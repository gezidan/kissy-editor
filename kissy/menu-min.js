/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Jul 20 18:43
*/
KISSY.add("menu/filtermenu",function(h,f,g,i){return f.create(g,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},handleFilterEvent:function(){this.set("filterStr",this.get("view").get("filterInput").val());var c=this.get("highlightedItem");if(!c||!c.get("visible"))this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},_uiSetFilterStr:function(c){this.filterItems(c)},filterItems:function(c){var a=this.get("view"),b=a.get("labelEl");a=a.get("filterInput");
b[c?"hide":"show"]();if(this.get("allowMultiple")){b=[];var d;d=c.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var e=[];if(d)e=d[1].split(/[,\uff0c]/);if(/[,\uff0c]$/.test(c)){b=[];if(d){b=e;d=e[e.length-1];if((e=(e=this.get("highlightedItem"))&&e.get("caption"))&&e.indexOf(d)>-1&&d)b[b.length-1]=e;a.val(b.join(",")+",")}c=""}else{if(d)c=d[2]||"";b=e}this.get("enteredItems").length!=b.length&&this.set("enteredItems",b)}a=this.get("children");var j=c&&RegExp(c.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,
"\\x08"),"ig"),k=h.substitute("{prefixCls}menuitem-hit",{prefixCls:this.get("prefixCls")});h.each(a,function(l){var m=l.get("caption"),n=l.get("view");if(c)if(m.indexOf(c)>-1){l.set("visible",true);l.get("view").set("content",m.replace(j,function(o){return"<span class='"+k+"'>"+o+"</span>"}))}else l.set("visible",false);else{n.set("content",m);l.set("visible",true)}})},decorateInternal:function(c){var a=this.get("prefixCls");this.set("el",c);this.decorateChildren(c.one("."+a+"menu-content"))},destructor:function(){var c=
this.get("view");(c=c&&c.get("filterInput"))&&c.detach()}},{ATTRS:{label:{view:true},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:false}},DefaultRender:i})},{requires:["uibase","./menu","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(h,f,g,i){function c(b,d){return h.substitute(d,{prefixCls:b.get("prefixCls")})}var a=f.all;return g.create(i,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var b=i.prototype.getContentElement.call(this),d=this.get("filterWrap");d||this.set("filterWrap",d=a("<div class='"+c(this,"{prefixCls}menu-filter")+"'/>").appendTo(b));this.get("labelEl")||this.set("labelEl",
a("<div class='"+c(this,"{prefixCls}menu-filter-label")+"'/>").appendTo(d));this.get("filterInput")||this.set("filterInput",a("<input autocomplete='off'/>").appendTo(d));this.get("menuContent")||this.set("menuContent",a("<div class='"+c(this,"{prefixCls}menu-content")+"'/>").appendTo(b))},_uiSetLabel:function(b){this.get("labelEl").html(b)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(b){return b.one("."+c(this,"{prefixCls}menu-filter")).one("."+c(this,"{prefixCls}menu-filter-label"))},filterWrap:function(b){return b.one("."+
c(this,"{prefixCls}menu-filter"))},menuContent:function(b){return b.one("."+c(this,"{prefixCls}menu-content"))},filterInput:function(b){return b.one("."+c(this,"{prefixCls}menu-filter")).one("input")}}})},{requires:["node","uibase","./menurender"]});
KISSY.add("menu/menu",function(h,f,g,i){var c;c=f.create(g.Container,{_uiSetHighlightedItem:function(a,b){var d=b&&b.prevVal;d&&d.set("highlighted",false);a&&a.set("highlighted",true);this.set("activeItem",a)},_handleBlur:function(a){if(c.superclass._handleBlur.call(this,a))return true;this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(a,b){var d=this.get("children"),e=d.length,j=a;do{var k=d[a];if(!k.get("disabled")&&k.get("visible")!==false)return d[a];a=(a+b+e)%e}while(a!=
j)},_handleClick:function(a){if(c.superclass._handleClick.call(this,a))return true;var b=this.get("highlightedItem");if(b&&b._handleClick(a))return true},_handleKeydown:function(a){if(this._handleKeydownInternal(a)){a.halt();return true}},_handleKeydownInternal:function(a){if(c.superclass._handleKeydown.call(this,a))return true;var b=this.get("highlightedItem");if(b&&b._handleKeydown(a))return true;var d=this.get("children"),e=d.length;if(e!=0){switch(a.keyCode){case 27:return;case 36:this.set("highlightedItem",
this._getNextEnabledHighlighted(0,1));break;case 35:this.set("highlightedItem",this._getNextEnabledHighlighted(e-1,-1));break;case 38:if(b){a=h.indexOf(b,d);e=(a-1+e)%e}else e=e-1;this.set("highlightedItem",this._getNextEnabledHighlighted(e,-1));break;case 40:if(b){a=h.indexOf(b,d);e=(a+1+e)%e}else e=0;this.set("highlightedItem",this._getNextEnabledHighlighted(e,1));break;default:return}return true}},bindUI:function(){var a=this;a.on("hide",function(){a.set("highlightedItem",undefined)})},containsElement:function(a){if(this.get("view").containsElement(a))return true;
for(var b=this.get("children"),d=0,e=b.length;d<e;d++){var j=b[d];if(typeof j.containsElement=="function"&&j.containsElement(a))return true}return false}},{ATTRS:{highlightedItem:{},activeItem:{view:true}}});c.DefaultRender=i;g.UIStore.setUIByClass("menu",{priority:10,ui:c});return c},{requires:["uibase","component","./menurender","./submenu"]});
KISSY.add("menu/menuitem",function(h,f,g,i){var c=f.create(g.ModelControl,[f.Contentbox],{_handleMouseEnter:function(a){if(c.superclass._handleMouseEnter.call(this,a))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(a){if(c.superclass._handleMouseLeave.call(this,a))return true;this.get("parent").set("highlightedItem",undefined)},_handleClick:function(a){if(c.superclass._handleClick.call(this,a))return true;this.get("selectable")&&this.set("selected",true);this.get("checkable")&&
this.set("checked",!this.get("checked"));this.get("parent").fire("click",{target:this})},_uiSetHighlighted:function(a){if(a){var b=this.get("el");a=this.get("parent").get("el");var d=b.offset().top;b=b[0].offsetHeight;var e=a.offset().top,j=a[0].offsetHeight;if(d-e>=j)a[0].scrollTop+=d-e+b-j;else if(d-e<0)a[0].scrollTop+=d-e}},containsElement:function(a){return this.get("view").containsElement(a)}},{ATTRS:{handleMouseEvents:{value:false},selectable:{view:true},checkable:{view:true},caption:{getter:function(a){a||
this.__set("caption",a=this.get("content"));return a}},value:{},highlighted:{view:true},checked:{view:true},selected:{view:true}}});c.DefaultRender=i;g.UIStore.setUIByClass("menuitem",{priority:10,ui:c});return c},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(h,f,g,i){function c(a,b){return h.substitute(b,{prefixCls:a.get("prefixCls")})}return g.create(i.Render,[g.Contentbox.Render],{renderUI:function(){var a=this.get("el");c(this,"{prefixCls}contentbox");a.addClass(c(this,"{prefixCls}menuitem")).attr("role","menuitem");this.get("contentEl").addClass(c(this,"{prefixCls}menuitem-content"));a.attr("id")||a.attr("id",h.guid("ks-menuitem"))},_uiSetDisabled:function(a){var b=this.get("el").attr("aria-disabled",!!a);
a?b.addClass(c(this,"{prefixCls}menuitem-disabled")):b.removeClass(c(this,"{prefixCls}menuitem-disabled"))},_uiSetHighlighted:function(a){var b=this.get("el");a?b.addClass(c(this,"{prefixCls}menuitem-highlight")):b.removeClass(c(this,"{prefixCls}menuitem-highlight"))},_uiSetSelected:function(a){this.get("el")[a?"addClass":"removeClass"](c(this,"{prefixCls}menuitem-selected"))},_uiSetChecked:function(a){this.get("el")[a?"addClass":"removeClass"](c(this,"{prefixCls}menuitem-checked"));if(a){a=this.get("el");
var b=c(this,"{prefixCls}menuitem-checkbox"),d=a.one("."+b);if(!d){d=(new f("<div class='"+b+"'/>")).prependTo(a);d.unselectable()}}},_uiSetSelectable:function(a){this.get("el").attr("role",a?"menuitemradio":"menuitem")},_uiSetCheckable:function(a){this.get("el").attr("role",a?"menuitemcheckbox":"menuitem")},_handleMouseDown:function(){var a=this.get("el");a.addClass(c(this,"{prefixCls}menuitem-active"));a.attr("aria-pressed",true)},_handleMouseUp:function(){var a=this.get("el");a.removeClass(c(this,
"{prefixCls}menuitem-active"));a.attr("aria-pressed",false)},containsElement:function(a){var b=this.get("el");return b[0]==a||b.contains(a)}},{ATTRS:{focusable:{value:false},highlighted:{},selected:{},checked:{},visibleMode:{value:"display"}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(h,f,g,i){return g.create(i.Render,[g.Contentbox.Render],{renderUI:function(){var c=this.get("el");c.addClass(h.substitute("{prefixCls}menu  {prefixCls}menu-vertical",{prefixCls:this.get("prefixCls")})).attr("role","menu").attr("aria-haspopup",true);c.attr("id")||c.attr("id",h.guid("ks-menu"))},_uiSetActiveItem:function(c){var a=this.get("el");if(c){c=c.get("view").get("el").attr("id");a.attr("aria-activedescendant",c)}else a.attr("aria-activedescendant","")},containsElement:function(c){var a=
this.get("el");return a[0]===c||a.contains(c)}},{ATTRS:{focusable:{value:true},activeItem:{},visibleMode:{value:"display"}}})},{requires:["ua","uibase","component"]});KISSY.add("menu/popupmenu",function(h,f,g,i,c){h=f.create(i,[f.Position,f.Align],{},{DefaultRender:c});g.UIStore.setUIByClass("popupmenu",{priority:20,ui:h});return h},{requires:["uibase","component","./menu","./popupmenurender"]});
KISSY.add("menu/popupmenurender",function(h,f,g,i){return g.create(i,[g.Position.Render,f.ie===6?g.Shim.Render:null],{renderUI:function(){this.get("el").addClass(h.substitute("{prefixCls}popmenu",{prefixCls:this.get("prefixCls")}))}},{ATTRS:{focusable:{value:false},visibleMode:{value:"visibility"}}})},{requires:["ua","uibase","./menurender"]});
KISSY.add("menu/separator",function(h,f,g,i){return f.create(g.ModelControl,{},{ATTRS:{handleMouseEvents:{value:false}},DefaultRender:i})},{requires:["uibase","component","./separatorrender"]});KISSY.add("menu/separatorrender",function(h,f,g){return f.create(g.Render,{createDom:function(){this.get("el").attr("role","separator").addClass(h.substitute("{prefixCls}menuseparator",{prefixCls:this.get("prefixCls")}))}},{ATTRS:{focusable:{value:false},disabled:{value:true}}})},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(h,f,g,i,c){var a;a=f.create(i,{_onParentHide:function(){this.get("menu")&&this.get("menu").hide()},bindUI:function(){var b=this.get("parent"),d=this.get("menu");if(b){b.on("hide",this._onParentHide,this);d.on("click",function(e){b.fire("click",{target:e.target})});d.on("afterActiveItemChange",function(e){b.set("activeItem",e.newVal)})}d.on("beforeHighlightedItemChange",this.onChildHighlight_,this)},_handleMouseEnter:function(b){if(a.superclass._handleMouseEnter.call(this,
b))return true;this.clearTimers();this.showTimer_=h.later(this.showMenu,this.get("menuDelay"),false,this)},showMenu:function(){var b=this.get("menu");b.set("align",{node:this.get("view").get("el"),points:["tr","tl"]});b.render();this.get("view").get("el").attr("aria-haspopup",b.get("view").get("el").attr("id"));b.show()},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}},onChildHighlight_:function(b){if(b.newVal)if(this.get("menu").get("parent")==
this){this.clearTimers();this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var b=this.get("menu");b&&b.hide()},_handleClick:function(b){this.showMenu();return this.get("menu")._handleClick(b)},_handleKeydown:function(b){if(a.superclass._handleKeydown.call(this,b))return true;var d=this.get("menu"),e=d&&d.get("visible"),j=b.keyCode;if(e){if(!d._handleKeydown(b))if(j==37){this.hideMenu();this.get("parent").set("activeItem",this)}else return}else if(j==39){this.showMenu();b=d.get("children");
b[0]&&d.set("highlightedItem",b[0])}else return;return true},_uiSetHighlighted:function(b,d){a.superclass._uiSetHighlighted.call(this,b,d);if(!b){this.dismissTimer_&&this.dismissTimer_.cancel();this.dismissTimer_=h.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(b){var d=this.get("menu");return d&&d.containsElement(b)},decorateInternal:function(b){var d=this.get("prefixCls");this.set("el",b);var e=b.one("."+d+"popupmenu");if(e){e.hide();h.one(b[0].ownerDocument.body).prepend(e);
this.set("menu",new (g.UIStore.getUIByClass("popupmenu"))({srcNode:e,prefixCls:d}))}},destructor:function(){var b=this.get("parent"),d=this.get("menu");this.clearTimers();b&&b.detach("hide",this._onParentHide,this);!this.get("externalSubMenu")&&d&&d.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:false},menu:{setter:function(b){b.set("parent",this)}}}});a.DefaultRender=c;g.UIStore.setUIByClass("submenu",{priority:20,ui:a});return a},{requires:["uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(h,f,g){var i;return i=f.create(g,{renderUI:function(){var c=this.get("el"),a=this.get("contentEl");c.addClass(this.get("prefixCls")+"submenu").attr("aria-haspopup","true");a.append(h.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetContent:function(c){i.superclass._uiSetContent.call(this,c);this.get("contentEl").append(h.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},
{requires:["uibase","./menuitemrender"]});KISSY.add("menu",function(h,f,g,i,c,a,b,d,e,j,k){f.Render=g;f.Item=i;f.Item.Render=c;f.SubMenu=a;a.Render=b;f.Separator=d;f.PopupMenu=j;f.FilterMenu=k;return f},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender","menu/separator","menu/separatorrender","menu/popupmenu","menu/filtermenu"]});
