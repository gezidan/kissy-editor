/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Aug 9 18:39
*/
KISSY.add("menu/delmenuitem",function(i,g,f,j,a,b){var h=g.all;i=b.CLS;var d=b.DEL_CLS;f=f.create(a,{_performInternal:function(c){if(h(c.target).hasClass(this.getCls(d))){this.get("parent").removeChild(this,true);this.get("parent").set("highlightedItem",null);this.get("parent").fire("delete",{target:this});return true}return a.prototype._performInternal.call(this,c)},_handleKeydown:function(c){if(c.keyCode===g.KeyCodes.D){this.get("parent").removeChild(this,true);this.get("parent").set("highlightedItem",
null);this.get("parent").fire("delete",{target:this});return true}}},{ATTRS:{delTooltip:{view:true}},DefaultRender:b});j.UIStore.setUIByClass(i,{priority:j.UIStore.PRIORITY.LEVEL4,ui:f});return f},{requires:["node","uibase","component","./menuitem","./delmenuitemrender"]});
KISSY.add("menu/delmenuitemrender",function(i,g,f,j,a){function b(d){d.get("contentEl").append(i.substitute(h,{prefixCls:d.get("prefixCls"),tooltip:d.get("delTooltip")}))}var h='<span class="{prefixCls}menuitem-delete" title="{tooltip}">X</span>';return f.create(a,{renderUI:function(){this.get("el").addClass(this.getCls("menuitem-deletable"))},createDom:function(){b(this)},_uiSetContent:function(d){a.prototype._uiSetContent.call(this,d);b(this)},_uiSetDelTooltip:function(){this._uiSetContent(this.get("content"))}},
{ATTRS:{delTooltip:{}},HTML_PARSER:{delEl:function(d){return d.one(this.getCls("menuitem-delete"))}},CLS:"menuitem-deletable",DEL_CLS:"menuitem-delete"})},{requires:["node","uibase","component","./menuitemrender"]});
KISSY.add("menu/filtermenu",function(i,g,f,j){return g.create(f,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},handleFilterEvent:function(){var a=this.get("view").get("filterInput"),b=this.get("highlightedItem");this.set("filterStr",a.val());if(!b||!b.get("visible"))this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},_uiSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var b=this.get("view"),h=b.get("labelEl");b=b.get("filterInput");
h[a?"hide":"show"]();if(this.get("allowMultiple")){h=[];var d;d=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var c=[];if(d)c=d[1].split(/[,\uff0c]/);if(/[,\uff0c]$/.test(a)){h=[];if(d){h=c;d=c[c.length-1];if((c=(c=this.get("highlightedItem"))&&c.get("caption"))&&c.indexOf(d)>-1&&d)h[h.length-1]=c;b.val(h.join(",")+",")}a=""}else{if(d)a=d[2]||"";h=c}this.get("enteredItems").length!=h.length&&this.set("enteredItems",h)}b=this.get("children");var e=a&&RegExp(a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,
"\\x08"),"ig"),k=this.getCls("menuitem-hit");i.each(b,function(l){var m=l.get("caption"),n=l.get("view");if(a)if(m.indexOf(a)>-1){l.set("visible",true);n.set("content",m.replace(e,function(o){return"<span class='"+k+"'>"+o+"</span>"}))}else l.set("visible",false);else{n.set("content",m);l.set("visible",true)}})},decorateInternal:function(a){this.set("el",a);this.decorateChildren(a.one("."+this.getCls("menu-content")))},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},
{ATTRS:{label:{view:true},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:false}},DefaultRender:j})},{requires:["uibase","./menu","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(i,g,f,j){var a=g.all;return f.create(j,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var b=j.prototype.getContentElement.call(this),h=this.get("filterWrap");h||this.set("filterWrap",h=a("<div class='"+this.getCls("menu-filter")+"'/>").appendTo(b));this.get("labelEl")||this.set("labelEl",a("<div class='"+this.getCls("menu-filter-label")+"'/>").appendTo(h));this.get("filterInput")||
this.set("filterInput",a("<input autocomplete='off'/>").appendTo(h));this.get("menuContent")||this.set("menuContent",a("<div class='"+this.getCls("menu-content")+"'/>").appendTo(b))},_uiSetLabel:function(b){this.get("labelEl").html(b)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(b){return b.one("."+this.getCls("menu-filter")).one("."+this.getCls("menu-filter-label"))},filterWrap:function(b){return b.one("."+this.getCls("menu-filter"))},menuContent:function(b){return b.one("."+this.getCls("menu-content"))},
filterInput:function(b){return b.one("."+this.getCls("menu-filter")).one("input")}}})},{requires:["node","uibase","./menurender"]});
KISSY.add("menu/menu",function(i,g,f,j,a){var b=g.KeyCodes,h=f.create(j.Container,{_uiSetHighlightedItem:function(d,c){var e=c&&c.prevVal;e&&e.set("highlighted",false);d&&d.set("highlighted",true);this.set("activeItem",d)},_handleBlur:function(d){h.superclass._handleBlur.call(this,d);this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(d,c){var e=this.get("children"),k=e.length,l=d;do{var m=e[d];if(!m.get("disabled")&&m.get("visible")!==false)return e[d];d=(d+c+k)%k}while(d!=
l)},_handleKeydown:function(d){if(this._handleKeyEventInternal(d)){d.halt();return true}},_handleKeyEventInternal:function(d){var c=this.get("highlightedItem");if(c&&c._handleKeydown(d))return true;var e=this.get("children"),k=e.length;if(k!==0){switch(d.keyCode){case b.ESC:return;case b.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case b.END:this.set("highlightedItem",this._getNextEnabledHighlighted(k-1,-1));break;case b.UP:if(c){d=i.indexOf(c,e);k=(d-1+k)%k}else k=
k-1;this.set("highlightedItem",this._getNextEnabledHighlighted(k,-1));break;case b.DOWN:if(c){d=i.indexOf(c,e);k=(d+1+k)%k}else k=0;this.set("highlightedItem",this._getNextEnabledHighlighted(k,1));break;default:return}return true}},bindUI:function(){var d=this;d.on("hide",function(){d.set("highlightedItem",undefined)})},containsElement:function(d){if(this.get("view").containsElement(d))return true;for(var c=this.get("children"),e=0,k=c.length;e<k;e++){var l=c[e];if(typeof l.containsElement=="function"&&
l.containsElement(d))return true}return false}},{ATTRS:{focusable:{value:true},visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:true}},DefaultRender:a});j.UIStore.setUIByClass("menu",{priority:j.UIStore.PRIORITY.LEVEL1,ui:h});return h},{requires:["event","uibase","component","./menurender","./submenu"]});
KISSY.add("menu/menuitem",function(i,g,f,j){var a=g.create(f.ModelControl,[g.Contentbox],{_handleMouseEnter:function(b){if(a.superclass._handleMouseEnter.call(this,b))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(b){if(a.superclass._handleMouseLeave.call(this,b))return true;this.get("parent").set("highlightedItem",undefined)},_performInternal:function(){this.get("selectable")&&this.set("selected",true);this.get("checkable")&&this.set("checked",!this.get("checked"));
this.get("parent").fire("click",{target:this});return true},_uiSetHighlighted:function(b){if(b){var h=this.get("el");b=this.get("parent").get("el");var d=h.offset().top;h=h[0].offsetHeight;var c=b.offset().top,e=b[0].offsetHeight;if(d-c>=e)b[0].scrollTop+=d-c+h-e;else if(d-c<0)b[0].scrollTop+=d-c}},containsElement:function(b){return this.get("view").containsElement(b)}},{ATTRS:{focusable:{value:false},visibleMode:{value:"display"},handleMouseEvents:{value:false},selectable:{view:true},checkable:{view:true},
caption:{getter:function(b){b||this.__set("caption",b=this.get("content"));return b}},value:{},checked:{view:true},selected:{view:true}}});a.DefaultRender=j;f.UIStore.setUIByClass("menuitem",{priority:10,ui:a});return a},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(i,g,f,j){return f.create(j.Render,[f.Contentbox.Render],{renderUI:function(){var a=this.get("el");a.addClass(this.getCls("menuitem")).attr("role","menuitem");this.get("contentEl").addClass(this.getCls("menuitem-content"));a.attr("id")||a.attr("id",i.guid("ks-menuitem"))},_uiSetDisabled:function(a){var b=this.get("el").attr("aria-disabled",!!a);a?b.addClass(this.getCls("menuitem-disabled")):b.removeClass(this.getCls("menuitem-disabled"))},_uiSetHighlighted:function(a){var b=
this.get("el");a?b.addClass(this.getCls("menuitem-highlight")):b.removeClass(this.getCls("menuitem-highlight"))},_uiSetSelected:function(a){this.get("el")[a?"addClass":"removeClass"](this.getCls("menuitem-selected"))},_uiSetChecked:function(a){this.get("el")[a?"addClass":"removeClass"](this.getCls("menuitem-checked"));if(a){a=this.get("el");var b=this.getCls("menuitem-checkbox"),h=a.one("."+b);if(!h){h=(new g("<div class='"+b+"'/>")).prependTo(a);h.unselectable()}}},_uiSetSelectable:function(a){this.get("el").attr("role",
a?"menuitemradio":"menuitem")},_uiSetCheckable:function(a){this.get("el").attr("role",a?"menuitemcheckbox":"menuitem")},_uiSetActive:function(a){this.get("el")[a?"addClass":"removeClass"](this.getCls("menuitem-active")).attr("aria-pressed",a)},containsElement:function(a){var b=this.get("el");return b[0]==a||b.contains(a)}},{ATTRS:{selected:{},checked:{}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(i,g,f,j){return f.create(j.Render,[f.Contentbox.Render],{renderUI:function(){var a=this.get("el");a.addClass(this.getCls("menu  menu-vertical")).attr("role","menu").attr("aria-haspopup",true);a.attr("id")||a.attr("id",i.guid("ks-menu"))},_uiSetActiveItem:function(a){var b=this.get("el");if(a){a=a.get("el").attr("id");b.attr("aria-activedescendant",a)}else b.attr("aria-activedescendant","")},containsElement:function(a){var b=this.get("el");return b[0]===a||b.contains(a)}},
{ATTRS:{activeItem:{}}})},{requires:["ua","uibase","component"]});KISSY.add("menu/popupmenu",function(i,g,f,j,a){i=g.create(j,[g.Position,g.Align],{},{ATTRS:{focusable:{value:false},visibleMode:{value:"visibility"}},DefaultRender:a});f.UIStore.setUIByClass("popupmenu",{priority:f.UIStore.PRIORITY.LEVEL2,ui:i});return i},{requires:["uibase","component","./menu","./popupmenurender"]});
KISSY.add("menu/popupmenurender",function(i,g,f,j){return f.create(j,[f.Position.Render,g.ie===6?f.Shim.Render:null],{renderUI:function(){this.get("el").addClass(this.getCls("popmenu"))}})},{requires:["ua","uibase","./menurender"]});
KISSY.add("menu/separator",function(i,g,f,j){i=g.create(f.ModelControl,{},{ATTRS:{focusable:{value:false},disabled:{value:true},handleMouseEvents:{value:false}},DefaultRender:j});f.UIStore.setUIByClass("menuseparator",{priority:f.UIStore.PRIORITY.LEVEL2,ui:i});return i},{requires:["uibase","component","./separatorrender"]});
KISSY.add("menu/separatorrender",function(i,g,f){return g.create(f.Render,{createDom:function(){this.get("el").attr("role","separator").addClass(this.getCls("menuseparator"))}})},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(i,g,f,j,a,b){var h=g.KeyCodes,d=f.create(a,[j.DecorateChild],{_onParentHide:function(){this.get("menu")&&this.get("menu").hide()},bindUI:function(){var c=this.get("parent"),e=this.get("menu");if(c){c.on("hide",this._onParentHide,this);e.on("click",function(k){c.fire("click",{target:k.target})});e.on("afterActiveItemChange",function(k){c.set("activeItem",k.newVal)})}e.on("beforeHighlightedItemChange",this.onChildHighlight_,this)},_handleMouseEnter:function(c){if(d.superclass._handleMouseEnter.call(this,
c))return true;this.clearTimers();this.showTimer_=i.later(this.showMenu,this.get("menuDelay"),false,this)},showMenu:function(){var c=this.get("menu");c.set("align",{node:this.get("el"),points:["tr","tl"]});c.render();this.get("el").attr("aria-haspopup",c.get("el").attr("id"));c.show()},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}},onChildHighlight_:function(c){if(c.newVal)if(this.get("menu").get("parent")==
this){this.clearTimers();this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var c=this.get("menu");c&&c.hide()},_performInternal:function(){this.clearTimers();this.showMenu()},_handleKeydown:function(c){var e=this.get("menu"),k=e&&e.get("visible"),l=c.keyCode;if(k){if(!e._handleKeydown(c))if(l==h.LEFT){this.hideMenu();this.get("parent").set("activeItem",this)}else return}else if(l==h.RIGHT){this.showMenu();c=e.get("children");c[0]&&e.set("highlightedItem",c[0])}else return;return true},
_uiSetHighlighted:function(c,e){d.superclass._uiSetHighlighted.call(this,c,e);if(!c){this.dismissTimer_&&this.dismissTimer_.cancel();this.dismissTimer_=i.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(c){var e=this.get("menu");return e&&e.containsElement(c)},decorateChildrenInternal:function(c,e,k){e.hide();i.one(e[0].ownerDocument.body).prepend(e);this.set("menu",new c({srcNode:e,prefixCls:k}))},destructor:function(){var c=this.get("parent"),e=this.get("menu");this.clearTimers();
c&&c.detach("hide",this._onParentHide,this);!this.get("externalSubMenu")&&e&&e.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:false},menu:{setter:function(c){c.set("parent",this)}},decorateChildCls:{value:"popupmenu"}},DefaultRender:b});j.UIStore.setUIByClass("submenu",{priority:j.UIStore.PRIORITY.LEVEL2,ui:d});return d},{requires:["event","uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(i,g,f){var j;return j=g.create(f,{renderUI:function(){var a=this.get("el"),b=this.get("contentEl");a.addClass(this.get("prefixCls")+"submenu").attr("aria-haspopup","true");b.append(i.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetContent:function(a){j.superclass._uiSetContent.call(this,a);this.get("contentEl").append(i.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},
{requires:["uibase","./menuitemrender"]});KISSY.add("menu",function(i,g,f,j,a,b,h,d,c,e,k,l){g.Render=f;g.Item=j;g.Item.Render=a;g.SubMenu=b;b.Render=h;g.Separator=d;g.PopupMenu=e;g.FilterMenu=k;g.DelMenuItem=l;return g},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender","menu/separator","menu/separatorrender","menu/popupmenu","menu/filtermenu","menu/delmenuitem","menu/delmenuitemrender"]});
