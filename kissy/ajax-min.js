/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Aug 9 18:38
*/
KISSY.add("ajax/base",function(i,h,j,f){function c(e){e=i.mix(i.clone(u),e||{},undefined,undefined,true);if(!i.isBoolean(e.crossDomain)){var l=n.exec(e.url.toLowerCase());e.crossDomain=!!(l&&(l[1]!=r[1]||l[2]!=r[2]||(l[3]||(l[1]==="http:"?o:q))!=(r[3]||(r[1]==="http:"?o:q))))}if(e.processData&&e.data&&!i.isString(e.data))e.data=i.param(e.data,undefined,undefined,e.serializeArray);e.type=e.type.toUpperCase();e.hasContent=!p.test(e.type);if(!e.hasContent){if(e.data)e.url+=(/\?/.test(e.url)?"&":"?")+
e.data;if(e.cache===false)e.url+=(/\?/.test(e.url)?"&":"?")+"_ksTS="+(i.now()+"_"+i.guid())}e.dataType=i.trim(e.dataType||"*").split(g);e.context=e.context||e;return e}function a(e,l){d.fire(e,{ajaxConfig:l.config,xhr:l})}function b(e){var l=this.config;e=e.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);l[e]&&l[e].call(l.context,this.responseData,this.statusText,this);a(e,this)}function d(e){if(e.url){e=c(e);var l=new f(e);a("start",l);var x=new (s[e.dataType[0]]||s["*"])(l);l.transport=
x;e.contentType&&l.setRequestHeader("Content-Type",e.contentType);var v=e.dataType[0],w=e.accepts;l.setRequestHeader("Accept",v&&w[v]?w[v]+(v==="*"?"":", */*; q=0.01"):w["*"]);for(var y in e.headers)l.setRequestHeader(y,e.headers[y]);l.on("complete success error",b);l.readyState=1;a("send",l);if(e.async&&e.timeout>0)l.timeoutTimer=setTimeout(function(){l.abort("timeout")},e.timeout);try{l.state=1;x.send()}catch(z){l.status<2&&l.callback(-1,z)}return l}}var g=/\s+/,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,
m=function(e){return e},o=80,q=443,p=/^(?:GET|HEAD)$/,k,r;try{k=location.href}catch(t){k=document.createElement("a");k.href="";k=k.href}r=n.exec(k);k=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(r[1]);var s={},u={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:h.parse,
html:m,text:m,xml:i.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};u.converters.html=u.converters.text;i.mix(d,j.Target);i.mix(d,{isLocal:k,setupConfig:function(e){i.mix(u,e,undefined,undefined,true)},setupTransport:function(e,l){s[e]=l},getTransport:function(e){return s[e]},getConfig:function(){return u}});return d},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/form-serializer",function(i,h){return{serialize:function(j){j=h.get(j);var f={};i.each(j.elements,function(c){c.disabled||(f[c.name]=h.val(c))});return i.param(f,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/form",function(i,h,j,f){h.on("start",function(c){c=c.xhr.config;if(c.form){var a=j.get(c.form);if((a.encoding||a.enctype).toLowerCase()!="multipart/form-data"){if(a=f.serialize(a))if(c.hasContent){c.data=c.data||"";if(c.data)c.data+="&";c.data+=a}else c.url+=(/\?/.test(c.url)?"&":"?")+a}else{a=c.dataType[0];if(a=="*")a="text";c.dataType.length=2;c.dataType[0]="iframe";c.dataType[1]=a}}});return h},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-upload",function(i,h,j,f){function c(b){this.xhr=b}var a=document;f.setupConfig({converters:{iframe:f.getConfig().converters.text,text:{iframe:function(b){return b}}}});i.augment(c,{send:function(){var b=this.xhr,d=b.config,g,n=h.get(d.form);this.attrs={target:h.attr(n,"target")||"",action:h.attr(n,"action")||""};this.form=n;var m=i.guid("ajax-iframe");b.iframe=h.create("<iframe  id='"+m+"' name='"+m+"' style='position:absolute;left:-9999px;top:-9999px;'/>");b.iframeId=m;h.prepend(b.iframe,
a.body||a.documentElement);h.attr(n,{target:b.iframeId,action:d.url});if(d.data){g=d.data;d=d.serializeArray;g=i.unparam(g);m=[];for(var o in g)for(var q=i.makeArray(g[o]),p=0;p<q.length;p++){var k=a.createElement("input");k.type="hidden";k.name=o+(d?"[]":"");k.value=q[p];h.append(k,n);m.push(k)}g=m}this.fields=g;j.on(b.iframe,"load error",this._callback,this);n.submit()},_callback:function(b){var d=this.xhr;b=b.type;var g=d.iframe;if(g){h.attr(this.form,this.attrs);if(b=="load"){b=g.contentWindow.document;
d.responseXML=b;d.responseText=h.text(b.body);d.callback(200,"success")}else b=="error"&&d.callback(500,"error");h.remove(this.fields);j.detach(g);setTimeout(function(){h.remove(g)},30);d.iframe=null}},abort:function(){this._callback(0,1)}});f.setupTransport("iframe",c);return f},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(i,h){h.setupConfig({jsonp:"callback",jsonpCallback:function(){return i.guid("jsonp")}});h.on("start",function(j){j=j.xhr;var f=j.config;if(f.dataType[0]=="jsonp"){var c,a=f.jsonpCallback,b=i.isFunction(a)?a():a,d=window[b];f.url+=(/\?/.test(f.url)?"&":"?")+f.jsonp+"="+b;window[b]=function(g){if(arguments.length>1)g=i.makeArray(arguments);c=[g]};j.on("complete",function(){window[b]=d;if(d===undefined)try{delete window[b]}catch(g){}else c&&d(c[0])});j.converters=j.converters||
{};j.converters.script=j.converters.script||{};j.converters.script.json=function(){return c[0]};f.dataType.length=2;f.dataType[0]="script";f.dataType[1]="json"}});return h},{requires:["./base"]});
KISSY.add("ajax/script",function(i,h){function j(c){if(!c.config.crossDomain&&!c.config.forceScript)return new (h.getTransport("*"))(c);this.xhrObj=c;return 0}var f=document;h.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(c){i.globalEval(c);return c}}}});i.augment(j,{send:function(){var c=this,a,b=this.xhrObj.config,d=f.head||f.getElementsByTagName("head")[0]||
f.documentElement;c.head=d;a=f.createElement("script");c.script=a;a.async="async";if(b.scriptCharset)a.charset=b.scriptCharset;a.src=b.url;a.onerror=a.onload=a.onreadystatechange=function(g){g=g||window.event;c._callback((g.type||"error").toLowerCase())};d.insertBefore(a,d.firstChild)},_callback:function(c,a){var b=this.script,d=this.xhrObj,g=this.head;if(b)if(a||!b.readyState||/loaded|complete/.test(b.readyState)||c=="error"){b.onerror=b.onload=b.onreadystatechange=null;if(g&&b.parentNode){b.src=
"#";g.removeChild(b)}this.head=this.script=undefined;if(!a&&c!="error")d.callback(200,"success");else c=="error"&&d.callback(500,"scripterror")}},abort:function(){this._callback(0,1)}});h.setupTransport("script",j);return h},{requires:["./base","./xhr"]});
KISSY.add("ajax/xhr",function(i,h){function j(){try{return new window.XMLHttpRequest}catch(a){}}h.xhr=window.ActiveXObject?function(){var a;if(!(a=!h.isLocal&&j()))a:{try{a=new window.ActiveXObject("Microsoft.XMLHTTP");break a}catch(b){}a=void 0}return a}:j;var f=h.xhr(),c=false;if(f){if("withCredentials"in f)c=true;f=function(a){this.xhrObj=a};i.augment(f,{send:function(){var a=this,b=a.xhrObj,d=b.config;if(!(d.crossDomain&&!c)){var g=h.xhr(),n,m;a.xhr=g;d.username?g.open(d.type,d.url,d.async,d.username,
d.password):g.open(d.type,d.url,d.async);if(n=d.xhrFields)for(m in n)g[m]=n[m];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType);if(!d.crossDomain&&!b.requestHeaders["X-Requested-With"])b.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{for(m in b.requestHeaders)g.setRequestHeader(m,b.requestHeaders[m])}catch(o){}g.send(d.hasContent&&d.data||null);if(!d.async||g.readyState==4)a._callback();else g.onreadystatechange=function(){a._callback()}}},abort:function(){this._callback(0,
1)},_callback:function(a,b){try{var d=this.xhr,g=this.xhrObj,n=g.config;if(b||d.readyState==4){d.onreadystatechange=i.noop;if(b)d.readyState!==4&&d.abort();else{var m=d.status;g.responseHeadersString=d.getAllResponseHeaders();var o=d.responseXML;if(o&&o.documentElement)g.responseXML=o;g.responseText=d.responseText;try{var q=d.statusText}catch(p){q=""}if(!m&&h.isLocal&&!n.crossDomain)m=g.responseText?200:404;else if(m===1223)m=204;g.callback(m,q)}}}catch(k){d.onreadystatechange=i.noop;b||g.callback(-1,
k)}}});h.setupTransport("*",f);return h}},{requires:["./base"]});
KISSY.add("ajax/xhrobject",function(i,h){function j(a){var b=a.responseText,d=a.responseXML,g=a.config,n=g.converters,m=a.converters||{},o,q,p=g.contents,k=g.dataType;if(b||d){for(g=a.mimeType||a.getResponseHeader("Content-Type");k[0]=="*";)k.shift();if(!k.length)for(o in p)if(p[o].test(g)){k[0]!=o&&k.unshift(o);break}k[0]=k[0]||"text";if(k[0]=="text"&&b!==undefined)q=b;else if(k[0]=="xml"&&d!==undefined)q=d;else i.each(["text","xml"],function(t){var s=k[0];if(m[t]&&m[t][s]||n[t]&&n[t][s]){k.unshift(t);
q=t=="text"?b:d;return false}})}p=k[0];for(g=1;g<k.length;g++){o=k[g];var r=m[p]&&m[p][o]||n[p]&&n[p][o];if(!r)throw"no covert for "+p+" => "+o;q=r(q);p=o}a.responseData=q}function f(a){i.mix(this,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var c=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;i.augment(f,h.Target,{setRequestHeader:function(a,b){this.requestHeaders[a]=
b;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(a){var b;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};b=c.exec(this.responseHeadersString);)this.responseHeaders[b[1]]=b[2];b=this.responseHeaders[a]}return b===undefined?null:b},overrideMimeType:function(a){if(!this.state)this.mimeType=a;return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this.callback(0,a);return this},
callback:function(a,b){if(this.state!=2){this.state=2;this.readyState=4;var d;if(a>=200&&a<300||a==304)if(a==304){b="notmodified";d=true}else try{j(this);b="success";d=true}catch(g){b="parsererror : "+g}else if(a<0)a=0;this.status=a;this.statusText=b;d?this.fire("success"):this.fire("error");this.fire("complete");this.transport=undefined}}});return f},{requires:["event"]});
KISSY.add("ajax",function(i,h){i.mix(h,{get:function(j,f,c,a,b){if(i.isFunction(f)){a=c;c=f;f=undefined}return h({type:b||"get",url:j,data:f,success:c,dataType:a})},post:function(j,f,c,a){if(i.isFunction(f)){a=c;c=f;f=undefined}return h.get(j,f,c,a,"post")},jsonp:function(j,f,c){if(i.isFunction(f)){c=f;f=undefined}return h.get(j,f,c,"jsonp")},getScript:i.getScript,getJSON:function(j,f,c){if(i.isFunction(f)){c=f;f=undefined}return h.get(j,f,c,"json")},upload:function(j,f,c,a,b){if(i.isFunction(c)){b=
a;a=c;c=undefined}return h({url:j,type:"post",dataType:b,form:f,data:c,success:a})}});return h},{requires:["ajax/base","ajax/xhrobject","ajax/xhr","ajax/script","ajax/jsonp","ajax/form","ajax/iframe-upload"]});
