KISSY.Editor.add("walker",function(o){function k(a,c){if(this._.end)return null;var b=this.range,d,f=this.guard,i=this.type,p=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;b.trim();if(b.collapsed){this.end();return null}}if(!a&&!this._.guardLTR){var q=b.endContainer,r=new l(q[0].childNodes[b.endOffset]);this._.guardLTR=function(e,g){return(e=m._4e_wrap(e))&&e[0]&&(!g||!m._4e_equals(q,e))&&(!r[0]||!e._4e_equals(r))&&(e[0].nodeType!=j.NODE_ELEMENT||!g||e._4e_name()!=
"body")}}if(a&&!this._.guardRTL){var s=b.startContainer,t=b.startOffset>0&&new l(s[0].childNodes[b.startOffset-1]);this._.guardRTL=function(e,g){return(e=m._4e_wrap(e))&&e[0]&&(!g||!e._4e_equals(s))&&(!t[0]||!e._4e_equals(t))&&(e[0].nodeType!=j.NODE_ELEMENT||!g||e._4e_name()!="body")}}var u=a?this._.guardRTL:this._.guardLTR;d=f?function(e,g){if(u(e,g)===false)return false;return f(e,g)}:u;if(this.current)a=this.current[p](false,i,d);else if(a){a=b.endContainer;if(b.endOffset>0){a=new l(a[0].childNodes[b.endOffset-
1]);if(d(a)===false)a=null}else a=d(a,true)===false?null:a._4e_previousSourceNode(true,i,d)}else{a=b.startContainer;if((a=new l(a[0].childNodes[b.startOffset]))&&a[0]){if(d(a)===false)a=null}else a=d(b.startContainer,true)===false?null:b.startContainer._4e_nextSourceNode(true,i,d)}for(;a&&a[0]&&!this._.end;){this.current=a;if(!this.evaluator||this.evaluator(a)!==false){if(!c)return a}else if(c&&this.evaluator)return false;a=a[p](false,i,d)}this.end();return this.current=null}function v(a){for(var c,
b=null;c=k.call(this,a);)b=c;return b}function h(a){this.range=a;this._={}}var n=KISSY,j=o.NODE,m=n.DOM,l=n.Node;n.augment(h,{end:function(){this._.end=1},next:function(){return k.call(this)},previous:function(){return k.call(this,true)},checkForward:function(){return k.call(this,false,true)!==false},checkBackward:function(){return k.call(this,true,true)!==false},lastForward:function(){return v.call(this)},lastBackward:function(){return v.call(this,true)},reset:function(){delete this.current;this._=
{}}});h.blockBoundary=function(a){return function(c){c=m._4e_wrap(c);return!(c&&c[0].nodeType==j.NODE_ELEMENT&&c._4e_isBlockBoundary(a))}};h.listItemBoundary=function(){return this.blockBoundary({br:1})};h.bookmark=function(a,c){function b(d){return d&&d[0]&&d._4e_name()=="span"&&d.attr("_ke_bookmark")}return function(d){var f,i;f=d&&d[0]&&d[0].nodeType==j.NODE_TEXT&&(i=d.parent())&&b(i);f=a?f:f||b(d);return c^f}};h.whitespaces=function(a){return function(c){c=(c=c[0]||c)&&c.nodeType==j.NODE_TEXT&&
!n.trim(c.nodeValue);return a^c}};h.invisible=function(a){var c=h.whitespaces();return function(b){b=c(b)||b[0].nodeType==j.NODE_ELEMENT&&!b[0].offsetHeight;return a^b}};o.Walker=h});
