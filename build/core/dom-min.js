KISSY.Editor.add("dom",function(p){function u(a){return a.replace(/-(\w)/g,function(b,c){return c.toUpperCase()})}var o=KISSY,i=o.DOM,k=o.UA,n=o.Node,t=p.Utils,v={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};p.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};p.POSITION={};var l=p.NODE,m=p.POSITION;m.POSITION_IDENTICAL=0;m.POSITION_DISCONNECTED=
1;m.POSITION_FOLLOWING=2;m.POSITION_PRECEDING=4;m.POSITION_IS_CONTAINED=8;m.POSITION_CONTAINS=16;var q={},w={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},x={hr:1},f=function(a){return a[0]||a},r=function(a){if(a&&!a[0])return new n(a);return a},s={_4e_wrap:r,_4e_equals:function(a,b){if(!a&&!b)return true;if(!a||!b)return false;a=f(a);b=f(b);return a===b},_4e_isBlockBoundary:function(a,
b){a=r(a);b=o.mix(o.mix({},x),b||{});return w[a.css("display")]||b[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=f(a);for(var b=a.parentNode.childNodes,c=0;c<b.length;c++)if(b[c]===a)return c;return-1},_4e_first:function(a,b){a=f(a);if((a=(a=a.firstChild)&&new n(a))&&b&&!b(a))a=a._4e_next(b);return a},_4e_move:function(a,b,c){a._4e_remove();a=f(a);b=f(b);c?b.insertBefore(a,b.firstChild):b.appendChild(a)},
_4e_name:function(a){a=f(a);var b=a.nodeName.toLowerCase();if(k.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},_4e_isIdentical:function(a,b){if(a._4e_name()!=b._4e_name())return false;var c=a[0].attributes,d=b[0].attributes,e=c.length,g=d.length;if(!k.ie&&e!=g)return false;for(var h=0;h<e;h++){var j=c[h];if((!k.ie||j.specified&&j.nodeName!="_ke_expando")&&j.nodeValue!=b.attr(j.nodeName))return false}if(k.ie)for(h=0;h<g;h++){j=d[h];if(j.specified&&j.nodeName!="_ke_expando"&&j.nodeValue!=
a.attr(j.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=f(a).childNodes;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.nodeType;if(!(e==l.NODE_ELEMENT&&d.getAttribute("_ke_bookmark")))if(e==l.NODE_ELEMENT&&!s._4e_isEmptyInlineRemoveable(d)||e==l.NODE_TEXT&&o.trim(d.nodeValue))return false}return true},_4e_moveChildren:function(a,b,c){a=f(a);b=b[0]||b;if(a!=b)if(c)for(;c=a.lastChild;)b.insertBefore(a.removeChild(c),b.firstChild);else for(;c=a.firstChild;)b.appendChild(a.removeChild(c))},
_4e_mergeSiblings:function(){function a(b,c,d){if(c[0]&&c[0].nodeType==l.NODE_ELEMENT){for(var e=[];c.attr("_ke_bookmark")||c._4e_isEmptyInlineRemoveable();){e.push(c);c=d?new n(c[0].nextSibling):new n(c[0].previousSibling);if(!c[0]||c[0].nodeType!=l.NODE_ELEMENT)return}if(b._4e_isIdentical(c)){for(var g=d?b[0].lastChild:b[0].firstChild;e.length;)e.shift()._4e_move(b,!d);c._4e_moveChildren(b,!d);c._4e_remove();g[0]&&g[0].nodeType==l.NODE_ELEMENT&&g._4e_mergeSiblings()}}}return function(b){if(b[0])if(v[b._4e_name()]||
b._4e_name()=="a"){a(b,new n(b[0].nextSibling),true);a(b,new n(b[0].previousSibling))}}}(),_4e_unselectable:k.gecko?function(a){a=f(a);a.style.MozUserSelect="none"}:k.webkit?function(a){a=f(a);a.style.KhtmlUserSelect="none"}:function(a){a=f(a);if(k.ie||k.opera){var b,c=0;for(a.unselectable="on";b=a.all[c++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},_4e_getOffset:function(a,b){a=f(a);var c,d=0;c=0;var e=a.ownerDocument.defaultView||
a.ownerDocument.parentWindow,g=a.ownerDocument,h=g.documentElement;b=b||g;if(a.getBoundingClientRect){if(a!==g.body&&h!==a){c=a.getBoundingClientRect();d=c.left+(b===g?i.scrollLeft(e):0);c=c.top+(b===g?i.scrollTop(e):0)}if(b)if(e!=(b.defaultView||b.parentWindow)&&e.frameElement){b=s._4e_getOffset(e.frameElement,b);d+=b.left;c+=b.top}}return{left:d,top:c}},_4e_getFrameDocument:function(a){return(a=f(a))&&a.contentWindow.document},_4e_splitText:function(a,b){a=f(a);var c=a.ownerDocument;if(!(!a||a.nodeType!=
l.NODE_TEXT)){if(k.ie&&b==a.nodeValue.length){c=c.createTextNode("");i.insertAfter(c,a);return c}a=new n(a.splitText(b));if(k.ie==8){c=c.createTextNode("");i.insertAfter(c,a[0]);c.parentNode.removeChild(c)}return a}},_4e_parents:function(a,b){a=r(a);var c=[];do c[b?"push":"unshift"](a);while(a=a.parent());return c},_4e_clone:function(a,b,c){a=f(a);a=a.cloneNode(b);if(!c){var d=function(e){if(e.nodeType==l.NODE_ELEMENT){e.removeAttribute("id",false);e.removeAttribute("_ke_expando",false);e=e.childNodes;
for(var g=0;g<e.length;g++)d(e[g])}};d(a)}return new n(a)},_4e_nextSourceNode:function(a,b,c,d){a=f(a);if(d&&!d.call){var e=d[0]||d;d=function(h){h=h[0]||h;return h!==e}}b=!b&&a.firstChild;var g=new n(a);if(!b){if(a.nodeType==l.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.nextSibling}for(;!b&&(g=g.parent());){if(d&&d(g,true)===false)return null;b=g[0].nextSibling}if(!b)return null;b=i._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&c!=b[0].nodeType)return b._4e_nextSourceNode(false,c,d);return b},
_4e_previousSourceNode:function(a,b,c,d){a=f(a);if(d&&!d.call){var e=d[0]||d;d=function(h){h=h[0]||h;return h!==e}}b=!b&&a.lastChild;var g=new n(a);if(!b){if(a.nodeType==l.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.previousSibling}for(;!b&&(g=g.parent());){if(d&&d(g,true)===false)return null;b=g[0].previousSibling}if(!b)return null;b=i._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&b[0].nodeType!=c)return b._4e_previousSourceNode(false,c,d);return b},_4e_contains:k.ie||k.webkit?function(a,
b){a=f(a);b=f(b);return b.nodeType!=l.NODE_ELEMENT?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=f(a);b=f(b);return!!(a.compareDocumentPosition(b)&16)},_4e_commonAncestor:function(a,b){if(a._4e_equals(b))return a;if(b[0].nodeType!=l.NODE_TEXT&&b._4e_contains(a))return b;a=a[0].nodeType==l.NODE_TEXT?a.parent():a;do if(a[0].nodeType!=l.NODE_TEXT&&a._4e_contains(b))return a;while(a=a.parent());return null},_4e_ascendant:function(a,b,c){a=f(a);if(!c)a=a.parentNode;if(b&&!o.isFunction(b)){var d=
b;b=function(e){return e._4e_name()==d}}for(;a&&a.nodeType!=9;){if(!b||b(new n(a))===true)return new n(a);a=a.parentNode}return null},_4e_hasAttribute:function(a,b){a=f(a);a=a.attributes.getNamedItem(b);return!!(a&&a.specified)},_4e_hasAttributes:k.ie?function(a){a=f(a);for(var b=a.attributes,c=0;c<b.length;c++){var d=b[c];switch(d.nodeName){case "class":if(a.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(d.specified)return true}}return false}:function(a){a=f(a);k.gecko&&
a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},_4e_position:function(a,b){var c=f(a),d=f(b);if(c.compareDocumentPosition)return c.compareDocumentPosition(d);if(c==d)return m.POSITION_IDENTICAL;if(c.nodeType==l.NODE_ELEMENT&&d.nodeType==l.NODE_ELEMENT){if(c.contains){if(c.contains(d))return m.POSITION_CONTAINS+m.POSITION_PRECEDING;if(d.contains(c))return m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING}if("sourceIndex"in c)return c.sourceIndex<
0||d.sourceIndex<0?m.POSITION_DISCONNECTED:c.sourceIndex<d.sourceIndex?m.POSITION_PRECEDING:m.POSITION_FOLLOWING}a=a._4e_address();b=b._4e_address();c=Math.min(a.length,b.length);for(d=0;d<=c-1;d++)if(a[d]!=b[d]){if(d<c)return a[d]<b[d]?m.POSITION_PRECEDING:m.POSITION_FOLLOWING;break}return a.length<b.length?m.POSITION_CONTAINS+m.POSITION_PRECEDING:m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING},_4e_address:function(a,b){a=f(a);var c=[],d=a.ownerDocument.documentElement;for(a=a;a&&a!=d;){var e=a.parentNode,
g=-1;if(e){for(var h=0;h<e.childNodes.length;h++){var j=e.childNodes[h];if(!(b&&j.nodeType==3&&j.previousSibling&&j.previousSibling.nodeType==3)){g++;if(j==a)break}}c.unshift(g)}a=e}return c},_4e_breakParent:function(a,b){var c=new p.Range(a[0].ownerDocument);c.setStartAfter(a);c.setEndAfter(b);b=c.extractContents();c.insertNode(a._4e_remove());a[0].parentNode.insertBefore(b,a[0].nextSibling)},_4e_style:function(a,b,c){if(c!==undefined)return a.css(b,c);a=a[0]||a;return a.style[u(b)]},_4e_remove:function(a,
b){var c=f(a),d=c.parentNode;if(d){if(b)for(;b=c.firstChild;)d.insertBefore(c.removeChild(b),c);d.removeChild(c)}return a},_4e_trim:function(a){i._4e_ltrim(a);i._4e_rtrim(a)},_4e_ltrim:function(a){a=f(a);for(var b;b=a.firstChild;){if(b.nodeType==l.NODE_TEXT){var c=t.ltrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new n(b))._4e_splitText(d-c.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){a=f(a);for(var b;b=a.lastChild;){if(b.type==l.NODE_TEXT){var c=
t.rtrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new n(b))._4e_splitText(c.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!k.ie&&!k.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},_4e_appendBogus:function(a){a=f(a);for(var b=a.lastChild;b&&b.nodeType==l.NODE_TEXT&&!o.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==l.NODE_TEXT||i._4e_name(b)!=="br"){b=k.opera?a.ownerDocument.createTextNode(""):
a.ownerDocument.createElement("br");k.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},_4e_previous:function(a,b){a=f(a);var c;do c=(a=a.previousSibling)&&new n(a);while(c&&b&&!b(c));return c},_4e_last:function(a,b){a=i._4e_wrap(a);if((a=(a=a[0].lastChild)&&new n(a))&&b&&!b(a))a=a._4e_previous(b);return a},_4e_next:function(a,b){a=f(a);var c;do c=(a=a.nextSibling)&&new n(a);while(c&&b&&!b(c));return c},_4e_outerHtml:function(a){a=f(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");
var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML},_4e_setMarker:function(a,b,c,d){a=i._4e_wrap(a);var e=a._4e_getData("list_marker_id")||a._4e_setData("list_marker_id",o.guid())._4e_getData("list_marker_id"),g=a._4e_getData("list_marker_names")||a._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");b[e]=a;g[c]=1;return a._4e_setData(c,d)},_4e_clearMarkers:function(a,b,c){a=r(a);var d=a._4e_getData("list_marker_names"),e=a._4e_getData("list_marker_id");
for(var g in d)a._4e_removeData(g);a._4e_removeData("list_marker_names");if(c){a._4e_removeData("list_marker_id");delete b[e]}},_4e_setData:function(a,b,c){var d=i._4e_getUniqueId(a);(q[d]||(q[d]={}))[b]=c;return a},_4e_getData:function(a,b){a=f(a);return(a=(a=a.getAttribute("_ke_expando"))&&q[a])&&a[b]},_4e_removeData:function(a,b){a=f(a);var c=a.getAttribute("_ke_expando");var d=(c=c&&q[c])&&c[b];typeof d!="undefined"&&c&&delete c[b];o.isEmptyObject(c)&&i._4e_clearData(a);return d||null},_4e_clearData:function(a){a=
f(a);var b=a.getAttribute("_ke_expando");b&&delete q[b];b&&a.removeAttribute("_ke_expando")},_4e_getUniqueId:function(a){a=f(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=o.guid();a.setAttribute("_ke_expando",b);return b},_4e_copyAttributes:function(a,b,c){a=f(a);var d=a.attributes;c=c||{};for(var e=0;e<d.length;e++){var g=d[e],h=g.nodeName.toLowerCase(),j;if(!(h in c))if(h=="checked"&&(j=i.attr(a,h)))b.attr(h,j);else if(g.specified||k.ie&&g.nodeValue&&h=="value"){j=i.attr(a,h);if(j===null)j=
g.nodeValue;b.attr(h,j)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=i._4e_name(a);var b=p.XHTML_DTD;return(a=!b.$nonEditable[a]&&(b[a]||b.span))&&a["#"]},_4e_scrollIntoView:function(a){a=r(a);var b=a[0].ownerDocument,c=i.scrollLeft(b),d=i.scrollTop(b),e=a.offset(),g=e.left;e=e.top;if(i.viewportHeight(b)+d<e||e<d||i.viewportWidth(b)+c<g||g<c)a.scrollIntoView(b)},_4e_getElementsByTagName:function(a,b,c){a=f(a);if(!k.ie&&c)b=c+":"+b;c=[];a=a.getElementsByTagName(b);
for(b=0;b<a.length;b++)c.push(new n(a[b]));return c}};o.DOM._4e_inject=function(a){o.mix(i,a);for(var b in a)a.hasOwnProperty(b)&&function(c){n.prototype[c]=function(){var d=[].slice.call(arguments,0);d.unshift(this);return a[c].apply(null,d)}}(b)};o.DOM._4e_inject(s)});
