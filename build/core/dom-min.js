KISSY.Editor.add("dom",function(q){function v(a){return a.replace(/-(\w)/g,function(b,c){return c.toUpperCase()})}var p=KISSY,j=p.DOM,n=p.UA,k=p.Node,u=q.Utils,w={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};q.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};q.NODE=q.NODE;q.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};q.POSITION=q.POSITION;var l=q.NODE,o=q.POSITION,s={},x={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},h=function(a){return a[0]||a},r=function(a){if(a&&!a[0])return new k(a);return a},f={_4e_wrap:r,_4e_unwrap:h,_4e_equals:function(a,b){if(!a&&!b)return true;if(!a||!b)return false;a=h(a);
b=h(b);return a===b},_4e_isBlockBoundary:function(a,b){a=r(a);var c=p.mix(p.mix({},y),b||{});return x[a.css("display")]||c[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=h(a);for(var b=a.parentNode.childNodes,c=0;c<b.length;c++)if(b[c]===a)return c;return-1},_4e_first:function(a,b){a=h(a);var c=a.firstChild;if((c=c&&new k(c))&&b&&!b(c))c=c._4e_next(b);return c},_4e_move:function(a,b,c){a=h(a);
j._4e_remove(a);b=h(b);c?b.insertBefore(a,b.firstChild):b.appendChild(a)},_4e_name:function(a){a=h(a);var b=a.nodeName.toLowerCase();if(n.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},_4e_isIdentical:function(a,b){if(a._4e_name()!=b._4e_name())return false;var c=a[0].attributes,d=b[0].attributes,e=c.length,g=d.length;if(!n.ie&&e!=g)return false;for(var i=0;i<e;i++){var m=c[i];if((!n.ie||m.specified&&m.nodeName!="_ke_expando")&&m.nodeValue!=b.attr(m.nodeName))return false}if(n.ie)for(i=
0;i<g;i++){m=d[i];if(m.specified&&m.nodeName!="_ke_expando"&&m.nodeValue!=a.attr(m.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=h(a).childNodes;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.nodeType;if(!(e==l.NODE_ELEMENT&&d.getAttribute("_ke_bookmark")))if(e==l.NODE_ELEMENT&&!f._4e_isEmptyInlineRemoveable(d)||e==l.NODE_TEXT&&p.trim(d.nodeValue))return false}return true},_4e_moveChildren:function(a,b,c){a=h(a);b=b[0]||b;if(a!=b)if(c)for(;c=a.lastChild;)b.insertBefore(a.removeChild(c),
b.firstChild);else for(;c=a.firstChild;)b.appendChild(a.removeChild(c))},_4e_mergeSiblings:function(){function a(b,c,d){if(c[0]&&c[0].nodeType==l.NODE_ELEMENT){for(var e=[];c.attr("_ke_bookmark")||c._4e_isEmptyInlineRemoveable();){e.push(c);c=d?new k(c[0].nextSibling):new k(c[0].previousSibling);if(!c[0]||c[0].nodeType!=l.NODE_ELEMENT)return}if(b._4e_isIdentical(c)){for(var g=d?b[0].lastChild:b[0].firstChild;e.length;)e.shift()._4e_move(b,!d);c._4e_moveChildren(b,!d);c._4e_remove();g[0]&&g[0].nodeType==
l.NODE_ELEMENT&&g._4e_mergeSiblings()}}}return function(b){if(b[0])if(w[b._4e_name()]||b._4e_name()=="a"){a(b,new k(b[0].nextSibling),true);a(b,new k(b[0].previousSibling))}}}(),_4e_unselectable:n.gecko?function(a){a=h(a);a.style.MozUserSelect="none"}:n.webkit?function(a){a=h(a);a.style.KhtmlUserSelect="none"}:function(a){a=h(a);if(n.ie||n.opera){var b,c=0;for(a.unselectable="on";b=a.all[c++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable=
"on"}}},_4e_getOffset:function(a,b){a=h(a);var c,d=0;c=0;var e=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,g=a.ownerDocument,i=g.documentElement;b=b||g;if(a.getBoundingClientRect){if(a!==g.body&&i!==a){c=a.getBoundingClientRect();d=c.left+(b===g?j.scrollLeft(e):0);c=c.top+(b===g?j.scrollTop(e):0)}if(b)if(e!=(b.defaultView||b.parentWindow)&&e.frameElement){e=f._4e_getOffset(e.frameElement,b);d+=e.left;c+=e.top}}return{left:d,top:c}},_4e_getFrameDocument:function(a){return(a=h(a))&&a.contentWindow.document},
_4e_splitText:function(a,b){a=h(a);var c=a.ownerDocument;if(!(!a||a.nodeType!=l.NODE_TEXT)){if(n.ie&&b==a.nodeValue.length){var d=c.createTextNode("");j.insertAfter(d,a);return new k(d)}d=new k(a.splitText(b));if(c.documentMode){c=c.createTextNode("");j.insertAfter(c,d[0]);j._4e_remove(c)}return d}},_4e_parents:function(a,b){a=r(a);var c=[];do c[b?"push":"unshift"](a);while(a=a.parent());return c},_4e_clone:function(a,b,c){a=h(a);a=a.cloneNode(b);if(!c){var d=function(e){if(e.nodeType==l.NODE_ELEMENT){e.removeAttribute("id",
false);e.removeAttribute("_ke_expando",false);e=e.childNodes;for(var g=0;g<e.length;g++)d(e[g])}};d(a)}return new k(a)},_4e_nextSourceNode:function(a,b,c,d){a=h(a);if(d&&!d.call){var e=d[0]||d;d=function(i){i=i[0]||i;return i!==e}}b=!b&&a.firstChild;var g=new k(a);if(!b){if(a.nodeType==l.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.nextSibling}for(;!b&&(g=g.parent());){if(d&&d(g,true)===false)return null;b=g[0].nextSibling}if(!b)return null;b=j._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&
c!=b[0].nodeType)return b._4e_nextSourceNode(false,c,d);return b},_4e_previousSourceNode:function(a,b,c,d){a=h(a);if(d&&!d.call){var e=d[0]||d;d=function(i){i=i[0]||i;return i!==e}}b=!b&&a.lastChild;var g=new k(a);if(!b){if(a.nodeType==l.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.previousSibling}for(;!b&&(g=g.parent());){if(d&&d(g,true)===false)return null;b=g[0].previousSibling}if(!b)return null;b=j._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&b[0].nodeType!=c)return b._4e_previousSourceNode(false,
c,d);return b},_4e_contains:n.ie||n.webkit?function(a,b){a=h(a);b=h(b);return b.nodeType!=l.NODE_ELEMENT?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=h(a);b=h(b);return!!(a.compareDocumentPosition(b)&16)},_4e_commonAncestor:function(a,b){if(a._4e_equals(b))return a;if(b[0].nodeType!=l.NODE_TEXT&&b._4e_contains(a))return b;var c=a[0].nodeType==l.NODE_TEXT?a.parent():a;do if(c[0].nodeType!=l.NODE_TEXT&&c._4e_contains(b))return c;while(c=c.parent());return null},_4e_ascendant:function(a,
b,c){a=h(a);if(!c)a=a.parentNode;if(b&&!p.isFunction(b)){var d=b;b=function(e){return e._4e_name()==d}}for(;a&&a.nodeType!=9;){if(!b||b(new k(a))===true)return new k(a);a=a.parentNode}return null},_4e_hasAttribute:function(a,b){a=h(a);var c=a.attributes.getNamedItem(b);return!!(c&&c.specified)},_4e_hasAttributes:n.ie?function(a){a=h(a);for(var b=a.attributes,c=0;c<b.length;c++){var d=b[c];switch(d.nodeName){case "class":if(a.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(d.specified)return true}}return false}:
function(a){a=h(a);n.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},_4e_position:function(a,b){var c=h(a),d=h(b);if(c.compareDocumentPosition)return c.compareDocumentPosition(d);if(c==d)return o.POSITION_IDENTICAL;if(c.nodeType==l.NODE_ELEMENT&&d.nodeType==l.NODE_ELEMENT){if(c.contains){if(c.contains(d))return o.POSITION_CONTAINS+o.POSITION_PRECEDING;if(d.contains(c))return o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING}if("sourceIndex"in
c)return c.sourceIndex<0||d.sourceIndex<0?o.POSITION_DISCONNECTED:c.sourceIndex<d.sourceIndex?o.POSITION_PRECEDING:o.POSITION_FOLLOWING}c=a._4e_address();d=b._4e_address();for(var e=Math.min(c.length,d.length),g=0;g<=e-1;g++)if(c[g]!=d[g]){if(g<e)return c[g]<d[g]?o.POSITION_PRECEDING:o.POSITION_FOLLOWING;break}return c.length<d.length?o.POSITION_CONTAINS+o.POSITION_PRECEDING:o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING},_4e_address:function(a,b){a=h(a);for(var c=[],d=a.ownerDocument.documentElement,
e=a;e&&e!=d;){var g=e.parentNode,i=-1;if(g){for(var m=0;m<g.childNodes.length;m++){var t=g.childNodes[m];if(!(b&&t.nodeType==3&&t.previousSibling&&t.previousSibling.nodeType==3)){i++;if(t==e)break}}c.unshift(i)}e=g}return c},_4e_breakParent:function(a,b){var c=new q.Range(a[0].ownerDocument);c.setStartAfter(a);c.setEndAfter(b);var d=c.extractContents();c.insertNode(a._4e_remove());a[0].parentNode.insertBefore(d,a[0].nextSibling)},_4e_style:function(a,b,c){a=r(a);if(c!==undefined)return a.css(b,c);
a=h(a);return a.style[v(b)]},_4e_remove:function(a,b){var c=h(a),d=c.parentNode;if(d){if(b)for(var e;e=c.firstChild;)d.insertBefore(c.removeChild(e),c);d.removeChild(c)}return a},_4e_trim:function(a){j._4e_ltrim(a);j._4e_rtrim(a)},_4e_ltrim:function(a){a=h(a);for(var b;b=a.firstChild;){if(b.nodeType==l.NODE_TEXT){var c=u.ltrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new k(b))._4e_splitText(d-c.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){a=
h(a);for(var b;b=a.lastChild;){if(b.type==l.NODE_TEXT){var c=u.rtrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new k(b))._4e_splitText(c.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!n.ie&&!n.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},_4e_appendBogus:function(a){a=h(a);for(var b=a.lastChild;b&&b.nodeType==l.NODE_TEXT&&!p.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==l.NODE_TEXT||j._4e_name(b)!==
"br"){b=n.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");n.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},_4e_previous:function(a,b){var c=h(a),d;do d=(c=c.previousSibling)&&new k(c);while(d&&b&&!b(d));return d},_4e_last:function(a,b){a=j._4e_wrap(a);var c=a[0].lastChild;if((c=c&&new k(c))&&b&&!b(c))c=c._4e_previous(b);return c},_4e_next:function(a,b){var c=h(a),d;do d=(c=c.nextSibling)&&new k(c);while(d&&b&&!b(d));return d},_4e_outerHtml:function(a){a=h(a);
if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML},_4e_setMarker:function(a,b,c,d){a=j._4e_wrap(a);var e=a._4e_getData("list_marker_id")||a._4e_setData("list_marker_id",p.guid())._4e_getData("list_marker_id"),g=a._4e_getData("list_marker_names")||a._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");b[e]=a;g[c]=1;return a._4e_setData(c,d)},_4e_clearMarkers:function(a,b,c){a=r(a);
var d=a._4e_getData("list_marker_names"),e=a._4e_getData("list_marker_id"),g;for(g in d)a._4e_removeData(g);a._4e_removeData("list_marker_names");if(c){a._4e_removeData("list_marker_id");delete b[e]}},_4e_setData:function(a,b,c){var d=j._4e_getUniqueId(a);(s[d]||(s[d]={}))[b]=c;return a},_4e_getData:function(a,b){a=h(a);var c=a.getAttribute("_ke_expando");return(c=c&&s[c])&&c[b]},_4e_removeData:function(a,b){a=h(a);var c=a.getAttribute("_ke_expando");var d=(c=c&&s[c])&&c[b];typeof d!="undefined"&&
c&&delete c[b];p.isEmptyObject(c)&&j._4e_clearData(a);return d||null},_4e_clearData:function(a){a=h(a);var b=a.getAttribute("_ke_expando");b&&delete s[b];b&&a.removeAttribute("_ke_expando")},_4e_getUniqueId:function(a){a=h(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=p.guid();a.setAttribute("_ke_expando",b);return b},_4e_copyAttributes:function(a,b,c){a=h(a);b=r(b);var d=a.attributes;c=c||{};for(var e=0;e<d.length;e++){var g=d[e],i=g.nodeName.toLowerCase(),m;if(!(i in c))if(i=="checked"&&
(m=j.attr(a,i)))b.attr(i,m);else if(g.specified||n.ie&&g.nodeValue&&i=="value"){m=j.attr(a,i);if(m===null)m=g.nodeValue;b.attr(i,m)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=j._4e_name(a);var b=q.XHTML_DTD;return(a=!b.$nonEditable[a]&&(b[a]||b.span))&&a["#"]},_4e_scrollIntoView:function(a){a=r(a);var b=a[0].ownerDocument,c=j.scrollLeft(b),d=j.scrollTop(b),e=a.offset(),g=e.left;e=e.top;if(j.viewportHeight(b)+d<e||e<d||j.viewportWidth(b)+c<g||g<c)a.scrollIntoView(b)},
_4e_getElementsByTagName:function(a,b,c){a=h(a);if(!n.ie&&c)b=c+":"+b;c=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)c.push(new k(a[b]));return c}};p.DOM._4e_inject=function(a){p.mix(j,a);for(var b in a)a.hasOwnProperty(b)&&function(c){k.prototype[c]=function(){var d=[].slice.call(arguments,0);d.unshift(this);return a[c].apply(null,d)}}(b)};u.extern(f,{_4e_wrap:f._4e_wrap,_4e_unwrap:f._4e_unwrap,_4e_equals:f._4e_equals,_4e_isBlockBoundary:f._4e_isBlockBoundary,_4e_getWin:f._4e_getWin,_4e_index:f._4e_index,
_4e_first:f._4e_first,_4e_move:f._4e_move,_4e_name:f._4e_name,_4e_isIdentical:f._4e_isIdentical,_4e_isEmptyInlineRemoveable:f._4e_isEmptyInlineRemoveable,_4e_moveChildren:f._4e_moveChildren,_4e_mergeSiblings:f._4e_mergeSiblings,_4e_unselectable:f._4e_unselectable,_4e_getOffset:f._4e_getOffset,_4e_getFrameDocument:f._4e_getFrameDocument,_4e_splitText:f._4e_splitText,_4e_parents:f._4e_parents,_4e_clone:f._4e_clone,_4e_nextSourceNode:f._4e_nextSourceNode,_4e_previousSourceNode:f._4e_previousSourceNode,
_4e_contains:f._4e_contains,_4e_commonAncestor:f._4e_commonAncestor,_4e_ascendant:f._4e_ascendant,_4e_hasAttribute:f._4e_hasAttribute,_4e_hasAttributes:f._4e_hasAttributes,_4e_position:f._4e_position,_4e_address:f._4e_address,_4e_breakParent:f._4e_breakParent,_4e_style:f._4e_style,_4e_remove:f._4e_remove,_4e_trim:f._4e_trim,_4e_ltrim:f._4e_ltrim,_4e_rtrim:f._4e_rtrim,_4e_appendBogus:f._4e_appendBogus,_4e_last:f._4e_last,_4e_previous:f._4e_previous,_4e_next:f._4e_next,_4e_outerHtml:f._4e_outerHtml,
_4e_setMarker:f._4e_setMarker,_4e_clearMarkers:f._4e_clearMarkers,_4e_setData:f._4e_setData,_4e_getData:f._4e_getData,_4e_removeData:f._4e_removeData,_4e_clearData:f._4e_clearData,_4e_removeData:f._4e_removeData,_4e_getUniqueId:f._4e_getUniqueId,_4e_copyAttributes:f._4e_copyAttributes,_4e_isEditable:f._4e_isEditable,_4e_scrollIntoView:f._4e_scrollIntoView,_4e_getElementsByTagName:f._4e_getElementsByTagName});j._4e_inject(f)});
