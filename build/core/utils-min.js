KISSY.Editor.add("utils",function(o){var g=KISSY,r=g.Node,j=g.DOM,k=g.UA,q=g.Event;o.Utils={debugUrl:function(a){var b=g.Config.debug;if(!b)return a.replace(/\.(js|css)/i,"-min.$1");if(b==="dev")return"../src/"+a;return a},lazyRun:function(a,b,c){var d=a[b],f=a[c];a[b]=function(){d.apply(this,arguments);a[b]=a[c];return f.apply(this,arguments)}},getXY:function(a,b,c,d){c=c.defaultView||c.parentWindow;a-=j.scrollLeft(c);b-=j.scrollTop(c);if(d)if(c!=(d.defaultView||d.parentWindow)&&c.frameElement){d=
j._4e_getOffset(c.frameElement,d);a+=d.left;b+=d.top}return{left:a,top:b}},tryThese:function(){for(var a,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(f){}}return a},arrayCompare:function(a,b){if(!a&&!b)return true;if(!a||!b||a.length!=b.length)return false;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return false;return true},getByAddress:function(a,b,c){a=a.documentElement;for(var d=0;a&&d<b.length;d++){var f=b[d];if(c)for(var h=-1,e=0;e<a.childNodes.length;e++){var i=a.childNodes[e];
if(!(c===true&&i.nodeType==3&&i.previousSibling&&i.previousSibling.nodeType==3)){h++;if(h==f){a=i;break}}}else a=a.childNodes[f]}return a?new r(a):null},clearAllMarkers:function(a){for(var b in a)a[b]._4e_clearMarkers(a,true)},htmlEncodeAttr:function(a){return a.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,"")},trim:function(a){return this.ltrim(this.rtrim(a))},mix:function(){for(var a={},
b=0;b<arguments.length;b++)a=g.mix(a,arguments[b]);return a},isCustomDomain:function(){if(!k.ie)return false;var a=document.domain,b=window.location.hostname;return a!=b&&a!="["+b+"]"},duplicateStr:function(a,b){return Array(b+1).join(a)},throttle:function(a,b,c){c=c||150;if(c===-1)return function(){a.apply(b,arguments)};var d=(new Date).getTime();return function(){var f=(new Date).getTime();if(f-d>c){d=f;a.apply(b,arguments)}}},buffer:function(a,b,c){c=c||0;var d=null;return function(){d&&clearTimeout(d);
var f=arguments;d=setTimeout(function(){return a.apply(b,f)},c)}},isNumber:function(a){return/^\d+(.\d+)?$/.test(g.trim(a))},verifyInputs:function(a){for(var b=0;b<a.length;b++){var c=j._4e_wrap(a[b]),d=g.trim(c.val()),f=c.attr("data-verify");c=c.attr("data-warning");if(f&&!RegExp(f).test(d)){alert(c);return}}return true},sourceDisable:function(a,b){a.on("sourcemode",b.disable,b);a.on("wysiwygmode",b.enable,b)},resetInput:function(a){var b=a.attr("placeholder");if(b&&!k.webkit){a.val(b);a.addClass("ke-input-tip")}else k.webkit&&
a.val("")},placeholder:function(a,b){a.attr("placeholder",b);if(!k.webkit){a.on("blur",function(){if(!g.trim(a.val())){a.val(b);a.addClass("ke-input-tip")}});a.on("focus",function(){g.trim(a.val())==b&&a.val("");a.removeClass("ke-input-tip")})}},clean:function(a){a=a[0]||a;for(var b=g.makeArray(a.childNodes),c=0;c<b.length;c++){var d=b[c];d.nodeType==o.NODE.NODE_TEXT&&!g.trim(d.nodeValue)&&a.removeChild(d)}},htmlEncode:function(a){return!a?a:String(a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,
"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(a){return!a?a:String(a).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(a,b){return a.toLowerCase()==b.toLowerCase()},normParams:function(a){a=g.clone(a);for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if(g.isFunction(c))a[b]=c()}return a},doFormUpload:function(a,b,c){function d(){var n={responseText:"",responseXML:null};n.argument=a?a.argument:null;try{var l;if((l=k.ie?h.contentWindow.document:
h.contentDocument||window.frames[f].document)&&l.body)n.responseText=l.body.innerHTML;n.responseXML=l&&l.XMLDocument?l.XMLDocument:l}catch(s){}q.remove(h,"load",d);a.callback&&a.callback(n);setTimeout(function(){j._4e_remove(h)},100)}var f=g.guid("form-upload-"),h=document.createElement("iframe");h.id=f;h.name=f;h.className="ke-hidden";if(k.ie)h.src="javascript:false";document.body.appendChild(h);if(k.ie)document.frames[f].name=f;var e=j._4e_unwrap(a.form),i={target:e.target,method:e.method,encoding:e.encoding,
enctype:e.enctype,action:e.action};e.target=f;e.method="POST";e.enctype=e.encoding="multipart/form-data";if(c)e.action=c;var m;if(b){m=[];b=o.Utils.normParams(b);for(var p in b)if(b.hasOwnProperty(p)){c=document.createElement("input");c.type="hidden";c.name=p;c.value=b[p];e.appendChild(c);m.push(c)}}q.on(h,"load",d);e.submit();e.target=i.target;e.method=i.method;e.enctype=i.enctype;e.encoding=i.encoding;e.action=i.action;if(m){b=0;for(e=m.length;b<e;b++)j._4e_remove(m[b])}}}});
