KISSY.Editor.add("select",function(){function j(a){j.superclass.constructor.call(this,a);this._init()}var f=KISSY,i=f.Node,l=f.Event,m=f.DOM,k=f.Editor;j.ATTRS={container:{},doc:{},value:{},width:{},title:{},items:{}};f.extend(j,f.Base,{_init:function(){var a=this.get("container"),b=new i("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'></span><span class='ke-select-drop'></span></a></span>"),c=this.get("title"),d=b.one(".ke-select-text");b.one(".ke-select-drop");
d.html(c);d.css("width",this.get("width"));b._4e_unselectable();b.attr("title",c);b.appendTo(a);b.on("click",this._click,this);this.el=b;this.title=d;this._focusA=b.one("a.ke-select");k.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",this._valueChange,this)},_valueChange:function(a){a=a.newVal;for(var b=this.get("title"),c=this.get("items"),d=0;d<c.length;d++){var e=c[d];if(e.value==a){b=e.name;break}}this.title.html(b)},_prepare:function(){var a=this.el,b=this._focusA,c=new i("<div class='ke-menu' onmousedown='return false;'></div>"),
d=new k.SimpleOverlay({el:c,focusMgr:false}),e=this.get("items");this.get("title")&&(new i("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+this.get("title")+"</div>")).appendTo(c);for(var g=0;g<e.length;g++){var h=e[g];h=new i("<a class='ke-select-menu-item' href='#' data-value='"+h.value+"'>"+h.name+"</a>",h.attrs);h._4e_unselectable();h.appendTo(c)}this.get("popUpWidth")&&c.css("width",this.get("popUpWidth"));c.appendTo(document.body);this.menu=d;d.on("show",function(){b.addClass("ke-select-active")});
d.on("hide",function(){b.removeClass("ke-select-active")});l.on([document,this.get("doc")],"click",function(n){a._4e_contains(n.target)||d.hide()});c.on("click",this._select,this);var o=this.as=c.all("a");l.on(c[0],"mouseenter",function(){o.removeClass("ke-menu-selected")})},_select:function(a){a.halt();var b=this.menu,c=b.el;if(a=(new i(a.target))._4e_ascendant(function(g){return c._4e_contains(g)&&g._4e_name()=="a"},true)){var d=this.get("value"),e=a.attr("data-value");this.set("value",e);this.fire("click",
{newVal:e,preVal:d,name:a.html()});b.hide()}},_real:function(){var a=this.el.offset();a.top+=this.el.height();a.left+=1;if(a.left+this.menu.el.width()>m.viewportWidth()-60)a.left=m.viewportWidth()-this.menu.el.width()-60;this.menu.show(a)},_click:function(a){a.preventDefault();var b=this.get("value");if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();b&&this.menu&&this.as.each(function(c){c.attr("data-value")==b?c.addClass("ke-menu-selected"):c.removeClass("ke-menu-selected")})}}});
k.Select=j});
