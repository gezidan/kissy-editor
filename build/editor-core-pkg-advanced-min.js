/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-15 15:11:30
*/
var T=true,U=null,Y=false;
KISSY.add("editor",function(p,C){function v(y,i){function a(A){for(var m=v.Env.mods,D=0;D<A.length;D++){for(var j=A[D],s=u,I=0;I<D;I++)if(j==A[I]){s=z;break}I=m[j];if(s&&I){s=p.clone(I);j=j+"_"+D;s.name=j;A[D]=j;m[j]||(m[j]=s)}}}var b=this;if(!(b instanceof v))return new v(y,i);if(p.isString(y))y=p.one(y);y=B.D(y);i=i||{};i.Ke=i.pluginConfig||{};b.ha=i;i.pluginConfig=i.Ke;b.cfg=i;p.app(b,p.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],k=u;b.use=function(A,m){A=A.split(",");a(A);
if(!k)for(var D=0;D<d.length;D++){var j=d[D];p.inArray(j,A)||A.unshift(j)}b.ready(function(){p.use.call(b,A.join(","),function(){m&&m.call(b);if(!k){b.setData(y.val());if(i.focus)b.focus();else{var s=b.getSelection();s&&s.removeAllRanges()}b.fire("save");k=z}},{order:z,global:v})});return b};b.use=b.use;b.Be(y);return b}function J(y){var i=p.Config.debug;y=i?i==="dev"?"../src/"+y:y:y.replace(/\.(js|css)/i,"-min.$1");y+=y.indexOf("?")!=-1?"&":"?";y+="t="+encodeURIComponent("2010-12-15 15:11:30");return y}
var B=p.DOM,z=T,u=Y;p.app(v,p.EventTarget);v.Config.base=p.Config.base+"editor/";var r=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],q,f,h,e,o={};q=0;for(f=r.length;q<f;q++){h=r[q];if(p.isString(h))h=r[q]={name:h+"",requires:U};e=h.requires||[];h.requires=e.concat(["button"])}r=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar","overlay",{name:"contextmenu",wd:["overlay"]},{name:"bubbleview",
wd:["overlay"]},{name:"select",wd:["overlay"]}].concat(r);q=0;for(f=r.length;q<f;q++){h=r[q];e=h.name||h;o[e]={attach:u,charset:"utf-8",requires:h.requires,csspath:h.useCss?J("plugins/"+e+"/plugin.css"):C,path:J("plugins/"+e+"/plugin.js")}}v.add(o);p.Editor=v;p.Editor=v});
KISSY.Editor.add("utils",function(p){var C=U,v=KISSY,J=v.Node,B=v.DOM,z=v.UA,u=v.Event,r;if(z.ie)r=document.documentMode||z.ie;var q={Tc:function(f){var h=v.Config.debug;f=h?h==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-12-15 15:11:30");return f},Ge:function(f,h,e){var o=f[h],y=f[e];f[h]=function(){o.apply(this,arguments);f[h]=f[e];return y.apply(this,arguments)}},xe:function(f,h,e,o){e=e.defaultView||e.parentWindow;f-=B.scrollLeft(e);
h-=B.scrollTop(e);if(o)if(e!=(o.defaultView||o.parentWindow)&&e.frameElement){o=B.Hb(e.frameElement,o);f+=o.left;h+=o.top}return{left:f,top:h}},Dd:function(){for(var f,h=0,e=arguments.length;h<e;h++){var o=arguments[h];try{f=o();break}catch(y){}}return f},ce:function(f,h){if(!f&&!h)return T;if(!f||!h||f.length!=h.length)return Y;for(var e=0;e<f.length;e++)if(f[e]!==h[e])return Y;return T},Xc:function(f,h,e){f=f.documentElement;for(var o=0;f&&o<h.length;o++){var y=h[o];if(e)for(var i=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(e===T&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){i++;if(i==y){f=b;break}}}else f=f.childNodes[y]}return f?new J(f):C},ke:function(f){for(var h in f)f[h].Bc(f,T)},dc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},La:function(f){return f.replace(/^\s+/,"")},Na:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.La(this.Na(f))},mix:function(){for(var f={},h=0;h<arguments.length;h++)f=v.mix(f,arguments[h]);
return f},jb:function(){if(!z.ie)return Y;var f=document.domain,h=window.location.hostname;return f!=h&&f!="["+h+"]"},pe:function(f,h){return Array(h+1).join(f)},Te:function(f,h,e){e=e||150;if(e===-1)return function(){f.apply(h,arguments)};var o=(new Date).getTime();return function(){var y=(new Date).getTime();if(y-o>e){o=y;f.apply(h,arguments)}}},fe:function(f,h,e){e=e||0;var o=C;return function(){o&&clearTimeout(o);var y=arguments;o=setTimeout(function(){return f.apply(h,y)},e)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(v.trim(f))},
Ve:function(f){for(var h=0;h<f.length;h++){var e=B.D(f[h]),o=v.trim(e.val()),y=e.attr("data-verify");e=e.attr("data-warning");if(y&&!RegExp(y).test(o)){alert(e);return Y}}return T},Re:function(f,h){f.on("sourcemode",h.xf,h);f.on("wysiwygmode",h.Bf,h)},Ne:function(f){var h=f.attr("placeholder");if(h&&!z.webkit){f.addClass("ke-input-tip");f.val(h)}else z.webkit&&f.val("")},Mf:function(f,h){f.removeClass("ke-input-tip");f.val(h)},Je:function(f,h){f.attr("placeholder",h);if(!z.webkit){f.on("blur",function(){if(!v.trim(f.val())){f.addClass("ke-input-tip");
f.val(h)}});f.on("focus",function(){f.removeClass("ke-input-tip");v.trim(f.val())==h&&f.val("")})}},je:function(f){f=f[0]||f;for(var h=v.makeArray(f.childNodes),e=0;e<h.length;e++){var o=h[e];o.nodeType==p.n.f&&!v.trim(o.nodeValue)&&f.removeChild(o)}},Ae:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ze:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},re:function(f,
h){return f.toLowerCase()==h.toLowerCase()},ld:function(f){f=v.clone(f);for(var h in f)if(f.hasOwnProperty(h)){var e=f[h];if(v.isFunction(e))f[h]=e()}return f},oe:function(f,h,e){function o(){var A={responseText:"",responseXML:C};A.be=f?f.be:C;try{var m;if((m=z.ie?i.contentWindow.document:i.contentDocument||window.frames[y].document)&&m.body)A.responseText=m.body.innerHTML;A.responseXML=m&&m.XMLDocument?m.XMLDocument:m}catch(D){v.log(D)}u.remove(i,"load",o);f.ge&&f.ge(A);setTimeout(function(){B.h(i)},
100)}var y=v.guid("form-upload-"),i=document.createElement("iframe");i.id=y;i.name=y;i.className="ke-hidden";var a="document.open();"+(q.jb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(z.ie)i.src=z.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";v.log("doFormUpload : "+i.src);document.body.appendChild(i);if(z.ie)document.frames[y].name=y;a=B.Jc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=y;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(e)a.action=e;var d;if(h){d=[];h=p.l.ld(h);for(var k in h)if(h.hasOwnProperty(k)){e=document.createElement("input");e.type="hidden";e.name=k;e.value=h[k];a.appendChild(e);d.push(e)}}u.on(i,"load",o);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(d){h=0;for(k=d.length;h<k;h++)B.h(d[h])}return i},o:function(f,h){for(var e in h)f[e]=h[e]},map:function(f,h){for(var e=0;e<f.length;e++)f[e]=
h(f[e]);return f},Ja:r,Le:function(f){z.ie?f.Ic():f.attr("onmousedown","return false;")},Cf:function(f){f=f.attributes;return f.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(f.src||"")}};p.l=q;p.Utils=q;z.Ja=q.Ja;q.o(q,{debugUrl:q.Tc,lazyRun:q.Ge,getXY:q.xe,tryThese:q.Dd,arrayCompare:q.ce,getByAddress:q.Xc,clearAllMarkers:q.ke,htmlEncodeAttr:q.dc,ltrim:q.La,rtrim:q.Na,trim:q.trim,mix:q.mix,isCustomDomain:q.jb,duplicateStr:q.pe,buffer:q.fe,isNumber:q.isNumber,verifyInputs:q.Ve,sourceDisable:q.Re,
resetInput:q.Ne,placeholder:q.Je,clean:q.je,htmlEncode:q.Ae,htmlDecode:q.ze,equalsIgnoreCase:q.re,normParams:q.ld,throttle:q.Te,doFormUpload:q.oe,map:q.map})});
KISSY.Editor.add("dom",function(p){function C(a){if(a&&!a[0])return new r(a);return a}function v(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var B=KISSY,z=B.DOM,u=B.UA,r=B.Node,q=p.l,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};p.n={e:1,f:3,Id:8,hf:11};p.NODE=p.n;p.Ua={ca:0,Jd:1,ba:2,X:4,W:8,xc:16};p.POSITION=
p.Ua;var h=p.n,e=p.Ua,o={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},i={D:C,Jc:v,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return Y;a=v(a);b=v(b);return a===b},pa:function(a,b){a=C(a);var d=B.mix(B.mix({},y),b||{});return o[a.css("display")]||d[a.d()]},ea:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
Y},v:function(a){a=v(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Nd:function(a,b){a=v(a);var d=a.firstChild;if((d=d&&new r(d))&&b&&!b(d))d=d.Ca(b);return d},Gc:function(a,b,d){a=v(a);z.h(a);b=v(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=v(a);var b=a.nodeName.toLowerCase();if(u.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Ec:function(a,b){if(a.d()!=b.d())return Y;var d=a[0].attributes,k=b[0].attributes,A=d.length,
m=k.length;if(A!=m)return Y;for(var D=0;D<A;D++){var j=d[D],s=j.name;if(j.specified&&a.attr(s)!=b.attr(s))return Y}if(q.Ja<8)for(D=0;D<m;D++){j=k[D];s=j.name;if(j.specified&&a.attr(s)!=b.attr(s))return Y}return T},Ib:function(a){a=v(a).childNodes;for(var b=0,d=a.length;b<d;b++){var k=a[b],A=k.nodeType;if(!(A==h.e&&k.getAttribute("_ke_bookmark")))if(A==h.e&&!i.Ib(k)||A==h.f&&B.trim(k.nodeValue))return Y}return T},Jb:function(a,b,d){a=v(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},qa:function(){function a(b,d,k){if(d[0]&&d[0].nodeType==h.e){for(var A=[];d.attr("_ke_bookmark")||d.Ib();){A.push(d);d=k?new r(d[0].nextSibling):new r(d[0].previousSibling);if(!d[0]||d[0].nodeType!=h.e)return}if(b.Ec(d)){for(var m=k?b[0].lastChild:b[0].firstChild;A.length;)A.shift().Gc(b,!k);d.Jb(b,!k);d.h();m[0]&&m[0].nodeType==h.e&&m.qa()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new r(b[0].nextSibling),T);
a(b,new r(b[0].previousSibling))}}}(),Ic:u.gecko?function(a){a=v(a);a.style.MozUserSelect="none"}:u.webkit?function(a){a=v(a);a.style.ef="none"}:function(a){a=v(a);if(u.ie||u.opera){var b=0;a.setAttribute("unselectable","on");for(var d=a.getElementsByTagName("*");a=d[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},Hb:function(a,b){a=v(a);var d,k=0;d=0;var A=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,
m=a.ownerDocument,D=m.documentElement;b=b||m;if(a.getBoundingClientRect){if(a!==m.body&&D!==a){d=a.getBoundingClientRect();k=d.left+(b===m?z.scrollLeft(A):0);d=d.top+(b===m?z.scrollTop(A):0)}if(b)if(A!=(b.defaultView||b.parentWindow)&&A.frameElement){A=i.Hb(A.frameElement,b);k+=A.left;d+=A.top}}return{left:k,top:d}},Pd:function(a){return(a=v(a))&&a.contentWindow.document},ga:function(a,b){a=v(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=h.f)){if(u.ie&&b==a.nodeValue.length){var k=d.createTextNode("");
z.insertAfter(k,a);return new r(k)}k=new r(a.splitText(b));if(d.documentMode){d=d.createTextNode("");z.insertAfter(d,k[0]);z.h(d)}return k}},Kb:function(a,b){a=C(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=v(a);a=a.cloneNode(b);if(!d){var k=function(A){if(A.nodeType==h.e){A.removeAttribute("id");A=A.childNodes;for(var m=0;m<A.length;m++)k(A[m])}};k(a)}return new r(a)},w:function(a,b,d,k){a=v(a);if(k&&!k.call){var A=k[0]||k;k=function(D){D=D[0]||D;return D!==
A}}b=!b&&a.firstChild;var m=new r(a);if(!b){if(a.nodeType==h.e&&k&&k(a,T)===Y)return U;b=a.nextSibling}for(;!b&&(m=m.parent());){if(k&&k(m,T)===Y)return U;b=m[0].nextSibling}if(!b)return U;b=z.D(b);if(k&&k(b)===Y)return U;if(d&&d!=b[0].nodeType)return b.w(Y,d,k);return b},fa:function(a,b,d,k){a=v(a);if(k&&!k.call){var A=k[0]||k;k=function(D){D=D[0]||D;return D!==A}}b=!b&&a.lastChild;var m=new r(a);if(!b){if(a.nodeType==h.e&&k&&k(a,T)===Y)return U;b=a.previousSibling}for(;!b&&(m=m.parent());){if(k&&
k(m,T)===Y)return U;b=m[0].previousSibling}if(!b)return U;b=z.D(b);if(k&&k(b)===Y)return U;if(d&&b[0].nodeType!=d)return b.fa(Y,d,k);return b},Gb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=h.f&&b.contains(a))return b;var d=a[0].nodeType==h.f?a.parent():a;do if(d[0].nodeType!=h.f&&d.contains(b))return d;while(d=d.parent());return U},Ld:function(a,b,d){a=v(a);if(!d)a=a.parentNode;if(b&&!B.isFunction(b)){var k=b;b=function(A){return A.d()==k}}for(;a&&a.nodeType!=9;){if(!b||b(new r(a))===T)return new r(a);
a=a.parentNode}return U},Cc:q.Ja<9?function(a,b){a=v(a);var d=a.attributes[b];return!!(d&&d.specified)}:function(a,b){a=v(a);return a.hasAttribute(b)},Za:q.Ja<9?function(a){a=v(a);for(var b=a.attributes,d=0;d<b.length;d++){var k=b[d];switch(k.name){case "class":if(a.getAttribute("class"))return T;break;default:if(k.specified)return T}}return Y}:function(a){a=v(a);u.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Da:function(a,b){var d=v(a),k=v(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(k);
if(d==k)return e.ca;if(d.nodeType==h.e&&k.nodeType==h.e){if(d.contains){if(d.contains(k))return e.xc+e.X;if(k.contains(d))return e.W+e.ba}if("sourceIndex"in d)return d.sourceIndex<0||k.sourceIndex<0?e.Jd:d.sourceIndex<k.sourceIndex?e.X:e.ba}d=a.Ba();k=b.Ba();for(var A=Math.min(d.length,k.length),m=0;m<=A-1;m++)if(d[m]!=k[m]){if(m<A)return d[m]<k[m]?e.X:e.ba;break}return d.length<k.length?e.xc+e.X:e.W+e.ba},Ba:function(a,b){a=v(a);for(var d=[],k=a.ownerDocument.documentElement,A=a;A&&A!=k;){var m=
A.parentNode,D=-1;if(m){for(var j=0;j<m.childNodes.length;j++){var s=m.childNodes[j];if(!(b&&s.nodeType==3&&s.previousSibling&&s.previousSibling.nodeType==3)){D++;if(s==A)break}}d.unshift(D)}A=m}return d},Fb:function(a,b){var d=new p.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var k=d.extractContents();d.insertNode(a.h());a[0].parentNode.insertBefore(k,a[0].nextSibling)},L:function(a,b,d){a=C(a);if(d!==undefined)return a.css(b,d);a=v(a);return a.style[J(b)]},h:function(a,b){var d=
v(a),k=d.parentNode;if(k){if(b)for(var A;A=d.firstChild;)k.insertBefore(d.removeChild(A),d);k.removeChild(d)}return a},ab:function(a){z.Fc(a);z.Hc(a)},Fc:function(a){a=v(a);for(var b;b=a.firstChild;){if(b.nodeType==h.f){var d=q.La(b.nodeValue),k=b.nodeValue.length;if(d){if(d.length<k){(new r(b)).ga(k-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Hc:function(a){a=v(a);for(var b;b=a.lastChild;){if(b.type==h.f){var d=q.Na(b.nodeValue),k=b.nodeValue.length;if(d){if(d.length<
k){(new r(b)).ga(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!u.ie&&!u.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Eb:function(a){a=v(a);for(var b=a.lastChild;b&&b.nodeType==h.f&&!B.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==h.f||z.d(b)!=="br"){b=u.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");u.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},ra:function(a,
b){var d=v(a),k;do k=(d=d.previousSibling)&&new r(d);while(k&&b&&!b(k));return k},Rd:function(a,b){a=z.D(a);var d=a[0].lastChild;if((d=d&&new r(d))&&b&&!b(d))d=d.ra(b);return d},Ca:function(a,b){var d=v(a),k;do k=(d=d.nextSibling)&&new r(d);while(k&&b&&!b(k));return k},$a:function(a){a=v(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},Sd:function(a,b,d,k){a=z.D(a);var A=a.data("list_marker_id")||
a.data("list_marker_id",B.guid()).data("list_marker_id"),m=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[A]=a;m[d]=1;return a.data(d,k)},Bc:function(a,b,d){a=C(a);var k=a.data("list_marker_names"),A=a.data("list_marker_id"),m;for(m in k)a.removeData(m);a.removeData("list_marker_names");if(d){a.removeData("list_marker_id");delete b[A]}},Md:function(a,b,d){a=v(a);b=C(b);var k=a.attributes;d=d||{};for(var A=0;A<k.length;A++){var m=k[A],D=m.name.toLowerCase(),
j;if(!(D in d))if(D=="checked"&&(j=z.attr(a,D)))b.attr(D,j);else if(m.specified||u.ie&&m.value&&D=="value"){j=z.attr(a,D);if(j===U)j=m.nodeValue;b.attr(D,j)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Dc:function(a){a=z.d(a);var b=p.m;return(a=!b.uc[a]&&(b[a]||b.span))&&a["#"]},Lb:function(a){a=C(a);var b=a[0].ownerDocument,d=z.scrollLeft(b),k=z.scrollTop(b),A=a.offset(),m=A.left;A=A.top;if(z.viewportHeight(b)+k<A||A<k||z.viewportWidth(b)+d<m||m<d)a.scrollIntoView(b)},Od:function(a,
b,d){a=v(a);if(!u.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new r(a[b]));return d}};B.DOM.Qd=function(a){B.mix(z,a);for(var b in a)a.hasOwnProperty(b)&&function(d){r.prototype[d]=function(){var k=[].slice.call(arguments,0);k.unshift(this);return a[d].apply(U,k)}}(b)};q.o(i,{_4e_wrap:i.D,_4e_unwrap:i.Jc,_4e_equals:i.g,_4e_isBlockBoundary:i.pa,_4e_getWin:i.ea,_4e_index:i.v,_4e_first:i.Nd,_4e_move:i.Gc,_4e_name:i.d,_4e_isIdentical:i.Ec,_4e_isEmptyInlineRemoveable:i.Ib,
_4e_moveChildren:i.Jb,_4e_mergeSiblings:i.qa,_4e_unselectable:i.Ic,_4e_getOffset:i.Hb,_4e_getFrameDocument:i.Pd,_4e_splitText:i.ga,_4e_parents:i.Kb,_4e_clone:i.K,_4e_nextSourceNode:i.w,_4e_previousSourceNode:i.fa,_4e_commonAncestor:i.Gb,_4e_ascendant:i.Ld,_4e_hasAttribute:i.Cc,_4e_hasAttributes:i.Za,_4e_position:i.Da,_4e_address:i.Ba,_4e_breakParent:i.Fb,_4e_style:i.L,_4e_remove:i.h,_4e_trim:i.ab,_4e_ltrim:i.Fc,_4e_rtrim:i.Hc,_4e_appendBogus:i.Eb,_4e_last:i.Rd,_4e_previous:i.ra,_4e_next:i.Ca,_4e_outerHtml:i.$a,
_4e_setMarker:i.Sd,_4e_clearMarkers:i.Bc,_4e_getUniqueId:i.qf,_4e_copyAttributes:i.Md,_4e_isEditable:i.Dc,_4e_scrollIntoView:i.Lb,_4e_getElementsByTagName:i.Od});z.Qd(i)});
KISSY.Editor.add("focusmanager",function(p){function C(){this.ec=f;r=this;J.log(this.Ea+" focus")}function v(){this.ec=h;r=e;J.log(this.Ea+" blur")}var J=KISSY,B=J.DOM,z=J.Event,u={},r,q={Hf:function(){for(var o in u){var y=u[o];y.document.designMode="off";y.document.designMode="on"}},wf:function(){return r},ue:function(o){return u[o]},add:function(o){var y=B.ea(o.document);z.on(y,"focus",C,o);z.on(y,"blur",v,o)},Me:function(o){u[o.Ea]=o},remove:function(o){delete u[o.Ea];var y=B.ea(o.document);z.remove(y,
"focus",C,o);z.remove(y,"blur",v,o)}},f=T,h=Y,e=U;p.se=q;p.focusManager=q;p.$c=function(){return u};p.getInstances=p.$c});
KISSY.Editor.add("definition",function(p){var C=T,v=Y,J=p.l,B=document,z=KISSY,u=z.UA,r=z.DOM,q=z.Node,f=z.Event,h=p.se,e=J.Dd,o=J.Tc("theme/editor-iframe.css"),y=1,i="document.open();"+(J.jb()?'document.domain="'+B.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(u.ie?"javascript:void(function(){"+encodeURIComponent(i)+"}())":"")+'"  tabIndex="'+(u.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";p.zc=0;p.Ya=1;p.SOURCE_MODE=p.zc;p.WYSIWYG_MODE=p.Ya;z.augment(p,{Be:function(b){if(u.ie)r.addClass(B.body,"ke-ie"+u.ie);else if(u.gecko)r.addClass(B.body,"ke-gecko");else u.webkit&&r.addClass(B.body,"ke-webkit");var d=this,k=new q(a.replace(/\$\(tabIndex\)/,b.attr("tabIndex")));
d.zf=k;d.Ea=y++;h.Me(d);d.tb=k.one(".ke-textarea-wrap");d.wrap=d.tb;d.ib=d.tb.one("iframe");d.iframe=d.ib;d.Cd=k.one(".ke-editor-tools");d.toolBarDiv=d.Cd;d.Z=b;d.textarea=d.Z;d.Se=k.one(".ke-editor-status");d.statusDiv=d.Se;J.Le(d.Cd);d.Mb={};d.Kc={};var A=b.L("width"),m=b.L("height");if(A){k.css("width",A);b.css("width","100%")}d.Z.css("display","none");k.insertAfter(b);d.tb[0].appendChild(b[0]);if(m){d.tb.css("height",m);b.css("height","100%")}k=d.ib;d.on("dataReady",function(){d.Xd=C;p.fire("instanceCreated",
{qe:d})});u.gecko?k.on("load",d.Mc,d):d.Mc();d.ha.attachForm&&b[0].form&&d.Vd()},Vd:function(){(new q(this.Z[0].form)).on("submit",this.Bd,this)},Ue:function(b,d){var k=this,A=p.kf;A.Ef();k.use(b,function(){var m=k.Yc(b);if(m){d(m);A.Lf()}else z.later(arguments.callee,50,Y,k)})},$d:function(b,d){this.Kc[b]=d},Yc:function(b){return this.Kc[b]},Yd:function(b,d){this.Mb[b]=d},ye:function(b){return this.Mb[b]},execCommand:function(b){var d=this.Mb[b],k=z.makeArray(arguments);k.shift();k.unshift(this);
return d.exec.apply(d,k)},$b:function(){return this.Z.css("display")=="none"?p.Ya:p.zc},getData:function(b){var d;d=this.$b()==p.Ya?this.document.body.innerHTML:this.Z.val();if(this.htmlDataProcessor)d=b?this.htmlDataProcessor.toHtml(d,"p"):this.htmlDataProcessor.toServer(d,"p");d=z.trim(d);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(d))d="";return d},setData:function(b){var d=b;if(this.htmlDataProcessor)d=this.htmlDataProcessor.toDataFormat(b,"p");this.document.body.innerHTML=d;this.$b()!=p.Ya&&this.Z.val(b)},
Bd:function(){this.Z.val(this.getData())},Fa:function(b){b=b||0;return b+(this.ha.Fa||0)},rf:function(){return this.document.body.innerHTML},tf:function(b){this.document.body.innerHTML=b},Wd:function(b){var d=this.ha,k=d.ta,A="";if(k)for(var m=0;m<k.length;m++)A+='<link href="'+k[m]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+p.Config.base+o+"' rel='stylesheet'/><style>"+(d.Tb||"")+"</style>"+A+"</head><body class='ke-editor'>&nbsp;"+(b?'<script id="ke_actscript" type="text/javascript">'+
(J.jb()?'document.domain="'+B.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':"")+"</body></html>"},getSelection:function(){return p.Ac.getSelection(this.document)},focus:function(){var b=this.document,d=r.ea(b);u.webkit&&d&&d.parent&&d.parent.focus();u.webkit&&d&&d.focus();b&&b.body.focus();this.mb()},blur:function(){r.ea(this.document).blur();this.document&&this.document.body.blur()},Zd:function(b){var d=this.ha,k=this.document;d.Tb=d.Tb||"";d.Tb+="\n"+b;d=k.createElement("style");
k.getElementsByTagName("head")[0].appendChild(d);if(d.styleSheet)d.styleSheet.cssText=b;else d.appendChild(k.createTextNode(b))},vf:function(b){var d=this.ha,k=this.document;d.ta=d.ta||[];d.ta.push(b);d=k.createElement("link");d.rel="stylesheet";k.getElementsByTagName("head")[0].appendChild(d);d.href=b},If:function(b){for(var d=this.ha,k=z.makeArray(this.document.getElementsByTagName("link")),A=0;A<k.length;A++)k[A].href==b&&r.h(k[A]);d.ta=d.ta||[];d=d.ta;b=z.indexOf(b,d);b!=-1&&d.splice(b,1)},Mc:function(){function b(){D=
m.document;d.document=D;k.detach();D.open("text/html","replace");D.write(A);D.close()}var d=this,k=d.ib,A=d.Wd(d.Ea),m=k[0].contentWindow,D;try{D=m.document}catch(j){k[0].src=k[0].src;if(u.ie<7){setTimeout(b,10);return}}b()},ready:function(b){this.Xd?b():this.on("dataReady",b)},bb:function(){var b=this;b.Lc&&clearTimeout(b.Lc);b.Lc=setTimeout(function(){var d=b.getSelection();if(d&&!d.hd){var k=d.gb(),A=new p.Ta(k);if(!b.kc||!b.kc.Rc(A)){b.kc=A;b.fire("selectionChange",{selection:d,path:A,element:k})}}},
100)},mb:function(){this.kc=U;this.bb()},gd:function(b,d,k){var A=this;A.focus();setTimeout(function(){var m,D=b.d(),j=p.m,s=p.na,I=p.n,w=j.Ra[D],c=A.getSelection(),g=c&&c.A(),l,t,n,x;if(!g||g.length==0){var O=arguments,P=O.callee;setTimeout(function(){P.apply(A,O)},30)}else{A.fire("save");for(var L=g.length-1;L>=0;L--){l=g[L];l.deleteContents();m=!L&&b||b.K(C);d&&d(m);if(w)for(;(n=l.ua(v,C))&&(x=j[n.d()])&&!(x&&x[D]);)if(n.d()in j.span)l.pc(n);else if(l.sa()&&l.ja()){l.setStartBefore(n);l.collapse(C);
n.h()}else l.oc();l.insertNode(m);t||(t=m)}if(t){D=t.w(C);j=A.document;x=p.m;if(x.sc[m.d()]){D=new q(j.createTextNode(" "));D.insertAfter(t)}else if(D){if(D.d()=="br"&&x[D.parent().d()].p){x=new q("<p>&nbsp;</p>",U,j);D[0].parentNode.replaceChild(x[0],D[0]);D=x}}else{x=new q("<p>&nbsp;</p>",U,j);x.insertAfter(t);D=x}l.H(t,s.t);D&&D[0].nodeType==I.e&&l.lb(D);c.sb([l]);A.focus();m&&m.Lb();setTimeout(function(){A.fire("save")},10);k&&k(m)}}},0)},Ce:function(b){var d=this;if(d.htmlDataProcessor)b=d.htmlDataProcessor.toDataFormat(b);
if(u.webkit){var k=r.create(b,U,d.document);k=k.nodeType==11?z.makeArray(k.childNodes):[k];for(var A=0;A<k.length;A++)d.gd(new q(k[A]))}else{d.focus();setTimeout(function(){var m=d.getSelection(),D=m&&m.A();if(!D||D.length==0){var j=arguments,s=j.callee;setTimeout(function(){s.apply(d,j)},30)}else{d.fire("save");if(u.ie){m=m.r();m.type=="Control"&&m.clear();m.createRange().pasteHTML(b)}else d.document.execCommand("inserthtml",v,b);setTimeout(function(){d.fire("save")},10)}},0)}}});p._initIFrame=function(b){function d(c){e(function(){m.designMode=
"on";setTimeout(function(){m.designMode="off";j.focus();if(!arguments.callee.Oe)arguments.callee.Oe=C},50)},function(){m.designMode="off";r.attr(j,"contentEditable",v);r.attr(j,"contentEditable",C);!c&&d(1)})}var k=h.ue(b);b=k.Z[0];var A=k.ib[0].contentWindow,m=k.document,D=k.ha;r.h(m.getElementById("ke_actscript"));var j=m.body;if(u.ie){j.hideFocus=C;j.disabled=C;j.contentEditable=C;j.removeAttribute("disabled")}else setTimeout(function(){if(u.gecko||u.opera)j.contentEditable=C;else if(u.webkit)j.parentNode.contentEditable=
C;else m.designMode="on"},0);if(u.webkit){f.on(m,"click",function(c){var g=new q(c.target);z.inArray(g.d(),["input","select"])&&c.preventDefault()});f.on(m,"mouseup",function(c){var g=new q(c.target);z.inArray(g.d(),["input","textarea"])&&c.preventDefault()})}if(u.gecko||u.ie||u.opera){var s;s=new q(r.insertAfter((new q('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],b));s.on("focus",function(){k.focus()});k.uf=function(){u.gecko&&k.ec&&s[0].focus()};
k.on("destroy",function(){})}if(u.ie&&m.compatMode=="CSS1Compat"||u.gecko||u.opera){var I=new q(m.documentElement);I.on("mousedown",function(c){if((new q(c.target))[0]==I[0]){u.gecko&&d(v);s[0].focus()}})}f.on(A,"focus",function(){if(u.gecko)d(v);else u.opera&&j.focus();k.mb()});u.gecko&&f.on(k.document,"mousedown",function(){k.ec||d(v)});if(u.ie){f.on(m,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var g=k.getSelection(),l=g.ac();if(l){k.fire("save");var t=g.A()[0].O();l.h();g.xd([t]);k.fire("save");
c.preventDefault()}}});if(m.compatMode=="CSS1Compat"){var w={33:1,34:1};f.on(m,"keydown",function(c){c.keyCode in w&&setTimeout(function(){k.getSelection().scrollIntoView()},0)})}}setTimeout(function(){u.ie&&setTimeout(function(){if(m){j.runtimeStyle.marginBottom="0px";j.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){k.fire("dataReady");var c=D.disableObjectResizing,g=D.disableInlineTableEditing;if(c||g)try{m.execCommand("enableObjectResizing",v,!c);m.execCommand("enableInlineTableEditing",
v,!g)}catch(l){f.on(j,u.ie?"resizestart":"resize",function(t){var n=new q(t.target);if(c||n.d()==="table"&&g)t.preventDefault()})}},10);u.webkit&&f.on(m,"mousedown",function(c){c=new q(c.target);z.inArray(c.d(),["img","hr","input","textarea","select"])&&k.getSelection().nc(c)});u.gecko&&f.on(m,"dragstart",function(c){var g=new q(c.target);g.d()==="img"&&/ke_/.test(g[0].className)&&c.preventDefault()});h.add(k)};i=p.prototype;J.o(i,{setData:i.setData,getData:i.getData,insertElement:i.gd,insertHtml:i.Ce,
ready:i.ready,addCustomStyle:i.Zd,addCommand:i.Yd,hasCommand:i.ye,execCommand:i.execCommand,useDialog:i.Ue,addDialog:i.$d,getDialog:i.Yc,getMode:i.$b,sync:i.Bd,baseZIndex:i.Fa,getSelection:i.getSelection,focus:i.focus,blur:i.blur,notifySelectionChange:i.mb})});
KISSY.Editor.add("zindex",function(){var p=KISSY.Editor;if(!p.Ed){p.Ed={af:1100,lf:1200,bf:99999,gf:900,jf:9999,LOADING:11E3,ff:12E3,mf:1200};p.Fa=function(C){var v=C,J=p.$c(),B;for(B in J){if(!J.hasOwnProperty(B))return;v=Math.max(v,J[B].Fa(C))}return v};p.baseZIndex=p.Fa;p.zIndexManager=p.Ed}});
KISSY.Editor.add("dtd",function(p){p.m=function(){function C(D){for(var j=arguments.length-1;j>0;)KISSY.mix(D,arguments[j--]);return D}var v={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},B=C({a:1},J),z=C({iframe:1},B),u={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},r={ins:1,del:1,script:1,style:1},q=C({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},r),f=C({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},q),h=C({p:1},f);J=C({iframe:1},f,J);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=C({a:1},J),o={tr:1},y={"#":1},i=C({param:1},f),a=C({form:1},v,z,u,h),b={li:1},d={base:1,link:1,meta:1,title:1},k=C(d,{style:1,script:1}),A={head:1,body:1},m={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{wb:C({html:1},A,d),Ra:m,Ze:{body:1,div:1,td:1,th:1,caption:1,
form:1},sc:e,qc:C({script:1,style:1},m),rc:{script:1,style:1},ub:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},vb:{dd:1,dt:1,li:1},Fd:{ul:1,ol:1,dl:1},uc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},aa:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$e:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},vc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:A,head:k,style:y,body:a,base:{},link:{},meta:{},title:y,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:C(h,u),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:b,h1:e,h3:e,option:y,h2:e,form:C(v,z,u,h),select:{optgroup:1,option:1},font:e,ins:e,menu:b,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:y,tfoot:o,cite:e,li:a,input:{},iframe:a,
strong:e,textarea:y,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:i,sup:e,dd:a,strike:e,area:{},dir:b,map:C({area:1,form:1,p:1},v,r,u),applet:i,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:C({Df:1},f),thead:o,ul:b,acronym:e,b:e,a:J,blockquote:a,caption:e,i:e,u:e,tbody:o,s:e,address:C(z,h),tt:e,legend:e,q:e,pre:C(q,B),p:e,em:e,dfn:e}}();p.XHTML_DTD=p.m});
KISSY.Editor.add("elementpath",function(p){function C(f){var h=z,e=z,o=[];for(f=f;f&&f[0];){if(f[0].nodeType==B.e){if(!this.Fe)this.Fe=f;var y=f.d();if(!e){if(!h&&u[y])h=f;if(r[y]){var i;if(i=!h){if(i=y=="div"){a:{i=f;i=i[0]||i;i=i.childNodes;for(var a=0,b=i.length;a<b;a++){var d=i[a];if(d.nodeType==B.e&&J.Ra[d.nodeName.toLowerCase()]){i=T;break a}}i=Y}i=!i}i=i}if(i)h=f;else e=f}}o.push(f);if(y=="body")break}f=f.parent()}this.block=this.z=h;this.blockLimit=this.F=e;this.elements=this.elements=o}var v=
KISSY.DOM,J=p.m,B=p.n,z=U,u={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},r={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};C.prototype={Rc:function(f){var h=this.elements;f=f&&f.elements;if(!f||h.length!=f.length)return Y;for(var e=0;e<h.length;e++)if(!v.g(h[e],f[e]))return Y;return T},contains:function(f){for(var h=this.elements,e=0;e<h.length;e++)if(h[e].d()in f)return h[e];return z}};p.ElementPath=p.Ta=C;var q=C.prototype;p.l.o(q,{compare:q.Rc,
contains:q.contains})});
KISSY.Editor.add("walker",function(p){function C(o,y){if(this.c.end)return u;var i,a=this.wa,b,d=this.bc,k=this.type,A=o?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return u}}if(!o&&!this.c.bd){var m=a.endContainer,D=new h(m[0].childNodes[a.endOffset]);this.c.bd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!f.g(m,w))&&(!D[0]||!w.g(D))&&(w[0].nodeType!=q.e||!c||w.d()!="body")}}if(o&&!this.c.cd){var j=a.startContainer,s=a.startOffset>
0&&new h(j[0].childNodes[a.startOffset-1]);this.c.cd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!w.g(j))&&(!s[0]||!w.g(s))&&(w[0].nodeType!=q.e||!c||w.d()!="body")}}var I=o?this.c.cd:this.c.bd;b=d?function(w,c){if(I(w,c)===z)return z;return d(w,c)}:I;if(this.eb)i=this.eb[A](z,k,b);else if(o){i=a.endContainer;if(a.endOffset>0){i=new h(i[0].childNodes[a.endOffset-1]);if(b(i)===z)i=u}else i=b(i,B)===z?u:i.fa(B,k,b)}else{i=a.startContainer;if((i=new h(i[0].childNodes[a.startOffset]))&&i[0]){if(b(i)===
z)i=u}else i=b(a.startContainer,B)===z?u:a.startContainer.w(B,k,b)}for(;i&&i[0]&&!this.c.end;){this.eb=i;if(!this.Q||this.Q(i)!==z){if(!y)return i}else if(y&&this.Q)return z;i=i[A](z,k,b)}this.end();return this.eb=u}function v(o){for(var y,i=u;y=C.call(this,o);)i=y;return i}function J(o){this.wa=o;this.c={}}var B=T,z=Y,u=U,r=KISSY,q=p.n,f=r.DOM,h=r.Node;r.augment(J,{end:function(){this.c.end=1},next:function(){return C.call(this)},pb:function(){return C.call(this,B)},Qc:function(){return C.call(this,
z,B)!==z},Pc:function(){return C.call(this,B,B)!==z},kd:function(){return v.call(this)},jd:function(){return v.call(this,B)},reset:function(){delete this.eb;this.c={}}});J.Pb=function(o){return function(y){y=f.D(y);return!(y&&y[0].nodeType==q.e&&y.pa(o))}};J.Ie=function(){return this.Pb({Qb:1})};J.Ga=function(o,y){function i(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,d;b=a&&a[0]&&a[0].nodeType==q.f&&(d=a.parent())&&i(d);b=o?b:b||i(a);return y^b}};J.Qa=function(o){return function(y){y=
(y=y[0]||y)&&y.nodeType==q.f&&!r.trim(y.nodeValue);return o^y}};J.De=function(o){var y=J.Qa();return function(i){i=y(i)||i[0].nodeType==q.e&&!i[0].offsetHeight;return o^i}};p.Aa=J;p.Walker=J;var e=J.prototype;p.l.o(e,{end:e.end,next:e.next,previous:e.pb,checkForward:e.Qc,checkBackward:e.Pc,lastForward:e.kd,lastBackward:e.jd,reset:e.reset});p.l.o(J,{blockBoundary:J.Pb,listItemBoundary:J.Ie,bookmark:J.Ga,whitespaces:J.Qa,invisible:J.De})});
KISSY.Editor.add("range",function(p){function C(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=r;this.document=c}function v(c){var g=c[0].nodeType!=e.f&&c.d()in k.aa,l=!h.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return g||l||c}function J(c){return!s(c)&&!I(c)}function B(c){var g=q,l=i.Ga(r);return function(t){if(l(t))return r;if(t[0].nodeType==e.f){if(h.trim(t[0].nodeValue).length)return q}else if(t[0].nodeType==e.e)if(!j[t.d()])if(!c&&!d.ie&&
t.d()=="br"&&!g)g=r;else return q;return r}}function z(c,g){function l(t){return t&&t.nodeName=="span"&&t.getAttribute("_ke_bookmark")}return function(t){var n,x;n=t&&!t.nodeName&&(x=t.parentNode)&&l(x);n=c?n:n||l(t);return g^n}}function u(c){return function(g){g=(g=g[0]||g)&&g.nodeType==e.f&&!h.trim(g.nodeValue);return c^g}}p.na={V:1,J:2,C:3,t:4,zb:1,yb:2,Sa:3,Wa:1,Hd:2,nf:3,da:1,yc:2};p.RANGE=p.na;var r=T,q=Y,f=U,h=KISSY,e=p.n,o=p.na,y=p.Ua,i=p.Aa,a=h.DOM,b=p.l.Xc,d=h.UA,k=p.m,A=p.Ta,m=h.Node,D=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};C.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};h.augment(C,{Pa:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},ic:function(){var c=this.startContainer,
g=this.startOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;g=this.endOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},jc:function(){var c=
this.startContainer,g=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.T(c,o.C);g&&g.d()=="span"&&g.attr("_ke_bookmark")&&this.S(g,o.t)},setStart:function(c,g){if(c[0].nodeType==e.e&&D[c.d()]){c=c.parent();g=c.v()}this.startContainer=c;this.startOffset=g;if(!this.endContainer){this.endContainer=c;this.endOffset=g}this.Pa()},setEnd:function(c,g){if(c[0].nodeType==e.e&&D[c.d()]){c=c.parent();g=c.v()+1}this.endContainer=c;this.endOffset=g;if(!this.startContainer){this.startContainer=
c;this.startOffset=g}this.Pa()},T:function(c,g){switch(g){case o.V:this.setStart(c,0);break;case o.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case o.C:this.setStartBefore(c);break;case o.t:this.setStartAfter(c)}this.Pa()},S:function(c,g){switch(g){case o.V:this.setEnd(c,0);break;case o.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case o.C:this.setEndBefore(c);break;case o.t:this.setEndAfter(c)}this.Pa()},
Wb:function(c,g){var l=this.startContainer,t=this.endContainer,n=this.startOffset,x=this.endOffset,O,P=this.document,L;this.jc();if(t[0].nodeType==e.f)t=t.ga(x);else if(t[0].childNodes.length>0)if(x>=t[0].childNodes.length){t=new m(t[0].appendChild(P.createTextNode("")));L=r}else t=new m(t[0].childNodes[x]);if(l[0].nodeType==e.f){l.ga(n);if(l.g(t))t=new m(l[0].nextSibling)}else if(n)if(n>=l[0].childNodes.length){O=new m(P.createTextNode(""));l.append(O);l=O;O=r}else l=new m(l[0].childNodes[n].previousSibling);
else{O=new m(P.createTextNode(""));l.prepend(O);l=O;O=r}n=l.Kb();x=t.Kb();var Q,S,W;for(Q=0;Q<n.length;Q++){S=n[Q];W=x[Q];if(!S.g(W))break}P=g;for(var V,X,E,K=Q;K<n.length;K++){V=n[K];X=P&&!V.g(l)?P.appendChild(V.K()[0]):U;for(V=V[0].nextSibling;V;){if(a.g(x[K],V)||a.g(t,V))break;E=V.nextSibling;if(c==2)P.appendChild(V.cloneNode(r));else{a.h(V);c==1&&P.appendChild(V)}V=E}if(X)P=X}P=g;for(Q=Q;Q<x.length;Q++){V=x[Q];X=P&&c>0&&!V.g(t)?P.appendChild(V.K()[0]):U;if(!n[Q]||!V.parent().g(n[Q].parent()))for(V=
V[0].previousSibling;V;){if(a.g(n[Q],V)||a.g(l,V))break;E=V.previousSibling;if(c==2)P.insertBefore(V.cloneNode(r),P.firstChild);else{a.h(V);c==1&&P.insertBefore(V,P.firstChild)}V=E}if(X)P=X}if(c==2){W=this.startContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}W=this.endContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}}else{if(S&&
W&&(!l.parent().g(S.parent())||!t.parent().g(W.parent()))){S=W.v();O&&W.parent().g(l.parent())&&S--;this.setStart(W.parent(),S)}this.collapse(r)}O&&l.h();L&&t[0].parentNode&&t.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=r},clone:function(){var c=new C(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},Zc:function(){var c=this.clone();c.ic();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return f;var g=new p.Aa(c),l=z(r,undefined),t=u(r);c.Q=function(n){return t(n)&&l(n)};c=g.next();g.reset();g=g.pb();return c&&c.g(g)?c:f},Oa:function(c,g){if(!this.collapsed){c=c||o.yc;var l=this.clone(),t=this.startContainer,n=this.endContainer,x=this.startOffset,O=this.endOffset,P=1,L=1;if(t&&t[0].nodeType==e.f)if(x)if(x>=t[0].nodeValue.length)l.setStartAfter(t);
else{l.setStartBefore(t);P=0}else l.setStartBefore(t);if(n&&n[0].nodeType==e.f)if(O)if(O>=n[0].nodeValue.length)l.setEndAfter(n);else{l.setEndAfter(n);L=0}else l.setEndBefore(n);l=new i(l);l.Q=function(S){S=S[0]||S;return S.nodeType==(c==o.da?e.e:e.f)};var Q;l.bc=function(S,W){S=S[0]||S;if(c==o.da&&S.nodeType==e.f)return q;if(W&&S==Q)return q;if(!W&&S.nodeType==e.e)Q=S;return r};if(P)(t=l[c==o.da?"lastForward":"next"]())&&this.T(t,g?o.V:o.C);if(L){l.reset();(l=l[c==o.da?"lastBackward":"previous"]())&&
this.S(l,g?o.J:o.t)}return!!(P||L)}},we:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Sc:function(c){var g=this.startContainer,l=this.endContainer,t=this.startOffset,n=this.endOffset,x,O;if(!g||!l)return{start:0,end:0};if(c){if(g[0].nodeType==e.e)if((x=new m(g[0].childNodes[t]))&&x[0]&&x[0].nodeType==e.f&&t>0&&x[0].previousSibling.nodeType==e.f){g=x;t=0}for(;g[0].nodeType==e.f&&(O=g.ra())&&O[0].nodeType==e.f;){g=O;t+=
O[0].nodeValue.length}if(!this.collapsed){if(l[0].nodeType==e.e)if((x=new m(l[0].childNodes[n]))&&x[0]&&x[0].nodeType==e.f&&n>0&&x[0].previousSibling.nodeType==e.f){l=x;n=0}for(;l[0].nodeType==e.f&&(O=l.ra())&&O[0].nodeType==e.f;){l=O;n+=O[0].nodeValue.length}}}return{start:g.Ba(c),end:this.collapsed?f:l.Ba(c),startOffset:t,endOffset:n,md:c,Ee:r}},O:function(c){var g,l,t,n,x=this.collapsed;g=new m("<span>",f,this.document);g.attr("_ke_bookmark",1);g.css("display","none");g.html("&nbsp;");if(c){t=
h.guid("ke_bm_");g.attr("id",t+"S")}if(!x){l=g.K();l.html("&nbsp;");c&&l.attr("id",t+"E");n=this.clone();n.collapse();n.insertNode(l)}n=this.clone();n.collapse(r);n.insertNode(g);if(l){this.setStartAfter(g);this.setEndBefore(l)}else this.H(g,o.t);return{Y:c?t+"S":g,P:c?t+"E":l,zd:c,collapsed:x}},H:function(c,g){this.T(c,g);this.collapse(r)},trim:function(c,g){var l=this.startContainer,t=this.startOffset,n=this.collapsed;if((!c||n)&&l[0]&&l[0].nodeType==e.f){if(t)if(t>=l[0].nodeValue.length){t=l.v()+
1;l=l.parent()}else{var x=l.ga(t);t=l.v()+1;l=l.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(x,this.endOffset-this.startOffset);else if(a.g(l,this.endContainer))this.endOffset+=1}else{t=l.v();l=l.parent()}this.setStart(l,t);if(n){this.collapse(r);return}}l=this.endContainer;t=this.endOffset;if(!(g||n)&&l[0]&&l[0].nodeType==e.f){if(t){t>=l.nodeValue.length||l.ga(t);t=l.v()+1}else t=l.v();l=l.parent();this.setEnd(l,t)}},insertNode:function(c){this.jc();this.trim(q,r);var g=this.startContainer;
g[0].insertBefore(c[0]||c,g[0].childNodes[this.startOffset]||U);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.Ee){var g=b(this.document,c.start,c.md),l=c.startOffset,t=c.end&&b(this.document,c.end,c.md);c=c.endOffset;this.setStart(g,l);t?this.setEnd(t,c):this.collapse(r)}else{g=(l=c.zd)?h.one("#"+c.Y,this.document):c.Y;c=l?h.one("#"+c.P,this.document):c.P;this.setStartBefore(g);g.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(r)}},
ua:function(c,g){var l=this.startContainer,t=this.endContainer;l=a.g(l,t)?c&&l[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new m(l[0].childNodes[this.startOffset]):l:l.Gb(t);return g&&l[0].nodeType==e.f?l.parent():l},Ia:function(c){switch(c){case o.zb:if(this.collapsed)break;c=this.ua();var g=new m(this.document.body),l,t,n,x,O,P=q,L,Q;L=this.startContainer;Q=this.startOffset;if(L[0].nodeType==e.f){if(Q){L=!h.trim(L[0].nodeValue.substring(0,Q)).length&&L;P=!!L}if(L)if(!(x=L[0].previousSibling))n=
L.parent()}else{if(Q)x=L[0].childNodes[Q-1]||L[0].lastChild;x||(n=L)}for(;n||x;){if(n&&!x){if(!O&&a.g(n,c))O=r;if(!g.contains(n))break;if(!P||n.css("display")!="inline"){P=q;if(O)l=n;else this.setStartBefore(n)}x=n[0].previousSibling}for(;x;){L=q;if(x.nodeType==e.f){Q=x.nodeValue;if(/[^\s\ufeff]/.test(Q))x=f;L=/[\s\ufeff]$/.test(Q)}else if(x.offsetWidth>0&&!x.getAttribute("_ke_bookmark"))if(P&&k.aa[x.nodeName.toLowerCase()]){Q=a.text(x);if(/[^\s\ufeff]/.test(Q))x=f;else for(var S=x.all||x.getElementsByTagName("*"),
W=0,V;V=S[W++];)if(!k.aa[V.nodeName.toLowerCase()]){x=f;break}if(x)L=!!Q.length}else x=f;if(L)if(P)if(O)l=n;else n&&this.setStartBefore(n);else P=r;if(x){L=x.previousSibling;if(!n&&!L){n=new m(x);x=f;break}x=L}else n=f}if(n)n=n.parent()}L=this.endContainer;Q=this.endOffset;n=x=f;O=P=q;if(L[0].nodeType==e.f){L=!h.trim(L[0].nodeValue.substring(Q)).length&&L;P=!(L&&L[0].nodeValue.length);if(L)if(!(x=L[0].nextSibling))n=L.parent()}else(x=L[0].childNodes[Q])||(n=L);for(;n||x;){if(n&&!x){if(!O&&a.g(n,c))O=
r;if(!g.contains(n))break;if(!P||n.css("display")!="inline"){P=q;if(O)t=n;else n&&this.setEndAfter(n)}x=n[0].nextSibling}for(;x;){L=q;if(x.nodeType==e.f){Q=x.nodeValue;if(/[^\s\ufeff]/.test(Q))x=f;L=/^[\s\ufeff]/.test(Q)}else if(x.offsetWidth>0&&!x.getAttribute("_ke_bookmark"))if(P&&k.aa[x.nodeName.toLowerCase()]){Q=a.text(x);if(/[^\s\ufeff]/.test(Q))x=f;else{S=x.all||x.getElementsByTagName("*");for(W=0;V=S[W++];)if(!k.aa[V.nodeName.toLowerCase()]){x=f;break}}if(x)L=!!Q.length}else x=f;if(L)if(P)if(O)t=
n;else this.setEndAfter(n);if(x){L=x.nextSibling;if(!n&&!L){n=new m(x);x=f;break}x=L}else n=f}if(n)n=n.parent()}if(l&&t){c=l.contains(t)?t:l;this.setStartBefore(c);this.setEndAfter(c)}break;case o.yb:case o.Sa:n=new C(this.document);g=new m(this.document.body);n.T(g,o.V);n.setEnd(this.startContainer,this.startOffset);n=new i(n);var X,E,K=i.Pb(c==o.Sa?{Qb:1}:f),G=function(F){var H=K(F);H||(X=F);return H};l=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")E=F;return H};n.bc=G;n=n.jd();X=X||g;this.T(X,
X.d()!="br"&&(!n&&this.sa()||n&&X.contains(n))?o.V:o.t);n=this.clone();n.collapse();n.S(g,o.J);n=new i(n);n.bc=c==o.Sa?l:G;X=f;n=n.kd();X=X||g;this.S(X,!n&&this.ja()||n&&X.contains(n)?o.J:o.C);E&&this.setEndAfter(E)}},sa:function(){var c=this.startContainer,g=this.startOffset;if(g&&c[0].nodeType==e.f)if(h.trim(c[0].nodeValue.substring(0,g)).length)return q;this.trim();c=new A(this.startContainer);g=this.clone();g.collapse(r);g.T(c.z||c.F,o.V);c=new i(g);c.Q=B(r);return c.Pc()},ja:function(){var c=
this.endContainer,g=this.endOffset;if(c[0].nodeType==e.f)if(h.trim(c[0].nodeValue.substring(g)).length)return q;this.trim();c=new A(this.endContainer);g=this.clone();g.collapse(q);g.S(c.z||c.F,o.J);c=new i(g);c.Q=B(q);return c.Qc()},deleteContents:function(){this.collapsed||this.Wb(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Wb(1,c);return c},Sb:function(c,g){var l=this.clone();l[g==o.Wa?"setStartAt":"setEndAt"](c,g==o.Wa?o.V:o.J);l=new i(l);l.Q=
v;return l[g==o.Wa?"checkBackward":"checkForward"]()},Wc:function(){var c=this.startContainer,g=this.endContainer,l=this.startOffset,t=this.endOffset,n;if(c[0].nodeType==e.e){n=c[0].childNodes.length;if(n>l)c=new m(c[0].childNodes[l]);else if(n<1)c=c.fa();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new m(c);c=c.w()||c}}if(g[0].nodeType==e.e){n=g[0].childNodes.length;if(n>t)g=(new m(g[0].childNodes[t])).fa(r);else if(n<1)g=g.fa();else{for(g=g[0];g.lastChild;)g=g.lastChild;g=new m(g)}}if(c.Da(g)&y.ba)c=
g;return{Y:c,P:g}},fb:function(c,g){var l=this.O(),t=new m(this.document.createElement(g));this.collapse(c);this.Ia(o.yb);t[0].appendChild(this.extractContents());t.ab();d.ie||t.Eb();this.insertNode(t);this.moveToBookmark(l);return t},oc:function(c){var g=new A(this.startContainer),l=new A(this.endContainer),t=g.z,n=l.z,x=f;if(!g.F.g(l.F))return f;if(c!="br"){if(!t){t=this.fb(r,c);n=(new A(this.endContainer)).z}n||(n=this.fb(q,c))}c=t&&this.sa();g=n&&this.ja();this.deleteContents();if(t&&a.g(t,n))if(g){x=
new A(this.startContainer);this.H(n,o.t);n=f}else if(c){x=new A(this.startContainer);this.H(t,o.C);t=f}else{n=this.pc(t);!d.ie&&!h.inArray(t.d(),["ul","ol"])&&t.Eb()}return{Gf:t,Ff:n,Xe:c,We:g,Af:x}},pc:function(c){if(!this.collapsed)return f;this.S(c,o.J);var g=this.extractContents(),l=c.K(q);l[0].appendChild(g);l.insertAfter(c);this.H(c,o.t);return l},lb:function(c,g){var l,t=p.m;if(t.ub[c.d()])return q;for(;c&&c[0].nodeType==e.e;){if(l=c.Dc())this.H(c,g?o.J:o.V);else if(t.sc[c.d()]){this.H(c,g?
o.t:o.C);return r}if((c=t.ub[c.d()]?c[g?"_4e_previous":"_4e_next"](J):c[g?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,g?o.t:o.C);return r}}return l},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var j={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},s=new i.Qa,I=new i.Ga;p.Range=
C;p.Range=C;var w=C.prototype;p.l.o(w,{updateCollapsed:w.Pa,optimize:w.ic,setStartAfter:w.setStartAfter,setEndAfter:w.setEndAfter,setStartBefore:w.setStartBefore,setEndBefore:w.setEndBefore,optimizeBookmark:w.jc,setStart:w.setStart,setEnd:w.setEnd,setStartAt:w.T,setEndAt:w.S,execContentsAction:w.Wb,collapse:w.collapse,clone:w.clone,getEnclosedNode:w.Zc,shrink:w.Oa,getTouchedStartNode:w.we,createBookmark2:w.Sc,createBookmark:w.O,moveToPosition:w.H,trim:w.trim,insertNode:w.insertNode,moveToBookmark:w.moveToBookmark,
getCommonAncestor:w.ua,enlarge:w.Ia,checkStartOfBlock:w.sa,checkEndOfBlock:w.ja,deleteContents:w.deleteContents,extractContents:w.extractContents,checkBoundaryOfElement:w.Sb,getBoundaryNodes:w.Wc,fixBlock:w.fb,splitBlock:w.oc,splitElement:w.pc,moveToElementEditablePosition:w.lb,selectNodeContents:w.selectNodeContents})});
KISSY.Editor.add("domiterator",function(p){function C(i){if(!(arguments.length<1)){this.wa=i;this.Yb=J;this.Vc=v;this.Vb=J;this.c||(this.c={})}}var v=T,J=Y,B=KISSY,z=B.UA,u=p.Aa,r=p.Range,q=p.na,f=p.n,h=p.Ta,e=B.Node,o=B.DOM,y=/^[\r\n\t ]*$/;B.augment(C,{ve:function(i){var a,b,d,k,A;if(!this.c.I){b=this.wa.clone();b.Oa(q.da,v);b.Ia(this.Yb||!this.Vc?q.Sa:q.yb);var m=new u(b),D=u.Ga(v,v);m.Q=D;this.c.ka=m.next();m=new u(b);m.Q=D;m=m.pb();this.c.I=m.w(v);if(this.c.I&&this.c.I[0].nodeType==f.f&&!B.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().pa()){D=new r(b.document);D.H(this.c.I,q.t);if(D.ja()){D=new h(D.endContainer);this.c.I=(D.z||D.F).w(v)}}if(!this.c.I){this.c.I=this.c.Uc=new e(b.document.createTextNode(""));o.insertAfter(this.c.I[0],m[0])}b=U}D=this.c.ka;m=this.c.I;for(this.c.ka=U;D;){var j=J,s=D[0].nodeType!=f.e,I=J;if(s){if(D[0].nodeType==f.f)if(y.test(D[0].nodeValue))s=J}else{var w=D.d();if(D.pa(this.Yb&&{Qb:1})){if(w=="br")s=v;else if(!b&&!D[0].childNodes.length&&w!="hr"){a=D;d=D.g(m);break}if(b){b.S(D,q.C);
if(w!="br")this.c.ka=D}j=v}else{if(D[0].firstChild){if(!b){b=new r(this.wa.document);b.T(D,q.C)}D=new e(D[0].firstChild);continue}s=v}}if(s&&!b){b=new r(this.wa.document);b.T(D,q.C)}d=(!j||s)&&D.g(m);if(b&&!j)for(;!D[0].nextSibling&&!d;){w=D.parent();if(w.pa(this.Yb&&{Qb:1})){j=v;d||w.g(m);break}D=w;s=v;d=D.g(m);I=v}s&&b.S(D,q.t);D=D.w(I,U,m);if((d=!D)||j&&b)break}if(!a){if(!b){this.c.Uc&&this.c.Uc.h();return this.c.ka=U}a=new h(b.startContainer);D=a.F;j={yf:1,Kf:1,Jf:1};a=a.z;if((!a||!a[0])&&!this.Vb&&
j[D.d()]&&b.sa()&&b.ja())a=D;else if(!a||this.Vb&&a.d()=="li"){a=new e(this.wa.document.createElement(i||"p"));a[0].appendChild(b.extractContents());a.ab();b.insertNode(a);k=A=v}else if(a.d()!="li"){if(!b.sa()||!b.ja()){a=a.K(J);a[0].appendChild(b.extractContents());a.ab();A=b.oc();k=!A.Xe;A=!A.We;b.insertNode(a)}}else if(!d)this.c.ka=a.g(m)?U:b.Wc().P.w(v,U,m)}if(k){b=new e(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&o.d(b[0].lastChild)=="br"&&o.h(b[0].lastChild)}if(A){b=
u.Ga(J,v);k=new e(a[0].lastChild);if(k[0]&&k[0].nodeType==f.e&&k.d()=="br")if(z.ie||k.ra(b)||k.Ca(b))k.h()}if(!this.c.ka)this.c.ka=d||a.g(m)?U:a.w(v,U,m);return a}});r.prototype.ne=function(){return new C(this)}});
KISSY.Editor.add("selection",function(p){function C(j){this.document=this.document=j;this.c={M:{}};if(a){var s=this.r().createRange();if(!s||s.item&&s.item(0).ownerDocument!=j||s.parentElement&&s.parentElement().ownerDocument!=j)this.hd=B}}function v(j){j=new C(j);return!j||j.hd?u:j}function J(j){var s=j.document,I=new e(s.body),w=new e(s.documentElement);if(q.ie){if(q.ie<8||document.documentMode==7)w.on("click",function(L){(new e(L.target)).d()==="html"&&j.getSelection().A()[0].select()});var c,
g,l=1;w.on("mousedown",function(){l=0});w.on("mouseup",function(){l=1});I.on("focusin",function(L){if((new e(L.target)).d()=="body")if(c){try{l&&c.select()}catch(Q){}c=u}});I.on("focus",function(){g=B;n()});I.on("beforedeactivate",function(L){if(!L.relatedTarget){g=z;l=1}});h.on(f.ea(s),"blur",function(){s&&s.selection.empty()});I.on("mousedown",function(){t()});I.on("mouseup",function(){g=B;setTimeout(function(){n(B)},0)});var t=function(){g=z},n=function(L){if(g){var Q=j.document,S=j.getSelection(),
W=S&&S.hb(),V=S&&S.r();if(L&&V&&W==o.Bb)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){n(B)},50);return}var X;if(!(V&&W==o.oa&&(X=f.d(S.gb()))&&X in{input:1,textarea:1})){c=V&&S.A()[0];j.bb()}}};I.on("keydown",t);I.on("keyup",function(){g=B;n()});h.on(s,"selectionchange",n)}else{h.on(s,"mouseup",j.bb,j);h.on(s,"keyup",j.bb,j)}var x={table:1,pre:1},O=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,P=p.Aa.Qa(B);j.on("selectionChange",
function(L){var Q=L.path;L=(L=L.selection)&&L.A()[0];if(!(!L||!L.collapsed||Q.z))if(Q.F.d()=="body"){Q=L.fb(B,"p");if(Q.$a().match(O)){var S=Q.Ca(P);if(S&&S[0].nodeType==i.e&&!x[S.d()]){L.lb(S);Q.h()}else if((S=Q.ra(P))&&S[0].nodeType==i.e&&!x[S.d()]){L.lb(S,S.$a().match(O)?z:B);Q.h()}}L.select();a||j.mb()}})}p.Kd={Bb:1,oa:2,Va:3};var B=T,z=Y,u=U,r=KISSY,q=r.UA,f=r.DOM,h=r.Event,e=r.Node,o=p.Kd,y=p.na,i=p.n,a=!window.getSelection,b=p.Aa,d=p.Range,k={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};r.augment(C,{r:!a?function(){var j=this.c.M;return j.gc||(j.gc=f.ea(this.document).getSelection())}:function(){var j=this.c.M;return j.gc||(j.gc=this.document.selection)},hb:!a?function(){var j=this.c.M;if(j.type)return j.type;var s=o.oa,I=this.r();if(I){if(I.rangeCount==1){I=I.getRangeAt(0);var w=I.startContainer;if(w==I.endContainer&&w.nodeType==i.e&&I.endOffset-I.startOffset===1&&k[w.childNodes[I.startOffset].nodeName.toLowerCase()])s=
o.Va}}else s=o.Bb;return j.type=s}:function(){var j=this.c.M;if(j.type)return j.type;var s=o.Bb;try{var I=this.r(),w=I.type;if(w=="Text")s=o.oa;if(w=="Control")s=o.Va;if(I.createRange().parentElement)s=o.oa}catch(c){}return j.type=s},A:a?function(){function j(s,I){s=s.duplicate();s.collapse(I);for(var w=s.parentElement(),c=w.childNodes,g,l=0;l<c.length;l++){var t=c[l];if(t.nodeType==i.e){g=s.duplicate();g.moveToElementText(t);t=g.compareEndPoints("StartToStart",s);var n=g.compareEndPoints("EndToStart",
s);g.collapse();if(t>0)break;else if(!t||n==1&&t==-1)return{Ha:w,offset:l};else if(!n)return{Ha:w,offset:l+1};g=u}}if(!g){g=s.duplicate();g.moveToElementText(w);g.collapse(z)}g.setEndPoint("StartToStart",s);g=g.text.replace(/\r\n|\r/g,"\n").length;try{for(;g>0;)g-=c[--l].nodeValue.length}catch(x){g=0}return g===0?{Ha:w,offset:l}:{Ha:c[l],offset:-g}}return function(){var s=this.c.M;if(s.ma)return s.ma;var I=this.r(),w=I&&I.createRange(),c=this.hb();if(!I)return[];if(c==o.oa){I=new d(this.document);
c=j(w,B);I.setStart(new e(c.Ha),c.offset);c=j(w);I.setEnd(new e(c.Ha),c.offset);return s.ma=[I]}else if(c==o.Va){s=s.ma=[];for(c=0;c<w.length;c++){var g=w.item(c),l=g.parentNode,t=0;for(I=new d(this.document);t<l.childNodes.length&&l.childNodes[t]!=g;t++);I.setStart(new e(l),t);I.setEnd(new e(l),t+1);s.push(I)}return s}return s.ma=[]}}():function(){var j=this.c.M;if(j.ma)return j.ma;var s=[],I=this.r();if(!I)return[];for(var w=0;w<I.rangeCount;w++){var c=I.getRangeAt(w),g=new d(this.document);g.setStart(new e(c.startContainer),
c.startOffset);g.setEnd(new e(c.endContainer),c.endOffset);s.push(g)}return j.ma=s},gb:function(){var j=this.c.M;if(j.Ad!==undefined)return j.Ad;var s,I=this.r();switch(this.hb()){case o.Va:return this.ac();case o.oa:var w=this.A()[0];if(w)if(!w.collapsed){for(w.ic();B;){s=w.startContainer;if(w.startOffset==(s[0].nodeType===i.e?s[0].childNodes.length:s[0].nodeValue.length)&&!s.pa())w.setStartAfter(s);else break}s=w.startContainer;if(s[0].nodeType!=i.e)return s.parent();s=new e(s[0].childNodes[w.startOffset]);
if(!s[0]||s[0].nodeType!=i.e)return w.startContainer;for(w=s[0].firstChild;w&&w.nodeType==i.e;){s=new e(w);w=w.firstChild}return s}if(a){w=I.createRange();w.collapse(B);s=w.parentElement()}else if((s=I.anchorNode)&&s.nodeType!=i.e)s=s.parentNode}return j.Ad=s?f.D(s):u},ac:function(){var j=this,s,I=j.c.M;if(I.yd!==undefined)return I.yd;if(a){s=j.r().createRange();s=s.item&&s.item(0)}s||(s=function(){for(var w=j.A()[0],c,g,l=2;l&&!((c=w.Zc())&&c[0].nodeType==i.e&&k[c.d()]&&(g=c));l--)w.Oa(y.da);return g&&
g[0]}());return I.yd=f.D(s)},reset:function(){this.c.M={}},nc:function(j){var s,I=this.document;if(a)try{s=I.body.createControlRange();s.addElement(j[0]);s.select()}catch(w){s=I.body.createTextRange();s.moveToElementText(j[0]);s.select()}finally{}else{s=I.createRange();s.selectNode(j[0]);j=this.r();j.removeAllRanges();j.addRange(s)}this.reset()},sb:function(j){if(a){if(j.length>1){var s=j[j.length-1];j[0].setEnd(s.endContainer,s.endOffset);j.length=1}j[0]&&j[0].select()}else{s=this.r();if(!s)return;
s.removeAllRanges();for(var I=0;I<j.length;I++){var w=j[I],c=this.document.createRange(),g=w.startContainer;w.collapsed&&q.gecko&&q.gecko<1.09&&g[0].nodeType==i.e&&!g[0].childNodes.length&&g[0].appendChild(this.document.createTextNode(""));c.setStart(g[0],w.startOffset);c.setEnd(w.endContainer[0],w.endOffset);s.addRange(c)}}this.reset()},me:function(j){for(var s=[],I=this.A(),w=0;w<I.length;w++)s.push(I[w].Sc(j));return s},le:function(j,s){var I=[],w=this.document,c;s=s||this.A();for(var g=s.length,
l=0;l<g;l++){I.push(c=s[l].O(j,B));var t=(j=c.zd)?r.one("#"+c.Y,w):c.Y;c=j?r.one("#"+c.P,w):c.P;for(var n=l+1;n<g;n++){var x=s[n],O=x.startContainer,P=x.endContainer;f.g(O,t.parent())&&x.startOffset++;f.g(O,c.parent())&&x.startOffset++;f.g(P,t.parent())&&x.endOffset++;f.g(P,c.parent())&&x.endOffset++}}return I},xd:function(j){for(var s=[],I=0;I<j.length;I++){var w=new d(this.document);w.moveToBookmark(j[I]);s.push(w)}this.sb(s);return this},ua:function(){var j=this.A();return j[0].startContainer.Gb(j[j.length-
1].endContainer)},scrollIntoView:function(){var j=this.gb();j&&j.Lb()},removeAllRanges:function(){var j=this.r();if(a)j&&j.clear();else j&&j.removeAllRanges()}});var A={table:1,tbody:1,tr:1},m=b.Qa(B),D=/\ufeff|\u00a0/;d.prototype.select=d.prototype.select=!a?function(){var j=this.startContainer;this.collapsed&&j[0].nodeType==i.e&&!j[0].childNodes.length&&j[0].appendChild(this.document.createTextNode(""));var s=this.document.createRange();s.setStart(j[0],this.startOffset);try{s.setEnd(this.endContainer[0],
this.endOffset)}catch(I){if(I.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(B);s.setEnd(this.endContainer[0],this.endOffset)}else throw I;}j=v(this.document).r();j.removeAllRanges();j.addRange(s)}:function(j){var s=this.collapsed,I,w;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var c=this.startContainer[0].childNodes[this.startOffset];if(c.nodeType==i.e){(new C(this.document)).nc(new e(c));return}}if(this.startContainer[0].nodeType==i.e&&this.startContainer.d()in
A||this.endContainer[0].nodeType==i.e&&this.endContainer.d()in A)this.Oa(y.da,B);var g=this.O();c=g.Y;var l;if(!s)l=g.P;g=this.document.body.createTextRange();g.moveToElementText(c[0]);g.moveStart("character",1);if(l){j=this.document.body.createTextRange();j.moveToElementText(l[0]);g.setEndPoint("EndToEnd",j);g.moveEnd("character",-1)}else{for(I=c[0].nextSibling;I&&!m(I);)I=I.nextSibling;I=!(I&&I.nodeValue&&I.nodeValue.match(D))&&(j||!c[0].previousSibling||c[0].previousSibling&&f.d(c[0].previousSibling)==
"br");w=new e(this.document.createElement("span"));w.html("&#65279;");w.insertBefore(c);I&&f.insertBefore(this.document.createTextNode("\ufeff"),c)}this.setStartBefore(c);c.h();if(s){if(I){g.moveStart("character",-1);g.select();this.document.selection.clear()}else g.select();if(w){this.H(w,y.C);w.h()}}else{this.setEndBefore(l);l.h();g.select()}};C.getSelection=v;p.Ac=C;p.Selection=C;b=C.prototype;p.l.o(b,{getNative:b.r,getType:b.hb,getRanges:b.A,getStartElement:b.gb,getSelectedElement:b.ac,reset:b.reset,
selectElement:b.nc,selectRanges:b.sb,createBookmarks2:b.me,createBookmarks:b.le,getCommonAncestor:b.ua,scrollIntoView:b.scrollIntoView,selectBookmarks:b.xd,removeAllRanges:b.removeAllRanges});p.on("instanceCreated",function(j){J(j.qe)})});
KISSY.Editor.add("styles",function(p){function C(E,K){for(var G in E)E[G]=E[G].replace(V,function(F,H){return K[H]})}function v(E,K){if(K){E=s.clone(E);C(E.attributes,K);C(E.styles,K)}var G=this.element=this.element=(E.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.Cb:S[G]?c.Xa:c.za;this.c={definition:E}}function J(E,K){var G=K?this.mc:this.Nb;E.body.focus();for(var F=new l(E),H=F.A(),N=0;N<H.length;N++)G.call(this,H[N]);F.sb(H)}function B(E,K){var G;G=E.element;if(G=="*")G="span";
G=new O(K.createElement(G));return z(G,E)}function z(E,K){var G=K.c.definition,F=G.attributes;G=v.ad(G);if(F)for(var H in F)E.attr(H,F[H]);if(G)E[0].style.cssText=G;return E}function u(E){var K=E.O(m),G=E.ne();G.Vb=m;G.Vc=m;for(var F,H=E.document;F=G.ve();){var N=B(this,H);F=F;var M=N;N=M.d=="pre";var R=F.d=="pre",ba=!N&&R;if(N&&!R){R=F;M=M;ba=R.html();ba=r(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(M[0]);M[0].outerHTML="<pre>"+ba+"</pre>";M=new O(R.firstChild);M.h()}else M.html(ba);M=M}else if(ba)M=f(q(F),M);else F.Jb(M);F[0].parentNode.replaceChild(M[0],F[0]);if(N){F=M;N=void 0;if((N=F.fa(m,t.e))&&N.d()=="pre"){M=r(N.html(),/\n$/,"")+"\n\n"+r(F.html(),/^\n/,"");if(P.ie)F[0].outerHTML="<pre>"+M+"</pre>";else F.html(M);N.h()}}}E.moveToBookmark(K)}function r(E,K,G){var F="",H="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(N,M,R){M&&(F=M);R&&(H=R);return""});return F+E.replace(K,G)+H}function q(E){var K=[];r(E.$a(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function f(E,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<E.length;F++){var H=E[F];H=H.replace(/(\r\n|\r)/g,"\n");H=r(H,/^[ \t]*\n/,"");H=r(H,/\n$/,"");H=r(H,/^[ \t]+|[ \t]+$/g,function(M,R){return M.length==
1?"&nbsp;":R?" "+Array(M.length).join("&nbsp;"):Array(M.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(M){return Array(M.length).join("&nbsp;")+" "});var N=K.K();N.html(H);G.appendChild(N[0])}return G}function h(E){var K=E.document;if(E.collapsed){K=B(this,K);E.insertNode(K);E.H(K,g.J)}else{var G=this.element,F=this.c.definition,H,N=p.m[G]||(H=m,p.m.span),M=E.O();E.Ia(g.zb);E.trim();var R=E.O(),ba=R.Y;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=D;if(w.g($,R)){$=
j;Z=m}else{var aa=$[0].nodeType,fa=aa==t.e?$.d():j;if(fa&&$.attr("_ke_bookmark")){$=$.w(m);continue}if(!fa||N[fa]&&($.Da(R)|n.X|n.ca|n.W)==n.X+n.ca+n.W&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((p.m[ga.d()]||p.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!p.m.aa[fa]||($.Da(R)|n.X|n.ca|n.W)==n.X+n.ca+n.W)){ca=new x(K);ca.setStartBefore($)}if(aa==t.f||aa==t.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Ca(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),N[da.d()])&&(da.Da(ba)|n.ba|n.ca|n.W)==n.ba+n.ca+n.W&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=m)}}else Z=m}else Z=m;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=B(this,K);for(aa=ca.ua();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.Za()){Z=j;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());d(this,Z);ca.insertNode(Z);
Z.qa();P.ie||Z[0].normalize()}ca=j}}ba.h();R.h();E.moveToBookmark(M);E.Oa(g.yc)}}function e(E){E.Ia(g.zb);var K=E.O(),G=K.Y;if(E.collapsed){for(var F=new L(G.parent()),H,N=0,M;N<F.elements.length&&(M=F.elements[N]);N++){if(M==F.z||M==F.F)break;if(this.ia(M)){var R=E.Sb(M,g.Hd),ba=!R&&E.Sb(M,g.Wa);if(ba||R){H=M;H.match=ba?"start":"end"}else{M.qa();M.d()==this.element?a(this,M):k(M,i(this)[M.d()])}}}if(H&&H[0]){M=G;for(N=0;;N++){R=F.elements[N];if(w.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(M[0]);M=R}w[H.match=="start"?"insertBefore":"insertAfter"](M,H)}}else{var $=K.P,ca=this;F=function(){for(var Z=new L(G.parent()),aa=new L($.parent()),fa=j,ga=j,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Fb(ga);fa&&G.Fb(fa)};F();for(H=new O(G[0].nextSibling);H[0]!==$[0];){N=H.w();if(H[0]&&H[0].nodeType==t.e&&this.ia(H)){H.d()==
this.element?a(this,H):k(H,i(this)[H.d()]);if(N[0].nodeType==t.e&&N.contains(G)){F();N=new O(G[0].nextSibling)}}H=N}}E.moveToBookmark(K)}function o(E){var K={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function y(E,K){var G;if(K!==D){G=document.createElement("span");G.style.cssText=E;G=G.style.cssText||""}else G=E;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(E){if(E.c.vd)return E.c.vd;
var K=E.c.vd={},G=E.c.definition.overrides;if(G){s.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],N,M;if(typeof H=="string")N=H.toLowerCase();else{N=H.element?H.element.toLowerCase():E.element;M=H.attributes}H=K[N]||(K[N]={});if(M){H=H.attributes=H.attributes||[];for(var R in M)H.push([R.toLowerCase(),M[R]])}}}return K}function a(E,K){var G=E.c.definition,F=I.mix(G.attributes,i(E)[K.d()]);G=G.styles;var H=s.isEmptyObject(F)&&s.isEmptyObject(G),N;for(N in F)if(!((N=="class"||E.c.definition.fullMatch)&&
K.attr(N)!=b(N,F[N]))){H=H||!!K.Cc(N);K.removeAttr(N)}for(var M in G)if(!(E.c.definition.fullMatch&&K.L(M)!=b(M,G[M],m))){H=H||!!K.L(M);K.L(M,"")}A(K)}function b(E,K,G){var F=new O("<span>");F[G?"_4e_style":"attr"](E,K);return F[G?"_4e_style":"attr"](E)}function d(E,K){for(var G=i(E),F=K.all(E.element),H=F.length;--H>=0;)a(E,new O(F[H]));for(var N in G)if(N!=E.element){F=K.all(N);for(H=F.length-1;H>=0;H--){var M=new O(F[H]);k(M,G[N])}}}function k(E,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],N;if(N=E.attr(H)){var M=G[F][1];if(M===j||M.test&&M.test(N)||typeof M=="string"&&N==M)E[0].removeAttribute(H)}}A(E)}function A(E){if(!E.Za()){var K=E[0].firstChild,G=E[0].lastChild;E.h(m);if(K){K.nodeType==t.e&&w.qa(K);G&&K!=G&&G.nodeType==t.e&&w.qa(G)}}}var m=T,D=Y,j=U,s=KISSY,I=p.l,w=s.DOM,c={Cb:1,za:2,Xa:3},g=p.na,l=p.Ac,t=p.n,n=p.Ua,x=p.Range,O=s.Node,P=s.UA,L=p.Ta,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},S={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},W=/\s*(?:;\s*|$)/g,V=/#\((.+?)\)/g;p.of=c;v.prototype={apply:function(E){J.call(this,E,D)},remove:function(E){J.call(this,E,m)},Nb:function(E){return(this.Nb=this.type==c.za?h:this.type==c.Cb?u:this.type==c.Xa?j:j).call(this,E)},mc:function(E){return(this.mc=this.type==c.za?e:j).call(this,E)},ae:function(E){z(E,this)},ia:function(E,K){if(!E)return D;var G=this.c.definition;if(E.d()==this.element){if(!K&&!E.Za())return m;var F=G.Td;if(F)G=F;else{F={};var H=0,N=G.attributes;
if(N)for(var M in N){H++;F[M]=N[M]}if(N=v.ad(G)){F.style||H++;F.style=N}F._length=H;G=G.Td=F}if(G._length){for(var R in G)if(R!="_length"){H=E.attr(R)||"";if(R=="style")a:{F=G[R];H=y(H,D);typeof F=="string"&&(F=o(F));typeof H=="string"&&(H=o(H));N=void 0;for(N in F)if(!(N in H&&(H[N]==F[N]||F[N]=="inherit"||H[N]=="inherit"))){F=D;break a}F=m}else F=G[R]==H;if(F){if(!K)return m}else if(K)return D}if(K)return m}else return m}if(R=i(this)[E.d()]){if(!(G=R.attributes))return m;for(F=0;F<G.length;F++){R=
G[F][0];if(R=E.attr(R)){H=G[F][1];if(H===j||typeof H=="string"&&R==H||H.test&&H.test(R))return m}}}return D},he:function(E){switch(this.type){case c.Cb:return this.ia(E.z||E.F,m);case c.Xa:case c.za:for(var K=E.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.za&&(w.g(F,E.z)||w.g(F,E.F))))if(!(this.type==c.Xa&&!(F.d()in S)))if(this.ia(F,m))return m}}return D}};v.ad=function(E){var K=E.Ud;if(K)return K;K=E.styles;var G=E.attributes&&E.attributes.style||"",F="";if(G.length)G=G.replace(W,";");
for(var H in K){var N=K[H],M=(H+":"+N).replace(W,";");if(N=="inherit")F+=M;else G+=M}if(G.length)G=y(G);G+=F;return E.Ud=G};p.pf=v;p.Style=v;var X=v.prototype;p.l.o(X,{apply:X.apply,remove:X.remove,applyToRange:X.Nb,removeFromRange:X.mc,applyToObject:X.ae,checkElementRemovable:X.ia,checkActive:X.he})});
KISSY.Editor.add("htmlparser",function(){function p(){}function C(){this.c={ed:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var v=KISSY,J=v.Editor,B=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,z={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},u=J.m;v.augment(C,{va:p,ud:p,la:p,pd:p,Ma:p,parse:function(r){for(var q,
f,h=0,e;q=this.c.ed.exec(r);){f=q.index;if(f>h){h=r.substring(h,f);e?e.push(h):this.la(h)}h=this.c.ed.lastIndex;if(f=q[1]){f=f.toLowerCase();if(e&&u.rc[f]){this.pd(e.join(""));e=U}if(!e){this.ud(f);continue}}if(e)e.push(q[0]);else if(f=q[3]){f=f.toLowerCase();if(!/="/.test(f)){var o={},y;q=q[4];var i=!!(q&&q.charAt(q.length-1)=="/");if(q)for(;y=B.exec(q);){var a=y[1].toLowerCase();y=y[2]||y[3]||y[4]||"";o[a]=!y&&z[a]?a:y}this.va(f,o,i);if(!e&&u.rc[f])e=[]}}else if(f=q[2])this.Ma(f)}r.length>h&&this.la(r.substring(h,
r.length))}});J.j=C;J.HtmlParser=C});
KISSY.Editor.add("htmlparser-basicwriter",function(){function p(){this.c={k:[]}}var C=KISSY,v=C.Editor,J=v.l;C.augment(p,{nb:function(B){this.c.k.push("<",B)},ob:function(B,z){z?this.c.k.push(" />"):this.c.k.push(">")},cb:function(B,z){if(typeof z=="string")z=J.dc(z);this.c.k.push(" ",B,'="',z,'"')},db:function(B){this.c.k.push("</",B,">")},text:function(B){this.c.k.push(B)},N:function(B){this.c.k.push("<!--",B,"--\>")},write:function(B){this.c.k.push(B)},reset:function(){this.c.k=[];this.c.B=Y},
Zb:function(B){var z=this.c.k.join("");B&&this.reset();return z}});v.j.xb=p;v.j.BasicWriter=p;C=p.prototype;v.l.o(C,{openTag:C.nb,openTagClose:C.ob,attribute:C.cb,closeTag:C.db,text:C.text,comment:C.N,write:C.write,reset:C.reset,getHtml:C.Zb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function p(){p.superclass.constructor.call(this);this.fd="\t";this.Pe=" />";this.He="\n";this.te=z;this.Qe=B;this.c.B=z;this.c.G="";this.c.rules={};var u=v.m,r;for(r in J.mix({},u.wb,u.Ra,u.vb,u.vc))this.xa(r,{B:B,ee:B,Rb:B,Oc:!u[r]["#"],de:B});this.xa("br",{Rb:B});this.xa("title",{B:z,Rb:z});this.xa("style",{B:z,Oc:B});this.xa("pre",{B:z})}var C=KISSY,v=C.Editor,J=v.l,B=T,z=Y;C.extend(p,v.j.xb,{nb:function(u){var r=this.c.rules[u];if(this.c.B)this.G();
else if(r&&r.ee){this.Ka();this.G()}this.c.k.push("<",u)},ob:function(u,r){var q=this.c.rules[u];if(r)this.c.k.push(this.Pe);else{this.c.k.push(">");if(q&&q.B)this.c.G+=this.fd}q&&q.Rb&&this.Ka()},cb:function(u,r){if(typeof r=="string"){this.te&&(r=r.replace(/&amp;/g,"&"));r=J.dc(r)}this.c.k.push(" ",u,'="',r,'"')},db:function(u){var r=this.c.rules[u];if(r&&r.B)this.c.G=this.c.G.substr(this.fd.length);if(this.c.B)this.G();else if(r&&r.Oc){this.Ka();this.G()}this.c.k.push("</",u,">");r&&r.de&&this.Ka()},
text:function(u){if(this.c.B){this.G();u=J.La(u)}this.c.k.push(u)},N:function(u){this.c.B&&this.G();this.c.k.push("<!--",u,"--\>")},Ka:function(){this.c.k.length>0&&this.c.k.push(this.He);this.c.B=B},G:function(){this.c.k.push(this.c.G);this.c.B=z},xa:function(u,r){var q=this.c.rules[u];if(q)J.mix(q,r);else this.c.rules[u]=r}});v.j.df=p;v.j.HtmlWriter=p;C=p.prototype;v.l.o(C,{openTag:C.nb,openTagClose:C.ob,attribute:C.cb,closeTag:C.db,text:C.text,comment:C.N,lineBreak:C.Ka,indentation:C.G,setRules:C.xa})});
KISSY.Editor.add("htmlparser-fragment",function(){function p(){this.children=[];this.parent=J;this.c={R:C,cc:v}}var C=T,v=Y,J=U,B=KISSY.Editor,z={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},u=KISSY,r=B.l,q=B.n,f=B.m,h=r.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),e=f.Fd,o=f.vb;p.Ab=function(y,i){function a(g){var l;if(m.length>0)for(var t=0;t<m.length;t++){var n=m[t],x=n.name,O=f[x],P=j.name&&f[j.name];if((!P||P[x])&&(!g||!O||O[g]||!f[g])){if(!l){b();l=1}n=n.clone();
n.parent=j;j=n;m.splice(t,1);t--}}}function b(){for(;D.length;)j.add(D.shift())}function d(g,l,t){l=l||j||A;if(i&&!l.type){var n,x;if((n=g.attributes&&(x=g.attributes._ke_real_element_type)?x:g.name)&&!(n in f.qc)&&!(n in f.wb)){n=j;j=l;k.va(i,{});l=j;if(t)j=n}}if(g.c.R&&g.name!="pre"){t=g.children.length;if((n=g.children[t-1])&&n.type==q.f)if(x=r.Na(n.value))n.value=x;else g.children.length=t-1}l.add(g);if(g.qb){j=g.qb;delete g.qb}}var k=new B.j,A=new p,m=[],D=[],j=A,s=v,I;k.va=function(g,l,t){var n=
new B.j.wc(g,l);if(n.fc&&t)n.kb=C;if(f.aa[g])m.push(n);else{if(g==="pre")s=C;else if(g==="br"&&s){j.add(new B.j.Db("\n"));return}if(g==="br")D.push(n);else{var x=j.name,O=x&&(f[x]||(j.c.R?f.div:f.span));if(O&&!n.fc&&!j.fc&&!O[g]){O=v;var P;if(g in e&&x in e){x=j.children;(x=x[x.length-1])&&x.name in o||d(x=new B.j.wc("li"),j);I=j;P=x}else if(g==x)d(j,j.parent);else{if(h[x])I||(I=j);else{d(j,j.parent,C);z[x]||m.unshift(j)}O=C}j=P?P:j.qb||j.parent;if(O){k.va.apply(this,arguments);return}}a(g);b();n.parent=
j;n.qb=I;I=0;if(n.kb)d(n);else j=n}}};k.ud=function(g){for(var l=m.length-1;l>=0;l--)if(g==m[l].name){m.splice(l,1);return}for(var t=[],n=[],x=j;x.type&&x.name!=g;){x.c.R||n.unshift(x);t.push(x);x=x.parent}if(x.type){for(l=0;l<t.length;l++){var O=t[l];d(O,O.parent)}j=x;if(j.name=="pre")s=v;x.c.R&&b();d(x,x.parent);if(x==j)j=j.parent;m=m.concat(n)}if(g=="body")i=v};k.la=function(g){if(!j.c.cc&&!s){g=r.La(g);if(g.length===0)return}b();a();if(i&&(!j.type||j.name=="body")&&r.trim(g))this.va(i,{});s||
(g=g.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));j.add(new B.j.Db(g))};k.pd=function(){};k.Ma=function(g){j.add(new B.j.Gd(g))};k.parse(y);for(b();j.type;){var w=j.parent,c=j;if(i&&(!w.type||w.name=="body")&&!f.qc[c.name]){j=w;k.va(i,{});w=j}w.add(c);j=w}return A};u.augment(p,{add:function(y){var i=this.children.length;if(i=i>0&&this.children[i-1]||J){if(y.c.R&&i.type==q.f){i.value=r.Na(i.value);if(i.value.length===0){this.children.pop();this.add(y);return}}i.next=y}y.pb=i;y.parent=this;this.children.push(y);
this.c.cc=y.type==q.f||y.type==q.e&&!y.c.R},$:function(y,i){var a;this.filterChildren=this.Xb=function(){var b=new B.j.xb;this.U.call(this,b,i,C);b=b.Zb();this.children=(new p.Ab(b)).children;a=1};!this.name&&i&&i.rd(this);this.U(y,a?J:i)},U:function(y,i){for(var a=0;a<this.children.length;a++)this.children[a].$(y,i)}});B.j.ya=p;B.j.Fragment=p;p.FromHtml=p.Ab;u=p.prototype;B.l.o(u,{add:u.add,writeHtml:u.$,writeChildrenHtml:u.U})});
KISSY.Editor.add("htmlparser-element",function(){function p(z,u){z=z[0];u=u[0];return z<u?-1:z>u?1:0}function C(z,u){this.name=z;this.attributes=u||(u={});this.children=[];var r=u.sf||z,q=v.m;r=!!(q.wb[r]||q.Ra[r]||q.vb[r]||q.vc[r]||q.uc[r]||r=="br");var f=!!q.ub[z];this.kb=f;this.fc=!q[z];this.c={R:r,cc:f||!r}}var v=KISSY.Editor,J=v.n;KISSY.augment(C,{type:J.e,add:v.j.ya.prototype.add,clone:function(){return new C(this.name,this.attributes)},$:function(z,u){var r=this.attributes,q=this,f=q.name,
h,e,o,y;q.Xb=function(){if(!y){var b=new v.j.xb;v.j.ya.prototype.U.call(q,b,u);q.children=(new v.j.ya.Ab(b.Zb())).children;y=1}};q.filterChildren=q.Xb;if(u){for(;;){if(!(f=u.qd(f)))return;q.name=f;if(!(q=u.hc(q)))return;q.parent=this.parent;if(q.name==f)break;if(q.type!=J.e){q.$(z,u);return}f=q.name;if(!f){this.U.call(q,z,y?U:u);return}}r=q.attributes}z.nb(f,r);for(var i=[],a=0;a<2;a++)for(h in r){e=h;o=r[h];if(a==1)i.push([h,o]);else if(u){for(;;)if(e=u.od(h))if(e!=h){delete r[h];h=e}else break;
else{delete r[h];break}if(e)if((o=u.nd(q,e,o))===Y)delete r[e];else r[e]=o}}z.Qe&&i.sort(p);r=i.length;for(a=0;a<r;a++){h=i[a];z.cb(h[0],h[1])}z.ob(f,q.kb);if(!q.kb){this.U.call(q,z,y?U:u);z.db(f)}},U:function(){v.j.ya.prototype.U.apply(this,arguments)}});v.j.wc=C;v.j.Element=C;var B=C.prototype;v.l.o(B,{type:B.type,add:B.add,clone:B.clone,writeHtml:B.$,writeChildrenHtml:B.U})});
KISSY.Editor.add("htmlparser-filter",function(){function p(h){this.c={Ub:[],Ob:[],elements:{tc:0},attributes:{tc:0}};h&&this.Nc(h,10)}function C(h,e){for(var o=0;h&&o<e.length;o++){var y=e[o];h=h.replace(y[0],y[1])}return h}function v(h,e,o){if(typeof e=="function")e=[e];var y,i;i=h.length;var a=e&&e.length;if(a){for(y=0;y<i&&h[y].lc<o;y++);for(i=a-1;i>=0;i--)if(a=e[i]){a.lc=o;h.splice(y,0,a)}}}function J(h,e,o){if(e)for(var y in e){var i=h[y];h[y]=B(i,e[y],o);i||h.tc++}}function B(h,e,o){if(e){e.lc=
o;if(h){if(h.splice)v(h,e,o);else{h=h.lc>o?[e,h]:[h,e];h.filter=z}return h}else return e.filter=e}}function z(h){for(var e=h.type||h instanceof r.j.ya,o=0;o<this.length;o++){if(e)var y=h.type,i=h.name;var a=this[o].apply(window,arguments);if(a===f)return a;if(e){if(a&&(a.name!=i||a.type!=y))return a}else if(typeof a!="string")return a;a!=undefined&&(h=a)}return h}var u=KISSY,r=u.Editor,q=r.n,f=Y;u.augment(p,{Nc:function(h,e){if(typeof e!="number")e=10;v(this.c.Ub,h.Ub,e);v(this.c.Ob,h.Ob,e);J(this.c.elements,
h.elements,e);J(this.c.attributes,h.attributes,e);this.c.text=B(this.c.text,h.text,e)||this.c.text;this.c.N=B(this.c.N,h.N,e)||this.c.N;this.c.rb=B(this.c.rb,h.rb,e)||this.c.rb},qd:function(h){return C(h,this.c.Ub)},od:function(h){return C(h,this.c.Ob)},la:function(h){var e=this.c.text;return e?e.filter(h):h},Ma:function(h,e){var o=this.c.N;return o?o.filter(h,e):h},rd:function(h){var e=this.c.rb;return e?e.filter(h):h},hc:function(h){for(var e=[this.c.elements["^"],this.c.elements[h.name],this.c.elements.Ye],
o,y=0;y<3;y++)if(o=e[y]){o=o.filter(h,this);if(o===f)return U;if(o&&o!=h)return this.sd(o);if(h.parent&&!h.name)break}return h},sd:function(h){var e=h.type;return e==q.e?this.hc(h):e==q.f?new r.j.Db(this.la(h.value)):U},nd:function(h,e,o){if(e=this.c.attributes[e]){h=e.filter(o,h,this);if(h===f)return f;if(typeof h!="undefined")return h}return o}});r.j.cf=p;u=p.prototype;r.l.o(u,{addRules:u.Nc,onElementName:u.qd,onAttributeName:u.od,onText:u.la,onComment:u.Ma,onFragment:u.rd,onElement:u.hc,onNode:u.sd,
onAttribute:u.nd});r.j.Filter=p});KISSY.Editor.add("htmlparser-text",function(){function p(B){this.value=B;this.c={R:J}}var C=KISSY,v=C.Editor,J=Y;C.augment(p,{type:v.n.f,$:function(B,z){var u=this.value;z&&!(u=z.la(u,this))||B.text(u)}});v.j.Db=p;v.j.Text=p});
KISSY.Editor.add("htmlparser-comment",function(){function p(J){this.value=J;this.c={R:Y}}var C=KISSY.Editor,v=C.n;C.j.Gd=p;C.j.Comment=p;p.prototype={constructor:p,type:v.Id,$:function(J,B){var z=this.value;if(B){if(!(z=B.Ma(z,this)))return;if(typeof z!="string"){z.parent=this.parent;z.$(J,B);return}}J.N(z)}}});
