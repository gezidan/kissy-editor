/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-10 14:14:07
*/
var T=true,U=null,Y=false;
KISSY.add("editor",function(p,B){function v(x,i){function a(z){for(var l=v.Env.mods,D=0;D<z.length;D++){for(var k=z[D],s=u,I=0;I<D;I++)if(k==z[I]){s=y;break}I=l[k];if(s&&I){s=p.clone(I);k=k+"_"+D;s.name=k;z[D]=k;l[k]||(l[k]=s)}}}var b=this;if(!(b instanceof v))return new v(x,i);if(p.isString(x))x=p.one(x);x=A.D(x);i=i||{};i.Je=i.pluginConfig||{};b.ha=i;i.pluginConfig=i.Je;b.cfg=i;p.app(b,p.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],j=u;b.use=function(z,l){z=z.split(",");a(z);
if(!j)for(var D=0;D<d.length;D++){var k=d[D];p.inArray(k,z)||z.unshift(k)}p.use.call(b,z.join(","),function(){b.ready(function(){l&&l.call(b);if(!j){b.setData(x.val());if(i.focus)b.focus();else{var s=b.getSelection();s&&s.removeAllRanges()}b.fire("save");j=y}})},{order:y,global:v});return b};b.use=b.use;b.Ae(x);return b}function J(x){var i=p.Config.debug;x=i?i==="dev"?"../src/"+x:x:x.replace(/\.(js|css)/i,"-min.$1");x+=x.indexOf("?")!=-1?"&":"?";x+="t="+encodeURIComponent("2010-12-10 14:14:07");return x}
var A=p.DOM,y=T,u=Y;p.app(v,p.EventTarget);v.Config.base=p.Config.base+"editor/";var r=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],q,f,h,e,o={};q=0;for(f=r.length;q<f;q++){h=r[q];if(p.isString(h))h=r[q]={name:h+"",requires:U};e=h.requires||[];h.requires=e.concat(["button"])}r=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar",{name:"contextmenu"},{name:"bubbleview"},{name:"select"}].concat(r);
q=0;for(f=r.length;q<f;q++){h=r[q];e=h.name||h;o[e]={attach:u,charset:"utf-8",requires:h.requires,csspath:h.Lf?J("plugins/"+e+"/plugin.css"):B,path:J("plugins/"+e+"/plugin.js")}}v.add(o);p.Editor=v;p.Editor=v});
KISSY.Editor.add("utils",function(p){var B=U,v=KISSY,J=v.Node,A=v.DOM,y=v.UA,u=v.Event,r;if(y.ie)r=document.documentMode||y.ie;var q={Tc:function(f){var h=v.Config.debug;f=h?h==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-12-10 20:54:45");return f},Fe:function(f,h,e){var o=f[h],x=f[e];f[h]=function(){o.apply(this,arguments);f[h]=f[e];return x.apply(this,arguments)}},we:function(f,h,e,o){e=e.defaultView||e.parentWindow;f-=A.scrollLeft(e);
h-=A.scrollTop(e);if(o)if(e!=(o.defaultView||o.parentWindow)&&e.frameElement){o=A.Hb(e.frameElement,o);f+=o.left;h+=o.top}return{left:f,top:h}},Cd:function(){for(var f,h=0,e=arguments.length;h<e;h++){var o=arguments[h];try{f=o();break}catch(x){}}return f},be:function(f,h){if(!f&&!h)return T;if(!f||!h||f.length!=h.length)return Y;for(var e=0;e<f.length;e++)if(f[e]!==h[e])return Y;return T},Xc:function(f,h,e){f=f.documentElement;for(var o=0;f&&o<h.length;o++){var x=h[o];if(e)for(var i=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(e===T&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){i++;if(i==x){f=b;break}}}else f=f.childNodes[x]}return f?new J(f):B},je:function(f){for(var h in f)f[h].Bc(f,T)},dc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},La:function(f){return f.replace(/^\s+/,"")},Na:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.La(this.Na(f))},mix:function(){for(var f={},h=0;h<arguments.length;h++)f=v.mix(f,arguments[h]);
return f},jb:function(){if(!y.ie)return Y;var f=document.domain,h=window.location.hostname;return f!=h&&f!="["+h+"]"},oe:function(f,h){return Array(h+1).join(f)},Se:function(f,h,e){e=e||150;if(e===-1)return function(){f.apply(h,arguments)};var o=(new Date).getTime();return function(){var x=(new Date).getTime();if(x-o>e){o=x;f.apply(h,arguments)}}},ee:function(f,h,e){e=e||0;var o=B;return function(){o&&clearTimeout(o);var x=arguments;o=setTimeout(function(){return f.apply(h,x)},e)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(v.trim(f))},
Ue:function(f){for(var h=0;h<f.length;h++){var e=A.D(f[h]),o=v.trim(e.val()),x=e.attr("data-verify");e=e.attr("data-warning");if(x&&!RegExp(x).test(o)){alert(e);return Y}}return T},Qe:function(f,h){f.on("sourcemode",h.wf,h);f.on("wysiwygmode",h.Af,h)},Me:function(f){var h=f.attr("placeholder");if(h&&!y.webkit){f.addClass("ke-input-tip");f.val(h)}else y.webkit&&f.val("")},Mf:function(f,h){f.removeClass("ke-input-tip");f.val(h)},Ie:function(f,h){f.attr("placeholder",h);if(!y.webkit){f.on("blur",function(){if(!v.trim(f.val())){f.addClass("ke-input-tip");
f.val(h)}});f.on("focus",function(){f.removeClass("ke-input-tip");v.trim(f.val())==h&&f.val("")})}},he:function(f){f=f[0]||f;for(var h=v.makeArray(f.childNodes),e=0;e<h.length;e++){var o=h[e];o.nodeType==p.n.f&&!v.trim(o.nodeValue)&&f.removeChild(o)}},ze:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ye:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},qe:function(f,
h){return f.toLowerCase()==h.toLowerCase()},ld:function(f){f=v.clone(f);for(var h in f)if(f.hasOwnProperty(h)){var e=f[h];if(v.isFunction(e))f[h]=e()}return f},ne:function(f,h,e){function o(){var z={responseText:"",responseXML:B};z.ae=f?f.ae:B;try{var l;if((l=y.ie?i.contentWindow.document:i.contentDocument||window.frames[x].document)&&l.body)z.responseText=l.body.innerHTML;z.responseXML=l&&l.XMLDocument?l.XMLDocument:l}catch(D){v.log(D)}u.remove(i,"load",o);f.fe&&f.fe(z);setTimeout(function(){A.h(i)},
100)}var x=v.guid("form-upload-"),i=document.createElement("iframe");i.id=x;i.name=x;i.className="ke-hidden";var a="document.open();"+(q.jb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(y.ie)i.src=y.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";v.log("doFormUpload : "+i.src);document.body.appendChild(i);if(y.ie)document.frames[x].name=x;a=A.Jc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=x;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(e)a.action=e;var d;if(h){d=[];h=p.l.ld(h);for(var j in h)if(h.hasOwnProperty(j)){e=document.createElement("input");e.type="hidden";e.name=j;e.value=h[j];a.appendChild(e);d.push(e)}}u.on(i,"load",o);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(d){h=0;for(j=d.length;h<j;h++)A.h(d[h])}return i},o:function(f,h){for(var e in h)f[e]=h[e]},map:function(f,h){for(var e=0;e<f.length;e++)f[e]=
h(f[e]);return f},Ja:r,Ke:function(f){y.ie?f.Ic():f.attr("onmousedown","return false;")},Bf:function(f){f=f.attributes;return f.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(f.src||"")}};p.l=q;p.Utils=q;y.Ja=q.Ja;q.o(q,{debugUrl:q.Tc,lazyRun:q.Fe,getXY:q.we,tryThese:q.Cd,arrayCompare:q.be,getByAddress:q.Xc,clearAllMarkers:q.je,htmlEncodeAttr:q.dc,ltrim:q.La,rtrim:q.Na,trim:q.trim,mix:q.mix,isCustomDomain:q.jb,duplicateStr:q.oe,buffer:q.ee,isNumber:q.isNumber,verifyInputs:q.Ue,sourceDisable:q.Qe,
resetInput:q.Me,placeholder:q.Ie,clean:q.he,htmlEncode:q.ze,htmlDecode:q.ye,equalsIgnoreCase:q.qe,normParams:q.ld,throttle:q.Se,doFormUpload:q.ne,map:q.map})});
KISSY.Editor.add("dom",function(p){function B(a){if(a&&!a[0])return new r(a);return a}function v(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var A=KISSY,y=A.DOM,u=A.UA,r=A.Node,q=p.l,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};p.n={e:1,f:3,Hd:8,gf:11};p.NODE=p.n;p.Ua={ca:0,Id:1,ba:2,X:4,W:8,xc:16};p.POSITION=
p.Ua;var h=p.n,e=p.Ua,o={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},x={hr:1},i={D:B,Jc:v,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return Y;a=v(a);b=v(b);return a===b},pa:function(a,b){a=B(a);var d=A.mix(A.mix({},x),b||{});return o[a.css("display")]||d[a.d()]},ea:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
Y},v:function(a){a=v(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Md:function(a,b){a=v(a);var d=a.firstChild;if((d=d&&new r(d))&&b&&!b(d))d=d.Ca(b);return d},Gc:function(a,b,d){a=v(a);y.h(a);b=v(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=v(a);var b=a.nodeName.toLowerCase();if(u.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Ec:function(a,b){if(a.d()!=b.d())return Y;var d=a[0].attributes,j=b[0].attributes,z=d.length,
l=j.length;if(z!=l)return Y;for(var D=0;D<z;D++){var k=d[D],s=k.name;if(k.specified&&a.attr(s)!=b.attr(s))return Y}if(q.Ja<8)for(D=0;D<l;D++){k=j[D];s=k.name;if(k.specified&&a.attr(s)!=b.attr(s))return Y}return T},Ib:function(a){a=v(a).childNodes;for(var b=0,d=a.length;b<d;b++){var j=a[b],z=j.nodeType;if(!(z==h.e&&j.getAttribute("_ke_bookmark")))if(z==h.e&&!i.Ib(j)||z==h.f&&A.trim(j.nodeValue))return Y}return T},Jb:function(a,b,d){a=v(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},qa:function(){function a(b,d,j){if(d[0]&&d[0].nodeType==h.e){for(var z=[];d.attr("_ke_bookmark")||d.Ib();){z.push(d);d=j?new r(d[0].nextSibling):new r(d[0].previousSibling);if(!d[0]||d[0].nodeType!=h.e)return}if(b.Ec(d)){for(var l=j?b[0].lastChild:b[0].firstChild;z.length;)z.shift().Gc(b,!j);d.Jb(b,!j);d.h();l[0]&&l[0].nodeType==h.e&&l.qa()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new r(b[0].nextSibling),T);
a(b,new r(b[0].previousSibling))}}}(),Ic:u.gecko?function(a){a=v(a);a.style.MozUserSelect="none"}:u.webkit?function(a){a=v(a);a.style.df="none"}:function(a){a=v(a);if(u.ie||u.opera){var b=0;a.setAttribute("unselectable","on");for(var d=a.getElementsByTagName("*");a=d[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},Hb:function(a,b){a=v(a);var d,j=0;d=0;var z=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,
l=a.ownerDocument,D=l.documentElement;b=b||l;if(a.getBoundingClientRect){if(a!==l.body&&D!==a){d=a.getBoundingClientRect();j=d.left+(b===l?y.scrollLeft(z):0);d=d.top+(b===l?y.scrollTop(z):0)}if(b)if(z!=(b.defaultView||b.parentWindow)&&z.frameElement){z=i.Hb(z.frameElement,b);j+=z.left;d+=z.top}}return{left:j,top:d}},Od:function(a){return(a=v(a))&&a.contentWindow.document},ga:function(a,b){a=v(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=h.f)){if(u.ie&&b==a.nodeValue.length){var j=d.createTextNode("");
y.insertAfter(j,a);return new r(j)}j=new r(a.splitText(b));if(d.documentMode){d=d.createTextNode("");y.insertAfter(d,j[0]);y.h(d)}return j}},Kb:function(a,b){a=B(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=v(a);a=a.cloneNode(b);if(!d){var j=function(z){if(z.nodeType==h.e){z.removeAttribute("id");z=z.childNodes;for(var l=0;l<z.length;l++)j(z[l])}};j(a)}return new r(a)},w:function(a,b,d,j){a=v(a);if(j&&!j.call){var z=j[0]||j;j=function(D){D=D[0]||D;return D!==
z}}b=!b&&a.firstChild;var l=new r(a);if(!b){if(a.nodeType==h.e&&j&&j(a,T)===Y)return U;b=a.nextSibling}for(;!b&&(l=l.parent());){if(j&&j(l,T)===Y)return U;b=l[0].nextSibling}if(!b)return U;b=y.D(b);if(j&&j(b)===Y)return U;if(d&&d!=b[0].nodeType)return b.w(Y,d,j);return b},fa:function(a,b,d,j){a=v(a);if(j&&!j.call){var z=j[0]||j;j=function(D){D=D[0]||D;return D!==z}}b=!b&&a.lastChild;var l=new r(a);if(!b){if(a.nodeType==h.e&&j&&j(a,T)===Y)return U;b=a.previousSibling}for(;!b&&(l=l.parent());){if(j&&
j(l,T)===Y)return U;b=l[0].previousSibling}if(!b)return U;b=y.D(b);if(j&&j(b)===Y)return U;if(d&&b[0].nodeType!=d)return b.fa(Y,d,j);return b},Gb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=h.f&&b.contains(a))return b;var d=a[0].nodeType==h.f?a.parent():a;do if(d[0].nodeType!=h.f&&d.contains(b))return d;while(d=d.parent());return U},Kd:function(a,b,d){a=v(a);if(!d)a=a.parentNode;if(b&&!A.isFunction(b)){var j=b;b=function(z){return z.d()==j}}for(;a&&a.nodeType!=9;){if(!b||b(new r(a))===T)return new r(a);
a=a.parentNode}return U},Cc:q.Ja<9?function(a,b){a=v(a);var d=a.attributes[b];return!!(d&&d.specified)}:function(a,b){a=v(a);return a.hasAttribute(b)},Za:q.Ja<9?function(a){a=v(a);for(var b=a.attributes,d=0;d<b.length;d++){var j=b[d];switch(j.name){case "class":if(a.getAttribute("class"))return T;break;default:if(j.specified)return T}}return Y}:function(a){a=v(a);u.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Da:function(a,b){var d=v(a),j=v(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(j);
if(d==j)return e.ca;if(d.nodeType==h.e&&j.nodeType==h.e){if(d.contains){if(d.contains(j))return e.xc+e.X;if(j.contains(d))return e.W+e.ba}if("sourceIndex"in d)return d.sourceIndex<0||j.sourceIndex<0?e.Id:d.sourceIndex<j.sourceIndex?e.X:e.ba}d=a.Ba();j=b.Ba();for(var z=Math.min(d.length,j.length),l=0;l<=z-1;l++)if(d[l]!=j[l]){if(l<z)return d[l]<j[l]?e.X:e.ba;break}return d.length<j.length?e.xc+e.X:e.W+e.ba},Ba:function(a,b){a=v(a);for(var d=[],j=a.ownerDocument.documentElement,z=a;z&&z!=j;){var l=
z.parentNode,D=-1;if(l){for(var k=0;k<l.childNodes.length;k++){var s=l.childNodes[k];if(!(b&&s.nodeType==3&&s.previousSibling&&s.previousSibling.nodeType==3)){D++;if(s==z)break}}d.unshift(D)}z=l}return d},Fb:function(a,b){var d=new p.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var j=d.extractContents();d.insertNode(a.h());a[0].parentNode.insertBefore(j,a[0].nextSibling)},L:function(a,b,d){a=B(a);if(d!==undefined)return a.css(b,d);a=v(a);return a.style[J(b)]},h:function(a,b){var d=
v(a),j=d.parentNode;if(j){if(b)for(var z;z=d.firstChild;)j.insertBefore(d.removeChild(z),d);j.removeChild(d)}return a},ab:function(a){y.Fc(a);y.Hc(a)},Fc:function(a){a=v(a);for(var b;b=a.firstChild;){if(b.nodeType==h.f){var d=q.La(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<j){(new r(b)).ga(j-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Hc:function(a){a=v(a);for(var b;b=a.lastChild;){if(b.type==h.f){var d=q.Na(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<
j){(new r(b)).ga(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!u.ie&&!u.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Eb:function(a){a=v(a);for(var b=a.lastChild;b&&b.nodeType==h.f&&!A.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==h.f||y.d(b)!=="br"){b=u.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");u.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},ra:function(a,
b){var d=v(a),j;do j=(d=d.previousSibling)&&new r(d);while(j&&b&&!b(j));return j},Qd:function(a,b){a=y.D(a);var d=a[0].lastChild;if((d=d&&new r(d))&&b&&!b(d))d=d.ra(b);return d},Ca:function(a,b){var d=v(a),j;do j=(d=d.nextSibling)&&new r(d);while(j&&b&&!b(j));return j},$a:function(a){a=v(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},Rd:function(a,b,d,j){a=y.D(a);var z=a.data("list_marker_id")||
a.data("list_marker_id",A.guid()).data("list_marker_id"),l=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[z]=a;l[d]=1;return a.data(d,j)},Bc:function(a,b,d){a=B(a);var j=a.data("list_marker_names"),z=a.data("list_marker_id"),l;for(l in j)a.removeData(l);a.removeData("list_marker_names");if(d){a.removeData("list_marker_id");delete b[z]}},Ld:function(a,b,d){a=v(a);b=B(b);var j=a.attributes;d=d||{};for(var z=0;z<j.length;z++){var l=j[z],D=l.name.toLowerCase(),
k;if(!(D in d))if(D=="checked"&&(k=y.attr(a,D)))b.attr(D,k);else if(l.specified||u.ie&&l.value&&D=="value"){k=y.attr(a,D);if(k===U)k=l.nodeValue;b.attr(D,k)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Dc:function(a){a=y.d(a);var b=p.m;return(a=!b.uc[a]&&(b[a]||b.span))&&a["#"]},Lb:function(a){a=B(a);var b=a[0].ownerDocument,d=y.scrollLeft(b),j=y.scrollTop(b),z=a.offset(),l=z.left;z=z.top;if(y.viewportHeight(b)+j<z||z<j||y.viewportWidth(b)+d<l||l<d)a.scrollIntoView(b)},Nd:function(a,
b,d){a=v(a);if(!u.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new r(a[b]));return d}};A.DOM.Pd=function(a){A.mix(y,a);for(var b in a)a.hasOwnProperty(b)&&function(d){r.prototype[d]=function(){var j=[].slice.call(arguments,0);j.unshift(this);return a[d].apply(U,j)}}(b)};q.o(i,{_4e_wrap:i.D,_4e_unwrap:i.Jc,_4e_equals:i.g,_4e_isBlockBoundary:i.pa,_4e_getWin:i.ea,_4e_index:i.v,_4e_first:i.Md,_4e_move:i.Gc,_4e_name:i.d,_4e_isIdentical:i.Ec,_4e_isEmptyInlineRemoveable:i.Ib,
_4e_moveChildren:i.Jb,_4e_mergeSiblings:i.qa,_4e_unselectable:i.Ic,_4e_getOffset:i.Hb,_4e_getFrameDocument:i.Od,_4e_splitText:i.ga,_4e_parents:i.Kb,_4e_clone:i.K,_4e_nextSourceNode:i.w,_4e_previousSourceNode:i.fa,_4e_commonAncestor:i.Gb,_4e_ascendant:i.Kd,_4e_hasAttribute:i.Cc,_4e_hasAttributes:i.Za,_4e_position:i.Da,_4e_address:i.Ba,_4e_breakParent:i.Fb,_4e_style:i.L,_4e_remove:i.h,_4e_trim:i.ab,_4e_ltrim:i.Fc,_4e_rtrim:i.Hc,_4e_appendBogus:i.Eb,_4e_last:i.Qd,_4e_previous:i.ra,_4e_next:i.Ca,_4e_outerHtml:i.$a,
_4e_setMarker:i.Rd,_4e_clearMarkers:i.Bc,_4e_getUniqueId:i.pf,_4e_copyAttributes:i.Ld,_4e_isEditable:i.Dc,_4e_scrollIntoView:i.Lb,_4e_getElementsByTagName:i.Nd});y.Pd(i)});
KISSY.Editor.add("focusmanager",function(p){function B(){this.ec=f;r=this;J.log(this.Ea+" focus")}function v(){this.ec=h;r=e;J.log(this.Ea+" blur")}var J=KISSY,A=J.DOM,y=J.Event,u={},r,q={Ff:function(){for(var o in u){var x=u[o];x.document.designMode="off";x.document.designMode="on"}},vf:function(){return r},te:function(o){return u[o]},add:function(o){var x=A.ea(o.document);y.on(x,"focus",B,o);y.on(x,"blur",v,o)},Le:function(o){u[o.Ea]=o},remove:function(o){delete u[o.Ea];var x=A.ea(o.document);y.remove(x,
"focus",B,o);y.remove(x,"blur",v,o)}},f=T,h=Y,e=U;p.re=q;p.focusManager=q;p.$c=function(){return u};p.getInstances=p.$c});
KISSY.Editor.add("definition",function(p){var B=T,v=Y,J=p.l,A=document,y=KISSY,u=y.UA,r=y.DOM,q=y.Node,f=y.Event,h=p.re,e=J.Cd,o=J.Tc("theme/editor-iframe.css"),x=1,i="document.open();"+(J.jb()?'document.domain="'+A.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(u.ie?"javascript:void(function(){"+encodeURIComponent(i)+"}())":"")+'"  tabIndex="'+(u.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";p.zc=0;p.Ya=1;p.SOURCE_MODE=p.zc;p.WYSIWYG_MODE=p.Ya;y.augment(p,{Ae:function(b){if(u.ie)r.addClass(A.body,"ke-ie"+u.ie);else if(u.gecko)r.addClass(A.body,"ke-gecko");else u.webkit&&r.addClass(A.body,"ke-webkit");var d=this,j=new q(a.replace(/\$\(tabIndex\)/,b.attr("tabIndex")));
d.yf=j;d.Ea=x++;h.Le(d);d.tb=j.one(".ke-textarea-wrap");d.wrap=d.tb;d.ib=d.tb.one("iframe");d.iframe=d.ib;d.Bd=j.one(".ke-editor-tools");d.toolBarDiv=d.Bd;d.Z=b;d.textarea=d.Z;d.Re=j.one(".ke-editor-status");d.statusDiv=d.Re;J.Ke(d.Bd);d.Mb={};d.Kc={};var z=b.L("width"),l=b.L("height");if(z){j.css("width",z);b.css("width","100%")}d.Z.css("display","none");j.insertAfter(b);d.tb[0].appendChild(b[0]);if(l){d.tb.css("height",l);b.css("height","100%")}j=d.ib;d.on("dataReady",function(){d.Wd=B;p.fire("instanceCreated",
{pe:d})});u.gecko?j.on("load",d.Mc,d):d.Mc();d.ha.attachForm&&b[0].form&&d.Ud()},Ud:function(){(new q(this.Z[0].form)).on("submit",this.Ad,this)},Te:function(b,d){var j=this,z=p.jf;z.Cf();j.use(b,function(){var l=j.Yc(b);if(l){d(l);z.Kf()}else y.later(arguments.callee,50,Y,j)})},Zd:function(b,d){this.Kc[b]=d},Yc:function(b){return this.Kc[b]},Xd:function(b,d){this.Mb[b]=d},xe:function(b){return this.Mb[b]},execCommand:function(b){var d=this.Mb[b],j=y.makeArray(arguments);j.shift();j.unshift(this);
return d.exec.apply(d,j)},$b:function(){return this.Z.css("display")=="none"?p.Ya:p.zc},getData:function(b){var d;d=this.$b()==p.Ya?this.document.body.innerHTML:this.Z.val();if(this.htmlDataProcessor)d=b?this.htmlDataProcessor.toHtml(d,"p"):this.htmlDataProcessor.toServer(d,"p");d=y.trim(d);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(d))d="";return d},setData:function(b){var d=b;if(this.htmlDataProcessor)d=this.htmlDataProcessor.toDataFormat(b,"p");this.document.body.innerHTML=d;this.$b()!=p.Ya&&this.Z.val(b)},
Ad:function(){this.Z.val(this.getData())},Fa:function(b){b=b||0;return b+(this.ha.Fa||0)},qf:function(){return this.document.body.innerHTML},sf:function(b){this.document.body.innerHTML=b},Vd:function(b){var d=this.ha,j=d.ta,z="";if(j)for(var l=0;l<j.length;l++)z+='<link href="'+j[l]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+p.Config.base+o+"' rel='stylesheet'/><style>"+(d.Tb||"")+"</style>"+z+"</head><body class='ke-editor'>&nbsp;"+(b?'<script id="ke_actscript" type="text/javascript">'+
(J.jb()?'document.domain="'+A.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':"")+"</body></html>"},getSelection:function(){return p.Ac.getSelection(this.document)},focus:function(){var b=this.document,d=r.ea(b);u.webkit&&d&&d.parent&&d.parent.focus();u.webkit&&d&&d.focus();b&&b.body.focus();this.mb()},blur:function(){r.ea(this.document).blur();this.document&&this.document.body.blur()},Yd:function(b){var d=this.ha,j=this.document;d.Tb=d.Tb||"";d.Tb+="\n"+b;d=j.createElement("style");
j.getElementsByTagName("head")[0].appendChild(d);if(d.styleSheet)d.styleSheet.cssText=b;else d.appendChild(j.createTextNode(b))},uf:function(b){var d=this.ha,j=this.document;d.ta=d.ta||[];d.ta.push(b);d=j.createElement("link");d.rel="stylesheet";j.getElementsByTagName("head")[0].appendChild(d);d.href=b},Gf:function(b){for(var d=this.ha,j=y.makeArray(this.document.getElementsByTagName("link")),z=0;z<j.length;z++)j[z].href==b&&r.h(j[z]);d.ta=d.ta||[];d=d.ta;b=y.indexOf(b,d);b!=-1&&d.splice(b,1)},Mc:function(){function b(){D=
l.document;d.document=D;j.detach();D.open("text/html","replace");D.write(z);D.close()}var d=this,j=d.ib,z=d.Vd(d.Ea),l=j[0].contentWindow,D;try{D=l.document}catch(k){j[0].src=j[0].src;if(u.ie<7){setTimeout(b,10);return}}b()},ready:function(b){this.Wd?b():this.on("dataReady",b)},bb:function(){var b=this;b.Lc&&clearTimeout(b.Lc);b.Lc=setTimeout(function(){var d=b.getSelection();if(d&&!d.hd){var j=d.gb(),z=new p.Ta(j);if(!b.kc||!b.kc.Rc(z)){b.kc=z;b.fire("selectionChange",{selection:d,path:z,element:j})}}},
100)},mb:function(){this.kc=U;this.bb()},gd:function(b,d){var j=this,z;j.focus();setTimeout(function(){var l=b.d(),D=p.m,k=p.na,s=p.n,I=D.Ra[l],w=j.getSelection(),c=w&&w.A(),g,n,t,m;if(!c||c.length==0){var C=arguments,O=C.callee;setTimeout(function(){O.apply(j,C)},30)}else{j.fire("save");for(var P=c.length-1;P>=0;P--){g=c[P];g.deleteContents();z=!P&&b||b.K(B);d&&d(z);if(I)for(;(t=g.ua(v,B))&&(m=D[t.d()])&&!(m&&m[l]);)if(t.d()in D.span)g.pc(t);else if(g.sa()&&g.ja()){g.setStartBefore(t);g.collapse(B);
t.h()}else g.oc();g.insertNode(z);n||(n=z)}if(n){l=n.w(B);D=j.document;m=p.m;if(m.sc[z.d()]){l=new q(D.createTextNode(" "));l.insertAfter(n)}else if(l){if(l.d()=="br"&&m[l.parent().d()].p){m=new q("<p>&nbsp;</p>",U,D);l[0].parentNode.replaceChild(m[0],l[0]);l=m}}else{m=new q("<p>&nbsp;</p>",U,D);m.insertAfter(n);l=m}g.H(n,k.t);l&&l[0].nodeType==s.e&&g.lb(l);w.sb([g]);j.focus();z&&z.Lb();setTimeout(function(){j.fire("save")},10)}}},0);return z},Be:function(b){var d=this;if(d.htmlDataProcessor)b=d.htmlDataProcessor.toDataFormat(b);
if(u.webkit){var j=r.create(b,U,this.document);j=j.nodeType==11?y.makeArray(j.childNodes):[j];for(var z=0;z<j.length;z++)d.gd(new q(j[z]))}else{d.focus();setTimeout(function(){var l=d.getSelection(),D=l&&l.A();if(!D||D.length==0){var k=arguments,s=k.callee;setTimeout(function(){s.apply(d,k)},30)}else{d.fire("save");if(u.ie){l=l.r();l.type=="Control"&&l.clear();l.createRange().pasteHTML(b)}else d.document.execCommand("inserthtml",v,b);d.focus();setTimeout(function(){d.fire("save")},10)}},0)}}});p._initIFrame=
function(b){function d(c){e(function(){l.designMode="on";setTimeout(function(){l.designMode="off";k.focus();if(!arguments.callee.Ne)arguments.callee.Ne=B},50)},function(){l.designMode="off";r.attr(k,"contentEditable",v);r.attr(k,"contentEditable",B);!c&&d(1)})}var j=h.te(b);b=j.Z[0];var z=j.ib[0].contentWindow,l=j.document,D=j.ha;r.h(l.getElementById("ke_actscript"));var k=l.body;if(u.ie){k.hideFocus=B;k.disabled=B;k.contentEditable=B;k.removeAttribute("disabled")}else setTimeout(function(){if(u.gecko||
u.opera)k.contentEditable=B;else if(u.webkit)k.parentNode.contentEditable=B;else l.designMode="on"},0);if(u.webkit){f.on(l,"click",function(c){var g=new q(c.target);y.inArray(g.d(),["input","select"])&&c.preventDefault()});f.on(l,"mouseup",function(c){var g=new q(c.target);y.inArray(g.d(),["input","textarea"])&&c.preventDefault()})}if(u.gecko||u.ie||u.opera){var s;s=new q(r.insertAfter((new q('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],b));s.on("focus",
function(){j.focus()});j.tf=function(){u.gecko&&j.ec&&s[0].focus()};j.on("destroy",function(){})}if(u.ie&&l.compatMode=="CSS1Compat"||u.gecko||u.opera){var I=new q(l.documentElement);I.on("mousedown",function(c){if((new q(c.target))[0]==I[0]){u.gecko&&d(v);s[0].focus()}})}f.on(z,"focus",function(){if(u.gecko)d(v);else u.opera&&k.focus();j.mb()});u.gecko&&f.on(j.document,"mousedown",function(){j.ec||d(v)});if(u.ie){f.on(l,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var g=j.getSelection(),n=g.ac();
if(n){j.fire("save");var t=g.A()[0].O();n.h();g.wd([t]);j.fire("save");c.preventDefault()}}});if(l.compatMode=="CSS1Compat"){var w={33:1,34:1};f.on(l,"keydown",function(c){c.keyCode in w&&setTimeout(function(){j.getSelection().scrollIntoView()},0)})}}setTimeout(function(){u.ie&&setTimeout(function(){if(l){k.runtimeStyle.marginBottom="0px";k.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){j.fire("dataReady");var c=D.disableObjectResizing,g=D.disableInlineTableEditing;if(c||g)try{l.execCommand("enableObjectResizing",
v,!c);l.execCommand("enableInlineTableEditing",v,!g)}catch(n){f.on(k,u.ie?"resizestart":"resize",function(t){var m=new q(t.target);if(c||m.d()==="table"&&g)t.preventDefault()})}},10);u.webkit&&f.on(l,"mousedown",function(c){c=new q(c.target);y.inArray(c.d(),["img","hr","input","textarea","select"])&&j.getSelection().nc(c)});u.gecko&&f.on(l,"dragstart",function(c){var g=new q(c.target);g.d()==="img"&&/ke_/.test(g[0].className)&&c.preventDefault()});h.add(j)};i=p.prototype;J.o(i,{setData:i.setData,
getData:i.getData,insertElement:i.gd,insertHtml:i.Be,ready:i.ready,addCustomStyle:i.Yd,addCommand:i.Xd,hasCommand:i.xe,execCommand:i.execCommand,useDialog:i.Te,addDialog:i.Zd,getDialog:i.Yc,getMode:i.$b,sync:i.Ad,baseZIndex:i.Fa,getSelection:i.getSelection,focus:i.focus,blur:i.blur,notifySelectionChange:i.mb})});
KISSY.Editor.add("zindex",function(){var p=KISSY.Editor;if(!p.Dd){p.Dd={$e:1100,kf:1200,af:99999,ff:900,hf:9999,LOADING:11E3,ef:12E3,lf:1200};p.Fa=function(B){var v=B,J=p.$c(),A;for(A in J){if(!J.hasOwnProperty(A))return;v=Math.max(v,J[A].Fa(B))}return v};p.baseZIndex=p.Fa;p.zIndexManager=p.Dd}});
KISSY.Editor.add("dtd",function(p){p.m=function(){function B(D){for(var k=arguments.length-1;k>0;)KISSY.mix(D,arguments[k--]);return D}var v={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},A=B({a:1},J),y=B({iframe:1},A),u={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},r={ins:1,del:1,script:1,style:1},q=B({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},r),f=B({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},q),h=B({p:1},f);J=B({iframe:1},f,J);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=B({a:1},J),o={tr:1},x={"#":1},i=B({param:1},f),a=B({form:1},v,y,u,h),b={li:1},d={base:1,link:1,meta:1,title:1},j=B(d,{style:1,script:1}),z={head:1,body:1},l={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{wb:B({html:1},z,d),Ra:l,Ye:{body:1,div:1,td:1,th:1,caption:1,
form:1},sc:e,qc:B({script:1,style:1},l),rc:{script:1,style:1},ub:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},vb:{dd:1,dt:1,li:1},Ed:{ul:1,ol:1,dl:1},uc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},aa:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},Ze:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},vc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:z,head:j,style:x,body:a,base:{},link:{},meta:{},title:x,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:B(h,u),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:b,h1:e,h3:e,option:x,h2:e,form:B(v,y,u,h),select:{optgroup:1,option:1},font:e,ins:e,menu:b,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:x,tfoot:o,cite:e,li:a,input:{},iframe:a,
strong:e,textarea:x,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:i,sup:e,dd:a,strike:e,area:{},dir:b,map:B({area:1,form:1,p:1},v,r,u),applet:i,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:B({legend:1},f),thead:o,ul:b,acronym:e,b:e,a:J,blockquote:a,caption:e,i:e,u:e,tbody:o,s:e,address:B(y,h),tt:e,legend:e,q:e,pre:B(q,A),p:e,em:e,dfn:e}}();p.XHTML_DTD=p.m});
KISSY.Editor.add("elementpath",function(p){function B(f){var h=y,e=y,o=[];for(f=f;f&&f[0];){if(f[0].nodeType==A.e){if(!this.Ee)this.Ee=f;var x=f.d();if(!e){if(!h&&u[x])h=f;if(r[x]){var i;if(i=!h){if(i=x=="div"){a:{i=f;i=i[0]||i;i=i.childNodes;for(var a=0,b=i.length;a<b;a++){var d=i[a];if(d.nodeType==A.e&&J.Ra[d.nodeName.toLowerCase()]){i=T;break a}}i=Y}i=!i}i=i}if(i)h=f;else e=f}}o.push(f);if(x=="body")break}f=f.parent()}this.block=this.z=h;this.blockLimit=this.F=e;this.elements=this.elements=o}var v=
KISSY.DOM,J=p.m,A=p.n,y=U,u={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},r={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};B.prototype={Rc:function(f){var h=this.elements;f=f&&f.elements;if(!f||h.length!=f.length)return Y;for(var e=0;e<h.length;e++)if(!v.g(h[e],f[e]))return Y;return T},contains:function(f){for(var h=this.elements,e=0;e<h.length;e++)if(h[e].d()in f)return h[e];return y}};p.ElementPath=p.Ta=B;var q=B.prototype;p.l.o(q,{compare:q.Rc,
contains:q.contains})});
KISSY.Editor.add("walker",function(p){function B(o,x){if(this.c.end)return u;var i,a=this.wa,b,d=this.bc,j=this.type,z=o?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return u}}if(!o&&!this.c.bd){var l=a.endContainer,D=new h(l[0].childNodes[a.endOffset]);this.c.bd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!f.g(l,w))&&(!D[0]||!w.g(D))&&(w[0].nodeType!=q.e||!c||w.d()!="body")}}if(o&&!this.c.cd){var k=a.startContainer,s=a.startOffset>
0&&new h(k[0].childNodes[a.startOffset-1]);this.c.cd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!w.g(k))&&(!s[0]||!w.g(s))&&(w[0].nodeType!=q.e||!c||w.d()!="body")}}var I=o?this.c.cd:this.c.bd;b=d?function(w,c){if(I(w,c)===y)return y;return d(w,c)}:I;if(this.eb)i=this.eb[z](y,j,b);else if(o){i=a.endContainer;if(a.endOffset>0){i=new h(i[0].childNodes[a.endOffset-1]);if(b(i)===y)i=u}else i=b(i,A)===y?u:i.fa(A,j,b)}else{i=a.startContainer;if((i=new h(i[0].childNodes[a.startOffset]))&&i[0]){if(b(i)===
y)i=u}else i=b(a.startContainer,A)===y?u:a.startContainer.w(A,j,b)}for(;i&&i[0]&&!this.c.end;){this.eb=i;if(!this.Q||this.Q(i)!==y){if(!x)return i}else if(x&&this.Q)return y;i=i[z](y,j,b)}this.end();return this.eb=u}function v(o){for(var x,i=u;x=B.call(this,o);)i=x;return i}function J(o){this.wa=o;this.c={}}var A=T,y=Y,u=U,r=KISSY,q=p.n,f=r.DOM,h=r.Node;r.augment(J,{end:function(){this.c.end=1},next:function(){return B.call(this)},pb:function(){return B.call(this,A)},Qc:function(){return B.call(this,
y,A)!==y},Pc:function(){return B.call(this,A,A)!==y},kd:function(){return v.call(this)},jd:function(){return v.call(this,A)},reset:function(){delete this.eb;this.c={}}});J.Pb=function(o){return function(x){x=f.D(x);return!(x&&x[0].nodeType==q.e&&x.pa(o))}};J.He=function(){return this.Pb({Qb:1})};J.Ga=function(o,x){function i(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,d;b=a&&a[0]&&a[0].nodeType==q.f&&(d=a.parent())&&i(d);b=o?b:b||i(a);return x^b}};J.Qa=function(o){return function(x){x=
(x=x[0]||x)&&x.nodeType==q.f&&!r.trim(x.nodeValue);return o^x}};J.Ce=function(o){var x=J.Qa();return function(i){i=x(i)||i[0].nodeType==q.e&&!i[0].offsetHeight;return o^i}};p.Aa=J;p.Walker=J;var e=J.prototype;p.l.o(e,{end:e.end,next:e.next,previous:e.pb,checkForward:e.Qc,checkBackward:e.Pc,lastForward:e.kd,lastBackward:e.jd,reset:e.reset});p.l.o(J,{blockBoundary:J.Pb,listItemBoundary:J.He,bookmark:J.Ga,whitespaces:J.Qa,invisible:J.Ce})});
KISSY.Editor.add("range",function(p){function B(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=r;this.document=c}function v(c){var g=c[0].nodeType!=e.f&&c.d()in j.aa,n=!h.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return g||n||c}function J(c){return!s(c)&&!I(c)}function A(c){var g=q,n=i.Ga(r);return function(t){if(n(t))return r;if(t[0].nodeType==e.f){if(h.trim(t[0].nodeValue).length)return q}else if(t[0].nodeType==e.e)if(!k[t.d()])if(!c&&!d.ie&&
t.d()=="br"&&!g)g=r;else return q;return r}}function y(c,g){function n(t){return t&&t.nodeName=="span"&&t.getAttribute("_ke_bookmark")}return function(t){var m,C;m=t&&!t.nodeName&&(C=t.parentNode)&&n(C);m=c?m:m||n(t);return g^m}}function u(c){return function(g){g=(g=g[0]||g)&&g.nodeType==e.f&&!h.trim(g.nodeValue);return c^g}}p.na={V:1,J:2,C:3,t:4,zb:1,yb:2,Sa:3,Wa:1,Gd:2,mf:3,da:1,yc:2};p.RANGE=p.na;var r=T,q=Y,f=U,h=KISSY,e=p.n,o=p.na,x=p.Ua,i=p.Aa,a=h.DOM,b=p.l.Xc,d=h.UA,j=p.m,z=p.Ta,l=h.Node,D=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};B.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};h.augment(B,{Pa:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},ic:function(){var c=this.startContainer,
g=this.startOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;g=this.endOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},jc:function(){var c=
this.startContainer,g=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.T(c,o.C);g&&g.d()=="span"&&g.attr("_ke_bookmark")&&this.S(g,o.t)},setStart:function(c,g){if(c[0].nodeType==e.e&&D[c.d()]){c=c.parent();g=c.v()}this.startContainer=c;this.startOffset=g;if(!this.endContainer){this.endContainer=c;this.endOffset=g}this.Pa()},setEnd:function(c,g){if(c[0].nodeType==e.e&&D[c.d()]){c=c.parent();g=c.v()+1}this.endContainer=c;this.endOffset=g;if(!this.startContainer){this.startContainer=
c;this.startOffset=g}this.Pa()},T:function(c,g){switch(g){case o.V:this.setStart(c,0);break;case o.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case o.C:this.setStartBefore(c);break;case o.t:this.setStartAfter(c)}this.Pa()},S:function(c,g){switch(g){case o.V:this.setEnd(c,0);break;case o.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case o.C:this.setEndBefore(c);break;case o.t:this.setEndAfter(c)}this.Pa()},
Wb:function(c,g){var n=this.startContainer,t=this.endContainer,m=this.startOffset,C=this.endOffset,O,P=this.document,N;this.jc();if(t[0].nodeType==e.f)t=t.ga(C);else if(t[0].childNodes.length>0)if(C>=t[0].childNodes.length){t=new l(t[0].appendChild(P.createTextNode("")));N=r}else t=new l(t[0].childNodes[C]);if(n[0].nodeType==e.f){n.ga(m);if(n.g(t))t=new l(n[0].nextSibling)}else if(m)if(m>=n[0].childNodes.length){O=new l(P.createTextNode(""));n.append(O);n=O;O=r}else n=new l(n[0].childNodes[m].previousSibling);
else{O=new l(P.createTextNode(""));n.prepend(O);n=O;O=r}m=n.Kb();C=t.Kb();var Q,S,W;for(Q=0;Q<m.length;Q++){S=m[Q];W=C[Q];if(!S.g(W))break}P=g;for(var V,X,E,K=Q;K<m.length;K++){V=m[K];X=P&&!V.g(n)?P.appendChild(V.K()[0]):U;for(V=V[0].nextSibling;V;){if(a.g(C[K],V)||a.g(t,V))break;E=V.nextSibling;if(c==2)P.appendChild(V.cloneNode(r));else{a.h(V);c==1&&P.appendChild(V)}V=E}if(X)P=X}P=g;for(Q=Q;Q<C.length;Q++){V=C[Q];X=P&&c>0&&!V.g(t)?P.appendChild(V.K()[0]):U;if(!m[Q]||!V.parent().g(m[Q].parent()))for(V=
V[0].previousSibling;V;){if(a.g(m[Q],V)||a.g(n,V))break;E=V.previousSibling;if(c==2)P.insertBefore(V.cloneNode(r),P.firstChild);else{a.h(V);c==1&&P.insertBefore(V,P.firstChild)}V=E}if(X)P=X}if(c==2){W=this.startContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}W=this.endContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}}else{if(S&&
W&&(!n.parent().g(S.parent())||!t.parent().g(W.parent()))){S=W.v();O&&W.parent().g(n.parent())&&S--;this.setStart(W.parent(),S)}this.collapse(r)}O&&n.h();N&&t[0].parentNode&&t.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=r},clone:function(){var c=new B(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},Zc:function(){var c=this.clone();c.ic();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return f;var g=new p.Aa(c),n=y(r,undefined),t=u(r);c.Q=function(m){return t(m)&&n(m)};c=g.next();g.reset();g=g.pb();return c&&c.g(g)?c:f},Oa:function(c,g){if(!this.collapsed){c=c||o.yc;var n=this.clone(),t=this.startContainer,m=this.endContainer,C=this.startOffset,O=this.endOffset,P=1,N=1;if(t&&t[0].nodeType==e.f)if(C)if(C>=t[0].nodeValue.length)n.setStartAfter(t);
else{n.setStartBefore(t);P=0}else n.setStartBefore(t);if(m&&m[0].nodeType==e.f)if(O)if(O>=m[0].nodeValue.length)n.setEndAfter(m);else{n.setEndAfter(m);N=0}else n.setEndBefore(m);n=new i(n);n.Q=function(S){S=S[0]||S;return S.nodeType==(c==o.da?e.e:e.f)};var Q;n.bc=function(S,W){S=S[0]||S;if(c==o.da&&S.nodeType==e.f)return q;if(W&&S==Q)return q;if(!W&&S.nodeType==e.e)Q=S;return r};if(P)(t=n[c==o.da?"lastForward":"next"]())&&this.T(t,g?o.V:o.C);if(N){n.reset();(n=n[c==o.da?"lastBackward":"previous"]())&&
this.S(n,g?o.J:o.t)}return!!(P||N)}},ve:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Sc:function(c){var g=this.startContainer,n=this.endContainer,t=this.startOffset,m=this.endOffset,C,O;if(!g||!n)return{start:0,end:0};if(c){if(g[0].nodeType==e.e)if((C=new l(g[0].childNodes[t]))&&C[0]&&C[0].nodeType==e.f&&t>0&&C[0].previousSibling.nodeType==e.f){g=C;t=0}for(;g[0].nodeType==e.f&&(O=g.ra())&&O[0].nodeType==e.f;){g=O;t+=
O[0].nodeValue.length}if(!this.collapsed){if(n[0].nodeType==e.e)if((C=new l(n[0].childNodes[m]))&&C[0]&&C[0].nodeType==e.f&&m>0&&C[0].previousSibling.nodeType==e.f){n=C;m=0}for(;n[0].nodeType==e.f&&(O=n.ra())&&O[0].nodeType==e.f;){n=O;m+=O[0].nodeValue.length}}}return{start:g.Ba(c),end:this.collapsed?f:n.Ba(c),startOffset:t,endOffset:m,md:c,De:r}},O:function(c){var g,n,t,m,C=this.collapsed;g=new l("<span>",f,this.document);g.attr("_ke_bookmark",1);g.css("display","none");g.html("&nbsp;");if(c){t=
h.guid("ke_bm_");g.attr("id",t+"S")}if(!C){n=g.K();n.html("&nbsp;");c&&n.attr("id",t+"E");m=this.clone();m.collapse();m.insertNode(n)}m=this.clone();m.collapse(r);m.insertNode(g);if(n){this.setStartAfter(g);this.setEndBefore(n)}else this.H(g,o.t);return{Y:c?t+"S":g,P:c?t+"E":n,yd:c,collapsed:C}},H:function(c,g){this.T(c,g);this.collapse(r)},trim:function(c,g){var n=this.startContainer,t=this.startOffset,m=this.collapsed;if((!c||m)&&n[0]&&n[0].nodeType==e.f){if(t)if(t>=n[0].nodeValue.length){t=n.v()+
1;n=n.parent()}else{var C=n.ga(t);t=n.v()+1;n=n.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(a.g(n,this.endContainer))this.endOffset+=1}else{t=n.v();n=n.parent()}this.setStart(n,t);if(m){this.collapse(r);return}}n=this.endContainer;t=this.endOffset;if(!(g||m)&&n[0]&&n[0].nodeType==e.f){if(t){t>=n.nodeValue.length||n.ga(t);t=n.v()+1}else t=n.v();n=n.parent();this.setEnd(n,t)}},insertNode:function(c){this.jc();this.trim(q,r);var g=this.startContainer;
g[0].insertBefore(c[0]||c,g[0].childNodes[this.startOffset]||U);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.De){var g=b(this.document,c.start,c.md),n=c.startOffset,t=c.end&&b(this.document,c.end,c.md);c=c.endOffset;this.setStart(g,n);t?this.setEnd(t,c):this.collapse(r)}else{g=(n=c.yd)?h.one("#"+c.Y,this.document):c.Y;c=n?h.one("#"+c.P,this.document):c.P;this.setStartBefore(g);g.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(r)}},
ua:function(c,g){var n=this.startContainer,t=this.endContainer;n=a.g(n,t)?c&&n[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new l(n[0].childNodes[this.startOffset]):n:n.Gb(t);return g&&n[0].nodeType==e.f?n.parent():n},Ia:function(c){switch(c){case o.zb:if(this.collapsed)break;c=this.ua();var g=new l(this.document.body),n,t,m,C,O,P=q,N,Q;N=this.startContainer;Q=this.startOffset;if(N[0].nodeType==e.f){if(Q){N=!h.trim(N[0].nodeValue.substring(0,Q)).length&&N;P=!!N}if(N)if(!(C=N[0].previousSibling))m=
N.parent()}else{if(Q)C=N[0].childNodes[Q-1]||N[0].lastChild;C||(m=N)}for(;m||C;){if(m&&!C){if(!O&&a.g(m,c))O=r;if(!g.contains(m))break;if(!P||m.css("display")!="inline"){P=q;if(O)n=m;else this.setStartBefore(m)}C=m[0].previousSibling}for(;C;){N=q;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;N=/[\s\ufeff]$/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(P&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else for(var S=C.all||C.getElementsByTagName("*"),
W=0,V;V=S[W++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}if(C)N=!!Q.length}else C=f;if(N)if(P)if(O)n=m;else m&&this.setStartBefore(m);else P=r;if(C){N=C.previousSibling;if(!m&&!N){m=new l(C);C=f;break}C=N}else m=f}if(m)m=m.parent()}N=this.endContainer;Q=this.endOffset;m=C=f;O=P=q;if(N[0].nodeType==e.f){N=!h.trim(N[0].nodeValue.substring(Q)).length&&N;P=!(N&&N[0].nodeValue.length);if(N)if(!(C=N[0].nextSibling))m=N.parent()}else(C=N[0].childNodes[Q])||(m=N);for(;m||C;){if(m&&!C){if(!O&&a.g(m,c))O=
r;if(!g.contains(m))break;if(!P||m.css("display")!="inline"){P=q;if(O)t=m;else m&&this.setEndAfter(m)}C=m[0].nextSibling}for(;C;){N=q;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;N=/^[\s\ufeff]/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(P&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else{S=C.all||C.getElementsByTagName("*");for(W=0;V=S[W++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}}if(C)N=!!Q.length}else C=f;if(N)if(P)if(O)t=
m;else this.setEndAfter(m);if(C){N=C.nextSibling;if(!m&&!N){m=new l(C);C=f;break}C=N}else m=f}if(m)m=m.parent()}if(n&&t){c=n.contains(t)?t:n;this.setStartBefore(c);this.setEndAfter(c)}break;case o.yb:case o.Sa:m=new B(this.document);g=new l(this.document.body);m.T(g,o.V);m.setEnd(this.startContainer,this.startOffset);m=new i(m);var X,E,K=i.Pb(c==o.Sa?{Qb:1}:f),G=function(F){var H=K(F);H||(X=F);return H};n=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")E=F;return H};m.bc=G;m=m.jd();X=X||g;this.T(X,
X.d()!="br"&&(!m&&this.sa()||m&&X.contains(m))?o.V:o.t);m=this.clone();m.collapse();m.S(g,o.J);m=new i(m);m.bc=c==o.Sa?n:G;X=f;m=m.kd();X=X||g;this.S(X,!m&&this.ja()||m&&X.contains(m)?o.J:o.C);E&&this.setEndAfter(E)}},sa:function(){var c=this.startContainer,g=this.startOffset;if(g&&c[0].nodeType==e.f)if(h.trim(c[0].nodeValue.substring(0,g)).length)return q;this.trim();c=new z(this.startContainer);g=this.clone();g.collapse(r);g.T(c.z||c.F,o.V);c=new i(g);c.Q=A(r);return c.Pc()},ja:function(){var c=
this.endContainer,g=this.endOffset;if(c[0].nodeType==e.f)if(h.trim(c[0].nodeValue.substring(g)).length)return q;this.trim();c=new z(this.endContainer);g=this.clone();g.collapse(q);g.S(c.z||c.F,o.J);c=new i(g);c.Q=A(q);return c.Qc()},deleteContents:function(){this.collapsed||this.Wb(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Wb(1,c);return c},Sb:function(c,g){var n=this.clone();n[g==o.Wa?"setStartAt":"setEndAt"](c,g==o.Wa?o.V:o.J);n=new i(n);n.Q=
v;return n[g==o.Wa?"checkBackward":"checkForward"]()},Wc:function(){var c=this.startContainer,g=this.endContainer,n=this.startOffset,t=this.endOffset,m;if(c[0].nodeType==e.e){m=c[0].childNodes.length;if(m>n)c=new l(c[0].childNodes[n]);else if(m<1)c=c.fa();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new l(c);c=c.w()||c}}if(g[0].nodeType==e.e){m=g[0].childNodes.length;if(m>t)g=(new l(g[0].childNodes[t])).fa(r);else if(m<1)g=g.fa();else{for(g=g[0];g.lastChild;)g=g.lastChild;g=new l(g)}}if(c.Da(g)&x.ba)c=
g;return{Y:c,P:g}},fb:function(c,g){var n=this.O(),t=new l(this.document.createElement(g));this.collapse(c);this.Ia(o.yb);t[0].appendChild(this.extractContents());t.ab();d.ie||t.Eb();this.insertNode(t);this.moveToBookmark(n);return t},oc:function(c){var g=new z(this.startContainer),n=new z(this.endContainer),t=g.z,m=n.z,C=f;if(!g.F.g(n.F))return f;if(c!="br"){if(!t){t=this.fb(r,c);m=(new z(this.endContainer)).z}m||(m=this.fb(q,c))}c=t&&this.sa();g=m&&this.ja();this.deleteContents();if(t&&a.g(t,m))if(g){C=
new z(this.startContainer);this.H(m,o.t);m=f}else if(c){C=new z(this.startContainer);this.H(t,o.C);t=f}else{m=this.pc(t);!d.ie&&!h.inArray(t.d(),["ul","ol"])&&t.Eb()}return{Ef:t,Df:m,We:c,Ve:g,zf:C}},pc:function(c){if(!this.collapsed)return f;this.S(c,o.J);var g=this.extractContents(),n=c.K(q);n[0].appendChild(g);n.insertAfter(c);this.H(c,o.t);return n},lb:function(c,g){var n,t=p.m;if(t.ub[c.d()])return q;for(;c&&c[0].nodeType==e.e;){if(n=c.Dc())this.H(c,g?o.J:o.V);else if(t.sc[c.d()]){this.H(c,g?
o.t:o.C);return r}if((c=t.ub[c.d()]?c[g?"_4e_previous":"_4e_next"](J):c[g?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,g?o.t:o.C);return r}}return n},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var k={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},s=new i.Qa,I=new i.Ga;p.Range=
B;p.Range=B;var w=B.prototype;p.l.o(w,{updateCollapsed:w.Pa,optimize:w.ic,setStartAfter:w.setStartAfter,setEndAfter:w.setEndAfter,setStartBefore:w.setStartBefore,setEndBefore:w.setEndBefore,optimizeBookmark:w.jc,setStart:w.setStart,setEnd:w.setEnd,setStartAt:w.T,setEndAt:w.S,execContentsAction:w.Wb,collapse:w.collapse,clone:w.clone,getEnclosedNode:w.Zc,shrink:w.Oa,getTouchedStartNode:w.ve,createBookmark2:w.Sc,createBookmark:w.O,moveToPosition:w.H,trim:w.trim,insertNode:w.insertNode,moveToBookmark:w.moveToBookmark,
getCommonAncestor:w.ua,enlarge:w.Ia,checkStartOfBlock:w.sa,checkEndOfBlock:w.ja,deleteContents:w.deleteContents,extractContents:w.extractContents,checkBoundaryOfElement:w.Sb,getBoundaryNodes:w.Wc,fixBlock:w.fb,splitBlock:w.oc,splitElement:w.pc,moveToElementEditablePosition:w.lb,selectNodeContents:w.selectNodeContents})});
KISSY.Editor.add("domiterator",function(p){function B(i){if(!(arguments.length<1)){this.wa=i;this.Yb=J;this.Vc=v;this.Vb=J;this.c||(this.c={})}}var v=T,J=Y,A=KISSY,y=A.UA,u=p.Aa,r=p.Range,q=p.na,f=p.n,h=p.Ta,e=A.Node,o=A.DOM,x=/^[\r\n\t ]*$/;A.augment(B,{ue:function(i){var a,b,d,j,z;if(!this.c.I){b=this.wa.clone();b.Oa(q.da,v);b.Ia(this.Yb||!this.Vc?q.Sa:q.yb);var l=new u(b),D=u.Ga(v,v);l.Q=D;this.c.ka=l.next();l=new u(b);l.Q=D;l=l.pb();this.c.I=l.w(v);if(this.c.I&&this.c.I[0].nodeType==f.f&&!A.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().pa()){D=new r(b.document);D.H(this.c.I,q.t);if(D.ja()){D=new h(D.endContainer);this.c.I=(D.z||D.F).w(v)}}if(!this.c.I){this.c.I=this.c.Uc=new e(b.document.createTextNode(""));o.insertAfter(this.c.I[0],l[0])}b=U}D=this.c.ka;l=this.c.I;for(this.c.ka=U;D;){var k=J,s=D[0].nodeType!=f.e,I=J;if(s){if(D[0].nodeType==f.f)if(x.test(D[0].nodeValue))s=J}else{var w=D.d();if(D.pa(this.Yb&&{Qb:1})){if(w=="br")s=v;else if(!b&&!D[0].childNodes.length&&w!="hr"){a=D;d=D.g(l);break}if(b){b.S(D,q.C);
if(w!="br")this.c.ka=D}k=v}else{if(D[0].firstChild){if(!b){b=new r(this.wa.document);b.T(D,q.C)}D=new e(D[0].firstChild);continue}s=v}}if(s&&!b){b=new r(this.wa.document);b.T(D,q.C)}d=(!k||s)&&D.g(l);if(b&&!k)for(;!D[0].nextSibling&&!d;){w=D.parent();if(w.pa(this.Yb&&{Qb:1})){k=v;d||w.g(l);break}D=w;s=v;d=D.g(l);I=v}s&&b.S(D,q.t);D=D.w(I,U,l);if((d=!D)||k&&b)break}if(!a){if(!b){this.c.Uc&&this.c.Uc.h();return this.c.ka=U}a=new h(b.startContainer);D=a.F;k={xf:1,Jf:1,If:1};a=a.z;if((!a||!a[0])&&!this.Vb&&
k[D.d()]&&b.sa()&&b.ja())a=D;else if(!a||this.Vb&&a.d()=="li"){a=new e(this.wa.document.createElement(i||"p"));a[0].appendChild(b.extractContents());a.ab();b.insertNode(a);j=z=v}else if(a.d()!="li"){if(!b.sa()||!b.ja()){a=a.K(J);a[0].appendChild(b.extractContents());a.ab();z=b.oc();j=!z.We;z=!z.Ve;b.insertNode(a)}}else if(!d)this.c.ka=a.g(l)?U:b.Wc().P.w(v,U,l)}if(j){b=new e(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&o.d(b[0].lastChild)=="br"&&o.h(b[0].lastChild)}if(z){b=
u.Ga(J,v);j=new e(a[0].lastChild);if(j[0]&&j[0].nodeType==f.e&&j.d()=="br")if(y.ie||j.ra(b)||j.Ca(b))j.h()}if(!this.c.ka)this.c.ka=d||a.g(l)?U:a.w(v,U,l);return a}});r.prototype.me=function(){return new B(this)}});
KISSY.Editor.add("selection",function(p){function B(k){this.document=this.document=k;this.c={M:{}};if(a){var s=this.r().createRange();if(!s||s.item&&s.item(0).ownerDocument!=k||s.parentElement&&s.parentElement().ownerDocument!=k)this.hd=A}}function v(k){k=new B(k);return!k||k.hd?u:k}function J(k){var s=k.document,I=new e(s.body),w=new e(s.documentElement);if(q.ie){if(q.ie<8||document.documentMode==7)w.on("click",function(N){(new e(N.target)).d()==="html"&&k.getSelection().A()[0].select()});var c,
g,n=1;w.on("mousedown",function(){n=0});w.on("mouseup",function(){n=1});I.on("focusin",function(N){if((new e(N.target)).d()=="body")if(c){try{n&&c.select()}catch(Q){}c=u}});I.on("focus",function(){g=A;m()});I.on("beforedeactivate",function(N){if(!N.relatedTarget){g=y;n=1}});h.on(f.ea(s),"blur",function(){s&&s.selection.empty()});I.on("mousedown",function(){t()});I.on("mouseup",function(){g=A;setTimeout(function(){m(A)},0)});var t=function(){g=y},m=function(N){if(g){var Q=k.document,S=k.getSelection(),
W=S&&S.hb(),V=S&&S.r();if(N&&V&&W==o.Bb)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){m(A)},50);return}var X;if(!(V&&W==o.oa&&(X=f.d(S.gb()))&&X in{input:1,textarea:1})){c=V&&S.A()[0];k.bb()}}};I.on("keydown",t);I.on("keyup",function(){g=A;m()});h.on(s,"selectionchange",m)}else{h.on(s,"mouseup",k.bb,k);h.on(s,"keyup",k.bb,k)}var C={table:1,pre:1},O=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,P=p.Aa.Qa(A);k.on("selectionChange",
function(N){var Q=N.path;N=(N=N.selection)&&N.A()[0];if(!(!N||!N.collapsed||Q.z))if(Q.F.d()=="body"){Q=N.fb(A,"p");if(Q.$a().match(O)){var S=Q.Ca(P);if(S&&S[0].nodeType==i.e&&!C[S.d()]){N.lb(S);Q.h()}else if((S=Q.ra(P))&&S[0].nodeType==i.e&&!C[S.d()]){N.lb(S,S.$a().match(O)?y:A);Q.h()}}N.select();a||k.mb()}})}p.Jd={Bb:1,oa:2,Va:3};var A=T,y=Y,u=U,r=KISSY,q=r.UA,f=r.DOM,h=r.Event,e=r.Node,o=p.Jd,x=p.na,i=p.n,a=!window.getSelection,b=p.Aa,d=p.Range,j={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};r.augment(B,{r:!a?function(){var k=this.c.M;return k.gc||(k.gc=f.ea(this.document).getSelection())}:function(){var k=this.c.M;return k.gc||(k.gc=this.document.selection)},hb:!a?function(){var k=this.c.M;if(k.type)return k.type;var s=o.oa,I=this.r();if(I){if(I.rangeCount==1){I=I.getRangeAt(0);var w=I.startContainer;if(w==I.endContainer&&w.nodeType==i.e&&I.endOffset-I.startOffset===1&&j[w.childNodes[I.startOffset].nodeName.toLowerCase()])s=
o.Va}}else s=o.Bb;return k.type=s}:function(){var k=this.c.M;if(k.type)return k.type;var s=o.Bb;try{var I=this.r(),w=I.type;if(w=="Text")s=o.oa;if(w=="Control")s=o.Va;if(I.createRange().parentElement)s=o.oa}catch(c){}return k.type=s},A:a?function(){function k(s,I){s=s.duplicate();s.collapse(I);for(var w=s.parentElement(),c=w.childNodes,g,n=0;n<c.length;n++){var t=c[n];if(t.nodeType==i.e){g=s.duplicate();g.moveToElementText(t);t=g.compareEndPoints("StartToStart",s);var m=g.compareEndPoints("EndToStart",
s);g.collapse();if(t>0)break;else if(!t||m==1&&t==-1)return{Ha:w,offset:n};else if(!m)return{Ha:w,offset:n+1};g=u}}if(!g){g=s.duplicate();g.moveToElementText(w);g.collapse(y)}g.setEndPoint("StartToStart",s);g=g.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;g>0;)g-=c[--n].nodeValue.length}catch(C){g=0}return g===0?{Ha:w,offset:n}:{Ha:c[n],offset:-g}}return function(){var s=this.c.M;if(s.ma)return s.ma;var I=this.r(),w=I&&I.createRange(),c=this.hb();if(!I)return[];if(c==o.oa){I=new d(this.document);
c=k(w,A);I.setStart(new e(c.Ha),c.offset);c=k(w);I.setEnd(new e(c.Ha),c.offset);return s.ma=[I]}else if(c==o.Va){s=s.ma=[];for(c=0;c<w.length;c++){var g=w.item(c),n=g.parentNode,t=0;for(I=new d(this.document);t<n.childNodes.length&&n.childNodes[t]!=g;t++);I.setStart(new e(n),t);I.setEnd(new e(n),t+1);s.push(I)}return s}return s.ma=[]}}():function(){var k=this.c.M;if(k.ma)return k.ma;var s=[],I=this.r();if(!I)return[];for(var w=0;w<I.rangeCount;w++){var c=I.getRangeAt(w),g=new d(this.document);g.setStart(new e(c.startContainer),
c.startOffset);g.setEnd(new e(c.endContainer),c.endOffset);s.push(g)}return k.ma=s},gb:function(){var k=this.c.M;if(k.zd!==undefined)return k.zd;var s,I=this.r();switch(this.hb()){case o.Va:return this.ac();case o.oa:var w=this.A()[0];if(w)if(!w.collapsed){for(w.ic();A;){s=w.startContainer;if(w.startOffset==(s[0].nodeType===i.e?s[0].childNodes.length:s[0].nodeValue.length)&&!s.pa())w.setStartAfter(s);else break}s=w.startContainer;if(s[0].nodeType!=i.e)return s.parent();s=new e(s[0].childNodes[w.startOffset]);
if(!s[0]||s[0].nodeType!=i.e)return w.startContainer;for(w=s[0].firstChild;w&&w.nodeType==i.e;){s=new e(w);w=w.firstChild}return s}if(a){w=I.createRange();w.collapse(A);s=w.parentElement()}else if((s=I.anchorNode)&&s.nodeType!=i.e)s=s.parentNode}return k.zd=s?f.D(s):u},ac:function(){var k=this,s,I=k.c.M;if(I.xd!==undefined)return I.xd;if(a){s=k.r().createRange();s=s.item&&s.item(0)}s||(s=function(){for(var w=k.A()[0],c,g,n=2;n&&!((c=w.Zc())&&c[0].nodeType==i.e&&j[c.d()]&&(g=c));n--)w.Oa(x.da);return g&&
g[0]}());return I.xd=f.D(s)},reset:function(){this.c.M={}},nc:function(k){var s;if(a)try{s=this.document.body.createControlRange();s.addElement(k[0]);s.select()}catch(I){s=this.document.body.createTextRange();s.moveToElementText(k[0]);s.select()}finally{}else{s=this.document.createRange();s.selectNode(k[0]);k=this.r();k.removeAllRanges();k.addRange(s)}this.reset()},sb:function(k){if(a){if(k.length>1){var s=k[k.length-1];k[0].setEnd(s.endContainer,s.endOffset);k.length=1}k[0]&&k[0].select()}else{s=
this.r();if(!s)return;s.removeAllRanges();for(var I=0;I<k.length;I++){var w=k[I],c=this.document.createRange(),g=w.startContainer;w.collapsed&&q.gecko&&q.gecko<1.09&&g[0].nodeType==i.e&&!g[0].childNodes.length&&g[0].appendChild(this.document.createTextNode(""));c.setStart(g[0],w.startOffset);c.setEnd(w.endContainer[0],w.endOffset);s.addRange(c)}}this.reset()},le:function(k){for(var s=[],I=this.A(),w=0;w<I.length;w++)s.push(I[w].Sc(k));return s},ke:function(k,s){var I=[],w=this.document,c;s=s||this.A();
for(var g=s.length,n=0;n<g;n++){I.push(c=s[n].O(k,A));var t=(k=c.yd)?r.one("#"+c.Y,w):c.Y;c=k?r.one("#"+c.P,w):c.P;for(var m=n+1;m<g;m++){var C=s[m],O=C.startContainer,P=C.endContainer;f.g(O,t.parent())&&C.startOffset++;f.g(O,c.parent())&&C.startOffset++;f.g(P,t.parent())&&C.endOffset++;f.g(P,c.parent())&&C.endOffset++}}return I},wd:function(k){for(var s=[],I=0;I<k.length;I++){var w=new d(this.document);w.moveToBookmark(k[I]);s.push(w)}this.sb(s);return this},ua:function(){var k=this.A();return k[0].startContainer.Gb(k[k.length-
1].endContainer)},scrollIntoView:function(){var k=this.gb();k&&k.Lb()},removeAllRanges:function(){var k=this.r();if(a)k&&k.clear();else k&&k.removeAllRanges()}});var z={table:1,tbody:1,tr:1},l=b.Qa(A),D=/\ufeff|\u00a0/;d.prototype.select=d.prototype.select=!a?function(){var k=this.startContainer;this.collapsed&&k[0].nodeType==i.e&&!k[0].childNodes.length&&k[0].appendChild(this.document.createTextNode(""));var s=this.document.createRange();s.setStart(k[0],this.startOffset);try{s.setEnd(this.endContainer[0],
this.endOffset)}catch(I){if(I.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(A);s.setEnd(this.endContainer[0],this.endOffset)}else throw I;}k=v(this.document).r();k.removeAllRanges();k.addRange(s)}:function(k){var s=this.collapsed,I,w;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var c=this.startContainer[0].childNodes[this.startOffset];if(c.nodeType==i.e){(new B(this.document)).nc(new e(c));return}}if(this.startContainer[0].nodeType==i.e&&this.startContainer.d()in
z||this.endContainer[0].nodeType==i.e&&this.endContainer.d()in z)this.Oa(x.da,A);var g=this.O();c=g.Y;var n;if(!s)n=g.P;g=this.document.body.createTextRange();g.moveToElementText(c[0]);g.moveStart("character",1);if(n){k=this.document.body.createTextRange();k.moveToElementText(n[0]);g.setEndPoint("EndToEnd",k);g.moveEnd("character",-1)}else{for(I=c[0].nextSibling;I&&!l(I);)I=I.nextSibling;I=!(I&&I.nodeValue&&I.nodeValue.match(D))&&(k||!c[0].previousSibling||c[0].previousSibling&&f.d(c[0].previousSibling)==
"br");w=this.document.createElement("span");w.innerHTML="&#65279;";w=(new e(w)).insertBefore(c);I&&f.insertBefore(this.document.createTextNode("\ufeff"),c)}this.setStartBefore(c);c.h();if(s){if(I){g.moveStart("character",-1);g.select();this.document.selection.clear()}else g.select();if(w){this.H(w,x.C);w.h()}}else{this.setEndBefore(n);n.h();g.select()}};B.getSelection=v;p.Ac=B;p.Selection=B;b=B.prototype;p.l.o(b,{getNative:b.r,getType:b.hb,getRanges:b.A,getStartElement:b.gb,getSelectedElement:b.ac,reset:b.reset,
selectElement:b.nc,selectRanges:b.sb,createBookmarks2:b.le,createBookmarks:b.ke,getCommonAncestor:b.ua,scrollIntoView:b.scrollIntoView,selectBookmarks:b.wd,removeAllRanges:b.removeAllRanges});p.on("instanceCreated",function(k){J(k.pe)})});
KISSY.Editor.add("styles",function(p){function B(E,K){for(var G in E)E[G]=E[G].replace(V,function(F,H){return K[H]})}function v(E,K){if(K){E=s.clone(E);B(E.attributes,K);B(E.styles,K)}var G=this.element=this.element=(E.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.Cb:S[G]?c.Xa:c.za;this.c={definition:E}}function J(E,K){var G=K?this.mc:this.Nb;E.body.focus();for(var F=new n(E),H=F.A(),M=0;M<H.length;M++)G.call(this,H[M]);F.sb(H)}function A(E,K){var G;G=E.element;if(G=="*")G="span";
G=new O(K.createElement(G));return y(G,E)}function y(E,K){var G=K.c.definition,F=G.attributes;G=v.ad(G);if(F)for(var H in F)E.attr(H,F[H]);if(G)E[0].style.cssText=G;return E}function u(E){var K=E.O(l),G=E.me();G.Vb=l;G.Vc=l;for(var F,H=E.document;F=G.ue();){var M=A(this,H);F=F;var L=M;M=L.d=="pre";var R=F.d=="pre",ba=!M&&R;if(M&&!R){R=F;L=L;ba=R.html();ba=r(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+ba+"</pre>";L=new O(R.firstChild);L.h()}else L.html(ba);L=L}else if(ba)L=f(q(F),L);else F.Jb(L);F[0].parentNode.replaceChild(L[0],F[0]);if(M){F=L;M=void 0;if((M=F.fa(l,t.e))&&M.d()=="pre"){L=r(M.html(),/\n$/,"")+"\n\n"+r(F.html(),/^\n/,"");if(P.ie)F[0].outerHTML="<pre>"+L+"</pre>";else F.html(L);M.h()}}}E.moveToBookmark(K)}function r(E,K,G){var F="",H="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(M,L,R){L&&(F=L);R&&(H=R);return""});return F+E.replace(K,G)+H}function q(E){var K=[];r(E.$a(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function f(E,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<E.length;F++){var H=E[F];H=H.replace(/(\r\n|\r)/g,"\n");H=r(H,/^[ \t]*\n/,"");H=r(H,/\n$/,"");H=r(H,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=K.K();M.html(H);G.appendChild(M[0])}return G}function h(E){var K=E.document;if(E.collapsed){K=A(this,K);E.insertNode(K);E.H(K,g.J)}else{var G=this.element,F=this.c.definition,H,M=p.m[G]||(H=l,p.m.span),L=E.O();E.Ia(g.zb);E.trim();var R=E.O(),ba=R.Y;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=D;if(w.g($,R)){$=
k;Z=l}else{var aa=$[0].nodeType,fa=aa==t.e?$.d():k;if(fa&&$.attr("_ke_bookmark")){$=$.w(l);continue}if(!fa||M[fa]&&($.Da(R)|m.X|m.ca|m.W)==m.X+m.ca+m.W&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((p.m[ga.d()]||p.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!p.m.aa[fa]||($.Da(R)|m.X|m.ca|m.W)==m.X+m.ca+m.W)){ca=new C(K);ca.setStartBefore($)}if(aa==t.f||aa==t.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Ca(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),M[da.d()])&&(da.Da(ba)|m.ba|m.ca|m.W)==m.ba+m.ca+m.W&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=l)}}else Z=l}else Z=l;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=A(this,K);for(aa=ca.ua();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.Za()){Z=k;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());d(this,Z);ca.insertNode(Z);
Z.qa();P.ie||Z[0].normalize()}ca=k}}ba.h();R.h();E.moveToBookmark(L);E.Oa(g.yc)}}function e(E){E.Ia(g.zb);var K=E.O(),G=K.Y;if(E.collapsed){for(var F=new N(G.parent()),H,M=0,L;M<F.elements.length&&(L=F.elements[M]);M++){if(L==F.z||L==F.F)break;if(this.ia(L)){var R=E.Sb(L,g.Gd),ba=!R&&E.Sb(L,g.Wa);if(ba||R){H=L;H.match=ba?"start":"end"}else{L.qa();L.d()==this.element?a(this,L):j(L,i(this)[L.d()])}}}if(H&&H[0]){L=G;for(M=0;;M++){R=F.elements[M];if(w.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(L[0]);L=R}w[H.match=="start"?"insertBefore":"insertAfter"](L,H)}}else{var $=K.P,ca=this;F=function(){for(var Z=new N(G.parent()),aa=new N($.parent()),fa=k,ga=k,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Fb(ga);fa&&G.Fb(fa)};F();for(H=new O(G[0].nextSibling);H[0]!==$[0];){M=H.w();if(H[0]&&H[0].nodeType==t.e&&this.ia(H)){H.d()==
this.element?a(this,H):j(H,i(this)[H.d()]);if(M[0].nodeType==t.e&&M.contains(G)){F();M=new O(G[0].nextSibling)}}H=M}}E.moveToBookmark(K)}function o(E){var K={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function x(E,K){var G;if(K!==D){G=document.createElement("span");G.style.cssText=E;G=G.style.cssText||""}else G=E;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(E){if(E.c.vd)return E.c.vd;
var K=E.c.vd={},G=E.c.definition.overrides;if(G){s.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],M,L;if(typeof H=="string")M=H.toLowerCase();else{M=H.element?H.element.toLowerCase():E.element;L=H.attributes}H=K[M]||(K[M]={});if(L){H=H.attributes=H.attributes||[];for(var R in L)H.push([R.toLowerCase(),L[R]])}}}return K}function a(E,K){var G=E.c.definition,F=I.mix(G.attributes,i(E)[K.d()]);G=G.styles;var H=s.isEmptyObject(F)&&s.isEmptyObject(G),M;for(M in F)if(!((M=="class"||E.c.definition.fullMatch)&&
K.attr(M)!=b(M,F[M]))){H=H||!!K.Cc(M);K.removeAttr(M)}for(var L in G)if(!(E.c.definition.fullMatch&&K.L(L)!=b(L,G[L],l))){H=H||!!K.L(L);K.L(L,"")}z(K)}function b(E,K,G){var F=new O("<span>");F[G?"_4e_style":"attr"](E,K);return F[G?"_4e_style":"attr"](E)}function d(E,K){for(var G=i(E),F=K.all(E.element),H=F.length;--H>=0;)a(E,new O(F[H]));for(var M in G)if(M!=E.element){F=K.all(M);for(H=F.length-1;H>=0;H--){var L=new O(F[H]);j(L,G[M])}}}function j(E,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],M;if(M=E.attr(H)){var L=G[F][1];if(L===k||L.test&&L.test(M)||typeof L=="string"&&M==L)E[0].removeAttribute(H)}}z(E)}function z(E){if(!E.Za()){var K=E[0].firstChild,G=E[0].lastChild;E.h(l);if(K){K.nodeType==t.e&&w.qa(K);G&&K!=G&&G.nodeType==t.e&&w.qa(G)}}}var l=T,D=Y,k=U,s=KISSY,I=p.l,w=s.DOM,c={Cb:1,za:2,Xa:3},g=p.na,n=p.Ac,t=p.n,m=p.Ua,C=p.Range,O=s.Node,P=s.UA,N=p.Ta,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},S={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},W=/\s*(?:;\s*|$)/g,V=/#\((.+?)\)/g;p.nf=c;v.prototype={apply:function(E){J.call(this,E,D)},remove:function(E){J.call(this,E,l)},Nb:function(E){return(this.Nb=this.type==c.za?h:this.type==c.Cb?u:this.type==c.Xa?k:k).call(this,E)},mc:function(E){return(this.mc=this.type==c.za?e:k).call(this,E)},$d:function(E){y(E,this)},ia:function(E,K){if(!E)return D;var G=this.c.definition;if(E.d()==this.element){if(!K&&!E.Za())return l;var F=G.Sd;if(F)G=F;else{F={};var H=0,M=G.attributes;
if(M)for(var L in M){H++;F[L]=M[L]}if(M=v.ad(G)){F.style||H++;F.style=M}F._length=H;G=G.Sd=F}if(G._length){for(var R in G)if(R!="_length"){H=E.attr(R)||"";if(R=="style")a:{F=G[R];H=x(H,D);typeof F=="string"&&(F=o(F));typeof H=="string"&&(H=o(H));M=void 0;for(M in F)if(!(M in H&&(H[M]==F[M]||F[M]=="inherit"||H[M]=="inherit"))){F=D;break a}F=l}else F=G[R]==H;if(F){if(!K)return l}else if(K)return D}if(K)return l}else return l}if(R=i(this)[E.d()]){if(!(G=R.attributes))return l;for(F=0;F<G.length;F++){R=
G[F][0];if(R=E.attr(R)){H=G[F][1];if(H===k||typeof H=="string"&&R==H||H.test&&H.test(R))return l}}}return D},ge:function(E){switch(this.type){case c.Cb:return this.ia(E.z||E.F,l);case c.Xa:case c.za:for(var K=E.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.za&&(w.g(F,E.z)||w.g(F,E.F))))if(!(this.type==c.Xa&&!(F.d()in S)))if(this.ia(F,l))return l}}return D}};v.ad=function(E){var K=E.Td;if(K)return K;K=E.styles;var G=E.attributes&&E.attributes.style||"",F="";if(G.length)G=G.replace(W,";");
for(var H in K){var M=K[H],L=(H+":"+M).replace(W,";");if(M=="inherit")F+=L;else G+=L}if(G.length)G=x(G);G+=F;return E.Td=G};p.of=v;p.Style=v;var X=v.prototype;p.l.o(X,{apply:X.apply,remove:X.remove,applyToRange:X.Nb,removeFromRange:X.mc,applyToObject:X.$d,checkElementRemovable:X.ia,checkActive:X.ge})});
KISSY.Editor.add("htmlparser",function(){function p(){}function B(){this.c={ed:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var v=KISSY,J=v.Editor,A=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,y={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},u=J.m;v.augment(B,{va:p,ud:p,la:p,pd:p,Ma:p,parse:function(r){for(var q,
f,h=0,e;q=this.c.ed.exec(r);){f=q.index;if(f>h){h=r.substring(h,f);e?e.push(h):this.la(h)}h=this.c.ed.lastIndex;if(f=q[1]){f=f.toLowerCase();if(e&&u.rc[f]){this.pd(e.join(""));e=U}if(!e){this.ud(f);continue}}if(e)e.push(q[0]);else if(f=q[3]){f=f.toLowerCase();if(!/="/.test(f)){var o={},x;q=q[4];var i=!!(q&&q.charAt(q.length-1)=="/");if(q)for(;x=A.exec(q);){var a=x[1].toLowerCase();x=x[2]||x[3]||x[4]||"";o[a]=!x&&y[a]?a:x}this.va(f,o,i);if(!e&&u.rc[f])e=[]}}else if(f=q[2])this.Ma(f)}r.length>h&&this.la(r.substring(h,
r.length))}});J.j=B;J.HtmlParser=B});
KISSY.Editor.add("htmlparser-basicwriter",function(){function p(){this.c={k:[]}}var B=KISSY,v=B.Editor,J=v.l;B.augment(p,{nb:function(A){this.c.k.push("<",A)},ob:function(A,y){y?this.c.k.push(" />"):this.c.k.push(">")},cb:function(A,y){if(typeof y=="string")y=J.dc(y);this.c.k.push(" ",A,'="',y,'"')},db:function(A){this.c.k.push("</",A,">")},text:function(A){this.c.k.push(A)},N:function(A){this.c.k.push("<!--",A,"--\>")},write:function(A){this.c.k.push(A)},reset:function(){this.c.k=[];this.c.B=Y},
Zb:function(A){var y=this.c.k.join("");A&&this.reset();return y}});v.j.xb=p;v.j.BasicWriter=p;B=p.prototype;v.l.o(B,{openTag:B.nb,openTagClose:B.ob,attribute:B.cb,closeTag:B.db,text:B.text,comment:B.N,write:B.write,reset:B.reset,getHtml:B.Zb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function p(){p.Hf.constructor.call(this);this.fd="\t";this.Oe=" />";this.Ge="\n";this.se=y;this.Pe=A;this.c.B=y;this.c.G="";this.c.rules={};var u=v.m,r;for(r in J.mix({},u.wb,u.Ra,u.vb,u.vc))this.xa(r,{B:A,de:A,Rb:A,Oc:!u[r]["#"],ce:A});this.xa("br",{Rb:A});this.xa("title",{B:y,Rb:y});this.xa("style",{B:y,Oc:A});this.xa("pre",{B:y})}var B=KISSY,v=B.Editor,J=v.l,A=T,y=Y;B.extend(p,v.j.xb,{nb:function(u){var r=this.c.rules[u];if(this.c.B)this.G();
else if(r&&r.de){this.Ka();this.G()}this.c.k.push("<",u)},ob:function(u,r){var q=this.c.rules[u];if(r)this.c.k.push(this.Oe);else{this.c.k.push(">");if(q&&q.B)this.c.G+=this.fd}q&&q.Rb&&this.Ka()},cb:function(u,r){if(typeof r=="string"){this.se&&(r=r.replace(/&amp;/g,"&"));r=J.dc(r)}this.c.k.push(" ",u,'="',r,'"')},db:function(u){var r=this.c.rules[u];if(r&&r.B)this.c.G=this.c.G.substr(this.fd.length);if(this.c.B)this.G();else if(r&&r.Oc){this.Ka();this.G()}this.c.k.push("</",u,">");r&&r.ce&&this.Ka()},
text:function(u){if(this.c.B){this.G();u=J.La(u)}this.c.k.push(u)},N:function(u){this.c.B&&this.G();this.c.k.push("<!--",u,"--\>")},Ka:function(){this.c.k.length>0&&this.c.k.push(this.Ge);this.c.B=A},G:function(){this.c.k.push(this.c.G);this.c.B=y},xa:function(u,r){var q=this.c.rules[u];if(q)J.mix(q,r);else this.c.rules[u]=r}});v.j.cf=p;v.j.HtmlWriter=p;B=p.prototype;v.l.o(B,{openTag:B.nb,openTagClose:B.ob,attribute:B.cb,closeTag:B.db,text:B.text,comment:B.N,lineBreak:B.Ka,indentation:B.G,setRules:B.xa})});
KISSY.Editor.add("htmlparser-fragment",function(){function p(){this.children=[];this.parent=J;this.c={R:B,cc:v}}var B=T,v=Y,J=U,A=KISSY.Editor,y={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},u=KISSY,r=A.l,q=A.n,f=A.m,h=r.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),e=f.Ed,o=f.vb;p.Ab=function(x,i){function a(g){var n;if(l.length>0)for(var t=0;t<l.length;t++){var m=l[t],C=m.name,O=f[C],P=k.name&&f[k.name];if((!P||P[C])&&(!g||!O||O[g]||!f[g])){if(!n){b();n=1}m=m.clone();
m.parent=k;k=m;l.splice(t,1);t--}}}function b(){for(;D.length;)k.add(D.shift())}function d(g,n,t){n=n||k||z;if(i&&!n.type){var m,C;if((m=g.attributes&&(C=g.attributes._ke_real_element_type)?C:g.name)&&!(m in f.qc)&&!(m in f.wb)){m=k;k=n;j.va(i,{});n=k;if(t)k=m}}if(g.c.R&&g.name!="pre"){t=g.children.length;if((m=g.children[t-1])&&m.type==q.f)if(C=r.Na(m.value))m.value=C;else g.children.length=t-1}n.add(g);if(g.qb){k=g.qb;delete g.qb}}var j=new A.j,z=new p,l=[],D=[],k=z,s=v,I;j.va=function(g,n,t){var m=
new A.j.wc(g,n);if(m.fc&&t)m.kb=B;if(f.aa[g])l.push(m);else{if(g=="pre")s=B;else if(g=="br"&&s){k.add(new A.j.Db("\n"));return}if(g=="br")D.push(m);else{var C=k.name,O=C&&(f[C]||(k.c.R?f.div:f.span));if(O&&!m.fc&&!k.fc&&!O[g]){O=v;var P;if(g in e&&C in e){C=k.children;(C=C[C.length-1])&&C.name in o||d(C=new A.j.wc("li"),k);I=k;P=C}else if(g==C)d(k,k.parent);else{if(h[C])I||(I=k);else{d(k,k.parent,B);y[C]||l.unshift(k)}O=B}k=P?P:k.qb||k.parent;if(O){j.va.apply(this,arguments);return}}a(g);b();m.parent=
k;m.qb=I;I=0;if(m.kb)d(m);else k=m}}};j.ud=function(g){for(var n=l.length-1;n>=0;n--)if(g==l[n].name){l.splice(n,1);return}for(var t=[],m=[],C=k;C.type&&C.name!=g;){C.c.R||m.unshift(C);t.push(C);C=C.parent}if(C.type){for(n=0;n<t.length;n++){var O=t[n];d(O,O.parent)}k=C;if(k.name=="pre")s=v;C.c.R&&b();d(C,C.parent);if(C==k)k=k.parent;l=l.concat(m)}if(g=="body")i=v};j.la=function(g){if(!k.c.cc&&!s){g=r.La(g);if(g.length===0)return}b();a();if(i&&(!k.type||k.name=="body")&&r.trim(g))this.va(i,{});s||
(g=g.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));k.add(new A.j.Db(g))};j.pd=function(){};j.Ma=function(g){k.add(new A.j.Fd(g))};j.parse(x);for(b();k.type;){var w=k.parent,c=k;if(i&&(!w.type||w.name=="body")&&!f.qc[c.name]){k=w;j.va(i,{});w=k}w.add(c);k=w}return z};u.augment(p,{add:function(x){var i=this.children.length;if(i=i>0&&this.children[i-1]||J){if(x.c.R&&i.type==q.f){i.value=r.Na(i.value);if(i.value.length===0){this.children.pop();this.add(x);return}}i.next=x}x.pb=i;x.parent=this;this.children.push(x);
this.c.cc=x.type==q.f||x.type==q.e&&!x.c.R},$:function(x,i){var a;this.filterChildren=this.Xb=function(){var b=new A.j.xb;this.U.call(this,b,i,B);b=b.Zb();this.children=(new p.Ab(b)).children;a=1};!this.name&&i&&i.rd(this);this.U(x,a?J:i)},U:function(x,i){for(var a=0;a<this.children.length;a++)this.children[a].$(x,i)}});A.j.ya=p;A.j.Fragment=p;p.FromHtml=p.Ab;u=p.prototype;A.l.o(u,{add:u.add,writeHtml:u.$,writeChildrenHtml:u.U})});
KISSY.Editor.add("htmlparser-element",function(){function p(y,u){y=y[0];u=u[0];return y<u?-1:y>u?1:0}function B(y,u){this.name=y;this.attributes=u||(u={});this.children=[];var r=u.rf||y,q=v.m;r=!!(q.wb[r]||q.Ra[r]||q.vb[r]||q.vc[r]||q.uc[r]||r=="br");var f=!!q.ub[y];this.kb=f;this.fc=!q[y];this.c={R:r,cc:f||!r}}var v=KISSY.Editor,J=v.n;KISSY.augment(B,{type:J.e,add:v.j.ya.prototype.add,clone:function(){return new B(this.name,this.attributes)},$:function(y,u){var r=this.attributes,q=this,f=q.name,
h,e,o,x;q.Xb=function(){if(!x){var b=new v.j.xb;v.j.ya.prototype.U.call(q,b,u);q.children=(new v.j.ya.Ab(b.Zb())).children;x=1}};q.filterChildren=q.Xb;if(u){for(;;){if(!(f=u.qd(f)))return;q.name=f;if(!(q=u.hc(q)))return;q.parent=this.parent;if(q.name==f)break;if(q.type!=J.e){q.$(y,u);return}f=q.name;if(!f){this.U.call(q,y,x?U:u);return}}r=q.attributes}y.nb(f,r);for(var i=[],a=0;a<2;a++)for(h in r){e=h;o=r[h];if(a==1)i.push([h,o]);else if(u){for(;;)if(e=u.od(h))if(e!=h){delete r[h];h=e}else break;
else{delete r[h];break}if(e)if((o=u.nd(q,e,o))===Y)delete r[e];else r[e]=o}}y.Pe&&i.sort(p);r=i.length;for(a=0;a<r;a++){h=i[a];y.cb(h[0],h[1])}y.ob(f,q.kb);if(!q.kb){this.U.call(q,y,x?U:u);y.db(f)}},U:function(){v.j.ya.prototype.U.apply(this,arguments)}});v.j.wc=B;v.j.Element=B;var A=B.prototype;v.l.o(A,{type:A.type,add:A.add,clone:A.clone,writeHtml:A.$,writeChildrenHtml:A.U})});
KISSY.Editor.add("htmlparser-filter",function(){function p(h){this.c={Ub:[],Ob:[],elements:{tc:0},attributes:{tc:0}};h&&this.Nc(h,10)}function B(h,e){for(var o=0;h&&o<e.length;o++){var x=e[o];h=h.replace(x[0],x[1])}return h}function v(h,e,o){if(typeof e=="function")e=[e];var x,i;i=h.length;var a=e&&e.length;if(a){for(x=0;x<i&&h[x].lc<o;x++);for(i=a-1;i>=0;i--)if(a=e[i]){a.lc=o;h.splice(x,0,a)}}}function J(h,e,o){if(e)for(var x in e){var i=h[x];h[x]=A(i,e[x],o);i||h.tc++}}function A(h,e,o){if(e){e.lc=
o;if(h){if(h.splice)v(h,e,o);else{h=h.lc>o?[e,h]:[h,e];h.filter=y}return h}else return e.filter=e}}function y(h){for(var e=h.type||h instanceof r.j.ya,o=0;o<this.length;o++){if(e)var x=h.type,i=h.name;var a=this[o].apply(window,arguments);if(a===f)return a;if(e){if(a&&(a.name!=i||a.type!=x))return a}else if(typeof a!="string")return a;a!=undefined&&(h=a)}return h}var u=KISSY,r=u.Editor,q=r.n,f=Y;u.augment(p,{Nc:function(h,e){if(typeof e!="number")e=10;v(this.c.Ub,h.Ub,e);v(this.c.Ob,h.Ob,e);J(this.c.elements,
h.elements,e);J(this.c.attributes,h.attributes,e);this.c.text=A(this.c.text,h.text,e)||this.c.text;this.c.N=A(this.c.N,h.N,e)||this.c.N;this.c.rb=A(this.c.rb,h.rb,e)||this.c.rb},qd:function(h){return B(h,this.c.Ub)},od:function(h){return B(h,this.c.Ob)},la:function(h){var e=this.c.text;return e?e.filter(h):h},Ma:function(h,e){var o=this.c.N;return o?o.filter(h,e):h},rd:function(h){var e=this.c.rb;return e?e.filter(h):h},hc:function(h){for(var e=[this.c.elements["^"],this.c.elements[h.name],this.c.elements.Xe],
o,x=0;x<3;x++)if(o=e[x]){o=o.filter(h,this);if(o===f)return U;if(o&&o!=h)return this.sd(o);if(h.parent&&!h.name)break}return h},sd:function(h){var e=h.type;return e==q.e?this.hc(h):e==q.f?new r.j.Db(this.la(h.value)):U},nd:function(h,e,o){if(e=this.c.attributes[e]){h=e.filter(o,h,this);if(h===f)return f;if(typeof h!="undefined")return h}return o}});r.j.bf=p;u=p.prototype;r.l.o(u,{addRules:u.Nc,onElementName:u.qd,onAttributeName:u.od,onText:u.la,onComment:u.Ma,onFragment:u.rd,onElement:u.hc,onNode:u.sd,
onAttribute:u.nd});r.j.Filter=p});KISSY.Editor.add("htmlparser-text",function(){function p(A){this.value=A;this.c={R:J}}var B=KISSY,v=B.Editor,J=Y;B.augment(p,{type:v.n.f,$:function(A,y){var u=this.value;y&&!(u=y.la(u,this))||A.text(u)}});v.j.Db=p;v.j.Text=p});
KISSY.Editor.add("htmlparser-comment",function(){function p(J){this.value=J;this.c={R:Y}}var B=KISSY.Editor,v=B.n;B.j.Fd=p;B.j.Comment=p;p.prototype={constructor:p,type:v.Hd,$:function(J,A){var y=this.value;if(A){if(!(y=A.Ma(y,this)))return;if(typeof y!="string"){y.parent=this.parent;y.$(J,A);return}}J.N(y)}}});
