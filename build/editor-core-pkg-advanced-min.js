/*
 Constructor for kissy editor and module dependency definition
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-02 12:37:53
*/
var T=true,U=null,V=false;
KISSY.add("editor",function(r,D){function u(o,k){function a(s){for(var i=u.Env.mods,h=0;h<s.length;h++){for(var z=s[h],E=v,x=0;x<h;x++)if(z==s[x]){E=B;break}x=i[z];if(E&&x){E=r.clone(x);z=z+"_"+h;E.name=z;s[h]=z;i[z]||(i[z]=E)}}}var b=this;if(!(b instanceof u))return new u(o,k);if(r.isString(o))o=r.one(o);o=A.D(o);k=k||{};k.Ne=k.pluginConfig||{};b.Ga=k;k.pluginConfig=k.Ne;b.cfg=k;r.app(b,r.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],m=v;b.use=function(s,i){s=s.split(",");a(s);
if(!m)for(var h=0;h<d.length;h++){var z=d[h];r.inArray(z,s)||s.unshift(z)}r.use.call(b,s.join(","),function(){b.ready(function(){i&&i.call(b);if(!m){b.setData(o.val());if(k.focus)b.focus();else{var E=b.getSelection();E&&E.removeAllRanges()}b.fire("save");m=B}})},{order:B,global:u});return b};b.use=b.use;b.Ee(o);return b}function J(o){var k=r.Config.debug;o=k?k==="dev"?"../src/"+o:o:o.replace(/\.(js|css)/i,"-min.$1");o+=o.indexOf("?")!=-1?"&":"?";o+="t="+encodeURIComponent("2010-11-02 12:37:53");return o}
var A=r.DOM,B=T,v=V;r.app(u,r.EventTarget);u.Config.base=r.Config.base+"editor/";var n=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",requires:["flash/support"]},
{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",{name:"smiley"},{name:"sourcearea",
requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],f,l,j,e,t={};f=0;for(l=n.length;f<l;f++){j=n[f];if(r.isString(j))j=n[f]={name:j+"",requires:U};e=j.requires||[];var G=["button"];j.name.indexOf("/dialog")!=-1&&G.push("overlay");j.requires=e.concat(G)}n=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},{name:"progressbar"},{name:"overlay",
requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(n);f=0;for(l=n.length;f<l;f++){j=n[f];e=j.name;t[e]={attach:v,charset:"utf-8",requires:j.requires,csspath:j.Pf?J("plugins/"+e+"/plugin.css"):D,path:J("plugins/"+e+"/plugin.js")}}u.add(t);r.Editor=u;r.Editor=u});
KISSY.Editor.add("utils",function(r){var D=U,u=KISSY,J=u.Node,A=u.DOM,B=u.UA,v=u.Event,n={Yc:function(f){var l=u.Config.debug;f=l?l==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-11-02 12:05:37");return f},Je:function(f,l,j){var e=f[l],t=f[j];f[l]=function(){e.apply(this,arguments);f[l]=f[j];return t.apply(this,arguments)}},Ae:function(f,l,j,e){j=j.defaultView||j.parentWindow;f-=A.scrollLeft(j);l-=A.scrollTop(j);if(e)if(j!=(e.defaultView||
e.parentWindow)&&j.frameElement){e=A.Hb(j.frameElement,e);f+=e.left;l+=e.top}return{left:f,top:l}},Gd:function(){for(var f,l=0,j=arguments.length;l<j;l++){var e=arguments[l];try{f=e();break}catch(t){}}return f},fe:function(f,l){if(!f&&!l)return T;if(!f||!l||f.length!=l.length)return V;for(var j=0;j<f.length;j++)if(f[j]!==l[j])return V;return T},bd:function(f,l,j){f=f.documentElement;for(var e=0;f&&e<l.length;e++){var t=l[e];if(j)for(var G=-1,o=0;o<f.childNodes.length;o++){var k=f.childNodes[o];if(!(j===
T&&k.nodeType==3&&k.previousSibling&&k.previousSibling.nodeType==3)){G++;if(G==t){f=k;break}}}else f=f.childNodes[t]}return f?new J(f):D},ne:function(f){for(var l in f)f[l].Fc(f,T)},fc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ka:function(f){return f.replace(/^\s+/,"")},Ma:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ka(this.Ma(f))},mix:function(){for(var f={},l=0;l<arguments.length;l++)f=u.mix(f,arguments[l]);return f},hc:function(){if(!B.ie)return V;
var f=document.domain,l=window.location.hostname;return f!=l&&f!="["+l+"]"},se:function(f,l){return Array(l+1).join(f)},Ve:function(f,l,j){j=j||150;if(j===-1)return function(){f.apply(l,arguments)};var e=(new Date).getTime();return function(){var t=(new Date).getTime();if(t-e>j){e=t;f.apply(l,arguments)}}},je:function(f,l,j){j=j||0;var e=D;return function(){e&&clearTimeout(e);var t=arguments;e=setTimeout(function(){return f.apply(l,t)},j)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(u.trim(f))},
Xe:function(f){for(var l=0;l<f.length;l++){var j=A.D(f[l]),e=u.trim(j.val()),t=j.attr("data-verify");j=j.attr("data-warning");if(t&&!RegExp(t).test(e)){alert(j);return V}}return T},Te:function(f,l){f.on("sourcemode",l.zf,l);f.on("wysiwygmode",l.Ff,l)},Pe:function(f){var l=f.attr("placeholder");if(l&&!B.webkit){f.val(l);f.addClass("ke-input-tip")}else B.webkit&&f.val("")},Me:function(f,l){f.attr("placeholder",l);if(!B.webkit){f.on("blur",function(){if(!u.trim(f.val())){f.val(l);f.addClass("ke-input-tip")}});
f.on("focus",function(){u.trim(f.val())==l&&f.val("");f.removeClass("ke-input-tip")})}},me:function(f){f=f[0]||f;for(var l=u.makeArray(f.childNodes),j=0;j<l.length;j++){var e=l[j];e.nodeType==r.n.f&&!u.trim(e.nodeValue)&&f.removeChild(e)}},De:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},Ce:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},ue:function(f,
l){return f.toLowerCase()==l.toLowerCase()},qd:function(f){f=u.clone(f);for(var l in f)if(f.hasOwnProperty(l)){var j=f[l];if(u.isFunction(j))f[l]=j()}return f},re:function(f,l,j){function e(){var d={responseText:"",responseXML:D};d.ee=f?f.ee:D;try{var m;if((m=B.ie?G.contentWindow.document:G.contentDocument||window.frames[t].document)&&m.body)d.responseText=m.body.innerHTML;d.responseXML=m&&m.XMLDocument?m.XMLDocument:m}catch(s){}v.remove(G,"load",e);f.ke&&f.ke(d);setTimeout(function(){A.j(G)},100)}
var t=u.guid("form-upload-"),G=document.createElement("iframe");G.id=t;G.name=t;G.className="ke-hidden";if(B.ie)G.src="javascript:FALSE";document.body.appendChild(G);if(B.ie)document.frames[t].name=t;var o=A.Oc(f.form),k={target:o.target,method:o.method,encoding:o.encoding,enctype:o.enctype,action:o.action};o.target=t;o.method="POST";o.enctype=o.encoding="multipart/form-data";if(j)o.action=j;var a;if(l){a=[];l=r.k.qd(l);for(var b in l)if(l.hasOwnProperty(b)){j=document.createElement("input");j.type=
"hidden";j.name=b;j.value=l[b];o.appendChild(j);a.push(j)}}v.on(G,"load",e);o.submit();o.target=k.target;o.method=k.method;o.enctype=k.enctype;o.encoding=k.encoding;o.action=k.action;if(a){l=0;for(o=a.length;l<o;l++)A.j(a[l])}return G},o:function(f,l){for(var j in l)f[j]=l[j]}};r.k=n;r.Utils=n;n.o(n,{debugUrl:n.Yc,lazyRun:n.Je,getXY:n.Ae,tryThese:n.Gd,arrayCompare:n.fe,getByAddress:n.bd,clearAllMarkers:n.ne,htmlEncodeAttr:n.fc,ltrim:n.Ka,rtrim:n.Ma,trim:n.trim,mix:n.mix,isCustomDomain:n.hc,duplicateStr:n.se,
buffer:n.je,isNumber:n.isNumber,verifyInputs:n.Xe,sourceDisable:n.Te,resetInput:n.Pe,placeholder:n.Me,clean:n.me,htmlEncode:n.De,htmlDecode:n.Ce,equalsIgnoreCase:n.ue,normParams:n.qd,throttle:n.Ve,doFormUpload:n.re})});
KISSY.Editor.add("focusmanager",function(r){function D(){this.gc=f;n=this}function u(){this.gc=l;n=j}var J=KISSY,A=J.DOM,B=J.Event,v={},n;J={Jf:function(){for(var e in v){var t=v[e];t.document.designMode="off";t.document.designMode="on"}},yf:function(){return n},xe:function(e){return v[e]},add:function(e){var t=A.ga(e.document);B.on(t,"focus",D,e);B.on(t,"blur",u,e)},Oe:function(e){v[e.Mb]=e},remove:function(e){delete v[e.Mb];var t=A.ga(e.document);B.remove(t,"focus",D,e);B.remove(t,"blur",u,e)}};
var f=T,l=V,j=U;r.ve=J;r.focusManager=J;r.fd=function(){return v};r.getInstances=r.fd});
KISSY.Editor.add("definition",function(r){function D(a,b){return"<!doctype html><html><head><title>${title}</title><link href='"+r.Config.base+t+"' rel='stylesheet'/><style>"+(b||"")+"</style></head><body class='ke-editor'>&nbsp;"+(a?'<script id="ke_actscript" type="text/javascript">'+(r.k.hc()?'document.domain="'+A.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':"")+"</body></html>"}var u=T,J=V,A=document,B=KISSY,v=B.UA,n=B.DOM,f=B.Node,l=B.Event,j=r.ve,e=r.k.Gd,t=r.k.Yc("theme/editor-iframe.css"),
G=1,o="document.open();"+(r.k.hc()?'document.domain="'+A.domain+'";':"")+"document.close();",k="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(v.ie?"javascript:void(function(){"+encodeURIComponent(o)+"}())":"")+'"  tabIndex="'+(v.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+
".ke-editor-status".substring(1)+"'></div></div>";r.Cc=0;r.Xa=1;r.SOURCE_MODE=r.Cc;r.WYSIWYG_MODE=r.Xa;B.augment(r,{Ee:function(a){if(v.ie)n.addClass(A.body,"ie"+v.ie);else if(v.gecko)n.addClass(A.body,"gecko");else v.webkit&&n.addClass(A.body,"webkit");var b=this,d=new f(k.replace(/\$\(tabIndex\)/,a.attr("tabIndex")));d.on("mousedown",function(i){if(v.webkit){var h=n.d(i.target);if(h=="select"||h=="option")return u}i.halt()});a.on("mousedown",function(i){i.stopPropagation()});b.Df=d;b.Mb=G++;j.Oe(b);
b.tb=d.one(".ke-textarea-wrap");b.wrap=b.tb;b.ib=b.tb.one("iframe");b.iframe=b.ib;b.Fd=d.one(".ke-editor-tools");b.toolBarDiv=b.Fd;b.$=a;b.textarea=b.$;b.Ue=d.one(".ke-editor-status");b.statusDiv=b.Ue;b.Fd.Nc();b.Nb={};b.Pc={};var m=a.M("width"),s=a.M("height");if(m){d.css("width",m);a.css("width","100%")}b.$.css("display","none");d.insertAfter(a);b.tb[0].appendChild(a[0]);if(s){b.tb.css("height",s);a.css("height","100%")}d=b.ib;b.on("dataReady",function(){b.Zd=u;r.fire("instanceCreated",{te:b})});
v.gecko?d.on("load",b.Rc,b):b.Rc();b.Ga.xf&&a[0].form&&b.Yd()},Yd:function(){(new f(this.$[0].form)).on("submit",this.Ed,this)},We:function(a,b){var d=this,m=r.qf;m.Gf();d.use(a,function(){var s=d.cd(a);b(s);m.Of()})},be:function(a,b){this.Pc[a]=b},cd:function(a){return this.Pc[a]},ce:function(a){this.ready(a)},$d:function(a,b){this.Nb[a]=b},Be:function(a){return this.Nb[a]},execCommand:function(a){var b=this.Nb[a],d=B.makeArray(arguments);d.shift();d.unshift(this);return b.exec.apply(b,d)},ac:function(){return this.$.css("display")==
"none"?r.Xa:r.Cc},getData:function(a){var b;b=this.ac()==r.Xa?this.document.body.innerHTML:this.$.val();if(this.htmlDataProcessor)b=a?this.htmlDataProcessor.toHtml(b,"p"):this.htmlDataProcessor.toServer(b,"p");return b},setData:function(a){var b=a;if(this.htmlDataProcessor)b=this.htmlDataProcessor.toDataFormat(a,"p");this.document.body.innerHTML=b;this.ac()!=r.Xa&&this.$.val(a)},Ed:function(){this.$.val(this.getData())},Fa:function(a){a=a||0;return a+(this.Ga.Fa||0)},sf:function(){return this.document.body.innerHTML},
vf:function(a){this.document.body.innerHTML=a},uf:D,getSelection:function(){return r.Dc.getSelection(this.document)},focus:function(){var a=this.document,b=n.ga(a);v.webkit&&b&&b.parent&&b.parent.focus();b&&b.focus();a&&a.body.focus();this.lb()},blur:function(){n.ga(this.document).blur();this.document&&this.document.body.blur()},ae:function(a){var b=this.Ga,d=this.document;b.Ub=b.Ub||"";b.Ub+="\n"+a;b=d.createElement("style");d.getElementsByTagName("head")[0].appendChild(b);if(b.styleSheet)b.styleSheet.cssText=
a;else b.appendChild(d.createTextNode(a))},Rc:function(){function a(){i=s.document;b.document=i;d.detach();i.open("text/html","replace");i.write(m);i.close()}var b=this,d=b.ib,m=D(b.Mb,b.Ga.Ub),s=d[0].contentWindow,i;try{i=s.document}catch(h){d[0].src=d[0].src;if(v.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this.Zd?a():this.on("dataReady",a)},cb:function(){var a=this;a.Qc&&clearTimeout(a.Qc);a.Qc=setTimeout(function(){var b=a.getSelection();if(b&&!b.nd){var d=b.cc(),m=new r.Sa(d);if(!a.mc||
!a.mc.Wc(m)){a.mc=m;a.fire("selectionChange",{selection:b,path:m,element:d})}}},100)},lb:function(){this.mc=U;this.cb()},md:function(a,b){var d=this;d.focus();var m=a.d(),s=r.m,i=r.oa,h=r.n,z=s.Qa[m],E=d.getSelection(),x=E&&E.A(),c,g,p,w,q;if(!x||x.length==0){var C=arguments,Q=C.callee;setTimeout(function(){Q.apply(d,C)},30)}else{d.fire("save");for(var N=x.length-1;N>=0;N--){c=x[N];c.deleteContents();g=!N&&a||a.K(u);b&&b(g);if(z)for(;(w=c.va(J,u))&&(q=s[w.d()])&&!(q&&q[m]);)if(w.d()in s.span)c.sc(w);
else if(c.ua()&&c.ka()){c.setStartBefore(w);c.collapse(u);w.j()}else c.rc();c.insertNode(g);p||(p=g)}if(p){m=p.w(u);s=d.document;q=r.m;if(q.vc[g.d()]){m=new f(s.createTextNode(" "));m.insertAfter(p)}else if(m){if(m.d()=="br"&&q[m.parent().d()].p){q=new f("<p>&nbsp;</p>",U,s);m[0].parentNode.replaceChild(q[0],m[0]);m=q}}else{q=new f("<p>&nbsp;</p>",U,s);q.insertAfter(p);m=q}c.H(p,i.t);m&&m[0].nodeType==h.e&&c.kb(m);E.sb([c]);d.focus();g&&g.Lb();setTimeout(function(){d.fire("save")},10);return g}}},
Fe:function(a){var b=this;if(b.htmlDataProcessor)a=b.htmlDataProcessor.toDataFormat(a);if(v.webkit){var d=n.create(a,U,this.document);d=d.nodeType==11?B.makeArray(d.childNodes):[d];for(var m=0;m<d.length;m++)b.md(new f(d[m]))}else{b.focus();m=(d=b.getSelection())&&d.A();if(!m||m.length==0){var s=arguments,i=s.callee;setTimeout(function(){i.apply(b,s)},30)}else{b.fire("save");if(v.ie){d=d.r();d.type=="Control"&&d.clear();d.createRange().pasteHTML(a)}else b.document.execCommand("inserthtml",J,a);b.focus();
setTimeout(function(){b.fire("save")},10)}}}});r._initIFrame=function(a){function b(c){e(function(){s.designMode="on";setTimeout(function(){s.designMode="off";h.focus();if(!arguments.callee.Qe)arguments.callee.Qe=u},50)},function(){s.designMode="off";n.attr(h,"contentEditable",J);n.attr(h,"contentEditable",u);!c&&b(1)})}var d=j.xe(a);a=d.$[0];var m=d.ib[0].contentWindow,s=d.document,i=d.Ga;n.j(s.getElementById("ke_actscript"));var h=s.body;if(v.ie){h.hideFocus=u;h.disabled=u;h.contentEditable=u;h.removeAttribute("disabled")}else setTimeout(function(){if(v.gecko||
v.opera)h.contentEditable=u;else if(v.webkit)h.parentNode.contentEditable=u;else s.designMode="on"},0);if(v.webkit){l.on(s,"click",function(c){var g=new f(c.target);B.inArray(g.d(),["input","select"])&&c.preventDefault()});l.on(s,"mouseup",function(c){var g=new f(c.target);B.inArray(g.d(),["input","textarea"])&&c.preventDefault()})}if(v.gecko||v.ie||v.opera){var z;z=new f(n.insertAfter((new f('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],a));z.on("focus",
function(){d.focus()});d.wf=function(){v.gecko&&d.gc&&z[0].focus()};d.on("destroy",function(){})}if(v.ie&&s.compatMode=="CSS1Compat"||v.gecko||v.opera){var E=new f(s.documentElement);E.on("mousedown",function(c){if(c.target==E[0]){v.gecko&&b(J);z[0].focus()}})}l.on(m,"focus",function(){if(v.gecko)b(J);else v.opera&&h.focus();d.lb()});v.gecko&&l.on(d.document,"mousedown",function(){d.gc||b(J)});if(v.ie){l.on(s,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var g=d.getSelection(),p=g.bc();if(p){d.fire("save");
var w=g.A()[0].P();p.j();g.pc([w]);d.fire("save");c.preventDefault()}}});if(s.compatMode=="CSS1Compat"){var x={33:1,34:1};l.on(s,"keydown",function(c){c.keyCode in x&&setTimeout(function(){d.getSelection().scrollIntoView()},0)})}}setTimeout(function(){v.ie&&setTimeout(function(){if(s){h.runtimeStyle.marginBottom="0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){d.fire("dataReady");var c=i.Bf,g=i.Af;if(c||g)try{s.execCommand("enableObjectResizing",J,!c);s.execCommand("enableInlineTableEditing",
J,!g)}catch(p){l.on(h,v.ie?"resizestart":"resize",function(w){if(c||n.d(w.target)==="table"&&g)w.preventDefault()})}},10);v.webkit&&l.on(s,"mousedown",function(c){c=new f(c.target);B.inArray(c.d(),["img","hr","input","textarea","select"])&&d.getSelection().qc(c)});v.gecko&&l.on(s,"dragstart",function(c){var g=new f(c.target);g.d()==="img"&&/ke_/.test(g[0].className)&&c.preventDefault()});j.add(d)};o=r.prototype;r.k.o(o,{setData:o.setData,getData:o.getData,insertElement:o.md,insertHtml:o.Fe,ready:o.ready,
addCustomStyle:o.ae,addCommand:o.$d,hasCommand:o.Be,execCommand:o.execCommand,addPlugin:o.ce,useDialog:o.We,addDialog:o.be,getDialog:o.cd,getMode:o.ac,sync:o.Ed,baseZIndex:o.Fa,getSelection:o.getSelection,focus:o.focus,blur:o.blur,notifySelectionChange:o.lb})});
KISSY.Editor.add("zindex",function(){var r=KISSY.Editor;if(!r.Hd){r.Hd={cf:1100,mf:1200,df:99999,jf:900,lf:9999,LOADING:11E3,hf:12E3,nf:1200};r.Fa=function(D){var u=D,J=r.fd(),A;for(A in J){if(!J.hasOwnProperty(A))return;u=Math.max(u,J[A].Fa(D))}return u};r.baseZIndex=r.Fa;r.zIndexManager=r.Hd}});
KISSY.Editor.add("dtd",function(r){r.m=function(){function D(i){for(var h=arguments.length-1;h>0;)KISSY.mix(i,arguments[h--]);return i}var u={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},A=D({a:1},J),B=D({iframe:1},A),v={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},n={ins:1,del:1,script:1,style:1},f=D({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},n),l=D({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},f),j=D({p:1},l);J=D({iframe:1},l,J);l={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=D({a:1},J),t={tr:1},G={"#":1},o=D({param:1},l),k=D({form:1},u,B,v,j),a={li:1},b={base:1,link:1,meta:1,title:1},d=D(b,{style:1,script:1}),m={head:1,body:1},s={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{wb:D({html:1},m,b),Qa:s,af:{body:1,div:1,td:1,th:1,caption:1,
form:1},vc:e,tc:D({script:1,style:1},s),uc:{script:1,style:1},ub:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},vb:{dd:1,dt:1,li:1},Id:{ul:1,ol:1,dl:1},xc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},ba:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},bf:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},yc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:m,head:d,style:G,body:k,base:{},link:{},meta:{},title:G,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:k,td:k,br:{},th:k,center:k,kbd:e,button:D(j,v),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:a,h1:e,h3:e,option:G,h2:e,form:D(u,B,v,j),select:{optgroup:1,option:1},font:e,ins:e,menu:a,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:G,tfoot:t,cite:e,li:k,input:{},iframe:k,
strong:e,textarea:G,noframes:k,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:k,object:o,sup:e,dd:k,strike:e,area:{},dir:a,map:D({area:1,form:1,p:1},u,n,v),applet:o,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:D({legend:1},l),thead:t,ul:a,acronym:e,b:e,a:J,blockquote:k,caption:e,i:e,u:e,tbody:t,s:e,address:D(B,j),tt:e,legend:e,q:e,pre:D(f,A),p:e,em:e,dfn:e}}();r.XHTML_DTD=r.m});
KISSY.Editor.add("dom",function(r){function D(a){if(a&&!a[0])return new n(a);return a}function u(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var A=KISSY,B=A.DOM,v=A.UA,n=A.Node,f=r.k,l={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};r.n={e:1,f:3,Ld:8,kf:11};r.NODE=r.n;r.Ta={da:0,Md:1,ca:2,Y:4,X:8,Ac:16};r.POSITION=
r.Ta;var j=r.n,e=r.Ta,t={},G={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},o={hr:1},k={D:D,Oc:u,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return V;a=u(a);b=u(b);return a===b},qa:function(a,b){a=D(a);var d=A.mix(A.mix({},o),b||{});return G[a.css("display")]||d[a.d()]},ga:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
V},v:function(a){a=u(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Qd:function(a,b){a=u(a);var d=a.firstChild;if((d=d&&new n(d))&&b&&!b(d))d=d.Za(b);return d},Lc:function(a,b,d){a=u(a);B.j(a);b=u(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(v.ie)if((a=a.Kf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Jc:function(a,b){if(a.d()!=b.d())return V;var d=a[0].attributes,m=b[0].attributes,s=d.length,
i=m.length;if(!v.ie&&s!=i)return V;for(var h=0;h<s;h++){var z=d[h];if((!v.ie||z.specified&&z.nodeName!="_ke_expando")&&z.nodeValue!=b.attr(z.nodeName))return V}if(v.ie)for(h=0;h<i;h++){z=m[h];if(z.specified&&z.nodeName!="_ke_expando"&&z.nodeValue!=a.attr(z.nodeName))return V}return T},Ib:function(a){a=u(a).childNodes;for(var b=0,d=a.length;b<d;b++){var m=a[b],s=m.nodeType;if(!(s==j.e&&m.getAttribute("_ke_bookmark")))if(s==j.e&&!k.Ib(m)||s==j.f&&A.trim(m.nodeValue))return V}return T},Jb:function(a,
b,d){a=u(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},ra:function(){function a(b,d,m){if(d[0]&&d[0].nodeType==j.e){for(var s=[];d.attr("_ke_bookmark")||d.Ib();){s.push(d);d=m?new n(d[0].nextSibling):new n(d[0].previousSibling);if(!d[0]||d[0].nodeType!=j.e)return}if(b.Jc(d)){for(var i=m?b[0].lastChild:b[0].firstChild;s.length;)s.shift().Lc(b,!m);d.Jb(b,!m);d.j();i[0]&&i[0].nodeType==j.e&&i.ra()}}}
return function(b){if(b[0])if(l[b.d()]||b.d()=="a"){a(b,new n(b[0].nextSibling),T);a(b,new n(b[0].previousSibling))}}}(),Nc:v.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:v.webkit?function(a){a=u(a);a.style.gf="none"}:function(a){a=u(a);if(v.ie||v.opera){var b,d=0;for(a.unselectable="on";b=a.all[d++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},Hb:function(a,b){a=u(a);var d,m=0;d=0;var s=a.ownerDocument.defaultView||
a.ownerDocument.parentWindow,i=a.ownerDocument,h=i.documentElement;b=b||i;if(a.getBoundingClientRect){if(a!==i.body&&h!==a){d=a.getBoundingClientRect();m=d.left+(b===i?B.scrollLeft(s):0);d=d.top+(b===i?B.scrollTop(s):0)}if(b)if(s!=(b.defaultView||b.parentWindow)&&s.frameElement){s=k.Hb(s.frameElement,b);m+=s.left;d+=s.top}}return{left:m,top:d}},Sd:function(a){return(a=u(a))&&a.contentWindow.document},ia:function(a,b){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=j.f)){if(v.ie&&b==a.nodeValue.length){var m=
d.createTextNode("");B.insertAfter(m,a);return new n(m)}m=new n(a.splitText(b));if(v.ie==8){d=d.createTextNode("");B.insertAfter(d,m[0]);d.parentNode.removeChild(d)}return m}},Kb:function(a,b){a=D(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=u(a);a=a.cloneNode(b);if(!d){var m=function(s){if(s.nodeType==j.e){s.removeAttribute("id",V);s.removeAttribute("_ke_expando",V);s=s.childNodes;for(var i=0;i<s.length;i++)m(s[i])}};m(a)}return new n(a)},w:function(a,
b,d,m){a=u(a);if(m&&!m.call){var s=m[0]||m;m=function(h){h=h[0]||h;return h!==s}}b=!b&&a.firstChild;var i=new n(a);if(!b){if(a.nodeType==j.e&&m&&m(a,T)===V)return U;b=a.nextSibling}for(;!b&&(i=i.parent());){if(m&&m(i,T)===V)return U;b=i[0].nextSibling}if(!b)return U;b=B.D(b);if(m&&m(b)===V)return U;if(d&&d!=b[0].nodeType)return b.w(V,d,m);return b},ha:function(a,b,d,m){a=u(a);if(m&&!m.call){var s=m[0]||m;m=function(h){h=h[0]||h;return h!==s}}b=!b&&a.lastChild;var i=new n(a);if(!b){if(a.nodeType==
j.e&&m&&m(a,T)===V)return U;b=a.previousSibling}for(;!b&&(i=i.parent());){if(m&&m(i,T)===V)return U;b=i[0].previousSibling}if(!b)return U;b=B.D(b);if(m&&m(b)===V)return U;if(d&&b[0].nodeType!=d)return b.ha(V,d,m);return b},L:v.ie||v.webkit?function(a,b){a=u(a);b=u(b);return b.nodeType!=j.e?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=u(a);b=u(b);return!!(a.compareDocumentPosition(b)&16)},Gb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=j.f&&b.L(a))return b;var d=a[0].nodeType==
j.f?a.parent():a;do if(d[0].nodeType!=j.f&&d.L(b))return d;while(d=d.parent());return U},Od:function(a,b,d){a=u(a);if(!d)a=a.parentNode;if(b&&!A.isFunction(b)){var m=b;b=function(s){return s.d()==m}}for(;a&&a.nodeType!=9;){if(!b||b(new n(a))===T)return new n(a);a=a.parentNode}return U},Hc:function(a,b){a=u(a);var d=a.attributes.getNamedItem(b);return!!(d&&d.specified)},Ya:v.ie?function(a){a=u(a);for(var b=a.attributes,d=0;d<b.length;d++){var m=b[d];switch(m.nodeName){case "class":if(a.getAttribute("class"))return T;
break;case "_ke_expando":continue;default:if(m.specified)return T}}return V}:function(a){a=u(a);v.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},Da:function(a,b){var d=u(a),m=u(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(m);if(d==m)return e.da;if(d.nodeType==j.e&&m.nodeType==j.e){if(d.contains){if(d.contains(m))return e.Ac+e.Y;if(m.contains(d))return e.X+e.ca}if("sourceIndex"in d)return d.sourceIndex<0||m.sourceIndex<
0?e.Md:d.sourceIndex<m.sourceIndex?e.Y:e.ca}d=a.Ca();m=b.Ca();for(var s=Math.min(d.length,m.length),i=0;i<=s-1;i++)if(d[i]!=m[i]){if(i<s)return d[i]<m[i]?e.Y:e.ca;break}return d.length<m.length?e.Ac+e.Y:e.X+e.ca},Ca:function(a,b){a=u(a);for(var d=[],m=a.ownerDocument.documentElement,s=a;s&&s!=m;){var i=s.parentNode,h=-1;if(i){for(var z=0;z<i.childNodes.length;z++){var E=i.childNodes[z];if(!(b&&E.nodeType==3&&E.previousSibling&&E.previousSibling.nodeType==3)){h++;if(E==s)break}}d.unshift(h)}s=i}return d},
Fb:function(a,b){var d=new r.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var m=d.extractContents();d.insertNode(a.j());a[0].parentNode.insertBefore(m,a[0].nextSibling)},M:function(a,b,d){a=D(a);if(d!==undefined)return a.css(b,d);a=u(a);return a.style[J(b)]},j:function(a,b){var d=u(a),m=d.parentNode;if(m){if(b)for(var s;s=d.firstChild;)m.insertBefore(d.removeChild(s),d);m.removeChild(d)}return a},bb:function(a){B.Kc(a);B.Mc(a)},Kc:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==
j.f){var d=f.Ka(b.nodeValue),m=b.nodeValue.length;if(d){if(d.length<m){(new n(b)).ia(m-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Mc:function(a){a=u(a);for(var b;b=a.lastChild;){if(b.type==j.f){var d=f.Ma(b.nodeValue),m=b.nodeValue.length;if(d){if(d.length<m){(new n(b)).ia(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!v.ie&&!v.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Eb:function(a){a=
u(a);for(var b=a.lastChild;b&&b.nodeType==j.f&&!A.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==j.f||B.d(b)!=="br"){b=v.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");v.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},sa:function(a,b){var d=u(a),m;do m=(d=d.previousSibling)&&new n(d);while(m&&b&&!b(m));return m},Ud:function(a,b){a=B.D(a);var d=a[0].lastChild;if((d=d&&new n(d))&&b&&!b(d))d=d.sa(b);return d},Za:function(a,b){var d=u(a),m;do m=(d=d.nextSibling)&&
new n(d);while(m&&b&&!b(m));return m},$a:function(a){a=u(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},Vd:function(a,b,d,m){a=B.D(a);var s=a.fa("list_marker_id")||a.ab("list_marker_id",A.guid()).fa("list_marker_id"),i=a.fa("list_marker_names")||a.ab("list_marker_names",{}).fa("list_marker_names");b[s]=a;i[d]=1;return a.ab(d,m)},Fc:function(a,b,d){a=D(a);var m=a.fa("list_marker_names"),s=a.fa("list_marker_id"),
i;for(i in m)a.Ea(i);a.Ea("list_marker_names");if(d){a.Ea("list_marker_id");delete b[s]}},ab:function(a,b,d){var m=B.Gc(a);(t[m]||(t[m]={}))[b]=d;return a},fa:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");return(d=d&&t[d])&&d[b]},Ea:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");var m=(d=d&&t[d])&&d[b];typeof m!="undefined"&&d&&delete d[b];A.isEmptyObject(d)&&B.Ec(a);return m||U},Ec:function(a){a=u(a);var b=a.getAttribute("_ke_expando");b&&delete t[b];b&&a.removeAttribute("_ke_expando")},
Gc:function(a){a=u(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=A.guid();a.setAttribute("_ke_expando",b);return b},Pd:function(a,b,d){a=u(a);b=D(b);var m=a.attributes;d=d||{};for(var s=0;s<m.length;s++){var i=m[s],h=i.nodeName.toLowerCase(),z;if(!(h in d))if(h=="checked"&&(z=B.attr(a,h)))b.attr(h,z);else if(i.specified||v.ie&&i.nodeValue&&h=="value"){z=B.attr(a,h);if(z===U)z=i.nodeValue;b.attr(h,z)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Ic:function(a){a=B.d(a);var b=
r.m;return(a=!b.xc[a]&&(b[a]||b.span))&&a["#"]},Lb:function(a){a=D(a);var b=a[0].ownerDocument,d=B.scrollLeft(b),m=B.scrollTop(b),s=a.offset(),i=s.left;s=s.top;if(B.viewportHeight(b)+m<s||s<m||B.viewportWidth(b)+d<i||i<d)a.scrollIntoView(b)},Rd:function(a,b,d){a=u(a);if(!v.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new n(a[b]));return d}};A.DOM.Td=function(a){A.mix(B,a);for(var b in a)a.hasOwnProperty(b)&&function(d){n.prototype[d]=function(){var m=[].slice.call(arguments,
0);m.unshift(this);return a[d].apply(U,m)}}(b)};f.o(k,{_4e_wrap:k.D,_4e_unwrap:k.Oc,_4e_equals:k.g,_4e_isBlockBoundary:k.qa,_4e_getWin:k.ga,_4e_index:k.v,_4e_first:k.Qd,_4e_move:k.Lc,_4e_name:k.d,_4e_isIdentical:k.Jc,_4e_isEmptyInlineRemoveable:k.Ib,_4e_moveChildren:k.Jb,_4e_mergeSiblings:k.ra,_4e_unselectable:k.Nc,_4e_getOffset:k.Hb,_4e_getFrameDocument:k.Sd,_4e_splitText:k.ia,_4e_parents:k.Kb,_4e_clone:k.K,_4e_nextSourceNode:k.w,_4e_previousSourceNode:k.ha,_4e_contains:k.L,_4e_commonAncestor:k.Gb,
_4e_ascendant:k.Od,_4e_hasAttribute:k.Hc,_4e_hasAttributes:k.Ya,_4e_position:k.Da,_4e_address:k.Ca,_4e_breakParent:k.Fb,_4e_style:k.M,_4e_remove:k.j,_4e_trim:k.bb,_4e_ltrim:k.Kc,_4e_rtrim:k.Mc,_4e_appendBogus:k.Eb,_4e_last:k.Ud,_4e_previous:k.sa,_4e_next:k.Za,_4e_outerHtml:k.$a,_4e_setMarker:k.Vd,_4e_clearMarkers:k.Fc,_4e_setData:k.ab,_4e_getData:k.fa,_4e_removeData:k.Ea,_4e_clearData:k.Ec,_4e_removeData:k.Ea,_4e_getUniqueId:k.Gc,_4e_copyAttributes:k.Pd,_4e_isEditable:k.Ic,_4e_scrollIntoView:k.Lb,
_4e_getElementsByTagName:k.Rd});B.Td(k)});
KISSY.Editor.add("elementpath",function(r){function D(l){var j=B,e=B,t=[];for(l=l;l&&l[0];){if(l[0].nodeType==A.e){if(!this.Ie)this.Ie=l;var G=l.d();if(!e){if(!j&&v[G])j=l;if(n[G]){var o;if(o=!j){if(o=G=="div"){a:{o=l;o=o[0]||o;o=o.childNodes;for(var k=0,a=o.length;k<a;k++){var b=o[k];if(b.nodeType==A.e&&J.Qa[b.nodeName.toLowerCase()]){o=T;break a}}o=V}o=!o}o=o}if(o)j=l;else e=l}}t.push(l);if(G=="body")break}l=l.parent()}this.block=this.z=j;this.blockLimit=this.F=e;this.elements=this.elements=t}var u=
KISSY.DOM,J=r.m,A=r.n,B=U,v={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},n={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};D.prototype={Wc:function(l){var j=this.elements;l=l&&l.elements;if(!l||j.length!=l.length)return V;for(var e=0;e<j.length;e++)if(!u.g(j[e],l[e]))return V;return T},contains:function(l){for(var j=this.elements,e=0;e<j.length;e++)if(j[e].d()in l)return j[e];return B}};r.ElementPath=r.Sa=D;var f=D.prototype;r.k.o(f,{compare:f.Wc,
contains:f.contains})});
KISSY.Editor.add("walker",function(r){function D(t,G){if(this.c.end)return v;var o,k=this.xa,a,b=this.dc,d=this.type,m=t?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;k.trim();if(k.collapsed){this.end();return v}}if(!t&&!this.c.hd){var s=k.endContainer,i=new j(s[0].childNodes[k.endOffset]);this.c.hd=function(x,c){return(x=l.D(x))&&x[0]&&(!c||!l.g(s,x))&&(!i[0]||!x.g(i))&&(x[0].nodeType!=f.e||!c||x.d()!="body")}}if(t&&!this.c.jd){var h=k.startContainer,z=k.startOffset>
0&&new j(h[0].childNodes[k.startOffset-1]);this.c.jd=function(x,c){return(x=l.D(x))&&x[0]&&(!c||!x.g(h))&&(!z[0]||!x.g(z))&&(x[0].nodeType!=f.e||!c||x.d()!="body")}}var E=t?this.c.jd:this.c.hd;a=b?function(x,c){if(E(x,c)===B)return B;return b(x,c)}:E;if(this.fb)o=this.fb[m](B,d,a);else if(t){o=k.endContainer;if(k.endOffset>0){o=new j(o[0].childNodes[k.endOffset-1]);if(a(o)===B)o=v}else o=a(o,A)===B?v:o.ha(A,d,a)}else{o=k.startContainer;if((o=new j(o[0].childNodes[k.startOffset]))&&o[0]){if(a(o)===
B)o=v}else o=a(k.startContainer,A)===B?v:k.startContainer.w(A,d,a)}for(;o&&o[0]&&!this.c.end;){this.fb=o;if(!this.R||this.R(o)!==B){if(!G)return o}else if(G&&this.R)return B;o=o[m](B,d,a)}this.end();return this.fb=v}function u(t){for(var G,o=v;G=D.call(this,t);)o=G;return o}function J(t){this.xa=t;this.c={}}var A=T,B=V,v=U,n=KISSY,f=r.n,l=n.DOM,j=n.Node;n.augment(J,{end:function(){this.c.end=1},next:function(){return D.call(this)},pb:function(){return D.call(this,A)},Vc:function(){return D.call(this,
B,A)!==B},Uc:function(){return D.call(this,A,A)!==B},pd:function(){return u.call(this)},od:function(){return u.call(this,A)},reset:function(){delete this.fb;this.c={}}});J.Qb=function(t){return function(G){G=l.D(G);return!(G&&G[0].nodeType==f.e&&G.qa(t))}};J.Le=function(){return this.Qb({Rb:1})};J.ta=function(t,G){function o(k){return k&&k[0]&&k.d()=="span"&&k.attr("_ke_bookmark")}return function(k){var a,b;a=k&&k[0]&&k[0].nodeType==f.f&&(b=k.parent())&&o(b);a=t?a:a||o(k);return G^a}};J.Pa=function(t){return function(G){G=
(G=G[0]||G)&&G.nodeType==f.f&&!n.trim(G.nodeValue);return t^G}};J.Ge=function(t){var G=J.Pa();return function(o){o=G(o)||o[0].nodeType==f.e&&!o[0].offsetHeight;return t^o}};r.Ba=J;r.Walker=J;var e=J.prototype;r.k.o(e,{end:e.end,next:e.next,previous:e.pb,checkForward:e.Vc,checkBackward:e.Uc,lastForward:e.pd,lastBackward:e.od,reset:e.reset});r.k.o(J,{blockBoundary:J.Qb,listItemBoundary:J.Le,bookmark:J.ta,whitespaces:J.Pa,invisible:J.Ge})});
KISSY.Editor.add("range",function(r){function D(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=l;this.collapsed=n;this.document=c}function u(c){var g=c[0].nodeType!=e.f&&c.d()in d.ba,p=!j.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return g||p||c}function J(c){return!z(c)&&!E(c)}function A(c){var g=f,p=o.ta(n);return function(w){if(p(w))return n;if(w[0].nodeType==e.f){if(j.trim(w[0].nodeValue).length)return f}else if(w[0].nodeType==e.e)if(!h[w.d()])if(!c&&!b.ie&&
w.d()=="br"&&!g)g=n;else return f;return n}}function B(c,g){function p(w){return w&&w.nodeName=="span"&&w.getAttribute("_ke_bookmark")}return function(w){var q,C;q=w&&!w.nodeName&&(C=w.parentNode)&&p(C);q=c?q:q||p(w);return g^q}}function v(c){return function(g){g=(g=g[0]||g)&&g.nodeType==e.f&&!j.trim(g.nodeValue);return c^g}}r.oa={W:1,J:2,C:3,t:4,zb:1,yb:2,Ra:3,Va:1,Kd:2,of:3,ea:1,Bc:2};r.RANGE=r.oa;var n=T,f=V,l=U,j=KISSY,e=r.n,t=r.oa,G=r.Ta,o=r.Ba,k=j.DOM,a=r.k.bd,b=j.UA,d=r.m,m=r.Sa,s=j.Node,i=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};D.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};j.augment(D,{Oa:function(){this.collapsed=this.startContainer&&this.endContainer&&k.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},lc:function(){var c=this.startContainer,
g=this.startOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;g=this.endOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},ob:function(){var c=
this.startContainer,g=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.U(c,t.C);g&&g.d()=="span"&&g.attr("_ke_bookmark")&&this.T(g,t.t)},setStart:function(c,g){if(c[0].nodeType==e.e&&i[c.d()]){c=c.parent();g=c.v()}this.startContainer=c;this.startOffset=g;if(!this.endContainer){this.endContainer=c;this.endOffset=g}this.Oa()},setEnd:function(c,g){if(c[0].nodeType==e.e&&i[c.d()]){c=c.parent();g=c.v()+1}this.endContainer=c;this.endOffset=g;if(!this.startContainer){this.startContainer=
c;this.startOffset=g}this.Oa()},U:function(c,g){switch(g){case t.W:this.setStart(c,0);break;case t.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case t.C:this.setStartBefore(c);break;case t.t:this.setStartAfter(c)}this.Oa()},T:function(c,g){switch(g){case t.W:this.setEnd(c,0);break;case t.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case t.C:this.setEndBefore(c);break;case t.t:this.setEndAfter(c)}this.Oa()},
Xb:function(c,g){var p=this.startContainer,w=this.endContainer,q=this.startOffset,C=this.endOffset,Q,N=this.document,O;this.ob();if(w[0].nodeType==e.f)w=w.ia(C);else if(w[0].childNodes.length>0)if(C>=w[0].childNodes.length){w=new s(w[0].appendChild(N.createTextNode("")));O=n}else w=new s(w[0].childNodes[C]);if(p[0].nodeType==e.f){p.ia(q);if(p.g(w))w=new s(p[0].nextSibling)}else if(q)if(q>=p[0].childNodes.length){Q=new s(N.createTextNode(""));p.append(Q);p=Q;Q=n}else p=new s(p[0].childNodes[q].previousSibling);
else{Q=new s(N.createTextNode(""));(q=p[0].firstChild)?k.insertBefore(Q[0],q):p.append(Q);p=Q;Q=n}q=p.Kb();C=w.Kb();var P,W,S;for(P=0;P<q.length;P++){W=q[P];S=C[P];if(!W.g(S))break}N=g;for(var y,K,F,H=P;H<q.length;H++){y=q[H];if(N&&!y.g(p))K=N.appendChild(y.K()[0]);for(y=y[0].nextSibling;y;){if(k.g(C[H],y)||k.g(w,y))break;F=y.nextSibling;if(c==2)N.appendChild(y.cloneNode(n));else{y.parentNode.removeChild(y);c==1&&N.appendChild(y)}y=F}if(K)N=K}N=g;for(P=P;P<C.length;P++){y=C[P];if(c>0&&!y.g(w))K=N.appendChild(y.K()[0]);
if(!q[P]||!y.parent().g(q[P].parent()))for(y=y[0].previousSibling;y;){if(k.g(q[P],y)||k.g(p,y))break;F=y.previousSibling;if(c==2)N.insertBefore(y.cloneNode(n),N.firstChild);else{k.j(y);c==1&&N.insertBefore(y,N.firstChild)}y=F}if(K)N=K}if(c==2){S=this.startContainer[0];if(S.nodeType==e.f&&S.nextSibling&&S.nextSibling.nodeType==e.f){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}S=this.endContainer[0];if(S.nodeType==e.f&&S.nextSibling&&S.nextSibling.nodeType==e.f){S.data+=S.nextSibling.data;
S.parentNode.removeChild(S.nextSibling)}}else{if(W&&S&&(!p.parent().g(W.parent())||!w.parent().g(S.parent()))){W=S.v();Q&&S.parent().g(p.parent())&&W--;this.setStart(S.parent(),W)}this.collapse(n)}Q&&p.j();O&&w[0].parentNode&&w.j()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=n},clone:function(){var c=new D(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},ed:function(){var c=this.clone();c.lc();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return l;var g=new r.Ba(c),p=B(n,undefined),w=v(n);c.R=function(q){return w(q)&&p(q)};c=g.next();g.reset();g=g.pb();return c&&c.g(g)?c:l},Na:function(c,g){if(!this.collapsed){c=c||t.Bc;var p=this.clone(),w=this.startContainer,q=this.endContainer,C=this.startOffset,
Q=this.endOffset,N=1,O=1;if(w&&w[0].nodeType==e.f)if(C)if(C>=w[0].nodeValue.length)p.setStartAfter(w);else{p.setStartBefore(w);N=0}else p.setStartBefore(w);if(q&&q[0].nodeType==e.f)if(Q)if(Q>=q[0].nodeValue.length)p.setEndAfter(q);else{p.setEndAfter(q);O=0}else p.setEndBefore(q);p=new o(p);p.R=function(W){W=W[0]||W;return W.nodeType==(c==t.ea?e.e:e.f)};var P;p.dc=function(W,S){W=W[0]||W;if(c==t.ea&&W.nodeType==e.f)return f;if(S&&W==P)return f;if(!S&&W.nodeType==e.e)P=W;return n};if(N)(w=p[c==t.ea?
"lastForward":"next"]())&&this.U(w,g?t.W:t.C);if(O){p.reset();(p=p[c==t.ea?"lastBackward":"previous"]())&&this.T(p,g?t.J:t.t)}return!!(N||O)}},ze:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Xc:function(c){var g=this.startContainer,p=this.endContainer,w=this.startOffset,q=this.endOffset,C,Q;if(!g||!p)return{start:0,end:0};if(c){if(g[0].nodeType==e.e)if((C=new s(g[0].childNodes[w]))&&C[0]&&C[0].nodeType==e.f&&w>0&&C[0].previousSibling.nodeType==
e.f){g=C;w=0}for(;g[0].nodeType==e.f&&(Q=g.sa())&&Q[0].nodeType==e.f;){g=Q;w+=Q[0].nodeValue.length}if(!this.collapsed){if(p[0].nodeType==e.e)if((C=new s(p[0].childNodes[q]))&&C[0]&&C[0].nodeType==e.f&&q>0&&C[0].previousSibling.nodeType==e.f){p=C;q=0}for(;p[0].nodeType==e.f&&(Q=p.sa())&&Q[0].nodeType==e.f;){p=Q;q+=Q[0].nodeValue.length}}}return{start:g.Ca(c),end:this.collapsed?l:p.Ca(c),startOffset:w,endOffset:q,rd:c,He:n}},P:function(c){var g,p,w,q;g=new s("<span>",l,this.document);g.attr("_ke_bookmark",
1);g.css("display","none");g.html("&nbsp;");if(c){w=j.guid("ke_bm_");g.attr("id",w+"S")}if(!this.collapsed){p=g.K();p.html("&nbsp;");c&&p.attr("id",w+"E");q=this.clone();q.collapse();q.insertNode(p)}q=this.clone();q.collapse(n);q.insertNode(g);if(p){this.setStartAfter(g);this.setEndBefore(p)}else this.H(g,t.t);return{Z:c?w+"S":g,Q:c?w+"E":p,Cd:c}},H:function(c,g){this.U(c,g);this.collapse(n)},trim:function(c,g){var p=this.startContainer,w=this.startOffset,q=this.collapsed;if((!c||q)&&p[0]&&p[0].nodeType==
e.f){if(w)if(w>=p[0].nodeValue.length){w=p.v()+1;p=p.parent()}else{var C=p.ia(w);w=p.v()+1;p=p.parent();if(k.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(k.g(p,this.endContainer))this.endOffset+=1}else{w=p.v();p=p.parent()}this.setStart(p,w);if(q){this.collapse(n);return}}p=this.endContainer;w=this.endOffset;if(!(g||q)&&p[0]&&p[0].nodeType==e.f){if(w){w>=p.nodeValue.length||p.ia(w);w=p.v()+1}else w=p.v();p=p.parent();this.setEnd(p,w)}},insertNode:function(c){this.ob();
this.trim(f,n);var g=this.startContainer,p=g[0].childNodes[this.startOffset];this.ob();this.trim(f,n);p?k.insertBefore(c[0]||c,p):g[0].appendChild(c[0]||c);k.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.He){var g=a(this.document,c.start,c.rd),p=c.startOffset,w=c.end&&a(this.document,c.end,c.rd);c=c.endOffset;this.setStart(g,p);w?this.setEnd(w,c):this.collapse(n)}else{g=(p=c.Cd)?j.one("#"+c.Z,this.document):c.Z;c=p?j.one("#"+c.Q,this.document):
c.Q;this.setStartBefore(g);g.j();if(c&&c[0]){this.setEndBefore(c);c.j()}else this.collapse(n)}},va:function(c,g){var p=this.startContainer,w=this.endContainer;p=k.g(p,w)?c&&p[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new s(p[0].childNodes[this.startOffset]):p:p.Gb(w);return g&&p[0].nodeType==e.f?p.parent():p},Ia:function(c){switch(c){case t.zb:if(this.collapsed)break;c=this.va();var g=new s(this.document.body),p,w,q,C,Q,N=f,O,P;O=this.startContainer;P=this.startOffset;if(O[0].nodeType==
e.f){if(P){O=!j.trim(O[0].nodeValue.substring(0,P)).length&&O;N=!!O}if(O)if(!(C=O[0].previousSibling))q=O.parent()}else{if(P)C=O[0].childNodes[P-1]||O[0].lastChild;C||(q=O)}for(;q||C;){if(q&&!C){if(!Q&&k.g(q,c))Q=n;if(!g.L(q))break;if(!N||q.css("display")!="inline"){N=f;if(Q)p=q;else this.setStartBefore(q)}C=q[0].previousSibling}for(;C;){O=f;if(C.nodeType==e.f){P=C.nodeValue;if(/[^\s\ufeff]/.test(P))C=l;O=/[\s\ufeff]$/.test(P)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(N&&d.ba[C.nodeName.toLowerCase()]){P=
k.text(C);if(/[^\s\ufeff]/.test(P))C=l;else for(var W=C.all||C.getElementsByTagName("*"),S=0,y;y=W[S++];)if(!d.ba[y.nodeName.toLowerCase()]){C=l;break}if(C)O=!!P.length}else C=l;if(O)if(N)if(Q)p=q;else q&&this.setStartBefore(q);else N=n;if(C){O=C.previousSibling;if(!q&&!O){q=new s(C);C=l;break}C=O}else q=l}if(q)q=q.parent()}O=this.endContainer;P=this.endOffset;q=C=l;Q=N=f;if(O[0].nodeType==e.f){O=!j.trim(O[0].nodeValue.substring(P)).length&&O;N=!(O&&O[0].nodeValue.length);if(O)if(!(C=O[0].nextSibling))q=
O.parent()}else(C=O[0].childNodes[P])||(q=O);for(;q||C;){if(q&&!C){if(!Q&&k.g(q,c))Q=n;if(!g.L(q))break;if(!N||q.css("display")!="inline"){N=f;if(Q)w=q;else q&&this.setEndAfter(q)}C=q[0].nextSibling}for(;C;){O=f;if(C.nodeType==e.f){P=C.nodeValue;if(/[^\s\ufeff]/.test(P))C=l;O=/^[\s\ufeff]/.test(P)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(N&&d.ba[C.nodeName.toLowerCase()]){P=k.text(C);if(/[^\s\ufeff]/.test(P))C=l;else{W=C.all||C.getElementsByTagName("*");for(S=0;y=W[S++];)if(!d.ba[y.nodeName.toLowerCase()]){C=
l;break}}if(C)O=!!P.length}else C=l;if(O)if(N)if(Q)w=q;else this.setEndAfter(q);if(C){O=C.nextSibling;if(!q&&!O){q=new s(C);C=l;break}C=O}else q=l}if(q)q=q.parent()}if(p&&w){c=p.L(w)?w:p;this.setStartBefore(c);this.setEndAfter(c)}break;case t.yb:case t.Ra:q=new D(this.document);g=new s(this.document.body);q.U(g,t.W);q.setEnd(this.startContainer,this.startOffset);q=new o(q);var K,F,H=o.Qb(c==t.Ra?{Rb:1}:l),I=function(M){var L=H(M);L||(K=M);return L};p=function(M){var L=I(M);if(!L&&M[0]&&M.d()=="br")F=
M;return L};q.dc=I;q=q.od();K=K||g;this.U(K,K.d()!="br"&&(!q&&this.ua()||q&&K.L(q))?t.W:t.t);q=this.clone();q.collapse();q.T(g,t.J);q=new o(q);q.dc=c==t.Ra?p:I;K=l;q=q.pd();K=K||g;this.T(K,!q&&this.ka()||q&&K.L(q)?t.J:t.C);F&&this.setEndAfter(F)}},ua:function(){var c=this.startContainer,g=this.startOffset;if(g&&c[0].nodeType==e.f)if(j.trim(c[0].nodeValue.substring(0,g)).length)return f;this.trim();c=new m(this.startContainer);g=this.clone();g.collapse(n);g.U(c.z||c.F,t.W);c=new o(g);c.R=A(n);return c.Uc()},
ka:function(){var c=this.endContainer,g=this.endOffset;if(c[0].nodeType==e.f)if(j.trim(c[0].nodeValue.substring(g)).length)return f;this.trim();c=new m(this.endContainer);g=this.clone();g.collapse(f);g.T(c.z||c.F,t.J);c=new o(g);c.R=A(f);return c.Vc()},deleteContents:function(){this.collapsed||this.Xb(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Xb(1,c);return c},Tb:function(c,g){var p=this.clone();p[g==t.Va?"setStartAt":"setEndAt"](c,g==t.Va?t.W:
t.J);p=new o(p);p.R=u;return p[g==t.Va?"checkBackward":"checkForward"]()},ad:function(){var c=this.startContainer,g=this.endContainer,p=this.startOffset,w=this.endOffset,q;if(c[0].nodeType==e.e){q=c[0].childNodes.length;if(q>p)c=new s(c[0].childNodes[p]);else if(q<1)c=c.ha();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new s(c);c=c.w()||c}}if(g[0].nodeType==e.e){q=g[0].childNodes.length;if(q>w)g=(new s(g[0].childNodes[w])).ha(n);else if(q<1)g=g.ha();else{for(g=g[0];g.lastChild;)g=g.lastChild;g=new s(g)}}if(c.Da(g)&
G.ca)c=g;return{Z:c,Q:g}},gb:function(c,g){var p=this.P(),w=new s(this.document.createElement(g));this.collapse(c);this.Ia(t.yb);w[0].appendChild(this.extractContents());w.bb();b.ie||w.Eb();this.insertNode(w);this.moveToBookmark(p);return w},rc:function(c){var g=new m(this.startContainer),p=new m(this.endContainer),w=g.z,q=p.z,C=l;if(!g.F.g(p.F))return l;if(c!="br"){if(!w){w=this.gb(n,c);q=(new m(this.endContainer)).z}q||(q=this.gb(f,c))}c=w&&this.ua();g=q&&this.ka();this.deleteContents();if(w&&k.g(w,
q))if(g){C=new m(this.startContainer);this.H(q,t.t);q=l}else if(c){C=new m(this.startContainer);this.H(w,t.C);w=l}else{q=this.sc(w);!b.ie&&!j.inArray(w.d(),["ul","ol"])&&w.Eb()}return{If:w,Hf:q,Ze:c,Ye:g,Ef:C}},sc:function(c){if(!this.collapsed)return l;this.T(c,t.J);var g=this.extractContents(),p=c.K(f);p[0].appendChild(g);p.insertAfter(c);this.H(c,t.t);return p},kb:function(c,g){var p,w=r.m;if(w.ub[c.d()])return f;for(;c&&c[0].nodeType==e.e;){if(p=c.Ic())this.H(c,g?t.J:t.W);else if(w.vc[c.d()]){this.H(c,
g?t.t:t.C);return n}if((c=w.ub[c.d()]?c[g?"_4e_previous":"_4e_next"](J):c[g?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,g?t.t:t.C);return n}}return p},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var h={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},z=new o.Pa,E=new o.ta;r.Range=
D;r.Range=D;var x=D.prototype;r.k.o(x,{updateCollapsed:x.Oa,optimize:x.lc,setStartAfter:x.setStartAfter,setEndAfter:x.setEndAfter,setStartBefore:x.setStartBefore,setEndBefore:x.setEndBefore,optimizeBookmark:x.ob,setStart:x.setStart,setEnd:x.setEnd,setStartAt:x.U,setEndAt:x.T,execContentsAction:x.Xb,collapse:x.collapse,clone:x.clone,getEnclosedNode:x.ed,shrink:x.Na,getTouchedStartNode:x.ze,createBookmark2:x.Xc,createBookmark:x.P,moveToPosition:x.H,trim:x.trim,insertNode:x.insertNode,moveToBookmark:x.moveToBookmark,
getCommonAncestor:x.va,enlarge:x.Ia,checkStartOfBlock:x.ua,checkEndOfBlock:x.ka,deleteContents:x.deleteContents,extractContents:x.extractContents,checkBoundaryOfElement:x.Tb,getBoundaryNodes:x.ad,fixBlock:x.gb,splitBlock:x.rc,splitElement:x.sc,moveToElementEditablePosition:x.kb,selectNodeContents:x.selectNodeContents})});
KISSY.Editor.add("domiterator",function(r){function D(o){if(!(arguments.length<1)){this.xa=o;this.Zb=J;this.$c=u;this.Wb=J;this.c||(this.c={})}}var u=T,J=V,A=KISSY,B=A.UA,v=r.Ba,n=r.Range,f=r.oa,l=r.n,j=r.Sa,e=A.Node,t=A.DOM,G=/^[\r\n\t ]*$/;v.ta();A.augment(D,{ye:function(o){var k,a,b,d,m;if(!this.c.I){a=this.xa.clone();a.Na(f.ea,u);a.Ia(this.Zb||!this.$c?f.Ra:f.yb);var s=new v(a),i=v.ta(u,u);s.R=i;this.c.la=s.next();s=new v(a);s.R=i;s=s.pb();this.c.I=s.w(u);if(this.c.I&&this.c.I[0].nodeType==l.f&&
!A.trim(this.c.I[0].nodeValue)&&this.c.I.parent().qa()){i=new n(a.document);i.H(this.c.I,f.t);if(i.ka()){i=new j(i.endContainer);this.c.I=(i.z||i.F).w(u)}}if(!this.c.I){this.c.I=this.c.Zc=new e(a.document.createTextNode(""));t.insertAfter(this.c.I[0],s[0])}a=U}i=this.c.la;s=this.c.I;for(this.c.la=U;i;){var h=J,z=i[0].nodeType!=l.e,E=J;if(z){if(i[0].nodeType==l.f)if(G.test(i[0].nodeValue))z=J}else{var x=i.d();if(i.qa(this.Zb&&{Rb:1})){if(x=="br")z=u;else if(!a&&!i[0].childNodes.length&&x!="hr"){k=
i;b=i.g(s);break}if(a){a.T(i,f.C);if(x!="br")this.c.la=i}h=u}else{if(i[0].firstChild){if(!a){a=new n(this.xa.document);a.U(i,f.C)}i=new e(i[0].firstChild);continue}z=u}}if(z&&!a){a=new n(this.xa.document);a.U(i,f.C)}b=(!h||z)&&i.g(s);if(a&&!h)for(;!i[0].nextSibling&&!b;){x=i.parent();if(x.qa(this.Zb&&{Rb:1})){h=u;b||x.g(s);break}i=x;z=u;b=i.g(s);E=u}z&&a.T(i,f.t);i=i.w(E,U,s);if((b=!i)||h&&a)break}if(!k){if(!a){this.c.Zc&&this.c.Zc.j();return this.c.la=U}k=new j(a.startContainer);i=k.F;h={Cf:1,Nf:1,
Mf:1};k=k.z;if((!k||!k[0])&&!this.Wb&&h[i.d()]&&a.ua()&&a.ka())k=i;else if(!k||this.Wb&&k.d()=="li"){k=new e(this.xa.document.createElement(o||"p"));k[0].appendChild(a.extractContents());k.bb();a.insertNode(k);d=m=u}else if(k.d()!="li"){if(!a.ua()||!a.ka()){k=k.K(J);k[0].appendChild(a.extractContents());k.bb();m=a.rc();d=!m.Ze;m=!m.Ye;a.insertNode(k)}}else if(!b)this.c.la=k.g(s)?U:a.ad().Q.w(u,U,s)}if(d){a=new e(k[0].previousSibling);if(a[0]&&a[0].nodeType==l.e)if(a.d()=="br")a.j();else a[0].lastChild&&
t.d(a[0].lastChild)=="br"&&t.j(a[0].lastChild)}if(m){a=v.ta(J,u);d=new e(k[0].lastChild);if(d[0]&&d[0].nodeType==l.e&&d.d()=="br")if(B.ie||d.sa(a)||d.Za(a))d.j()}if(!this.c.la)this.c.la=b||k.g(s)?U:k.w(u,U,s);return k}});n.prototype.qe=function(){return new D(this)}});
KISSY.Editor.add("selection",function(r){function D(i){this.document=this.document=i;this.c={N:{}};if(f.ie){var h=this.r().createRange();if(!h||h.item&&h.item(0).ownerDocument!=i||h.parentElement&&h.parentElement().ownerDocument!=i)this.nd=A}}function u(i){i=new D(i);return!i||i.nd?v:i}function J(i){var h=i.document,z=new e(h.body),E=new e(h.documentElement);if(f.ie){if(f.ie<8||document.documentMode==7)E.on("click",function(N){l.d(N.target)==="html"&&i.getSelection().A()[0].select()});var x,c,g=1;
E.on("mousedown",function(){g=0});E.on("mouseup",function(){g=1});z.on("focusin",function(N){if(l.d(N.target)=="body")if(x){try{g&&x.select()}catch(O){}x=v}});z.on("focus",function(){c=A;w()});z.on("beforedeactivate",function(N){if(!N.relatedTarget){c=B;g=1}});j.on(l.ga(h),"blur",function(){h&&h.selection.empty()});z.on("mousedown",function(){p()});z.on("mouseup",function(){c=A;setTimeout(function(){w(A)},0)});var p=function(){c=B},w=function(N){if(c){var O=i.document,P=i.getSelection(),W=P&&P.hb(),
S=P&&P.r();if(N&&S&&W==t.Bb)if(!O.queryCommandEnabled("InsertImage")){setTimeout(function(){w(A)},50);return}var y;if(!(S&&W==t.pa&&(y=l.d(S.createRange().parentElement()))&&y in{input:1,textarea:1})){x=S&&P.A()[0];i.cb()}}};z.on("keydown",p);z.on("keyup",function(){c=A;w()});j.on(h,"selectionchange",w)}else{j.on(h,"mouseup",i.cb,i);j.on(h,"keyup",i.cb,i)}var q={table:1,pre:1},C=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,Q=r.Ba.Pa(A);
i.on("selectionChange",function(N){var O=N.path;N=(N=N.selection)&&N.A()[0];var P=O.F;if(N)if(N.collapse&&!O.z&&P.d()=="body"){O=N.gb(A,"p");if(O.$a().match(C))if((P=O.Za(Q))&&P[0].nodeType==o.e&&!q[P.d()]){N.kb(P);O.j()}else if((P=O.sa(Q))&&P[0].nodeType==o.e&&!q[P.d()]){N.kb(P,P.$a().match(C)?B:A);O.j()}N.select();f.ie||i.lb()}})}r.Nd={Bb:1,pa:2,Ua:3};var A=T,B=V,v=U,n=KISSY,f=n.UA,l=n.DOM,j=n.Event,e=n.Node,t=r.Nd,G=r.oa,o=r.n,k=r.Ba,a=r.Range,b={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};n.augment(D,{r:f.ie?function(){var i=this.c.N;return i.jc||(i.jc=this.document.selection)}:function(){var i=this.c.N;return i.jc||(i.jc=l.ga(this.document).getSelection())},hb:f.ie?function(){var i=this.c.N;if(i.type)return i.type;var h=t.Bb;try{var z=this.r(),E=z.type;if(E=="Text")h=t.pa;if(E=="Control")h=t.Ua;if(z.createRange().parentElement)h=t.pa}catch(x){}return i.type=h}:function(){var i=this.c.N;
if(i.type)return i.type;var h=t.pa,z=this.r();if(z){if(z.rangeCount==1){z=z.getRangeAt(0);var E=z.startContainer;if(E==z.endContainer&&E.nodeType==o.e&&z.endOffset-z.startOffset===1&&b[E.childNodes[z.startOffset].nodeName.toLowerCase()])h=t.Ua}}else h=t.Bb;return i.type=h},A:f.ie?function(){function i(h,z){h=h.duplicate();h.collapse(z);for(var E=h.parentElement(),x=E.childNodes,c,g=0;g<x.length;g++){var p=x[g];if(p.nodeType==o.e){c=h.duplicate();c.moveToElementText(p);p=c.compareEndPoints("StartToStart",
h);var w=c.compareEndPoints("EndToStart",h);c.collapse();if(p>0)break;else if(!p||w==1&&p==-1)return{Ha:E,offset:g};else if(!w)return{Ha:E,offset:g+1};c=v}}if(!c){c=h.duplicate();c.moveToElementText(E);c.collapse(B)}c.setEndPoint("StartToStart",h);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=x[--g].nodeValue.length}catch(q){c=0}return c===0?{Ha:E,offset:g}:{Ha:x[g],offset:-c}}return function(){var h=this.c.N;if(h.na)return h.na;var z=this.r(),E=z&&z.createRange(),x=this.hb();if(!z)return[];
if(x==t.pa){z=new a(this.document);x=i(E,A);z.setStart(new e(x.Ha),x.offset);x=i(E);z.setEnd(new e(x.Ha),x.offset);return h.na=[z]}else if(x==t.Ua){h=h.na=[];for(x=0;x<E.length;x++){var c=E.item(x),g=c.parentNode,p=0;for(z=new a(this.document);p<g.childNodes.length&&g.childNodes[p]!=c;p++);z.setStart(new e(g),p);z.setEnd(new e(g),p+1);h.push(z)}return h}return h.na=[]}}():function(){var i=this.c.N;if(i.na)return i.na;var h=[],z=this.r();if(!z)return[];for(var E=0;E<z.rangeCount;E++){var x=z.getRangeAt(E),
c=new a(this.document);c.setStart(new e(x.startContainer),x.startOffset);c.setEnd(new e(x.endContainer),x.endOffset);h.push(c)}return i.na=h},cc:function(){var i=this.c.N;if(i.Dd!==undefined)return i.Dd;var h,z=this.r();switch(this.hb()){case t.Ua:return this.bc();case t.pa:var E=this.A()[0];if(E)if(!E.collapsed){for(E.lc();A;){h=E.startContainer;if(E.startOffset==(h[0].nodeType===o.e?h[0].childNodes.length:h[0].nodeValue.length)&&!h.qa())E.setStartAfter(h);else break}h=E.startContainer;if(h[0].nodeType!=
o.e)return h.parent();h=new e(h[0].childNodes[E.startOffset]);if(!h[0]||h[0].nodeType!=o.e)return E.startContainer;for(E=h[0].firstChild;E&&E.nodeType==o.e;){h=new e(E);E=E.firstChild}return h}if(f.ie){E=z.createRange();E.collapse(A);h=E.parentElement()}else if((h=z.anchorNode)&&h.nodeType!=o.e)h=h.parentNode}return i.Dd=h?l.D(h):v},bc:function(){var i=this,h,z=i.c.N;if(z.Bd!==undefined)return z.Bd;if(f.ie){h=i.r().createRange();h=h.item&&h.item(0)}h||(h=function(){for(var E=i.A()[0],x,c,g=2;g&&!((x=
E.ed())&&x[0].nodeType==o.e&&b[x.d()]&&(c=x));g--)E.Na(G.ea);return c&&c[0]}());return z.Bd=l.D(h)},reset:function(){this.c.N={}},qc:function(i){var h;if(f.ie)try{h=this.document.body.createControlRange();h.addElement(i[0]);h.select()}catch(z){h=this.document.body.createTextRange();h.moveToElementText(i[0]);h.select()}finally{}else{h=this.document.createRange();h.selectNode(i[0]);i=this.r();i.removeAllRanges();i.addRange(h)}this.reset()},sb:function(i){if(f.ie)i[0]&&i[0].select();else{var h=this.r();
if(!h)return;h.removeAllRanges();for(var z=0;z<i.length;z++){var E=i[z],x=this.document.createRange(),c=E.startContainer;E.collapsed&&f.gecko&&f.gecko<1.09&&c[0].nodeType==o.e&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));x.setStart(c[0],E.startOffset);x.setEnd(E.endContainer[0],E.endOffset);h.addRange(x)}}this.reset()},pe:function(i){for(var h=[],z=this.A(),E=0;E<z.length;E++)h.push(z[E].Xc(i));return h},oe:function(i){for(var h=[],z=this.A(),E=z.length,x=this.document,
c,g=0;g<E;g++){h.push(c=z[g].P(i,A));var p=(i=c.Cd)?n.one("#"+c.Z,x):c.Z;c=i?n.one("#"+c.Q,x):c.Q;for(var w=g+1;w<E;w++){var q=z[w],C=q.startContainer,Q=q.endContainer;l.g(C,p.parent())&&q.startOffset++;l.g(C,c.parent())&&q.startOffset++;l.g(Q,p.parent())&&q.endOffset++;l.g(Q,c.parent())&&q.endOffset++}}return h},pc:function(i){for(var h=[],z=0;z<i.length;z++){var E=new a(this.document);E.moveToBookmark(i[z]);h.push(E)}this.sb(h);return this},va:function(){var i=this.A();return i[0].startContainer.Gb(i[i.length-
1].endContainer)},scrollIntoView:function(){var i=this.cc();i&&i.Lb()},removeAllRanges:function(){var i=this.r();f.ie?i.clear():i.removeAllRanges()}});var d={table:1,tbody:1,tr:1},m=k.Pa(A),s=/\ufeff|\u00a0/;a.prototype.select=a.prototype.select=f.ie?function(i){var h=this.collapsed,z,E;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var x=this.startContainer[0].childNodes[this.startOffset];if(x.nodeType==o.e){(new D(this.document)).qc(new e(x));return}}if(this.startContainer[0].nodeType==
o.e&&this.startContainer.d()in d||this.endContainer[0].nodeType==o.e&&this.endContainer.d()in d)this.Na(G.ea,A);var c=this.P();x=c.Z;var g;if(!h)g=c.Q;c=this.document.body.createTextRange();c.moveToElementText(x[0]);c.moveStart("character",1);if(g){i=this.document.body.createTextRange();i.moveToElementText(g[0]);c.setEndPoint("EndToEnd",i);c.moveEnd("character",-1)}else{for(z=x[0].nextSibling;z&&!m(z);)z=z.nextSibling;z=!(z&&z.nodeValue&&z.nodeValue.match(s))&&(i||!x[0].previousSibling||x[0].previousSibling&&
l.d(x[0].previousSibling)=="br");E=this.document.createElement("span");E.innerHTML="&#65279;";E=new e(E);l.insertBefore(E[0],x[0]);z&&l.insertBefore(this.document.createTextNode("\ufeff"),x[0])}this.setStartBefore(x);x.j();if(h){if(z){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(E){this.H(E,G.C);E.j()}}else{this.setEndBefore(g);g.j();c.select()}}:function(){var i=this.startContainer;this.collapsed&&i[0].nodeType==o.e&&!i[0].childNodes.length&&i[0].appendChild(this.document.createTextNode(""));
var h=this.document.createRange();h.setStart(i[0],this.startOffset);try{h.setEnd(this.endContainer[0],this.endOffset)}catch(z){if(z.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(A);h.setEnd(this.endContainer[0],this.endOffset)}else throw z;}i=u(this.document).r();i.removeAllRanges();i.addRange(h)};D.getSelection=u;r.Dc=D;r.Selection=D;k=D.prototype;r.k.o(k,{getNative:k.r,getType:k.hb,getRanges:k.A,getStartElement:k.cc,getSelectedElement:k.bc,reset:k.reset,selectElement:k.qc,selectRanges:k.sb,
createBookmarks2:k.pe,createBookmarks:k.oe,selectBookmarks:k.pc,getCommonAncestor:k.va,scrollIntoView:k.scrollIntoView,selectBookmarks:k.pc,removeAllRanges:k.removeAllRanges});r.on("instanceCreated",function(i){J(i.te)})});
KISSY.Editor.add("styles",function(r){function D(y,K){for(var F in y)y[F]=y[F].replace(W,function(H,I){return K[I]})}function u(y,K){if(K){y=h.clone(y);D(y.attributes,K);D(y.styles,K)}var F=this.element=this.element=(y.element||"*").toLowerCase();this.type=this.type=F=="#"||N[F]?E.Cb:O[F]?E.Wa:E.Aa;this.c={definition:y}}function J(y,K){var F=K?this.oc:this.Ob;y.body.focus();for(var H=new c(y),I=H.A(),M=0;M<I.length;M++)F.call(this,I[M]);H.sb(I)}function A(y,K){var F;F=y.element;if(F=="*")F="span";
F=new q(K.createElement(F));return B(F,y)}function B(y,K){var F=K.c.definition,H=F.attributes;F=u.gd(F);if(H)for(var I in H)y.attr(I,H[I]);if(F)y[0].style.cssText=F;return y}function v(y){var K=y.P(m),F=y.qe();F.Wb=m;F.$c=m;for(var H,I=y.document;H=F.ye();){var M=A(this,I);H=H;var L=M;M=L.d=="pre";var R=H.d=="pre",$=!M&&R;if(M&&!R){R=H;L=L;$=R.html();$=n($,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");$=$.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");$=$.replace(/([ \t\n\r]+|&nbsp;)/g," ");$=$.replace(/<br\b[^>]*>/gi,
"\n");if(C.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+$+"</pre>";L=new q(R.firstChild);L.j()}else L.html($);L=L}else if($)L=l(f(H),L);else H.Jb(L);H[0].parentNode.replaceChild(L[0],H[0]);if(M){H=L;M=void 0;if((M=H.ha(m,g.e))&&M.d()=="pre"){L=n(M.html(),/\n$/,"")+"\n\n"+n(H.html(),/^\n/,"");if(C.ie)H[0].outerHTML="<pre>"+L+"</pre>";else H.html(L);M.j()}}}y.moveToBookmark(K)}function n(y,K,F){var H="",I="";y=y.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(M,L,R){L&&(H=L);R&&(I=R);return""});return H+y.replace(K,F)+I}function f(y){var K=[];n(y.$a(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(F,H,I){return H+"</pre>"+I+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(F,H){K.push(H)});return K}function l(y,K){for(var F=K[0].ownerDocument.createDocumentFragment(),H=0;H<y.length;H++){var I=y[H];I=I.replace(/(\r\n|\r)/g,"\n");I=n(I,/^[ \t]*\n/,"");I=n(I,/\n$/,"");I=n(I,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});I=I.replace(/\n/g,"<br>");I=I.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=K.K();M.html(I);F.appendChild(M[0])}return F}function j(y){var K=y.document;if(y.collapsed){K=A(this,K);y.insertNode(K);y.H(K,x.J)}else{var F=this.element,H=this.c.definition,I,M=r.m[F]||(I=m,r.m.span),L=y.P();y.Ia(x.zb);y.trim();var R=y.P(),$=R.Z;R=R.Q;for(var Z=$,ba;Z&&Z[0];){var X=s;if(z.g(Z,R)){Z=i;
X=m}else{var Y=Z[0].nodeType,ea=Y==g.e?Z.d():i;if(ea&&Z.attr("_ke_bookmark")){Z=Z.w(m);continue}if(!ea||M[ea]&&(Z.Da(R)|p.Y|p.da|p.X)==p.Y+p.da+p.X&&(!H.childRule||H.childRule(Z))){var aa=Z.parent();if(aa&&aa[0]&&((r.m[aa.d()]||r.m.span)[F]||I)&&(!H.parentRule||H.parentRule(aa))){if(!ba&&(!ea||!r.m.ba[ea]||(Z.Da(R)|p.Y|p.da|p.X)==p.Y+p.da+p.X)){ba=new w(K);ba.setStartBefore(Z)}if(Y==g.f||Y==g.e&&!Z[0].childNodes.length){Y=Z;for(var ca;!Y[0].nextSibling&&(ca=Y.parent(),M[ca.d()])&&(ca.Da($)|p.ca|p.da|
p.X)==p.ca+p.da+p.X&&(!H.childRule||H.childRule(ca));)Y=ca;ba.setEndAfter(Y);Y[0].nextSibling||(X=m)}}else X=m}else X=m;Z=Z.w()}if(X&&ba&&!ba.collapsed){X=A(this,K);for(Y=ba.va();X&&Y&&X[0]&&Y[0];){if(Y.d()==F){for(var da in H.attributes)X.attr(da)==Y.attr(da)&&X[0].removeAttribute(da);for(var ha in H.styles)X.M(ha)==Y.M(ha)&&X.M(ha,"");if(!X.Ya()){X=i;break}}Y=Y.parent()}if(X){X[0].appendChild(ba.extractContents());Y=X;ea=o(this);aa=Y.all(this.element);for(var fa=aa.length;--fa>=0;)k(this,new q(aa[fa]));
var ga=void 0;for(ga in ea)if(ga!=this.element){aa=Y.all(ga);for(fa=aa.length-1;fa>=0;fa--){var ia=new q(aa[fa]);b(ia,ea[ga])}}ba.insertNode(X);X.ra();C.ie||X[0].normalize()}ba=i}}$.j();R.j();y.moveToBookmark(L);y.Na(x.Bc)}}function e(y){y.Ia(x.zb);var K=y.P(),F=K.Z;if(y.collapsed){for(var H=new Q(F.parent()),I,M=0,L;M<H.elements.length&&(L=H.elements[M]);M++){if(L==H.z||L==H.F)break;if(this.ja(L)){var R=y.Tb(L,x.Kd),$=!R&&y.Tb(L,x.Va);if($||R){I=L;I.match=$?"start":"end"}else{L.ra();L.d()==this.element?
k(this,L):b(L,o(this)[L.d()])}}}if(I&&I[0]){L=F;for(M=0;;M++){R=H.elements[M];if(z.g(R,I))break;else if(R.match)continue;else R=R.K();R[0].appendChild(L[0]);L=R}z[I.match=="start"?"insertBefore":"insertAfter"](L[0],I[0])}}else{var Z=K.Q,ba=this;H=function(){for(var X=new Q(F.parent()),Y=new Q(Z.parent()),ea=i,aa=i,ca=0;ca<X.elements.length;ca++){var da=X.elements[ca];if(da==X.z||da==X.F)break;if(ba.ja(da))ea=da}for(ca=0;ca<Y.elements.length;ca++){da=Y.elements[ca];if(da==Y.z||da==Y.F)break;if(ba.ja(da))aa=
da}aa&&Z.Fb(aa);ea&&F.Fb(ea)};H();for(I=new q(F[0].nextSibling);I[0]!==Z[0];){M=I.w();if(I[0]&&I[0].nodeType==g.e&&this.ja(I)){I.d()==this.element?k(this,I):b(I,o(this)[I.d()]);if(M[0].nodeType==g.e&&M.L(F)){H();M=new q(F[0].nextSibling)}}I=M}}y.moveToBookmark(K)}function t(y){var K={};y.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(F,H,I){K[H]=I});return K}function G(y,K){var F;if(K!==s){F=document.createElement("span");F.style.cssText=y;F=F.style.cssText||""}else F=
y;return F.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function o(y){if(y.c.Ad)return y.c.Ad;var K=y.c.Ad={},F=y.c.definition.overrides;if(F){h.isArray(F)||(F=[F]);for(var H=0;H<F.length;H++){var I=F[H],M,L;if(typeof I=="string")M=I.toLowerCase();else{M=I.element?I.element.toLowerCase():y.element;L=I.attributes}I=K[M]||(K[M]={});if(L){I=I.attributes=I.attributes||[];for(var R in L)I.push([R.toLowerCase(),L[R]])}}}return K}function k(y,K){var F=y.c.definition,
H=h.mix(h.mix({},F.attributes),o(y)[K.d()]);F=F.styles;var I=h.isEmptyObject(H)&&h.isEmptyObject(F),M;for(M in H)if(!((M=="class"||y.c.definition.fullMatch)&&K.attr(M)!=a(M,H[M]))){I=I||!!K.Hc(M);K.removeAttr(M)}for(var L in F)if(!(y.c.definition.fullMatch&&K.M(L)!=a(L,F[L],m))){I=I||!!K.M(L);K.M(L,"")}I&&d(K)}function a(y,K,F){var H=new q("<span>");H[F?"_4e_style":"attr"](y,K);return H[F?"_4e_style":"attr"](y)}function b(y,K){var F=K&&K.attributes;if(F)for(var H=0;H<F.length;H++){var I=F[H][0],M;
if(M=y.attr(I)){var L=F[H][1];if(L===i||L.test&&L.test(M)||typeof L=="string"&&M==L)y[0].removeAttribute(I)}}d(y)}function d(y){if(!y.Ya()){var K=y[0].firstChild,F=y[0].lastChild;y.j(m);if(K){K.nodeType==g.e&&z.ra(K);F&&!K===F&&F.nodeType==g.e&&z.ra(F)}}}var m=T,s=V,i=U,h=KISSY,z=h.DOM,E={Cb:1,Aa:2,Wa:3},x=r.oa,c=r.Dc,g=r.n,p=r.Ta,w=r.Range,q=h.Node,C=h.UA,Q=r.Sa,N={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},O={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,
dd:1,form:1},P=/\s*(?:;\s*|$)/,W=/#\((.+?)\)/g;r.pf=E;u.prototype={apply:function(y){J.call(this,y,s)},remove:function(y){J.call(this,y,m)},Ob:function(y){return(this.Ob=this.type==E.Aa?j:this.type==E.Cb?v:this.type==E.Wa?i:i).call(this,y)},oc:function(y){return(this.oc=this.type==E.Aa?e:i).call(this,y)},de:function(y){B(y,this)},ja:function(y,K){if(!y)return s;var F=this.c.definition;if(y.d()==this.element){if(!K&&!y.Ya())return m;var H=F.Wd;if(H)F=H;else{H={};var I=0,M=F.attributes;if(M)for(var L in M){I++;
H[L]=M[L]}if(M=u.gd(F)){H.style||I++;H.style=M}H._length=I;F=F.Wd=H}if(F._length){for(var R in F)if(R!="_length"){I=y.attr(R)||"";if(R=="style")a:{H=F[R];I=G(I,s);typeof H=="string"&&(H=t(H));typeof I=="string"&&(I=t(I));M=void 0;for(M in H)if(!(M in I&&(I[M]==H[M]||H[M]=="inherit"||I[M]=="inherit"))){H=s;break a}H=m}else H=F[R]==I;if(H){if(!K)return m}else if(K)return s}if(K)return m}else return m}if(R=o(this)[y.d()]){if(!(F=R.attributes))return m;for(H=0;H<F.length;H++){R=F[H][0];if(R=y.attr(R)){I=
F[H][1];if(I===i||typeof I=="string"&&R==I||I.test&&I.test(R))return m}}}return s},le:function(y){switch(this.type){case E.Cb:return this.ja(y.z||y.F,m);case E.Wa:case E.Aa:for(var K=y.elements,F=0,H;F<K.length;F++){H=K[F];if(!(this.type==E.Aa&&(z.g(H,y.z)||z.g(H,y.F))))if(!(this.type==E.Wa&&!(H.d()in O)))if(this.ja(H,m))return m}}return s}};u.gd=function(y){var K=y.Xd;if(K)return K;K=y.styles;var F=y.attributes&&y.attributes.style||"",H="";if(F.length)F=F.replace(P,";");for(var I in K){var M=K[I],
L=(I+":"+M).replace(P,";");if(M=="inherit")H+=L;else F+=L}if(F.length)F=G(F);F+=H;return y.Xd=F};r.rf=u;r.Style=u;var S=u.prototype;r.k.o(S,{apply:S.apply,remove:S.remove,applyToRange:S.Ob,removeFromRange:S.oc,applyToObject:S.de,checkElementRemovable:S.ja,checkActive:S.le})});
KISSY.Editor.add("htmlparser",function(){function r(){}function D(){this.c={kd:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var u=KISSY,J=u.Editor,A=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,B={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},v=J.m;u.augment(D,{wa:r,zd:r,ma:r,vd:r,La:r,parse:function(n){for(var f,
l,j=0,e;f=this.c.kd.exec(n);){l=f.index;if(l>j){j=n.substring(j,l);e?e.push(j):this.ma(j)}j=this.c.kd.lastIndex;if(l=f[1]){l=l.toLowerCase();if(e&&v.uc[l]){this.vd(e.join(""));e=U}if(!e){this.zd(l);continue}}if(e)e.push(f[0]);else if(l=f[3]){l=l.toLowerCase();if(!/="/.test(l)){var t={},G;f=f[4];var o=!!(f&&f.charAt(f.length-1)=="/");if(f)for(;G=A.exec(f);){var k=G[1].toLowerCase();G=G[2]||G[3]||G[4]||"";t[k]=!G&&B[k]?k:G}this.wa(l,t,o);if(!e&&v.uc[l])e=[]}}else if(l=f[2])this.La(l)}n.length>j&&this.ma(n.substring(j,
n.length))}});J.h=D;J.HtmlParser=D});
KISSY.Editor.add("htmlparser-basicwriter",function(){function r(){this.c={l:[]}}var D=KISSY,u=D.Editor,J=u.k;D.augment(r,{mb:function(A){this.c.l.push("<",A)},nb:function(A,B){B?this.c.l.push(" />"):this.c.l.push(">")},db:function(A,B){if(typeof B=="string")B=J.fc(B);this.c.l.push(" ",A,'="',B,'"')},eb:function(A){this.c.l.push("</",A,">")},text:function(A){this.c.l.push(A)},O:function(A){this.c.l.push("<!--",A,"--\>")},write:function(A){this.c.l.push(A)},reset:function(){this.c.l=[];this.c.B=V},
$b:function(A){var B=this.c.l.join("");A&&this.reset();return B}});u.h.xb=r;u.h.BasicWriter=r;D=r.prototype;u.k.o(D,{openTag:D.mb,openTagClose:D.nb,attribute:D.db,closeTag:D.eb,text:D.text,comment:D.O,write:D.write,reset:D.reset,getHtml:D.$b})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function r(){r.Lf.constructor.call(this);this.ld="\t";this.Re=" />";this.Ke="\n";this.we=B;this.Se=A;this.c.B=B;this.c.G="";this.c.rules={};var v=u.m,n;for(n in J.mix({},v.wb,v.Qa,v.vb,v.yc))this.ya(n,{B:A,he:A,Sb:A,Tc:!v[n]["#"],ge:A});this.ya("br",{Sb:A});this.ya("title",{B:B,Sb:B});this.ya("style",{B:B,Tc:A});this.ya("pre",{B:B})}var D=KISSY,u=D.Editor,J=u.k,A=T,B=V;D.extend(r,u.h.xb,{mb:function(v){var n=this.c.rules[v];if(this.c.B)this.G();
else if(n&&n.he){this.Ja();this.G()}this.c.l.push("<",v)},nb:function(v,n){var f=this.c.rules[v];if(n)this.c.l.push(this.Re);else{this.c.l.push(">");if(f&&f.B)this.c.G+=this.ld}f&&f.Sb&&this.Ja()},db:function(v,n){if(typeof n=="string"){this.we&&(n=n.replace(/&amp;/g,"&"));n=J.fc(n)}this.c.l.push(" ",v,'="',n,'"')},eb:function(v){var n=this.c.rules[v];if(n&&n.B)this.c.G=this.c.G.substr(this.ld.length);if(this.c.B)this.G();else if(n&&n.Tc){this.Ja();this.G()}this.c.l.push("</",v,">");n&&n.ge&&this.Ja()},
text:function(v){if(this.c.B){this.G();v=J.Ka(v)}this.c.l.push(v)},O:function(v){this.c.B&&this.G();this.c.l.push("<!--",v,"--\>")},Ja:function(){this.c.l.length>0&&this.c.l.push(this.Ke);this.c.B=A},G:function(){this.c.l.push(this.c.G);this.c.B=B},ya:function(v,n){var f=this.c.rules[v];if(f)J.mix(f,n);else this.c.rules[v]=n}});u.h.ff=r;u.h.HtmlWriter=r;D=r.prototype;u.k.o(D,{openTag:D.mb,openTagClose:D.nb,attribute:D.db,closeTag:D.eb,text:D.text,comment:D.O,lineBreak:D.Ja,indentation:D.G,setRules:D.ya})});
KISSY.Editor.add("htmlparser-fragment",function(){function r(){this.children=[];this.parent=J;this.c={S:D,ec:u}}var D=T,u=V,J=U,A=KISSY.Editor,B={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},v=KISSY,n=A.k,f=A.n,l=A.m,j=n.mix({table:1,ul:1,ol:1,dl:1},l.table,l.ul,l.ol,l.dl),e=l.Id,t=l.vb;r.Ab=function(G,o){function k(g){var p;if(s.length>0)for(var w=0;w<s.length;w++){var q=s[w],C=q.name,Q=l[C],N=h.name&&l[h.name];if((!N||N[C])&&(!g||!Q||Q[g]||!l[g])){if(!p){a();p=1}q=q.clone();
q.parent=h;h=q;s.splice(w,1);w--}}}function a(){for(;i.length;)h.add(i.shift())}function b(g,p,w){p=p||h||m;if(o&&!p.type){var q,C;if((q=g.attributes&&(C=g.attributes._ke_real_element_type)?C:g.name)&&!(q in l.tc)&&!(q in l.wb)){q=h;h=p;d.wa(o,{});p=h;if(w)h=q}}if(g.c.S&&g.name!="pre"){w=g.children.length;if((q=g.children[w-1])&&q.type==f.f)if(C=n.Ma(q.value))q.value=C;else g.children.length=w-1}p.add(g);if(g.qb){h=g.qb;delete g.qb}}var d=new A.h,m=new r,s=[],i=[],h=m,z=u,E;d.wa=function(g,p,w){var q=
new A.h.zc(g,p);if(q.ic&&w)q.jb=D;if(l.ba[g])s.push(q);else{if(g=="pre")z=D;else if(g=="br"&&z){h.add(new A.h.Db("\n"));return}if(g=="br")i.push(q);else{var C=h.name,Q=C&&(l[C]||(h.c.S?l.div:l.span));if(Q&&!q.ic&&!h.ic&&!Q[g]){Q=u;var N;if(g in e&&C in e){C=h.children;(C=C[C.length-1])&&C.name in t||b(C=new A.h.zc("li"),h);E=h;N=C}else if(g==C)b(h,h.parent);else{if(j[C])E||(E=h);else{b(h,h.parent,D);B[C]||s.unshift(h)}Q=D}h=N?N:h.qb||h.parent;if(Q){d.wa.apply(this,arguments);return}}k(g);a();q.parent=
h;q.qb=E;E=0;if(q.jb)b(q);else h=q}}};d.zd=function(g){for(var p=s.length-1;p>=0;p--)if(g==s[p].name){s.splice(p,1);return}for(var w=[],q=[],C=h;C.type&&C.name!=g;){C.c.S||q.unshift(C);w.push(C);C=C.parent}if(C.type){for(p=0;p<w.length;p++){var Q=w[p];b(Q,Q.parent)}h=C;if(h.name=="pre")z=u;C.c.S&&a();b(C,C.parent);if(C==h)h=h.parent;s=s.concat(q)}if(g=="body")o=u};d.ma=function(g){if(!h.c.ec&&!z){g=n.Ka(g);if(g.length===0)return}a();k();if(o&&(!h.type||h.name=="body")&&n.trim(g))this.wa(o,{});z||
(g=g.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));h.add(new A.h.Db(g))};d.vd=function(){};d.La=function(g){h.add(new A.h.Jd(g))};d.parse(G);for(a();h.type;){var x=h.parent,c=h;if(o&&(!x.type||x.name=="body")&&!l.tc[c.name]){h=x;d.wa(o,{});x=h}x.add(c);h=x}return m};v.augment(r,{add:function(G){var o=this.children.length;if(o=o>0&&this.children[o-1]||J){if(G.c.S&&o.type==f.f){o.value=n.Ma(o.value);if(o.value.length===0){this.children.pop();this.add(G);return}}o.next=G}G.pb=o;G.parent=this;this.children.push(G);
this.c.ec=G.type==f.f||G.type==f.e&&!G.c.S},aa:function(G,o){var k;this.filterChildren=this.Yb=function(){var a=new A.h.xb;this.V.call(this,a,o,D);a=a.$b();this.children=(new r.Ab(a)).children;k=1};!this.name&&o&&o.xd(this);this.V(G,k?J:o)},V:function(G,o){for(var k=0;k<this.children.length;k++)this.children[k].aa(G,o)}});A.h.za=r;A.h.Fragment=r;r.FromHtml=r.Ab;v=r.prototype;A.k.o(v,{add:v.add,writeHtml:v.aa,writeChildrenHtml:v.V})});
KISSY.Editor.add("htmlparser-element",function(){function r(B,v){B=B[0];v=v[0];return B<v?-1:B>v?1:0}function D(B,v){this.name=B;this.attributes=v||(v={});this.children=[];var n=v.tf||B,f=u.m;n=!!(f.wb[n]||f.Qa[n]||f.vb[n]||f.yc[n]||f.xc[n]||n=="br");var l=!!f.ub[B];this.jb=l;this.ic=!f[B];this.c={S:n,ec:l||!n}}var u=KISSY.Editor,J=u.n;KISSY.augment(D,{type:J.e,add:u.h.za.prototype.add,clone:function(){return new D(this.name,this.attributes)},aa:function(B,v){var n=this.attributes,f=this,l=f.name,
j,e,t,G;f.Yb=function(){if(!G){var a=new u.h.xb;u.h.za.prototype.V.call(f,a,v);f.children=(new u.h.za.Ab(a.$b())).children;G=1}};f.filterChildren=f.Yb;if(v){for(;;){if(!(l=v.wd(l)))return;f.name=l;if(!(f=v.kc(f)))return;f.parent=this.parent;if(f.name==l)break;if(f.type!=J.e){f.aa(B,v);return}l=f.name;if(!l){this.V.call(f,B,G?U:v);return}}n=f.attributes}B.mb(l,n);for(var o=[],k=0;k<2;k++)for(j in n){e=j;t=n[j];if(k==1)o.push([j,t]);else if(v){for(;;)if(e=v.ud(j))if(e!=j){delete n[j];j=e}else break;
else{delete n[j];break}if(e)if((t=v.sd(f,e,t))===V)delete n[e];else n[e]=t}}B.Se&&o.sort(r);n=o.length;for(k=0;k<n;k++){j=o[k];B.db(j[0],j[1])}B.nb(l,f.jb);if(!f.jb){this.V.call(f,B,G?U:v);B.eb(l)}},V:function(){u.h.za.prototype.V.apply(this,arguments)}});u.h.zc=D;u.h.Element=D;var A=D.prototype;u.k.o(A,{type:A.type,add:A.add,clone:A.clone,writeHtml:A.aa,writeChildrenHtml:A.V})});
KISSY.Editor.add("htmlparser-filter",function(){function r(j){this.c={Vb:[],Pb:[],elements:{wc:0},attributes:{wc:0}};j&&this.Sc(j,10)}function D(j,e){for(var t=0;j&&t<e.length;t++){var G=e[t];j=j.replace(G[0],G[1])}return j}function u(j,e,t){if(typeof e=="function")e=[e];var G,o;o=j.length;var k=e&&e.length;if(k){for(G=0;G<o&&j[G].nc<t;G++);for(o=k-1;o>=0;o--)if(k=e[o]){k.nc=t;j.splice(G,0,k)}}}function J(j,e,t){if(e)for(var G in e){var o=j[G];j[G]=A(o,e[G],t);o||j.wc++}}function A(j,e,t){if(e){e.nc=
t;if(j){if(j.splice)u(j,e,t);else{j=j.nc>t?[e,j]:[j,e];j.filter=B}return j}else return e.filter=e}}function B(j){for(var e=j.type||j instanceof n.h.za,t=0;t<this.length;t++){if(e)var G=j.type,o=j.name;var k=this[t].apply(window,arguments);if(k===l)return k;if(e){if(k&&(k.name!=o||k.type!=G))return k}else if(typeof k!="string")return k;k!=undefined&&(j=k)}return j}var v=KISSY,n=v.Editor,f=n.n,l=V;v.augment(r,{Sc:function(j,e){if(typeof e!="number")e=10;u(this.c.Vb,j.Vb,e);u(this.c.Pb,j.Pb,e);J(this.c.elements,
j.elements,e);J(this.c.attributes,j.attributes,e);this.c.text=A(this.c.text,j.text,e)||this.c.text;this.c.O=A(this.c.O,j.O,e)||this.c.O;this.c.rb=A(this.c.rb,j.rb,e)||this.c.rb},wd:function(j){return D(j,this.c.Vb)},ud:function(j){return D(j,this.c.Pb)},ma:function(j){var e=this.c.text;return e?e.filter(j):j},La:function(j,e){var t=this.c.O;return t?t.filter(j,e):j},xd:function(j){var e=this.c.rb;return e?e.filter(j):j},kc:function(j){for(var e=[this.c.elements["^"],this.c.elements[j.name],this.c.elements.$e],
t,G=0;G<3;G++)if(t=e[G]){t=t.filter(j,this);if(t===l)return U;if(t&&t!=j)return this.yd(t);if(j.parent&&!j.name)break}return j},yd:function(j){var e=j.type;return e==f.e?this.kc(j):e==f.f?new n.h.Db(this.ma(j.value)):U},sd:function(j,e,t){if(e=this.c.attributes[e]){j=e.filter(t,j,this);if(j===l)return l;if(typeof j!="undefined")return j}return t}});n.h.ef=r;v=r.prototype;n.k.o(v,{addRules:v.Sc,onElementName:v.wd,onAttributeName:v.ud,onText:v.ma,onComment:v.La,onFragment:v.xd,onElement:v.kc,onNode:v.yd,
onAttribute:v.sd});n.h.Filter=r});KISSY.Editor.add("htmlparser-text",function(){function r(A){this.value=A;this.c={S:J}}var D=KISSY,u=D.Editor,J=V;D.augment(r,{type:u.n.f,aa:function(A,B){var v=this.value;B&&!(v=B.ma(v,this))||A.text(v)}});u.h.Db=r;u.h.Text=r});
KISSY.Editor.add("htmlparser-comment",function(){function r(J){this.value=J;this.c={S:V}}var D=KISSY.Editor,u=D.n;D.h.Jd=r;D.h.Comment=r;r.prototype={constructor:r,type:u.Ld,aa:function(J,A){var B=this.value;if(A){if(!(B=A.La(B,this)))return;if(typeof B!="string"){B.parent=this.parent;B.aa(J,A);return}}J.O(B)}}});
