/*
 Constructor for kissy editor and module dependency definition
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-05 10:01:17
*/
var T=true,U=null,V=false;
KISSY.add("editor",function(r,D){function u(o,l){function a(s){for(var i=u.Env.mods,g=0;g<s.length;g++){for(var z=s[g],E=v,w=0;w<g;w++)if(z==s[w]){E=B;break}w=i[z];if(E&&w){E=r.clone(w);z=z+"_"+g;E.name=z;s[g]=z;i[z]||(i[z]=E)}}}var b=this;if(!(b instanceof u))return new u(o,l);if(r.isString(o))o=r.one(o);o=A.D(o);l=l||{};l.Ne=l.pluginConfig||{};b.Ga=l;l.pluginConfig=l.Ne;b.cfg=l;r.app(b,r.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],m=v;b.use=function(s,i){s=s.split(",");a(s);
if(!m)for(var g=0;g<d.length;g++){var z=d[g];r.inArray(z,s)||s.unshift(z)}r.use.call(b,s.join(","),function(){b.ready(function(){i&&i.call(b);if(!m){b.setData(o.val());if(l.focus)b.focus();else{var E=b.getSelection();E&&E.removeAllRanges()}b.fire("save");m=B}})},{order:B,global:u});return b};b.use=b.use;b.Ee(o);return b}function J(o){var l=r.Config.debug;o=l?l==="dev"?"../src/"+o:o:o.replace(/\.(js|css)/i,"-min.$1");o+=o.indexOf("?")!=-1?"&":"?";o+="t="+encodeURIComponent("2010-11-05 10:01:17");return o}
var A=r.DOM,B=T,v=V;r.app(u,r.EventTarget);u.Config.base=r.Config.base+"editor/";var n=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",
requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],f,k,j,e,t={};f=0;for(k=n.length;f<k;f++){j=n[f];if(r.isString(j))j=n[f]={name:j+"",requires:U};e=j.requires||[];var G=["button"];j.name.indexOf("/dialog")!=-1&&G.push("overlay");j.requires=e.concat(G)}n=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},
{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(n);f=0;for(k=n.length;f<k;f++){j=n[f];e=j.name;t[e]={attach:v,charset:"utf-8",requires:j.requires,csspath:j.Pf?J("plugins/"+e+"/plugin.css"):D,path:J("plugins/"+e+"/plugin.js")}}u.add(t);r.Editor=u;r.Editor=u});
KISSY.Editor.add("utils",function(r){var D=U,u=KISSY,J=u.Node,A=u.DOM,B=u.UA,v=u.Event,n={Xc:function(f){var k=u.Config.debug;f=k?k==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-11-05 10:01:17");return f},Je:function(f,k,j){var e=f[k],t=f[j];f[k]=function(){e.apply(this,arguments);f[k]=f[j];return t.apply(this,arguments)}},Ae:function(f,k,j,e){j=j.defaultView||j.parentWindow;f-=A.scrollLeft(j);k-=A.scrollTop(j);if(e)if(j!=(e.defaultView||
e.parentWindow)&&j.frameElement){e=A.Gb(j.frameElement,e);f+=e.left;k+=e.top}return{left:f,top:k}},Gd:function(){for(var f,k=0,j=arguments.length;k<j;k++){var e=arguments[k];try{f=e();break}catch(t){}}return f},fe:function(f,k){if(!f&&!k)return T;if(!f||!k||f.length!=k.length)return V;for(var j=0;j<f.length;j++)if(f[j]!==k[j])return V;return T},ad:function(f,k,j){f=f.documentElement;for(var e=0;f&&e<k.length;e++){var t=k[e];if(j)for(var G=-1,o=0;o<f.childNodes.length;o++){var l=f.childNodes[o];if(!(j===
T&&l.nodeType==3&&l.previousSibling&&l.previousSibling.nodeType==3)){G++;if(G==t){f=l;break}}}else f=f.childNodes[t]}return f?new J(f):D},ne:function(f){for(var k in f)f[k].Ec(f,T)},ec:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ka:function(f){return f.replace(/^\s+/,"")},Ma:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ka(this.Ma(f))},mix:function(){for(var f={},k=0;k<arguments.length;k++)f=u.mix(f,arguments[k]);return f},gc:function(){if(!B.ie)return V;
var f=document.domain,k=window.location.hostname;return f!=k&&f!="["+k+"]"},se:function(f,k){return Array(k+1).join(f)},Ve:function(f,k,j){j=j||150;if(j===-1)return function(){f.apply(k,arguments)};var e=(new Date).getTime();return function(){var t=(new Date).getTime();if(t-e>j){e=t;f.apply(k,arguments)}}},je:function(f,k,j){j=j||0;var e=D;return function(){e&&clearTimeout(e);var t=arguments;e=setTimeout(function(){return f.apply(k,t)},j)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(u.trim(f))},
Xe:function(f){for(var k=0;k<f.length;k++){var j=A.D(f[k]),e=u.trim(j.val()),t=j.attr("data-verify");j=j.attr("data-warning");if(t&&!RegExp(t).test(e)){alert(j);return V}}return T},Te:function(f,k){f.on("sourcemode",k.zf,k);f.on("wysiwygmode",k.Ff,k)},Pe:function(f){var k=f.attr("placeholder");if(k&&!B.webkit){f.val(k);f.addClass("ke-input-tip")}else B.webkit&&f.val("")},Qf:function(f,k){f.val(k);f.removeClass("ke-input-tip")},Me:function(f,k){f.attr("placeholder",k);if(!B.webkit){f.on("blur",function(){if(!u.trim(f.val())){f.val(k);
f.addClass("ke-input-tip")}});f.on("focus",function(){u.trim(f.val())==k&&f.val("");f.removeClass("ke-input-tip")})}},me:function(f){f=f[0]||f;for(var k=u.makeArray(f.childNodes),j=0;j<k.length;j++){var e=k[j];e.nodeType==r.n.f&&!u.trim(e.nodeValue)&&f.removeChild(e)}},De:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},Ce:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,
"&")},ue:function(f,k){return f.toLowerCase()==k.toLowerCase()},pd:function(f){f=u.clone(f);for(var k in f)if(f.hasOwnProperty(k)){var j=f[k];if(u.isFunction(j))f[k]=j()}return f},re:function(f,k,j){function e(){var d={responseText:"",responseXML:D};d.ee=f?f.ee:D;try{var m;if((m=B.ie?G.contentWindow.document:G.contentDocument||window.frames[t].document)&&m.body)d.responseText=m.body.innerHTML;d.responseXML=m&&m.XMLDocument?m.XMLDocument:m}catch(s){}v.remove(G,"load",e);f.ke&&f.ke(d);setTimeout(function(){A.j(G)},
100)}var t=u.guid("form-upload-"),G=document.createElement("iframe");G.id=t;G.name=t;G.className="ke-hidden";if(B.ie)G.src="javascript:FALSE";document.body.appendChild(G);if(B.ie)document.frames[t].name=t;var o=A.Nc(f.form),l={target:o.target,method:o.method,encoding:o.encoding,enctype:o.enctype,action:o.action};o.target=t;o.method="POST";o.enctype=o.encoding="multipart/form-data";if(j)o.action=j;var a;if(k){a=[];k=r.k.pd(k);for(var b in k)if(k.hasOwnProperty(b)){j=document.createElement("input");
j.type="hidden";j.name=b;j.value=k[b];o.appendChild(j);a.push(j)}}v.on(G,"load",e);o.submit();o.target=l.target;o.method=l.method;o.enctype=l.enctype;o.encoding=l.encoding;o.action=l.action;if(a){k=0;for(o=a.length;k<o;k++)A.j(a[k])}return G},o:function(f,k){for(var j in k)f[j]=k[j]},map:function(f,k){for(var j=0;j<f.length;j++)f[j]=k(f[j]);return f}};r.k=n;r.Utils=n;n.o(n,{debugUrl:n.Xc,lazyRun:n.Je,getXY:n.Ae,tryThese:n.Gd,arrayCompare:n.fe,getByAddress:n.ad,clearAllMarkers:n.ne,htmlEncodeAttr:n.ec,
ltrim:n.Ka,rtrim:n.Ma,trim:n.trim,mix:n.mix,isCustomDomain:n.gc,duplicateStr:n.se,buffer:n.je,isNumber:n.isNumber,verifyInputs:n.Xe,sourceDisable:n.Te,resetInput:n.Pe,placeholder:n.Me,clean:n.me,htmlEncode:n.De,htmlDecode:n.Ce,equalsIgnoreCase:n.ue,normParams:n.pd,throttle:n.Ve,doFormUpload:n.re,map:n.map})});
KISSY.Editor.add("focusmanager",function(r){function D(){this.fc=f;n=this}function u(){this.fc=k;n=j}var J=KISSY,A=J.DOM,B=J.Event,v={},n;J={Jf:function(){for(var e in v){var t=v[e];t.document.designMode="off";t.document.designMode="on"}},yf:function(){return n},xe:function(e){return v[e]},add:function(e){var t=A.ga(e.document);B.on(t,"focus",D,e);B.on(t,"blur",u,e)},Oe:function(e){v[e.Lb]=e},remove:function(e){delete v[e.Lb];var t=A.ga(e.document);B.remove(t,"focus",D,e);B.remove(t,"blur",u,e)}};
var f=T,k=V,j=U;r.ve=J;r.focusManager=J;r.ed=function(){return v};r.getInstances=r.ed});
KISSY.Editor.add("definition",function(r){function D(a,b){return"<!doctype html><html><head><title>${title}</title><link href='"+r.Config.base+t+"' rel='stylesheet'/><style>"+(b||"")+"</style></head><body class='ke-editor'>&nbsp;"+(a?'<script id="ke_actscript" type="text/javascript">'+(r.k.gc()?'document.domain="'+A.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':"")+"</body></html>"}var u=T,J=V,A=document,B=KISSY,v=B.UA,n=B.DOM,f=B.Node,k=B.Event,j=r.ve,e=r.k.Gd,t=r.k.Xc("theme/editor-iframe.css"),
G=1,o="document.open();"+(r.k.gc()?'document.domain="'+A.domain+'";':"")+"document.close();",l="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(v.ie?"javascript:void(function(){"+encodeURIComponent(o)+"}())":"")+'"  tabIndex="'+(v.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+
".ke-editor-status".substring(1)+"'></div></div>";r.Bc=0;r.Xa=1;r.SOURCE_MODE=r.Bc;r.WYSIWYG_MODE=r.Xa;B.augment(r,{Ee:function(a){if(v.ie)n.addClass(A.body,"ie"+v.ie);else if(v.gecko)n.addClass(A.body,"gecko");else v.webkit&&n.addClass(A.body,"webkit");var b=this,d=new f(l.replace(/\$\(tabIndex\)/,a.attr("tabIndex")));d.on("mousedown",function(i){if(v.webkit){var g=n.d(i.target);if(g=="select"||g=="option")return u}i.halt()});a.on("mousedown",function(i){i.stopPropagation()});b.Df=d;b.Lb=G++;j.Oe(b);
b.sb=d.one(".ke-textarea-wrap");b.wrap=b.sb;b.ib=b.sb.one("iframe");b.iframe=b.ib;b.Fd=d.one(".ke-editor-tools");b.toolBarDiv=b.Fd;b.$=a;b.textarea=b.$;b.Ue=d.one(".ke-editor-status");b.statusDiv=b.Ue;b.Fd.Mc();b.Mb={};b.Oc={};var m=a.M("width"),s=a.M("height");if(m){d.css("width",m);a.css("width","100%")}b.$.css("display","none");d.insertAfter(a);b.sb[0].appendChild(a[0]);if(s){b.sb.css("height",s);a.css("height","100%")}d=b.ib;b.on("dataReady",function(){b.Zd=u;r.fire("instanceCreated",{te:b})});
v.gecko?d.on("load",b.Qc,b):b.Qc();b.Ga.xf&&a[0].form&&b.Yd()},Yd:function(){(new f(this.$[0].form)).on("submit",this.Ed,this)},We:function(a,b){var d=this,m=r.qf;m.Gf();d.use(a,function(){var s=d.bd(a);b(s);m.Of()})},be:function(a,b){this.Oc[a]=b},bd:function(a){return this.Oc[a]},ce:function(a){this.ready(a)},$d:function(a,b){this.Mb[a]=b},Be:function(a){return this.Mb[a]},execCommand:function(a){var b=this.Mb[a],d=B.makeArray(arguments);d.shift();d.unshift(this);return b.exec.apply(b,d)},$b:function(){return this.$.css("display")==
"none"?r.Xa:r.Bc},getData:function(a){var b;b=this.$b()==r.Xa?this.document.body.innerHTML:this.$.val();if(this.htmlDataProcessor)b=a?this.htmlDataProcessor.toHtml(b,"p"):this.htmlDataProcessor.toServer(b,"p");return b},setData:function(a){var b=a;if(this.htmlDataProcessor)b=this.htmlDataProcessor.toDataFormat(a,"p");this.document.body.innerHTML=b;this.$b()!=r.Xa&&this.$.val(a)},Ed:function(){this.$.val(this.getData())},Fa:function(a){a=a||0;return a+(this.Ga.Fa||0)},sf:function(){return this.document.body.innerHTML},
vf:function(a){this.document.body.innerHTML=a},uf:D,getSelection:function(){return r.Cc.getSelection(this.document)},focus:function(){var a=this.document,b=n.ga(a);v.webkit&&b&&b.parent&&b.parent.focus();b&&b.focus();a&&a.body.focus();this.lb()},blur:function(){n.ga(this.document).blur();this.document&&this.document.body.blur()},ae:function(a){var b=this.Ga,d=this.document;b.Tb=b.Tb||"";b.Tb+="\n"+a;b=d.createElement("style");d.getElementsByTagName("head")[0].appendChild(b);if(b.styleSheet)b.styleSheet.cssText=
a;else b.appendChild(d.createTextNode(a))},Qc:function(){function a(){i=s.document;b.document=i;d.detach();i.open("text/html","replace");i.write(m);i.close()}var b=this,d=b.ib,m=D(b.Lb,b.Ga.Tb),s=d[0].contentWindow,i;try{i=s.document}catch(g){d[0].src=d[0].src;if(v.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this.Zd?a():this.on("dataReady",a)},cb:function(){var a=this;a.Pc&&clearTimeout(a.Pc);a.Pc=setTimeout(function(){var b=a.getSelection();if(b&&!b.md){var d=b.bc(),m=new r.Sa(d);if(!a.mc||
!a.mc.Vc(m)){a.mc=m;a.fire("selectionChange",{selection:b,path:m,element:d})}}},100)},lb:function(){this.mc=U;this.cb()},ld:function(a,b){var d=this;d.focus();var m=a.d(),s=r.m,i=r.oa,g=r.n,z=s.Qa[m],E=d.getSelection(),w=E&&E.A(),c,h,p,x,q;if(!w||w.length==0){var C=arguments,Q=C.callee;setTimeout(function(){Q.apply(d,C)},30)}else{d.fire("save");for(var N=w.length-1;N>=0;N--){c=w[N];c.deleteContents();h=!N&&a||a.K(u);b&&b(h);if(z)for(;(x=c.va(J,u))&&(q=s[x.d()])&&!(q&&q[m]);)if(x.d()in s.span)c.rc(x);
else if(c.ua()&&c.ka()){c.setStartBefore(x);c.collapse(u);x.j()}else c.qc();c.insertNode(h);p||(p=h)}if(p){m=p.w(u);s=d.document;q=r.m;if(q.uc[h.d()]){m=new f(s.createTextNode(" "));m.insertAfter(p)}else if(m){if(m.d()=="br"&&q[m.parent().d()].p){q=new f("<p>&nbsp;</p>",U,s);m[0].parentNode.replaceChild(q[0],m[0]);m=q}}else{q=new f("<p>&nbsp;</p>",U,s);q.insertAfter(p);m=q}c.H(p,i.t);m&&m[0].nodeType==g.e&&c.kb(m);E.rb([c]);d.focus();h&&h.Kb();setTimeout(function(){d.fire("save")},10);return h}}},
Fe:function(a){var b=this;if(b.htmlDataProcessor)a=b.htmlDataProcessor.toDataFormat(a);if(v.webkit){var d=n.create(a,U,this.document);d=d.nodeType==11?B.makeArray(d.childNodes):[d];for(var m=0;m<d.length;m++)b.ld(new f(d[m]))}else{b.focus();m=(d=b.getSelection())&&d.A();if(!m||m.length==0){var s=arguments,i=s.callee;setTimeout(function(){i.apply(b,s)},30)}else{b.fire("save");if(v.ie){d=d.r();d.type=="Control"&&d.clear();d.createRange().pasteHTML(a)}else b.document.execCommand("inserthtml",J,a);b.focus();
setTimeout(function(){b.fire("save")},10)}}}});r._initIFrame=function(a){function b(c){e(function(){s.designMode="on";setTimeout(function(){s.designMode="off";g.focus();if(!arguments.callee.Qe)arguments.callee.Qe=u},50)},function(){s.designMode="off";n.attr(g,"contentEditable",J);n.attr(g,"contentEditable",u);!c&&b(1)})}var d=j.xe(a);a=d.$[0];var m=d.ib[0].contentWindow,s=d.document,i=d.Ga;n.j(s.getElementById("ke_actscript"));var g=s.body;if(v.ie){g.hideFocus=u;g.disabled=u;g.contentEditable=u;g.removeAttribute("disabled")}else setTimeout(function(){if(v.gecko||
v.opera)g.contentEditable=u;else if(v.webkit)g.parentNode.contentEditable=u;else s.designMode="on"},0);if(v.webkit){k.on(s,"click",function(c){var h=new f(c.target);B.inArray(h.d(),["input","select"])&&c.preventDefault()});k.on(s,"mouseup",function(c){var h=new f(c.target);B.inArray(h.d(),["input","textarea"])&&c.preventDefault()})}if(v.gecko||v.ie||v.opera){var z;z=new f(n.insertAfter((new f('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],a));z.on("focus",
function(){d.focus()});d.wf=function(){v.gecko&&d.fc&&z[0].focus()};d.on("destroy",function(){})}if(v.ie&&s.compatMode=="CSS1Compat"||v.gecko||v.opera){var E=new f(s.documentElement);E.on("mousedown",function(c){if(c.target==E[0]){v.gecko&&b(J);z[0].focus()}})}k.on(m,"focus",function(){if(v.gecko)b(J);else v.opera&&g.focus();d.lb()});v.gecko&&k.on(d.document,"mousedown",function(){d.fc||b(J)});if(v.ie){k.on(s,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var h=d.getSelection(),p=h.ac();if(p){d.fire("save");
var x=h.A()[0].P();p.j();h.Ad([x]);d.fire("save");c.preventDefault()}}});if(s.compatMode=="CSS1Compat"){var w={33:1,34:1};k.on(s,"keydown",function(c){c.keyCode in w&&setTimeout(function(){d.getSelection().scrollIntoView()},0)})}}setTimeout(function(){v.ie&&setTimeout(function(){if(s){g.runtimeStyle.marginBottom="0px";g.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){d.fire("dataReady");var c=i.Bf,h=i.Af;if(c||h)try{s.execCommand("enableObjectResizing",J,!c);s.execCommand("enableInlineTableEditing",
J,!h)}catch(p){k.on(g,v.ie?"resizestart":"resize",function(x){if(c||n.d(x.target)==="table"&&h)x.preventDefault()})}},10);v.webkit&&k.on(s,"mousedown",function(c){c=new f(c.target);B.inArray(c.d(),["img","hr","input","textarea","select"])&&d.getSelection().pc(c)});v.gecko&&k.on(s,"dragstart",function(c){var h=new f(c.target);h.d()==="img"&&/ke_/.test(h[0].className)&&c.preventDefault()});j.add(d)};o=r.prototype;r.k.o(o,{setData:o.setData,getData:o.getData,insertElement:o.ld,insertHtml:o.Fe,ready:o.ready,
addCustomStyle:o.ae,addCommand:o.$d,hasCommand:o.Be,execCommand:o.execCommand,addPlugin:o.ce,useDialog:o.We,addDialog:o.be,getDialog:o.bd,getMode:o.$b,sync:o.Ed,baseZIndex:o.Fa,getSelection:o.getSelection,focus:o.focus,blur:o.blur,notifySelectionChange:o.lb})});
KISSY.Editor.add("zindex",function(){var r=KISSY.Editor;if(!r.Hd){r.Hd={cf:1100,mf:1200,df:99999,jf:900,lf:9999,LOADING:11E3,hf:12E3,nf:1200};r.Fa=function(D){var u=D,J=r.ed(),A;for(A in J){if(!J.hasOwnProperty(A))return;u=Math.max(u,J[A].Fa(D))}return u};r.baseZIndex=r.Fa;r.zIndexManager=r.Hd}});
KISSY.Editor.add("dtd",function(r){r.m=function(){function D(i){for(var g=arguments.length-1;g>0;)KISSY.mix(i,arguments[g--]);return i}var u={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},A=D({a:1},J),B=D({iframe:1},A),v={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},n={ins:1,del:1,script:1,style:1},f=D({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},n),k=D({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},f),j=D({p:1},k);J=D({iframe:1},k,J);k={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=D({a:1},J),t={tr:1},G={"#":1},o=D({param:1},k),l=D({form:1},u,B,v,j),a={li:1},b={base:1,link:1,meta:1,title:1},d=D(b,{style:1,script:1}),m={head:1,body:1},s={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{vb:D({html:1},m,b),Qa:s,af:{body:1,div:1,td:1,th:1,caption:1,
form:1},uc:e,sc:D({script:1,style:1},s),tc:{script:1,style:1},tb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},ub:{dd:1,dt:1,li:1},Id:{ul:1,ol:1,dl:1},wc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},ba:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},bf:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},xc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:m,head:d,style:G,body:l,base:{},link:{},meta:{},title:G,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:l,td:l,br:{},th:l,center:l,kbd:e,button:D(j,v),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:a,h1:e,h3:e,option:G,h2:e,form:D(u,B,v,j),select:{optgroup:1,option:1},font:e,ins:e,menu:a,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:G,tfoot:t,cite:e,li:l,input:{},iframe:l,
strong:e,textarea:G,noframes:l,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:l,object:o,sup:e,dd:l,strike:e,area:{},dir:a,map:D({area:1,form:1,p:1},u,n,v),applet:o,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:D({legend:1},k),thead:t,ul:a,acronym:e,b:e,a:J,blockquote:l,caption:e,i:e,u:e,tbody:t,s:e,address:D(B,j),tt:e,legend:e,q:e,pre:D(f,A),p:e,em:e,dfn:e}}();r.XHTML_DTD=r.m});
KISSY.Editor.add("dom",function(r){function D(a){if(a&&!a[0])return new n(a);return a}function u(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var A=KISSY,B=A.DOM,v=A.UA,n=A.Node,f=r.k,k={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};r.n={e:1,f:3,Ld:8,kf:11};r.NODE=r.n;r.Ta={da:0,Md:1,ca:2,Y:4,X:8,zc:16};r.POSITION=
r.Ta;var j=r.n,e=r.Ta,t={},G={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},o={hr:1},l={D:D,Nc:u,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return V;a=u(a);b=u(b);return a===b},qa:function(a,b){a=D(a);var d=A.mix(A.mix({},o),b||{});return G[a.css("display")]||d[a.d()]},ga:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
V},v:function(a){a=u(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Qd:function(a,b){a=u(a);var d=a.firstChild;if((d=d&&new n(d))&&b&&!b(d))d=d.Za(b);return d},Kc:function(a,b,d){a=u(a);B.j(a);b=u(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(v.ie)if((a=a.Kf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Ic:function(a,b){if(a.d()!=b.d())return V;var d=a[0].attributes,m=b[0].attributes,s=d.length,
i=m.length;if(!v.ie&&s!=i)return V;for(var g=0;g<s;g++){var z=d[g];if((!v.ie||z.specified&&z.nodeName!="_ke_expando")&&z.nodeValue!=b.attr(z.nodeName))return V}if(v.ie)for(g=0;g<i;g++){z=m[g];if(z.specified&&z.nodeName!="_ke_expando"&&z.nodeValue!=a.attr(z.nodeName))return V}return T},Hb:function(a){a=u(a).childNodes;for(var b=0,d=a.length;b<d;b++){var m=a[b],s=m.nodeType;if(!(s==j.e&&m.getAttribute("_ke_bookmark")))if(s==j.e&&!l.Hb(m)||s==j.f&&A.trim(m.nodeValue))return V}return T},Ib:function(a,
b,d){a=u(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},ra:function(){function a(b,d,m){if(d[0]&&d[0].nodeType==j.e){for(var s=[];d.attr("_ke_bookmark")||d.Hb();){s.push(d);d=m?new n(d[0].nextSibling):new n(d[0].previousSibling);if(!d[0]||d[0].nodeType!=j.e)return}if(b.Ic(d)){for(var i=m?b[0].lastChild:b[0].firstChild;s.length;)s.shift().Kc(b,!m);d.Ib(b,!m);d.j();i[0]&&i[0].nodeType==j.e&&i.ra()}}}
return function(b){if(b[0])if(k[b.d()]||b.d()=="a"){a(b,new n(b[0].nextSibling),T);a(b,new n(b[0].previousSibling))}}}(),Mc:v.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:v.webkit?function(a){a=u(a);a.style.gf="none"}:function(a){a=u(a);if(v.ie||v.opera){var b,d=0;for(a.unselectable="on";b=a.all[d++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},Gb:function(a,b){a=u(a);var d,m=0;d=0;var s=a.ownerDocument.defaultView||
a.ownerDocument.parentWindow,i=a.ownerDocument,g=i.documentElement;b=b||i;if(a.getBoundingClientRect){if(a!==i.body&&g!==a){d=a.getBoundingClientRect();m=d.left+(b===i?B.scrollLeft(s):0);d=d.top+(b===i?B.scrollTop(s):0)}if(b)if(s!=(b.defaultView||b.parentWindow)&&s.frameElement){s=l.Gb(s.frameElement,b);m+=s.left;d+=s.top}}return{left:m,top:d}},Sd:function(a){return(a=u(a))&&a.contentWindow.document},ia:function(a,b){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=j.f)){if(v.ie&&b==a.nodeValue.length){var m=
d.createTextNode("");B.insertAfter(m,a);return new n(m)}m=new n(a.splitText(b));if(d.documentMode){d=d.createTextNode("");B.insertAfter(d,m[0]);B.j(d)}return m}},Jb:function(a,b){a=D(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=u(a);a=a.cloneNode(b);if(!d){var m=function(s){if(s.nodeType==j.e){s.removeAttribute("id",V);s.removeAttribute("_ke_expando",V);s=s.childNodes;for(var i=0;i<s.length;i++)m(s[i])}};m(a)}return new n(a)},w:function(a,b,d,m){a=u(a);
if(m&&!m.call){var s=m[0]||m;m=function(g){g=g[0]||g;return g!==s}}b=!b&&a.firstChild;var i=new n(a);if(!b){if(a.nodeType==j.e&&m&&m(a,T)===V)return U;b=a.nextSibling}for(;!b&&(i=i.parent());){if(m&&m(i,T)===V)return U;b=i[0].nextSibling}if(!b)return U;b=B.D(b);if(m&&m(b)===V)return U;if(d&&d!=b[0].nodeType)return b.w(V,d,m);return b},ha:function(a,b,d,m){a=u(a);if(m&&!m.call){var s=m[0]||m;m=function(g){g=g[0]||g;return g!==s}}b=!b&&a.lastChild;var i=new n(a);if(!b){if(a.nodeType==j.e&&m&&m(a,T)===
V)return U;b=a.previousSibling}for(;!b&&(i=i.parent());){if(m&&m(i,T)===V)return U;b=i[0].previousSibling}if(!b)return U;b=B.D(b);if(m&&m(b)===V)return U;if(d&&b[0].nodeType!=d)return b.ha(V,d,m);return b},L:v.ie||v.webkit?function(a,b){a=u(a);b=u(b);return b.nodeType!=j.e?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=u(a);b=u(b);return!!(a.compareDocumentPosition(b)&16)},Fb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=j.f&&b.L(a))return b;var d=a[0].nodeType==j.f?a.parent():
a;do if(d[0].nodeType!=j.f&&d.L(b))return d;while(d=d.parent());return U},Od:function(a,b,d){a=u(a);if(!d)a=a.parentNode;if(b&&!A.isFunction(b)){var m=b;b=function(s){return s.d()==m}}for(;a&&a.nodeType!=9;){if(!b||b(new n(a))===T)return new n(a);a=a.parentNode}return U},Gc:function(a,b){a=u(a);var d=a.attributes.getNamedItem(b);return!!(d&&d.specified)},Ya:v.ie?function(a){a=u(a);for(var b=a.attributes,d=0;d<b.length;d++){var m=b[d];switch(m.nodeName){case "class":if(a.getAttribute("class"))return T;
break;case "_ke_expando":continue;default:if(m.specified)return T}}return V}:function(a){a=u(a);v.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},Da:function(a,b){var d=u(a),m=u(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(m);if(d==m)return e.da;if(d.nodeType==j.e&&m.nodeType==j.e){if(d.contains){if(d.contains(m))return e.zc+e.Y;if(m.contains(d))return e.X+e.ca}if("sourceIndex"in d)return d.sourceIndex<0||m.sourceIndex<
0?e.Md:d.sourceIndex<m.sourceIndex?e.Y:e.ca}d=a.Ca();m=b.Ca();for(var s=Math.min(d.length,m.length),i=0;i<=s-1;i++)if(d[i]!=m[i]){if(i<s)return d[i]<m[i]?e.Y:e.ca;break}return d.length<m.length?e.zc+e.Y:e.X+e.ca},Ca:function(a,b){a=u(a);for(var d=[],m=a.ownerDocument.documentElement,s=a;s&&s!=m;){var i=s.parentNode,g=-1;if(i){for(var z=0;z<i.childNodes.length;z++){var E=i.childNodes[z];if(!(b&&E.nodeType==3&&E.previousSibling&&E.previousSibling.nodeType==3)){g++;if(E==s)break}}d.unshift(g)}s=i}return d},
Eb:function(a,b){var d=new r.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var m=d.extractContents();d.insertNode(a.j());a[0].parentNode.insertBefore(m,a[0].nextSibling)},M:function(a,b,d){a=D(a);if(d!==undefined)return a.css(b,d);a=u(a);return a.style[J(b)]},j:function(a,b){var d=u(a),m=d.parentNode;if(m){if(b)for(var s;s=d.firstChild;)m.insertBefore(d.removeChild(s),d);m.removeChild(d)}return a},bb:function(a){B.Jc(a);B.Lc(a)},Jc:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==
j.f){var d=f.Ka(b.nodeValue),m=b.nodeValue.length;if(d){if(d.length<m){(new n(b)).ia(m-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Lc:function(a){a=u(a);for(var b;b=a.lastChild;){if(b.type==j.f){var d=f.Ma(b.nodeValue),m=b.nodeValue.length;if(d){if(d.length<m){(new n(b)).ia(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!v.ie&&!v.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Db:function(a){a=
u(a);for(var b=a.lastChild;b&&b.nodeType==j.f&&!A.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==j.f||B.d(b)!=="br"){b=v.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");v.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},sa:function(a,b){var d=u(a),m;do m=(d=d.previousSibling)&&new n(d);while(m&&b&&!b(m));return m},Ud:function(a,b){a=B.D(a);var d=a[0].lastChild;if((d=d&&new n(d))&&b&&!b(d))d=d.sa(b);return d},Za:function(a,b){var d=u(a),m;do m=(d=d.nextSibling)&&
new n(d);while(m&&b&&!b(m));return m},$a:function(a){a=u(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},Vd:function(a,b,d,m){a=B.D(a);var s=a.fa("list_marker_id")||a.ab("list_marker_id",A.guid()).fa("list_marker_id"),i=a.fa("list_marker_names")||a.ab("list_marker_names",{}).fa("list_marker_names");b[s]=a;i[d]=1;return a.ab(d,m)},Ec:function(a,b,d){a=D(a);var m=a.fa("list_marker_names"),s=a.fa("list_marker_id"),
i;for(i in m)a.Ea(i);a.Ea("list_marker_names");if(d){a.Ea("list_marker_id");delete b[s]}},ab:function(a,b,d){var m=B.Fc(a);(t[m]||(t[m]={}))[b]=d;return a},fa:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");return(d=d&&t[d])&&d[b]},Ea:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");var m=(d=d&&t[d])&&d[b];typeof m!="undefined"&&d&&delete d[b];A.isEmptyObject(d)&&B.Dc(a);return m||U},Dc:function(a){a=u(a);var b=a.getAttribute("_ke_expando");b&&delete t[b];b&&a.removeAttribute("_ke_expando")},
Fc:function(a){a=u(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=A.guid();a.setAttribute("_ke_expando",b);return b},Pd:function(a,b,d){a=u(a);b=D(b);var m=a.attributes;d=d||{};for(var s=0;s<m.length;s++){var i=m[s],g=i.nodeName.toLowerCase(),z;if(!(g in d))if(g=="checked"&&(z=B.attr(a,g)))b.attr(g,z);else if(i.specified||v.ie&&i.nodeValue&&g=="value"){z=B.attr(a,g);if(z===U)z=i.nodeValue;b.attr(g,z)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Hc:function(a){a=B.d(a);var b=
r.m;return(a=!b.wc[a]&&(b[a]||b.span))&&a["#"]},Kb:function(a){a=D(a);var b=a[0].ownerDocument,d=B.scrollLeft(b),m=B.scrollTop(b),s=a.offset(),i=s.left;s=s.top;if(B.viewportHeight(b)+m<s||s<m||B.viewportWidth(b)+d<i||i<d)a.scrollIntoView(b)},Rd:function(a,b,d){a=u(a);if(!v.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new n(a[b]));return d}};A.DOM.Td=function(a){A.mix(B,a);for(var b in a)a.hasOwnProperty(b)&&function(d){n.prototype[d]=function(){var m=[].slice.call(arguments,
0);m.unshift(this);return a[d].apply(U,m)}}(b)};f.o(l,{_4e_wrap:l.D,_4e_unwrap:l.Nc,_4e_equals:l.g,_4e_isBlockBoundary:l.qa,_4e_getWin:l.ga,_4e_index:l.v,_4e_first:l.Qd,_4e_move:l.Kc,_4e_name:l.d,_4e_isIdentical:l.Ic,_4e_isEmptyInlineRemoveable:l.Hb,_4e_moveChildren:l.Ib,_4e_mergeSiblings:l.ra,_4e_unselectable:l.Mc,_4e_getOffset:l.Gb,_4e_getFrameDocument:l.Sd,_4e_splitText:l.ia,_4e_parents:l.Jb,_4e_clone:l.K,_4e_nextSourceNode:l.w,_4e_previousSourceNode:l.ha,_4e_contains:l.L,_4e_commonAncestor:l.Fb,
_4e_ascendant:l.Od,_4e_hasAttribute:l.Gc,_4e_hasAttributes:l.Ya,_4e_position:l.Da,_4e_address:l.Ca,_4e_breakParent:l.Eb,_4e_style:l.M,_4e_remove:l.j,_4e_trim:l.bb,_4e_ltrim:l.Jc,_4e_rtrim:l.Lc,_4e_appendBogus:l.Db,_4e_last:l.Ud,_4e_previous:l.sa,_4e_next:l.Za,_4e_outerHtml:l.$a,_4e_setMarker:l.Vd,_4e_clearMarkers:l.Ec,_4e_setData:l.ab,_4e_getData:l.fa,_4e_removeData:l.Ea,_4e_clearData:l.Dc,_4e_removeData:l.Ea,_4e_getUniqueId:l.Fc,_4e_copyAttributes:l.Pd,_4e_isEditable:l.Hc,_4e_scrollIntoView:l.Kb,
_4e_getElementsByTagName:l.Rd});B.Td(l)});
KISSY.Editor.add("elementpath",function(r){function D(k){var j=B,e=B,t=[];for(k=k;k&&k[0];){if(k[0].nodeType==A.e){if(!this.Ie)this.Ie=k;var G=k.d();if(!e){if(!j&&v[G])j=k;if(n[G]){var o;if(o=!j){if(o=G=="div"){a:{o=k;o=o[0]||o;o=o.childNodes;for(var l=0,a=o.length;l<a;l++){var b=o[l];if(b.nodeType==A.e&&J.Qa[b.nodeName.toLowerCase()]){o=T;break a}}o=V}o=!o}o=o}if(o)j=k;else e=k}}t.push(k);if(G=="body")break}k=k.parent()}this.block=this.z=j;this.blockLimit=this.F=e;this.elements=this.elements=t}var u=
KISSY.DOM,J=r.m,A=r.n,B=U,v={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},n={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};D.prototype={Vc:function(k){var j=this.elements;k=k&&k.elements;if(!k||j.length!=k.length)return V;for(var e=0;e<j.length;e++)if(!u.g(j[e],k[e]))return V;return T},contains:function(k){for(var j=this.elements,e=0;e<j.length;e++)if(j[e].d()in k)return j[e];return B}};r.ElementPath=r.Sa=D;var f=D.prototype;r.k.o(f,{compare:f.Vc,
contains:f.contains})});
KISSY.Editor.add("walker",function(r){function D(t,G){if(this.c.end)return v;var o,l=this.xa,a,b=this.cc,d=this.type,m=t?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;l.trim();if(l.collapsed){this.end();return v}}if(!t&&!this.c.gd){var s=l.endContainer,i=new j(s[0].childNodes[l.endOffset]);this.c.gd=function(w,c){return(w=k.D(w))&&w[0]&&(!c||!k.g(s,w))&&(!i[0]||!w.g(i))&&(w[0].nodeType!=f.e||!c||w.d()!="body")}}if(t&&!this.c.hd){var g=l.startContainer,z=l.startOffset>
0&&new j(g[0].childNodes[l.startOffset-1]);this.c.hd=function(w,c){return(w=k.D(w))&&w[0]&&(!c||!w.g(g))&&(!z[0]||!w.g(z))&&(w[0].nodeType!=f.e||!c||w.d()!="body")}}var E=t?this.c.hd:this.c.gd;a=b?function(w,c){if(E(w,c)===B)return B;return b(w,c)}:E;if(this.fb)o=this.fb[m](B,d,a);else if(t){o=l.endContainer;if(l.endOffset>0){o=new j(o[0].childNodes[l.endOffset-1]);if(a(o)===B)o=v}else o=a(o,A)===B?v:o.ha(A,d,a)}else{o=l.startContainer;if((o=new j(o[0].childNodes[l.startOffset]))&&o[0]){if(a(o)===
B)o=v}else o=a(l.startContainer,A)===B?v:l.startContainer.w(A,d,a)}for(;o&&o[0]&&!this.c.end;){this.fb=o;if(!this.R||this.R(o)!==B){if(!G)return o}else if(G&&this.R)return B;o=o[m](B,d,a)}this.end();return this.fb=v}function u(t){for(var G,o=v;G=D.call(this,t);)o=G;return o}function J(t){this.xa=t;this.c={}}var A=T,B=V,v=U,n=KISSY,f=r.n,k=n.DOM,j=n.Node;n.augment(J,{end:function(){this.c.end=1},next:function(){return D.call(this)},ob:function(){return D.call(this,A)},Uc:function(){return D.call(this,
B,A)!==B},Tc:function(){return D.call(this,A,A)!==B},od:function(){return u.call(this)},nd:function(){return u.call(this,A)},reset:function(){delete this.fb;this.c={}}});J.Pb=function(t){return function(G){G=k.D(G);return!(G&&G[0].nodeType==f.e&&G.qa(t))}};J.Le=function(){return this.Pb({Qb:1})};J.ta=function(t,G){function o(l){return l&&l[0]&&l.d()=="span"&&l.attr("_ke_bookmark")}return function(l){var a,b;a=l&&l[0]&&l[0].nodeType==f.f&&(b=l.parent())&&o(b);a=t?a:a||o(l);return G^a}};J.Pa=function(t){return function(G){G=
(G=G[0]||G)&&G.nodeType==f.f&&!n.trim(G.nodeValue);return t^G}};J.Ge=function(t){var G=J.Pa();return function(o){o=G(o)||o[0].nodeType==f.e&&!o[0].offsetHeight;return t^o}};r.Ba=J;r.Walker=J;var e=J.prototype;r.k.o(e,{end:e.end,next:e.next,previous:e.ob,checkForward:e.Uc,checkBackward:e.Tc,lastForward:e.od,lastBackward:e.nd,reset:e.reset});r.k.o(J,{blockBoundary:J.Pb,listItemBoundary:J.Le,bookmark:J.ta,whitespaces:J.Pa,invisible:J.Ge})});
KISSY.Editor.add("range",function(r){function D(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=k;this.collapsed=n;this.document=c}function u(c){var h=c[0].nodeType!=e.f&&c.d()in d.ba,p=!j.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||p||c}function J(c){return!z(c)&&!E(c)}function A(c){var h=f,p=o.ta(n);return function(x){if(p(x))return n;if(x[0].nodeType==e.f){if(j.trim(x[0].nodeValue).length)return f}else if(x[0].nodeType==e.e)if(!g[x.d()])if(!c&&!b.ie&&
x.d()=="br"&&!h)h=n;else return f;return n}}function B(c,h){function p(x){return x&&x.nodeName=="span"&&x.getAttribute("_ke_bookmark")}return function(x){var q,C;q=x&&!x.nodeName&&(C=x.parentNode)&&p(C);q=c?q:q||p(x);return h^q}}function v(c){return function(h){h=(h=h[0]||h)&&h.nodeType==e.f&&!j.trim(h.nodeValue);return c^h}}r.oa={W:1,J:2,C:3,t:4,yb:1,xb:2,Ra:3,Va:1,Kd:2,of:3,ea:1,Ac:2};r.RANGE=r.oa;var n=T,f=V,k=U,j=KISSY,e=r.n,t=r.oa,G=r.Ta,o=r.Ba,l=j.DOM,a=r.k.ad,b=j.UA,d=r.m,m=r.Sa,s=j.Node,i=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};D.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};j.augment(D,{Oa:function(){this.collapsed=this.startContainer&&this.endContainer&&l.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},kc:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},lc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.U(c,t.C);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.T(h,t.t)},setStart:function(c,h){if(c[0].nodeType==e.e&&i[c.d()]){c=c.parent();h=c.v()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Oa()},setEnd:function(c,h){if(c[0].nodeType==e.e&&i[c.d()]){c=c.parent();h=c.v()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Oa()},U:function(c,h){switch(h){case t.W:this.setStart(c,0);break;case t.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case t.C:this.setStartBefore(c);break;case t.t:this.setStartAfter(c)}this.Oa()},T:function(c,h){switch(h){case t.W:this.setEnd(c,0);break;case t.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case t.C:this.setEndBefore(c);break;case t.t:this.setEndAfter(c)}this.Oa()},
Wb:function(c,h){var p=this.startContainer,x=this.endContainer,q=this.startOffset,C=this.endOffset,Q,N=this.document,O;this.lc();if(x[0].nodeType==e.f)x=x.ia(C);else if(x[0].childNodes.length>0)if(C>=x[0].childNodes.length){x=new s(x[0].appendChild(N.createTextNode("")));O=n}else x=new s(x[0].childNodes[C]);if(p[0].nodeType==e.f){p.ia(q);if(p.g(x))x=new s(p[0].nextSibling)}else if(q)if(q>=p[0].childNodes.length){Q=new s(N.createTextNode(""));p.append(Q);p=Q;Q=n}else p=new s(p[0].childNodes[q].previousSibling);
else{Q=new s(N.createTextNode(""));(q=p[0].firstChild)?l.insertBefore(Q[0],q):p.append(Q);p=Q;Q=n}q=p.Jb();C=x.Jb();var P,W,S;for(P=0;P<q.length;P++){W=q[P];S=C[P];if(!W.g(S))break}N=h;for(var y,K,F,H=P;H<q.length;H++){y=q[H];if(N&&!y.g(p))K=N.appendChild(y.K()[0]);for(y=y[0].nextSibling;y;){if(l.g(C[H],y)||l.g(x,y))break;F=y.nextSibling;if(c==2)N.appendChild(y.cloneNode(n));else{y.parentNode.removeChild(y);c==1&&N.appendChild(y)}y=F}if(K)N=K}N=h;for(P=P;P<C.length;P++){y=C[P];if(c>0&&!y.g(x))K=N.appendChild(y.K()[0]);
if(!q[P]||!y.parent().g(q[P].parent()))for(y=y[0].previousSibling;y;){if(l.g(q[P],y)||l.g(p,y))break;F=y.previousSibling;if(c==2)N.insertBefore(y.cloneNode(n),N.firstChild);else{l.j(y);c==1&&N.insertBefore(y,N.firstChild)}y=F}if(K)N=K}if(c==2){S=this.startContainer[0];if(S.nodeType==e.f&&S.nextSibling&&S.nextSibling.nodeType==e.f){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}S=this.endContainer[0];if(S.nodeType==e.f&&S.nextSibling&&S.nextSibling.nodeType==e.f){S.data+=S.nextSibling.data;
S.parentNode.removeChild(S.nextSibling)}}else{if(W&&S&&(!p.parent().g(W.parent())||!x.parent().g(S.parent()))){W=S.v();Q&&S.parent().g(p.parent())&&W--;this.setStart(S.parent(),W)}this.collapse(n)}Q&&p.j();O&&x[0].parentNode&&x.j()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=n},clone:function(){var c=new D(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},cd:function(){var c=this.clone();c.kc();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return k;var h=new r.Ba(c),p=B(n,undefined),x=v(n);c.R=function(q){return x(q)&&p(q)};c=h.next();h.reset();h=h.ob();return c&&c.g(h)?c:k},Na:function(c,h){if(!this.collapsed){c=c||t.Ac;var p=this.clone(),x=this.startContainer,q=this.endContainer,C=this.startOffset,
Q=this.endOffset,N=1,O=1;if(x&&x[0].nodeType==e.f)if(C)if(C>=x[0].nodeValue.length)p.setStartAfter(x);else{p.setStartBefore(x);N=0}else p.setStartBefore(x);if(q&&q[0].nodeType==e.f)if(Q)if(Q>=q[0].nodeValue.length)p.setEndAfter(q);else{p.setEndAfter(q);O=0}else p.setEndBefore(q);p=new o(p);p.R=function(W){W=W[0]||W;return W.nodeType==(c==t.ea?e.e:e.f)};var P;p.cc=function(W,S){W=W[0]||W;if(c==t.ea&&W.nodeType==e.f)return f;if(S&&W==P)return f;if(!S&&W.nodeType==e.e)P=W;return n};if(N)(x=p[c==t.ea?
"lastForward":"next"]())&&this.U(x,h?t.W:t.C);if(O){p.reset();(p=p[c==t.ea?"lastBackward":"previous"]())&&this.T(p,h?t.J:t.t)}return!!(N||O)}},ze:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Wc:function(c){var h=this.startContainer,p=this.endContainer,x=this.startOffset,q=this.endOffset,C,Q;if(!h||!p)return{start:0,end:0};if(c){if(h[0].nodeType==e.e)if((C=new s(h[0].childNodes[x]))&&C[0]&&C[0].nodeType==e.f&&x>0&&C[0].previousSibling.nodeType==
e.f){h=C;x=0}for(;h[0].nodeType==e.f&&(Q=h.sa())&&Q[0].nodeType==e.f;){h=Q;x+=Q[0].nodeValue.length}if(!this.collapsed){if(p[0].nodeType==e.e)if((C=new s(p[0].childNodes[q]))&&C[0]&&C[0].nodeType==e.f&&q>0&&C[0].previousSibling.nodeType==e.f){p=C;q=0}for(;p[0].nodeType==e.f&&(Q=p.sa())&&Q[0].nodeType==e.f;){p=Q;q+=Q[0].nodeValue.length}}}return{start:h.Ca(c),end:this.collapsed?k:p.Ca(c),startOffset:x,endOffset:q,qd:c,He:n}},P:function(c){var h,p,x,q,C=this.collapsed;h=new s("<span>",k,this.document);
h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){x=j.guid("ke_bm_");h.attr("id",x+"S")}if(!C){p=h.K();p.html("&nbsp;");c&&p.attr("id",x+"E");q=this.clone();q.collapse();q.insertNode(p)}q=this.clone();q.collapse(n);q.insertNode(h);if(p){this.setStartAfter(h);this.setEndBefore(p)}else this.H(h,t.t);return{Z:c?x+"S":h,Q:c?x+"E":p,Cd:c,collapsed:C}},H:function(c,h){this.U(c,h);this.collapse(n)},trim:function(c,h){var p=this.startContainer,x=this.startOffset,q=this.collapsed;if((!c||
q)&&p[0]&&p[0].nodeType==e.f){if(x)if(x>=p[0].nodeValue.length){x=p.v()+1;p=p.parent()}else{var C=p.ia(x);x=p.v()+1;p=p.parent();if(l.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(l.g(p,this.endContainer))this.endOffset+=1}else{x=p.v();p=p.parent()}this.setStart(p,x);if(q){this.collapse(n);return}}p=this.endContainer;x=this.endOffset;if(!(h||q)&&p[0]&&p[0].nodeType==e.f){if(x){x>=p.nodeValue.length||p.ia(x);x=p.v()+1}else x=p.v();p=p.parent();this.setEnd(p,
x)}},insertNode:function(c){this.lc();this.trim(f,n);var h=this.startContainer,p=h[0].childNodes[this.startOffset];p?l.insertBefore(c[0]||c,p):h[0].appendChild(c[0]||c);l.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.He){var h=a(this.document,c.start,c.qd),p=c.startOffset,x=c.end&&a(this.document,c.end,c.qd);c=c.endOffset;this.setStart(h,p);x?this.setEnd(x,c):this.collapse(n)}else{h=(p=c.Cd)?j.one("#"+c.Z,this.document):c.Z;c=p?j.one("#"+
c.Q,this.document):c.Q;this.setStartBefore(h);h.j();if(c&&c[0]){this.setEndBefore(c);c.j()}else this.collapse(n)}},va:function(c,h){var p=this.startContainer,x=this.endContainer;p=l.g(p,x)?c&&p[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new s(p[0].childNodes[this.startOffset]):p:p.Fb(x);return h&&p[0].nodeType==e.f?p.parent():p},Ia:function(c){switch(c){case t.yb:if(this.collapsed)break;c=this.va();var h=new s(this.document.body),p,x,q,C,Q,N=f,O,P;O=this.startContainer;P=this.startOffset;
if(O[0].nodeType==e.f){if(P){O=!j.trim(O[0].nodeValue.substring(0,P)).length&&O;N=!!O}if(O)if(!(C=O[0].previousSibling))q=O.parent()}else{if(P)C=O[0].childNodes[P-1]||O[0].lastChild;C||(q=O)}for(;q||C;){if(q&&!C){if(!Q&&l.g(q,c))Q=n;if(!h.L(q))break;if(!N||q.css("display")!="inline"){N=f;if(Q)p=q;else this.setStartBefore(q)}C=q[0].previousSibling}for(;C;){O=f;if(C.nodeType==e.f){P=C.nodeValue;if(/[^\s\ufeff]/.test(P))C=k;O=/[\s\ufeff]$/.test(P)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(N&&
d.ba[C.nodeName.toLowerCase()]){P=l.text(C);if(/[^\s\ufeff]/.test(P))C=k;else for(var W=C.all||C.getElementsByTagName("*"),S=0,y;y=W[S++];)if(!d.ba[y.nodeName.toLowerCase()]){C=k;break}if(C)O=!!P.length}else C=k;if(O)if(N)if(Q)p=q;else q&&this.setStartBefore(q);else N=n;if(C){O=C.previousSibling;if(!q&&!O){q=new s(C);C=k;break}C=O}else q=k}if(q)q=q.parent()}O=this.endContainer;P=this.endOffset;q=C=k;Q=N=f;if(O[0].nodeType==e.f){O=!j.trim(O[0].nodeValue.substring(P)).length&&O;N=!(O&&O[0].nodeValue.length);
if(O)if(!(C=O[0].nextSibling))q=O.parent()}else(C=O[0].childNodes[P])||(q=O);for(;q||C;){if(q&&!C){if(!Q&&l.g(q,c))Q=n;if(!h.L(q))break;if(!N||q.css("display")!="inline"){N=f;if(Q)x=q;else q&&this.setEndAfter(q)}C=q[0].nextSibling}for(;C;){O=f;if(C.nodeType==e.f){P=C.nodeValue;if(/[^\s\ufeff]/.test(P))C=k;O=/^[\s\ufeff]/.test(P)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(N&&d.ba[C.nodeName.toLowerCase()]){P=l.text(C);if(/[^\s\ufeff]/.test(P))C=k;else{W=C.all||C.getElementsByTagName("*");
for(S=0;y=W[S++];)if(!d.ba[y.nodeName.toLowerCase()]){C=k;break}}if(C)O=!!P.length}else C=k;if(O)if(N)if(Q)x=q;else this.setEndAfter(q);if(C){O=C.nextSibling;if(!q&&!O){q=new s(C);C=k;break}C=O}else q=k}if(q)q=q.parent()}if(p&&x){c=p.L(x)?x:p;this.setStartBefore(c);this.setEndAfter(c)}break;case t.xb:case t.Ra:q=new D(this.document);h=new s(this.document.body);q.U(h,t.W);q.setEnd(this.startContainer,this.startOffset);q=new o(q);var K,F,H=o.Pb(c==t.Ra?{Qb:1}:k),I=function(M){var L=H(M);L||(K=M);return L};
p=function(M){var L=I(M);if(!L&&M[0]&&M.d()=="br")F=M;return L};q.cc=I;q=q.nd();K=K||h;this.U(K,K.d()!="br"&&(!q&&this.ua()||q&&K.L(q))?t.W:t.t);q=this.clone();q.collapse();q.T(h,t.J);q=new o(q);q.cc=c==t.Ra?p:I;K=k;q=q.od();K=K||h;this.T(K,!q&&this.ka()||q&&K.L(q)?t.J:t.C);F&&this.setEndAfter(F)}},ua:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==e.f)if(j.trim(c[0].nodeValue.substring(0,h)).length)return f;this.trim();c=new m(this.startContainer);h=this.clone();h.collapse(n);
h.U(c.z||c.F,t.W);c=new o(h);c.R=A(n);return c.Tc()},ka:function(){var c=this.endContainer,h=this.endOffset;if(c[0].nodeType==e.f)if(j.trim(c[0].nodeValue.substring(h)).length)return f;this.trim();c=new m(this.endContainer);h=this.clone();h.collapse(f);h.T(c.z||c.F,t.J);c=new o(h);c.R=A(f);return c.Uc()},deleteContents:function(){this.collapsed||this.Wb(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Wb(1,c);return c},Sb:function(c,h){var p=this.clone();
p[h==t.Va?"setStartAt":"setEndAt"](c,h==t.Va?t.W:t.J);p=new o(p);p.R=u;return p[h==t.Va?"checkBackward":"checkForward"]()},$c:function(){var c=this.startContainer,h=this.endContainer,p=this.startOffset,x=this.endOffset,q;if(c[0].nodeType==e.e){q=c[0].childNodes.length;if(q>p)c=new s(c[0].childNodes[p]);else if(q<1)c=c.ha();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new s(c);c=c.w()||c}}if(h[0].nodeType==e.e){q=h[0].childNodes.length;if(q>x)h=(new s(h[0].childNodes[x])).ha(n);else if(q<1)h=h.ha();
else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new s(h)}}if(c.Da(h)&G.ca)c=h;return{Z:c,Q:h}},gb:function(c,h){var p=this.P(),x=new s(this.document.createElement(h));this.collapse(c);this.Ia(t.xb);x[0].appendChild(this.extractContents());x.bb();b.ie||x.Db();this.insertNode(x);this.moveToBookmark(p);return x},qc:function(c){var h=new m(this.startContainer),p=new m(this.endContainer),x=h.z,q=p.z,C=k;if(!h.F.g(p.F))return k;if(c!="br"){if(!x){x=this.gb(n,c);q=(new m(this.endContainer)).z}q||(q=this.gb(f,
c))}c=x&&this.ua();h=q&&this.ka();this.deleteContents();if(x&&l.g(x,q))if(h){C=new m(this.startContainer);this.H(q,t.t);q=k}else if(c){C=new m(this.startContainer);this.H(x,t.C);x=k}else{q=this.rc(x);!b.ie&&!j.inArray(x.d(),["ul","ol"])&&x.Db()}return{If:x,Hf:q,Ze:c,Ye:h,Ef:C}},rc:function(c){if(!this.collapsed)return k;this.T(c,t.J);var h=this.extractContents(),p=c.K(f);p[0].appendChild(h);p.insertAfter(c);this.H(c,t.t);return p},kb:function(c,h){var p,x=r.m;if(x.tb[c.d()])return f;for(;c&&c[0].nodeType==
e.e;){if(p=c.Hc())this.H(c,h?t.J:t.W);else if(x.uc[c.d()]){this.H(c,h?t.t:t.C);return n}if((c=x.tb[c.d()]?c[h?"_4e_previous":"_4e_next"](J):c[h?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,h?t.t:t.C);return n}}return p},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var g={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},z=new o.Pa,E=new o.ta;r.Range=D;r.Range=D;var w=D.prototype;r.k.o(w,{updateCollapsed:w.Oa,optimize:w.kc,setStartAfter:w.setStartAfter,setEndAfter:w.setEndAfter,setStartBefore:w.setStartBefore,setEndBefore:w.setEndBefore,optimizeBookmark:w.lc,setStart:w.setStart,setEnd:w.setEnd,setStartAt:w.U,setEndAt:w.T,execContentsAction:w.Wb,collapse:w.collapse,clone:w.clone,getEnclosedNode:w.cd,shrink:w.Na,getTouchedStartNode:w.ze,createBookmark2:w.Wc,createBookmark:w.P,
moveToPosition:w.H,trim:w.trim,insertNode:w.insertNode,moveToBookmark:w.moveToBookmark,getCommonAncestor:w.va,enlarge:w.Ia,checkStartOfBlock:w.ua,checkEndOfBlock:w.ka,deleteContents:w.deleteContents,extractContents:w.extractContents,checkBoundaryOfElement:w.Sb,getBoundaryNodes:w.$c,fixBlock:w.gb,splitBlock:w.qc,splitElement:w.rc,moveToElementEditablePosition:w.kb,selectNodeContents:w.selectNodeContents})});
KISSY.Editor.add("domiterator",function(r){function D(o){if(!(arguments.length<1)){this.xa=o;this.Yb=J;this.Zc=u;this.Vb=J;this.c||(this.c={})}}var u=T,J=V,A=KISSY,B=A.UA,v=r.Ba,n=r.Range,f=r.oa,k=r.n,j=r.Sa,e=A.Node,t=A.DOM,G=/^[\r\n\t ]*$/;v.ta();A.augment(D,{ye:function(o){var l,a,b,d,m;if(!this.c.I){a=this.xa.clone();a.Na(f.ea,u);a.Ia(this.Yb||!this.Zc?f.Ra:f.xb);var s=new v(a),i=v.ta(u,u);s.R=i;this.c.la=s.next();s=new v(a);s.R=i;s=s.ob();this.c.I=s.w(u);if(this.c.I&&this.c.I[0].nodeType==k.f&&
!A.trim(this.c.I[0].nodeValue)&&this.c.I.parent().qa()){i=new n(a.document);i.H(this.c.I,f.t);if(i.ka()){i=new j(i.endContainer);this.c.I=(i.z||i.F).w(u)}}if(!this.c.I){this.c.I=this.c.Yc=new e(a.document.createTextNode(""));t.insertAfter(this.c.I[0],s[0])}a=U}i=this.c.la;s=this.c.I;for(this.c.la=U;i;){var g=J,z=i[0].nodeType!=k.e,E=J;if(z){if(i[0].nodeType==k.f)if(G.test(i[0].nodeValue))z=J}else{var w=i.d();if(i.qa(this.Yb&&{Qb:1})){if(w=="br")z=u;else if(!a&&!i[0].childNodes.length&&w!="hr"){l=
i;b=i.g(s);break}if(a){a.T(i,f.C);if(w!="br")this.c.la=i}g=u}else{if(i[0].firstChild){if(!a){a=new n(this.xa.document);a.U(i,f.C)}i=new e(i[0].firstChild);continue}z=u}}if(z&&!a){a=new n(this.xa.document);a.U(i,f.C)}b=(!g||z)&&i.g(s);if(a&&!g)for(;!i[0].nextSibling&&!b;){w=i.parent();if(w.qa(this.Yb&&{Qb:1})){g=u;b||w.g(s);break}i=w;z=u;b=i.g(s);E=u}z&&a.T(i,f.t);i=i.w(E,U,s);if((b=!i)||g&&a)break}if(!l){if(!a){this.c.Yc&&this.c.Yc.j();return this.c.la=U}l=new j(a.startContainer);i=l.F;g={Cf:1,Nf:1,
Mf:1};l=l.z;if((!l||!l[0])&&!this.Vb&&g[i.d()]&&a.ua()&&a.ka())l=i;else if(!l||this.Vb&&l.d()=="li"){l=new e(this.xa.document.createElement(o||"p"));l[0].appendChild(a.extractContents());l.bb();a.insertNode(l);d=m=u}else if(l.d()!="li"){if(!a.ua()||!a.ka()){l=l.K(J);l[0].appendChild(a.extractContents());l.bb();m=a.qc();d=!m.Ze;m=!m.Ye;a.insertNode(l)}}else if(!b)this.c.la=l.g(s)?U:a.$c().Q.w(u,U,s)}if(d){a=new e(l[0].previousSibling);if(a[0]&&a[0].nodeType==k.e)if(a.d()=="br")a.j();else a[0].lastChild&&
t.d(a[0].lastChild)=="br"&&t.j(a[0].lastChild)}if(m){a=v.ta(J,u);d=new e(l[0].lastChild);if(d[0]&&d[0].nodeType==k.e&&d.d()=="br")if(B.ie||d.sa(a)||d.Za(a))d.j()}if(!this.c.la)this.c.la=b||l.g(s)?U:l.w(u,U,s);return l}});n.prototype.qe=function(){return new D(this)}});
KISSY.Editor.add("selection",function(r){function D(i){this.document=this.document=i;this.c={N:{}};if(f.ie){var g=this.r().createRange();if(!g||g.item&&g.item(0).ownerDocument!=i||g.parentElement&&g.parentElement().ownerDocument!=i)this.md=A}}function u(i){i=new D(i);return!i||i.md?v:i}function J(i){var g=i.document,z=new e(g.body),E=new e(g.documentElement);if(f.ie){if(f.ie<8||document.documentMode==7)E.on("click",function(N){k.d(N.target)==="html"&&i.getSelection().A()[0].select()});var w,c,h=1;
E.on("mousedown",function(){h=0});E.on("mouseup",function(){h=1});z.on("focusin",function(N){if(k.d(N.target)=="body")if(w){try{h&&w.select()}catch(O){}w=v}});z.on("focus",function(){c=A;x()});z.on("beforedeactivate",function(N){if(!N.relatedTarget){c=B;h=1}});j.on(k.ga(g),"blur",function(){g&&g.selection.empty()});z.on("mousedown",function(){p()});z.on("mouseup",function(){c=A;setTimeout(function(){x(A)},0)});var p=function(){c=B},x=function(N){if(c){var O=i.document,P=i.getSelection(),W=P&&P.hb(),
S=P&&P.r();if(N&&S&&W==t.Ab)if(!O.queryCommandEnabled("InsertImage")){setTimeout(function(){x(A)},50);return}var y;if(!(S&&W==t.pa&&(y=k.d(S.createRange().parentElement()))&&y in{input:1,textarea:1})){w=S&&P.A()[0];i.cb()}}};z.on("keydown",p);z.on("keyup",function(){c=A;x()});j.on(g,"selectionchange",x)}else{j.on(g,"mouseup",i.cb,i);j.on(g,"keyup",i.cb,i)}var q={table:1,pre:1},C=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,Q=r.Ba.Pa(A);
i.on("selectionChange",function(N){var O=N.path;N=(N=N.selection)&&N.A()[0];var P=O.F;if(N)if(N.collapse&&!O.z&&P.d()=="body"){O=N.gb(A,"p");if(O.$a().match(C))if((P=O.Za(Q))&&P[0].nodeType==o.e&&!q[P.d()]){N.kb(P);O.j()}else if((P=O.sa(Q))&&P[0].nodeType==o.e&&!q[P.d()]){N.kb(P,P.$a().match(C)?B:A);O.j()}N.select();f.ie||i.lb()}})}r.Nd={Ab:1,pa:2,Ua:3};var A=T,B=V,v=U,n=KISSY,f=n.UA,k=n.DOM,j=n.Event,e=n.Node,t=r.Nd,G=r.oa,o=r.n,l=r.Ba,a=r.Range,b={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};n.augment(D,{r:f.ie?function(){var i=this.c.N;return i.ic||(i.ic=this.document.selection)}:function(){var i=this.c.N;return i.ic||(i.ic=k.ga(this.document).getSelection())},hb:f.ie?function(){var i=this.c.N;if(i.type)return i.type;var g=t.Ab;try{var z=this.r(),E=z.type;if(E=="Text")g=t.pa;if(E=="Control")g=t.Ua;if(z.createRange().parentElement)g=t.pa}catch(w){}return i.type=g}:function(){var i=this.c.N;
if(i.type)return i.type;var g=t.pa,z=this.r();if(z){if(z.rangeCount==1){z=z.getRangeAt(0);var E=z.startContainer;if(E==z.endContainer&&E.nodeType==o.e&&z.endOffset-z.startOffset===1&&b[E.childNodes[z.startOffset].nodeName.toLowerCase()])g=t.Ua}}else g=t.Ab;return i.type=g},A:f.ie?function(){function i(g,z){g=g.duplicate();g.collapse(z);for(var E=g.parentElement(),w=E.childNodes,c,h=0;h<w.length;h++){var p=w[h];if(p.nodeType==o.e){c=g.duplicate();c.moveToElementText(p);p=c.compareEndPoints("StartToStart",
g);var x=c.compareEndPoints("EndToStart",g);c.collapse();if(p>0)break;else if(!p||x==1&&p==-1)return{Ha:E,offset:h};else if(!x)return{Ha:E,offset:h+1};c=v}}if(!c){c=g.duplicate();c.moveToElementText(E);c.collapse(B)}c.setEndPoint("StartToStart",g);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=w[--h].nodeValue.length}catch(q){c=0}return c===0?{Ha:E,offset:h}:{Ha:w[h],offset:-c}}return function(){var g=this.c.N;if(g.na)return g.na;var z=this.r(),E=z&&z.createRange(),w=this.hb();if(!z)return[];
if(w==t.pa){z=new a(this.document);w=i(E,A);z.setStart(new e(w.Ha),w.offset);w=i(E);z.setEnd(new e(w.Ha),w.offset);return g.na=[z]}else if(w==t.Ua){g=g.na=[];for(w=0;w<E.length;w++){var c=E.item(w),h=c.parentNode,p=0;for(z=new a(this.document);p<h.childNodes.length&&h.childNodes[p]!=c;p++);z.setStart(new e(h),p);z.setEnd(new e(h),p+1);g.push(z)}return g}return g.na=[]}}():function(){var i=this.c.N;if(i.na)return i.na;var g=[],z=this.r();if(!z)return[];for(var E=0;E<z.rangeCount;E++){var w=z.getRangeAt(E),
c=new a(this.document);c.setStart(new e(w.startContainer),w.startOffset);c.setEnd(new e(w.endContainer),w.endOffset);g.push(c)}return i.na=g},bc:function(){var i=this.c.N;if(i.Dd!==undefined)return i.Dd;var g,z=this.r();switch(this.hb()){case t.Ua:return this.ac();case t.pa:var E=this.A()[0];if(E)if(!E.collapsed){for(E.kc();A;){g=E.startContainer;if(E.startOffset==(g[0].nodeType===o.e?g[0].childNodes.length:g[0].nodeValue.length)&&!g.qa())E.setStartAfter(g);else break}g=E.startContainer;if(g[0].nodeType!=
o.e)return g.parent();g=new e(g[0].childNodes[E.startOffset]);if(!g[0]||g[0].nodeType!=o.e)return E.startContainer;for(E=g[0].firstChild;E&&E.nodeType==o.e;){g=new e(E);E=E.firstChild}return g}if(f.ie){E=z.createRange();E.collapse(A);g=E.parentElement()}else if((g=z.anchorNode)&&g.nodeType!=o.e)g=g.parentNode}return i.Dd=g?k.D(g):v},ac:function(){var i=this,g,z=i.c.N;if(z.Bd!==undefined)return z.Bd;if(f.ie){g=i.r().createRange();g=g.item&&g.item(0)}g||(g=function(){for(var E=i.A()[0],w,c,h=2;h&&!((w=
E.cd())&&w[0].nodeType==o.e&&b[w.d()]&&(c=w));h--)E.Na(G.ea);return c&&c[0]}());return z.Bd=k.D(g)},reset:function(){this.c.N={}},pc:function(i){var g;if(f.ie)try{g=this.document.body.createControlRange();g.addElement(i[0]);g.select()}catch(z){g=this.document.body.createTextRange();g.moveToElementText(i[0]);g.select()}finally{}else{g=this.document.createRange();g.selectNode(i[0]);i=this.r();i.removeAllRanges();i.addRange(g)}this.reset()},rb:function(i){if(f.ie){if(i.length>1){var g=i[i.length-1];
i[0].setEnd(g.endContainer,g.endOffset);i.length=1}i[0]&&i[0].select()}else{g=this.r();if(!g)return;g.removeAllRanges();for(var z=0;z<i.length;z++){var E=i[z],w=this.document.createRange(),c=E.startContainer;E.collapsed&&f.gecko&&f.gecko<1.09&&c[0].nodeType==o.e&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));w.setStart(c[0],E.startOffset);w.setEnd(E.endContainer[0],E.endOffset);g.addRange(w)}}this.reset()},pe:function(i){for(var g=[],z=this.A(),E=0;E<z.length;E++)g.push(z[E].Wc(i));
return g},oe:function(i,g){var z=[],E=this.document,w;g=g||this.A();for(var c=g.length,h=0;h<c;h++){z.push(w=g[h].P(i,A));var p=(i=w.Cd)?n.one("#"+w.Z,E):w.Z;w=i?n.one("#"+w.Q,E):w.Q;for(var x=h+1;x<c;x++){var q=g[x],C=q.startContainer,Q=q.endContainer;k.g(C,p.parent())&&q.startOffset++;k.g(C,w.parent())&&q.startOffset++;k.g(Q,p.parent())&&q.endOffset++;k.g(Q,w.parent())&&q.endOffset++}}return z},Ad:function(i){for(var g=[],z=0;z<i.length;z++){var E=new a(this.document);E.moveToBookmark(i[z]);g.push(E)}this.rb(g);
return this},va:function(){var i=this.A();return i[0].startContainer.Fb(i[i.length-1].endContainer)},scrollIntoView:function(){var i=this.bc();i&&i.Kb()},removeAllRanges:function(){var i=this.r();if(f.ie)i&&i.clear();else i&&i.removeAllRanges()}});var d={table:1,tbody:1,tr:1},m=l.Pa(A),s=/\ufeff|\u00a0/;a.prototype.select=a.prototype.select=f.ie?function(i){var g=this.collapsed,z,E;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var w=this.startContainer[0].childNodes[this.startOffset];
if(w.nodeType==o.e){(new D(this.document)).pc(new e(w));return}}if(this.startContainer[0].nodeType==o.e&&this.startContainer.d()in d||this.endContainer[0].nodeType==o.e&&this.endContainer.d()in d)this.Na(G.ea,A);var c=this.P();w=c.Z;var h;if(!g)h=c.Q;c=this.document.body.createTextRange();c.moveToElementText(w[0]);c.moveStart("character",1);if(h){i=this.document.body.createTextRange();i.moveToElementText(h[0]);c.setEndPoint("EndToEnd",i);c.moveEnd("character",-1)}else{for(z=w[0].nextSibling;z&&!m(z);)z=
z.nextSibling;z=!(z&&z.nodeValue&&z.nodeValue.match(s))&&(i||!w[0].previousSibling||w[0].previousSibling&&k.d(w[0].previousSibling)=="br");E=this.document.createElement("span");E.innerHTML="&#65279;";E=new e(E);k.insertBefore(E[0],w[0]);z&&k.insertBefore(this.document.createTextNode("\ufeff"),w[0])}this.setStartBefore(w);w.j();if(g){if(z){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(E){this.H(E,G.C);E.j()}}else{this.setEndBefore(h);h.j();c.select()}}:function(){var i=
this.startContainer;this.collapsed&&i[0].nodeType==o.e&&!i[0].childNodes.length&&i[0].appendChild(this.document.createTextNode(""));var g=this.document.createRange();g.setStart(i[0],this.startOffset);try{g.setEnd(this.endContainer[0],this.endOffset)}catch(z){if(z.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(A);g.setEnd(this.endContainer[0],this.endOffset)}else throw z;}i=u(this.document).r();i.removeAllRanges();i.addRange(g)};D.getSelection=u;r.Cc=D;r.Selection=D;l=D.prototype;r.k.o(l,
{getNative:l.r,getType:l.hb,getRanges:l.A,getStartElement:l.bc,getSelectedElement:l.ac,reset:l.reset,selectElement:l.pc,selectRanges:l.rb,createBookmarks2:l.pe,createBookmarks:l.oe,getCommonAncestor:l.va,scrollIntoView:l.scrollIntoView,selectBookmarks:l.Ad,removeAllRanges:l.removeAllRanges});r.on("instanceCreated",function(i){J(i.te)})});
KISSY.Editor.add("styles",function(r){function D(y,K){for(var F in y)y[F]=y[F].replace(W,function(H,I){return K[I]})}function u(y,K){if(K){y=g.clone(y);D(y.attributes,K);D(y.styles,K)}var F=this.element=this.element=(y.element||"*").toLowerCase();this.type=this.type=F=="#"||N[F]?E.Bb:O[F]?E.Wa:E.Aa;this.c={definition:y}}function J(y,K){var F=K?this.oc:this.Nb;y.body.focus();for(var H=new c(y),I=H.A(),M=0;M<I.length;M++)F.call(this,I[M]);H.rb(I)}function A(y,K){var F;F=y.element;if(F=="*")F="span";
F=new q(K.createElement(F));return B(F,y)}function B(y,K){var F=K.c.definition,H=F.attributes;F=u.fd(F);if(H)for(var I in H)y.attr(I,H[I]);if(F)y[0].style.cssText=F;return y}function v(y){var K=y.P(m),F=y.qe();F.Vb=m;F.Zc=m;for(var H,I=y.document;H=F.ye();){var M=A(this,I);H=H;var L=M;M=L.d=="pre";var R=H.d=="pre",$=!M&&R;if(M&&!R){R=H;L=L;$=R.html();$=n($,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");$=$.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");$=$.replace(/([ \t\n\r]+|&nbsp;)/g," ");$=$.replace(/<br\b[^>]*>/gi,
"\n");if(C.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+$+"</pre>";L=new q(R.firstChild);L.j()}else L.html($);L=L}else if($)L=k(f(H),L);else H.Ib(L);H[0].parentNode.replaceChild(L[0],H[0]);if(M){H=L;M=void 0;if((M=H.ha(m,h.e))&&M.d()=="pre"){L=n(M.html(),/\n$/,"")+"\n\n"+n(H.html(),/^\n/,"");if(C.ie)H[0].outerHTML="<pre>"+L+"</pre>";else H.html(L);M.j()}}}y.moveToBookmark(K)}function n(y,K,F){var H="",I="";y=y.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(M,L,R){L&&(H=L);R&&(I=R);return""});return H+y.replace(K,F)+I}function f(y){var K=[];n(y.$a(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(F,H,I){return H+"</pre>"+I+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(F,H){K.push(H)});return K}function k(y,K){for(var F=K[0].ownerDocument.createDocumentFragment(),H=0;H<y.length;H++){var I=y[H];I=I.replace(/(\r\n|\r)/g,"\n");I=n(I,/^[ \t]*\n/,"");I=n(I,/\n$/,"");I=n(I,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});I=I.replace(/\n/g,"<br>");I=I.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=K.K();M.html(I);F.appendChild(M[0])}return F}function j(y){var K=y.document;if(y.collapsed){K=A(this,K);y.insertNode(K);y.H(K,w.J)}else{var F=this.element,H=this.c.definition,I,M=r.m[F]||(I=m,r.m.span),L=y.P();y.Ia(w.yb);y.trim();var R=y.P(),$=R.Z;R=R.Q;for(var Z=$,ba;Z&&Z[0];){var X=s;if(z.g(Z,R)){Z=i;
X=m}else{var Y=Z[0].nodeType,ea=Y==h.e?Z.d():i;if(ea&&Z.attr("_ke_bookmark")){Z=Z.w(m);continue}if(!ea||M[ea]&&(Z.Da(R)|p.Y|p.da|p.X)==p.Y+p.da+p.X&&(!H.childRule||H.childRule(Z))){var aa=Z.parent();if(aa&&aa[0]&&((r.m[aa.d()]||r.m.span)[F]||I)&&(!H.parentRule||H.parentRule(aa))){if(!ba&&(!ea||!r.m.ba[ea]||(Z.Da(R)|p.Y|p.da|p.X)==p.Y+p.da+p.X)){ba=new x(K);ba.setStartBefore(Z)}if(Y==h.f||Y==h.e&&!Z[0].childNodes.length){Y=Z;for(var ca;!Y[0].nextSibling&&(ca=Y.parent(),M[ca.d()])&&(ca.Da($)|p.ca|p.da|
p.X)==p.ca+p.da+p.X&&(!H.childRule||H.childRule(ca));)Y=ca;ba.setEndAfter(Y);Y[0].nextSibling||(X=m)}}else X=m}else X=m;Z=Z.w()}if(X&&ba&&!ba.collapsed){X=A(this,K);for(Y=ba.va();X&&Y&&X[0]&&Y[0];){if(Y.d()==F){for(var da in H.attributes)X.attr(da)==Y.attr(da)&&X[0].removeAttribute(da);for(var ha in H.styles)X.M(ha)==Y.M(ha)&&X.M(ha,"");if(!X.Ya()){X=i;break}}Y=Y.parent()}if(X){X[0].appendChild(ba.extractContents());Y=X;ea=o(this);aa=Y.all(this.element);for(var fa=aa.length;--fa>=0;)l(this,new q(aa[fa]));
var ga=void 0;for(ga in ea)if(ga!=this.element){aa=Y.all(ga);for(fa=aa.length-1;fa>=0;fa--){var ia=new q(aa[fa]);b(ia,ea[ga])}}ba.insertNode(X);X.ra();C.ie||X[0].normalize()}ba=i}}$.j();R.j();y.moveToBookmark(L);y.Na(w.Ac)}}function e(y){y.Ia(w.yb);var K=y.P(),F=K.Z;if(y.collapsed){for(var H=new Q(F.parent()),I,M=0,L;M<H.elements.length&&(L=H.elements[M]);M++){if(L==H.z||L==H.F)break;if(this.ja(L)){var R=y.Sb(L,w.Kd),$=!R&&y.Sb(L,w.Va);if($||R){I=L;I.match=$?"start":"end"}else{L.ra();L.d()==this.element?
l(this,L):b(L,o(this)[L.d()])}}}if(I&&I[0]){L=F;for(M=0;;M++){R=H.elements[M];if(z.g(R,I))break;else if(R.match)continue;else R=R.K();R[0].appendChild(L[0]);L=R}z[I.match=="start"?"insertBefore":"insertAfter"](L[0],I[0])}}else{var Z=K.Q,ba=this;H=function(){for(var X=new Q(F.parent()),Y=new Q(Z.parent()),ea=i,aa=i,ca=0;ca<X.elements.length;ca++){var da=X.elements[ca];if(da==X.z||da==X.F)break;if(ba.ja(da))ea=da}for(ca=0;ca<Y.elements.length;ca++){da=Y.elements[ca];if(da==Y.z||da==Y.F)break;if(ba.ja(da))aa=
da}aa&&Z.Eb(aa);ea&&F.Eb(ea)};H();for(I=new q(F[0].nextSibling);I[0]!==Z[0];){M=I.w();if(I[0]&&I[0].nodeType==h.e&&this.ja(I)){I.d()==this.element?l(this,I):b(I,o(this)[I.d()]);if(M[0].nodeType==h.e&&M.L(F)){H();M=new q(F[0].nextSibling)}}I=M}}y.moveToBookmark(K)}function t(y){var K={};y.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(F,H,I){K[H]=I});return K}function G(y,K){var F;if(K!==s){F=document.createElement("span");F.style.cssText=y;F=F.style.cssText||""}else F=
y;return F.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function o(y){if(y.c.zd)return y.c.zd;var K=y.c.zd={},F=y.c.definition.overrides;if(F){g.isArray(F)||(F=[F]);for(var H=0;H<F.length;H++){var I=F[H],M,L;if(typeof I=="string")M=I.toLowerCase();else{M=I.element?I.element.toLowerCase():y.element;L=I.attributes}I=K[M]||(K[M]={});if(L){I=I.attributes=I.attributes||[];for(var R in L)I.push([R.toLowerCase(),L[R]])}}}return K}function l(y,K){var F=y.c.definition,
H=g.mix(g.mix({},F.attributes),o(y)[K.d()]);F=F.styles;var I=g.isEmptyObject(H)&&g.isEmptyObject(F),M;for(M in H)if(!((M=="class"||y.c.definition.fullMatch)&&K.attr(M)!=a(M,H[M]))){I=I||!!K.Gc(M);K.removeAttr(M)}for(var L in F)if(!(y.c.definition.fullMatch&&K.M(L)!=a(L,F[L],m))){I=I||!!K.M(L);K.M(L,"")}I&&d(K)}function a(y,K,F){var H=new q("<span>");H[F?"_4e_style":"attr"](y,K);return H[F?"_4e_style":"attr"](y)}function b(y,K){var F=K&&K.attributes;if(F)for(var H=0;H<F.length;H++){var I=F[H][0],M;
if(M=y.attr(I)){var L=F[H][1];if(L===i||L.test&&L.test(M)||typeof L=="string"&&M==L)y[0].removeAttribute(I)}}d(y)}function d(y){if(!y.Ya()){var K=y[0].firstChild,F=y[0].lastChild;y.j(m);if(K){K.nodeType==h.e&&z.ra(K);F&&!K===F&&F.nodeType==h.e&&z.ra(F)}}}var m=T,s=V,i=U,g=KISSY,z=g.DOM,E={Bb:1,Aa:2,Wa:3},w=r.oa,c=r.Cc,h=r.n,p=r.Ta,x=r.Range,q=g.Node,C=g.UA,Q=r.Sa,N={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},O={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,
dd:1,form:1},P=/\s*(?:;\s*|$)/,W=/#\((.+?)\)/g;r.pf=E;u.prototype={apply:function(y){J.call(this,y,s)},remove:function(y){J.call(this,y,m)},Nb:function(y){return(this.Nb=this.type==E.Aa?j:this.type==E.Bb?v:this.type==E.Wa?i:i).call(this,y)},oc:function(y){return(this.oc=this.type==E.Aa?e:i).call(this,y)},de:function(y){B(y,this)},ja:function(y,K){if(!y)return s;var F=this.c.definition;if(y.d()==this.element){if(!K&&!y.Ya())return m;var H=F.Wd;if(H)F=H;else{H={};var I=0,M=F.attributes;if(M)for(var L in M){I++;
H[L]=M[L]}if(M=u.fd(F)){H.style||I++;H.style=M}H._length=I;F=F.Wd=H}if(F._length){for(var R in F)if(R!="_length"){I=y.attr(R)||"";if(R=="style")a:{H=F[R];I=G(I,s);typeof H=="string"&&(H=t(H));typeof I=="string"&&(I=t(I));M=void 0;for(M in H)if(!(M in I&&(I[M]==H[M]||H[M]=="inherit"||I[M]=="inherit"))){H=s;break a}H=m}else H=F[R]==I;if(H){if(!K)return m}else if(K)return s}if(K)return m}else return m}if(R=o(this)[y.d()]){if(!(F=R.attributes))return m;for(H=0;H<F.length;H++){R=F[H][0];if(R=y.attr(R)){I=
F[H][1];if(I===i||typeof I=="string"&&R==I||I.test&&I.test(R))return m}}}return s},le:function(y){switch(this.type){case E.Bb:return this.ja(y.z||y.F,m);case E.Wa:case E.Aa:for(var K=y.elements,F=0,H;F<K.length;F++){H=K[F];if(!(this.type==E.Aa&&(z.g(H,y.z)||z.g(H,y.F))))if(!(this.type==E.Wa&&!(H.d()in O)))if(this.ja(H,m))return m}}return s}};u.fd=function(y){var K=y.Xd;if(K)return K;K=y.styles;var F=y.attributes&&y.attributes.style||"",H="";if(F.length)F=F.replace(P,";");for(var I in K){var M=K[I],
L=(I+":"+M).replace(P,";");if(M=="inherit")H+=L;else F+=L}if(F.length)F=G(F);F+=H;return y.Xd=F};r.rf=u;r.Style=u;var S=u.prototype;r.k.o(S,{apply:S.apply,remove:S.remove,applyToRange:S.Nb,removeFromRange:S.oc,applyToObject:S.de,checkElementRemovable:S.ja,checkActive:S.le})});
KISSY.Editor.add("htmlparser",function(){function r(){}function D(){this.c={jd:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var u=KISSY,J=u.Editor,A=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,B={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},v=J.m;u.augment(D,{wa:r,yd:r,ma:r,ud:r,La:r,parse:function(n){for(var f,
k,j=0,e;f=this.c.jd.exec(n);){k=f.index;if(k>j){j=n.substring(j,k);e?e.push(j):this.ma(j)}j=this.c.jd.lastIndex;if(k=f[1]){k=k.toLowerCase();if(e&&v.tc[k]){this.ud(e.join(""));e=U}if(!e){this.yd(k);continue}}if(e)e.push(f[0]);else if(k=f[3]){k=k.toLowerCase();if(!/="/.test(k)){var t={},G;f=f[4];var o=!!(f&&f.charAt(f.length-1)=="/");if(f)for(;G=A.exec(f);){var l=G[1].toLowerCase();G=G[2]||G[3]||G[4]||"";t[l]=!G&&B[l]?l:G}this.wa(k,t,o);if(!e&&v.tc[k])e=[]}}else if(k=f[2])this.La(k)}n.length>j&&this.ma(n.substring(j,
n.length))}});J.h=D;J.HtmlParser=D});
KISSY.Editor.add("htmlparser-basicwriter",function(){function r(){this.c={l:[]}}var D=KISSY,u=D.Editor,J=u.k;D.augment(r,{mb:function(A){this.c.l.push("<",A)},nb:function(A,B){B?this.c.l.push(" />"):this.c.l.push(">")},db:function(A,B){if(typeof B=="string")B=J.ec(B);this.c.l.push(" ",A,'="',B,'"')},eb:function(A){this.c.l.push("</",A,">")},text:function(A){this.c.l.push(A)},O:function(A){this.c.l.push("<!--",A,"--\>")},write:function(A){this.c.l.push(A)},reset:function(){this.c.l=[];this.c.B=V},
Zb:function(A){var B=this.c.l.join("");A&&this.reset();return B}});u.h.wb=r;u.h.BasicWriter=r;D=r.prototype;u.k.o(D,{openTag:D.mb,openTagClose:D.nb,attribute:D.db,closeTag:D.eb,text:D.text,comment:D.O,write:D.write,reset:D.reset,getHtml:D.Zb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function r(){r.Lf.constructor.call(this);this.kd="\t";this.Re=" />";this.Ke="\n";this.we=B;this.Se=A;this.c.B=B;this.c.G="";this.c.rules={};var v=u.m,n;for(n in J.mix({},v.vb,v.Qa,v.ub,v.xc))this.ya(n,{B:A,he:A,Rb:A,Sc:!v[n]["#"],ge:A});this.ya("br",{Rb:A});this.ya("title",{B:B,Rb:B});this.ya("style",{B:B,Sc:A});this.ya("pre",{B:B})}var D=KISSY,u=D.Editor,J=u.k,A=T,B=V;D.extend(r,u.h.wb,{mb:function(v){var n=this.c.rules[v];if(this.c.B)this.G();
else if(n&&n.he){this.Ja();this.G()}this.c.l.push("<",v)},nb:function(v,n){var f=this.c.rules[v];if(n)this.c.l.push(this.Re);else{this.c.l.push(">");if(f&&f.B)this.c.G+=this.kd}f&&f.Rb&&this.Ja()},db:function(v,n){if(typeof n=="string"){this.we&&(n=n.replace(/&amp;/g,"&"));n=J.ec(n)}this.c.l.push(" ",v,'="',n,'"')},eb:function(v){var n=this.c.rules[v];if(n&&n.B)this.c.G=this.c.G.substr(this.kd.length);if(this.c.B)this.G();else if(n&&n.Sc){this.Ja();this.G()}this.c.l.push("</",v,">");n&&n.ge&&this.Ja()},
text:function(v){if(this.c.B){this.G();v=J.Ka(v)}this.c.l.push(v)},O:function(v){this.c.B&&this.G();this.c.l.push("<!--",v,"--\>")},Ja:function(){this.c.l.length>0&&this.c.l.push(this.Ke);this.c.B=A},G:function(){this.c.l.push(this.c.G);this.c.B=B},ya:function(v,n){var f=this.c.rules[v];if(f)J.mix(f,n);else this.c.rules[v]=n}});u.h.ff=r;u.h.HtmlWriter=r;D=r.prototype;u.k.o(D,{openTag:D.mb,openTagClose:D.nb,attribute:D.db,closeTag:D.eb,text:D.text,comment:D.O,lineBreak:D.Ja,indentation:D.G,setRules:D.ya})});
KISSY.Editor.add("htmlparser-fragment",function(){function r(){this.children=[];this.parent=J;this.c={S:D,dc:u}}var D=T,u=V,J=U,A=KISSY.Editor,B={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},v=KISSY,n=A.k,f=A.n,k=A.m,j=n.mix({table:1,ul:1,ol:1,dl:1},k.table,k.ul,k.ol,k.dl),e=k.Id,t=k.ub;r.zb=function(G,o){function l(h){var p;if(s.length>0)for(var x=0;x<s.length;x++){var q=s[x],C=q.name,Q=k[C],N=g.name&&k[g.name];if((!N||N[C])&&(!h||!Q||Q[h]||!k[h])){if(!p){a();p=1}q=q.clone();
q.parent=g;g=q;s.splice(x,1);x--}}}function a(){for(;i.length;)g.add(i.shift())}function b(h,p,x){p=p||g||m;if(o&&!p.type){var q,C;if((q=h.attributes&&(C=h.attributes._ke_real_element_type)?C:h.name)&&!(q in k.sc)&&!(q in k.vb)){q=g;g=p;d.wa(o,{});p=g;if(x)g=q}}if(h.c.S&&h.name!="pre"){x=h.children.length;if((q=h.children[x-1])&&q.type==f.f)if(C=n.Ma(q.value))q.value=C;else h.children.length=x-1}p.add(h);if(h.pb){g=h.pb;delete h.pb}}var d=new A.h,m=new r,s=[],i=[],g=m,z=u,E;d.wa=function(h,p,x){var q=
new A.h.yc(h,p);if(q.hc&&x)q.jb=D;if(k.ba[h])s.push(q);else{if(h=="pre")z=D;else if(h=="br"&&z){g.add(new A.h.Cb("\n"));return}if(h=="br")i.push(q);else{var C=g.name,Q=C&&(k[C]||(g.c.S?k.div:k.span));if(Q&&!q.hc&&!g.hc&&!Q[h]){Q=u;var N;if(h in e&&C in e){C=g.children;(C=C[C.length-1])&&C.name in t||b(C=new A.h.yc("li"),g);E=g;N=C}else if(h==C)b(g,g.parent);else{if(j[C])E||(E=g);else{b(g,g.parent,D);B[C]||s.unshift(g)}Q=D}g=N?N:g.pb||g.parent;if(Q){d.wa.apply(this,arguments);return}}l(h);a();q.parent=
g;q.pb=E;E=0;if(q.jb)b(q);else g=q}}};d.yd=function(h){for(var p=s.length-1;p>=0;p--)if(h==s[p].name){s.splice(p,1);return}for(var x=[],q=[],C=g;C.type&&C.name!=h;){C.c.S||q.unshift(C);x.push(C);C=C.parent}if(C.type){for(p=0;p<x.length;p++){var Q=x[p];b(Q,Q.parent)}g=C;if(g.name=="pre")z=u;C.c.S&&a();b(C,C.parent);if(C==g)g=g.parent;s=s.concat(q)}if(h=="body")o=u};d.ma=function(h){if(!g.c.dc&&!z){h=n.Ka(h);if(h.length===0)return}a();l();if(o&&(!g.type||g.name=="body")&&n.trim(h))this.wa(o,{});z||
(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));g.add(new A.h.Cb(h))};d.ud=function(){};d.La=function(h){g.add(new A.h.Jd(h))};d.parse(G);for(a();g.type;){var w=g.parent,c=g;if(o&&(!w.type||w.name=="body")&&!k.sc[c.name]){g=w;d.wa(o,{});w=g}w.add(c);g=w}return m};v.augment(r,{add:function(G){var o=this.children.length;if(o=o>0&&this.children[o-1]||J){if(G.c.S&&o.type==f.f){o.value=n.Ma(o.value);if(o.value.length===0){this.children.pop();this.add(G);return}}o.next=G}G.ob=o;G.parent=this;this.children.push(G);
this.c.dc=G.type==f.f||G.type==f.e&&!G.c.S},aa:function(G,o){var l;this.filterChildren=this.Xb=function(){var a=new A.h.wb;this.V.call(this,a,o,D);a=a.Zb();this.children=(new r.zb(a)).children;l=1};!this.name&&o&&o.wd(this);this.V(G,l?J:o)},V:function(G,o){for(var l=0;l<this.children.length;l++)this.children[l].aa(G,o)}});A.h.za=r;A.h.Fragment=r;r.FromHtml=r.zb;v=r.prototype;A.k.o(v,{add:v.add,writeHtml:v.aa,writeChildrenHtml:v.V})});
KISSY.Editor.add("htmlparser-element",function(){function r(B,v){B=B[0];v=v[0];return B<v?-1:B>v?1:0}function D(B,v){this.name=B;this.attributes=v||(v={});this.children=[];var n=v.tf||B,f=u.m;n=!!(f.vb[n]||f.Qa[n]||f.ub[n]||f.xc[n]||f.wc[n]||n=="br");var k=!!f.tb[B];this.jb=k;this.hc=!f[B];this.c={S:n,dc:k||!n}}var u=KISSY.Editor,J=u.n;KISSY.augment(D,{type:J.e,add:u.h.za.prototype.add,clone:function(){return new D(this.name,this.attributes)},aa:function(B,v){var n=this.attributes,f=this,k=f.name,
j,e,t,G;f.Xb=function(){if(!G){var a=new u.h.wb;u.h.za.prototype.V.call(f,a,v);f.children=(new u.h.za.zb(a.Zb())).children;G=1}};f.filterChildren=f.Xb;if(v){for(;;){if(!(k=v.vd(k)))return;f.name=k;if(!(f=v.jc(f)))return;f.parent=this.parent;if(f.name==k)break;if(f.type!=J.e){f.aa(B,v);return}k=f.name;if(!k){this.V.call(f,B,G?U:v);return}}n=f.attributes}B.mb(k,n);for(var o=[],l=0;l<2;l++)for(j in n){e=j;t=n[j];if(l==1)o.push([j,t]);else if(v){for(;;)if(e=v.sd(j))if(e!=j){delete n[j];j=e}else break;
else{delete n[j];break}if(e)if((t=v.rd(f,e,t))===V)delete n[e];else n[e]=t}}B.Se&&o.sort(r);n=o.length;for(l=0;l<n;l++){j=o[l];B.db(j[0],j[1])}B.nb(k,f.jb);if(!f.jb){this.V.call(f,B,G?U:v);B.eb(k)}},V:function(){u.h.za.prototype.V.apply(this,arguments)}});u.h.yc=D;u.h.Element=D;var A=D.prototype;u.k.o(A,{type:A.type,add:A.add,clone:A.clone,writeHtml:A.aa,writeChildrenHtml:A.V})});
KISSY.Editor.add("htmlparser-filter",function(){function r(j){this.c={Ub:[],Ob:[],elements:{vc:0},attributes:{vc:0}};j&&this.Rc(j,10)}function D(j,e){for(var t=0;j&&t<e.length;t++){var G=e[t];j=j.replace(G[0],G[1])}return j}function u(j,e,t){if(typeof e=="function")e=[e];var G,o;o=j.length;var l=e&&e.length;if(l){for(G=0;G<o&&j[G].nc<t;G++);for(o=l-1;o>=0;o--)if(l=e[o]){l.nc=t;j.splice(G,0,l)}}}function J(j,e,t){if(e)for(var G in e){var o=j[G];j[G]=A(o,e[G],t);o||j.vc++}}function A(j,e,t){if(e){e.nc=
t;if(j){if(j.splice)u(j,e,t);else{j=j.nc>t?[e,j]:[j,e];j.filter=B}return j}else return e.filter=e}}function B(j){for(var e=j.type||j instanceof n.h.za,t=0;t<this.length;t++){if(e)var G=j.type,o=j.name;var l=this[t].apply(window,arguments);if(l===k)return l;if(e){if(l&&(l.name!=o||l.type!=G))return l}else if(typeof l!="string")return l;l!=undefined&&(j=l)}return j}var v=KISSY,n=v.Editor,f=n.n,k=V;v.augment(r,{Rc:function(j,e){if(typeof e!="number")e=10;u(this.c.Ub,j.Ub,e);u(this.c.Ob,j.Ob,e);J(this.c.elements,
j.elements,e);J(this.c.attributes,j.attributes,e);this.c.text=A(this.c.text,j.text,e)||this.c.text;this.c.O=A(this.c.O,j.O,e)||this.c.O;this.c.qb=A(this.c.qb,j.qb,e)||this.c.qb},vd:function(j){return D(j,this.c.Ub)},sd:function(j){return D(j,this.c.Ob)},ma:function(j){var e=this.c.text;return e?e.filter(j):j},La:function(j,e){var t=this.c.O;return t?t.filter(j,e):j},wd:function(j){var e=this.c.qb;return e?e.filter(j):j},jc:function(j){for(var e=[this.c.elements["^"],this.c.elements[j.name],this.c.elements.$e],
t,G=0;G<3;G++)if(t=e[G]){t=t.filter(j,this);if(t===k)return U;if(t&&t!=j)return this.xd(t);if(j.parent&&!j.name)break}return j},xd:function(j){var e=j.type;return e==f.e?this.jc(j):e==f.f?new n.h.Cb(this.ma(j.value)):U},rd:function(j,e,t){if(e=this.c.attributes[e]){j=e.filter(t,j,this);if(j===k)return k;if(typeof j!="undefined")return j}return t}});n.h.ef=r;v=r.prototype;n.k.o(v,{addRules:v.Rc,onElementName:v.vd,onAttributeName:v.sd,onText:v.ma,onComment:v.La,onFragment:v.wd,onElement:v.jc,onNode:v.xd,
onAttribute:v.rd});n.h.Filter=r});KISSY.Editor.add("htmlparser-text",function(){function r(A){this.value=A;this.c={S:J}}var D=KISSY,u=D.Editor,J=V;D.augment(r,{type:u.n.f,aa:function(A,B){var v=this.value;B&&!(v=B.ma(v,this))||A.text(v)}});u.h.Cb=r;u.h.Text=r});
KISSY.Editor.add("htmlparser-comment",function(){function r(J){this.value=J;this.c={S:V}}var D=KISSY.Editor,u=D.n;D.h.Jd=r;D.h.Comment=r;r.prototype={constructor:r,type:u.Ld,aa:function(J,A){var B=this.value;if(A){if(!(B=A.La(B,this)))return;if(typeof B!="string"){B.parent=this.parent;B.aa(J,A);return}}J.O(B)}}});
