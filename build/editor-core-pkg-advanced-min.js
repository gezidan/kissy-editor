/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-10 13:03:14
*/
var T=true,U=null,V=false;
KISSY.add("editor",function(q,C){function u(r,d){function a(w){for(var h=u.Env.mods,j=0;j<w.length;j++){for(var B=w[j],F=y,p=0;p<j;p++)if(B==w[p]){F=v;break}p=h[B];if(F&&p){F=q.clone(p);B=B+"_"+j;F.name=B;w[j]=B;h[B]||(h[B]=F)}}}var b=this;if(!(b instanceof u))return new u(r,d);if(q.isString(r))r=q.one(r);r=z.D(r);d=d||{};d.Pe=d.pluginConfig||{};b.ja=d;d.pluginConfig=d.Pe;b.cfg=d;q.app(b,q.EventTarget);var f=["htmldataprocessor","enterkey","clipboard"],m=y;b.use=function(w,h){w=w.split(",");a(w);
if(!m)for(var j=0;j<f.length;j++){var B=f[j];q.inArray(B,w)||w.unshift(B)}q.use.call(b,w.join(","),function(){b.ready(function(){h&&h.call(b);if(!m){b.setData(r.val());if(d.focus)b.focus();else{var F=b.getSelection();F&&F.removeAllRanges()}b.fire("save");m=v}})},{order:v,global:u});return b};b.use=b.use;b.Ge(r);return b}function K(r){var d=q.Config.debug;r=d?d==="dev"?"../src/"+r:r:r.replace(/\.(js|css)/i,"-min.$1");r+=r.indexOf("?")!=-1?"&":"?";r+="t="+encodeURIComponent("2010-11-10 13:03:14");return r}
var z=q.DOM,v=T,y=V;q.app(u,q.EventTarget);u.Config.base=q.Config.base+"editor/";var n=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",
requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],g,l,i,e,s={};g=0;for(l=n.length;g<l;g++){i=n[g];if(q.isString(i))i=n[g]={name:i+"",requires:U};e=i.requires||[];var D=["button"];i.name.indexOf("/dialog")!=-1&&D.push("overlay");i.requires=e.concat(D)}n=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},
{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(n);g=0;for(l=n.length;g<l;g++){i=n[g];e=i.name;s[e]={attach:y,charset:"utf-8",requires:i.requires,csspath:i.Sf?K("plugins/"+e+"/plugin.css"):C,path:K("plugins/"+e+"/plugin.js")}}u.add(s);q.Editor=u;q.Editor=u});
KISSY.Editor.add("utils",function(q){var C=U,u=KISSY,K=u.Node,z=u.DOM,v=u.UA,y=u.Event,n={Yc:function(g){var l=u.Config.debug;g=l?l==="dev"?"../src/"+g:g:g.replace(/\.(js|css)/i,"-min.$1");g+=g.indexOf("?")!=-1?"&":"?";g+="t="+encodeURIComponent("2010-11-15 17:16:08");return g},Le:function(g,l,i){var e=g[l],s=g[i];g[l]=function(){e.apply(this,arguments);g[l]=g[i];return s.apply(this,arguments)}},Ce:function(g,l,i,e){i=i.defaultView||i.parentWindow;g-=z.scrollLeft(i);l-=z.scrollTop(i);if(e)if(i!=(e.defaultView||
e.parentWindow)&&i.frameElement){e=z.Ib(i.frameElement,e);g+=e.left;l+=e.top}return{left:g,top:l}},Hd:function(){for(var g,l=0,i=arguments.length;l<i;l++){var e=arguments[l];try{g=e();break}catch(s){}}return g},he:function(g,l){if(!g&&!l)return T;if(!g||!l||g.length!=l.length)return V;for(var i=0;i<g.length;i++)if(g[i]!==l[i])return V;return T},bd:function(g,l,i){g=g.documentElement;for(var e=0;g&&e<l.length;e++){var s=l[e];if(i)for(var D=-1,r=0;r<g.childNodes.length;r++){var d=g.childNodes[r];if(!(i===
T&&d.nodeType==3&&d.previousSibling&&d.previousSibling.nodeType==3)){D++;if(D==s){g=d;break}}}else g=g.childNodes[s]}return g?new K(g):C},pe:function(g){for(var l in g)g[l].Fc(g,T)},gc:function(g){return g.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},La:function(g){return g.replace(/^\s+/,"")},Na:function(g){return g.replace(/\s+$/,"")},trim:function(g){return this.La(this.Na(g))},mix:function(){for(var g={},l=0;l<arguments.length;l++)g=u.mix(g,arguments[l]);return g},kb:function(){if(!v.ie)return V;
var g=document.domain,l=window.location.hostname;return g!=l&&g!="["+l+"]"},ue:function(g,l){return Array(l+1).join(g)},Xe:function(g,l,i){i=i||150;if(i===-1)return function(){g.apply(l,arguments)};var e=(new Date).getTime();return function(){var s=(new Date).getTime();if(s-e>i){e=s;g.apply(l,arguments)}}},le:function(g,l,i){i=i||0;var e=C;return function(){e&&clearTimeout(e);var s=arguments;e=setTimeout(function(){return g.apply(l,s)},i)}},isNumber:function(g){return/^\d+(.\d+)?$/.test(u.trim(g))},
Ze:function(g){for(var l=0;l<g.length;l++){var i=z.D(g[l]),e=u.trim(i.val()),s=i.attr("data-verify");i=i.attr("data-warning");if(s&&!RegExp(s).test(e)){alert(i);return V}}return T},Ve:function(g,l){g.on("sourcemode",l.Bf,l);g.on("wysiwygmode",l.Hf,l)},Re:function(g){var l=g.attr("placeholder");if(l&&!v.webkit){g.val(l);g.addClass("ke-input-tip")}else v.webkit&&g.val("")},Tf:function(g,l){g.val(l);g.removeClass("ke-input-tip")},Oe:function(g,l){g.attr("placeholder",l);if(!v.webkit){g.on("blur",function(){if(!u.trim(g.val())){g.val(l);
g.addClass("ke-input-tip")}});g.on("focus",function(){u.trim(g.val())==l&&g.val("");g.removeClass("ke-input-tip")})}},oe:function(g){g=g[0]||g;for(var l=u.makeArray(g.childNodes),i=0;i<l.length;i++){var e=l[i];e.nodeType==q.n.f&&!u.trim(e.nodeValue)&&g.removeChild(e)}},Fe:function(g){return!g?g:String(g).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},Ee:function(g){return!g?g:String(g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,
"&")},we:function(g,l){return g.toLowerCase()==l.toLowerCase()},qd:function(g){g=u.clone(g);for(var l in g)if(g.hasOwnProperty(l)){var i=g[l];if(u.isFunction(i))g[l]=i()}return g},te:function(g,l,i){function e(){var f={responseText:"",responseXML:C};f.ge=g?g.ge:C;try{var m;if((m=v.ie?D.contentWindow.document:D.contentDocument||window.frames[s].document)&&m.body)f.responseText=m.body.innerHTML;f.responseXML=m&&m.XMLDocument?m.XMLDocument:m}catch(w){u.log(w)}y.remove(D,"load",e);g.me&&g.me(f);setTimeout(function(){z.h(D)},
100)}var s=u.guid("form-upload-"),D=document.createElement("iframe");D.id=s;D.name=s;D.className="ke-hidden";var r="document.open();"+(n.kb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(v.ie)D.src=v.ie?"javascript:void(function(){"+encodeURIComponent(r)+"}())":"";u.log("doFormUpload : "+D.src);document.body.appendChild(D);if(v.ie)document.frames[s].name=s;r=z.Oc(g.form);var d={target:r.target,method:r.method,encoding:r.encoding,enctype:r.enctype,action:r.action};r.target=s;
r.method="POST";r.enctype=r.encoding="multipart/form-data";if(i)r.action=i;var a;if(l){a=[];l=q.k.qd(l);for(var b in l)if(l.hasOwnProperty(b)){i=document.createElement("input");i.type="hidden";i.name=b;i.value=l[b];r.appendChild(i);a.push(i)}}y.on(D,"load",e);r.submit();r.target=d.target;r.method=d.method;r.enctype=d.enctype;r.encoding=d.encoding;r.action=d.action;if(a){l=0;for(b=a.length;l<b;l++)z.h(a[l])}return D},o:function(g,l){for(var i in l)g[i]=l[i]},map:function(g,l){for(var i=0;i<g.length;i++)g[i]=
l(g[i]);return g}};q.k=n;q.Utils=n;n.o(n,{debugUrl:n.Yc,lazyRun:n.Le,getXY:n.Ce,tryThese:n.Hd,arrayCompare:n.he,getByAddress:n.bd,clearAllMarkers:n.pe,htmlEncodeAttr:n.gc,ltrim:n.La,rtrim:n.Na,trim:n.trim,mix:n.mix,isCustomDomain:n.kb,duplicateStr:n.ue,buffer:n.le,isNumber:n.isNumber,verifyInputs:n.Ze,sourceDisable:n.Ve,resetInput:n.Re,placeholder:n.Oe,clean:n.oe,htmlEncode:n.Fe,htmlDecode:n.Ee,equalsIgnoreCase:n.we,normParams:n.qd,throttle:n.Xe,doFormUpload:n.te,map:n.map})});
KISSY.Editor.add("focusmanager",function(q){function C(){this.hc=g;n=this}function u(){this.hc=l;n=i}var K=KISSY,z=K.DOM,v=K.Event,y={},n;K={Lf:function(){for(var e in y){var s=y[e];s.document.designMode="off";s.document.designMode="on"}},Af:function(){return n},ze:function(e){return y[e]},add:function(e){var s=z.ga(e.document);v.on(s,"focus",C,e);v.on(s,"blur",u,e)},Qe:function(e){y[e.Nb]=e},remove:function(e){delete y[e.Nb];var s=z.ga(e.document);v.remove(s,"focus",C,e);v.remove(s,"blur",u,e)}};
var g=T,l=V,i=U;q.xe=K;q.focusManager=K;q.fd=function(){return y};q.getInstances=q.fd});
KISSY.Editor.add("definition",function(q){var C=T,u=V,K=document,z=KISSY,v=z.UA,y=z.DOM,n=z.Node,g=z.Event,l=q.xe,i=q.k.Hd,e=q.k.Yc("theme/editor-iframe.css"),s=1,D="document.open();"+(q.k.kb()?'document.domain="'+K.domain+'";':"")+"document.close();",r="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(v.ie?
"javascript:void(function(){"+encodeURIComponent(D)+"}())":"")+'"  tabIndex="'+(v.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";q.Cc=0;q.Ya=1;q.SOURCE_MODE=q.Cc;q.WYSIWYG_MODE=q.Ya;z.augment(q,{Ge:function(d){if(v.ie)y.addClass(K.body,"ie"+v.ie);else if(v.gecko)y.addClass(K.body,"gecko");else v.webkit&&y.addClass(K.body,"webkit");var a=this,b=new n(r.replace(/\$\(tabIndex\)/,d.attr("tabIndex")));b.on("mousedown",
function(w){if(v.webkit){var h=y.d(w.target);if(h=="select"||h=="option")return C}w.halt()});d.on("mousedown",function(w){w.stopPropagation()});a.Ff=b;a.Nb=s++;l.Qe(a);a.ub=b.one(".ke-textarea-wrap");a.wrap=a.ub;a.jb=a.ub.one("iframe");a.iframe=a.jb;a.Gd=b.one(".ke-editor-tools");a.toolBarDiv=a.Gd;a.$=d;a.textarea=a.$;a.We=b.one(".ke-editor-status");a.statusDiv=a.We;a.Gd.Nc();a.Ob={};a.Pc={};var f=d.M("width"),m=d.M("height");if(f){b.css("width",f);d.css("width","100%")}a.$.css("display","none");
b.insertAfter(d);a.ub[0].appendChild(d[0]);if(m){a.ub.css("height",m);d.css("height","100%")}b=a.jb;a.on("dataReady",function(){a.ae=C;q.fire("instanceCreated",{ve:a})});v.gecko?b.on("load",a.Rc,a):a.Rc();a.ja.zf&&d[0].form&&a.Zd()},Zd:function(){(new n(this.$[0].form)).on("submit",this.Fd,this)},Ye:function(d,a){var b=this,f=q.sf;f.If();b.use(d,function(){var m=b.cd(d);a(m);f.Rf()})},de:function(d,a){this.Pc[d]=a},cd:function(d){return this.Pc[d]},ee:function(d){this.ready(d)},be:function(d,a){this.Ob[d]=
a},De:function(d){return this.Ob[d]},execCommand:function(d){var a=this.Ob[d],b=z.makeArray(arguments);b.shift();b.unshift(this);return a.exec.apply(a,b)},bc:function(){return this.$.css("display")=="none"?q.Ya:q.Cc},getData:function(d){var a;a=this.bc()==q.Ya?this.document.body.innerHTML:this.$.val();if(this.htmlDataProcessor)a=d?this.htmlDataProcessor.toHtml(a,"p"):this.htmlDataProcessor.toServer(a,"p");a=z.trim(a);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(a))a="";return a},setData:function(d){var a=d;
if(this.htmlDataProcessor)a=this.htmlDataProcessor.toDataFormat(d,"p");this.document.body.innerHTML=a;this.bc()!=q.Ya&&this.$.val(d)},Fd:function(){this.$.val(this.getData())},Ha:function(d){d=d||0;return d+(this.ja.Ha||0)},uf:function(){return this.document.body.innerHTML},wf:function(d){this.document.body.innerHTML=d},$d:function(d){var a=this.ja,b=a.wa,f="";if(b)for(var m=0;m<b.length;m++)f+='<link href="'+b[m]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+
q.Config.base+e+"' rel='stylesheet'/><style>"+(a.Vb||"")+"</style>"+f+"</head><body class='ke-editor'>&nbsp;"+(d?'<script id="ke_actscript" type="text/javascript">'+(q.k.kb()?'document.domain="'+K.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+d+'");<\/script>':"")+"</body></html>"},getSelection:function(){return q.Dc.getSelection(this.document)},focus:function(){var d=this.document,a=y.ga(d);v.webkit&&a&&a.parent&&a.parent.focus();a&&a.focus();d&&d.body.focus();this.nb()},blur:function(){y.ga(this.document).blur();
this.document&&this.document.body.blur()},ce:function(d){var a=this.ja,b=this.document;a.Vb=a.Vb||"";a.Vb+="\n"+d;a=b.createElement("style");b.getElementsByTagName("head")[0].appendChild(a);if(a.styleSheet)a.styleSheet.cssText=d;else a.appendChild(b.createTextNode(d))},yf:function(d){var a=this.ja,b=this.document;a.wa=a.wa||[];a.wa.push(d);a=b.createElement("link");a.rel="stylesheet";b.getElementsByTagName("head")[0].appendChild(a);a.href=d},Mf:function(d){for(var a=this.ja,b=z.makeArray(this.document.getElementsByTagName("link")),
f=0;f<b.length;f++)b[f].href==d&&y.h(b[f]);a.wa=a.wa||[];a=a.wa;d=z.indexOf(d,a);d!=-1&&a.splice(d,1)},Rc:function(){function d(){w=m.document;a.document=w;b.detach();w.open("text/html","replace");w.write(f);w.close()}var a=this,b=a.jb,f=a.$d(a.Nb),m=b[0].contentWindow,w;try{w=m.document}catch(h){b[0].src=b[0].src;if(v.ie<7){setTimeout(d,10);return}}d()},ready:function(d){this.ae?d():this.on("dataReady",d)},db:function(){var d=this;d.Qc&&clearTimeout(d.Qc);d.Qc=setTimeout(function(){var a=d.getSelection();
if(a&&!a.nd){var b=a.dc(),f=new q.Ta(b);if(!d.nc||!d.nc.Wc(f)){d.nc=f;d.fire("selectionChange",{selection:a,path:f,element:b})}}},100)},nb:function(){this.nc=U;this.db()},md:function(d,a){var b=this;b.focus();var f=d.d(),m=q.m,w=q.pa,h=q.n,j=m.Ra[f],B=b.getSelection(),F=B&&B.A(),p,c,k,o,x;if(!F||F.length==0){var t=arguments,E=t.callee;setTimeout(function(){E.apply(b,t)},30)}else{b.fire("save");for(var O=F.length-1;O>=0;O--){p=F[O];p.deleteContents();c=!O&&d||d.K(C);a&&a(c);if(j)for(;(o=p.xa(u,C))&&
(x=m[o.d()])&&!(x&&x[f]);)if(o.d()in m.span)p.sc(o);else if(p.va()&&p.la()){p.setStartBefore(o);p.collapse(C);o.h()}else p.rc();p.insertNode(c);k||(k=c)}if(k){f=k.w(C);m=b.document;x=q.m;if(x.vc[c.d()]){f=new n(m.createTextNode(" "));f.insertAfter(k)}else if(f){if(f.d()=="br"&&x[f.parent().d()].p){x=new n("<p>&nbsp;</p>",U,m);f[0].parentNode.replaceChild(x[0],f[0]);f=x}}else{x=new n("<p>&nbsp;</p>",U,m);x.insertAfter(k);f=x}p.H(k,w.t);f&&f[0].nodeType==h.e&&p.mb(f);B.tb([p]);b.focus();c&&c.Mb();setTimeout(function(){b.fire("save")},
10);return c}}},He:function(d){var a=this;if(a.htmlDataProcessor)d=a.htmlDataProcessor.toDataFormat(d);if(v.webkit){var b=y.create(d,U,this.document);b=b.nodeType==11?z.makeArray(b.childNodes):[b];for(var f=0;f<b.length;f++)a.md(new n(b[f]))}else{a.focus();f=(b=a.getSelection())&&b.A();if(!f||f.length==0){var m=arguments,w=m.callee;setTimeout(function(){w.apply(a,m)},30)}else{a.fire("save");if(v.ie){b=b.r();b.type=="Control"&&b.clear();b.createRange().pasteHTML(d)}else a.document.execCommand("inserthtml",
u,d);a.focus();setTimeout(function(){a.fire("save")},10)}}}});q._initIFrame=function(d){function a(p){i(function(){m.designMode="on";setTimeout(function(){m.designMode="off";h.focus();if(!arguments.callee.Se)arguments.callee.Se=C},50)},function(){m.designMode="off";y.attr(h,"contentEditable",u);y.attr(h,"contentEditable",C);!p&&a(1)})}var b=l.ze(d);d=b.$[0];var f=b.jb[0].contentWindow,m=b.document,w=b.ja;y.h(m.getElementById("ke_actscript"));var h=m.body;if(v.ie){h.hideFocus=C;h.disabled=C;h.contentEditable=
C;h.removeAttribute("disabled")}else setTimeout(function(){if(v.gecko||v.opera)h.contentEditable=C;else if(v.webkit)h.parentNode.contentEditable=C;else m.designMode="on"},0);if(v.webkit){g.on(m,"click",function(p){var c=new n(p.target);z.inArray(c.d(),["input","select"])&&p.preventDefault()});g.on(m,"mouseup",function(p){var c=new n(p.target);z.inArray(c.d(),["input","textarea"])&&p.preventDefault()})}if(v.gecko||v.ie||v.opera){var j;j=new n(y.insertAfter((new n('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
d));j.on("focus",function(){b.focus()});b.xf=function(){v.gecko&&b.hc&&j[0].focus()};b.on("destroy",function(){})}if(v.ie&&m.compatMode=="CSS1Compat"||v.gecko||v.opera){var B=new n(m.documentElement);B.on("mousedown",function(p){if(p.target==B[0]){v.gecko&&a(u);j[0].focus()}})}g.on(f,"focus",function(){if(v.gecko)a(u);else v.opera&&h.focus();b.nb()});v.gecko&&g.on(b.document,"mousedown",function(){b.hc||a(u)});if(v.ie){g.on(m,"keydown",function(p){if(p.keyCode in{8:1,46:1}){var c=b.getSelection(),
k=c.cc();if(k){b.fire("save");var o=c.A()[0].P();k.h();c.Bd([o]);b.fire("save");p.preventDefault()}}});if(m.compatMode=="CSS1Compat"){var F={33:1,34:1};g.on(m,"keydown",function(p){p.keyCode in F&&setTimeout(function(){b.getSelection().scrollIntoView()},0)})}}setTimeout(function(){v.ie&&setTimeout(function(){if(m){h.runtimeStyle.marginBottom="0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){b.fire("dataReady");var p=w.Df,c=w.Cf;if(p||c)try{m.execCommand("enableObjectResizing",
u,!p);m.execCommand("enableInlineTableEditing",u,!c)}catch(k){g.on(h,v.ie?"resizestart":"resize",function(o){if(p||y.d(o.target)==="table"&&c)o.preventDefault()})}},10);v.webkit&&g.on(m,"mousedown",function(p){p=new n(p.target);z.inArray(p.d(),["img","hr","input","textarea","select"])&&b.getSelection().qc(p)});v.gecko&&g.on(m,"dragstart",function(p){var c=new n(p.target);c.d()==="img"&&/ke_/.test(c[0].className)&&p.preventDefault()});l.add(b)};D=q.prototype;q.k.o(D,{setData:D.setData,getData:D.getData,
insertElement:D.md,insertHtml:D.He,ready:D.ready,addCustomStyle:D.ce,addCommand:D.be,hasCommand:D.De,execCommand:D.execCommand,addPlugin:D.ee,useDialog:D.Ye,addDialog:D.de,getDialog:D.cd,getMode:D.bc,sync:D.Fd,baseZIndex:D.Ha,getSelection:D.getSelection,focus:D.focus,blur:D.blur,notifySelectionChange:D.nb})});
KISSY.Editor.add("zindex",function(){var q=KISSY.Editor;if(!q.Id){q.Id={ef:1100,of:1200,ff:99999,lf:900,nf:9999,LOADING:11E3,kf:12E3,pf:1200};q.Ha=function(C){var u=C,K=q.fd(),z;for(z in K){if(!K.hasOwnProperty(z))return;u=Math.max(u,K[z].Ha(C))}return u};q.baseZIndex=q.Ha;q.zIndexManager=q.Id}});
KISSY.Editor.add("dtd",function(q){q.m=function(){function C(h){for(var j=arguments.length-1;j>0;)KISSY.mix(h,arguments[j--]);return h}var u={isindex:1,fieldset:1},K={input:1,button:1,select:1,textarea:1,label:1},z=C({a:1},K),v=C({iframe:1},z),y={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},n={ins:1,del:1,script:1,style:1},g=C({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},n),l=C({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},g),i=C({p:1},l);K=C({iframe:1},l,K);l={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=C({a:1},K),s={tr:1},D={"#":1},r=C({param:1},l),d=C({form:1},u,v,y,i),a={li:1},b={base:1,link:1,meta:1,title:1},f=C(b,{style:1,script:1}),m={head:1,body:1},w={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{xb:C({html:1},m,b),Ra:w,cf:{body:1,div:1,td:1,th:1,caption:1,
form:1},vc:e,tc:C({script:1,style:1},w),uc:{script:1,style:1},vb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},wb:{dd:1,dt:1,li:1},Jd:{ul:1,ol:1,dl:1},xc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},ba:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},df:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},yc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:m,head:f,style:D,body:d,base:{},link:{},meta:{},title:D,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:d,td:d,br:{},th:d,center:d,kbd:e,button:C(i,y),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:a,h1:e,h3:e,option:D,h2:e,form:C(u,v,y,i),select:{optgroup:1,option:1},font:e,ins:e,menu:a,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:D,tfoot:s,cite:e,li:d,input:{},iframe:d,
strong:e,textarea:D,noframes:d,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:d,object:r,sup:e,dd:d,strike:e,area:{},dir:a,map:C({area:1,form:1,p:1},u,n,y),applet:r,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:C({legend:1},l),thead:s,ul:a,acronym:e,b:e,a:K,blockquote:d,caption:e,i:e,u:e,tbody:s,s:e,address:C(v,i),tt:e,legend:e,q:e,pre:C(g,z),p:e,em:e,dfn:e}}();q.XHTML_DTD=q.m});
KISSY.Editor.add("dom",function(q){function C(a){if(a&&!a[0])return new n(a);return a}function u(a){return a[0]||a}function K(a){return a.replace(/-(\w)/g,function(b,f){return f.toUpperCase()})}var z=KISSY,v=z.DOM,y=z.UA,n=z.Node,g=q.k,l={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};q.n={e:1,f:3,Md:8,mf:11};q.NODE=q.n;q.Ua={da:0,Nd:1,ca:2,Y:4,X:8,Ac:16};q.POSITION=
q.Ua;var i=q.n,e=q.Ua,s={},D={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},r={hr:1},d={D:C,Oc:u,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return V;a=u(a);b=u(b);return a===b},ra:function(a,b){a=C(a);var f=z.mix(z.mix({},r),b||{});return D[a.css("display")]||f[a.d()]},ga:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
V},v:function(a){a=u(a);for(var b=a.parentNode.childNodes,f=0;f<b.length;f++)if(b[f]===a)return f;return-1},Rd:function(a,b){a=u(a);var f=a.firstChild;if((f=f&&new n(f))&&b&&!b(f))f=f.$a(b);return f},Lc:function(a,b,f){a=u(a);v.h(a);b=u(b);f?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(y.ie)if((a=a.Nf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Jc:function(a,b){if(a.d()!=b.d())return V;var f=a[0].attributes,m=b[0].attributes,w=f.length,
h=m.length;if(!y.ie&&w!=h)return V;for(var j=0;j<w;j++){var B=f[j];if((!y.ie||B.specified&&B.nodeName!="_ke_expando")&&B.nodeValue!=b.attr(B.nodeName))return V}if(y.ie)for(j=0;j<h;j++){B=m[j];if(B.specified&&B.nodeName!="_ke_expando"&&B.nodeValue!=a.attr(B.nodeName))return V}return T},Jb:function(a){a=u(a).childNodes;for(var b=0,f=a.length;b<f;b++){var m=a[b],w=m.nodeType;if(!(w==i.e&&m.getAttribute("_ke_bookmark")))if(w==i.e&&!d.Jb(m)||w==i.f&&z.trim(m.nodeValue))return V}return T},Kb:function(a,
b,f){a=u(a);b=b[0]||b;if(a!=b)if(f)for(;f=a.lastChild;)b.insertBefore(a.removeChild(f),b.firstChild);else for(;f=a.firstChild;)b.appendChild(a.removeChild(f))},sa:function(){function a(b,f,m){if(f[0]&&f[0].nodeType==i.e){for(var w=[];f.attr("_ke_bookmark")||f.Jb();){w.push(f);f=m?new n(f[0].nextSibling):new n(f[0].previousSibling);if(!f[0]||f[0].nodeType!=i.e)return}if(b.Jc(f)){for(var h=m?b[0].lastChild:b[0].firstChild;w.length;)w.shift().Lc(b,!m);f.Kb(b,!m);f.h();h[0]&&h[0].nodeType==i.e&&h.sa()}}}
return function(b){if(b[0])if(l[b.d()]||b.d()=="a"){a(b,new n(b[0].nextSibling),T);a(b,new n(b[0].previousSibling))}}}(),Nc:y.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:y.webkit?function(a){a=u(a);a.style.jf="none"}:function(a){a=u(a);if(y.ie||y.opera){var b,f=0;for(a.unselectable="on";b=a.all[f++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},Ib:function(a,b){a=u(a);var f,m=0;f=0;var w=a.ownerDocument.defaultView||
a.ownerDocument.parentWindow,h=a.ownerDocument,j=h.documentElement;b=b||h;if(a.getBoundingClientRect){if(a!==h.body&&j!==a){f=a.getBoundingClientRect();m=f.left+(b===h?v.scrollLeft(w):0);f=f.top+(b===h?v.scrollTop(w):0)}if(b)if(w!=(b.defaultView||b.parentWindow)&&w.frameElement){w=d.Ib(w.frameElement,b);m+=w.left;f+=w.top}}return{left:m,top:f}},Td:function(a){return(a=u(a))&&a.contentWindow.document},ia:function(a,b){a=u(a);var f=a.ownerDocument;if(!(!a||a.nodeType!=i.f)){if(y.ie&&b==a.nodeValue.length){var m=
f.createTextNode("");v.insertAfter(m,a);return new n(m)}m=new n(a.splitText(b));if(f.documentMode){f=f.createTextNode("");v.insertAfter(f,m[0]);v.h(f)}return m}},Lb:function(a,b){a=C(a);var f=[];do f[b?"push":"unshift"](a);while(a=a.parent());return f},K:function(a,b,f){a=u(a);a=a.cloneNode(b);if(!f){var m=function(w){if(w.nodeType==i.e){w.removeAttribute("id",V);w.removeAttribute("_ke_expando",V);w=w.childNodes;for(var h=0;h<w.length;h++)m(w[h])}};m(a)}return new n(a)},w:function(a,b,f,m){a=u(a);
if(m&&!m.call){var w=m[0]||m;m=function(j){j=j[0]||j;return j!==w}}b=!b&&a.firstChild;var h=new n(a);if(!b){if(a.nodeType==i.e&&m&&m(a,T)===V)return U;b=a.nextSibling}for(;!b&&(h=h.parent());){if(m&&m(h,T)===V)return U;b=h[0].nextSibling}if(!b)return U;b=v.D(b);if(m&&m(b)===V)return U;if(f&&f!=b[0].nodeType)return b.w(V,f,m);return b},ha:function(a,b,f,m){a=u(a);if(m&&!m.call){var w=m[0]||m;m=function(j){j=j[0]||j;return j!==w}}b=!b&&a.lastChild;var h=new n(a);if(!b){if(a.nodeType==i.e&&m&&m(a,T)===
V)return U;b=a.previousSibling}for(;!b&&(h=h.parent());){if(m&&m(h,T)===V)return U;b=h[0].previousSibling}if(!b)return U;b=v.D(b);if(m&&m(b)===V)return U;if(f&&b[0].nodeType!=f)return b.ha(V,f,m);return b},L:y.ie||y.webkit?function(a,b){a=u(a);b=u(b);return b.nodeType!=i.e?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=u(a);b=u(b);return!!(a.compareDocumentPosition(b)&16)},Hb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=i.f&&b.L(a))return b;var f=a[0].nodeType==i.f?a.parent():
a;do if(f[0].nodeType!=i.f&&f.L(b))return f;while(f=f.parent());return U},Pd:function(a,b,f){a=u(a);if(!f)a=a.parentNode;if(b&&!z.isFunction(b)){var m=b;b=function(w){return w.d()==m}}for(;a&&a.nodeType!=9;){if(!b||b(new n(a))===T)return new n(a);a=a.parentNode}return U},Hc:function(a,b){a=u(a);var f=a.attributes.getNamedItem(b);return!!(f&&f.specified)},Za:y.ie?function(a){a=u(a);for(var b=a.attributes,f=0;f<b.length;f++){var m=b[f];switch(m.nodeName){case "class":if(a.getAttribute("class"))return T;
break;case "_ke_expando":continue;default:if(m.specified)return T}}return V}:function(a){a=u(a);y.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},Fa:function(a,b){var f=u(a),m=u(b);if(f.compareDocumentPosition)return f.compareDocumentPosition(m);if(f==m)return e.da;if(f.nodeType==i.e&&m.nodeType==i.e){if(f.contains){if(f.contains(m))return e.Ac+e.Y;if(m.contains(f))return e.X+e.ca}if("sourceIndex"in f)return f.sourceIndex<0||m.sourceIndex<
0?e.Nd:f.sourceIndex<m.sourceIndex?e.Y:e.ca}f=a.Ea();m=b.Ea();for(var w=Math.min(f.length,m.length),h=0;h<=w-1;h++)if(f[h]!=m[h]){if(h<w)return f[h]<m[h]?e.Y:e.ca;break}return f.length<m.length?e.Ac+e.Y:e.X+e.ca},Ea:function(a,b){a=u(a);for(var f=[],m=a.ownerDocument.documentElement,w=a;w&&w!=m;){var h=w.parentNode,j=-1;if(h){for(var B=0;B<h.childNodes.length;B++){var F=h.childNodes[B];if(!(b&&F.nodeType==3&&F.previousSibling&&F.previousSibling.nodeType==3)){j++;if(F==w)break}}f.unshift(j)}w=h}return f},
Gb:function(a,b){var f=new q.Range(a[0].ownerDocument);f.setStartAfter(a);f.setEndAfter(b);var m=f.extractContents();f.insertNode(a.h());a[0].parentNode.insertBefore(m,a[0].nextSibling)},M:function(a,b,f){a=C(a);if(f!==undefined)return a.css(b,f);a=u(a);return a.style[K(b)]},h:function(a,b){var f=u(a),m=f.parentNode;if(m){if(b)for(var w;w=f.firstChild;)m.insertBefore(f.removeChild(w),f);m.removeChild(f)}return a},cb:function(a){v.Kc(a);v.Mc(a)},Kc:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==
i.f){var f=g.La(b.nodeValue),m=b.nodeValue.length;if(f){if(f.length<m){(new n(b)).ia(m-f.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Mc:function(a){a=u(a);for(var b;b=a.lastChild;){if(b.type==i.f){var f=g.Na(b.nodeValue),m=b.nodeValue.length;if(f){if(f.length<m){(new n(b)).ia(f.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!y.ie&&!y.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Fb:function(a){a=
u(a);for(var b=a.lastChild;b&&b.nodeType==i.f&&!z.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==i.f||v.d(b)!=="br"){b=y.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");y.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},ta:function(a,b){var f=u(a),m;do m=(f=f.previousSibling)&&new n(f);while(m&&b&&!b(m));return m},Vd:function(a,b){a=v.D(a);var f=a[0].lastChild;if((f=f&&new n(f))&&b&&!b(f))f=f.ta(b);return f},$a:function(a,b){var f=u(a),m;do m=(f=f.nextSibling)&&
new n(f);while(m&&b&&!b(m));return m},ab:function(a){a=u(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},Wd:function(a,b,f,m){a=v.D(a);var w=a.fa("list_marker_id")||a.bb("list_marker_id",z.guid()).fa("list_marker_id"),h=a.fa("list_marker_names")||a.bb("list_marker_names",{}).fa("list_marker_names");b[w]=a;h[f]=1;return a.bb(f,m)},Fc:function(a,b,f){a=C(a);var m=a.fa("list_marker_names"),w=a.fa("list_marker_id"),
h;for(h in m)a.Ga(h);a.Ga("list_marker_names");if(f){a.Ga("list_marker_id");delete b[w]}},bb:function(a,b,f){var m=v.Gc(a);(s[m]||(s[m]={}))[b]=f;return a},fa:function(a,b){a=u(a);var f=a.getAttribute("_ke_expando");return(f=f&&s[f])&&f[b]},Ga:function(a,b){a=u(a);var f=a.getAttribute("_ke_expando");var m=(f=f&&s[f])&&f[b];typeof m!="undefined"&&f&&delete f[b];z.isEmptyObject(f)&&v.Ec(a);return m||U},Ec:function(a){a=u(a);var b=a.getAttribute("_ke_expando");b&&delete s[b];b&&a.removeAttribute("_ke_expando")},
Gc:function(a){a=u(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=z.guid();a.setAttribute("_ke_expando",b);return b},Qd:function(a,b,f){a=u(a);b=C(b);var m=a.attributes;f=f||{};for(var w=0;w<m.length;w++){var h=m[w],j=h.nodeName.toLowerCase(),B;if(!(j in f))if(j=="checked"&&(B=v.attr(a,j)))b.attr(j,B);else if(h.specified||y.ie&&h.nodeValue&&j=="value"){B=v.attr(a,j);if(B===U)B=h.nodeValue;b.attr(j,B)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Ic:function(a){a=v.d(a);var b=
q.m;return(a=!b.xc[a]&&(b[a]||b.span))&&a["#"]},Mb:function(a){a=C(a);var b=a[0].ownerDocument,f=v.scrollLeft(b),m=v.scrollTop(b),w=a.offset(),h=w.left;w=w.top;if(v.viewportHeight(b)+m<w||w<m||v.viewportWidth(b)+f<h||h<f)a.scrollIntoView(b)},Sd:function(a,b,f){a=u(a);if(!y.ie&&f)b=f+":"+b;f=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)f.push(new n(a[b]));return f}};z.DOM.Ud=function(a){z.mix(v,a);for(var b in a)a.hasOwnProperty(b)&&function(f){n.prototype[f]=function(){var m=[].slice.call(arguments,
0);m.unshift(this);return a[f].apply(U,m)}}(b)};g.o(d,{_4e_wrap:d.D,_4e_unwrap:d.Oc,_4e_equals:d.g,_4e_isBlockBoundary:d.ra,_4e_getWin:d.ga,_4e_index:d.v,_4e_first:d.Rd,_4e_move:d.Lc,_4e_name:d.d,_4e_isIdentical:d.Jc,_4e_isEmptyInlineRemoveable:d.Jb,_4e_moveChildren:d.Kb,_4e_mergeSiblings:d.sa,_4e_unselectable:d.Nc,_4e_getOffset:d.Ib,_4e_getFrameDocument:d.Td,_4e_splitText:d.ia,_4e_parents:d.Lb,_4e_clone:d.K,_4e_nextSourceNode:d.w,_4e_previousSourceNode:d.ha,_4e_contains:d.L,_4e_commonAncestor:d.Hb,
_4e_ascendant:d.Pd,_4e_hasAttribute:d.Hc,_4e_hasAttributes:d.Za,_4e_position:d.Fa,_4e_address:d.Ea,_4e_breakParent:d.Gb,_4e_style:d.M,_4e_remove:d.h,_4e_trim:d.cb,_4e_ltrim:d.Kc,_4e_rtrim:d.Mc,_4e_appendBogus:d.Fb,_4e_last:d.Vd,_4e_previous:d.ta,_4e_next:d.$a,_4e_outerHtml:d.ab,_4e_setMarker:d.Wd,_4e_clearMarkers:d.Fc,_4e_setData:d.bb,_4e_getData:d.fa,_4e_removeData:d.Ga,_4e_clearData:d.Ec,_4e_removeData:d.Ga,_4e_getUniqueId:d.Gc,_4e_copyAttributes:d.Qd,_4e_isEditable:d.Ic,_4e_scrollIntoView:d.Mb,
_4e_getElementsByTagName:d.Sd});v.Ud(d)});
KISSY.Editor.add("elementpath",function(q){function C(l){var i=v,e=v,s=[];for(l=l;l&&l[0];){if(l[0].nodeType==z.e){if(!this.Ke)this.Ke=l;var D=l.d();if(!e){if(!i&&y[D])i=l;if(n[D]){var r;if(r=!i){if(r=D=="div"){a:{r=l;r=r[0]||r;r=r.childNodes;for(var d=0,a=r.length;d<a;d++){var b=r[d];if(b.nodeType==z.e&&K.Ra[b.nodeName.toLowerCase()]){r=T;break a}}r=V}r=!r}r=r}if(r)i=l;else e=l}}s.push(l);if(D=="body")break}l=l.parent()}this.block=this.z=i;this.blockLimit=this.F=e;this.elements=this.elements=s}var u=
KISSY.DOM,K=q.m,z=q.n,v=U,y={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},n={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};C.prototype={Wc:function(l){var i=this.elements;l=l&&l.elements;if(!l||i.length!=l.length)return V;for(var e=0;e<i.length;e++)if(!u.g(i[e],l[e]))return V;return T},contains:function(l){for(var i=this.elements,e=0;e<i.length;e++)if(i[e].d()in l)return i[e];return v}};q.ElementPath=q.Ta=C;var g=C.prototype;q.k.o(g,{compare:g.Wc,
contains:g.contains})});
KISSY.Editor.add("walker",function(q){function C(s,D){if(this.c.end)return y;var r,d=this.za,a,b=this.ec,f=this.type,m=s?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;d.trim();if(d.collapsed){this.end();return y}}if(!s&&!this.c.hd){var w=d.endContainer,h=new i(w[0].childNodes[d.endOffset]);this.c.hd=function(p,c){return(p=l.D(p))&&p[0]&&(!c||!l.g(w,p))&&(!h[0]||!p.g(h))&&(p[0].nodeType!=g.e||!c||p.d()!="body")}}if(s&&!this.c.jd){var j=d.startContainer,B=d.startOffset>
0&&new i(j[0].childNodes[d.startOffset-1]);this.c.jd=function(p,c){return(p=l.D(p))&&p[0]&&(!c||!p.g(j))&&(!B[0]||!p.g(B))&&(p[0].nodeType!=g.e||!c||p.d()!="body")}}var F=s?this.c.jd:this.c.hd;a=b?function(p,c){if(F(p,c)===v)return v;return b(p,c)}:F;if(this.gb)r=this.gb[m](v,f,a);else if(s){r=d.endContainer;if(d.endOffset>0){r=new i(r[0].childNodes[d.endOffset-1]);if(a(r)===v)r=y}else r=a(r,z)===v?y:r.ha(z,f,a)}else{r=d.startContainer;if((r=new i(r[0].childNodes[d.startOffset]))&&r[0]){if(a(r)===
v)r=y}else r=a(d.startContainer,z)===v?y:d.startContainer.w(z,f,a)}for(;r&&r[0]&&!this.c.end;){this.gb=r;if(!this.R||this.R(r)!==v){if(!D)return r}else if(D&&this.R)return v;r=r[m](v,f,a)}this.end();return this.gb=y}function u(s){for(var D,r=y;D=C.call(this,s);)r=D;return r}function K(s){this.za=s;this.c={}}var z=T,v=V,y=U,n=KISSY,g=q.n,l=n.DOM,i=n.Node;n.augment(K,{end:function(){this.c.end=1},next:function(){return C.call(this)},qb:function(){return C.call(this,z)},Vc:function(){return C.call(this,
v,z)!==v},Uc:function(){return C.call(this,z,z)!==v},pd:function(){return u.call(this)},od:function(){return u.call(this,z)},reset:function(){delete this.gb;this.c={}}});K.Rb=function(s){return function(D){D=l.D(D);return!(D&&D[0].nodeType==g.e&&D.ra(s))}};K.Ne=function(){return this.Rb({Sb:1})};K.ua=function(s,D){function r(d){return d&&d[0]&&d.d()=="span"&&d.attr("_ke_bookmark")}return function(d){var a,b;a=d&&d[0]&&d[0].nodeType==g.f&&(b=d.parent())&&r(b);a=s?a:a||r(d);return D^a}};K.Qa=function(s){return function(D){D=
(D=D[0]||D)&&D.nodeType==g.f&&!n.trim(D.nodeValue);return s^D}};K.Ie=function(s){var D=K.Qa();return function(r){r=D(r)||r[0].nodeType==g.e&&!r[0].offsetHeight;return s^r}};q.Da=K;q.Walker=K;var e=K.prototype;q.k.o(e,{end:e.end,next:e.next,previous:e.qb,checkForward:e.Vc,checkBackward:e.Uc,lastForward:e.pd,lastBackward:e.od,reset:e.reset});q.k.o(K,{blockBoundary:K.Rb,listItemBoundary:K.Ne,bookmark:K.ua,whitespaces:K.Qa,invisible:K.Ie})});
KISSY.Editor.add("range",function(q){function C(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=l;this.collapsed=n;this.document=c}function u(c){var k=c[0].nodeType!=e.f&&c.d()in f.ba,o=!i.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return k||o||c}function K(c){return!B(c)&&!F(c)}function z(c){var k=g,o=r.ua(n);return function(x){if(o(x))return n;if(x[0].nodeType==e.f){if(i.trim(x[0].nodeValue).length)return g}else if(x[0].nodeType==e.e)if(!j[x.d()])if(!c&&!b.ie&&
x.d()=="br"&&!k)k=n;else return g;return n}}function v(c,k){function o(x){return x&&x.nodeName=="span"&&x.getAttribute("_ke_bookmark")}return function(x){var t,E;t=x&&!x.nodeName&&(E=x.parentNode)&&o(E);t=c?t:t||o(x);return k^t}}function y(c){return function(k){k=(k=k[0]||k)&&k.nodeType==e.f&&!i.trim(k.nodeValue);return c^k}}q.pa={W:1,J:2,C:3,t:4,Ab:1,zb:2,Sa:3,Wa:1,Ld:2,qf:3,ea:1,Bc:2};q.RANGE=q.pa;var n=T,g=V,l=U,i=KISSY,e=q.n,s=q.pa,D=q.Ua,r=q.Da,d=i.DOM,a=q.k.bd,b=i.UA,f=q.m,m=q.Ta,w=i.Node,h=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};C.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};i.augment(C,{Pa:function(){this.collapsed=this.startContainer&&this.endContainer&&d.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},lc:function(){var c=this.startContainer,
k=this.startOffset;if(c[0].nodeType!=e.e)if(k)k>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;k=this.endOffset;if(c[0].nodeType!=e.e)if(k)k>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},mc:function(){var c=
this.startContainer,k=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.U(c,s.C);k&&k.d()=="span"&&k.attr("_ke_bookmark")&&this.T(k,s.t)},setStart:function(c,k){if(c[0].nodeType==e.e&&h[c.d()]){c=c.parent();k=c.v()}this.startContainer=c;this.startOffset=k;if(!this.endContainer){this.endContainer=c;this.endOffset=k}this.Pa()},setEnd:function(c,k){if(c[0].nodeType==e.e&&h[c.d()]){c=c.parent();k=c.v()+1}this.endContainer=c;this.endOffset=k;if(!this.startContainer){this.startContainer=
c;this.startOffset=k}this.Pa()},U:function(c,k){switch(k){case s.W:this.setStart(c,0);break;case s.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case s.C:this.setStartBefore(c);break;case s.t:this.setStartAfter(c)}this.Pa()},T:function(c,k){switch(k){case s.W:this.setEnd(c,0);break;case s.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case s.C:this.setEndBefore(c);break;case s.t:this.setEndAfter(c)}this.Pa()},
Yb:function(c,k){var o=this.startContainer,x=this.endContainer,t=this.startOffset,E=this.endOffset,O,N=this.document,P;this.mc();if(x[0].nodeType==e.f)x=x.ia(E);else if(x[0].childNodes.length>0)if(E>=x[0].childNodes.length){x=new w(x[0].appendChild(N.createTextNode("")));P=n}else x=new w(x[0].childNodes[E]);if(o[0].nodeType==e.f){o.ia(t);if(o.g(x))x=new w(o[0].nextSibling)}else if(t)if(t>=o[0].childNodes.length){O=new w(N.createTextNode(""));o.append(O);o=O;O=n}else o=new w(o[0].childNodes[t].previousSibling);
else{O=new w(N.createTextNode(""));(t=o[0].firstChild)?d.insertBefore(O[0],t):o.append(O);o=O;O=n}t=o.Lb();E=x.Lb();var Q,W,S;for(Q=0;Q<t.length;Q++){W=t[Q];S=E[Q];if(!W.g(S))break}N=k;for(var A,J,G,H=Q;H<t.length;H++){A=t[H];if(N&&!A.g(o))J=N.appendChild(A.K()[0]);for(A=A[0].nextSibling;A;){if(d.g(E[H],A)||d.g(x,A))break;G=A.nextSibling;if(c==2)N.appendChild(A.cloneNode(n));else{A.parentNode.removeChild(A);c==1&&N.appendChild(A)}A=G}if(J)N=J}N=k;for(Q=Q;Q<E.length;Q++){A=E[Q];if(c>0&&!A.g(x))J=N.appendChild(A.K()[0]);
if(!t[Q]||!A.parent().g(t[Q].parent()))for(A=A[0].previousSibling;A;){if(d.g(t[Q],A)||d.g(o,A))break;G=A.previousSibling;if(c==2)N.insertBefore(A.cloneNode(n),N.firstChild);else{d.h(A);c==1&&N.insertBefore(A,N.firstChild)}A=G}if(J)N=J}if(c==2){S=this.startContainer[0];if(S.nodeType==e.f&&S.nextSibling&&S.nextSibling.nodeType==e.f){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}S=this.endContainer[0];if(S.nodeType==e.f&&S.nextSibling&&S.nextSibling.nodeType==e.f){S.data+=S.nextSibling.data;
S.parentNode.removeChild(S.nextSibling)}}else{if(W&&S&&(!o.parent().g(W.parent())||!x.parent().g(S.parent()))){W=S.v();O&&S.parent().g(o.parent())&&W--;this.setStart(S.parent(),W)}this.collapse(n)}O&&o.h();P&&x[0].parentNode&&x.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=n},clone:function(){var c=new C(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},ed:function(){var c=this.clone();c.lc();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return l;var k=new q.Da(c),o=v(n,undefined),x=y(n);c.R=function(t){return x(t)&&o(t)};c=k.next();k.reset();k=k.qb();return c&&c.g(k)?c:l},Oa:function(c,k){if(!this.collapsed){c=c||s.Bc;var o=this.clone(),x=this.startContainer,t=this.endContainer,E=this.startOffset,
O=this.endOffset,N=1,P=1;if(x&&x[0].nodeType==e.f)if(E)if(E>=x[0].nodeValue.length)o.setStartAfter(x);else{o.setStartBefore(x);N=0}else o.setStartBefore(x);if(t&&t[0].nodeType==e.f)if(O)if(O>=t[0].nodeValue.length)o.setEndAfter(t);else{o.setEndAfter(t);P=0}else o.setEndBefore(t);o=new r(o);o.R=function(W){W=W[0]||W;return W.nodeType==(c==s.ea?e.e:e.f)};var Q;o.ec=function(W,S){W=W[0]||W;if(c==s.ea&&W.nodeType==e.f)return g;if(S&&W==Q)return g;if(!S&&W.nodeType==e.e)Q=W;return n};if(N)(x=o[c==s.ea?
"lastForward":"next"]())&&this.U(x,k?s.W:s.C);if(P){o.reset();(o=o[c==s.ea?"lastBackward":"previous"]())&&this.T(o,k?s.J:s.t)}return!!(N||P)}},Be:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Xc:function(c){var k=this.startContainer,o=this.endContainer,x=this.startOffset,t=this.endOffset,E,O;if(!k||!o)return{start:0,end:0};if(c){if(k[0].nodeType==e.e)if((E=new w(k[0].childNodes[x]))&&E[0]&&E[0].nodeType==e.f&&x>0&&E[0].previousSibling.nodeType==
e.f){k=E;x=0}for(;k[0].nodeType==e.f&&(O=k.ta())&&O[0].nodeType==e.f;){k=O;x+=O[0].nodeValue.length}if(!this.collapsed){if(o[0].nodeType==e.e)if((E=new w(o[0].childNodes[t]))&&E[0]&&E[0].nodeType==e.f&&t>0&&E[0].previousSibling.nodeType==e.f){o=E;t=0}for(;o[0].nodeType==e.f&&(O=o.ta())&&O[0].nodeType==e.f;){o=O;t+=O[0].nodeValue.length}}}return{start:k.Ea(c),end:this.collapsed?l:o.Ea(c),startOffset:x,endOffset:t,rd:c,Je:n}},P:function(c){var k,o,x,t,E=this.collapsed;k=new w("<span>",l,this.document);
k.attr("_ke_bookmark",1);k.css("display","none");k.html("&nbsp;");if(c){x=i.guid("ke_bm_");k.attr("id",x+"S")}if(!E){o=k.K();o.html("&nbsp;");c&&o.attr("id",x+"E");t=this.clone();t.collapse();t.insertNode(o)}t=this.clone();t.collapse(n);t.insertNode(k);if(o){this.setStartAfter(k);this.setEndBefore(o)}else this.H(k,s.t);return{Z:c?x+"S":k,Q:c?x+"E":o,Dd:c,collapsed:E}},H:function(c,k){this.U(c,k);this.collapse(n)},trim:function(c,k){var o=this.startContainer,x=this.startOffset,t=this.collapsed;if((!c||
t)&&o[0]&&o[0].nodeType==e.f){if(x)if(x>=o[0].nodeValue.length){x=o.v()+1;o=o.parent()}else{var E=o.ia(x);x=o.v()+1;o=o.parent();if(d.g(this.startContainer,this.endContainer))this.setEnd(E,this.endOffset-this.startOffset);else if(d.g(o,this.endContainer))this.endOffset+=1}else{x=o.v();o=o.parent()}this.setStart(o,x);if(t){this.collapse(n);return}}o=this.endContainer;x=this.endOffset;if(!(k||t)&&o[0]&&o[0].nodeType==e.f){if(x){x>=o.nodeValue.length||o.ia(x);x=o.v()+1}else x=o.v();o=o.parent();this.setEnd(o,
x)}},insertNode:function(c){this.mc();this.trim(g,n);var k=this.startContainer,o=k[0].childNodes[this.startOffset];o?d.insertBefore(c[0]||c,o):k[0].appendChild(c[0]||c);d.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.Je){var k=a(this.document,c.start,c.rd),o=c.startOffset,x=c.end&&a(this.document,c.end,c.rd);c=c.endOffset;this.setStart(k,o);x?this.setEnd(x,c):this.collapse(n)}else{k=(o=c.Dd)?i.one("#"+c.Z,this.document):c.Z;c=o?i.one("#"+
c.Q,this.document):c.Q;this.setStartBefore(k);k.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(n)}},xa:function(c,k){var o=this.startContainer,x=this.endContainer;o=d.g(o,x)?c&&o[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new w(o[0].childNodes[this.startOffset]):o:o.Hb(x);return k&&o[0].nodeType==e.f?o.parent():o},Ja:function(c){switch(c){case s.Ab:if(this.collapsed)break;c=this.xa();var k=new w(this.document.body),o,x,t,E,O,N=g,P,Q;P=this.startContainer;Q=this.startOffset;
if(P[0].nodeType==e.f){if(Q){P=!i.trim(P[0].nodeValue.substring(0,Q)).length&&P;N=!!P}if(P)if(!(E=P[0].previousSibling))t=P.parent()}else{if(Q)E=P[0].childNodes[Q-1]||P[0].lastChild;E||(t=P)}for(;t||E;){if(t&&!E){if(!O&&d.g(t,c))O=n;if(!k.L(t))break;if(!N||t.css("display")!="inline"){N=g;if(O)o=t;else this.setStartBefore(t)}E=t[0].previousSibling}for(;E;){P=g;if(E.nodeType==e.f){Q=E.nodeValue;if(/[^\s\ufeff]/.test(Q))E=l;P=/[\s\ufeff]$/.test(Q)}else if(E.offsetWidth>0&&!E.getAttribute("_ke_bookmark"))if(N&&
f.ba[E.nodeName.toLowerCase()]){Q=d.text(E);if(/[^\s\ufeff]/.test(Q))E=l;else for(var W=E.all||E.getElementsByTagName("*"),S=0,A;A=W[S++];)if(!f.ba[A.nodeName.toLowerCase()]){E=l;break}if(E)P=!!Q.length}else E=l;if(P)if(N)if(O)o=t;else t&&this.setStartBefore(t);else N=n;if(E){P=E.previousSibling;if(!t&&!P){t=new w(E);E=l;break}E=P}else t=l}if(t)t=t.parent()}P=this.endContainer;Q=this.endOffset;t=E=l;O=N=g;if(P[0].nodeType==e.f){P=!i.trim(P[0].nodeValue.substring(Q)).length&&P;N=!(P&&P[0].nodeValue.length);
if(P)if(!(E=P[0].nextSibling))t=P.parent()}else(E=P[0].childNodes[Q])||(t=P);for(;t||E;){if(t&&!E){if(!O&&d.g(t,c))O=n;if(!k.L(t))break;if(!N||t.css("display")!="inline"){N=g;if(O)x=t;else t&&this.setEndAfter(t)}E=t[0].nextSibling}for(;E;){P=g;if(E.nodeType==e.f){Q=E.nodeValue;if(/[^\s\ufeff]/.test(Q))E=l;P=/^[\s\ufeff]/.test(Q)}else if(E.offsetWidth>0&&!E.getAttribute("_ke_bookmark"))if(N&&f.ba[E.nodeName.toLowerCase()]){Q=d.text(E);if(/[^\s\ufeff]/.test(Q))E=l;else{W=E.all||E.getElementsByTagName("*");
for(S=0;A=W[S++];)if(!f.ba[A.nodeName.toLowerCase()]){E=l;break}}if(E)P=!!Q.length}else E=l;if(P)if(N)if(O)x=t;else this.setEndAfter(t);if(E){P=E.nextSibling;if(!t&&!P){t=new w(E);E=l;break}E=P}else t=l}if(t)t=t.parent()}if(o&&x){c=o.L(x)?x:o;this.setStartBefore(c);this.setEndAfter(c)}break;case s.zb:case s.Sa:t=new C(this.document);k=new w(this.document.body);t.U(k,s.W);t.setEnd(this.startContainer,this.startOffset);t=new r(t);var J,G,H=r.Rb(c==s.Sa?{Sb:1}:l),I=function(M){var L=H(M);L||(J=M);return L};
o=function(M){var L=I(M);if(!L&&M[0]&&M.d()=="br")G=M;return L};t.ec=I;t=t.od();J=J||k;this.U(J,J.d()!="br"&&(!t&&this.va()||t&&J.L(t))?s.W:s.t);t=this.clone();t.collapse();t.T(k,s.J);t=new r(t);t.ec=c==s.Sa?o:I;J=l;t=t.pd();J=J||k;this.T(J,!t&&this.la()||t&&J.L(t)?s.J:s.C);G&&this.setEndAfter(G)}},va:function(){var c=this.startContainer,k=this.startOffset;if(k&&c[0].nodeType==e.f)if(i.trim(c[0].nodeValue.substring(0,k)).length)return g;this.trim();c=new m(this.startContainer);k=this.clone();k.collapse(n);
k.U(c.z||c.F,s.W);c=new r(k);c.R=z(n);return c.Uc()},la:function(){var c=this.endContainer,k=this.endOffset;if(c[0].nodeType==e.f)if(i.trim(c[0].nodeValue.substring(k)).length)return g;this.trim();c=new m(this.endContainer);k=this.clone();k.collapse(g);k.T(c.z||c.F,s.J);c=new r(k);c.R=z(g);return c.Vc()},deleteContents:function(){this.collapsed||this.Yb(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Yb(1,c);return c},Ub:function(c,k){var o=this.clone();
o[k==s.Wa?"setStartAt":"setEndAt"](c,k==s.Wa?s.W:s.J);o=new r(o);o.R=u;return o[k==s.Wa?"checkBackward":"checkForward"]()},ad:function(){var c=this.startContainer,k=this.endContainer,o=this.startOffset,x=this.endOffset,t;if(c[0].nodeType==e.e){t=c[0].childNodes.length;if(t>o)c=new w(c[0].childNodes[o]);else if(t<1)c=c.ha();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new w(c);c=c.w()||c}}if(k[0].nodeType==e.e){t=k[0].childNodes.length;if(t>x)k=(new w(k[0].childNodes[x])).ha(n);else if(t<1)k=k.ha();
else{for(k=k[0];k.lastChild;)k=k.lastChild;k=new w(k)}}if(c.Fa(k)&D.ca)c=k;return{Z:c,Q:k}},hb:function(c,k){var o=this.P(),x=new w(this.document.createElement(k));this.collapse(c);this.Ja(s.zb);x[0].appendChild(this.extractContents());x.cb();b.ie||x.Fb();this.insertNode(x);this.moveToBookmark(o);return x},rc:function(c){var k=new m(this.startContainer),o=new m(this.endContainer),x=k.z,t=o.z,E=l;if(!k.F.g(o.F))return l;if(c!="br"){if(!x){x=this.hb(n,c);t=(new m(this.endContainer)).z}t||(t=this.hb(g,
c))}c=x&&this.va();k=t&&this.la();this.deleteContents();if(x&&d.g(x,t))if(k){E=new m(this.startContainer);this.H(t,s.t);t=l}else if(c){E=new m(this.startContainer);this.H(x,s.C);x=l}else{t=this.sc(x);!b.ie&&!i.inArray(x.d(),["ul","ol"])&&x.Fb()}return{Kf:x,Jf:t,af:c,$e:k,Gf:E}},sc:function(c){if(!this.collapsed)return l;this.T(c,s.J);var k=this.extractContents(),o=c.K(g);o[0].appendChild(k);o.insertAfter(c);this.H(c,s.t);return o},mb:function(c,k){var o,x=q.m;if(x.vb[c.d()])return g;for(;c&&c[0].nodeType==
e.e;){if(o=c.Ic())this.H(c,k?s.J:s.W);else if(x.vc[c.d()]){this.H(c,k?s.t:s.C);return n}if((c=x.vb[c.d()]?c[k?"_4e_previous":"_4e_next"](K):c[k?"_4e_last":"_4e_first"](K))&&c[0].nodeType==e.f){this.H(c,k?s.t:s.C);return n}}return o},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var j={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},B=new r.Qa,F=new r.ua;q.Range=C;q.Range=C;var p=C.prototype;q.k.o(p,{updateCollapsed:p.Pa,optimize:p.lc,setStartAfter:p.setStartAfter,setEndAfter:p.setEndAfter,setStartBefore:p.setStartBefore,setEndBefore:p.setEndBefore,optimizeBookmark:p.mc,setStart:p.setStart,setEnd:p.setEnd,setStartAt:p.U,setEndAt:p.T,execContentsAction:p.Yb,collapse:p.collapse,clone:p.clone,getEnclosedNode:p.ed,shrink:p.Oa,getTouchedStartNode:p.Be,createBookmark2:p.Xc,createBookmark:p.P,
moveToPosition:p.H,trim:p.trim,insertNode:p.insertNode,moveToBookmark:p.moveToBookmark,getCommonAncestor:p.xa,enlarge:p.Ja,checkStartOfBlock:p.va,checkEndOfBlock:p.la,deleteContents:p.deleteContents,extractContents:p.extractContents,checkBoundaryOfElement:p.Ub,getBoundaryNodes:p.ad,fixBlock:p.hb,splitBlock:p.rc,splitElement:p.sc,moveToElementEditablePosition:p.mb,selectNodeContents:p.selectNodeContents})});
KISSY.Editor.add("domiterator",function(q){function C(r){if(!(arguments.length<1)){this.za=r;this.$b=K;this.$c=u;this.Xb=K;this.c||(this.c={})}}var u=T,K=V,z=KISSY,v=z.UA,y=q.Da,n=q.Range,g=q.pa,l=q.n,i=q.Ta,e=z.Node,s=z.DOM,D=/^[\r\n\t ]*$/;y.ua();z.augment(C,{Ae:function(r){var d,a,b,f,m;if(!this.c.I){a=this.za.clone();a.Oa(g.ea,u);a.Ja(this.$b||!this.$c?g.Sa:g.zb);var w=new y(a),h=y.ua(u,u);w.R=h;this.c.ma=w.next();w=new y(a);w.R=h;w=w.qb();this.c.I=w.w(u);if(this.c.I&&this.c.I[0].nodeType==l.f&&
!z.trim(this.c.I[0].nodeValue)&&this.c.I.parent().ra()){h=new n(a.document);h.H(this.c.I,g.t);if(h.la()){h=new i(h.endContainer);this.c.I=(h.z||h.F).w(u)}}if(!this.c.I){this.c.I=this.c.Zc=new e(a.document.createTextNode(""));s.insertAfter(this.c.I[0],w[0])}a=U}h=this.c.ma;w=this.c.I;for(this.c.ma=U;h;){var j=K,B=h[0].nodeType!=l.e,F=K;if(B){if(h[0].nodeType==l.f)if(D.test(h[0].nodeValue))B=K}else{var p=h.d();if(h.ra(this.$b&&{Sb:1})){if(p=="br")B=u;else if(!a&&!h[0].childNodes.length&&p!="hr"){d=
h;b=h.g(w);break}if(a){a.T(h,g.C);if(p!="br")this.c.ma=h}j=u}else{if(h[0].firstChild){if(!a){a=new n(this.za.document);a.U(h,g.C)}h=new e(h[0].firstChild);continue}B=u}}if(B&&!a){a=new n(this.za.document);a.U(h,g.C)}b=(!j||B)&&h.g(w);if(a&&!j)for(;!h[0].nextSibling&&!b;){p=h.parent();if(p.ra(this.$b&&{Sb:1})){j=u;b||p.g(w);break}h=p;B=u;b=h.g(w);F=u}B&&a.T(h,g.t);h=h.w(F,U,w);if((b=!h)||j&&a)break}if(!d){if(!a){this.c.Zc&&this.c.Zc.h();return this.c.ma=U}d=new i(a.startContainer);h=d.F;j={Ef:1,Qf:1,
Pf:1};d=d.z;if((!d||!d[0])&&!this.Xb&&j[h.d()]&&a.va()&&a.la())d=h;else if(!d||this.Xb&&d.d()=="li"){d=new e(this.za.document.createElement(r||"p"));d[0].appendChild(a.extractContents());d.cb();a.insertNode(d);f=m=u}else if(d.d()!="li"){if(!a.va()||!a.la()){d=d.K(K);d[0].appendChild(a.extractContents());d.cb();m=a.rc();f=!m.af;m=!m.$e;a.insertNode(d)}}else if(!b)this.c.ma=d.g(w)?U:a.ad().Q.w(u,U,w)}if(f){a=new e(d[0].previousSibling);if(a[0]&&a[0].nodeType==l.e)if(a.d()=="br")a.h();else a[0].lastChild&&
s.d(a[0].lastChild)=="br"&&s.h(a[0].lastChild)}if(m){a=y.ua(K,u);f=new e(d[0].lastChild);if(f[0]&&f[0].nodeType==l.e&&f.d()=="br")if(v.ie||f.ta(a)||f.$a(a))f.h()}if(!this.c.ma)this.c.ma=b||d.g(w)?U:d.w(u,U,w);return d}});n.prototype.se=function(){return new C(this)}});
KISSY.Editor.add("selection",function(q){function C(h){this.document=this.document=h;this.c={N:{}};if(g.ie){var j=this.r().createRange();if(!j||j.item&&j.item(0).ownerDocument!=h||j.parentElement&&j.parentElement().ownerDocument!=h)this.nd=z}}function u(h){h=new C(h);return!h||h.nd?y:h}function K(h){var j=h.document,B=new e(j.body),F=new e(j.documentElement);if(g.ie){if(g.ie<8||document.documentMode==7)F.on("click",function(N){l.d(N.target)==="html"&&h.getSelection().A()[0].select()});var p,c,k=1;
F.on("mousedown",function(){k=0});F.on("mouseup",function(){k=1});B.on("focusin",function(N){if(l.d(N.target)=="body")if(p){try{k&&p.select()}catch(P){}p=y}});B.on("focus",function(){c=z;x()});B.on("beforedeactivate",function(N){if(!N.relatedTarget){c=v;k=1}});i.on(l.ga(j),"blur",function(){j&&j.selection.empty()});B.on("mousedown",function(){o()});B.on("mouseup",function(){c=z;setTimeout(function(){x(z)},0)});var o=function(){c=v},x=function(N){if(c){var P=h.document,Q=h.getSelection(),W=Q&&Q.ib(),
S=Q&&Q.r();if(N&&S&&W==s.Cb)if(!P.queryCommandEnabled("InsertImage")){setTimeout(function(){x(z)},50);return}var A;if(!(S&&W==s.qa&&(A=l.d(S.createRange().parentElement()))&&A in{input:1,textarea:1})){p=S&&Q.A()[0];h.db()}}};B.on("keydown",o);B.on("keyup",function(){c=z;x()});i.on(j,"selectionchange",x)}else{i.on(j,"mouseup",h.db,h);i.on(j,"keyup",h.db,h)}var t={table:1,pre:1},E=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,O=q.Da.Qa(z);
h.on("selectionChange",function(N){var P=N.path;N=(N=N.selection)&&N.A()[0];var Q=P.F;if(N)if(N.collapse&&!P.z&&Q.d()=="body"){P=N.hb(z,"p");if(P.ab().match(E))if((Q=P.$a(O))&&Q[0].nodeType==r.e&&!t[Q.d()]){N.mb(Q);P.h()}else if((Q=P.ta(O))&&Q[0].nodeType==r.e&&!t[Q.d()]){N.mb(Q,Q.ab().match(E)?v:z);P.h()}N.select();g.ie||h.nb()}})}q.Od={Cb:1,qa:2,Va:3};var z=T,v=V,y=U,n=KISSY,g=n.UA,l=n.DOM,i=n.Event,e=n.Node,s=q.Od,D=q.pa,r=q.n,d=q.Da,a=q.Range,b={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};n.augment(C,{r:g.ie?function(){var h=this.c.N;return h.jc||(h.jc=this.document.selection)}:function(){var h=this.c.N;return h.jc||(h.jc=l.ga(this.document).getSelection())},ib:g.ie?function(){var h=this.c.N;if(h.type)return h.type;var j=s.Cb;try{var B=this.r(),F=B.type;if(F=="Text")j=s.qa;if(F=="Control")j=s.Va;if(B.createRange().parentElement)j=s.qa}catch(p){}return h.type=j}:function(){var h=this.c.N;
if(h.type)return h.type;var j=s.qa,B=this.r();if(B){if(B.rangeCount==1){B=B.getRangeAt(0);var F=B.startContainer;if(F==B.endContainer&&F.nodeType==r.e&&B.endOffset-B.startOffset===1&&b[F.childNodes[B.startOffset].nodeName.toLowerCase()])j=s.Va}}else j=s.Cb;return h.type=j},A:g.ie?function(){function h(j,B){j=j.duplicate();j.collapse(B);for(var F=j.parentElement(),p=F.childNodes,c,k=0;k<p.length;k++){var o=p[k];if(o.nodeType==r.e){c=j.duplicate();c.moveToElementText(o);o=c.compareEndPoints("StartToStart",
j);var x=c.compareEndPoints("EndToStart",j);c.collapse();if(o>0)break;else if(!o||x==1&&o==-1)return{Ia:F,offset:k};else if(!x)return{Ia:F,offset:k+1};c=y}}if(!c){c=j.duplicate();c.moveToElementText(F);c.collapse(v)}c.setEndPoint("StartToStart",j);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=p[--k].nodeValue.length}catch(t){c=0}return c===0?{Ia:F,offset:k}:{Ia:p[k],offset:-c}}return function(){var j=this.c.N;if(j.oa)return j.oa;var B=this.r(),F=B&&B.createRange(),p=this.ib();if(!B)return[];
if(p==s.qa){B=new a(this.document);p=h(F,z);B.setStart(new e(p.Ia),p.offset);p=h(F);B.setEnd(new e(p.Ia),p.offset);return j.oa=[B]}else if(p==s.Va){j=j.oa=[];for(p=0;p<F.length;p++){var c=F.item(p),k=c.parentNode,o=0;for(B=new a(this.document);o<k.childNodes.length&&k.childNodes[o]!=c;o++);B.setStart(new e(k),o);B.setEnd(new e(k),o+1);j.push(B)}return j}return j.oa=[]}}():function(){var h=this.c.N;if(h.oa)return h.oa;var j=[],B=this.r();if(!B)return[];for(var F=0;F<B.rangeCount;F++){var p=B.getRangeAt(F),
c=new a(this.document);c.setStart(new e(p.startContainer),p.startOffset);c.setEnd(new e(p.endContainer),p.endOffset);j.push(c)}return h.oa=j},dc:function(){var h=this.c.N;if(h.Ed!==undefined)return h.Ed;var j,B=this.r();switch(this.ib()){case s.Va:return this.cc();case s.qa:var F=this.A()[0];if(F)if(!F.collapsed){for(F.lc();z;){j=F.startContainer;if(F.startOffset==(j[0].nodeType===r.e?j[0].childNodes.length:j[0].nodeValue.length)&&!j.ra())F.setStartAfter(j);else break}j=F.startContainer;if(j[0].nodeType!=
r.e)return j.parent();j=new e(j[0].childNodes[F.startOffset]);if(!j[0]||j[0].nodeType!=r.e)return F.startContainer;for(F=j[0].firstChild;F&&F.nodeType==r.e;){j=new e(F);F=F.firstChild}return j}if(g.ie){F=B.createRange();F.collapse(z);j=F.parentElement()}else if((j=B.anchorNode)&&j.nodeType!=r.e)j=j.parentNode}return h.Ed=j?l.D(j):y},cc:function(){var h=this,j,B=h.c.N;if(B.Cd!==undefined)return B.Cd;if(g.ie){j=h.r().createRange();j=j.item&&j.item(0)}j||(j=function(){for(var F=h.A()[0],p,c,k=2;k&&!((p=
F.ed())&&p[0].nodeType==r.e&&b[p.d()]&&(c=p));k--)F.Oa(D.ea);return c&&c[0]}());return B.Cd=l.D(j)},reset:function(){this.c.N={}},qc:function(h){var j;if(g.ie)try{j=this.document.body.createControlRange();j.addElement(h[0]);j.select()}catch(B){j=this.document.body.createTextRange();j.moveToElementText(h[0]);j.select()}finally{}else{j=this.document.createRange();j.selectNode(h[0]);h=this.r();h.removeAllRanges();h.addRange(j)}this.reset()},tb:function(h){if(g.ie){if(h.length>1){var j=h[h.length-1];
h[0].setEnd(j.endContainer,j.endOffset);h.length=1}h[0]&&h[0].select()}else{j=this.r();if(!j)return;j.removeAllRanges();for(var B=0;B<h.length;B++){var F=h[B],p=this.document.createRange(),c=F.startContainer;F.collapsed&&g.gecko&&g.gecko<1.09&&c[0].nodeType==r.e&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));p.setStart(c[0],F.startOffset);p.setEnd(F.endContainer[0],F.endOffset);j.addRange(p)}}this.reset()},re:function(h){for(var j=[],B=this.A(),F=0;F<B.length;F++)j.push(B[F].Xc(h));
return j},qe:function(h,j){var B=[],F=this.document,p;j=j||this.A();for(var c=j.length,k=0;k<c;k++){B.push(p=j[k].P(h,z));var o=(h=p.Dd)?n.one("#"+p.Z,F):p.Z;p=h?n.one("#"+p.Q,F):p.Q;for(var x=k+1;x<c;x++){var t=j[x],E=t.startContainer,O=t.endContainer;l.g(E,o.parent())&&t.startOffset++;l.g(E,p.parent())&&t.startOffset++;l.g(O,o.parent())&&t.endOffset++;l.g(O,p.parent())&&t.endOffset++}}return B},Bd:function(h){for(var j=[],B=0;B<h.length;B++){var F=new a(this.document);F.moveToBookmark(h[B]);j.push(F)}this.tb(j);
return this},xa:function(){var h=this.A();return h[0].startContainer.Hb(h[h.length-1].endContainer)},scrollIntoView:function(){var h=this.dc();h&&h.Mb()},removeAllRanges:function(){var h=this.r();if(g.ie)h&&h.clear();else h&&h.removeAllRanges()}});var f={table:1,tbody:1,tr:1},m=d.Qa(z),w=/\ufeff|\u00a0/;a.prototype.select=a.prototype.select=g.ie?function(h){var j=this.collapsed,B,F;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var p=this.startContainer[0].childNodes[this.startOffset];
if(p.nodeType==r.e){(new C(this.document)).qc(new e(p));return}}if(this.startContainer[0].nodeType==r.e&&this.startContainer.d()in f||this.endContainer[0].nodeType==r.e&&this.endContainer.d()in f)this.Oa(D.ea,z);var c=this.P();p=c.Z;var k;if(!j)k=c.Q;c=this.document.body.createTextRange();c.moveToElementText(p[0]);c.moveStart("character",1);if(k){h=this.document.body.createTextRange();h.moveToElementText(k[0]);c.setEndPoint("EndToEnd",h);c.moveEnd("character",-1)}else{for(B=p[0].nextSibling;B&&!m(B);)B=
B.nextSibling;B=!(B&&B.nodeValue&&B.nodeValue.match(w))&&(h||!p[0].previousSibling||p[0].previousSibling&&l.d(p[0].previousSibling)=="br");F=this.document.createElement("span");F.innerHTML="&#65279;";F=new e(F);l.insertBefore(F[0],p[0]);B&&l.insertBefore(this.document.createTextNode("\ufeff"),p[0])}this.setStartBefore(p);p.h();if(j){if(B){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(F){this.H(F,D.C);F.h()}}else{this.setEndBefore(k);k.h();c.select()}}:function(){var h=
this.startContainer;this.collapsed&&h[0].nodeType==r.e&&!h[0].childNodes.length&&h[0].appendChild(this.document.createTextNode(""));var j=this.document.createRange();j.setStart(h[0],this.startOffset);try{j.setEnd(this.endContainer[0],this.endOffset)}catch(B){if(B.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(z);j.setEnd(this.endContainer[0],this.endOffset)}else throw B;}h=u(this.document).r();h.removeAllRanges();h.addRange(j)};C.getSelection=u;q.Dc=C;q.Selection=C;d=C.prototype;q.k.o(d,
{getNative:d.r,getType:d.ib,getRanges:d.A,getStartElement:d.dc,getSelectedElement:d.cc,reset:d.reset,selectElement:d.qc,selectRanges:d.tb,createBookmarks2:d.re,createBookmarks:d.qe,getCommonAncestor:d.xa,scrollIntoView:d.scrollIntoView,selectBookmarks:d.Bd,removeAllRanges:d.removeAllRanges});q.on("instanceCreated",function(h){K(h.ve)})});
KISSY.Editor.add("styles",function(q){function C(A,J){for(var G in A)A[G]=A[G].replace(W,function(H,I){return J[I]})}function u(A,J){if(J){A=j.clone(A);C(A.attributes,J);C(A.styles,J)}var G=this.element=this.element=(A.element||"*").toLowerCase();this.type=this.type=G=="#"||N[G]?F.Db:P[G]?F.Xa:F.Ca;this.c={definition:A}}function K(A,J){var G=J?this.pc:this.Pb;A.body.focus();for(var H=new c(A),I=H.A(),M=0;M<I.length;M++)G.call(this,I[M]);H.tb(I)}function z(A,J){var G;G=A.element;if(G=="*")G="span";
G=new t(J.createElement(G));return v(G,A)}function v(A,J){var G=J.c.definition,H=G.attributes;G=u.gd(G);if(H)for(var I in H)A.attr(I,H[I]);if(G)A[0].style.cssText=G;return A}function y(A){var J=A.P(m),G=A.se();G.Xb=m;G.$c=m;for(var H,I=A.document;H=G.Ae();){var M=z(this,I);H=H;var L=M;M=L.d=="pre";var R=H.d=="pre",$=!M&&R;if(M&&!R){R=H;L=L;$=R.html();$=n($,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");$=$.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");$=$.replace(/([ \t\n\r]+|&nbsp;)/g," ");$=$.replace(/<br\b[^>]*>/gi,
"\n");if(E.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+$+"</pre>";L=new t(R.firstChild);L.h()}else L.html($);L=L}else if($)L=l(g(H),L);else H.Kb(L);H[0].parentNode.replaceChild(L[0],H[0]);if(M){H=L;M=void 0;if((M=H.ha(m,k.e))&&M.d()=="pre"){L=n(M.html(),/\n$/,"")+"\n\n"+n(H.html(),/^\n/,"");if(E.ie)H[0].outerHTML="<pre>"+L+"</pre>";else H.html(L);M.h()}}}A.moveToBookmark(J)}function n(A,J,G){var H="",I="";A=A.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(M,L,R){L&&(H=L);R&&(I=R);return""});return H+A.replace(J,G)+I}function g(A){var J=[];n(A.ab(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,H,I){return H+"</pre>"+I+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,H){J.push(H)});return J}function l(A,J){for(var G=J[0].ownerDocument.createDocumentFragment(),H=0;H<A.length;H++){var I=A[H];I=I.replace(/(\r\n|\r)/g,"\n");I=n(I,/^[ \t]*\n/,"");I=n(I,/\n$/,"");I=n(I,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});I=I.replace(/\n/g,"<br>");I=I.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=J.K();M.html(I);G.appendChild(M[0])}return G}function i(A){var J=A.document;if(A.collapsed){J=z(this,J);A.insertNode(J);A.H(J,p.J)}else{var G=this.element,H=this.c.definition,I,M=q.m[G]||(I=m,q.m.span),L=A.P();A.Ja(p.Ab);A.trim();var R=A.P(),$=R.Z;R=R.Q;for(var Z=$,ba;Z&&Z[0];){var X=w;if(B.g(Z,R)){Z=h;
X=m}else{var Y=Z[0].nodeType,ea=Y==k.e?Z.d():h;if(ea&&Z.attr("_ke_bookmark")){Z=Z.w(m);continue}if(!ea||M[ea]&&(Z.Fa(R)|o.Y|o.da|o.X)==o.Y+o.da+o.X&&(!H.childRule||H.childRule(Z))){var aa=Z.parent();if(aa&&aa[0]&&((q.m[aa.d()]||q.m.span)[G]||I)&&(!H.parentRule||H.parentRule(aa))){if(!ba&&(!ea||!q.m.ba[ea]||(Z.Fa(R)|o.Y|o.da|o.X)==o.Y+o.da+o.X)){ba=new x(J);ba.setStartBefore(Z)}if(Y==k.f||Y==k.e&&!Z[0].childNodes.length){Y=Z;for(var ca;!Y[0].nextSibling&&(ca=Y.parent(),M[ca.d()])&&(ca.Fa($)|o.ca|o.da|
o.X)==o.ca+o.da+o.X&&(!H.childRule||H.childRule(ca));)Y=ca;ba.setEndAfter(Y);Y[0].nextSibling||(X=m)}}else X=m}else X=m;Z=Z.w()}if(X&&ba&&!ba.collapsed){X=z(this,J);for(Y=ba.xa();X&&Y&&X[0]&&Y[0];){if(Y.d()==G){for(var da in H.attributes)X.attr(da)==Y.attr(da)&&X[0].removeAttribute(da);for(var ha in H.styles)X.M(ha)==Y.M(ha)&&X.M(ha,"");if(!X.Za()){X=h;break}}Y=Y.parent()}if(X){X[0].appendChild(ba.extractContents());Y=X;ea=r(this);aa=Y.all(this.element);for(var fa=aa.length;--fa>=0;)d(this,new t(aa[fa]));
var ga=void 0;for(ga in ea)if(ga!=this.element){aa=Y.all(ga);for(fa=aa.length-1;fa>=0;fa--){var ia=new t(aa[fa]);b(ia,ea[ga])}}ba.insertNode(X);X.sa();E.ie||X[0].normalize()}ba=h}}$.h();R.h();A.moveToBookmark(L);A.Oa(p.Bc)}}function e(A){A.Ja(p.Ab);var J=A.P(),G=J.Z;if(A.collapsed){for(var H=new O(G.parent()),I,M=0,L;M<H.elements.length&&(L=H.elements[M]);M++){if(L==H.z||L==H.F)break;if(this.ka(L)){var R=A.Ub(L,p.Ld),$=!R&&A.Ub(L,p.Wa);if($||R){I=L;I.match=$?"start":"end"}else{L.sa();L.d()==this.element?
d(this,L):b(L,r(this)[L.d()])}}}if(I&&I[0]){L=G;for(M=0;;M++){R=H.elements[M];if(B.g(R,I))break;else if(R.match)continue;else R=R.K();R[0].appendChild(L[0]);L=R}B[I.match=="start"?"insertBefore":"insertAfter"](L[0],I[0])}}else{var Z=J.Q,ba=this;H=function(){for(var X=new O(G.parent()),Y=new O(Z.parent()),ea=h,aa=h,ca=0;ca<X.elements.length;ca++){var da=X.elements[ca];if(da==X.z||da==X.F)break;if(ba.ka(da))ea=da}for(ca=0;ca<Y.elements.length;ca++){da=Y.elements[ca];if(da==Y.z||da==Y.F)break;if(ba.ka(da))aa=
da}aa&&Z.Gb(aa);ea&&G.Gb(ea)};H();for(I=new t(G[0].nextSibling);I[0]!==Z[0];){M=I.w();if(I[0]&&I[0].nodeType==k.e&&this.ka(I)){I.d()==this.element?d(this,I):b(I,r(this)[I.d()]);if(M[0].nodeType==k.e&&M.L(G)){H();M=new t(G[0].nextSibling)}}I=M}}A.moveToBookmark(J)}function s(A){var J={};A.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,H,I){J[H]=I});return J}function D(A,J){var G;if(J!==w){G=document.createElement("span");G.style.cssText=A;G=G.style.cssText||""}else G=
A;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function r(A){if(A.c.Ad)return A.c.Ad;var J=A.c.Ad={},G=A.c.definition.overrides;if(G){j.isArray(G)||(G=[G]);for(var H=0;H<G.length;H++){var I=G[H],M,L;if(typeof I=="string")M=I.toLowerCase();else{M=I.element?I.element.toLowerCase():A.element;L=I.attributes}I=J[M]||(J[M]={});if(L){I=I.attributes=I.attributes||[];for(var R in L)I.push([R.toLowerCase(),L[R]])}}}return J}function d(A,J){var G=A.c.definition,
H=j.mix(j.mix({},G.attributes),r(A)[J.d()]);G=G.styles;var I=j.isEmptyObject(H)&&j.isEmptyObject(G),M;for(M in H)if(!((M=="class"||A.c.definition.fullMatch)&&J.attr(M)!=a(M,H[M]))){I=I||!!J.Hc(M);J.removeAttr(M)}for(var L in G)if(!(A.c.definition.fullMatch&&J.M(L)!=a(L,G[L],m))){I=I||!!J.M(L);J.M(L,"")}I&&f(J)}function a(A,J,G){var H=new t("<span>");H[G?"_4e_style":"attr"](A,J);return H[G?"_4e_style":"attr"](A)}function b(A,J){var G=J&&J.attributes;if(G)for(var H=0;H<G.length;H++){var I=G[H][0],M;
if(M=A.attr(I)){var L=G[H][1];if(L===h||L.test&&L.test(M)||typeof L=="string"&&M==L)A[0].removeAttribute(I)}}f(A)}function f(A){if(!A.Za()){var J=A[0].firstChild,G=A[0].lastChild;A.h(m);if(J){J.nodeType==k.e&&B.sa(J);G&&!J===G&&G.nodeType==k.e&&B.sa(G)}}}var m=T,w=V,h=U,j=KISSY,B=j.DOM,F={Db:1,Ca:2,Xa:3},p=q.pa,c=q.Dc,k=q.n,o=q.Ua,x=q.Range,t=j.Node,E=j.UA,O=q.Ta,N={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},P={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,
dd:1,form:1},Q=/\s*(?:;\s*|$)/,W=/#\((.+?)\)/g;q.rf=F;u.prototype={apply:function(A){K.call(this,A,w)},remove:function(A){K.call(this,A,m)},Pb:function(A){return(this.Pb=this.type==F.Ca?i:this.type==F.Db?y:this.type==F.Xa?h:h).call(this,A)},pc:function(A){return(this.pc=this.type==F.Ca?e:h).call(this,A)},fe:function(A){v(A,this)},ka:function(A,J){if(!A)return w;var G=this.c.definition;if(A.d()==this.element){if(!J&&!A.Za())return m;var H=G.Xd;if(H)G=H;else{H={};var I=0,M=G.attributes;if(M)for(var L in M){I++;
H[L]=M[L]}if(M=u.gd(G)){H.style||I++;H.style=M}H._length=I;G=G.Xd=H}if(G._length){for(var R in G)if(R!="_length"){I=A.attr(R)||"";if(R=="style")a:{H=G[R];I=D(I,w);typeof H=="string"&&(H=s(H));typeof I=="string"&&(I=s(I));M=void 0;for(M in H)if(!(M in I&&(I[M]==H[M]||H[M]=="inherit"||I[M]=="inherit"))){H=w;break a}H=m}else H=G[R]==I;if(H){if(!J)return m}else if(J)return w}if(J)return m}else return m}if(R=r(this)[A.d()]){if(!(G=R.attributes))return m;for(H=0;H<G.length;H++){R=G[H][0];if(R=A.attr(R)){I=
G[H][1];if(I===h||typeof I=="string"&&R==I||I.test&&I.test(R))return m}}}return w},ne:function(A){switch(this.type){case F.Db:return this.ka(A.z||A.F,m);case F.Xa:case F.Ca:for(var J=A.elements,G=0,H;G<J.length;G++){H=J[G];if(!(this.type==F.Ca&&(B.g(H,A.z)||B.g(H,A.F))))if(!(this.type==F.Xa&&!(H.d()in P)))if(this.ka(H,m))return m}}return w}};u.gd=function(A){var J=A.Yd;if(J)return J;J=A.styles;var G=A.attributes&&A.attributes.style||"",H="";if(G.length)G=G.replace(Q,";");for(var I in J){var M=J[I],
L=(I+":"+M).replace(Q,";");if(M=="inherit")H+=L;else G+=L}if(G.length)G=D(G);G+=H;return A.Yd=G};q.tf=u;q.Style=u;var S=u.prototype;q.k.o(S,{apply:S.apply,remove:S.remove,applyToRange:S.Pb,removeFromRange:S.pc,applyToObject:S.fe,checkElementRemovable:S.ka,checkActive:S.ne})});
KISSY.Editor.add("htmlparser",function(){function q(){}function C(){this.c={kd:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var u=KISSY,K=u.Editor,z=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,v={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},y=K.m;u.augment(C,{ya:q,zd:q,na:q,vd:q,Ma:q,parse:function(n){for(var g,
l,i=0,e;g=this.c.kd.exec(n);){l=g.index;if(l>i){i=n.substring(i,l);e?e.push(i):this.na(i)}i=this.c.kd.lastIndex;if(l=g[1]){l=l.toLowerCase();if(e&&y.uc[l]){this.vd(e.join(""));e=U}if(!e){this.zd(l);continue}}if(e)e.push(g[0]);else if(l=g[3]){l=l.toLowerCase();if(!/="/.test(l)){var s={},D;g=g[4];var r=!!(g&&g.charAt(g.length-1)=="/");if(g)for(;D=z.exec(g);){var d=D[1].toLowerCase();D=D[2]||D[3]||D[4]||"";s[d]=!D&&v[d]?d:D}this.ya(l,s,r);if(!e&&y.uc[l])e=[]}}else if(l=g[2])this.Ma(l)}n.length>i&&this.na(n.substring(i,
n.length))}});K.j=C;K.HtmlParser=C});
KISSY.Editor.add("htmlparser-basicwriter",function(){function q(){this.c={l:[]}}var C=KISSY,u=C.Editor,K=u.k;C.augment(q,{ob:function(z){this.c.l.push("<",z)},pb:function(z,v){v?this.c.l.push(" />"):this.c.l.push(">")},eb:function(z,v){if(typeof v=="string")v=K.gc(v);this.c.l.push(" ",z,'="',v,'"')},fb:function(z){this.c.l.push("</",z,">")},text:function(z){this.c.l.push(z)},O:function(z){this.c.l.push("<!--",z,"--\>")},write:function(z){this.c.l.push(z)},reset:function(){this.c.l=[];this.c.B=V},
ac:function(z){var v=this.c.l.join("");z&&this.reset();return v}});u.j.yb=q;u.j.BasicWriter=q;C=q.prototype;u.k.o(C,{openTag:C.ob,openTagClose:C.pb,attribute:C.eb,closeTag:C.fb,text:C.text,comment:C.O,write:C.write,reset:C.reset,getHtml:C.ac})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function q(){q.Of.constructor.call(this);this.ld="\t";this.Te=" />";this.Me="\n";this.ye=v;this.Ue=z;this.c.B=v;this.c.G="";this.c.rules={};var y=u.m,n;for(n in K.mix({},y.xb,y.Ra,y.wb,y.yc))this.Aa(n,{B:z,ke:z,Tb:z,Tc:!y[n]["#"],je:z});this.Aa("br",{Tb:z});this.Aa("title",{B:v,Tb:v});this.Aa("style",{B:v,Tc:z});this.Aa("pre",{B:v})}var C=KISSY,u=C.Editor,K=u.k,z=T,v=V;C.extend(q,u.j.yb,{ob:function(y){var n=this.c.rules[y];if(this.c.B)this.G();
else if(n&&n.ke){this.Ka();this.G()}this.c.l.push("<",y)},pb:function(y,n){var g=this.c.rules[y];if(n)this.c.l.push(this.Te);else{this.c.l.push(">");if(g&&g.B)this.c.G+=this.ld}g&&g.Tb&&this.Ka()},eb:function(y,n){if(typeof n=="string"){this.ye&&(n=n.replace(/&amp;/g,"&"));n=K.gc(n)}this.c.l.push(" ",y,'="',n,'"')},fb:function(y){var n=this.c.rules[y];if(n&&n.B)this.c.G=this.c.G.substr(this.ld.length);if(this.c.B)this.G();else if(n&&n.Tc){this.Ka();this.G()}this.c.l.push("</",y,">");n&&n.je&&this.Ka()},
text:function(y){if(this.c.B){this.G();y=K.La(y)}this.c.l.push(y)},O:function(y){this.c.B&&this.G();this.c.l.push("<!--",y,"--\>")},Ka:function(){this.c.l.length>0&&this.c.l.push(this.Me);this.c.B=z},G:function(){this.c.l.push(this.c.G);this.c.B=v},Aa:function(y,n){var g=this.c.rules[y];if(g)K.mix(g,n);else this.c.rules[y]=n}});u.j.hf=q;u.j.HtmlWriter=q;C=q.prototype;u.k.o(C,{openTag:C.ob,openTagClose:C.pb,attribute:C.eb,closeTag:C.fb,text:C.text,comment:C.O,lineBreak:C.Ka,indentation:C.G,setRules:C.Aa})});
KISSY.Editor.add("htmlparser-fragment",function(){function q(){this.children=[];this.parent=K;this.c={S:C,fc:u}}var C=T,u=V,K=U,z=KISSY.Editor,v={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},y=KISSY,n=z.k,g=z.n,l=z.m,i=n.mix({table:1,ul:1,ol:1,dl:1},l.table,l.ul,l.ol,l.dl),e=l.Jd,s=l.wb;q.Bb=function(D,r){function d(k){var o;if(w.length>0)for(var x=0;x<w.length;x++){var t=w[x],E=t.name,O=l[E],N=j.name&&l[j.name];if((!N||N[E])&&(!k||!O||O[k]||!l[k])){if(!o){a();o=1}t=t.clone();
t.parent=j;j=t;w.splice(x,1);x--}}}function a(){for(;h.length;)j.add(h.shift())}function b(k,o,x){o=o||j||m;if(r&&!o.type){var t,E;if((t=k.attributes&&(E=k.attributes._ke_real_element_type)?E:k.name)&&!(t in l.tc)&&!(t in l.xb)){t=j;j=o;f.ya(r,{});o=j;if(x)j=t}}if(k.c.S&&k.name!="pre"){x=k.children.length;if((t=k.children[x-1])&&t.type==g.f)if(E=n.Na(t.value))t.value=E;else k.children.length=x-1}o.add(k);if(k.rb){j=k.rb;delete k.rb}}var f=new z.j,m=new q,w=[],h=[],j=m,B=u,F;f.ya=function(k,o,x){var t=
new z.j.zc(k,o);if(t.ic&&x)t.lb=C;if(l.ba[k])w.push(t);else{if(k=="pre")B=C;else if(k=="br"&&B){j.add(new z.j.Eb("\n"));return}if(k=="br")h.push(t);else{var E=j.name,O=E&&(l[E]||(j.c.S?l.div:l.span));if(O&&!t.ic&&!j.ic&&!O[k]){O=u;var N;if(k in e&&E in e){E=j.children;(E=E[E.length-1])&&E.name in s||b(E=new z.j.zc("li"),j);F=j;N=E}else if(k==E)b(j,j.parent);else{if(i[E])F||(F=j);else{b(j,j.parent,C);v[E]||w.unshift(j)}O=C}j=N?N:j.rb||j.parent;if(O){f.ya.apply(this,arguments);return}}d(k);a();t.parent=
j;t.rb=F;F=0;if(t.lb)b(t);else j=t}}};f.zd=function(k){for(var o=w.length-1;o>=0;o--)if(k==w[o].name){w.splice(o,1);return}for(var x=[],t=[],E=j;E.type&&E.name!=k;){E.c.S||t.unshift(E);x.push(E);E=E.parent}if(E.type){for(o=0;o<x.length;o++){var O=x[o];b(O,O.parent)}j=E;if(j.name=="pre")B=u;E.c.S&&a();b(E,E.parent);if(E==j)j=j.parent;w=w.concat(t)}if(k=="body")r=u};f.na=function(k){if(!j.c.fc&&!B){k=n.La(k);if(k.length===0)return}a();d();if(r&&(!j.type||j.name=="body")&&n.trim(k))this.ya(r,{});B||
(k=k.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));j.add(new z.j.Eb(k))};f.vd=function(){};f.Ma=function(k){j.add(new z.j.Kd(k))};f.parse(D);for(a();j.type;){var p=j.parent,c=j;if(r&&(!p.type||p.name=="body")&&!l.tc[c.name]){j=p;f.ya(r,{});p=j}p.add(c);j=p}return m};y.augment(q,{add:function(D){var r=this.children.length;if(r=r>0&&this.children[r-1]||K){if(D.c.S&&r.type==g.f){r.value=n.Na(r.value);if(r.value.length===0){this.children.pop();this.add(D);return}}r.next=D}D.qb=r;D.parent=this;this.children.push(D);
this.c.fc=D.type==g.f||D.type==g.e&&!D.c.S},aa:function(D,r){var d;this.filterChildren=this.Zb=function(){var a=new z.j.yb;this.V.call(this,a,r,C);a=a.ac();this.children=(new q.Bb(a)).children;d=1};!this.name&&r&&r.xd(this);this.V(D,d?K:r)},V:function(D,r){for(var d=0;d<this.children.length;d++)this.children[d].aa(D,r)}});z.j.Ba=q;z.j.Fragment=q;q.FromHtml=q.Bb;y=q.prototype;z.k.o(y,{add:y.add,writeHtml:y.aa,writeChildrenHtml:y.V})});
KISSY.Editor.add("htmlparser-element",function(){function q(v,y){v=v[0];y=y[0];return v<y?-1:v>y?1:0}function C(v,y){this.name=v;this.attributes=y||(y={});this.children=[];var n=y.vf||v,g=u.m;n=!!(g.xb[n]||g.Ra[n]||g.wb[n]||g.yc[n]||g.xc[n]||n=="br");var l=!!g.vb[v];this.lb=l;this.ic=!g[v];this.c={S:n,fc:l||!n}}var u=KISSY.Editor,K=u.n;KISSY.augment(C,{type:K.e,add:u.j.Ba.prototype.add,clone:function(){return new C(this.name,this.attributes)},aa:function(v,y){var n=this.attributes,g=this,l=g.name,
i,e,s,D;g.Zb=function(){if(!D){var a=new u.j.yb;u.j.Ba.prototype.V.call(g,a,y);g.children=(new u.j.Ba.Bb(a.ac())).children;D=1}};g.filterChildren=g.Zb;if(y){for(;;){if(!(l=y.wd(l)))return;g.name=l;if(!(g=y.kc(g)))return;g.parent=this.parent;if(g.name==l)break;if(g.type!=K.e){g.aa(v,y);return}l=g.name;if(!l){this.V.call(g,v,D?U:y);return}}n=g.attributes}v.ob(l,n);for(var r=[],d=0;d<2;d++)for(i in n){e=i;s=n[i];if(d==1)r.push([i,s]);else if(y){for(;;)if(e=y.ud(i))if(e!=i){delete n[i];i=e}else break;
else{delete n[i];break}if(e)if((s=y.sd(g,e,s))===V)delete n[e];else n[e]=s}}v.Ue&&r.sort(q);n=r.length;for(d=0;d<n;d++){i=r[d];v.eb(i[0],i[1])}v.pb(l,g.lb);if(!g.lb){this.V.call(g,v,D?U:y);v.fb(l)}},V:function(){u.j.Ba.prototype.V.apply(this,arguments)}});u.j.zc=C;u.j.Element=C;var z=C.prototype;u.k.o(z,{type:z.type,add:z.add,clone:z.clone,writeHtml:z.aa,writeChildrenHtml:z.V})});
KISSY.Editor.add("htmlparser-filter",function(){function q(i){this.c={Wb:[],Qb:[],elements:{wc:0},attributes:{wc:0}};i&&this.Sc(i,10)}function C(i,e){for(var s=0;i&&s<e.length;s++){var D=e[s];i=i.replace(D[0],D[1])}return i}function u(i,e,s){if(typeof e=="function")e=[e];var D,r;r=i.length;var d=e&&e.length;if(d){for(D=0;D<r&&i[D].oc<s;D++);for(r=d-1;r>=0;r--)if(d=e[r]){d.oc=s;i.splice(D,0,d)}}}function K(i,e,s){if(e)for(var D in e){var r=i[D];i[D]=z(r,e[D],s);r||i.wc++}}function z(i,e,s){if(e){e.oc=
s;if(i){if(i.splice)u(i,e,s);else{i=i.oc>s?[e,i]:[i,e];i.filter=v}return i}else return e.filter=e}}function v(i){for(var e=i.type||i instanceof n.j.Ba,s=0;s<this.length;s++){if(e)var D=i.type,r=i.name;var d=this[s].apply(window,arguments);if(d===l)return d;if(e){if(d&&(d.name!=r||d.type!=D))return d}else if(typeof d!="string")return d;d!=undefined&&(i=d)}return i}var y=KISSY,n=y.Editor,g=n.n,l=V;y.augment(q,{Sc:function(i,e){if(typeof e!="number")e=10;u(this.c.Wb,i.Wb,e);u(this.c.Qb,i.Qb,e);K(this.c.elements,
i.elements,e);K(this.c.attributes,i.attributes,e);this.c.text=z(this.c.text,i.text,e)||this.c.text;this.c.O=z(this.c.O,i.O,e)||this.c.O;this.c.sb=z(this.c.sb,i.sb,e)||this.c.sb},wd:function(i){return C(i,this.c.Wb)},ud:function(i){return C(i,this.c.Qb)},na:function(i){var e=this.c.text;return e?e.filter(i):i},Ma:function(i,e){var s=this.c.O;return s?s.filter(i,e):i},xd:function(i){var e=this.c.sb;return e?e.filter(i):i},kc:function(i){for(var e=[this.c.elements["^"],this.c.elements[i.name],this.c.elements.bf],
s,D=0;D<3;D++)if(s=e[D]){s=s.filter(i,this);if(s===l)return U;if(s&&s!=i)return this.yd(s);if(i.parent&&!i.name)break}return i},yd:function(i){var e=i.type;return e==g.e?this.kc(i):e==g.f?new n.j.Eb(this.na(i.value)):U},sd:function(i,e,s){if(e=this.c.attributes[e]){i=e.filter(s,i,this);if(i===l)return l;if(typeof i!="undefined")return i}return s}});n.j.gf=q;y=q.prototype;n.k.o(y,{addRules:y.Sc,onElementName:y.wd,onAttributeName:y.ud,onText:y.na,onComment:y.Ma,onFragment:y.xd,onElement:y.kc,onNode:y.yd,
onAttribute:y.sd});n.j.Filter=q});KISSY.Editor.add("htmlparser-text",function(){function q(z){this.value=z;this.c={S:K}}var C=KISSY,u=C.Editor,K=V;C.augment(q,{type:u.n.f,aa:function(z,v){var y=this.value;v&&!(y=v.na(y,this))||z.text(y)}});u.j.Eb=q;u.j.Text=q});
KISSY.Editor.add("htmlparser-comment",function(){function q(K){this.value=K;this.c={S:V}}var C=KISSY.Editor,u=C.n;C.j.Kd=q;C.j.Comment=q;q.prototype={constructor:q,type:u.Md,aa:function(K,z){var v=this.value;if(z){if(!(v=z.Ma(v,this)))return;if(typeof v!="string"){v.parent=this.parent;v.aa(K,z);return}}K.O(v)}}});
