/*
 Constructor for kissy editor,dependency moved to independent module
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1.5
 @buildtime: 2010-12-17 17:33:46
*/
var T=true,U=null,X=false;
KISSY.add("editor",function(p){function x(w,t){var j=this;if(!(j instanceof x))return new x(w,t);if(p.isString(w))w=p.one(w);w=s.D(w);t=t||{};t.rf=t.pluginConfig||{};j.ta=t;t.pluginConfig=t.rf;j.cfg=t;p.app(j,p.EventTarget);var i=["htmldataprocessor","enterkey","clipboard"],f=A;j.use=function(g,e){g=g.split(",");if(!f)for(var n=0;n<i.length;n++){var B=i[n];p.inArray(B,g)||g.unshift(B)}j.ready(function(){p.use.call(j,g.join(","),function(){for(var k=0;k<g.length;k++)j.Rd(g[k]);e&&e.call(j);if(!f){j.setData(w.val());
if(t.focus)j.focus();else(k=j.getSelection())&&k.removeAllRanges();f=I}},{global:x})});return j};j.use=j.use;j.Config.base=x.Config.base;j.Config.componentJsName="plugin.js?t=2010-12-17 17:33:46";j.gf(w);return j}var s=p.DOM,I=T,A=X;p.app(x,p.EventTarget);x.Config.base=p.Config.base+"editor/plugins/";x.Config.componentJsName="plugin.js?t=2010-12-17 17:33:46";p.Editor=x;p.Editor=x});
KISSY.Editor.add("utils",function(p){var x=U,s=KISSY,I=s.Node,A=s.DOM,w=s.UA,t=s.Event,j;if(w.ie)j=document.documentMode||w.ie;var i={fd:function(f){f=s.Config.debug?f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-12-17 16:59:33");return f},zd:function(f,g,e){var n=f[g],B=f[e];f[g]=function(){n.apply(this,arguments);f[g]=f[e];return B.apply(this,arguments)}},cf:function(f,g,e,n){e=e.defaultView||e.parentWindow;f-=A.scrollLeft(e);g-=A.scrollTop(e);
if(n)if(e!=(n.defaultView||n.parentWindow)&&e.frameElement){n=A.Kb(e.frameElement,n);f+=n.left;g+=n.top}return{left:f,top:g}},Qd:function(){for(var f,g=0,e=arguments.length;g<e;g++){var n=arguments[g];try{f=n();break}catch(B){}}return f},Fe:function(f,g){if(!f&&!g)return T;if(!f||!g||f.length!=g.length)return X;for(var e=0;e<f.length;e++)if(f[e]!==g[e])return X;return T},md:function(f,g,e){f=f.documentElement;for(var n=0;f&&n<g.length;n++){var B=g[n];if(e)for(var k=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(e===T&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){k++;if(k==B){f=b;break}}}else f=f.childNodes[B]}return f?new I(f):x},Me:function(f){for(var g in f)f[g].Kc(f,T)},jc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ma:function(f){return f.replace(/^\s+/,"")},Oa:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ma(this.Oa(f))},mix:function(){for(var f={},g=0;g<arguments.length;g++)f=s.mix(f,arguments[g]);
return f},lb:function(){if(!w.ie)return X;var f=document.domain,g=window.location.hostname;return f!=g&&f!="["+g+"]"},Se:function(f,g){return Array(g+1).join(f)},Bf:function(f,g,e){e=e||150;if(e===-1)return function(){f.apply(g,arguments)};var n=(new Date).getTime();return function(){var B=(new Date).getTime();if(B-n>e){n=B;f.apply(g,arguments)}}},Ie:function(f,g,e){e=e||0;var n=x;return function(){n&&clearTimeout(n);var B=arguments;n=setTimeout(function(){return f.apply(g,B)},e)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(s.trim(f))},
Df:function(f){for(var g=0;g<f.length;g++){var e=A.D(f[g]),n=s.trim(e.val()),B=e.attr("data-verify");e=e.attr("data-warning");if(B&&!RegExp(B).test(n)){alert(e);return X}}return T},yf:function(f,g){f.on("sourcemode",g.gd,g);f.on("wysiwygmode",g.jd,g)},uf:function(f){var g=f.attr("placeholder");if(g&&!w.webkit){f.addClass("ke-input-tip");f.val(g)}else w.webkit&&f.val("")},Tg:function(f,g){f.removeClass("ke-input-tip");f.val(g)},qf:function(f,g){f.attr("placeholder",g);if(!w.webkit){f.on("blur",function(){if(!s.trim(f.val())){f.addClass("ke-input-tip");
f.val(g)}});f.on("focus",function(){f.removeClass("ke-input-tip");s.trim(f.val())==g&&f.val("")})}},Le:function(f){f=f[0]||f;for(var g=s.makeArray(f.childNodes),e=0;e<g.length;e++){var n=g[e];n.nodeType==p.n.f&&!s.trim(n.nodeValue)&&f.removeChild(n)}},ff:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ef:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},Ve:function(f,
g){return f.toLowerCase()==g.toLowerCase()},Ad:function(f){f=s.clone(f);for(var g in f)if(f.hasOwnProperty(g)){var e=f[g];if(s.isFunction(e))f[g]=e()}return f},Re:function(f,g,e){function n(){var C={responseText:"",responseXML:x};C.Ee=f?f.Ee:x;try{var r;if((r=w.ie?k.contentWindow.document:k.contentDocument||window.frames[B].document)&&r.body)C.responseText=r.body.innerHTML;C.responseXML=r&&r.XMLDocument?r.XMLDocument:r}catch(D){s.log(D)}t.remove(k,"load",n);f.Je&&f.Je(C);setTimeout(function(){A.h(k)},
100)}var B=s.guid("form-upload-"),k=document.createElement("iframe");k.id=B;k.name=B;k.className="ke-hidden";var a="document.open();"+(i.lb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(w.ie)k.src=w.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";s.log("doFormUpload : "+k.src);document.body.appendChild(k);if(w.ie)document.frames[B].name=B;a=A.Rc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=B;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(e)a.action=e;var d;if(g){d=[];g=p.k.Ad(g);for(var l in g)if(g.hasOwnProperty(l)){e=document.createElement("input");e.type="hidden";e.name=l;e.value=g[l];a.appendChild(e);d.push(e)}}t.on(k,"load",n);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(d){g=0;for(l=d.length;g<l;g++)A.h(d[g])}return k},o:function(f,g){for(var e in g)f[e]=g[e]},map:function(f,g){for(var e=0;e<f.length;e++)f[e]=
g(f[e]);return f},Ka:j,sf:function(f){w.ie?f.Ha():f.attr("onmousedown","return false;")},Gg:function(f){f=f.attributes;return f.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(f.src||"")}};p.k=i;p.Utils=i;w.Ka=i.Ka;i.o(i,{debugUrl:i.fd,lazyRun:i.zd,getXY:i.cf,tryThese:i.Qd,arrayCompare:i.Fe,getByAddress:i.md,clearAllMarkers:i.Me,htmlEncodeAttr:i.jc,ltrim:i.Ma,rtrim:i.Oa,trim:i.trim,mix:i.mix,isCustomDomain:i.lb,duplicateStr:i.Se,buffer:i.Ie,isNumber:i.isNumber,verifyInputs:i.Df,sourceDisable:i.yf,
resetInput:i.uf,placeholder:i.qf,clean:i.Le,htmlEncode:i.ff,htmlDecode:i.ef,equalsIgnoreCase:i.Ve,normParams:i.Ad,throttle:i.Bf,doFormUpload:i.Re,map:i.map})});
KISSY.Editor.add("dom",function(p){function x(a){if(a&&!a[0])return new j(a);return a}function s(a){return a[0]||a}function I(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var A=KISSY,w=A.DOM,t=A.UA,j=A.Node,i=p.k,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};p.n={e:1,f:3,Xd:8,Tf:11};p.NODE=p.n;p.Va={da:0,Zd:1,ca:2,Y:4,X:8,Fc:16};p.POSITION=
p.Va;var g=p.n,e=p.Va,n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},B={hr:1},k={D:x,Rc:s,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return X;a=s(a);b=s(b);return a===b},qa:function(a,b){a=x(a);var d=A.mix(A.mix({},B),b||{});return n[a.css("display")]||d[a.d()]},fa:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
X},v:function(a){a=s(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},ee:function(a,b){a=s(a);var d=a.firstChild;if((d=d&&new j(d))&&b&&!b(d))d=d.Fa(b);return d},Pc:function(a,b,d){a=s(a);w.h(a);b=s(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=s(a);var b=a.nodeName.toLowerCase();if(t.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Nc:function(a,b){if(a.d()!=b.d())return X;var d=a[0].attributes,l=b[0].attributes,C=d.length,
r=l.length;if(C!=r)return X;for(var D=0;D<C;D++){var m=d[D],v=m.name;if(m.specified&&a.attr(v)!=b.attr(v))return X}if(i.Ka<8)for(D=0;D<r;D++){m=l[D];v=m.name;if(m.specified&&a.attr(v)!=b.attr(v))return X}return T},Lb:function(a){a=s(a).childNodes;for(var b=0,d=a.length;b<d;b++){var l=a[b],C=l.nodeType;if(!(C==g.e&&l.getAttribute("_ke_bookmark")))if(C==g.e&&!k.Lb(l)||C==g.f&&A.trim(l.nodeValue))return X}return T},Mb:function(a,b,d){a=s(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},ra:function(){function a(b,d,l){if(d[0]&&d[0].nodeType==g.e){for(var C=[];d.attr("_ke_bookmark")||d.Lb();){C.push(d);d=l?new j(d[0].nextSibling):new j(d[0].previousSibling);if(!d[0]||d[0].nodeType!=g.e)return}if(b.Nc(d)){for(var r=l?b[0].lastChild:b[0].firstChild;C.length;)C.shift().Pc(b,!l);d.Mb(b,!l);d.h();r[0]&&r[0].nodeType==g.e&&r.ra()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new j(b[0].nextSibling),T);
a(b,new j(b[0].previousSibling))}}}(),Ha:t.gecko?function(a){a=s(a);a.style.MozUserSelect="none"}:t.webkit?function(a){a=s(a);a.style.Qf="none"}:function(a){a=s(a);if(t.ie||t.opera){var b=0;a.setAttribute("unselectable","on");for(var d=a.getElementsByTagName("*");a=d[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},Kb:function(a,b){a=s(a);var d,l=0;d=0;var C=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,
r=a.ownerDocument,D=r.documentElement;b=b||r;if(a.getBoundingClientRect){if(a!==r.body&&D!==a){d=a.getBoundingClientRect();l=d.left+(b===r?w.scrollLeft(C):0);d=d.top+(b===r?w.scrollTop(C):0)}if(b)if(C!=(b.defaultView||b.parentWindow)&&C.frameElement){C=k.Kb(C.frameElement,b);l+=C.left;d+=C.top}}return{left:l,top:d}},ge:function(a){return(a=s(a))&&a.contentWindow.document},ha:function(a,b){a=s(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=g.f)){if(t.ie&&b==a.nodeValue.length){var l=d.createTextNode("");
w.insertAfter(l,a);return new j(l)}l=new j(a.splitText(b));if(d.documentMode){d=d.createTextNode("");w.insertAfter(d,l[0]);w.h(d)}return l}},Nb:function(a,b){a=x(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=s(a);a=a.cloneNode(b);if(!d){var l=function(C){if(C.nodeType==g.e){C.removeAttribute("id");C=C.childNodes;for(var r=0;r<C.length;r++)l(C[r])}};l(a)}return new j(a)},w:function(a,b,d,l){a=s(a);if(l&&!l.call){var C=l[0]||l;l=function(D){D=D[0]||D;return D!==
C}}b=!b&&a.firstChild;var r=new j(a);if(!b){if(a.nodeType==g.e&&l&&l(a,T)===X)return U;b=a.nextSibling}for(;!b&&(r=r.parent());){if(l&&l(r,T)===X)return U;b=r[0].nextSibling}if(!b)return U;b=w.D(b);if(l&&l(b)===X)return U;if(d&&d!=b[0].nodeType)return b.w(X,d,l);return b},ga:function(a,b,d,l){a=s(a);if(l&&!l.call){var C=l[0]||l;l=function(D){D=D[0]||D;return D!==C}}b=!b&&a.lastChild;var r=new j(a);if(!b){if(a.nodeType==g.e&&l&&l(a,T)===X)return U;b=a.previousSibling}for(;!b&&(r=r.parent());){if(l&&
l(r,T)===X)return U;b=r[0].previousSibling}if(!b)return U;b=w.D(b);if(l&&l(b)===X)return U;if(d&&b[0].nodeType!=d)return b.ga(X,d,l);return b},Jb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=g.f&&b.contains(a))return b;var d=a[0].nodeType==g.f?a.parent():a;do if(d[0].nodeType!=g.f&&d.contains(b))return d;while(d=d.parent());return U},Jc:function(a,b,d){a=s(a);if(!d)a=a.parentNode;if(b&&!A.isFunction(b)){var l=b;b=function(C){return C.d()==l}}for(;a&&a.nodeType!=9;){if(!b||b(new j(a))===T)return new j(a);
a=a.parentNode}return U},Lc:i.Ka<9?function(a,b){a=s(a);var d=a.attributes[b];return!!(d&&d.specified)}:function(a,b){a=s(a);return a.hasAttribute(b)},$a:i.Ka<9?function(a){a=s(a);for(var b=a.attributes,d=0;d<b.length;d++){var l=b[d];switch(l.name){case "class":if(a.getAttribute("class"))return T;break;default:if(l.specified)return T}}return X}:function(a){a=s(a);t.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Ga:function(a,b){var d=s(a),l=s(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(l);
if(d==l)return e.da;if(d.nodeType==g.e&&l.nodeType==g.e){if(d.contains){if(d.contains(l))return e.Fc+e.Y;if(l.contains(d))return e.X+e.ca}if("sourceIndex"in d)return d.sourceIndex<0||l.sourceIndex<0?e.Zd:d.sourceIndex<l.sourceIndex?e.Y:e.ca}d=a.Ea();l=b.Ea();for(var C=Math.min(d.length,l.length),r=0;r<=C-1;r++)if(d[r]!=l[r]){if(r<C)return d[r]<l[r]?e.Y:e.ca;break}return d.length<l.length?e.Fc+e.Y:e.X+e.ca},Ea:function(a,b){a=s(a);for(var d=[],l=a.ownerDocument.documentElement,C=a;C&&C!=l;){var r=
C.parentNode,D=-1;if(r){for(var m=0;m<r.childNodes.length;m++){var v=r.childNodes[m];if(!(b&&v.nodeType==3&&v.previousSibling&&v.previousSibling.nodeType==3)){D++;if(v==C)break}}d.unshift(D)}C=r}return d},Ib:function(a,b){var d=new p.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var l=d.extractContents();d.insertNode(a.h());a[0].parentNode.insertBefore(l,a[0].nextSibling)},L:function(a,b,d){a=x(a);if(d!==undefined)return a.css(b,d);a=s(a);return a.style[I(b)]},h:function(a,b){var d=
s(a),l=d.parentNode;if(l){if(b)for(var C;C=d.firstChild;)l.insertBefore(d.removeChild(C),d);l.removeChild(d)}return a},bb:function(a){w.Oc(a);w.Qc(a)},Oc:function(a){a=s(a);for(var b;b=a.firstChild;){if(b.nodeType==g.f){var d=i.Ma(b.nodeValue),l=b.nodeValue.length;if(d){if(d.length<l){(new j(b)).ha(l-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Qc:function(a){a=s(a);for(var b;b=a.lastChild;){if(b.type==g.f){var d=i.Oa(b.nodeValue),l=b.nodeValue.length;if(d){if(d.length<
l){(new j(b)).ha(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!t.ie&&!t.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Hb:function(a){a=s(a);for(var b=a.lastChild;b&&b.nodeType==g.f&&!A.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==g.f||w.d(b)!=="br"){b=t.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");t.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},sa:function(a,
b){var d=s(a),l;do l=(d=d.previousSibling)&&new j(d);while(l&&b&&!b(l));return l},je:function(a,b){a=w.D(a);var d=a[0].lastChild;if((d=d&&new j(d))&&b&&!b(d))d=d.sa(b);return d},Fa:function(a,b){var d=s(a),l;do l=(d=d.nextSibling)&&new j(d);while(l&&b&&!b(l));return l},ab:function(a){a=s(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},ke:function(a,b,d,l){a=w.D(a);var C=a.data("list_marker_id")||
a.data("list_marker_id",A.guid()).data("list_marker_id"),r=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[C]=a;r[d]=1;return a.data(d,l)},Kc:function(a,b,d){a=x(a);var l=a.data("list_marker_names"),C=a.data("list_marker_id"),r;for(r in l)a.removeData(r);a.removeData("list_marker_names");if(d){a.removeData("list_marker_id");delete b[C]}},de:function(a,b,d){a=s(a);b=x(b);var l=a.attributes;d=d||{};for(var C=0;C<l.length;C++){var r=l[C],D=r.name.toLowerCase(),
m;if(!(D in d))if(D=="checked"&&(m=w.attr(a,D)))b.attr(D,m);else if(r.specified||t.ie&&r.value&&D=="value"){m=w.attr(a,D);if(m===U)m=r.nodeValue;b.attr(D,m)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Mc:function(a){a=w.d(a);var b=p.m;return(a=!b.Cc[a]&&(b[a]||b.span))&&a["#"]},Ob:function(a){a=x(a);var b=a[0].ownerDocument,d=w.scrollLeft(b),l=w.scrollTop(b),C=a.offset(),r=C.left;C=C.top;if(w.viewportHeight(b)+l<C||C<l||w.viewportWidth(b)+d<r||r<d)a.scrollIntoView(b)},fe:function(a,
b,d){a=s(a);if(!t.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new j(a[b]));return d}};A.DOM.he=function(a){A.mix(w,a);for(var b in a)a.hasOwnProperty(b)&&function(d){j.prototype[d]=function(){var l=[].slice.call(arguments,0);l.unshift(this);return a[d].apply(U,l)}}(b)};i.o(k,{_4e_wrap:k.D,_4e_unwrap:k.Rc,_4e_equals:k.g,_4e_isBlockBoundary:k.qa,_4e_getWin:k.fa,_4e_index:k.v,_4e_first:k.ee,_4e_move:k.Pc,_4e_name:k.d,_4e_isIdentical:k.Nc,_4e_isEmptyInlineRemoveable:k.Lb,
_4e_moveChildren:k.Mb,_4e_mergeSiblings:k.ra,_4e_unselectable:k.Ha,_4e_getOffset:k.Kb,_4e_getFrameDocument:k.ge,_4e_splitText:k.ha,_4e_parents:k.Nb,_4e_clone:k.K,_4e_nextSourceNode:k.w,_4e_previousSourceNode:k.ga,_4e_commonAncestor:k.Jb,_4e_ascendant:k.Jc,_4e_hasAttribute:k.Lc,_4e_hasAttributes:k.$a,_4e_position:k.Ga,_4e_address:k.Ea,_4e_breakParent:k.Ib,_4e_style:k.L,_4e_remove:k.h,_4e_trim:k.bb,_4e_ltrim:k.Oc,_4e_rtrim:k.Qc,_4e_appendBogus:k.Hb,_4e_last:k.je,_4e_previous:k.sa,_4e_next:k.Fa,_4e_outerHtml:k.ab,
_4e_setMarker:k.ke,_4e_clearMarkers:k.Kc,_4e_getUniqueId:k.cg,_4e_copyAttributes:k.de,_4e_isEditable:k.Mc,_4e_scrollIntoView:k.Ob,_4e_getElementsByTagName:k.fe});w.he(k)});
KISSY.Editor.add("focusmanager",function(p){function x(){this.kc=i;j=this}function s(){this.kc=f;j=g}var I=KISSY,A=I.DOM,w=I.Event,t={},j;I={Mg:function(){for(var e in t){var n=t[e];n.document.designMode="off";n.document.designMode="on"}},wg:function(){return j},Ze:function(e){return t[e]},add:function(e){var n=A.fa(e.document);w.on(n,"focus",x,e);w.on(n,"blur",s,e)},tf:function(e){t[e.Pb]=e},remove:function(e){delete t[e.Pb];var n=A.fa(e.document);w.remove(n,"focus",x,e);w.remove(n,"blur",s,e)}};
var i=T,f=X,g=U;p.We=I;p.focusManager=I;p.$e=function(){return t};p.getInstances=p.$e});
KISSY.Editor.add("definition",function(p){var x=T,s=X,I=p.k,A=document,w=KISSY,t=w.UA,j=w.DOM,i=w.Node,f=w.Event,g=p.We,e=I.Qd,n=I.fd("../theme/editor-iframe.css"),B=1,k="document.open();"+(I.lb()?'document.domain="'+A.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(t.ie?
"javascript:void(function(){"+encodeURIComponent(k)+"}())":"")+'"  tabIndex="'+(t.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";p.Hc=0;p.Za=1;p.SOURCE_MODE=p.Hc;p.WYSIWYG_MODE=p.Za;w.augment(p,{gf:function(b){if(t.ie)j.addClass(A.body,"ke-ie"+t.ie);else if(t.gecko)j.addClass(A.body,"ke-gecko");else t.webkit&&j.addClass(A.body,"ke-webkit");var d=this,l=new i(a.replace(/\$\(tabIndex\)/,b.attr("tabIndex")));d.Ag=
l;d.Pb=B++;g.tf(d);d.wb=l.one(".ke-textarea-wrap");d.wrap=d.wb;d.kb=d.wb.one("iframe");d.iframe=d.kb;d.Pd=l.one(".ke-editor-tools");d.toolBarDiv=d.Pd;d.$=b;d.textarea=d.$;d.Af=l.one(".ke-editor-status");d.statusDiv=d.Af;I.sf(d.Pd);d.Qb={};d.Sc={};var C=b.L("width"),r=b.L("height");if(C){l.css("width",C);b.css("width","100%")}d.$.css("display","none");l.insertAfter(b);d.wb[0].appendChild(b[0]);if(r){d.wb.css("height",r);b.css("height","100%")}l=d.kb;d.on("dataReady",function(){d.te=x;p.fire("instanceCreated",
{Te:d})});t.gecko?l.on("load",d.Yc,d):d.Yc();d.ta.attachForm&&b[0].form&&d.oe()},oe:function(){(new i(this.$[0].form)).on("submit",this.Od,this)},Cf:function(b,d){var l=this,C=p.Yd;C&&C.mc();l.use(b,function(){var r=l.nd(b);if(r){d(r);C&&C.Sg()}else w.later(arguments.callee,50,X,l)})},Ce:function(b,d){this.Sc[b]=d},nd:function(b){return this.Sc[b]},Ae:function(b,d){this.Qb[b]=d},df:function(b){return this.Qb[b]},execCommand:function(b){var d=this.Qb[b],l=w.makeArray(arguments);l.shift();l.unshift(this);
return d.exec.apply(d,l)},fc:function(){return this.$.css("display")=="none"?p.Za:p.Hc},getData:function(b){var d;d=this.fc()==p.Za?this.document.body.innerHTML:this.$.val();if(this.htmlDataProcessor)d=b?this.htmlDataProcessor.toHtml(d,"p"):this.htmlDataProcessor.toServer(d,"p");d=w.trim(d);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(d))d="";return d},setData:function(b){var d=b;if(this.htmlDataProcessor)d=this.htmlDataProcessor.toDataFormat(b,"p");this.document.body.innerHTML=d;this.fc()!=p.Za&&this.$.val(b)},
Od:function(){this.$.val(this.getData())},eg:function(){return this.document.body.innerHTML},ig:function(b){this.document.body.innerHTML=b},se:function(b){var d=this.ta,l=d.wa,C="";if(l)for(var r=0;r<l.length;r++)C+='<link href="'+l[r]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+p.Config.base+n+"' rel='stylesheet'/><style>"+(d.Zb||"")+"</style>"+C+"</head><body class='ke-editor'>&nbsp;"+(b?'<script id="ke_actscript" type="text/javascript">'+(I.lb()?
'document.domain="'+A.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':"")+"</body></html>"},getSelection:function(){return p.Ic.getSelection(this.document)},focus:function(){var b=this.document,d=j.fa(b);t.webkit&&d&&d.parent&&d.parent.focus();t.webkit&&d&&d.focus();b&&b.body.focus();this.pb()},blur:function(){j.fa(this.document).blur();this.document&&this.document.body.blur()},Be:function(b){var d=this.ta,l=this.document;d.Zb=d.Zb||"";d.Zb+="\n"+b;d=l.createElement("style");
l.getElementsByTagName("head")[0].appendChild(d);if(d.styleSheet)d.styleSheet.cssText=b;else d.appendChild(l.createTextNode(b))},og:function(b){var d=this.ta,l=this.document;d.wa=d.wa||[];d.wa.push(b);d=l.createElement("link");d.rel="stylesheet";l.getElementsByTagName("head")[0].appendChild(d);d.href=b},Ng:function(b){for(var d=this.ta,l=w.makeArray(this.document.getElementsByTagName("link")),C=0;C<l.length;C++)l[C].href==b&&j.h(l[C]);d.wa=d.wa||[];d=d.wa;b=w.indexOf(b,d);b!=-1&&d.splice(b,1)},Yc:function(){function b(){D=
r.document;d.document=D;l.detach();D.open("text/html","replace");D.write(C);D.close()}var d=this,l=d.kb,C=d.se(d.Pb),r=l[0].contentWindow,D;try{D=r.document}catch(m){l[0].src=l[0].src;if(t.ie<7){setTimeout(b,10);return}}b()},ready:function(b){this.te?b():this.on("dataReady",b)},pg:function(b,d,l){this.cb=this.cb||[];l=l||{};l.Ye=d;this.cb[b]=l},Rd:function(b){if(this.cb){var d=this.cb[b];if(d)if(!(d.status&&!d.duplicate)){b=this.Env.mods[b].requires||[];for(var l=0;l<b.length;l++)this.Rd(b[l]);d.Ye.call(this);
d.status=1}}},db:function(){var b=this;b.Wc&&clearTimeout(b.Wc);b.Wc=setTimeout(function(){var d=b.getSelection();if(d&&!d.wd){var l=d.ib(),C=new p.Ua(l);if(!b.rc||!b.rc.cd(C)){b.rc=C;b.fire("selectionChange",{selection:d,path:C,element:l})}}},100)},pb:function(){this.rc=U;this.db()},vd:function(b,d,l){var C=this;C.focus();setTimeout(function(){var r,D=b.d(),m=p.m,v=p.oa,J=p.n,y=m.Sa[D],c=C.getSelection(),h=c&&c.A(),o,u,q,z;if(!h||h.length==0){var O=arguments,P=O.callee;setTimeout(function(){P.apply(C,
O)},30)}else{C.fire("save");for(var L=h.length-1;L>=0;L--){o=h[L];o.deleteContents();r=!L&&b||b.K(x);d&&d(r);if(y)for(;(q=o.xa(s,x))&&(z=m[q.d()])&&!(z&&z[D]);)if(q.d()in m.span)o.wc(q);else if(o.ua()&&o.ja()){o.setStartBefore(q);o.collapse(x);q.h()}else o.vc();o.insertNode(r);u||(u=r)}if(u){D=u.w(x);m=C.document;z=p.m;if(z.Ac[r.d()]){D=new i(m.createTextNode(" "));D.insertAfter(u)}else if(D){if(D.d()=="br"&&z[D.parent().d()].p){z=new i("<p>&nbsp;</p>",U,m);D[0].parentNode.replaceChild(z[0],D[0]);
D=z}}else{z=new i("<p>&nbsp;</p>",U,m);z.insertAfter(u);D=z}o.H(u,v.t);D&&D[0].nodeType==J.e&&o.nb(D);c.vb([o]);C.focus();r&&r.Ob();setTimeout(function(){C.fire("save")},10);l&&l(r)}}},0)},hf:function(b){var d=this;if(d.htmlDataProcessor)b=d.htmlDataProcessor.toDataFormat(b);if(t.webkit){var l=j.create(b,U,d.document);l=l.nodeType==11?w.makeArray(l.childNodes):[l];for(var C=0;C<l.length;C++)d.vd(new i(l[C]))}else{d.focus();setTimeout(function(){var r=d.getSelection(),D=r&&r.A();if(!D||D.length==0){var m=
arguments,v=m.callee;setTimeout(function(){v.apply(d,m)},30)}else{d.fire("save");if(t.ie){r=r.r();r.type=="Control"&&r.clear();r.createRange().pasteHTML(b)}else d.document.execCommand("inserthtml",s,b);setTimeout(function(){d.fire("save")},10)}},0)}}});p._initIFrame=function(b){function d(c){e(function(){r.designMode="on";setTimeout(function(){r.designMode="off";m.focus();if(!arguments.callee.vf)arguments.callee.vf=x},50)},function(){r.designMode="off";j.attr(m,"contentEditable",s);j.attr(m,"contentEditable",
x);!c&&d(1)})}var l=g.Ze(b);b=l.$[0];var C=l.kb[0].contentWindow,r=l.document,D=l.ta;j.h(r.getElementById("ke_actscript"));var m=r.body;if(t.ie){m.hideFocus=x;m.disabled=x;m.contentEditable=x;m.removeAttribute("disabled")}else setTimeout(function(){if(t.gecko||t.opera)m.contentEditable=x;else if(t.webkit)m.parentNode.contentEditable=x;else r.designMode="on"},0);if(t.webkit){f.on(r,"click",function(c){var h=new i(c.target);w.inArray(h.d(),["input","select"])&&c.preventDefault()});f.on(r,"mouseup",
function(c){var h=new i(c.target);w.inArray(h.d(),["input","textarea"])&&c.preventDefault()})}if(t.gecko||t.ie||t.opera){var v;v=new i(j.insertAfter((new i('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],b));v.on("focus",function(){l.focus()});l.ng=function(){t.gecko&&l.kc&&v[0].focus()};l.on("destroy",function(){})}if(t.ie&&r.compatMode=="CSS1Compat"||t.gecko||t.opera){var J=new i(r.documentElement);J.on("mousedown",function(c){if((new i(c.target))[0]==
J[0]){t.gecko&&d(s);v[0].focus()}})}f.on(C,"focus",function(){if(t.gecko)d(s);else t.opera&&m.focus();l.pb()});t.gecko&&f.on(l.document,"mousedown",function(){l.kc||d(s)});if(t.ie){f.on(r,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var h=l.getSelection(),o=h.gc();if(o){l.fire("save");var u=h.A()[0].O();o.h();h.Kd([u]);l.fire("save");c.preventDefault()}}});if(r.compatMode=="CSS1Compat"){var y={33:1,34:1};f.on(r,"keydown",function(c){c.keyCode in y&&setTimeout(function(){l.getSelection().scrollIntoView()},
0)})}}setTimeout(function(){t.ie&&setTimeout(function(){if(r){m.runtimeStyle.marginBottom="0px";m.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){l.fire("dataReady");var c=D.disableObjectResizing,h=D.disableInlineTableEditing;if(c||h)try{r.execCommand("enableObjectResizing",s,!c);r.execCommand("enableInlineTableEditing",s,!h)}catch(o){f.on(m,t.ie?"resizestart":"resize",function(u){var q=new i(u.target);if(c||q.d()==="table"&&h)u.preventDefault()})}},10);t.webkit&&f.on(r,"mousedown",
function(c){c=new i(c.target);w.inArray(c.d(),["img","hr","input","textarea","select"])&&l.getSelection().uc(c)});t.gecko&&f.on(r,"dragstart",function(c){var h=new i(c.target);h.d()==="img"&&/ke_/.test(h[0].className)&&c.preventDefault()});g.add(l)};k=p.prototype;I.o(k,{setData:k.setData,getData:k.getData,insertElement:k.vd,insertHtml:k.hf,ready:k.ready,addCustomStyle:k.Be,addCommand:k.Ae,hasCommand:k.df,execCommand:k.execCommand,useDialog:k.Cf,addDialog:k.Ce,getDialog:k.nd,getMode:k.fc,sync:k.Od,
getSelection:k.getSelection,focus:k.focus,blur:k.blur,notifySelectionChange:k.pb})});KISSY.Editor.add("zindex",function(){var p=KISSY.Editor;if(!p.xc){p.xc={Jf:1100,Zf:1200,Lf:99999,Sf:900,Yf:9999,LOADING:11E3,Rf:12E3,$d:1200};p.Ub=function(x){return(p.Kf.Ub||1E4)+x};p.baseZIndex=p.Ub;p.zIndexManager=p.xc}});
KISSY.Editor.add("dtd",function(p){p.m=function(){function x(D){for(var m=arguments.length-1;m>0;)KISSY.mix(D,arguments[m--]);return D}var s={isindex:1,fieldset:1},I={input:1,button:1,select:1,textarea:1,label:1},A=x({a:1},I),w=x({iframe:1},A),t={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},i=x({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),f=x({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),g=x({p:1},f);I=x({iframe:1},f,I);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=x({a:1},I),n={tr:1},B={"#":1},k=x({param:1},f),a=x({form:1},s,w,t,g),b={li:1},d={base:1,link:1,meta:1,title:1},l=x(d,{style:1,script:1}),C={head:1,body:1},r={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{zb:x({html:1},C,d),Sa:r,Hf:{body:1,div:1,td:1,th:1,caption:1,
form:1},Ac:e,yc:x({script:1,style:1},r),zc:{script:1,style:1},xb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},yb:{dd:1,dt:1,li:1},Sd:{ul:1,ol:1,dl:1},Cc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},ba:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},If:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},Dc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:C,head:l,style:B,body:a,base:{},link:{},meta:{},title:B,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:x(g,t),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:b,h1:e,h3:e,option:B,h2:e,form:x(s,w,t,g),select:{optgroup:1,option:1},font:e,ins:e,menu:b,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:B,tfoot:n,cite:e,li:a,input:{},iframe:a,
strong:e,textarea:B,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:k,sup:e,dd:a,strike:e,area:{},dir:b,map:x({area:1,form:1,p:1},s,j,t),applet:k,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:x({Hg:1},f),thead:n,ul:b,acronym:e,b:e,a:I,blockquote:a,caption:e,i:e,u:e,tbody:n,s:e,address:x(w,g),tt:e,legend:e,q:e,pre:x(i,A),p:e,em:e,dfn:e}}();p.XHTML_DTD=p.m});
KISSY.Editor.add("elementpath",function(p){function x(f){var g=w,e=w,n=[];for(f=f;f&&f[0];){if(f[0].nodeType==A.e){if(!this.mf)this.mf=f;var B=f.d();if(!e){if(!g&&t[B])g=f;if(j[B]){var k;if(k=!g){if(k=B=="div"){a:{k=f;k=k[0]||k;k=k.childNodes;for(var a=0,b=k.length;a<b;a++){var d=k[a];if(d.nodeType==A.e&&I.Sa[d.nodeName.toLowerCase()]){k=T;break a}}k=X}k=!k}k=k}if(k)g=f;else e=f}}n.push(f);if(B=="body")break}f=f.parent()}this.block=this.z=g;this.blockLimit=this.F=e;this.elements=this.elements=n}var s=
KISSY.DOM,I=p.m,A=p.n,w=U,t={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};x.prototype={cd:function(f){var g=this.elements;f=f&&f.elements;if(!f||g.length!=f.length)return X;for(var e=0;e<g.length;e++)if(!s.g(g[e],f[e]))return X;return T},contains:function(f){for(var g=this.elements,e=0;e<g.length;e++)if(g[e].d()in f)return g[e];return w}};p.ElementPath=p.Ua=x;var i=x.prototype;p.k.o(i,{compare:i.cd,
contains:i.contains})});
KISSY.Editor.add("walker",function(p){function x(n,B){if(this.c.end)return t;var k,a=this.za,b,d=this.hc,l=this.type,C=n?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return t}}if(!n&&!this.c.qd){var r=a.endContainer,D=new g(r[0].childNodes[a.endOffset]);this.c.qd=function(y,c){return(y=f.D(y))&&y[0]&&(!c||!f.g(r,y))&&(!D[0]||!y.g(D))&&(y[0].nodeType!=i.e||!c||y.d()!="body")}}if(n&&!this.c.rd){var m=a.startContainer,v=a.startOffset>
0&&new g(m[0].childNodes[a.startOffset-1]);this.c.rd=function(y,c){return(y=f.D(y))&&y[0]&&(!c||!y.g(m))&&(!v[0]||!y.g(v))&&(y[0].nodeType!=i.e||!c||y.d()!="body")}}var J=n?this.c.rd:this.c.qd;b=d?function(y,c){if(J(y,c)===w)return w;return d(y,c)}:J;if(this.gb)k=this.gb[C](w,l,b);else if(n){k=a.endContainer;if(a.endOffset>0){k=new g(k[0].childNodes[a.endOffset-1]);if(b(k)===w)k=t}else k=b(k,A)===w?t:k.ga(A,l,b)}else{k=a.startContainer;if((k=new g(k[0].childNodes[a.startOffset]))&&k[0]){if(b(k)===
w)k=t}else k=b(a.startContainer,A)===w?t:a.startContainer.w(A,l,b)}for(;k&&k[0]&&!this.c.end;){this.gb=k;if(!this.Q||this.Q(k)!==w){if(!B)return k}else if(B&&this.Q)return w;k=k[C](w,l,b)}this.end();return this.gb=t}function s(n){for(var B,k=t;B=x.call(this,n);)k=B;return k}function I(n){this.za=n;this.c={}}var A=T,w=X,t=U,j=KISSY,i=p.n,f=j.DOM,g=j.Node;j.augment(I,{end:function(){this.c.end=1},next:function(){return x.call(this)},sb:function(){return x.call(this,A)},bd:function(){return x.call(this,
w,A)!==w},ad:function(){return x.call(this,A,A)!==w},yd:function(){return s.call(this)},xd:function(){return s.call(this,A)},reset:function(){delete this.gb;this.c={}}});I.Vb=function(n){return function(B){B=f.D(B);return!(B&&B[0].nodeType==i.e&&B.qa(n))}};I.of=function(){return this.Vb({Wb:1})};I.Ia=function(n,B){function k(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,d;b=a&&a[0]&&a[0].nodeType==i.f&&(d=a.parent())&&k(d);b=n?b:b||k(a);return B^b}};I.Ra=function(n){return function(B){B=
(B=B[0]||B)&&B.nodeType==i.f&&!j.trim(B.nodeValue);return n^B}};I.jf=function(n){var B=I.Ra();return function(k){k=B(k)||k[0].nodeType==i.e&&!k[0].offsetHeight;return n^k}};p.Da=I;p.Walker=I;var e=I.prototype;p.k.o(e,{end:e.end,next:e.next,previous:e.sb,checkForward:e.bd,checkBackward:e.ad,lastForward:e.yd,lastBackward:e.xd,reset:e.reset});p.k.o(I,{blockBoundary:I.Vb,listItemBoundary:I.of,bookmark:I.Ia,whitespaces:I.Ra,invisible:I.jf})});
KISSY.Editor.add("range",function(p){function x(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=j;this.document=c}function s(c){var h=c[0].nodeType!=e.f&&c.d()in l.ba,o=!g.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||o||c}function I(c){return!v(c)&&!J(c)}function A(c){var h=i,o=k.Ia(j);return function(u){if(o(u))return j;if(u[0].nodeType==e.f){if(g.trim(u[0].nodeValue).length)return i}else if(u[0].nodeType==e.e)if(!m[u.d()])if(!c&&!d.ie&&
u.d()=="br"&&!h)h=j;else return i;return j}}function w(c,h){function o(u){return u&&u.nodeName=="span"&&u.getAttribute("_ke_bookmark")}return function(u){var q,z;q=u&&!u.nodeName&&(z=u.parentNode)&&o(z);q=c?q:q||o(u);return h^q}}function t(c){return function(h){h=(h=h[0]||h)&&h.nodeType==e.f&&!g.trim(h.nodeValue);return c^h}}p.oa={W:1,J:2,C:3,t:4,Cb:1,Bb:2,Ta:3,Xa:1,Wd:2,$f:3,ea:1,Gc:2};p.RANGE=p.oa;var j=T,i=X,f=U,g=KISSY,e=p.n,n=p.oa,B=p.Va,k=p.Da,a=g.DOM,b=p.k.md,d=g.UA,l=p.m,C=p.Ua,r=g.Node,D=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};x.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};g.augment(x,{Qa:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},pc:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},qc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.U(c,n.C);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.T(h,n.t)},setStart:function(c,h){if(c[0].nodeType==e.e&&D[c.d()]){c=c.parent();h=c.v()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Qa()},setEnd:function(c,h){if(c[0].nodeType==e.e&&D[c.d()]){c=c.parent();h=c.v()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Qa()},U:function(c,h){switch(h){case n.W:this.setStart(c,0);break;case n.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case n.C:this.setStartBefore(c);break;case n.t:this.setStartAfter(c)}this.Qa()},T:function(c,h){switch(h){case n.W:this.setEnd(c,0);break;case n.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case n.C:this.setEndBefore(c);break;case n.t:this.setEndAfter(c)}this.Qa()},
bc:function(c,h){var o=this.startContainer,u=this.endContainer,q=this.startOffset,z=this.endOffset,O,P=this.document,L;this.qc();if(u[0].nodeType==e.f)u=u.ha(z);else if(u[0].childNodes.length>0)if(z>=u[0].childNodes.length){u=new r(u[0].appendChild(P.createTextNode("")));L=j}else u=new r(u[0].childNodes[z]);if(o[0].nodeType==e.f){o.ha(q);if(o.g(u))u=new r(o[0].nextSibling)}else if(q)if(q>=o[0].childNodes.length){O=new r(P.createTextNode(""));o.append(O);o=O;O=j}else o=new r(o[0].childNodes[q].previousSibling);
else{O=new r(P.createTextNode(""));o.prepend(O);o=O;O=j}q=o.Nb();z=u.Nb();var Q,S,W;for(Q=0;Q<q.length;Q++){S=q[Q];W=z[Q];if(!S.g(W))break}P=h;for(var V,Y,E,K=Q;K<q.length;K++){V=q[K];Y=P&&!V.g(o)?P.appendChild(V.K()[0]):U;for(V=V[0].nextSibling;V;){if(a.g(z[K],V)||a.g(u,V))break;E=V.nextSibling;if(c==2)P.appendChild(V.cloneNode(j));else{a.h(V);c==1&&P.appendChild(V)}V=E}if(Y)P=Y}P=h;for(Q=Q;Q<z.length;Q++){V=z[Q];Y=P&&c>0&&!V.g(u)?P.appendChild(V.K()[0]):U;if(!q[Q]||!V.parent().g(q[Q].parent()))for(V=
V[0].previousSibling;V;){if(a.g(q[Q],V)||a.g(o,V))break;E=V.previousSibling;if(c==2)P.insertBefore(V.cloneNode(j),P.firstChild);else{a.h(V);c==1&&P.insertBefore(V,P.firstChild)}V=E}if(Y)P=Y}if(c==2){W=this.startContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}W=this.endContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}}else{if(S&&
W&&(!o.parent().g(S.parent())||!u.parent().g(W.parent()))){S=W.v();O&&W.parent().g(o.parent())&&S--;this.setStart(W.parent(),S)}this.collapse(j)}O&&o.h();L&&u[0].parentNode&&u.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=j},clone:function(){var c=new x(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},od:function(){var c=this.clone();c.pc();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return f;var h=new p.Da(c),o=w(j,undefined),u=t(j);c.Q=function(q){return u(q)&&o(q)};c=h.next();h.reset();h=h.sb();return c&&c.g(h)?c:f},Pa:function(c,h){if(!this.collapsed){c=c||n.Gc;var o=this.clone(),u=this.startContainer,q=this.endContainer,z=this.startOffset,O=this.endOffset,P=1,L=1;if(u&&u[0].nodeType==e.f)if(z)if(z>=u[0].nodeValue.length)o.setStartAfter(u);
else{o.setStartBefore(u);P=0}else o.setStartBefore(u);if(q&&q[0].nodeType==e.f)if(O)if(O>=q[0].nodeValue.length)o.setEndAfter(q);else{o.setEndAfter(q);L=0}else o.setEndBefore(q);o=new k(o);o.Q=function(S){S=S[0]||S;return S.nodeType==(c==n.ea?e.e:e.f)};var Q;o.hc=function(S,W){S=S[0]||S;if(c==n.ea&&S.nodeType==e.f)return i;if(W&&S==Q)return i;if(!W&&S.nodeType==e.e)Q=S;return j};if(P)(u=o[c==n.ea?"lastForward":"next"]())&&this.U(u,h?n.W:n.C);if(L){o.reset();(o=o[c==n.ea?"lastBackward":"previous"]())&&
this.T(o,h?n.J:n.t)}return!!(P||L)}},bf:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},ed:function(c){var h=this.startContainer,o=this.endContainer,u=this.startOffset,q=this.endOffset,z,O;if(!h||!o)return{start:0,end:0};if(c){if(h[0].nodeType==e.e)if((z=new r(h[0].childNodes[u]))&&z[0]&&z[0].nodeType==e.f&&u>0&&z[0].previousSibling.nodeType==e.f){h=z;u=0}for(;h[0].nodeType==e.f&&(O=h.sa())&&O[0].nodeType==e.f;){h=O;u+=
O[0].nodeValue.length}if(!this.collapsed){if(o[0].nodeType==e.e)if((z=new r(o[0].childNodes[q]))&&z[0]&&z[0].nodeType==e.f&&q>0&&z[0].previousSibling.nodeType==e.f){o=z;q=0}for(;o[0].nodeType==e.f&&(O=o.sa())&&O[0].nodeType==e.f;){o=O;q+=O[0].nodeValue.length}}}return{start:h.Ea(c),end:this.collapsed?f:o.Ea(c),startOffset:u,endOffset:q,Bd:c,kf:j}},O:function(c){var h,o,u,q,z=this.collapsed;h=new r("<span>",f,this.document);h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){u=
g.guid("ke_bm_");h.attr("id",u+"S")}if(!z){o=h.K();o.html("&nbsp;");c&&o.attr("id",u+"E");q=this.clone();q.collapse();q.insertNode(o)}q=this.clone();q.collapse(j);q.insertNode(h);if(o){this.setStartAfter(h);this.setEndBefore(o)}else this.H(h,n.t);return{Z:c?u+"S":h,P:c?u+"E":o,Md:c,collapsed:z}},H:function(c,h){this.U(c,h);this.collapse(j)},trim:function(c,h){var o=this.startContainer,u=this.startOffset,q=this.collapsed;if((!c||q)&&o[0]&&o[0].nodeType==e.f){if(u)if(u>=o[0].nodeValue.length){u=o.v()+
1;o=o.parent()}else{var z=o.ha(u);u=o.v()+1;o=o.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(z,this.endOffset-this.startOffset);else if(a.g(o,this.endContainer))this.endOffset+=1}else{u=o.v();o=o.parent()}this.setStart(o,u);if(q){this.collapse(j);return}}o=this.endContainer;u=this.endOffset;if(!(h||q)&&o[0]&&o[0].nodeType==e.f){if(u){u>=o.nodeValue.length||o.ha(u);u=o.v()+1}else u=o.v();o=o.parent();this.setEnd(o,u)}},insertNode:function(c){this.qc();this.trim(i,j);var h=this.startContainer;
h[0].insertBefore(c[0]||c,h[0].childNodes[this.startOffset]||U);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.kf){var h=b(this.document,c.start,c.Bd),o=c.startOffset,u=c.end&&b(this.document,c.end,c.Bd);c=c.endOffset;this.setStart(h,o);u?this.setEnd(u,c):this.collapse(j)}else{h=(o=c.Md)?g.one("#"+c.Z,this.document):c.Z;c=o?g.one("#"+c.P,this.document):c.P;this.setStartBefore(h);h.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(j)}},
xa:function(c,h){var o=this.startContainer,u=this.endContainer;o=a.g(o,u)?c&&o[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new r(o[0].childNodes[this.startOffset]):o:o.Jb(u);return h&&o[0].nodeType==e.f?o.parent():o},Ja:function(c){switch(c){case n.Cb:if(this.collapsed)break;c=this.xa();var h=new r(this.document.body),o,u,q,z,O,P=i,L,Q;L=this.startContainer;Q=this.startOffset;if(L[0].nodeType==e.f){if(Q){L=!g.trim(L[0].nodeValue.substring(0,Q)).length&&L;P=!!L}if(L)if(!(z=L[0].previousSibling))q=
L.parent()}else{if(Q)z=L[0].childNodes[Q-1]||L[0].lastChild;z||(q=L)}for(;q||z;){if(q&&!z){if(!O&&a.g(q,c))O=j;if(!h.contains(q))break;if(!P||q.css("display")!="inline"){P=i;if(O)o=q;else this.setStartBefore(q)}z=q[0].previousSibling}for(;z;){L=i;if(z.nodeType==e.f){Q=z.nodeValue;if(/[^\s\ufeff]/.test(Q))z=f;L=/[\s\ufeff]$/.test(Q)}else if(z.offsetWidth>0&&!z.getAttribute("_ke_bookmark"))if(P&&l.ba[z.nodeName.toLowerCase()]){Q=a.text(z);if(/[^\s\ufeff]/.test(Q))z=f;else for(var S=z.all||z.getElementsByTagName("*"),
W=0,V;V=S[W++];)if(!l.ba[V.nodeName.toLowerCase()]){z=f;break}if(z)L=!!Q.length}else z=f;if(L)if(P)if(O)o=q;else q&&this.setStartBefore(q);else P=j;if(z){L=z.previousSibling;if(!q&&!L){q=new r(z);z=f;break}z=L}else q=f}if(q)q=q.parent()}L=this.endContainer;Q=this.endOffset;q=z=f;O=P=i;if(L[0].nodeType==e.f){L=!g.trim(L[0].nodeValue.substring(Q)).length&&L;P=!(L&&L[0].nodeValue.length);if(L)if(!(z=L[0].nextSibling))q=L.parent()}else(z=L[0].childNodes[Q])||(q=L);for(;q||z;){if(q&&!z){if(!O&&a.g(q,c))O=
j;if(!h.contains(q))break;if(!P||q.css("display")!="inline"){P=i;if(O)u=q;else q&&this.setEndAfter(q)}z=q[0].nextSibling}for(;z;){L=i;if(z.nodeType==e.f){Q=z.nodeValue;if(/[^\s\ufeff]/.test(Q))z=f;L=/^[\s\ufeff]/.test(Q)}else if(z.offsetWidth>0&&!z.getAttribute("_ke_bookmark"))if(P&&l.ba[z.nodeName.toLowerCase()]){Q=a.text(z);if(/[^\s\ufeff]/.test(Q))z=f;else{S=z.all||z.getElementsByTagName("*");for(W=0;V=S[W++];)if(!l.ba[V.nodeName.toLowerCase()]){z=f;break}}if(z)L=!!Q.length}else z=f;if(L)if(P)if(O)u=
q;else this.setEndAfter(q);if(z){L=z.nextSibling;if(!q&&!L){q=new r(z);z=f;break}z=L}else q=f}if(q)q=q.parent()}if(o&&u){c=o.contains(u)?u:o;this.setStartBefore(c);this.setEndAfter(c)}break;case n.Bb:case n.Ta:q=new x(this.document);h=new r(this.document.body);q.U(h,n.W);q.setEnd(this.startContainer,this.startOffset);q=new k(q);var Y,E,K=k.Vb(c==n.Ta?{Wb:1}:f),G=function(F){var H=K(F);H||(Y=F);return H};o=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")E=F;return H};q.hc=G;q=q.xd();Y=Y||h;this.U(Y,
Y.d()!="br"&&(!q&&this.ua()||q&&Y.contains(q))?n.W:n.t);q=this.clone();q.collapse();q.T(h,n.J);q=new k(q);q.hc=c==n.Ta?o:G;Y=f;q=q.yd();Y=Y||h;this.T(Y,!q&&this.ja()||q&&Y.contains(q)?n.J:n.C);E&&this.setEndAfter(E)}},ua:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(0,h)).length)return i;this.trim();c=new C(this.startContainer);h=this.clone();h.collapse(j);h.U(c.z||c.F,n.W);c=new k(h);c.Q=A(j);return c.ad()},ja:function(){var c=
this.endContainer,h=this.endOffset;if(c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(h)).length)return i;this.trim();c=new C(this.endContainer);h=this.clone();h.collapse(i);h.T(c.z||c.F,n.J);c=new k(h);c.Q=A(i);return c.bd()},deleteContents:function(){this.collapsed||this.bc(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.bc(1,c);return c},Yb:function(c,h){var o=this.clone();o[h==n.Xa?"setStartAt":"setEndAt"](c,h==n.Xa?n.W:n.J);o=new k(o);o.Q=
s;return o[h==n.Xa?"checkBackward":"checkForward"]()},ld:function(){var c=this.startContainer,h=this.endContainer,o=this.startOffset,u=this.endOffset,q;if(c[0].nodeType==e.e){q=c[0].childNodes.length;if(q>o)c=new r(c[0].childNodes[o]);else if(q<1)c=c.ga();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new r(c);c=c.w()||c}}if(h[0].nodeType==e.e){q=h[0].childNodes.length;if(q>u)h=(new r(h[0].childNodes[u])).ga(j);else if(q<1)h=h.ga();else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new r(h)}}if(c.Ga(h)&B.ca)c=
h;return{Z:c,P:h}},hb:function(c,h){var o=this.O(),u=new r(this.document.createElement(h));this.collapse(c);this.Ja(n.Bb);u[0].appendChild(this.extractContents());u.bb();d.ie||u.Hb();this.insertNode(u);this.moveToBookmark(o);return u},vc:function(c){var h=new C(this.startContainer),o=new C(this.endContainer),u=h.z,q=o.z,z=f;if(!h.F.g(o.F))return f;if(c!="br"){if(!u){u=this.hb(j,c);q=(new C(this.endContainer)).z}q||(q=this.hb(i,c))}c=u&&this.ua();h=q&&this.ja();this.deleteContents();if(u&&a.g(u,q))if(h){z=
new C(this.startContainer);this.H(q,n.t);q=f}else if(c){z=new C(this.startContainer);this.H(u,n.C);u=f}else{q=this.wc(u);!d.ie&&!g.inArray(u.d(),["ul","ol"])&&u.Hb()}return{Lg:u,Jg:q,Ff:c,Ef:h,Dg:z}},wc:function(c){if(!this.collapsed)return f;this.T(c,n.J);var h=this.extractContents(),o=c.K(i);o[0].appendChild(h);o.insertAfter(c);this.H(c,n.t);return o},nb:function(c,h){var o,u=p.m;if(u.xb[c.d()])return i;for(;c&&c[0].nodeType==e.e;){if(o=c.Mc())this.H(c,h?n.J:n.W);else if(u.Ac[c.d()]){this.H(c,h?
n.t:n.C);return j}if((c=u.xb[c.d()]?c[h?"_4e_previous":"_4e_next"](I):c[h?"_4e_last":"_4e_first"](I))&&c[0].nodeType==e.f){this.H(c,h?n.t:n.C);return j}}return o},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var m={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},v=new k.Ra,J=new k.Ia;p.Range=
x;p.Range=x;var y=x.prototype;p.k.o(y,{updateCollapsed:y.Qa,optimize:y.pc,setStartAfter:y.setStartAfter,setEndAfter:y.setEndAfter,setStartBefore:y.setStartBefore,setEndBefore:y.setEndBefore,optimizeBookmark:y.qc,setStart:y.setStart,setEnd:y.setEnd,setStartAt:y.U,setEndAt:y.T,execContentsAction:y.bc,collapse:y.collapse,clone:y.clone,getEnclosedNode:y.od,shrink:y.Pa,getTouchedStartNode:y.bf,createBookmark2:y.ed,createBookmark:y.O,moveToPosition:y.H,trim:y.trim,insertNode:y.insertNode,moveToBookmark:y.moveToBookmark,
getCommonAncestor:y.xa,enlarge:y.Ja,checkStartOfBlock:y.ua,checkEndOfBlock:y.ja,deleteContents:y.deleteContents,extractContents:y.extractContents,checkBoundaryOfElement:y.Yb,getBoundaryNodes:y.ld,fixBlock:y.hb,splitBlock:y.vc,splitElement:y.wc,moveToElementEditablePosition:y.nb,selectNodeContents:y.selectNodeContents})});
KISSY.Editor.add("domiterator",function(p){function x(k){if(!(arguments.length<1)){this.za=k;this.dc=I;this.kd=s;this.ac=I;this.c||(this.c={})}}var s=T,I=X,A=KISSY,w=A.UA,t=p.Da,j=p.Range,i=p.oa,f=p.n,g=p.Ua,e=A.Node,n=A.DOM,B=/^[\r\n\t ]*$/;A.augment(x,{af:function(k){var a,b,d,l,C;if(!this.c.I){b=this.za.clone();b.Pa(i.ea,s);b.Ja(this.dc||!this.kd?i.Ta:i.Bb);var r=new t(b),D=t.Ia(s,s);r.Q=D;this.c.la=r.next();r=new t(b);r.Q=D;r=r.sb();this.c.I=r.w(s);if(this.c.I&&this.c.I[0].nodeType==f.f&&!A.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().qa()){D=new j(b.document);D.H(this.c.I,i.t);if(D.ja()){D=new g(D.endContainer);this.c.I=(D.z||D.F).w(s)}}if(!this.c.I){this.c.I=this.c.hd=new e(b.document.createTextNode(""));n.insertAfter(this.c.I[0],r[0])}b=U}D=this.c.la;r=this.c.I;for(this.c.la=U;D;){var m=I,v=D[0].nodeType!=f.e,J=I;if(v){if(D[0].nodeType==f.f)if(B.test(D[0].nodeValue))v=I}else{var y=D.d();if(D.qa(this.dc&&{Wb:1})){if(y=="br")v=s;else if(!b&&!D[0].childNodes.length&&y!="hr"){a=D;d=D.g(r);break}if(b){b.T(D,i.C);
if(y!="br")this.c.la=D}m=s}else{if(D[0].firstChild){if(!b){b=new j(this.za.document);b.U(D,i.C)}D=new e(D[0].firstChild);continue}v=s}}if(v&&!b){b=new j(this.za.document);b.U(D,i.C)}d=(!m||v)&&D.g(r);if(b&&!m)for(;!D[0].nextSibling&&!d;){y=D.parent();if(y.qa(this.dc&&{Wb:1})){m=s;d||y.g(r);break}D=y;v=s;d=D.g(r);J=s}v&&b.T(D,i.t);D=D.w(J,U,r);if((d=!D)||m&&b)break}if(!a){if(!b){this.c.hd&&this.c.hd.h();return this.c.la=U}a=new g(b.startContainer);D=a.F;m={yg:1,Rg:1,Qg:1};a=a.z;if((!a||!a[0])&&!this.ac&&
m[D.d()]&&b.ua()&&b.ja())a=D;else if(!a||this.ac&&a.d()=="li"){a=new e(this.za.document.createElement(k||"p"));a[0].appendChild(b.extractContents());a.bb();b.insertNode(a);l=C=s}else if(a.d()!="li"){if(!b.ua()||!b.ja()){a=a.K(I);a[0].appendChild(b.extractContents());a.bb();C=b.vc();l=!C.Ff;C=!C.Ef;b.insertNode(a)}}else if(!d)this.c.la=a.g(r)?U:b.ld().P.w(s,U,r)}if(l){b=new e(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&n.d(b[0].lastChild)=="br"&&n.h(b[0].lastChild)}if(C){b=
t.Ia(I,s);l=new e(a[0].lastChild);if(l[0]&&l[0].nodeType==f.e&&l.d()=="br")if(w.ie||l.sa(b)||l.Fa(b))l.h()}if(!this.c.la)this.c.la=d||a.g(r)?U:a.w(s,U,r);return a}});j.prototype.Qe=function(){return new x(this)}});
KISSY.Editor.add("selection",function(p){function x(m){this.document=this.document=m;this.c={M:{}};if(a){var v=this.r().createRange();if(!v||v.item&&v.item(0).ownerDocument!=m||v.parentElement&&v.parentElement().ownerDocument!=m)this.wd=A}}function s(m){m=new x(m);return!m||m.wd?t:m}function I(m){var v=m.document,J=new e(v.body),y=new e(v.documentElement);if(i.ie){if(i.ie<8||document.documentMode==7)y.on("click",function(L){(new e(L.target)).d()==="html"&&m.getSelection().A()[0].select()});var c,
h,o=1;y.on("mousedown",function(){o=0});y.on("mouseup",function(){o=1});J.on("focusin",function(L){if((new e(L.target)).d()=="body")if(c){try{o&&c.select()}catch(Q){}c=t}});J.on("focus",function(){h=A;q()});J.on("beforedeactivate",function(L){if(!L.relatedTarget){h=w;o=1}});g.on(f.fa(v),"blur",function(){v&&v.selection.empty()});J.on("mousedown",function(){u()});J.on("mouseup",function(){h=A;setTimeout(function(){q(A)},0)});var u=function(){h=w},q=function(L){if(h){var Q=m.document,S=m.getSelection(),
W=S&&S.jb(),V=S&&S.r();if(L&&V&&W==n.Eb)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){q(A)},50);return}var Y;if(!(V&&W==n.pa&&(Y=f.d(S.ib()))&&Y in{input:1,textarea:1})){c=V&&S.A()[0];m.db()}}};J.on("keydown",u);J.on("keyup",function(){h=A;q()});g.on(v,"selectionchange",q)}else{g.on(v,"mouseup",m.db,m);g.on(v,"keyup",m.db,m)}var z={table:1,pre:1},O=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,P=p.Da.Ra(A);m.on("selectionChange",
function(L){var Q=L.path;L=(L=L.selection)&&L.A()[0];if(!(!L||!L.collapsed||Q.z))if(Q.F.d()=="body"){Q=L.hb(A,"p");if(Q.ab().match(O)){var S=Q.Fa(P);if(S&&S[0].nodeType==k.e&&!z[S.d()]){L.nb(S);Q.h()}else if((S=Q.sa(P))&&S[0].nodeType==k.e&&!z[S.d()]){L.nb(S,S.ab().match(O)?w:A);Q.h()}}L.select();a||m.pb()}})}p.ae={Eb:1,pa:2,Wa:3};var A=T,w=X,t=U,j=KISSY,i=j.UA,f=j.DOM,g=j.Event,e=j.Node,n=p.ae,B=p.oa,k=p.n,a=!window.getSelection,b=p.Da,d=p.Range,l={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};j.augment(x,{r:!a?function(){var m=this.c.M;return m.nc||(m.nc=f.fa(this.document).getSelection())}:function(){var m=this.c.M;return m.nc||(m.nc=this.document.selection)},jb:!a?function(){var m=this.c.M;if(m.type)return m.type;var v=n.pa,J=this.r();if(J){if(J.rangeCount==1){J=J.getRangeAt(0);var y=J.startContainer;if(y==J.endContainer&&y.nodeType==k.e&&J.endOffset-J.startOffset===1&&l[y.childNodes[J.startOffset].nodeName.toLowerCase()])v=
n.Wa}}else v=n.Eb;return m.type=v}:function(){var m=this.c.M;if(m.type)return m.type;var v=n.Eb;try{var J=this.r(),y=J.type;if(y=="Text")v=n.pa;if(y=="Control")v=n.Wa;if(J.createRange().parentElement)v=n.pa}catch(c){}return m.type=v},A:a?function(){function m(v,J){v=v.duplicate();v.collapse(J);for(var y=v.parentElement(),c=y.childNodes,h,o=0;o<c.length;o++){var u=c[o];if(u.nodeType==k.e){h=v.duplicate();h.moveToElementText(u);u=h.compareEndPoints("StartToStart",v);var q=h.compareEndPoints("EndToStart",
v);h.collapse();if(u>0)break;else if(!u||q==1&&u==-1)return{va:y,offset:o};else if(!q)return{va:y,offset:o+1};h=t}}if(!h){h=v.duplicate();h.moveToElementText(y);h.collapse(w)}h.setEndPoint("StartToStart",v);h=h.text.replace(/\r\n|\r/g,"\n").length;try{for(;h>0;)h-=c[--o].nodeValue.length}catch(z){h=0}return h===0?{va:y,offset:o}:{va:c[o],offset:-h}}return function(){var v=this.c.M;if(v.na)return v.na;var J=this.r(),y=J&&J.createRange(),c=this.jb();if(!J)return[];if(c==n.pa){J=new d(this.document);
c=m(y,A);J.setStart(new e(c.va),c.offset);c=m(y);J.setEnd(new e(c.va),c.offset);return v.na=[J]}else if(c==n.Wa){v=v.na=[];for(c=0;c<y.length;c++){var h=y.item(c),o=h.parentNode,u=0;for(J=new d(this.document);u<o.childNodes.length&&o.childNodes[u]!=h;u++);J.setStart(new e(o),u);J.setEnd(new e(o),u+1);v.push(J)}return v}return v.na=[]}}():function(){var m=this.c.M;if(m.na)return m.na;var v=[],J=this.r();if(!J)return[];for(var y=0;y<J.rangeCount;y++){var c=J.getRangeAt(y),h=new d(this.document);h.setStart(new e(c.startContainer),
c.startOffset);h.setEnd(new e(c.endContainer),c.endOffset);v.push(h)}return m.na=v},ib:function(){var m=this.c.M;if(m.Nd!==undefined)return m.Nd;var v,J=this.r();switch(this.jb()){case n.Wa:return this.gc();case n.pa:var y=this.A()[0];if(y)if(!y.collapsed){for(y.pc();A;){v=y.startContainer;if(y.startOffset==(v[0].nodeType===k.e?v[0].childNodes.length:v[0].nodeValue.length)&&!v.qa())y.setStartAfter(v);else break}v=y.startContainer;if(v[0].nodeType!=k.e)return v.parent();v=new e(v[0].childNodes[y.startOffset]);
if(!v[0]||v[0].nodeType!=k.e)return y.startContainer;for(y=v[0].firstChild;y&&y.nodeType==k.e;){v=new e(y);y=y.firstChild}return v}if(a){y=J.createRange();y.collapse(A);v=y.parentElement()}else if((v=J.anchorNode)&&v.nodeType!=k.e)v=v.parentNode}return m.Nd=v?f.D(v):t},gc:function(){var m=this,v,J=m.c.M;if(J.Ld!==undefined)return J.Ld;if(a){v=m.r().createRange();v=v.item&&v.item(0)}v||(v=function(){for(var y=m.A()[0],c,h,o=2;o&&!((c=y.od())&&c[0].nodeType==k.e&&l[c.d()]&&(h=c));o--)y.Pa(B.ea);return h&&
h[0]}());return J.Ld=f.D(v)},reset:function(){this.c.M={}},uc:function(m){var v,J=this.document;if(a)try{v=J.body.createControlRange();v.addElement(m[0]);v.select()}catch(y){v=J.body.createTextRange();v.moveToElementText(m[0]);v.select()}finally{}else{v=J.createRange();v.selectNode(m[0]);m=this.r();m.removeAllRanges();m.addRange(v)}this.reset()},vb:function(m){if(a){if(m.length>1){var v=m[m.length-1];m[0].setEnd(v.endContainer,v.endOffset);m.length=1}m[0]&&m[0].select()}else{v=this.r();if(!v)return;
v.removeAllRanges();for(var J=0;J<m.length;J++){var y=m[J],c=this.document.createRange(),h=y.startContainer;y.collapsed&&i.gecko&&i.gecko<1.09&&h[0].nodeType==k.e&&!h[0].childNodes.length&&h[0].appendChild(this.document.createTextNode(""));c.setStart(h[0],y.startOffset);c.setEnd(y.endContainer[0],y.endOffset);v.addRange(c)}}this.reset()},Pe:function(m){for(var v=[],J=this.A(),y=0;y<J.length;y++)v.push(J[y].ed(m));return v},Oe:function(m,v){var J=[],y=this.document,c;v=v||this.A();for(var h=v.length,
o=0;o<h;o++){J.push(c=v[o].O(m,A));var u=(m=c.Md)?j.one("#"+c.Z,y):c.Z;c=m?j.one("#"+c.P,y):c.P;for(var q=o+1;q<h;q++){var z=v[q],O=z.startContainer,P=z.endContainer;f.g(O,u.parent())&&z.startOffset++;f.g(O,c.parent())&&z.startOffset++;f.g(P,u.parent())&&z.endOffset++;f.g(P,c.parent())&&z.endOffset++}}return J},Kd:function(m){for(var v=[],J=0;J<m.length;J++){var y=new d(this.document);y.moveToBookmark(m[J]);v.push(y)}this.vb(v);return this},xa:function(){var m=this.A();return m[0].startContainer.Jb(m[m.length-
1].endContainer)},scrollIntoView:function(){var m=this.ib();m&&m.Ob()},removeAllRanges:function(){var m=this.r();if(a)m&&m.clear();else m&&m.removeAllRanges()}});var C={table:1,tbody:1,tr:1},r=b.Ra(A),D=/\ufeff|\u00a0/;d.prototype.select=d.prototype.select=!a?function(){var m=this.startContainer;this.collapsed&&m[0].nodeType==k.e&&!m[0].childNodes.length&&m[0].appendChild(this.document.createTextNode(""));var v=this.document.createRange();v.setStart(m[0],this.startOffset);try{v.setEnd(this.endContainer[0],
this.endOffset)}catch(J){if(J.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(A);v.setEnd(this.endContainer[0],this.endOffset)}else throw J;}m=s(this.document).r();m.removeAllRanges();m.addRange(v)}:function(m){var v=this.collapsed,J,y;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var c=this.startContainer[0].childNodes[this.startOffset];if(c.nodeType==k.e){(new x(this.document)).uc(new e(c));return}}if(this.startContainer[0].nodeType==k.e&&this.startContainer.d()in
C||this.endContainer[0].nodeType==k.e&&this.endContainer.d()in C)this.Pa(B.ea,A);var h=this.O();c=h.Z;var o;if(!v)o=h.P;h=this.document.body.createTextRange();h.moveToElementText(c[0]);h.moveStart("character",1);if(o){m=this.document.body.createTextRange();m.moveToElementText(o[0]);h.setEndPoint("EndToEnd",m);h.moveEnd("character",-1)}else{for(J=c[0].nextSibling;J&&!r(J);)J=J.nextSibling;J=!(J&&J.nodeValue&&J.nodeValue.match(D))&&(m||!c[0].previousSibling||c[0].previousSibling&&f.d(c[0].previousSibling)==
"br");y=new e(this.document.createElement("span"));y.html("&#65279;");y.insertBefore(c);J&&f.insertBefore(this.document.createTextNode("\ufeff"),c)}this.setStartBefore(c);c.h();if(v){if(J){h.moveStart("character",-1);h.select();this.document.selection.clear()}else h.select();if(y){this.H(y,B.C);y.h()}}else{this.setEndBefore(o);o.h();h.select()}};x.getSelection=s;p.Ic=x;p.Selection=x;b=x.prototype;p.k.o(b,{getNative:b.r,getType:b.jb,getRanges:b.A,getStartElement:b.ib,getSelectedElement:b.gc,reset:b.reset,
selectElement:b.uc,selectRanges:b.vb,createBookmarks2:b.Pe,createBookmarks:b.Oe,getCommonAncestor:b.xa,scrollIntoView:b.scrollIntoView,selectBookmarks:b.Kd,removeAllRanges:b.removeAllRanges});p.on("instanceCreated",function(m){I(m.Te)})});
KISSY.Editor.add("styles",function(p){function x(E,K){for(var G in E)E[G]=E[G].replace(V,function(F,H){return K[H]})}function s(E,K){if(K){E=v.clone(E);x(E.attributes,K);x(E.styles,K)}var G=this.element=this.element=(E.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.Fb:S[G]?c.Ya:c.Ca;this.c={definition:E}}function I(E,K){var G=K?this.tc:this.Rb;E.body.focus();for(var F=new o(E),H=F.A(),N=0;N<H.length;N++)G.call(this,H[N]);F.vb(H)}function A(E,K){var G;G=E.element;if(G=="*")G="span";
G=new O(K.createElement(G));return w(G,E)}function w(E,K){var G=K.c.definition,F=G.attributes;G=s.pd(G);if(F)for(var H in F)E.attr(H,F[H]);if(G)E[0].style.cssText=G;return E}function t(E){var K=E.O(r),G=E.Qe();G.ac=r;G.kd=r;for(var F,H=E.document;F=G.af();){var N=A(this,H);F=F;var M=N;N=M.d=="pre";var R=F.d=="pre",ba=!N&&R;if(N&&!R){R=F;M=M;ba=R.html();ba=j(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(M[0]);M[0].outerHTML="<pre>"+ba+"</pre>";M=new O(R.firstChild);M.h()}else M.html(ba);M=M}else if(ba)M=f(i(F),M);else F.Mb(M);F[0].parentNode.replaceChild(M[0],F[0]);if(N){F=M;N=void 0;if((N=F.ga(r,u.e))&&N.d()=="pre"){M=j(N.html(),/\n$/,"")+"\n\n"+j(F.html(),/^\n/,"");if(P.ie)F[0].outerHTML="<pre>"+M+"</pre>";else F.html(M);N.h()}}}E.moveToBookmark(K)}function j(E,K,G){var F="",H="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(N,M,R){M&&(F=M);R&&(H=R);return""});return F+E.replace(K,G)+H}function i(E){var K=[];j(E.ab(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function f(E,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<E.length;F++){var H=E[F];H=H.replace(/(\r\n|\r)/g,"\n");H=j(H,/^[ \t]*\n/,"");H=j(H,/\n$/,"");H=j(H,/^[ \t]+|[ \t]+$/g,function(M,R){return M.length==
1?"&nbsp;":R?" "+Array(M.length).join("&nbsp;"):Array(M.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(M){return Array(M.length).join("&nbsp;")+" "});var N=K.K();N.html(H);G.appendChild(N[0])}return G}function g(E){var K=E.document;if(E.collapsed){K=A(this,K);E.insertNode(K);E.H(K,h.J)}else{var G=this.element,F=this.c.definition,H,N=p.m[G]||(H=r,p.m.span),M=E.O();E.Ja(h.Cb);E.trim();var R=E.O(),ba=R.Z;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=D;if(y.g($,R)){$=
m;Z=r}else{var aa=$[0].nodeType,fa=aa==u.e?$.d():m;if(fa&&$.attr("_ke_bookmark")){$=$.w(r);continue}if(!fa||N[fa]&&($.Ga(R)|q.Y|q.da|q.X)==q.Y+q.da+q.X&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((p.m[ga.d()]||p.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!p.m.ba[fa]||($.Ga(R)|q.Y|q.da|q.X)==q.Y+q.da+q.X)){ca=new z(K);ca.setStartBefore($)}if(aa==u.f||aa==u.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Fa(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),N[da.d()])&&(da.Ga(ba)|q.ca|q.da|q.X)==q.ca+q.da+q.X&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=r)}}else Z=r}else Z=r;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=A(this,K);for(aa=ca.xa();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.$a()){Z=m;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());d(this,Z);ca.insertNode(Z);
Z.ra();P.ie||Z[0].normalize()}ca=m}}ba.h();R.h();E.moveToBookmark(M);E.Pa(h.Gc)}}function e(E){E.Ja(h.Cb);var K=E.O(),G=K.Z;if(E.collapsed){for(var F=new L(G.parent()),H,N=0,M;N<F.elements.length&&(M=F.elements[N]);N++){if(M==F.z||M==F.F)break;if(this.ia(M)){var R=E.Yb(M,h.Wd),ba=!R&&E.Yb(M,h.Xa);if(ba||R){H=M;H.match=ba?"start":"end"}else{M.ra();M.d()==this.element?a(this,M):l(M,k(this)[M.d()])}}}if(H&&H[0]){M=G;for(N=0;;N++){R=F.elements[N];if(y.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(M[0]);M=R}y[H.match=="start"?"insertBefore":"insertAfter"](M,H)}}else{var $=K.P,ca=this;F=function(){for(var Z=new L(G.parent()),aa=new L($.parent()),fa=m,ga=m,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Ib(ga);fa&&G.Ib(fa)};F();for(H=new O(G[0].nextSibling);H[0]!==$[0];){N=H.w();if(H[0]&&H[0].nodeType==u.e&&this.ia(H)){H.d()==
this.element?a(this,H):l(H,k(this)[H.d()]);if(N[0].nodeType==u.e&&N.contains(G)){F();N=new O(G[0].nextSibling)}}H=N}}E.moveToBookmark(K)}function n(E){var K={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function B(E,K){var G;if(K!==D){G=document.createElement("span");G.style.cssText=E;G=G.style.cssText||""}else G=E;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function k(E){if(E.c.Jd)return E.c.Jd;
var K=E.c.Jd={},G=E.c.definition.overrides;if(G){v.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],N,M;if(typeof H=="string")N=H.toLowerCase();else{N=H.element?H.element.toLowerCase():E.element;M=H.attributes}H=K[N]||(K[N]={});if(M){H=H.attributes=H.attributes||[];for(var R in M)H.push([R.toLowerCase(),M[R]])}}}return K}function a(E,K){var G=E.c.definition,F=J.mix(G.attributes,k(E)[K.d()]);G=G.styles;var H=v.isEmptyObject(F)&&v.isEmptyObject(G),N;for(N in F)if(!((N=="class"||E.c.definition.fullMatch)&&
K.attr(N)!=b(N,F[N]))){H=H||!!K.Lc(N);K.removeAttr(N)}for(var M in G)if(!(E.c.definition.fullMatch&&K.L(M)!=b(M,G[M],r))){H=H||!!K.L(M);K.L(M,"")}C(K)}function b(E,K,G){var F=new O("<span>");F[G?"_4e_style":"attr"](E,K);return F[G?"_4e_style":"attr"](E)}function d(E,K){for(var G=k(E),F=K.all(E.element),H=F.length;--H>=0;)a(E,new O(F[H]));for(var N in G)if(N!=E.element){F=K.all(N);for(H=F.length-1;H>=0;H--){var M=new O(F[H]);l(M,G[N])}}}function l(E,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],N;if(N=E.attr(H)){var M=G[F][1];if(M===m||M.test&&M.test(N)||typeof M=="string"&&N==M)E[0].removeAttribute(H)}}C(E)}function C(E){if(!E.$a()){var K=E[0].firstChild,G=E[0].lastChild;E.h(r);if(K){K.nodeType==u.e&&y.ra(K);G&&K!=G&&G.nodeType==u.e&&y.ra(G)}}}var r=T,D=X,m=U,v=KISSY,J=p.k,y=v.DOM,c={Fb:1,Ca:2,Ya:3},h=p.oa,o=p.Ic,u=p.n,q=p.Va,z=p.Range,O=v.Node,P=v.UA,L=p.Ua,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},S={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},W=/\s*(?:;\s*|$)/g,V=/#\((.+?)\)/g;p.ag=c;s.prototype={apply:function(E){I.call(this,E,D)},remove:function(E){I.call(this,E,r)},Rb:function(E){return(this.Rb=this.type==c.Ca?g:this.type==c.Fb?t:this.type==c.Ya?m:m).call(this,E)},tc:function(E){return(this.tc=this.type==c.Ca?e:m).call(this,E)},De:function(E){w(E,this)},ia:function(E,K){if(!E)return D;var G=this.c.definition;if(E.d()==this.element){if(!K&&!E.$a())return r;var F=G.le;if(F)G=F;else{F={};var H=0,N=G.attributes;
if(N)for(var M in N){H++;F[M]=N[M]}if(N=s.pd(G)){F.style||H++;F.style=N}F._length=H;G=G.le=F}if(G._length){for(var R in G)if(R!="_length"){H=E.attr(R)||"";if(R=="style")a:{F=G[R];H=B(H,D);typeof F=="string"&&(F=n(F));typeof H=="string"&&(H=n(H));N=void 0;for(N in F)if(!(N in H&&(H[N]==F[N]||F[N]=="inherit"||H[N]=="inherit"))){F=D;break a}F=r}else F=G[R]==H;if(F){if(!K)return r}else if(K)return D}if(K)return r}else return r}if(R=k(this)[E.d()]){if(!(G=R.attributes))return r;for(F=0;F<G.length;F++){R=
G[F][0];if(R=E.attr(R)){H=G[F][1];if(H===m||typeof H=="string"&&R==H||H.test&&H.test(R))return r}}}return D},Ke:function(E){switch(this.type){case c.Fb:return this.ia(E.z||E.F,r);case c.Ya:case c.Ca:for(var K=E.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.Ca&&(y.g(F,E.z)||y.g(F,E.F))))if(!(this.type==c.Ya&&!(F.d()in S)))if(this.ia(F,r))return r}}return D}};s.pd=function(E){var K=E.me;if(K)return K;K=E.styles;var G=E.attributes&&E.attributes.style||"",F="";if(G.length)G=G.replace(W,";");
for(var H in K){var N=K[H],M=(H+":"+N).replace(W,";");if(N=="inherit")F+=M;else G+=M}if(G.length)G=B(G);G+=F;return E.me=G};p.bg=s;p.Style=s;var Y=s.prototype;p.k.o(Y,{apply:Y.apply,remove:Y.remove,applyToRange:Y.Rb,removeFromRange:Y.tc,applyToObject:Y.De,checkElementRemovable:Y.ia,checkActive:Y.Ke})});
KISSY.Editor.add("htmlparser",function(){function p(){}function x(){this.c={sd:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var s=KISSY,I=s.Editor,A=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,w={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},t=I.m;s.augment(x,{ya:p,Id:p,ma:p,Ed:p,Na:p,parse:function(j){for(var i,
f,g=0,e;i=this.c.sd.exec(j);){f=i.index;if(f>g){g=j.substring(g,f);e?e.push(g):this.ma(g)}g=this.c.sd.lastIndex;if(f=i[1]){f=f.toLowerCase();if(e&&t.zc[f]){this.Ed(e.join(""));e=U}if(!e){this.Id(f);continue}}if(e)e.push(i[0]);else if(f=i[3]){f=f.toLowerCase();if(!/="/.test(f)){var n={},B;i=i[4];var k=!!(i&&i.charAt(i.length-1)=="/");if(i)for(;B=A.exec(i);){var a=B[1].toLowerCase();B=B[2]||B[3]||B[4]||"";n[a]=!B&&w[a]?a:B}this.ya(f,n,k);if(!e&&t.zc[f])e=[]}}else if(f=i[2])this.Na(f)}j.length>g&&this.ma(j.substring(g,
j.length))}});I.j=x;I.HtmlParser=x});
KISSY.Editor.add("htmlparser-basicwriter",function(){function p(){this.c={l:[]}}var x=KISSY,s=x.Editor,I=s.k;x.augment(p,{qb:function(A){this.c.l.push("<",A)},rb:function(A,w){w?this.c.l.push(" />"):this.c.l.push(">")},eb:function(A,w){if(typeof w=="string")w=I.jc(w);this.c.l.push(" ",A,'="',w,'"')},fb:function(A){this.c.l.push("</",A,">")},text:function(A){this.c.l.push(A)},N:function(A){this.c.l.push("<!--",A,"--\>")},write:function(A){this.c.l.push(A)},reset:function(){this.c.l=[];this.c.B=X},
ec:function(A){var w=this.c.l.join("");A&&this.reset();return w}});s.j.Ab=p;s.j.BasicWriter=p;x=p.prototype;s.k.o(x,{openTag:x.qb,openTagClose:x.rb,attribute:x.eb,closeTag:x.fb,text:x.text,comment:x.N,write:x.write,reset:x.reset,getHtml:x.ec})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function p(){p.superclass.constructor.call(this);this.ud="\t";this.wf=" />";this.nf="\n";this.Xe=w;this.xf=A;this.c.B=w;this.c.G="";this.c.rules={};var t=s.m,j;for(j in I.mix({},t.zb,t.Sa,t.yb,t.Dc))this.Aa(j,{B:A,He:A,Xb:A,$c:!t[j]["#"],Ge:A});this.Aa("br",{Xb:A});this.Aa("title",{B:w,Xb:w});this.Aa("style",{B:w,$c:A});this.Aa("pre",{B:w})}var x=KISSY,s=x.Editor,I=s.k,A=T,w=X;x.extend(p,s.j.Ab,{qb:function(t){var j=this.c.rules[t];if(this.c.B)this.G();
else if(j&&j.He){this.La();this.G()}this.c.l.push("<",t)},rb:function(t,j){var i=this.c.rules[t];if(j)this.c.l.push(this.wf);else{this.c.l.push(">");if(i&&i.B)this.c.G+=this.ud}i&&i.Xb&&this.La()},eb:function(t,j){if(typeof j=="string"){this.Xe&&(j=j.replace(/&amp;/g,"&"));j=I.jc(j)}this.c.l.push(" ",t,'="',j,'"')},fb:function(t){var j=this.c.rules[t];if(j&&j.B)this.c.G=this.c.G.substr(this.ud.length);if(this.c.B)this.G();else if(j&&j.$c){this.La();this.G()}this.c.l.push("</",t,">");j&&j.Ge&&this.La()},
text:function(t){if(this.c.B){this.G();t=I.Ma(t)}this.c.l.push(t)},N:function(t){this.c.B&&this.G();this.c.l.push("<!--",t,"--\>")},La:function(){this.c.l.length>0&&this.c.l.push(this.nf);this.c.B=A},G:function(){this.c.l.push(this.c.G);this.c.B=w},Aa:function(t,j){var i=this.c.rules[t];if(i)I.mix(i,j);else this.c.rules[t]=j}});s.j.Pf=p;s.j.HtmlWriter=p;x=p.prototype;s.k.o(x,{openTag:x.qb,openTagClose:x.rb,attribute:x.eb,closeTag:x.fb,text:x.text,comment:x.N,lineBreak:x.La,indentation:x.G,setRules:x.Aa})});
KISSY.Editor.add("htmlparser-fragment",function(){function p(){this.children=[];this.parent=I;this.c={R:x,ic:s}}var x=T,s=X,I=U,A=KISSY.Editor,w={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},t=KISSY,j=A.k,i=A.n,f=A.m,g=j.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),e=f.Sd,n=f.yb;p.Db=function(B,k){function a(h){var o;if(r.length>0)for(var u=0;u<r.length;u++){var q=r[u],z=q.name,O=f[z],P=m.name&&f[m.name];if((!P||P[z])&&(!h||!O||O[h]||!f[h])){if(!o){b();o=1}q=q.clone();
q.parent=m;m=q;r.splice(u,1);u--}}}function b(){for(;D.length;)m.add(D.shift())}function d(h,o,u){o=o||m||C;if(k&&!o.type){var q,z;if((q=h.attributes&&(z=h.attributes._ke_real_element_type)?z:h.name)&&!(q in f.yc)&&!(q in f.zb)){q=m;m=o;l.ya(k,{});o=m;if(u)m=q}}if(h.c.R&&h.name!="pre"){u=h.children.length;if((q=h.children[u-1])&&q.type==i.f)if(z=j.Oa(q.value))q.value=z;else h.children.length=u-1}o.add(h);if(h.tb){m=h.tb;delete h.tb}}var l=new A.j,C=new p,r=[],D=[],m=C,v=s,J;l.ya=function(h,o,u){var q=
new A.j.Ec(h,o);if(q.lc&&u)q.mb=x;if(f.ba[h])r.push(q);else{if(h==="pre")v=x;else if(h==="br"&&v){m.add(new A.j.Gb("\n"));return}if(h==="br")D.push(q);else{var z=m.name,O=z&&(f[z]||(m.c.R?f.div:f.span));if(O&&!q.lc&&!m.lc&&!O[h]){O=s;var P;if(h in e&&z in e){z=m.children;(z=z[z.length-1])&&z.name in n||d(z=new A.j.Ec("li"),m);J=m;P=z}else if(h==z)d(m,m.parent);else{if(g[z])J||(J=m);else{d(m,m.parent,x);w[z]||r.unshift(m)}O=x}m=P?P:m.tb||m.parent;if(O){l.ya.apply(this,arguments);return}}a(h);b();q.parent=
m;q.tb=J;J=0;if(q.mb)d(q);else m=q}}};l.Id=function(h){for(var o=r.length-1;o>=0;o--)if(h==r[o].name){r.splice(o,1);return}for(var u=[],q=[],z=m;z.type&&z.name!=h;){z.c.R||q.unshift(z);u.push(z);z=z.parent}if(z.type){for(o=0;o<u.length;o++){var O=u[o];d(O,O.parent)}m=z;if(m.name=="pre")v=s;z.c.R&&b();d(z,z.parent);if(z==m)m=m.parent;r=r.concat(q)}if(h=="body")k=s};l.ma=function(h){if(!m.c.ic&&!v){h=j.Ma(h);if(h.length===0)return}b();a();if(k&&(!m.type||m.name=="body")&&j.trim(h))this.ya(k,{});v||
(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));m.add(new A.j.Gb(h))};l.Ed=function(){};l.Na=function(h){m.add(new A.j.Ud(h))};l.parse(B);for(b();m.type;){var y=m.parent,c=m;if(k&&(!y.type||y.name=="body")&&!f.yc[c.name]){m=y;l.ya(k,{});y=m}y.add(c);m=y}return C};t.augment(p,{add:function(B){var k=this.children.length;if(k=k>0&&this.children[k-1]||I){if(B.c.R&&k.type==i.f){k.value=j.Oa(k.value);if(k.value.length===0){this.children.pop();this.add(B);return}}k.next=B}B.sb=k;B.parent=this;this.children.push(B);
this.c.ic=B.type==i.f||B.type==i.e&&!B.c.R},aa:function(B,k){var a;this.filterChildren=this.cc=function(){var b=new A.j.Ab;this.V.call(this,b,k,x);b=b.ec();this.children=(new p.Db(b)).children;a=1};!this.name&&k&&k.Gd(this);this.V(B,a?I:k)},V:function(B,k){for(var a=0;a<this.children.length;a++)this.children[a].aa(B,k)}});A.j.Ba=p;A.j.Fragment=p;p.FromHtml=p.Db;t=p.prototype;A.k.o(t,{add:t.add,writeHtml:t.aa,writeChildrenHtml:t.V})});
KISSY.Editor.add("htmlparser-element",function(){function p(w,t){w=w[0];t=t[0];return w<t?-1:w>t?1:0}function x(w,t){this.name=w;this.attributes=t||(t={});this.children=[];var j=t.fg||w,i=s.m;j=!!(i.zb[j]||i.Sa[j]||i.yb[j]||i.Dc[j]||i.Cc[j]||j=="br");var f=!!i.xb[w];this.mb=f;this.lc=!i[w];this.c={R:j,ic:f||!j}}var s=KISSY.Editor,I=s.n;KISSY.augment(x,{type:I.e,add:s.j.Ba.prototype.add,clone:function(){return new x(this.name,this.attributes)},aa:function(w,t){var j=this.attributes,i=this,f=i.name,
g,e,n,B;i.cc=function(){if(!B){var b=new s.j.Ab;s.j.Ba.prototype.V.call(i,b,t);i.children=(new s.j.Ba.Db(b.ec())).children;B=1}};i.filterChildren=i.cc;if(t){for(;;){if(!(f=t.Fd(f)))return;i.name=f;if(!(i=t.oc(i)))return;i.parent=this.parent;if(i.name==f)break;if(i.type!=I.e){i.aa(w,t);return}f=i.name;if(!f){this.V.call(i,w,B?U:t);return}}j=i.attributes}w.qb(f,j);for(var k=[],a=0;a<2;a++)for(g in j){e=g;n=j[g];if(a==1)k.push([g,n]);else if(t){for(;;)if(e=t.Dd(g))if(e!=g){delete j[g];g=e}else break;
else{delete j[g];break}if(e)if((n=t.Cd(i,e,n))===X)delete j[e];else j[e]=n}}w.xf&&k.sort(p);j=k.length;for(a=0;a<j;a++){g=k[a];w.eb(g[0],g[1])}w.rb(f,i.mb);if(!i.mb){this.V.call(i,w,B?U:t);w.fb(f)}},V:function(){s.j.Ba.prototype.V.apply(this,arguments)}});s.j.Ec=x;s.j.Element=x;var A=x.prototype;s.k.o(A,{type:A.type,add:A.add,clone:A.clone,writeHtml:A.aa,writeChildrenHtml:A.V})});
KISSY.Editor.add("htmlparser-filter",function(){function p(g){this.c={$b:[],Tb:[],elements:{Bc:0},attributes:{Bc:0}};g&&this.Zc(g,10)}function x(g,e){for(var n=0;g&&n<e.length;n++){var B=e[n];g=g.replace(B[0],B[1])}return g}function s(g,e,n){if(typeof e=="function")e=[e];var B,k;k=g.length;var a=e&&e.length;if(a){for(B=0;B<k&&g[B].sc<n;B++);for(k=a-1;k>=0;k--)if(a=e[k]){a.sc=n;g.splice(B,0,a)}}}function I(g,e,n){if(e)for(var B in e){var k=g[B];g[B]=A(k,e[B],n);k||g.Bc++}}function A(g,e,n){if(e){e.sc=
n;if(g){if(g.splice)s(g,e,n);else{g=g.sc>n?[e,g]:[g,e];g.filter=w}return g}else return e.filter=e}}function w(g){for(var e=g.type||g instanceof j.j.Ba,n=0;n<this.length;n++){if(e)var B=g.type,k=g.name;var a=this[n].apply(window,arguments);if(a===f)return a;if(e){if(a&&(a.name!=k||a.type!=B))return a}else if(typeof a!="string")return a;a!=undefined&&(g=a)}return g}var t=KISSY,j=t.Editor,i=j.n,f=X;t.augment(p,{Zc:function(g,e){if(typeof e!="number")e=10;s(this.c.$b,g.$b,e);s(this.c.Tb,g.Tb,e);I(this.c.elements,
g.elements,e);I(this.c.attributes,g.attributes,e);this.c.text=A(this.c.text,g.text,e)||this.c.text;this.c.N=A(this.c.N,g.N,e)||this.c.N;this.c.ub=A(this.c.ub,g.ub,e)||this.c.ub},Fd:function(g){return x(g,this.c.$b)},Dd:function(g){return x(g,this.c.Tb)},ma:function(g){var e=this.c.text;return e?e.filter(g):g},Na:function(g,e){var n=this.c.N;return n?n.filter(g,e):g},Gd:function(g){var e=this.c.ub;return e?e.filter(g):g},oc:function(g){for(var e=[this.c.elements["^"],this.c.elements[g.name],this.c.elements.Gf],
n,B=0;B<3;B++)if(n=e[B]){n=n.filter(g,this);if(n===f)return U;if(n&&n!=g)return this.Hd(n);if(g.parent&&!g.name)break}return g},Hd:function(g){var e=g.type;return e==i.e?this.oc(g):e==i.f?new j.j.Gb(this.ma(g.value)):U},Cd:function(g,e,n){if(e=this.c.attributes[e]){g=e.filter(n,g,this);if(g===f)return f;if(typeof g!="undefined")return g}return n}});j.j.Of=p;t=p.prototype;j.k.o(t,{addRules:t.Zc,onElementName:t.Fd,onAttributeName:t.Dd,onText:t.ma,onComment:t.Na,onFragment:t.Gd,onElement:t.oc,onNode:t.Hd,
onAttribute:t.Cd});j.j.Filter=p});KISSY.Editor.add("htmlparser-text",function(){function p(A){this.value=A;this.c={R:I}}var x=KISSY,s=x.Editor,I=X;x.augment(p,{type:s.n.f,aa:function(A,w){var t=this.value;w&&!(t=w.ma(t,this))||A.text(t)}});s.j.Gb=p;s.j.Text=p});
KISSY.Editor.add("htmlparser-comment",function(){function p(I){this.value=I;this.c={R:X}}var x=KISSY.Editor,s=x.n;x.j.Ud=p;x.j.Comment=p;p.prototype={constructor:p,type:s.Xd,aa:function(I,A){var w=this.value;if(A){if(!(w=A.Na(w,this)))return;if(typeof w!="string"){w.parent=this.parent;w.aa(I,A);return}}I.N(w)}}});
KISSY.Editor.add("button",function(){var p=KISSY,x=p.Editor;if(x.ce)p.log("TripleButton attach twice","warn");else{p=p.UIBase.create([p.UIBase.Box],{sg:function(){var s=this,I=s.get("el");I.on("click",s.ne,s);I.on("mousedown",function(){s.get("state")=="off"&&I.addClass("ke-triplebutton-active")});I.on("mouseup mouseleave",function(){s.get("state")=="off"&&I.hasClass("ke-triplebutton-active")&&setTimeout(function(){I.removeClass("ke-triplebutton-active")},300)})},mg:function(){this.get("el").attr("title",
this.get("title"))},jg:function(s){var I=this.get("el");if(s!==undefined){I.html("<span class='ke-toolbar-item "+s+"'>");I.Ha()}},lg:function(s){var I=this.get("el");s!==undefined&&I.html(s)},kg:function(s){this["_"+s]()},gd:function(){this.we=this.get("state");this.set("state","disabled")},jd:function(){this.get("state")=="disabled"&&this.set("state",this.we)},ne:function(s){this.fire(this.get("state")+"Click",s);s.type=this.get("state")+"Click";this.fire("click",s);s.preventDefault()},ug:function(){this.set("state",
"on")},tg:function(){this.set("state","off")},hg:function(){var s=this.get("el");s.removeClass("ke-triplebutton-off ke-triplebutton-disabled");s.addClass("ke-triplebutton-on")},gg:function(){var s=this.get("el");s.removeClass("ke-triplebutton-on ke-triplebutton-disabled");s.addClass("ke-triplebutton-off")},dg:function(){var s=this.get("el");s.removeClass("ke-triplebutton-off ke-triplebutton-on");s.addClass("ke-triplebutton-disabled")}},{Td:{zf:{value:"off"},Ue:{value:"ke-triplebutton ke-triplebutton-off"},
Bg:{value:{hideFocus:T,tabIndex:-1}},Cg:{value:"a"},title:{},vg:{},text:{}}});p.Wf="on";p.Uf="off";p.Vd="disabled";p.Xf="ke-triplebutton-on";p.Vf="ke-triplebutton-off";p.Mf="ke-triplebutton-disabled";x.ce=p}});
KISSY.Editor.add("select",function(){function p(j){p.superclass.constructor.call(this,j);this.qe()}var x=KISSY,s=x.Node,I=x.Event,A=x.DOM,w=x.Editor;if(w.be)x.log("ke select attach more");else{p.Vd=0;p.Nf=1;var t=w.m;p.Td={Pg:{},ka:{},Ne:{},va:{},zg:{},value:{},width:{},title:{},lf:{},align:{value:["l","b"]},Ig:{Ug:function(){for(var j=this.ka.parent();j;){var i=j.d();if(t[i]&&t[i].div)return j;j=j.parent()}return new s(document.body)}},zf:{value:1}};p.xg=function(j){for(var i=j.width(),f=[],g=j.all("option"),
e=0;e<g.length;e++){var n=g[e];f.push({name:A.html(n),value:A.attr(n,"value")})}return new p({width:i+"px",ka:j,lf:f,Ne:"ke-combox",value:j.val()})};x.extend(p,x.Base,{qe:function(){var j=this.get("container"),i=this.get("el"),f=new s("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),g=this.get("title")||"",
e=this.get("cls"),n=f.one(".ke-select-text"),B=f.one(".ke-select-text-inner");f.one(".ke-select-drop");this.get("value")!==undefined?B.html(this.Tc(this.get("value"))):B.html(g);n.css("width",this.get("width"));f.Ha();g&&f.attr("title",g);e&&f.addClass(e);if(i)i[0].parentNode.replaceChild(f[0],i[0]);else j&&f.appendTo(j);f.on("click",this.pe,this);this.ka=f;this.title=B;this.Uc=f.one("a.ke-select");w.k.zd(this,"_prepare","_real");this.on("afterValueChange",this.ze,this);this.on("afterStateChange",
this.ye,this)},Tc:function(j){var i=this.get("title")||"",f=this.get("items");if(this.get("showValue"))return j||i;for(var g=0;g<f.length;g++){var e=f[g];if(e.value==j){i=e.name;break}}return i},ze:function(j){this.title.html(this.Tc(j.ob))},Vc:function(j){j=j.ob;var i=this.Xc;i.html("");if(j)for(var f=0;f<j.length;f++){var g=j[f];(new s("<a class='ke-select-menu-item' href='#' data-value='"+g.value+"'>"+g.name+"</a>",g.qg)).appendTo(i).Ha()}this.Sb=i.all("a")},val:function(j){if(j!==undefined){this.set("value",
j);return this}else return this.get("value")},ve:function(){this.S.get("visible")&&this.ue()},re:function(){function j(k){k=new s(k.target);f.contains(k)||f.g(k)||n.hide()}var i=this,f=i.ka,g=i.get("popUpWidth"),e=i.Uc,n=new w.Yd({rg:T,Og:i.get("menuContainer"),content:"<div>",Eg:X,Ue:"ke-menu",width:g?g:f.width(),zIndex:w.Ub(w.xc.$d),Fg:X}),B=i.get("items");g=n.get("contentEl").one("div");i.S=n;I.on(window,"resize",i.ve,i);i.get("title")&&(new s("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+
i.get("title")+"</div>")).appendTo(g);i.Xc=(new s("<div>")).appendTo(g);i.Vc({ob:B});n.on("show",function(){e.addClass("ke-select-active")});n.on("hide",function(){e.removeClass("ke-select-active")});I.on(document,"click",j);i.get("doc")&&I.on(i.get("doc"),"click",j);g.on("click",i.xe,i);i.Sb=i.Xc.all("a");I.on(g[0],"mouseenter",function(){i.Sb.removeClass("ke-menu-selected")});i.on("afterItemsChange",i.Vc,i);i.pf=g},ye:function(j){var i=this.ka;j.ob==1?i.removeClass("ke-select-disabled"):i.addClass("ke-select-disabled")},
jd:function(){this.set("state",1)},gd:function(){this.set("state",0)},xe:function(j){j.halt();var i=this.S,f=this.pf;if(j=(new s(j.target)).Jc(function(n){return f.contains(n)&&n.d()=="a"},T)){var g=this.get("value"),e=j.attr("data-value");this.set("value",e);this.fire("click",{ob:e,Kg:g,name:j.html()});i.hide()}},ue:function(){var j=this.ka,i=j.offset(),f=x.clone(i),g=this.S.get("el").height(),e=this.S.get("el").width(),n=A.scrollTop(),B=A.scrollLeft(),k=A.viewportHeight(),a=A.viewportWidth();a=
B+a-60;k=n+k;var b=i.top+(j.height()-2);j=i.left+j.width()-2;var d=this.get("align"),l=d[0];if(d[1]=="b"){i.top=b;if(i.top+g>k&&f.top-n>k-b)i.top=f.top-g}else{i.top=f.top-g;if(i.top<n&&f.top-n<k-b)i.top=b}if(l=="l"){if(i.left+e>a&&j-B>a-f.left)i.left=j-e}else{i.left=j-e;if(i.left<B&&j-B<a-f.left)i.left=f.left}this.S.set("xy",[i.left,i.top]);this.S.show()},pe:function(j){if(!this.mc){j.preventDefault();var i=this;j=i.ka;var f=i.get("value");if(!j.hasClass("ke-select-disabled"))if(i.Uc.hasClass("ke-select-active"))i.S&&
i.S.hide();else{i.mc=T;w.use("overlay",function(){i.mc=X;i.re();f&&i.S&&i.Sb.each(function(g){g.attr("data-value")==f?g.addClass("ke-menu-selected"):g.removeClass("ke-menu-selected")})})}}}});w.be=p}});
