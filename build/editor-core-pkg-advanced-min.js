/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-10 14:14:07
*/
var T=true,U=null,Y=false;
KISSY.add("editor",function(p,B){function v(y,i){function a(x){for(var n=v.Env.mods,E=0;E<x.length;E++){for(var k=x[E],s=u,I=0;I<E;I++)if(k==x[I]){s=z;break}I=n[k];if(s&&I){s=p.clone(I);k=k+"_"+E;s.name=k;x[E]=k;n[k]||(n[k]=s)}}}var b=this;if(!(b instanceof v))return new v(y,i);if(p.isString(y))y=p.one(y);y=A.D(y);i=i||{};i.Je=i.pluginConfig||{};b.ha=i;i.pluginConfig=i.Je;b.cfg=i;p.app(b,p.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],j=u;b.use=function(x,n){x=x.split(",");a(x);
if(!j)for(var E=0;E<d.length;E++){var k=d[E];p.inArray(k,x)||x.unshift(k)}p.use.call(b,x.join(","),function(){b.ready(function(){n&&n.call(b);if(!j){b.setData(y.val());if(i.focus)b.focus();else{var s=b.getSelection();s&&s.removeAllRanges()}b.fire("save");j=z}})},{order:z,global:v});return b};b.use=b.use;b.Ae(y);return b}function J(y){var i=p.Config.debug;y=i?i==="dev"?"../src/"+y:y:y.replace(/\.(js|css)/i,"-min.$1");y+=y.indexOf("?")!=-1?"&":"?";y+="t="+encodeURIComponent("2010-12-10 14:14:07");return y}
var A=p.DOM,z=T,u=Y;p.app(v,p.EventTarget);v.Config.base=p.Config.base+"editor/";var r=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],q,f,h,e,o={};q=0;for(f=r.length;q<f;q++){h=r[q];if(p.isString(h))h=r[q]={name:h+"",requires:U};e=h.requires||[];h.requires=e.concat(["button"])}r=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar",{name:"contextmenu"},{name:"bubbleview"},{name:"select"}].concat(r);
q=0;for(f=r.length;q<f;q++){h=r[q];e=h.name||h;o[e]={attach:u,charset:"utf-8",requires:h.requires,csspath:h.Pf?J("plugins/"+e+"/plugin.css"):B,path:J("plugins/"+e+"/plugin.js")}}v.add(o);p.Editor=v;p.Editor=v});
KISSY.Editor.add("utils",function(p){var B=U,v=KISSY,J=v.Node,A=v.DOM,z=v.UA,u=v.Event,r;if(z.ie)r=document.documentMode||z.ie;var q={Tc:function(f){var h=v.Config.debug;f=h?h==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-12-10 20:36:53");return f},Fe:function(f,h,e){var o=f[h],y=f[e];f[h]=function(){o.apply(this,arguments);f[h]=f[e];return y.apply(this,arguments)}},we:function(f,h,e,o){e=e.defaultView||e.parentWindow;f-=A.scrollLeft(e);
h-=A.scrollTop(e);if(o)if(e!=(o.defaultView||o.parentWindow)&&e.frameElement){o=A.Gb(e.frameElement,o);f+=o.left;h+=o.top}return{left:f,top:h}},Cd:function(){for(var f,h=0,e=arguments.length;h<e;h++){var o=arguments[h];try{f=o();break}catch(y){}}return f},be:function(f,h){if(!f&&!h)return T;if(!f||!h||f.length!=h.length)return Y;for(var e=0;e<f.length;e++)if(f[e]!==h[e])return Y;return T},Xc:function(f,h,e){f=f.documentElement;for(var o=0;f&&o<h.length;o++){var y=h[o];if(e)for(var i=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(e===T&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){i++;if(i==y){f=b;break}}}else f=f.childNodes[y]}return f?new J(f):B},je:function(f){for(var h in f)f[h].Bc(f,T)},cc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ka:function(f){return f.replace(/^\s+/,"")},Ma:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ka(this.Ma(f))},mix:function(){for(var f={},h=0;h<arguments.length;h++)f=v.mix(f,arguments[h]);
return f},ib:function(){if(!z.ie)return Y;var f=document.domain,h=window.location.hostname;return f!=h&&f!="["+h+"]"},oe:function(f,h){return Array(h+1).join(f)},Se:function(f,h,e){e=e||150;if(e===-1)return function(){f.apply(h,arguments)};var o=(new Date).getTime();return function(){var y=(new Date).getTime();if(y-o>e){o=y;f.apply(h,arguments)}}},ee:function(f,h,e){e=e||0;var o=B;return function(){o&&clearTimeout(o);var y=arguments;o=setTimeout(function(){return f.apply(h,y)},e)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(v.trim(f))},
Ue:function(f){for(var h=0;h<f.length;h++){var e=A.D(f[h]),o=v.trim(e.val()),y=e.attr("data-verify");e=e.attr("data-warning");if(y&&!RegExp(y).test(o)){alert(e);return Y}}return T},Qe:function(f,h){f.on("sourcemode",h.xf,h);f.on("wysiwygmode",h.Df,h)},Me:function(f){var h=f.attr("placeholder");if(h&&!z.webkit){f.addClass("ke-input-tip");f.val(h)}else z.webkit&&f.val("")},Qf:function(f,h){f.removeClass("ke-input-tip");f.val(h)},Ie:function(f,h){f.attr("placeholder",h);if(!z.webkit){f.on("blur",function(){if(!v.trim(f.val())){f.addClass("ke-input-tip");
f.val(h)}});f.on("focus",function(){f.removeClass("ke-input-tip");v.trim(f.val())==h&&f.val("")})}},he:function(f){f=f[0]||f;for(var h=v.makeArray(f.childNodes),e=0;e<h.length;e++){var o=h[e];o.nodeType==p.n.f&&!v.trim(o.nodeValue)&&f.removeChild(o)}},ze:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ye:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},qe:function(f,
h){return f.toLowerCase()==h.toLowerCase()},ld:function(f){f=v.clone(f);for(var h in f)if(f.hasOwnProperty(h)){var e=f[h];if(v.isFunction(e))f[h]=e()}return f},ne:function(f,h,e){function o(){var x={responseText:"",responseXML:B};x.ae=f?f.ae:B;try{var n;if((n=z.ie?i.contentWindow.document:i.contentDocument||window.frames[y].document)&&n.body)x.responseText=n.body.innerHTML;x.responseXML=n&&n.XMLDocument?n.XMLDocument:n}catch(E){v.log(E)}u.remove(i,"load",o);f.fe&&f.fe(x);setTimeout(function(){A.h(i)},
100)}var y=v.guid("form-upload-"),i=document.createElement("iframe");i.id=y;i.name=y;i.className="ke-hidden";var a="document.open();"+(q.ib()?'document.domain="'+document.domain+'";':"")+"document.close();";if(z.ie)i.src=z.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";v.log("doFormUpload : "+i.src);document.body.appendChild(i);if(z.ie)document.frames[y].name=y;a=A.Jc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=y;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(e)a.action=e;var d;if(h){d=[];h=p.l.ld(h);for(var j in h)if(h.hasOwnProperty(j)){e=document.createElement("input");e.type="hidden";e.name=j;e.value=h[j];a.appendChild(e);d.push(e)}}u.on(i,"load",o);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(d){h=0;for(j=d.length;h<j;h++)A.h(d[h])}return i},o:function(f,h){for(var e in h)f[e]=h[e]},map:function(f,h){for(var e=0;e<f.length;e++)f[e]=
h(f[e]);return f},dc:r,Ke:function(f){z.ie?f.Ic():f.attr("onmousedown","return false;")},Ef:function(f){f=f.attributes;return f.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(f.src||"")}};p.l=q;p.Utils=q;q.o(q,{debugUrl:q.Tc,lazyRun:q.Fe,getXY:q.we,tryThese:q.Cd,arrayCompare:q.be,getByAddress:q.Xc,clearAllMarkers:q.je,htmlEncodeAttr:q.cc,ltrim:q.Ka,rtrim:q.Ma,trim:q.trim,mix:q.mix,isCustomDomain:q.ib,duplicateStr:q.oe,buffer:q.ee,isNumber:q.isNumber,verifyInputs:q.Ue,sourceDisable:q.Qe,
resetInput:q.Me,placeholder:q.Ie,clean:q.he,htmlEncode:q.ze,htmlDecode:q.ye,equalsIgnoreCase:q.qe,normParams:q.ld,throttle:q.Se,doFormUpload:q.ne,map:q.map})});
KISSY.Editor.add("dom",function(p){function B(a){if(a&&!a[0])return new r(a);return a}function v(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var A=KISSY,z=A.DOM,u=A.UA,r=A.Node,q=p.l,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};p.n={e:1,f:3,Hd:8,gf:11};p.NODE=p.n;p.Ta={ca:0,Id:1,ba:2,X:4,W:8,xc:16};p.POSITION=
p.Ta;var h=p.n,e=p.Ta,o={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},i={D:B,Jc:v,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return Y;a=v(a);b=v(b);return a===b},pa:function(a,b){a=B(a);var d=A.mix(A.mix({},y),b||{});return o[a.css("display")]||d[a.d()]},ea:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
Y},v:function(a){a=v(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Md:function(a,b){a=v(a);var d=a.firstChild;if((d=d&&new r(d))&&b&&!b(d))d=d.Ca(b);return d},Gc:function(a,b,d){a=v(a);z.h(a);b=v(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=v(a);var b=a.nodeName.toLowerCase();if(u.ie)if((a=a.Kf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Ec:function(a,b){if(a.d()!=b.d())return Y;var d=a[0].attributes,j=b[0].attributes,x=d.length,
n=j.length;if(x!=n)return Y;for(var E=0;E<x;E++){var k=d[E],s=k.name;if(k.specified&&a.attr(s)!=b.attr(s))return Y}if(q.dc<8)for(E=0;E<n;E++){k=j[E];s=k.name;if(k.specified&&a.attr(s)!=b.attr(s))return Y}return T},Hb:function(a){a=v(a).childNodes;for(var b=0,d=a.length;b<d;b++){var j=a[b],x=j.nodeType;if(!(x==h.e&&j.getAttribute("_ke_bookmark")))if(x==h.e&&!i.Hb(j)||x==h.f&&A.trim(j.nodeValue))return Y}return T},Ib:function(a,b,d){a=v(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},qa:function(){function a(b,d,j){if(d[0]&&d[0].nodeType==h.e){for(var x=[];d.attr("_ke_bookmark")||d.Hb();){x.push(d);d=j?new r(d[0].nextSibling):new r(d[0].previousSibling);if(!d[0]||d[0].nodeType!=h.e)return}if(b.Ec(d)){for(var n=j?b[0].lastChild:b[0].firstChild;x.length;)x.shift().Gc(b,!j);d.Ib(b,!j);d.h();n[0]&&n[0].nodeType==h.e&&n.qa()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new r(b[0].nextSibling),T);
a(b,new r(b[0].previousSibling))}}}(),Ic:u.gecko?function(a){a=v(a);a.style.MozUserSelect="none"}:u.webkit?function(a){a=v(a);a.style.df="none"}:function(a){a=v(a);if(u.ie||u.opera){var b=0;a.setAttribute("unselectable","on");for(var d=a.getElementsByTagName("*");a=d[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},Gb:function(a,b){a=v(a);var d,j=0;d=0;var x=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,
n=a.ownerDocument,E=n.documentElement;b=b||n;if(a.getBoundingClientRect){if(a!==n.body&&E!==a){d=a.getBoundingClientRect();j=d.left+(b===n?z.scrollLeft(x):0);d=d.top+(b===n?z.scrollTop(x):0)}if(b)if(x!=(b.defaultView||b.parentWindow)&&x.frameElement){x=i.Gb(x.frameElement,b);j+=x.left;d+=x.top}}return{left:j,top:d}},Od:function(a){return(a=v(a))&&a.contentWindow.document},ga:function(a,b){a=v(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=h.f)){if(u.ie&&b==a.nodeValue.length){var j=d.createTextNode("");
z.insertAfter(j,a);return new r(j)}j=new r(a.splitText(b));if(d.documentMode){d=d.createTextNode("");z.insertAfter(d,j[0]);z.h(d)}return j}},Jb:function(a,b){a=B(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=v(a);a=a.cloneNode(b);if(!d){var j=function(x){if(x.nodeType==h.e){x.removeAttribute("id");x=x.childNodes;for(var n=0;n<x.length;n++)j(x[n])}};j(a)}return new r(a)},w:function(a,b,d,j){a=v(a);if(j&&!j.call){var x=j[0]||j;j=function(E){E=E[0]||E;return E!==
x}}b=!b&&a.firstChild;var n=new r(a);if(!b){if(a.nodeType==h.e&&j&&j(a,T)===Y)return U;b=a.nextSibling}for(;!b&&(n=n.parent());){if(j&&j(n,T)===Y)return U;b=n[0].nextSibling}if(!b)return U;b=z.D(b);if(j&&j(b)===Y)return U;if(d&&d!=b[0].nodeType)return b.w(Y,d,j);return b},fa:function(a,b,d,j){a=v(a);if(j&&!j.call){var x=j[0]||j;j=function(E){E=E[0]||E;return E!==x}}b=!b&&a.lastChild;var n=new r(a);if(!b){if(a.nodeType==h.e&&j&&j(a,T)===Y)return U;b=a.previousSibling}for(;!b&&(n=n.parent());){if(j&&
j(n,T)===Y)return U;b=n[0].previousSibling}if(!b)return U;b=z.D(b);if(j&&j(b)===Y)return U;if(d&&b[0].nodeType!=d)return b.fa(Y,d,j);return b},Fb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=h.f&&b.contains(a))return b;var d=a[0].nodeType==h.f?a.parent():a;do if(d[0].nodeType!=h.f&&d.contains(b))return d;while(d=d.parent());return U},Kd:function(a,b,d){a=v(a);if(!d)a=a.parentNode;if(b&&!A.isFunction(b)){var j=b;b=function(x){return x.d()==j}}for(;a&&a.nodeType!=9;){if(!b||b(new r(a))===T)return new r(a);
a=a.parentNode}return U},Cc:q.dc<9?function(a,b){a=v(a);var d=a.attributes[b];return!!(d&&d.specified)}:function(a,b){a=v(a);return a.hasAttribute(b)},Ya:q.dc<9?function(a){a=v(a);for(var b=a.attributes,d=0;d<b.length;d++){var j=b[d];switch(j.name){case "class":if(a.getAttribute("class"))return T;break;default:if(j.specified)return T}}return Y}:function(a){a=v(a);u.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Da:function(a,b){var d=v(a),j=v(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(j);
if(d==j)return e.ca;if(d.nodeType==h.e&&j.nodeType==h.e){if(d.contains){if(d.contains(j))return e.xc+e.X;if(j.contains(d))return e.W+e.ba}if("sourceIndex"in d)return d.sourceIndex<0||j.sourceIndex<0?e.Id:d.sourceIndex<j.sourceIndex?e.X:e.ba}d=a.Ba();j=b.Ba();for(var x=Math.min(d.length,j.length),n=0;n<=x-1;n++)if(d[n]!=j[n]){if(n<x)return d[n]<j[n]?e.X:e.ba;break}return d.length<j.length?e.xc+e.X:e.W+e.ba},Ba:function(a,b){a=v(a);for(var d=[],j=a.ownerDocument.documentElement,x=a;x&&x!=j;){var n=
x.parentNode,E=-1;if(n){for(var k=0;k<n.childNodes.length;k++){var s=n.childNodes[k];if(!(b&&s.nodeType==3&&s.previousSibling&&s.previousSibling.nodeType==3)){E++;if(s==x)break}}d.unshift(E)}x=n}return d},Eb:function(a,b){var d=new p.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var j=d.extractContents();d.insertNode(a.h());a[0].parentNode.insertBefore(j,a[0].nextSibling)},L:function(a,b,d){a=B(a);if(d!==undefined)return a.css(b,d);a=v(a);return a.style[J(b)]},h:function(a,b){var d=
v(a),j=d.parentNode;if(j){if(b)for(var x;x=d.firstChild;)j.insertBefore(d.removeChild(x),d);j.removeChild(d)}return a},$a:function(a){z.Fc(a);z.Hc(a)},Fc:function(a){a=v(a);for(var b;b=a.firstChild;){if(b.nodeType==h.f){var d=q.Ka(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<j){(new r(b)).ga(j-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Hc:function(a){a=v(a);for(var b;b=a.lastChild;){if(b.type==h.f){var d=q.Ma(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<
j){(new r(b)).ga(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!u.ie&&!u.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Db:function(a){a=v(a);for(var b=a.lastChild;b&&b.nodeType==h.f&&!A.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==h.f||z.d(b)!=="br"){b=u.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");u.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},ra:function(a,
b){var d=v(a),j;do j=(d=d.previousSibling)&&new r(d);while(j&&b&&!b(j));return j},Qd:function(a,b){a=z.D(a);var d=a[0].lastChild;if((d=d&&new r(d))&&b&&!b(d))d=d.ra(b);return d},Ca:function(a,b){var d=v(a),j;do j=(d=d.nextSibling)&&new r(d);while(j&&b&&!b(j));return j},Za:function(a){a=v(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},Rd:function(a,b,d,j){a=z.D(a);var x=a.data("list_marker_id")||
a.data("list_marker_id",A.guid()).data("list_marker_id"),n=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[x]=a;n[d]=1;return a.data(d,j)},Bc:function(a,b,d){a=B(a);var j=a.data("list_marker_names"),x=a.data("list_marker_id"),n;for(n in j)a.removeData(n);a.removeData("list_marker_names");if(d){a.removeData("list_marker_id");delete b[x]}},Ld:function(a,b,d){a=v(a);b=B(b);var j=a.attributes;d=d||{};for(var x=0;x<j.length;x++){var n=j[x],E=n.name.toLowerCase(),
k;if(!(E in d))if(E=="checked"&&(k=z.attr(a,E)))b.attr(E,k);else if(n.specified||u.ie&&n.value&&E=="value"){k=z.attr(a,E);if(k===U)k=n.nodeValue;b.attr(E,k)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Dc:function(a){a=z.d(a);var b=p.m;return(a=!b.uc[a]&&(b[a]||b.span))&&a["#"]},Kb:function(a){a=B(a);var b=a[0].ownerDocument,d=z.scrollLeft(b),j=z.scrollTop(b),x=a.offset(),n=x.left;x=x.top;if(z.viewportHeight(b)+j<x||x<j||z.viewportWidth(b)+d<n||n<d)a.scrollIntoView(b)},Nd:function(a,
b,d){a=v(a);if(!u.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new r(a[b]));return d}};A.DOM.Pd=function(a){A.mix(z,a);for(var b in a)a.hasOwnProperty(b)&&function(d){r.prototype[d]=function(){var j=[].slice.call(arguments,0);j.unshift(this);return a[d].apply(U,j)}}(b)};q.o(i,{_4e_wrap:i.D,_4e_unwrap:i.Jc,_4e_equals:i.g,_4e_isBlockBoundary:i.pa,_4e_getWin:i.ea,_4e_index:i.v,_4e_first:i.Md,_4e_move:i.Gc,_4e_name:i.d,_4e_isIdentical:i.Ec,_4e_isEmptyInlineRemoveable:i.Hb,
_4e_moveChildren:i.Ib,_4e_mergeSiblings:i.qa,_4e_unselectable:i.Ic,_4e_getOffset:i.Gb,_4e_getFrameDocument:i.Od,_4e_splitText:i.ga,_4e_parents:i.Jb,_4e_clone:i.K,_4e_nextSourceNode:i.w,_4e_previousSourceNode:i.fa,_4e_commonAncestor:i.Fb,_4e_ascendant:i.Kd,_4e_hasAttribute:i.Cc,_4e_hasAttributes:i.Ya,_4e_position:i.Da,_4e_address:i.Ba,_4e_breakParent:i.Eb,_4e_style:i.L,_4e_remove:i.h,_4e_trim:i.$a,_4e_ltrim:i.Fc,_4e_rtrim:i.Hc,_4e_appendBogus:i.Db,_4e_last:i.Qd,_4e_previous:i.ra,_4e_next:i.Ca,_4e_outerHtml:i.Za,
_4e_setMarker:i.Rd,_4e_clearMarkers:i.Bc,_4e_getUniqueId:i.pf,_4e_copyAttributes:i.Ld,_4e_isEditable:i.Dc,_4e_scrollIntoView:i.Kb,_4e_getElementsByTagName:i.Nd});z.Pd(i)});
KISSY.Editor.add("focusmanager",function(p){function B(){this.ec=f;r=this;J.log(this.Ea+" focus")}function v(){this.ec=h;r=e;J.log(this.Ea+" blur")}var J=KISSY,A=J.DOM,z=J.Event,u={},r,q={If:function(){for(var o in u){var y=u[o];y.document.designMode="off";y.document.designMode="on"}},wf:function(){return r},te:function(o){return u[o]},add:function(o){var y=A.ea(o.document);z.on(y,"focus",B,o);z.on(y,"blur",v,o)},Le:function(o){u[o.Ea]=o},remove:function(o){delete u[o.Ea];var y=A.ea(o.document);z.remove(y,
"focus",B,o);z.remove(y,"blur",v,o)}},f=T,h=Y,e=U;p.re=q;p.focusManager=q;p.$c=function(){return u};p.getInstances=p.$c});
KISSY.Editor.add("definition",function(p){var B=T,v=Y,J=p.l,A=document,z=KISSY,u=z.UA,r=z.DOM,q=z.Node,f=z.Event,h=p.re,e=J.Cd,o=J.Tc("theme/editor-iframe.css"),y=1,i="document.open();"+(J.ib()?'document.domain="'+A.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(u.ie?"javascript:void(function(){"+encodeURIComponent(i)+"}())":"")+'"  tabIndex="'+(u.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";p.zc=0;p.Xa=1;p.SOURCE_MODE=p.zc;p.WYSIWYG_MODE=p.Xa;z.augment(p,{Ae:function(b){if(u.ie)r.addClass(A.body,"ke-ie"+u.ie);else if(u.gecko)r.addClass(A.body,"ke-gecko");else u.webkit&&r.addClass(A.body,"ke-webkit");var d=this,j=new q(a.replace(/\$\(tabIndex\)/,b.attr("tabIndex")));
d.Bf=j;d.Ea=y++;h.Le(d);d.sb=j.one(".ke-textarea-wrap");d.wrap=d.sb;d.hb=d.sb.one("iframe");d.iframe=d.hb;d.Bd=j.one(".ke-editor-tools");d.toolBarDiv=d.Bd;d.Z=b;d.textarea=d.Z;d.Re=j.one(".ke-editor-status");d.statusDiv=d.Re;J.Ke(d.Bd);d.Lb={};d.Kc={};var x=b.L("width"),n=b.L("height");if(x){j.css("width",x);b.css("width","100%")}d.Z.css("display","none");j.insertAfter(b);d.sb[0].appendChild(b[0]);if(n){d.sb.css("height",n);b.css("height","100%")}j=d.hb;d.on("dataReady",function(){d.Wd=B;p.fire("instanceCreated",
{pe:d})});u.gecko?j.on("load",d.Mc,d):d.Mc();d.ha.vf&&b[0].form&&d.Ud()},Ud:function(){(new q(this.Z[0].form)).on("submit",this.Ad,this)},Te:function(b,d){var j=this,x=p.jf;x.Ff();j.use(b,function(){var n=j.Yc(b);if(n){d(n);x.Of()}else z.later(arguments.callee,50,Y,j)})},Zd:function(b,d){this.Kc[b]=d},Yc:function(b){return this.Kc[b]},Xd:function(b,d){this.Lb[b]=d},xe:function(b){return this.Lb[b]},execCommand:function(b){var d=this.Lb[b],j=z.makeArray(arguments);j.shift();j.unshift(this);return d.exec.apply(d,
j)},Zb:function(){return this.Z.css("display")=="none"?p.Xa:p.zc},getData:function(b){var d;d=this.Zb()==p.Xa?this.document.body.innerHTML:this.Z.val();if(this.htmlDataProcessor)d=b?this.htmlDataProcessor.toHtml(d,"p"):this.htmlDataProcessor.toServer(d,"p");d=z.trim(d);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(d))d="";return d},setData:function(b){var d=b;if(this.htmlDataProcessor)d=this.htmlDataProcessor.toDataFormat(b,"p");this.document.body.innerHTML=d;this.Zb()!=p.Xa&&this.Z.val(b)},Ad:function(){this.Z.val(this.getData())},
Fa:function(b){b=b||0;return b+(this.ha.Fa||0)},qf:function(){return this.document.body.innerHTML},sf:function(b){this.document.body.innerHTML=b},Vd:function(b){var d=this.ha,j=d.ta,x="";if(j)for(var n=0;n<j.length;n++)x+='<link href="'+j[n]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+p.Config.base+o+"' rel='stylesheet'/><style>"+(d.Sb||"")+"</style>"+x+"</head><body class='ke-editor'>&nbsp;"+(b?'<script id="ke_actscript" type="text/javascript">'+
(J.ib()?'document.domain="'+A.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':"")+"</body></html>"},getSelection:function(){return p.Ac.getSelection(this.document)},focus:function(){var b=this.document,d=r.ea(b);u.webkit&&d&&d.parent&&d.parent.focus();u.webkit&&d&&d.focus();b&&b.body.focus();this.lb()},blur:function(){r.ea(this.document).blur();this.document&&this.document.body.blur()},Yd:function(b){var d=this.ha,j=this.document;d.Sb=d.Sb||"";d.Sb+="\n"+b;d=j.createElement("style");
j.getElementsByTagName("head")[0].appendChild(d);if(d.styleSheet)d.styleSheet.cssText=b;else d.appendChild(j.createTextNode(b))},uf:function(b){var d=this.ha,j=this.document;d.ta=d.ta||[];d.ta.push(b);d=j.createElement("link");d.rel="stylesheet";j.getElementsByTagName("head")[0].appendChild(d);d.href=b},Jf:function(b){for(var d=this.ha,j=z.makeArray(this.document.getElementsByTagName("link")),x=0;x<j.length;x++)j[x].href==b&&r.h(j[x]);d.ta=d.ta||[];d=d.ta;b=z.indexOf(b,d);b!=-1&&d.splice(b,1)},Mc:function(){function b(){E=
n.document;d.document=E;j.detach();E.open("text/html","replace");E.write(x);E.close()}var d=this,j=d.hb,x=d.Vd(d.Ea),n=j[0].contentWindow,E;try{E=n.document}catch(k){j[0].src=j[0].src;if(u.ie<7){setTimeout(b,10);return}}b()},ready:function(b){this.Wd?b():this.on("dataReady",b)},ab:function(){var b=this;b.Lc&&clearTimeout(b.Lc);b.Lc=setTimeout(function(){var d=b.getSelection();if(d&&!d.hd){var j=d.fb(),x=new p.Sa(j);if(!b.kc||!b.kc.Rc(x)){b.kc=x;b.fire("selectionChange",{selection:d,path:x,element:j})}}},
100)},lb:function(){this.kc=U;this.ab()},gd:function(b,d){var j=this;j.focus();var x=b.d(),n=p.m,E=p.na,k=p.n,s=n.Qa[x],I=j.getSelection(),w=I&&I.A(),c,g,m,t,l;if(!w||w.length==0){var C=arguments,O=C.callee;setTimeout(function(){O.apply(j,C)},30)}else{j.fire("save");for(var P=w.length-1;P>=0;P--){c=w[P];c.deleteContents();g=!P&&b||b.K(B);d&&d(g);if(s)for(;(t=c.ua(v,B))&&(l=n[t.d()])&&!(l&&l[x]);)if(t.d()in n.span)c.pc(t);else if(c.sa()&&c.ja()){c.setStartBefore(t);c.collapse(B);t.h()}else c.oc();
c.insertNode(g);m||(m=g)}if(m){x=m.w(B);n=j.document;l=p.m;if(l.sc[g.d()]){x=new q(n.createTextNode(" "));x.insertAfter(m)}else if(x){if(x.d()=="br"&&l[x.parent().d()].p){l=new q("<p>&nbsp;</p>",U,n);x[0].parentNode.replaceChild(l[0],x[0]);x=l}}else{l=new q("<p>&nbsp;</p>",U,n);l.insertAfter(m);x=l}c.H(m,E.t);x&&x[0].nodeType==k.e&&c.kb(x);I.rb([c]);j.focus();g&&g.Kb();setTimeout(function(){j.fire("save")},10);return g}}},Be:function(b){var d=this;if(d.htmlDataProcessor)b=d.htmlDataProcessor.toDataFormat(b);
if(u.webkit){var j=r.create(b,U,this.document);j=j.nodeType==11?z.makeArray(j.childNodes):[j];for(var x=0;x<j.length;x++)d.gd(new q(j[x]))}else{d.focus();x=(j=d.getSelection())&&j.A();if(!x||x.length==0){var n=arguments,E=n.callee;setTimeout(function(){E.apply(d,n)},30)}else{d.fire("save");if(u.ie){j=j.r();j.type=="Control"&&j.clear();j.createRange().pasteHTML(b)}else d.document.execCommand("inserthtml",v,b);d.focus();setTimeout(function(){d.fire("save")},10)}}}});p._initIFrame=function(b){function d(c){e(function(){n.designMode=
"on";setTimeout(function(){n.designMode="off";k.focus();if(!arguments.callee.Ne)arguments.callee.Ne=B},50)},function(){n.designMode="off";r.attr(k,"contentEditable",v);r.attr(k,"contentEditable",B);!c&&d(1)})}var j=h.te(b);b=j.Z[0];var x=j.hb[0].contentWindow,n=j.document,E=j.ha;r.h(n.getElementById("ke_actscript"));var k=n.body;if(u.ie){k.hideFocus=B;k.disabled=B;k.contentEditable=B;k.removeAttribute("disabled")}else setTimeout(function(){if(u.gecko||u.opera)k.contentEditable=B;else if(u.webkit)k.parentNode.contentEditable=
B;else n.designMode="on"},0);if(u.webkit){f.on(n,"click",function(c){var g=new q(c.target);z.inArray(g.d(),["input","select"])&&c.preventDefault()});f.on(n,"mouseup",function(c){var g=new q(c.target);z.inArray(g.d(),["input","textarea"])&&c.preventDefault()})}if(u.gecko||u.ie||u.opera){var s;s=new q(r.insertAfter((new q('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],b));s.on("focus",function(){j.focus()});j.tf=function(){u.gecko&&j.ec&&s[0].focus()};
j.on("destroy",function(){})}if(u.ie&&n.compatMode=="CSS1Compat"||u.gecko||u.opera){var I=new q(n.documentElement);I.on("mousedown",function(c){if((new q(c.target))[0]==I[0]){u.gecko&&d(v);s[0].focus()}})}f.on(x,"focus",function(){if(u.gecko)d(v);else u.opera&&k.focus();j.lb()});u.gecko&&f.on(j.document,"mousedown",function(){j.ec||d(v)});if(u.ie){f.on(n,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var g=j.getSelection(),m=g.$b();if(m){j.fire("save");var t=g.A()[0].O();m.h();g.wd([t]);j.fire("save");
c.preventDefault()}}});if(n.compatMode=="CSS1Compat"){var w={33:1,34:1};f.on(n,"keydown",function(c){c.keyCode in w&&setTimeout(function(){j.getSelection().scrollIntoView()},0)})}}setTimeout(function(){u.ie&&setTimeout(function(){if(n){k.runtimeStyle.marginBottom="0px";k.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){j.fire("dataReady");var c=E.zf,g=E.yf;if(c||g)try{n.execCommand("enableObjectResizing",v,!c);n.execCommand("enableInlineTableEditing",v,!g)}catch(m){f.on(k,u.ie?"resizestart":
"resize",function(t){var l=new q(t.target);if(c||l.d()==="table"&&g)t.preventDefault()})}},10);u.webkit&&f.on(n,"mousedown",function(c){c=new q(c.target);z.inArray(c.d(),["img","hr","input","textarea","select"])&&j.getSelection().nc(c)});u.gecko&&f.on(n,"dragstart",function(c){var g=new q(c.target);g.d()==="img"&&/ke_/.test(g[0].className)&&c.preventDefault()});h.add(j)};i=p.prototype;J.o(i,{setData:i.setData,getData:i.getData,insertElement:i.gd,insertHtml:i.Be,ready:i.ready,addCustomStyle:i.Yd,addCommand:i.Xd,
hasCommand:i.xe,execCommand:i.execCommand,useDialog:i.Te,addDialog:i.Zd,getDialog:i.Yc,getMode:i.Zb,sync:i.Ad,baseZIndex:i.Fa,getSelection:i.getSelection,focus:i.focus,blur:i.blur,notifySelectionChange:i.lb})});
KISSY.Editor.add("zindex",function(){var p=KISSY.Editor;if(!p.Dd){p.Dd={$e:1100,kf:1200,af:99999,ff:900,hf:9999,LOADING:11E3,ef:12E3,lf:1200};p.Fa=function(B){var v=B,J=p.$c(),A;for(A in J){if(!J.hasOwnProperty(A))return;v=Math.max(v,J[A].Fa(B))}return v};p.baseZIndex=p.Fa;p.zIndexManager=p.Dd}});
KISSY.Editor.add("dtd",function(p){p.m=function(){function B(E){for(var k=arguments.length-1;k>0;)KISSY.mix(E,arguments[k--]);return E}var v={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},A=B({a:1},J),z=B({iframe:1},A),u={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},r={ins:1,del:1,script:1,style:1},q=B({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},r),f=B({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},q),h=B({p:1},f);J=B({iframe:1},f,J);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=B({a:1},J),o={tr:1},y={"#":1},i=B({param:1},f),a=B({form:1},v,z,u,h),b={li:1},d={base:1,link:1,meta:1,title:1},j=B(d,{style:1,script:1}),x={head:1,body:1},n={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{vb:B({html:1},x,d),Qa:n,Ye:{body:1,div:1,td:1,th:1,caption:1,
form:1},sc:e,qc:B({script:1,style:1},n),rc:{script:1,style:1},tb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},ub:{dd:1,dt:1,li:1},Ed:{ul:1,ol:1,dl:1},uc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},aa:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},Ze:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},vc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:x,head:j,style:y,body:a,base:{},link:{},meta:{},title:y,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:B(h,u),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:b,h1:e,h3:e,option:y,h2:e,form:B(v,z,u,h),select:{optgroup:1,option:1},font:e,ins:e,menu:b,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:y,tfoot:o,cite:e,li:a,input:{},iframe:a,
strong:e,textarea:y,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:i,sup:e,dd:a,strike:e,area:{},dir:b,map:B({area:1,form:1,p:1},v,r,u),applet:i,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:B({legend:1},f),thead:o,ul:b,acronym:e,b:e,a:J,blockquote:a,caption:e,i:e,u:e,tbody:o,s:e,address:B(z,h),tt:e,legend:e,q:e,pre:B(q,A),p:e,em:e,dfn:e}}();p.XHTML_DTD=p.m});
KISSY.Editor.add("elementpath",function(p){function B(f){var h=z,e=z,o=[];for(f=f;f&&f[0];){if(f[0].nodeType==A.e){if(!this.Ee)this.Ee=f;var y=f.d();if(!e){if(!h&&u[y])h=f;if(r[y]){var i;if(i=!h){if(i=y=="div"){a:{i=f;i=i[0]||i;i=i.childNodes;for(var a=0,b=i.length;a<b;a++){var d=i[a];if(d.nodeType==A.e&&J.Qa[d.nodeName.toLowerCase()]){i=T;break a}}i=Y}i=!i}i=i}if(i)h=f;else e=f}}o.push(f);if(y=="body")break}f=f.parent()}this.block=this.z=h;this.blockLimit=this.F=e;this.elements=this.elements=o}var v=
KISSY.DOM,J=p.m,A=p.n,z=U,u={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},r={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};B.prototype={Rc:function(f){var h=this.elements;f=f&&f.elements;if(!f||h.length!=f.length)return Y;for(var e=0;e<h.length;e++)if(!v.g(h[e],f[e]))return Y;return T},contains:function(f){for(var h=this.elements,e=0;e<h.length;e++)if(h[e].d()in f)return h[e];return z}};p.ElementPath=p.Sa=B;var q=B.prototype;p.l.o(q,{compare:q.Rc,
contains:q.contains})});
KISSY.Editor.add("walker",function(p){function B(o,y){if(this.c.end)return u;var i,a=this.wa,b,d=this.ac,j=this.type,x=o?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return u}}if(!o&&!this.c.bd){var n=a.endContainer,E=new h(n[0].childNodes[a.endOffset]);this.c.bd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!f.g(n,w))&&(!E[0]||!w.g(E))&&(w[0].nodeType!=q.e||!c||w.d()!="body")}}if(o&&!this.c.cd){var k=a.startContainer,s=a.startOffset>
0&&new h(k[0].childNodes[a.startOffset-1]);this.c.cd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!w.g(k))&&(!s[0]||!w.g(s))&&(w[0].nodeType!=q.e||!c||w.d()!="body")}}var I=o?this.c.cd:this.c.bd;b=d?function(w,c){if(I(w,c)===z)return z;return d(w,c)}:I;if(this.db)i=this.db[x](z,j,b);else if(o){i=a.endContainer;if(a.endOffset>0){i=new h(i[0].childNodes[a.endOffset-1]);if(b(i)===z)i=u}else i=b(i,A)===z?u:i.fa(A,j,b)}else{i=a.startContainer;if((i=new h(i[0].childNodes[a.startOffset]))&&i[0]){if(b(i)===
z)i=u}else i=b(a.startContainer,A)===z?u:a.startContainer.w(A,j,b)}for(;i&&i[0]&&!this.c.end;){this.db=i;if(!this.Q||this.Q(i)!==z){if(!y)return i}else if(y&&this.Q)return z;i=i[x](z,j,b)}this.end();return this.db=u}function v(o){for(var y,i=u;y=B.call(this,o);)i=y;return i}function J(o){this.wa=o;this.c={}}var A=T,z=Y,u=U,r=KISSY,q=p.n,f=r.DOM,h=r.Node;r.augment(J,{end:function(){this.c.end=1},next:function(){return B.call(this)},ob:function(){return B.call(this,A)},Qc:function(){return B.call(this,
z,A)!==z},Pc:function(){return B.call(this,A,A)!==z},kd:function(){return v.call(this)},jd:function(){return v.call(this,A)},reset:function(){delete this.db;this.c={}}});J.Ob=function(o){return function(y){y=f.D(y);return!(y&&y[0].nodeType==q.e&&y.pa(o))}};J.He=function(){return this.Ob({Pb:1})};J.Ga=function(o,y){function i(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,d;b=a&&a[0]&&a[0].nodeType==q.f&&(d=a.parent())&&i(d);b=o?b:b||i(a);return y^b}};J.Pa=function(o){return function(y){y=
(y=y[0]||y)&&y.nodeType==q.f&&!r.trim(y.nodeValue);return o^y}};J.Ce=function(o){var y=J.Pa();return function(i){i=y(i)||i[0].nodeType==q.e&&!i[0].offsetHeight;return o^i}};p.Aa=J;p.Walker=J;var e=J.prototype;p.l.o(e,{end:e.end,next:e.next,previous:e.ob,checkForward:e.Qc,checkBackward:e.Pc,lastForward:e.kd,lastBackward:e.jd,reset:e.reset});p.l.o(J,{blockBoundary:J.Ob,listItemBoundary:J.He,bookmark:J.Ga,whitespaces:J.Pa,invisible:J.Ce})});
KISSY.Editor.add("range",function(p){function B(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=r;this.document=c}function v(c){var g=c[0].nodeType!=e.f&&c.d()in j.aa,m=!h.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return g||m||c}function J(c){return!s(c)&&!I(c)}function A(c){var g=q,m=i.Ga(r);return function(t){if(m(t))return r;if(t[0].nodeType==e.f){if(h.trim(t[0].nodeValue).length)return q}else if(t[0].nodeType==e.e)if(!k[t.d()])if(!c&&!d.ie&&
t.d()=="br"&&!g)g=r;else return q;return r}}function z(c,g){function m(t){return t&&t.nodeName=="span"&&t.getAttribute("_ke_bookmark")}return function(t){var l,C;l=t&&!t.nodeName&&(C=t.parentNode)&&m(C);l=c?l:l||m(t);return g^l}}function u(c){return function(g){g=(g=g[0]||g)&&g.nodeType==e.f&&!h.trim(g.nodeValue);return c^g}}p.na={V:1,J:2,C:3,t:4,yb:1,xb:2,Ra:3,Va:1,Gd:2,mf:3,da:1,yc:2};p.RANGE=p.na;var r=T,q=Y,f=U,h=KISSY,e=p.n,o=p.na,y=p.Ta,i=p.Aa,a=h.DOM,b=p.l.Xc,d=h.UA,j=p.m,x=p.Sa,n=h.Node,E=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};B.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};h.augment(B,{Oa:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},ic:function(){var c=this.startContainer,
g=this.startOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;g=this.endOffset;if(c[0].nodeType!=e.e)if(g)g>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},jc:function(){var c=
this.startContainer,g=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.T(c,o.C);g&&g.d()=="span"&&g.attr("_ke_bookmark")&&this.S(g,o.t)},setStart:function(c,g){if(c[0].nodeType==e.e&&E[c.d()]){c=c.parent();g=c.v()}this.startContainer=c;this.startOffset=g;if(!this.endContainer){this.endContainer=c;this.endOffset=g}this.Oa()},setEnd:function(c,g){if(c[0].nodeType==e.e&&E[c.d()]){c=c.parent();g=c.v()+1}this.endContainer=c;this.endOffset=g;if(!this.startContainer){this.startContainer=
c;this.startOffset=g}this.Oa()},T:function(c,g){switch(g){case o.V:this.setStart(c,0);break;case o.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case o.C:this.setStartBefore(c);break;case o.t:this.setStartAfter(c)}this.Oa()},S:function(c,g){switch(g){case o.V:this.setEnd(c,0);break;case o.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case o.C:this.setEndBefore(c);break;case o.t:this.setEndAfter(c)}this.Oa()},
Vb:function(c,g){var m=this.startContainer,t=this.endContainer,l=this.startOffset,C=this.endOffset,O,P=this.document,N;this.jc();if(t[0].nodeType==e.f)t=t.ga(C);else if(t[0].childNodes.length>0)if(C>=t[0].childNodes.length){t=new n(t[0].appendChild(P.createTextNode("")));N=r}else t=new n(t[0].childNodes[C]);if(m[0].nodeType==e.f){m.ga(l);if(m.g(t))t=new n(m[0].nextSibling)}else if(l)if(l>=m[0].childNodes.length){O=new n(P.createTextNode(""));m.append(O);m=O;O=r}else m=new n(m[0].childNodes[l].previousSibling);
else{O=new n(P.createTextNode(""));m.prepend(O);m=O;O=r}l=m.Jb();C=t.Jb();var Q,S,W;for(Q=0;Q<l.length;Q++){S=l[Q];W=C[Q];if(!S.g(W))break}P=g;for(var V,X,D,K=Q;K<l.length;K++){V=l[K];X=P&&!V.g(m)?P.appendChild(V.K()[0]):U;for(V=V[0].nextSibling;V;){if(a.g(C[K],V)||a.g(t,V))break;D=V.nextSibling;if(c==2)P.appendChild(V.cloneNode(r));else{a.h(V);c==1&&P.appendChild(V)}V=D}if(X)P=X}P=g;for(Q=Q;Q<C.length;Q++){V=C[Q];X=P&&c>0&&!V.g(t)?P.appendChild(V.K()[0]):U;if(!l[Q]||!V.parent().g(l[Q].parent()))for(V=
V[0].previousSibling;V;){if(a.g(l[Q],V)||a.g(m,V))break;D=V.previousSibling;if(c==2)P.insertBefore(V.cloneNode(r),P.firstChild);else{a.h(V);c==1&&P.insertBefore(V,P.firstChild)}V=D}if(X)P=X}if(c==2){W=this.startContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}W=this.endContainer[0];if(W.nodeType==e.f&&W.nextSibling&&W.nextSibling.nodeType==e.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}}else{if(S&&
W&&(!m.parent().g(S.parent())||!t.parent().g(W.parent()))){S=W.v();O&&W.parent().g(m.parent())&&S--;this.setStart(W.parent(),S)}this.collapse(r)}O&&m.h();N&&t[0].parentNode&&t.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=r},clone:function(){var c=new B(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},Zc:function(){var c=this.clone();c.ic();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return f;var g=new p.Aa(c),m=z(r,undefined),t=u(r);c.Q=function(l){return t(l)&&m(l)};c=g.next();g.reset();g=g.ob();return c&&c.g(g)?c:f},Na:function(c,g){if(!this.collapsed){c=c||o.yc;var m=this.clone(),t=this.startContainer,l=this.endContainer,C=this.startOffset,O=this.endOffset,P=1,N=1;if(t&&t[0].nodeType==e.f)if(C)if(C>=t[0].nodeValue.length)m.setStartAfter(t);
else{m.setStartBefore(t);P=0}else m.setStartBefore(t);if(l&&l[0].nodeType==e.f)if(O)if(O>=l[0].nodeValue.length)m.setEndAfter(l);else{m.setEndAfter(l);N=0}else m.setEndBefore(l);m=new i(m);m.Q=function(S){S=S[0]||S;return S.nodeType==(c==o.da?e.e:e.f)};var Q;m.ac=function(S,W){S=S[0]||S;if(c==o.da&&S.nodeType==e.f)return q;if(W&&S==Q)return q;if(!W&&S.nodeType==e.e)Q=S;return r};if(P)(t=m[c==o.da?"lastForward":"next"]())&&this.T(t,g?o.V:o.C);if(N){m.reset();(m=m[c==o.da?"lastBackward":"previous"]())&&
this.S(m,g?o.J:o.t)}return!!(P||N)}},ve:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Sc:function(c){var g=this.startContainer,m=this.endContainer,t=this.startOffset,l=this.endOffset,C,O;if(!g||!m)return{start:0,end:0};if(c){if(g[0].nodeType==e.e)if((C=new n(g[0].childNodes[t]))&&C[0]&&C[0].nodeType==e.f&&t>0&&C[0].previousSibling.nodeType==e.f){g=C;t=0}for(;g[0].nodeType==e.f&&(O=g.ra())&&O[0].nodeType==e.f;){g=O;t+=
O[0].nodeValue.length}if(!this.collapsed){if(m[0].nodeType==e.e)if((C=new n(m[0].childNodes[l]))&&C[0]&&C[0].nodeType==e.f&&l>0&&C[0].previousSibling.nodeType==e.f){m=C;l=0}for(;m[0].nodeType==e.f&&(O=m.ra())&&O[0].nodeType==e.f;){m=O;l+=O[0].nodeValue.length}}}return{start:g.Ba(c),end:this.collapsed?f:m.Ba(c),startOffset:t,endOffset:l,md:c,De:r}},O:function(c){var g,m,t,l,C=this.collapsed;g=new n("<span>",f,this.document);g.attr("_ke_bookmark",1);g.css("display","none");g.html("&nbsp;");if(c){t=
h.guid("ke_bm_");g.attr("id",t+"S")}if(!C){m=g.K();m.html("&nbsp;");c&&m.attr("id",t+"E");l=this.clone();l.collapse();l.insertNode(m)}l=this.clone();l.collapse(r);l.insertNode(g);if(m){this.setStartAfter(g);this.setEndBefore(m)}else this.H(g,o.t);return{Y:c?t+"S":g,P:c?t+"E":m,yd:c,collapsed:C}},H:function(c,g){this.T(c,g);this.collapse(r)},trim:function(c,g){var m=this.startContainer,t=this.startOffset,l=this.collapsed;if((!c||l)&&m[0]&&m[0].nodeType==e.f){if(t)if(t>=m[0].nodeValue.length){t=m.v()+
1;m=m.parent()}else{var C=m.ga(t);t=m.v()+1;m=m.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(a.g(m,this.endContainer))this.endOffset+=1}else{t=m.v();m=m.parent()}this.setStart(m,t);if(l){this.collapse(r);return}}m=this.endContainer;t=this.endOffset;if(!(g||l)&&m[0]&&m[0].nodeType==e.f){if(t){t>=m.nodeValue.length||m.ga(t);t=m.v()+1}else t=m.v();m=m.parent();this.setEnd(m,t)}},insertNode:function(c){this.jc();this.trim(q,r);var g=this.startContainer;
g[0].insertBefore(c[0]||c,g[0].childNodes[this.startOffset]||U);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.De){var g=b(this.document,c.start,c.md),m=c.startOffset,t=c.end&&b(this.document,c.end,c.md);c=c.endOffset;this.setStart(g,m);t?this.setEnd(t,c):this.collapse(r)}else{g=(m=c.yd)?h.one("#"+c.Y,this.document):c.Y;c=m?h.one("#"+c.P,this.document):c.P;this.setStartBefore(g);g.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(r)}},
ua:function(c,g){var m=this.startContainer,t=this.endContainer;m=a.g(m,t)?c&&m[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new n(m[0].childNodes[this.startOffset]):m:m.Fb(t);return g&&m[0].nodeType==e.f?m.parent():m},Ia:function(c){switch(c){case o.yb:if(this.collapsed)break;c=this.ua();var g=new n(this.document.body),m,t,l,C,O,P=q,N,Q;N=this.startContainer;Q=this.startOffset;if(N[0].nodeType==e.f){if(Q){N=!h.trim(N[0].nodeValue.substring(0,Q)).length&&N;P=!!N}if(N)if(!(C=N[0].previousSibling))l=
N.parent()}else{if(Q)C=N[0].childNodes[Q-1]||N[0].lastChild;C||(l=N)}for(;l||C;){if(l&&!C){if(!O&&a.g(l,c))O=r;if(!g.contains(l))break;if(!P||l.css("display")!="inline"){P=q;if(O)m=l;else this.setStartBefore(l)}C=l[0].previousSibling}for(;C;){N=q;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;N=/[\s\ufeff]$/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(P&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else for(var S=C.all||C.getElementsByTagName("*"),
W=0,V;V=S[W++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}if(C)N=!!Q.length}else C=f;if(N)if(P)if(O)m=l;else l&&this.setStartBefore(l);else P=r;if(C){N=C.previousSibling;if(!l&&!N){l=new n(C);C=f;break}C=N}else l=f}if(l)l=l.parent()}N=this.endContainer;Q=this.endOffset;l=C=f;O=P=q;if(N[0].nodeType==e.f){N=!h.trim(N[0].nodeValue.substring(Q)).length&&N;P=!(N&&N[0].nodeValue.length);if(N)if(!(C=N[0].nextSibling))l=N.parent()}else(C=N[0].childNodes[Q])||(l=N);for(;l||C;){if(l&&!C){if(!O&&a.g(l,c))O=
r;if(!g.contains(l))break;if(!P||l.css("display")!="inline"){P=q;if(O)t=l;else l&&this.setEndAfter(l)}C=l[0].nextSibling}for(;C;){N=q;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;N=/^[\s\ufeff]/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(P&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else{S=C.all||C.getElementsByTagName("*");for(W=0;V=S[W++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}}if(C)N=!!Q.length}else C=f;if(N)if(P)if(O)t=
l;else this.setEndAfter(l);if(C){N=C.nextSibling;if(!l&&!N){l=new n(C);C=f;break}C=N}else l=f}if(l)l=l.parent()}if(m&&t){c=m.contains(t)?t:m;this.setStartBefore(c);this.setEndAfter(c)}break;case o.xb:case o.Ra:l=new B(this.document);g=new n(this.document.body);l.T(g,o.V);l.setEnd(this.startContainer,this.startOffset);l=new i(l);var X,D,K=i.Ob(c==o.Ra?{Pb:1}:f),G=function(F){var H=K(F);H||(X=F);return H};m=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")D=F;return H};l.ac=G;l=l.jd();X=X||g;this.T(X,
X.d()!="br"&&(!l&&this.sa()||l&&X.contains(l))?o.V:o.t);l=this.clone();l.collapse();l.S(g,o.J);l=new i(l);l.ac=c==o.Ra?m:G;X=f;l=l.kd();X=X||g;this.S(X,!l&&this.ja()||l&&X.contains(l)?o.J:o.C);D&&this.setEndAfter(D)}},sa:function(){var c=this.startContainer,g=this.startOffset;if(g&&c[0].nodeType==e.f)if(h.trim(c[0].nodeValue.substring(0,g)).length)return q;this.trim();c=new x(this.startContainer);g=this.clone();g.collapse(r);g.T(c.z||c.F,o.V);c=new i(g);c.Q=A(r);return c.Pc()},ja:function(){var c=
this.endContainer,g=this.endOffset;if(c[0].nodeType==e.f)if(h.trim(c[0].nodeValue.substring(g)).length)return q;this.trim();c=new x(this.endContainer);g=this.clone();g.collapse(q);g.S(c.z||c.F,o.J);c=new i(g);c.Q=A(q);return c.Qc()},deleteContents:function(){this.collapsed||this.Vb(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Vb(1,c);return c},Rb:function(c,g){var m=this.clone();m[g==o.Va?"setStartAt":"setEndAt"](c,g==o.Va?o.V:o.J);m=new i(m);m.Q=
v;return m[g==o.Va?"checkBackward":"checkForward"]()},Wc:function(){var c=this.startContainer,g=this.endContainer,m=this.startOffset,t=this.endOffset,l;if(c[0].nodeType==e.e){l=c[0].childNodes.length;if(l>m)c=new n(c[0].childNodes[m]);else if(l<1)c=c.fa();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new n(c);c=c.w()||c}}if(g[0].nodeType==e.e){l=g[0].childNodes.length;if(l>t)g=(new n(g[0].childNodes[t])).fa(r);else if(l<1)g=g.fa();else{for(g=g[0];g.lastChild;)g=g.lastChild;g=new n(g)}}if(c.Da(g)&y.ba)c=
g;return{Y:c,P:g}},eb:function(c,g){var m=this.O(),t=new n(this.document.createElement(g));this.collapse(c);this.Ia(o.xb);t[0].appendChild(this.extractContents());t.$a();d.ie||t.Db();this.insertNode(t);this.moveToBookmark(m);return t},oc:function(c){var g=new x(this.startContainer),m=new x(this.endContainer),t=g.z,l=m.z,C=f;if(!g.F.g(m.F))return f;if(c!="br"){if(!t){t=this.eb(r,c);l=(new x(this.endContainer)).z}l||(l=this.eb(q,c))}c=t&&this.sa();g=l&&this.ja();this.deleteContents();if(t&&a.g(t,l))if(g){C=
new x(this.startContainer);this.H(l,o.t);l=f}else if(c){C=new x(this.startContainer);this.H(t,o.C);t=f}else{l=this.pc(t);!d.ie&&!h.inArray(t.d(),["ul","ol"])&&t.Db()}return{Hf:t,Gf:l,We:c,Ve:g,Cf:C}},pc:function(c){if(!this.collapsed)return f;this.S(c,o.J);var g=this.extractContents(),m=c.K(q);m[0].appendChild(g);m.insertAfter(c);this.H(c,o.t);return m},kb:function(c,g){var m,t=p.m;if(t.tb[c.d()])return q;for(;c&&c[0].nodeType==e.e;){if(m=c.Dc())this.H(c,g?o.J:o.V);else if(t.sc[c.d()]){this.H(c,g?
o.t:o.C);return r}if((c=t.tb[c.d()]?c[g?"_4e_previous":"_4e_next"](J):c[g?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,g?o.t:o.C);return r}}return m},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var k={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},s=new i.Pa,I=new i.Ga;p.Range=
B;p.Range=B;var w=B.prototype;p.l.o(w,{updateCollapsed:w.Oa,optimize:w.ic,setStartAfter:w.setStartAfter,setEndAfter:w.setEndAfter,setStartBefore:w.setStartBefore,setEndBefore:w.setEndBefore,optimizeBookmark:w.jc,setStart:w.setStart,setEnd:w.setEnd,setStartAt:w.T,setEndAt:w.S,execContentsAction:w.Vb,collapse:w.collapse,clone:w.clone,getEnclosedNode:w.Zc,shrink:w.Na,getTouchedStartNode:w.ve,createBookmark2:w.Sc,createBookmark:w.O,moveToPosition:w.H,trim:w.trim,insertNode:w.insertNode,moveToBookmark:w.moveToBookmark,
getCommonAncestor:w.ua,enlarge:w.Ia,checkStartOfBlock:w.sa,checkEndOfBlock:w.ja,deleteContents:w.deleteContents,extractContents:w.extractContents,checkBoundaryOfElement:w.Rb,getBoundaryNodes:w.Wc,fixBlock:w.eb,splitBlock:w.oc,splitElement:w.pc,moveToElementEditablePosition:w.kb,selectNodeContents:w.selectNodeContents})});
KISSY.Editor.add("domiterator",function(p){function B(i){if(!(arguments.length<1)){this.wa=i;this.Xb=J;this.Vc=v;this.Ub=J;this.c||(this.c={})}}var v=T,J=Y,A=KISSY,z=A.UA,u=p.Aa,r=p.Range,q=p.na,f=p.n,h=p.Sa,e=A.Node,o=A.DOM,y=/^[\r\n\t ]*$/;A.augment(B,{ue:function(i){var a,b,d,j,x;if(!this.c.I){b=this.wa.clone();b.Na(q.da,v);b.Ia(this.Xb||!this.Vc?q.Ra:q.xb);var n=new u(b),E=u.Ga(v,v);n.Q=E;this.c.ka=n.next();n=new u(b);n.Q=E;n=n.ob();this.c.I=n.w(v);if(this.c.I&&this.c.I[0].nodeType==f.f&&!A.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().pa()){E=new r(b.document);E.H(this.c.I,q.t);if(E.ja()){E=new h(E.endContainer);this.c.I=(E.z||E.F).w(v)}}if(!this.c.I){this.c.I=this.c.Uc=new e(b.document.createTextNode(""));o.insertAfter(this.c.I[0],n[0])}b=U}E=this.c.ka;n=this.c.I;for(this.c.ka=U;E;){var k=J,s=E[0].nodeType!=f.e,I=J;if(s){if(E[0].nodeType==f.f)if(y.test(E[0].nodeValue))s=J}else{var w=E.d();if(E.pa(this.Xb&&{Pb:1})){if(w=="br")s=v;else if(!b&&!E[0].childNodes.length&&w!="hr"){a=E;d=E.g(n);break}if(b){b.S(E,q.C);
if(w!="br")this.c.ka=E}k=v}else{if(E[0].firstChild){if(!b){b=new r(this.wa.document);b.T(E,q.C)}E=new e(E[0].firstChild);continue}s=v}}if(s&&!b){b=new r(this.wa.document);b.T(E,q.C)}d=(!k||s)&&E.g(n);if(b&&!k)for(;!E[0].nextSibling&&!d;){w=E.parent();if(w.pa(this.Xb&&{Pb:1})){k=v;d||w.g(n);break}E=w;s=v;d=E.g(n);I=v}s&&b.S(E,q.t);E=E.w(I,U,n);if((d=!E)||k&&b)break}if(!a){if(!b){this.c.Uc&&this.c.Uc.h();return this.c.ka=U}a=new h(b.startContainer);E=a.F;k={Af:1,Nf:1,Mf:1};a=a.z;if((!a||!a[0])&&!this.Ub&&
k[E.d()]&&b.sa()&&b.ja())a=E;else if(!a||this.Ub&&a.d()=="li"){a=new e(this.wa.document.createElement(i||"p"));a[0].appendChild(b.extractContents());a.$a();b.insertNode(a);j=x=v}else if(a.d()!="li"){if(!b.sa()||!b.ja()){a=a.K(J);a[0].appendChild(b.extractContents());a.$a();x=b.oc();j=!x.We;x=!x.Ve;b.insertNode(a)}}else if(!d)this.c.ka=a.g(n)?U:b.Wc().P.w(v,U,n)}if(j){b=new e(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&o.d(b[0].lastChild)=="br"&&o.h(b[0].lastChild)}if(x){b=
u.Ga(J,v);j=new e(a[0].lastChild);if(j[0]&&j[0].nodeType==f.e&&j.d()=="br")if(z.ie||j.ra(b)||j.Ca(b))j.h()}if(!this.c.ka)this.c.ka=d||a.g(n)?U:a.w(v,U,n);return a}});r.prototype.me=function(){return new B(this)}});
KISSY.Editor.add("selection",function(p){function B(k){this.document=this.document=k;this.c={M:{}};if(a){var s=this.r().createRange();if(!s||s.item&&s.item(0).ownerDocument!=k||s.parentElement&&s.parentElement().ownerDocument!=k)this.hd=A}}function v(k){k=new B(k);return!k||k.hd?u:k}function J(k){var s=k.document,I=new e(s.body),w=new e(s.documentElement);if(q.ie){if(q.ie<8||document.documentMode==7)w.on("click",function(N){(new e(N.target)).d()==="html"&&k.getSelection().A()[0].select()});var c,
g,m=1;w.on("mousedown",function(){m=0});w.on("mouseup",function(){m=1});I.on("focusin",function(N){if((new e(N.target)).d()=="body")if(c){try{m&&c.select()}catch(Q){}c=u}});I.on("focus",function(){g=A;l()});I.on("beforedeactivate",function(N){if(!N.relatedTarget){g=z;m=1}});h.on(f.ea(s),"blur",function(){s&&s.selection.empty()});I.on("mousedown",function(){t()});I.on("mouseup",function(){g=A;setTimeout(function(){l(A)},0)});var t=function(){g=z},l=function(N){if(g){var Q=k.document,S=k.getSelection(),
W=S&&S.gb(),V=S&&S.r();if(N&&V&&W==o.Ab)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){l(A)},50);return}var X;if(!(V&&W==o.oa&&(X=f.d(S.fb()))&&X in{input:1,textarea:1})){c=V&&S.A()[0];k.ab()}}};I.on("keydown",t);I.on("keyup",function(){g=A;l()});h.on(s,"selectionchange",l)}else{h.on(s,"mouseup",k.ab,k);h.on(s,"keyup",k.ab,k)}var C={table:1,pre:1},O=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,P=p.Aa.Pa(A);k.on("selectionChange",
function(N){var Q=N.path;N=(N=N.selection)&&N.A()[0];if(!(!N||!N.collapsed||Q.z))if(Q.F.d()=="body"){Q=N.eb(A,"p");if(Q.Za().match(O)){var S=Q.Ca(P);if(S&&S[0].nodeType==i.e&&!C[S.d()]){N.kb(S);Q.h()}else if((S=Q.ra(P))&&S[0].nodeType==i.e&&!C[S.d()]){N.kb(S,S.Za().match(O)?z:A);Q.h()}}N.select();a||k.lb()}})}p.Jd={Ab:1,oa:2,Ua:3};var A=T,z=Y,u=U,r=KISSY,q=r.UA,f=r.DOM,h=r.Event,e=r.Node,o=p.Jd,y=p.na,i=p.n,a=!window.getSelection,b=p.Aa,d=p.Range,j={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};r.augment(B,{r:!a?function(){var k=this.c.M;return k.gc||(k.gc=f.ea(this.document).getSelection())}:function(){var k=this.c.M;return k.gc||(k.gc=this.document.selection)},gb:!a?function(){var k=this.c.M;if(k.type)return k.type;var s=o.oa,I=this.r();if(I){if(I.rangeCount==1){I=I.getRangeAt(0);var w=I.startContainer;if(w==I.endContainer&&w.nodeType==i.e&&I.endOffset-I.startOffset===1&&j[w.childNodes[I.startOffset].nodeName.toLowerCase()])s=
o.Ua}}else s=o.Ab;return k.type=s}:function(){var k=this.c.M;if(k.type)return k.type;var s=o.Ab;try{var I=this.r(),w=I.type;if(w=="Text")s=o.oa;if(w=="Control")s=o.Ua;if(I.createRange().parentElement)s=o.oa}catch(c){}return k.type=s},A:a?function(){function k(s,I){s=s.duplicate();s.collapse(I);for(var w=s.parentElement(),c=w.childNodes,g,m=0;m<c.length;m++){var t=c[m];if(t.nodeType==i.e){g=s.duplicate();g.moveToElementText(t);t=g.compareEndPoints("StartToStart",s);var l=g.compareEndPoints("EndToStart",
s);g.collapse();if(t>0)break;else if(!t||l==1&&t==-1)return{Ha:w,offset:m};else if(!l)return{Ha:w,offset:m+1};g=u}}if(!g){g=s.duplicate();g.moveToElementText(w);g.collapse(z)}g.setEndPoint("StartToStart",s);g=g.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;g>0;)g-=c[--m].nodeValue.length}catch(C){g=0}return g===0?{Ha:w,offset:m}:{Ha:c[m],offset:-g}}return function(){var s=this.c.M;if(s.ma)return s.ma;var I=this.r(),w=I&&I.createRange(),c=this.gb();if(!I)return[];if(c==o.oa){I=new d(this.document);
c=k(w,A);I.setStart(new e(c.Ha),c.offset);c=k(w);I.setEnd(new e(c.Ha),c.offset);return s.ma=[I]}else if(c==o.Ua){s=s.ma=[];for(c=0;c<w.length;c++){var g=w.item(c),m=g.parentNode,t=0;for(I=new d(this.document);t<m.childNodes.length&&m.childNodes[t]!=g;t++);I.setStart(new e(m),t);I.setEnd(new e(m),t+1);s.push(I)}return s}return s.ma=[]}}():function(){var k=this.c.M;if(k.ma)return k.ma;var s=[],I=this.r();if(!I)return[];for(var w=0;w<I.rangeCount;w++){var c=I.getRangeAt(w),g=new d(this.document);g.setStart(new e(c.startContainer),
c.startOffset);g.setEnd(new e(c.endContainer),c.endOffset);s.push(g)}return k.ma=s},fb:function(){var k=this.c.M;if(k.zd!==undefined)return k.zd;var s,I=this.r();switch(this.gb()){case o.Ua:return this.$b();case o.oa:var w=this.A()[0];if(w)if(!w.collapsed){for(w.ic();A;){s=w.startContainer;if(w.startOffset==(s[0].nodeType===i.e?s[0].childNodes.length:s[0].nodeValue.length)&&!s.pa())w.setStartAfter(s);else break}s=w.startContainer;if(s[0].nodeType!=i.e)return s.parent();s=new e(s[0].childNodes[w.startOffset]);
if(!s[0]||s[0].nodeType!=i.e)return w.startContainer;for(w=s[0].firstChild;w&&w.nodeType==i.e;){s=new e(w);w=w.firstChild}return s}if(a){w=I.createRange();w.collapse(A);s=w.parentElement()}else if((s=I.anchorNode)&&s.nodeType!=i.e)s=s.parentNode}return k.zd=s?f.D(s):u},$b:function(){var k=this,s,I=k.c.M;if(I.xd!==undefined)return I.xd;if(a){s=k.r().createRange();s=s.item&&s.item(0)}s||(s=function(){for(var w=k.A()[0],c,g,m=2;m&&!((c=w.Zc())&&c[0].nodeType==i.e&&j[c.d()]&&(g=c));m--)w.Na(y.da);return g&&
g[0]}());return I.xd=f.D(s)},reset:function(){this.c.M={}},nc:function(k){var s;if(a)try{s=this.document.body.createControlRange();s.addElement(k[0]);s.select()}catch(I){s=this.document.body.createTextRange();s.moveToElementText(k[0]);s.select()}finally{}else{s=this.document.createRange();s.selectNode(k[0]);k=this.r();k.removeAllRanges();k.addRange(s)}this.reset()},rb:function(k){if(a){if(k.length>1){var s=k[k.length-1];k[0].setEnd(s.endContainer,s.endOffset);k.length=1}k[0]&&k[0].select()}else{s=
this.r();if(!s)return;s.removeAllRanges();for(var I=0;I<k.length;I++){var w=k[I],c=this.document.createRange(),g=w.startContainer;w.collapsed&&q.gecko&&q.gecko<1.09&&g[0].nodeType==i.e&&!g[0].childNodes.length&&g[0].appendChild(this.document.createTextNode(""));c.setStart(g[0],w.startOffset);c.setEnd(w.endContainer[0],w.endOffset);s.addRange(c)}}this.reset()},le:function(k){for(var s=[],I=this.A(),w=0;w<I.length;w++)s.push(I[w].Sc(k));return s},ke:function(k,s){var I=[],w=this.document,c;s=s||this.A();
for(var g=s.length,m=0;m<g;m++){I.push(c=s[m].O(k,A));var t=(k=c.yd)?r.one("#"+c.Y,w):c.Y;c=k?r.one("#"+c.P,w):c.P;for(var l=m+1;l<g;l++){var C=s[l],O=C.startContainer,P=C.endContainer;f.g(O,t.parent())&&C.startOffset++;f.g(O,c.parent())&&C.startOffset++;f.g(P,t.parent())&&C.endOffset++;f.g(P,c.parent())&&C.endOffset++}}return I},wd:function(k){for(var s=[],I=0;I<k.length;I++){var w=new d(this.document);w.moveToBookmark(k[I]);s.push(w)}this.rb(s);return this},ua:function(){var k=this.A();return k[0].startContainer.Fb(k[k.length-
1].endContainer)},scrollIntoView:function(){var k=this.fb();k&&k.Kb()},removeAllRanges:function(){var k=this.r();if(a)k&&k.clear();else k&&k.removeAllRanges()}});var x={table:1,tbody:1,tr:1},n=b.Pa(A),E=/\ufeff|\u00a0/;d.prototype.select=d.prototype.select=!a?function(){var k=this.startContainer;this.collapsed&&k[0].nodeType==i.e&&!k[0].childNodes.length&&k[0].appendChild(this.document.createTextNode(""));var s=this.document.createRange();s.setStart(k[0],this.startOffset);try{s.setEnd(this.endContainer[0],
this.endOffset)}catch(I){if(I.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(A);s.setEnd(this.endContainer[0],this.endOffset)}else throw I;}k=v(this.document).r();k.removeAllRanges();k.addRange(s)}:function(k){var s=this.collapsed,I,w;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var c=this.startContainer[0].childNodes[this.startOffset];if(c.nodeType==i.e){(new B(this.document)).nc(new e(c));return}}if(this.startContainer[0].nodeType==i.e&&this.startContainer.d()in
x||this.endContainer[0].nodeType==i.e&&this.endContainer.d()in x)this.Na(y.da,A);var g=this.O();c=g.Y;var m;if(!s)m=g.P;g=this.document.body.createTextRange();g.moveToElementText(c[0]);g.moveStart("character",1);if(m){k=this.document.body.createTextRange();k.moveToElementText(m[0]);g.setEndPoint("EndToEnd",k);g.moveEnd("character",-1)}else{for(I=c[0].nextSibling;I&&!n(I);)I=I.nextSibling;I=!(I&&I.nodeValue&&I.nodeValue.match(E))&&(k||!c[0].previousSibling||c[0].previousSibling&&f.d(c[0].previousSibling)==
"br");w=this.document.createElement("span");w.innerHTML="&#65279;";w=(new e(w)).insertBefore(c);I&&f.insertBefore(this.document.createTextNode("\ufeff"),c)}this.setStartBefore(c);c.h();if(s){if(I){g.moveStart("character",-1);g.select();this.document.selection.clear()}else g.select();if(w){this.H(w,y.C);w.h()}}else{this.setEndBefore(m);m.h();g.select()}};B.getSelection=v;p.Ac=B;p.Selection=B;b=B.prototype;p.l.o(b,{getNative:b.r,getType:b.gb,getRanges:b.A,getStartElement:b.fb,getSelectedElement:b.$b,reset:b.reset,
selectElement:b.nc,selectRanges:b.rb,createBookmarks2:b.le,createBookmarks:b.ke,getCommonAncestor:b.ua,scrollIntoView:b.scrollIntoView,selectBookmarks:b.wd,removeAllRanges:b.removeAllRanges});p.on("instanceCreated",function(k){J(k.pe)})});
KISSY.Editor.add("styles",function(p){function B(D,K){for(var G in D)D[G]=D[G].replace(V,function(F,H){return K[H]})}function v(D,K){if(K){D=s.clone(D);B(D.attributes,K);B(D.styles,K)}var G=this.element=this.element=(D.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.Bb:S[G]?c.Wa:c.za;this.c={definition:D}}function J(D,K){var G=K?this.mc:this.Mb;D.body.focus();for(var F=new m(D),H=F.A(),M=0;M<H.length;M++)G.call(this,H[M]);F.rb(H)}function A(D,K){var G;G=D.element;if(G=="*")G="span";
G=new O(K.createElement(G));return z(G,D)}function z(D,K){var G=K.c.definition,F=G.attributes;G=v.ad(G);if(F)for(var H in F)D.attr(H,F[H]);if(G)D[0].style.cssText=G;return D}function u(D){var K=D.O(n),G=D.me();G.Ub=n;G.Vc=n;for(var F,H=D.document;F=G.ue();){var M=A(this,H);F=F;var L=M;M=L.d=="pre";var R=F.d=="pre",ba=!M&&R;if(M&&!R){R=F;L=L;ba=R.html();ba=r(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+ba+"</pre>";L=new O(R.firstChild);L.h()}else L.html(ba);L=L}else if(ba)L=f(q(F),L);else F.Ib(L);F[0].parentNode.replaceChild(L[0],F[0]);if(M){F=L;M=void 0;if((M=F.fa(n,t.e))&&M.d()=="pre"){L=r(M.html(),/\n$/,"")+"\n\n"+r(F.html(),/^\n/,"");if(P.ie)F[0].outerHTML="<pre>"+L+"</pre>";else F.html(L);M.h()}}}D.moveToBookmark(K)}function r(D,K,G){var F="",H="";D=D.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(M,L,R){L&&(F=L);R&&(H=R);return""});return F+D.replace(K,G)+H}function q(D){var K=[];r(D.Za(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function f(D,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<D.length;F++){var H=D[F];H=H.replace(/(\r\n|\r)/g,"\n");H=r(H,/^[ \t]*\n/,"");H=r(H,/\n$/,"");H=r(H,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=K.K();M.html(H);G.appendChild(M[0])}return G}function h(D){var K=D.document;if(D.collapsed){K=A(this,K);D.insertNode(K);D.H(K,g.J)}else{var G=this.element,F=this.c.definition,H,M=p.m[G]||(H=n,p.m.span),L=D.O();D.Ia(g.yb);D.trim();var R=D.O(),ba=R.Y;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=E;if(w.g($,R)){$=
k;Z=n}else{var aa=$[0].nodeType,fa=aa==t.e?$.d():k;if(fa&&$.attr("_ke_bookmark")){$=$.w(n);continue}if(!fa||M[fa]&&($.Da(R)|l.X|l.ca|l.W)==l.X+l.ca+l.W&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((p.m[ga.d()]||p.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!p.m.aa[fa]||($.Da(R)|l.X|l.ca|l.W)==l.X+l.ca+l.W)){ca=new C(K);ca.setStartBefore($)}if(aa==t.f||aa==t.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Ca(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),M[da.d()])&&(da.Da(ba)|l.ba|l.ca|l.W)==l.ba+l.ca+l.W&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=n)}}else Z=n}else Z=n;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=A(this,K);for(aa=ca.ua();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.Ya()){Z=k;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());d(this,Z);ca.insertNode(Z);
Z.qa();P.ie||Z[0].normalize()}ca=k}}ba.h();R.h();D.moveToBookmark(L);D.Na(g.yc)}}function e(D){D.Ia(g.yb);var K=D.O(),G=K.Y;if(D.collapsed){for(var F=new N(G.parent()),H,M=0,L;M<F.elements.length&&(L=F.elements[M]);M++){if(L==F.z||L==F.F)break;if(this.ia(L)){var R=D.Rb(L,g.Gd),ba=!R&&D.Rb(L,g.Va);if(ba||R){H=L;H.match=ba?"start":"end"}else{L.qa();L.d()==this.element?a(this,L):j(L,i(this)[L.d()])}}}if(H&&H[0]){L=G;for(M=0;;M++){R=F.elements[M];if(w.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(L[0]);L=R}w[H.match=="start"?"insertBefore":"insertAfter"](L,H)}}else{var $=K.P,ca=this;F=function(){for(var Z=new N(G.parent()),aa=new N($.parent()),fa=k,ga=k,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Eb(ga);fa&&G.Eb(fa)};F();for(H=new O(G[0].nextSibling);H[0]!==$[0];){M=H.w();if(H[0]&&H[0].nodeType==t.e&&this.ia(H)){H.d()==
this.element?a(this,H):j(H,i(this)[H.d()]);if(M[0].nodeType==t.e&&M.contains(G)){F();M=new O(G[0].nextSibling)}}H=M}}D.moveToBookmark(K)}function o(D){var K={};D.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function y(D,K){var G;if(K!==E){G=document.createElement("span");G.style.cssText=D;G=G.style.cssText||""}else G=D;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(D){if(D.c.vd)return D.c.vd;
var K=D.c.vd={},G=D.c.definition.overrides;if(G){s.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],M,L;if(typeof H=="string")M=H.toLowerCase();else{M=H.element?H.element.toLowerCase():D.element;L=H.attributes}H=K[M]||(K[M]={});if(L){H=H.attributes=H.attributes||[];for(var R in L)H.push([R.toLowerCase(),L[R]])}}}return K}function a(D,K){var G=D.c.definition,F=I.mix(G.attributes,i(D)[K.d()]);G=G.styles;var H=s.isEmptyObject(F)&&s.isEmptyObject(G),M;for(M in F)if(!((M=="class"||D.c.definition.fullMatch)&&
K.attr(M)!=b(M,F[M]))){H=H||!!K.Cc(M);K.removeAttr(M)}for(var L in G)if(!(D.c.definition.fullMatch&&K.L(L)!=b(L,G[L],n))){H=H||!!K.L(L);K.L(L,"")}x(K)}function b(D,K,G){var F=new O("<span>");F[G?"_4e_style":"attr"](D,K);return F[G?"_4e_style":"attr"](D)}function d(D,K){for(var G=i(D),F=K.all(D.element),H=F.length;--H>=0;)a(D,new O(F[H]));for(var M in G)if(M!=D.element){F=K.all(M);for(H=F.length-1;H>=0;H--){var L=new O(F[H]);j(L,G[M])}}}function j(D,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],M;if(M=D.attr(H)){var L=G[F][1];if(L===k||L.test&&L.test(M)||typeof L=="string"&&M==L)D[0].removeAttribute(H)}}x(D)}function x(D){if(!D.Ya()){var K=D[0].firstChild,G=D[0].lastChild;D.h(n);if(K){K.nodeType==t.e&&w.qa(K);G&&K!=G&&G.nodeType==t.e&&w.qa(G)}}}var n=T,E=Y,k=U,s=KISSY,I=p.l,w=s.DOM,c={Bb:1,za:2,Wa:3},g=p.na,m=p.Ac,t=p.n,l=p.Ta,C=p.Range,O=s.Node,P=s.UA,N=p.Sa,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},S={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},W=/\s*(?:;\s*|$)/g,V=/#\((.+?)\)/g;p.nf=c;v.prototype={apply:function(D){J.call(this,D,E)},remove:function(D){J.call(this,D,n)},Mb:function(D){return(this.Mb=this.type==c.za?h:this.type==c.Bb?u:this.type==c.Wa?k:k).call(this,D)},mc:function(D){return(this.mc=this.type==c.za?e:k).call(this,D)},$d:function(D){z(D,this)},ia:function(D,K){if(!D)return E;var G=this.c.definition;if(D.d()==this.element){if(!K&&!D.Ya())return n;var F=G.Sd;if(F)G=F;else{F={};var H=0,M=G.attributes;
if(M)for(var L in M){H++;F[L]=M[L]}if(M=v.ad(G)){F.style||H++;F.style=M}F._length=H;G=G.Sd=F}if(G._length){for(var R in G)if(R!="_length"){H=D.attr(R)||"";if(R=="style")a:{F=G[R];H=y(H,E);typeof F=="string"&&(F=o(F));typeof H=="string"&&(H=o(H));M=void 0;for(M in F)if(!(M in H&&(H[M]==F[M]||F[M]=="inherit"||H[M]=="inherit"))){F=E;break a}F=n}else F=G[R]==H;if(F){if(!K)return n}else if(K)return E}if(K)return n}else return n}if(R=i(this)[D.d()]){if(!(G=R.attributes))return n;for(F=0;F<G.length;F++){R=
G[F][0];if(R=D.attr(R)){H=G[F][1];if(H===k||typeof H=="string"&&R==H||H.test&&H.test(R))return n}}}return E},ge:function(D){switch(this.type){case c.Bb:return this.ia(D.z||D.F,n);case c.Wa:case c.za:for(var K=D.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.za&&(w.g(F,D.z)||w.g(F,D.F))))if(!(this.type==c.Wa&&!(F.d()in S)))if(this.ia(F,n))return n}}return E}};v.ad=function(D){var K=D.Td;if(K)return K;K=D.styles;var G=D.attributes&&D.attributes.style||"",F="";if(G.length)G=G.replace(W,";");
for(var H in K){var M=K[H],L=(H+":"+M).replace(W,";");if(M=="inherit")F+=L;else G+=L}if(G.length)G=y(G);G+=F;return D.Td=G};p.of=v;p.Style=v;var X=v.prototype;p.l.o(X,{apply:X.apply,remove:X.remove,applyToRange:X.Mb,removeFromRange:X.mc,applyToObject:X.$d,checkElementRemovable:X.ia,checkActive:X.ge})});
KISSY.Editor.add("htmlparser",function(){function p(){}function B(){this.c={ed:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var v=KISSY,J=v.Editor,A=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,z={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},u=J.m;v.augment(B,{va:p,ud:p,la:p,pd:p,La:p,parse:function(r){for(var q,
f,h=0,e;q=this.c.ed.exec(r);){f=q.index;if(f>h){h=r.substring(h,f);e?e.push(h):this.la(h)}h=this.c.ed.lastIndex;if(f=q[1]){f=f.toLowerCase();if(e&&u.rc[f]){this.pd(e.join(""));e=U}if(!e){this.ud(f);continue}}if(e)e.push(q[0]);else if(f=q[3]){f=f.toLowerCase();if(!/="/.test(f)){var o={},y;q=q[4];var i=!!(q&&q.charAt(q.length-1)=="/");if(q)for(;y=A.exec(q);){var a=y[1].toLowerCase();y=y[2]||y[3]||y[4]||"";o[a]=!y&&z[a]?a:y}this.va(f,o,i);if(!e&&u.rc[f])e=[]}}else if(f=q[2])this.La(f)}r.length>h&&this.la(r.substring(h,
r.length))}});J.j=B;J.HtmlParser=B});
KISSY.Editor.add("htmlparser-basicwriter",function(){function p(){this.c={k:[]}}var B=KISSY,v=B.Editor,J=v.l;B.augment(p,{mb:function(A){this.c.k.push("<",A)},nb:function(A,z){z?this.c.k.push(" />"):this.c.k.push(">")},bb:function(A,z){if(typeof z=="string")z=J.cc(z);this.c.k.push(" ",A,'="',z,'"')},cb:function(A){this.c.k.push("</",A,">")},text:function(A){this.c.k.push(A)},N:function(A){this.c.k.push("<!--",A,"--\>")},write:function(A){this.c.k.push(A)},reset:function(){this.c.k=[];this.c.B=Y},
Yb:function(A){var z=this.c.k.join("");A&&this.reset();return z}});v.j.wb=p;v.j.BasicWriter=p;B=p.prototype;v.l.o(B,{openTag:B.mb,openTagClose:B.nb,attribute:B.bb,closeTag:B.cb,text:B.text,comment:B.N,write:B.write,reset:B.reset,getHtml:B.Yb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function p(){p.Lf.constructor.call(this);this.fd="\t";this.Oe=" />";this.Ge="\n";this.se=z;this.Pe=A;this.c.B=z;this.c.G="";this.c.rules={};var u=v.m,r;for(r in J.mix({},u.vb,u.Qa,u.ub,u.vc))this.xa(r,{B:A,de:A,Qb:A,Oc:!u[r]["#"],ce:A});this.xa("br",{Qb:A});this.xa("title",{B:z,Qb:z});this.xa("style",{B:z,Oc:A});this.xa("pre",{B:z})}var B=KISSY,v=B.Editor,J=v.l,A=T,z=Y;B.extend(p,v.j.wb,{mb:function(u){var r=this.c.rules[u];if(this.c.B)this.G();
else if(r&&r.de){this.Ja();this.G()}this.c.k.push("<",u)},nb:function(u,r){var q=this.c.rules[u];if(r)this.c.k.push(this.Oe);else{this.c.k.push(">");if(q&&q.B)this.c.G+=this.fd}q&&q.Qb&&this.Ja()},bb:function(u,r){if(typeof r=="string"){this.se&&(r=r.replace(/&amp;/g,"&"));r=J.cc(r)}this.c.k.push(" ",u,'="',r,'"')},cb:function(u){var r=this.c.rules[u];if(r&&r.B)this.c.G=this.c.G.substr(this.fd.length);if(this.c.B)this.G();else if(r&&r.Oc){this.Ja();this.G()}this.c.k.push("</",u,">");r&&r.ce&&this.Ja()},
text:function(u){if(this.c.B){this.G();u=J.Ka(u)}this.c.k.push(u)},N:function(u){this.c.B&&this.G();this.c.k.push("<!--",u,"--\>")},Ja:function(){this.c.k.length>0&&this.c.k.push(this.Ge);this.c.B=A},G:function(){this.c.k.push(this.c.G);this.c.B=z},xa:function(u,r){var q=this.c.rules[u];if(q)J.mix(q,r);else this.c.rules[u]=r}});v.j.cf=p;v.j.HtmlWriter=p;B=p.prototype;v.l.o(B,{openTag:B.mb,openTagClose:B.nb,attribute:B.bb,closeTag:B.cb,text:B.text,comment:B.N,lineBreak:B.Ja,indentation:B.G,setRules:B.xa})});
KISSY.Editor.add("htmlparser-fragment",function(){function p(){this.children=[];this.parent=J;this.c={R:B,bc:v}}var B=T,v=Y,J=U,A=KISSY.Editor,z={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},u=KISSY,r=A.l,q=A.n,f=A.m,h=r.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),e=f.Ed,o=f.ub;p.zb=function(y,i){function a(g){var m;if(n.length>0)for(var t=0;t<n.length;t++){var l=n[t],C=l.name,O=f[C],P=k.name&&f[k.name];if((!P||P[C])&&(!g||!O||O[g]||!f[g])){if(!m){b();m=1}l=l.clone();
l.parent=k;k=l;n.splice(t,1);t--}}}function b(){for(;E.length;)k.add(E.shift())}function d(g,m,t){m=m||k||x;if(i&&!m.type){var l,C;if((l=g.attributes&&(C=g.attributes._ke_real_element_type)?C:g.name)&&!(l in f.qc)&&!(l in f.vb)){l=k;k=m;j.va(i,{});m=k;if(t)k=l}}if(g.c.R&&g.name!="pre"){t=g.children.length;if((l=g.children[t-1])&&l.type==q.f)if(C=r.Ma(l.value))l.value=C;else g.children.length=t-1}m.add(g);if(g.pb){k=g.pb;delete g.pb}}var j=new A.j,x=new p,n=[],E=[],k=x,s=v,I;j.va=function(g,m,t){var l=
new A.j.wc(g,m);if(l.fc&&t)l.jb=B;if(f.aa[g])n.push(l);else{if(g=="pre")s=B;else if(g=="br"&&s){k.add(new A.j.Cb("\n"));return}if(g=="br")E.push(l);else{var C=k.name,O=C&&(f[C]||(k.c.R?f.div:f.span));if(O&&!l.fc&&!k.fc&&!O[g]){O=v;var P;if(g in e&&C in e){C=k.children;(C=C[C.length-1])&&C.name in o||d(C=new A.j.wc("li"),k);I=k;P=C}else if(g==C)d(k,k.parent);else{if(h[C])I||(I=k);else{d(k,k.parent,B);z[C]||n.unshift(k)}O=B}k=P?P:k.pb||k.parent;if(O){j.va.apply(this,arguments);return}}a(g);b();l.parent=
k;l.pb=I;I=0;if(l.jb)d(l);else k=l}}};j.ud=function(g){for(var m=n.length-1;m>=0;m--)if(g==n[m].name){n.splice(m,1);return}for(var t=[],l=[],C=k;C.type&&C.name!=g;){C.c.R||l.unshift(C);t.push(C);C=C.parent}if(C.type){for(m=0;m<t.length;m++){var O=t[m];d(O,O.parent)}k=C;if(k.name=="pre")s=v;C.c.R&&b();d(C,C.parent);if(C==k)k=k.parent;n=n.concat(l)}if(g=="body")i=v};j.la=function(g){if(!k.c.bc&&!s){g=r.Ka(g);if(g.length===0)return}b();a();if(i&&(!k.type||k.name=="body")&&r.trim(g))this.va(i,{});s||
(g=g.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));k.add(new A.j.Cb(g))};j.pd=function(){};j.La=function(g){k.add(new A.j.Fd(g))};j.parse(y);for(b();k.type;){var w=k.parent,c=k;if(i&&(!w.type||w.name=="body")&&!f.qc[c.name]){k=w;j.va(i,{});w=k}w.add(c);k=w}return x};u.augment(p,{add:function(y){var i=this.children.length;if(i=i>0&&this.children[i-1]||J){if(y.c.R&&i.type==q.f){i.value=r.Ma(i.value);if(i.value.length===0){this.children.pop();this.add(y);return}}i.next=y}y.ob=i;y.parent=this;this.children.push(y);
this.c.bc=y.type==q.f||y.type==q.e&&!y.c.R},$:function(y,i){var a;this.filterChildren=this.Wb=function(){var b=new A.j.wb;this.U.call(this,b,i,B);b=b.Yb();this.children=(new p.zb(b)).children;a=1};!this.name&&i&&i.rd(this);this.U(y,a?J:i)},U:function(y,i){for(var a=0;a<this.children.length;a++)this.children[a].$(y,i)}});A.j.ya=p;A.j.Fragment=p;p.FromHtml=p.zb;u=p.prototype;A.l.o(u,{add:u.add,writeHtml:u.$,writeChildrenHtml:u.U})});
KISSY.Editor.add("htmlparser-element",function(){function p(z,u){z=z[0];u=u[0];return z<u?-1:z>u?1:0}function B(z,u){this.name=z;this.attributes=u||(u={});this.children=[];var r=u.rf||z,q=v.m;r=!!(q.vb[r]||q.Qa[r]||q.ub[r]||q.vc[r]||q.uc[r]||r=="br");var f=!!q.tb[z];this.jb=f;this.fc=!q[z];this.c={R:r,bc:f||!r}}var v=KISSY.Editor,J=v.n;KISSY.augment(B,{type:J.e,add:v.j.ya.prototype.add,clone:function(){return new B(this.name,this.attributes)},$:function(z,u){var r=this.attributes,q=this,f=q.name,
h,e,o,y;q.Wb=function(){if(!y){var b=new v.j.wb;v.j.ya.prototype.U.call(q,b,u);q.children=(new v.j.ya.zb(b.Yb())).children;y=1}};q.filterChildren=q.Wb;if(u){for(;;){if(!(f=u.qd(f)))return;q.name=f;if(!(q=u.hc(q)))return;q.parent=this.parent;if(q.name==f)break;if(q.type!=J.e){q.$(z,u);return}f=q.name;if(!f){this.U.call(q,z,y?U:u);return}}r=q.attributes}z.mb(f,r);for(var i=[],a=0;a<2;a++)for(h in r){e=h;o=r[h];if(a==1)i.push([h,o]);else if(u){for(;;)if(e=u.od(h))if(e!=h){delete r[h];h=e}else break;
else{delete r[h];break}if(e)if((o=u.nd(q,e,o))===Y)delete r[e];else r[e]=o}}z.Pe&&i.sort(p);r=i.length;for(a=0;a<r;a++){h=i[a];z.bb(h[0],h[1])}z.nb(f,q.jb);if(!q.jb){this.U.call(q,z,y?U:u);z.cb(f)}},U:function(){v.j.ya.prototype.U.apply(this,arguments)}});v.j.wc=B;v.j.Element=B;var A=B.prototype;v.l.o(A,{type:A.type,add:A.add,clone:A.clone,writeHtml:A.$,writeChildrenHtml:A.U})});
KISSY.Editor.add("htmlparser-filter",function(){function p(h){this.c={Tb:[],Nb:[],elements:{tc:0},attributes:{tc:0}};h&&this.Nc(h,10)}function B(h,e){for(var o=0;h&&o<e.length;o++){var y=e[o];h=h.replace(y[0],y[1])}return h}function v(h,e,o){if(typeof e=="function")e=[e];var y,i;i=h.length;var a=e&&e.length;if(a){for(y=0;y<i&&h[y].lc<o;y++);for(i=a-1;i>=0;i--)if(a=e[i]){a.lc=o;h.splice(y,0,a)}}}function J(h,e,o){if(e)for(var y in e){var i=h[y];h[y]=A(i,e[y],o);i||h.tc++}}function A(h,e,o){if(e){e.lc=
o;if(h){if(h.splice)v(h,e,o);else{h=h.lc>o?[e,h]:[h,e];h.filter=z}return h}else return e.filter=e}}function z(h){for(var e=h.type||h instanceof r.j.ya,o=0;o<this.length;o++){if(e)var y=h.type,i=h.name;var a=this[o].apply(window,arguments);if(a===f)return a;if(e){if(a&&(a.name!=i||a.type!=y))return a}else if(typeof a!="string")return a;a!=undefined&&(h=a)}return h}var u=KISSY,r=u.Editor,q=r.n,f=Y;u.augment(p,{Nc:function(h,e){if(typeof e!="number")e=10;v(this.c.Tb,h.Tb,e);v(this.c.Nb,h.Nb,e);J(this.c.elements,
h.elements,e);J(this.c.attributes,h.attributes,e);this.c.text=A(this.c.text,h.text,e)||this.c.text;this.c.N=A(this.c.N,h.N,e)||this.c.N;this.c.qb=A(this.c.qb,h.qb,e)||this.c.qb},qd:function(h){return B(h,this.c.Tb)},od:function(h){return B(h,this.c.Nb)},la:function(h){var e=this.c.text;return e?e.filter(h):h},La:function(h,e){var o=this.c.N;return o?o.filter(h,e):h},rd:function(h){var e=this.c.qb;return e?e.filter(h):h},hc:function(h){for(var e=[this.c.elements["^"],this.c.elements[h.name],this.c.elements.Xe],
o,y=0;y<3;y++)if(o=e[y]){o=o.filter(h,this);if(o===f)return U;if(o&&o!=h)return this.sd(o);if(h.parent&&!h.name)break}return h},sd:function(h){var e=h.type;return e==q.e?this.hc(h):e==q.f?new r.j.Cb(this.la(h.value)):U},nd:function(h,e,o){if(e=this.c.attributes[e]){h=e.filter(o,h,this);if(h===f)return f;if(typeof h!="undefined")return h}return o}});r.j.bf=p;u=p.prototype;r.l.o(u,{addRules:u.Nc,onElementName:u.qd,onAttributeName:u.od,onText:u.la,onComment:u.La,onFragment:u.rd,onElement:u.hc,onNode:u.sd,
onAttribute:u.nd});r.j.Filter=p});KISSY.Editor.add("htmlparser-text",function(){function p(A){this.value=A;this.c={R:J}}var B=KISSY,v=B.Editor,J=Y;B.augment(p,{type:v.n.f,$:function(A,z){var u=this.value;z&&!(u=z.la(u,this))||A.text(u)}});v.j.Cb=p;v.j.Text=p});
KISSY.Editor.add("htmlparser-comment",function(){function p(J){this.value=J;this.c={R:Y}}var B=KISSY.Editor,v=B.n;B.j.Fd=p;B.j.Comment=p;p.prototype={constructor:p,type:v.Hd,$:function(J,A){var z=this.value;if(A){if(!(z=A.La(z,this)))return;if(typeof z!="string"){z.parent=this.parent;z.$(J,A);return}}J.N(z)}}});
