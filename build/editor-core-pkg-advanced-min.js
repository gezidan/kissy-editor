/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-10 13:03:14
*/
var S=true,T=null,X=false;
KISSY.add("editor",function(o,A){function u(k,a){function b(t){for(var i=u.Env.mods,j=0;j<t.length;j++){for(var C=t[j],I=y,n=0;n<j;n++)if(C==t[n]){I=v;break}n=i[C];if(I&&n){I=o.clone(n);C=C+"_"+j;I.name=C;t[j]=C;i[C]||(i[C]=I)}}}var e=this;if(!(e instanceof u))return new u(k,a);if(o.isString(k))k=o.one(k);k=x.D(k);a=a||{};a.Ke=a.pluginConfig||{};e.ha=a;a.pluginConfig=a.Ke;e.cfg=a;o.app(e,o.EventTarget);var l=["htmldataprocessor","enterkey","clipboard"],B=y;e.use=function(t,i){t=t.split(",");b(t);
if(!B)for(var j=0;j<l.length;j++){var C=l[j];o.inArray(C,t)||t.unshift(C)}o.use.call(e,t.join(","),function(){e.ready(function(){i&&i.call(e);if(!B){e.setData(k.val());if(a.focus)e.focus();else{var I=e.getSelection();I&&I.removeAllRanges()}e.fire("save");B=v}})},{order:v,global:u});return e};e.use=e.use;e.Be(k);return e}function J(k){var a=o.Config.debug;k=a?a==="dev"?"../src/"+k:k:k.replace(/\.(js|css)/i,"-min.$1");k+=k.indexOf("?")!=-1?"&":"?";k+="t="+encodeURIComponent("2010-11-10 13:03:14");return k}
var x=o.DOM,v=S,y=X;o.app(u,o.EventTarget);u.Config.base=o.Config.base+"editor/";var s=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",
requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],r,f,g,d,q={};r=0;for(f=s.length;r<f;r++){g=s[r];if(o.isString(g))g=s[r]={name:g+"",requires:T};d=g.requires||[];var z=["button"];g.name.indexOf("/dialog")!=-1&&z.push("overlay");g.requires=d.concat(z)}s=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},
{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(s);r=0;for(f=s.length;r<f;r++){g=s[r];d=g.name;q[d]={attach:y,charset:"utf-8",requires:g.requires,csspath:g.Of?J("plugins/"+d+"/plugin.css"):A,path:J("plugins/"+d+"/plugin.js")}}u.add(q);o.Editor=u;o.Editor=u});
KISSY.Editor.add("utils",function(o){var A=T,u=KISSY,J=u.Node,x=u.DOM,v=u.UA,y=u.Event,s;if(v.ie)s=document.documentMode||v.ie;var r={Tc:function(f){var g=u.Config.debug;f=g?g==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-11-17 20:35:10");return f},Ge:function(f,g,d){var q=f[g],z=f[d];f[g]=function(){q.apply(this,arguments);f[g]=f[d];return z.apply(this,arguments)}},xe:function(f,g,d,q){d=d.defaultView||d.parentWindow;f-=x.scrollLeft(d);
g-=x.scrollTop(d);if(q)if(d!=(q.defaultView||q.parentWindow)&&d.frameElement){q=x.Eb(d.frameElement,q);f+=q.left;g+=q.top}return{left:f,top:g}},Cd:function(){for(var f,g=0,d=arguments.length;g<d;g++){var q=arguments[g];try{f=q();break}catch(z){}}return f},ce:function(f,g){if(!f&&!g)return S;if(!f||!g||f.length!=g.length)return X;for(var d=0;d<f.length;d++)if(f[d]!==g[d])return X;return S},Xc:function(f,g,d){f=f.documentElement;for(var q=0;f&&q<g.length;q++){var z=g[q];if(d)for(var k=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(d===S&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){k++;if(k==z){f=b;break}}}else f=f.childNodes[z]}return f?new J(f):A},ke:function(f){for(var g in f)f[g].Bc(f,S)},cc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ja:function(f){return f.replace(/^\s+/,"")},La:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ja(this.La(f))},mix:function(){for(var f={},g=0;g<arguments.length;g++)f=u.mix(f,arguments[g]);
return f},gb:function(){if(!v.ie)return X;var f=document.domain,g=window.location.hostname;return f!=g&&f!="["+g+"]"},pe:function(f,g){return Array(g+1).join(f)},Se:function(f,g,d){d=d||150;if(d===-1)return function(){f.apply(g,arguments)};var q=(new Date).getTime();return function(){var z=(new Date).getTime();if(z-q>d){q=z;f.apply(g,arguments)}}},fe:function(f,g,d){d=d||0;var q=A;return function(){q&&clearTimeout(q);var z=arguments;q=setTimeout(function(){return f.apply(g,z)},d)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(u.trim(f))},
Ue:function(f){for(var g=0;g<f.length;g++){var d=x.D(f[g]),q=u.trim(d.val()),z=d.attr("data-verify");d=d.attr("data-warning");if(z&&!RegExp(z).test(q)){alert(d);return X}}return S},Qe:function(f,g){f.on("sourcemode",g.xf,g);f.on("wysiwygmode",g.Df,g)},Me:function(f){var g=f.attr("placeholder");if(g&&!v.webkit){f.addClass("ke-input-tip");f.val(g)}else v.webkit&&f.val("")},Pf:function(f,g){f.removeClass("ke-input-tip");f.val(g)},Je:function(f,g){f.attr("placeholder",g);if(!v.webkit){f.on("blur",function(){if(!u.trim(f.val())){f.addClass("ke-input-tip");
f.val(g)}});f.on("focus",function(){f.removeClass("ke-input-tip");u.trim(f.val())==g&&f.val("")})}},je:function(f){f=f[0]||f;for(var g=u.makeArray(f.childNodes),d=0;d<g.length;d++){var q=g[d];q.nodeType==o.n.f&&!u.trim(q.nodeValue)&&f.removeChild(q)}},Ae:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ze:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},re:function(f,
g){return f.toLowerCase()==g.toLowerCase()},ld:function(f){f=u.clone(f);for(var g in f)if(f.hasOwnProperty(g)){var d=f[g];if(u.isFunction(d))f[g]=d()}return f},oe:function(f,g,d){function q(){var B={responseText:"",responseXML:A};B.be=f?f.be:A;try{var t;if((t=v.ie?k.contentWindow.document:k.contentDocument||window.frames[z].document)&&t.body)B.responseText=t.body.innerHTML;B.responseXML=t&&t.XMLDocument?t.XMLDocument:t}catch(i){u.log(i)}y.remove(k,"load",q);f.ge&&f.ge(B);setTimeout(function(){x.h(k)},
100)}var z=u.guid("form-upload-"),k=document.createElement("iframe");k.id=z;k.name=z;k.className="ke-hidden";var a="document.open();"+(r.gb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(v.ie)k.src=v.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";u.log("doFormUpload : "+k.src);document.body.appendChild(k);if(v.ie)document.frames[z].name=z;a=x.Jc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=z;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(d)a.action=d;var e;if(g){e=[];g=o.k.ld(g);for(var l in g)if(g.hasOwnProperty(l)){d=document.createElement("input");d.type="hidden";d.name=l;d.value=g[l];a.appendChild(d);e.push(d)}}y.on(k,"load",q);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(e){g=0;for(l=e.length;g<l;g++)x.h(e[g])}return k},o:function(f,g){for(var d in g)f[d]=g[d]},map:function(f,g){for(var d=0;d<f.length;d++)f[d]=
g(f[d]);return f},dc:s};o.k=r;o.Utils=r;r.o(r,{debugUrl:r.Tc,lazyRun:r.Ge,getXY:r.xe,tryThese:r.Cd,arrayCompare:r.ce,getByAddress:r.Xc,clearAllMarkers:r.ke,htmlEncodeAttr:r.cc,ltrim:r.Ja,rtrim:r.La,trim:r.trim,mix:r.mix,isCustomDomain:r.gb,duplicateStr:r.pe,buffer:r.fe,isNumber:r.isNumber,verifyInputs:r.Ue,sourceDisable:r.Qe,resetInput:r.Me,placeholder:r.Je,clean:r.je,htmlEncode:r.Ae,htmlDecode:r.ze,equalsIgnoreCase:r.re,normParams:r.ld,throttle:r.Se,doFormUpload:r.oe,map:r.map})});
KISSY.Editor.add("focusmanager",function(o){function A(){this.ec=r;s=this}function u(){this.ec=f;s=g}var J=KISSY,x=J.DOM,v=J.Event,y={},s;J={Hf:function(){for(var d in y){var q=y[d];q.document.designMode="off";q.document.designMode="on"}},wf:function(){return s},ue:function(d){return y[d]},add:function(d){var q=x.ea(d.document);v.on(q,"focus",A,d);v.on(q,"blur",u,d)},Le:function(d){y[d.Jb]=d},remove:function(d){delete y[d.Jb];var q=x.ea(d.document);v.remove(q,"focus",A,d);v.remove(q,"blur",u,d)}};
var r=S,f=X,g=T;o.se=J;o.focusManager=J;o.$c=function(){return y};o.getInstances=o.$c});
KISSY.Editor.add("definition",function(o){var A=S,u=X,J=document,x=KISSY,v=x.UA,y=x.DOM,s=x.Node,r=x.Event,f=o.se,g=o.k.Cd,d=o.k.Tc("theme/editor-iframe.css"),q=1,z="document.open();"+(o.k.gb()?'document.domain="'+J.domain+'";':"")+"document.close();",k="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(v.ie?
"javascript:void(function(){"+encodeURIComponent(z)+"}())":"")+'"  tabIndex="'+(v.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";o.zc=0;o.Wa=1;o.SOURCE_MODE=o.zc;o.WYSIWYG_MODE=o.Wa;x.augment(o,{Be:function(a){if(v.ie)y.addClass(J.body,"ie"+v.ie);else if(v.gecko)y.addClass(J.body,"gecko");else v.webkit&&y.addClass(J.body,"webkit");var b=this,e=new s(k.replace(/\$\(tabIndex\)/,a.attr("tabIndex")));e.on("mousedown",
function(t){if(v.webkit){var i=y.d(t.target);if(i=="select"||i=="option")return A}t.halt()});a.on("mousedown",function(t){t.stopPropagation()});b.Bf=e;b.Jb=q++;f.Le(b);b.qb=e.one(".ke-textarea-wrap");b.wrap=b.qb;b.fb=b.qb.one("iframe");b.iframe=b.fb;b.Bd=e.one(".ke-editor-tools");b.toolBarDiv=b.Bd;b.Z=a;b.textarea=b.Z;b.Re=e.one(".ke-editor-status");b.statusDiv=b.Re;b.Bd.Ic();b.Kb={};b.Kc={};var l=a.L("width"),B=a.L("height");if(l){e.css("width",l);a.css("width","100%")}b.Z.css("display","none");
e.insertAfter(a);b.qb[0].appendChild(a[0]);if(B){b.qb.css("height",B);a.css("height","100%")}e=b.fb;b.on("dataReady",function(){b.Wd=A;o.fire("instanceCreated",{qe:b})});v.gecko?e.on("load",b.Mc,b):b.Mc();b.ha.vf&&a[0].form&&b.Ud()},Ud:function(){(new s(this.Z[0].form)).on("submit",this.Ad,this)},Te:function(a,b){var e=this,l=o.nf;l.Ef();e.use(a,function(){var B=e.Yc(a);b(B);l.Nf()})},Zd:function(a,b){this.Kc[a]=b},Yc:function(a){return this.Kc[a]},$d:function(a){this.ready(a)},Xd:function(a,b){this.Kb[a]=
b},ye:function(a){return this.Kb[a]},execCommand:function(a){var b=this.Kb[a],e=x.makeArray(arguments);e.shift();e.unshift(this);return b.exec.apply(b,e)},Yb:function(){return this.Z.css("display")=="none"?o.Wa:o.zc},getData:function(a){var b;b=this.Yb()==o.Wa?this.document.body.innerHTML:this.Z.val();if(this.htmlDataProcessor)b=a?this.htmlDataProcessor.toHtml(b,"p"):this.htmlDataProcessor.toServer(b,"p");b=x.trim(b);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(b))b="";return b},setData:function(a){var b=a;
if(this.htmlDataProcessor)b=this.htmlDataProcessor.toDataFormat(a,"p");this.document.body.innerHTML=b;this.Yb()!=o.Wa&&this.Z.val(a)},Ad:function(){this.Z.val(this.getData())},Ea:function(a){a=a||0;return a+(this.ha.Ea||0)},qf:function(){return this.document.body.innerHTML},sf:function(a){this.document.body.innerHTML=a},Vd:function(a){var b=this.ha,e=b.ta,l="";if(e)for(var B=0;B<e.length;B++)l+='<link href="'+e[B]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+
o.Config.base+d+"' rel='stylesheet'/><style>"+(b.Rb||"")+"</style>"+l+"</head><body class='ke-editor'>&nbsp;"+(a?'<script id="ke_actscript" type="text/javascript">'+(o.k.gb()?'document.domain="'+J.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':"")+"</body></html>"},getSelection:function(){return o.Ac.getSelection(this.document)},focus:function(){var a=this.document,b=y.ea(a);v.webkit&&b&&b.parent&&b.parent.focus();b&&b.focus();a&&a.body.focus();this.jb()},blur:function(){y.ea(this.document).blur();
this.document&&this.document.body.blur()},Yd:function(a){var b=this.ha,e=this.document;b.Rb=b.Rb||"";b.Rb+="\n"+a;b=e.createElement("style");e.getElementsByTagName("head")[0].appendChild(b);if(b.styleSheet)b.styleSheet.cssText=a;else b.appendChild(e.createTextNode(a))},uf:function(a){var b=this.ha,e=this.document;b.ta=b.ta||[];b.ta.push(a);b=e.createElement("link");b.rel="stylesheet";e.getElementsByTagName("head")[0].appendChild(b);b.href=a},If:function(a){for(var b=this.ha,e=x.makeArray(this.document.getElementsByTagName("link")),
l=0;l<e.length;l++)e[l].href==a&&y.h(e[l]);b.ta=b.ta||[];b=b.ta;a=x.indexOf(a,b);a!=-1&&b.splice(a,1)},Mc:function(){function a(){t=B.document;b.document=t;e.detach();t.open("text/html","replace");t.write(l);t.close()}var b=this,e=b.fb,l=b.Vd(b.Jb),B=e[0].contentWindow,t;try{t=B.document}catch(i){e[0].src=e[0].src;if(v.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this.Wd?a():this.on("dataReady",a)},$a:function(){var a=this;a.Lc&&clearTimeout(a.Lc);a.Lc=setTimeout(function(){var b=a.getSelection();
if(b&&!b.hd){var e=b.$b(),l=new o.Ra(e);if(!a.kc||!a.kc.Rc(l)){a.kc=l;a.fire("selectionChange",{selection:b,path:l,element:e})}}},100)},jb:function(){this.kc=T;this.$a()},gd:function(a,b){var e=this;e.focus();var l=a.d(),B=o.m,t=o.na,i=o.n,j=B.Pa[l],C=e.getSelection(),I=C&&C.A(),n,c,h,p,w;if(!I||I.length==0){var m=arguments,D=m.callee;setTimeout(function(){D.apply(e,m)},30)}else{e.fire("save");for(var O=I.length-1;O>=0;O--){n=I[O];n.deleteContents();c=!O&&a||a.K(A);b&&b(c);if(j)for(;(p=n.ua(u,A))&&
(w=B[p.d()])&&!(w&&w[l]);)if(p.d()in B.span)n.pc(p);else if(n.sa()&&n.ja()){n.setStartBefore(p);n.collapse(A);p.h()}else n.oc();n.insertNode(c);h||(h=c)}if(h){l=h.w(A);B=e.document;w=o.m;if(w.sc[c.d()]){l=new s(B.createTextNode(" "));l.insertAfter(h)}else if(l){if(l.d()=="br"&&w[l.parent().d()].p){w=new s("<p>&nbsp;</p>",T,B);l[0].parentNode.replaceChild(w[0],l[0]);l=w}}else{w=new s("<p>&nbsp;</p>",T,B);w.insertAfter(h);l=w}n.H(h,t.t);l&&l[0].nodeType==i.e&&n.ib(l);C.pb([n]);e.focus();c&&c.Ib();setTimeout(function(){e.fire("save")},
10);return c}}},Ce:function(a){var b=this;if(b.htmlDataProcessor)a=b.htmlDataProcessor.toDataFormat(a);if(v.webkit){var e=y.create(a,T,this.document);e=e.nodeType==11?x.makeArray(e.childNodes):[e];for(var l=0;l<e.length;l++)b.gd(new s(e[l]))}else{b.focus();l=(e=b.getSelection())&&e.A();if(!l||l.length==0){var B=arguments,t=B.callee;setTimeout(function(){t.apply(b,B)},30)}else{b.fire("save");if(v.ie){e=e.r();e.type=="Control"&&e.clear();e.createRange().pasteHTML(a)}else b.document.execCommand("inserthtml",
u,a);b.focus();setTimeout(function(){b.fire("save")},10)}}}});o._initIFrame=function(a){function b(n){g(function(){B.designMode="on";setTimeout(function(){B.designMode="off";i.focus();if(!arguments.callee.Ne)arguments.callee.Ne=A},50)},function(){B.designMode="off";y.attr(i,"contentEditable",u);y.attr(i,"contentEditable",A);!n&&b(1)})}var e=f.ue(a);a=e.Z[0];var l=e.fb[0].contentWindow,B=e.document,t=e.ha;y.h(B.getElementById("ke_actscript"));var i=B.body;if(v.ie){i.hideFocus=A;i.disabled=A;i.contentEditable=
A;i.removeAttribute("disabled")}else setTimeout(function(){if(v.gecko||v.opera)i.contentEditable=A;else if(v.webkit)i.parentNode.contentEditable=A;else B.designMode="on"},0);if(v.webkit){r.on(B,"click",function(n){var c=new s(n.target);x.inArray(c.d(),["input","select"])&&n.preventDefault()});r.on(B,"mouseup",function(n){var c=new s(n.target);x.inArray(c.d(),["input","textarea"])&&n.preventDefault()})}if(v.gecko||v.ie||v.opera){var j;j=new s(y.insertAfter((new s('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
a));j.on("focus",function(){e.focus()});e.tf=function(){v.gecko&&e.ec&&j[0].focus()};e.on("destroy",function(){})}if(v.ie&&B.compatMode=="CSS1Compat"||v.gecko||v.opera){var C=new s(B.documentElement);C.on("mousedown",function(n){if(n.target==C[0]){v.gecko&&b(u);j[0].focus()}})}r.on(l,"focus",function(){if(v.gecko)b(u);else v.opera&&i.focus();e.jb()});v.gecko&&r.on(e.document,"mousedown",function(){e.ec||b(u)});if(v.ie){r.on(B,"keydown",function(n){if(n.keyCode in{8:1,46:1}){var c=e.getSelection(),
h=c.Zb();if(h){e.fire("save");var p=c.A()[0].O();h.h();c.wd([p]);e.fire("save");n.preventDefault()}}});if(B.compatMode=="CSS1Compat"){var I={33:1,34:1};r.on(B,"keydown",function(n){n.keyCode in I&&setTimeout(function(){e.getSelection().scrollIntoView()},0)})}}setTimeout(function(){v.ie&&setTimeout(function(){if(B){i.runtimeStyle.marginBottom="0px";i.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){e.fire("dataReady");var n=t.zf,c=t.yf;if(n||c)try{B.execCommand("enableObjectResizing",
u,!n);B.execCommand("enableInlineTableEditing",u,!c)}catch(h){r.on(i,v.ie?"resizestart":"resize",function(p){if(n||y.d(p.target)==="table"&&c)p.preventDefault()})}},10);v.webkit&&r.on(B,"mousedown",function(n){n=new s(n.target);x.inArray(n.d(),["img","hr","input","textarea","select"])&&e.getSelection().nc(n)});v.gecko&&r.on(B,"dragstart",function(n){var c=new s(n.target);c.d()==="img"&&/ke_/.test(c[0].className)&&n.preventDefault()});f.add(e)};z=o.prototype;o.k.o(z,{setData:z.setData,getData:z.getData,
insertElement:z.gd,insertHtml:z.Ce,ready:z.ready,addCustomStyle:z.Yd,addCommand:z.Xd,hasCommand:z.ye,execCommand:z.execCommand,addPlugin:z.$d,useDialog:z.Te,addDialog:z.Zd,getDialog:z.Yc,getMode:z.Yb,sync:z.Ad,baseZIndex:z.Ea,getSelection:z.getSelection,focus:z.focus,blur:z.blur,notifySelectionChange:z.jb})});
KISSY.Editor.add("zindex",function(){var o=KISSY.Editor;if(!o.Dd){o.Dd={$e:1100,jf:1200,af:99999,ff:900,hf:9999,LOADING:11E3,ef:12E3,kf:1200};o.Ea=function(A){var u=A,J=o.$c(),x;for(x in J){if(!J.hasOwnProperty(x))return;u=Math.max(u,J[x].Ea(A))}return u};o.baseZIndex=o.Ea;o.zIndexManager=o.Dd}});
KISSY.Editor.add("dtd",function(o){o.m=function(){function A(i){for(var j=arguments.length-1;j>0;)KISSY.mix(i,arguments[j--]);return i}var u={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},x=A({a:1},J),v=A({iframe:1},x),y={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},s={ins:1,del:1,script:1,style:1},r=A({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},s),f=A({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},r),g=A({p:1},f);J=A({iframe:1},f,J);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var d=A({a:1},J),q={tr:1},z={"#":1},k=A({param:1},f),a=A({form:1},u,v,y,g),b={li:1},e={base:1,link:1,meta:1,title:1},l=A(e,{style:1,script:1}),B={head:1,body:1},t={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{tb:A({html:1},B,e),Pa:t,Ye:{body:1,div:1,td:1,th:1,caption:1,
form:1},sc:d,qc:A({script:1,style:1},t),rc:{script:1,style:1},rb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},sb:{dd:1,dt:1,li:1},Ed:{ul:1,ol:1,dl:1},uc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},aa:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},Ze:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},vc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:B,head:l,style:z,body:a,base:{},link:{},meta:{},title:z,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:d,button:A(g,y),basefont:{},h5:d,h4:d,samp:d,h6:d,ol:b,h1:d,h3:d,option:z,h2:d,form:A(u,v,y,g),select:{optgroup:1,option:1},font:d,ins:d,menu:b,abbr:d,label:d,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:d,script:z,tfoot:q,cite:d,li:a,input:{},iframe:a,
strong:d,textarea:z,noframes:a,big:d,small:d,span:d,hr:{},dt:d,sub:d,optgroup:{option:1},param:{},bdo:d,"var":d,div:a,object:k,sup:d,dd:a,strike:d,area:{},dir:b,map:A({area:1,form:1,p:1},u,s,y),applet:k,dl:{dt:1,dd:1},del:d,isindex:{},fieldset:A({legend:1},f),thead:q,ul:b,acronym:d,b:d,a:J,blockquote:a,caption:d,i:d,u:d,tbody:q,s:d,address:A(v,g),tt:d,legend:d,q:d,pre:A(r,x),p:d,em:d,dfn:d}}();o.XHTML_DTD=o.m});
KISSY.Editor.add("dom",function(o){function A(a){if(a&&!a[0])return new s(a);return a}function u(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,e){return e.toUpperCase()})}var x=KISSY,v=x.DOM,y=x.UA,s=x.Node,r=o.k,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};o.n={e:1,f:3,Hd:8,gf:11};o.NODE=o.n;o.Sa={ca:0,Id:1,ba:2,X:4,W:8,xc:16};o.POSITION=
o.Sa;var g=o.n,d=o.Sa,q={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},z={hr:1},k={D:A,Jc:u,g:function(a,b){if(!a&&!b)return S;if(!a||!b)return X;a=u(a);b=u(b);return a===b},pa:function(a,b){a=A(a);var e=x.mix(x.mix({},z),b||{});return q[a.css("display")]||e[a.d()]},ea:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
X},v:function(a){a=u(a);for(var b=a.parentNode.childNodes,e=0;e<b.length;e++)if(b[e]===a)return e;return-1},Md:function(a,b){a=u(a);var e=a.firstChild;if((e=e&&new s(e))&&b&&!b(e))e=e.Ca(b);return e},Gc:function(a,b,e){a=u(a);v.h(a);b=u(b);e?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(y.ie)if((a=a.Jf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Ec:function(a,b){if(a.d()!=b.d())return X;var e=a[0].attributes,l=b[0].attributes,B=e.length,
t=l.length;if(B!=t)return X;for(var i=0;i<B;i++){var j=e[i],C=j.name;if(j.specified&&a.attr(C)!=b.attr(C))return X}if(r.dc<8)for(i=0;i<t;i++){j=l[i];C=j.name;if(j.specified&&a.attr(C)!=b.attr(C))return X}return S},Fb:function(a){a=u(a).childNodes;for(var b=0,e=a.length;b<e;b++){var l=a[b],B=l.nodeType;if(!(B==g.e&&l.getAttribute("_ke_bookmark")))if(B==g.e&&!k.Fb(l)||B==g.f&&x.trim(l.nodeValue))return X}return S},Gb:function(a,b,e){a=u(a);b=b[0]||b;if(a!=b)if(e)for(;e=a.lastChild;)b.insertBefore(a.removeChild(e),
b.firstChild);else for(;e=a.firstChild;)b.appendChild(a.removeChild(e))},qa:function(){function a(b,e,l){if(e[0]&&e[0].nodeType==g.e){for(var B=[];e.attr("_ke_bookmark")||e.Fb();){B.push(e);e=l?new s(e[0].nextSibling):new s(e[0].previousSibling);if(!e[0]||e[0].nodeType!=g.e)return}if(b.Ec(e)){for(var t=l?b[0].lastChild:b[0].firstChild;B.length;)B.shift().Gc(b,!l);e.Gb(b,!l);e.h();t[0]&&t[0].nodeType==g.e&&t.qa()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new s(b[0].nextSibling),S);
a(b,new s(b[0].previousSibling))}}}(),Ic:y.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:y.webkit?function(a){a=u(a);a.style.df="none"}:function(a){a=u(a);if(y.ie||y.opera){var b,e=0;for(a.unselectable="on";b=a.all[e++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},Eb:function(a,b){a=u(a);var e,l=0;e=0;var B=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,t=a.ownerDocument,i=t.documentElement;b=b||
t;if(a.getBoundingClientRect){if(a!==t.body&&i!==a){e=a.getBoundingClientRect();l=e.left+(b===t?v.scrollLeft(B):0);e=e.top+(b===t?v.scrollTop(B):0)}if(b)if(B!=(b.defaultView||b.parentWindow)&&B.frameElement){B=k.Eb(B.frameElement,b);l+=B.left;e+=B.top}}return{left:l,top:e}},Od:function(a){return(a=u(a))&&a.contentWindow.document},ga:function(a,b){a=u(a);var e=a.ownerDocument;if(!(!a||a.nodeType!=g.f)){if(y.ie&&b==a.nodeValue.length){var l=e.createTextNode("");v.insertAfter(l,a);return new s(l)}l=
new s(a.splitText(b));if(e.documentMode){e=e.createTextNode("");v.insertAfter(e,l[0]);v.h(e)}return l}},Hb:function(a,b){a=A(a);var e=[];do e[b?"push":"unshift"](a);while(a=a.parent());return e},K:function(a,b,e){a=u(a);a=a.cloneNode(b);if(!e){var l=function(B){if(B.nodeType==g.e){B.removeAttribute("id");B=B.childNodes;for(var t=0;t<B.length;t++)l(B[t])}};l(a)}return new s(a)},w:function(a,b,e,l){a=u(a);if(l&&!l.call){var B=l[0]||l;l=function(i){i=i[0]||i;return i!==B}}b=!b&&a.firstChild;var t=new s(a);
if(!b){if(a.nodeType==g.e&&l&&l(a,S)===X)return T;b=a.nextSibling}for(;!b&&(t=t.parent());){if(l&&l(t,S)===X)return T;b=t[0].nextSibling}if(!b)return T;b=v.D(b);if(l&&l(b)===X)return T;if(e&&e!=b[0].nodeType)return b.w(X,e,l);return b},fa:function(a,b,e,l){a=u(a);if(l&&!l.call){var B=l[0]||l;l=function(i){i=i[0]||i;return i!==B}}b=!b&&a.lastChild;var t=new s(a);if(!b){if(a.nodeType==g.e&&l&&l(a,S)===X)return T;b=a.previousSibling}for(;!b&&(t=t.parent());){if(l&&l(t,S)===X)return T;b=t[0].previousSibling}if(!b)return T;
b=v.D(b);if(l&&l(b)===X)return T;if(e&&b[0].nodeType!=e)return b.fa(X,e,l);return b},Db:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=g.f&&b.contains(a))return b;var e=a[0].nodeType==g.f?a.parent():a;do if(e[0].nodeType!=g.f&&e.contains(b))return e;while(e=e.parent());return T},Kd:function(a,b,e){a=u(a);if(!e)a=a.parentNode;if(b&&!x.isFunction(b)){var l=b;b=function(B){return B.d()==l}}for(;a&&a.nodeType!=9;){if(!b||b(new s(a))===S)return new s(a);a=a.parentNode}return T},Cc:r.dc<9?function(a,
b){a=u(a);var e=a.attributes[b];return!!(e&&e.specified)}:function(a,b){a=u(a);return a.hasAttribute(b)},Xa:r.dc<9?function(a){a=u(a);for(var b=a.attributes,e=0;e<b.length;e++){var l=b[e];switch(l.name){case "class":if(a.getAttribute("class"))return S;break;default:if(l.specified)return S}}return X}:function(a){a=u(a);y.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Da:function(a,b){var e=u(a),l=u(b);if(e.compareDocumentPosition)return e.compareDocumentPosition(l);if(e==l)return d.ca;
if(e.nodeType==g.e&&l.nodeType==g.e){if(e.contains){if(e.contains(l))return d.xc+d.X;if(l.contains(e))return d.W+d.ba}if("sourceIndex"in e)return e.sourceIndex<0||l.sourceIndex<0?d.Id:e.sourceIndex<l.sourceIndex?d.X:d.ba}e=a.Ba();l=b.Ba();for(var B=Math.min(e.length,l.length),t=0;t<=B-1;t++)if(e[t]!=l[t]){if(t<B)return e[t]<l[t]?d.X:d.ba;break}return e.length<l.length?d.xc+d.X:d.W+d.ba},Ba:function(a,b){a=u(a);for(var e=[],l=a.ownerDocument.documentElement,B=a;B&&B!=l;){var t=B.parentNode,i=-1;if(t){for(var j=
0;j<t.childNodes.length;j++){var C=t.childNodes[j];if(!(b&&C.nodeType==3&&C.previousSibling&&C.previousSibling.nodeType==3)){i++;if(C==B)break}}e.unshift(i)}B=t}return e},Cb:function(a,b){var e=new o.Range(a[0].ownerDocument);e.setStartAfter(a);e.setEndAfter(b);var l=e.extractContents();e.insertNode(a.h());a[0].parentNode.insertBefore(l,a[0].nextSibling)},L:function(a,b,e){a=A(a);if(e!==undefined)return a.css(b,e);a=u(a);return a.style[J(b)]},h:function(a,b){var e=u(a),l=e.parentNode;if(l){if(b)for(var B;B=
e.firstChild;)l.insertBefore(e.removeChild(B),e);l.removeChild(e)}return a},Za:function(a){v.Fc(a);v.Hc(a)},Fc:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==g.f){var e=r.Ja(b.nodeValue),l=b.nodeValue.length;if(e){if(e.length<l){(new s(b)).ga(l-e.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Hc:function(a){a=u(a);for(var b;b=a.lastChild;){if(b.type==g.f){var e=r.La(b.nodeValue),l=b.nodeValue.length;if(e){if(e.length<l){(new s(b)).ga(e.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);
continue}}break}if(!y.ie&&!y.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Bb:function(a){a=u(a);for(var b=a.lastChild;b&&b.nodeType==g.f&&!x.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==g.f||v.d(b)!=="br"){b=y.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");y.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},ra:function(a,b){var e=u(a),l;do l=(e=e.previousSibling)&&new s(e);while(l&&b&&!b(l));return l},
Qd:function(a,b){a=v.D(a);var e=a[0].lastChild;if((e=e&&new s(e))&&b&&!b(e))e=e.ra(b);return e},Ca:function(a,b){var e=u(a),l;do l=(e=e.nextSibling)&&new s(e);while(l&&b&&!b(l));return l},Ya:function(a){a=u(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(S));return b.innerHTML},Rd:function(a,b,e,l){a=v.D(a);var B=a.data("list_marker_id")||a.data("list_marker_id",x.guid()).data("list_marker_id"),t=a.data("list_marker_names")||
a.data("list_marker_names",{}).data("list_marker_names");b[B]=a;t[e]=1;return a.data(e,l)},Bc:function(a,b,e){a=A(a);var l=a.data("list_marker_names"),B=a.data("list_marker_id"),t;for(t in l)a.removeData(t);a.removeData("list_marker_names");if(e){a.removeData("list_marker_id");delete b[B]}},Ld:function(a,b,e){a=u(a);b=A(b);var l=a.attributes;e=e||{};for(var B=0;B<l.length;B++){var t=l[B],i=t.name.toLowerCase(),j;if(!(i in e))if(i=="checked"&&(j=v.attr(a,i)))b.attr(i,j);else if(t.specified||y.ie&&
t.value&&i=="value"){j=v.attr(a,i);if(j===T)j=t.nodeValue;b.attr(i,j)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Dc:function(a){a=v.d(a);var b=o.m;return(a=!b.uc[a]&&(b[a]||b.span))&&a["#"]},Ib:function(a){a=A(a);var b=a[0].ownerDocument,e=v.scrollLeft(b),l=v.scrollTop(b),B=a.offset(),t=B.left;B=B.top;if(v.viewportHeight(b)+l<B||B<l||v.viewportWidth(b)+e<t||t<e)a.scrollIntoView(b)},Nd:function(a,b,e){a=u(a);if(!y.ie&&e)b=e+":"+b;e=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)e.push(new s(a[b]));
return e}};x.DOM.Pd=function(a){x.mix(v,a);for(var b in a)a.hasOwnProperty(b)&&function(e){s.prototype[e]=function(){var l=[].slice.call(arguments,0);l.unshift(this);return a[e].apply(T,l)}}(b)};r.o(k,{_4e_wrap:k.D,_4e_unwrap:k.Jc,_4e_equals:k.g,_4e_isBlockBoundary:k.pa,_4e_getWin:k.ea,_4e_index:k.v,_4e_first:k.Md,_4e_move:k.Gc,_4e_name:k.d,_4e_isIdentical:k.Ec,_4e_isEmptyInlineRemoveable:k.Fb,_4e_moveChildren:k.Gb,_4e_mergeSiblings:k.qa,_4e_unselectable:k.Ic,_4e_getOffset:k.Eb,_4e_getFrameDocument:k.Od,
_4e_splitText:k.ga,_4e_parents:k.Hb,_4e_clone:k.K,_4e_nextSourceNode:k.w,_4e_previousSourceNode:k.fa,_4e_commonAncestor:k.Db,_4e_ascendant:k.Kd,_4e_hasAttribute:k.Cc,_4e_hasAttributes:k.Xa,_4e_position:k.Da,_4e_address:k.Ba,_4e_breakParent:k.Cb,_4e_style:k.L,_4e_remove:k.h,_4e_trim:k.Za,_4e_ltrim:k.Fc,_4e_rtrim:k.Hc,_4e_appendBogus:k.Bb,_4e_last:k.Qd,_4e_previous:k.ra,_4e_next:k.Ca,_4e_outerHtml:k.Ya,_4e_setMarker:k.Rd,_4e_clearMarkers:k.Bc,_4e_getUniqueId:k.pf,_4e_copyAttributes:k.Ld,_4e_isEditable:k.Dc,
_4e_scrollIntoView:k.Ib,_4e_getElementsByTagName:k.Nd});v.Pd(k)});
KISSY.Editor.add("elementpath",function(o){function A(f){var g=v,d=v,q=[];for(f=f;f&&f[0];){if(f[0].nodeType==x.e){if(!this.Fe)this.Fe=f;var z=f.d();if(!d){if(!g&&y[z])g=f;if(s[z]){var k;if(k=!g){if(k=z=="div"){a:{k=f;k=k[0]||k;k=k.childNodes;for(var a=0,b=k.length;a<b;a++){var e=k[a];if(e.nodeType==x.e&&J.Pa[e.nodeName.toLowerCase()]){k=S;break a}}k=X}k=!k}k=k}if(k)g=f;else d=f}}q.push(f);if(z=="body")break}f=f.parent()}this.block=this.z=g;this.blockLimit=this.F=d;this.elements=this.elements=q}var u=
KISSY.DOM,J=o.m,x=o.n,v=T,y={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},s={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};A.prototype={Rc:function(f){var g=this.elements;f=f&&f.elements;if(!f||g.length!=f.length)return X;for(var d=0;d<g.length;d++)if(!u.g(g[d],f[d]))return X;return S},contains:function(f){for(var g=this.elements,d=0;d<g.length;d++)if(g[d].d()in f)return g[d];return v}};o.ElementPath=o.Ra=A;var r=A.prototype;o.k.o(r,{compare:r.Rc,
contains:r.contains})});
KISSY.Editor.add("walker",function(o){function A(q,z){if(this.c.end)return y;var k,a=this.wa,b,e=this.ac,l=this.type,B=q?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return y}}if(!q&&!this.c.bd){var t=a.endContainer,i=new g(t[0].childNodes[a.endOffset]);this.c.bd=function(n,c){return(n=f.D(n))&&n[0]&&(!c||!f.g(t,n))&&(!i[0]||!n.g(i))&&(n[0].nodeType!=r.e||!c||n.d()!="body")}}if(q&&!this.c.cd){var j=a.startContainer,C=a.startOffset>
0&&new g(j[0].childNodes[a.startOffset-1]);this.c.cd=function(n,c){return(n=f.D(n))&&n[0]&&(!c||!n.g(j))&&(!C[0]||!n.g(C))&&(n[0].nodeType!=r.e||!c||n.d()!="body")}}var I=q?this.c.cd:this.c.bd;b=e?function(n,c){if(I(n,c)===v)return v;return e(n,c)}:I;if(this.cb)k=this.cb[B](v,l,b);else if(q){k=a.endContainer;if(a.endOffset>0){k=new g(k[0].childNodes[a.endOffset-1]);if(b(k)===v)k=y}else k=b(k,x)===v?y:k.fa(x,l,b)}else{k=a.startContainer;if((k=new g(k[0].childNodes[a.startOffset]))&&k[0]){if(b(k)===
v)k=y}else k=b(a.startContainer,x)===v?y:a.startContainer.w(x,l,b)}for(;k&&k[0]&&!this.c.end;){this.cb=k;if(!this.Q||this.Q(k)!==v){if(!z)return k}else if(z&&this.Q)return v;k=k[B](v,l,b)}this.end();return this.cb=y}function u(q){for(var z,k=y;z=A.call(this,q);)k=z;return k}function J(q){this.wa=q;this.c={}}var x=S,v=X,y=T,s=KISSY,r=o.n,f=s.DOM,g=s.Node;s.augment(J,{end:function(){this.c.end=1},next:function(){return A.call(this)},mb:function(){return A.call(this,x)},Qc:function(){return A.call(this,
v,x)!==v},Pc:function(){return A.call(this,x,x)!==v},kd:function(){return u.call(this)},jd:function(){return u.call(this,x)},reset:function(){delete this.cb;this.c={}}});J.Nb=function(q){return function(z){z=f.D(z);return!(z&&z[0].nodeType==r.e&&z.pa(q))}};J.Ie=function(){return this.Nb({Ob:1})};J.Fa=function(q,z){function k(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,e;b=a&&a[0]&&a[0].nodeType==r.f&&(e=a.parent())&&k(e);b=q?b:b||k(a);return z^b}};J.Oa=function(q){return function(z){z=
(z=z[0]||z)&&z.nodeType==r.f&&!s.trim(z.nodeValue);return q^z}};J.De=function(q){var z=J.Oa();return function(k){k=z(k)||k[0].nodeType==r.e&&!k[0].offsetHeight;return q^k}};o.Aa=J;o.Walker=J;var d=J.prototype;o.k.o(d,{end:d.end,next:d.next,previous:d.mb,checkForward:d.Qc,checkBackward:d.Pc,lastForward:d.kd,lastBackward:d.jd,reset:d.reset});o.k.o(J,{blockBoundary:J.Nb,listItemBoundary:J.Ie,bookmark:J.Fa,whitespaces:J.Oa,invisible:J.De})});
KISSY.Editor.add("range",function(o){function A(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=s;this.document=c}function u(c){var h=c[0].nodeType!=d.f&&c.d()in l.aa,p=!g.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||p||c}function J(c){return!C(c)&&!I(c)}function x(c){var h=r,p=k.Fa(s);return function(w){if(p(w))return s;if(w[0].nodeType==d.f){if(g.trim(w[0].nodeValue).length)return r}else if(w[0].nodeType==d.e)if(!j[w.d()])if(!c&&!e.ie&&
w.d()=="br"&&!h)h=s;else return r;return s}}function v(c,h){function p(w){return w&&w.nodeName=="span"&&w.getAttribute("_ke_bookmark")}return function(w){var m,D;m=w&&!w.nodeName&&(D=w.parentNode)&&p(D);m=c?m:m||p(w);return h^m}}function y(c){return function(h){h=(h=h[0]||h)&&h.nodeType==d.f&&!g.trim(h.nodeValue);return c^h}}o.na={V:1,J:2,C:3,t:4,wb:1,vb:2,Qa:3,Ua:1,Gd:2,lf:3,da:1,yc:2};o.RANGE=o.na;var s=S,r=X,f=T,g=KISSY,d=o.n,q=o.na,z=o.Sa,k=o.Aa,a=g.DOM,b=o.k.Xc,e=g.UA,l=o.m,B=o.Ra,t=g.Node,i=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};A.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};g.augment(A,{Na:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},ic:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=d.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=d.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},jc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.T(c,q.C);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.S(h,q.t)},setStart:function(c,h){if(c[0].nodeType==d.e&&i[c.d()]){c=c.parent();h=c.v()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Na()},setEnd:function(c,h){if(c[0].nodeType==d.e&&i[c.d()]){c=c.parent();h=c.v()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Na()},T:function(c,h){switch(h){case q.V:this.setStart(c,0);break;case q.J:c[0].nodeType==d.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case q.C:this.setStartBefore(c);break;case q.t:this.setStartAfter(c)}this.Na()},S:function(c,h){switch(h){case q.V:this.setEnd(c,0);break;case q.J:c[0].nodeType==d.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case q.C:this.setEndBefore(c);break;case q.t:this.setEndAfter(c)}this.Na()},
Ub:function(c,h){var p=this.startContainer,w=this.endContainer,m=this.startOffset,D=this.endOffset,O,N=this.document,P;this.jc();if(w[0].nodeType==d.f)w=w.ga(D);else if(w[0].childNodes.length>0)if(D>=w[0].childNodes.length){w=new t(w[0].appendChild(N.createTextNode("")));P=s}else w=new t(w[0].childNodes[D]);if(p[0].nodeType==d.f){p.ga(m);if(p.g(w))w=new t(p[0].nextSibling)}else if(m)if(m>=p[0].childNodes.length){O=new t(N.createTextNode(""));p.append(O);p=O;O=s}else p=new t(p[0].childNodes[m].previousSibling);
else{O=new t(N.createTextNode(""));(m=p[0].firstChild)?a.insertBefore(O[0],m):p.append(O);p=O;O=s}m=p.Hb();D=w.Hb();var Q,W,U;for(Q=0;Q<m.length;Q++){W=m[Q];U=D[Q];if(!W.g(U))break}N=h;for(var V,Y,E,K=Q;K<m.length;K++){V=m[K];Y=N&&!V.g(p)?N.appendChild(V.K()[0]):T;for(V=V[0].nextSibling;V;){if(a.g(D[K],V)||a.g(w,V))break;E=V.nextSibling;if(c==2)N.appendChild(V.cloneNode(s));else{a.h(V);c==1&&N.appendChild(V)}V=E}if(Y)N=Y}N=h;for(Q=Q;Q<D.length;Q++){V=D[Q];Y=N&&c>0&&!V.g(w)?N.appendChild(V.K()[0]):
T;if(!m[Q]||!V.parent().g(m[Q].parent()))for(V=V[0].previousSibling;V;){if(a.g(m[Q],V)||a.g(p,V))break;E=V.previousSibling;if(c==2)N.insertBefore(V.cloneNode(s),N.firstChild);else{a.h(V);c==1&&N.insertBefore(V,N.firstChild)}V=E}if(Y)N=Y}if(c==2){U=this.startContainer[0];if(U.nodeType==d.f&&U.nextSibling&&U.nextSibling.nodeType==d.f){U.data+=U.nextSibling.data;U.parentNode.removeChild(U.nextSibling)}U=this.endContainer[0];if(U.nodeType==d.f&&U.nextSibling&&U.nextSibling.nodeType==d.f){U.data+=U.nextSibling.data;
U.parentNode.removeChild(U.nextSibling)}}else{if(W&&U&&(!p.parent().g(W.parent())||!w.parent().g(U.parent()))){W=U.v();O&&U.parent().g(p.parent())&&W--;this.setStart(U.parent(),W)}this.collapse(s)}O&&p.h();P&&w[0].parentNode&&w.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=s},clone:function(){var c=new A(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},Zc:function(){var c=this.clone();c.ic();if(c.startContainer[0].nodeType!=d.e||c.endContainer[0].nodeType!=d.e)return f;var h=new o.Aa(c),p=v(s,undefined),w=y(s);c.Q=function(m){return w(m)&&p(m)};c=h.next();h.reset();h=h.mb();return c&&c.g(h)?c:f},Ma:function(c,h){if(!this.collapsed){c=c||q.yc;var p=this.clone(),w=this.startContainer,m=this.endContainer,D=this.startOffset,
O=this.endOffset,N=1,P=1;if(w&&w[0].nodeType==d.f)if(D)if(D>=w[0].nodeValue.length)p.setStartAfter(w);else{p.setStartBefore(w);N=0}else p.setStartBefore(w);if(m&&m[0].nodeType==d.f)if(O)if(O>=m[0].nodeValue.length)p.setEndAfter(m);else{p.setEndAfter(m);P=0}else p.setEndBefore(m);p=new k(p);p.Q=function(W){W=W[0]||W;return W.nodeType==(c==q.da?d.e:d.f)};var Q;p.ac=function(W,U){W=W[0]||W;if(c==q.da&&W.nodeType==d.f)return r;if(U&&W==Q)return r;if(!U&&W.nodeType==d.e)Q=W;return s};if(N)(w=p[c==q.da?
"lastForward":"next"]())&&this.T(w,h?q.V:q.C);if(P){p.reset();(p=p[c==q.da?"lastBackward":"previous"]())&&this.S(p,h?q.J:q.t)}return!!(N||P)}},we:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=d.e)return c;return c.childNodes[this.startOffset]||c},Sc:function(c){var h=this.startContainer,p=this.endContainer,w=this.startOffset,m=this.endOffset,D,O;if(!h||!p)return{start:0,end:0};if(c){if(h[0].nodeType==d.e)if((D=new t(h[0].childNodes[w]))&&D[0]&&D[0].nodeType==d.f&&w>0&&D[0].previousSibling.nodeType==
d.f){h=D;w=0}for(;h[0].nodeType==d.f&&(O=h.ra())&&O[0].nodeType==d.f;){h=O;w+=O[0].nodeValue.length}if(!this.collapsed){if(p[0].nodeType==d.e)if((D=new t(p[0].childNodes[m]))&&D[0]&&D[0].nodeType==d.f&&m>0&&D[0].previousSibling.nodeType==d.f){p=D;m=0}for(;p[0].nodeType==d.f&&(O=p.ra())&&O[0].nodeType==d.f;){p=O;m+=O[0].nodeValue.length}}}return{start:h.Ba(c),end:this.collapsed?f:p.Ba(c),startOffset:w,endOffset:m,md:c,Ee:s}},O:function(c){var h,p,w,m,D=this.collapsed;h=new t("<span>",f,this.document);
h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){w=g.guid("ke_bm_");h.attr("id",w+"S")}if(!D){p=h.K();p.html("&nbsp;");c&&p.attr("id",w+"E");m=this.clone();m.collapse();m.insertNode(p)}m=this.clone();m.collapse(s);m.insertNode(h);if(p){this.setStartAfter(h);this.setEndBefore(p)}else this.H(h,q.t);return{Y:c?w+"S":h,P:c?w+"E":p,yd:c,collapsed:D}},H:function(c,h){this.T(c,h);this.collapse(s)},trim:function(c,h){var p=this.startContainer,w=this.startOffset,m=this.collapsed;if((!c||
m)&&p[0]&&p[0].nodeType==d.f){if(w)if(w>=p[0].nodeValue.length){w=p.v()+1;p=p.parent()}else{var D=p.ga(w);w=p.v()+1;p=p.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(D,this.endOffset-this.startOffset);else if(a.g(p,this.endContainer))this.endOffset+=1}else{w=p.v();p=p.parent()}this.setStart(p,w);if(m){this.collapse(s);return}}p=this.endContainer;w=this.endOffset;if(!(h||m)&&p[0]&&p[0].nodeType==d.f){if(w){w>=p.nodeValue.length||p.ga(w);w=p.v()+1}else w=p.v();p=p.parent();this.setEnd(p,
w)}},insertNode:function(c){this.jc();this.trim(r,s);var h=this.startContainer,p=h[0].childNodes[this.startOffset];p?a.insertBefore(c[0]||c,p):h[0].appendChild(c[0]||c);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.Ee){var h=b(this.document,c.start,c.md),p=c.startOffset,w=c.end&&b(this.document,c.end,c.md);c=c.endOffset;this.setStart(h,p);w?this.setEnd(w,c):this.collapse(s)}else{h=(p=c.yd)?g.one("#"+c.Y,this.document):c.Y;c=p?g.one("#"+
c.P,this.document):c.P;this.setStartBefore(h);h.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(s)}},ua:function(c,h){var p=this.startContainer,w=this.endContainer;p=a.g(p,w)?c&&p[0].nodeType==d.e&&this.startOffset==this.endOffset-1?new t(p[0].childNodes[this.startOffset]):p:p.Db(w);return h&&p[0].nodeType==d.f?p.parent():p},Ha:function(c){switch(c){case q.wb:if(this.collapsed)break;c=this.ua();var h=new t(this.document.body),p,w,m,D,O,N=r,P,Q;P=this.startContainer;Q=this.startOffset;
if(P[0].nodeType==d.f){if(Q){P=!g.trim(P[0].nodeValue.substring(0,Q)).length&&P;N=!!P}if(P)if(!(D=P[0].previousSibling))m=P.parent()}else{if(Q)D=P[0].childNodes[Q-1]||P[0].lastChild;D||(m=P)}for(;m||D;){if(m&&!D){if(!O&&a.g(m,c))O=s;if(!h.contains(m))break;if(!N||m.css("display")!="inline"){N=r;if(O)p=m;else this.setStartBefore(m)}D=m[0].previousSibling}for(;D;){P=r;if(D.nodeType==d.f){Q=D.nodeValue;if(/[^\s\ufeff]/.test(Q))D=f;P=/[\s\ufeff]$/.test(Q)}else if(D.offsetWidth>0&&!D.getAttribute("_ke_bookmark"))if(N&&
l.aa[D.nodeName.toLowerCase()]){Q=a.text(D);if(/[^\s\ufeff]/.test(Q))D=f;else for(var W=D.all||D.getElementsByTagName("*"),U=0,V;V=W[U++];)if(!l.aa[V.nodeName.toLowerCase()]){D=f;break}if(D)P=!!Q.length}else D=f;if(P)if(N)if(O)p=m;else m&&this.setStartBefore(m);else N=s;if(D){P=D.previousSibling;if(!m&&!P){m=new t(D);D=f;break}D=P}else m=f}if(m)m=m.parent()}P=this.endContainer;Q=this.endOffset;m=D=f;O=N=r;if(P[0].nodeType==d.f){P=!g.trim(P[0].nodeValue.substring(Q)).length&&P;N=!(P&&P[0].nodeValue.length);
if(P)if(!(D=P[0].nextSibling))m=P.parent()}else(D=P[0].childNodes[Q])||(m=P);for(;m||D;){if(m&&!D){if(!O&&a.g(m,c))O=s;if(!h.contains(m))break;if(!N||m.css("display")!="inline"){N=r;if(O)w=m;else m&&this.setEndAfter(m)}D=m[0].nextSibling}for(;D;){P=r;if(D.nodeType==d.f){Q=D.nodeValue;if(/[^\s\ufeff]/.test(Q))D=f;P=/^[\s\ufeff]/.test(Q)}else if(D.offsetWidth>0&&!D.getAttribute("_ke_bookmark"))if(N&&l.aa[D.nodeName.toLowerCase()]){Q=a.text(D);if(/[^\s\ufeff]/.test(Q))D=f;else{W=D.all||D.getElementsByTagName("*");
for(U=0;V=W[U++];)if(!l.aa[V.nodeName.toLowerCase()]){D=f;break}}if(D)P=!!Q.length}else D=f;if(P)if(N)if(O)w=m;else this.setEndAfter(m);if(D){P=D.nextSibling;if(!m&&!P){m=new t(D);D=f;break}D=P}else m=f}if(m)m=m.parent()}if(p&&w){c=p.contains(w)?w:p;this.setStartBefore(c);this.setEndAfter(c)}break;case q.vb:case q.Qa:m=new A(this.document);h=new t(this.document.body);m.T(h,q.V);m.setEnd(this.startContainer,this.startOffset);m=new k(m);var Y,E,K=k.Nb(c==q.Qa?{Ob:1}:f),G=function(F){var H=K(F);H||(Y=
F);return H};p=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")E=F;return H};m.ac=G;m=m.jd();Y=Y||h;this.T(Y,Y.d()!="br"&&(!m&&this.sa()||m&&Y.contains(m))?q.V:q.t);m=this.clone();m.collapse();m.S(h,q.J);m=new k(m);m.ac=c==q.Qa?p:G;Y=f;m=m.kd();Y=Y||h;this.S(Y,!m&&this.ja()||m&&Y.contains(m)?q.J:q.C);E&&this.setEndAfter(E)}},sa:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==d.f)if(g.trim(c[0].nodeValue.substring(0,h)).length)return r;this.trim();c=new B(this.startContainer);
h=this.clone();h.collapse(s);h.T(c.z||c.F,q.V);c=new k(h);c.Q=x(s);return c.Pc()},ja:function(){var c=this.endContainer,h=this.endOffset;if(c[0].nodeType==d.f)if(g.trim(c[0].nodeValue.substring(h)).length)return r;this.trim();c=new B(this.endContainer);h=this.clone();h.collapse(r);h.S(c.z||c.F,q.J);c=new k(h);c.Q=x(r);return c.Qc()},deleteContents:function(){this.collapsed||this.Ub(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Ub(1,c);return c},Qb:function(c,
h){var p=this.clone();p[h==q.Ua?"setStartAt":"setEndAt"](c,h==q.Ua?q.V:q.J);p=new k(p);p.Q=u;return p[h==q.Ua?"checkBackward":"checkForward"]()},Wc:function(){var c=this.startContainer,h=this.endContainer,p=this.startOffset,w=this.endOffset,m;if(c[0].nodeType==d.e){m=c[0].childNodes.length;if(m>p)c=new t(c[0].childNodes[p]);else if(m<1)c=c.fa();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new t(c);c=c.w()||c}}if(h[0].nodeType==d.e){m=h[0].childNodes.length;if(m>w)h=(new t(h[0].childNodes[w])).fa(s);
else if(m<1)h=h.fa();else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new t(h)}}if(c.Da(h)&z.ba)c=h;return{Y:c,P:h}},db:function(c,h){var p=this.O(),w=new t(this.document.createElement(h));this.collapse(c);this.Ha(q.vb);w[0].appendChild(this.extractContents());w.Za();e.ie||w.Bb();this.insertNode(w);this.moveToBookmark(p);return w},oc:function(c){var h=new B(this.startContainer),p=new B(this.endContainer),w=h.z,m=p.z,D=f;if(!h.F.g(p.F))return f;if(c!="br"){if(!w){w=this.db(s,c);m=(new B(this.endContainer)).z}m||
(m=this.db(r,c))}c=w&&this.sa();h=m&&this.ja();this.deleteContents();if(w&&a.g(w,m))if(h){D=new B(this.startContainer);this.H(m,q.t);m=f}else if(c){D=new B(this.startContainer);this.H(w,q.C);w=f}else{m=this.pc(w);!e.ie&&!g.inArray(w.d(),["ul","ol"])&&w.Bb()}return{Gf:w,Ff:m,We:c,Ve:h,Cf:D}},pc:function(c){if(!this.collapsed)return f;this.S(c,q.J);var h=this.extractContents(),p=c.K(r);p[0].appendChild(h);p.insertAfter(c);this.H(c,q.t);return p},ib:function(c,h){var p,w=o.m;if(w.rb[c.d()])return r;
for(;c&&c[0].nodeType==d.e;){if(p=c.Dc())this.H(c,h?q.J:q.V);else if(w.sc[c.d()]){this.H(c,h?q.t:q.C);return s}if((c=w.rb[c.d()]?c[h?"_4e_previous":"_4e_next"](J):c[h?"_4e_last":"_4e_first"](J))&&c[0].nodeType==d.f){this.H(c,h?q.t:q.C);return s}}return p},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==d.f?c[0].nodeValue.length:c[0].childNodes.length)}});var j={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,
small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},C=new k.Oa,I=new k.Fa;o.Range=A;o.Range=A;var n=A.prototype;o.k.o(n,{updateCollapsed:n.Na,optimize:n.ic,setStartAfter:n.setStartAfter,setEndAfter:n.setEndAfter,setStartBefore:n.setStartBefore,setEndBefore:n.setEndBefore,optimizeBookmark:n.jc,setStart:n.setStart,setEnd:n.setEnd,setStartAt:n.T,setEndAt:n.S,execContentsAction:n.Ub,collapse:n.collapse,clone:n.clone,getEnclosedNode:n.Zc,shrink:n.Ma,getTouchedStartNode:n.we,createBookmark2:n.Sc,
createBookmark:n.O,moveToPosition:n.H,trim:n.trim,insertNode:n.insertNode,moveToBookmark:n.moveToBookmark,getCommonAncestor:n.ua,enlarge:n.Ha,checkStartOfBlock:n.sa,checkEndOfBlock:n.ja,deleteContents:n.deleteContents,extractContents:n.extractContents,checkBoundaryOfElement:n.Qb,getBoundaryNodes:n.Wc,fixBlock:n.db,splitBlock:n.oc,splitElement:n.pc,moveToElementEditablePosition:n.ib,selectNodeContents:n.selectNodeContents})});
KISSY.Editor.add("domiterator",function(o){function A(k){if(!(arguments.length<1)){this.wa=k;this.Wb=J;this.Vc=u;this.Tb=J;this.c||(this.c={})}}var u=S,J=X,x=KISSY,v=x.UA,y=o.Aa,s=o.Range,r=o.na,f=o.n,g=o.Ra,d=x.Node,q=x.DOM,z=/^[\r\n\t ]*$/;x.augment(A,{ve:function(k){var a,b,e,l,B;if(!this.c.I){b=this.wa.clone();b.Ma(r.da,u);b.Ha(this.Wb||!this.Vc?r.Qa:r.vb);var t=new y(b),i=y.Fa(u,u);t.Q=i;this.c.ka=t.next();t=new y(b);t.Q=i;t=t.mb();this.c.I=t.w(u);if(this.c.I&&this.c.I[0].nodeType==f.f&&!x.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().pa()){i=new s(b.document);i.H(this.c.I,r.t);if(i.ja()){i=new g(i.endContainer);this.c.I=(i.z||i.F).w(u)}}if(!this.c.I){this.c.I=this.c.Uc=new d(b.document.createTextNode(""));q.insertAfter(this.c.I[0],t[0])}b=T}i=this.c.ka;t=this.c.I;for(this.c.ka=T;i;){var j=J,C=i[0].nodeType!=f.e,I=J;if(C){if(i[0].nodeType==f.f)if(z.test(i[0].nodeValue))C=J}else{var n=i.d();if(i.pa(this.Wb&&{Ob:1})){if(n=="br")C=u;else if(!b&&!i[0].childNodes.length&&n!="hr"){a=i;e=i.g(t);break}if(b){b.S(i,r.C);
if(n!="br")this.c.ka=i}j=u}else{if(i[0].firstChild){if(!b){b=new s(this.wa.document);b.T(i,r.C)}i=new d(i[0].firstChild);continue}C=u}}if(C&&!b){b=new s(this.wa.document);b.T(i,r.C)}e=(!j||C)&&i.g(t);if(b&&!j)for(;!i[0].nextSibling&&!e;){n=i.parent();if(n.pa(this.Wb&&{Ob:1})){j=u;e||n.g(t);break}i=n;C=u;e=i.g(t);I=u}C&&b.S(i,r.t);i=i.w(I,T,t);if((e=!i)||j&&b)break}if(!a){if(!b){this.c.Uc&&this.c.Uc.h();return this.c.ka=T}a=new g(b.startContainer);i=a.F;j={Af:1,Mf:1,Lf:1};a=a.z;if((!a||!a[0])&&!this.Tb&&
j[i.d()]&&b.sa()&&b.ja())a=i;else if(!a||this.Tb&&a.d()=="li"){a=new d(this.wa.document.createElement(k||"p"));a[0].appendChild(b.extractContents());a.Za();b.insertNode(a);l=B=u}else if(a.d()!="li"){if(!b.sa()||!b.ja()){a=a.K(J);a[0].appendChild(b.extractContents());a.Za();B=b.oc();l=!B.We;B=!B.Ve;b.insertNode(a)}}else if(!e)this.c.ka=a.g(t)?T:b.Wc().P.w(u,T,t)}if(l){b=new d(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&q.d(b[0].lastChild)=="br"&&q.h(b[0].lastChild)}if(B){b=
y.Fa(J,u);l=new d(a[0].lastChild);if(l[0]&&l[0].nodeType==f.e&&l.d()=="br")if(v.ie||l.ra(b)||l.Ca(b))l.h()}if(!this.c.ka)this.c.ka=e||a.g(t)?T:a.w(u,T,t);return a}});s.prototype.ne=function(){return new A(this)}});
KISSY.Editor.add("selection",function(o){function A(i){this.document=this.document=i;this.c={M:{}};if(r.ie){var j=this.r().createRange();if(!j||j.item&&j.item(0).ownerDocument!=i||j.parentElement&&j.parentElement().ownerDocument!=i)this.hd=x}}function u(i){i=new A(i);return!i||i.hd?y:i}function J(i){var j=i.document,C=new d(j.body),I=new d(j.documentElement);if(r.ie){if(r.ie<8||document.documentMode==7)I.on("click",function(N){f.d(N.target)==="html"&&i.getSelection().A()[0].select()});var n,c,h=1;
I.on("mousedown",function(){h=0});I.on("mouseup",function(){h=1});C.on("focusin",function(N){if(f.d(N.target)=="body")if(n){try{h&&n.select()}catch(P){}n=y}});C.on("focus",function(){c=x;w()});C.on("beforedeactivate",function(N){if(!N.relatedTarget){c=v;h=1}});g.on(f.ea(j),"blur",function(){j&&j.selection.empty()});C.on("mousedown",function(){p()});C.on("mouseup",function(){c=x;setTimeout(function(){w(x)},0)});var p=function(){c=v},w=function(N){if(c){var P=i.document,Q=i.getSelection(),W=Q&&Q.eb(),
U=Q&&Q.r();if(N&&U&&W==q.yb)if(!P.queryCommandEnabled("InsertImage")){setTimeout(function(){w(x)},50);return}var V;if(!(U&&W==q.oa&&(V=f.d(U.createRange().parentElement()))&&V in{input:1,textarea:1})){n=U&&Q.A()[0];i.$a()}}};C.on("keydown",p);C.on("keyup",function(){c=x;w()});g.on(j,"selectionchange",w)}else{g.on(j,"mouseup",i.$a,i);g.on(j,"keyup",i.$a,i)}var m={table:1,pre:1},D=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,O=o.Aa.Oa(x);
i.on("selectionChange",function(N){var P=N.path;N=(N=N.selection)&&N.A()[0];if(!(!N||!N.collapsed||P.z))if(P.F.d()=="body"){P=N.db(x,"p");if(P.Ya().match(D)){var Q=P.Ca(O);if(Q&&Q[0].nodeType==k.e&&!m[Q.d()]){N.ib(Q);P.h()}else if((Q=P.ra(O))&&Q[0].nodeType==k.e&&!m[Q.d()]){N.ib(Q,Q.Ya().match(D)?v:x);P.h()}}N.select();r.ie||i.jb()}})}o.Jd={yb:1,oa:2,Ta:3};var x=S,v=X,y=T,s=KISSY,r=s.UA,f=s.DOM,g=s.Event,d=s.Node,q=o.Jd,z=o.na,k=o.n,a=o.Aa,b=o.Range,e={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};s.augment(A,{r:r.ie?function(){var i=this.c.M;return i.gc||(i.gc=this.document.selection)}:function(){var i=this.c.M;return i.gc||(i.gc=f.ea(this.document).getSelection())},eb:r.ie?function(){var i=this.c.M;if(i.type)return i.type;var j=q.yb;try{var C=this.r(),I=C.type;if(I=="Text")j=q.oa;if(I=="Control")j=q.Ta;if(C.createRange().parentElement)j=q.oa}catch(n){}return i.type=j}:function(){var i=this.c.M;
if(i.type)return i.type;var j=q.oa,C=this.r();if(C){if(C.rangeCount==1){C=C.getRangeAt(0);var I=C.startContainer;if(I==C.endContainer&&I.nodeType==k.e&&C.endOffset-C.startOffset===1&&e[I.childNodes[C.startOffset].nodeName.toLowerCase()])j=q.Ta}}else j=q.yb;return i.type=j},A:r.ie?function(){function i(j,C){j=j.duplicate();j.collapse(C);for(var I=j.parentElement(),n=I.childNodes,c,h=0;h<n.length;h++){var p=n[h];if(p.nodeType==k.e){c=j.duplicate();c.moveToElementText(p);p=c.compareEndPoints("StartToStart",
j);var w=c.compareEndPoints("EndToStart",j);c.collapse();if(p>0)break;else if(!p||w==1&&p==-1)return{Ga:I,offset:h};else if(!w)return{Ga:I,offset:h+1};c=y}}if(!c){c=j.duplicate();c.moveToElementText(I);c.collapse(v)}c.setEndPoint("StartToStart",j);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=n[--h].nodeValue.length}catch(m){c=0}return c===0?{Ga:I,offset:h}:{Ga:n[h],offset:-c}}return function(){var j=this.c.M;if(j.ma)return j.ma;var C=this.r(),I=C&&C.createRange(),n=this.eb();if(!C)return[];
if(n==q.oa){C=new b(this.document);n=i(I,x);C.setStart(new d(n.Ga),n.offset);n=i(I);C.setEnd(new d(n.Ga),n.offset);return j.ma=[C]}else if(n==q.Ta){j=j.ma=[];for(n=0;n<I.length;n++){var c=I.item(n),h=c.parentNode,p=0;for(C=new b(this.document);p<h.childNodes.length&&h.childNodes[p]!=c;p++);C.setStart(new d(h),p);C.setEnd(new d(h),p+1);j.push(C)}return j}return j.ma=[]}}():function(){var i=this.c.M;if(i.ma)return i.ma;var j=[],C=this.r();if(!C)return[];for(var I=0;I<C.rangeCount;I++){var n=C.getRangeAt(I),
c=new b(this.document);c.setStart(new d(n.startContainer),n.startOffset);c.setEnd(new d(n.endContainer),n.endOffset);j.push(c)}return i.ma=j},$b:function(){var i=this.c.M;if(i.zd!==undefined)return i.zd;var j,C=this.r();switch(this.eb()){case q.Ta:return this.Zb();case q.oa:var I=this.A()[0];if(I)if(!I.collapsed){for(I.ic();x;){j=I.startContainer;if(I.startOffset==(j[0].nodeType===k.e?j[0].childNodes.length:j[0].nodeValue.length)&&!j.pa())I.setStartAfter(j);else break}j=I.startContainer;if(j[0].nodeType!=
k.e)return j.parent();j=new d(j[0].childNodes[I.startOffset]);if(!j[0]||j[0].nodeType!=k.e)return I.startContainer;for(I=j[0].firstChild;I&&I.nodeType==k.e;){j=new d(I);I=I.firstChild}return j}if(r.ie){I=C.createRange();I.collapse(x);j=I.parentElement()}else if((j=C.anchorNode)&&j.nodeType!=k.e)j=j.parentNode}return i.zd=j?f.D(j):y},Zb:function(){var i=this,j,C=i.c.M;if(C.xd!==undefined)return C.xd;if(r.ie){j=i.r().createRange();j=j.item&&j.item(0)}j||(j=function(){for(var I=i.A()[0],n,c,h=2;h&&!((n=
I.Zc())&&n[0].nodeType==k.e&&e[n.d()]&&(c=n));h--)I.Ma(z.da);return c&&c[0]}());return C.xd=f.D(j)},reset:function(){this.c.M={}},nc:function(i){var j;if(r.ie)try{j=this.document.body.createControlRange();j.addElement(i[0]);j.select()}catch(C){j=this.document.body.createTextRange();j.moveToElementText(i[0]);j.select()}finally{}else{j=this.document.createRange();j.selectNode(i[0]);i=this.r();i.removeAllRanges();i.addRange(j)}this.reset()},pb:function(i){if(r.ie){if(i.length>1){var j=i[i.length-1];
i[0].setEnd(j.endContainer,j.endOffset);i.length=1}i[0]&&i[0].select()}else{j=this.r();if(!j)return;j.removeAllRanges();for(var C=0;C<i.length;C++){var I=i[C],n=this.document.createRange(),c=I.startContainer;I.collapsed&&r.gecko&&r.gecko<1.09&&c[0].nodeType==k.e&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));n.setStart(c[0],I.startOffset);n.setEnd(I.endContainer[0],I.endOffset);j.addRange(n)}}this.reset()},me:function(i){for(var j=[],C=this.A(),I=0;I<C.length;I++)j.push(C[I].Sc(i));
return j},le:function(i,j){var C=[],I=this.document,n;j=j||this.A();for(var c=j.length,h=0;h<c;h++){C.push(n=j[h].O(i,x));var p=(i=n.yd)?s.one("#"+n.Y,I):n.Y;n=i?s.one("#"+n.P,I):n.P;for(var w=h+1;w<c;w++){var m=j[w],D=m.startContainer,O=m.endContainer;f.g(D,p.parent())&&m.startOffset++;f.g(D,n.parent())&&m.startOffset++;f.g(O,p.parent())&&m.endOffset++;f.g(O,n.parent())&&m.endOffset++}}return C},wd:function(i){for(var j=[],C=0;C<i.length;C++){var I=new b(this.document);I.moveToBookmark(i[C]);j.push(I)}this.pb(j);
return this},ua:function(){var i=this.A();return i[0].startContainer.Db(i[i.length-1].endContainer)},scrollIntoView:function(){var i=this.$b();i&&i.Ib()},removeAllRanges:function(){var i=this.r();if(r.ie)i&&i.clear();else i&&i.removeAllRanges()}});var l={table:1,tbody:1,tr:1},B=a.Oa(x),t=/\ufeff|\u00a0/;b.prototype.select=b.prototype.select=r.ie?function(i){var j=this.collapsed,C,I;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var n=this.startContainer[0].childNodes[this.startOffset];
if(n.nodeType==k.e){(new A(this.document)).nc(new d(n));return}}if(this.startContainer[0].nodeType==k.e&&this.startContainer.d()in l||this.endContainer[0].nodeType==k.e&&this.endContainer.d()in l)this.Ma(z.da,x);var c=this.O();n=c.Y;var h;if(!j)h=c.P;c=this.document.body.createTextRange();c.moveToElementText(n[0]);c.moveStart("character",1);if(h){i=this.document.body.createTextRange();i.moveToElementText(h[0]);c.setEndPoint("EndToEnd",i);c.moveEnd("character",-1)}else{for(C=n[0].nextSibling;C&&!B(C);)C=
C.nextSibling;C=!(C&&C.nodeValue&&C.nodeValue.match(t))&&(i||!n[0].previousSibling||n[0].previousSibling&&f.d(n[0].previousSibling)=="br");I=this.document.createElement("span");I.innerHTML="&#65279;";I=new d(I);f.insertBefore(I[0],n[0]);C&&f.insertBefore(this.document.createTextNode("\ufeff"),n[0])}this.setStartBefore(n);n.h();if(j){if(C){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(I){this.H(I,z.C);I.h()}}else{this.setEndBefore(h);h.h();c.select()}}:function(){var i=
this.startContainer;this.collapsed&&i[0].nodeType==k.e&&!i[0].childNodes.length&&i[0].appendChild(this.document.createTextNode(""));var j=this.document.createRange();j.setStart(i[0],this.startOffset);try{j.setEnd(this.endContainer[0],this.endOffset)}catch(C){if(C.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(x);j.setEnd(this.endContainer[0],this.endOffset)}else throw C;}i=u(this.document).r();i.removeAllRanges();i.addRange(j)};A.getSelection=u;o.Ac=A;o.Selection=A;a=A.prototype;o.k.o(a,
{getNative:a.r,getType:a.eb,getRanges:a.A,getStartElement:a.$b,getSelectedElement:a.Zb,reset:a.reset,selectElement:a.nc,selectRanges:a.pb,createBookmarks2:a.me,createBookmarks:a.le,getCommonAncestor:a.ua,scrollIntoView:a.scrollIntoView,selectBookmarks:a.wd,removeAllRanges:a.removeAllRanges});o.on("instanceCreated",function(i){J(i.qe)})});
KISSY.Editor.add("styles",function(o){function A(E,K){for(var G in E)E[G]=E[G].replace(V,function(F,H){return K[H]})}function u(E,K){if(K){E=C.clone(E);A(E.attributes,K);A(E.styles,K)}var G=this.element=this.element=(E.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.zb:W[G]?c.Va:c.za;this.c={definition:E}}function J(E,K){var G=K?this.mc:this.Lb;E.body.focus();for(var F=new p(E),H=F.A(),M=0;M<H.length;M++)G.call(this,H[M]);F.pb(H)}function x(E,K){var G;G=E.element;if(G=="*")G="span";
G=new O(K.createElement(G));return v(G,E)}function v(E,K){var G=K.c.definition,F=G.attributes;G=u.ad(G);if(F)for(var H in F)E.attr(H,F[H]);if(G)E[0].style.cssText=G;return E}function y(E){var K=E.O(t),G=E.ne();G.Tb=t;G.Vc=t;for(var F,H=E.document;F=G.ve();){var M=x(this,H);F=F;var L=M;M=L.d=="pre";var R=F.d=="pre",ba=!M&&R;if(M&&!R){R=F;L=L;ba=R.html();ba=s(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(N.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+ba+"</pre>";L=new O(R.firstChild);L.h()}else L.html(ba);L=L}else if(ba)L=f(r(F),L);else F.Gb(L);F[0].parentNode.replaceChild(L[0],F[0]);if(M){F=L;M=void 0;if((M=F.fa(t,w.e))&&M.d()=="pre"){L=s(M.html(),/\n$/,"")+"\n\n"+s(F.html(),/^\n/,"");if(N.ie)F[0].outerHTML="<pre>"+L+"</pre>";else F.html(L);M.h()}}}E.moveToBookmark(K)}function s(E,K,G){var F="",H="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(M,L,R){L&&(F=L);R&&(H=R);return""});return F+E.replace(K,G)+H}function r(E){var K=[];s(E.Ya(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function f(E,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<E.length;F++){var H=E[F];H=H.replace(/(\r\n|\r)/g,"\n");H=s(H,/^[ \t]*\n/,"");H=s(H,/\n$/,"");H=s(H,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=K.K();M.html(H);G.appendChild(M[0])}return G}function g(E){var K=E.document;if(E.collapsed){K=x(this,K);E.insertNode(K);E.H(K,h.J)}else{var G=this.element,F=this.c.definition,H,M=o.m[G]||(H=t,o.m.span),L=E.O();E.Ha(h.wb);E.trim();var R=E.O(),ba=R.Y;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=i;if(n.g($,R)){$=
j;Z=t}else{var aa=$[0].nodeType,fa=aa==w.e?$.d():j;if(fa&&$.attr("_ke_bookmark")){$=$.w(t);continue}if(!fa||M[fa]&&($.Da(R)|m.X|m.ca|m.W)==m.X+m.ca+m.W&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((o.m[ga.d()]||o.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!o.m.aa[fa]||($.Da(R)|m.X|m.ca|m.W)==m.X+m.ca+m.W)){ca=new D(K);ca.setStartBefore($)}if(aa==w.f||aa==w.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Ca(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),M[da.d()])&&(da.Da(ba)|m.ba|m.ca|m.W)==m.ba+m.ca+m.W&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=t)}}else Z=t}else Z=t;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=x(this,K);for(aa=ca.ua();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.Xa()){Z=j;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());e(this,Z);ca.insertNode(Z);
Z.qa();N.ie||Z[0].normalize()}ca=j}}ba.h();R.h();E.moveToBookmark(L);E.Ma(h.yc)}}function d(E){E.Ha(h.wb);var K=E.O(),G=K.Y;if(E.collapsed){for(var F=new P(G.parent()),H,M=0,L;M<F.elements.length&&(L=F.elements[M]);M++){if(L==F.z||L==F.F)break;if(this.ia(L)){var R=E.Qb(L,h.Gd),ba=!R&&E.Qb(L,h.Ua);if(ba||R){H=L;H.match=ba?"start":"end"}else{L.qa();L.d()==this.element?a(this,L):l(L,k(this)[L.d()])}}}if(H&&H[0]){L=G;for(M=0;;M++){R=F.elements[M];if(n.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(L[0]);L=R}n[H.match=="start"?"insertBefore":"insertAfter"](L[0],H[0])}}else{var $=K.P,ca=this;F=function(){for(var Z=new P(G.parent()),aa=new P($.parent()),fa=j,ga=j,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Cb(ga);fa&&G.Cb(fa)};F();for(H=new O(G[0].nextSibling);H[0]!==$[0];){M=H.w();if(H[0]&&H[0].nodeType==w.e&&this.ia(H)){H.d()==
this.element?a(this,H):l(H,k(this)[H.d()]);if(M[0].nodeType==w.e&&M.contains(G)){F();M=new O(G[0].nextSibling)}}H=M}}E.moveToBookmark(K)}function q(E){var K={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function z(E,K){var G;if(K!==i){G=document.createElement("span");G.style.cssText=E;G=G.style.cssText||""}else G=E;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function k(E){if(E.c.vd)return E.c.vd;
var K=E.c.vd={},G=E.c.definition.overrides;if(G){C.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],M,L;if(typeof H=="string")M=H.toLowerCase();else{M=H.element?H.element.toLowerCase():E.element;L=H.attributes}H=K[M]||(K[M]={});if(L){H=H.attributes=H.attributes||[];for(var R in L)H.push([R.toLowerCase(),L[R]])}}}return K}function a(E,K){var G=E.c.definition,F=I.mix(G.attributes,k(E)[K.d()]);G=G.styles;var H=C.isEmptyObject(F)&&C.isEmptyObject(G),M;for(M in F)if(!((M=="class"||E.c.definition.fullMatch)&&
K.attr(M)!=b(M,F[M]))){H=H||!!K.Cc(M);K.removeAttr(M)}for(var L in G)if(!(E.c.definition.fullMatch&&K.L(L)!=b(L,G[L],t))){H=H||!!K.L(L);K.L(L,"")}B(K)}function b(E,K,G){var F=new O("<span>");F[G?"_4e_style":"attr"](E,K);return F[G?"_4e_style":"attr"](E)}function e(E,K){for(var G=k(E),F=K.all(E.element),H=F.length;--H>=0;)a(E,new O(F[H]));for(var M in G)if(M!=E.element){F=K.all(M);for(H=F.length-1;H>=0;H--){var L=new O(F[H]);l(L,G[M])}}}function l(E,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],M;if(M=E.attr(H)){var L=G[F][1];if(L===j||L.test&&L.test(M)||typeof L=="string"&&M==L)E[0].removeAttribute(H)}}B(E)}function B(E){if(!E.Xa()){var K=E[0].firstChild,G=E[0].lastChild;E.h(t);if(K){K.nodeType==w.e&&n.qa(K);G&&K!=G&&G.nodeType==w.e&&n.qa(G)}}}var t=S,i=X,j=T,C=KISSY,I=o.k,n=C.DOM,c={zb:1,za:2,Va:3},h=o.na,p=o.Ac,w=o.n,m=o.Sa,D=o.Range,O=C.Node,N=C.UA,P=o.Ra,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},W={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},U=/\s*(?:;\s*|$)/,V=/#\((.+?)\)/g;o.mf=c;u.prototype={apply:function(E){J.call(this,E,i)},remove:function(E){J.call(this,E,t)},Lb:function(E){return(this.Lb=this.type==c.za?g:this.type==c.zb?y:this.type==c.Va?j:j).call(this,E)},mc:function(E){return(this.mc=this.type==c.za?d:j).call(this,E)},ae:function(E){v(E,this)},ia:function(E,K){if(!E)return i;var G=this.c.definition;if(E.d()==this.element){if(!K&&!E.Xa())return t;var F=G.Sd;if(F)G=F;else{F={};var H=0,M=G.attributes;
if(M)for(var L in M){H++;F[L]=M[L]}if(M=u.ad(G)){F.style||H++;F.style=M}F._length=H;G=G.Sd=F}if(G._length){for(var R in G)if(R!="_length"){H=E.attr(R)||"";if(R=="style")a:{F=G[R];H=z(H,i);typeof F=="string"&&(F=q(F));typeof H=="string"&&(H=q(H));M=void 0;for(M in F)if(!(M in H&&(H[M]==F[M]||F[M]=="inherit"||H[M]=="inherit"))){F=i;break a}F=t}else F=G[R]==H;if(F){if(!K)return t}else if(K)return i}if(K)return t}else return t}if(R=k(this)[E.d()]){if(!(G=R.attributes))return t;for(F=0;F<G.length;F++){R=
G[F][0];if(R=E.attr(R)){H=G[F][1];if(H===j||typeof H=="string"&&R==H||H.test&&H.test(R))return t}}}return i},he:function(E){switch(this.type){case c.zb:return this.ia(E.z||E.F,t);case c.Va:case c.za:for(var K=E.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.za&&(n.g(F,E.z)||n.g(F,E.F))))if(!(this.type==c.Va&&!(F.d()in W)))if(this.ia(F,t))return t}}return i}};u.ad=function(E){var K=E.Td;if(K)return K;K=E.styles;var G=E.attributes&&E.attributes.style||"",F="";if(G.length)G=G.replace(U,";");
for(var H in K){var M=K[H],L=(H+":"+M).replace(U,";");if(M=="inherit")F+=L;else G+=L}if(G.length)G=z(G);G+=F;return E.Td=G};o.of=u;o.Style=u;var Y=u.prototype;o.k.o(Y,{apply:Y.apply,remove:Y.remove,applyToRange:Y.Lb,removeFromRange:Y.mc,applyToObject:Y.ae,checkElementRemovable:Y.ia,checkActive:Y.he})});
KISSY.Editor.add("htmlparser",function(){function o(){}function A(){this.c={ed:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var u=KISSY,J=u.Editor,x=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,v={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},y=J.m;u.augment(A,{va:o,ud:o,la:o,pd:o,Ka:o,parse:function(s){for(var r,
f,g=0,d;r=this.c.ed.exec(s);){f=r.index;if(f>g){g=s.substring(g,f);d?d.push(g):this.la(g)}g=this.c.ed.lastIndex;if(f=r[1]){f=f.toLowerCase();if(d&&y.rc[f]){this.pd(d.join(""));d=T}if(!d){this.ud(f);continue}}if(d)d.push(r[0]);else if(f=r[3]){f=f.toLowerCase();if(!/="/.test(f)){var q={},z;r=r[4];var k=!!(r&&r.charAt(r.length-1)=="/");if(r)for(;z=x.exec(r);){var a=z[1].toLowerCase();z=z[2]||z[3]||z[4]||"";q[a]=!z&&v[a]?a:z}this.va(f,q,k);if(!d&&y.rc[f])d=[]}}else if(f=r[2])this.Ka(f)}s.length>g&&this.la(s.substring(g,
s.length))}});J.j=A;J.HtmlParser=A});
KISSY.Editor.add("htmlparser-basicwriter",function(){function o(){this.c={l:[]}}var A=KISSY,u=A.Editor,J=u.k;A.augment(o,{kb:function(x){this.c.l.push("<",x)},lb:function(x,v){v?this.c.l.push(" />"):this.c.l.push(">")},ab:function(x,v){if(typeof v=="string")v=J.cc(v);this.c.l.push(" ",x,'="',v,'"')},bb:function(x){this.c.l.push("</",x,">")},text:function(x){this.c.l.push(x)},N:function(x){this.c.l.push("<!--",x,"--\>")},write:function(x){this.c.l.push(x)},reset:function(){this.c.l=[];this.c.B=X},
Xb:function(x){var v=this.c.l.join("");x&&this.reset();return v}});u.j.ub=o;u.j.BasicWriter=o;A=o.prototype;u.k.o(A,{openTag:A.kb,openTagClose:A.lb,attribute:A.ab,closeTag:A.bb,text:A.text,comment:A.N,write:A.write,reset:A.reset,getHtml:A.Xb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function o(){o.Kf.constructor.call(this);this.fd="\t";this.Oe=" />";this.He="\n";this.te=v;this.Pe=x;this.c.B=v;this.c.G="";this.c.rules={};var y=u.m,s;for(s in J.mix({},y.tb,y.Pa,y.sb,y.vc))this.xa(s,{B:x,ee:x,Pb:x,Oc:!y[s]["#"],de:x});this.xa("br",{Pb:x});this.xa("title",{B:v,Pb:v});this.xa("style",{B:v,Oc:x});this.xa("pre",{B:v})}var A=KISSY,u=A.Editor,J=u.k,x=S,v=X;A.extend(o,u.j.ub,{kb:function(y){var s=this.c.rules[y];if(this.c.B)this.G();
else if(s&&s.ee){this.Ia();this.G()}this.c.l.push("<",y)},lb:function(y,s){var r=this.c.rules[y];if(s)this.c.l.push(this.Oe);else{this.c.l.push(">");if(r&&r.B)this.c.G+=this.fd}r&&r.Pb&&this.Ia()},ab:function(y,s){if(typeof s=="string"){this.te&&(s=s.replace(/&amp;/g,"&"));s=J.cc(s)}this.c.l.push(" ",y,'="',s,'"')},bb:function(y){var s=this.c.rules[y];if(s&&s.B)this.c.G=this.c.G.substr(this.fd.length);if(this.c.B)this.G();else if(s&&s.Oc){this.Ia();this.G()}this.c.l.push("</",y,">");s&&s.de&&this.Ia()},
text:function(y){if(this.c.B){this.G();y=J.Ja(y)}this.c.l.push(y)},N:function(y){this.c.B&&this.G();this.c.l.push("<!--",y,"--\>")},Ia:function(){this.c.l.length>0&&this.c.l.push(this.He);this.c.B=x},G:function(){this.c.l.push(this.c.G);this.c.B=v},xa:function(y,s){var r=this.c.rules[y];if(r)J.mix(r,s);else this.c.rules[y]=s}});u.j.cf=o;u.j.HtmlWriter=o;A=o.prototype;u.k.o(A,{openTag:A.kb,openTagClose:A.lb,attribute:A.ab,closeTag:A.bb,text:A.text,comment:A.N,lineBreak:A.Ia,indentation:A.G,setRules:A.xa})});
KISSY.Editor.add("htmlparser-fragment",function(){function o(){this.children=[];this.parent=J;this.c={R:A,bc:u}}var A=S,u=X,J=T,x=KISSY.Editor,v={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},y=KISSY,s=x.k,r=x.n,f=x.m,g=s.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),d=f.Ed,q=f.sb;o.xb=function(z,k){function a(h){var p;if(t.length>0)for(var w=0;w<t.length;w++){var m=t[w],D=m.name,O=f[D],N=j.name&&f[j.name];if((!N||N[D])&&(!h||!O||O[h]||!f[h])){if(!p){b();p=1}m=m.clone();
m.parent=j;j=m;t.splice(w,1);w--}}}function b(){for(;i.length;)j.add(i.shift())}function e(h,p,w){p=p||j||B;if(k&&!p.type){var m,D;if((m=h.attributes&&(D=h.attributes._ke_real_element_type)?D:h.name)&&!(m in f.qc)&&!(m in f.tb)){m=j;j=p;l.va(k,{});p=j;if(w)j=m}}if(h.c.R&&h.name!="pre"){w=h.children.length;if((m=h.children[w-1])&&m.type==r.f)if(D=s.La(m.value))m.value=D;else h.children.length=w-1}p.add(h);if(h.nb){j=h.nb;delete h.nb}}var l=new x.j,B=new o,t=[],i=[],j=B,C=u,I;l.va=function(h,p,w){var m=
new x.j.wc(h,p);if(m.fc&&w)m.hb=A;if(f.aa[h])t.push(m);else{if(h=="pre")C=A;else if(h=="br"&&C){j.add(new x.j.Ab("\n"));return}if(h=="br")i.push(m);else{var D=j.name,O=D&&(f[D]||(j.c.R?f.div:f.span));if(O&&!m.fc&&!j.fc&&!O[h]){O=u;var N;if(h in d&&D in d){D=j.children;(D=D[D.length-1])&&D.name in q||e(D=new x.j.wc("li"),j);I=j;N=D}else if(h==D)e(j,j.parent);else{if(g[D])I||(I=j);else{e(j,j.parent,A);v[D]||t.unshift(j)}O=A}j=N?N:j.nb||j.parent;if(O){l.va.apply(this,arguments);return}}a(h);b();m.parent=
j;m.nb=I;I=0;if(m.hb)e(m);else j=m}}};l.ud=function(h){for(var p=t.length-1;p>=0;p--)if(h==t[p].name){t.splice(p,1);return}for(var w=[],m=[],D=j;D.type&&D.name!=h;){D.c.R||m.unshift(D);w.push(D);D=D.parent}if(D.type){for(p=0;p<w.length;p++){var O=w[p];e(O,O.parent)}j=D;if(j.name=="pre")C=u;D.c.R&&b();e(D,D.parent);if(D==j)j=j.parent;t=t.concat(m)}if(h=="body")k=u};l.la=function(h){if(!j.c.bc&&!C){h=s.Ja(h);if(h.length===0)return}b();a();if(k&&(!j.type||j.name=="body")&&s.trim(h))this.va(k,{});C||
(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));j.add(new x.j.Ab(h))};l.pd=function(){};l.Ka=function(h){j.add(new x.j.Fd(h))};l.parse(z);for(b();j.type;){var n=j.parent,c=j;if(k&&(!n.type||n.name=="body")&&!f.qc[c.name]){j=n;l.va(k,{});n=j}n.add(c);j=n}return B};y.augment(o,{add:function(z){var k=this.children.length;if(k=k>0&&this.children[k-1]||J){if(z.c.R&&k.type==r.f){k.value=s.La(k.value);if(k.value.length===0){this.children.pop();this.add(z);return}}k.next=z}z.mb=k;z.parent=this;this.children.push(z);
this.c.bc=z.type==r.f||z.type==r.e&&!z.c.R},$:function(z,k){var a;this.filterChildren=this.Vb=function(){var b=new x.j.ub;this.U.call(this,b,k,A);b=b.Xb();this.children=(new o.xb(b)).children;a=1};!this.name&&k&&k.rd(this);this.U(z,a?J:k)},U:function(z,k){for(var a=0;a<this.children.length;a++)this.children[a].$(z,k)}});x.j.ya=o;x.j.Fragment=o;o.FromHtml=o.xb;y=o.prototype;x.k.o(y,{add:y.add,writeHtml:y.$,writeChildrenHtml:y.U})});
KISSY.Editor.add("htmlparser-element",function(){function o(v,y){v=v[0];y=y[0];return v<y?-1:v>y?1:0}function A(v,y){this.name=v;this.attributes=y||(y={});this.children=[];var s=y.rf||v,r=u.m;s=!!(r.tb[s]||r.Pa[s]||r.sb[s]||r.vc[s]||r.uc[s]||s=="br");var f=!!r.rb[v];this.hb=f;this.fc=!r[v];this.c={R:s,bc:f||!s}}var u=KISSY.Editor,J=u.n;KISSY.augment(A,{type:J.e,add:u.j.ya.prototype.add,clone:function(){return new A(this.name,this.attributes)},$:function(v,y){var s=this.attributes,r=this,f=r.name,
g,d,q,z;r.Vb=function(){if(!z){var b=new u.j.ub;u.j.ya.prototype.U.call(r,b,y);r.children=(new u.j.ya.xb(b.Xb())).children;z=1}};r.filterChildren=r.Vb;if(y){for(;;){if(!(f=y.qd(f)))return;r.name=f;if(!(r=y.hc(r)))return;r.parent=this.parent;if(r.name==f)break;if(r.type!=J.e){r.$(v,y);return}f=r.name;if(!f){this.U.call(r,v,z?T:y);return}}s=r.attributes}v.kb(f,s);for(var k=[],a=0;a<2;a++)for(g in s){d=g;q=s[g];if(a==1)k.push([g,q]);else if(y){for(;;)if(d=y.od(g))if(d!=g){delete s[g];g=d}else break;
else{delete s[g];break}if(d)if((q=y.nd(r,d,q))===X)delete s[d];else s[d]=q}}v.Pe&&k.sort(o);s=k.length;for(a=0;a<s;a++){g=k[a];v.ab(g[0],g[1])}v.lb(f,r.hb);if(!r.hb){this.U.call(r,v,z?T:y);v.bb(f)}},U:function(){u.j.ya.prototype.U.apply(this,arguments)}});u.j.wc=A;u.j.Element=A;var x=A.prototype;u.k.o(x,{type:x.type,add:x.add,clone:x.clone,writeHtml:x.$,writeChildrenHtml:x.U})});
KISSY.Editor.add("htmlparser-filter",function(){function o(g){this.c={Sb:[],Mb:[],elements:{tc:0},attributes:{tc:0}};g&&this.Nc(g,10)}function A(g,d){for(var q=0;g&&q<d.length;q++){var z=d[q];g=g.replace(z[0],z[1])}return g}function u(g,d,q){if(typeof d=="function")d=[d];var z,k;k=g.length;var a=d&&d.length;if(a){for(z=0;z<k&&g[z].lc<q;z++);for(k=a-1;k>=0;k--)if(a=d[k]){a.lc=q;g.splice(z,0,a)}}}function J(g,d,q){if(d)for(var z in d){var k=g[z];g[z]=x(k,d[z],q);k||g.tc++}}function x(g,d,q){if(d){d.lc=
q;if(g){if(g.splice)u(g,d,q);else{g=g.lc>q?[d,g]:[g,d];g.filter=v}return g}else return d.filter=d}}function v(g){for(var d=g.type||g instanceof s.j.ya,q=0;q<this.length;q++){if(d)var z=g.type,k=g.name;var a=this[q].apply(window,arguments);if(a===f)return a;if(d){if(a&&(a.name!=k||a.type!=z))return a}else if(typeof a!="string")return a;a!=undefined&&(g=a)}return g}var y=KISSY,s=y.Editor,r=s.n,f=X;y.augment(o,{Nc:function(g,d){if(typeof d!="number")d=10;u(this.c.Sb,g.Sb,d);u(this.c.Mb,g.Mb,d);J(this.c.elements,
g.elements,d);J(this.c.attributes,g.attributes,d);this.c.text=x(this.c.text,g.text,d)||this.c.text;this.c.N=x(this.c.N,g.N,d)||this.c.N;this.c.ob=x(this.c.ob,g.ob,d)||this.c.ob},qd:function(g){return A(g,this.c.Sb)},od:function(g){return A(g,this.c.Mb)},la:function(g){var d=this.c.text;return d?d.filter(g):g},Ka:function(g,d){var q=this.c.N;return q?q.filter(g,d):g},rd:function(g){var d=this.c.ob;return d?d.filter(g):g},hc:function(g){for(var d=[this.c.elements["^"],this.c.elements[g.name],this.c.elements.Xe],
q,z=0;z<3;z++)if(q=d[z]){q=q.filter(g,this);if(q===f)return T;if(q&&q!=g)return this.sd(q);if(g.parent&&!g.name)break}return g},sd:function(g){var d=g.type;return d==r.e?this.hc(g):d==r.f?new s.j.Ab(this.la(g.value)):T},nd:function(g,d,q){if(d=this.c.attributes[d]){g=d.filter(q,g,this);if(g===f)return f;if(typeof g!="undefined")return g}return q}});s.j.bf=o;y=o.prototype;s.k.o(y,{addRules:y.Nc,onElementName:y.qd,onAttributeName:y.od,onText:y.la,onComment:y.Ka,onFragment:y.rd,onElement:y.hc,onNode:y.sd,
onAttribute:y.nd});s.j.Filter=o});KISSY.Editor.add("htmlparser-text",function(){function o(x){this.value=x;this.c={R:J}}var A=KISSY,u=A.Editor,J=X;A.augment(o,{type:u.n.f,$:function(x,v){var y=this.value;v&&!(y=v.la(y,this))||x.text(y)}});u.j.Ab=o;u.j.Text=o});
KISSY.Editor.add("htmlparser-comment",function(){function o(J){this.value=J;this.c={R:X}}var A=KISSY.Editor,u=A.n;A.j.Fd=o;A.j.Comment=o;o.prototype={constructor:o,type:u.Hd,$:function(J,x){var v=this.value;if(x){if(!(v=x.Ka(v,this)))return;if(typeof v!="string"){v.parent=this.parent;v.$(J,x);return}}J.N(v)}}});
