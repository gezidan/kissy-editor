/*
 Constructor for kissy editor,dependency moved to independent module
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1.5
 @buildtime: 2010-12-20 13:41:49
*/
var T=true,U=null,X=false;
KISSY.add("editor",function(l){function w(u,j){var i=this;if(!(i instanceof w))return new w(u,j);if(l.isString(u))u=l.one(u);u=I.D(u);j=j||{};j.rf=j.pluginConfig||{};i.ta=j;j.pluginConfig=j.rf;i.cfg=j;l.app(i,l.EventTarget);var e=["htmldataprocessor","enterkey","clipboard"],g=z;i.use=function(d,m){d=d.split(",");if(!g)for(var y=0;y<e.length;y++){var k=e[y];l.inArray(k,d)||d.unshift(k)}i.ready(function(){l.use.call(i,d.join(","),function(){for(var a=0;a<d.length;a++)i.Rd(d[a]);m&&m.call(i);if(!g){i.setData(u.val());
if(j.focus)i.focus();else(a=i.getSelection())&&a.removeAllRanges();g=A}},{global:w})});return i};i.use=i.use;i.Config.base=w.Config.base;i.Config.debug=w.Config.debug;i.Config.componentJsName=r;i.gf(u);return i}function r(){return"plugin-min.js?t=2010-12-20 13:41:49"}var I=l.DOM,A=T,z=X;l.app(w,l.EventTarget);w.Config.base=l.Config.base+"editor/plugins/";w.Config.debug=l.Config.debug;w.Config.componentJsName=r;l.Editor=w;l.Editor=w});
KISSY.Editor.add("utils",function(l){var w=U,r=KISSY,I=r.Node,A=r.DOM,z=r.UA,u=r.Event,j;if(z.ie)j=document.documentMode||z.ie;var i={fd:function(e){e=e.replace(/-min\.(js|css)/i,".$1");l.Config.yg||(e=e.replace(/\.(js|css)/i,"-min.$1"));if(e.indexOf("?t")==-1){e+=e.indexOf("?")!=-1?"&":"?";e+="t=2010-12-20 13:41:49"}return l.Config.sg+e},zd:function(e,g,d){var m=e[g],y=e[d];e[g]=function(){m.apply(this,arguments);e[g]=e[d];return y.apply(this,arguments)}},cf:function(e,g,d,m){d=d.defaultView||d.parentWindow;
e-=A.scrollLeft(d);g-=A.scrollTop(d);if(m)if(d!=(m.defaultView||m.parentWindow)&&d.frameElement){m=A.Kb(d.frameElement,m);e+=m.left;g+=m.top}return{left:e,top:g}},Qd:function(){for(var e,g=0,d=arguments.length;g<d;g++){var m=arguments[g];try{e=m();break}catch(y){}}return e},Fe:function(e,g){if(!e&&!g)return T;if(!e||!g||e.length!=g.length)return X;for(var d=0;d<e.length;d++)if(e[d]!==g[d])return X;return T},md:function(e,g,d){e=e.documentElement;for(var m=0;e&&m<g.length;m++){var y=g[m];if(d)for(var k=
-1,a=0;a<e.childNodes.length;a++){var b=e.childNodes[a];if(!(d===T&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){k++;if(k==y){e=b;break}}}else e=e.childNodes[y]}return e?new I(e):w},Me:function(e){for(var g in e)e[g].Kc(e,T)},jc:function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ma:function(e){return e.replace(/^\s+/,"")},Oa:function(e){return e.replace(/\s+$/,"")},trim:function(e){return this.Ma(this.Oa(e))},mix:function(){for(var e={},g=0;g<
arguments.length;g++)e=r.mix(e,arguments[g]);return e},lb:function(){if(!z.ie)return X;var e=document.domain,g=window.location.hostname;return e!=g&&e!="["+g+"]"},Se:function(e,g){return Array(g+1).join(e)},Bf:function(e,g,d){d=d||150;if(d===-1)return function(){e.apply(g,arguments)};var m=(new Date).getTime();return function(){var y=(new Date).getTime();if(y-m>d){m=y;e.apply(g,arguments)}}},Ie:function(e,g,d){d=d||0;var m=w;return function(){m&&clearTimeout(m);var y=arguments;m=setTimeout(function(){return e.apply(g,
y)},d)}},isNumber:function(e){return/^\d+(.\d+)?$/.test(r.trim(e))},Df:function(e){for(var g=0;g<e.length;g++){var d=A.D(e[g]),m=r.trim(d.val()),y=d.attr("data-verify");d=d.attr("data-warning");if(y&&!RegExp(y).test(m)){alert(d);return X}}return T},yf:function(e,g){e.on("sourcemode",g.gd,g);e.on("wysiwygmode",g.jd,g)},uf:function(e){var g=e.attr("placeholder");if(g&&!z.webkit){e.addClass("ke-input-tip");e.val(g)}else z.webkit&&e.val("")},Vg:function(e,g){e.removeClass("ke-input-tip");e.val(g)},qf:function(e,
g){e.attr("placeholder",g);if(!z.webkit){e.on("blur",function(){if(!r.trim(e.val())){e.addClass("ke-input-tip");e.val(g)}});e.on("focus",function(){e.removeClass("ke-input-tip");r.trim(e.val())==g&&e.val("")})}},Le:function(e){e=e[0]||e;for(var g=r.makeArray(e.childNodes),d=0;d<g.length;d++){var m=g[d];m.nodeType==l.n.f&&!r.trim(m.nodeValue)&&e.removeChild(m)}},ff:function(e){return!e?e:String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ef:function(e){return!e?
e:String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},Ve:function(e,g){return e.toLowerCase()==g.toLowerCase()},Ad:function(e){e=r.clone(e);for(var g in e)if(e.hasOwnProperty(g)){var d=e[g];if(r.isFunction(d))e[g]=d()}return e},Re:function(e,g,d){function m(){var B={responseText:"",responseXML:w};B.Ee=e?e.Ee:w;try{var t;if((t=z.ie?k.contentWindow.document:k.contentDocument||window.frames[y].document)&&t.body)B.responseText=t.body.innerHTML;B.responseXML=
t&&t.XMLDocument?t.XMLDocument:t}catch(E){r.log(E)}u.remove(k,"load",m);e.Je&&e.Je(B);setTimeout(function(){A.h(k)},100)}var y=r.guid("form-upload-"),k=document.createElement("iframe");k.id=y;k.name=y;k.className="ke-hidden";var a="document.open();"+(i.lb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(z.ie)k.src=z.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";r.log("doFormUpload : "+k.src);document.body.appendChild(k);if(z.ie)document.frames[y].name=y;a=A.Rc(e.form);
var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=y;a.method="POST";a.enctype=a.encoding="multipart/form-data";if(d)a.action=d;var f;if(g){f=[];g=l.k.Ad(g);for(var q in g)if(g.hasOwnProperty(q)){d=document.createElement("input");d.type="hidden";d.name=q;d.value=g[q];a.appendChild(d);f.push(d)}}u.on(k,"load",m);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(f){g=0;for(q=f.length;g<q;g++)A.h(f[g])}return k},
o:function(e,g){for(var d in g)e[d]=g[d]},map:function(e,g){for(var d=0;d<e.length;d++)e[d]=g(e[d]);return e},Ka:j,sf:function(e){z.ie?e.Ha():e.attr("onmousedown","return false;")},Ig:function(e){e=e.attributes;return e.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(e.src||"")}};l.k=i;l.Utils=i;z.Ka=i.Ka;i.o(i,{debugUrl:i.fd,lazyRun:i.zd,getXY:i.cf,tryThese:i.Qd,arrayCompare:i.Fe,getByAddress:i.md,clearAllMarkers:i.Me,htmlEncodeAttr:i.jc,ltrim:i.Ma,rtrim:i.Oa,trim:i.trim,mix:i.mix,isCustomDomain:i.lb,
duplicateStr:i.Se,buffer:i.Ie,isNumber:i.isNumber,verifyInputs:i.Df,sourceDisable:i.yf,resetInput:i.uf,placeholder:i.qf,clean:i.Le,htmlEncode:i.ff,htmlDecode:i.ef,equalsIgnoreCase:i.Ve,normParams:i.Ad,throttle:i.Bf,doFormUpload:i.Re,map:i.map})});
KISSY.Editor.add("dom",function(l){function w(a){if(a&&!a[0])return new j(a);return a}function r(a){return a[0]||a}function I(a){return a.replace(/-(\w)/g,function(b,f){return f.toUpperCase()})}var A=KISSY,z=A.DOM,u=A.UA,j=A.Node,i=l.k,e={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};l.n={e:1,f:3,Xd:8,Tf:11};l.NODE=l.n;l.Va={da:0,Zd:1,ca:2,Y:4,X:8,Fc:16};l.POSITION=
l.Va;var g=l.n,d=l.Va,m={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},k={D:w,Rc:r,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return X;a=r(a);b=r(b);return a===b},qa:function(a,b){a=w(a);var f=A.mix(A.mix({},y),b||{});return m[a.css("display")]||f[a.d()]},fa:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
X},v:function(a){a=r(a);for(var b=a.parentNode.childNodes,f=0;f<b.length;f++)if(b[f]===a)return f;return-1},ee:function(a,b){a=r(a);var f=a.firstChild;if((f=f&&new j(f))&&b&&!b(f))f=f.Fa(b);return f},Pc:function(a,b,f){a=r(a);z.h(a);b=r(b);f?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=r(a);var b=a.nodeName.toLowerCase();if(u.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Nc:function(a,b){if(a.d()!=b.d())return X;var f=a[0].attributes,q=b[0].attributes,B=f.length,
t=q.length;if(B!=t)return X;for(var E=0;E<B;E++){var n=f[E],x=n.name;if(n.specified&&a.attr(x)!=b.attr(x))return X}if(i.Ka<8)for(E=0;E<t;E++){n=q[E];x=n.name;if(n.specified&&a.attr(x)!=b.attr(x))return X}return T},Lb:function(a){a=r(a).childNodes;for(var b=0,f=a.length;b<f;b++){var q=a[b],B=q.nodeType;if(!(B==g.e&&q.getAttribute("_ke_bookmark")))if(B==g.e&&!k.Lb(q)||B==g.f&&A.trim(q.nodeValue))return X}return T},Mb:function(a,b,f){a=r(a);b=b[0]||b;if(a!=b)if(f)for(;f=a.lastChild;)b.insertBefore(a.removeChild(f),
b.firstChild);else for(;f=a.firstChild;)b.appendChild(a.removeChild(f))},ra:function(){function a(b,f,q){if(f[0]&&f[0].nodeType==g.e){for(var B=[];f.attr("_ke_bookmark")||f.Lb();){B.push(f);f=q?new j(f[0].nextSibling):new j(f[0].previousSibling);if(!f[0]||f[0].nodeType!=g.e)return}if(b.Nc(f)){for(var t=q?b[0].lastChild:b[0].firstChild;B.length;)B.shift().Pc(b,!q);f.Mb(b,!q);f.h();t[0]&&t[0].nodeType==g.e&&t.ra()}}}return function(b){if(b[0])if(e[b.d()]||b.d()=="a"){a(b,new j(b[0].nextSibling),T);
a(b,new j(b[0].previousSibling))}}}(),Ha:u.gecko?function(a){a=r(a);a.style.MozUserSelect="none"}:u.webkit?function(a){a=r(a);a.style.Qf="none"}:function(a){a=r(a);if(u.ie||u.opera){var b=0;a.setAttribute("unselectable","on");for(var f=a.getElementsByTagName("*");a=f[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},Kb:function(a,b){a=r(a);var f,q=0;f=0;var B=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,
t=a.ownerDocument,E=t.documentElement;b=b||t;if(a.getBoundingClientRect){if(a!==t.body&&E!==a){f=a.getBoundingClientRect();q=f.left+(b===t?z.scrollLeft(B):0);f=f.top+(b===t?z.scrollTop(B):0)}if(b)if(B!=(b.defaultView||b.parentWindow)&&B.frameElement){B=k.Kb(B.frameElement,b);q+=B.left;f+=B.top}}return{left:q,top:f}},ge:function(a){return(a=r(a))&&a.contentWindow.document},ha:function(a,b){a=r(a);var f=a.ownerDocument;if(!(!a||a.nodeType!=g.f)){if(u.ie&&b==a.nodeValue.length){var q=f.createTextNode("");
z.insertAfter(q,a);return new j(q)}q=new j(a.splitText(b));if(f.documentMode){f=f.createTextNode("");z.insertAfter(f,q[0]);z.h(f)}return q}},Nb:function(a,b){a=w(a);var f=[];do f[b?"push":"unshift"](a);while(a=a.parent());return f},K:function(a,b,f){a=r(a);a=a.cloneNode(b);if(!f){var q=function(B){if(B.nodeType==g.e){B.removeAttribute("id");B=B.childNodes;for(var t=0;t<B.length;t++)q(B[t])}};q(a)}return new j(a)},w:function(a,b,f,q){a=r(a);if(q&&!q.call){var B=q[0]||q;q=function(E){E=E[0]||E;return E!==
B}}b=!b&&a.firstChild;var t=new j(a);if(!b){if(a.nodeType==g.e&&q&&q(a,T)===X)return U;b=a.nextSibling}for(;!b&&(t=t.parent());){if(q&&q(t,T)===X)return U;b=t[0].nextSibling}if(!b)return U;b=z.D(b);if(q&&q(b)===X)return U;if(f&&f!=b[0].nodeType)return b.w(X,f,q);return b},ga:function(a,b,f,q){a=r(a);if(q&&!q.call){var B=q[0]||q;q=function(E){E=E[0]||E;return E!==B}}b=!b&&a.lastChild;var t=new j(a);if(!b){if(a.nodeType==g.e&&q&&q(a,T)===X)return U;b=a.previousSibling}for(;!b&&(t=t.parent());){if(q&&
q(t,T)===X)return U;b=t[0].previousSibling}if(!b)return U;b=z.D(b);if(q&&q(b)===X)return U;if(f&&b[0].nodeType!=f)return b.ga(X,f,q);return b},Jb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=g.f&&b.contains(a))return b;var f=a[0].nodeType==g.f?a.parent():a;do if(f[0].nodeType!=g.f&&f.contains(b))return f;while(f=f.parent());return U},Jc:function(a,b,f){a=r(a);if(!f)a=a.parentNode;if(b&&!A.isFunction(b)){var q=b;b=function(B){return B.d()==q}}for(;a&&a.nodeType!=9;){if(!b||b(new j(a))===T)return new j(a);
a=a.parentNode}return U},Lc:i.Ka<9?function(a,b){a=r(a);var f=a.attributes[b];return!!(f&&f.specified)}:function(a,b){a=r(a);return a.hasAttribute(b)},$a:i.Ka<9?function(a){a=r(a);for(var b=a.attributes,f=0;f<b.length;f++){var q=b[f];switch(q.name){case "class":if(a.getAttribute("class"))return T;break;default:if(q.specified)return T}}return X}:function(a){a=r(a);u.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Ga:function(a,b){var f=r(a),q=r(b);if(f.compareDocumentPosition)return f.compareDocumentPosition(q);
if(f==q)return d.da;if(f.nodeType==g.e&&q.nodeType==g.e){if(f.contains){if(f.contains(q))return d.Fc+d.Y;if(q.contains(f))return d.X+d.ca}if("sourceIndex"in f)return f.sourceIndex<0||q.sourceIndex<0?d.Zd:f.sourceIndex<q.sourceIndex?d.Y:d.ca}f=a.Ea();q=b.Ea();for(var B=Math.min(f.length,q.length),t=0;t<=B-1;t++)if(f[t]!=q[t]){if(t<B)return f[t]<q[t]?d.Y:d.ca;break}return f.length<q.length?d.Fc+d.Y:d.X+d.ca},Ea:function(a,b){a=r(a);for(var f=[],q=a.ownerDocument.documentElement,B=a;B&&B!=q;){var t=
B.parentNode,E=-1;if(t){for(var n=0;n<t.childNodes.length;n++){var x=t.childNodes[n];if(!(b&&x.nodeType==3&&x.previousSibling&&x.previousSibling.nodeType==3)){E++;if(x==B)break}}f.unshift(E)}B=t}return f},Ib:function(a,b){var f=new l.Range(a[0].ownerDocument);f.setStartAfter(a);f.setEndAfter(b);var q=f.extractContents();f.insertNode(a.h());a[0].parentNode.insertBefore(q,a[0].nextSibling)},L:function(a,b,f){a=w(a);if(f!==undefined)return a.css(b,f);a=r(a);return a.style[I(b)]},h:function(a,b){var f=
r(a),q=f.parentNode;if(q){if(b)for(var B;B=f.firstChild;)q.insertBefore(f.removeChild(B),f);q.removeChild(f)}return a},bb:function(a){z.Oc(a);z.Qc(a)},Oc:function(a){a=r(a);for(var b;b=a.firstChild;){if(b.nodeType==g.f){var f=i.Ma(b.nodeValue),q=b.nodeValue.length;if(f){if(f.length<q){(new j(b)).ha(q-f.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Qc:function(a){a=r(a);for(var b;b=a.lastChild;){if(b.type==g.f){var f=i.Oa(b.nodeValue),q=b.nodeValue.length;if(f){if(f.length<
q){(new j(b)).ha(f.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!u.ie&&!u.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Hb:function(a){a=r(a);for(var b=a.lastChild;b&&b.nodeType==g.f&&!A.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==g.f||z.d(b)!=="br"){b=u.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");u.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},sa:function(a,
b){var f=r(a),q;do q=(f=f.previousSibling)&&new j(f);while(q&&b&&!b(q));return q},je:function(a,b){a=z.D(a);var f=a[0].lastChild;if((f=f&&new j(f))&&b&&!b(f))f=f.sa(b);return f},Fa:function(a,b){var f=r(a),q;do q=(f=f.nextSibling)&&new j(f);while(q&&b&&!b(q));return q},ab:function(a){a=r(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},ke:function(a,b,f,q){a=z.D(a);var B=a.data("list_marker_id")||
a.data("list_marker_id",A.guid()).data("list_marker_id"),t=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[B]=a;t[f]=1;return a.data(f,q)},Kc:function(a,b,f){a=w(a);var q=a.data("list_marker_names"),B=a.data("list_marker_id"),t;for(t in q)a.removeData(t);a.removeData("list_marker_names");if(f){a.removeData("list_marker_id");delete b[B]}},de:function(a,b,f){a=r(a);b=w(b);var q=a.attributes;f=f||{};for(var B=0;B<q.length;B++){var t=q[B],E=t.name.toLowerCase(),
n;if(!(E in f))if(E=="checked"&&(n=z.attr(a,E)))b.attr(E,n);else if(t.specified||u.ie&&t.value&&E=="value"){n=z.attr(a,E);if(n===U)n=t.nodeValue;b.attr(E,n)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Mc:function(a){a=z.d(a);var b=l.m;return(a=!b.Cc[a]&&(b[a]||b.span))&&a["#"]},Ob:function(a){a=w(a);var b=a[0].ownerDocument,f=z.scrollLeft(b),q=z.scrollTop(b),B=a.offset(),t=B.left;B=B.top;if(z.viewportHeight(b)+q<B||B<q||z.viewportWidth(b)+f<t||t<f)a.scrollIntoView(b)},fe:function(a,
b,f){a=r(a);if(!u.ie&&f)b=f+":"+b;f=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)f.push(new j(a[b]));return f}};A.DOM.he=function(a){A.mix(z,a);for(var b in a)a.hasOwnProperty(b)&&function(f){j.prototype[f]=function(){var q=[].slice.call(arguments,0);q.unshift(this);return a[f].apply(U,q)}}(b)};i.o(k,{_4e_wrap:k.D,_4e_unwrap:k.Rc,_4e_equals:k.g,_4e_isBlockBoundary:k.qa,_4e_getWin:k.fa,_4e_index:k.v,_4e_first:k.ee,_4e_move:k.Pc,_4e_name:k.d,_4e_isIdentical:k.Nc,_4e_isEmptyInlineRemoveable:k.Lb,
_4e_moveChildren:k.Mb,_4e_mergeSiblings:k.ra,_4e_unselectable:k.Ha,_4e_getOffset:k.Kb,_4e_getFrameDocument:k.ge,_4e_splitText:k.ha,_4e_parents:k.Nb,_4e_clone:k.K,_4e_nextSourceNode:k.w,_4e_previousSourceNode:k.ga,_4e_commonAncestor:k.Jb,_4e_ascendant:k.Jc,_4e_hasAttribute:k.Lc,_4e_hasAttributes:k.$a,_4e_position:k.Ga,_4e_address:k.Ea,_4e_breakParent:k.Ib,_4e_style:k.L,_4e_remove:k.h,_4e_trim:k.bb,_4e_ltrim:k.Oc,_4e_rtrim:k.Qc,_4e_appendBogus:k.Hb,_4e_last:k.je,_4e_previous:k.sa,_4e_next:k.Fa,_4e_outerHtml:k.ab,
_4e_setMarker:k.ke,_4e_clearMarkers:k.Kc,_4e_getUniqueId:k.cg,_4e_copyAttributes:k.de,_4e_isEditable:k.Mc,_4e_scrollIntoView:k.Ob,_4e_getElementsByTagName:k.fe});z.he(k)});
KISSY.Editor.add("focusmanager",function(l){function w(){this.kc=i;j=this}function r(){this.kc=e;j=g}var I=KISSY,A=I.DOM,z=I.Event,u={},j;I={Og:function(){for(var d in u){var m=u[d];m.document.designMode="off";m.document.designMode="on"}},xg:function(){return j},Ze:function(d){return u[d]},add:function(d){var m=A.fa(d.document);z.on(m,"focus",w,d);z.on(m,"blur",r,d)},tf:function(d){u[d.Pb]=d},remove:function(d){delete u[d.Pb];var m=A.fa(d.document);z.remove(m,"focus",w,d);z.remove(m,"blur",r,d)}};
var i=T,e=X,g=U;l.We=I;l.focusManager=I;l.$e=function(){return u};l.getInstances=l.$e});
KISSY.Editor.add("definition",function(l){var w=T,r=X,I=l.k,A=document,z=KISSY,u=z.UA,j=z.DOM,i=z.Node,e=z.Event,g=l.We,d=I.Qd,m=1,y="document.open();"+(I.lb()?'document.domain="'+A.domain+'";':"")+"document.close();",k="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(u.ie?"javascript:void(function(){"+
encodeURIComponent(y)+"}())":"")+'"  tabIndex="'+(u.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";l.Hc=0;l.Za=1;l.SOURCE_MODE=l.Hc;l.WYSIWYG_MODE=l.Za;z.augment(l,{gf:function(a){if(u.ie)j.addClass(A.body,"ke-ie"+u.ie);else if(u.gecko)j.addClass(A.body,"ke-gecko");else u.webkit&&j.addClass(A.body,"ke-webkit");var b=this,f=new i(k.replace(/\$\(tabIndex\)/,a.attr("tabIndex")));b.Cg=f;b.Pb=m++;g.tf(b);b.wb=f.one(".ke-textarea-wrap");
b.wrap=b.wb;b.kb=b.wb.one("iframe");b.iframe=b.kb;b.Pd=f.one(".ke-editor-tools");b.toolBarDiv=b.Pd;b.$=a;b.textarea=b.$;b.Af=f.one(".ke-editor-status");b.statusDiv=b.Af;I.sf(b.Pd);b.Qb={};b.Sc={};var q=a.L("width"),B=a.L("height");if(q){f.css("width",q);a.css("width","100%")}b.$.css("display","none");f.insertAfter(a);b.wb[0].appendChild(a[0]);if(B){b.wb.css("height",B);a.css("height","100%")}f=b.kb;b.on("dataReady",function(){b.te=w;l.fire("instanceCreated",{Te:b})});u.gecko?f.on("load",b.Yc,b):b.Yc();
b.ta.attachForm&&a[0].form&&b.oe()},oe:function(){(new i(this.$[0].form)).on("submit",this.Od,this)},Cf:function(a,b){var f=this,q=l.Yd;q&&q.mc();f.use(a,function(){var B=f.nd(a);if(B){b(B);q&&q.Ug()}else z.later(arguments.callee,50,X,f)})},Ce:function(a,b){this.Sc[a]=b},nd:function(a){return this.Sc[a]},Ae:function(a,b){this.Qb[a]=b},df:function(a){return this.Qb[a]},execCommand:function(a){var b=this.Qb[a],f=z.makeArray(arguments);f.shift();f.unshift(this);return b.exec.apply(b,f)},fc:function(){return this.$.css("display")==
"none"?l.Za:l.Hc},getData:function(a){var b;b=this.fc()==l.Za?this.document.body.innerHTML:this.$.val();if(this.htmlDataProcessor)b=a?this.htmlDataProcessor.toHtml(b,"p"):this.htmlDataProcessor.toServer(b,"p");b=z.trim(b);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(b))b="";return b},setData:function(a){var b=a;if(this.htmlDataProcessor)b=this.htmlDataProcessor.toDataFormat(a,"p");this.document.body.innerHTML=b;this.fc()!=l.Za&&this.$.val(a)},Od:function(){this.$.val(this.getData())},eg:function(){return this.document.body.innerHTML},
ig:function(a){this.document.body.innerHTML=a},se:function(a){var b=this.ta,f=b.Zb;b=b.wa;var q="",B=l.k.fd("../theme/editor-iframe.css");if(b)for(var t=0;t<b.length;t++)q+='<link href="'+b[t]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+B+"' rel='stylesheet'/><style>"+(f||"")+"</style>"+q+"</head><body class='ke-editor'>&nbsp;"+(a?'<script id="ke_actscript" type="text/javascript">'+(I.lb()?'document.domain="'+A.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+
a+'");<\/script>':"")+"</body></html>"},getSelection:function(){return l.Ic.getSelection(this.document)},focus:function(){var a=this.document,b=j.fa(a);u.webkit&&b&&b.parent&&b.parent.focus();u.webkit&&b&&b.focus();a&&a.body.focus();this.pb()},blur:function(){j.fa(this.document).blur();this.document&&this.document.body.blur()},Be:function(a){var b=this.ta,f=this.document;b.Zb=b.Zb||"";b.Zb+="\n"+a;b=f.createElement("style");f.getElementsByTagName("head")[0].appendChild(b);if(b.styleSheet)b.styleSheet.cssText=
a;else b.appendChild(f.createTextNode(a))},og:function(a){var b=this.ta,f=this.document;b.wa=b.wa||[];b.wa.push(a);b=f.createElement("link");b.rel="stylesheet";f.getElementsByTagName("head")[0].appendChild(b);b.href=a},Pg:function(a){for(var b=this.ta,f=z.makeArray(this.document.getElementsByTagName("link")),q=0;q<f.length;q++)f[q].href==a&&j.h(f[q]);b.wa=b.wa||[];b=b.wa;a=z.indexOf(a,b);a!=-1&&b.splice(a,1)},Yc:function(){function a(){t=B.document;b.document=t;f.detach();t.open("text/html","replace");
t.write(q);t.close()}var b=this,f=b.kb,q=b.se(b.Pb),B=f[0].contentWindow,t;try{t=B.document}catch(E){f[0].src=f[0].src;if(u.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this.te?a():this.on("dataReady",a)},pg:function(a,b,f){this.cb=this.cb||[];f=f||{};f.Ye=b;this.cb[a]=f},Rd:function(a){if(this.cb){var b=this.cb[a];if(b)if(!(b.status&&!b.duplicate)){a=this.Env.mods[a].requires||[];for(var f=0;f<a.length;f++)this.Rd(a[f]);b.Ye.call(this);b.status=1}}},db:function(){var a=this;a.Wc&&clearTimeout(a.Wc);
a.Wc=setTimeout(function(){var b=a.getSelection();if(b&&!b.wd){var f=b.ib(),q=new l.Ua(f);if(!a.rc||!a.rc.cd(q)){a.rc=q;a.fire("selectionChange",{selection:b,path:q,element:f})}}},100)},pb:function(){this.rc=U;this.db()},vd:function(a,b,f){var q=this;q.focus();setTimeout(function(){var B,t=a.d(),E=l.m,n=l.oa,x=l.n,J=E.Sa[t],s=q.getSelection(),c=s&&s.A(),h,p,v,o;if(!c||c.length==0){var C=arguments,O=C.callee;setTimeout(function(){O.apply(q,C)},30)}else{q.fire("save");for(var P=c.length-1;P>=0;P--){h=
c[P];h.deleteContents();B=!P&&a||a.K(w);b&&b(B);if(J)for(;(v=h.xa(r,w))&&(o=E[v.d()])&&!(o&&o[t]);)if(v.d()in E.span)h.wc(v);else if(h.ua()&&h.ja()){h.setStartBefore(v);h.collapse(w);v.h()}else h.vc();h.insertNode(B);p||(p=B)}if(p){t=p.w(w);E=q.document;o=l.m;if(o.Ac[B.d()]){t=new i(E.createTextNode(" "));t.insertAfter(p)}else if(t){if(t.d()=="br"&&o[t.parent().d()].p){o=new i("<p>&nbsp;</p>",U,E);t[0].parentNode.replaceChild(o[0],t[0]);t=o}}else{o=new i("<p>&nbsp;</p>",U,E);o.insertAfter(p);t=o}h.H(p,
n.t);t&&t[0].nodeType==x.e&&h.nb(t);s.vb([h]);q.focus();B&&B.Ob();setTimeout(function(){q.fire("save")},10);f&&f(B)}}},0)},hf:function(a){var b=this;if(b.htmlDataProcessor)a=b.htmlDataProcessor.toDataFormat(a);if(u.webkit){var f=j.create(a,U,b.document);f=f.nodeType==11?z.makeArray(f.childNodes):[f];for(var q=0;q<f.length;q++)b.vd(new i(f[q]))}else{b.focus();setTimeout(function(){var B=b.getSelection(),t=B&&B.A();if(!t||t.length==0){var E=arguments,n=E.callee;setTimeout(function(){n.apply(b,E)},30)}else{b.fire("save");
if(u.ie){B=B.r();B.type=="Control"&&B.clear();B.createRange().pasteHTML(a)}else b.document.execCommand("inserthtml",r,a);setTimeout(function(){b.fire("save")},10)}},0)}}});l._initIFrame=function(a){function b(s){d(function(){B.designMode="on";setTimeout(function(){B.designMode="off";E.focus();if(!arguments.callee.vf)arguments.callee.vf=w},50)},function(){B.designMode="off";j.attr(E,"contentEditable",r);j.attr(E,"contentEditable",w);!s&&b(1)})}var f=g.Ze(a);a=f.$[0];var q=f.kb[0].contentWindow,B=f.document,
t=f.ta;j.h(B.getElementById("ke_actscript"));var E=B.body;if(u.ie){E.hideFocus=w;E.disabled=w;E.contentEditable=w;E.removeAttribute("disabled")}else setTimeout(function(){if(u.gecko||u.opera)E.contentEditable=w;else if(u.webkit)E.parentNode.contentEditable=w;else B.designMode="on"},0);if(u.webkit){e.on(B,"click",function(s){var c=new i(s.target);z.inArray(c.d(),["input","select"])&&s.preventDefault()});e.on(B,"mouseup",function(s){var c=new i(s.target);z.inArray(c.d(),["input","textarea"])&&s.preventDefault()})}if(u.gecko||
u.ie||u.opera){var n;n=new i(j.insertAfter((new i('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],a));n.on("focus",function(){f.focus()});f.ng=function(){u.gecko&&f.kc&&n[0].focus()};f.on("destroy",function(){})}if(u.ie&&B.compatMode=="CSS1Compat"||u.gecko||u.opera){var x=new i(B.documentElement);x.on("mousedown",function(s){if((new i(s.target))[0]==x[0]){u.gecko&&b(r);n[0].focus()}})}e.on(q,"focus",function(){if(u.gecko)b(r);else u.opera&&E.focus();f.pb()});
u.gecko&&e.on(f.document,"mousedown",function(){f.kc||b(r)});if(u.ie){e.on(B,"keydown",function(s){if(s.keyCode in{8:1,46:1}){var c=f.getSelection(),h=c.gc();if(h){f.fire("save");var p=c.A()[0].O();h.h();c.Kd([p]);f.fire("save");s.preventDefault()}}});if(B.compatMode=="CSS1Compat"){var J={33:1,34:1};e.on(B,"keydown",function(s){s.keyCode in J&&setTimeout(function(){f.getSelection().scrollIntoView()},0)})}}setTimeout(function(){u.ie&&setTimeout(function(){if(B){E.runtimeStyle.marginBottom="0px";E.runtimeStyle.marginBottom=
""}},1E3)},0);setTimeout(function(){f.fire("dataReady");var s=t.disableObjectResizing,c=t.disableInlineTableEditing;if(s||c)try{B.execCommand("enableObjectResizing",r,!s);B.execCommand("enableInlineTableEditing",r,!c)}catch(h){e.on(E,u.ie?"resizestart":"resize",function(p){var v=new i(p.target);if(s||v.d()==="table"&&c)p.preventDefault()})}},10);u.webkit&&e.on(B,"mousedown",function(s){s=new i(s.target);z.inArray(s.d(),["img","hr","input","textarea","select"])&&f.getSelection().uc(s)});u.gecko&&e.on(B,
"dragstart",function(s){var c=new i(s.target);c.d()==="img"&&/ke_/.test(c[0].className)&&s.preventDefault()});g.add(f)};y=l.prototype;I.o(y,{setData:y.setData,getData:y.getData,insertElement:y.vd,insertHtml:y.hf,ready:y.ready,addCustomStyle:y.Be,addCommand:y.Ae,hasCommand:y.df,execCommand:y.execCommand,useDialog:y.Cf,addDialog:y.Ce,getDialog:y.nd,getMode:y.fc,sync:y.Od,getSelection:y.getSelection,focus:y.focus,blur:y.blur,notifySelectionChange:y.pb})});
KISSY.Editor.add("zindex",function(){var l=KISSY.Editor;if(!l.xc){l.xc={Jf:1100,Zf:1200,Lf:99999,Sf:900,Yf:9999,LOADING:11E3,Rf:12E3,$d:1200};l.Ub=function(w){return(l.Kf.Ub||1E4)+w};l.baseZIndex=l.Ub;l.zIndexManager=l.xc}});
KISSY.Editor.add("dtd",function(l){l.m=function(){function w(E){for(var n=arguments.length-1;n>0;)KISSY.mix(E,arguments[n--]);return E}var r={isindex:1,fieldset:1},I={input:1,button:1,select:1,textarea:1,label:1},A=w({a:1},I),z=w({iframe:1},A),u={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},i=w({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),e=w({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),g=w({p:1},e);I=w({iframe:1},e,I);e={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var d=w({a:1},I),m={tr:1},y={"#":1},k=w({param:1},e),a=w({form:1},r,z,u,g),b={li:1},f={base:1,link:1,meta:1,title:1},q=w(f,{style:1,script:1}),B={head:1,body:1},t={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{zb:w({html:1},B,f),Sa:t,Hf:{body:1,div:1,td:1,th:1,caption:1,
form:1},Ac:d,yc:w({script:1,style:1},t),zc:{script:1,style:1},xb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},yb:{dd:1,dt:1,li:1},Sd:{ul:1,ol:1,dl:1},Cc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},ba:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},If:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},Dc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:B,head:q,style:y,body:a,base:{},link:{},meta:{},title:y,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:d,button:w(g,u),basefont:{},h5:d,h4:d,samp:d,h6:d,ol:b,h1:d,h3:d,option:y,h2:d,form:w(r,z,u,g),select:{optgroup:1,option:1},font:d,ins:d,menu:b,abbr:d,label:d,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:d,script:y,tfoot:m,cite:d,li:a,input:{},iframe:a,
strong:d,textarea:y,noframes:a,big:d,small:d,span:d,hr:{},dt:d,sub:d,optgroup:{option:1},param:{},bdo:d,"var":d,div:a,object:k,sup:d,dd:a,strike:d,area:{},dir:b,map:w({area:1,form:1,p:1},r,j,u),applet:k,dl:{dt:1,dd:1},del:d,isindex:{},fieldset:w({Jg:1},e),thead:m,ul:b,acronym:d,b:d,a:I,blockquote:a,caption:d,i:d,u:d,tbody:m,s:d,address:w(z,g),tt:d,legend:d,q:d,pre:w(i,A),p:d,em:d,dfn:d}}();l.XHTML_DTD=l.m});
KISSY.Editor.add("elementpath",function(l){function w(e){var g=z,d=z,m=[];for(e=e;e&&e[0];){if(e[0].nodeType==A.e){if(!this.mf)this.mf=e;var y=e.d();if(!d){if(!g&&u[y])g=e;if(j[y]){var k;if(k=!g){if(k=y=="div"){a:{k=e;k=k[0]||k;k=k.childNodes;for(var a=0,b=k.length;a<b;a++){var f=k[a];if(f.nodeType==A.e&&I.Sa[f.nodeName.toLowerCase()]){k=T;break a}}k=X}k=!k}k=k}if(k)g=e;else d=e}}m.push(e);if(y=="body")break}e=e.parent()}this.block=this.z=g;this.blockLimit=this.F=d;this.elements=this.elements=m}var r=
KISSY.DOM,I=l.m,A=l.n,z=U,u={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};w.prototype={cd:function(e){var g=this.elements;e=e&&e.elements;if(!e||g.length!=e.length)return X;for(var d=0;d<g.length;d++)if(!r.g(g[d],e[d]))return X;return T},contains:function(e){for(var g=this.elements,d=0;d<g.length;d++)if(g[d].d()in e)return g[d];return z}};l.ElementPath=l.Ua=w;var i=w.prototype;l.k.o(i,{compare:i.cd,
contains:i.contains})});
KISSY.Editor.add("walker",function(l){function w(m,y){if(this.c.end)return u;var k,a=this.za,b,f=this.hc,q=this.type,B=m?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return u}}if(!m&&!this.c.qd){var t=a.endContainer,E=new g(t[0].childNodes[a.endOffset]);this.c.qd=function(s,c){return(s=e.D(s))&&s[0]&&(!c||!e.g(t,s))&&(!E[0]||!s.g(E))&&(s[0].nodeType!=i.e||!c||s.d()!="body")}}if(m&&!this.c.rd){var n=a.startContainer,x=a.startOffset>
0&&new g(n[0].childNodes[a.startOffset-1]);this.c.rd=function(s,c){return(s=e.D(s))&&s[0]&&(!c||!s.g(n))&&(!x[0]||!s.g(x))&&(s[0].nodeType!=i.e||!c||s.d()!="body")}}var J=m?this.c.rd:this.c.qd;b=f?function(s,c){if(J(s,c)===z)return z;return f(s,c)}:J;if(this.gb)k=this.gb[B](z,q,b);else if(m){k=a.endContainer;if(a.endOffset>0){k=new g(k[0].childNodes[a.endOffset-1]);if(b(k)===z)k=u}else k=b(k,A)===z?u:k.ga(A,q,b)}else{k=a.startContainer;if((k=new g(k[0].childNodes[a.startOffset]))&&k[0]){if(b(k)===
z)k=u}else k=b(a.startContainer,A)===z?u:a.startContainer.w(A,q,b)}for(;k&&k[0]&&!this.c.end;){this.gb=k;if(!this.Q||this.Q(k)!==z){if(!y)return k}else if(y&&this.Q)return z;k=k[B](z,q,b)}this.end();return this.gb=u}function r(m){for(var y,k=u;y=w.call(this,m);)k=y;return k}function I(m){this.za=m;this.c={}}var A=T,z=X,u=U,j=KISSY,i=l.n,e=j.DOM,g=j.Node;j.augment(I,{end:function(){this.c.end=1},next:function(){return w.call(this)},sb:function(){return w.call(this,A)},bd:function(){return w.call(this,
z,A)!==z},ad:function(){return w.call(this,A,A)!==z},yd:function(){return r.call(this)},xd:function(){return r.call(this,A)},reset:function(){delete this.gb;this.c={}}});I.Vb=function(m){return function(y){y=e.D(y);return!(y&&y[0].nodeType==i.e&&y.qa(m))}};I.of=function(){return this.Vb({Wb:1})};I.Ia=function(m,y){function k(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,f;b=a&&a[0]&&a[0].nodeType==i.f&&(f=a.parent())&&k(f);b=m?b:b||k(a);return y^b}};I.Ra=function(m){return function(y){y=
(y=y[0]||y)&&y.nodeType==i.f&&!j.trim(y.nodeValue);return m^y}};I.jf=function(m){var y=I.Ra();return function(k){k=y(k)||k[0].nodeType==i.e&&!k[0].offsetHeight;return m^k}};l.Da=I;l.Walker=I;var d=I.prototype;l.k.o(d,{end:d.end,next:d.next,previous:d.sb,checkForward:d.bd,checkBackward:d.ad,lastForward:d.yd,lastBackward:d.xd,reset:d.reset});l.k.o(I,{blockBoundary:I.Vb,listItemBoundary:I.of,bookmark:I.Ia,whitespaces:I.Ra,invisible:I.jf})});
KISSY.Editor.add("range",function(l){function w(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=e;this.collapsed=j;this.document=c}function r(c){var h=c[0].nodeType!=d.f&&c.d()in q.ba,p=!g.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||p||c}function I(c){return!x(c)&&!J(c)}function A(c){var h=i,p=k.Ia(j);return function(v){if(p(v))return j;if(v[0].nodeType==d.f){if(g.trim(v[0].nodeValue).length)return i}else if(v[0].nodeType==d.e)if(!n[v.d()])if(!c&&!f.ie&&
v.d()=="br"&&!h)h=j;else return i;return j}}function z(c,h){function p(v){return v&&v.nodeName=="span"&&v.getAttribute("_ke_bookmark")}return function(v){var o,C;o=v&&!v.nodeName&&(C=v.parentNode)&&p(C);o=c?o:o||p(v);return h^o}}function u(c){return function(h){h=(h=h[0]||h)&&h.nodeType==d.f&&!g.trim(h.nodeValue);return c^h}}l.oa={W:1,J:2,C:3,t:4,Cb:1,Bb:2,Ta:3,Xa:1,Wd:2,$f:3,ea:1,Gc:2};l.RANGE=l.oa;var j=T,i=X,e=U,g=KISSY,d=l.n,m=l.oa,y=l.Va,k=l.Da,a=g.DOM,b=l.k.md,f=g.UA,q=l.m,B=l.Ua,t=g.Node,E=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};w.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};g.augment(w,{Qa:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},pc:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=d.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=d.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},qc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.U(c,m.C);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.T(h,m.t)},setStart:function(c,h){if(c[0].nodeType==d.e&&E[c.d()]){c=c.parent();h=c.v()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Qa()},setEnd:function(c,h){if(c[0].nodeType==d.e&&E[c.d()]){c=c.parent();h=c.v()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Qa()},U:function(c,h){switch(h){case m.W:this.setStart(c,0);break;case m.J:c[0].nodeType==d.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case m.C:this.setStartBefore(c);break;case m.t:this.setStartAfter(c)}this.Qa()},T:function(c,h){switch(h){case m.W:this.setEnd(c,0);break;case m.J:c[0].nodeType==d.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case m.C:this.setEndBefore(c);break;case m.t:this.setEndAfter(c)}this.Qa()},
bc:function(c,h){var p=this.startContainer,v=this.endContainer,o=this.startOffset,C=this.endOffset,O,P=this.document,N;this.qc();if(v[0].nodeType==d.f)v=v.ha(C);else if(v[0].childNodes.length>0)if(C>=v[0].childNodes.length){v=new t(v[0].appendChild(P.createTextNode("")));N=j}else v=new t(v[0].childNodes[C]);if(p[0].nodeType==d.f){p.ha(o);if(p.g(v))v=new t(p[0].nextSibling)}else if(o)if(o>=p[0].childNodes.length){O=new t(P.createTextNode(""));p.append(O);p=O;O=j}else p=new t(p[0].childNodes[o].previousSibling);
else{O=new t(P.createTextNode(""));p.prepend(O);p=O;O=j}o=p.Nb();C=v.Nb();var Q,S,W;for(Q=0;Q<o.length;Q++){S=o[Q];W=C[Q];if(!S.g(W))break}P=h;for(var V,Y,D,K=Q;K<o.length;K++){V=o[K];Y=P&&!V.g(p)?P.appendChild(V.K()[0]):U;for(V=V[0].nextSibling;V;){if(a.g(C[K],V)||a.g(v,V))break;D=V.nextSibling;if(c==2)P.appendChild(V.cloneNode(j));else{a.h(V);c==1&&P.appendChild(V)}V=D}if(Y)P=Y}P=h;for(Q=Q;Q<C.length;Q++){V=C[Q];Y=P&&c>0&&!V.g(v)?P.appendChild(V.K()[0]):U;if(!o[Q]||!V.parent().g(o[Q].parent()))for(V=
V[0].previousSibling;V;){if(a.g(o[Q],V)||a.g(p,V))break;D=V.previousSibling;if(c==2)P.insertBefore(V.cloneNode(j),P.firstChild);else{a.h(V);c==1&&P.insertBefore(V,P.firstChild)}V=D}if(Y)P=Y}if(c==2){W=this.startContainer[0];if(W.nodeType==d.f&&W.nextSibling&&W.nextSibling.nodeType==d.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}W=this.endContainer[0];if(W.nodeType==d.f&&W.nextSibling&&W.nextSibling.nodeType==d.f){W.data+=W.nextSibling.data;W.parentNode.removeChild(W.nextSibling)}}else{if(S&&
W&&(!p.parent().g(S.parent())||!v.parent().g(W.parent()))){S=W.v();O&&W.parent().g(p.parent())&&S--;this.setStart(W.parent(),S)}this.collapse(j)}O&&p.h();N&&v[0].parentNode&&v.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=j},clone:function(){var c=new w(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},od:function(){var c=this.clone();c.pc();if(c.startContainer[0].nodeType!=d.e||c.endContainer[0].nodeType!=d.e)return e;var h=new l.Da(c),p=z(j,undefined),v=u(j);c.Q=function(o){return v(o)&&p(o)};c=h.next();h.reset();h=h.sb();return c&&c.g(h)?c:e},Pa:function(c,h){if(!this.collapsed){c=c||m.Gc;var p=this.clone(),v=this.startContainer,o=this.endContainer,C=this.startOffset,O=this.endOffset,P=1,N=1;if(v&&v[0].nodeType==d.f)if(C)if(C>=v[0].nodeValue.length)p.setStartAfter(v);
else{p.setStartBefore(v);P=0}else p.setStartBefore(v);if(o&&o[0].nodeType==d.f)if(O)if(O>=o[0].nodeValue.length)p.setEndAfter(o);else{p.setEndAfter(o);N=0}else p.setEndBefore(o);p=new k(p);p.Q=function(S){S=S[0]||S;return S.nodeType==(c==m.ea?d.e:d.f)};var Q;p.hc=function(S,W){S=S[0]||S;if(c==m.ea&&S.nodeType==d.f)return i;if(W&&S==Q)return i;if(!W&&S.nodeType==d.e)Q=S;return j};if(P)(v=p[c==m.ea?"lastForward":"next"]())&&this.U(v,h?m.W:m.C);if(N){p.reset();(p=p[c==m.ea?"lastBackward":"previous"]())&&
this.T(p,h?m.J:m.t)}return!!(P||N)}},bf:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=d.e)return c;return c.childNodes[this.startOffset]||c},ed:function(c){var h=this.startContainer,p=this.endContainer,v=this.startOffset,o=this.endOffset,C,O;if(!h||!p)return{start:0,end:0};if(c){if(h[0].nodeType==d.e)if((C=new t(h[0].childNodes[v]))&&C[0]&&C[0].nodeType==d.f&&v>0&&C[0].previousSibling.nodeType==d.f){h=C;v=0}for(;h[0].nodeType==d.f&&(O=h.sa())&&O[0].nodeType==d.f;){h=O;v+=
O[0].nodeValue.length}if(!this.collapsed){if(p[0].nodeType==d.e)if((C=new t(p[0].childNodes[o]))&&C[0]&&C[0].nodeType==d.f&&o>0&&C[0].previousSibling.nodeType==d.f){p=C;o=0}for(;p[0].nodeType==d.f&&(O=p.sa())&&O[0].nodeType==d.f;){p=O;o+=O[0].nodeValue.length}}}return{start:h.Ea(c),end:this.collapsed?e:p.Ea(c),startOffset:v,endOffset:o,Bd:c,kf:j}},O:function(c){var h,p,v,o,C=this.collapsed;h=new t("<span>",e,this.document);h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){v=
g.guid("ke_bm_");h.attr("id",v+"S")}if(!C){p=h.K();p.html("&nbsp;");c&&p.attr("id",v+"E");o=this.clone();o.collapse();o.insertNode(p)}o=this.clone();o.collapse(j);o.insertNode(h);if(p){this.setStartAfter(h);this.setEndBefore(p)}else this.H(h,m.t);return{Z:c?v+"S":h,P:c?v+"E":p,Md:c,collapsed:C}},H:function(c,h){this.U(c,h);this.collapse(j)},trim:function(c,h){var p=this.startContainer,v=this.startOffset,o=this.collapsed;if((!c||o)&&p[0]&&p[0].nodeType==d.f){if(v)if(v>=p[0].nodeValue.length){v=p.v()+
1;p=p.parent()}else{var C=p.ha(v);v=p.v()+1;p=p.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(a.g(p,this.endContainer))this.endOffset+=1}else{v=p.v();p=p.parent()}this.setStart(p,v);if(o){this.collapse(j);return}}p=this.endContainer;v=this.endOffset;if(!(h||o)&&p[0]&&p[0].nodeType==d.f){if(v){v>=p.nodeValue.length||p.ha(v);v=p.v()+1}else v=p.v();p=p.parent();this.setEnd(p,v)}},insertNode:function(c){this.qc();this.trim(i,j);var h=this.startContainer;
h[0].insertBefore(c[0]||c,h[0].childNodes[this.startOffset]||U);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.kf){var h=b(this.document,c.start,c.Bd),p=c.startOffset,v=c.end&&b(this.document,c.end,c.Bd);c=c.endOffset;this.setStart(h,p);v?this.setEnd(v,c):this.collapse(j)}else{h=(p=c.Md)?g.one("#"+c.Z,this.document):c.Z;c=p?g.one("#"+c.P,this.document):c.P;this.setStartBefore(h);h.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(j)}},
xa:function(c,h){var p=this.startContainer,v=this.endContainer;p=a.g(p,v)?c&&p[0].nodeType==d.e&&this.startOffset==this.endOffset-1?new t(p[0].childNodes[this.startOffset]):p:p.Jb(v);return h&&p[0].nodeType==d.f?p.parent():p},Ja:function(c){switch(c){case m.Cb:if(this.collapsed)break;c=this.xa();var h=new t(this.document.body),p,v,o,C,O,P=i,N,Q;N=this.startContainer;Q=this.startOffset;if(N[0].nodeType==d.f){if(Q){N=!g.trim(N[0].nodeValue.substring(0,Q)).length&&N;P=!!N}if(N)if(!(C=N[0].previousSibling))o=
N.parent()}else{if(Q)C=N[0].childNodes[Q-1]||N[0].lastChild;C||(o=N)}for(;o||C;){if(o&&!C){if(!O&&a.g(o,c))O=j;if(!h.contains(o))break;if(!P||o.css("display")!="inline"){P=i;if(O)p=o;else this.setStartBefore(o)}C=o[0].previousSibling}for(;C;){N=i;if(C.nodeType==d.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=e;N=/[\s\ufeff]$/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(P&&q.ba[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=e;else for(var S=C.all||C.getElementsByTagName("*"),
W=0,V;V=S[W++];)if(!q.ba[V.nodeName.toLowerCase()]){C=e;break}if(C)N=!!Q.length}else C=e;if(N)if(P)if(O)p=o;else o&&this.setStartBefore(o);else P=j;if(C){N=C.previousSibling;if(!o&&!N){o=new t(C);C=e;break}C=N}else o=e}if(o)o=o.parent()}N=this.endContainer;Q=this.endOffset;o=C=e;O=P=i;if(N[0].nodeType==d.f){N=!g.trim(N[0].nodeValue.substring(Q)).length&&N;P=!(N&&N[0].nodeValue.length);if(N)if(!(C=N[0].nextSibling))o=N.parent()}else(C=N[0].childNodes[Q])||(o=N);for(;o||C;){if(o&&!C){if(!O&&a.g(o,c))O=
j;if(!h.contains(o))break;if(!P||o.css("display")!="inline"){P=i;if(O)v=o;else o&&this.setEndAfter(o)}C=o[0].nextSibling}for(;C;){N=i;if(C.nodeType==d.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=e;N=/^[\s\ufeff]/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(P&&q.ba[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=e;else{S=C.all||C.getElementsByTagName("*");for(W=0;V=S[W++];)if(!q.ba[V.nodeName.toLowerCase()]){C=e;break}}if(C)N=!!Q.length}else C=e;if(N)if(P)if(O)v=
o;else this.setEndAfter(o);if(C){N=C.nextSibling;if(!o&&!N){o=new t(C);C=e;break}C=N}else o=e}if(o)o=o.parent()}if(p&&v){c=p.contains(v)?v:p;this.setStartBefore(c);this.setEndAfter(c)}break;case m.Bb:case m.Ta:o=new w(this.document);h=new t(this.document.body);o.U(h,m.W);o.setEnd(this.startContainer,this.startOffset);o=new k(o);var Y,D,K=k.Vb(c==m.Ta?{Wb:1}:e),G=function(F){var H=K(F);H||(Y=F);return H};p=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")D=F;return H};o.hc=G;o=o.xd();Y=Y||h;this.U(Y,
Y.d()!="br"&&(!o&&this.ua()||o&&Y.contains(o))?m.W:m.t);o=this.clone();o.collapse();o.T(h,m.J);o=new k(o);o.hc=c==m.Ta?p:G;Y=e;o=o.yd();Y=Y||h;this.T(Y,!o&&this.ja()||o&&Y.contains(o)?m.J:m.C);D&&this.setEndAfter(D)}},ua:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==d.f)if(g.trim(c[0].nodeValue.substring(0,h)).length)return i;this.trim();c=new B(this.startContainer);h=this.clone();h.collapse(j);h.U(c.z||c.F,m.W);c=new k(h);c.Q=A(j);return c.ad()},ja:function(){var c=
this.endContainer,h=this.endOffset;if(c[0].nodeType==d.f)if(g.trim(c[0].nodeValue.substring(h)).length)return i;this.trim();c=new B(this.endContainer);h=this.clone();h.collapse(i);h.T(c.z||c.F,m.J);c=new k(h);c.Q=A(i);return c.bd()},deleteContents:function(){this.collapsed||this.bc(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.bc(1,c);return c},Yb:function(c,h){var p=this.clone();p[h==m.Xa?"setStartAt":"setEndAt"](c,h==m.Xa?m.W:m.J);p=new k(p);p.Q=
r;return p[h==m.Xa?"checkBackward":"checkForward"]()},ld:function(){var c=this.startContainer,h=this.endContainer,p=this.startOffset,v=this.endOffset,o;if(c[0].nodeType==d.e){o=c[0].childNodes.length;if(o>p)c=new t(c[0].childNodes[p]);else if(o<1)c=c.ga();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new t(c);c=c.w()||c}}if(h[0].nodeType==d.e){o=h[0].childNodes.length;if(o>v)h=(new t(h[0].childNodes[v])).ga(j);else if(o<1)h=h.ga();else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new t(h)}}if(c.Ga(h)&y.ca)c=
h;return{Z:c,P:h}},hb:function(c,h){var p=this.O(),v=new t(this.document.createElement(h));this.collapse(c);this.Ja(m.Bb);v[0].appendChild(this.extractContents());v.bb();f.ie||v.Hb();this.insertNode(v);this.moveToBookmark(p);return v},vc:function(c){var h=new B(this.startContainer),p=new B(this.endContainer),v=h.z,o=p.z,C=e;if(!h.F.g(p.F))return e;if(c!="br"){if(!v){v=this.hb(j,c);o=(new B(this.endContainer)).z}o||(o=this.hb(i,c))}c=v&&this.ua();h=o&&this.ja();this.deleteContents();if(v&&a.g(v,o))if(h){C=
new B(this.startContainer);this.H(o,m.t);o=e}else if(c){C=new B(this.startContainer);this.H(v,m.C);v=e}else{o=this.wc(v);!f.ie&&!g.inArray(v.d(),["ul","ol"])&&v.Hb()}return{Ng:v,Lg:o,Ff:c,Ef:h,Fg:C}},wc:function(c){if(!this.collapsed)return e;this.T(c,m.J);var h=this.extractContents(),p=c.K(i);p[0].appendChild(h);p.insertAfter(c);this.H(c,m.t);return p},nb:function(c,h){var p,v=l.m;if(v.xb[c.d()])return i;for(;c&&c[0].nodeType==d.e;){if(p=c.Mc())this.H(c,h?m.J:m.W);else if(v.Ac[c.d()]){this.H(c,h?
m.t:m.C);return j}if((c=v.xb[c.d()]?c[h?"_4e_previous":"_4e_next"](I):c[h?"_4e_last":"_4e_first"](I))&&c[0].nodeType==d.f){this.H(c,h?m.t:m.C);return j}}return p},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==d.f?c[0].nodeValue.length:c[0].childNodes.length)}});var n={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},x=new k.Ra,J=new k.Ia;l.Range=
w;l.Range=w;var s=w.prototype;l.k.o(s,{updateCollapsed:s.Qa,optimize:s.pc,setStartAfter:s.setStartAfter,setEndAfter:s.setEndAfter,setStartBefore:s.setStartBefore,setEndBefore:s.setEndBefore,optimizeBookmark:s.qc,setStart:s.setStart,setEnd:s.setEnd,setStartAt:s.U,setEndAt:s.T,execContentsAction:s.bc,collapse:s.collapse,clone:s.clone,getEnclosedNode:s.od,shrink:s.Pa,getTouchedStartNode:s.bf,createBookmark2:s.ed,createBookmark:s.O,moveToPosition:s.H,trim:s.trim,insertNode:s.insertNode,moveToBookmark:s.moveToBookmark,
getCommonAncestor:s.xa,enlarge:s.Ja,checkStartOfBlock:s.ua,checkEndOfBlock:s.ja,deleteContents:s.deleteContents,extractContents:s.extractContents,checkBoundaryOfElement:s.Yb,getBoundaryNodes:s.ld,fixBlock:s.hb,splitBlock:s.vc,splitElement:s.wc,moveToElementEditablePosition:s.nb,selectNodeContents:s.selectNodeContents})});
KISSY.Editor.add("domiterator",function(l){function w(k){if(!(arguments.length<1)){this.za=k;this.dc=I;this.kd=r;this.ac=I;this.c||(this.c={})}}var r=T,I=X,A=KISSY,z=A.UA,u=l.Da,j=l.Range,i=l.oa,e=l.n,g=l.Ua,d=A.Node,m=A.DOM,y=/^[\r\n\t ]*$/;A.augment(w,{af:function(k){var a,b,f,q,B;if(!this.c.I){b=this.za.clone();b.Pa(i.ea,r);b.Ja(this.dc||!this.kd?i.Ta:i.Bb);var t=new u(b),E=u.Ia(r,r);t.Q=E;this.c.la=t.next();t=new u(b);t.Q=E;t=t.sb();this.c.I=t.w(r);if(this.c.I&&this.c.I[0].nodeType==e.f&&!A.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().qa()){E=new j(b.document);E.H(this.c.I,i.t);if(E.ja()){E=new g(E.endContainer);this.c.I=(E.z||E.F).w(r)}}if(!this.c.I){this.c.I=this.c.hd=new d(b.document.createTextNode(""));m.insertAfter(this.c.I[0],t[0])}b=U}E=this.c.la;t=this.c.I;for(this.c.la=U;E;){var n=I,x=E[0].nodeType!=e.e,J=I;if(x){if(E[0].nodeType==e.f)if(y.test(E[0].nodeValue))x=I}else{var s=E.d();if(E.qa(this.dc&&{Wb:1})){if(s=="br")x=r;else if(!b&&!E[0].childNodes.length&&s!="hr"){a=E;f=E.g(t);break}if(b){b.T(E,i.C);
if(s!="br")this.c.la=E}n=r}else{if(E[0].firstChild){if(!b){b=new j(this.za.document);b.U(E,i.C)}E=new d(E[0].firstChild);continue}x=r}}if(x&&!b){b=new j(this.za.document);b.U(E,i.C)}f=(!n||x)&&E.g(t);if(b&&!n)for(;!E[0].nextSibling&&!f;){s=E.parent();if(s.qa(this.dc&&{Wb:1})){n=r;f||s.g(t);break}E=s;x=r;f=E.g(t);J=r}x&&b.T(E,i.t);E=E.w(J,U,t);if((f=!E)||n&&b)break}if(!a){if(!b){this.c.hd&&this.c.hd.h();return this.c.la=U}a=new g(b.startContainer);E=a.F;n={Ag:1,Tg:1,Sg:1};a=a.z;if((!a||!a[0])&&!this.ac&&
n[E.d()]&&b.ua()&&b.ja())a=E;else if(!a||this.ac&&a.d()=="li"){a=new d(this.za.document.createElement(k||"p"));a[0].appendChild(b.extractContents());a.bb();b.insertNode(a);q=B=r}else if(a.d()!="li"){if(!b.ua()||!b.ja()){a=a.K(I);a[0].appendChild(b.extractContents());a.bb();B=b.vc();q=!B.Ff;B=!B.Ef;b.insertNode(a)}}else if(!f)this.c.la=a.g(t)?U:b.ld().P.w(r,U,t)}if(q){b=new d(a[0].previousSibling);if(b[0]&&b[0].nodeType==e.e)if(b.d()=="br")b.h();else b[0].lastChild&&m.d(b[0].lastChild)=="br"&&m.h(b[0].lastChild)}if(B){b=
u.Ia(I,r);q=new d(a[0].lastChild);if(q[0]&&q[0].nodeType==e.e&&q.d()=="br")if(z.ie||q.sa(b)||q.Fa(b))q.h()}if(!this.c.la)this.c.la=f||a.g(t)?U:a.w(r,U,t);return a}});j.prototype.Qe=function(){return new w(this)}});
KISSY.Editor.add("selection",function(l){function w(n){this.document=this.document=n;this.c={M:{}};if(a){var x=this.r().createRange();if(!x||x.item&&x.item(0).ownerDocument!=n||x.parentElement&&x.parentElement().ownerDocument!=n)this.wd=A}}function r(n){n=new w(n);return!n||n.wd?u:n}function I(n){var x=n.document,J=new d(x.body),s=new d(x.documentElement);if(i.ie){if(i.ie<8||document.documentMode==7)s.on("click",function(N){(new d(N.target)).d()==="html"&&n.getSelection().A()[0].select()});var c,
h,p=1;s.on("mousedown",function(){p=0});s.on("mouseup",function(){p=1});J.on("focusin",function(N){if((new d(N.target)).d()=="body")if(c){try{p&&c.select()}catch(Q){}c=u}});J.on("focus",function(){h=A;o()});J.on("beforedeactivate",function(N){if(!N.relatedTarget){h=z;p=1}});g.on(e.fa(x),"blur",function(){x&&x.selection.empty()});J.on("mousedown",function(){v()});J.on("mouseup",function(){h=A;setTimeout(function(){o(A)},0)});var v=function(){h=z},o=function(N){if(h){var Q=n.document,S=n.getSelection(),
W=S&&S.jb(),V=S&&S.r();if(N&&V&&W==m.Eb)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){o(A)},50);return}var Y;if(!(V&&W==m.pa&&(Y=e.d(S.ib()))&&Y in{input:1,textarea:1})){c=V&&S.A()[0];n.db()}}};J.on("keydown",v);J.on("keyup",function(){h=A;o()});g.on(x,"selectionchange",o)}else{g.on(x,"mouseup",n.db,n);g.on(x,"keyup",n.db,n)}var C={table:1,pre:1},O=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,P=l.Da.Ra(A);n.on("selectionChange",
function(N){var Q=N.path;N=(N=N.selection)&&N.A()[0];if(!(!N||!N.collapsed||Q.z))if(Q.F.d()=="body"){Q=N.hb(A,"p");if(Q.ab().match(O)){var S=Q.Fa(P);if(S&&S[0].nodeType==k.e&&!C[S.d()]){N.nb(S);Q.h()}else if((S=Q.sa(P))&&S[0].nodeType==k.e&&!C[S.d()]){N.nb(S,S.ab().match(O)?z:A);Q.h()}}N.select();a||n.pb()}})}l.ae={Eb:1,pa:2,Wa:3};var A=T,z=X,u=U,j=KISSY,i=j.UA,e=j.DOM,g=j.Event,d=j.Node,m=l.ae,y=l.oa,k=l.n,a=!window.getSelection,b=l.Da,f=l.Range,q={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};j.augment(w,{r:!a?function(){var n=this.c.M;return n.nc||(n.nc=e.fa(this.document).getSelection())}:function(){var n=this.c.M;return n.nc||(n.nc=this.document.selection)},jb:!a?function(){var n=this.c.M;if(n.type)return n.type;var x=m.pa,J=this.r();if(J){if(J.rangeCount==1){J=J.getRangeAt(0);var s=J.startContainer;if(s==J.endContainer&&s.nodeType==k.e&&J.endOffset-J.startOffset===1&&q[s.childNodes[J.startOffset].nodeName.toLowerCase()])x=
m.Wa}}else x=m.Eb;return n.type=x}:function(){var n=this.c.M;if(n.type)return n.type;var x=m.Eb;try{var J=this.r(),s=J.type;if(s=="Text")x=m.pa;if(s=="Control")x=m.Wa;if(J.createRange().parentElement)x=m.pa}catch(c){}return n.type=x},A:a?function(){function n(x,J){x=x.duplicate();x.collapse(J);for(var s=x.parentElement(),c=s.childNodes,h,p=0;p<c.length;p++){var v=c[p];if(v.nodeType==k.e){h=x.duplicate();h.moveToElementText(v);v=h.compareEndPoints("StartToStart",x);var o=h.compareEndPoints("EndToStart",
x);h.collapse();if(v>0)break;else if(!v||o==1&&v==-1)return{va:s,offset:p};else if(!o)return{va:s,offset:p+1};h=u}}if(!h){h=x.duplicate();h.moveToElementText(s);h.collapse(z)}h.setEndPoint("StartToStart",x);h=h.text.replace(/\r\n|\r/g,"\n").length;try{for(;h>0;)h-=c[--p].nodeValue.length}catch(C){h=0}return h===0?{va:s,offset:p}:{va:c[p],offset:-h}}return function(){var x=this.c.M;if(x.na)return x.na;var J=this.r(),s=J&&J.createRange(),c=this.jb();if(!J)return[];if(c==m.pa){J=new f(this.document);
c=n(s,A);J.setStart(new d(c.va),c.offset);c=n(s);J.setEnd(new d(c.va),c.offset);return x.na=[J]}else if(c==m.Wa){x=x.na=[];for(c=0;c<s.length;c++){var h=s.item(c),p=h.parentNode,v=0;for(J=new f(this.document);v<p.childNodes.length&&p.childNodes[v]!=h;v++);J.setStart(new d(p),v);J.setEnd(new d(p),v+1);x.push(J)}return x}return x.na=[]}}():function(){var n=this.c.M;if(n.na)return n.na;var x=[],J=this.r();if(!J)return[];for(var s=0;s<J.rangeCount;s++){var c=J.getRangeAt(s),h=new f(this.document);h.setStart(new d(c.startContainer),
c.startOffset);h.setEnd(new d(c.endContainer),c.endOffset);x.push(h)}return n.na=x},ib:function(){var n=this.c.M;if(n.Nd!==undefined)return n.Nd;var x,J=this.r();switch(this.jb()){case m.Wa:return this.gc();case m.pa:var s=this.A()[0];if(s)if(!s.collapsed){for(s.pc();A;){x=s.startContainer;if(s.startOffset==(x[0].nodeType===k.e?x[0].childNodes.length:x[0].nodeValue.length)&&!x.qa())s.setStartAfter(x);else break}x=s.startContainer;if(x[0].nodeType!=k.e)return x.parent();x=new d(x[0].childNodes[s.startOffset]);
if(!x[0]||x[0].nodeType!=k.e)return s.startContainer;for(s=x[0].firstChild;s&&s.nodeType==k.e;){x=new d(s);s=s.firstChild}return x}if(a){s=J.createRange();s.collapse(A);x=s.parentElement()}else if((x=J.anchorNode)&&x.nodeType!=k.e)x=x.parentNode}return n.Nd=x?e.D(x):u},gc:function(){var n=this,x,J=n.c.M;if(J.Ld!==undefined)return J.Ld;if(a){x=n.r().createRange();x=x.item&&x.item(0)}x||(x=function(){for(var s=n.A()[0],c,h,p=2;p&&!((c=s.od())&&c[0].nodeType==k.e&&q[c.d()]&&(h=c));p--)s.Pa(y.ea);return h&&
h[0]}());return J.Ld=e.D(x)},reset:function(){this.c.M={}},uc:function(n){var x,J=this.document;if(a)try{x=J.body.createControlRange();x.addElement(n[0]);x.select()}catch(s){x=J.body.createTextRange();x.moveToElementText(n[0]);x.select()}finally{}else{x=J.createRange();x.selectNode(n[0]);n=this.r();n.removeAllRanges();n.addRange(x)}this.reset()},vb:function(n){if(a){if(n.length>1){var x=n[n.length-1];n[0].setEnd(x.endContainer,x.endOffset);n.length=1}n[0]&&n[0].select()}else{x=this.r();if(!x)return;
x.removeAllRanges();for(var J=0;J<n.length;J++){var s=n[J],c=this.document.createRange(),h=s.startContainer;s.collapsed&&i.gecko&&i.gecko<1.09&&h[0].nodeType==k.e&&!h[0].childNodes.length&&h[0].appendChild(this.document.createTextNode(""));c.setStart(h[0],s.startOffset);c.setEnd(s.endContainer[0],s.endOffset);x.addRange(c)}}this.reset()},Pe:function(n){for(var x=[],J=this.A(),s=0;s<J.length;s++)x.push(J[s].ed(n));return x},Oe:function(n,x){var J=[],s=this.document,c;x=x||this.A();for(var h=x.length,
p=0;p<h;p++){J.push(c=x[p].O(n,A));var v=(n=c.Md)?j.one("#"+c.Z,s):c.Z;c=n?j.one("#"+c.P,s):c.P;for(var o=p+1;o<h;o++){var C=x[o],O=C.startContainer,P=C.endContainer;e.g(O,v.parent())&&C.startOffset++;e.g(O,c.parent())&&C.startOffset++;e.g(P,v.parent())&&C.endOffset++;e.g(P,c.parent())&&C.endOffset++}}return J},Kd:function(n){for(var x=[],J=0;J<n.length;J++){var s=new f(this.document);s.moveToBookmark(n[J]);x.push(s)}this.vb(x);return this},xa:function(){var n=this.A();return n[0].startContainer.Jb(n[n.length-
1].endContainer)},scrollIntoView:function(){var n=this.ib();n&&n.Ob()},removeAllRanges:function(){var n=this.r();if(a)n&&n.clear();else n&&n.removeAllRanges()}});var B={table:1,tbody:1,tr:1},t=b.Ra(A),E=/\ufeff|\u00a0/;f.prototype.select=f.prototype.select=!a?function(){var n=this.startContainer;this.collapsed&&n[0].nodeType==k.e&&!n[0].childNodes.length&&n[0].appendChild(this.document.createTextNode(""));var x=this.document.createRange();x.setStart(n[0],this.startOffset);try{x.setEnd(this.endContainer[0],
this.endOffset)}catch(J){if(J.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(A);x.setEnd(this.endContainer[0],this.endOffset)}else throw J;}n=r(this.document).r();n.removeAllRanges();n.addRange(x)}:function(n){var x=this.collapsed,J,s;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var c=this.startContainer[0].childNodes[this.startOffset];if(c.nodeType==k.e){(new w(this.document)).uc(new d(c));return}}if(this.startContainer[0].nodeType==k.e&&this.startContainer.d()in
B||this.endContainer[0].nodeType==k.e&&this.endContainer.d()in B)this.Pa(y.ea,A);var h=this.O();c=h.Z;var p;if(!x)p=h.P;h=this.document.body.createTextRange();h.moveToElementText(c[0]);h.moveStart("character",1);if(p){n=this.document.body.createTextRange();n.moveToElementText(p[0]);h.setEndPoint("EndToEnd",n);h.moveEnd("character",-1)}else{for(J=c[0].nextSibling;J&&!t(J);)J=J.nextSibling;J=!(J&&J.nodeValue&&J.nodeValue.match(E))&&(n||!c[0].previousSibling||c[0].previousSibling&&e.d(c[0].previousSibling)==
"br");s=new d(this.document.createElement("span"));s.html("&#65279;");s.insertBefore(c);J&&e.insertBefore(this.document.createTextNode("\ufeff"),c)}this.setStartBefore(c);c.h();if(x){if(J){h.moveStart("character",-1);h.select();this.document.selection.clear()}else h.select();if(s){this.H(s,y.C);s.h()}}else{this.setEndBefore(p);p.h();h.select()}};w.getSelection=r;l.Ic=w;l.Selection=w;b=w.prototype;l.k.o(b,{getNative:b.r,getType:b.jb,getRanges:b.A,getStartElement:b.ib,getSelectedElement:b.gc,reset:b.reset,
selectElement:b.uc,selectRanges:b.vb,createBookmarks2:b.Pe,createBookmarks:b.Oe,getCommonAncestor:b.xa,scrollIntoView:b.scrollIntoView,selectBookmarks:b.Kd,removeAllRanges:b.removeAllRanges});l.on("instanceCreated",function(n){I(n.Te)})});
KISSY.Editor.add("styles",function(l){function w(D,K){for(var G in D)D[G]=D[G].replace(V,function(F,H){return K[H]})}function r(D,K){if(K){D=x.clone(D);w(D.attributes,K);w(D.styles,K)}var G=this.element=this.element=(D.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.Fb:S[G]?c.Ya:c.Ca;this.c={definition:D}}function I(D,K){var G=K?this.tc:this.Rb;D.body.focus();for(var F=new p(D),H=F.A(),M=0;M<H.length;M++)G.call(this,H[M]);F.vb(H)}function A(D,K){var G;G=D.element;if(G=="*")G="span";
G=new O(K.createElement(G));return z(G,D)}function z(D,K){var G=K.c.definition,F=G.attributes;G=r.pd(G);if(F)for(var H in F)D.attr(H,F[H]);if(G)D[0].style.cssText=G;return D}function u(D){var K=D.O(t),G=D.Qe();G.ac=t;G.kd=t;for(var F,H=D.document;F=G.af();){var M=A(this,H);F=F;var L=M;M=L.d=="pre";var R=F.d=="pre",ba=!M&&R;if(M&&!R){R=F;L=L;ba=R.html();ba=j(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+ba+"</pre>";L=new O(R.firstChild);L.h()}else L.html(ba);L=L}else if(ba)L=e(i(F),L);else F.Mb(L);F[0].parentNode.replaceChild(L[0],F[0]);if(M){F=L;M=void 0;if((M=F.ga(t,v.e))&&M.d()=="pre"){L=j(M.html(),/\n$/,"")+"\n\n"+j(F.html(),/^\n/,"");if(P.ie)F[0].outerHTML="<pre>"+L+"</pre>";else F.html(L);M.h()}}}D.moveToBookmark(K)}function j(D,K,G){var F="",H="";D=D.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(M,L,R){L&&(F=L);R&&(H=R);return""});return F+D.replace(K,G)+H}function i(D){var K=[];j(D.ab(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function e(D,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<D.length;F++){var H=D[F];H=H.replace(/(\r\n|\r)/g,"\n");H=j(H,/^[ \t]*\n/,"");H=j(H,/\n$/,"");H=j(H,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=K.K();M.html(H);G.appendChild(M[0])}return G}function g(D){var K=D.document;if(D.collapsed){K=A(this,K);D.insertNode(K);D.H(K,h.J)}else{var G=this.element,F=this.c.definition,H,M=l.m[G]||(H=t,l.m.span),L=D.O();D.Ja(h.Cb);D.trim();var R=D.O(),ba=R.Z;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=E;if(s.g($,R)){$=
n;Z=t}else{var aa=$[0].nodeType,fa=aa==v.e?$.d():n;if(fa&&$.attr("_ke_bookmark")){$=$.w(t);continue}if(!fa||M[fa]&&($.Ga(R)|o.Y|o.da|o.X)==o.Y+o.da+o.X&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((l.m[ga.d()]||l.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!l.m.ba[fa]||($.Ga(R)|o.Y|o.da|o.X)==o.Y+o.da+o.X)){ca=new C(K);ca.setStartBefore($)}if(aa==v.f||aa==v.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Fa(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),M[da.d()])&&(da.Ga(ba)|o.ca|o.da|o.X)==o.ca+o.da+o.X&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=t)}}else Z=t}else Z=t;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=A(this,K);for(aa=ca.xa();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.$a()){Z=n;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());f(this,Z);ca.insertNode(Z);
Z.ra();P.ie||Z[0].normalize()}ca=n}}ba.h();R.h();D.moveToBookmark(L);D.Pa(h.Gc)}}function d(D){D.Ja(h.Cb);var K=D.O(),G=K.Z;if(D.collapsed){for(var F=new N(G.parent()),H,M=0,L;M<F.elements.length&&(L=F.elements[M]);M++){if(L==F.z||L==F.F)break;if(this.ia(L)){var R=D.Yb(L,h.Wd),ba=!R&&D.Yb(L,h.Xa);if(ba||R){H=L;H.match=ba?"start":"end"}else{L.ra();L.d()==this.element?a(this,L):q(L,k(this)[L.d()])}}}if(H&&H[0]){L=G;for(M=0;;M++){R=F.elements[M];if(s.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(L[0]);L=R}s[H.match=="start"?"insertBefore":"insertAfter"](L,H)}}else{var $=K.P,ca=this;F=function(){for(var Z=new N(G.parent()),aa=new N($.parent()),fa=n,ga=n,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Ib(ga);fa&&G.Ib(fa)};F();for(H=new O(G[0].nextSibling);H[0]!==$[0];){M=H.w();if(H[0]&&H[0].nodeType==v.e&&this.ia(H)){H.d()==
this.element?a(this,H):q(H,k(this)[H.d()]);if(M[0].nodeType==v.e&&M.contains(G)){F();M=new O(G[0].nextSibling)}}H=M}}D.moveToBookmark(K)}function m(D){var K={};D.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function y(D,K){var G;if(K!==E){G=document.createElement("span");G.style.cssText=D;G=G.style.cssText||""}else G=D;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function k(D){if(D.c.Jd)return D.c.Jd;
var K=D.c.Jd={},G=D.c.definition.overrides;if(G){x.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],M,L;if(typeof H=="string")M=H.toLowerCase();else{M=H.element?H.element.toLowerCase():D.element;L=H.attributes}H=K[M]||(K[M]={});if(L){H=H.attributes=H.attributes||[];for(var R in L)H.push([R.toLowerCase(),L[R]])}}}return K}function a(D,K){var G=D.c.definition,F=J.mix(G.attributes,k(D)[K.d()]);G=G.styles;var H=x.isEmptyObject(F)&&x.isEmptyObject(G),M;for(M in F)if(!((M=="class"||D.c.definition.fullMatch)&&
K.attr(M)!=b(M,F[M]))){H=H||!!K.Lc(M);K.removeAttr(M)}for(var L in G)if(!(D.c.definition.fullMatch&&K.L(L)!=b(L,G[L],t))){H=H||!!K.L(L);K.L(L,"")}B(K)}function b(D,K,G){var F=new O("<span>");F[G?"_4e_style":"attr"](D,K);return F[G?"_4e_style":"attr"](D)}function f(D,K){for(var G=k(D),F=K.all(D.element),H=F.length;--H>=0;)a(D,new O(F[H]));for(var M in G)if(M!=D.element){F=K.all(M);for(H=F.length-1;H>=0;H--){var L=new O(F[H]);q(L,G[M])}}}function q(D,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],M;if(M=D.attr(H)){var L=G[F][1];if(L===n||L.test&&L.test(M)||typeof L=="string"&&M==L)D[0].removeAttribute(H)}}B(D)}function B(D){if(!D.$a()){var K=D[0].firstChild,G=D[0].lastChild;D.h(t);if(K){K.nodeType==v.e&&s.ra(K);G&&K!=G&&G.nodeType==v.e&&s.ra(G)}}}var t=T,E=X,n=U,x=KISSY,J=l.k,s=x.DOM,c={Fb:1,Ca:2,Ya:3},h=l.oa,p=l.Ic,v=l.n,o=l.Va,C=l.Range,O=x.Node,P=x.UA,N=l.Ua,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},S={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},W=/\s*(?:;\s*|$)/g,V=/#\((.+?)\)/g;l.ag=c;r.prototype={apply:function(D){I.call(this,D,E)},remove:function(D){I.call(this,D,t)},Rb:function(D){return(this.Rb=this.type==c.Ca?g:this.type==c.Fb?u:this.type==c.Ya?n:n).call(this,D)},tc:function(D){return(this.tc=this.type==c.Ca?d:n).call(this,D)},De:function(D){z(D,this)},ia:function(D,K){if(!D)return E;var G=this.c.definition;if(D.d()==this.element){if(!K&&!D.$a())return t;var F=G.le;if(F)G=F;else{F={};var H=0,M=G.attributes;
if(M)for(var L in M){H++;F[L]=M[L]}if(M=r.pd(G)){F.style||H++;F.style=M}F._length=H;G=G.le=F}if(G._length){for(var R in G)if(R!="_length"){H=D.attr(R)||"";if(R=="style")a:{F=G[R];H=y(H,E);typeof F=="string"&&(F=m(F));typeof H=="string"&&(H=m(H));M=void 0;for(M in F)if(!(M in H&&(H[M]==F[M]||F[M]=="inherit"||H[M]=="inherit"))){F=E;break a}F=t}else F=G[R]==H;if(F){if(!K)return t}else if(K)return E}if(K)return t}else return t}if(R=k(this)[D.d()]){if(!(G=R.attributes))return t;for(F=0;F<G.length;F++){R=
G[F][0];if(R=D.attr(R)){H=G[F][1];if(H===n||typeof H=="string"&&R==H||H.test&&H.test(R))return t}}}return E},Ke:function(D){switch(this.type){case c.Fb:return this.ia(D.z||D.F,t);case c.Ya:case c.Ca:for(var K=D.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.Ca&&(s.g(F,D.z)||s.g(F,D.F))))if(!(this.type==c.Ya&&!(F.d()in S)))if(this.ia(F,t))return t}}return E}};r.pd=function(D){var K=D.me;if(K)return K;K=D.styles;var G=D.attributes&&D.attributes.style||"",F="";if(G.length)G=G.replace(W,";");
for(var H in K){var M=K[H],L=(H+":"+M).replace(W,";");if(M=="inherit")F+=L;else G+=L}if(G.length)G=y(G);G+=F;return D.me=G};l.bg=r;l.Style=r;var Y=r.prototype;l.k.o(Y,{apply:Y.apply,remove:Y.remove,applyToRange:Y.Rb,removeFromRange:Y.tc,applyToObject:Y.De,checkElementRemovable:Y.ia,checkActive:Y.Ke})});
KISSY.Editor.add("htmlparser",function(){function l(){}function w(){this.c={sd:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var r=KISSY,I=r.Editor,A=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,z={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},u=I.m;r.augment(w,{ya:l,Id:l,ma:l,Ed:l,Na:l,parse:function(j){for(var i,
e,g=0,d;i=this.c.sd.exec(j);){e=i.index;if(e>g){g=j.substring(g,e);d?d.push(g):this.ma(g)}g=this.c.sd.lastIndex;if(e=i[1]){e=e.toLowerCase();if(d&&u.zc[e]){this.Ed(d.join(""));d=U}if(!d){this.Id(e);continue}}if(d)d.push(i[0]);else if(e=i[3]){e=e.toLowerCase();if(!/="/.test(e)){var m={},y;i=i[4];var k=!!(i&&i.charAt(i.length-1)=="/");if(i)for(;y=A.exec(i);){var a=y[1].toLowerCase();y=y[2]||y[3]||y[4]||"";m[a]=!y&&z[a]?a:y}this.ya(e,m,k);if(!d&&u.zc[e])d=[]}}else if(e=i[2])this.Na(e)}j.length>g&&this.ma(j.substring(g,
j.length))}});I.j=w;I.HtmlParser=w});
KISSY.Editor.add("htmlparser-basicwriter",function(){function l(){this.c={l:[]}}var w=KISSY,r=w.Editor,I=r.k;w.augment(l,{qb:function(A){this.c.l.push("<",A)},rb:function(A,z){z?this.c.l.push(" />"):this.c.l.push(">")},eb:function(A,z){if(typeof z=="string")z=I.jc(z);this.c.l.push(" ",A,'="',z,'"')},fb:function(A){this.c.l.push("</",A,">")},text:function(A){this.c.l.push(A)},N:function(A){this.c.l.push("<!--",A,"--\>")},write:function(A){this.c.l.push(A)},reset:function(){this.c.l=[];this.c.B=X},
ec:function(A){var z=this.c.l.join("");A&&this.reset();return z}});r.j.Ab=l;r.j.BasicWriter=l;w=l.prototype;r.k.o(w,{openTag:w.qb,openTagClose:w.rb,attribute:w.eb,closeTag:w.fb,text:w.text,comment:w.N,write:w.write,reset:w.reset,getHtml:w.ec})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function l(){l.superclass.constructor.call(this);this.ud="\t";this.wf=" />";this.nf="\n";this.Xe=z;this.xf=A;this.c.B=z;this.c.G="";this.c.rules={};var u=r.m,j;for(j in I.mix({},u.zb,u.Sa,u.yb,u.Dc))this.Aa(j,{B:A,He:A,Xb:A,$c:!u[j]["#"],Ge:A});this.Aa("br",{Xb:A});this.Aa("title",{B:z,Xb:z});this.Aa("style",{B:z,$c:A});this.Aa("pre",{B:z})}var w=KISSY,r=w.Editor,I=r.k,A=T,z=X;w.extend(l,r.j.Ab,{qb:function(u){var j=this.c.rules[u];if(this.c.B)this.G();
else if(j&&j.He){this.La();this.G()}this.c.l.push("<",u)},rb:function(u,j){var i=this.c.rules[u];if(j)this.c.l.push(this.wf);else{this.c.l.push(">");if(i&&i.B)this.c.G+=this.ud}i&&i.Xb&&this.La()},eb:function(u,j){if(typeof j=="string"){this.Xe&&(j=j.replace(/&amp;/g,"&"));j=I.jc(j)}this.c.l.push(" ",u,'="',j,'"')},fb:function(u){var j=this.c.rules[u];if(j&&j.B)this.c.G=this.c.G.substr(this.ud.length);if(this.c.B)this.G();else if(j&&j.$c){this.La();this.G()}this.c.l.push("</",u,">");j&&j.Ge&&this.La()},
text:function(u){if(this.c.B){this.G();u=I.Ma(u)}this.c.l.push(u)},N:function(u){this.c.B&&this.G();this.c.l.push("<!--",u,"--\>")},La:function(){this.c.l.length>0&&this.c.l.push(this.nf);this.c.B=A},G:function(){this.c.l.push(this.c.G);this.c.B=z},Aa:function(u,j){var i=this.c.rules[u];if(i)I.mix(i,j);else this.c.rules[u]=j}});r.j.Pf=l;r.j.HtmlWriter=l;w=l.prototype;r.k.o(w,{openTag:w.qb,openTagClose:w.rb,attribute:w.eb,closeTag:w.fb,text:w.text,comment:w.N,lineBreak:w.La,indentation:w.G,setRules:w.Aa})});
KISSY.Editor.add("htmlparser-fragment",function(){function l(){this.children=[];this.parent=I;this.c={R:w,ic:r}}var w=T,r=X,I=U,A=KISSY.Editor,z={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},u=KISSY,j=A.k,i=A.n,e=A.m,g=j.mix({table:1,ul:1,ol:1,dl:1},e.table,e.ul,e.ol,e.dl),d=e.Sd,m=e.yb;l.Db=function(y,k){function a(h){var p;if(t.length>0)for(var v=0;v<t.length;v++){var o=t[v],C=o.name,O=e[C],P=n.name&&e[n.name];if((!P||P[C])&&(!h||!O||O[h]||!e[h])){if(!p){b();p=1}o=o.clone();
o.parent=n;n=o;t.splice(v,1);v--}}}function b(){for(;E.length;)n.add(E.shift())}function f(h,p,v){p=p||n||B;if(k&&!p.type){var o,C;if((o=h.attributes&&(C=h.attributes._ke_real_element_type)?C:h.name)&&!(o in e.yc)&&!(o in e.zb)){o=n;n=p;q.ya(k,{});p=n;if(v)n=o}}if(h.c.R&&h.name!="pre"){v=h.children.length;if((o=h.children[v-1])&&o.type==i.f)if(C=j.Oa(o.value))o.value=C;else h.children.length=v-1}p.add(h);if(h.tb){n=h.tb;delete h.tb}}var q=new A.j,B=new l,t=[],E=[],n=B,x=r,J;q.ya=function(h,p,v){var o=
new A.j.Ec(h,p);if(o.lc&&v)o.mb=w;if(e.ba[h])t.push(o);else{if(h==="pre")x=w;else if(h==="br"&&x){n.add(new A.j.Gb("\n"));return}if(h==="br")E.push(o);else{var C=n.name,O=C&&(e[C]||(n.c.R?e.div:e.span));if(O&&!o.lc&&!n.lc&&!O[h]){O=r;var P;if(h in d&&C in d){C=n.children;(C=C[C.length-1])&&C.name in m||f(C=new A.j.Ec("li"),n);J=n;P=C}else if(h==C)f(n,n.parent);else{if(g[C])J||(J=n);else{f(n,n.parent,w);z[C]||t.unshift(n)}O=w}n=P?P:n.tb||n.parent;if(O){q.ya.apply(this,arguments);return}}a(h);b();o.parent=
n;o.tb=J;J=0;if(o.mb)f(o);else n=o}}};q.Id=function(h){for(var p=t.length-1;p>=0;p--)if(h==t[p].name){t.splice(p,1);return}for(var v=[],o=[],C=n;C.type&&C.name!=h;){C.c.R||o.unshift(C);v.push(C);C=C.parent}if(C.type){for(p=0;p<v.length;p++){var O=v[p];f(O,O.parent)}n=C;if(n.name=="pre")x=r;C.c.R&&b();f(C,C.parent);if(C==n)n=n.parent;t=t.concat(o)}if(h=="body")k=r};q.ma=function(h){if(!n.c.ic&&!x){h=j.Ma(h);if(h.length===0)return}b();a();if(k&&(!n.type||n.name=="body")&&j.trim(h))this.ya(k,{});x||
(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));n.add(new A.j.Gb(h))};q.Ed=function(){};q.Na=function(h){n.add(new A.j.Ud(h))};q.parse(y);for(b();n.type;){var s=n.parent,c=n;if(k&&(!s.type||s.name=="body")&&!e.yc[c.name]){n=s;q.ya(k,{});s=n}s.add(c);n=s}return B};u.augment(l,{add:function(y){var k=this.children.length;if(k=k>0&&this.children[k-1]||I){if(y.c.R&&k.type==i.f){k.value=j.Oa(k.value);if(k.value.length===0){this.children.pop();this.add(y);return}}k.next=y}y.sb=k;y.parent=this;this.children.push(y);
this.c.ic=y.type==i.f||y.type==i.e&&!y.c.R},aa:function(y,k){var a;this.filterChildren=this.cc=function(){var b=new A.j.Ab;this.V.call(this,b,k,w);b=b.ec();this.children=(new l.Db(b)).children;a=1};!this.name&&k&&k.Gd(this);this.V(y,a?I:k)},V:function(y,k){for(var a=0;a<this.children.length;a++)this.children[a].aa(y,k)}});A.j.Ba=l;A.j.Fragment=l;l.FromHtml=l.Db;u=l.prototype;A.k.o(u,{add:u.add,writeHtml:u.aa,writeChildrenHtml:u.V})});
KISSY.Editor.add("htmlparser-element",function(){function l(z,u){z=z[0];u=u[0];return z<u?-1:z>u?1:0}function w(z,u){this.name=z;this.attributes=u||(u={});this.children=[];var j=u.fg||z,i=r.m;j=!!(i.zb[j]||i.Sa[j]||i.yb[j]||i.Dc[j]||i.Cc[j]||j=="br");var e=!!i.xb[z];this.mb=e;this.lc=!i[z];this.c={R:j,ic:e||!j}}var r=KISSY.Editor,I=r.n;KISSY.augment(w,{type:I.e,add:r.j.Ba.prototype.add,clone:function(){return new w(this.name,this.attributes)},aa:function(z,u){var j=this.attributes,i=this,e=i.name,
g,d,m,y;i.cc=function(){if(!y){var b=new r.j.Ab;r.j.Ba.prototype.V.call(i,b,u);i.children=(new r.j.Ba.Db(b.ec())).children;y=1}};i.filterChildren=i.cc;if(u){for(;;){if(!(e=u.Fd(e)))return;i.name=e;if(!(i=u.oc(i)))return;i.parent=this.parent;if(i.name==e)break;if(i.type!=I.e){i.aa(z,u);return}e=i.name;if(!e){this.V.call(i,z,y?U:u);return}}j=i.attributes}z.qb(e,j);for(var k=[],a=0;a<2;a++)for(g in j){d=g;m=j[g];if(a==1)k.push([g,m]);else if(u){for(;;)if(d=u.Dd(g))if(d!=g){delete j[g];g=d}else break;
else{delete j[g];break}if(d)if((m=u.Cd(i,d,m))===X)delete j[d];else j[d]=m}}z.xf&&k.sort(l);j=k.length;for(a=0;a<j;a++){g=k[a];z.eb(g[0],g[1])}z.rb(e,i.mb);if(!i.mb){this.V.call(i,z,y?U:u);z.fb(e)}},V:function(){r.j.Ba.prototype.V.apply(this,arguments)}});r.j.Ec=w;r.j.Element=w;var A=w.prototype;r.k.o(A,{type:A.type,add:A.add,clone:A.clone,writeHtml:A.aa,writeChildrenHtml:A.V})});
KISSY.Editor.add("htmlparser-filter",function(){function l(g){this.c={$b:[],Tb:[],elements:{Bc:0},attributes:{Bc:0}};g&&this.Zc(g,10)}function w(g,d){for(var m=0;g&&m<d.length;m++){var y=d[m];g=g.replace(y[0],y[1])}return g}function r(g,d,m){if(typeof d=="function")d=[d];var y,k;k=g.length;var a=d&&d.length;if(a){for(y=0;y<k&&g[y].sc<m;y++);for(k=a-1;k>=0;k--)if(a=d[k]){a.sc=m;g.splice(y,0,a)}}}function I(g,d,m){if(d)for(var y in d){var k=g[y];g[y]=A(k,d[y],m);k||g.Bc++}}function A(g,d,m){if(d){d.sc=
m;if(g){if(g.splice)r(g,d,m);else{g=g.sc>m?[d,g]:[g,d];g.filter=z}return g}else return d.filter=d}}function z(g){for(var d=g.type||g instanceof j.j.Ba,m=0;m<this.length;m++){if(d)var y=g.type,k=g.name;var a=this[m].apply(window,arguments);if(a===e)return a;if(d){if(a&&(a.name!=k||a.type!=y))return a}else if(typeof a!="string")return a;a!=undefined&&(g=a)}return g}var u=KISSY,j=u.Editor,i=j.n,e=X;u.augment(l,{Zc:function(g,d){if(typeof d!="number")d=10;r(this.c.$b,g.$b,d);r(this.c.Tb,g.Tb,d);I(this.c.elements,
g.elements,d);I(this.c.attributes,g.attributes,d);this.c.text=A(this.c.text,g.text,d)||this.c.text;this.c.N=A(this.c.N,g.N,d)||this.c.N;this.c.ub=A(this.c.ub,g.ub,d)||this.c.ub},Fd:function(g){return w(g,this.c.$b)},Dd:function(g){return w(g,this.c.Tb)},ma:function(g){var d=this.c.text;return d?d.filter(g):g},Na:function(g,d){var m=this.c.N;return m?m.filter(g,d):g},Gd:function(g){var d=this.c.ub;return d?d.filter(g):g},oc:function(g){for(var d=[this.c.elements["^"],this.c.elements[g.name],this.c.elements.Gf],
m,y=0;y<3;y++)if(m=d[y]){m=m.filter(g,this);if(m===e)return U;if(m&&m!=g)return this.Hd(m);if(g.parent&&!g.name)break}return g},Hd:function(g){var d=g.type;return d==i.e?this.oc(g):d==i.f?new j.j.Gb(this.ma(g.value)):U},Cd:function(g,d,m){if(d=this.c.attributes[d]){g=d.filter(m,g,this);if(g===e)return e;if(typeof g!="undefined")return g}return m}});j.j.Of=l;u=l.prototype;j.k.o(u,{addRules:u.Zc,onElementName:u.Fd,onAttributeName:u.Dd,onText:u.ma,onComment:u.Na,onFragment:u.Gd,onElement:u.oc,onNode:u.Hd,
onAttribute:u.Cd});j.j.Filter=l});KISSY.Editor.add("htmlparser-text",function(){function l(A){this.value=A;this.c={R:I}}var w=KISSY,r=w.Editor,I=X;w.augment(l,{type:r.n.f,aa:function(A,z){var u=this.value;z&&!(u=z.ma(u,this))||A.text(u)}});r.j.Gb=l;r.j.Text=l});
KISSY.Editor.add("htmlparser-comment",function(){function l(I){this.value=I;this.c={R:X}}var w=KISSY.Editor,r=w.n;w.j.Ud=l;w.j.Comment=l;l.prototype={constructor:l,type:r.Xd,aa:function(I,A){var z=this.value;if(A){if(!(z=A.Na(z,this)))return;if(typeof z!="string"){z.parent=this.parent;z.aa(I,A);return}}I.N(z)}}});
KISSY.Editor.add("button",function(){var l=KISSY,w=l.Editor;if(w.ce)l.log("TripleButton attach twice","warn");else{l=l.UIBase.create([l.UIBase.Box],{tg:function(){var r=this,I=r.get("el");I.on("click",r.ne,r);I.on("mousedown",function(){r.get("state")=="off"&&I.addClass("ke-triplebutton-active")});I.on("mouseup mouseleave",function(){r.get("state")=="off"&&I.hasClass("ke-triplebutton-active")&&setTimeout(function(){I.removeClass("ke-triplebutton-active")},300)})},mg:function(){this.get("el").attr("title",
this.get("title"))},jg:function(r){var I=this.get("el");if(r!==undefined){I.html("<span class='ke-toolbar-item "+r+"'>");I.Ha()}},lg:function(r){var I=this.get("el");r!==undefined&&I.html(r)},kg:function(r){this["_"+r]()},gd:function(){this.we=this.get("state");this.set("state","disabled")},jd:function(){this.get("state")=="disabled"&&this.set("state",this.we)},ne:function(r){this.fire(this.get("state")+"Click",r);r.type=this.get("state")+"Click";this.fire("click",r);r.preventDefault()},vg:function(){this.set("state",
"on")},ug:function(){this.set("state","off")},hg:function(){var r=this.get("el");r.removeClass("ke-triplebutton-off ke-triplebutton-disabled");r.addClass("ke-triplebutton-on")},gg:function(){var r=this.get("el");r.removeClass("ke-triplebutton-on ke-triplebutton-disabled");r.addClass("ke-triplebutton-off")},dg:function(){var r=this.get("el");r.removeClass("ke-triplebutton-off ke-triplebutton-on");r.addClass("ke-triplebutton-disabled")}},{Td:{zf:{value:"off"},Ue:{value:"ke-triplebutton ke-triplebutton-off"},
Dg:{value:{hideFocus:T,tabIndex:-1}},Eg:{value:"a"},title:{},wg:{},text:{}}});l.Wf="on";l.Uf="off";l.Vd="disabled";l.Xf="ke-triplebutton-on";l.Vf="ke-triplebutton-off";l.Mf="ke-triplebutton-disabled";w.ce=l}});
KISSY.Editor.add("select",function(){function l(j){l.superclass.constructor.call(this,j);this.qe()}var w=KISSY,r=w.Node,I=w.Event,A=w.DOM,z=w.Editor;if(z.be)w.log("ke select attach more");else{l.Vd=0;l.Nf=1;var u=z.m;l.Td={Rg:{},ka:{},Ne:{},va:{},Bg:{},value:{},width:{},title:{},lf:{},align:{value:["l","b"]},Kg:{Wg:function(){for(var j=this.ka.parent();j;){var i=j.d();if(u[i]&&u[i].div)return j;j=j.parent()}return new r(document.body)}},zf:{value:1}};l.zg=function(j){for(var i=j.width(),e=[],g=j.all("option"),
d=0;d<g.length;d++){var m=g[d];e.push({name:A.html(m),value:A.attr(m,"value")})}return new l({width:i+"px",ka:j,lf:e,Ne:"ke-combox",value:j.val()})};w.extend(l,w.Base,{qe:function(){var j=this.get("container"),i=this.get("el"),e=new r("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),g=this.get("title")||"",
d=this.get("cls"),m=e.one(".ke-select-text"),y=e.one(".ke-select-text-inner");e.one(".ke-select-drop");this.get("value")!==undefined?y.html(this.Tc(this.get("value"))):y.html(g);m.css("width",this.get("width"));e.Ha();g&&e.attr("title",g);d&&e.addClass(d);if(i)i[0].parentNode.replaceChild(e[0],i[0]);else j&&e.appendTo(j);e.on("click",this.pe,this);this.ka=e;this.title=y;this.Uc=e.one("a.ke-select");z.k.zd(this,"_prepare","_real");this.on("afterValueChange",this.ze,this);this.on("afterStateChange",
this.ye,this)},Tc:function(j){var i=this.get("title")||"",e=this.get("items");if(this.get("showValue"))return j||i;for(var g=0;g<e.length;g++){var d=e[g];if(d.value==j){i=d.name;break}}return i},ze:function(j){this.title.html(this.Tc(j.ob))},Vc:function(j){j=j.ob;var i=this.Xc;i.html("");if(j)for(var e=0;e<j.length;e++){var g=j[e];(new r("<a class='ke-select-menu-item' href='#' data-value='"+g.value+"'>"+g.name+"</a>",g.qg)).appendTo(i).Ha()}this.Sb=i.all("a")},val:function(j){if(j!==undefined){this.set("value",
j);return this}else return this.get("value")},ve:function(){this.S.get("visible")&&this.ue()},re:function(){function j(k){k=new r(k.target);e.contains(k)||e.g(k)||m.hide()}var i=this,e=i.ka,g=i.get("popUpWidth"),d=i.Uc,m=new z.Yd({rg:T,Qg:i.get("menuContainer"),content:"<div>",Gg:X,Ue:"ke-menu",width:g?g:e.width(),zIndex:z.Ub(z.xc.$d),Hg:X}),y=i.get("items");g=m.get("contentEl").one("div");i.S=m;I.on(window,"resize",i.ve,i);i.get("title")&&(new r("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+
i.get("title")+"</div>")).appendTo(g);i.Xc=(new r("<div>")).appendTo(g);i.Vc({ob:y});m.on("show",function(){d.addClass("ke-select-active")});m.on("hide",function(){d.removeClass("ke-select-active")});I.on(document,"click",j);i.get("doc")&&I.on(i.get("doc"),"click",j);g.on("click",i.xe,i);i.Sb=i.Xc.all("a");I.on(g[0],"mouseenter",function(){i.Sb.removeClass("ke-menu-selected")});i.on("afterItemsChange",i.Vc,i);i.pf=g},ye:function(j){var i=this.ka;j.ob==1?i.removeClass("ke-select-disabled"):i.addClass("ke-select-disabled")},
jd:function(){this.set("state",1)},gd:function(){this.set("state",0)},xe:function(j){j.halt();var i=this.S,e=this.pf;if(j=(new r(j.target)).Jc(function(m){return e.contains(m)&&m.d()=="a"},T)){var g=this.get("value"),d=j.attr("data-value");this.set("value",d);this.fire("click",{ob:d,Mg:g,name:j.html()});i.hide()}},ue:function(){var j=this.ka,i=j.offset(),e=w.clone(i),g=this.S.get("el").height(),d=this.S.get("el").width(),m=A.scrollTop(),y=A.scrollLeft(),k=A.viewportHeight(),a=A.viewportWidth();a=
y+a-60;k=m+k;var b=i.top+(j.height()-2);j=i.left+j.width()-2;var f=this.get("align"),q=f[0];if(f[1]=="b"){i.top=b;if(i.top+g>k&&e.top-m>k-b)i.top=e.top-g}else{i.top=e.top-g;if(i.top<m&&e.top-m<k-b)i.top=b}if(q=="l"){if(i.left+d>a&&j-y>a-e.left)i.left=j-d}else{i.left=j-d;if(i.left<y&&j-y<a-e.left)i.left=e.left}this.S.set("xy",[i.left,i.top]);this.S.show()},pe:function(j){if(!this.mc){j.preventDefault();var i=this;j=i.ka;var e=i.get("value");if(!j.hasClass("ke-select-disabled"))if(i.Uc.hasClass("ke-select-active"))i.S&&
i.S.hide();else{i.mc=T;z.use("overlay",function(){i.mc=X;i.re();e&&i.S&&i.Sb.each(function(g){g.attr("data-value")==e?g.addClass("ke-menu-selected"):g.removeClass("ke-menu-selected")})})}}}});z.be=l}});
