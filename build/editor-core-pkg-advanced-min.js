/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-03 15:06:45
*/
var S=true,T=null,X=false;
KISSY.add("editor",function(q,B){function u(y,i){function a(w){for(var n=u.Env.mods,l=0;l<w.length;l++){for(var k=w[l],D=t,I=0;I<l;I++)if(k==w[I]){D=z;break}I=n[k];if(D&&I){D=q.clone(I);k=k+"_"+l;D.name=k;w[l]=k;n[k]||(n[k]=D)}}}var b=this;if(!(b instanceof u))return new u(y,i);if(q.isString(y))y=q.one(y);y=A.D(y);i=i||{};i.Je=i.pluginConfig||{};b.ha=i;i.pluginConfig=i.Je;b.cfg=i;q.app(b,q.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],j=t;b.use=function(w,n){w=w.split(",");a(w);
if(!j)for(var l=0;l<d.length;l++){var k=d[l];q.inArray(k,w)||w.unshift(k)}q.use.call(b,w.join(","),function(){b.ready(function(){n&&n.call(b);if(!j){b.setData(y.val());if(i.focus)b.focus();else{var D=b.getSelection();D&&D.removeAllRanges()}b.fire("save");j=z}})},{order:z,global:u});return b};b.use=b.use;b.Ae(y);return b}function J(y){var i=q.Config.debug;y=i?i==="dev"?"../src/"+y:y:y.replace(/\.(js|css)/i,"-min.$1");y+=y.indexOf("?")!=-1?"&":"?";y+="t="+encodeURIComponent("2010-12-03 15:06:45");return y}
var A=q.DOM,z=S,t=X;q.app(u,q.EventTarget);u.Config.base=q.Config.base+"editor/";var s=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],p,f,g,e,o={};p=0;for(f=s.length;p<f;p++){g=s[p];if(q.isString(g))g=s[p]={name:g+"",requires:T};e=g.requires||[];g.requires=e.concat(["button"])}s=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar",{name:"contextmenu"},{name:"bubbleview"},{name:"select"}].concat(s);
p=0;for(f=s.length;p<f;p++){g=s[p];e=g.name;o[e]={attach:t,charset:"utf-8",requires:g.requires,csspath:g.Pf?J("plugins/"+e+"/plugin.css"):B,path:J("plugins/"+e+"/plugin.js")}}u.add(o);q.Editor=u;q.Editor=u});
KISSY.Editor.add("utils",function(q){var B=T,u=KISSY,J=u.Node,A=u.DOM,z=u.UA,t=u.Event,s;if(z.ie)s=document.documentMode||z.ie;var p={Tc:function(f){var g=u.Config.debug;f=g?g==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-12-03 15:02:53");return f},Fe:function(f,g,e){var o=f[g],y=f[e];f[g]=function(){o.apply(this,arguments);f[g]=f[e];return y.apply(this,arguments)}},we:function(f,g,e,o){e=e.defaultView||e.parentWindow;f-=A.scrollLeft(e);
g-=A.scrollTop(e);if(o)if(e!=(o.defaultView||o.parentWindow)&&e.frameElement){o=A.Fb(e.frameElement,o);f+=o.left;g+=o.top}return{left:f,top:g}},Cd:function(){for(var f,g=0,e=arguments.length;g<e;g++){var o=arguments[g];try{f=o();break}catch(y){}}return f},be:function(f,g){if(!f&&!g)return S;if(!f||!g||f.length!=g.length)return X;for(var e=0;e<f.length;e++)if(f[e]!==g[e])return X;return S},Xc:function(f,g,e){f=f.documentElement;for(var o=0;f&&o<g.length;o++){var y=g[o];if(e)for(var i=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(e===S&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){i++;if(i==y){f=b;break}}}else f=f.childNodes[y]}return f?new J(f):B},je:function(f){for(var g in f)f[g].Bc(f,S)},cc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ka:function(f){return f.replace(/^\s+/,"")},Ma:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ka(this.Ma(f))},mix:function(){for(var f={},g=0;g<arguments.length;g++)f=u.mix(f,arguments[g]);
return f},hb:function(){if(!z.ie)return X;var f=document.domain,g=window.location.hostname;return f!=g&&f!="["+g+"]"},oe:function(f,g){return Array(g+1).join(f)},Se:function(f,g,e){e=e||150;if(e===-1)return function(){f.apply(g,arguments)};var o=(new Date).getTime();return function(){var y=(new Date).getTime();if(y-o>e){o=y;f.apply(g,arguments)}}},ee:function(f,g,e){e=e||0;var o=B;return function(){o&&clearTimeout(o);var y=arguments;o=setTimeout(function(){return f.apply(g,y)},e)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(u.trim(f))},
Ue:function(f){for(var g=0;g<f.length;g++){var e=A.D(f[g]),o=u.trim(e.val()),y=e.attr("data-verify");e=e.attr("data-warning");if(y&&!RegExp(y).test(o)){alert(e);return X}}return S},Qe:function(f,g){f.on("sourcemode",g.xf,g);f.on("wysiwygmode",g.Df,g)},Me:function(f){var g=f.attr("placeholder");if(g&&!z.webkit){f.addClass("ke-input-tip");f.val(g)}else z.webkit&&f.val("")},Qf:function(f,g){f.removeClass("ke-input-tip");f.val(g)},Ie:function(f,g){f.attr("placeholder",g);if(!z.webkit){f.on("blur",function(){if(!u.trim(f.val())){f.addClass("ke-input-tip");
f.val(g)}});f.on("focus",function(){f.removeClass("ke-input-tip");u.trim(f.val())==g&&f.val("")})}},he:function(f){f=f[0]||f;for(var g=u.makeArray(f.childNodes),e=0;e<g.length;e++){var o=g[e];o.nodeType==q.n.f&&!u.trim(o.nodeValue)&&f.removeChild(o)}},ze:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ye:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},qe:function(f,
g){return f.toLowerCase()==g.toLowerCase()},ld:function(f){f=u.clone(f);for(var g in f)if(f.hasOwnProperty(g)){var e=f[g];if(u.isFunction(e))f[g]=e()}return f},ne:function(f,g,e){function o(){var w={responseText:"",responseXML:B};w.ae=f?f.ae:B;try{var n;if((n=z.ie?i.contentWindow.document:i.contentDocument||window.frames[y].document)&&n.body)w.responseText=n.body.innerHTML;w.responseXML=n&&n.XMLDocument?n.XMLDocument:n}catch(l){u.log(l)}t.remove(i,"load",o);f.fe&&f.fe(w);setTimeout(function(){A.h(i)},
100)}var y=u.guid("form-upload-"),i=document.createElement("iframe");i.id=y;i.name=y;i.className="ke-hidden";var a="document.open();"+(p.hb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(z.ie)i.src=z.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";u.log("doFormUpload : "+i.src);document.body.appendChild(i);if(z.ie)document.frames[y].name=y;a=A.Jc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=y;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(e)a.action=e;var d;if(g){d=[];g=q.l.ld(g);for(var j in g)if(g.hasOwnProperty(j)){e=document.createElement("input");e.type="hidden";e.name=j;e.value=g[j];a.appendChild(e);d.push(e)}}t.on(i,"load",o);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(d){g=0;for(j=d.length;g<j;g++)A.h(d[g])}return i},o:function(f,g){for(var e in g)f[e]=g[e]},map:function(f,g){for(var e=0;e<f.length;e++)f[e]=
g(f[e]);return f},dc:s,Ke:function(f){z.ie?f.Ic():f.attr("onmousedown","return false;")},Ef:function(f){f=f.attributes;return f.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(f.src||"")}};q.l=p;q.Utils=p;p.o(p,{debugUrl:p.Tc,lazyRun:p.Fe,getXY:p.we,tryThese:p.Cd,arrayCompare:p.be,getByAddress:p.Xc,clearAllMarkers:p.je,htmlEncodeAttr:p.cc,ltrim:p.Ka,rtrim:p.Ma,trim:p.trim,mix:p.mix,isCustomDomain:p.hb,duplicateStr:p.oe,buffer:p.ee,isNumber:p.isNumber,verifyInputs:p.Ue,sourceDisable:p.Qe,
resetInput:p.Me,placeholder:p.Ie,clean:p.he,htmlEncode:p.ze,htmlDecode:p.ye,equalsIgnoreCase:p.qe,normParams:p.ld,throttle:p.Se,doFormUpload:p.ne,map:p.map})});
KISSY.Editor.add("dom",function(q){function B(a){if(a&&!a[0])return new s(a);return a}function u(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var A=KISSY,z=A.DOM,t=A.UA,s=A.Node,p=q.l,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};q.n={e:1,f:3,Hd:8,gf:11};q.NODE=q.n;q.Ta={ca:0,Id:1,ba:2,X:4,W:8,xc:16};q.POSITION=
q.Ta;var g=q.n,e=q.Ta,o={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},i={D:B,Jc:u,g:function(a,b){if(!a&&!b)return S;if(!a||!b)return X;a=u(a);b=u(b);return a===b},pa:function(a,b){a=B(a);var d=A.mix(A.mix({},y),b||{});return o[a.css("display")]||d[a.d()]},ea:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
X},v:function(a){a=u(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Md:function(a,b){a=u(a);var d=a.firstChild;if((d=d&&new s(d))&&b&&!b(d))d=d.Ca(b);return d},Gc:function(a,b,d){a=u(a);z.h(a);b=u(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(t.ie)if((a=a.Kf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Ec:function(a,b){if(a.d()!=b.d())return X;var d=a[0].attributes,j=b[0].attributes,w=d.length,
n=j.length;if(w!=n)return X;for(var l=0;l<w;l++){var k=d[l],D=k.name;if(k.specified&&a.attr(D)!=b.attr(D))return X}if(p.dc<8)for(l=0;l<n;l++){k=j[l];D=k.name;if(k.specified&&a.attr(D)!=b.attr(D))return X}return S},Gb:function(a){a=u(a).childNodes;for(var b=0,d=a.length;b<d;b++){var j=a[b],w=j.nodeType;if(!(w==g.e&&j.getAttribute("_ke_bookmark")))if(w==g.e&&!i.Gb(j)||w==g.f&&A.trim(j.nodeValue))return X}return S},Hb:function(a,b,d){a=u(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},qa:function(){function a(b,d,j){if(d[0]&&d[0].nodeType==g.e){for(var w=[];d.attr("_ke_bookmark")||d.Gb();){w.push(d);d=j?new s(d[0].nextSibling):new s(d[0].previousSibling);if(!d[0]||d[0].nodeType!=g.e)return}if(b.Ec(d)){for(var n=j?b[0].lastChild:b[0].firstChild;w.length;)w.shift().Gc(b,!j);d.Hb(b,!j);d.h();n[0]&&n[0].nodeType==g.e&&n.qa()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new s(b[0].nextSibling),S);
a(b,new s(b[0].previousSibling))}}}(),Ic:t.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:t.webkit?function(a){a=u(a);a.style.df="none"}:function(a){a=u(a);if(t.ie||t.opera){var b=0;a.unselectable="on";for(var d=a.getElementsByTagName("*");a=d[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.unselectable="on"}}},Fb:function(a,b){a=u(a);var d,j=0;d=0;var w=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,n=a.ownerDocument,
l=n.documentElement;b=b||n;if(a.getBoundingClientRect){if(a!==n.body&&l!==a){d=a.getBoundingClientRect();j=d.left+(b===n?z.scrollLeft(w):0);d=d.top+(b===n?z.scrollTop(w):0)}if(b)if(w!=(b.defaultView||b.parentWindow)&&w.frameElement){w=i.Fb(w.frameElement,b);j+=w.left;d+=w.top}}return{left:j,top:d}},Od:function(a){return(a=u(a))&&a.contentWindow.document},ga:function(a,b){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=g.f)){if(t.ie&&b==a.nodeValue.length){var j=d.createTextNode("");z.insertAfter(j,
a);return new s(j)}j=new s(a.splitText(b));if(d.documentMode){d=d.createTextNode("");z.insertAfter(d,j[0]);z.h(d)}return j}},Ib:function(a,b){a=B(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=u(a);a=a.cloneNode(b);if(!d){var j=function(w){if(w.nodeType==g.e){w.removeAttribute("id");w=w.childNodes;for(var n=0;n<w.length;n++)j(w[n])}};j(a)}return new s(a)},w:function(a,b,d,j){a=u(a);if(j&&!j.call){var w=j[0]||j;j=function(l){l=l[0]||l;return l!==w}}b=!b&&
a.firstChild;var n=new s(a);if(!b){if(a.nodeType==g.e&&j&&j(a,S)===X)return T;b=a.nextSibling}for(;!b&&(n=n.parent());){if(j&&j(n,S)===X)return T;b=n[0].nextSibling}if(!b)return T;b=z.D(b);if(j&&j(b)===X)return T;if(d&&d!=b[0].nodeType)return b.w(X,d,j);return b},fa:function(a,b,d,j){a=u(a);if(j&&!j.call){var w=j[0]||j;j=function(l){l=l[0]||l;return l!==w}}b=!b&&a.lastChild;var n=new s(a);if(!b){if(a.nodeType==g.e&&j&&j(a,S)===X)return T;b=a.previousSibling}for(;!b&&(n=n.parent());){if(j&&j(n,S)===
X)return T;b=n[0].previousSibling}if(!b)return T;b=z.D(b);if(j&&j(b)===X)return T;if(d&&b[0].nodeType!=d)return b.fa(X,d,j);return b},Eb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=g.f&&b.contains(a))return b;var d=a[0].nodeType==g.f?a.parent():a;do if(d[0].nodeType!=g.f&&d.contains(b))return d;while(d=d.parent());return T},Kd:function(a,b,d){a=u(a);if(!d)a=a.parentNode;if(b&&!A.isFunction(b)){var j=b;b=function(w){return w.d()==j}}for(;a&&a.nodeType!=9;){if(!b||b(new s(a))===S)return new s(a);
a=a.parentNode}return T},Cc:p.dc<9?function(a,b){a=u(a);var d=a.attributes[b];return!!(d&&d.specified)}:function(a,b){a=u(a);return a.hasAttribute(b)},Ya:p.dc<9?function(a){a=u(a);for(var b=a.attributes,d=0;d<b.length;d++){var j=b[d];switch(j.name){case "class":if(a.getAttribute("class"))return S;break;default:if(j.specified)return S}}return X}:function(a){a=u(a);t.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Da:function(a,b){var d=u(a),j=u(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(j);
if(d==j)return e.ca;if(d.nodeType==g.e&&j.nodeType==g.e){if(d.contains){if(d.contains(j))return e.xc+e.X;if(j.contains(d))return e.W+e.ba}if("sourceIndex"in d)return d.sourceIndex<0||j.sourceIndex<0?e.Id:d.sourceIndex<j.sourceIndex?e.X:e.ba}d=a.Ba();j=b.Ba();for(var w=Math.min(d.length,j.length),n=0;n<=w-1;n++)if(d[n]!=j[n]){if(n<w)return d[n]<j[n]?e.X:e.ba;break}return d.length<j.length?e.xc+e.X:e.W+e.ba},Ba:function(a,b){a=u(a);for(var d=[],j=a.ownerDocument.documentElement,w=a;w&&w!=j;){var n=
w.parentNode,l=-1;if(n){for(var k=0;k<n.childNodes.length;k++){var D=n.childNodes[k];if(!(b&&D.nodeType==3&&D.previousSibling&&D.previousSibling.nodeType==3)){l++;if(D==w)break}}d.unshift(l)}w=n}return d},Db:function(a,b){var d=new q.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var j=d.extractContents();d.insertNode(a.h());a[0].parentNode.insertBefore(j,a[0].nextSibling)},L:function(a,b,d){a=B(a);if(d!==undefined)return a.css(b,d);a=u(a);return a.style[J(b)]},h:function(a,b){var d=
u(a),j=d.parentNode;if(j){if(b)for(var w;w=d.firstChild;)j.insertBefore(d.removeChild(w),d);j.removeChild(d)}return a},$a:function(a){z.Fc(a);z.Hc(a)},Fc:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==g.f){var d=p.Ka(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<j){(new s(b)).ga(j-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Hc:function(a){a=u(a);for(var b;b=a.lastChild;){if(b.type==g.f){var d=p.Ma(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<
j){(new s(b)).ga(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!t.ie&&!t.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Cb:function(a){a=u(a);for(var b=a.lastChild;b&&b.nodeType==g.f&&!A.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==g.f||z.d(b)!=="br"){b=t.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");t.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},ra:function(a,
b){var d=u(a),j;do j=(d=d.previousSibling)&&new s(d);while(j&&b&&!b(j));return j},Qd:function(a,b){a=z.D(a);var d=a[0].lastChild;if((d=d&&new s(d))&&b&&!b(d))d=d.ra(b);return d},Ca:function(a,b){var d=u(a),j;do j=(d=d.nextSibling)&&new s(d);while(j&&b&&!b(j));return j},Za:function(a){a=u(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(S));return b.innerHTML},Rd:function(a,b,d,j){a=z.D(a);var w=a.data("list_marker_id")||
a.data("list_marker_id",A.guid()).data("list_marker_id"),n=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[w]=a;n[d]=1;return a.data(d,j)},Bc:function(a,b,d){a=B(a);var j=a.data("list_marker_names"),w=a.data("list_marker_id"),n;for(n in j)a.removeData(n);a.removeData("list_marker_names");if(d){a.removeData("list_marker_id");delete b[w]}},Ld:function(a,b,d){a=u(a);b=B(b);var j=a.attributes;d=d||{};for(var w=0;w<j.length;w++){var n=j[w],l=n.name.toLowerCase(),
k;if(!(l in d))if(l=="checked"&&(k=z.attr(a,l)))b.attr(l,k);else if(n.specified||t.ie&&n.value&&l=="value"){k=z.attr(a,l);if(k===T)k=n.nodeValue;b.attr(l,k)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Dc:function(a){a=z.d(a);var b=q.m;return(a=!b.uc[a]&&(b[a]||b.span))&&a["#"]},Jb:function(a){a=B(a);var b=a[0].ownerDocument,d=z.scrollLeft(b),j=z.scrollTop(b),w=a.offset(),n=w.left;w=w.top;if(z.viewportHeight(b)+j<w||w<j||z.viewportWidth(b)+d<n||n<d)a.scrollIntoView(b)},Nd:function(a,
b,d){a=u(a);if(!t.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new s(a[b]));return d}};A.DOM.Pd=function(a){A.mix(z,a);for(var b in a)a.hasOwnProperty(b)&&function(d){s.prototype[d]=function(){var j=[].slice.call(arguments,0);j.unshift(this);return a[d].apply(T,j)}}(b)};p.o(i,{_4e_wrap:i.D,_4e_unwrap:i.Jc,_4e_equals:i.g,_4e_isBlockBoundary:i.pa,_4e_getWin:i.ea,_4e_index:i.v,_4e_first:i.Md,_4e_move:i.Gc,_4e_name:i.d,_4e_isIdentical:i.Ec,_4e_isEmptyInlineRemoveable:i.Gb,
_4e_moveChildren:i.Hb,_4e_mergeSiblings:i.qa,_4e_unselectable:i.Ic,_4e_getOffset:i.Fb,_4e_getFrameDocument:i.Od,_4e_splitText:i.ga,_4e_parents:i.Ib,_4e_clone:i.K,_4e_nextSourceNode:i.w,_4e_previousSourceNode:i.fa,_4e_commonAncestor:i.Eb,_4e_ascendant:i.Kd,_4e_hasAttribute:i.Cc,_4e_hasAttributes:i.Ya,_4e_position:i.Da,_4e_address:i.Ba,_4e_breakParent:i.Db,_4e_style:i.L,_4e_remove:i.h,_4e_trim:i.$a,_4e_ltrim:i.Fc,_4e_rtrim:i.Hc,_4e_appendBogus:i.Cb,_4e_last:i.Qd,_4e_previous:i.ra,_4e_next:i.Ca,_4e_outerHtml:i.Za,
_4e_setMarker:i.Rd,_4e_clearMarkers:i.Bc,_4e_getUniqueId:i.pf,_4e_copyAttributes:i.Ld,_4e_isEditable:i.Dc,_4e_scrollIntoView:i.Jb,_4e_getElementsByTagName:i.Nd});z.Pd(i)});
KISSY.Editor.add("focusmanager",function(q){function B(){this.ec=f;s=this;J.log(this.Ea+" focus")}function u(){this.ec=g;s=e;J.log(this.Ea+" blur")}var J=KISSY,A=J.DOM,z=J.Event,t={},s,p={If:function(){for(var o in t){var y=t[o];y.document.designMode="off";y.document.designMode="on"}},wf:function(){return s},te:function(o){return t[o]},add:function(o){var y=A.ea(o.document);z.on(y,"focus",B,o);z.on(y,"blur",u,o)},Le:function(o){t[o.Ea]=o},remove:function(o){delete t[o.Ea];var y=A.ea(o.document);z.remove(y,
"focus",B,o);z.remove(y,"blur",u,o)}},f=S,g=X,e=T;q.re=p;q.focusManager=p;q.$c=function(){return t};q.getInstances=q.$c});
KISSY.Editor.add("definition",function(q){var B=S,u=X,J=q.l,A=document,z=KISSY,t=z.UA,s=z.DOM,p=z.Node,f=z.Event,g=q.re,e=J.Cd,o=J.Tc("theme/editor-iframe.css"),y=1,i="document.open();"+(J.hb()?'document.domain="'+A.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(t.ie?"javascript:void(function(){"+encodeURIComponent(i)+"}())":"")+'"  tabIndex="'+(t.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";q.zc=0;q.Xa=1;q.SOURCE_MODE=q.zc;q.WYSIWYG_MODE=q.Xa;z.augment(q,{Ae:function(b){if(t.ie)s.addClass(A.body,"ie"+t.ie);else if(t.gecko)s.addClass(A.body,"gecko");else t.webkit&&s.addClass(A.body,"webkit");var d=this,j=new p(a.replace(/\$\(tabIndex\)/,b.attr("tabIndex")));d.Bf=j;
d.Ea=y++;g.Le(d);d.rb=j.one(".ke-textarea-wrap");d.wrap=d.rb;d.gb=d.rb.one("iframe");d.iframe=d.gb;d.Bd=j.one(".ke-editor-tools");d.toolBarDiv=d.Bd;d.Z=b;d.textarea=d.Z;d.Re=j.one(".ke-editor-status");d.statusDiv=d.Re;J.Ke(d.Bd);d.Kb={};d.Kc={};var w=b.L("width"),n=b.L("height");if(w){j.css("width",w);b.css("width","100%")}d.Z.css("display","none");j.insertAfter(b);d.rb[0].appendChild(b[0]);if(n){d.rb.css("height",n);b.css("height","100%")}j=d.gb;d.on("dataReady",function(){d.Wd=B;q.fire("instanceCreated",
{pe:d})});t.gecko?j.on("load",d.Mc,d):d.Mc();d.ha.vf&&b[0].form&&d.Ud()},Ud:function(){(new p(this.Z[0].form)).on("submit",this.Ad,this)},Te:function(b,d){var j=this,w=q.jf;w.Ff();j.use(b,function(){var n=j.Yc(b);if(n){d(n);w.Of()}else z.later(arguments.callee,50,X,j)})},Zd:function(b,d){this.Kc[b]=d},Yc:function(b){return this.Kc[b]},Xd:function(b,d){this.Kb[b]=d},xe:function(b){return this.Kb[b]},execCommand:function(b){var d=this.Kb[b],j=z.makeArray(arguments);j.shift();j.unshift(this);return d.exec.apply(d,
j)},Yb:function(){return this.Z.css("display")=="none"?q.Xa:q.zc},getData:function(b){var d;d=this.Yb()==q.Xa?this.document.body.innerHTML:this.Z.val();if(this.htmlDataProcessor)d=b?this.htmlDataProcessor.toHtml(d,"p"):this.htmlDataProcessor.toServer(d,"p");d=z.trim(d);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(d))d="";return d},setData:function(b){var d=b;if(this.htmlDataProcessor)d=this.htmlDataProcessor.toDataFormat(b,"p");this.document.body.innerHTML=d;this.Yb()!=q.Xa&&this.Z.val(b)},Ad:function(){this.Z.val(this.getData())},
Fa:function(b){b=b||0;return b+(this.ha.Fa||0)},qf:function(){return this.document.body.innerHTML},sf:function(b){this.document.body.innerHTML=b},Vd:function(b){var d=this.ha,j=d.ta,w="";if(j)for(var n=0;n<j.length;n++)w+='<link href="'+j[n]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+q.Config.base+o+"' rel='stylesheet'/><style>"+(d.Rb||"")+"</style>"+w+"</head><body class='ke-editor'>&nbsp;"+(b?'<script id="ke_actscript" type="text/javascript">'+
(J.hb()?'document.domain="'+A.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':"")+"</body></html>"},getSelection:function(){return q.Ac.getSelection(this.document)},focus:function(){var b=this.document,d=s.ea(b);t.webkit&&d&&d.parent&&d.parent.focus();d&&d.focus();b&&b.body.focus();this.kb()},blur:function(){s.ea(this.document).blur();this.document&&this.document.body.blur()},Yd:function(b){var d=this.ha,j=this.document;d.Rb=d.Rb||"";d.Rb+="\n"+b;d=j.createElement("style");
j.getElementsByTagName("head")[0].appendChild(d);if(d.styleSheet)d.styleSheet.cssText=b;else d.appendChild(j.createTextNode(b))},uf:function(b){var d=this.ha,j=this.document;d.ta=d.ta||[];d.ta.push(b);d=j.createElement("link");d.rel="stylesheet";j.getElementsByTagName("head")[0].appendChild(d);d.href=b},Jf:function(b){for(var d=this.ha,j=z.makeArray(this.document.getElementsByTagName("link")),w=0;w<j.length;w++)j[w].href==b&&s.h(j[w]);d.ta=d.ta||[];d=d.ta;b=z.indexOf(b,d);b!=-1&&d.splice(b,1)},Mc:function(){function b(){l=
n.document;d.document=l;j.detach();l.open("text/html","replace");l.write(w);l.close()}var d=this,j=d.gb,w=d.Vd(d.Ea),n=j[0].contentWindow,l;try{l=n.document}catch(k){j[0].src=j[0].src;if(t.ie<7){setTimeout(b,10);return}}b()},ready:function(b){this.Wd?b():this.on("dataReady",b)},ab:function(){var b=this;b.Lc&&clearTimeout(b.Lc);b.Lc=setTimeout(function(){var d=b.getSelection();if(d&&!d.hd){var j=d.$b(),w=new q.Sa(j);if(!b.kc||!b.kc.Rc(w)){b.kc=w;b.fire("selectionChange",{selection:d,path:w,element:j})}}},
100)},kb:function(){this.kc=T;this.ab()},gd:function(b,d){var j=this;j.focus();var w=b.d(),n=q.m,l=q.na,k=q.n,D=n.Qa[w],I=j.getSelection(),x=I&&I.A(),c,h,r,v,m;if(!x||x.length==0){var C=arguments,P=C.callee;setTimeout(function(){P.apply(j,C)},30)}else{j.fire("save");for(var M=x.length-1;M>=0;M--){c=x[M];c.deleteContents();h=!M&&b||b.K(B);d&&d(h);if(D)for(;(v=c.ua(u,B))&&(m=n[v.d()])&&!(m&&m[w]);)if(v.d()in n.span)c.pc(v);else if(c.sa()&&c.ja()){c.setStartBefore(v);c.collapse(B);v.h()}else c.oc();
c.insertNode(h);r||(r=h)}if(r){w=r.w(B);n=j.document;m=q.m;if(m.sc[h.d()]){w=new p(n.createTextNode(" "));w.insertAfter(r)}else if(w){if(w.d()=="br"&&m[w.parent().d()].p){m=new p("<p>&nbsp;</p>",T,n);w[0].parentNode.replaceChild(m[0],w[0]);w=m}}else{m=new p("<p>&nbsp;</p>",T,n);m.insertAfter(r);w=m}c.H(r,l.t);w&&w[0].nodeType==k.e&&c.jb(w);I.qb([c]);j.focus();h&&h.Jb();setTimeout(function(){j.fire("save")},10);return h}}},Be:function(b){var d=this;if(d.htmlDataProcessor)b=d.htmlDataProcessor.toDataFormat(b);
if(t.webkit){var j=s.create(b,T,this.document);j=j.nodeType==11?z.makeArray(j.childNodes):[j];for(var w=0;w<j.length;w++)d.gd(new p(j[w]))}else{d.focus();w=(j=d.getSelection())&&j.A();if(!w||w.length==0){var n=arguments,l=n.callee;setTimeout(function(){l.apply(d,n)},30)}else{d.fire("save");if(t.ie){j=j.r();j.type=="Control"&&j.clear();j.createRange().pasteHTML(b)}else d.document.execCommand("inserthtml",u,b);d.focus();setTimeout(function(){d.fire("save")},10)}}}});q._initIFrame=function(b){function d(c){e(function(){n.designMode=
"on";setTimeout(function(){n.designMode="off";k.focus();if(!arguments.callee.Ne)arguments.callee.Ne=B},50)},function(){n.designMode="off";s.attr(k,"contentEditable",u);s.attr(k,"contentEditable",B);!c&&d(1)})}var j=g.te(b);b=j.Z[0];var w=j.gb[0].contentWindow,n=j.document,l=j.ha;s.h(n.getElementById("ke_actscript"));var k=n.body;if(t.ie){k.hideFocus=B;k.disabled=B;k.contentEditable=B;k.removeAttribute("disabled")}else setTimeout(function(){if(t.gecko||t.opera)k.contentEditable=B;else if(t.webkit)k.parentNode.contentEditable=
B;else n.designMode="on"},0);if(t.webkit){f.on(n,"click",function(c){var h=new p(c.target);z.inArray(h.d(),["input","select"])&&c.preventDefault()});f.on(n,"mouseup",function(c){var h=new p(c.target);z.inArray(h.d(),["input","textarea"])&&c.preventDefault()})}if(t.gecko||t.ie||t.opera){var D;D=new p(s.insertAfter((new p('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],b));D.on("focus",function(){j.focus()});j.tf=function(){t.gecko&&j.ec&&D[0].focus()};
j.on("destroy",function(){})}if(t.ie&&n.compatMode=="CSS1Compat"||t.gecko||t.opera){var I=new p(n.documentElement);I.on("mousedown",function(c){if((new p(c.target))[0]==I[0]){t.gecko&&d(u);D[0].focus()}})}f.on(w,"focus",function(){if(t.gecko)d(u);else t.opera&&k.focus();j.kb()});t.gecko&&f.on(j.document,"mousedown",function(){j.ec||d(u)});if(t.ie){f.on(n,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var h=j.getSelection(),r=h.Zb();if(r){j.fire("save");var v=h.A()[0].O();r.h();h.wd([v]);j.fire("save");
c.preventDefault()}}});if(n.compatMode=="CSS1Compat"){var x={33:1,34:1};f.on(n,"keydown",function(c){c.keyCode in x&&setTimeout(function(){j.getSelection().scrollIntoView()},0)})}}setTimeout(function(){t.ie&&setTimeout(function(){if(n){k.runtimeStyle.marginBottom="0px";k.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){j.fire("dataReady");var c=l.zf,h=l.yf;if(c||h)try{n.execCommand("enableObjectResizing",u,!c);n.execCommand("enableInlineTableEditing",u,!h)}catch(r){f.on(k,t.ie?"resizestart":
"resize",function(v){var m=new p(v.target);if(c||m.d()==="table"&&h)v.preventDefault()})}},10);t.webkit&&f.on(n,"mousedown",function(c){c=new p(c.target);z.inArray(c.d(),["img","hr","input","textarea","select"])&&j.getSelection().nc(c)});t.gecko&&f.on(n,"dragstart",function(c){var h=new p(c.target);h.d()==="img"&&/ke_/.test(h[0].className)&&c.preventDefault()});g.add(j)};i=q.prototype;J.o(i,{setData:i.setData,getData:i.getData,insertElement:i.gd,insertHtml:i.Be,ready:i.ready,addCustomStyle:i.Yd,addCommand:i.Xd,
hasCommand:i.xe,execCommand:i.execCommand,useDialog:i.Te,addDialog:i.Zd,getDialog:i.Yc,getMode:i.Yb,sync:i.Ad,baseZIndex:i.Fa,getSelection:i.getSelection,focus:i.focus,blur:i.blur,notifySelectionChange:i.kb})});
KISSY.Editor.add("zindex",function(){var q=KISSY.Editor;if(!q.Dd){q.Dd={$e:1100,kf:1200,af:99999,ff:900,hf:9999,LOADING:11E3,ef:12E3,lf:1200};q.Fa=function(B){var u=B,J=q.$c(),A;for(A in J){if(!J.hasOwnProperty(A))return;u=Math.max(u,J[A].Fa(B))}return u};q.baseZIndex=q.Fa;q.zIndexManager=q.Dd}});
KISSY.Editor.add("dtd",function(q){q.m=function(){function B(l){for(var k=arguments.length-1;k>0;)KISSY.mix(l,arguments[k--]);return l}var u={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},A=B({a:1},J),z=B({iframe:1},A),t={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},s={ins:1,del:1,script:1,style:1},p=B({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},s),f=B({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},p),g=B({p:1},f);J=B({iframe:1},f,J);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=B({a:1},J),o={tr:1},y={"#":1},i=B({param:1},f),a=B({form:1},u,z,t,g),b={li:1},d={base:1,link:1,meta:1,title:1},j=B(d,{style:1,script:1}),w={head:1,body:1},n={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{ub:B({html:1},w,d),Qa:n,Ye:{body:1,div:1,td:1,th:1,caption:1,
form:1},sc:e,qc:B({script:1,style:1},n),rc:{script:1,style:1},sb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},tb:{dd:1,dt:1,li:1},Ed:{ul:1,ol:1,dl:1},uc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},aa:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},Ze:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},vc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:w,head:j,style:y,body:a,base:{},link:{},meta:{},title:y,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:B(g,t),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:b,h1:e,h3:e,option:y,h2:e,form:B(u,z,t,g),select:{optgroup:1,option:1},font:e,ins:e,menu:b,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:y,tfoot:o,cite:e,li:a,input:{},iframe:a,
strong:e,textarea:y,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:i,sup:e,dd:a,strike:e,area:{},dir:b,map:B({area:1,form:1,p:1},u,s,t),applet:i,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:B({legend:1},f),thead:o,ul:b,acronym:e,b:e,a:J,blockquote:a,caption:e,i:e,u:e,tbody:o,s:e,address:B(z,g),tt:e,legend:e,q:e,pre:B(p,A),p:e,em:e,dfn:e}}();q.XHTML_DTD=q.m});
KISSY.Editor.add("elementpath",function(q){function B(f){var g=z,e=z,o=[];for(f=f;f&&f[0];){if(f[0].nodeType==A.e){if(!this.Ee)this.Ee=f;var y=f.d();if(!e){if(!g&&t[y])g=f;if(s[y]){var i;if(i=!g){if(i=y=="div"){a:{i=f;i=i[0]||i;i=i.childNodes;for(var a=0,b=i.length;a<b;a++){var d=i[a];if(d.nodeType==A.e&&J.Qa[d.nodeName.toLowerCase()]){i=S;break a}}i=X}i=!i}i=i}if(i)g=f;else e=f}}o.push(f);if(y=="body")break}f=f.parent()}this.block=this.z=g;this.blockLimit=this.F=e;this.elements=this.elements=o}var u=
KISSY.DOM,J=q.m,A=q.n,z=T,t={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},s={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};B.prototype={Rc:function(f){var g=this.elements;f=f&&f.elements;if(!f||g.length!=f.length)return X;for(var e=0;e<g.length;e++)if(!u.g(g[e],f[e]))return X;return S},contains:function(f){for(var g=this.elements,e=0;e<g.length;e++)if(g[e].d()in f)return g[e];return z}};q.ElementPath=q.Sa=B;var p=B.prototype;q.l.o(p,{compare:p.Rc,
contains:p.contains})});
KISSY.Editor.add("walker",function(q){function B(o,y){if(this.c.end)return t;var i,a=this.wa,b,d=this.ac,j=this.type,w=o?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return t}}if(!o&&!this.c.bd){var n=a.endContainer,l=new g(n[0].childNodes[a.endOffset]);this.c.bd=function(x,c){return(x=f.D(x))&&x[0]&&(!c||!f.g(n,x))&&(!l[0]||!x.g(l))&&(x[0].nodeType!=p.e||!c||x.d()!="body")}}if(o&&!this.c.cd){var k=a.startContainer,D=a.startOffset>
0&&new g(k[0].childNodes[a.startOffset-1]);this.c.cd=function(x,c){return(x=f.D(x))&&x[0]&&(!c||!x.g(k))&&(!D[0]||!x.g(D))&&(x[0].nodeType!=p.e||!c||x.d()!="body")}}var I=o?this.c.cd:this.c.bd;b=d?function(x,c){if(I(x,c)===z)return z;return d(x,c)}:I;if(this.db)i=this.db[w](z,j,b);else if(o){i=a.endContainer;if(a.endOffset>0){i=new g(i[0].childNodes[a.endOffset-1]);if(b(i)===z)i=t}else i=b(i,A)===z?t:i.fa(A,j,b)}else{i=a.startContainer;if((i=new g(i[0].childNodes[a.startOffset]))&&i[0]){if(b(i)===
z)i=t}else i=b(a.startContainer,A)===z?t:a.startContainer.w(A,j,b)}for(;i&&i[0]&&!this.c.end;){this.db=i;if(!this.Q||this.Q(i)!==z){if(!y)return i}else if(y&&this.Q)return z;i=i[w](z,j,b)}this.end();return this.db=t}function u(o){for(var y,i=t;y=B.call(this,o);)i=y;return i}function J(o){this.wa=o;this.c={}}var A=S,z=X,t=T,s=KISSY,p=q.n,f=s.DOM,g=s.Node;s.augment(J,{end:function(){this.c.end=1},next:function(){return B.call(this)},nb:function(){return B.call(this,A)},Qc:function(){return B.call(this,
z,A)!==z},Pc:function(){return B.call(this,A,A)!==z},kd:function(){return u.call(this)},jd:function(){return u.call(this,A)},reset:function(){delete this.db;this.c={}}});J.Nb=function(o){return function(y){y=f.D(y);return!(y&&y[0].nodeType==p.e&&y.pa(o))}};J.He=function(){return this.Nb({Ob:1})};J.Ga=function(o,y){function i(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,d;b=a&&a[0]&&a[0].nodeType==p.f&&(d=a.parent())&&i(d);b=o?b:b||i(a);return y^b}};J.Pa=function(o){return function(y){y=
(y=y[0]||y)&&y.nodeType==p.f&&!s.trim(y.nodeValue);return o^y}};J.Ce=function(o){var y=J.Pa();return function(i){i=y(i)||i[0].nodeType==p.e&&!i[0].offsetHeight;return o^i}};q.Aa=J;q.Walker=J;var e=J.prototype;q.l.o(e,{end:e.end,next:e.next,previous:e.nb,checkForward:e.Qc,checkBackward:e.Pc,lastForward:e.kd,lastBackward:e.jd,reset:e.reset});q.l.o(J,{blockBoundary:J.Nb,listItemBoundary:J.He,bookmark:J.Ga,whitespaces:J.Pa,invisible:J.Ce})});
KISSY.Editor.add("range",function(q){function B(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=s;this.document=c}function u(c){var h=c[0].nodeType!=e.f&&c.d()in j.aa,r=!g.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||r||c}function J(c){return!D(c)&&!I(c)}function A(c){var h=p,r=i.Ga(s);return function(v){if(r(v))return s;if(v[0].nodeType==e.f){if(g.trim(v[0].nodeValue).length)return p}else if(v[0].nodeType==e.e)if(!k[v.d()])if(!c&&!d.ie&&
v.d()=="br"&&!h)h=s;else return p;return s}}function z(c,h){function r(v){return v&&v.nodeName=="span"&&v.getAttribute("_ke_bookmark")}return function(v){var m,C;m=v&&!v.nodeName&&(C=v.parentNode)&&r(C);m=c?m:m||r(v);return h^m}}function t(c){return function(h){h=(h=h[0]||h)&&h.nodeType==e.f&&!g.trim(h.nodeValue);return c^h}}q.na={V:1,J:2,C:3,t:4,xb:1,wb:2,Ra:3,Va:1,Gd:2,mf:3,da:1,yc:2};q.RANGE=q.na;var s=S,p=X,f=T,g=KISSY,e=q.n,o=q.na,y=q.Ta,i=q.Aa,a=g.DOM,b=q.l.Xc,d=g.UA,j=q.m,w=q.Sa,n=g.Node,l=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};B.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};g.augment(B,{Oa:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},ic:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},jc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.T(c,o.C);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.S(h,o.t)},setStart:function(c,h){if(c[0].nodeType==e.e&&l[c.d()]){c=c.parent();h=c.v()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Oa()},setEnd:function(c,h){if(c[0].nodeType==e.e&&l[c.d()]){c=c.parent();h=c.v()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Oa()},T:function(c,h){switch(h){case o.V:this.setStart(c,0);break;case o.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case o.C:this.setStartBefore(c);break;case o.t:this.setStartAfter(c)}this.Oa()},S:function(c,h){switch(h){case o.V:this.setEnd(c,0);break;case o.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case o.C:this.setEndBefore(c);break;case o.t:this.setEndAfter(c)}this.Oa()},
Ub:function(c,h){var r=this.startContainer,v=this.endContainer,m=this.startOffset,C=this.endOffset,P,M=this.document,O;this.jc();if(v[0].nodeType==e.f)v=v.ga(C);else if(v[0].childNodes.length>0)if(C>=v[0].childNodes.length){v=new n(v[0].appendChild(M.createTextNode("")));O=s}else v=new n(v[0].childNodes[C]);if(r[0].nodeType==e.f){r.ga(m);if(r.g(v))v=new n(r[0].nextSibling)}else if(m)if(m>=r[0].childNodes.length){P=new n(M.createTextNode(""));r.append(P);r=P;P=s}else r=new n(r[0].childNodes[m].previousSibling);
else{P=new n(M.createTextNode(""));r.prepend(P);r=P;P=s}m=r.Ib();C=v.Ib();var Q,W,U;for(Q=0;Q<m.length;Q++){W=m[Q];U=C[Q];if(!W.g(U))break}M=h;for(var V,Y,E,K=Q;K<m.length;K++){V=m[K];Y=M&&!V.g(r)?M.appendChild(V.K()[0]):T;for(V=V[0].nextSibling;V;){if(a.g(C[K],V)||a.g(v,V))break;E=V.nextSibling;if(c==2)M.appendChild(V.cloneNode(s));else{a.h(V);c==1&&M.appendChild(V)}V=E}if(Y)M=Y}M=h;for(Q=Q;Q<C.length;Q++){V=C[Q];Y=M&&c>0&&!V.g(v)?M.appendChild(V.K()[0]):T;if(!m[Q]||!V.parent().g(m[Q].parent()))for(V=
V[0].previousSibling;V;){if(a.g(m[Q],V)||a.g(r,V))break;E=V.previousSibling;if(c==2)M.insertBefore(V.cloneNode(s),M.firstChild);else{a.h(V);c==1&&M.insertBefore(V,M.firstChild)}V=E}if(Y)M=Y}if(c==2){U=this.startContainer[0];if(U.nodeType==e.f&&U.nextSibling&&U.nextSibling.nodeType==e.f){U.data+=U.nextSibling.data;U.parentNode.removeChild(U.nextSibling)}U=this.endContainer[0];if(U.nodeType==e.f&&U.nextSibling&&U.nextSibling.nodeType==e.f){U.data+=U.nextSibling.data;U.parentNode.removeChild(U.nextSibling)}}else{if(W&&
U&&(!r.parent().g(W.parent())||!v.parent().g(U.parent()))){W=U.v();P&&U.parent().g(r.parent())&&W--;this.setStart(U.parent(),W)}this.collapse(s)}P&&r.h();O&&v[0].parentNode&&v.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=s},clone:function(){var c=new B(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},Zc:function(){var c=this.clone();c.ic();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return f;var h=new q.Aa(c),r=z(s,undefined),v=t(s);c.Q=function(m){return v(m)&&r(m)};c=h.next();h.reset();h=h.nb();return c&&c.g(h)?c:f},Na:function(c,h){if(!this.collapsed){c=c||o.yc;var r=this.clone(),v=this.startContainer,m=this.endContainer,C=this.startOffset,P=this.endOffset,M=1,O=1;if(v&&v[0].nodeType==e.f)if(C)if(C>=v[0].nodeValue.length)r.setStartAfter(v);
else{r.setStartBefore(v);M=0}else r.setStartBefore(v);if(m&&m[0].nodeType==e.f)if(P)if(P>=m[0].nodeValue.length)r.setEndAfter(m);else{r.setEndAfter(m);O=0}else r.setEndBefore(m);r=new i(r);r.Q=function(W){W=W[0]||W;return W.nodeType==(c==o.da?e.e:e.f)};var Q;r.ac=function(W,U){W=W[0]||W;if(c==o.da&&W.nodeType==e.f)return p;if(U&&W==Q)return p;if(!U&&W.nodeType==e.e)Q=W;return s};if(M)(v=r[c==o.da?"lastForward":"next"]())&&this.T(v,h?o.V:o.C);if(O){r.reset();(r=r[c==o.da?"lastBackward":"previous"]())&&
this.S(r,h?o.J:o.t)}return!!(M||O)}},ve:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Sc:function(c){var h=this.startContainer,r=this.endContainer,v=this.startOffset,m=this.endOffset,C,P;if(!h||!r)return{start:0,end:0};if(c){if(h[0].nodeType==e.e)if((C=new n(h[0].childNodes[v]))&&C[0]&&C[0].nodeType==e.f&&v>0&&C[0].previousSibling.nodeType==e.f){h=C;v=0}for(;h[0].nodeType==e.f&&(P=h.ra())&&P[0].nodeType==e.f;){h=P;v+=
P[0].nodeValue.length}if(!this.collapsed){if(r[0].nodeType==e.e)if((C=new n(r[0].childNodes[m]))&&C[0]&&C[0].nodeType==e.f&&m>0&&C[0].previousSibling.nodeType==e.f){r=C;m=0}for(;r[0].nodeType==e.f&&(P=r.ra())&&P[0].nodeType==e.f;){r=P;m+=P[0].nodeValue.length}}}return{start:h.Ba(c),end:this.collapsed?f:r.Ba(c),startOffset:v,endOffset:m,md:c,De:s}},O:function(c){var h,r,v,m,C=this.collapsed;h=new n("<span>",f,this.document);h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){v=
g.guid("ke_bm_");h.attr("id",v+"S")}if(!C){r=h.K();r.html("&nbsp;");c&&r.attr("id",v+"E");m=this.clone();m.collapse();m.insertNode(r)}m=this.clone();m.collapse(s);m.insertNode(h);if(r){this.setStartAfter(h);this.setEndBefore(r)}else this.H(h,o.t);return{Y:c?v+"S":h,P:c?v+"E":r,yd:c,collapsed:C}},H:function(c,h){this.T(c,h);this.collapse(s)},trim:function(c,h){var r=this.startContainer,v=this.startOffset,m=this.collapsed;if((!c||m)&&r[0]&&r[0].nodeType==e.f){if(v)if(v>=r[0].nodeValue.length){v=r.v()+
1;r=r.parent()}else{var C=r.ga(v);v=r.v()+1;r=r.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(a.g(r,this.endContainer))this.endOffset+=1}else{v=r.v();r=r.parent()}this.setStart(r,v);if(m){this.collapse(s);return}}r=this.endContainer;v=this.endOffset;if(!(h||m)&&r[0]&&r[0].nodeType==e.f){if(v){v>=r.nodeValue.length||r.ga(v);v=r.v()+1}else v=r.v();r=r.parent();this.setEnd(r,v)}},insertNode:function(c){this.jc();this.trim(p,s);var h=this.startContainer;
h[0].insertBefore(c[0]||c,h[0].childNodes[this.startOffset]||T);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.De){var h=b(this.document,c.start,c.md),r=c.startOffset,v=c.end&&b(this.document,c.end,c.md);c=c.endOffset;this.setStart(h,r);v?this.setEnd(v,c):this.collapse(s)}else{h=(r=c.yd)?g.one("#"+c.Y,this.document):c.Y;c=r?g.one("#"+c.P,this.document):c.P;this.setStartBefore(h);h.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(s)}},
ua:function(c,h){var r=this.startContainer,v=this.endContainer;r=a.g(r,v)?c&&r[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new n(r[0].childNodes[this.startOffset]):r:r.Eb(v);return h&&r[0].nodeType==e.f?r.parent():r},Ia:function(c){switch(c){case o.xb:if(this.collapsed)break;c=this.ua();var h=new n(this.document.body),r,v,m,C,P,M=p,O,Q;O=this.startContainer;Q=this.startOffset;if(O[0].nodeType==e.f){if(Q){O=!g.trim(O[0].nodeValue.substring(0,Q)).length&&O;M=!!O}if(O)if(!(C=O[0].previousSibling))m=
O.parent()}else{if(Q)C=O[0].childNodes[Q-1]||O[0].lastChild;C||(m=O)}for(;m||C;){if(m&&!C){if(!P&&a.g(m,c))P=s;if(!h.contains(m))break;if(!M||m.css("display")!="inline"){M=p;if(P)r=m;else this.setStartBefore(m)}C=m[0].previousSibling}for(;C;){O=p;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;O=/[\s\ufeff]$/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(M&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else for(var W=C.all||C.getElementsByTagName("*"),
U=0,V;V=W[U++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}if(C)O=!!Q.length}else C=f;if(O)if(M)if(P)r=m;else m&&this.setStartBefore(m);else M=s;if(C){O=C.previousSibling;if(!m&&!O){m=new n(C);C=f;break}C=O}else m=f}if(m)m=m.parent()}O=this.endContainer;Q=this.endOffset;m=C=f;P=M=p;if(O[0].nodeType==e.f){O=!g.trim(O[0].nodeValue.substring(Q)).length&&O;M=!(O&&O[0].nodeValue.length);if(O)if(!(C=O[0].nextSibling))m=O.parent()}else(C=O[0].childNodes[Q])||(m=O);for(;m||C;){if(m&&!C){if(!P&&a.g(m,c))P=
s;if(!h.contains(m))break;if(!M||m.css("display")!="inline"){M=p;if(P)v=m;else m&&this.setEndAfter(m)}C=m[0].nextSibling}for(;C;){O=p;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;O=/^[\s\ufeff]/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(M&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else{W=C.all||C.getElementsByTagName("*");for(U=0;V=W[U++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}}if(C)O=!!Q.length}else C=f;if(O)if(M)if(P)v=
m;else this.setEndAfter(m);if(C){O=C.nextSibling;if(!m&&!O){m=new n(C);C=f;break}C=O}else m=f}if(m)m=m.parent()}if(r&&v){c=r.contains(v)?v:r;this.setStartBefore(c);this.setEndAfter(c)}break;case o.wb:case o.Ra:m=new B(this.document);h=new n(this.document.body);m.T(h,o.V);m.setEnd(this.startContainer,this.startOffset);m=new i(m);var Y,E,K=i.Nb(c==o.Ra?{Ob:1}:f),G=function(F){var H=K(F);H||(Y=F);return H};r=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")E=F;return H};m.ac=G;m=m.jd();Y=Y||h;this.T(Y,
Y.d()!="br"&&(!m&&this.sa()||m&&Y.contains(m))?o.V:o.t);m=this.clone();m.collapse();m.S(h,o.J);m=new i(m);m.ac=c==o.Ra?r:G;Y=f;m=m.kd();Y=Y||h;this.S(Y,!m&&this.ja()||m&&Y.contains(m)?o.J:o.C);E&&this.setEndAfter(E)}},sa:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(0,h)).length)return p;this.trim();c=new w(this.startContainer);h=this.clone();h.collapse(s);h.T(c.z||c.F,o.V);c=new i(h);c.Q=A(s);return c.Pc()},ja:function(){var c=
this.endContainer,h=this.endOffset;if(c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(h)).length)return p;this.trim();c=new w(this.endContainer);h=this.clone();h.collapse(p);h.S(c.z||c.F,o.J);c=new i(h);c.Q=A(p);return c.Qc()},deleteContents:function(){this.collapsed||this.Ub(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Ub(1,c);return c},Qb:function(c,h){var r=this.clone();r[h==o.Va?"setStartAt":"setEndAt"](c,h==o.Va?o.V:o.J);r=new i(r);r.Q=
u;return r[h==o.Va?"checkBackward":"checkForward"]()},Wc:function(){var c=this.startContainer,h=this.endContainer,r=this.startOffset,v=this.endOffset,m;if(c[0].nodeType==e.e){m=c[0].childNodes.length;if(m>r)c=new n(c[0].childNodes[r]);else if(m<1)c=c.fa();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new n(c);c=c.w()||c}}if(h[0].nodeType==e.e){m=h[0].childNodes.length;if(m>v)h=(new n(h[0].childNodes[v])).fa(s);else if(m<1)h=h.fa();else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new n(h)}}if(c.Da(h)&y.ba)c=
h;return{Y:c,P:h}},eb:function(c,h){var r=this.O(),v=new n(this.document.createElement(h));this.collapse(c);this.Ia(o.wb);v[0].appendChild(this.extractContents());v.$a();d.ie||v.Cb();this.insertNode(v);this.moveToBookmark(r);return v},oc:function(c){var h=new w(this.startContainer),r=new w(this.endContainer),v=h.z,m=r.z,C=f;if(!h.F.g(r.F))return f;if(c!="br"){if(!v){v=this.eb(s,c);m=(new w(this.endContainer)).z}m||(m=this.eb(p,c))}c=v&&this.sa();h=m&&this.ja();this.deleteContents();if(v&&a.g(v,m))if(h){C=
new w(this.startContainer);this.H(m,o.t);m=f}else if(c){C=new w(this.startContainer);this.H(v,o.C);v=f}else{m=this.pc(v);!d.ie&&!g.inArray(v.d(),["ul","ol"])&&v.Cb()}return{Hf:v,Gf:m,We:c,Ve:h,Cf:C}},pc:function(c){if(!this.collapsed)return f;this.S(c,o.J);var h=this.extractContents(),r=c.K(p);r[0].appendChild(h);r.insertAfter(c);this.H(c,o.t);return r},jb:function(c,h){var r,v=q.m;if(v.sb[c.d()])return p;for(;c&&c[0].nodeType==e.e;){if(r=c.Dc())this.H(c,h?o.J:o.V);else if(v.sc[c.d()]){this.H(c,h?
o.t:o.C);return s}if((c=v.sb[c.d()]?c[h?"_4e_previous":"_4e_next"](J):c[h?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,h?o.t:o.C);return s}}return r},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var k={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},D=new i.Pa,I=new i.Ga;q.Range=
B;q.Range=B;var x=B.prototype;q.l.o(x,{updateCollapsed:x.Oa,optimize:x.ic,setStartAfter:x.setStartAfter,setEndAfter:x.setEndAfter,setStartBefore:x.setStartBefore,setEndBefore:x.setEndBefore,optimizeBookmark:x.jc,setStart:x.setStart,setEnd:x.setEnd,setStartAt:x.T,setEndAt:x.S,execContentsAction:x.Ub,collapse:x.collapse,clone:x.clone,getEnclosedNode:x.Zc,shrink:x.Na,getTouchedStartNode:x.ve,createBookmark2:x.Sc,createBookmark:x.O,moveToPosition:x.H,trim:x.trim,insertNode:x.insertNode,moveToBookmark:x.moveToBookmark,
getCommonAncestor:x.ua,enlarge:x.Ia,checkStartOfBlock:x.sa,checkEndOfBlock:x.ja,deleteContents:x.deleteContents,extractContents:x.extractContents,checkBoundaryOfElement:x.Qb,getBoundaryNodes:x.Wc,fixBlock:x.eb,splitBlock:x.oc,splitElement:x.pc,moveToElementEditablePosition:x.jb,selectNodeContents:x.selectNodeContents})});
KISSY.Editor.add("domiterator",function(q){function B(i){if(!(arguments.length<1)){this.wa=i;this.Wb=J;this.Vc=u;this.Tb=J;this.c||(this.c={})}}var u=S,J=X,A=KISSY,z=A.UA,t=q.Aa,s=q.Range,p=q.na,f=q.n,g=q.Sa,e=A.Node,o=A.DOM,y=/^[\r\n\t ]*$/;A.augment(B,{ue:function(i){var a,b,d,j,w;if(!this.c.I){b=this.wa.clone();b.Na(p.da,u);b.Ia(this.Wb||!this.Vc?p.Ra:p.wb);var n=new t(b),l=t.Ga(u,u);n.Q=l;this.c.ka=n.next();n=new t(b);n.Q=l;n=n.nb();this.c.I=n.w(u);if(this.c.I&&this.c.I[0].nodeType==f.f&&!A.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().pa()){l=new s(b.document);l.H(this.c.I,p.t);if(l.ja()){l=new g(l.endContainer);this.c.I=(l.z||l.F).w(u)}}if(!this.c.I){this.c.I=this.c.Uc=new e(b.document.createTextNode(""));o.insertAfter(this.c.I[0],n[0])}b=T}l=this.c.ka;n=this.c.I;for(this.c.ka=T;l;){var k=J,D=l[0].nodeType!=f.e,I=J;if(D){if(l[0].nodeType==f.f)if(y.test(l[0].nodeValue))D=J}else{var x=l.d();if(l.pa(this.Wb&&{Ob:1})){if(x=="br")D=u;else if(!b&&!l[0].childNodes.length&&x!="hr"){a=l;d=l.g(n);break}if(b){b.S(l,p.C);
if(x!="br")this.c.ka=l}k=u}else{if(l[0].firstChild){if(!b){b=new s(this.wa.document);b.T(l,p.C)}l=new e(l[0].firstChild);continue}D=u}}if(D&&!b){b=new s(this.wa.document);b.T(l,p.C)}d=(!k||D)&&l.g(n);if(b&&!k)for(;!l[0].nextSibling&&!d;){x=l.parent();if(x.pa(this.Wb&&{Ob:1})){k=u;d||x.g(n);break}l=x;D=u;d=l.g(n);I=u}D&&b.S(l,p.t);l=l.w(I,T,n);if((d=!l)||k&&b)break}if(!a){if(!b){this.c.Uc&&this.c.Uc.h();return this.c.ka=T}a=new g(b.startContainer);l=a.F;k={Af:1,Nf:1,Mf:1};a=a.z;if((!a||!a[0])&&!this.Tb&&
k[l.d()]&&b.sa()&&b.ja())a=l;else if(!a||this.Tb&&a.d()=="li"){a=new e(this.wa.document.createElement(i||"p"));a[0].appendChild(b.extractContents());a.$a();b.insertNode(a);j=w=u}else if(a.d()!="li"){if(!b.sa()||!b.ja()){a=a.K(J);a[0].appendChild(b.extractContents());a.$a();w=b.oc();j=!w.We;w=!w.Ve;b.insertNode(a)}}else if(!d)this.c.ka=a.g(n)?T:b.Wc().P.w(u,T,n)}if(j){b=new e(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&o.d(b[0].lastChild)=="br"&&o.h(b[0].lastChild)}if(w){b=
t.Ga(J,u);j=new e(a[0].lastChild);if(j[0]&&j[0].nodeType==f.e&&j.d()=="br")if(z.ie||j.ra(b)||j.Ca(b))j.h()}if(!this.c.ka)this.c.ka=d||a.g(n)?T:a.w(u,T,n);return a}});s.prototype.me=function(){return new B(this)}});
KISSY.Editor.add("selection",function(q){function B(l){this.document=this.document=l;this.c={M:{}};if(p.ie){var k=this.r().createRange();if(!k||k.item&&k.item(0).ownerDocument!=l||k.parentElement&&k.parentElement().ownerDocument!=l)this.hd=A}}function u(l){l=new B(l);return!l||l.hd?t:l}function J(l){var k=l.document,D=new e(k.body),I=new e(k.documentElement);if(p.ie){if(p.ie<8||document.documentMode==7)I.on("click",function(M){(new e(M.target)).d()==="html"&&l.getSelection().A()[0].select()});var x,
c,h=1;I.on("mousedown",function(){h=0});I.on("mouseup",function(){h=1});D.on("focusin",function(M){if((new e(M.target)).d()=="body")if(x){try{h&&x.select()}catch(O){}x=t}});D.on("focus",function(){c=A;v()});D.on("beforedeactivate",function(M){if(!M.relatedTarget){c=z;h=1}});g.on(f.ea(k),"blur",function(){k&&k.selection.empty()});D.on("mousedown",function(){r()});D.on("mouseup",function(){c=A;setTimeout(function(){v(A)},0)});var r=function(){c=z},v=function(M){if(c){var O=l.document,Q=l.getSelection(),
W=Q&&Q.fb(),U=Q&&Q.r();if(M&&U&&W==o.zb)if(!O.queryCommandEnabled("InsertImage")){setTimeout(function(){v(A)},50);return}var V;if(!(U&&W==o.oa&&(V=f.d(U.createRange().parentElement()))&&V in{input:1,textarea:1})){x=U&&Q.A()[0];l.ab()}}};D.on("keydown",r);D.on("keyup",function(){c=A;v()});g.on(k,"selectionchange",v)}else{g.on(k,"mouseup",l.ab,l);g.on(k,"keyup",l.ab,l)}var m={table:1,pre:1},C=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
P=q.Aa.Pa(A);l.on("selectionChange",function(M){var O=M.path;M=(M=M.selection)&&M.A()[0];if(!(!M||!M.collapsed||O.z))if(O.F.d()=="body"){O=M.eb(A,"p");if(O.Za().match(C)){var Q=O.Ca(P);if(Q&&Q[0].nodeType==i.e&&!m[Q.d()]){M.jb(Q);O.h()}else if((Q=O.ra(P))&&Q[0].nodeType==i.e&&!m[Q.d()]){M.jb(Q,Q.Za().match(C)?z:A);O.h()}}M.select();p.ie||l.kb()}})}q.Jd={zb:1,oa:2,Ua:3};var A=S,z=X,t=T,s=KISSY,p=s.UA,f=s.DOM,g=s.Event,e=s.Node,o=q.Jd,y=q.na,i=q.n,a=q.Aa,b=q.Range,d={img:1,hr:1,li:1,table:1,tr:1,td:1,
th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};s.augment(B,{r:p.ie?function(){var l=this.c.M;return l.gc||(l.gc=this.document.selection)}:function(){var l=this.c.M;return l.gc||(l.gc=f.ea(this.document).getSelection())},fb:p.ie?function(){var l=this.c.M;if(l.type)return l.type;var k=o.zb;try{var D=this.r(),I=D.type;if(I=="Text")k=o.oa;if(I=="Control")k=o.Ua;if(D.createRange().parentElement)k=o.oa}catch(x){}return l.type=k}:function(){var l=
this.c.M;if(l.type)return l.type;var k=o.oa,D=this.r();if(D){if(D.rangeCount==1){D=D.getRangeAt(0);var I=D.startContainer;if(I==D.endContainer&&I.nodeType==i.e&&D.endOffset-D.startOffset===1&&d[I.childNodes[D.startOffset].nodeName.toLowerCase()])k=o.Ua}}else k=o.zb;return l.type=k},A:p.ie?function(){function l(k,D){k=k.duplicate();k.collapse(D);for(var I=k.parentElement(),x=I.childNodes,c,h=0;h<x.length;h++){var r=x[h];if(r.nodeType==i.e){c=k.duplicate();c.moveToElementText(r);r=c.compareEndPoints("StartToStart",
k);var v=c.compareEndPoints("EndToStart",k);c.collapse();if(r>0)break;else if(!r||v==1&&r==-1)return{Ha:I,offset:h};else if(!v)return{Ha:I,offset:h+1};c=t}}if(!c){c=k.duplicate();c.moveToElementText(I);c.collapse(z)}c.setEndPoint("StartToStart",k);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=x[--h].nodeValue.length}catch(m){c=0}return c===0?{Ha:I,offset:h}:{Ha:x[h],offset:-c}}return function(){var k=this.c.M;if(k.ma)return k.ma;var D=this.r(),I=D&&D.createRange(),x=this.fb();if(!D)return[];
if(x==o.oa){D=new b(this.document);x=l(I,A);D.setStart(new e(x.Ha),x.offset);x=l(I);D.setEnd(new e(x.Ha),x.offset);return k.ma=[D]}else if(x==o.Ua){k=k.ma=[];for(x=0;x<I.length;x++){var c=I.item(x),h=c.parentNode,r=0;for(D=new b(this.document);r<h.childNodes.length&&h.childNodes[r]!=c;r++);D.setStart(new e(h),r);D.setEnd(new e(h),r+1);k.push(D)}return k}return k.ma=[]}}():function(){var l=this.c.M;if(l.ma)return l.ma;var k=[],D=this.r();if(!D)return[];for(var I=0;I<D.rangeCount;I++){var x=D.getRangeAt(I),
c=new b(this.document);c.setStart(new e(x.startContainer),x.startOffset);c.setEnd(new e(x.endContainer),x.endOffset);k.push(c)}return l.ma=k},$b:function(){var l=this.c.M;if(l.zd!==undefined)return l.zd;var k,D=this.r();switch(this.fb()){case o.Ua:return this.Zb();case o.oa:var I=this.A()[0];if(I)if(!I.collapsed){for(I.ic();A;){k=I.startContainer;if(I.startOffset==(k[0].nodeType===i.e?k[0].childNodes.length:k[0].nodeValue.length)&&!k.pa())I.setStartAfter(k);else break}k=I.startContainer;if(k[0].nodeType!=
i.e)return k.parent();k=new e(k[0].childNodes[I.startOffset]);if(!k[0]||k[0].nodeType!=i.e)return I.startContainer;for(I=k[0].firstChild;I&&I.nodeType==i.e;){k=new e(I);I=I.firstChild}return k}if(p.ie){I=D.createRange();I.collapse(A);k=I.parentElement()}else if((k=D.anchorNode)&&k.nodeType!=i.e)k=k.parentNode}return l.zd=k?f.D(k):t},Zb:function(){var l=this,k,D=l.c.M;if(D.xd!==undefined)return D.xd;if(p.ie){k=l.r().createRange();k=k.item&&k.item(0)}k||(k=function(){for(var I=l.A()[0],x,c,h=2;h&&!((x=
I.Zc())&&x[0].nodeType==i.e&&d[x.d()]&&(c=x));h--)I.Na(y.da);return c&&c[0]}());return D.xd=f.D(k)},reset:function(){this.c.M={}},nc:function(l){var k;if(p.ie)try{k=this.document.body.createControlRange();k.addElement(l[0]);k.select()}catch(D){k=this.document.body.createTextRange();k.moveToElementText(l[0]);k.select()}finally{}else{k=this.document.createRange();k.selectNode(l[0]);l=this.r();l.removeAllRanges();l.addRange(k)}this.reset()},qb:function(l){if(p.ie){if(l.length>1){var k=l[l.length-1];
l[0].setEnd(k.endContainer,k.endOffset);l.length=1}l[0]&&l[0].select()}else{k=this.r();if(!k)return;k.removeAllRanges();for(var D=0;D<l.length;D++){var I=l[D],x=this.document.createRange(),c=I.startContainer;I.collapsed&&p.gecko&&p.gecko<1.09&&c[0].nodeType==i.e&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));x.setStart(c[0],I.startOffset);x.setEnd(I.endContainer[0],I.endOffset);k.addRange(x)}}this.reset()},le:function(l){for(var k=[],D=this.A(),I=0;I<D.length;I++)k.push(D[I].Sc(l));
return k},ke:function(l,k){var D=[],I=this.document,x;k=k||this.A();for(var c=k.length,h=0;h<c;h++){D.push(x=k[h].O(l,A));var r=(l=x.yd)?s.one("#"+x.Y,I):x.Y;x=l?s.one("#"+x.P,I):x.P;for(var v=h+1;v<c;v++){var m=k[v],C=m.startContainer,P=m.endContainer;f.g(C,r.parent())&&m.startOffset++;f.g(C,x.parent())&&m.startOffset++;f.g(P,r.parent())&&m.endOffset++;f.g(P,x.parent())&&m.endOffset++}}return D},wd:function(l){for(var k=[],D=0;D<l.length;D++){var I=new b(this.document);I.moveToBookmark(l[D]);k.push(I)}this.qb(k);
return this},ua:function(){var l=this.A();return l[0].startContainer.Eb(l[l.length-1].endContainer)},scrollIntoView:function(){var l=this.$b();l&&l.Jb()},removeAllRanges:function(){var l=this.r();if(p.ie)l&&l.clear();else l&&l.removeAllRanges()}});var j={table:1,tbody:1,tr:1},w=a.Pa(A),n=/\ufeff|\u00a0/;b.prototype.select=b.prototype.select=p.ie?function(l){var k=this.collapsed,D,I;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var x=this.startContainer[0].childNodes[this.startOffset];
if(x.nodeType==i.e){(new B(this.document)).nc(new e(x));return}}if(this.startContainer[0].nodeType==i.e&&this.startContainer.d()in j||this.endContainer[0].nodeType==i.e&&this.endContainer.d()in j)this.Na(y.da,A);var c=this.O();x=c.Y;var h;if(!k)h=c.P;c=this.document.body.createTextRange();c.moveToElementText(x[0]);c.moveStart("character",1);if(h){l=this.document.body.createTextRange();l.moveToElementText(h[0]);c.setEndPoint("EndToEnd",l);c.moveEnd("character",-1)}else{for(D=x[0].nextSibling;D&&!w(D);)D=
D.nextSibling;D=!(D&&D.nodeValue&&D.nodeValue.match(n))&&(l||!x[0].previousSibling||x[0].previousSibling&&f.d(x[0].previousSibling)=="br");I=this.document.createElement("span");I.innerHTML="&#65279;";I=(new e(I)).insertBefore(x);D&&f.insertBefore(this.document.createTextNode("\ufeff"),x)}this.setStartBefore(x);x.h();if(k){if(D){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(I){this.H(I,y.C);I.h()}}else{this.setEndBefore(h);h.h();c.select()}}:function(){var l=
this.startContainer;this.collapsed&&l[0].nodeType==i.e&&!l[0].childNodes.length&&l[0].appendChild(this.document.createTextNode(""));var k=this.document.createRange();k.setStart(l[0],this.startOffset);try{k.setEnd(this.endContainer[0],this.endOffset)}catch(D){if(D.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(A);k.setEnd(this.endContainer[0],this.endOffset)}else throw D;}l=u(this.document).r();l.removeAllRanges();l.addRange(k)};B.getSelection=u;q.Ac=B;q.Selection=B;a=B.prototype;q.l.o(a,
{getNative:a.r,getType:a.fb,getRanges:a.A,getStartElement:a.$b,getSelectedElement:a.Zb,reset:a.reset,selectElement:a.nc,selectRanges:a.qb,createBookmarks2:a.le,createBookmarks:a.ke,getCommonAncestor:a.ua,scrollIntoView:a.scrollIntoView,selectBookmarks:a.wd,removeAllRanges:a.removeAllRanges});q.on("instanceCreated",function(l){J(l.pe)})});
KISSY.Editor.add("styles",function(q){function B(E,K){for(var G in E)E[G]=E[G].replace(V,function(F,H){return K[H]})}function u(E,K){if(K){E=D.clone(E);B(E.attributes,K);B(E.styles,K)}var G=this.element=this.element=(E.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.Ab:W[G]?c.Wa:c.za;this.c={definition:E}}function J(E,K){var G=K?this.mc:this.Lb;E.body.focus();for(var F=new r(E),H=F.A(),N=0;N<H.length;N++)G.call(this,H[N]);F.qb(H)}function A(E,K){var G;G=E.element;if(G=="*")G="span";
G=new P(K.createElement(G));return z(G,E)}function z(E,K){var G=K.c.definition,F=G.attributes;G=u.ad(G);if(F)for(var H in F)E.attr(H,F[H]);if(G)E[0].style.cssText=G;return E}function t(E){var K=E.O(n),G=E.me();G.Tb=n;G.Vc=n;for(var F,H=E.document;F=G.ue();){var N=A(this,H);F=F;var L=N;N=L.d=="pre";var R=F.d=="pre",ba=!N&&R;if(N&&!R){R=F;L=L;ba=R.html();ba=s(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(M.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+ba+"</pre>";L=new P(R.firstChild);L.h()}else L.html(ba);L=L}else if(ba)L=f(p(F),L);else F.Hb(L);F[0].parentNode.replaceChild(L[0],F[0]);if(N){F=L;N=void 0;if((N=F.fa(n,v.e))&&N.d()=="pre"){L=s(N.html(),/\n$/,"")+"\n\n"+s(F.html(),/^\n/,"");if(M.ie)F[0].outerHTML="<pre>"+L+"</pre>";else F.html(L);N.h()}}}E.moveToBookmark(K)}function s(E,K,G){var F="",H="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(N,L,R){L&&(F=L);R&&(H=R);return""});return F+E.replace(K,G)+H}function p(E){var K=[];s(E.Za(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function f(E,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<E.length;F++){var H=E[F];H=H.replace(/(\r\n|\r)/g,"\n");H=s(H,/^[ \t]*\n/,"");H=s(H,/\n$/,"");H=s(H,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var N=K.K();N.html(H);G.appendChild(N[0])}return G}function g(E){var K=E.document;if(E.collapsed){K=A(this,K);E.insertNode(K);E.H(K,h.J)}else{var G=this.element,F=this.c.definition,H,N=q.m[G]||(H=n,q.m.span),L=E.O();E.Ia(h.xb);E.trim();var R=E.O(),ba=R.Y;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=l;if(x.g($,R)){$=
k;Z=n}else{var aa=$[0].nodeType,fa=aa==v.e?$.d():k;if(fa&&$.attr("_ke_bookmark")){$=$.w(n);continue}if(!fa||N[fa]&&($.Da(R)|m.X|m.ca|m.W)==m.X+m.ca+m.W&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((q.m[ga.d()]||q.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!q.m.aa[fa]||($.Da(R)|m.X|m.ca|m.W)==m.X+m.ca+m.W)){ca=new C(K);ca.setStartBefore($)}if(aa==v.f||aa==v.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Ca(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),N[da.d()])&&(da.Da(ba)|m.ba|m.ca|m.W)==m.ba+m.ca+m.W&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=n)}}else Z=n}else Z=n;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=A(this,K);for(aa=ca.ua();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.Ya()){Z=k;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());d(this,Z);ca.insertNode(Z);
Z.qa();M.ie||Z[0].normalize()}ca=k}}ba.h();R.h();E.moveToBookmark(L);E.Na(h.yc)}}function e(E){E.Ia(h.xb);var K=E.O(),G=K.Y;if(E.collapsed){for(var F=new O(G.parent()),H,N=0,L;N<F.elements.length&&(L=F.elements[N]);N++){if(L==F.z||L==F.F)break;if(this.ia(L)){var R=E.Qb(L,h.Gd),ba=!R&&E.Qb(L,h.Va);if(ba||R){H=L;H.match=ba?"start":"end"}else{L.qa();L.d()==this.element?a(this,L):j(L,i(this)[L.d()])}}}if(H&&H[0]){L=G;for(N=0;;N++){R=F.elements[N];if(x.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(L[0]);L=R}x[H.match=="start"?"insertBefore":"insertAfter"](L,H)}}else{var $=K.P,ca=this;F=function(){for(var Z=new O(G.parent()),aa=new O($.parent()),fa=k,ga=k,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Db(ga);fa&&G.Db(fa)};F();for(H=new P(G[0].nextSibling);H[0]!==$[0];){N=H.w();if(H[0]&&H[0].nodeType==v.e&&this.ia(H)){H.d()==
this.element?a(this,H):j(H,i(this)[H.d()]);if(N[0].nodeType==v.e&&N.contains(G)){F();N=new P(G[0].nextSibling)}}H=N}}E.moveToBookmark(K)}function o(E){var K={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function y(E,K){var G;if(K!==l){G=document.createElement("span");G.style.cssText=E;G=G.style.cssText||""}else G=E;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(E){if(E.c.vd)return E.c.vd;
var K=E.c.vd={},G=E.c.definition.overrides;if(G){D.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],N,L;if(typeof H=="string")N=H.toLowerCase();else{N=H.element?H.element.toLowerCase():E.element;L=H.attributes}H=K[N]||(K[N]={});if(L){H=H.attributes=H.attributes||[];for(var R in L)H.push([R.toLowerCase(),L[R]])}}}return K}function a(E,K){var G=E.c.definition,F=I.mix(G.attributes,i(E)[K.d()]);G=G.styles;var H=D.isEmptyObject(F)&&D.isEmptyObject(G),N;for(N in F)if(!((N=="class"||E.c.definition.fullMatch)&&
K.attr(N)!=b(N,F[N]))){H=H||!!K.Cc(N);K.removeAttr(N)}for(var L in G)if(!(E.c.definition.fullMatch&&K.L(L)!=b(L,G[L],n))){H=H||!!K.L(L);K.L(L,"")}w(K)}function b(E,K,G){var F=new P("<span>");F[G?"_4e_style":"attr"](E,K);return F[G?"_4e_style":"attr"](E)}function d(E,K){for(var G=i(E),F=K.all(E.element),H=F.length;--H>=0;)a(E,new P(F[H]));for(var N in G)if(N!=E.element){F=K.all(N);for(H=F.length-1;H>=0;H--){var L=new P(F[H]);j(L,G[N])}}}function j(E,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],N;if(N=E.attr(H)){var L=G[F][1];if(L===k||L.test&&L.test(N)||typeof L=="string"&&N==L)E[0].removeAttribute(H)}}w(E)}function w(E){if(!E.Ya()){var K=E[0].firstChild,G=E[0].lastChild;E.h(n);if(K){K.nodeType==v.e&&x.qa(K);G&&K!=G&&G.nodeType==v.e&&x.qa(G)}}}var n=S,l=X,k=T,D=KISSY,I=q.l,x=D.DOM,c={Ab:1,za:2,Wa:3},h=q.na,r=q.Ac,v=q.n,m=q.Ta,C=q.Range,P=D.Node,M=D.UA,O=q.Sa,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},W={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},U=/\s*(?:;\s*|$)/g,V=/#\((.+?)\)/g;q.nf=c;u.prototype={apply:function(E){J.call(this,E,l)},remove:function(E){J.call(this,E,n)},Lb:function(E){return(this.Lb=this.type==c.za?g:this.type==c.Ab?t:this.type==c.Wa?k:k).call(this,E)},mc:function(E){return(this.mc=this.type==c.za?e:k).call(this,E)},$d:function(E){z(E,this)},ia:function(E,K){if(!E)return l;var G=this.c.definition;if(E.d()==this.element){if(!K&&!E.Ya())return n;var F=G.Sd;if(F)G=F;else{F={};var H=0,N=G.attributes;
if(N)for(var L in N){H++;F[L]=N[L]}if(N=u.ad(G)){F.style||H++;F.style=N}F._length=H;G=G.Sd=F}if(G._length){for(var R in G)if(R!="_length"){H=E.attr(R)||"";if(R=="style")a:{F=G[R];H=y(H,l);typeof F=="string"&&(F=o(F));typeof H=="string"&&(H=o(H));N=void 0;for(N in F)if(!(N in H&&(H[N]==F[N]||F[N]=="inherit"||H[N]=="inherit"))){F=l;break a}F=n}else F=G[R]==H;if(F){if(!K)return n}else if(K)return l}if(K)return n}else return n}if(R=i(this)[E.d()]){if(!(G=R.attributes))return n;for(F=0;F<G.length;F++){R=
G[F][0];if(R=E.attr(R)){H=G[F][1];if(H===k||typeof H=="string"&&R==H||H.test&&H.test(R))return n}}}return l},ge:function(E){switch(this.type){case c.Ab:return this.ia(E.z||E.F,n);case c.Wa:case c.za:for(var K=E.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.za&&(x.g(F,E.z)||x.g(F,E.F))))if(!(this.type==c.Wa&&!(F.d()in W)))if(this.ia(F,n))return n}}return l}};u.ad=function(E){var K=E.Td;if(K)return K;K=E.styles;var G=E.attributes&&E.attributes.style||"",F="";if(G.length)G=G.replace(U,";");
for(var H in K){var N=K[H],L=(H+":"+N).replace(U,";");if(N=="inherit")F+=L;else G+=L}if(G.length)G=y(G);G+=F;return E.Td=G};q.of=u;q.Style=u;var Y=u.prototype;q.l.o(Y,{apply:Y.apply,remove:Y.remove,applyToRange:Y.Lb,removeFromRange:Y.mc,applyToObject:Y.$d,checkElementRemovable:Y.ia,checkActive:Y.ge})});
KISSY.Editor.add("htmlparser",function(){function q(){}function B(){this.c={ed:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var u=KISSY,J=u.Editor,A=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,z={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},t=J.m;u.augment(B,{va:q,ud:q,la:q,pd:q,La:q,parse:function(s){for(var p,
f,g=0,e;p=this.c.ed.exec(s);){f=p.index;if(f>g){g=s.substring(g,f);e?e.push(g):this.la(g)}g=this.c.ed.lastIndex;if(f=p[1]){f=f.toLowerCase();if(e&&t.rc[f]){this.pd(e.join(""));e=T}if(!e){this.ud(f);continue}}if(e)e.push(p[0]);else if(f=p[3]){f=f.toLowerCase();if(!/="/.test(f)){var o={},y;p=p[4];var i=!!(p&&p.charAt(p.length-1)=="/");if(p)for(;y=A.exec(p);){var a=y[1].toLowerCase();y=y[2]||y[3]||y[4]||"";o[a]=!y&&z[a]?a:y}this.va(f,o,i);if(!e&&t.rc[f])e=[]}}else if(f=p[2])this.La(f)}s.length>g&&this.la(s.substring(g,
s.length))}});J.j=B;J.HtmlParser=B});
KISSY.Editor.add("htmlparser-basicwriter",function(){function q(){this.c={k:[]}}var B=KISSY,u=B.Editor,J=u.l;B.augment(q,{lb:function(A){this.c.k.push("<",A)},mb:function(A,z){z?this.c.k.push(" />"):this.c.k.push(">")},bb:function(A,z){if(typeof z=="string")z=J.cc(z);this.c.k.push(" ",A,'="',z,'"')},cb:function(A){this.c.k.push("</",A,">")},text:function(A){this.c.k.push(A)},N:function(A){this.c.k.push("<!--",A,"--\>")},write:function(A){this.c.k.push(A)},reset:function(){this.c.k=[];this.c.B=X},
Xb:function(A){var z=this.c.k.join("");A&&this.reset();return z}});u.j.vb=q;u.j.BasicWriter=q;B=q.prototype;u.l.o(B,{openTag:B.lb,openTagClose:B.mb,attribute:B.bb,closeTag:B.cb,text:B.text,comment:B.N,write:B.write,reset:B.reset,getHtml:B.Xb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function q(){q.Lf.constructor.call(this);this.fd="\t";this.Oe=" />";this.Ge="\n";this.se=z;this.Pe=A;this.c.B=z;this.c.G="";this.c.rules={};var t=u.m,s;for(s in J.mix({},t.ub,t.Qa,t.tb,t.vc))this.xa(s,{B:A,de:A,Pb:A,Oc:!t[s]["#"],ce:A});this.xa("br",{Pb:A});this.xa("title",{B:z,Pb:z});this.xa("style",{B:z,Oc:A});this.xa("pre",{B:z})}var B=KISSY,u=B.Editor,J=u.l,A=S,z=X;B.extend(q,u.j.vb,{lb:function(t){var s=this.c.rules[t];if(this.c.B)this.G();
else if(s&&s.de){this.Ja();this.G()}this.c.k.push("<",t)},mb:function(t,s){var p=this.c.rules[t];if(s)this.c.k.push(this.Oe);else{this.c.k.push(">");if(p&&p.B)this.c.G+=this.fd}p&&p.Pb&&this.Ja()},bb:function(t,s){if(typeof s=="string"){this.se&&(s=s.replace(/&amp;/g,"&"));s=J.cc(s)}this.c.k.push(" ",t,'="',s,'"')},cb:function(t){var s=this.c.rules[t];if(s&&s.B)this.c.G=this.c.G.substr(this.fd.length);if(this.c.B)this.G();else if(s&&s.Oc){this.Ja();this.G()}this.c.k.push("</",t,">");s&&s.ce&&this.Ja()},
text:function(t){if(this.c.B){this.G();t=J.Ka(t)}this.c.k.push(t)},N:function(t){this.c.B&&this.G();this.c.k.push("<!--",t,"--\>")},Ja:function(){this.c.k.length>0&&this.c.k.push(this.Ge);this.c.B=A},G:function(){this.c.k.push(this.c.G);this.c.B=z},xa:function(t,s){var p=this.c.rules[t];if(p)J.mix(p,s);else this.c.rules[t]=s}});u.j.cf=q;u.j.HtmlWriter=q;B=q.prototype;u.l.o(B,{openTag:B.lb,openTagClose:B.mb,attribute:B.bb,closeTag:B.cb,text:B.text,comment:B.N,lineBreak:B.Ja,indentation:B.G,setRules:B.xa})});
KISSY.Editor.add("htmlparser-fragment",function(){function q(){this.children=[];this.parent=J;this.c={R:B,bc:u}}var B=S,u=X,J=T,A=KISSY.Editor,z={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},t=KISSY,s=A.l,p=A.n,f=A.m,g=s.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),e=f.Ed,o=f.tb;q.yb=function(y,i){function a(h){var r;if(n.length>0)for(var v=0;v<n.length;v++){var m=n[v],C=m.name,P=f[C],M=k.name&&f[k.name];if((!M||M[C])&&(!h||!P||P[h]||!f[h])){if(!r){b();r=1}m=m.clone();
m.parent=k;k=m;n.splice(v,1);v--}}}function b(){for(;l.length;)k.add(l.shift())}function d(h,r,v){r=r||k||w;if(i&&!r.type){var m,C;if((m=h.attributes&&(C=h.attributes._ke_real_element_type)?C:h.name)&&!(m in f.qc)&&!(m in f.ub)){m=k;k=r;j.va(i,{});r=k;if(v)k=m}}if(h.c.R&&h.name!="pre"){v=h.children.length;if((m=h.children[v-1])&&m.type==p.f)if(C=s.Ma(m.value))m.value=C;else h.children.length=v-1}r.add(h);if(h.ob){k=h.ob;delete h.ob}}var j=new A.j,w=new q,n=[],l=[],k=w,D=u,I;j.va=function(h,r,v){var m=
new A.j.wc(h,r);if(m.fc&&v)m.ib=B;if(f.aa[h])n.push(m);else{if(h=="pre")D=B;else if(h=="br"&&D){k.add(new A.j.Bb("\n"));return}if(h=="br")l.push(m);else{var C=k.name,P=C&&(f[C]||(k.c.R?f.div:f.span));if(P&&!m.fc&&!k.fc&&!P[h]){P=u;var M;if(h in e&&C in e){C=k.children;(C=C[C.length-1])&&C.name in o||d(C=new A.j.wc("li"),k);I=k;M=C}else if(h==C)d(k,k.parent);else{if(g[C])I||(I=k);else{d(k,k.parent,B);z[C]||n.unshift(k)}P=B}k=M?M:k.ob||k.parent;if(P){j.va.apply(this,arguments);return}}a(h);b();m.parent=
k;m.ob=I;I=0;if(m.ib)d(m);else k=m}}};j.ud=function(h){for(var r=n.length-1;r>=0;r--)if(h==n[r].name){n.splice(r,1);return}for(var v=[],m=[],C=k;C.type&&C.name!=h;){C.c.R||m.unshift(C);v.push(C);C=C.parent}if(C.type){for(r=0;r<v.length;r++){var P=v[r];d(P,P.parent)}k=C;if(k.name=="pre")D=u;C.c.R&&b();d(C,C.parent);if(C==k)k=k.parent;n=n.concat(m)}if(h=="body")i=u};j.la=function(h){if(!k.c.bc&&!D){h=s.Ka(h);if(h.length===0)return}b();a();if(i&&(!k.type||k.name=="body")&&s.trim(h))this.va(i,{});D||
(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));k.add(new A.j.Bb(h))};j.pd=function(){};j.La=function(h){k.add(new A.j.Fd(h))};j.parse(y);for(b();k.type;){var x=k.parent,c=k;if(i&&(!x.type||x.name=="body")&&!f.qc[c.name]){k=x;j.va(i,{});x=k}x.add(c);k=x}return w};t.augment(q,{add:function(y){var i=this.children.length;if(i=i>0&&this.children[i-1]||J){if(y.c.R&&i.type==p.f){i.value=s.Ma(i.value);if(i.value.length===0){this.children.pop();this.add(y);return}}i.next=y}y.nb=i;y.parent=this;this.children.push(y);
this.c.bc=y.type==p.f||y.type==p.e&&!y.c.R},$:function(y,i){var a;this.filterChildren=this.Vb=function(){var b=new A.j.vb;this.U.call(this,b,i,B);b=b.Xb();this.children=(new q.yb(b)).children;a=1};!this.name&&i&&i.rd(this);this.U(y,a?J:i)},U:function(y,i){for(var a=0;a<this.children.length;a++)this.children[a].$(y,i)}});A.j.ya=q;A.j.Fragment=q;q.FromHtml=q.yb;t=q.prototype;A.l.o(t,{add:t.add,writeHtml:t.$,writeChildrenHtml:t.U})});
KISSY.Editor.add("htmlparser-element",function(){function q(z,t){z=z[0];t=t[0];return z<t?-1:z>t?1:0}function B(z,t){this.name=z;this.attributes=t||(t={});this.children=[];var s=t.rf||z,p=u.m;s=!!(p.ub[s]||p.Qa[s]||p.tb[s]||p.vc[s]||p.uc[s]||s=="br");var f=!!p.sb[z];this.ib=f;this.fc=!p[z];this.c={R:s,bc:f||!s}}var u=KISSY.Editor,J=u.n;KISSY.augment(B,{type:J.e,add:u.j.ya.prototype.add,clone:function(){return new B(this.name,this.attributes)},$:function(z,t){var s=this.attributes,p=this,f=p.name,
g,e,o,y;p.Vb=function(){if(!y){var b=new u.j.vb;u.j.ya.prototype.U.call(p,b,t);p.children=(new u.j.ya.yb(b.Xb())).children;y=1}};p.filterChildren=p.Vb;if(t){for(;;){if(!(f=t.qd(f)))return;p.name=f;if(!(p=t.hc(p)))return;p.parent=this.parent;if(p.name==f)break;if(p.type!=J.e){p.$(z,t);return}f=p.name;if(!f){this.U.call(p,z,y?T:t);return}}s=p.attributes}z.lb(f,s);for(var i=[],a=0;a<2;a++)for(g in s){e=g;o=s[g];if(a==1)i.push([g,o]);else if(t){for(;;)if(e=t.od(g))if(e!=g){delete s[g];g=e}else break;
else{delete s[g];break}if(e)if((o=t.nd(p,e,o))===X)delete s[e];else s[e]=o}}z.Pe&&i.sort(q);s=i.length;for(a=0;a<s;a++){g=i[a];z.bb(g[0],g[1])}z.mb(f,p.ib);if(!p.ib){this.U.call(p,z,y?T:t);z.cb(f)}},U:function(){u.j.ya.prototype.U.apply(this,arguments)}});u.j.wc=B;u.j.Element=B;var A=B.prototype;u.l.o(A,{type:A.type,add:A.add,clone:A.clone,writeHtml:A.$,writeChildrenHtml:A.U})});
KISSY.Editor.add("htmlparser-filter",function(){function q(g){this.c={Sb:[],Mb:[],elements:{tc:0},attributes:{tc:0}};g&&this.Nc(g,10)}function B(g,e){for(var o=0;g&&o<e.length;o++){var y=e[o];g=g.replace(y[0],y[1])}return g}function u(g,e,o){if(typeof e=="function")e=[e];var y,i;i=g.length;var a=e&&e.length;if(a){for(y=0;y<i&&g[y].lc<o;y++);for(i=a-1;i>=0;i--)if(a=e[i]){a.lc=o;g.splice(y,0,a)}}}function J(g,e,o){if(e)for(var y in e){var i=g[y];g[y]=A(i,e[y],o);i||g.tc++}}function A(g,e,o){if(e){e.lc=
o;if(g){if(g.splice)u(g,e,o);else{g=g.lc>o?[e,g]:[g,e];g.filter=z}return g}else return e.filter=e}}function z(g){for(var e=g.type||g instanceof s.j.ya,o=0;o<this.length;o++){if(e)var y=g.type,i=g.name;var a=this[o].apply(window,arguments);if(a===f)return a;if(e){if(a&&(a.name!=i||a.type!=y))return a}else if(typeof a!="string")return a;a!=undefined&&(g=a)}return g}var t=KISSY,s=t.Editor,p=s.n,f=X;t.augment(q,{Nc:function(g,e){if(typeof e!="number")e=10;u(this.c.Sb,g.Sb,e);u(this.c.Mb,g.Mb,e);J(this.c.elements,
g.elements,e);J(this.c.attributes,g.attributes,e);this.c.text=A(this.c.text,g.text,e)||this.c.text;this.c.N=A(this.c.N,g.N,e)||this.c.N;this.c.pb=A(this.c.pb,g.pb,e)||this.c.pb},qd:function(g){return B(g,this.c.Sb)},od:function(g){return B(g,this.c.Mb)},la:function(g){var e=this.c.text;return e?e.filter(g):g},La:function(g,e){var o=this.c.N;return o?o.filter(g,e):g},rd:function(g){var e=this.c.pb;return e?e.filter(g):g},hc:function(g){for(var e=[this.c.elements["^"],this.c.elements[g.name],this.c.elements.Xe],
o,y=0;y<3;y++)if(o=e[y]){o=o.filter(g,this);if(o===f)return T;if(o&&o!=g)return this.sd(o);if(g.parent&&!g.name)break}return g},sd:function(g){var e=g.type;return e==p.e?this.hc(g):e==p.f?new s.j.Bb(this.la(g.value)):T},nd:function(g,e,o){if(e=this.c.attributes[e]){g=e.filter(o,g,this);if(g===f)return f;if(typeof g!="undefined")return g}return o}});s.j.bf=q;t=q.prototype;s.l.o(t,{addRules:t.Nc,onElementName:t.qd,onAttributeName:t.od,onText:t.la,onComment:t.La,onFragment:t.rd,onElement:t.hc,onNode:t.sd,
onAttribute:t.nd});s.j.Filter=q});KISSY.Editor.add("htmlparser-text",function(){function q(A){this.value=A;this.c={R:J}}var B=KISSY,u=B.Editor,J=X;B.augment(q,{type:u.n.f,$:function(A,z){var t=this.value;z&&!(t=z.la(t,this))||A.text(t)}});u.j.Bb=q;u.j.Text=q});
KISSY.Editor.add("htmlparser-comment",function(){function q(J){this.value=J;this.c={R:X}}var B=KISSY.Editor,u=B.n;B.j.Fd=q;B.j.Comment=q;q.prototype={constructor:q,type:u.Hd,$:function(J,A){var z=this.value;if(A){if(!(z=A.La(z,this)))return;if(typeof z!="string"){z.parent=this.parent;z.$(J,A);return}}J.N(z)}}});
