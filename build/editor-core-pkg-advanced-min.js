/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-10 13:03:14
*/
var T=true,U=null,X=false;
KISSY.add("editor",function(o,B){function u(j,a){function b(w){for(var i=u.Env.mods,k=0;k<w.length;k++){for(var E=w[k],G=z,m=0;m<k;m++)if(E==w[m]){G=v;break}m=i[E];if(G&&m){G=o.clone(m);E=E+"_"+k;G.name=E;w[k]=E;i[E]||(i[E]=G)}}}var d=this;if(!(d instanceof u))return new u(j,a);if(o.isString(j))j=o.one(j);j=y.D(j);a=a||{};a.Le=a.pluginConfig||{};d.ia=a;a.pluginConfig=a.Le;d.cfg=a;o.app(d,o.EventTarget);var l=["htmldataprocessor","enterkey","clipboard"],x=z;d.use=function(w,i){w=w.split(",");b(w);
if(!x)for(var k=0;k<l.length;k++){var E=l[k];o.inArray(E,w)||w.unshift(E)}o.use.call(d,w.join(","),function(){d.ready(function(){i&&i.call(d);if(!x){d.setData(j.val());if(a.focus)d.focus();else{var G=d.getSelection();G&&G.removeAllRanges()}d.fire("save");x=v}})},{order:v,global:u});return d};d.use=d.use;d.Ce(j);return d}function J(j){var a=o.Config.debug;j=a?a==="dev"?"../src/"+j:j:j.replace(/\.(js|css)/i,"-min.$1");j+=j.indexOf("?")!=-1?"&":"?";j+="t="+encodeURIComponent("2010-11-10 13:03:14");return j}
var y=o.DOM,v=T,z=X;o.app(u,o.EventTarget);u.Config.base=o.Config.base+"editor/";var r=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",
requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],q,f,g,e,p={};q=0;for(f=r.length;q<f;q++){g=r[q];if(o.isString(g))g=r[q]={name:g+"",requires:U};e=g.requires||[];var A=["button"];g.name.indexOf("/dialog")!=-1&&A.push("overlay");g.requires=e.concat(A)}r=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},
{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(r);q=0;for(f=r.length;q<f;q++){g=r[q];e=g.name;p[e]={attach:z,charset:"utf-8",requires:g.requires,csspath:g.Pf?J("plugins/"+e+"/plugin.css"):B,path:J("plugins/"+e+"/plugin.js")}}u.add(p);o.Editor=u;o.Editor=u});
KISSY.Editor.add("utils",function(o){var B=U,u=KISSY,J=u.Node,y=u.DOM,v=u.UA,z=u.Event,r;if(v.ie)r=document.documentMode||v.ie;var q={Uc:function(f){var g=u.Config.debug;f=g?g==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-11-17 18:19:09");return f},He:function(f,g,e){var p=f[g],A=f[e];f[g]=function(){p.apply(this,arguments);f[g]=f[e];return A.apply(this,arguments)}},ye:function(f,g,e,p){e=e.defaultView||e.parentWindow;f-=y.scrollLeft(e);
g-=y.scrollTop(e);if(p)if(e!=(p.defaultView||p.parentWindow)&&e.frameElement){p=y.Fb(e.frameElement,p);f+=p.left;g+=p.top}return{left:f,top:g}},Dd:function(){for(var f,g=0,e=arguments.length;g<e;g++){var p=arguments[g];try{f=p();break}catch(A){}}return f},de:function(f,g){if(!f&&!g)return T;if(!f||!g||f.length!=g.length)return X;for(var e=0;e<f.length;e++)if(f[e]!==g[e])return X;return T},Yc:function(f,g,e){f=f.documentElement;for(var p=0;f&&p<g.length;p++){var A=g[p];if(e)for(var j=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(e===T&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){j++;if(j==A){f=b;break}}}else f=f.childNodes[A]}return f?new J(f):B},le:function(f){for(var g in f)f[g].Cc(f,T)},dc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ja:function(f){return f.replace(/^\s+/,"")},La:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ja(this.La(f))},mix:function(){for(var f={},g=0;g<arguments.length;g++)f=u.mix(f,arguments[g]);
return f},hb:function(){if(!v.ie)return X;var f=document.domain,g=window.location.hostname;return f!=g&&f!="["+g+"]"},qe:function(f,g){return Array(g+1).join(f)},Te:function(f,g,e){e=e||150;if(e===-1)return function(){f.apply(g,arguments)};var p=(new Date).getTime();return function(){var A=(new Date).getTime();if(A-p>e){p=A;f.apply(g,arguments)}}},ge:function(f,g,e){e=e||0;var p=B;return function(){p&&clearTimeout(p);var A=arguments;p=setTimeout(function(){return f.apply(g,A)},e)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(u.trim(f))},
Ve:function(f){for(var g=0;g<f.length;g++){var e=y.D(f[g]),p=u.trim(e.val()),A=e.attr("data-verify");e=e.attr("data-warning");if(A&&!RegExp(A).test(p)){alert(e);return X}}return T},Re:function(f,g){f.on("sourcemode",g.yf,g);f.on("wysiwygmode",g.Ef,g)},Ne:function(f){var g=f.attr("placeholder");if(g&&!v.webkit){f.addClass("ke-input-tip");f.val(g)}else v.webkit&&f.val("")},Qf:function(f,g){f.removeClass("ke-input-tip");f.val(g)},Ke:function(f,g){f.attr("placeholder",g);if(!v.webkit){f.on("blur",function(){if(!u.trim(f.val())){f.addClass("ke-input-tip");
f.val(g)}});f.on("focus",function(){f.removeClass("ke-input-tip");u.trim(f.val())==g&&f.val("")})}},ke:function(f){f=f[0]||f;for(var g=u.makeArray(f.childNodes),e=0;e<g.length;e++){var p=g[e];p.nodeType==o.n.f&&!u.trim(p.nodeValue)&&f.removeChild(p)}},Be:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},Ae:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},se:function(f,
g){return f.toLowerCase()==g.toLowerCase()},md:function(f){f=u.clone(f);for(var g in f)if(f.hasOwnProperty(g)){var e=f[g];if(u.isFunction(e))f[g]=e()}return f},pe:function(f,g,e){function p(){var x={responseText:"",responseXML:B};x.ce=f?f.ce:B;try{var w;if((w=v.ie?j.contentWindow.document:j.contentDocument||window.frames[A].document)&&w.body)x.responseText=w.body.innerHTML;x.responseXML=w&&w.XMLDocument?w.XMLDocument:w}catch(i){u.log(i)}z.remove(j,"load",p);f.he&&f.he(x);setTimeout(function(){y.h(j)},
100)}var A=u.guid("form-upload-"),j=document.createElement("iframe");j.id=A;j.name=A;j.className="ke-hidden";var a="document.open();"+(q.hb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(v.ie)j.src=v.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";u.log("doFormUpload : "+j.src);document.body.appendChild(j);if(v.ie)document.frames[A].name=A;a=y.Kc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=A;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(e)a.action=e;var d;if(g){d=[];g=o.k.md(g);for(var l in g)if(g.hasOwnProperty(l)){e=document.createElement("input");e.type="hidden";e.name=l;e.value=g[l];a.appendChild(e);d.push(e)}}z.on(j,"load",p);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(d){g=0;for(l=d.length;g<l;g++)y.h(d[g])}return j},o:function(f,g){for(var e in g)f[e]=g[e]},map:function(f,g){for(var e=0;e<f.length;e++)f[e]=
g(f[e]);return f},ec:r};o.k=q;o.Utils=q;q.o(q,{debugUrl:q.Uc,lazyRun:q.He,getXY:q.ye,tryThese:q.Dd,arrayCompare:q.de,getByAddress:q.Yc,clearAllMarkers:q.le,htmlEncodeAttr:q.dc,ltrim:q.Ja,rtrim:q.La,trim:q.trim,mix:q.mix,isCustomDomain:q.hb,duplicateStr:q.qe,buffer:q.ge,isNumber:q.isNumber,verifyInputs:q.Ve,sourceDisable:q.Re,resetInput:q.Ne,placeholder:q.Ke,clean:q.ke,htmlEncode:q.Be,htmlDecode:q.Ae,equalsIgnoreCase:q.se,normParams:q.md,throttle:q.Te,doFormUpload:q.pe,map:q.map})});
KISSY.Editor.add("focusmanager",function(o){function B(){this.fc=q;r=this}function u(){this.fc=f;r=g}var J=KISSY,y=J.DOM,v=J.Event,z={},r;J={If:function(){for(var e in z){var p=z[e];p.document.designMode="off";p.document.designMode="on"}},xf:function(){return r},ve:function(e){return z[e]},add:function(e){var p=y.fa(e.document);v.on(p,"focus",B,e);v.on(p,"blur",u,e)},Me:function(e){z[e.Kb]=e},remove:function(e){delete z[e.Kb];var p=y.fa(e.document);v.remove(p,"focus",B,e);v.remove(p,"blur",u,e)}};
var q=T,f=X,g=U;o.te=J;o.focusManager=J;o.ad=function(){return z};o.getInstances=o.ad});
KISSY.Editor.add("definition",function(o){var B=T,u=X,J=document,y=KISSY,v=y.UA,z=y.DOM,r=y.Node,q=y.Event,f=o.te,g=o.k.Dd,e=o.k.Uc("theme/editor-iframe.css"),p=1,A="document.open();"+(o.k.hb()?'document.domain="'+J.domain+'";':"")+"document.close();",j="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(v.ie?
"javascript:void(function(){"+encodeURIComponent(A)+"}())":"")+'"  tabIndex="'+(v.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";o.Ac=0;o.Wa=1;o.SOURCE_MODE=o.Ac;o.WYSIWYG_MODE=o.Wa;y.augment(o,{Ce:function(a){if(v.ie)z.addClass(J.body,"ie"+v.ie);else if(v.gecko)z.addClass(J.body,"gecko");else v.webkit&&z.addClass(J.body,"webkit");var b=this,d=new r(j.replace(/\$\(tabIndex\)/,a.attr("tabIndex")));d.on("mousedown",
function(w){if(v.webkit){var i=z.d(w.target);if(i=="select"||i=="option")return B}w.halt()});a.on("mousedown",function(w){w.stopPropagation()});b.Cf=d;b.Kb=p++;f.Me(b);b.rb=d.one(".ke-textarea-wrap");b.wrap=b.rb;b.gb=b.rb.one("iframe");b.iframe=b.gb;b.Cd=d.one(".ke-editor-tools");b.toolBarDiv=b.Cd;b.$=a;b.textarea=b.$;b.Se=d.one(".ke-editor-status");b.statusDiv=b.Se;b.Cd.Jc();b.Lb={};b.Lc={};var l=a.M("width"),x=a.M("height");if(l){d.css("width",l);a.css("width","100%")}b.$.css("display","none");
d.insertAfter(a);b.rb[0].appendChild(a[0]);if(x){b.rb.css("height",x);a.css("height","100%")}d=b.gb;b.on("dataReady",function(){b.Xd=B;o.fire("instanceCreated",{re:b})});v.gecko?d.on("load",b.Nc,b):b.Nc();b.ia.wf&&a[0].form&&b.Vd()},Vd:function(){(new r(this.$[0].form)).on("submit",this.Bd,this)},Ue:function(a,b){var d=this,l=o.of;l.Ff();d.use(a,function(){var x=d.Zc(a);b(x);l.Of()})},$d:function(a,b){this.Lc[a]=b},Zc:function(a){return this.Lc[a]},ae:function(a){this.ready(a)},Yd:function(a,b){this.Lb[a]=
b},ze:function(a){return this.Lb[a]},execCommand:function(a){var b=this.Lb[a],d=y.makeArray(arguments);d.shift();d.unshift(this);return b.exec.apply(b,d)},Zb:function(){return this.$.css("display")=="none"?o.Wa:o.Ac},getData:function(a){var b;b=this.Zb()==o.Wa?this.document.body.innerHTML:this.$.val();if(this.htmlDataProcessor)b=a?this.htmlDataProcessor.toHtml(b,"p"):this.htmlDataProcessor.toServer(b,"p");b=y.trim(b);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(b))b="";return b},setData:function(a){var b=a;
if(this.htmlDataProcessor)b=this.htmlDataProcessor.toDataFormat(a,"p");this.document.body.innerHTML=b;this.Zb()!=o.Wa&&this.$.val(a)},Bd:function(){this.$.val(this.getData())},Ea:function(a){a=a||0;return a+(this.ia.Ea||0)},rf:function(){return this.document.body.innerHTML},tf:function(a){this.document.body.innerHTML=a},Wd:function(a){var b=this.ia,d=b.ua,l="";if(d)for(var x=0;x<d.length;x++)l+='<link href="'+d[x]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+
o.Config.base+e+"' rel='stylesheet'/><style>"+(b.Sb||"")+"</style>"+l+"</head><body class='ke-editor'>&nbsp;"+(a?'<script id="ke_actscript" type="text/javascript">'+(o.k.hb()?'document.domain="'+J.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':"")+"</body></html>"},getSelection:function(){return o.Bc.getSelection(this.document)},focus:function(){var a=this.document,b=z.fa(a);v.webkit&&b&&b.parent&&b.parent.focus();b&&b.focus();a&&a.body.focus();this.kb()},blur:function(){z.fa(this.document).blur();
this.document&&this.document.body.blur()},Zd:function(a){var b=this.ia,d=this.document;b.Sb=b.Sb||"";b.Sb+="\n"+a;b=d.createElement("style");d.getElementsByTagName("head")[0].appendChild(b);if(b.styleSheet)b.styleSheet.cssText=a;else b.appendChild(d.createTextNode(a))},vf:function(a){var b=this.ia,d=this.document;b.ua=b.ua||[];b.ua.push(a);b=d.createElement("link");b.rel="stylesheet";d.getElementsByTagName("head")[0].appendChild(b);b.href=a},Jf:function(a){for(var b=this.ia,d=y.makeArray(this.document.getElementsByTagName("link")),
l=0;l<d.length;l++)d[l].href==a&&z.h(d[l]);b.ua=b.ua||[];b=b.ua;a=y.indexOf(a,b);a!=-1&&b.splice(a,1)},Nc:function(){function a(){w=x.document;b.document=w;d.detach();w.open("text/html","replace");w.write(l);w.close()}var b=this,d=b.gb,l=b.Wd(b.Kb),x=d[0].contentWindow,w;try{w=x.document}catch(i){d[0].src=d[0].src;if(v.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this.Xd?a():this.on("dataReady",a)},ab:function(){var a=this;a.Mc&&clearTimeout(a.Mc);a.Mc=setTimeout(function(){var b=a.getSelection();
if(b&&!b.jd){var d=b.ac(),l=new o.Ra(d);if(!a.lc||!a.lc.Sc(l)){a.lc=l;a.fire("selectionChange",{selection:b,path:l,element:d})}}},100)},kb:function(){this.lc=U;this.ab()},hd:function(a,b){var d=this;d.focus();var l=a.d(),x=o.m,w=o.oa,i=o.n,k=x.Pa[l],E=d.getSelection(),G=E&&E.A(),m,c,h,n,t;if(!G||G.length==0){var s=arguments,C=s.callee;setTimeout(function(){C.apply(d,s)},30)}else{d.fire("save");for(var O=G.length-1;O>=0;O--){m=G[O];m.deleteContents();c=!O&&a||a.K(B);b&&b(c);if(k)for(;(n=m.va(u,B))&&
(t=x[n.d()])&&!(t&&t[l]);)if(n.d()in x.span)m.qc(n);else if(m.ta()&&m.ka()){m.setStartBefore(n);m.collapse(B);n.h()}else m.pc();m.insertNode(c);h||(h=c)}if(h){l=h.w(B);x=d.document;t=o.m;if(t.tc[c.d()]){l=new r(x.createTextNode(" "));l.insertAfter(h)}else if(l){if(l.d()=="br"&&t[l.parent().d()].p){t=new r("<p>&nbsp;</p>",U,x);l[0].parentNode.replaceChild(t[0],l[0]);l=t}}else{t=new r("<p>&nbsp;</p>",U,x);t.insertAfter(h);l=t}m.H(h,w.t);l&&l[0].nodeType==i.e&&m.jb(l);E.qb([m]);d.focus();c&&c.Jb();setTimeout(function(){d.fire("save")},
10);return c}}},De:function(a){var b=this;if(b.htmlDataProcessor)a=b.htmlDataProcessor.toDataFormat(a);if(v.webkit){var d=z.create(a,U,this.document);d=d.nodeType==11?y.makeArray(d.childNodes):[d];for(var l=0;l<d.length;l++)b.hd(new r(d[l]))}else{b.focus();l=(d=b.getSelection())&&d.A();if(!l||l.length==0){var x=arguments,w=x.callee;setTimeout(function(){w.apply(b,x)},30)}else{b.fire("save");if(v.ie){d=d.r();d.type=="Control"&&d.clear();d.createRange().pasteHTML(a)}else b.document.execCommand("inserthtml",
u,a);b.focus();setTimeout(function(){b.fire("save")},10)}}}});o._initIFrame=function(a){function b(m){g(function(){x.designMode="on";setTimeout(function(){x.designMode="off";i.focus();if(!arguments.callee.Oe)arguments.callee.Oe=B},50)},function(){x.designMode="off";z.attr(i,"contentEditable",u);z.attr(i,"contentEditable",B);!m&&b(1)})}var d=f.ve(a);a=d.$[0];var l=d.gb[0].contentWindow,x=d.document,w=d.ia;z.h(x.getElementById("ke_actscript"));var i=x.body;if(v.ie){i.hideFocus=B;i.disabled=B;i.contentEditable=
B;i.removeAttribute("disabled")}else setTimeout(function(){if(v.gecko||v.opera)i.contentEditable=B;else if(v.webkit)i.parentNode.contentEditable=B;else x.designMode="on"},0);if(v.webkit){q.on(x,"click",function(m){var c=new r(m.target);y.inArray(c.d(),["input","select"])&&m.preventDefault()});q.on(x,"mouseup",function(m){var c=new r(m.target);y.inArray(c.d(),["input","textarea"])&&m.preventDefault()})}if(v.gecko||v.ie||v.opera){var k;k=new r(z.insertAfter((new r('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
a));k.on("focus",function(){d.focus()});d.uf=function(){v.gecko&&d.fc&&k[0].focus()};d.on("destroy",function(){})}if(v.ie&&x.compatMode=="CSS1Compat"||v.gecko||v.opera){var E=new r(x.documentElement);E.on("mousedown",function(m){if(m.target==E[0]){v.gecko&&b(u);k[0].focus()}})}q.on(l,"focus",function(){if(v.gecko)b(u);else v.opera&&i.focus();d.kb()});v.gecko&&q.on(d.document,"mousedown",function(){d.fc||b(u)});if(v.ie){q.on(x,"keydown",function(m){if(m.keyCode in{8:1,46:1}){var c=d.getSelection(),
h=c.$b();if(h){d.fire("save");var n=c.A()[0].P();h.h();c.xd([n]);d.fire("save");m.preventDefault()}}});if(x.compatMode=="CSS1Compat"){var G={33:1,34:1};q.on(x,"keydown",function(m){m.keyCode in G&&setTimeout(function(){d.getSelection().scrollIntoView()},0)})}}setTimeout(function(){v.ie&&setTimeout(function(){if(x){i.runtimeStyle.marginBottom="0px";i.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){d.fire("dataReady");var m=w.Af,c=w.zf;if(m||c)try{x.execCommand("enableObjectResizing",
u,!m);x.execCommand("enableInlineTableEditing",u,!c)}catch(h){q.on(i,v.ie?"resizestart":"resize",function(n){if(m||z.d(n.target)==="table"&&c)n.preventDefault()})}},10);v.webkit&&q.on(x,"mousedown",function(m){m=new r(m.target);y.inArray(m.d(),["img","hr","input","textarea","select"])&&d.getSelection().oc(m)});v.gecko&&q.on(x,"dragstart",function(m){var c=new r(m.target);c.d()==="img"&&/ke_/.test(c[0].className)&&m.preventDefault()});f.add(d)};A=o.prototype;o.k.o(A,{setData:A.setData,getData:A.getData,
insertElement:A.hd,insertHtml:A.De,ready:A.ready,addCustomStyle:A.Zd,addCommand:A.Yd,hasCommand:A.ze,execCommand:A.execCommand,addPlugin:A.ae,useDialog:A.Ue,addDialog:A.$d,getDialog:A.Zc,getMode:A.Zb,sync:A.Bd,baseZIndex:A.Ea,getSelection:A.getSelection,focus:A.focus,blur:A.blur,notifySelectionChange:A.kb})});
KISSY.Editor.add("zindex",function(){var o=KISSY.Editor;if(!o.Ed){o.Ed={af:1100,kf:1200,bf:99999,gf:900,jf:9999,LOADING:11E3,ff:12E3,lf:1200};o.Ea=function(B){var u=B,J=o.ad(),y;for(y in J){if(!J.hasOwnProperty(y))return;u=Math.max(u,J[y].Ea(B))}return u};o.baseZIndex=o.Ea;o.zIndexManager=o.Ed}});
KISSY.Editor.add("dtd",function(o){o.m=function(){function B(i){for(var k=arguments.length-1;k>0;)KISSY.mix(i,arguments[k--]);return i}var u={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},y=B({a:1},J),v=B({iframe:1},y),z={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},r={ins:1,del:1,script:1,style:1},q=B({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},r),f=B({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},q),g=B({p:1},f);J=B({iframe:1},f,J);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=B({a:1},J),p={tr:1},A={"#":1},j=B({param:1},f),a=B({form:1},u,v,z,g),b={li:1},d={base:1,link:1,meta:1,title:1},l=B(d,{style:1,script:1}),x={head:1,body:1},w={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{ub:B({html:1},x,d),Pa:w,Ze:{body:1,div:1,td:1,th:1,caption:1,
form:1},tc:e,rc:B({script:1,style:1},w),sc:{script:1,style:1},sb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},tb:{dd:1,dt:1,li:1},Fd:{ul:1,ol:1,dl:1},vc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},ba:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$e:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},wc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:x,head:l,style:A,body:a,base:{},link:{},meta:{},title:A,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:B(g,z),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:b,h1:e,h3:e,option:A,h2:e,form:B(u,v,z,g),select:{optgroup:1,option:1},font:e,ins:e,menu:b,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:A,tfoot:p,cite:e,li:a,input:{},iframe:a,
strong:e,textarea:A,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:j,sup:e,dd:a,strike:e,area:{},dir:b,map:B({area:1,form:1,p:1},u,r,z),applet:j,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:B({legend:1},f),thead:p,ul:b,acronym:e,b:e,a:J,blockquote:a,caption:e,i:e,u:e,tbody:p,s:e,address:B(v,g),tt:e,legend:e,q:e,pre:B(q,y),p:e,em:e,dfn:e}}();o.XHTML_DTD=o.m});
KISSY.Editor.add("dom",function(o){function B(a){if(a&&!a[0])return new r(a);return a}function u(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var y=KISSY,v=y.DOM,z=y.UA,r=y.Node,q=o.k,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};o.n={e:1,f:3,Id:8,hf:11};o.NODE=o.n;o.Sa={da:0,Jd:1,ca:2,Y:4,X:8,yc:16};o.POSITION=
o.Sa;var g=o.n,e=o.Sa,p={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},A={hr:1},j={D:B,Kc:u,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return X;a=u(a);b=u(b);return a===b},qa:function(a,b){a=B(a);var d=y.mix(y.mix({},A),b||{});return p[a.css("display")]||d[a.d()]},fa:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
X},v:function(a){a=u(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Nd:function(a,b){a=u(a);var d=a.firstChild;if((d=d&&new r(d))&&b&&!b(d))d=d.Ya(b);return d},Hc:function(a,b,d){a=u(a);v.h(a);b=u(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(z.ie)if((a=a.Kf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Fc:function(a,b){if(a.d()!=b.d())return X;var d=a[0].attributes,l=b[0].attributes,x=d.length,
w=l.length;if(x!=w)return X;for(var i=0;i<x;i++){var k=d[i],E=k.name;if(k.specified&&a.attr(E)!=b.attr(E))return X}if(q.ec<8)for(i=0;i<w;i++){k=l[i];E=k.name;if(k.specified&&a.attr(E)!=b.attr(E))return X}return T},Gb:function(a){a=u(a).childNodes;for(var b=0,d=a.length;b<d;b++){var l=a[b],x=l.nodeType;if(!(x==g.e&&l.getAttribute("_ke_bookmark")))if(x==g.e&&!j.Gb(l)||x==g.f&&y.trim(l.nodeValue))return X}return T},Hb:function(a,b,d){a=u(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},ra:function(){function a(b,d,l){if(d[0]&&d[0].nodeType==g.e){for(var x=[];d.attr("_ke_bookmark")||d.Gb();){x.push(d);d=l?new r(d[0].nextSibling):new r(d[0].previousSibling);if(!d[0]||d[0].nodeType!=g.e)return}if(b.Fc(d)){for(var w=l?b[0].lastChild:b[0].firstChild;x.length;)x.shift().Hc(b,!l);d.Hb(b,!l);d.h();w[0]&&w[0].nodeType==g.e&&w.ra()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new r(b[0].nextSibling),T);
a(b,new r(b[0].previousSibling))}}}(),Jc:z.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:z.webkit?function(a){a=u(a);a.style.ef="none"}:function(a){a=u(a);if(z.ie||z.opera){var b,d=0;for(a.unselectable="on";b=a.all[d++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},Fb:function(a,b){a=u(a);var d,l=0;d=0;var x=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,w=a.ownerDocument,i=w.documentElement;b=b||
w;if(a.getBoundingClientRect){if(a!==w.body&&i!==a){d=a.getBoundingClientRect();l=d.left+(b===w?v.scrollLeft(x):0);d=d.top+(b===w?v.scrollTop(x):0)}if(b)if(x!=(b.defaultView||b.parentWindow)&&x.frameElement){x=j.Fb(x.frameElement,b);l+=x.left;d+=x.top}}return{left:l,top:d}},Pd:function(a){return(a=u(a))&&a.contentWindow.document},ha:function(a,b){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=g.f)){if(z.ie&&b==a.nodeValue.length){var l=d.createTextNode("");v.insertAfter(l,a);return new r(l)}l=
new r(a.splitText(b));if(d.documentMode){d=d.createTextNode("");v.insertAfter(d,l[0]);v.h(d)}return l}},Ib:function(a,b){a=B(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=u(a);a=a.cloneNode(b);if(!d){var l=function(x){if(x.nodeType==g.e){x.removeAttribute("id");x=x.childNodes;for(var w=0;w<x.length;w++)l(x[w])}};l(a)}return new r(a)},w:function(a,b,d,l){a=u(a);if(l&&!l.call){var x=l[0]||l;l=function(i){i=i[0]||i;return i!==x}}b=!b&&a.firstChild;var w=new r(a);
if(!b){if(a.nodeType==g.e&&l&&l(a,T)===X)return U;b=a.nextSibling}for(;!b&&(w=w.parent());){if(l&&l(w,T)===X)return U;b=w[0].nextSibling}if(!b)return U;b=v.D(b);if(l&&l(b)===X)return U;if(d&&d!=b[0].nodeType)return b.w(X,d,l);return b},ga:function(a,b,d,l){a=u(a);if(l&&!l.call){var x=l[0]||l;l=function(i){i=i[0]||i;return i!==x}}b=!b&&a.lastChild;var w=new r(a);if(!b){if(a.nodeType==g.e&&l&&l(a,T)===X)return U;b=a.previousSibling}for(;!b&&(w=w.parent());){if(l&&l(w,T)===X)return U;b=w[0].previousSibling}if(!b)return U;
b=v.D(b);if(l&&l(b)===X)return U;if(d&&b[0].nodeType!=d)return b.ga(X,d,l);return b},L:z.gecko?function(a,b){a=u(a);b=u(b);return!!(a.compareDocumentPosition(b)&16)}:function(a,b){a=u(a);b=u(b);return b.nodeType!=g.e?a.contains(b.parentNode):a!=b&&a.contains(b)},Eb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=g.f&&b.L(a))return b;var d=a[0].nodeType==g.f?a.parent():a;do if(d[0].nodeType!=g.f&&d.L(b))return d;while(d=d.parent());return U},Ld:function(a,b,d){a=u(a);if(!d)a=a.parentNode;if(b&&
!y.isFunction(b)){var l=b;b=function(x){return x.d()==l}}for(;a&&a.nodeType!=9;){if(!b||b(new r(a))===T)return new r(a);a=a.parentNode}return U},Dc:q.ec<9?function(a,b){a=u(a);var d=a.attributes[b];return!!(d&&d.specified)}:function(a,b){a=u(a);return a.hasAttribute(b)},Xa:q.ec<9?function(a){a=u(a);for(var b=a.attributes,d=0;d<b.length;d++){var l=b[d];switch(l.name){case "class":if(a.getAttribute("class"))return T;break;default:if(l.specified)return T}}return X}:function(a){a=u(a);z.gecko&&a.removeAttribute("_moz_dirty");
return a.hasAttributes()},Da:function(a,b){var d=u(a),l=u(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(l);if(d==l)return e.da;if(d.nodeType==g.e&&l.nodeType==g.e){if(d.contains){if(d.contains(l))return e.yc+e.Y;if(l.contains(d))return e.X+e.ca}if("sourceIndex"in d)return d.sourceIndex<0||l.sourceIndex<0?e.Jd:d.sourceIndex<l.sourceIndex?e.Y:e.ca}d=a.Ca();l=b.Ca();for(var x=Math.min(d.length,l.length),w=0;w<=x-1;w++)if(d[w]!=l[w]){if(w<x)return d[w]<l[w]?e.Y:e.ca;break}return d.length<
l.length?e.yc+e.Y:e.X+e.ca},Ca:function(a,b){a=u(a);for(var d=[],l=a.ownerDocument.documentElement,x=a;x&&x!=l;){var w=x.parentNode,i=-1;if(w){for(var k=0;k<w.childNodes.length;k++){var E=w.childNodes[k];if(!(b&&E.nodeType==3&&E.previousSibling&&E.previousSibling.nodeType==3)){i++;if(E==x)break}}d.unshift(i)}x=w}return d},Db:function(a,b){var d=new o.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var l=d.extractContents();d.insertNode(a.h());a[0].parentNode.insertBefore(l,a[0].nextSibling)},
M:function(a,b,d){a=B(a);if(d!==undefined)return a.css(b,d);a=u(a);return a.style[J(b)]},h:function(a,b){var d=u(a),l=d.parentNode;if(l){if(b)for(var x;x=d.firstChild;)l.insertBefore(d.removeChild(x),d);l.removeChild(d)}return a},$a:function(a){v.Gc(a);v.Ic(a)},Gc:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==g.f){var d=q.Ja(b.nodeValue),l=b.nodeValue.length;if(d){if(d.length<l){(new r(b)).ha(l-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Ic:function(a){a=
u(a);for(var b;b=a.lastChild;){if(b.type==g.f){var d=q.La(b.nodeValue),l=b.nodeValue.length;if(d){if(d.length<l){(new r(b)).ha(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!z.ie&&!z.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Cb:function(a){a=u(a);for(var b=a.lastChild;b&&b.nodeType==g.f&&!y.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==g.f||v.d(b)!=="br"){b=z.opera?a.ownerDocument.createTextNode(""):
a.ownerDocument.createElement("br");z.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},sa:function(a,b){var d=u(a),l;do l=(d=d.previousSibling)&&new r(d);while(l&&b&&!b(l));return l},Rd:function(a,b){a=v.D(a);var d=a[0].lastChild;if((d=d&&new r(d))&&b&&!b(d))d=d.sa(b);return d},Ya:function(a,b){var d=u(a),l;do l=(d=d.nextSibling)&&new r(d);while(l&&b&&!b(l));return l},Za:function(a){a=u(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");
b.appendChild(a.cloneNode(T));return b.innerHTML},Sd:function(a,b,d,l){a=v.D(a);var x=a.data("list_marker_id")||a.data("list_marker_id",y.guid()).data("list_marker_id"),w=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[x]=a;w[d]=1;return a.data(d,l)},Cc:function(a,b,d){a=B(a);var l=a.data("list_marker_names"),x=a.data("list_marker_id"),w;for(w in l)a.removeData(w);a.removeData("list_marker_names");if(d){a.removeData("list_marker_id");delete b[x]}},Md:function(a,
b,d){a=u(a);b=B(b);var l=a.attributes;d=d||{};for(var x=0;x<l.length;x++){var w=l[x],i=w.name.toLowerCase(),k;if(!(i in d))if(i=="checked"&&(k=v.attr(a,i)))b.attr(i,k);else if(w.specified||z.ie&&w.value&&i=="value"){k=v.attr(a,i);if(k===U)k=w.nodeValue;b.attr(i,k)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Ec:function(a){a=v.d(a);var b=o.m;return(a=!b.vc[a]&&(b[a]||b.span))&&a["#"]},Jb:function(a){a=B(a);var b=a[0].ownerDocument,d=v.scrollLeft(b),l=v.scrollTop(b),x=a.offset(),w=
x.left;x=x.top;if(v.viewportHeight(b)+l<x||x<l||v.viewportWidth(b)+d<w||w<d)a.scrollIntoView(b)},Od:function(a,b,d){a=u(a);if(!z.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new r(a[b]));return d}};y.DOM.Qd=function(a){y.mix(v,a);for(var b in a)a.hasOwnProperty(b)&&function(d){r.prototype[d]=function(){var l=[].slice.call(arguments,0);l.unshift(this);return a[d].apply(U,l)}}(b)};q.o(j,{_4e_wrap:j.D,_4e_unwrap:j.Kc,_4e_equals:j.g,_4e_isBlockBoundary:j.qa,_4e_getWin:j.fa,
_4e_index:j.v,_4e_first:j.Nd,_4e_move:j.Hc,_4e_name:j.d,_4e_isIdentical:j.Fc,_4e_isEmptyInlineRemoveable:j.Gb,_4e_moveChildren:j.Hb,_4e_mergeSiblings:j.ra,_4e_unselectable:j.Jc,_4e_getOffset:j.Fb,_4e_getFrameDocument:j.Pd,_4e_splitText:j.ha,_4e_parents:j.Ib,_4e_clone:j.K,_4e_nextSourceNode:j.w,_4e_previousSourceNode:j.ga,_4e_contains:j.L,_4e_commonAncestor:j.Eb,_4e_ascendant:j.Ld,_4e_hasAttribute:j.Dc,_4e_hasAttributes:j.Xa,_4e_position:j.Da,_4e_address:j.Ca,_4e_breakParent:j.Db,_4e_style:j.M,_4e_remove:j.h,
_4e_trim:j.$a,_4e_ltrim:j.Gc,_4e_rtrim:j.Ic,_4e_appendBogus:j.Cb,_4e_last:j.Rd,_4e_previous:j.sa,_4e_next:j.Ya,_4e_outerHtml:j.Za,_4e_setMarker:j.Sd,_4e_clearMarkers:j.Cc,_4e_getUniqueId:j.qf,_4e_copyAttributes:j.Md,_4e_isEditable:j.Ec,_4e_scrollIntoView:j.Jb,_4e_getElementsByTagName:j.Od});v.Qd(j)});
KISSY.Editor.add("elementpath",function(o){function B(f){var g=v,e=v,p=[];for(f=f;f&&f[0];){if(f[0].nodeType==y.e){if(!this.Ge)this.Ge=f;var A=f.d();if(!e){if(!g&&z[A])g=f;if(r[A]){var j;if(j=!g){if(j=A=="div"){a:{j=f;j=j[0]||j;j=j.childNodes;for(var a=0,b=j.length;a<b;a++){var d=j[a];if(d.nodeType==y.e&&J.Pa[d.nodeName.toLowerCase()]){j=T;break a}}j=X}j=!j}j=j}if(j)g=f;else e=f}}p.push(f);if(A=="body")break}f=f.parent()}this.block=this.z=g;this.blockLimit=this.F=e;this.elements=this.elements=p}var u=
KISSY.DOM,J=o.m,y=o.n,v=U,z={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},r={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};B.prototype={Sc:function(f){var g=this.elements;f=f&&f.elements;if(!f||g.length!=f.length)return X;for(var e=0;e<g.length;e++)if(!u.g(g[e],f[e]))return X;return T},contains:function(f){for(var g=this.elements,e=0;e<g.length;e++)if(g[e].d()in f)return g[e];return v}};o.ElementPath=o.Ra=B;var q=B.prototype;o.k.o(q,{compare:q.Sc,
contains:q.contains})});
KISSY.Editor.add("walker",function(o){function B(p,A){if(this.c.end)return z;var j,a=this.xa,b,d=this.bc,l=this.type,x=p?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return z}}if(!p&&!this.c.cd){var w=a.endContainer,i=new g(w[0].childNodes[a.endOffset]);this.c.cd=function(m,c){return(m=f.D(m))&&m[0]&&(!c||!f.g(w,m))&&(!i[0]||!m.g(i))&&(m[0].nodeType!=q.e||!c||m.d()!="body")}}if(p&&!this.c.ed){var k=a.startContainer,E=a.startOffset>
0&&new g(k[0].childNodes[a.startOffset-1]);this.c.ed=function(m,c){return(m=f.D(m))&&m[0]&&(!c||!m.g(k))&&(!E[0]||!m.g(E))&&(m[0].nodeType!=q.e||!c||m.d()!="body")}}var G=p?this.c.ed:this.c.cd;b=d?function(m,c){if(G(m,c)===v)return v;return d(m,c)}:G;if(this.db)j=this.db[x](v,l,b);else if(p){j=a.endContainer;if(a.endOffset>0){j=new g(j[0].childNodes[a.endOffset-1]);if(b(j)===v)j=z}else j=b(j,y)===v?z:j.ga(y,l,b)}else{j=a.startContainer;if((j=new g(j[0].childNodes[a.startOffset]))&&j[0]){if(b(j)===
v)j=z}else j=b(a.startContainer,y)===v?z:a.startContainer.w(y,l,b)}for(;j&&j[0]&&!this.c.end;){this.db=j;if(!this.R||this.R(j)!==v){if(!A)return j}else if(A&&this.R)return v;j=j[x](v,l,b)}this.end();return this.db=z}function u(p){for(var A,j=z;A=B.call(this,p);)j=A;return j}function J(p){this.xa=p;this.c={}}var y=T,v=X,z=U,r=KISSY,q=o.n,f=r.DOM,g=r.Node;r.augment(J,{end:function(){this.c.end=1},next:function(){return B.call(this)},nb:function(){return B.call(this,y)},Rc:function(){return B.call(this,
v,y)!==v},Qc:function(){return B.call(this,y,y)!==v},ld:function(){return u.call(this)},kd:function(){return u.call(this,y)},reset:function(){delete this.db;this.c={}}});J.Ob=function(p){return function(A){A=f.D(A);return!(A&&A[0].nodeType==q.e&&A.qa(p))}};J.Je=function(){return this.Ob({Pb:1})};J.Fa=function(p,A){function j(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,d;b=a&&a[0]&&a[0].nodeType==q.f&&(d=a.parent())&&j(d);b=p?b:b||j(a);return A^b}};J.Oa=function(p){return function(A){A=
(A=A[0]||A)&&A.nodeType==q.f&&!r.trim(A.nodeValue);return p^A}};J.Ee=function(p){var A=J.Oa();return function(j){j=A(j)||j[0].nodeType==q.e&&!j[0].offsetHeight;return p^j}};o.Ba=J;o.Walker=J;var e=J.prototype;o.k.o(e,{end:e.end,next:e.next,previous:e.nb,checkForward:e.Rc,checkBackward:e.Qc,lastForward:e.ld,lastBackward:e.kd,reset:e.reset});o.k.o(J,{blockBoundary:J.Ob,listItemBoundary:J.Je,bookmark:J.Fa,whitespaces:J.Oa,invisible:J.Ee})});
KISSY.Editor.add("range",function(o){function B(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=r;this.document=c}function u(c){var h=c[0].nodeType!=e.f&&c.d()in l.ba,n=!g.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||n||c}function J(c){return!E(c)&&!G(c)}function y(c){var h=q,n=j.Fa(r);return function(t){if(n(t))return r;if(t[0].nodeType==e.f){if(g.trim(t[0].nodeValue).length)return q}else if(t[0].nodeType==e.e)if(!k[t.d()])if(!c&&!d.ie&&
t.d()=="br"&&!h)h=r;else return q;return r}}function v(c,h){function n(t){return t&&t.nodeName=="span"&&t.getAttribute("_ke_bookmark")}return function(t){var s,C;s=t&&!t.nodeName&&(C=t.parentNode)&&n(C);s=c?s:s||n(t);return h^s}}function z(c){return function(h){h=(h=h[0]||h)&&h.nodeType==e.f&&!g.trim(h.nodeValue);return c^h}}o.oa={W:1,J:2,C:3,t:4,xb:1,wb:2,Qa:3,Ua:1,Hd:2,mf:3,ea:1,zc:2};o.RANGE=o.oa;var r=T,q=X,f=U,g=KISSY,e=o.n,p=o.oa,A=o.Sa,j=o.Ba,a=g.DOM,b=o.k.Yc,d=g.UA,l=o.m,x=o.Ra,w=g.Node,i=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};B.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};g.augment(B,{Na:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},jc:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},kc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.U(c,p.C);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.T(h,p.t)},setStart:function(c,h){if(c[0].nodeType==e.e&&i[c.d()]){c=c.parent();h=c.v()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Na()},setEnd:function(c,h){if(c[0].nodeType==e.e&&i[c.d()]){c=c.parent();h=c.v()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Na()},U:function(c,h){switch(h){case p.W:this.setStart(c,0);break;case p.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case p.C:this.setStartBefore(c);break;case p.t:this.setStartAfter(c)}this.Na()},T:function(c,h){switch(h){case p.W:this.setEnd(c,0);break;case p.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case p.C:this.setEndBefore(c);break;case p.t:this.setEndAfter(c)}this.Na()},
Vb:function(c,h){var n=this.startContainer,t=this.endContainer,s=this.startOffset,C=this.endOffset,O,N=this.document,P;this.kc();if(t[0].nodeType==e.f)t=t.ha(C);else if(t[0].childNodes.length>0)if(C>=t[0].childNodes.length){t=new w(t[0].appendChild(N.createTextNode("")));P=r}else t=new w(t[0].childNodes[C]);if(n[0].nodeType==e.f){n.ha(s);if(n.g(t))t=new w(n[0].nextSibling)}else if(s)if(s>=n[0].childNodes.length){O=new w(N.createTextNode(""));n.append(O);n=O;O=r}else n=new w(n[0].childNodes[s].previousSibling);
else{O=new w(N.createTextNode(""));(s=n[0].firstChild)?a.insertBefore(O[0],s):n.append(O);n=O;O=r}s=n.Ib();C=t.Ib();var Q,W,V;for(Q=0;Q<s.length;Q++){W=s[Q];V=C[Q];if(!W.g(V))break}N=h;for(var S,D,K,F=Q;F<s.length;F++){S=s[F];D=N&&!S.g(n)?N.appendChild(S.K()[0]):U;for(S=S[0].nextSibling;S;){if(a.g(C[F],S)||a.g(t,S))break;K=S.nextSibling;if(c==2)N.appendChild(S.cloneNode(r));else{a.h(S);c==1&&N.appendChild(S)}S=K}if(D)N=D}N=h;for(Q=Q;Q<C.length;Q++){S=C[Q];D=N&&c>0&&!S.g(t)?N.appendChild(S.K()[0]):
U;if(!s[Q]||!S.parent().g(s[Q].parent()))for(S=S[0].previousSibling;S;){if(a.g(s[Q],S)||a.g(n,S))break;K=S.previousSibling;if(c==2)N.insertBefore(S.cloneNode(r),N.firstChild);else{a.h(S);c==1&&N.insertBefore(S,N.firstChild)}S=K}if(D)N=D}if(c==2){V=this.startContainer[0];if(V.nodeType==e.f&&V.nextSibling&&V.nextSibling.nodeType==e.f){V.data+=V.nextSibling.data;V.parentNode.removeChild(V.nextSibling)}V=this.endContainer[0];if(V.nodeType==e.f&&V.nextSibling&&V.nextSibling.nodeType==e.f){V.data+=V.nextSibling.data;
V.parentNode.removeChild(V.nextSibling)}}else{if(W&&V&&(!n.parent().g(W.parent())||!t.parent().g(V.parent()))){W=V.v();O&&V.parent().g(n.parent())&&W--;this.setStart(V.parent(),W)}this.collapse(r)}O&&n.h();P&&t[0].parentNode&&t.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=r},clone:function(){var c=new B(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},$c:function(){var c=this.clone();c.jc();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return f;var h=new o.Ba(c),n=v(r,undefined),t=z(r);c.R=function(s){return t(s)&&n(s)};c=h.next();h.reset();h=h.nb();return c&&c.g(h)?c:f},Ma:function(c,h){if(!this.collapsed){c=c||p.zc;var n=this.clone(),t=this.startContainer,s=this.endContainer,C=this.startOffset,
O=this.endOffset,N=1,P=1;if(t&&t[0].nodeType==e.f)if(C)if(C>=t[0].nodeValue.length)n.setStartAfter(t);else{n.setStartBefore(t);N=0}else n.setStartBefore(t);if(s&&s[0].nodeType==e.f)if(O)if(O>=s[0].nodeValue.length)n.setEndAfter(s);else{n.setEndAfter(s);P=0}else n.setEndBefore(s);n=new j(n);n.R=function(W){W=W[0]||W;return W.nodeType==(c==p.ea?e.e:e.f)};var Q;n.bc=function(W,V){W=W[0]||W;if(c==p.ea&&W.nodeType==e.f)return q;if(V&&W==Q)return q;if(!V&&W.nodeType==e.e)Q=W;return r};if(N)(t=n[c==p.ea?
"lastForward":"next"]())&&this.U(t,h?p.W:p.C);if(P){n.reset();(n=n[c==p.ea?"lastBackward":"previous"]())&&this.T(n,h?p.J:p.t)}return!!(N||P)}},xe:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Tc:function(c){var h=this.startContainer,n=this.endContainer,t=this.startOffset,s=this.endOffset,C,O;if(!h||!n)return{start:0,end:0};if(c){if(h[0].nodeType==e.e)if((C=new w(h[0].childNodes[t]))&&C[0]&&C[0].nodeType==e.f&&t>0&&C[0].previousSibling.nodeType==
e.f){h=C;t=0}for(;h[0].nodeType==e.f&&(O=h.sa())&&O[0].nodeType==e.f;){h=O;t+=O[0].nodeValue.length}if(!this.collapsed){if(n[0].nodeType==e.e)if((C=new w(n[0].childNodes[s]))&&C[0]&&C[0].nodeType==e.f&&s>0&&C[0].previousSibling.nodeType==e.f){n=C;s=0}for(;n[0].nodeType==e.f&&(O=n.sa())&&O[0].nodeType==e.f;){n=O;s+=O[0].nodeValue.length}}}return{start:h.Ca(c),end:this.collapsed?f:n.Ca(c),startOffset:t,endOffset:s,nd:c,Fe:r}},P:function(c){var h,n,t,s,C=this.collapsed;h=new w("<span>",f,this.document);
h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){t=g.guid("ke_bm_");h.attr("id",t+"S")}if(!C){n=h.K();n.html("&nbsp;");c&&n.attr("id",t+"E");s=this.clone();s.collapse();s.insertNode(n)}s=this.clone();s.collapse(r);s.insertNode(h);if(n){this.setStartAfter(h);this.setEndBefore(n)}else this.H(h,p.t);return{Z:c?t+"S":h,Q:c?t+"E":n,zd:c,collapsed:C}},H:function(c,h){this.U(c,h);this.collapse(r)},trim:function(c,h){var n=this.startContainer,t=this.startOffset,s=this.collapsed;if((!c||
s)&&n[0]&&n[0].nodeType==e.f){if(t)if(t>=n[0].nodeValue.length){t=n.v()+1;n=n.parent()}else{var C=n.ha(t);t=n.v()+1;n=n.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(a.g(n,this.endContainer))this.endOffset+=1}else{t=n.v();n=n.parent()}this.setStart(n,t);if(s){this.collapse(r);return}}n=this.endContainer;t=this.endOffset;if(!(h||s)&&n[0]&&n[0].nodeType==e.f){if(t){t>=n.nodeValue.length||n.ha(t);t=n.v()+1}else t=n.v();n=n.parent();this.setEnd(n,
t)}},insertNode:function(c){this.kc();this.trim(q,r);var h=this.startContainer,n=h[0].childNodes[this.startOffset];n?a.insertBefore(c[0]||c,n):h[0].appendChild(c[0]||c);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.Fe){var h=b(this.document,c.start,c.nd),n=c.startOffset,t=c.end&&b(this.document,c.end,c.nd);c=c.endOffset;this.setStart(h,n);t?this.setEnd(t,c):this.collapse(r)}else{h=(n=c.zd)?g.one("#"+c.Z,this.document):c.Z;c=n?g.one("#"+
c.Q,this.document):c.Q;this.setStartBefore(h);h.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(r)}},va:function(c,h){var n=this.startContainer,t=this.endContainer;n=a.g(n,t)?c&&n[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new w(n[0].childNodes[this.startOffset]):n:n.Eb(t);return h&&n[0].nodeType==e.f?n.parent():n},Ha:function(c){switch(c){case p.xb:if(this.collapsed)break;c=this.va();var h=new w(this.document.body),n,t,s,C,O,N=q,P,Q;P=this.startContainer;Q=this.startOffset;
if(P[0].nodeType==e.f){if(Q){P=!g.trim(P[0].nodeValue.substring(0,Q)).length&&P;N=!!P}if(P)if(!(C=P[0].previousSibling))s=P.parent()}else{if(Q)C=P[0].childNodes[Q-1]||P[0].lastChild;C||(s=P)}for(;s||C;){if(s&&!C){if(!O&&a.g(s,c))O=r;if(!h.L(s))break;if(!N||s.css("display")!="inline"){N=q;if(O)n=s;else this.setStartBefore(s)}C=s[0].previousSibling}for(;C;){P=q;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;P=/[\s\ufeff]$/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(N&&
l.ba[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else for(var W=C.all||C.getElementsByTagName("*"),V=0,S;S=W[V++];)if(!l.ba[S.nodeName.toLowerCase()]){C=f;break}if(C)P=!!Q.length}else C=f;if(P)if(N)if(O)n=s;else s&&this.setStartBefore(s);else N=r;if(C){P=C.previousSibling;if(!s&&!P){s=new w(C);C=f;break}C=P}else s=f}if(s)s=s.parent()}P=this.endContainer;Q=this.endOffset;s=C=f;O=N=q;if(P[0].nodeType==e.f){P=!g.trim(P[0].nodeValue.substring(Q)).length&&P;N=!(P&&P[0].nodeValue.length);
if(P)if(!(C=P[0].nextSibling))s=P.parent()}else(C=P[0].childNodes[Q])||(s=P);for(;s||C;){if(s&&!C){if(!O&&a.g(s,c))O=r;if(!h.L(s))break;if(!N||s.css("display")!="inline"){N=q;if(O)t=s;else s&&this.setEndAfter(s)}C=s[0].nextSibling}for(;C;){P=q;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;P=/^[\s\ufeff]/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(N&&l.ba[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else{W=C.all||C.getElementsByTagName("*");
for(V=0;S=W[V++];)if(!l.ba[S.nodeName.toLowerCase()]){C=f;break}}if(C)P=!!Q.length}else C=f;if(P)if(N)if(O)t=s;else this.setEndAfter(s);if(C){P=C.nextSibling;if(!s&&!P){s=new w(C);C=f;break}C=P}else s=f}if(s)s=s.parent()}if(n&&t){c=n.L(t)?t:n;this.setStartBefore(c);this.setEndAfter(c)}break;case p.wb:case p.Qa:s=new B(this.document);h=new w(this.document.body);s.U(h,p.W);s.setEnd(this.startContainer,this.startOffset);s=new j(s);var D,K,F=j.Ob(c==p.Qa?{Pb:1}:f),H=function(I){var L=F(I);L||(D=I);return L};
n=function(I){var L=H(I);if(!L&&I[0]&&I.d()=="br")K=I;return L};s.bc=H;s=s.kd();D=D||h;this.U(D,D.d()!="br"&&(!s&&this.ta()||s&&D.L(s))?p.W:p.t);s=this.clone();s.collapse();s.T(h,p.J);s=new j(s);s.bc=c==p.Qa?n:H;D=f;s=s.ld();D=D||h;this.T(D,!s&&this.ka()||s&&D.L(s)?p.J:p.C);K&&this.setEndAfter(K)}},ta:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(0,h)).length)return q;this.trim();c=new x(this.startContainer);h=this.clone();h.collapse(r);
h.U(c.z||c.F,p.W);c=new j(h);c.R=y(r);return c.Qc()},ka:function(){var c=this.endContainer,h=this.endOffset;if(c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(h)).length)return q;this.trim();c=new x(this.endContainer);h=this.clone();h.collapse(q);h.T(c.z||c.F,p.J);c=new j(h);c.R=y(q);return c.Rc()},deleteContents:function(){this.collapsed||this.Vb(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Vb(1,c);return c},Rb:function(c,h){var n=this.clone();
n[h==p.Ua?"setStartAt":"setEndAt"](c,h==p.Ua?p.W:p.J);n=new j(n);n.R=u;return n[h==p.Ua?"checkBackward":"checkForward"]()},Xc:function(){var c=this.startContainer,h=this.endContainer,n=this.startOffset,t=this.endOffset,s;if(c[0].nodeType==e.e){s=c[0].childNodes.length;if(s>n)c=new w(c[0].childNodes[n]);else if(s<1)c=c.ga();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new w(c);c=c.w()||c}}if(h[0].nodeType==e.e){s=h[0].childNodes.length;if(s>t)h=(new w(h[0].childNodes[t])).ga(r);else if(s<1)h=h.ga();
else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new w(h)}}if(c.Da(h)&A.ca)c=h;return{Z:c,Q:h}},eb:function(c,h){var n=this.P(),t=new w(this.document.createElement(h));this.collapse(c);this.Ha(p.wb);t[0].appendChild(this.extractContents());t.$a();d.ie||t.Cb();this.insertNode(t);this.moveToBookmark(n);return t},pc:function(c){var h=new x(this.startContainer),n=new x(this.endContainer),t=h.z,s=n.z,C=f;if(!h.F.g(n.F))return f;if(c!="br"){if(!t){t=this.eb(r,c);s=(new x(this.endContainer)).z}s||(s=this.eb(q,
c))}c=t&&this.ta();h=s&&this.ka();this.deleteContents();if(t&&a.g(t,s))if(h){C=new x(this.startContainer);this.H(s,p.t);s=f}else if(c){C=new x(this.startContainer);this.H(t,p.C);t=f}else{s=this.qc(t);!d.ie&&!g.inArray(t.d(),["ul","ol"])&&t.Cb()}return{Hf:t,Gf:s,Xe:c,We:h,Df:C}},qc:function(c){if(!this.collapsed)return f;this.T(c,p.J);var h=this.extractContents(),n=c.K(q);n[0].appendChild(h);n.insertAfter(c);this.H(c,p.t);return n},jb:function(c,h){var n,t=o.m;if(t.sb[c.d()])return q;for(;c&&c[0].nodeType==
e.e;){if(n=c.Ec())this.H(c,h?p.J:p.W);else if(t.tc[c.d()]){this.H(c,h?p.t:p.C);return r}if((c=t.sb[c.d()]?c[h?"_4e_previous":"_4e_next"](J):c[h?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,h?p.t:p.C);return r}}return n},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var k={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},E=new j.Oa,G=new j.Fa;o.Range=B;o.Range=B;var m=B.prototype;o.k.o(m,{updateCollapsed:m.Na,optimize:m.jc,setStartAfter:m.setStartAfter,setEndAfter:m.setEndAfter,setStartBefore:m.setStartBefore,setEndBefore:m.setEndBefore,optimizeBookmark:m.kc,setStart:m.setStart,setEnd:m.setEnd,setStartAt:m.U,setEndAt:m.T,execContentsAction:m.Vb,collapse:m.collapse,clone:m.clone,getEnclosedNode:m.$c,shrink:m.Ma,getTouchedStartNode:m.xe,createBookmark2:m.Tc,createBookmark:m.P,
moveToPosition:m.H,trim:m.trim,insertNode:m.insertNode,moveToBookmark:m.moveToBookmark,getCommonAncestor:m.va,enlarge:m.Ha,checkStartOfBlock:m.ta,checkEndOfBlock:m.ka,deleteContents:m.deleteContents,extractContents:m.extractContents,checkBoundaryOfElement:m.Rb,getBoundaryNodes:m.Xc,fixBlock:m.eb,splitBlock:m.pc,splitElement:m.qc,moveToElementEditablePosition:m.jb,selectNodeContents:m.selectNodeContents})});
KISSY.Editor.add("domiterator",function(o){function B(j){if(!(arguments.length<1)){this.xa=j;this.Xb=J;this.Wc=u;this.Ub=J;this.c||(this.c={})}}var u=T,J=X,y=KISSY,v=y.UA,z=o.Ba,r=o.Range,q=o.oa,f=o.n,g=o.Ra,e=y.Node,p=y.DOM,A=/^[\r\n\t ]*$/;y.augment(B,{we:function(j){var a,b,d,l,x;if(!this.c.I){b=this.xa.clone();b.Ma(q.ea,u);b.Ha(this.Xb||!this.Wc?q.Qa:q.wb);var w=new z(b),i=z.Fa(u,u);w.R=i;this.c.la=w.next();w=new z(b);w.R=i;w=w.nb();this.c.I=w.w(u);if(this.c.I&&this.c.I[0].nodeType==f.f&&!y.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().qa()){i=new r(b.document);i.H(this.c.I,q.t);if(i.ka()){i=new g(i.endContainer);this.c.I=(i.z||i.F).w(u)}}if(!this.c.I){this.c.I=this.c.Vc=new e(b.document.createTextNode(""));p.insertAfter(this.c.I[0],w[0])}b=U}i=this.c.la;w=this.c.I;for(this.c.la=U;i;){var k=J,E=i[0].nodeType!=f.e,G=J;if(E){if(i[0].nodeType==f.f)if(A.test(i[0].nodeValue))E=J}else{var m=i.d();if(i.qa(this.Xb&&{Pb:1})){if(m=="br")E=u;else if(!b&&!i[0].childNodes.length&&m!="hr"){a=i;d=i.g(w);break}if(b){b.T(i,q.C);
if(m!="br")this.c.la=i}k=u}else{if(i[0].firstChild){if(!b){b=new r(this.xa.document);b.U(i,q.C)}i=new e(i[0].firstChild);continue}E=u}}if(E&&!b){b=new r(this.xa.document);b.U(i,q.C)}d=(!k||E)&&i.g(w);if(b&&!k)for(;!i[0].nextSibling&&!d;){m=i.parent();if(m.qa(this.Xb&&{Pb:1})){k=u;d||m.g(w);break}i=m;E=u;d=i.g(w);G=u}E&&b.T(i,q.t);i=i.w(G,U,w);if((d=!i)||k&&b)break}if(!a){if(!b){this.c.Vc&&this.c.Vc.h();return this.c.la=U}a=new g(b.startContainer);i=a.F;k={Bf:1,Nf:1,Mf:1};a=a.z;if((!a||!a[0])&&!this.Ub&&
k[i.d()]&&b.ta()&&b.ka())a=i;else if(!a||this.Ub&&a.d()=="li"){a=new e(this.xa.document.createElement(j||"p"));a[0].appendChild(b.extractContents());a.$a();b.insertNode(a);l=x=u}else if(a.d()!="li"){if(!b.ta()||!b.ka()){a=a.K(J);a[0].appendChild(b.extractContents());a.$a();x=b.pc();l=!x.Xe;x=!x.We;b.insertNode(a)}}else if(!d)this.c.la=a.g(w)?U:b.Xc().Q.w(u,U,w)}if(l){b=new e(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&p.d(b[0].lastChild)=="br"&&p.h(b[0].lastChild)}if(x){b=
z.Fa(J,u);l=new e(a[0].lastChild);if(l[0]&&l[0].nodeType==f.e&&l.d()=="br")if(v.ie||l.sa(b)||l.Ya(b))l.h()}if(!this.c.la)this.c.la=d||a.g(w)?U:a.w(u,U,w);return a}});r.prototype.oe=function(){return new B(this)}});
KISSY.Editor.add("selection",function(o){function B(i){this.document=this.document=i;this.c={N:{}};if(q.ie){var k=this.r().createRange();if(!k||k.item&&k.item(0).ownerDocument!=i||k.parentElement&&k.parentElement().ownerDocument!=i)this.jd=y}}function u(i){i=new B(i);return!i||i.jd?z:i}function J(i){var k=i.document,E=new e(k.body),G=new e(k.documentElement);if(q.ie){if(q.ie<8||document.documentMode==7)G.on("click",function(N){f.d(N.target)==="html"&&i.getSelection().A()[0].select()});var m,c,h=1;
G.on("mousedown",function(){h=0});G.on("mouseup",function(){h=1});E.on("focusin",function(N){if(f.d(N.target)=="body")if(m){try{h&&m.select()}catch(P){}m=z}});E.on("focus",function(){c=y;t()});E.on("beforedeactivate",function(N){if(!N.relatedTarget){c=v;h=1}});g.on(f.fa(k),"blur",function(){k&&k.selection.empty()});E.on("mousedown",function(){n()});E.on("mouseup",function(){c=y;setTimeout(function(){t(y)},0)});var n=function(){c=v},t=function(N){if(c){var P=i.document,Q=i.getSelection(),W=Q&&Q.fb(),
V=Q&&Q.r();if(N&&V&&W==p.zb)if(!P.queryCommandEnabled("InsertImage")){setTimeout(function(){t(y)},50);return}var S;if(!(V&&W==p.pa&&(S=f.d(V.createRange().parentElement()))&&S in{input:1,textarea:1})){m=V&&Q.A()[0];i.ab()}}};E.on("keydown",n);E.on("keyup",function(){c=y;t()});g.on(k,"selectionchange",t)}else{g.on(k,"mouseup",i.ab,i);g.on(k,"keyup",i.ab,i)}var s={table:1,pre:1},C=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,O=o.Ba.Oa(y);
i.on("selectionChange",function(N){var P=N.path;N=(N=N.selection)&&N.A()[0];var Q=P.F;if(N)if(N.collapse&&!P.z&&Q.d()=="body"){P=N.eb(y,"p");if(P.Za().match(C))if((Q=P.Ya(O))&&Q[0].nodeType==j.e&&!s[Q.d()]){N.jb(Q);P.h()}else if((Q=P.sa(O))&&Q[0].nodeType==j.e&&!s[Q.d()]){N.jb(Q,Q.Za().match(C)?v:y);P.h()}N.select();q.ie||i.kb()}})}o.Kd={zb:1,pa:2,Ta:3};var y=T,v=X,z=U,r=KISSY,q=r.UA,f=r.DOM,g=r.Event,e=r.Node,p=o.Kd,A=o.oa,j=o.n,a=o.Ba,b=o.Range,d={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};r.augment(B,{r:q.ie?function(){var i=this.c.N;return i.hc||(i.hc=this.document.selection)}:function(){var i=this.c.N;return i.hc||(i.hc=f.fa(this.document).getSelection())},fb:q.ie?function(){var i=this.c.N;if(i.type)return i.type;var k=p.zb;try{var E=this.r(),G=E.type;if(G=="Text")k=p.pa;if(G=="Control")k=p.Ta;if(E.createRange().parentElement)k=p.pa}catch(m){}return i.type=k}:function(){var i=this.c.N;
if(i.type)return i.type;var k=p.pa,E=this.r();if(E){if(E.rangeCount==1){E=E.getRangeAt(0);var G=E.startContainer;if(G==E.endContainer&&G.nodeType==j.e&&E.endOffset-E.startOffset===1&&d[G.childNodes[E.startOffset].nodeName.toLowerCase()])k=p.Ta}}else k=p.zb;return i.type=k},A:q.ie?function(){function i(k,E){k=k.duplicate();k.collapse(E);for(var G=k.parentElement(),m=G.childNodes,c,h=0;h<m.length;h++){var n=m[h];if(n.nodeType==j.e){c=k.duplicate();c.moveToElementText(n);n=c.compareEndPoints("StartToStart",
k);var t=c.compareEndPoints("EndToStart",k);c.collapse();if(n>0)break;else if(!n||t==1&&n==-1)return{Ga:G,offset:h};else if(!t)return{Ga:G,offset:h+1};c=z}}if(!c){c=k.duplicate();c.moveToElementText(G);c.collapse(v)}c.setEndPoint("StartToStart",k);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=m[--h].nodeValue.length}catch(s){c=0}return c===0?{Ga:G,offset:h}:{Ga:m[h],offset:-c}}return function(){var k=this.c.N;if(k.na)return k.na;var E=this.r(),G=E&&E.createRange(),m=this.fb();if(!E)return[];
if(m==p.pa){E=new b(this.document);m=i(G,y);E.setStart(new e(m.Ga),m.offset);m=i(G);E.setEnd(new e(m.Ga),m.offset);return k.na=[E]}else if(m==p.Ta){k=k.na=[];for(m=0;m<G.length;m++){var c=G.item(m),h=c.parentNode,n=0;for(E=new b(this.document);n<h.childNodes.length&&h.childNodes[n]!=c;n++);E.setStart(new e(h),n);E.setEnd(new e(h),n+1);k.push(E)}return k}return k.na=[]}}():function(){var i=this.c.N;if(i.na)return i.na;var k=[],E=this.r();if(!E)return[];for(var G=0;G<E.rangeCount;G++){var m=E.getRangeAt(G),
c=new b(this.document);c.setStart(new e(m.startContainer),m.startOffset);c.setEnd(new e(m.endContainer),m.endOffset);k.push(c)}return i.na=k},ac:function(){var i=this.c.N;if(i.Ad!==undefined)return i.Ad;var k,E=this.r();switch(this.fb()){case p.Ta:return this.$b();case p.pa:var G=this.A()[0];if(G)if(!G.collapsed){for(G.jc();y;){k=G.startContainer;if(G.startOffset==(k[0].nodeType===j.e?k[0].childNodes.length:k[0].nodeValue.length)&&!k.qa())G.setStartAfter(k);else break}k=G.startContainer;if(k[0].nodeType!=
j.e)return k.parent();k=new e(k[0].childNodes[G.startOffset]);if(!k[0]||k[0].nodeType!=j.e)return G.startContainer;for(G=k[0].firstChild;G&&G.nodeType==j.e;){k=new e(G);G=G.firstChild}return k}if(q.ie){G=E.createRange();G.collapse(y);k=G.parentElement()}else if((k=E.anchorNode)&&k.nodeType!=j.e)k=k.parentNode}return i.Ad=k?f.D(k):z},$b:function(){var i=this,k,E=i.c.N;if(E.yd!==undefined)return E.yd;if(q.ie){k=i.r().createRange();k=k.item&&k.item(0)}k||(k=function(){for(var G=i.A()[0],m,c,h=2;h&&!((m=
G.$c())&&m[0].nodeType==j.e&&d[m.d()]&&(c=m));h--)G.Ma(A.ea);return c&&c[0]}());return E.yd=f.D(k)},reset:function(){this.c.N={}},oc:function(i){var k;if(q.ie)try{k=this.document.body.createControlRange();k.addElement(i[0]);k.select()}catch(E){k=this.document.body.createTextRange();k.moveToElementText(i[0]);k.select()}finally{}else{k=this.document.createRange();k.selectNode(i[0]);i=this.r();i.removeAllRanges();i.addRange(k)}this.reset()},qb:function(i){if(q.ie){if(i.length>1){var k=i[i.length-1];
i[0].setEnd(k.endContainer,k.endOffset);i.length=1}i[0]&&i[0].select()}else{k=this.r();if(!k)return;k.removeAllRanges();for(var E=0;E<i.length;E++){var G=i[E],m=this.document.createRange(),c=G.startContainer;G.collapsed&&q.gecko&&q.gecko<1.09&&c[0].nodeType==j.e&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));m.setStart(c[0],G.startOffset);m.setEnd(G.endContainer[0],G.endOffset);k.addRange(m)}}this.reset()},ne:function(i){for(var k=[],E=this.A(),G=0;G<E.length;G++)k.push(E[G].Tc(i));
return k},me:function(i,k){var E=[],G=this.document,m;k=k||this.A();for(var c=k.length,h=0;h<c;h++){E.push(m=k[h].P(i,y));var n=(i=m.zd)?r.one("#"+m.Z,G):m.Z;m=i?r.one("#"+m.Q,G):m.Q;for(var t=h+1;t<c;t++){var s=k[t],C=s.startContainer,O=s.endContainer;f.g(C,n.parent())&&s.startOffset++;f.g(C,m.parent())&&s.startOffset++;f.g(O,n.parent())&&s.endOffset++;f.g(O,m.parent())&&s.endOffset++}}return E},xd:function(i){for(var k=[],E=0;E<i.length;E++){var G=new b(this.document);G.moveToBookmark(i[E]);k.push(G)}this.qb(k);
return this},va:function(){var i=this.A();return i[0].startContainer.Eb(i[i.length-1].endContainer)},scrollIntoView:function(){var i=this.ac();i&&i.Jb()},removeAllRanges:function(){var i=this.r();if(q.ie)i&&i.clear();else i&&i.removeAllRanges()}});var l={table:1,tbody:1,tr:1},x=a.Oa(y),w=/\ufeff|\u00a0/;b.prototype.select=b.prototype.select=q.ie?function(i){var k=this.collapsed,E,G;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var m=this.startContainer[0].childNodes[this.startOffset];
if(m.nodeType==j.e){(new B(this.document)).oc(new e(m));return}}if(this.startContainer[0].nodeType==j.e&&this.startContainer.d()in l||this.endContainer[0].nodeType==j.e&&this.endContainer.d()in l)this.Ma(A.ea,y);var c=this.P();m=c.Z;var h;if(!k)h=c.Q;c=this.document.body.createTextRange();c.moveToElementText(m[0]);c.moveStart("character",1);if(h){i=this.document.body.createTextRange();i.moveToElementText(h[0]);c.setEndPoint("EndToEnd",i);c.moveEnd("character",-1)}else{for(E=m[0].nextSibling;E&&!x(E);)E=
E.nextSibling;E=!(E&&E.nodeValue&&E.nodeValue.match(w))&&(i||!m[0].previousSibling||m[0].previousSibling&&f.d(m[0].previousSibling)=="br");G=this.document.createElement("span");G.innerHTML="&#65279;";G=new e(G);f.insertBefore(G[0],m[0]);E&&f.insertBefore(this.document.createTextNode("\ufeff"),m[0])}this.setStartBefore(m);m.h();if(k){if(E){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(G){this.H(G,A.C);G.h()}}else{this.setEndBefore(h);h.h();c.select()}}:function(){var i=
this.startContainer;this.collapsed&&i[0].nodeType==j.e&&!i[0].childNodes.length&&i[0].appendChild(this.document.createTextNode(""));var k=this.document.createRange();k.setStart(i[0],this.startOffset);try{k.setEnd(this.endContainer[0],this.endOffset)}catch(E){if(E.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(y);k.setEnd(this.endContainer[0],this.endOffset)}else throw E;}i=u(this.document).r();i.removeAllRanges();i.addRange(k)};B.getSelection=u;o.Bc=B;o.Selection=B;a=B.prototype;o.k.o(a,
{getNative:a.r,getType:a.fb,getRanges:a.A,getStartElement:a.ac,getSelectedElement:a.$b,reset:a.reset,selectElement:a.oc,selectRanges:a.qb,createBookmarks2:a.ne,createBookmarks:a.me,getCommonAncestor:a.va,scrollIntoView:a.scrollIntoView,selectBookmarks:a.xd,removeAllRanges:a.removeAllRanges});o.on("instanceCreated",function(i){J(i.re)})});
KISSY.Editor.add("styles",function(o){function B(D,K){for(var F in D)D[F]=D[F].replace(V,function(H,I){return K[I]})}function u(D,K){if(K){D=k.clone(D);B(D.attributes,K);B(D.styles,K)}var F=this.element=this.element=(D.element||"*").toLowerCase();this.type=this.type=F=="#"||P[F]?m.Ab:Q[F]?m.Va:m.Aa;this.c={definition:D}}function J(D,K){var F=K?this.nc:this.Mb;D.body.focus();for(var H=new h(D),I=H.A(),L=0;L<I.length;L++)F.call(this,I[L]);H.qb(I)}function y(D,K){var F;F=D.element;if(F=="*")F="span";
F=new C(K.createElement(F));return v(F,D)}function v(D,K){var F=K.c.definition,H=F.attributes;F=u.bd(F);if(H)for(var I in H)D.attr(I,H[I]);if(F)D[0].style.cssText=F;return D}function z(D){var K=D.P(x),F=D.oe();F.Ub=x;F.Wc=x;for(var H,I=D.document;H=F.we();){var L=y(this,I);H=H;var M=L;L=M.d=="pre";var R=H.d=="pre",aa=!L&&R;if(L&&!R){R=H;M=M;aa=R.html();aa=r(aa,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");aa=aa.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");aa=aa.replace(/([ \t\n\r]+|&nbsp;)/g," ");aa=
aa.replace(/<br\b[^>]*>/gi,"\n");if(O.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(M[0]);M[0].outerHTML="<pre>"+aa+"</pre>";M=new C(R.firstChild);M.h()}else M.html(aa);M=M}else if(aa)M=f(q(H),M);else H.Hb(M);H[0].parentNode.replaceChild(M[0],H[0]);if(L){H=M;L=void 0;if((L=H.ga(x,n.e))&&L.d()=="pre"){M=r(L.html(),/\n$/,"")+"\n\n"+r(H.html(),/^\n/,"");if(O.ie)H[0].outerHTML="<pre>"+M+"</pre>";else H.html(M);L.h()}}}D.moveToBookmark(K)}function r(D,K,F){var H="",I="";D=D.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(L,M,R){M&&(H=M);R&&(I=R);return""});return H+D.replace(K,F)+I}function q(D){var K=[];r(D.Za(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(F,H,I){return H+"</pre>"+I+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(F,H){K.push(H)});return K}function f(D,K){for(var F=K[0].ownerDocument.createDocumentFragment(),H=0;H<D.length;H++){var I=D[H];I=I.replace(/(\r\n|\r)/g,"\n");I=r(I,/^[ \t]*\n/,"");I=r(I,/\n$/,"");I=r(I,/^[ \t]+|[ \t]+$/g,function(M,R){return M.length==
1?"&nbsp;":R?" "+Array(M.length).join("&nbsp;"):Array(M.length).join("&nbsp;")+" "});I=I.replace(/\n/g,"<br>");I=I.replace(/[ \t]{2,}/g,function(M){return Array(M.length).join("&nbsp;")+" "});var L=K.K();L.html(I);F.appendChild(L[0])}return F}function g(D){var K=D.document;if(D.collapsed){K=y(this,K);D.insertNode(K);D.H(K,c.J)}else{var F=this.element,H=this.c.definition,I,L=o.m[F]||(I=x,o.m.span),M=D.P();D.Ha(c.xb);D.trim();var R=D.P(),aa=R.Z;R=R.Q;for(var $=aa,ca;$&&$[0];){var Y=w;if(G.g($,R)){$=
i;Y=x}else{var Z=$[0].nodeType,fa=Z==n.e?$.d():i;if(fa&&$.attr("_ke_bookmark")){$=$.w(x);continue}if(!fa||L[fa]&&($.Da(R)|t.Y|t.da|t.X)==t.Y+t.da+t.X&&(!H.childRule||H.childRule($))){var ba=$.parent();if(ba&&ba[0]&&((o.m[ba.d()]||o.m.span)[F]||I)&&(!H.parentRule||H.parentRule(ba))){if(!ca&&(!fa||!o.m.ba[fa]||($.Da(R)|t.Y|t.da|t.X)==t.Y+t.da+t.X)){ca=new s(K);ca.setStartBefore($)}if(Z==n.f||Z==n.e&&!$[0].childNodes.length){Z=$;for(var da;!Z[0].nextSibling&&(da=Z.parent(),L[da.d()])&&(da.Da(aa)|t.ca|
t.da|t.X)==t.ca+t.da+t.X&&(!H.childRule||H.childRule(da));)Z=da;ca.setEndAfter(Z);Z[0].nextSibling||(Y=x)}}else Y=x}else Y=x;$=$.w()}if(Y&&ca&&!ca.collapsed){Y=y(this,K);for(Z=ca.va();Y&&Z&&Y[0]&&Z[0];){if(Z.d()==F){for(var ea in H.attributes)Y.attr(ea)==Z.attr(ea)&&Y[0].removeAttribute(ea);for(var ia in H.styles)Y.M(ia)==Z.M(ia)&&Y.M(ia,"");if(!Y.Xa()){Y=i;break}}Z=Z.parent()}if(Y){Y[0].appendChild(ca.extractContents());Z=Y;fa=j(this);ba=Z.all(this.element);for(var ga=ba.length;--ga>=0;)a(this,new C(ba[ga]));
var ha=void 0;for(ha in fa)if(ha!=this.element){ba=Z.all(ha);for(ga=ba.length-1;ga>=0;ga--){var ja=new C(ba[ga]);d(ja,fa[ha])}}ca.insertNode(Y);Y.ra();O.ie||Y[0].normalize()}ca=i}}aa.h();R.h();D.moveToBookmark(M);D.Ma(c.zc)}}function e(D){D.Ha(c.xb);var K=D.P(),F=K.Z;if(D.collapsed){for(var H=new N(F.parent()),I,L=0,M;L<H.elements.length&&(M=H.elements[L]);L++){if(M==H.z||M==H.F)break;if(this.ja(M)){var R=D.Rb(M,c.Hd),aa=!R&&D.Rb(M,c.Ua);if(aa||R){I=M;I.match=aa?"start":"end"}else{M.ra();M.d()==this.element?
a(this,M):d(M,j(this)[M.d()])}}}if(I&&I[0]){M=F;for(L=0;;L++){R=H.elements[L];if(G.g(R,I))break;else if(R.match)continue;else R=R.K();R[0].appendChild(M[0]);M=R}G[I.match=="start"?"insertBefore":"insertAfter"](M[0],I[0])}}else{var $=K.Q,ca=this;H=function(){for(var Y=new N(F.parent()),Z=new N($.parent()),fa=i,ba=i,da=0;da<Y.elements.length;da++){var ea=Y.elements[da];if(ea==Y.z||ea==Y.F)break;if(ca.ja(ea))fa=ea}for(da=0;da<Z.elements.length;da++){ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ja(ea))ba=
ea}ba&&$.Db(ba);fa&&F.Db(fa)};H();for(I=new C(F[0].nextSibling);I[0]!==$[0];){L=I.w();if(I[0]&&I[0].nodeType==n.e&&this.ja(I)){I.d()==this.element?a(this,I):d(I,j(this)[I.d()]);if(L[0].nodeType==n.e&&L.L(F)){H();L=new C(F[0].nextSibling)}}I=L}}D.moveToBookmark(K)}function p(D){var K={};D.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(F,H,I){K[H]=I});return K}function A(D,K){var F;if(K!==w){F=document.createElement("span");F.style.cssText=D;F=F.style.cssText||""}else F=
D;return F.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function j(D){if(D.c.wd)return D.c.wd;var K=D.c.wd={},F=D.c.definition.overrides;if(F){k.isArray(F)||(F=[F]);for(var H=0;H<F.length;H++){var I=F[H],L,M;if(typeof I=="string")L=I.toLowerCase();else{L=I.element?I.element.toLowerCase():D.element;M=I.attributes}I=K[L]||(K[L]={});if(M){I=I.attributes=I.attributes||[];for(var R in M)I.push([R.toLowerCase(),M[R]])}}}return K}function a(D,K){var F=D.c.definition,
H=E.mix(F.attributes,j(D)[K.d()]);F=F.styles;var I=k.isEmptyObject(H)&&k.isEmptyObject(F),L;for(L in H)if(!((L=="class"||D.c.definition.fullMatch)&&K.attr(L)!=b(L,H[L]))){I=I||!!K.Dc(L);K.removeAttr(L)}for(var M in F)if(!(D.c.definition.fullMatch&&K.M(M)!=b(M,F[M],x))){I=I||!!K.M(M);K.M(M,"")}l(K)}function b(D,K,F){var H=new C("<span>");H[F?"_4e_style":"attr"](D,K);return H[F?"_4e_style":"attr"](D)}function d(D,K){var F=K&&K.attributes;if(F)for(var H=0;H<F.length;H++){var I=F[H][0],L;if(L=D.attr(I)){var M=
F[H][1];if(M===i||M.test&&M.test(L)||typeof M=="string"&&L==M)D[0].removeAttribute(I)}}l(D)}function l(D){if(!D.Xa()){var K=D[0].firstChild,F=D[0].lastChild;D.h(x);if(K){K.nodeType==n.e&&G.ra(K);F&&K!=F&&F.nodeType==n.e&&G.ra(F)}}}var x=T,w=X,i=U,k=KISSY,E=o.k,G=k.DOM,m={Ab:1,Aa:2,Va:3},c=o.oa,h=o.Bc,n=o.n,t=o.Sa,s=o.Range,C=k.Node,O=k.UA,N=o.Ra,P={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},Q={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},W=
/\s*(?:;\s*|$)/,V=/#\((.+?)\)/g;o.nf=m;u.prototype={apply:function(D){J.call(this,D,w)},remove:function(D){J.call(this,D,x)},Mb:function(D){return(this.Mb=this.type==m.Aa?g:this.type==m.Ab?z:this.type==m.Va?i:i).call(this,D)},nc:function(D){return(this.nc=this.type==m.Aa?e:i).call(this,D)},be:function(D){v(D,this)},ja:function(D,K){if(!D)return w;var F=this.c.definition;if(D.d()==this.element){if(!K&&!D.Xa())return x;var H=F.Td;if(H)F=H;else{H={};var I=0,L=F.attributes;if(L)for(var M in L){I++;H[M]=
L[M]}if(L=u.bd(F)){H.style||I++;H.style=L}H._length=I;F=F.Td=H}if(F._length){for(var R in F)if(R!="_length"){I=D.attr(R)||"";if(R=="style")a:{H=F[R];I=A(I,w);typeof H=="string"&&(H=p(H));typeof I=="string"&&(I=p(I));L=void 0;for(L in H)if(!(L in I&&(I[L]==H[L]||H[L]=="inherit"||I[L]=="inherit"))){H=w;break a}H=x}else H=F[R]==I;if(H){if(!K)return x}else if(K)return w}if(K)return x}else return x}if(R=j(this)[D.d()]){if(!(F=R.attributes))return x;for(H=0;H<F.length;H++){R=F[H][0];if(R=D.attr(R)){I=F[H][1];
if(I===i||typeof I=="string"&&R==I||I.test&&I.test(R))return x}}}return w},je:function(D){switch(this.type){case m.Ab:return this.ja(D.z||D.F,x);case m.Va:case m.Aa:for(var K=D.elements,F=0,H;F<K.length;F++){H=K[F];if(!(this.type==m.Aa&&(G.g(H,D.z)||G.g(H,D.F))))if(!(this.type==m.Va&&!(H.d()in Q)))if(this.ja(H,x))return x}}return w}};u.bd=function(D){var K=D.Ud;if(K)return K;K=D.styles;var F=D.attributes&&D.attributes.style||"",H="";if(F.length)F=F.replace(W,";");for(var I in K){var L=K[I],M=(I+":"+
L).replace(W,";");if(L=="inherit")H+=M;else F+=M}if(F.length)F=A(F);F+=H;return D.Ud=F};o.pf=u;o.Style=u;var S=u.prototype;o.k.o(S,{apply:S.apply,remove:S.remove,applyToRange:S.Mb,removeFromRange:S.nc,applyToObject:S.be,checkElementRemovable:S.ja,checkActive:S.je})});
KISSY.Editor.add("htmlparser",function(){function o(){}function B(){this.c={fd:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var u=KISSY,J=u.Editor,y=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,v={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},z=J.m;u.augment(B,{wa:o,vd:o,ma:o,qd:o,Ka:o,parse:function(r){for(var q,
f,g=0,e;q=this.c.fd.exec(r);){f=q.index;if(f>g){g=r.substring(g,f);e?e.push(g):this.ma(g)}g=this.c.fd.lastIndex;if(f=q[1]){f=f.toLowerCase();if(e&&z.sc[f]){this.qd(e.join(""));e=U}if(!e){this.vd(f);continue}}if(e)e.push(q[0]);else if(f=q[3]){f=f.toLowerCase();if(!/="/.test(f)){var p={},A;q=q[4];var j=!!(q&&q.charAt(q.length-1)=="/");if(q)for(;A=y.exec(q);){var a=A[1].toLowerCase();A=A[2]||A[3]||A[4]||"";p[a]=!A&&v[a]?a:A}this.wa(f,p,j);if(!e&&z.sc[f])e=[]}}else if(f=q[2])this.Ka(f)}r.length>g&&this.ma(r.substring(g,
r.length))}});J.j=B;J.HtmlParser=B});
KISSY.Editor.add("htmlparser-basicwriter",function(){function o(){this.c={l:[]}}var B=KISSY,u=B.Editor,J=u.k;B.augment(o,{lb:function(y){this.c.l.push("<",y)},mb:function(y,v){v?this.c.l.push(" />"):this.c.l.push(">")},bb:function(y,v){if(typeof v=="string")v=J.dc(v);this.c.l.push(" ",y,'="',v,'"')},cb:function(y){this.c.l.push("</",y,">")},text:function(y){this.c.l.push(y)},O:function(y){this.c.l.push("<!--",y,"--\>")},write:function(y){this.c.l.push(y)},reset:function(){this.c.l=[];this.c.B=X},
Yb:function(y){var v=this.c.l.join("");y&&this.reset();return v}});u.j.vb=o;u.j.BasicWriter=o;B=o.prototype;u.k.o(B,{openTag:B.lb,openTagClose:B.mb,attribute:B.bb,closeTag:B.cb,text:B.text,comment:B.O,write:B.write,reset:B.reset,getHtml:B.Yb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function o(){o.Lf.constructor.call(this);this.gd="\t";this.Pe=" />";this.Ie="\n";this.ue=v;this.Qe=y;this.c.B=v;this.c.G="";this.c.rules={};var z=u.m,r;for(r in J.mix({},z.ub,z.Pa,z.tb,z.wc))this.ya(r,{B:y,fe:y,Qb:y,Pc:!z[r]["#"],ee:y});this.ya("br",{Qb:y});this.ya("title",{B:v,Qb:v});this.ya("style",{B:v,Pc:y});this.ya("pre",{B:v})}var B=KISSY,u=B.Editor,J=u.k,y=T,v=X;B.extend(o,u.j.vb,{lb:function(z){var r=this.c.rules[z];if(this.c.B)this.G();
else if(r&&r.fe){this.Ia();this.G()}this.c.l.push("<",z)},mb:function(z,r){var q=this.c.rules[z];if(r)this.c.l.push(this.Pe);else{this.c.l.push(">");if(q&&q.B)this.c.G+=this.gd}q&&q.Qb&&this.Ia()},bb:function(z,r){if(typeof r=="string"){this.ue&&(r=r.replace(/&amp;/g,"&"));r=J.dc(r)}this.c.l.push(" ",z,'="',r,'"')},cb:function(z){var r=this.c.rules[z];if(r&&r.B)this.c.G=this.c.G.substr(this.gd.length);if(this.c.B)this.G();else if(r&&r.Pc){this.Ia();this.G()}this.c.l.push("</",z,">");r&&r.ee&&this.Ia()},
text:function(z){if(this.c.B){this.G();z=J.Ja(z)}this.c.l.push(z)},O:function(z){this.c.B&&this.G();this.c.l.push("<!--",z,"--\>")},Ia:function(){this.c.l.length>0&&this.c.l.push(this.Ie);this.c.B=y},G:function(){this.c.l.push(this.c.G);this.c.B=v},ya:function(z,r){var q=this.c.rules[z];if(q)J.mix(q,r);else this.c.rules[z]=r}});u.j.df=o;u.j.HtmlWriter=o;B=o.prototype;u.k.o(B,{openTag:B.lb,openTagClose:B.mb,attribute:B.bb,closeTag:B.cb,text:B.text,comment:B.O,lineBreak:B.Ia,indentation:B.G,setRules:B.ya})});
KISSY.Editor.add("htmlparser-fragment",function(){function o(){this.children=[];this.parent=J;this.c={S:B,cc:u}}var B=T,u=X,J=U,y=KISSY.Editor,v={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},z=KISSY,r=y.k,q=y.n,f=y.m,g=r.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),e=f.Fd,p=f.tb;o.yb=function(A,j){function a(h){var n;if(w.length>0)for(var t=0;t<w.length;t++){var s=w[t],C=s.name,O=f[C],N=k.name&&f[k.name];if((!N||N[C])&&(!h||!O||O[h]||!f[h])){if(!n){b();n=1}s=s.clone();
s.parent=k;k=s;w.splice(t,1);t--}}}function b(){for(;i.length;)k.add(i.shift())}function d(h,n,t){n=n||k||x;if(j&&!n.type){var s,C;if((s=h.attributes&&(C=h.attributes._ke_real_element_type)?C:h.name)&&!(s in f.rc)&&!(s in f.ub)){s=k;k=n;l.wa(j,{});n=k;if(t)k=s}}if(h.c.S&&h.name!="pre"){t=h.children.length;if((s=h.children[t-1])&&s.type==q.f)if(C=r.La(s.value))s.value=C;else h.children.length=t-1}n.add(h);if(h.ob){k=h.ob;delete h.ob}}var l=new y.j,x=new o,w=[],i=[],k=x,E=u,G;l.wa=function(h,n,t){var s=
new y.j.xc(h,n);if(s.gc&&t)s.ib=B;if(f.ba[h])w.push(s);else{if(h=="pre")E=B;else if(h=="br"&&E){k.add(new y.j.Bb("\n"));return}if(h=="br")i.push(s);else{var C=k.name,O=C&&(f[C]||(k.c.S?f.div:f.span));if(O&&!s.gc&&!k.gc&&!O[h]){O=u;var N;if(h in e&&C in e){C=k.children;(C=C[C.length-1])&&C.name in p||d(C=new y.j.xc("li"),k);G=k;N=C}else if(h==C)d(k,k.parent);else{if(g[C])G||(G=k);else{d(k,k.parent,B);v[C]||w.unshift(k)}O=B}k=N?N:k.ob||k.parent;if(O){l.wa.apply(this,arguments);return}}a(h);b();s.parent=
k;s.ob=G;G=0;if(s.ib)d(s);else k=s}}};l.vd=function(h){for(var n=w.length-1;n>=0;n--)if(h==w[n].name){w.splice(n,1);return}for(var t=[],s=[],C=k;C.type&&C.name!=h;){C.c.S||s.unshift(C);t.push(C);C=C.parent}if(C.type){for(n=0;n<t.length;n++){var O=t[n];d(O,O.parent)}k=C;if(k.name=="pre")E=u;C.c.S&&b();d(C,C.parent);if(C==k)k=k.parent;w=w.concat(s)}if(h=="body")j=u};l.ma=function(h){if(!k.c.cc&&!E){h=r.Ja(h);if(h.length===0)return}b();a();if(j&&(!k.type||k.name=="body")&&r.trim(h))this.wa(j,{});E||
(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));k.add(new y.j.Bb(h))};l.qd=function(){};l.Ka=function(h){k.add(new y.j.Gd(h))};l.parse(A);for(b();k.type;){var m=k.parent,c=k;if(j&&(!m.type||m.name=="body")&&!f.rc[c.name]){k=m;l.wa(j,{});m=k}m.add(c);k=m}return x};z.augment(o,{add:function(A){var j=this.children.length;if(j=j>0&&this.children[j-1]||J){if(A.c.S&&j.type==q.f){j.value=r.La(j.value);if(j.value.length===0){this.children.pop();this.add(A);return}}j.next=A}A.nb=j;A.parent=this;this.children.push(A);
this.c.cc=A.type==q.f||A.type==q.e&&!A.c.S},aa:function(A,j){var a;this.filterChildren=this.Wb=function(){var b=new y.j.vb;this.V.call(this,b,j,B);b=b.Yb();this.children=(new o.yb(b)).children;a=1};!this.name&&j&&j.sd(this);this.V(A,a?J:j)},V:function(A,j){for(var a=0;a<this.children.length;a++)this.children[a].aa(A,j)}});y.j.za=o;y.j.Fragment=o;o.FromHtml=o.yb;z=o.prototype;y.k.o(z,{add:z.add,writeHtml:z.aa,writeChildrenHtml:z.V})});
KISSY.Editor.add("htmlparser-element",function(){function o(v,z){v=v[0];z=z[0];return v<z?-1:v>z?1:0}function B(v,z){this.name=v;this.attributes=z||(z={});this.children=[];var r=z.sf||v,q=u.m;r=!!(q.ub[r]||q.Pa[r]||q.tb[r]||q.wc[r]||q.vc[r]||r=="br");var f=!!q.sb[v];this.ib=f;this.gc=!q[v];this.c={S:r,cc:f||!r}}var u=KISSY.Editor,J=u.n;KISSY.augment(B,{type:J.e,add:u.j.za.prototype.add,clone:function(){return new B(this.name,this.attributes)},aa:function(v,z){var r=this.attributes,q=this,f=q.name,
g,e,p,A;q.Wb=function(){if(!A){var b=new u.j.vb;u.j.za.prototype.V.call(q,b,z);q.children=(new u.j.za.yb(b.Yb())).children;A=1}};q.filterChildren=q.Wb;if(z){for(;;){if(!(f=z.rd(f)))return;q.name=f;if(!(q=z.ic(q)))return;q.parent=this.parent;if(q.name==f)break;if(q.type!=J.e){q.aa(v,z);return}f=q.name;if(!f){this.V.call(q,v,A?U:z);return}}r=q.attributes}v.lb(f,r);for(var j=[],a=0;a<2;a++)for(g in r){e=g;p=r[g];if(a==1)j.push([g,p]);else if(z){for(;;)if(e=z.pd(g))if(e!=g){delete r[g];g=e}else break;
else{delete r[g];break}if(e)if((p=z.od(q,e,p))===X)delete r[e];else r[e]=p}}v.Qe&&j.sort(o);r=j.length;for(a=0;a<r;a++){g=j[a];v.bb(g[0],g[1])}v.mb(f,q.ib);if(!q.ib){this.V.call(q,v,A?U:z);v.cb(f)}},V:function(){u.j.za.prototype.V.apply(this,arguments)}});u.j.xc=B;u.j.Element=B;var y=B.prototype;u.k.o(y,{type:y.type,add:y.add,clone:y.clone,writeHtml:y.aa,writeChildrenHtml:y.V})});
KISSY.Editor.add("htmlparser-filter",function(){function o(g){this.c={Tb:[],Nb:[],elements:{uc:0},attributes:{uc:0}};g&&this.Oc(g,10)}function B(g,e){for(var p=0;g&&p<e.length;p++){var A=e[p];g=g.replace(A[0],A[1])}return g}function u(g,e,p){if(typeof e=="function")e=[e];var A,j;j=g.length;var a=e&&e.length;if(a){for(A=0;A<j&&g[A].mc<p;A++);for(j=a-1;j>=0;j--)if(a=e[j]){a.mc=p;g.splice(A,0,a)}}}function J(g,e,p){if(e)for(var A in e){var j=g[A];g[A]=y(j,e[A],p);j||g.uc++}}function y(g,e,p){if(e){e.mc=
p;if(g){if(g.splice)u(g,e,p);else{g=g.mc>p?[e,g]:[g,e];g.filter=v}return g}else return e.filter=e}}function v(g){for(var e=g.type||g instanceof r.j.za,p=0;p<this.length;p++){if(e)var A=g.type,j=g.name;var a=this[p].apply(window,arguments);if(a===f)return a;if(e){if(a&&(a.name!=j||a.type!=A))return a}else if(typeof a!="string")return a;a!=undefined&&(g=a)}return g}var z=KISSY,r=z.Editor,q=r.n,f=X;z.augment(o,{Oc:function(g,e){if(typeof e!="number")e=10;u(this.c.Tb,g.Tb,e);u(this.c.Nb,g.Nb,e);J(this.c.elements,
g.elements,e);J(this.c.attributes,g.attributes,e);this.c.text=y(this.c.text,g.text,e)||this.c.text;this.c.O=y(this.c.O,g.O,e)||this.c.O;this.c.pb=y(this.c.pb,g.pb,e)||this.c.pb},rd:function(g){return B(g,this.c.Tb)},pd:function(g){return B(g,this.c.Nb)},ma:function(g){var e=this.c.text;return e?e.filter(g):g},Ka:function(g,e){var p=this.c.O;return p?p.filter(g,e):g},sd:function(g){var e=this.c.pb;return e?e.filter(g):g},ic:function(g){for(var e=[this.c.elements["^"],this.c.elements[g.name],this.c.elements.Ye],
p,A=0;A<3;A++)if(p=e[A]){p=p.filter(g,this);if(p===f)return U;if(p&&p!=g)return this.ud(p);if(g.parent&&!g.name)break}return g},ud:function(g){var e=g.type;return e==q.e?this.ic(g):e==q.f?new r.j.Bb(this.ma(g.value)):U},od:function(g,e,p){if(e=this.c.attributes[e]){g=e.filter(p,g,this);if(g===f)return f;if(typeof g!="undefined")return g}return p}});r.j.cf=o;z=o.prototype;r.k.o(z,{addRules:z.Oc,onElementName:z.rd,onAttributeName:z.pd,onText:z.ma,onComment:z.Ka,onFragment:z.sd,onElement:z.ic,onNode:z.ud,
onAttribute:z.od});r.j.Filter=o});KISSY.Editor.add("htmlparser-text",function(){function o(y){this.value=y;this.c={S:J}}var B=KISSY,u=B.Editor,J=X;B.augment(o,{type:u.n.f,aa:function(y,v){var z=this.value;v&&!(z=v.ma(z,this))||y.text(z)}});u.j.Bb=o;u.j.Text=o});
KISSY.Editor.add("htmlparser-comment",function(){function o(J){this.value=J;this.c={S:X}}var B=KISSY.Editor,u=B.n;B.j.Gd=o;B.j.Comment=o;o.prototype={constructor:o,type:u.Id,aa:function(J,y){var v=this.value;if(y){if(!(v=y.Ka(v,this)))return;if(typeof v!="string"){v.parent=this.parent;v.aa(J,y);return}}J.O(v)}}});
