/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-19 15:41:38
*/
var S=true,T=null,X=false;
KISSY.add("editor",function(q,A){function u(i,a){function b(m){for(var l=u.Env.mods,k=0;k<m.length;k++){for(var B=m[k],I=t,w=0;w<k;w++)if(B==m[w]){I=x;break}w=l[B];if(I&&w){I=q.clone(w);B=B+"_"+k;I.name=B;m[k]=B;l[B]||(l[B]=I)}}}var d=this;if(!(d instanceof u))return new u(i,a);if(q.isString(i))i=q.one(i);i=z.D(i);a=a||{};a.Ke=a.pluginConfig||{};d.ha=a;a.pluginConfig=a.Ke;d.cfg=a;q.app(d,q.EventTarget);var j=["htmldataprocessor","enterkey","clipboard"],y=t;d.use=function(m,l){m=m.split(",");b(m);
if(!y)for(var k=0;k<j.length;k++){var B=j[k];q.inArray(B,m)||m.unshift(B)}q.use.call(d,m.join(","),function(){d.ready(function(){l&&l.call(d);if(!y){d.setData(i.val());if(a.focus)d.focus();else{var I=d.getSelection();I&&I.removeAllRanges()}d.fire("save");y=x}})},{order:x,global:u});return d};d.use=d.use;d.Be(i);return d}function J(i){var a=q.Config.debug;i=a?a==="dev"?"../src/"+i:i:i.replace(/\.(js|css)/i,"-min.$1");i+=i.indexOf("?")!=-1?"&":"?";i+="t="+encodeURIComponent("2010-11-19 15:41:38");return i}
var z=q.DOM,x=S,t=X;q.app(u,q.EventTarget);u.Config.base=q.Config.base+"editor/";var s=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",
requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],p,f,g,e,o={};p=0;for(f=s.length;p<f;p++){g=s[p];if(q.isString(g))g=s[p]={name:g+"",requires:T};e=g.requires||[];var D=["button"];g.name.indexOf("/dialog")!=-1&&D.push("overlay");g.requires=e.concat(D)}s=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},
{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(s);p=0;for(f=s.length;p<f;p++){g=s[p];e=g.name;o[e]={attach:t,charset:"utf-8",requires:g.requires,csspath:g.Pf?J("plugins/"+e+"/plugin.css"):A,path:J("plugins/"+e+"/plugin.js")}}u.add(o);q.Editor=u;q.Editor=u});
KISSY.Editor.add("utils",function(q){var A=T,u=KISSY,J=u.Node,z=u.DOM,x=u.UA,t=u.Event,s;if(x.ie)s=document.documentMode||x.ie;var p={Tc:function(f){var g=u.Config.debug;f=g?g==="dev"?"../src/"+f:f:f.replace(/\.(js|css)/i,"-min.$1");f+=f.indexOf("?")!=-1?"&":"?";f+="t="+encodeURIComponent("2010-11-19 17:29:25");return f},Ge:function(f,g,e){var o=f[g],D=f[e];f[g]=function(){o.apply(this,arguments);f[g]=f[e];return D.apply(this,arguments)}},xe:function(f,g,e,o){e=e.defaultView||e.parentWindow;f-=z.scrollLeft(e);
g-=z.scrollTop(e);if(o)if(e!=(o.defaultView||o.parentWindow)&&e.frameElement){o=z.Fb(e.frameElement,o);f+=o.left;g+=o.top}return{left:f,top:g}},Cd:function(){for(var f,g=0,e=arguments.length;g<e;g++){var o=arguments[g];try{f=o();break}catch(D){}}return f},ce:function(f,g){if(!f&&!g)return S;if(!f||!g||f.length!=g.length)return X;for(var e=0;e<f.length;e++)if(f[e]!==g[e])return X;return S},Xc:function(f,g,e){f=f.documentElement;for(var o=0;f&&o<g.length;o++){var D=g[o];if(e)for(var i=-1,a=0;a<f.childNodes.length;a++){var b=
f.childNodes[a];if(!(e===S&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){i++;if(i==D){f=b;break}}}else f=f.childNodes[D]}return f?new J(f):A},ke:function(f){for(var g in f)f[g].Bc(f,S)},cc:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Ka:function(f){return f.replace(/^\s+/,"")},Ma:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.Ka(this.Ma(f))},mix:function(){for(var f={},g=0;g<arguments.length;g++)f=u.mix(f,arguments[g]);
return f},hb:function(){if(!x.ie)return X;var f=document.domain,g=window.location.hostname;return f!=g&&f!="["+g+"]"},pe:function(f,g){return Array(g+1).join(f)},Te:function(f,g,e){e=e||150;if(e===-1)return function(){f.apply(g,arguments)};var o=(new Date).getTime();return function(){var D=(new Date).getTime();if(D-o>e){o=D;f.apply(g,arguments)}}},fe:function(f,g,e){e=e||0;var o=A;return function(){o&&clearTimeout(o);var D=arguments;o=setTimeout(function(){return f.apply(g,D)},e)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(u.trim(f))},
Ve:function(f){for(var g=0;g<f.length;g++){var e=z.D(f[g]),o=u.trim(e.val()),D=e.attr("data-verify");e=e.attr("data-warning");if(D&&!RegExp(D).test(o)){alert(e);return X}}return S},Re:function(f,g){f.on("sourcemode",g.yf,g);f.on("wysiwygmode",g.Ef,g)},Ne:function(f){var g=f.attr("placeholder");if(g&&!x.webkit){f.addClass("ke-input-tip");f.val(g)}else x.webkit&&f.val("")},Qf:function(f,g){f.removeClass("ke-input-tip");f.val(g)},Je:function(f,g){f.attr("placeholder",g);if(!x.webkit){f.on("blur",function(){if(!u.trim(f.val())){f.addClass("ke-input-tip");
f.val(g)}});f.on("focus",function(){f.removeClass("ke-input-tip");u.trim(f.val())==g&&f.val("")})}},je:function(f){f=f[0]||f;for(var g=u.makeArray(f.childNodes),e=0;e<g.length;e++){var o=g[e];o.nodeType==q.n.f&&!u.trim(o.nodeValue)&&f.removeChild(o)}},Ae:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},ze:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},re:function(f,
g){return f.toLowerCase()==g.toLowerCase()},ld:function(f){f=u.clone(f);for(var g in f)if(f.hasOwnProperty(g)){var e=f[g];if(u.isFunction(e))f[g]=e()}return f},oe:function(f,g,e){function o(){var y={responseText:"",responseXML:A};y.be=f?f.be:A;try{var m;if((m=x.ie?i.contentWindow.document:i.contentDocument||window.frames[D].document)&&m.body)y.responseText=m.body.innerHTML;y.responseXML=m&&m.XMLDocument?m.XMLDocument:m}catch(l){u.log(l)}t.remove(i,"load",o);f.ge&&f.ge(y);setTimeout(function(){z.h(i)},
100)}var D=u.guid("form-upload-"),i=document.createElement("iframe");i.id=D;i.name=D;i.className="ke-hidden";var a="document.open();"+(p.hb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(x.ie)i.src=x.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";u.log("doFormUpload : "+i.src);document.body.appendChild(i);if(x.ie)document.frames[D].name=D;a=z.Jc(f.form);var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=D;
a.method="POST";a.enctype=a.encoding="multipart/form-data";if(e)a.action=e;var d;if(g){d=[];g=q.l.ld(g);for(var j in g)if(g.hasOwnProperty(j)){e=document.createElement("input");e.type="hidden";e.name=j;e.value=g[j];a.appendChild(e);d.push(e)}}t.on(i,"load",o);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(d){g=0;for(j=d.length;g<j;g++)z.h(d[g])}return i},o:function(f,g){for(var e in g)f[e]=g[e]},map:function(f,g){for(var e=0;e<f.length;e++)f[e]=
g(f[e]);return f},dc:s,Le:function(f){x.ie?f.Ic():f.attr("onmousedown","return false;")}};q.l=p;q.Utils=p;p.o(p,{debugUrl:p.Tc,lazyRun:p.Ge,getXY:p.xe,tryThese:p.Cd,arrayCompare:p.ce,getByAddress:p.Xc,clearAllMarkers:p.ke,htmlEncodeAttr:p.cc,ltrim:p.Ka,rtrim:p.Ma,trim:p.trim,mix:p.mix,isCustomDomain:p.hb,duplicateStr:p.pe,buffer:p.fe,isNumber:p.isNumber,verifyInputs:p.Ve,sourceDisable:p.Re,resetInput:p.Ne,placeholder:p.Je,clean:p.je,htmlEncode:p.Ae,htmlDecode:p.ze,equalsIgnoreCase:p.re,normParams:p.ld,
throttle:p.Te,doFormUpload:p.oe,map:p.map})});
KISSY.Editor.add("dom",function(q){function A(a){if(a&&!a[0])return new s(a);return a}function u(a){return a[0]||a}function J(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var z=KISSY,x=z.DOM,t=z.UA,s=z.Node,p=q.l,f={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};q.n={e:1,f:3,Hd:8,hf:11};q.NODE=q.n;q.Ta={ca:0,Id:1,ba:2,X:4,W:8,xc:16};q.POSITION=
q.Ta;var g=q.n,e=q.Ta,o={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},D={hr:1},i={D:A,Jc:u,g:function(a,b){if(!a&&!b)return S;if(!a||!b)return X;a=u(a);b=u(b);return a===b},pa:function(a,b){a=A(a);var d=z.mix(z.mix({},D),b||{});return o[a.css("display")]||d[a.d()]},ea:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
X},v:function(a){a=u(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},Md:function(a,b){a=u(a);var d=a.firstChild;if((d=d&&new s(d))&&b&&!b(d))d=d.Ca(b);return d},Gc:function(a,b,d){a=u(a);x.h(a);b=u(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(t.ie)if((a=a.Kf)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Ec:function(a,b){if(a.d()!=b.d())return X;var d=a[0].attributes,j=b[0].attributes,y=d.length,
m=j.length;if(y!=m)return X;for(var l=0;l<y;l++){var k=d[l],B=k.name;if(k.specified&&a.attr(B)!=b.attr(B))return X}if(p.dc<8)for(l=0;l<m;l++){k=j[l];B=k.name;if(k.specified&&a.attr(B)!=b.attr(B))return X}return S},Gb:function(a){a=u(a).childNodes;for(var b=0,d=a.length;b<d;b++){var j=a[b],y=j.nodeType;if(!(y==g.e&&j.getAttribute("_ke_bookmark")))if(y==g.e&&!i.Gb(j)||y==g.f&&z.trim(j.nodeValue))return X}return S},Hb:function(a,b,d){a=u(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},qa:function(){function a(b,d,j){if(d[0]&&d[0].nodeType==g.e){for(var y=[];d.attr("_ke_bookmark")||d.Gb();){y.push(d);d=j?new s(d[0].nextSibling):new s(d[0].previousSibling);if(!d[0]||d[0].nodeType!=g.e)return}if(b.Ec(d)){for(var m=j?b[0].lastChild:b[0].firstChild;y.length;)y.shift().Gc(b,!j);d.Hb(b,!j);d.h();m[0]&&m[0].nodeType==g.e&&m.qa()}}}return function(b){if(b[0])if(f[b.d()]||b.d()=="a"){a(b,new s(b[0].nextSibling),S);
a(b,new s(b[0].previousSibling))}}}(),Ic:t.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:t.webkit?function(a){a=u(a);a.style.ef="none"}:function(a){a=u(a);if(t.ie||t.opera){var b=0;a.unselectable="on";for(var d=a.getElementsByTagName("*");a=d[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.unselectable="on"}}},Fb:function(a,b){a=u(a);var d,j=0;d=0;var y=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,m=a.ownerDocument,
l=m.documentElement;b=b||m;if(a.getBoundingClientRect){if(a!==m.body&&l!==a){d=a.getBoundingClientRect();j=d.left+(b===m?x.scrollLeft(y):0);d=d.top+(b===m?x.scrollTop(y):0)}if(b)if(y!=(b.defaultView||b.parentWindow)&&y.frameElement){y=i.Fb(y.frameElement,b);j+=y.left;d+=y.top}}return{left:j,top:d}},Od:function(a){return(a=u(a))&&a.contentWindow.document},ga:function(a,b){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=g.f)){if(t.ie&&b==a.nodeValue.length){var j=d.createTextNode("");x.insertAfter(j,
a);return new s(j)}j=new s(a.splitText(b));if(d.documentMode){d=d.createTextNode("");x.insertAfter(d,j[0]);x.h(d)}return j}},Ib:function(a,b){a=A(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},K:function(a,b,d){a=u(a);a=a.cloneNode(b);if(!d){var j=function(y){if(y.nodeType==g.e){y.removeAttribute("id");y=y.childNodes;for(var m=0;m<y.length;m++)j(y[m])}};j(a)}return new s(a)},w:function(a,b,d,j){a=u(a);if(j&&!j.call){var y=j[0]||j;j=function(l){l=l[0]||l;return l!==y}}b=!b&&
a.firstChild;var m=new s(a);if(!b){if(a.nodeType==g.e&&j&&j(a,S)===X)return T;b=a.nextSibling}for(;!b&&(m=m.parent());){if(j&&j(m,S)===X)return T;b=m[0].nextSibling}if(!b)return T;b=x.D(b);if(j&&j(b)===X)return T;if(d&&d!=b[0].nodeType)return b.w(X,d,j);return b},fa:function(a,b,d,j){a=u(a);if(j&&!j.call){var y=j[0]||j;j=function(l){l=l[0]||l;return l!==y}}b=!b&&a.lastChild;var m=new s(a);if(!b){if(a.nodeType==g.e&&j&&j(a,S)===X)return T;b=a.previousSibling}for(;!b&&(m=m.parent());){if(j&&j(m,S)===
X)return T;b=m[0].previousSibling}if(!b)return T;b=x.D(b);if(j&&j(b)===X)return T;if(d&&b[0].nodeType!=d)return b.fa(X,d,j);return b},Eb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=g.f&&b.contains(a))return b;var d=a[0].nodeType==g.f?a.parent():a;do if(d[0].nodeType!=g.f&&d.contains(b))return d;while(d=d.parent());return T},Kd:function(a,b,d){a=u(a);if(!d)a=a.parentNode;if(b&&!z.isFunction(b)){var j=b;b=function(y){return y.d()==j}}for(;a&&a.nodeType!=9;){if(!b||b(new s(a))===S)return new s(a);
a=a.parentNode}return T},Cc:p.dc<9?function(a,b){a=u(a);var d=a.attributes[b];return!!(d&&d.specified)}:function(a,b){a=u(a);return a.hasAttribute(b)},Ya:p.dc<9?function(a){a=u(a);for(var b=a.attributes,d=0;d<b.length;d++){var j=b[d];switch(j.name){case "class":if(a.getAttribute("class"))return S;break;default:if(j.specified)return S}}return X}:function(a){a=u(a);t.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},Da:function(a,b){var d=u(a),j=u(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(j);
if(d==j)return e.ca;if(d.nodeType==g.e&&j.nodeType==g.e){if(d.contains){if(d.contains(j))return e.xc+e.X;if(j.contains(d))return e.W+e.ba}if("sourceIndex"in d)return d.sourceIndex<0||j.sourceIndex<0?e.Id:d.sourceIndex<j.sourceIndex?e.X:e.ba}d=a.Ba();j=b.Ba();for(var y=Math.min(d.length,j.length),m=0;m<=y-1;m++)if(d[m]!=j[m]){if(m<y)return d[m]<j[m]?e.X:e.ba;break}return d.length<j.length?e.xc+e.X:e.W+e.ba},Ba:function(a,b){a=u(a);for(var d=[],j=a.ownerDocument.documentElement,y=a;y&&y!=j;){var m=
y.parentNode,l=-1;if(m){for(var k=0;k<m.childNodes.length;k++){var B=m.childNodes[k];if(!(b&&B.nodeType==3&&B.previousSibling&&B.previousSibling.nodeType==3)){l++;if(B==y)break}}d.unshift(l)}y=m}return d},Db:function(a,b){var d=new q.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var j=d.extractContents();d.insertNode(a.h());a[0].parentNode.insertBefore(j,a[0].nextSibling)},L:function(a,b,d){a=A(a);if(d!==undefined)return a.css(b,d);a=u(a);return a.style[J(b)]},h:function(a,b){var d=
u(a),j=d.parentNode;if(j){if(b)for(var y;y=d.firstChild;)j.insertBefore(d.removeChild(y),d);j.removeChild(d)}return a},$a:function(a){x.Fc(a);x.Hc(a)},Fc:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==g.f){var d=p.Ka(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<j){(new s(b)).ga(j-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Hc:function(a){a=u(a);for(var b;b=a.lastChild;){if(b.type==g.f){var d=p.Ma(b.nodeValue),j=b.nodeValue.length;if(d){if(d.length<
j){(new s(b)).ga(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!t.ie&&!t.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Cb:function(a){a=u(a);for(var b=a.lastChild;b&&b.nodeType==g.f&&!z.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==g.f||x.d(b)!=="br"){b=t.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");t.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},ra:function(a,
b){var d=u(a),j;do j=(d=d.previousSibling)&&new s(d);while(j&&b&&!b(j));return j},Qd:function(a,b){a=x.D(a);var d=a[0].lastChild;if((d=d&&new s(d))&&b&&!b(d))d=d.ra(b);return d},Ca:function(a,b){var d=u(a),j;do j=(d=d.nextSibling)&&new s(d);while(j&&b&&!b(j));return j},Za:function(a){a=u(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(S));return b.innerHTML},Rd:function(a,b,d,j){a=x.D(a);var y=a.data("list_marker_id")||
a.data("list_marker_id",z.guid()).data("list_marker_id"),m=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[y]=a;m[d]=1;return a.data(d,j)},Bc:function(a,b,d){a=A(a);var j=a.data("list_marker_names"),y=a.data("list_marker_id"),m;for(m in j)a.removeData(m);a.removeData("list_marker_names");if(d){a.removeData("list_marker_id");delete b[y]}},Ld:function(a,b,d){a=u(a);b=A(b);var j=a.attributes;d=d||{};for(var y=0;y<j.length;y++){var m=j[y],l=m.name.toLowerCase(),
k;if(!(l in d))if(l=="checked"&&(k=x.attr(a,l)))b.attr(l,k);else if(m.specified||t.ie&&m.value&&l=="value"){k=x.attr(a,l);if(k===T)k=m.nodeValue;b.attr(l,k)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Dc:function(a){a=x.d(a);var b=q.m;return(a=!b.uc[a]&&(b[a]||b.span))&&a["#"]},Jb:function(a){a=A(a);var b=a[0].ownerDocument,d=x.scrollLeft(b),j=x.scrollTop(b),y=a.offset(),m=y.left;y=y.top;if(x.viewportHeight(b)+j<y||y<j||x.viewportWidth(b)+d<m||m<d)a.scrollIntoView(b)},Nd:function(a,
b,d){a=u(a);if(!t.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new s(a[b]));return d}};z.DOM.Pd=function(a){z.mix(x,a);for(var b in a)a.hasOwnProperty(b)&&function(d){s.prototype[d]=function(){var j=[].slice.call(arguments,0);j.unshift(this);return a[d].apply(T,j)}}(b)};p.o(i,{_4e_wrap:i.D,_4e_unwrap:i.Jc,_4e_equals:i.g,_4e_isBlockBoundary:i.pa,_4e_getWin:i.ea,_4e_index:i.v,_4e_first:i.Md,_4e_move:i.Gc,_4e_name:i.d,_4e_isIdentical:i.Ec,_4e_isEmptyInlineRemoveable:i.Gb,
_4e_moveChildren:i.Hb,_4e_mergeSiblings:i.qa,_4e_unselectable:i.Ic,_4e_getOffset:i.Fb,_4e_getFrameDocument:i.Od,_4e_splitText:i.ga,_4e_parents:i.Ib,_4e_clone:i.K,_4e_nextSourceNode:i.w,_4e_previousSourceNode:i.fa,_4e_commonAncestor:i.Eb,_4e_ascendant:i.Kd,_4e_hasAttribute:i.Cc,_4e_hasAttributes:i.Ya,_4e_position:i.Da,_4e_address:i.Ba,_4e_breakParent:i.Db,_4e_style:i.L,_4e_remove:i.h,_4e_trim:i.$a,_4e_ltrim:i.Fc,_4e_rtrim:i.Hc,_4e_appendBogus:i.Cb,_4e_last:i.Qd,_4e_previous:i.ra,_4e_next:i.Ca,_4e_outerHtml:i.Za,
_4e_setMarker:i.Rd,_4e_clearMarkers:i.Bc,_4e_getUniqueId:i.qf,_4e_copyAttributes:i.Ld,_4e_isEditable:i.Dc,_4e_scrollIntoView:i.Jb,_4e_getElementsByTagName:i.Nd});x.Pd(i)});
KISSY.Editor.add("focusmanager",function(q){function A(){this.ec=f;s=this;J.log(this.Ea+" focus")}function u(){this.ec=g;s=e;J.log(this.Ea+" blur")}var J=KISSY,z=J.DOM,x=J.Event,t={},s,p={If:function(){for(var o in t){var D=t[o];D.document.designMode="off";D.document.designMode="on"}},xf:function(){return s},ue:function(o){return t[o]},add:function(o){var D=z.ea(o.document);x.on(D,"focus",A,o);x.on(D,"blur",u,o)},Me:function(o){t[o.Ea]=o},remove:function(o){delete t[o.Ea];var D=z.ea(o.document);x.remove(D,
"focus",A,o);x.remove(D,"blur",u,o)}},f=S,g=X,e=T;q.se=p;q.focusManager=p;q.$c=function(){return t};q.getInstances=q.$c});
KISSY.Editor.add("definition",function(q){var A=S,u=X,J=q.l,z=document,x=KISSY,t=x.UA,s=x.DOM,p=x.Node,f=x.Event,g=q.se,e=J.Cd,o=J.Tc("theme/editor-iframe.css"),D=1,i="document.open();"+(J.hb()?'document.domain="'+z.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(t.ie?"javascript:void(function(){"+encodeURIComponent(i)+"}())":"")+'"  tabIndex="'+(t.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";q.zc=0;q.Xa=1;q.SOURCE_MODE=q.zc;q.WYSIWYG_MODE=q.Xa;x.augment(q,{Be:function(b){if(t.ie)s.addClass(z.body,"ie"+t.ie);else if(t.gecko)s.addClass(z.body,"gecko");else t.webkit&&s.addClass(z.body,"webkit");var d=this,j=new p(a.replace(/\$\(tabIndex\)/,b.attr("tabIndex")));d.Cf=j;
d.Ea=D++;g.Me(d);d.rb=j.one(".ke-textarea-wrap");d.wrap=d.rb;d.gb=d.rb.one("iframe");d.iframe=d.gb;d.Bd=j.one(".ke-editor-tools");d.toolBarDiv=d.Bd;d.Z=b;d.textarea=d.Z;d.Se=j.one(".ke-editor-status");d.statusDiv=d.Se;J.Le(d.Bd);d.Kb={};d.Kc={};var y=b.L("width"),m=b.L("height");if(y){j.css("width",y);b.css("width","100%")}d.Z.css("display","none");j.insertAfter(b);d.rb[0].appendChild(b[0]);if(m){d.rb.css("height",m);b.css("height","100%")}j=d.gb;d.on("dataReady",function(){d.Wd=A;q.fire("instanceCreated",
{qe:d})});t.gecko?j.on("load",d.Mc,d):d.Mc();d.ha.wf&&b[0].form&&d.Ud()},Ud:function(){(new p(this.Z[0].form)).on("submit",this.Ad,this)},Ue:function(b,d){var j=this,y=q.kf;y.Ff();j.use(b,function(){var m=j.Yc(b);d(m);y.Of()})},Zd:function(b,d){this.Kc[b]=d},Yc:function(b){return this.Kc[b]},$d:function(b){this.ready(b)},Xd:function(b,d){this.Kb[b]=d},ye:function(b){return this.Kb[b]},execCommand:function(b){var d=this.Kb[b],j=x.makeArray(arguments);j.shift();j.unshift(this);return d.exec.apply(d,
j)},Yb:function(){return this.Z.css("display")=="none"?q.Xa:q.zc},getData:function(b){var d;d=this.Yb()==q.Xa?this.document.body.innerHTML:this.Z.val();if(this.htmlDataProcessor)d=b?this.htmlDataProcessor.toHtml(d,"p"):this.htmlDataProcessor.toServer(d,"p");d=x.trim(d);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(d))d="";return d},setData:function(b){var d=b;if(this.htmlDataProcessor)d=this.htmlDataProcessor.toDataFormat(b,"p");this.document.body.innerHTML=d;this.Yb()!=q.Xa&&this.Z.val(b)},Ad:function(){this.Z.val(this.getData())},
Fa:function(b){b=b||0;return b+(this.ha.Fa||0)},rf:function(){return this.document.body.innerHTML},tf:function(b){this.document.body.innerHTML=b},Vd:function(b){var d=this.ha,j=d.ta,y="";if(j)for(var m=0;m<j.length;m++)y+='<link href="'+j[m]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+q.Config.base+o+"' rel='stylesheet'/><style>"+(d.Rb||"")+"</style>"+y+"</head><body class='ke-editor'>&nbsp;"+(b?'<script id="ke_actscript" type="text/javascript">'+
(J.hb()?'document.domain="'+z.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':"")+"</body></html>"},getSelection:function(){return q.Ac.getSelection(this.document)},focus:function(){var b=this.document,d=s.ea(b);t.webkit&&d&&d.parent&&d.parent.focus();d&&d.focus();b&&b.body.focus();this.kb()},blur:function(){s.ea(this.document).blur();this.document&&this.document.body.blur()},Yd:function(b){var d=this.ha,j=this.document;d.Rb=d.Rb||"";d.Rb+="\n"+b;d=j.createElement("style");
j.getElementsByTagName("head")[0].appendChild(d);if(d.styleSheet)d.styleSheet.cssText=b;else d.appendChild(j.createTextNode(b))},vf:function(b){var d=this.ha,j=this.document;d.ta=d.ta||[];d.ta.push(b);d=j.createElement("link");d.rel="stylesheet";j.getElementsByTagName("head")[0].appendChild(d);d.href=b},Jf:function(b){for(var d=this.ha,j=x.makeArray(this.document.getElementsByTagName("link")),y=0;y<j.length;y++)j[y].href==b&&s.h(j[y]);d.ta=d.ta||[];d=d.ta;b=x.indexOf(b,d);b!=-1&&d.splice(b,1)},Mc:function(){function b(){l=
m.document;d.document=l;j.detach();l.open("text/html","replace");l.write(y);l.close()}var d=this,j=d.gb,y=d.Vd(d.Ea),m=j[0].contentWindow,l;try{l=m.document}catch(k){j[0].src=j[0].src;if(t.ie<7){setTimeout(b,10);return}}b()},ready:function(b){this.Wd?b():this.on("dataReady",b)},ab:function(){var b=this;b.Lc&&clearTimeout(b.Lc);b.Lc=setTimeout(function(){var d=b.getSelection();if(d&&!d.hd){var j=d.$b(),y=new q.Sa(j);if(!b.kc||!b.kc.Rc(y)){b.kc=y;b.fire("selectionChange",{selection:d,path:y,element:j})}}},
100)},kb:function(){this.kc=T;this.ab()},gd:function(b,d){var j=this;j.focus();var y=b.d(),m=q.m,l=q.na,k=q.n,B=m.Qa[y],I=j.getSelection(),w=I&&I.A(),c,h,r,v,n;if(!w||w.length==0){var C=arguments,P=C.callee;setTimeout(function(){P.apply(j,C)},30)}else{j.fire("save");for(var M=w.length-1;M>=0;M--){c=w[M];c.deleteContents();h=!M&&b||b.K(A);d&&d(h);if(B)for(;(v=c.ua(u,A))&&(n=m[v.d()])&&!(n&&n[y]);)if(v.d()in m.span)c.pc(v);else if(c.sa()&&c.ja()){c.setStartBefore(v);c.collapse(A);v.h()}else c.oc();
c.insertNode(h);r||(r=h)}if(r){y=r.w(A);m=j.document;n=q.m;if(n.sc[h.d()]){y=new p(m.createTextNode(" "));y.insertAfter(r)}else if(y){if(y.d()=="br"&&n[y.parent().d()].p){n=new p("<p>&nbsp;</p>",T,m);y[0].parentNode.replaceChild(n[0],y[0]);y=n}}else{n=new p("<p>&nbsp;</p>",T,m);n.insertAfter(r);y=n}c.H(r,l.t);y&&y[0].nodeType==k.e&&c.jb(y);I.qb([c]);j.focus();h&&h.Jb();setTimeout(function(){j.fire("save")},10);return h}}},Ce:function(b){var d=this;if(d.htmlDataProcessor)b=d.htmlDataProcessor.toDataFormat(b);
if(t.webkit){var j=s.create(b,T,this.document);j=j.nodeType==11?x.makeArray(j.childNodes):[j];for(var y=0;y<j.length;y++)d.gd(new p(j[y]))}else{d.focus();y=(j=d.getSelection())&&j.A();if(!y||y.length==0){var m=arguments,l=m.callee;setTimeout(function(){l.apply(d,m)},30)}else{d.fire("save");if(t.ie){j=j.r();j.type=="Control"&&j.clear();j.createRange().pasteHTML(b)}else d.document.execCommand("inserthtml",u,b);d.focus();setTimeout(function(){d.fire("save")},10)}}}});q._initIFrame=function(b){function d(c){e(function(){m.designMode=
"on";setTimeout(function(){m.designMode="off";k.focus();if(!arguments.callee.Oe)arguments.callee.Oe=A},50)},function(){m.designMode="off";s.attr(k,"contentEditable",u);s.attr(k,"contentEditable",A);!c&&d(1)})}var j=g.ue(b);b=j.Z[0];var y=j.gb[0].contentWindow,m=j.document,l=j.ha;s.h(m.getElementById("ke_actscript"));var k=m.body;if(t.ie){k.hideFocus=A;k.disabled=A;k.contentEditable=A;k.removeAttribute("disabled")}else setTimeout(function(){if(t.gecko||t.opera)k.contentEditable=A;else if(t.webkit)k.parentNode.contentEditable=
A;else m.designMode="on"},0);if(t.webkit){f.on(m,"click",function(c){var h=new p(c.target);x.inArray(h.d(),["input","select"])&&c.preventDefault()});f.on(m,"mouseup",function(c){var h=new p(c.target);x.inArray(h.d(),["input","textarea"])&&c.preventDefault()})}if(t.gecko||t.ie||t.opera){var B;B=new p(s.insertAfter((new p('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],b));B.on("focus",function(){j.focus()});j.uf=function(){t.gecko&&j.ec&&B[0].focus()};
j.on("destroy",function(){})}if(t.ie&&m.compatMode=="CSS1Compat"||t.gecko||t.opera){var I=new p(m.documentElement);I.on("mousedown",function(c){if(c.target==I[0]){t.gecko&&d(u);B[0].focus()}})}f.on(y,"focus",function(){if(t.gecko)d(u);else t.opera&&k.focus();j.kb()});t.gecko&&f.on(j.document,"mousedown",function(){j.ec||d(u)});if(t.ie){f.on(m,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var h=j.getSelection(),r=h.Zb();if(r){j.fire("save");var v=h.A()[0].O();r.h();h.wd([v]);j.fire("save");c.preventDefault()}}});
if(m.compatMode=="CSS1Compat"){var w={33:1,34:1};f.on(m,"keydown",function(c){c.keyCode in w&&setTimeout(function(){j.getSelection().scrollIntoView()},0)})}}setTimeout(function(){t.ie&&setTimeout(function(){if(m){k.runtimeStyle.marginBottom="0px";k.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){j.fire("dataReady");var c=l.Af,h=l.zf;if(c||h)try{m.execCommand("enableObjectResizing",u,!c);m.execCommand("enableInlineTableEditing",u,!h)}catch(r){f.on(k,t.ie?"resizestart":"resize",function(v){if(c||
s.d(v.target)==="table"&&h)v.preventDefault()})}},10);t.webkit&&f.on(m,"mousedown",function(c){c=new p(c.target);x.inArray(c.d(),["img","hr","input","textarea","select"])&&j.getSelection().nc(c)});t.gecko&&f.on(m,"dragstart",function(c){var h=new p(c.target);h.d()==="img"&&/ke_/.test(h[0].className)&&c.preventDefault()});g.add(j)};i=q.prototype;J.o(i,{setData:i.setData,getData:i.getData,insertElement:i.gd,insertHtml:i.Ce,ready:i.ready,addCustomStyle:i.Yd,addCommand:i.Xd,hasCommand:i.ye,execCommand:i.execCommand,
addPlugin:i.$d,useDialog:i.Ue,addDialog:i.Zd,getDialog:i.Yc,getMode:i.Yb,sync:i.Ad,baseZIndex:i.Fa,getSelection:i.getSelection,focus:i.focus,blur:i.blur,notifySelectionChange:i.kb})});KISSY.Editor.add("zindex",function(){var q=KISSY.Editor;if(!q.Dd){q.Dd={af:1100,lf:1200,bf:99999,gf:900,jf:9999,LOADING:11E3,ff:12E3,mf:1200};q.Fa=function(A){var u=A,J=q.$c(),z;for(z in J){if(!J.hasOwnProperty(z))return;u=Math.max(u,J[z].Fa(A))}return u};q.baseZIndex=q.Fa;q.zIndexManager=q.Dd}});
KISSY.Editor.add("dtd",function(q){q.m=function(){function A(l){for(var k=arguments.length-1;k>0;)KISSY.mix(l,arguments[k--]);return l}var u={isindex:1,fieldset:1},J={input:1,button:1,select:1,textarea:1,label:1},z=A({a:1},J),x=A({iframe:1},z),t={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},s={ins:1,del:1,script:1,style:1},p=A({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},s),f=A({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},p),g=A({p:1},f);J=A({iframe:1},f,J);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=A({a:1},J),o={tr:1},D={"#":1},i=A({param:1},f),a=A({form:1},u,x,t,g),b={li:1},d={base:1,link:1,meta:1,title:1},j=A(d,{style:1,script:1}),y={head:1,body:1},m={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{ub:A({html:1},y,d),Qa:m,Ze:{body:1,div:1,td:1,th:1,caption:1,
form:1},sc:e,qc:A({script:1,style:1},m),rc:{script:1,style:1},sb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},tb:{dd:1,dt:1,li:1},Ed:{ul:1,ol:1,dl:1},uc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},aa:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$e:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},vc:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:y,head:j,style:D,body:a,base:{},link:{},meta:{},title:D,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:A(g,t),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:b,h1:e,h3:e,option:D,h2:e,form:A(u,x,t,g),select:{optgroup:1,option:1},font:e,ins:e,menu:b,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:D,tfoot:o,cite:e,li:a,input:{},iframe:a,
strong:e,textarea:D,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:i,sup:e,dd:a,strike:e,area:{},dir:b,map:A({area:1,form:1,p:1},u,s,t),applet:i,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:A({legend:1},f),thead:o,ul:b,acronym:e,b:e,a:J,blockquote:a,caption:e,i:e,u:e,tbody:o,s:e,address:A(x,g),tt:e,legend:e,q:e,pre:A(p,z),p:e,em:e,dfn:e}}();q.XHTML_DTD=q.m});
KISSY.Editor.add("elementpath",function(q){function A(f){var g=x,e=x,o=[];for(f=f;f&&f[0];){if(f[0].nodeType==z.e){if(!this.Fe)this.Fe=f;var D=f.d();if(!e){if(!g&&t[D])g=f;if(s[D]){var i;if(i=!g){if(i=D=="div"){a:{i=f;i=i[0]||i;i=i.childNodes;for(var a=0,b=i.length;a<b;a++){var d=i[a];if(d.nodeType==z.e&&J.Qa[d.nodeName.toLowerCase()]){i=S;break a}}i=X}i=!i}i=i}if(i)g=f;else e=f}}o.push(f);if(D=="body")break}f=f.parent()}this.block=this.z=g;this.blockLimit=this.F=e;this.elements=this.elements=o}var u=
KISSY.DOM,J=q.m,z=q.n,x=T,t={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},s={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};A.prototype={Rc:function(f){var g=this.elements;f=f&&f.elements;if(!f||g.length!=f.length)return X;for(var e=0;e<g.length;e++)if(!u.g(g[e],f[e]))return X;return S},contains:function(f){for(var g=this.elements,e=0;e<g.length;e++)if(g[e].d()in f)return g[e];return x}};q.ElementPath=q.Sa=A;var p=A.prototype;q.l.o(p,{compare:p.Rc,
contains:p.contains})});
KISSY.Editor.add("walker",function(q){function A(o,D){if(this.c.end)return t;var i,a=this.wa,b,d=this.ac,j=this.type,y=o?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return t}}if(!o&&!this.c.bd){var m=a.endContainer,l=new g(m[0].childNodes[a.endOffset]);this.c.bd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!f.g(m,w))&&(!l[0]||!w.g(l))&&(w[0].nodeType!=p.e||!c||w.d()!="body")}}if(o&&!this.c.cd){var k=a.startContainer,B=a.startOffset>
0&&new g(k[0].childNodes[a.startOffset-1]);this.c.cd=function(w,c){return(w=f.D(w))&&w[0]&&(!c||!w.g(k))&&(!B[0]||!w.g(B))&&(w[0].nodeType!=p.e||!c||w.d()!="body")}}var I=o?this.c.cd:this.c.bd;b=d?function(w,c){if(I(w,c)===x)return x;return d(w,c)}:I;if(this.db)i=this.db[y](x,j,b);else if(o){i=a.endContainer;if(a.endOffset>0){i=new g(i[0].childNodes[a.endOffset-1]);if(b(i)===x)i=t}else i=b(i,z)===x?t:i.fa(z,j,b)}else{i=a.startContainer;if((i=new g(i[0].childNodes[a.startOffset]))&&i[0]){if(b(i)===
x)i=t}else i=b(a.startContainer,z)===x?t:a.startContainer.w(z,j,b)}for(;i&&i[0]&&!this.c.end;){this.db=i;if(!this.Q||this.Q(i)!==x){if(!D)return i}else if(D&&this.Q)return x;i=i[y](x,j,b)}this.end();return this.db=t}function u(o){for(var D,i=t;D=A.call(this,o);)i=D;return i}function J(o){this.wa=o;this.c={}}var z=S,x=X,t=T,s=KISSY,p=q.n,f=s.DOM,g=s.Node;s.augment(J,{end:function(){this.c.end=1},next:function(){return A.call(this)},nb:function(){return A.call(this,z)},Qc:function(){return A.call(this,
x,z)!==x},Pc:function(){return A.call(this,z,z)!==x},kd:function(){return u.call(this)},jd:function(){return u.call(this,z)},reset:function(){delete this.db;this.c={}}});J.Nb=function(o){return function(D){D=f.D(D);return!(D&&D[0].nodeType==p.e&&D.pa(o))}};J.Ie=function(){return this.Nb({Ob:1})};J.Ga=function(o,D){function i(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,d;b=a&&a[0]&&a[0].nodeType==p.f&&(d=a.parent())&&i(d);b=o?b:b||i(a);return D^b}};J.Pa=function(o){return function(D){D=
(D=D[0]||D)&&D.nodeType==p.f&&!s.trim(D.nodeValue);return o^D}};J.De=function(o){var D=J.Pa();return function(i){i=D(i)||i[0].nodeType==p.e&&!i[0].offsetHeight;return o^i}};q.Aa=J;q.Walker=J;var e=J.prototype;q.l.o(e,{end:e.end,next:e.next,previous:e.nb,checkForward:e.Qc,checkBackward:e.Pc,lastForward:e.kd,lastBackward:e.jd,reset:e.reset});q.l.o(J,{blockBoundary:J.Nb,listItemBoundary:J.Ie,bookmark:J.Ga,whitespaces:J.Pa,invisible:J.De})});
KISSY.Editor.add("range",function(q){function A(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=s;this.document=c}function u(c){var h=c[0].nodeType!=e.f&&c.d()in j.aa,r=!g.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||r||c}function J(c){return!B(c)&&!I(c)}function z(c){var h=p,r=i.Ga(s);return function(v){if(r(v))return s;if(v[0].nodeType==e.f){if(g.trim(v[0].nodeValue).length)return p}else if(v[0].nodeType==e.e)if(!k[v.d()])if(!c&&!d.ie&&
v.d()=="br"&&!h)h=s;else return p;return s}}function x(c,h){function r(v){return v&&v.nodeName=="span"&&v.getAttribute("_ke_bookmark")}return function(v){var n,C;n=v&&!v.nodeName&&(C=v.parentNode)&&r(C);n=c?n:n||r(v);return h^n}}function t(c){return function(h){h=(h=h[0]||h)&&h.nodeType==e.f&&!g.trim(h.nodeValue);return c^h}}q.na={V:1,J:2,C:3,t:4,xb:1,wb:2,Ra:3,Va:1,Gd:2,nf:3,da:1,yc:2};q.RANGE=q.na;var s=S,p=X,f=T,g=KISSY,e=q.n,o=q.na,D=q.Ta,i=q.Aa,a=g.DOM,b=q.l.Xc,d=g.UA,j=q.m,y=q.Sa,m=g.Node,l=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};A.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};g.augment(A,{Oa:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},ic:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=e.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.v()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.v())},setEndAfter:function(c){this.setEnd(c.parent(),c.v()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.v())},jc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.T(c,o.C);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.S(h,o.t)},setStart:function(c,h){if(c[0].nodeType==e.e&&l[c.d()]){c=c.parent();h=c.v()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Oa()},setEnd:function(c,h){if(c[0].nodeType==e.e&&l[c.d()]){c=c.parent();h=c.v()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Oa()},T:function(c,h){switch(h){case o.V:this.setStart(c,0);break;case o.J:c[0].nodeType==e.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case o.C:this.setStartBefore(c);break;case o.t:this.setStartAfter(c)}this.Oa()},S:function(c,h){switch(h){case o.V:this.setEnd(c,0);break;case o.J:c[0].nodeType==e.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case o.C:this.setEndBefore(c);break;case o.t:this.setEndAfter(c)}this.Oa()},
Ub:function(c,h){var r=this.startContainer,v=this.endContainer,n=this.startOffset,C=this.endOffset,P,M=this.document,O;this.jc();if(v[0].nodeType==e.f)v=v.ga(C);else if(v[0].childNodes.length>0)if(C>=v[0].childNodes.length){v=new m(v[0].appendChild(M.createTextNode("")));O=s}else v=new m(v[0].childNodes[C]);if(r[0].nodeType==e.f){r.ga(n);if(r.g(v))v=new m(r[0].nextSibling)}else if(n)if(n>=r[0].childNodes.length){P=new m(M.createTextNode(""));r.append(P);r=P;P=s}else r=new m(r[0].childNodes[n].previousSibling);
else{P=new m(M.createTextNode(""));r.prepend(P);r=P;P=s}n=r.Ib();C=v.Ib();var Q,W,U;for(Q=0;Q<n.length;Q++){W=n[Q];U=C[Q];if(!W.g(U))break}M=h;for(var V,Y,E,K=Q;K<n.length;K++){V=n[K];Y=M&&!V.g(r)?M.appendChild(V.K()[0]):T;for(V=V[0].nextSibling;V;){if(a.g(C[K],V)||a.g(v,V))break;E=V.nextSibling;if(c==2)M.appendChild(V.cloneNode(s));else{a.h(V);c==1&&M.appendChild(V)}V=E}if(Y)M=Y}M=h;for(Q=Q;Q<C.length;Q++){V=C[Q];Y=M&&c>0&&!V.g(v)?M.appendChild(V.K()[0]):T;if(!n[Q]||!V.parent().g(n[Q].parent()))for(V=
V[0].previousSibling;V;){if(a.g(n[Q],V)||a.g(r,V))break;E=V.previousSibling;if(c==2)M.insertBefore(V.cloneNode(s),M.firstChild);else{a.h(V);c==1&&M.insertBefore(V,M.firstChild)}V=E}if(Y)M=Y}if(c==2){U=this.startContainer[0];if(U.nodeType==e.f&&U.nextSibling&&U.nextSibling.nodeType==e.f){U.data+=U.nextSibling.data;U.parentNode.removeChild(U.nextSibling)}U=this.endContainer[0];if(U.nodeType==e.f&&U.nextSibling&&U.nextSibling.nodeType==e.f){U.data+=U.nextSibling.data;U.parentNode.removeChild(U.nextSibling)}}else{if(W&&
U&&(!r.parent().g(W.parent())||!v.parent().g(U.parent()))){W=U.v();P&&U.parent().g(r.parent())&&W--;this.setStart(U.parent(),W)}this.collapse(s)}P&&r.h();O&&v[0].parentNode&&v.h()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=s},clone:function(){var c=new A(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},Zc:function(){var c=this.clone();c.ic();if(c.startContainer[0].nodeType!=e.e||c.endContainer[0].nodeType!=e.e)return f;var h=new q.Aa(c),r=x(s,undefined),v=t(s);c.Q=function(n){return v(n)&&r(n)};c=h.next();h.reset();h=h.nb();return c&&c.g(h)?c:f},Na:function(c,h){if(!this.collapsed){c=c||o.yc;var r=this.clone(),v=this.startContainer,n=this.endContainer,C=this.startOffset,P=this.endOffset,M=1,O=1;if(v&&v[0].nodeType==e.f)if(C)if(C>=v[0].nodeValue.length)r.setStartAfter(v);
else{r.setStartBefore(v);M=0}else r.setStartBefore(v);if(n&&n[0].nodeType==e.f)if(P)if(P>=n[0].nodeValue.length)r.setEndAfter(n);else{r.setEndAfter(n);O=0}else r.setEndBefore(n);r=new i(r);r.Q=function(W){W=W[0]||W;return W.nodeType==(c==o.da?e.e:e.f)};var Q;r.ac=function(W,U){W=W[0]||W;if(c==o.da&&W.nodeType==e.f)return p;if(U&&W==Q)return p;if(!U&&W.nodeType==e.e)Q=W;return s};if(M)(v=r[c==o.da?"lastForward":"next"]())&&this.T(v,h?o.V:o.C);if(O){r.reset();(r=r[c==o.da?"lastBackward":"previous"]())&&
this.S(r,h?o.J:o.t)}return!!(M||O)}},we:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=e.e)return c;return c.childNodes[this.startOffset]||c},Sc:function(c){var h=this.startContainer,r=this.endContainer,v=this.startOffset,n=this.endOffset,C,P;if(!h||!r)return{start:0,end:0};if(c){if(h[0].nodeType==e.e)if((C=new m(h[0].childNodes[v]))&&C[0]&&C[0].nodeType==e.f&&v>0&&C[0].previousSibling.nodeType==e.f){h=C;v=0}for(;h[0].nodeType==e.f&&(P=h.ra())&&P[0].nodeType==e.f;){h=P;v+=
P[0].nodeValue.length}if(!this.collapsed){if(r[0].nodeType==e.e)if((C=new m(r[0].childNodes[n]))&&C[0]&&C[0].nodeType==e.f&&n>0&&C[0].previousSibling.nodeType==e.f){r=C;n=0}for(;r[0].nodeType==e.f&&(P=r.ra())&&P[0].nodeType==e.f;){r=P;n+=P[0].nodeValue.length}}}return{start:h.Ba(c),end:this.collapsed?f:r.Ba(c),startOffset:v,endOffset:n,md:c,Ee:s}},O:function(c){var h,r,v,n,C=this.collapsed;h=new m("<span>",f,this.document);h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){v=
g.guid("ke_bm_");h.attr("id",v+"S")}if(!C){r=h.K();r.html("&nbsp;");c&&r.attr("id",v+"E");n=this.clone();n.collapse();n.insertNode(r)}n=this.clone();n.collapse(s);n.insertNode(h);if(r){this.setStartAfter(h);this.setEndBefore(r)}else this.H(h,o.t);return{Y:c?v+"S":h,P:c?v+"E":r,yd:c,collapsed:C}},H:function(c,h){this.T(c,h);this.collapse(s)},trim:function(c,h){var r=this.startContainer,v=this.startOffset,n=this.collapsed;if((!c||n)&&r[0]&&r[0].nodeType==e.f){if(v)if(v>=r[0].nodeValue.length){v=r.v()+
1;r=r.parent()}else{var C=r.ga(v);v=r.v()+1;r=r.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(C,this.endOffset-this.startOffset);else if(a.g(r,this.endContainer))this.endOffset+=1}else{v=r.v();r=r.parent()}this.setStart(r,v);if(n){this.collapse(s);return}}r=this.endContainer;v=this.endOffset;if(!(h||n)&&r[0]&&r[0].nodeType==e.f){if(v){v>=r.nodeValue.length||r.ga(v);v=r.v()+1}else v=r.v();r=r.parent();this.setEnd(r,v)}},insertNode:function(c){this.jc();this.trim(p,s);var h=this.startContainer;
h[0].insertBefore(c[0]||c,h[0].childNodes[this.startOffset]||T);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.Ee){var h=b(this.document,c.start,c.md),r=c.startOffset,v=c.end&&b(this.document,c.end,c.md);c=c.endOffset;this.setStart(h,r);v?this.setEnd(v,c):this.collapse(s)}else{h=(r=c.yd)?g.one("#"+c.Y,this.document):c.Y;c=r?g.one("#"+c.P,this.document):c.P;this.setStartBefore(h);h.h();if(c&&c[0]){this.setEndBefore(c);c.h()}else this.collapse(s)}},
ua:function(c,h){var r=this.startContainer,v=this.endContainer;r=a.g(r,v)?c&&r[0].nodeType==e.e&&this.startOffset==this.endOffset-1?new m(r[0].childNodes[this.startOffset]):r:r.Eb(v);return h&&r[0].nodeType==e.f?r.parent():r},Ia:function(c){switch(c){case o.xb:if(this.collapsed)break;c=this.ua();var h=new m(this.document.body),r,v,n,C,P,M=p,O,Q;O=this.startContainer;Q=this.startOffset;if(O[0].nodeType==e.f){if(Q){O=!g.trim(O[0].nodeValue.substring(0,Q)).length&&O;M=!!O}if(O)if(!(C=O[0].previousSibling))n=
O.parent()}else{if(Q)C=O[0].childNodes[Q-1]||O[0].lastChild;C||(n=O)}for(;n||C;){if(n&&!C){if(!P&&a.g(n,c))P=s;if(!h.contains(n))break;if(!M||n.css("display")!="inline"){M=p;if(P)r=n;else this.setStartBefore(n)}C=n[0].previousSibling}for(;C;){O=p;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;O=/[\s\ufeff]$/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(M&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else for(var W=C.all||C.getElementsByTagName("*"),
U=0,V;V=W[U++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}if(C)O=!!Q.length}else C=f;if(O)if(M)if(P)r=n;else n&&this.setStartBefore(n);else M=s;if(C){O=C.previousSibling;if(!n&&!O){n=new m(C);C=f;break}C=O}else n=f}if(n)n=n.parent()}O=this.endContainer;Q=this.endOffset;n=C=f;P=M=p;if(O[0].nodeType==e.f){O=!g.trim(O[0].nodeValue.substring(Q)).length&&O;M=!(O&&O[0].nodeValue.length);if(O)if(!(C=O[0].nextSibling))n=O.parent()}else(C=O[0].childNodes[Q])||(n=O);for(;n||C;){if(n&&!C){if(!P&&a.g(n,c))P=
s;if(!h.contains(n))break;if(!M||n.css("display")!="inline"){M=p;if(P)v=n;else n&&this.setEndAfter(n)}C=n[0].nextSibling}for(;C;){O=p;if(C.nodeType==e.f){Q=C.nodeValue;if(/[^\s\ufeff]/.test(Q))C=f;O=/^[\s\ufeff]/.test(Q)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(M&&j.aa[C.nodeName.toLowerCase()]){Q=a.text(C);if(/[^\s\ufeff]/.test(Q))C=f;else{W=C.all||C.getElementsByTagName("*");for(U=0;V=W[U++];)if(!j.aa[V.nodeName.toLowerCase()]){C=f;break}}if(C)O=!!Q.length}else C=f;if(O)if(M)if(P)v=
n;else this.setEndAfter(n);if(C){O=C.nextSibling;if(!n&&!O){n=new m(C);C=f;break}C=O}else n=f}if(n)n=n.parent()}if(r&&v){c=r.contains(v)?v:r;this.setStartBefore(c);this.setEndAfter(c)}break;case o.wb:case o.Ra:n=new A(this.document);h=new m(this.document.body);n.T(h,o.V);n.setEnd(this.startContainer,this.startOffset);n=new i(n);var Y,E,K=i.Nb(c==o.Ra?{Ob:1}:f),G=function(F){var H=K(F);H||(Y=F);return H};r=function(F){var H=G(F);if(!H&&F[0]&&F.d()=="br")E=F;return H};n.ac=G;n=n.jd();Y=Y||h;this.T(Y,
Y.d()!="br"&&(!n&&this.sa()||n&&Y.contains(n))?o.V:o.t);n=this.clone();n.collapse();n.S(h,o.J);n=new i(n);n.ac=c==o.Ra?r:G;Y=f;n=n.kd();Y=Y||h;this.S(Y,!n&&this.ja()||n&&Y.contains(n)?o.J:o.C);E&&this.setEndAfter(E)}},sa:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(0,h)).length)return p;this.trim();c=new y(this.startContainer);h=this.clone();h.collapse(s);h.T(c.z||c.F,o.V);c=new i(h);c.Q=z(s);return c.Pc()},ja:function(){var c=
this.endContainer,h=this.endOffset;if(c[0].nodeType==e.f)if(g.trim(c[0].nodeValue.substring(h)).length)return p;this.trim();c=new y(this.endContainer);h=this.clone();h.collapse(p);h.S(c.z||c.F,o.J);c=new i(h);c.Q=z(p);return c.Qc()},deleteContents:function(){this.collapsed||this.Ub(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.Ub(1,c);return c},Qb:function(c,h){var r=this.clone();r[h==o.Va?"setStartAt":"setEndAt"](c,h==o.Va?o.V:o.J);r=new i(r);r.Q=
u;return r[h==o.Va?"checkBackward":"checkForward"]()},Wc:function(){var c=this.startContainer,h=this.endContainer,r=this.startOffset,v=this.endOffset,n;if(c[0].nodeType==e.e){n=c[0].childNodes.length;if(n>r)c=new m(c[0].childNodes[r]);else if(n<1)c=c.fa();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new m(c);c=c.w()||c}}if(h[0].nodeType==e.e){n=h[0].childNodes.length;if(n>v)h=(new m(h[0].childNodes[v])).fa(s);else if(n<1)h=h.fa();else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new m(h)}}if(c.Da(h)&D.ba)c=
h;return{Y:c,P:h}},eb:function(c,h){var r=this.O(),v=new m(this.document.createElement(h));this.collapse(c);this.Ia(o.wb);v[0].appendChild(this.extractContents());v.$a();d.ie||v.Cb();this.insertNode(v);this.moveToBookmark(r);return v},oc:function(c){var h=new y(this.startContainer),r=new y(this.endContainer),v=h.z,n=r.z,C=f;if(!h.F.g(r.F))return f;if(c!="br"){if(!v){v=this.eb(s,c);n=(new y(this.endContainer)).z}n||(n=this.eb(p,c))}c=v&&this.sa();h=n&&this.ja();this.deleteContents();if(v&&a.g(v,n))if(h){C=
new y(this.startContainer);this.H(n,o.t);n=f}else if(c){C=new y(this.startContainer);this.H(v,o.C);v=f}else{n=this.pc(v);!d.ie&&!g.inArray(v.d(),["ul","ol"])&&v.Cb()}return{Hf:v,Gf:n,Xe:c,We:h,Df:C}},pc:function(c){if(!this.collapsed)return f;this.S(c,o.J);var h=this.extractContents(),r=c.K(p);r[0].appendChild(h);r.insertAfter(c);this.H(c,o.t);return r},jb:function(c,h){var r,v=q.m;if(v.sb[c.d()])return p;for(;c&&c[0].nodeType==e.e;){if(r=c.Dc())this.H(c,h?o.J:o.V);else if(v.sc[c.d()]){this.H(c,h?
o.t:o.C);return s}if((c=v.sb[c.d()]?c[h?"_4e_previous":"_4e_next"](J):c[h?"_4e_last":"_4e_first"](J))&&c[0].nodeType==e.f){this.H(c,h?o.t:o.C);return s}}return r},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==e.f?c[0].nodeValue.length:c[0].childNodes.length)}});var k={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},B=new i.Pa,I=new i.Ga;q.Range=
A;q.Range=A;var w=A.prototype;q.l.o(w,{updateCollapsed:w.Oa,optimize:w.ic,setStartAfter:w.setStartAfter,setEndAfter:w.setEndAfter,setStartBefore:w.setStartBefore,setEndBefore:w.setEndBefore,optimizeBookmark:w.jc,setStart:w.setStart,setEnd:w.setEnd,setStartAt:w.T,setEndAt:w.S,execContentsAction:w.Ub,collapse:w.collapse,clone:w.clone,getEnclosedNode:w.Zc,shrink:w.Na,getTouchedStartNode:w.we,createBookmark2:w.Sc,createBookmark:w.O,moveToPosition:w.H,trim:w.trim,insertNode:w.insertNode,moveToBookmark:w.moveToBookmark,
getCommonAncestor:w.ua,enlarge:w.Ia,checkStartOfBlock:w.sa,checkEndOfBlock:w.ja,deleteContents:w.deleteContents,extractContents:w.extractContents,checkBoundaryOfElement:w.Qb,getBoundaryNodes:w.Wc,fixBlock:w.eb,splitBlock:w.oc,splitElement:w.pc,moveToElementEditablePosition:w.jb,selectNodeContents:w.selectNodeContents})});
KISSY.Editor.add("domiterator",function(q){function A(i){if(!(arguments.length<1)){this.wa=i;this.Wb=J;this.Vc=u;this.Tb=J;this.c||(this.c={})}}var u=S,J=X,z=KISSY,x=z.UA,t=q.Aa,s=q.Range,p=q.na,f=q.n,g=q.Sa,e=z.Node,o=z.DOM,D=/^[\r\n\t ]*$/;z.augment(A,{ve:function(i){var a,b,d,j,y;if(!this.c.I){b=this.wa.clone();b.Na(p.da,u);b.Ia(this.Wb||!this.Vc?p.Ra:p.wb);var m=new t(b),l=t.Ga(u,u);m.Q=l;this.c.ka=m.next();m=new t(b);m.Q=l;m=m.nb();this.c.I=m.w(u);if(this.c.I&&this.c.I[0].nodeType==f.f&&!z.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().pa()){l=new s(b.document);l.H(this.c.I,p.t);if(l.ja()){l=new g(l.endContainer);this.c.I=(l.z||l.F).w(u)}}if(!this.c.I){this.c.I=this.c.Uc=new e(b.document.createTextNode(""));o.insertAfter(this.c.I[0],m[0])}b=T}l=this.c.ka;m=this.c.I;for(this.c.ka=T;l;){var k=J,B=l[0].nodeType!=f.e,I=J;if(B){if(l[0].nodeType==f.f)if(D.test(l[0].nodeValue))B=J}else{var w=l.d();if(l.pa(this.Wb&&{Ob:1})){if(w=="br")B=u;else if(!b&&!l[0].childNodes.length&&w!="hr"){a=l;d=l.g(m);break}if(b){b.S(l,p.C);
if(w!="br")this.c.ka=l}k=u}else{if(l[0].firstChild){if(!b){b=new s(this.wa.document);b.T(l,p.C)}l=new e(l[0].firstChild);continue}B=u}}if(B&&!b){b=new s(this.wa.document);b.T(l,p.C)}d=(!k||B)&&l.g(m);if(b&&!k)for(;!l[0].nextSibling&&!d;){w=l.parent();if(w.pa(this.Wb&&{Ob:1})){k=u;d||w.g(m);break}l=w;B=u;d=l.g(m);I=u}B&&b.S(l,p.t);l=l.w(I,T,m);if((d=!l)||k&&b)break}if(!a){if(!b){this.c.Uc&&this.c.Uc.h();return this.c.ka=T}a=new g(b.startContainer);l=a.F;k={Bf:1,Nf:1,Mf:1};a=a.z;if((!a||!a[0])&&!this.Tb&&
k[l.d()]&&b.sa()&&b.ja())a=l;else if(!a||this.Tb&&a.d()=="li"){a=new e(this.wa.document.createElement(i||"p"));a[0].appendChild(b.extractContents());a.$a();b.insertNode(a);j=y=u}else if(a.d()!="li"){if(!b.sa()||!b.ja()){a=a.K(J);a[0].appendChild(b.extractContents());a.$a();y=b.oc();j=!y.Xe;y=!y.We;b.insertNode(a)}}else if(!d)this.c.ka=a.g(m)?T:b.Wc().P.w(u,T,m)}if(j){b=new e(a[0].previousSibling);if(b[0]&&b[0].nodeType==f.e)if(b.d()=="br")b.h();else b[0].lastChild&&o.d(b[0].lastChild)=="br"&&o.h(b[0].lastChild)}if(y){b=
t.Ga(J,u);j=new e(a[0].lastChild);if(j[0]&&j[0].nodeType==f.e&&j.d()=="br")if(x.ie||j.ra(b)||j.Ca(b))j.h()}if(!this.c.ka)this.c.ka=d||a.g(m)?T:a.w(u,T,m);return a}});s.prototype.ne=function(){return new A(this)}});
KISSY.Editor.add("selection",function(q){function A(l){this.document=this.document=l;this.c={M:{}};if(p.ie){var k=this.r().createRange();if(!k||k.item&&k.item(0).ownerDocument!=l||k.parentElement&&k.parentElement().ownerDocument!=l)this.hd=z}}function u(l){l=new A(l);return!l||l.hd?t:l}function J(l){var k=l.document,B=new e(k.body),I=new e(k.documentElement);if(p.ie){if(p.ie<8||document.documentMode==7)I.on("click",function(M){f.d(M.target)==="html"&&l.getSelection().A()[0].select()});var w,c,h=1;
I.on("mousedown",function(){h=0});I.on("mouseup",function(){h=1});B.on("focusin",function(M){if(f.d(M.target)=="body")if(w){try{h&&w.select()}catch(O){}w=t}});B.on("focus",function(){c=z;v()});B.on("beforedeactivate",function(M){if(!M.relatedTarget){c=x;h=1}});g.on(f.ea(k),"blur",function(){k&&k.selection.empty()});B.on("mousedown",function(){r()});B.on("mouseup",function(){c=z;setTimeout(function(){v(z)},0)});var r=function(){c=x},v=function(M){if(c){var O=l.document,Q=l.getSelection(),W=Q&&Q.fb(),
U=Q&&Q.r();if(M&&U&&W==o.zb)if(!O.queryCommandEnabled("InsertImage")){setTimeout(function(){v(z)},50);return}var V;if(!(U&&W==o.oa&&(V=f.d(U.createRange().parentElement()))&&V in{input:1,textarea:1})){w=U&&Q.A()[0];l.ab()}}};B.on("keydown",r);B.on("keyup",function(){c=z;v()});g.on(k,"selectionchange",v)}else{g.on(k,"mouseup",l.ab,l);g.on(k,"keyup",l.ab,l)}var n={table:1,pre:1},C=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,P=q.Aa.Pa(z);
l.on("selectionChange",function(M){var O=M.path;M=(M=M.selection)&&M.A()[0];if(!(!M||!M.collapsed||O.z))if(O.F.d()=="body"){O=M.eb(z,"p");if(O.Za().match(C)){var Q=O.Ca(P);if(Q&&Q[0].nodeType==i.e&&!n[Q.d()]){M.jb(Q);O.h()}else if((Q=O.ra(P))&&Q[0].nodeType==i.e&&!n[Q.d()]){M.jb(Q,Q.Za().match(C)?x:z);O.h()}}M.select();p.ie||l.kb()}})}q.Jd={zb:1,oa:2,Ua:3};var z=S,x=X,t=T,s=KISSY,p=s.UA,f=s.DOM,g=s.Event,e=s.Node,o=q.Jd,D=q.na,i=q.n,a=q.Aa,b=q.Range,d={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,
object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};s.augment(A,{r:p.ie?function(){var l=this.c.M;return l.gc||(l.gc=this.document.selection)}:function(){var l=this.c.M;return l.gc||(l.gc=f.ea(this.document).getSelection())},fb:p.ie?function(){var l=this.c.M;if(l.type)return l.type;var k=o.zb;try{var B=this.r(),I=B.type;if(I=="Text")k=o.oa;if(I=="Control")k=o.Ua;if(B.createRange().parentElement)k=o.oa}catch(w){}return l.type=k}:function(){var l=this.c.M;
if(l.type)return l.type;var k=o.oa,B=this.r();if(B){if(B.rangeCount==1){B=B.getRangeAt(0);var I=B.startContainer;if(I==B.endContainer&&I.nodeType==i.e&&B.endOffset-B.startOffset===1&&d[I.childNodes[B.startOffset].nodeName.toLowerCase()])k=o.Ua}}else k=o.zb;return l.type=k},A:p.ie?function(){function l(k,B){k=k.duplicate();k.collapse(B);for(var I=k.parentElement(),w=I.childNodes,c,h=0;h<w.length;h++){var r=w[h];if(r.nodeType==i.e){c=k.duplicate();c.moveToElementText(r);r=c.compareEndPoints("StartToStart",
k);var v=c.compareEndPoints("EndToStart",k);c.collapse();if(r>0)break;else if(!r||v==1&&r==-1)return{Ha:I,offset:h};else if(!v)return{Ha:I,offset:h+1};c=t}}if(!c){c=k.duplicate();c.moveToElementText(I);c.collapse(x)}c.setEndPoint("StartToStart",k);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=w[--h].nodeValue.length}catch(n){c=0}return c===0?{Ha:I,offset:h}:{Ha:w[h],offset:-c}}return function(){var k=this.c.M;if(k.ma)return k.ma;var B=this.r(),I=B&&B.createRange(),w=this.fb();if(!B)return[];
if(w==o.oa){B=new b(this.document);w=l(I,z);B.setStart(new e(w.Ha),w.offset);w=l(I);B.setEnd(new e(w.Ha),w.offset);return k.ma=[B]}else if(w==o.Ua){k=k.ma=[];for(w=0;w<I.length;w++){var c=I.item(w),h=c.parentNode,r=0;for(B=new b(this.document);r<h.childNodes.length&&h.childNodes[r]!=c;r++);B.setStart(new e(h),r);B.setEnd(new e(h),r+1);k.push(B)}return k}return k.ma=[]}}():function(){var l=this.c.M;if(l.ma)return l.ma;var k=[],B=this.r();if(!B)return[];for(var I=0;I<B.rangeCount;I++){var w=B.getRangeAt(I),
c=new b(this.document);c.setStart(new e(w.startContainer),w.startOffset);c.setEnd(new e(w.endContainer),w.endOffset);k.push(c)}return l.ma=k},$b:function(){var l=this.c.M;if(l.zd!==undefined)return l.zd;var k,B=this.r();switch(this.fb()){case o.Ua:return this.Zb();case o.oa:var I=this.A()[0];if(I)if(!I.collapsed){for(I.ic();z;){k=I.startContainer;if(I.startOffset==(k[0].nodeType===i.e?k[0].childNodes.length:k[0].nodeValue.length)&&!k.pa())I.setStartAfter(k);else break}k=I.startContainer;if(k[0].nodeType!=
i.e)return k.parent();k=new e(k[0].childNodes[I.startOffset]);if(!k[0]||k[0].nodeType!=i.e)return I.startContainer;for(I=k[0].firstChild;I&&I.nodeType==i.e;){k=new e(I);I=I.firstChild}return k}if(p.ie){I=B.createRange();I.collapse(z);k=I.parentElement()}else if((k=B.anchorNode)&&k.nodeType!=i.e)k=k.parentNode}return l.zd=k?f.D(k):t},Zb:function(){var l=this,k,B=l.c.M;if(B.xd!==undefined)return B.xd;if(p.ie){k=l.r().createRange();k=k.item&&k.item(0)}k||(k=function(){for(var I=l.A()[0],w,c,h=2;h&&!((w=
I.Zc())&&w[0].nodeType==i.e&&d[w.d()]&&(c=w));h--)I.Na(D.da);return c&&c[0]}());return B.xd=f.D(k)},reset:function(){this.c.M={}},nc:function(l){var k;if(p.ie)try{k=this.document.body.createControlRange();k.addElement(l[0]);k.select()}catch(B){k=this.document.body.createTextRange();k.moveToElementText(l[0]);k.select()}finally{}else{k=this.document.createRange();k.selectNode(l[0]);l=this.r();l.removeAllRanges();l.addRange(k)}this.reset()},qb:function(l){if(p.ie){if(l.length>1){var k=l[l.length-1];
l[0].setEnd(k.endContainer,k.endOffset);l.length=1}l[0]&&l[0].select()}else{k=this.r();if(!k)return;k.removeAllRanges();for(var B=0;B<l.length;B++){var I=l[B],w=this.document.createRange(),c=I.startContainer;I.collapsed&&p.gecko&&p.gecko<1.09&&c[0].nodeType==i.e&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));w.setStart(c[0],I.startOffset);w.setEnd(I.endContainer[0],I.endOffset);k.addRange(w)}}this.reset()},me:function(l){for(var k=[],B=this.A(),I=0;I<B.length;I++)k.push(B[I].Sc(l));
return k},le:function(l,k){var B=[],I=this.document,w;k=k||this.A();for(var c=k.length,h=0;h<c;h++){B.push(w=k[h].O(l,z));var r=(l=w.yd)?s.one("#"+w.Y,I):w.Y;w=l?s.one("#"+w.P,I):w.P;for(var v=h+1;v<c;v++){var n=k[v],C=n.startContainer,P=n.endContainer;f.g(C,r.parent())&&n.startOffset++;f.g(C,w.parent())&&n.startOffset++;f.g(P,r.parent())&&n.endOffset++;f.g(P,w.parent())&&n.endOffset++}}return B},wd:function(l){for(var k=[],B=0;B<l.length;B++){var I=new b(this.document);I.moveToBookmark(l[B]);k.push(I)}this.qb(k);
return this},ua:function(){var l=this.A();return l[0].startContainer.Eb(l[l.length-1].endContainer)},scrollIntoView:function(){var l=this.$b();l&&l.Jb()},removeAllRanges:function(){var l=this.r();if(p.ie)l&&l.clear();else l&&l.removeAllRanges()}});var j={table:1,tbody:1,tr:1},y=a.Pa(z),m=/\ufeff|\u00a0/;b.prototype.select=b.prototype.select=p.ie?function(l){var k=this.collapsed,B,I;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var w=this.startContainer[0].childNodes[this.startOffset];
if(w.nodeType==i.e){(new A(this.document)).nc(new e(w));return}}if(this.startContainer[0].nodeType==i.e&&this.startContainer.d()in j||this.endContainer[0].nodeType==i.e&&this.endContainer.d()in j)this.Na(D.da,z);var c=this.O();w=c.Y;var h;if(!k)h=c.P;c=this.document.body.createTextRange();c.moveToElementText(w[0]);c.moveStart("character",1);if(h){l=this.document.body.createTextRange();l.moveToElementText(h[0]);c.setEndPoint("EndToEnd",l);c.moveEnd("character",-1)}else{for(B=w[0].nextSibling;B&&!y(B);)B=
B.nextSibling;B=!(B&&B.nodeValue&&B.nodeValue.match(m))&&(l||!w[0].previousSibling||w[0].previousSibling&&f.d(w[0].previousSibling)=="br");I=this.document.createElement("span");I.innerHTML="&#65279;";I=(new e(I)).insertBefore(w);B&&f.insertBefore(this.document.createTextNode("\ufeff"),w)}this.setStartBefore(w);w.h();if(k){if(B){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(I){this.H(I,D.C);I.h()}}else{this.setEndBefore(h);h.h();c.select()}}:function(){var l=
this.startContainer;this.collapsed&&l[0].nodeType==i.e&&!l[0].childNodes.length&&l[0].appendChild(this.document.createTextNode(""));var k=this.document.createRange();k.setStart(l[0],this.startOffset);try{k.setEnd(this.endContainer[0],this.endOffset)}catch(B){if(B.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(z);k.setEnd(this.endContainer[0],this.endOffset)}else throw B;}l=u(this.document).r();l.removeAllRanges();l.addRange(k)};A.getSelection=u;q.Ac=A;q.Selection=A;a=A.prototype;q.l.o(a,
{getNative:a.r,getType:a.fb,getRanges:a.A,getStartElement:a.$b,getSelectedElement:a.Zb,reset:a.reset,selectElement:a.nc,selectRanges:a.qb,createBookmarks2:a.me,createBookmarks:a.le,getCommonAncestor:a.ua,scrollIntoView:a.scrollIntoView,selectBookmarks:a.wd,removeAllRanges:a.removeAllRanges});q.on("instanceCreated",function(l){J(l.qe)})});
KISSY.Editor.add("styles",function(q){function A(E,K){for(var G in E)E[G]=E[G].replace(V,function(F,H){return K[H]})}function u(E,K){if(K){E=B.clone(E);A(E.attributes,K);A(E.styles,K)}var G=this.element=this.element=(E.element||"*").toLowerCase();this.type=this.type=G=="#"||Q[G]?c.Ab:W[G]?c.Wa:c.za;this.c={definition:E}}function J(E,K){var G=K?this.mc:this.Lb;E.body.focus();for(var F=new r(E),H=F.A(),N=0;N<H.length;N++)G.call(this,H[N]);F.qb(H)}function z(E,K){var G;G=E.element;if(G=="*")G="span";
G=new P(K.createElement(G));return x(G,E)}function x(E,K){var G=K.c.definition,F=G.attributes;G=u.ad(G);if(F)for(var H in F)E.attr(H,F[H]);if(G)E[0].style.cssText=G;return E}function t(E){var K=E.O(m),G=E.ne();G.Tb=m;G.Vc=m;for(var F,H=E.document;F=G.ve();){var N=z(this,H);F=F;var L=N;N=L.d=="pre";var R=F.d=="pre",ba=!N&&R;if(N&&!R){R=F;L=L;ba=R.html();ba=s(ba,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");ba=ba.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");ba=ba.replace(/([ \t\n\r]+|&nbsp;)/g," ");ba=
ba.replace(/<br\b[^>]*>/gi,"\n");if(M.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+ba+"</pre>";L=new P(R.firstChild);L.h()}else L.html(ba);L=L}else if(ba)L=f(p(F),L);else F.Hb(L);F[0].parentNode.replaceChild(L[0],F[0]);if(N){F=L;N=void 0;if((N=F.fa(m,v.e))&&N.d()=="pre"){L=s(N.html(),/\n$/,"")+"\n\n"+s(F.html(),/^\n/,"");if(M.ie)F[0].outerHTML="<pre>"+L+"</pre>";else F.html(L);N.h()}}}E.moveToBookmark(K)}function s(E,K,G){var F="",H="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(N,L,R){L&&(F=L);R&&(H=R);return""});return F+E.replace(K,G)+H}function p(E){var K=[];s(E.Za(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,F,H){return F+"</pre>"+H+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,F){K.push(F)});return K}function f(E,K){for(var G=K[0].ownerDocument.createDocumentFragment(),F=0;F<E.length;F++){var H=E[F];H=H.replace(/(\r\n|\r)/g,"\n");H=s(H,/^[ \t]*\n/,"");H=s(H,/\n$/,"");H=s(H,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==
1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});H=H.replace(/\n/g,"<br>");H=H.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var N=K.K();N.html(H);G.appendChild(N[0])}return G}function g(E){var K=E.document;if(E.collapsed){K=z(this,K);E.insertNode(K);E.H(K,h.J)}else{var G=this.element,F=this.c.definition,H,N=q.m[G]||(H=m,q.m.span),L=E.O();E.Ia(h.xb);E.trim();var R=E.O(),ba=R.Y;R=R.P;for(var $=ba,ca;$&&$[0];){var Z=l;if(w.g($,R)){$=
k;Z=m}else{var aa=$[0].nodeType,fa=aa==v.e?$.d():k;if(fa&&$.attr("_ke_bookmark")){$=$.w(m);continue}if(!fa||N[fa]&&($.Da(R)|n.X|n.ca|n.W)==n.X+n.ca+n.W&&(!F.childRule||F.childRule($))){var ga=$.parent();if(ga&&ga[0]&&((q.m[ga.d()]||q.m.span)[G]||H)&&(!F.parentRule||F.parentRule(ga))){if(!ca&&(!fa||!q.m.aa[fa]||($.Da(R)|n.X|n.ca|n.W)==n.X+n.ca+n.W)){ca=new C(K);ca.setStartBefore($)}if(aa==v.f||aa==v.e&&!$[0].childNodes.length){aa=$;var da;for(fa=aa.Ca(function(ia){return!ia.attr("_ke_bookmark")});!fa&&
(da=aa.parent(),N[da.d()])&&(da.Da(ba)|n.ba|n.ca|n.W)==n.ba+n.ca+n.W&&(!F.childRule||F.childRule(da));)aa=da;ca.setEndAfter(aa);aa[0].nextSibling||(Z=m)}}else Z=m}else Z=m;$=$.w()}if(Z&&ca&&!ca.collapsed){Z=z(this,K);for(aa=ca.ua();Z&&aa&&Z[0]&&aa[0];){if(aa.d()==G){for(var ea in F.attributes)Z.attr(ea)==aa.attr(ea)&&Z[0].removeAttribute(ea);for(var ha in F.styles)Z.L(ha)==aa.L(ha)&&Z.L(ha,"");if(!Z.Ya()){Z=k;break}}aa=aa.parent()}if(Z){Z[0].appendChild(ca.extractContents());d(this,Z);ca.insertNode(Z);
Z.qa();M.ie||Z[0].normalize()}ca=k}}ba.h();R.h();E.moveToBookmark(L);E.Na(h.yc)}}function e(E){E.Ia(h.xb);var K=E.O(),G=K.Y;if(E.collapsed){for(var F=new O(G.parent()),H,N=0,L;N<F.elements.length&&(L=F.elements[N]);N++){if(L==F.z||L==F.F)break;if(this.ia(L)){var R=E.Qb(L,h.Gd),ba=!R&&E.Qb(L,h.Va);if(ba||R){H=L;H.match=ba?"start":"end"}else{L.qa();L.d()==this.element?a(this,L):j(L,i(this)[L.d()])}}}if(H&&H[0]){L=G;for(N=0;;N++){R=F.elements[N];if(w.g(R,H))break;else if(R.match)continue;else R=R.K();
R[0].appendChild(L[0]);L=R}w[H.match=="start"?"insertBefore":"insertAfter"](L,H)}}else{var $=K.P,ca=this;F=function(){for(var Z=new O(G.parent()),aa=new O($.parent()),fa=k,ga=k,da=0;da<Z.elements.length;da++){var ea=Z.elements[da];if(ea==Z.z||ea==Z.F)break;if(ca.ia(ea))fa=ea}for(da=0;da<aa.elements.length;da++){ea=aa.elements[da];if(ea==aa.z||ea==aa.F)break;if(ca.ia(ea))ga=ea}ga&&$.Db(ga);fa&&G.Db(fa)};F();for(H=new P(G[0].nextSibling);H[0]!==$[0];){N=H.w();if(H[0]&&H[0].nodeType==v.e&&this.ia(H)){H.d()==
this.element?a(this,H):j(H,i(this)[H.d()]);if(N[0].nodeType==v.e&&N.contains(G)){F();N=new P(G[0].nextSibling)}}H=N}}E.moveToBookmark(K)}function o(E){var K={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,F,H){K[F]=H});return K}function D(E,K){var G;if(K!==l){G=document.createElement("span");G.style.cssText=E;G=G.style.cssText||""}else G=E;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(E){if(E.c.vd)return E.c.vd;
var K=E.c.vd={},G=E.c.definition.overrides;if(G){B.isArray(G)||(G=[G]);for(var F=0;F<G.length;F++){var H=G[F],N,L;if(typeof H=="string")N=H.toLowerCase();else{N=H.element?H.element.toLowerCase():E.element;L=H.attributes}H=K[N]||(K[N]={});if(L){H=H.attributes=H.attributes||[];for(var R in L)H.push([R.toLowerCase(),L[R]])}}}return K}function a(E,K){var G=E.c.definition,F=I.mix(G.attributes,i(E)[K.d()]);G=G.styles;var H=B.isEmptyObject(F)&&B.isEmptyObject(G),N;for(N in F)if(!((N=="class"||E.c.definition.fullMatch)&&
K.attr(N)!=b(N,F[N]))){H=H||!!K.Cc(N);K.removeAttr(N)}for(var L in G)if(!(E.c.definition.fullMatch&&K.L(L)!=b(L,G[L],m))){H=H||!!K.L(L);K.L(L,"")}y(K)}function b(E,K,G){var F=new P("<span>");F[G?"_4e_style":"attr"](E,K);return F[G?"_4e_style":"attr"](E)}function d(E,K){for(var G=i(E),F=K.all(E.element),H=F.length;--H>=0;)a(E,new P(F[H]));for(var N in G)if(N!=E.element){F=K.all(N);for(H=F.length-1;H>=0;H--){var L=new P(F[H]);j(L,G[N])}}}function j(E,K){var G=K&&K.attributes;if(G)for(var F=0;F<G.length;F++){var H=
G[F][0],N;if(N=E.attr(H)){var L=G[F][1];if(L===k||L.test&&L.test(N)||typeof L=="string"&&N==L)E[0].removeAttribute(H)}}y(E)}function y(E){if(!E.Ya()){var K=E[0].firstChild,G=E[0].lastChild;E.h(m);if(K){K.nodeType==v.e&&w.qa(K);G&&K!=G&&G.nodeType==v.e&&w.qa(G)}}}var m=S,l=X,k=T,B=KISSY,I=q.l,w=B.DOM,c={Ab:1,za:2,Wa:3},h=q.na,r=q.Ac,v=q.n,n=q.Ta,C=q.Range,P=B.Node,M=B.UA,O=q.Sa,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},W={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,
ul:1,dl:1,dt:1,dd:1,form:1},U=/\s*(?:;\s*|$)/g,V=/#\((.+?)\)/g;q.of=c;u.prototype={apply:function(E){J.call(this,E,l)},remove:function(E){J.call(this,E,m)},Lb:function(E){return(this.Lb=this.type==c.za?g:this.type==c.Ab?t:this.type==c.Wa?k:k).call(this,E)},mc:function(E){return(this.mc=this.type==c.za?e:k).call(this,E)},ae:function(E){x(E,this)},ia:function(E,K){if(!E)return l;var G=this.c.definition;if(E.d()==this.element){if(!K&&!E.Ya())return m;var F=G.Sd;if(F)G=F;else{F={};var H=0,N=G.attributes;
if(N)for(var L in N){H++;F[L]=N[L]}if(N=u.ad(G)){F.style||H++;F.style=N}F._length=H;G=G.Sd=F}if(G._length){for(var R in G)if(R!="_length"){H=E.attr(R)||"";if(R=="style")a:{F=G[R];H=D(H,l);typeof F=="string"&&(F=o(F));typeof H=="string"&&(H=o(H));N=void 0;for(N in F)if(!(N in H&&(H[N]==F[N]||F[N]=="inherit"||H[N]=="inherit"))){F=l;break a}F=m}else F=G[R]==H;if(F){if(!K)return m}else if(K)return l}if(K)return m}else return m}if(R=i(this)[E.d()]){if(!(G=R.attributes))return m;for(F=0;F<G.length;F++){R=
G[F][0];if(R=E.attr(R)){H=G[F][1];if(H===k||typeof H=="string"&&R==H||H.test&&H.test(R))return m}}}return l},he:function(E){switch(this.type){case c.Ab:return this.ia(E.z||E.F,m);case c.Wa:case c.za:for(var K=E.elements,G=0,F;G<K.length;G++){F=K[G];if(!(this.type==c.za&&(w.g(F,E.z)||w.g(F,E.F))))if(!(this.type==c.Wa&&!(F.d()in W)))if(this.ia(F,m))return m}}return l}};u.ad=function(E){var K=E.Td;if(K)return K;K=E.styles;var G=E.attributes&&E.attributes.style||"",F="";if(G.length)G=G.replace(U,";");
for(var H in K){var N=K[H],L=(H+":"+N).replace(U,";");if(N=="inherit")F+=L;else G+=L}if(G.length)G=D(G);G+=F;return E.Td=G};q.pf=u;q.Style=u;var Y=u.prototype;q.l.o(Y,{apply:Y.apply,remove:Y.remove,applyToRange:Y.Lb,removeFromRange:Y.mc,applyToObject:Y.ae,checkElementRemovable:Y.ia,checkActive:Y.he})});
KISSY.Editor.add("htmlparser",function(){function q(){}function A(){this.c={ed:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var u=KISSY,J=u.Editor,z=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,x={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},t=J.m;u.augment(A,{va:q,ud:q,la:q,pd:q,La:q,parse:function(s){for(var p,
f,g=0,e;p=this.c.ed.exec(s);){f=p.index;if(f>g){g=s.substring(g,f);e?e.push(g):this.la(g)}g=this.c.ed.lastIndex;if(f=p[1]){f=f.toLowerCase();if(e&&t.rc[f]){this.pd(e.join(""));e=T}if(!e){this.ud(f);continue}}if(e)e.push(p[0]);else if(f=p[3]){f=f.toLowerCase();if(!/="/.test(f)){var o={},D;p=p[4];var i=!!(p&&p.charAt(p.length-1)=="/");if(p)for(;D=z.exec(p);){var a=D[1].toLowerCase();D=D[2]||D[3]||D[4]||"";o[a]=!D&&x[a]?a:D}this.va(f,o,i);if(!e&&t.rc[f])e=[]}}else if(f=p[2])this.La(f)}s.length>g&&this.la(s.substring(g,
s.length))}});J.j=A;J.HtmlParser=A});
KISSY.Editor.add("htmlparser-basicwriter",function(){function q(){this.c={k:[]}}var A=KISSY,u=A.Editor,J=u.l;A.augment(q,{lb:function(z){this.c.k.push("<",z)},mb:function(z,x){x?this.c.k.push(" />"):this.c.k.push(">")},bb:function(z,x){if(typeof x=="string")x=J.cc(x);this.c.k.push(" ",z,'="',x,'"')},cb:function(z){this.c.k.push("</",z,">")},text:function(z){this.c.k.push(z)},N:function(z){this.c.k.push("<!--",z,"--\>")},write:function(z){this.c.k.push(z)},reset:function(){this.c.k=[];this.c.B=X},
Xb:function(z){var x=this.c.k.join("");z&&this.reset();return x}});u.j.vb=q;u.j.BasicWriter=q;A=q.prototype;u.l.o(A,{openTag:A.lb,openTagClose:A.mb,attribute:A.bb,closeTag:A.cb,text:A.text,comment:A.N,write:A.write,reset:A.reset,getHtml:A.Xb})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function q(){q.Lf.constructor.call(this);this.fd="\t";this.Pe=" />";this.He="\n";this.te=x;this.Qe=z;this.c.B=x;this.c.G="";this.c.rules={};var t=u.m,s;for(s in J.mix({},t.ub,t.Qa,t.tb,t.vc))this.xa(s,{B:z,ee:z,Pb:z,Oc:!t[s]["#"],de:z});this.xa("br",{Pb:z});this.xa("title",{B:x,Pb:x});this.xa("style",{B:x,Oc:z});this.xa("pre",{B:x})}var A=KISSY,u=A.Editor,J=u.l,z=S,x=X;A.extend(q,u.j.vb,{lb:function(t){var s=this.c.rules[t];if(this.c.B)this.G();
else if(s&&s.ee){this.Ja();this.G()}this.c.k.push("<",t)},mb:function(t,s){var p=this.c.rules[t];if(s)this.c.k.push(this.Pe);else{this.c.k.push(">");if(p&&p.B)this.c.G+=this.fd}p&&p.Pb&&this.Ja()},bb:function(t,s){if(typeof s=="string"){this.te&&(s=s.replace(/&amp;/g,"&"));s=J.cc(s)}this.c.k.push(" ",t,'="',s,'"')},cb:function(t){var s=this.c.rules[t];if(s&&s.B)this.c.G=this.c.G.substr(this.fd.length);if(this.c.B)this.G();else if(s&&s.Oc){this.Ja();this.G()}this.c.k.push("</",t,">");s&&s.de&&this.Ja()},
text:function(t){if(this.c.B){this.G();t=J.Ka(t)}this.c.k.push(t)},N:function(t){this.c.B&&this.G();this.c.k.push("<!--",t,"--\>")},Ja:function(){this.c.k.length>0&&this.c.k.push(this.He);this.c.B=z},G:function(){this.c.k.push(this.c.G);this.c.B=x},xa:function(t,s){var p=this.c.rules[t];if(p)J.mix(p,s);else this.c.rules[t]=s}});u.j.df=q;u.j.HtmlWriter=q;A=q.prototype;u.l.o(A,{openTag:A.lb,openTagClose:A.mb,attribute:A.bb,closeTag:A.cb,text:A.text,comment:A.N,lineBreak:A.Ja,indentation:A.G,setRules:A.xa})});
KISSY.Editor.add("htmlparser-fragment",function(){function q(){this.children=[];this.parent=J;this.c={R:A,bc:u}}var A=S,u=X,J=T,z=KISSY.Editor,x={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},t=KISSY,s=z.l,p=z.n,f=z.m,g=s.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),e=f.Ed,o=f.tb;q.yb=function(D,i){function a(h){var r;if(m.length>0)for(var v=0;v<m.length;v++){var n=m[v],C=n.name,P=f[C],M=k.name&&f[k.name];if((!M||M[C])&&(!h||!P||P[h]||!f[h])){if(!r){b();r=1}n=n.clone();
n.parent=k;k=n;m.splice(v,1);v--}}}function b(){for(;l.length;)k.add(l.shift())}function d(h,r,v){r=r||k||y;if(i&&!r.type){var n,C;if((n=h.attributes&&(C=h.attributes._ke_real_element_type)?C:h.name)&&!(n in f.qc)&&!(n in f.ub)){n=k;k=r;j.va(i,{});r=k;if(v)k=n}}if(h.c.R&&h.name!="pre"){v=h.children.length;if((n=h.children[v-1])&&n.type==p.f)if(C=s.Ma(n.value))n.value=C;else h.children.length=v-1}r.add(h);if(h.ob){k=h.ob;delete h.ob}}var j=new z.j,y=new q,m=[],l=[],k=y,B=u,I;j.va=function(h,r,v){var n=
new z.j.wc(h,r);if(n.fc&&v)n.ib=A;if(f.aa[h])m.push(n);else{if(h=="pre")B=A;else if(h=="br"&&B){k.add(new z.j.Bb("\n"));return}if(h=="br")l.push(n);else{var C=k.name,P=C&&(f[C]||(k.c.R?f.div:f.span));if(P&&!n.fc&&!k.fc&&!P[h]){P=u;var M;if(h in e&&C in e){C=k.children;(C=C[C.length-1])&&C.name in o||d(C=new z.j.wc("li"),k);I=k;M=C}else if(h==C)d(k,k.parent);else{if(g[C])I||(I=k);else{d(k,k.parent,A);x[C]||m.unshift(k)}P=A}k=M?M:k.ob||k.parent;if(P){j.va.apply(this,arguments);return}}a(h);b();n.parent=
k;n.ob=I;I=0;if(n.ib)d(n);else k=n}}};j.ud=function(h){for(var r=m.length-1;r>=0;r--)if(h==m[r].name){m.splice(r,1);return}for(var v=[],n=[],C=k;C.type&&C.name!=h;){C.c.R||n.unshift(C);v.push(C);C=C.parent}if(C.type){for(r=0;r<v.length;r++){var P=v[r];d(P,P.parent)}k=C;if(k.name=="pre")B=u;C.c.R&&b();d(C,C.parent);if(C==k)k=k.parent;m=m.concat(n)}if(h=="body")i=u};j.la=function(h){if(!k.c.bc&&!B){h=s.Ka(h);if(h.length===0)return}b();a();if(i&&(!k.type||k.name=="body")&&s.trim(h))this.va(i,{});B||
(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));k.add(new z.j.Bb(h))};j.pd=function(){};j.La=function(h){k.add(new z.j.Fd(h))};j.parse(D);for(b();k.type;){var w=k.parent,c=k;if(i&&(!w.type||w.name=="body")&&!f.qc[c.name]){k=w;j.va(i,{});w=k}w.add(c);k=w}return y};t.augment(q,{add:function(D){var i=this.children.length;if(i=i>0&&this.children[i-1]||J){if(D.c.R&&i.type==p.f){i.value=s.Ma(i.value);if(i.value.length===0){this.children.pop();this.add(D);return}}i.next=D}D.nb=i;D.parent=this;this.children.push(D);
this.c.bc=D.type==p.f||D.type==p.e&&!D.c.R},$:function(D,i){var a;this.filterChildren=this.Vb=function(){var b=new z.j.vb;this.U.call(this,b,i,A);b=b.Xb();this.children=(new q.yb(b)).children;a=1};!this.name&&i&&i.rd(this);this.U(D,a?J:i)},U:function(D,i){for(var a=0;a<this.children.length;a++)this.children[a].$(D,i)}});z.j.ya=q;z.j.Fragment=q;q.FromHtml=q.yb;t=q.prototype;z.l.o(t,{add:t.add,writeHtml:t.$,writeChildrenHtml:t.U})});
KISSY.Editor.add("htmlparser-element",function(){function q(x,t){x=x[0];t=t[0];return x<t?-1:x>t?1:0}function A(x,t){this.name=x;this.attributes=t||(t={});this.children=[];var s=t.sf||x,p=u.m;s=!!(p.ub[s]||p.Qa[s]||p.tb[s]||p.vc[s]||p.uc[s]||s=="br");var f=!!p.sb[x];this.ib=f;this.fc=!p[x];this.c={R:s,bc:f||!s}}var u=KISSY.Editor,J=u.n;KISSY.augment(A,{type:J.e,add:u.j.ya.prototype.add,clone:function(){return new A(this.name,this.attributes)},$:function(x,t){var s=this.attributes,p=this,f=p.name,
g,e,o,D;p.Vb=function(){if(!D){var b=new u.j.vb;u.j.ya.prototype.U.call(p,b,t);p.children=(new u.j.ya.yb(b.Xb())).children;D=1}};p.filterChildren=p.Vb;if(t){for(;;){if(!(f=t.qd(f)))return;p.name=f;if(!(p=t.hc(p)))return;p.parent=this.parent;if(p.name==f)break;if(p.type!=J.e){p.$(x,t);return}f=p.name;if(!f){this.U.call(p,x,D?T:t);return}}s=p.attributes}x.lb(f,s);for(var i=[],a=0;a<2;a++)for(g in s){e=g;o=s[g];if(a==1)i.push([g,o]);else if(t){for(;;)if(e=t.od(g))if(e!=g){delete s[g];g=e}else break;
else{delete s[g];break}if(e)if((o=t.nd(p,e,o))===X)delete s[e];else s[e]=o}}x.Qe&&i.sort(q);s=i.length;for(a=0;a<s;a++){g=i[a];x.bb(g[0],g[1])}x.mb(f,p.ib);if(!p.ib){this.U.call(p,x,D?T:t);x.cb(f)}},U:function(){u.j.ya.prototype.U.apply(this,arguments)}});u.j.wc=A;u.j.Element=A;var z=A.prototype;u.l.o(z,{type:z.type,add:z.add,clone:z.clone,writeHtml:z.$,writeChildrenHtml:z.U})});
KISSY.Editor.add("htmlparser-filter",function(){function q(g){this.c={Sb:[],Mb:[],elements:{tc:0},attributes:{tc:0}};g&&this.Nc(g,10)}function A(g,e){for(var o=0;g&&o<e.length;o++){var D=e[o];g=g.replace(D[0],D[1])}return g}function u(g,e,o){if(typeof e=="function")e=[e];var D,i;i=g.length;var a=e&&e.length;if(a){for(D=0;D<i&&g[D].lc<o;D++);for(i=a-1;i>=0;i--)if(a=e[i]){a.lc=o;g.splice(D,0,a)}}}function J(g,e,o){if(e)for(var D in e){var i=g[D];g[D]=z(i,e[D],o);i||g.tc++}}function z(g,e,o){if(e){e.lc=
o;if(g){if(g.splice)u(g,e,o);else{g=g.lc>o?[e,g]:[g,e];g.filter=x}return g}else return e.filter=e}}function x(g){for(var e=g.type||g instanceof s.j.ya,o=0;o<this.length;o++){if(e)var D=g.type,i=g.name;var a=this[o].apply(window,arguments);if(a===f)return a;if(e){if(a&&(a.name!=i||a.type!=D))return a}else if(typeof a!="string")return a;a!=undefined&&(g=a)}return g}var t=KISSY,s=t.Editor,p=s.n,f=X;t.augment(q,{Nc:function(g,e){if(typeof e!="number")e=10;u(this.c.Sb,g.Sb,e);u(this.c.Mb,g.Mb,e);J(this.c.elements,
g.elements,e);J(this.c.attributes,g.attributes,e);this.c.text=z(this.c.text,g.text,e)||this.c.text;this.c.N=z(this.c.N,g.N,e)||this.c.N;this.c.pb=z(this.c.pb,g.pb,e)||this.c.pb},qd:function(g){return A(g,this.c.Sb)},od:function(g){return A(g,this.c.Mb)},la:function(g){var e=this.c.text;return e?e.filter(g):g},La:function(g,e){var o=this.c.N;return o?o.filter(g,e):g},rd:function(g){var e=this.c.pb;return e?e.filter(g):g},hc:function(g){for(var e=[this.c.elements["^"],this.c.elements[g.name],this.c.elements.Ye],
o,D=0;D<3;D++)if(o=e[D]){o=o.filter(g,this);if(o===f)return T;if(o&&o!=g)return this.sd(o);if(g.parent&&!g.name)break}return g},sd:function(g){var e=g.type;return e==p.e?this.hc(g):e==p.f?new s.j.Bb(this.la(g.value)):T},nd:function(g,e,o){if(e=this.c.attributes[e]){g=e.filter(o,g,this);if(g===f)return f;if(typeof g!="undefined")return g}return o}});s.j.cf=q;t=q.prototype;s.l.o(t,{addRules:t.Nc,onElementName:t.qd,onAttributeName:t.od,onText:t.la,onComment:t.La,onFragment:t.rd,onElement:t.hc,onNode:t.sd,
onAttribute:t.nd});s.j.Filter=q});KISSY.Editor.add("htmlparser-text",function(){function q(z){this.value=z;this.c={R:J}}var A=KISSY,u=A.Editor,J=X;A.augment(q,{type:u.n.f,$:function(z,x){var t=this.value;x&&!(t=x.la(t,this))||z.text(t)}});u.j.Bb=q;u.j.Text=q});
KISSY.Editor.add("htmlparser-comment",function(){function q(J){this.value=J;this.c={R:X}}var A=KISSY.Editor,u=A.n;A.j.Fd=q;A.j.Comment=q;q.prototype={constructor:q,type:u.Hd,$:function(J,z){var x=this.value;if(z){if(!(x=z.La(x,this)))return;if(typeof x!="string"){x.parent=this.parent;x.$(J,z);return}}J.N(x)}}});
