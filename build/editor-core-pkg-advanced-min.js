/*
 Constructor for kissy editor,dependency moved to independent module
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1.5
 @buildtime: 2011-01-12 23:00:39
*/
var T=true,V=null,Y=false;
KISSY.add("editor",function(k){function w(t,q){var n=this;if(!(n instanceof w))return new w(t,q);if(k.isString(t))t=k.one(t);t=I.C(t);q=q||{};q.Bf=q.pluginConfig||{};n.va=q;q.pluginConfig=q.Bf;n.cfg=q;k.app(n,k.EventTarget);var e=["htmldataprocessor","enterkey","clipboard"],f=A;n.use=function(d,i){d=d.split(",");if(!f)for(var u=0;u<e.length;u++){var j=e[u];k.inArray(j,d)||d.unshift(j)}n.ready(function(){k.use.call(n,d.join(","),function(){for(var a=0;a<d.length;a++)n.Zd(d[a]);i&&i.call(n);if(!f){n.setData(t.val());
if(q.focus)n.focus();else(a=n.getSelection())&&a.removeAllRanges();f=C}},{global:w})});return n};n.use=n.use;n.Config.base=w.Config.base;n.Config.debug=w.Config.debug;n.Config.componentJsName=p;n.rf(t);return n}function p(){return"plugin-min.js?t=2011-01-12 23:00:39"}var I=k.DOM,C=T,A=Y;k.app(w,k.EventTarget);w.Config.base=k.Config.base+"editor/plugins/";w.Config.debug=k.Config.debug;w.Config.componentJsName=p;k.Editor=w;k.Editor=w});
KISSY.Editor.add("utils",function(k){var w=V,p=KISSY,I=p.Node,C=p.DOM,A=p.UA,t=p.Event,q;if(A.ie)q=document.documentMode||A.ie;var n={od:function(e){e=e.replace(/-min\.(js|css)/i,".$1");k.Config.Lg||(e=e.replace(/\.(js|css)/i,"-min.$1"));if(e.indexOf("?t")==-1){e+=e.indexOf("?")!=-1?"&":"?";e+="t=2011-01-12 19:32:53"}return k.Config.Eg+e},Id:function(e,f,d){var i=e[f],u=e[d];e[f]=function(){i.apply(this,arguments);e[f]=e[d];return u.apply(this,arguments)}},nf:function(e,f,d,i){d=d.defaultView||d.parentWindow;
e-=C.scrollLeft(d);f-=C.scrollTop(d);if(i)if(d!=(i.defaultView||i.parentWindow)&&d.frameElement){i=C.Qb(d.frameElement,i);e+=i.left;f+=i.top}return{left:e,top:f}},Yd:function(){for(var e,f=0,d=arguments.length;f<d;f++){var i=arguments[f];try{e=i();break}catch(u){}}return e},Ne:function(e,f){if(!e&&!f)return T;if(!e||!f||e.length!=f.length)return Y;for(var d=0;d<e.length;d++)if(e[d]!==f[d])return Y;return T},wd:function(e,f,d){e=e.documentElement;for(var i=0;e&&i<f.length;i++){var u=f[i];if(d)for(var j=
-1,a=0;a<e.childNodes.length;a++){var b=e.childNodes[a];if(!(d===T&&b.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3)){j++;if(j==u){e=b;break}}}else e=e.childNodes[u]}return e?new I(e):w},Ve:function(e){for(var f in e)e[f].Pc(e,T)},pc:function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},Qa:function(e){return e.replace(/^\s+/,"")},Sa:function(e){return e.replace(/\s+$/,"")},trim:function(e){return this.Qa(this.Sa(e))},mix:function(){for(var e={},f=0;f<
arguments.length;f++)e=p.mix(e,arguments[f]);return e},qb:function(){if(!A.ie)return Y;var e=document.domain,f=window.location.hostname;return e!=f&&e!="["+f+"]"},bf:function(e,f){return Array(f+1).join(e)},Mf:function(e,f,d){d=d||150;if(d===-1)return function(){e.apply(f,arguments)};var i=(new Date).getTime();return function(){var u=(new Date).getTime();if(u-i>d){i=u;e.apply(f,arguments)}}},Re:function(e,f,d){d=d||0;var i=w;return function(){i&&clearTimeout(i);var u=arguments;i=setTimeout(function(){return e.apply(f,
u)},d)}},isNumber:function(e){return/^\d+(.\d+)?$/.test(p.trim(e))},Of:function(e){for(var f=0;f<e.length;f++){var d=C.C(e[f]),i=p.trim(d.val()),u=d.attr("data-verify");d=d.attr("data-warning");if(u&&!RegExp(u).test(i)){alert(d);return Y}}return T},If:function(e,f){e.on("sourcemode",f.pd,f);e.on("wysiwygmode",f.rd,f)},Ef:function(e){var f=e.attr("placeholder");if(f&&!A.webkit){e.addClass("ke-input-tip");e.val(f)}else A.webkit&&e.val("")},lh:function(e,f){e.removeClass("ke-input-tip");e.val(f)},Af:function(e,
f){e.attr("placeholder",f);if(!A.webkit){e.on("blur",function(){if(!p.trim(e.val())){e.addClass("ke-input-tip");e.val(f)}});e.on("focus",function(){e.removeClass("ke-input-tip");p.trim(e.val())==f&&e.val("")})}},Ue:function(e){e=e[0]||e;for(var f=p.makeArray(e.childNodes),d=0;d<f.length;d++){var i=f[d];i.nodeType==k.n.f&&!p.trim(i.nodeValue)&&e.removeChild(i)}},qf:function(e){return!e?e:String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},pf:function(e){return!e?
e:String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},ff:function(e,f){return e.toLowerCase()==f.toLowerCase()},Jd:function(e){e=p.clone(e);for(var f in e)if(e.hasOwnProperty(f)){var d=e[f];if(p.isFunction(d))e[f]=d()}return e},af:function(e,f,d){function i(){var B={responseText:"",responseXML:w};B.Me=e?e.Me:w;try{var y;if((y=A.ie?j.contentWindow.document:j.contentDocument||window.frames[u].document)&&y.body)B.responseText=y.body.innerHTML;B.responseXML=
y&&y.XMLDocument?y.XMLDocument:y}catch(r){p.log(r)}t.remove(j,"load",i);e.Se&&e.Se(B);setTimeout(function(){C.j(j)},100)}var u=p.guid("form-upload-"),j=document.createElement("iframe");j.id=u;j.name=u;j.className="ke-hidden";var a="document.open();"+(n.qb()?'document.domain="'+document.domain+'";':"")+"document.close();";if(A.ie)j.src=A.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";p.log("doFormUpload : "+j.src);document.body.appendChild(j);if(A.ie)document.frames[u].name=u;a=C.Wc(e.form);
var b={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=u;a.method="POST";a.enctype=a.encoding="multipart/form-data";if(d)a.action=d;var g;if(f){g=[];f=k.k.Jd(f);for(var o in f)if(f.hasOwnProperty(o)){d=document.createElement("input");d.type="hidden";d.name=o;d.value=f[o];a.appendChild(d);g.push(d)}}t.on(j,"load",i);a.submit();a.target=b.target;a.method=b.method;a.enctype=b.enctype;a.encoding=b.encoding;a.action=b.action;if(g){f=0;for(o=g.length;f<o;f++)C.j(g[f])}return j},
o:function(e,f){for(var d in f)e[d]=f[d]},map:function(e,f){for(var d=0;d<e.length;d++)e[d]=f(e[d]);return e},Ba:q,Cf:function(e){A.ie?e.ta():e.attr("onmousedown","return false;")},Xg:function(e){e=e.attributes;return e.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(e.src||"")},Ke:function(){var e=this.ib=this.ib||[];e.push.apply(e,p.makeArray(arguments))},$e:function(){for(var e=this.ib||[],f=0;f<e.length;f++){var d=e[f];if(p.isFunction(d))d();else{d.detach&&d.detach();d.za&&d.za();
d.nodeType&&d.remove&&d.remove()}}this.ib=[]}};k.k=n;k.Utils=n;A.Ba=n.Ba;n.o(n,{debugUrl:n.od,lazyRun:n.Id,getXY:n.nf,tryThese:n.Yd,arrayCompare:n.Ne,getByAddress:n.wd,clearAllMarkers:n.Ve,htmlEncodeAttr:n.pc,ltrim:n.Qa,rtrim:n.Sa,trim:n.trim,mix:n.mix,isCustomDomain:n.qb,duplicateStr:n.bf,buffer:n.Re,isNumber:n.isNumber,verifyInputs:n.Of,sourceDisable:n.If,resetInput:n.Ef,placeholder:n.Af,clean:n.Ue,htmlEncode:n.qf,htmlDecode:n.pf,equalsIgnoreCase:n.ff,normParams:n.Jd,throttle:n.Mf,doFormUpload:n.af,
map:n.map})});
KISSY.Editor.add("dom",function(k){function w(a){if(a&&!a[0])return new q(a);return a}function p(a){return a[0]||a}function I(a){return a.replace(/-(\w)/g,function(b,g){return g.toUpperCase()})}var C=KISSY,A=C.DOM,t=C.UA,q=C.Node,n=k.k,e={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};k.n={e:1,f:3,ee:8,dg:11};k.NODE=k.n;k.$a={ea:0,ge:1,da:2,aa:4,$:8,Kc:16};k.POSITION=
k.$a;var f=k.n,d=k.$a,i={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},u={hr:1},j={C:w,Wc:p,g:function(a,b){if(!a&&!b)return T;if(!a||!b)return Y;a=p(a);b=p(b);return a===b},qa:function(a,b){a=w(a);var g=C.mix(C.mix({},u),b||{});return i[a.css("display")]||g[a.d()]},ga:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:
Y},t:function(a){a=p(a);for(var b=a.parentNode.childNodes,g=0;g<b.length;g++)if(b[g]===a)return g;return-1},me:function(a,b){a=p(a);var g=a.firstChild;if((g=g&&new q(g))&&b&&!b(g))g=g.Ka(b);return g},Uc:function(a,b,g){a=p(a);A.j(a);b=p(b);g?b.insertBefore(a,b.firstChild):b.appendChild(a)},d:function(a){a=p(a);var b=a.nodeName.toLowerCase();if(t.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},Sc:function(a,b){if(a.d()!=b.d())return Y;var g=a[0].attributes,o=b[0].attributes,B=g.length,
y=o.length;if(B!=y)return Y;for(var r=0;r<B;r++){var x=g[r],z=x.name;if(x.specified&&a.attr(z)!=b.attr(z))return Y}if(n.Ba<8)for(r=0;r<y;r++){x=o[r];z=x.name;if(x.specified&&a.attr(z)!=b.attr(z))return Y}return T},Sb:function(a){a=p(a).childNodes;for(var b=0,g=a.length;b<g;b++){var o=a[b],B=o.nodeType;if(!(B==f.e&&o.getAttribute("_ke_bookmark")))if(B==f.e&&!j.Sb(o)||B==f.f&&C.trim(o.nodeValue))return Y}return T},Tb:function(a,b,g){a=p(a);b=b[0]||b;if(a!=b)if(g)for(;g=a.lastChild;)b.insertBefore(a.removeChild(g),
b.firstChild);else for(;g=a.firstChild;)b.appendChild(a.removeChild(g))},ra:function(){function a(b,g,o){if(g[0]&&g[0].nodeType==f.e){for(var B=[];g.attr("_ke_bookmark")||g.Sb();){B.push(g);g=o?new q(g[0].nextSibling):new q(g[0].previousSibling);if(!g[0]||g[0].nodeType!=f.e)return}if(b.Sc(g)){for(var y=o?b[0].lastChild:b[0].firstChild;B.length;)B.shift().Uc(b,!o);g.Tb(b,!o);g.j();y[0]&&y[0].nodeType==f.e&&y.ra()}}}return function(b){if(b[0])if(e[b.d()]||b.d()=="a"){a(b,new q(b[0].nextSibling),T);
a(b,new q(b[0].previousSibling))}}}(),ta:t.gecko?function(a){a=p(a);a.style.MozUserSelect="none"}:t.webkit?function(a){a=p(a);a.style.ag="none"}:function(a){a=p(a);if(t.ie||t.opera){var b=0;a.setAttribute("unselectable","on");for(var g=a.getElementsByTagName("*");a=g[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},Qb:function(a,b){a=p(a);var g,o=0;g=0;var B=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,
y=a.ownerDocument,r=y.documentElement;b=b||y;if(a.getBoundingClientRect){if(a!==y.body&&r!==a){g=a.getBoundingClientRect();o=g.left+(b===y?A.scrollLeft(B):0);g=g.top+(b===y?A.scrollTop(B):0)}if(b)if(B!=(b.defaultView||b.parentWindow)&&B.frameElement){B=j.Qb(B.frameElement,b);o+=B.left;g+=B.top}}return{left:o,top:g}},oe:function(a){return(a=p(a))&&a.contentWindow.document},ia:function(a,b){a=p(a);var g=a.ownerDocument;if(!(!a||a.nodeType!=f.f)){if(t.ie&&b==a.nodeValue.length){var o=g.createTextNode("");
A.insertAfter(o,a);return new q(o)}o=new q(a.splitText(b));if(g.documentMode){g=g.createTextNode("");A.insertAfter(g,o[0]);A.j(g)}return o}},Ub:function(a,b){a=w(a);var g=[];do g[b?"push":"unshift"](a);while(a=a.parent());return g},K:function(a,b,g){a=p(a);a=a.cloneNode(b);if(!g){var o=function(B){if(B.nodeType==f.e){B.removeAttribute("id");B=B.childNodes;for(var y=0;y<B.length;y++)o(B[y])}};o(a)}return new q(a)},v:function(a,b,g,o){a=p(a);if(o&&!o.call){var B=o[0]||o;o=function(r){r=r[0]||r;return r!==
B}}b=!b&&a.firstChild;var y=new q(a);if(!b){if(a.nodeType==f.e&&o&&o(a,T)===Y)return V;b=a.nextSibling}for(;!b&&(y=y.parent());){if(o&&o(y,T)===Y)return V;b=y[0].nextSibling}if(!b)return V;b=A.C(b);if(o&&o(b)===Y)return V;if(g&&g!=b[0].nodeType)return b.v(Y,g,o);return b},ha:function(a,b,g,o){a=p(a);if(o&&!o.call){var B=o[0]||o;o=function(r){r=r[0]||r;return r!==B}}b=!b&&a.lastChild;var y=new q(a);if(!b){if(a.nodeType==f.e&&o&&o(a,T)===Y)return V;b=a.previousSibling}for(;!b&&(y=y.parent());){if(o&&
o(y,T)===Y)return V;b=y[0].previousSibling}if(!b)return V;b=A.C(b);if(o&&o(b)===Y)return V;if(g&&b[0].nodeType!=g)return b.ha(Y,g,o);return b},Pb:function(a,b){if(a.g(b))return a;if(b[0].nodeType!=f.f&&b.contains(a))return b;var g=a[0].nodeType==f.f?a.parent():a;do if(g[0].nodeType!=f.f&&g.contains(b))return g;while(g=g.parent());return V},Oc:function(a,b,g){a=p(a);if(!g)a=a.parentNode;if(b&&!C.isFunction(b)){var o=b;b=function(B){return B.d()==o}}for(;a&&a.nodeType!=9;){if(!b||b(new q(a))===T)return new q(a);
a=a.parentNode}return V},Rb:n.Ba<9?function(a,b){a=p(a);var g=a.attributes[b];return!!(g&&g.specified)}:function(a,b){a=p(a);return a.hasAttribute(b)},eb:n.Ba<9?function(a){a=p(a);for(var b=a.attributes,g=0;g<b.length;g++){var o=b[g];switch(o.name){case "class":if(a.getAttribute("class"))return T;break;default:if(o.specified)return T}}return Y}:function(a){a=p(a);t.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},La:function(a,b){var g=p(a),o=p(b);if(g.compareDocumentPosition)return g.compareDocumentPosition(o);
if(g==o)return d.ea;if(g.nodeType==f.e&&o.nodeType==f.e){if(g.contains){if(g.contains(o))return d.Kc+d.aa;if(o.contains(g))return d.$+d.da}if("sourceIndex"in g)return g.sourceIndex<0||o.sourceIndex<0?d.ge:g.sourceIndex<o.sourceIndex?d.aa:d.da}g=a.Ja();o=b.Ja();for(var B=Math.min(g.length,o.length),y=0;y<=B-1;y++)if(g[y]!=o[y]){if(y<B)return g[y]<o[y]?d.aa:d.da;break}return g.length<o.length?d.Kc+d.aa:d.$+d.da},Ja:function(a,b){a=p(a);for(var g=[],o=a.ownerDocument.documentElement,B=a;B&&B!=o;){var y=
B.parentNode,r=-1;if(y){for(var x=0;x<y.childNodes.length;x++){var z=y.childNodes[x];if(!(b&&z.nodeType==3&&z.previousSibling&&z.previousSibling.nodeType==3)){r++;if(z==B)break}}g.unshift(r)}B=y}return g},Ob:function(a,b){var g=new k.Range(a[0].ownerDocument);g.setStartAfter(a);g.setEndAfter(b);var o=g.extractContents();g.insertNode(a.j());a[0].parentNode.insertBefore(o,a[0].nextSibling)},L:function(a,b,g){a=w(a);if(g!==undefined)return a.css(b,g);a=p(a);return a.style[I(b)]},j:function(a,b){var g=
p(a),o=g.parentNode;if(o){if(b)for(var B;B=g.firstChild;)o.insertBefore(g.removeChild(B),g);o.removeChild(g)}return a},gb:function(a){A.Tc(a);A.Vc(a)},Tc:function(a){a=p(a);for(var b;b=a.firstChild;){if(b.nodeType==f.f){var g=n.Qa(b.nodeValue),o=b.nodeValue.length;if(g){if(g.length<o){(new q(b)).ia(o-g.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},Vc:function(a){a=p(a);for(var b;b=a.lastChild;){if(b.type==f.f){var g=n.Sa(b.nodeValue),o=b.nodeValue.length;if(g){if(g.length<
o){(new q(b)).ia(g.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!t.ie&&!t.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},Nb:function(a){a=p(a);for(var b=a.lastChild;b&&b.nodeType==f.f&&!C.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==f.f||A.d(b)!=="br"){b=t.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");t.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},sa:function(a,
b){var g=p(a),o;do o=(g=g.previousSibling)&&new q(g);while(o&&b&&!b(o));return o},qe:function(a,b){a=A.C(a);var g=a[0].lastChild;if((g=g&&new q(g))&&b&&!b(g))g=g.sa(b);return g},Ka:function(a,b){var g=p(a),o;do o=(g=g.nextSibling)&&new q(g);while(o&&b&&!b(o));return o},fb:function(a){a=p(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(T));return b.innerHTML},re:function(a,b,g,o){a=A.C(a);var B=a.data("list_marker_id")||
a.data("list_marker_id",C.guid()).data("list_marker_id"),y=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[B]=a;y[g]=1;return a.data(g,o)},Pc:function(a,b,g){a=w(a);var o=a.data("list_marker_names"),B=a.data("list_marker_id"),y;for(y in o)a.removeData(y);a.removeData("list_marker_names");if(g){a.removeData("list_marker_id");delete b[B]}},Qc:function(a,b,g){a=p(a);b=w(b);var o=a.attributes;g=g||{};for(var B=0;B<o.length;B++){var y=o[B],r=y.name.toLowerCase(),
x;if(!(r in g))if(r=="checked"&&(x=A.attr(a,r)))b.attr(r,x);else if(y.specified||t.ie&&y.value&&r=="value"){x=A.attr(a,r);if(x===V)x=y.nodeValue;b.attr(r,x)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},Rc:function(a){a=A.d(a);var b=k.m;return(a=!b.Hc[a]&&(b[a]||b.span))&&a["#"]},Vb:function(a){a=w(a);var b=a[0].ownerDocument,g=A.scrollLeft(b),o=A.scrollTop(b),B=a.offset(),y=B.left;B=B.top;if(A.viewportHeight(b)+o<B||B<o||A.viewportWidth(b)+g<y||y<g)a.scrollIntoView(b)},ne:function(a,
b,g){a=p(a);if(!t.ie&&g)b=g+":"+b;g=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)g.push(new q(a[b]));return g}};C.DOM.pe=function(a){C.mix(A,a);for(var b in a)a.hasOwnProperty(b)&&function(g){q.prototype[g]=function(){var o=[].slice.call(arguments,0);o.unshift(this);return a[g].apply(V,o)}}(b)};n.o(j,{_4e_wrap:j.C,_4e_unwrap:j.Wc,_4e_equals:j.g,_4e_isBlockBoundary:j.qa,_4e_getWin:j.ga,_4e_index:j.t,_4e_first:j.me,_4e_move:j.Uc,_4e_name:j.d,_4e_isIdentical:j.Sc,_4e_isEmptyInlineRemoveable:j.Sb,
_4e_moveChildren:j.Tb,_4e_mergeSiblings:j.ra,_4e_unselectable:j.ta,_4e_getOffset:j.Qb,_4e_getFrameDocument:j.oe,_4e_splitText:j.ia,_4e_parents:j.Ub,_4e_clone:j.K,_4e_nextSourceNode:j.v,_4e_previousSourceNode:j.ha,_4e_commonAncestor:j.Pb,_4e_ascendant:j.Oc,_4e_hasAttribute:j.Rb,_4e_hasAttributes:j.eb,_4e_position:j.La,_4e_address:j.Ja,_4e_breakParent:j.Ob,_4e_style:j.L,_4e_remove:j.j,_4e_trim:j.gb,_4e_ltrim:j.Tc,_4e_rtrim:j.Vc,_4e_appendBogus:j.Nb,_4e_last:j.qe,_4e_previous:j.sa,_4e_next:j.Ka,_4e_outerHtml:j.fb,
_4e_setMarker:j.re,_4e_clearMarkers:j.Pc,_4e_getUniqueId:j.pg,_4e_copyAttributes:j.Qc,_4e_isEditable:j.Rc,_4e_scrollIntoView:j.Vb,_4e_getElementsByTagName:j.ne});A.pe(j)});
KISSY.Editor.add("focusmanager",function(k){function w(){this.qc=n;q=this}function p(){this.qc=e;q=f}var I=KISSY,C=I.DOM,A=I.Event,t={},q;I={eh:function(){for(var d in t){var i=t[d];i.document.designMode="off";i.document.designMode="on"}},Jg:function(){return q},jf:function(d){return t[d]},add:function(d){var i=C.ga(d.document);A.on(i,"focus",w,d);A.on(i,"blur",p,d)},Df:function(d){t[d.Wb]=d},remove:function(d){delete t[d.Wb];var i=C.ga(d.document);A.remove(i,"focus",w,d);A.remove(i,"blur",p,d)}};
var n=T,e=Y,f=V;k.ud=I;k.focusManager=I;k.kf=function(){return t};k.getInstances=k.kf});
KISSY.Editor.add("definition",function(k){var w=T,p=Y,I=k.k,C=document,A=KISSY,t=A.UA,q=A.DOM,n=A.Node,e=A.Event,f=k.ud,d=I.Yd,i=1,u="document.open();"+(I.qb()?'document.domain="'+C.domain+'";':"")+"document.close();",j="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(t.ie?"javascript:void(function(){"+
encodeURIComponent(u)+"}())":"")+'"  tabIndex="'+(t.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";k.Mc=0;k.db=1;k.SOURCE_MODE=k.Mc;k.WYSIWYG_MODE=k.db;A.augment(k,{rf:function(a){var b=this;b.hb={};b.Ma={};b.ua={};t.ie&&q.addClass(C.body,"ke-ie"+t.ie);if(t.trident)q.addClass(C.body,"ke-trident"+t.trident);else if(t.gecko)q.addClass(C.body,"ke-gecko");else t.webkit&&q.addClass(C.body,"ke-webkit");var g=new n(j.replace(/\$\(tabIndex\)/,
a.attr("tabIndex")));b.df=g;b.Wb=i++;f.Df(b);b.Wa=g.one(".ke-textarea-wrap");b.wrap=b.Wa;b.Ca=b.Wa.one("iframe");b.iframe=b.Ca;b.Xd=g.one(".ke-editor-tools");b.toolBarDiv=b.Xd;b.W=a;b.textarea=b.W;b.Kf=g.one(".ke-editor-status");b.statusDiv=b.Kf;I.Cf(b.Xd);var o=a.L("width"),B=a.L("height");if(o){g.css("width",o);a.css("width","100%")}b.W.css("display","none");g.insertAfter(a);b.Wa[0].appendChild(a[0]);if(B){b.Wa.css("height",B);a.css("height","100%")}g=b.Ca;b.on("dataReady",function(){b.Be=w;k.fire("instanceCreated",
{cf:b})});t.gecko?g.on("load",b.cd,b):b.cd();b.va.attachForm&&a[0].form&&b.we()},za:function(){if(!this.ue){var a=this.df,b=this.W,g=this.document,o=this.Ca[0].contentWindow;this.Bb();k.ud.remove(this);e.remove(g);e.remove(g.documentElement);e.remove(g.body);e.remove(o);this.Ca.detach();g=this.ua;for(var B in g)if(g.hasOwnProperty(B)){o=g[B];o.za&&o.za()}this.fire("destroy");b.insertBefore(a);a.remove();b.css({width:a.css("width"),height:this.Wa.css("height")});b.show();this.hb=this.Ma=this.ua=V;
this.detach();this.ue=T}},we:function(){var a=this,b=new n(a.W[0].form);b.on("submit",a.Bb,a);a.on("destroy",function(){b.detach("submit",a.Bb,a)})},Nf:function(a,b){var g=this,o=k.fe;o&&o.sc();g.use(a,function(){var B=g.xd(a);if(B){b(B);o&&o.kh()}else A.later(arguments.callee,50,Y,g)})},Je:function(a,b){this.Ma[a]=b},xd:function(a){return this.Ma[a]},Ng:function(a){var b=this.Ma[a];b&&b.za();this.Ma[a]=V},He:function(a,b){this.hb[a]=b},of:function(a){return this.hb[a]},execCommand:function(a){var b=
this.hb[a],g=A.makeArray(arguments);g.shift();g.unshift(this);return b.exec.apply(b,g)},lc:function(){return this.W.css("display")=="none"?k.db:k.Mc},getData:function(a){var b;b=this.lc()==k.db?this.document&&this.document.body?this.document.body.innerHTML:"":this.W.val();if(this.htmlDataProcessor)b=a?this.htmlDataProcessor.toHtml(b,"p"):this.htmlDataProcessor.toServer(b,"p");b=A.trim(b);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(b))b="";return b},setData:function(a){var b=a;if(this.htmlDataProcessor)b=this.htmlDataProcessor.toDataFormat(a,
"p");this.document.body.innerHTML=b;this.lc()!=k.db&&this.W.val(a)},Bb:function(){this.W.val(this.getData())},rg:function(){return this.document.body.innerHTML},vg:function(a){this.document.body.innerHTML=a},Ae:function(a){var b=this.va,g=b.ec;b=b.ya;var o="",B=k.k.od("../theme/editor-iframe.css");if(b)for(var y=0;y<b.length;y++)o+='<link href="'+b[y]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+B+"' rel='stylesheet'/><style>"+(g||"")+"</style>"+o+
"</head><body class='ke-editor'>&nbsp;"+(a?'<script id="ke_actscript" type="text/javascript">'+(I.qb()?'document.domain="'+C.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':"")+"</body></html>"},getSelection:function(){return k.Nc.getSelection(this.document)},focus:function(){var a=this.document,b=q.ga(a);t.webkit&&b&&b.parent&&b.parent.focus();t.webkit&&b&&b.focus();a&&a.body.focus();this.ub()},blur:function(){q.ga(this.document).blur();this.document&&this.document.body.blur()},
Ie:function(a){var b=this.va,g=this.document;b.ec=b.ec||"";b.ec+="\n"+a;b=g.createElement("style");g.getElementsByTagName("head")[0].appendChild(b);if(b.styleSheet)b.styleSheet.cssText=a;else b.appendChild(g.createTextNode(a))},Bg:function(a){var b=this.va,g=this.document;b.ya=b.ya||[];b.ya.push(a);b=g.createElement("link");b.rel="stylesheet";g.getElementsByTagName("head")[0].appendChild(b);b.href=a},fh:function(a){for(var b=this.va,g=A.makeArray(this.document.getElementsByTagName("link")),o=0;o<
g.length;o++)g[o].href==a&&q.j(g[o]);b.ya=b.ya||[];b=b.ya;a=A.indexOf(a,b);a!=-1&&b.splice(a,1)},cd:function(){function a(){y=B.document;b.document=y;g.detach();y.open("text/html","replace");y.write(o);y.close()}var b=this,g=b.Ca,o=b.Ae(b.Wb),B=g[0].contentWindow,y;try{y=B.document}catch(r){g[0].src=g[0].src;if(t.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this.Be?a():this.on("dataReady",a)},Cg:function(a,b,g){this.ua=this.ua;g=g||{};g.hf=b;this.ua[a]=g},Zd:function(a){var b=this.ua[a];
if(b)if(!(b.status&&!b.duplicate)){a=this.Env.mods[a].requires||[];for(var g=0;g<a.length;g++)this.Zd(a[g]);b.hf.call(b);b.status=1}},jb:function(){var a=this;a.$c&&clearTimeout(a.$c);a.$c=setTimeout(function(){var b=a.getSelection();if(b&&!b.Fd){var g=b.ob(),o=new k.Za(g);if(!a.xc||!a.xc.md(o)){a.xc=o;a.fire("selectionChange",{selection:b,path:o,element:g})}}},100)},ub:function(){this.xc=V;this.jb()},Ed:function(a,b,g){var o=this;o.focus();setTimeout(function(){var B,y=a.d(),r=k.m,x=k.oa,z=k.n,J=
r.Xa[y],s=o.getSelection(),c=s&&s.H(),h,l,v,m;if(!c||c.length==0){var D=arguments,P=D.callee;setTimeout(function(){P.apply(o,D)},30)}else{o.fire("save");for(var O=c.length-1;O>=0;O--){h=c[O];h.deleteContents();B=!O&&a||a.K(w);b&&b(B);if(J)for(;(v=h.Aa(p,w))&&(m=r[v.d()])&&!(m&&m[y]);)if(v.d()in r.span)h.Cc(v);else if(h.wa()&&h.ka()){h.setStartBefore(v);h.collapse(w);v.j()}else h.Bc();h.insertNode(B);l||(l=B)}if(l){y=l.v(w);r=o.document;m=k.m;if(m.Db[B.d()]){y=new n(r.createTextNode(" "));y.insertAfter(l)}else if(y){if(y.d()==
"br"&&m[y.parent().d()].p){m=new n("<p>&nbsp;</p>",V,r);y[0].parentNode.replaceChild(m[0],y[0]);y=m}}else{m=new n("<p>&nbsp;</p>",V,r);m.insertAfter(l);y=m}h.G(l,x.r);y&&y[0].nodeType==z.e&&h.sb(y);s.Ab([h]);o.focus();B&&B.Vb();setTimeout(function(){o.fire("save")},10);g&&g(B)}}},0)},sf:function(a,b){var g=this;if(g.htmlDataProcessor)a=g.htmlDataProcessor.toDataFormat(a,V,b);if(t.webkit){var o=q.create(a,V,g.document);o=o.nodeType==11?A.makeArray(o.childNodes):[o];for(var B=0;B<o.length;B++)g.Ed(new n(o[B]))}else{g.focus();
setTimeout(function(){var y=g.getSelection();y=y&&y.H();if(!y||y.length==0){var r=arguments,x=r.callee;setTimeout(function(){x.apply(g,r)},30)}else{g.fire("save");if(document.selection){y=document.selection;y.type=="Control"&&y.clear();y.createRange().pasteHTML(a)}else g.document.execCommand("inserthtml",p,a);setTimeout(function(){g.fire("save")},10)}},0)}}});k._initIFrame=function(a){function b(s){d(function(){B.designMode="on";setTimeout(function(){B.designMode="off";r.focus();if(!arguments.callee.Ff)arguments.callee.Ff=
w},50)},function(){B.designMode="off";q.attr(r,"contentEditable",p);q.attr(r,"contentEditable",w);!s&&b(1)})}var g=f.jf(a);a=g.W[0];var o=g.Ca[0].contentWindow,B=g.document,y=g.va;q.j(B.getElementById("ke_actscript"));var r=B.body;if(t.ie){r.hideFocus=w;r.disabled=w;r.contentEditable=w;r.removeAttribute("disabled")}else setTimeout(function(){if(t.gecko||t.opera)r.contentEditable=w;else if(t.webkit)r.parentNode.contentEditable=w;else B.designMode="on"},0);if(t.webkit){e.on(B,"click",function(s){var c=
new n(s.target);A.inArray(c.d(),["input","select"])&&s.preventDefault()});e.on(B,"mouseup",function(s){var c=new n(s.target);A.inArray(c.d(),["input","textarea"])&&s.preventDefault()})}if(t.gecko||t.ie||t.opera){var x;x=new n(q.insertAfter((new n('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],a));x.on("focus",function(){g.focus()});g.Ag=function(){t.gecko&&g.qc&&x[0].focus()};g.on("destroy",function(){x.detach();x.remove()})}if(B.documentMode||t.gecko||
t.opera){var z=B.documentElement;e.on(z,"mousedown",function(s){if((new n(s.target))[0]==z){t.gecko&&b(p);x[0].focus()}})}e.on(o,"focus",function(){if(t.gecko)b(p);else t.opera&&r.focus();g.ub()});t.gecko&&e.on(g.document,"mousedown",function(){g.qc||b(p)});if(t.ie){e.on(B,"keydown",function(s){if(s.keyCode in{8:1,46:1}){var c=g.getSelection(),h=c.mc();if(h){g.fire("save");var l=c.H()[0].O();h.j();c.Td([l]);g.fire("save");s.preventDefault()}}});if(B.compatMode=="CSS1Compat"){var J={33:1,34:1};e.on(B,
"keydown",function(s){s.keyCode in J&&setTimeout(function(){g.getSelection().scrollIntoView()},0)})}}setTimeout(function(){t.ie&&setTimeout(function(){if(B){r.runtimeStyle.marginBottom="0px";r.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){g.fire("dataReady");var s=y.disableObjectResizing,c=y.disableInlineTableEditing;if(s||c)try{B.execCommand("enableObjectResizing",p,!s);B.execCommand("enableInlineTableEditing",p,!c)}catch(h){e.on(r,t.ie?"resizestart":"resize",function(l){var v=new n(l.target);
if(s||v.d()==="table"&&c)l.preventDefault()})}},10);t.webkit&&e.on(B,"mousedown",function(s){s=new n(s.target);A.inArray(s.d(),["img","hr","input","textarea","select"])&&g.getSelection().Ac(s)});t.gecko&&e.on(B,"dragstart",function(s){var c=new n(s.target);c.d()==="img"&&/ke_/.test(c[0].className)&&s.preventDefault()});f.add(g)};document.documentMode>7&&function(){for(var a=A.all("link"),b=0;b<a.length;b++){var g=new n(a[b]),o=g.attr("href");o.indexOf("editor-pkg-min-mhtml.css")!=-1&&g.attr("href",
o.replace(/editor-pkg-min-mhtml\.css/g,"editor-pkg-min-datauri.css"))}}();u=k.prototype;I.o(u,{setData:u.setData,getData:u.getData,insertElement:u.Ed,insertHtml:u.sf,ready:u.ready,addCustomStyle:u.Ie,addCommand:u.He,hasCommand:u.of,execCommand:u.execCommand,useDialog:u.Nf,addDialog:u.Je,getDialog:u.xd,getMode:u.lc,sync:u.Bb,getSelection:u.getSelection,focus:u.focus,blur:u.blur,notifySelectionChange:u.ub})});
KISSY.Editor.add("zindex",function(){var k=KISSY.Editor;if(!k.Dc){k.Dc={Uf:1100,jg:1200,Wf:99999,cg:900,ig:9999,LOADING:11E3,bg:12E3,he:1200};k.$b=function(w){return(k.Vf.$b||1E4)+w};k.baseZIndex=k.$b;k.zIndexManager=k.Dc}});
KISSY.Editor.add("dtd",function(k){k.m=function(){function w(r){for(var x=arguments.length-1;x>0;)KISSY.mix(r,arguments[x--]);return r}var p={isindex:1,fieldset:1},I={input:1,button:1,select:1,textarea:1,label:1},C=w({a:1},I),A=w({iframe:1},C),t={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},q={ins:1,del:1,script:1,style:1},n=w({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,
s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},q),e=w({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},n),f=w({p:1},e);I=w({iframe:1},e,I);e={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,
del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var d=w({a:1},I),i={tr:1},u={"#":1},j=w({param:1},e),a=w({form:1},p,A,t,f),b={li:1},g={base:1,link:1,meta:1,title:1},o=w(g,{style:1,script:1}),B={head:1,body:1},y={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{Fb:w({html:1},B,g),Xa:y,Sf:{body:1,div:1,td:1,th:1,caption:1,
form:1},Db:d,Ec:w({script:1,style:1},y),Fc:{script:1,style:1},Cb:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},Eb:{dd:1,dt:1,li:1},$d:{ul:1,ol:1,dl:1},Hc:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},ca:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},Tf:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},Ic:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:B,head:o,style:u,body:a,base:{},link:{},meta:{},title:u,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:d,button:w(f,t),basefont:{},h5:d,h4:d,samp:d,h6:d,ol:b,h1:d,h3:d,option:u,h2:d,form:w(p,A,t,f),select:{optgroup:1,option:1},font:d,ins:d,menu:b,abbr:d,label:d,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:d,script:u,tfoot:i,cite:d,li:a,input:{},iframe:a,
strong:d,textarea:u,noframes:a,big:d,small:d,span:d,hr:{},dt:d,sub:d,optgroup:{option:1},param:{},bdo:d,"var":d,div:a,object:j,sup:d,dd:a,strike:d,area:{},dir:b,map:w({area:1,form:1,p:1},p,q,t),applet:j,dl:{dt:1,dd:1},del:d,isindex:{},fieldset:w({Yg:1},e),thead:i,ul:b,acronym:d,b:d,a:I,blockquote:a,caption:d,i:d,u:d,tbody:i,s:d,address:w(A,f),tt:d,legend:d,q:d,pre:w(n,C),p:d,em:d,dfn:d}}();k.XHTML_DTD=k.m});
KISSY.Editor.add("elementpath",function(k){function w(e){var f=A,d=A,i=[];for(e=e;e&&e[0];){if(e[0].nodeType==C.e){if(!this.wf)this.wf=e;var u=e.d();if(!d){if(!f&&t[u])f=e;if(q[u]){var j;if(j=!f){if(j=u=="div"){a:{j=e;j=j[0]||j;j=j.childNodes;for(var a=0,b=j.length;a<b;a++){var g=j[a];if(g.nodeType==C.e&&I.Xa[g.nodeName.toLowerCase()]){j=T;break a}}j=Y}j=!j}j=j}if(j)f=e;else d=e}}i.push(e);if(u=="body")break}e=e.parent()}this.block=this.w=f;this.blockLimit=this.D=d;this.elements=this.elements=i}var p=
KISSY.DOM,I=k.m,C=k.n,A=V,t={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},q={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};w.prototype={md:function(e){var f=this.elements;e=e&&e.elements;if(!e||f.length!=e.length)return Y;for(var d=0;d<f.length;d++)if(!p.g(f[d],e[d]))return Y;return T},contains:function(e){for(var f=this.elements,d=0;d<f.length;d++)if(f[d].d()in e)return f[d];return A}};k.ElementPath=k.Za=w;var n=w.prototype;k.k.o(n,{compare:n.md,
contains:n.contains})});
KISSY.Editor.add("walker",function(k){function w(i,u){if(this.c.end)return t;var j,a=this.Ea,b,g=this.nc,o=this.type,B=i?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this.c.start){this.c.start=1;a.trim();if(a.collapsed){this.end();return t}}if(!i&&!this.c.Ad){var y=a.endContainer,r=new f(y[0].childNodes[a.endOffset]);this.c.Ad=function(s,c){return(s=e.C(s))&&s[0]&&(!c||!e.g(y,s))&&(!r[0]||!s.g(r))&&(s[0].nodeType!=n.e||!c||s.d()!="body")}}if(i&&!this.c.Bd){var x=a.startContainer,z=a.startOffset>
0&&new f(x[0].childNodes[a.startOffset-1]);this.c.Bd=function(s,c){return(s=e.C(s))&&s[0]&&(!c||!s.g(x))&&(!z[0]||!s.g(z))&&(s[0].nodeType!=n.e||!c||s.d()!="body")}}var J=i?this.c.Bd:this.c.Ad;b=g?function(s,c){if(J(s,c)===A)return A;return g(s,c)}:J;if(this.mb)j=this.mb[B](A,o,b);else if(i){j=a.endContainer;if(a.endOffset>0){j=new f(j[0].childNodes[a.endOffset-1]);if(b(j)===A)j=t}else j=b(j,C)===A?t:j.ha(C,o,b)}else{j=a.startContainer;if((j=new f(j[0].childNodes[a.startOffset]))&&j[0]){if(b(j)===
A)j=t}else j=b(a.startContainer,C)===A?t:a.startContainer.v(C,o,b)}for(;j&&j[0]&&!this.c.end;){this.mb=j;if(!this.R||this.R(j)!==A){if(!u)return j}else if(u&&this.R)return A;j=j[B](A,o,b)}this.end();return this.mb=t}function p(i){for(var u,j=t;u=w.call(this,i);)j=u;return j}function I(i){this.Ea=i;this.c={}}var C=T,A=Y,t=V,q=KISSY,n=k.n,e=q.DOM,f=q.Node;q.augment(I,{end:function(){this.c.end=1},next:function(){return w.call(this)},xb:function(){return w.call(this,C)},ld:function(){return w.call(this,
A,C)!==A},kd:function(){return w.call(this,C,C)!==A},Hd:function(){return p.call(this)},Gd:function(){return p.call(this,C)},reset:function(){delete this.mb;this.c={}}});I.ac=function(i){return function(u){u=e.C(u);return!(u&&u[0].nodeType==n.e&&u.qa(i))}};I.yf=function(){return this.ac({bc:1})};I.Na=function(i,u){function j(a){return a&&a[0]&&a.d()=="span"&&a.attr("_ke_bookmark")}return function(a){var b,g;b=a&&a[0]&&a[0].nodeType==n.f&&(g=a.parent())&&j(g);b=i?b:b||j(a);return u^b}};I.Va=function(i){return function(u){u=
(u=u[0]||u)&&u.nodeType==n.f&&!q.trim(u.nodeValue);return i^u}};I.tf=function(i){var u=I.Va();return function(j){j=u(j)||j[0].nodeType==n.e&&!j[0].offsetHeight;return i^j}};k.Ia=I;k.Walker=I;var d=I.prototype;k.k.o(d,{end:d.end,next:d.next,previous:d.xb,checkForward:d.ld,checkBackward:d.kd,lastForward:d.Hd,lastBackward:d.Gd,reset:d.reset});k.k.o(I,{blockBoundary:I.ac,listItemBoundary:I.yf,bookmark:I.Na,whitespaces:I.Va,invisible:I.tf})});
KISSY.Editor.add("range",function(k){function w(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=e;this.collapsed=q;this.document=c}function p(c){var h=c[0].nodeType!=d.f&&c.d()in o.ca,l=!f.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return h||l||c}function I(c){return!z(c)&&!J(c)}function C(c){var h=n,l=j.Na(q);return function(v){if(l(v))return q;if(v[0].nodeType==d.f){if(f.trim(v[0].nodeValue).length)return n}else if(v[0].nodeType==d.e)if(!x[v.d()])if(!c&&!g.ie&&
v.d()=="br"&&!h)h=q;else return n;return q}}function A(c,h){function l(v){return v&&v.nodeName=="span"&&v.getAttribute("_ke_bookmark")}return function(v){var m,D;m=v&&!v.nodeName&&(D=v.parentNode)&&l(D);m=c?m:m||l(v);return h^m}}function t(c){return function(h){h=(h=h[0]||h)&&h.nodeType==d.f&&!f.trim(h.nodeValue);return c^h}}k.oa={Z:1,J:2,B:3,r:4,Ib:1,Hb:2,Ya:3,bb:1,de:2,kg:3,fa:1,Lc:2};k.RANGE=k.oa;var q=T,n=Y,e=V,f=KISSY,d=k.n,i=k.oa,u=k.$a,j=k.Ia,a=f.DOM,b=k.k.wd,g=f.UA,o=k.m,B=k.Za,y=f.Node,r=
{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};w.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+":"+this.endOffset);return c.join("<br/>")};f.augment(w,{Ua:function(){this.collapsed=this.startContainer&&this.endContainer&&a.g(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},vc:function(){var c=this.startContainer,
h=this.startOffset;if(c[0].nodeType!=d.e)if(h)h>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;h=this.endOffset;if(c[0].nodeType!=d.e)if(h)h>=c[0].nodeValue.length&&this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c.t()+1)},setStartBefore:function(c){this.setStart(c.parent(),c.t())},setEndAfter:function(c){this.setEnd(c.parent(),c.t()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c.t())},wc:function(){var c=
this.startContainer,h=this.endContainer;c&&c.d()=="span"&&c.attr("_ke_bookmark")&&this.V(c,i.B);h&&h.d()=="span"&&h.attr("_ke_bookmark")&&this.U(h,i.r)},setStart:function(c,h){if(c[0].nodeType==d.e&&r[c.d()]){c=c.parent();h=c.t()}this.startContainer=c;this.startOffset=h;if(!this.endContainer){this.endContainer=c;this.endOffset=h}this.Ua()},setEnd:function(c,h){if(c[0].nodeType==d.e&&r[c.d()]){c=c.parent();h=c.t()+1}this.endContainer=c;this.endOffset=h;if(!this.startContainer){this.startContainer=
c;this.startOffset=h}this.Ua()},V:function(c,h){switch(h){case i.Z:this.setStart(c,0);break;case i.J:c[0].nodeType==d.f?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case i.B:this.setStartBefore(c);break;case i.r:this.setStartAfter(c)}this.Ua()},U:function(c,h){switch(h){case i.Z:this.setEnd(c,0);break;case i.J:c[0].nodeType==d.f?this.setEnd(c,c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case i.B:this.setEndBefore(c);break;case i.r:this.setEndAfter(c)}this.Ua()},
hc:function(c,h){var l=this.startContainer,v=this.endContainer,m=this.startOffset,D=this.endOffset,P,O=this.document,Q;this.wc();if(v[0].nodeType==d.f)v=v.ia(D);else if(v[0].childNodes.length>0)if(D>=v[0].childNodes.length){v=new y(v[0].appendChild(O.createTextNode("")));Q=q}else v=new y(v[0].childNodes[D]);if(l[0].nodeType==d.f){l.ia(m);if(l.g(v))v=new y(l[0].nextSibling)}else if(m)if(m>=l[0].childNodes.length){P=new y(O.createTextNode(""));l.append(P);l=P;P=q}else l=new y(l[0].childNodes[m].previousSibling);
else{P=new y(O.createTextNode(""));l.prepend(P);l=P;P=q}m=l.Ub();D=v.Ub();var N,W,S;for(N=0;N<m.length;N++){W=m[N];S=D[N];if(!W.g(S))break}O=h;for(var X,aa,ca,F=N;F<m.length;F++){X=m[F];aa=O&&!X.g(l)?O.appendChild(X.K()[0]):V;for(X=X[0].nextSibling;X;){if(a.g(D[F],X)||a.g(v,X))break;ca=X.nextSibling;if(c==2)O.appendChild(X.cloneNode(q));else{a.j(X);c==1&&O.appendChild(X)}X=ca}if(aa)O=aa}O=h;for(N=N;N<D.length;N++){X=D[N];aa=O&&c>0&&!X.g(v)?O.appendChild(X.K()[0]):V;if(!m[N]||!X.parent().g(m[N].parent()))for(X=
X[0].previousSibling;X;){if(a.g(m[N],X)||a.g(l,X))break;ca=X.previousSibling;if(c==2)O.insertBefore(X.cloneNode(q),O.firstChild);else{a.j(X);c==1&&O.insertBefore(X,O.firstChild)}X=ca}if(aa)O=aa}if(c==2){S=this.startContainer[0];if(S.nodeType==d.f&&S.nextSibling&&S.nextSibling.nodeType==d.f){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}S=this.endContainer[0];if(S.nodeType==d.f&&S.nextSibling&&S.nextSibling.nodeType==d.f){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}}else{if(W&&
S&&(!l.parent().g(W.parent())||!v.parent().g(S.parent()))){W=S.t();P&&S.parent().g(l.parent())&&W--;this.setStart(S.parent(),W)}this.collapse(q)}P&&l.j();Q&&v[0].parentNode&&v.j()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=q},clone:function(){var c=new w(this.document);c.startContainer=this.startContainer;c.startOffset=this.startOffset;c.endContainer=this.endContainer;
c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},yd:function(){var c=this.clone();c.vc();if(c.startContainer[0].nodeType!=d.e||c.endContainer[0].nodeType!=d.e)return e;var h=new k.Ia(c),l=A(q,undefined),v=t(q);c.R=function(m){return v(m)&&l(m)};c=h.next();h.reset();h=h.xb();return c&&c.g(h)?c:e},Ta:function(c,h){if(!this.collapsed){c=c||i.Lc;var l=this.clone(),v=this.startContainer,m=this.endContainer,D=this.startOffset,P=this.endOffset,O=1,Q=1;if(v&&v[0].nodeType==d.f)if(D)if(D>=v[0].nodeValue.length)l.setStartAfter(v);
else{l.setStartBefore(v);O=0}else l.setStartBefore(v);if(m&&m[0].nodeType==d.f)if(P)if(P>=m[0].nodeValue.length)l.setEndAfter(m);else{l.setEndAfter(m);Q=0}else l.setEndBefore(m);l=new j(l);l.R=function(W){W=W[0]||W;return W.nodeType==(c==i.fa?d.e:d.f)};var N;l.nc=function(W,S){W=W[0]||W;if(c==i.fa&&W.nodeType==d.f)return n;if(S&&W==N)return n;if(!S&&W.nodeType==d.e)N=W;return q};if(O)(v=l[c==i.fa?"lastForward":"next"]())&&this.V(v,h?i.Z:i.B);if(Q){l.reset();(l=l[c==i.fa?"lastBackward":"previous"]())&&
this.U(l,h?i.J:i.r)}return!!(O||Q)}},mf:function(){var c=this.startContainer;if(this.collapsed||c[0].nodeType!=d.e)return c;return c.childNodes[this.startOffset]||c},nd:function(c){var h=this.startContainer,l=this.endContainer,v=this.startOffset,m=this.endOffset,D,P;if(!h||!l)return{start:0,end:0};if(c){if(h[0].nodeType==d.e)if((D=new y(h[0].childNodes[v]))&&D[0]&&D[0].nodeType==d.f&&v>0&&D[0].previousSibling.nodeType==d.f){h=D;v=0}for(;h[0].nodeType==d.f&&(P=h.sa())&&P[0].nodeType==d.f;){h=P;v+=
P[0].nodeValue.length}if(!this.collapsed){if(l[0].nodeType==d.e)if((D=new y(l[0].childNodes[m]))&&D[0]&&D[0].nodeType==d.f&&m>0&&D[0].previousSibling.nodeType==d.f){l=D;m=0}for(;l[0].nodeType==d.f&&(P=l.sa())&&P[0].nodeType==d.f;){l=P;m+=P[0].nodeValue.length}}}return{start:h.Ja(c),end:this.collapsed?e:l.Ja(c),startOffset:v,endOffset:m,Kd:c,uf:q}},O:function(c){var h,l,v,m,D=this.collapsed;h=new y("<span>",e,this.document);h.attr("_ke_bookmark",1);h.css("display","none");h.html("&nbsp;");if(c){v=
f.guid("ke_bm_");h.attr("id",v+"S")}if(!D){l=h.K();l.html("&nbsp;");c&&l.attr("id",v+"E");m=this.clone();m.collapse();m.insertNode(l)}m=this.clone();m.collapse(q);m.insertNode(h);if(l){this.setStartAfter(h);this.setEndBefore(l)}else this.G(h,i.r);return{ba:c?v+"S":h,Q:c?v+"E":l,Vd:c,collapsed:D}},G:function(c,h){this.V(c,h);this.collapse(q)},trim:function(c,h){var l=this.startContainer,v=this.startOffset,m=this.collapsed;if((!c||m)&&l[0]&&l[0].nodeType==d.f){if(v)if(v>=l[0].nodeValue.length){v=l.t()+
1;l=l.parent()}else{var D=l.ia(v);v=l.t()+1;l=l.parent();if(a.g(this.startContainer,this.endContainer))this.setEnd(D,this.endOffset-this.startOffset);else if(a.g(l,this.endContainer))this.endOffset+=1}else{v=l.t();l=l.parent()}this.setStart(l,v);if(m){this.collapse(q);return}}l=this.endContainer;v=this.endOffset;if(!(h||m)&&l[0]&&l[0].nodeType==d.f){if(v){v>=l.nodeValue.length||l.ia(v);v=l.t()+1}else v=l.t();l=l.parent();this.setEnd(l,v)}},insertNode:function(c){this.wc();this.trim(n,q);var h=this.startContainer;
h[0].insertBefore(c[0]||c,h[0].childNodes[this.startOffset]||V);a.g(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},moveToBookmark:function(c){if(c.uf){var h=b(this.document,c.start,c.Kd),l=c.startOffset,v=c.end&&b(this.document,c.end,c.Kd);c=c.endOffset;this.setStart(h,l);v?this.setEnd(v,c):this.collapse(q)}else{h=(l=c.Vd)?f.one("#"+c.ba,this.document):c.ba;c=l?f.one("#"+c.Q,this.document):c.Q;this.setStartBefore(h);h.j();if(c&&c[0]){this.setEndBefore(c);c.j()}else this.collapse(q)}},
Aa:function(c,h){var l=this.startContainer,v=this.endContainer;l=a.g(l,v)?c&&l[0].nodeType==d.e&&this.startOffset==this.endOffset-1?new y(l[0].childNodes[this.startOffset]):l:l.Pb(v);return h&&l[0].nodeType==d.f?l.parent():l},Oa:function(c){switch(c){case i.Ib:if(this.collapsed)break;c=this.Aa();var h=new y(this.document.body),l,v,m,D,P,O=n,Q,N;Q=this.startContainer;N=this.startOffset;if(Q[0].nodeType==d.f){if(N){Q=!f.trim(Q[0].nodeValue.substring(0,N)).length&&Q;O=!!Q}if(Q)if(!(D=Q[0].previousSibling))m=
Q.parent()}else{if(N)D=Q[0].childNodes[N-1]||Q[0].lastChild;D||(m=Q)}for(;m||D;){if(m&&!D){if(!P&&a.g(m,c))P=q;if(!h.contains(m))break;if(!O||m.css("display")!="inline"){O=n;if(P)l=m;else this.setStartBefore(m)}D=m[0].previousSibling}for(;D;){Q=n;if(D.nodeType==d.f){N=D.nodeValue;if(/[^\s\ufeff]/.test(N))D=e;Q=/[\s\ufeff]$/.test(N)}else if(D.offsetWidth>0&&!D.getAttribute("_ke_bookmark"))if(O&&o.ca[D.nodeName.toLowerCase()]){N=a.text(D);if(/[^\s\ufeff]/.test(N))D=e;else for(var W=D.all||D.getElementsByTagName("*"),
S=0,X;X=W[S++];)if(!o.ca[X.nodeName.toLowerCase()]){D=e;break}if(D)Q=!!N.length}else D=e;if(Q)if(O)if(P)l=m;else m&&this.setStartBefore(m);else O=q;if(D){Q=D.previousSibling;if(!m&&!Q){m=new y(D);D=e;break}D=Q}else m=e}if(m)m=m.parent()}Q=this.endContainer;N=this.endOffset;m=D=e;P=O=n;if(Q[0].nodeType==d.f){Q=!f.trim(Q[0].nodeValue.substring(N)).length&&Q;O=!(Q&&Q[0].nodeValue.length);if(Q)if(!(D=Q[0].nextSibling))m=Q.parent()}else(D=Q[0].childNodes[N])||(m=Q);for(;m||D;){if(m&&!D){if(!P&&a.g(m,c))P=
q;if(!h.contains(m))break;if(!O||m.css("display")!="inline"){O=n;if(P)v=m;else m&&this.setEndAfter(m)}D=m[0].nextSibling}for(;D;){Q=n;if(D.nodeType==d.f){N=D.nodeValue;if(/[^\s\ufeff]/.test(N))D=e;Q=/^[\s\ufeff]/.test(N)}else if(D.offsetWidth>0&&!D.getAttribute("_ke_bookmark"))if(O&&o.ca[D.nodeName.toLowerCase()]){N=a.text(D);if(/[^\s\ufeff]/.test(N))D=e;else{W=D.all||D.getElementsByTagName("*");for(S=0;X=W[S++];)if(!o.ca[X.nodeName.toLowerCase()]){D=e;break}}if(D)Q=!!N.length}else D=e;if(Q)if(O)if(P)v=
m;else this.setEndAfter(m);if(D){Q=D.nextSibling;if(!m&&!Q){m=new y(D);D=e;break}D=Q}else m=e}if(m)m=m.parent()}if(l&&v){c=l.contains(v)?v:l;this.setStartBefore(c);this.setEndAfter(c)}break;case i.Hb:case i.Ya:m=new w(this.document);h=new y(this.document.body);m.V(h,i.Z);m.setEnd(this.startContainer,this.startOffset);m=new j(m);var aa,ca,F=j.ac(c==i.Ya?{bc:1}:e),K=function(E){var H=F(E);H||(aa=E);return H};l=function(E){var H=K(E);if(!H&&E[0]&&E.d()=="br")ca=E;return H};m.nc=K;m=m.Gd();aa=aa||h;this.V(aa,
aa.d()!="br"&&(!m&&this.wa()||m&&aa.contains(m))?i.Z:i.r);m=this.clone();m.collapse();m.U(h,i.J);m=new j(m);m.nc=c==i.Ya?l:K;aa=e;m=m.Hd();aa=aa||h;this.U(aa,!m&&this.ka()||m&&aa.contains(m)?i.J:i.B);ca&&this.setEndAfter(ca)}},wa:function(){var c=this.startContainer,h=this.startOffset;if(h&&c[0].nodeType==d.f)if(f.trim(c[0].nodeValue.substring(0,h)).length)return n;this.trim();c=new B(this.startContainer);h=this.clone();h.collapse(q);h.V(c.w||c.D,i.Z);c=new j(h);c.R=C(q);return c.kd()},ka:function(){var c=
this.endContainer,h=this.endOffset;if(c[0].nodeType==d.f)if(f.trim(c[0].nodeValue.substring(h)).length)return n;this.trim();c=new B(this.endContainer);h=this.clone();h.collapse(n);h.U(c.w||c.D,i.J);c=new j(h);c.R=C(n);return c.ld()},deleteContents:function(){this.collapsed||this.hc(0)},extractContents:function(){var c=this.document.createDocumentFragment();this.collapsed||this.hc(1,c);return c},dc:function(c,h){var l=this.clone();l[h==i.bb?"setStartAt":"setEndAt"](c,h==i.bb?i.Z:i.J);l=new j(l);l.R=
p;return l[h==i.bb?"checkBackward":"checkForward"]()},vd:function(){var c=this.startContainer,h=this.endContainer,l=this.startOffset,v=this.endOffset,m;if(c[0].nodeType==d.e){m=c[0].childNodes.length;if(m>l)c=new y(c[0].childNodes[l]);else if(m<1)c=c.ha();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new y(c);c=c.v()||c}}if(h[0].nodeType==d.e){m=h[0].childNodes.length;if(m>v)h=(new y(h[0].childNodes[v])).ha(q);else if(m<1)h=h.ha();else{for(h=h[0];h.lastChild;)h=h.lastChild;h=new y(h)}}if(c.La(h)&u.da)c=
h;return{ba:c,Q:h}},nb:function(c,h){var l=this.O(),v=new y(this.document.createElement(h));this.collapse(c);this.Oa(i.Hb);v[0].appendChild(this.extractContents());v.gb();g.ie||v.Nb();for(var m=v[0].childNodes,D=0;D<m.length;D++){var P=m[D];P.nodeType==8&&this.insertNode(new y(P))}this.insertNode(v);this.moveToBookmark(l);return v},Bc:function(c){var h=new B(this.startContainer),l=new B(this.endContainer),v=h.w,m=l.w,D=e;if(!h.D.g(l.D))return e;if(c!="br"){if(!v){v=this.nb(q,c);m=(new B(this.endContainer)).w}m||
(m=this.nb(n,c))}c=v&&this.wa();h=m&&this.ka();this.deleteContents();if(v&&a.g(v,m))if(h){D=new B(this.startContainer);this.G(m,i.r);m=e}else if(c){D=new B(this.startContainer);this.G(v,i.B);v=e}else{m=this.Cc(v);!g.ie&&!f.inArray(v.d(),["ul","ol"])&&v.Nb()}return{dh:v,ah:m,Qf:c,Pf:h,Tg:D}},Cc:function(c){if(!this.collapsed)return e;this.U(c,i.J);var h=this.extractContents(),l=c.K(n);l[0].appendChild(h);l.insertAfter(c);this.G(c,i.r);return l},sb:function(c,h){var l,v=k.m;if(v.Cb[c.d()])return n;
for(;c&&c[0].nodeType==d.e;){if(l=c.Rc())this.G(c,h?i.J:i.Z);else if(v.Db[c.d()]){this.G(c,h?i.r:i.B);return q}if((c=v.Cb[c.d()]?c[h?"_4e_previous":"_4e_next"](I):c[h?"_4e_last":"_4e_first"](I))&&c[0].nodeType==d.f){this.G(c,h?i.r:i.B);return q}}return l},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==d.f?c[0].nodeValue.length:c[0].childNodes.length)}});var x={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,
small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},z=new j.Va,J=new j.Na;k.Range=w;k.Range=w;var s=w.prototype;k.k.o(s,{updateCollapsed:s.Ua,optimize:s.vc,setStartAfter:s.setStartAfter,setEndAfter:s.setEndAfter,setStartBefore:s.setStartBefore,setEndBefore:s.setEndBefore,optimizeBookmark:s.wc,setStart:s.setStart,setEnd:s.setEnd,setStartAt:s.V,setEndAt:s.U,execContentsAction:s.hc,collapse:s.collapse,clone:s.clone,getEnclosedNode:s.yd,shrink:s.Ta,getTouchedStartNode:s.mf,createBookmark2:s.nd,
createBookmark:s.O,moveToPosition:s.G,trim:s.trim,insertNode:s.insertNode,moveToBookmark:s.moveToBookmark,getCommonAncestor:s.Aa,enlarge:s.Oa,checkStartOfBlock:s.wa,checkEndOfBlock:s.ka,deleteContents:s.deleteContents,extractContents:s.extractContents,checkBoundaryOfElement:s.dc,getBoundaryNodes:s.vd,fixBlock:s.nb,splitBlock:s.Bc,splitElement:s.Cc,moveToElementEditablePosition:s.sb,selectNodeContents:s.selectNodeContents})});
KISSY.Editor.add("domiterator",function(k){function w(j){if(!(arguments.length<1)){this.Ea=j;this.jc=I;this.sd=p;this.gc=I;this.c||(this.c={})}}var p=T,I=Y,C=KISSY,A=C.UA,t=k.Ia,q=k.Range,n=k.oa,e=k.n,f=k.Za,d=C.Node,i=C.DOM,u=/^[\r\n\t ]*$/;C.augment(w,{lf:function(j){var a,b,g,o,B;if(!this.c.I){b=this.Ea.clone();b.Ta(n.fa,p);b.Oa(this.jc||!this.sd?n.Ya:n.Hb);var y=new t(b),r=t.Na(p,p);y.R=r;this.c.la=y.next();y=new t(b);y.R=r;y=y.xb();this.c.I=y.v(p);if(this.c.I&&this.c.I[0].nodeType==e.f&&!C.trim(this.c.I[0].nodeValue)&&
this.c.I.parent().qa()){r=new q(b.document);r.G(this.c.I,n.r);if(r.ka()){r=new f(r.endContainer);this.c.I=(r.w||r.D).v(p)}}if(!this.c.I){this.c.I=this.c.qd=new d(b.document.createTextNode(""));i.insertAfter(this.c.I[0],y[0])}b=V}r=this.c.la;y=this.c.I;for(this.c.la=V;r;){var x=I,z=r[0].nodeType!=e.e,J=I;if(z){if(r[0].nodeType==e.f)if(u.test(r[0].nodeValue))z=I}else{var s=r.d();if(r.qa(this.jc&&{bc:1})){if(s=="br")z=p;else if(!b&&!r[0].childNodes.length&&s!="hr"){a=r;g=r.g(y);break}if(b){b.U(r,n.B);
if(s!="br")this.c.la=r}x=p}else{if(r[0].firstChild){if(!b){b=new q(this.Ea.document);b.V(r,n.B)}r=new d(r[0].firstChild);continue}z=p}}if(z&&!b){b=new q(this.Ea.document);b.V(r,n.B)}g=(!x||z)&&r.g(y);if(b&&!x)for(;!r[0].nextSibling&&!g;){s=r.parent();if(s.qa(this.jc&&{bc:1})){x=p;g||s.g(y);break}r=s;z=p;g=r.g(y);J=p}z&&b.U(r,n.r);r=r.v(J,V,y);if((g=!r)||x&&b)break}if(!a){if(!b){this.c.qd&&this.c.qd.j();return this.c.la=V}a=new f(b.startContainer);r=a.D;x={Og:1,jh:1,ih:1};a=a.w;if((!a||!a[0])&&!this.gc&&
x[r.d()]&&b.wa()&&b.ka())a=r;else if(!a||this.gc&&a.d()=="li"){a=new d(this.Ea.document.createElement(j||"p"));a[0].appendChild(b.extractContents());a.gb();b.insertNode(a);o=B=p}else if(a.d()!="li"){if(!b.wa()||!b.ka()){a=a.K(I);a[0].appendChild(b.extractContents());a.gb();B=b.Bc();o=!B.Qf;B=!B.Pf;b.insertNode(a)}}else if(!g)this.c.la=a.g(y)?V:b.vd().Q.v(p,V,y)}if(o){b=new d(a[0].previousSibling);if(b[0]&&b[0].nodeType==e.e)if(b.d()=="br")b.j();else b[0].lastChild&&i.d(b[0].lastChild)=="br"&&i.j(b[0].lastChild)}if(B){b=
t.Na(I,p);o=new d(a[0].lastChild);if(o[0]&&o[0].nodeType==e.e&&o.d()=="br")if(A.ie||o.sa(b)||o.Ka(b))o.j()}if(!this.c.la)this.c.la=g||a.g(y)?V:a.v(p,V,y);return a}});q.prototype.Ze=function(){return new w(this)}});
KISSY.Editor.add("selection",function(k){function w(x){this.document=this.document=x;this.c={M:{}};if(a){var z=this.z().createRange();if(!z||z.item&&z.item(0).ownerDocument!=x||z.parentElement&&z.parentElement().ownerDocument!=x)this.Fd=C}}function p(x){x=new w(x);return!x||x.Fd?t:x}function I(x){function z(N){return Q(N)&&N&&N[0].nodeType!=8}var J=x.document,s=new d(J.body),c=new d(J.documentElement);if(n.ie){n.Ba<8&&c.on("click",function(N){(new d(N.target)).d()==="html"&&x.getSelection().z().createRange().select()});
var h,l,v=1;c.on("mousedown",function(){v=0});c.on("mouseup",function(){v=1});s.on("focusin",function(N){if((new d(N.target)).d()=="body")if(h){try{v&&h.select()}catch(W){}h=t}});s.on("focus",function(){l=C;D()});s.on("beforedeactivate",function(N){if(!N.relatedTarget){m();v=1}});f.on(e.ga(J),"blur",function(){try{J&&J.selection.empty()}catch(N){}});s.on("mousedown",function(){m()});s.on("mouseup",function(){l=C;setTimeout(function(){D(C)},0)});var m=function(){l=A},D=function(N){if(l){var W=x.document,
S=x.getSelection(),X=S&&S.pb(),aa=S&&W.selection;if(N&&aa&&X==i.Kb)if(!W.queryCommandEnabled("InsertImage")){setTimeout(function(){D(C)},50);return}var ca;if(!(aa&&X==i.pa&&(ca=e.d(S.ob()))&&ca in{input:1,textarea:1})){h=aa&&aa.createRange();x.jb()}}};s.on("keydown",m);s.on("keyup",function(){l=C;D()});f.on(J,"selectionchange",D)}else{f.on(J,"mouseup",x.jb,x);f.on(J,"keyup",x.jb,x)}var P={table:1,pre:1},O=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
Q=k.Ia.Va(C);x.on("selectionChange",function(N){var W=N.path;N=(N=N.selection)&&N.H()[0];if(!(!N||!N.collapsed||W.w))if(W.D.d()=="body")if(W=N.nb(C,"p")){if(W.fb().match(O)){var S=W.Ka(z);if(S&&S[0].nodeType==j.e&&!P[S.d()]){N.sb(S);W.j()}else if((S=W.sa(z))&&S[0].nodeType==j.e&&!P[S.d()]){N.sb(S,S.fb().match(O)?A:C);W.j()}}N.select();a||x.ub()}})}k.je={Kb:1,pa:2,ab:3};var C=T,A=Y,t=V,q=KISSY,n=q.UA,e=q.DOM,f=q.Event,d=q.Node,i=k.je,u=k.oa,j=k.n,a=!window.getSelection,b=k.Ia,g=k.Range,o={img:1,hr:1,
li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};q.augment(w,{z:!a?function(){var x=this.c.M;return x.tc||(x.tc=e.ga(this.document).getSelection())}:function(){var x=this.c.M;return x.tc||(x.tc=this.document.selection)},pb:!a?function(){var x=this.c.M;if(x.type)return x.type;var z=i.pa,J=this.z();if(J){if(J.rangeCount==1){J=J.getRangeAt(0);var s=J.startContainer;if(s==J.endContainer&&s.nodeType==j.e&&J.endOffset-J.startOffset===
1&&o[s.childNodes[J.startOffset].nodeName.toLowerCase()])z=i.ab}}else z=i.Kb;return x.type=z}:function(){var x=this.c.M;if(x.type)return x.type;var z=i.Kb;try{var J=this.z(),s=J.type;if(s=="Text")z=i.pa;if(s=="Control")z=i.ab;if(J.createRange().parentElement)z=i.pa}catch(c){}return x.type=z},H:a?function(){function x(z,J){z=z.duplicate();z.collapse(J);for(var s=z.parentElement(),c=s.childNodes,h,l=0;l<c.length;l++){var v=c[l];if(v.nodeType==j.e){h=z.duplicate();h.moveToElementText(v);v=h.compareEndPoints("StartToStart",
z);var m=h.compareEndPoints("EndToStart",z);h.collapse();if(v>0)break;else if(!v||m==1&&v==-1)return{xa:s,offset:l};else if(!m)return{xa:s,offset:l+1};h=t}}if(!h){h=z.duplicate();h.moveToElementText(s);h.collapse(A)}h.setEndPoint("StartToStart",z);h=String(h.text).replace(/\r\n|\r/g,"\n").length;try{for(;h>0;)h-=c[--l].nodeValue.length}catch(D){h=0}return h===0?{xa:s,offset:l}:{xa:c[l],offset:-h}}return function(){var z=this.c.M;if(z.na)return z.na;var J=this.z(),s=J&&J.createRange(),c=this.pb();
if(!J)return[];if(c==i.pa){J=new g(this.document);c=x(s,C);J.setStart(new d(c.xa),c.offset);c=x(s);J.setEnd(new d(c.xa),c.offset);return z.na=[J]}else if(c==i.ab){z=z.na=[];for(c=0;c<s.length;c++){var h=s.item(c),l=h.parentNode,v=0;for(J=new g(this.document);v<l.childNodes.length&&l.childNodes[v]!=h;v++);J.setStart(new d(l),v);J.setEnd(new d(l),v+1);z.push(J)}return z}return z.na=[]}}():function(){var x=this.c.M;if(x.na)return x.na;var z=[],J=this.z();if(!J)return[];for(var s=0;s<J.rangeCount;s++){var c=
J.getRangeAt(s),h=new g(this.document);h.setStart(new d(c.startContainer),c.startOffset);h.setEnd(new d(c.endContainer),c.endOffset);z.push(h)}return x.na=z},ob:function(){var x=this.c.M;if(x.Wd!==undefined)return x.Wd;var z,J=this.z();switch(this.pb()){case i.ab:return this.mc();case i.pa:var s=this.H()[0];if(s)if(!s.collapsed){for(s.vc();C;){z=s.startContainer;if(s.startOffset==(z[0].nodeType===j.e?z[0].childNodes.length:z[0].nodeValue.length)&&!z.qa())s.setStartAfter(z);else break}z=s.startContainer;
if(z[0].nodeType!=j.e)return z.parent();z=new d(z[0].childNodes[s.startOffset]);if(!z[0]||z[0].nodeType!=j.e)return s.startContainer;for(s=z[0].firstChild;s&&s.nodeType==j.e;){z=new d(s);s=s.firstChild}return z}if(a){s=J.createRange();s.collapse(C);z=s.parentElement()}else if((z=J.anchorNode)&&z.nodeType!=j.e)z=z.parentNode}return x.Wd=z?e.C(z):t},mc:function(){var x=this,z,J=x.c.M;if(J.Ud!==undefined)return J.Ud;if(a){z=x.z().createRange();z=z.item&&z.item(0)}z||(z=function(){for(var s=x.H()[0],
c,h,l=2;l&&!((c=s.yd())&&c[0].nodeType==j.e&&o[c.d()]&&(h=c));l--)s.Ta(u.fa);return h&&h[0]}());return J.Ud=e.C(z)},reset:function(){this.c.M={}},Ac:function(x){var z,J=this.document;if(a)try{z=J.body.createControlRange();z.addElement(x[0]);z.select()}catch(s){z=J.body.createTextRange();z.moveToElementText(x[0]);z.select()}finally{}else{z=J.createRange();z.selectNode(x[0]);x=this.z();x.removeAllRanges();x.addRange(z)}this.reset()},Ab:function(x){if(a){if(x.length>1){var z=x[x.length-1];x[0].setEnd(z.endContainer,
z.endOffset);x.length=1}x[0]&&x[0].select()}else{z=this.z();if(!z)return;z.removeAllRanges();for(var J=0;J<x.length;J++){var s=x[J],c=this.document.createRange(),h=s.startContainer;s.collapsed&&n.gecko&&n.gecko<1.09&&h[0].nodeType==j.e&&!h[0].childNodes.length&&h[0].appendChild(this.document.createTextNode(""));c.setStart(h[0],s.startOffset);c.setEnd(s.endContainer[0],s.endOffset);z.addRange(c)}}this.reset()},Ye:function(x){for(var z=[],J=this.H(),s=0;s<J.length;s++)z.push(J[s].nd(x));return z},Xe:function(x,
z){var J=[],s=this.document,c;z=z||this.H();for(var h=z.length,l=0;l<h;l++){J.push(c=z[l].O(x,C));var v=(x=c.Vd)?q.one("#"+c.ba,s):c.ba;c=x?q.one("#"+c.Q,s):c.Q;for(var m=l+1;m<h;m++){var D=z[m],P=D.startContainer,O=D.endContainer;e.g(P,v.parent())&&D.startOffset++;e.g(P,c.parent())&&D.startOffset++;e.g(O,v.parent())&&D.endOffset++;e.g(O,c.parent())&&D.endOffset++}}return J},Td:function(x){for(var z=[],J=0;J<x.length;J++){var s=new g(this.document);s.moveToBookmark(x[J]);z.push(s)}this.Ab(z);return this},
Aa:function(){var x=this.H();return x[0].startContainer.Pb(x[x.length-1].endContainer)},scrollIntoView:function(){var x=this.ob();x&&x.Vb()},removeAllRanges:function(){var x=this.z();if(a)x&&x.clear();else x&&x.removeAllRanges()}});var B={table:1,tbody:1,tr:1},y=b.Va(C),r=/\ufeff|\u00a0/;g.prototype.select=g.prototype.select=!a?function(){var x=this.startContainer;this.collapsed&&x[0].nodeType==j.e&&!x[0].childNodes.length&&x[0].appendChild(this.document.createTextNode(""));var z=this.document.createRange();
z.setStart(x[0],this.startOffset);try{z.setEnd(this.endContainer[0],this.endOffset)}catch(J){if(J.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(C);z.setEnd(this.endContainer[0],this.endOffset)}else throw J;}x=p(this.document).z();x.removeAllRanges();x.addRange(z)}:function(x){var z=this.collapsed,J,s;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var c=this.startContainer[0].childNodes[this.startOffset];if(c.nodeType==j.e){(new w(this.document)).Ac(new d(c));
return}}if(this.startContainer[0].nodeType==j.e&&this.startContainer.d()in B||this.endContainer[0].nodeType==j.e&&this.endContainer.d()in B)this.Ta(u.fa,C);var h=this.O();c=h.ba;var l;if(!z)l=h.Q;h=this.document.body.createTextRange();h.moveToElementText(c[0]);h.moveStart("character",1);if(l){x=this.document.body.createTextRange();x.moveToElementText(l[0]);h.setEndPoint("EndToEnd",x);h.moveEnd("character",-1)}else{for(J=c[0].nextSibling;J&&!y(J);)J=J.nextSibling;J=!(J&&J.nodeValue&&J.nodeValue.match(r))&&
(x||!c[0].previousSibling||c[0].previousSibling&&e.d(c[0].previousSibling)=="br");s=new d(this.document.createElement("span"));s.html("&#65279;");s.insertBefore(c);J&&e.insertBefore(this.document.createTextNode("\ufeff"),c)}this.setStartBefore(c);c.j();if(z){if(J){h.moveStart("character",-1);h.select();this.document.selection.clear()}else h.select();if(s){this.G(s,u.B);s.j()}}else{this.setEndBefore(l);l.j();h.select()}};w.getSelection=p;k.Nc=w;k.Selection=w;b=w.prototype;k.k.o(b,{getNative:b.z,getType:b.pb,
getRanges:b.H,getStartElement:b.ob,getSelectedElement:b.mc,reset:b.reset,selectElement:b.Ac,selectRanges:b.Ab,createBookmarks2:b.Ye,createBookmarks:b.Xe,getCommonAncestor:b.Aa,scrollIntoView:b.scrollIntoView,selectBookmarks:b.Td,removeAllRanges:b.removeAllRanges});k.on("instanceCreated",function(x){I(x.cf)})});
KISSY.Editor.add("styles",function(k){function w(F){return!F.attr("_ke_bookmark")}function p(F,K){for(var E in F)if(F.hasOwnProperty(E))if(J.isString(F[E]))F[E]=F[E].replace(aa,function(H,G){return K[G]});else p(F[E],K)}function I(F,K){if(K){F=J.clone(F);p(F,K)}var E=this.element=this.element=(F.element||"*").toLowerCase();this.type=this.type=E=="#"||W[E]?h.Lb:S[E]?h.cb:h.Ha;this.c={definition:F}}function C(F,K){var E=K?this.zc:this.Xb;F.body.focus();for(var H=new v(F),G=H.H(),M=0;M<G.length;M++)E.call(this,
G[M]);H.Ab(G)}function A(F,K,E){var H=F.element;if(H=="*")H="span";K=new O(K.createElement(H));E&&E.Qc(K);return t(K,F)}function t(F,K){var E=K.c.definition,H=E.attributes;E=I.zd(E);if(H)for(var G in H)F.attr(G,H[G]);if(E)F[0].style.cssText=E;return F}function q(F){var K=F.O(r),E=F.Ze();E.gc=r;E.sd=r;for(var H,G=F.document;H=E.lf();){var M=A(this,G,H);H=H;var L=M;M=L.d=="pre";var R=H.d=="pre",U=!M&&R;if(M&&!R){R=H;L=L;U=R.html();U=n(U,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");U=U.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,
"$1");U=U.replace(/([ \t\n\r]+|&nbsp;)/g," ");U=U.replace(/<br\b[^>]*>/gi,"\n");if(Q.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(L[0]);L[0].outerHTML="<pre>"+U+"</pre>";L=new O(R.firstChild);L.j()}else L.html(U);L=L}else if(U)L=f(e(H),L);else H.Tb(L);H[0].parentNode.replaceChild(L[0],H[0]);if(M){H=L;M=void 0;if((M=H.ha(r,m.e))&&M.d()=="pre"){L=n(M.html(),/\n$/,"")+"\n\n"+n(H.html(),/^\n/,"");if(Q.ie)H[0].outerHTML="<pre>"+L+"</pre>";else H.html(L);M.j()}}}F.moveToBookmark(K)}function n(F,
K,E){var H="",G="";F=F.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(M,L,R){L&&(H=L);R&&(G=R);return""});return H+F.replace(K,E)+G}function e(F){var K=[];n(F.fb(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(E,H,G){return H+"</pre>"+G+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(E,H){K.push(H)});return K}function f(F,K){for(var E=K[0].ownerDocument.createDocumentFragment(),H=0;H<F.length;H++){var G=F[H];G=G.replace(/(\r\n|\r)/g,
"\n");G=n(G,/^[ \t]*\n/,"");G=n(G,/\n$/,"");G=n(G,/^[ \t]+|[ \t]+$/g,function(L,R){return L.length==1?"&nbsp;":R?" "+Array(L.length).join("&nbsp;"):Array(L.length).join("&nbsp;")+" "});G=G.replace(/\n/g,"<br>");G=G.replace(/[ \t]{2,}/g,function(L){return Array(L.length).join("&nbsp;")+" "});var M=K.K();M.html(G);E.appendChild(M[0])}return E}function d(F){var K=F.document;if(F.collapsed){K=A(this,K,undefined);F.insertNode(K);F.G(K,l.J)}else{var E=this.element,H=this.c.definition,G,M=k.m[E]||(G=r,k.m.span),
L=F.O();F.Oa(l.Ib);F.trim();var R=F.O(),U=R.ba;R=R.Q;for(var $=U,da;$&&$[0];){var Z=x;if(c.g($,R)){$=z;Z=r}else{var ba=$[0].nodeType,fa=ba==m.e?$.d():z;if(fa&&$.attr("_ke_bookmark")){$=$.v(r);continue}if(!fa||M[fa]&&($.La(R)|D.aa|D.ea|D.$)==D.aa+D.ea+D.$&&(!H.childRule||H.childRule($))){var ha=$.parent();if(ha&&ha[0]&&((k.m[ha.d()]||k.m.span)[E]||G)&&(!H.parentRule||H.parentRule(ha))){if(!da&&(!fa||!k.m.ca[fa]||($.La(R)|D.aa|D.ea|D.$)==D.aa+D.ea+D.$)){da=new P(K);da.setStartBefore($)}if(ba==m.f||
ba==m.e&&!$[0].childNodes.length){ba=$;for(var ga;(Z=!ba.Ka(w))&&(ga=ba.parent(),M[ga.d()])&&(ga.La(U)|D.da|D.ea|D.$)==D.da+D.ea+D.$&&(!H.childRule||H.childRule(ga));)ba=ga;da.setEndAfter(ba)}}else Z=r}else Z=r;$=$.v()}if(Z&&da&&!da.collapsed){Z=A(this,K,undefined);ba=da.Aa();fa={Lf:{},Oe:{},gd:{},fd:{}};for(var ea,ia,ja;Z&&ba&&Z[0]&&ba[0];){if(ba.d()==E){for(ea in H.attributes)if(!(fa.fd[ea]||!(ja=ba.attr(ia))))if(Z.attr(ea)==ja)Z.removeAttr(ea);else fa.fd[ea]=1;for(ia in H.styles)if(!(fa.gd[ia]||
!(ja=ba.L(ia))))if(Z.L(ia)==ja)Z.L(ia,"");else fa.gd[ia]=1;if(!Z.eb()){Z=z;break}}ba=ba.parent()}if(Z){Z[0].appendChild(da.extractContents());o(this,Z);da.insertNode(Z);Z.ra();Q.ie||Z[0].normalize()}else{Z=new O(K.createElement("span"));Z[0].appendChild(da.extractContents());da.insertNode(Z);o(this,Z);Z.j(T)}da=z}}U.j();R.j();F.moveToBookmark(L);F.Ta(l.Lc)}}function i(F){F.Oa(l.Ib);var K=F.O(),E=K.ba;if(F.collapsed){for(var H=new N(E.parent()),G,M=0,L;M<H.elements.length&&(L=H.elements[M]);M++){if(L==
H.w||L==H.D)break;if(this.ja(L)){var R=F.dc(L,l.de),U=!R&&F.dc(L,l.bb);if(U||R){G=L;G.match=U?"start":"end"}else{L.ra();if(L.d()!=this.element){R=a(this);B(L,R[L.d()]||R["*"])}else b(this,L)}}}if(G&&G[0]){L=E;for(M=0;;M++){R=H.elements[M];if(c.g(R,G))break;else if(R.match)continue;else R=R.K();R[0].appendChild(L[0]);L=R}c[G.match=="start"?"insertBefore":"insertAfter"](L,G)}}else{var $=K.Q,da=this;H=function(){for(var Z=new N(E.parent()),ba=new N($.parent()),fa=z,ha=z,ga=0;ga<Z.elements.length;ga++){var ea=
Z.elements[ga];if(ea==Z.w||ea==Z.D)break;if(da.ja(ea))fa=ea}for(ga=0;ga<ba.elements.length;ga++){ea=ba.elements[ga];if(ea==ba.w||ea==ba.D)break;if(da.ja(ea))ha=ea}ha&&$.Ob(ha);fa&&E.Ob(fa)};H();for(G=new O(E[0].nextSibling);G[0]!==$[0];){M=G.v();if(G[0]&&G[0].nodeType==m.e&&this.ja(G)){if(G.d()==this.element)b(this,G);else{L=a(this);B(G,L[G.d()]||L["*"])}if(M[0].nodeType==m.e&&M.contains(E)){H();M=new O(E[0].nextSibling)}}G=M}}F.moveToBookmark(K)}function u(F){F=String(F);var K={};F.replace(/&quot;/g,
'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(E,H,G){K[H]=G});return K}function j(F,K){var E="";if(K!==x){E=document.createElement("span");E.style.cssText=F;E=E.style.cssText||""}else E=F;return E.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function a(F){if(F.c.Sd)return F.c.Sd;var K=F.c.Sd={},E=F.c.definition.overrides;if(E){J.isArray(E)||(E=[E]);for(var H=0;H<E.length;H++){var G=E[H],M,L,R;if(typeof G=="string")M=G.toLowerCase();else{M=
G.element?G.element.toLowerCase():F.element;L=G.attributes;R=G.styles}G=K[M]||(K[M]={});if(L){M=G.attributes=G.attributes||[];for(var U in L)L.hasOwnProperty(U)&&M.push([U.toLowerCase(),L[U]])}if(R){G=G.styles=G.styles||[];for(var $ in R)R.hasOwnProperty($)&&G.push([$.toLowerCase(),R[$]])}}}return K}function b(F,K){var E=F.c.definition,H=a(F),G=s.mix(E.attributes,(H[K.d()]||H["*"]||{}).attributes);E=s.mix(E.styles,(H[K.d()]||H["*"]||{}).styles);H=J.isEmptyObject(G)&&J.isEmptyObject(E);for(var M in G)if(G.hasOwnProperty(M))if(!((M==
"class"||F.c.definition.fullMatch)&&K.attr(M)!=g(M,G[M]))){H=H||!!K.Rb(M);K.removeAttr(M)}for(var L in E)if(E.hasOwnProperty(L))if(!(F.c.definition.fullMatch&&K.L(L)!=g(L,E[L],r))){H=H||!!K.L(L);K.L(L,"")}y(K)}function g(F,K,E){var H=new O("<span>");H[E?"_4e_style":"attr"](F,K);return H[E?"_4e_style":"attr"](F)}function o(F,K){for(var E=a(F),H=K.all(F.element),G=H.length;--G>=0;)b(F,new O(H[G]));for(var M in E)if(M!=F.element){H=K.all(M);for(G=H.length-1;G>=0;G--){var L=new O(H[G]);B(L,E[M])}}}function B(F,
K){var E,H=K&&K.attributes;if(H)for(E=0;E<H.length;E++){var G=H[E][0],M;if(M=F.attr(G)){var L=H[E][1];if(L===z||L.test&&L.test(M)||typeof L=="string"&&M==L)F[0].removeAttribute(G)}}if(H=K&&K.styles)for(E=0;E<H.length;E++){G=H[E][0];if(L=F.css(G)){var R=H[E][1];if(R===z||R.test&&R.test(M)||typeof R=="string"&&L==R)F.css(G,"")}}y(F)}function y(F){if(!F.eb()){var K=F[0].firstChild,E=F[0].lastChild;F.j(r);if(K){K.nodeType==m.e&&c.ra(K);E&&K!=E&&E.nodeType==m.e&&c.ra(E)}}}var r=T,x=Y,z=V,J=KISSY,s=k.k,
c=J.DOM,h={Lb:1,Ha:2,cb:3},l=k.oa,v=k.Nc,m=k.n,D=k.$a,P=k.Range,O=J.Node,Q=J.UA,N=k.Za,W={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},S={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},X=/\s*(?:;\s*|$)/g,aa=/#\((.+?)\)/g;k.lg=h;I.prototype={apply:function(F){C.call(this,F,x)},remove:function(F){C.call(this,F,r)},Xb:function(F){return(this.Xb=this.type==h.Ha?d:this.type==h.Lb?q:this.type==h.cb?z:z).call(this,F)},zc:function(F){return(this.zc=this.type==
h.Ha?i:z).call(this,F)},Le:function(F){t(F,this)},ja:function(F,K){if(!F)return x;var E=this.c.definition,H;if(F.d()==this.element){if(!K&&!F.eb())return r;var G=E.se;if(G)E=G;else{G={};var M=0,L=E.attributes;if(L)for(var R in L){M++;G[R]=L[R]}if(L=I.zd(E)){G.style||M++;G.style=L}G._length=M;E=E.se=G}if(E._length){for(var U in E)if(U!="_length"){M=F.attr(U)||"";if(U=="style")a:{G=E[U];M=j(M,x);typeof G=="string"&&(G=u(G));typeof M=="string"&&(M=u(M));L=void 0;for(L in G)if(!(L in M&&(M[L]==G[L]||
G[L]=="inherit"||M[L]=="inherit"))){G=x;break a}G=r}else G=E[U]==M;if(G){if(!K)return r}else if(K)return x}if(K)return r}else return r}U=a(this);if(U=U[F.d()]||U["*"]){if(!(E=U.attributes)&&!(H=U.Lf))return r;if(E)for(G=0;G<E.length;G++){U=E[G][0];if(U=F.attr(U)){M=E[G][1];if(M===z||typeof M=="string"&&U==M||M.test&&M.test(U))return r}}if(H)for(G=0;G<H.length;G++)if(U=F.css(H[G][0])){E=H[G][1];if(E===z||typeof E=="string"&&U==E||E.test&&E.test(U))return r}}return x},Te:function(F){switch(this.type){case h.Lb:return this.ja(F.w||
F.D,r);case h.cb:case h.Ha:for(var K=F.elements,E=0,H;E<K.length;E++){H=K[E];if(!(this.type==h.Ha&&(c.g(H,F.w)||c.g(H,F.D))))if(!(this.type==h.cb&&!(H.d()in S)))if(this.ja(H,r))return r}}return x}};I.zd=function(F){var K=F.te;if(K)return K;K=F.styles;var E=F.attributes&&F.attributes.style||"",H="";if(E.length)E=E.replace(X,";");for(var G in K){var M=K[G],L=(G+":"+M).replace(X,";");if(M=="inherit")H+=L;else E+=L}if(E.length)E=j(E);E+=H;return F.te=E};k.mg=I;k.Style=I;var ca=I.prototype;k.k.o(ca,{apply:ca.apply,
remove:ca.remove,applyToRange:ca.Xb,removeFromRange:ca.zc,applyToObject:ca.Le,checkElementRemovable:ca.ja,checkActive:ca.Te})});
KISSY.Editor.add("htmlparser",function(){function k(){}function w(){this.c={Cd:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var p=KISSY,I=p.Editor,C=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,A={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},t=I.m;p.augment(w,{Da:k,Rd:k,ma:k,Nd:k,Ra:k,parse:function(q){for(var n,
e,f=0,d;n=this.c.Cd.exec(q);){e=n.index;if(e>f){f=q.substring(f,e);d?d.push(f):this.ma(f)}f=this.c.Cd.lastIndex;if(e=n[1]){e=e.toLowerCase();if(d&&t.Fc[e]){this.Nd(d.join(""));d=V}if(!d){this.Rd(e);continue}}if(d)d.push(n[0]);else if(e=n[3]){e=e.toLowerCase();if(!/="/.test(e)){var i={},u;n=n[4];var j=!!(n&&n.charAt(n.length-1)=="/");if(n)for(;u=C.exec(n);){var a=u[1].toLowerCase();u=u[2]||u[3]||u[4]||"";i[a]=!u&&A[a]?a:u}this.Da(e,i,j);if(!d&&t.Fc[e])d=[]}}else if(e=n[2])this.Ra(e)}q.length>f&&this.ma(q.substring(f,
q.length))}});I.h=w;I.HtmlParser=w});
KISSY.Editor.add("htmlparser-basicwriter",function(){function k(){this.c={l:[]}}var w=KISSY,p=w.Editor,I=p.k;w.augment(k,{vb:function(C){this.c.l.push("<",C)},wb:function(C,A){A?this.c.l.push(" />"):this.c.l.push(">")},kb:function(C,A){if(typeof A=="string")A=I.pc(A);this.c.l.push(" ",C,'="',A,'"')},lb:function(C){this.c.l.push("</",C,">")},text:function(C){this.c.l.push(C)},N:function(C){this.c.l.push("<!--",C,"--\>")},write:function(C){this.c.l.push(C)},reset:function(){this.c.l=[];this.c.A=Y},
kc:function(C){var A=this.c.l.join("");C&&this.reset();return A}});p.h.Gb=k;p.h.BasicWriter=k;w=k.prototype;p.k.o(w,{openTag:w.vb,openTagClose:w.wb,attribute:w.kb,closeTag:w.lb,text:w.text,comment:w.N,write:w.write,reset:w.reset,getHtml:w.kc})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function k(){k.superclass.constructor.call(this);this.Dd="\t";this.Gf=" />";this.xf="\n";this.gf=A;this.Hf=C;this.c.A=A;this.c.F="";this.c.rules={};var t=p.m,q;for(q in I.mix({},t.Fb,t.Xa,t.Eb,t.Ic))this.Fa(q,{A:C,Qe:C,cc:C,hd:!t[q]["#"],Pe:C});this.Fa("br",{cc:C});this.Fa("title",{A:A,cc:A});this.Fa("style",{A:A,hd:C});this.Fa("pre",{A:A})}var w=KISSY,p=w.Editor,I=p.k,C=T,A=Y;w.extend(k,p.h.Gb,{vb:function(t){var q=this.c.rules[t];if(this.c.A)this.F();
else if(q&&q.Qe){this.Pa();this.F()}this.c.l.push("<",t)},wb:function(t,q){var n=this.c.rules[t];if(q)this.c.l.push(this.Gf);else{this.c.l.push(">");if(n&&n.A)this.c.F+=this.Dd}n&&n.cc&&this.Pa()},kb:function(t,q){if(typeof q=="string"){this.gf&&(q=q.replace(/&amp;/g,"&"));q=I.pc(q)}this.c.l.push(" ",t,'="',q,'"')},lb:function(t){var q=this.c.rules[t];if(q&&q.A)this.c.F=this.c.F.substr(this.Dd.length);if(this.c.A)this.F();else if(q&&q.hd){this.Pa();this.F()}this.c.l.push("</",t,">");q&&q.Pe&&this.Pa()},
text:function(t){if(this.c.A){this.F();t=I.Qa(t)}this.c.l.push(t)},N:function(t){this.c.A&&this.F();this.c.l.push("<!--",t,"--\>")},Pa:function(){this.c.l.length>0&&this.c.l.push(this.xf);this.c.A=C},F:function(){this.c.l.push(this.c.F);this.c.A=A},Fa:function(t,q){var n=this.c.rules[t];if(n)I.mix(n,q);else this.c.rules[t]=q}});p.h.$f=k;p.h.HtmlWriter=k;w=k.prototype;p.k.o(w,{openTag:w.vb,openTagClose:w.wb,attribute:w.kb,closeTag:w.lb,text:w.text,comment:w.N,lineBreak:w.Pa,indentation:w.F,setRules:w.Fa})});
KISSY.Editor.add("htmlparser-fragment",function(){function k(){this.children=[];this.parent=I;this.c={S:w,oc:p}}var w=T,p=Y,I=V,C=KISSY.Editor,A={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},t=KISSY,q=C.k,n=C.n,e=C.m;q.mix({table:1,ul:1,ol:1,dl:1},e.table,e.ul,e.ol,e.dl);var f=e.$d,d=e.Eb;k.Jb=function(i,u){function j(c){var h;if(B.length>0)for(var l=0;l<B.length;l++){var v=B[l],m=v.name,D=e[m],P=r.name&&e[r.name];if((!P||P[m])&&(!c||!D||D[c]||!e[c])){if(!h){a();h=1}v=v.clone();
v.parent=r;r=v;B.splice(l,1);l--}}}function a(){for(;y.length;)r.add(y.shift())}function b(c,h,l){h=h||r||o;if(u&&!h.type){var v,m;if((v=c.attributes&&(m=c.attributes._ke_real_element_type)?m:c.name)&&!(v in e.Ec)&&!(v in e.Fb)){m=r;r=h;g.Da({Zg:"ul",Qg:"dl",Kg:"dl"}[v]||u,{});h=r;if(l)r=m}}if(c.c.S&&c.name!="pre"){l=c.children.length;if((v=c.children[l-1])&&v.type==n.f)if(m=q.Sa(v.value))v.value=m;else c.children.length=l-1}h.add(c);if(c.yb){r=c.yb;delete c.yb}}var g=new C.h,o=new k,B=[],y=[],r=
o,x=p,z;g.Da=function(c,h,l){var v=new C.h.Jc(c,h);if(v.rc&&l)v.rb=w;if(e.ca[c])B.push(v);else{if(c==="pre")x=w;else if(c==="br"&&x){r.add(new C.h.Mb("\n"));return}if(c==="br")y.push(v);else{var m=r.name,D=m&&(e[m]||(r.c.S?e.div:e.span));if(D&&!v.rc&&!r.rc&&!D[c]){D=p;var P;if(c in f&&m in f){m=r.children;(m=m[m.length-1])&&m.name in d||b(m=new C.h.Jc("li"),r);z=r;P=m}else if(c==m)b(r,r.parent);else{b(r,r.parent,w);!A[m]&&m in e.Db&&B.unshift(r);D=w}r=P?P:r.yb||r.parent;if(D){g.Da.apply(this,arguments);
return}}j(c);a();v.parent=r;v.yb=z;z=0;if(v.rb)b(v);else r=v}}};g.Rd=function(c){for(var h=B.length-1;h>=0;h--)if(c==B[h].name){B.splice(h,1);return}for(var l=[],v=[],m=r;m.type&&m.name!=c;){m.c.S||v.unshift(m);l.push(m);m=m.parent}if(m.type){for(h=0;h<l.length;h++){var D=l[h];b(D,D.parent)}r=m;if(r.name=="pre")x=p;m.c.S&&a();b(m,m.parent);if(m==r)r=r.parent;B=B.concat(v)}if(c=="body")u=p};g.ma=function(c){if(!r.c.oc&&!x){c=q.Qa(c);if(c.length===0)return}a();j();if(u&&(!r.type||r.name=="body")&&q.trim(c))this.Da(u,
{});x||(c=c.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));r.add(new C.h.Mb(c))};g.Nd=function(c){r.add(new C.h.jd(c))};g.Ra=function(c){r.add(new C.h.be(c))};g.parse(i);for(a();r.type;){var J=r.parent,s=r;if(u&&(!J.type||J.name=="body")&&!e.Ec[s.name]){r=J;g.Da(u,{});J=r}J.add(s);r=J}return o};t.augment(k,{add:function(i){var u=this.children.length;if(u=u>0&&this.children[u-1]||I){if(i.c.S&&u.type==n.f){u.value=q.Sa(u.value);if(u.value.length===0){this.children.pop();this.add(i);return}}u.next=i}i.xb=u;
i.parent=this;this.children.push(i);this.c.oc=i.type==n.f||i.type==n.e&&!i.c.S},Y:function(i,u){var j;this.filterChildren=this.ic=function(){var a=new C.h.Gb;this.X.call(this,a,u,w);a=a.kc();this.children=(new k.Jb(a)).children;j=1};!this.name&&u&&u.Pd(this);this.X(i,j?I:u)},X:function(i,u){for(var j=0;j<this.children.length;j++)this.children[j].Y(i,u)}});C.h.Ga=k;C.h.Fragment=k;k.FromHtml=k.Jb;t=k.prototype;C.k.o(t,{add:t.add,writeHtml:t.Y,writeChildrenHtml:t.X})});
KISSY.Editor.add("htmlparser-element",function(){function k(A,t){A=A[0];t=t[0];return A<t?-1:A>t?1:0}function w(A,t){this.name=A;this.attributes=t||(t={});this.children=[];var q=t.sg||A,n=p.m;q=!!(n.Fb[q]||n.Xa[q]||n.Eb[q]||n.Ic[q]||n.Hc[q]||q=="br");var e=!!n.Cb[A];this.rb=e;this.rc=!n[A];this.c={S:q,oc:e||!q}}var p=KISSY.Editor,I=p.n;KISSY.augment(w,{type:I.e,add:p.h.Ga.prototype.add,clone:function(){return new w(this.name,this.attributes)},Y:function(A,t){var q=this.attributes,n=this,e=n.name,
f,d,i,u;n.ic=function(){if(!u){var b=new p.h.Gb;p.h.Ga.prototype.X.call(n,b,t);n.children=(new p.h.Ga.Jb(b.kc())).children;u=1}};n.filterChildren=n.ic;if(t){for(;;){if(!(e=t.Od(e)))return;n.name=e;if(!(n=t.uc(n)))return;n.parent=this.parent;if(n.name==e)break;if(n.type!=I.e){n.Y(A,t);return}e=n.name;if(!e){this.X.call(n,A,u?V:t);return}}q=n.attributes}A.vb(e,q);for(var j=[],a=0;a<2;a++)for(f in q){d=f;i=q[f];if(a==1)j.push([f,i]);else if(t){for(;;)if(d=t.Md(f))if(d!=f){delete q[f];f=d}else break;
else{delete q[f];break}if(d)if((i=t.Ld(n,d,i))===Y)delete q[d];else q[d]=i}}A.Hf&&j.sort(k);q=j.length;for(a=0;a<q;a++){f=j[a];A.kb(f[0],f[1])}A.wb(e,n.rb);if(!n.rb){this.X.call(n,A,u?V:t);A.lb(e)}},X:function(){p.h.Ga.prototype.X.apply(this,arguments)}});p.h.Jc=w;p.h.Element=w;var C=w.prototype;p.k.o(C,{type:C.type,add:C.add,clone:C.clone,writeHtml:C.Y,writeChildrenHtml:C.X})});
KISSY.Editor.add("htmlparser-filter",function(){function k(f){this.c={fc:[],Zb:[],elements:{Gc:0},attributes:{Gc:0}};f&&this.ed(f,10)}function w(f,d){for(var i=0;f&&i<d.length;i++){var u=d[i];f=f.replace(u[0],u[1])}return f}function p(f,d,i){if(typeof d=="function")d=[d];var u,j;j=f.length;var a=d&&d.length;if(a){for(u=0;u<j&&f[u].yc<i;u++);for(j=a-1;j>=0;j--)if(a=d[j]){a.yc=i;f.splice(u,0,a)}}}function I(f,d,i){if(d)for(var u in d){var j=f[u];f[u]=C(j,d[u],i);j||f.Gc++}}function C(f,d,i){if(d){d.yc=
i;if(f){if(f.splice)p(f,d,i);else{f=f.yc>i?[d,f]:[f,d];f.filter=A}return f}else return d.filter=d}}function A(f){for(var d=f.type||f instanceof q.h.Ga,i=0;i<this.length;i++){if(d)var u=f.type,j=f.name;var a=this[i].apply(window,arguments);if(a===e)return a;if(d){if(a&&(a.name!=j||a.type!=u))return a}else if(typeof a!="string")return a;a!=undefined&&(f=a)}return f}var t=KISSY,q=t.Editor,n=q.n,e=Y;t.augment(k,{ed:function(f,d){if(typeof d!="number")d=10;p(this.c.fc,f.fc,d);p(this.c.Zb,f.Zb,d);I(this.c.elements,
f.elements,d);I(this.c.attributes,f.attributes,d);this.c.text=C(this.c.text,f.text,d)||this.c.text;this.c.N=C(this.c.N,f.N,d)||this.c.N;this.c.zb=C(this.c.zb,f.zb,d)||this.c.zb},Od:function(f){return w(f,this.c.fc)},Md:function(f){return w(f,this.c.Zb)},ma:function(f){var d=this.c.text;return d?d.filter(f):f},Ra:function(f,d){var i=this.c.N;return i?i.filter(f,d):f},Pd:function(f){var d=this.c.zb;return d?d.filter(f):f},uc:function(f){for(var d=[this.c.elements["^"],this.c.elements[f.name],this.c.elements.Rf],
i,u=0;u<3;u++)if(i=d[u]){i=i.filter(f,this);if(i===e)return V;if(i&&i!=f)return this.Qd(i);if(f.parent&&!f.name)break}return f},Qd:function(f){var d=f.type;return d==n.e?this.uc(f):d==n.f?new q.h.Mb(this.ma(f.value)):V},Ld:function(f,d,i){if(d=this.c.attributes[d]){f=d.filter(i,f,this);if(f===e)return e;if(typeof f!="undefined")return f}return i}});q.h.Zf=k;t=k.prototype;q.k.o(t,{addRules:t.ed,onElementName:t.Od,onAttributeName:t.Md,onText:t.ma,onComment:t.Ra,onFragment:t.Pd,onElement:t.uc,onNode:t.Qd,
onAttribute:t.Ld});q.h.Filter=k});KISSY.Editor.add("htmlparser-text",function(){function k(C){this.value=C;this.c={S:I}}var w=KISSY,p=w.Editor,I=Y;w.augment(k,{type:p.n.f,Y:function(C,A){var t=this.value;A&&!(t=A.ma(t,this))||C.text(t)}});p.h.Mb=k;p.h.Text=k});KISSY.Editor.add("htmlparser-cdata",function(k){k.h.jd=function(w){this.value=w};k.h.jd.prototype={type:k.n.f,Y:function(w){w.write(this.value)}}});
KISSY.Editor.add("htmlparser-comment",function(){function k(I){this.value=I;this.c={S:Y}}var w=KISSY.Editor,p=w.n;w.h.be=k;w.h.Comment=k;k.prototype={constructor:k,type:p.ee,Y:function(I,C){var A=this.value;if(C){if(!(A=C.Ra(A,this)))return;if(typeof A!="string"){A.parent=this.parent;A.Y(I,C);return}}I.N(A)}}});
KISSY.Editor.add("button",function(){var k=KISSY,w=k.Editor;if(w.le)k.log("TripleButton attach twice","warn");else{k=k.UIBase.create([k.UIBase.Box],{Fg:function(){var p=this,I=p.get("el");I.on("click",p.ve,p);I.on("mousedown",function(){p.get("state")=="off"&&I.addClass("ke-triplebutton-active")});I.on("mouseup mouseleave",function(){p.get("state")=="off"&&I.hasClass("ke-triplebutton-active")&&setTimeout(function(){I.removeClass("ke-triplebutton-active")},300)})},zg:function(){this.get("el").attr("title",
this.get("title"))},wg:function(p){var I=this.get("el");if(p!==undefined){I.html("<span class='ke-toolbar-item "+p+"'>");I.ta()}},yg:function(p){var I=this.get("el");p!==undefined&&I.html(p)},xg:function(p){this["_"+p]()},pd:function(){this.De=this.get("state");this.set("state","disabled")},rd:function(){this.get("state")=="disabled"&&this.set("state",this.De)},ve:function(p){this.fire(this.get("state")+"Click",{og:p});this.fire("click",{ng:this.get("state")+"Click"});p&&p.halt()},Hg:function(){this.set("state",
"on")},Gg:function(){this.set("state","off")},ug:function(){var p=this.get("el");p.removeClass("ke-triplebutton-off ke-triplebutton-disabled");p.addClass("ke-triplebutton-on")},tg:function(){var p=this.get("el");p.removeClass("ke-triplebutton-on ke-triplebutton-disabled");p.addClass("ke-triplebutton-off")},qg:function(){var p=this.get("el");p.removeClass("ke-triplebutton-off ke-triplebutton-on");p.addClass("ke-triplebutton-disabled")}},{ae:{Jf:{value:"off"},ef:{value:"ke-triplebutton ke-triplebutton-off"},
Rg:{value:{hideFocus:T,tabIndex:-1}},Sg:{value:"a"},title:{},Ig:{},text:{}}});k.gg="on";k.eg="off";k.ce="disabled";k.hg="ke-triplebutton-on";k.fg="ke-triplebutton-off";k.Xf="ke-triplebutton-disabled";w.le=k}});
KISSY.Editor.add("select",function(){function k(e){k.superclass.constructor.call(this,e);this.ye()}var w=KISSY,p=w.Node,I=w.Event,C=w.DOM,A=w.Editor;if(A.ke)w.log("ke select attach more");else{k.ce=0;k.Yf=1;var t=A.m;k.ae={hh:{},P:{},We:{},xa:{},Pg:{},value:{},width:{},title:{},vf:{},Ug:{},align:{value:["l","b"]},$g:{mh:function(){for(var e=this.P.parent();e;){var f=e.d();if(t[f]&&t[f].div)return e;e=e.parent()}return new p(document.body)}},Jf:{value:1}};k.Mg=function(e){for(var f=e.width(),d=[],
i=e.all("option"),u=0;u<i.length;u++){var j=i[u];d.push({name:C.html(j),value:C.attr(j,"value")})}return new k({width:f+"px",P:e,vf:d,We:"ke-combox",value:e.val()})};var q=A.k.Ke,n=A.k.$e;w.extend(k,w.Base,{ye:function(){var e=this.get("container"),f=this.get("el"),d=new p("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
i=this.get("title")||"",u=this.get("cls"),j=d.one(".ke-select-text"),a=d.one(".ke-select-text-inner");d.one(".ke-select-drop");this.get("value")!==undefined?a.html(this.Xc(this.get("value"))):a.html(i);j.css("width",this.get("width"));d.ta();i&&d.attr("title",i);u&&d.addClass(u);if(f)f[0].parentNode.replaceChild(d[0],f[0]);else e&&d.appendTo(e);d.on("click",this.xe,this);this.P=d;this.title=a;this.Yc=d.one("a.ke-select");A.k.Id(this,"_prepare","_real");this.on("afterValueChange",this.Ge,this);this.on("afterStateChange",
this.Fe,this)},Xc:function(e){var f=this.get("title")||"",d=this.get("items");if(this.get("showValue"))return e||f;for(var i=0;i<d.length;i++){var u=d[i];if(u.value==e){f=u.name;break}}return f},Ge:function(e){this.title.html(this.Xc(e.tb))},Zc:function(e){var f;f=e.tb;e=this.bd;e.html("");if(f&&f.length)for(var d=0;d<f.length;d++){var i=f[d];(new p("<a class='ke-select-menu-item' href='#' data-value='"+i.value+"'>"+i.name+"</a>",i.Oe)).appendTo(e).ta()}else if(f=this.get("emptyText"))(new p("<a class='ke-select-menu-item' href='#'>"+
f+"</a>")).appendTo(e).ta();this.Yb=e.all("a")},val:function(e){if(e!==undefined){this.set("value",e);return this}else return this.get("value")},ad:function(){this.T.get("visible")&&this.Ce()},ze:function(){function e(b){b=new p(b.target);d.contains(b)||d.g(b)||j.hide()}var f=this,d=f.P,i=f.get("popUpWidth"),u=f.Yc,j=new A.fe({Dg:T,gh:f.get("menuContainer"),content:"<div>",Vg:Y,ef:"ke-menu",width:i?i:d.width(),zIndex:A.$b(A.Dc.he),Wg:Y}),a=f.get("items");q.call(f,j);i=j.get("contentEl").one("div");
f.T=j;I.on(window,"resize",f.ad,f);q.call(f,function(){I.remove(window,"resize",f.ad,f)});f.get("title")&&(new p("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+f.get("title")+"</div>")).appendTo(i);f.bd=(new p("<div>")).appendTo(i);f.Zc({tb:a});j.on("show",function(){u.addClass("ke-select-active")});j.on("hide",function(){u.removeClass("ke-select-active")});I.on(document,"click",e);q.call(f,function(){I.remove(document,"click",e)});f.get("doc")&&I.on(f.get("doc"),"click",
e);i.on("click",f.Ee,f);f.Yb=f.bd.all("a");I.on(i[0],"mouseenter",function(){f.Yb.removeClass("ke-menu-selected")});q.call(f,i);f.on("afterItemsChange",f.Zc,f);f.zf=i},Fe:function(e){var f=this.P;e.tb==1?f.removeClass("ke-select-disabled"):f.addClass("ke-select-disabled")},rd:function(){this.set("state",1)},pd:function(){this.set("state",0)},Ee:function(e){e&&e.halt();var f=this.T,d=this.zf;if((e=(new p(e.target)).Oc(function(j){return d.contains(j)&&j.d()=="a"},T))&&e.Rb("data-value")){var i=this.get("value"),
u=e.attr("data-value");this.set("value",u);this.fire("click",{tb:u,bh:i,name:e.html()});f.hide()}},Ce:function(){var e=this.P,f=e.offset(),d=w.clone(f),i=this.T.get("el").height(),u=this.T.get("el").width(),j=C.scrollTop(),a=C.scrollLeft(),b=C.viewportHeight(),g=C.viewportWidth();g=a+g-60;b=j+b;var o=f.top+(e.height()-2);e=f.left+e.width()-2;var B=this.get("align"),y=B[0];if(B[1]=="b"){f.top=o;if(f.top+i>b&&d.top-j>b-o)f.top=d.top-i}else{f.top=d.top-i;if(f.top<j&&d.top-j<b-o)f.top=o}if(y=="l"){if(f.left+
u>g&&e-a>g-d.left)f.left=e-u}else{f.left=e-u;if(f.left<a&&e-a<g-d.left)f.left=d.left}this.T.set("xy",[f.left,f.top]);this.T.show()},xe:function(e){if(!this.sc){e&&e.halt();var f=this;e=f.P;var d=f.get("value");if(!e.hasClass("ke-select-disabled"))if(f.Yc.hasClass("ke-select-active"))f.T&&f.T.hide();else{f.sc=T;A.use("overlay",function(){f.sc=Y;f.ze();d&&f.T&&f.Yb.each(function(i){i.attr("data-value")==d?i.addClass("ke-menu-selected"):i.removeClass("ke-menu-selected")})})}}},za:function(){n.call(this);
this.P.detach();this.P.remove()}});A.ke=k}});
