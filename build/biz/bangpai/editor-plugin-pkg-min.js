KISSY.Editor.add("bangpai-music",function(v){var j=KISSY,n=j.UA,t=j.Event,l=j.Editor,u=j.DOM,o=j.Node,w=l.Config.base+"theme/loading.gif",x=l.Flash,h="ke_xiami",i=v.htmlDataProcessor,a=i&&i.dataFilter;a&&a.addRules({elements:{object:function(d){var b=d.attributes,c=d.attributes.title,g;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<d.children.length;b++){g=d.children[b];if(g.name=="embed"){if(!x.isFlashEmbed(g))break;if(/xiami\.com/i.test(g.attributes.src))return i.createFakeParserElement(d,
h,"bangpai-music",true,{title:c})}}return null}for(b=0;b<d.children.length;b++){g=d.children[b];if(g.name=="param"&&g.attributes.name=="movie")if(/xiami\.com/i.test(g.attributes.value))return i.createFakeParserElement(d,h,"bangpai-music",true,{title:c})}},embed:function(d){if(!x.isFlashEmbed(d))return null;if(/xiami\.com/i.test(d.attributes.src))return i.createFakeParserElement(d,h,"bangpai-music",true,{title:d.attributes.title})}}},4);l.BangPaiMusic||function(){function d(f){d.superclass.constructor.apply(this,
arguments);f.cfg.disableObjectResizing||t.on(f.document.body,n.ie?"resizestart":"resize",function(e){u.hasClass(e.target,h)&&e.preventDefault()})}function b(f){return s.replace(/\${([^}]+)}/g,function(e,m){return f[m]})}function c(f,e,m){return"<a class='ke-xiami-page-item ke-button"+(f==e?" ke-xiami-curpage":"")+"' data-value='"+e+"' href='#'>"+(m||e)+"</a>"}function g(f){return f._4e_name()==="img"&&!!f.hasClass(h)&&f}u.addStyleSheet(".ke-xiami-list {margin:10px 0 10px 0;padding:10px 40px 0 40px;border-top:1px solid #CED5E0;display:none;}.ke-xiami-list li{border:1px solid #CED5E0;border-width:0 0 1px 0;overflow:hidden;zoom:1;padding:2px;}.ke-xiami-list .ke-xiami-add {float:right;}.ke-xiami-list .ke-xiami-song {float:left;width:300px;white-space:nowrap;overflow:hidden;}.ke-xiami-paging a{display: inline-block; zoom: 1;  *display: inline; padding:1px 7px;margin:0 3px;}.ke-xiami-paging a:hover,.ke-xiami-paging a.ke-xiami-curpage {color:red;text-decoration:none;}.ke-xiami-paging {text-align:center;margin:20px -10px 0 -10px;}.ke-xiami-page-more {padding:0 10px;}",
"BangPaiMusic");window.bangpai_xiami=function(f){var e=bangpai_xiami.instance;f.page=bangpai_xiami.page;e._listSearch(f)};var s="http://www.xiami.com/app/nineteen/search/key/${key}/page/${page}?random=${random}&callback=bangpai_xiami";j.extend(d,x,{_config:function(){this._cls=h;this._type="bangpai-music";this._title="\u867e\u7c73\u5c5e\u6027";this._bodyHtml="<div style='padding:20px 0;'><form action='#' class='ke-xiami-form' style='margin:0 20px;'><p class='ke-xiami-title'></p><p class='ke-xiami-url-wrap'><input class='ke-xiami-url ke-input' style='width:350px;vertical-align:middle;'/> &nbsp;  <button class='ke-xiami-submit'>\u641c \u7d22</button></p><p style='margin:10px 0'><label>\u5bf9 \u9f50\uff1a <select class='ke-xiami-align'><option value=''>\u65e0</option><option value='left'>\u5de6\u5bf9\u9f50</option><option value='right'>\u53f3\u5bf9\u9f50</option></select></label><label style='margin-left:45px;'>\u95f4\u8ddd\uff1a  <input  data-verify='^\\d+$'  data-warning='\u95f4\u8ddd\u8bf7\u8f93\u5165\u975e\u8d1f\u6574\u6570' class='ke-xiami-margin ke-input' style='width:60px' value='5'/> \u50cf\u7d20</label></p></form><div class='ke-xiami-list'></div></div>";
this._footHtml="<a class='ke-xiami-ok ke-button' style='margin-right:20px;'>\u786e&nbsp;\u5b9a</a><a class='ke-xiami-cancel ke-button'>\u53d6&nbsp;\u6d88</a>";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u867e\u7c73\u97f3\u4e50";this._contextMenu=y;this._flashRules=["img."+h];this._config_dwidth="480px"},_updateTip:function(f,e){var m=this.editor.restoreRealElement(e);if(m){f.html(e.attr("title"));f.attr("href",this._getFlashUrl(m))}},_initD:function(){function f(r){var q=p.val();if(q.replace(/[^\x00-\xff]/g,"@@").length>30)alert("\u957f\u5ea6\u4e0a\u965030\u4e2a\u5b57\u7b26\uff081\u4e2a\u6c49\u5b57=2\u4e2a\u5b57\u7b26\uff09");
else if(j.trim(q)){e._xiami_submit.disable();q={key:encodeURIComponent(p.val()),page:r,random:(new Date).valueOf()};q=b(q);bangpai_xiami.instance=e;bangpai_xiami.page=r;e._xiamia_list.html("<img style='display:block;width:32px;height:32px;margin:5px auto 0 auto;'src='"+w+"'/><p style='width: 130px; margin: 15px auto 0; color: rgb(150, 150, 150);'>\u6b63\u5728\u641c\u7d22\uff0c\u8bf7\u7a0d\u5019......</p>");e._xiamia_list.show();var B=j.getScript(q,{timeout:10,success:function(){},error:function(){B.src="";e._xiami_submit.enable();e._xiamia_list.html("<p style='text-align:center;margin:10px 0;'>\u4e0d\u597d\u610f\u601d\uff0c\u8d85\u65f6\u4e86\uff0c\u8bf7\u91cd\u8bd5\uff01</p>")}})}else alert("\u4e0d\u80fd\u4e3a\u7a7a\uff01")}
var e=this,m=e.editor,k=e.d;k.el.one(".ke-xiami-form");var p=k.el.one(".ke-xiami-url");e.dAlign=l.Select.decorate(k.el.one(".ke-xiami-align"));e._xiami_input=p;l.Utils.placeholder(p,"\u8f93\u5165\u6b4c\u66f2\u540d\u3001\u4e13\u8f91\u540d\u3001\u827a\u4eba\u540d");e._xiamia_list=k.el.one(".ke-xiami-list");e._xiami_submit=new l.TripleButton({el:k.el.one(".ke-xiami-submit"),cls:"ke-button",text:"\u641c&nbsp;\u7d22"});e._xiami_submit.on("offClick",function(){f(1)});p.on("keydown",function(r){r.keyCode===13&&f(1)});e.dMargin=k.el.one(".ke-xiami-margin");e._xiami_url_wrap=k.el.one(".ke-xiami-url-wrap");
e._xiamia_title=k.el.one(".ke-xiami-title");var z=k.foot.one(".ke-xiami-ok");k.foot.one(".ke-xiami-cancel").on("click",function(){k.hide()});z.on("click",function(){var r=e.selectedFlash,q=m.restoreRealElement(r);e._dinfo={url:e._getFlashUrl(q),attrs:{title:r.attr("title"),align:e.dAlign.val(),style:"margin:"+(parseInt(e.dMargin.val())||0)+"px;"}};e._gen()},e);e._xiamia_list.on("click",function(r){r.preventDefault();var q=new o(r.target);r=q._4e_ascendant(function(B){return e._xiamia_list._4e_contains(B)&&
B.hasClass("ke-xiami-add")},true);q=q._4e_ascendant(function(B){return e._xiamia_list._4e_contains(B)&&B.hasClass("ke-xiami-page-item")},true);if(r){e._dinfo={url:"http://www.xiami.com/widget/"+r.attr("data-value")+"/singlePlayer.swf",attrs:{title:r.attr("title"),align:e.dAlign.val(),style:"margin:"+(parseInt(e.dMargin.val())||0)+"px;"}};e._gen()}else q&&f(parseInt(q.attr("data-value")))})},_listSearch:function(f){var e,m=f.results,k="";if(f.key==j.trim(this._xiami_input.val())){this._xiami_submit.enable();
if(m&&m.length){k="<ul>";for(e=0;e<m.length;e++){var p=m[e],z=decodeURIComponent(p.song_name)+" - "+decodeURIComponent(p.artist_name);k=k;var r="<li title='"+z+"'><span class='ke-xiami-song'>",q=z;if(q.length>35)q=q.substring(0,35)+"...";k=k+(r+q+"</span><a href='#' title='"+z+"' class='ke-xiami-add' data-value='"+(p.album_id+"_"+p.song_id)+"'>\u6dfb\u52a0</a></li>")}k+="</ul>";m=f.page;f=Math.floor(f.total/8);e=m-1;p=m+1;if(f>1){k+="<p class='ke-xiami-paging'>";if(e<=2){p=Math.min(2-e+p,f-1);e=2}p=Math.min(p,
f-1);if(p==f-1)e=Math.max(2,p-3);if(m!=1)k+=c(m,m-1,"\u4e0a\u4e00\u9875");k+=c(m,1,"1");if(e!=2)k+="<span class='ke-xiami-page-more'>...</span>";for(e=e;e<=p;e++)k+=c(m,e);if(p!=f){if(p!=f-1)k+="<span class='ke-xiami-page-more'>...</span>";k+=c(m,f,f)}if(m!=f)k+=c(m,m+1,"\u4e0b\u4e00\u9875");k+="</p>"}}else k="<p style='text-align:center;margin:10px 0;'>\u4e0d\u597d\u610f\u601d\uff0c\u6ca1\u6709\u627e\u5230\u7ed3\u679c\uff01</p>";this._xiamia_list.html(k)}},_updateD:function(){var f=this.selectedFlash;if(f){this._xiami_input.val(f.attr("title"));this._xiamia_title.html(f.attr("title"));
this.dAlign.val(f.attr("align"));this.dMargin.val(parseInt(f._4e_style("margin"))||0);this._xiami_url_wrap.hide();this.d.foot.show();this._xiamia_title.show()}else{l.Utils.resetInput(this._xiami_input);this.dAlign.val("");this.dMargin.val("5");this._xiami_url_wrap.show();this.d.foot.hide();this._xiamia_title.hide();this._xiami_submit.enable()}this._xiamia_list.hide();this._xiamia_list.html("")},_getDInfo:function(){j.mix(this._dinfo.attrs,{width:257,height:33});return this._dinfo}});var y={"\u867e\u7c73\u5c5e\u6027":function(f){var e=
f.getSelection();e=e&&e.getStartElement();e=g(e);f=f._toolbars["bangpai-music"];e&&f.show(null,e)}};x.registerBubble("bangpai-music","\u867e\u7c73\u97f3\u4e50\uff1a ",g);l.BangPaiMusic=d}();v.addPlugin(function(){new l.BangPaiMusic(v)})},{attach:false,requires:["flashsupport"]});
KISSY.Editor.add("bangpai-sourcearea",function(v){var j=KISSY.Editor,n=KISSY,t=n.Node;UA=n.UA;TripleButton=j.TripleButton;if(!(UA.gecko<1.92)){j.BangPaiSourceArea||function(){function l(w){this.editor=w;this._init()}var u=j.SOURCE_MODE,o=j.WYSIWYG_MODE;n.augment(l,{_init:function(){var w=this.editor,x=w.statusDiv,h=this.el=(new t("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(x).one("input");
h.on("click",this._check,this);w.on("sourcemode",function(){h[0].checked=true});w.on("wysiwygmode",function(){h[0].checked=false})},_check:function(){this.el[0].checked?this._show():this._hide()},_show:function(){this.editor.execCommand("sourceAreaSupport",u)},_hide:function(){this.editor.execCommand("sourceAreaSupport",o)}});j.BangPaiSourceArea=l}();v.addPlugin(function(){new j.BangPaiSourceArea(v)})}},{attach:false,requires:["sourceareasupport"]});
KISSY.Editor.add("bangpai-upload",function(v){var j=KISSY,n=j.Editor;if(!n.BangPaiUpload){(function(){function t(a){this.editor=a;this._init()}var l=j.DOM,u=j.JSON,o=j.Node,w=n.SimpleOverlay;u=j.JSON;var x=window[n.STORE],h=n.Config.base+n.Utils.debugUrl("plugins/uploader/uploader.swf"),i={};name="ke-bangpai-upload";l.addStyleSheet(".ke-upload-head {background-color: #f4f7fc;background: -webkit-gradient(linear, left top, left bottom, from(rgb(244, 247, 252)), to(rgb(235, 239, 244)));background: -moz-linear-gradient(top, rgb(244, 247, 252), rgb(235, 239, 244));filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#f4f7fc', endColorstr = '#ebeff4');height:40px;border-bottom:1px solid #CED5E0;padding-top:1px;}.ke-upload-head-text {height:30px;line-height:30px;width:120px;margin-top:8px;margin-left:30px;text-align:center;border:1px solid #CED5E0;border-bottom-color:#FDFDFD;background:#FDFDFD;padding-bottom:2px;margin-bottom:-2px;position:relative;}.ke-upload-btn-wrap {position:relative;padding:15px 20px 15px 10px;text-align:right;}.ke-upload-list {width:100%;}.ke-upload-list th {border-top:1px solid #c1c8d1;background-color:#EBEDF1;}.ke-upload-list td,.ke-upload-list th {padding:0.5em;text-align:center;border-bottom:1px solid #c1c8d1;}",
"ke-BangPaiUpload");j.augment(t,j.EventTarget,{_prepareShow:function(){var a=this,d=a.editor,b=d.cfg.pluginConfig["bangpai-upload"];a.dialog=new w({title:"\u6279\u91cf\u4e0a\u4f20",mask:false,focusMgr:false,width:"700px"});var c=a.dialog;c.foot.hide();var g=c.body,s=(new o("<div class='ke-upload-btn-wrap'><span style='margin:0 15px 0 0px;color:#969696;display:inline-block;vertical-align:middle;width:80%;'></span></div>")).appendTo(g),y=(new o("<div style='display:none'>")).appendTo(g),f=new n.TripleButton({text:"\u6d4f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u89c8",
cls:"ke-button",container:s}),e=f.el.offset(),m=f.el.width()*2,k=f.el.height()*1.5;g=(new o("<div style='"+("position:absolute;width:"+m+"px;height:"+k+"px;z-index:"+d.baseZIndex(9999)+";")+"'>")).appendTo(s);var p=(new o("<div><table class='ke-upload-list'><thead><tr><th>\u5e8f\u53f7</th><th>\u56fe\u7247</th><th>\u5927\u5c0f</th><th style='width:30%'>\u4e0a\u4f20\u8fdb\u5ea6</th><th>\u56fe\u7247\u64cd\u4f5c</th></tr></thead><tbody></tbody></table></div>")).appendTo(y),z=p.one("tbody"),r=(new o("<p style='margin:15px 20px 35px; 0;text-align:right;'><a class='ke-button ke-bangpiaupload-ok'>\u786e\u5b9a\u4e0a\u4f20</a><a class='ke-button ke-bangpiaupload-insertall' style='margin-left:20px;'>\u5168\u90e8\u63d2\u5165</a></p>")).appendTo(y),
q=r.one(".ke-bangpiaupload-ok");r=r.one(".ke-bangpiaupload-insertall");j.guid(name);var B=(new o("<span></span>")).insertBefore(q);b.extraHtml&&p.append(b.extraHtml);a.statusText=B;a.btn=f;a.up=q;g.offset(e);f=new n.FlashBridge({movie:h,methods:["removeFile","cancel","removeFile","disable","enable","setAllowMultipleFiles","setFileFilters","uploadAll"],holder:g,attrs:{width:m,height:k},params:{wmode:"transparent"},flashVars:{allowedDomain:location.hostname,menu:true}});a.flashPos=g;a.uploader=f;a._list=
z;a._listTable=z.parent("table");a._listWrap=y;a._ds=b.serverUrl;a._dsp=b.serverParams||{};a._fileInput=b.fileInput||"Filedata";a._sizeLimit=b.sizeLimit||1E3;a._numberLimit=b.numberLimit||15;s.one("span").html("\u5141\u8bb8\u7528\u6237\u540c\u65f6\u4e0a\u4f20"+a._numberLimit+"\u5f20\u56fe\u7247\uff0c\u5355\u5f20\u56fe\u7247\u5bb9\u91cf\u4e0d\u8d85\u8fc7"+a._sizeLimit/1E3+"M");r.on("click",function(){trs=z.all("tr");for(var A=0;A<trs.length;A++){var C=new o(trs[A]),D=C.attr("url");if(D){d.insertElement(new o("<p>&nbsp;<img src='"+D+"'/>&nbsp;</p>",null,d.document));a._removeTrFile(C)}}if(D){y.hide();
c.hide()}});z.on("click",function(A){var C=new o(A.target);A.halt();if(C.hasClass("ke-upload-insert")){A=C.parent("tr");url=A.attr("url");d.insertElement(new o("<img src='"+url+"'/>",null,d.document))}if(C.hasClass("ke-upload-delete")||C.hasClass("ke-upload-insert")){A=C.parent("tr");a._removeTrFile(A)}});f.on("fileSelect",a._onSelect,a);f.on("uploadStart",a._onUploadStart,a);f.on("uploadProgress",a._onProgress,a);f.on("uploadComplete",a._onComplete,a);f.on("uploadCompleteData",a._onUploadCompleteData,
a);f.on("swfReady",a._ready,a);f.on("uploadError",a._uploadError,a);a._restore()},_removeTrFile:function(a){var d=a.attr("fid"),b=this.uploader;if(d){try{b.cancel(d)}catch(c){}b.removeFile(d)}if(i[d]){i[d].destroy();delete i[d]}a._4e_remove();this.denable();this._syncStatus()},_init:function(){var a=this,d=a.editor,b=new n.TripleButton({contentCls:"ke-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",container:d.toolBarDiv});b.on("offClick",a.show,a);a.el=b;n.Utils.lazyRun(a,"_prepareShow","_realShow");n.Utils.sourceDisable(d,
a);a.disable();n.storeReady(function(){a.enable()})},disable:function(){this.el.disable()},enable:function(){this.el.boff()},_realShow:function(){this.dialog.show()},show:function(){this._prepareShow()},_uploadError:function(a){var d=a.id,b=this._getFileTr(d);d=i[d];if(b){d&&d.destroy();b.one(".ke-upload-progress").html("<div style='color:red;'>"+a.status+"</div>")}},_getFileTr:function(a){for(var d=this._list.all("tr"),b=0;b<d.length;b++){var c=new o(d[b]);if(c.attr("fid")==a)return c}},_onUploadStart:function(a){this.uploader.removeFile(a.id)},
_onComplete:function(){},_onUploadCompleteData:function(a){var d=j.trim(a.data).replace(/\\r||\\n/g,"");a=a.id;if(d){d=u.parse(d);if(d.error)this._uploadError({id:a,status:d.error});else{if(a=this._getFileTr(a)){a.one(".ke-upload-insert").show();a.attr("url",d.imgUrl)}this._syncStatus()}}},_onProgress:function(a){var d=Math.floor(a.bytesLoaded*100/a.bytesTotal);(a=i[a.id])&&a.set("progress",d)},ddisable:function(){this.uploader.disable();this.btn.disable();this.flashPos.offset({left:-9999,top:-9999})},
denable:function(){this.uploader.enable();this.btn.enable();this.flashPos.offset(this.btn.el.offset())},_syncStatus:function(){var a=this._list,d=1,b=a.all("tr");if(b.length==0)this._listWrap.hide();else{a.all(".ke-upload-seq").each(function(g){g.html(d++)});for(var c=a=0;c<b.length;c++)(new o(b[c])).attr("url")||a++;this.statusText.html("\u961f\u5217\u4e2d\u5269\u4f59"+a+"\u5f20\u56fe\u7247\uff0c\u70b9\u51fb\u786e\u5b9a\u4e0a\u4f20\uff0c\u5f00\u59cb\u4e0a\u4f20\u3002 ")}this._save()},_restore:function(){var a=x.getItem("Multi-Upload-Save"),d=this._list[0];if(a){a=u.parse(decodeURIComponent(a));for(var b=
0;b<a.length;b++){var c=a[b];c.complete=1;c.fid="restore_"+b;this._createFileTr(d,c).attr("url",c.url)}if(c){this._listWrap.show();this._syncStatus()}}},_save:function(){for(var a=this._list.all("tr"),d=[],b=0;b<a.length;b++){var c=new o(a[b]),g=c.attr("url");if(g){var s=c.one(".ke-upload-filesize").html();c=c.one(".ke-upload-filename").html();d.push({name:c,size:s,url:g})}}x.setItem("Multi-Upload-Save",encodeURIComponent(u.stringify(d)))},_getFilesSize:function(a){var d=0,b;for(b in a)a.hasOwnProperty(b)&&
d++;return d},_createFileTr:function(a,d){var b=d.fid,c=a.insertRow(-1);l.attr(c,"fid",b);var g=c.insertCell(-1);l.attr(g,"class","ke-upload-seq");g=c.insertCell(-1);l.html(g,d.name);l.attr(g,"class","ke-upload-filename");g=c.insertCell(-1);l.html(g,d.size);l.attr(g,"class","ke-upload-filesize");g=c.insertCell(-1);l.attr(g,"class","ke-upload-progress");g=c.insertCell(-1);l.html(g,"<a href='#' class='ke-upload-insert' "+(d.complete?"":"style='display:none'")+">[\u63d2\u5165]</a> &nbsp; <a href='#' class='ke-upload-delete'>[\u5220\u9664]</a> &nbsp;");
c=new o(c);c.one(".ke-upload-progress");if(d.size>this._sizeLimit){this._uploadError({id:b,status:"\u56fe\u7247\u4e0d\u80fd\u8d85\u8fc7 n M".replace(/n/,this._sizeLimit/1E3)});this.uploader.removeFile(b)}else{i[b]=new n.ProgressBar({container:c.one(".ke-upload-progress"),width:"100px",height:"18px"});d.complete&&i[b].set("progress",100)}return c},_onSelect:function(a){var d=this.uploader,b=this._list,c=0;a=a.fileList;var g=this._numberLimit;if(a){var s=this._getFilesSize(a);s>g&&alert("\u7cfb\u7edf\u5c06\u53ea\u4fdd\u7559 n \u5f20".replace(/n/,this._numberLimit));
s>=g&&this.ddisable();g=b.children("tr");for(b=0;b<g.length;b++)(s=l.attr(g[b],"fid"))&&a[s]&&delete a[s];g=this._numberLimit-g.length;this._listWrap.show();s=this._list[0];for(b in a)if(a.hasOwnProperty(b)){c++;var y=a[b],f=Math.floor(y.size/1E3),e=y.id;c>g?d.removeFile(e):this._createFileTr(s,{size:f+"k",fid:e,name:y.name})}this._syncStatus()}},_ready:function(){var a=this,d=a.uploader,b=a.up,c=a.btn,g=a.flashPos,s=n.Utils.normParams;c.enable();g.offset(c.el.offset());d.setAllowMultipleFiles(true);
d.setFileFilters([{extensions:"*.jpeg;*.jpg;*.png;*.gif",description:"\u56fe\u7247\u6587\u4ef6( png,jpg,jpeg,gif )"}]);b.on("click",function(y){y.halt();d.uploadAll(a._ds,"POST",s(a._dsp),a._fileInput)})}});n.BangPaiUpload=t})();v.addPlugin(function(){new n.BangPaiUpload(v)})}},{attach:false,requires:["flashutils","progressbar","flashbridge","overlay"]});
KISSY.Editor.add("bangpai-video",function(v){function j(h){for(var i=0;i<x.length;i++){var a=x[i];if(a.reg.test(h))return a}}var n=KISSY,t=n.Editor,l="ke_video",u=t.Flash,o=v.htmlDataProcessor,w=o&&o.dataFilter;w&&w.addRules({elements:{object:function(h){var i=h.attributes;if(!(i.classid&&String(i.classid).toLowerCase())){for(i=0;i<h.children.length;i++)if(h.children[i].name=="embed"){if(!u.isFlashEmbed(h.children[i]))break;if(j(h.children[i].attributes.src))return o.createFakeParserElement(h,l,"bangpai-video",
true)}return null}for(i=0;i<h.children.length;i++){var a=h.children[i];if(a.name=="param"&&a.attributes.name=="movie")if(j(a.attributes.value))return o.createFakeParserElement(h,l,"bangpai-video",true)}},embed:function(h){if(!u.isFlashEmbed(h))return null;if(j(h.attributes.src))return o.createFakeParserElement(h,l,"bangpai-video",true)}}},4);var x=[{reg:/youku\.com/i,width:480,height:400,detect:function(h){var i=h.match(/id_([^.]+)\.html$/);if(i)return"http://player.youku.com/player.php/sid/"+i[1]+
"/v.swf";h.match(/v_playlist\/([^.]+)\.html$/);return h}},{reg:/tudou\.com/i,width:480,height:400,detect:function(h){return h}},{reg:/ku6\.com/i,width:480,height:400,detect:function(h){var i=h.match(/show[^\/]*\/([^.]+)\.html$/);if(i)return"http://player.ku6.com/refer/"+i[1]+"/v.swf";return h}}];t.BangPaiVideo||function(){function h(){h.superclass.constructor.apply(this,arguments)}function i(b){return b._4e_name()==="img"&&!!b.hasClass(l)&&b}var a=["img."+l];n.extend(h,u,{_config:function(){var b=
this.editor.cfg.pluginConfig;this._cls=l;this._type="bangpai-video";this._title="\u89c6\u9891\u5c5e\u6027";this._bodyHtml="<div style='padding:20px 20px 0 20px'><p><label>\u94fe\u63a5\uff1a <input class='ke-video-url ke-input' style='width:300px'/></label></p><table style='margin:10px 0 5px  40px;width:300px;'><tr><td><label>\u5bbd\u5ea6\uff1a  <input  data-verify='^(\u81ea\u52a8|((?!0$)\\d+))$'  data-warning='\u5bbd\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570' class='ke-video-width ke-input' style='width:60px' value='\u81ea\u52a8'/> \u50cf\u7d20</label></td><td><label> \u9ad8\u5ea6\uff1a  <input  data-verify='^(\u81ea\u52a8|((?!0$)\\d+))$'  data-warning='\u9ad8\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570' class='ke-video-height ke-input' style='width:60px' value='\u81ea\u52a8'/> \u50cf\u7d20</label></td></tr><tr><td><label>\u5bf9\u9f50\uff1a <select class='ke-video-align'><option value=''>\u65e0</option><option value='left'>\u5de6\u5bf9\u9f50</option><option value='right'>\u53f3\u5bf9\u9f50</option></select></td><td><label>\u95f4\u8ddd\uff1a <input  data-verify='^\\d+$'  data-warning='\u95f4\u8ddd\u8bf7\u8f93\u5165\u975e\u8d1f\u6574\u6570' class='ke-video-margin ke-input' style='width:60px' value='5'/> \u50cf\u7d20</label></td></tr></table></div>";
this._footHtml="<a class='ke-video-ok ke-button' style='margin-left:40px;margin-right:20px;'>\u786e\u5b9a</button> <a class='ke-video-cancel ke-button'>\u53d6\u6d88</a>";this._contentCls="ke-toolbar-video";this._tip="\u63d2\u5165\u89c6\u9891";this._contextMenu=d;this._flashRules=a;this.urlCfg=b["bangpai-video"]&&b["bangpai-video"].urlCfg;this._urlTip="\u652f\u6301 \u571f\u8c46\uff0c\u4f18\u9177\uff0cku6 \u89c6\u9891\u5206\u4eab";this._config_dwidth="400px"},_initD:function(){var b=this.d,c=b.el;this.dUrl=c.one(".ke-video-url");this.dAlign=t.Select.decorate(c.one(".ke-video-align"));this.dMargin=
c.one(".ke-video-margin");this.dWidth=c.one(".ke-video-width");this.dHeight=c.one(".ke-video-height");var g=c.one(".ke-video-ok");c=c.one(".ke-video-cancel");g.on("click",this._gen,this);c.on("click",function(){b.hide()});t.Utils.placeholder(this.dUrl,this._urlTip)},_getDInfo:function(){var b=this.dUrl.val(),c=j(b);if(c){if(b=c.detect(b))return{url:b,attrs:{height:parseInt(this.dHeight.val())||c.height,width:parseInt(this.dWidth.val())||c.width,align:this.dAlign.val(),style:"margin:"+(parseInt(this.dMargin.val())||
0)+"px;"}}}else alert("\u4e0d\u652f\u6301\u8be5\u94fe\u63a5\u6765\u6e90!")},_gen:function(){var b=this.dUrl.val(),c=this.urlCfg;if(c)for(var g=0;g<c.length;g++){var s=c[g];if(s.reg.test(b)){this.d.loading();h.dynamicUrl.origin=b;h.dynamicUrl.instance=this;n.getScript(s.url.replace(/@url@/,encodeURIComponent(b)).replace(/@callback@/,encodeURIComponent("KISSY.Editor.BangPaiVideo.dynamicUrl")));return}}h.superclass._gen.call(this)},_dynamicUrlPrepare:function(b){this.dUrl.val(b);this.d.unloading();h.superclass._gen.call(this)},_updateD:function(){var b=
this.editor,c=this.selectedFlash;if(c){b=b.restoreRealElement(c);this.dUrl.val(this._getFlashUrl(b));this.dAlign.val(b.attr("align"));this.dMargin.val(parseInt(b._4e_style("margin"))||0);c.css("width")&&this.dWidth.val(parseInt(c.css("width")));c.css("height")&&this.dHeight.val(parseInt(c.css("height")))}else{t.Utils.resetInput(this.dUrl);this.dAlign.val("");this.dMargin.val("5");this.dWidth.val("\u81ea\u52a8");this.dHeight.val("\u81ea\u52a8")}}});h.dynamicUrl=function(b,c){b===h.dynamicUrl.origin&&h.dynamicUrl.instance._dynamicUrlPrepare(c)};
u.registerBubble("bangpai-video","\u89c6\u9891\u94fe\u63a5\uff1a ",i);t.BangPaiVideo=h;var d={"\u89c6\u9891\u5c5e\u6027":function(b){var c=b.getSelection();c=(c=c&&c.getStartElement())&&i(c);b=b._toolbars["bangpai-video"];c&&b.show(null,c)}}}();v.addPlugin(function(){new t.BangPaiVideo(v)})},{attach:false,requires:["flashsupport"]});
