KISSY.Editor.add("bangpai-music",function(d){var c=KISSY.Editor,e=d.htmlDataProcessor,j=e&&e.dataFilter;j&&j.addRules({elements:{object:function(f){var g=f.attributes,h=f.attributes.title,b;if(!(g.classid&&String(g.classid).toLowerCase())){for(g=0;g<f.children.length;g++){b=f.children[g];if(b.name=="embed"){if(!c.Utils.isFlashEmbed(b))break;if(/xiami\.com/i.test(b.attributes.src))return e.createFakeParserElement(f,"ke_xiami","bangpai-music",true,{title:h})}}return null}for(g=0;g<f.children.length;g++){b=
f.children[g];if(b.name=="param"&&b.attributes.name=="movie")if(/xiami\.com/i.test(b.attributes.value))return e.createFakeParserElement(f,"ke_xiami","bangpai-music",true,{title:h})}},embed:function(f){if(!c.Utils.isFlashEmbed(f))return null;if(/xiami\.com/i.test(f.attributes.src))return e.createFakeParserElement(f,"ke_xiami","bangpai-music",true,{title:f.attributes.title})}}},4);d.addPlugin("bangpai-music",function(){var f=d.addButton("bangpai-music",{contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",
mode:c.WYSIWYG_MODE,loading:true});c.use("bangpai-music/support",function(){var g=new c.BangPaiMusic(d);f.reload({offClick:function(){g.show()}})})})},{attach:false,requires:["fakeobjects"]});
KISSY.Editor.add("bangpai-music/support",function(){function d(a){d.superclass.constructor.apply(this,arguments);a.cfg.disableObjectResizing||g.on(a.document.body,j.ie?"resizestart":"resize",function(i){(new e.Node(i.target)).hasClass(f)&&i.preventDefault()})}function c(a){return a._4e_name()==="img"&&!!a.hasClass(f)&&a}var e=KISSY,j=e.UA,f="ke_xiami",g=e.Event,h=e.Editor;e.extend(d,h.Flash,{_config:function(){this._cls=f;this._type="bangpai-music";this._contextMenu=b;this._flashRules=["img."+f]},
_updateTip:function(a,i){var k=this.editor.restoreRealElement(i);if(k){a.html(i.attr("title"));a.attr("href",this._getFlashUrl(k))}}});var b={"\u867e\u7c73\u5c5e\u6027":function(a){var i=a.editor.getSelection();i=i&&i.getStartElement();(i=c(i))&&a.show(null,i)}};h.Flash.registerBubble("bangpai-music","\u867e\u7c73\u97f3\u4e50\uff1a ",c);h.BangPaiMusic=d;h.add({"bangpai-music/dialog":{attach:false,charset:"utf-8",path:h.Utils.debugUrl("../biz/bangpai/plugins/music/dialog/plugin.js")}});h.add({"bangpai-music/dialog/support":{attach:false,charset:"utf-8",
requires:["flash/dialog/support"],path:h.Utils.debugUrl("../biz/bangpai/plugins/music/dialog/support/plugin.js")}})},{attach:false,requires:["flash/support"]});KISSY.Editor.add("bangpai-sourcearea",function(d){var c=KISSY.Editor;KISSY.UA.gecko<1.92||c.use("bangpai-sourcearea/support",function(){new c.BangPaiSourceArea(d)})},{attach:false});
KISSY.Editor.add("bangpai-sourcearea/support",function(){function d(h){this.editor=h;this._init()}var c=KISSY,e=c.Editor,j=c.Node,f=e.SOURCE_MODE,g=e.WYSIWYG_MODE;c.augment(d,{_init:function(){var h=this.editor,b=h.statusDiv,a=this.el=(new j("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(b).one("input");a.on("click",this._check,this);h.on("sourcemode",
function(){a[0].checked=true});h.on("wysiwygmode",function(){a[0].checked=false})},_check:function(){this.el[0].checked?this._show():this._hide()},_show:function(){e.SourceAreaSupport.exec(this.editor,f)},_hide:function(){e.SourceAreaSupport.exec(this.editor,g)}});e.BangPaiSourceArea=d},{attach:false,requires:["sourcearea/support"]});
KISSY.Editor.add("bangpai-upload",function(d){var c=KISSY.Editor;if(!c.Env.mods["bangpai-upload/dialog"]){c.add({"bangpai-upload/dialog":{attach:false,charset:"utf-8",path:c.Utils.debugUrl("../biz/bangpai/plugins/upload/dialog/plugin.js")}});c.add({"bangpai-upload/dialog/support":{attach:false,charset:"utf-8",requires:["progressbar","localstorage","overlay"],path:c.Utils.debugUrl("../biz/bangpai/plugins/upload/dialog/support/plugin.js")}})}d.addPlugin("bangpai-upload",function(){d.addButton("bangpai-upload",
{contentCls:"ke-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",mode:c.WYSIWYG_MODE,offClick:function(){this.editor.useDialog("bangpai-upload/dialog",function(e){e.show()})}})})},{attach:false});
KISSY.Editor.add("bangpai-video",function(d){function c(b){for(var a=0;a<g.length;a++){var i=g[a];if(i.reg.test(b))return i}}var e=KISSY.Editor,j=d.htmlDataProcessor,f=j&&j.dataFilter,g=[{reg:/youku\.com/i,width:480,height:400,detect:function(b){var a=b.match(/id_([^.]+)\.html$/);if(a)return"http://player.youku.com/player.php/sid/"+a[1]+"/v.swf";a=b.match(/v_playlist\/([^.]+)\.html$/);if(!a)return b}},{reg:/tudou\.com/i,width:480,height:400,detect:function(b){return b}},{reg:/ku6\.com/i,width:480,
height:400,detect:function(b){var a=b.match(/show[^\/]*\/([^.]+)\.html$/);if(a)return"http://player.ku6.com/refer/"+a[1]+"/v.swf";return b}}],h=d.cfg.pluginConfig;h["bangpai-video"]=h["bangpai-video"]||{};h=h["bangpai-video"];h.providers&&g.push.apply(g,h.providers);h.getProvider=c;f&&f.addRules({elements:{object:function(b){var a=b.attributes;if(!(a.classid&&String(a.classid).toLowerCase())){for(a=0;a<b.children.length;a++)if(b.children[a].name=="embed"){if(!e.Utils.isFlashEmbed(b.children[a]))break;
if(c(b.children[a].attributes.src))return j.createFakeParserElement(b,"ke_video","bangpai-video",true)}return null}for(a=0;a<b.children.length;a++){var i=b.children[a];if(i.name=="param"&&i.attributes.name=="movie")if(c(i.attributes.value))return j.createFakeParserElement(b,"ke_video","bangpai-video",true)}},embed:function(b){if(!e.Utils.isFlashEmbed(b))return null;if(c(b.attributes.src))return j.createFakeParserElement(b,"ke_video","bangpai-video",true)}}},4);d.addPlugin("bangpai-video",function(){var b=
d.addButton("bangpai-video",{contentCls:"ke-toolbar-video",title:"\u63d2\u5165\u89c6\u9891",mode:e.WYSIWYG_MODE,loading:true});e.use("bangpai-video/support",function(){var a=new e.BangPaiVideo(d);b.reload({offClick:function(){a.show()}})})})},{attach:false,requires:["fakeobjects"]});
KISSY.Editor.add("bangpai-video/support",function(){function d(){d.superclass.constructor.apply(this,arguments)}function c(a){return a._4e_name()==="img"&&!!a.hasClass(g)&&a}var e=KISSY,j=e.Editor,f=j.Flash,g="ke_video",h=["img."+g];d.CLS_VIDEO=g;d.TYPE_VIDEO="bangpai-video";e.extend(d,f,{_config:function(){this._cls=g;this._type="bangpai-video";this._contextMenu=b;this._flashRules=h}});f.registerBubble("bangpai-video","\u89c6\u9891\u94fe\u63a5\uff1a ",c);j.BangPaiVideo=d;var b={"\u89c6\u9891\u5c5e\u6027":function(a){var i=a.editor.getSelection();
(i=(i=i&&i.getStartElement())&&c(i))&&a.show(null,i)}};j.add({"bangpai-video/dialog":{attach:false,charset:"utf-8",path:j.Utils.debugUrl("../biz/bangpai/plugins/video/dialog/plugin.js")}});j.add({"bangpai-video/dialog/support":{attach:false,charset:"utf-8",requires:["flash/dialog/support"],path:j.Utils.debugUrl("../biz/bangpai/plugins/video/dialog/support/plugin.js")}})},{attach:false,requires:["flash/support"]});
