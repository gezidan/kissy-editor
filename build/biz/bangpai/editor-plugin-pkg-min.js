KISSY.Editor.add("bangpai-music",function(j){var f=KISSY,g=f.UA,l=f.Event,c=f.Editor,o=f.DOM,i=c.Flash,h="ke_xiami",n=j.htmlDataProcessor,k=n&&n.dataFilter;k&&k.addRules({elements:{object:function(a){var b=a.attributes,m=a.attributes.title,d;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++){d=a.children[b];if(d.name=="embed"){if(!i.isFlashEmbed(d))break;if(/xiami\.com/i.test(d.attributes.src))return n.createFakeParserElement(a,h,"bangpai-music",true,{title:m})}}return null}for(b=
0;b<a.children.length;b++){d=a.children[b];if(d.name=="param"&&d.attributes.name=="movie")if(/xiami\.com/i.test(d.attributes.value))return n.createFakeParserElement(a,h,"bangpai-music",true,{title:m})}},embed:function(a){if(!i.isFlashEmbed(a))return null;if(/xiami\.com/i.test(a.attributes.src))return n.createFakeParserElement(a,h,"bangpai-music",true,{title:a.attributes.title})}}},4);c.BangPaiMusic||function(){function a(d){a.superclass.constructor.apply(this,arguments);d.cfg.disableObjectResizing||
l.on(d.document.body,g.ie?"resizestart":"resize",function(e){o.hasClass(e.target,h)&&e.preventDefault()})}function b(d){return d._4e_name()==="img"&&!!d.hasClass(h)&&d}f.extend(a,i,{_config:function(){this._cls=h;this._type="bangpai-music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u867e\u7c73\u97f3\u4e50";this._contextMenu=m;this._flashRules=["img."+h]},_updateTip:function(d,e){var p=this.editor.restoreRealElement(e);if(p){d.html(e.attr("title"));d.attr("href",this._getFlashUrl(p))}}});var m={"\u867e\u7c73\u5c5e\u6027":function(d){var e=
d.getSelection();e=e&&e.getStartElement();e=b(e);d=d._toolbars["bangpai-music"];e&&d.show(null,e)}};i.registerBubble("bangpai-music","\u867e\u7c73\u97f3\u4e50\uff1a ",b);c.BangPaiMusic=a;c.add({"bangpai-music/dialog":{attach:false,charset:"utf-8",requires:["flash/dialog"],path:c.Utils.debugUrl("biz/bangpai/plugins/music/dialog/plugin.js")}})}();j.addPlugin(function(){new c.BangPaiMusic(j)})},{attach:false,requires:["flash/support"]});
KISSY.Editor.add("bangpai-sourcearea",function(j){var f=KISSY.Editor,g=KISSY,l=g.Node;if(!(g.UA.gecko<1.92)){f.BangPaiSourceArea||function(){function c(h){this.editor=h;this._init()}var o=f.SOURCE_MODE,i=f.WYSIWYG_MODE;g.augment(c,{_init:function(){var h=this.editor,n=h.statusDiv,k=this.el=(new l("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(n).one("input");
k.on("click",this._check,this);h.on("sourcemode",function(){k[0].checked=true});h.on("wysiwygmode",function(){k[0].checked=false})},_check:function(){this.el[0].checked?this._show():this._hide()},_show:function(){this.editor.execCommand("sourceAreaSupport",o)},_hide:function(){this.editor.execCommand("sourceAreaSupport",i)}});f.BangPaiSourceArea=c}();j.addPlugin(function(){new f.BangPaiSourceArea(j)})}},{attach:false,requires:["sourcearea/support"]});
KISSY.Editor.add("bangpai-upload",function(j){var f=KISSY,g=f.Editor;g.BangPaiUpload||function(){function l(c){this.editor=c;this._init()}f.augment(l,f.EventTarget,{_init:function(){var c=this,o=c.editor,i=new g.TripleButton({contentCls:"ke-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",container:o.toolBarDiv});i.on("offClick",c.show,c);c.el=i;g.Utils.sourceDisable(o,c);c.disable();g.storeReady(function(){c.enable()})},disable:function(){this.el.disable()},enable:function(){this.el.boff()},show:function(){this.editor.useDialog("bangpai-upload/dialog",
function(c){c.show()})}});g.add({"bangpai-upload/dialog":{attach:false,charset:"utf-8",requires:["flashutils","progressbar","flashbridge","overlay"],path:g.Utils.debugUrl("biz/bangpai/plugins/upload/dialog/plugin.js")}});g.BangPaiUpload=l}();j.addPlugin(function(){new g.BangPaiUpload(j)})},{attach:false,requires:["localStorage","button"]});
KISSY.Editor.add("bangpai-video",function(j){function f(a){for(var b=0;b<n.length;b++){var m=n[b];if(m.reg.test(a))return m}}var g=KISSY,l=g.Editor,c="ke_video",o=l.Flash,i=j.htmlDataProcessor,h=i&&i.dataFilter,n=[{reg:/youku\.com/i,width:480,height:400,detect:function(a){var b=a.match(/id_([^.]+)\.html$/);if(b)return"http://player.youku.com/player.php/sid/"+b[1]+"/v.swf";b=a.match(/v_playlist\/([^.]+)\.html$/);if(!b)return a}},{reg:/tudou\.com/i,width:480,height:400,detect:function(a){return a}},
{reg:/ku6\.com/i,width:480,height:400,detect:function(a){var b=a.match(/show[^\/]*\/([^.]+)\.html$/);if(b)return"http://player.ku6.com/refer/"+b[1]+"/v.swf";return a}}],k=j.cfg.pluginConfig;k["bangpai-video"]=k["bangpai-video"]||{};k=k["bangpai-video"];k.providers&&n.push.apply(n,k.providers);k.getProvider=f;h&&h.addRules({elements:{object:function(a){var b=a.attributes;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++)if(a.children[b].name=="embed"){if(!o.isFlashEmbed(a.children[b]))break;
if(f(a.children[b].attributes.src))return i.createFakeParserElement(a,c,"bangpai-video",true)}return null}for(b=0;b<a.children.length;b++){var m=a.children[b];if(m.name=="param"&&m.attributes.name=="movie")if(f(m.attributes.value))return i.createFakeParserElement(a,c,"bangpai-video",true)}},embed:function(a){if(!o.isFlashEmbed(a))return null;if(f(a.attributes.src))return i.createFakeParserElement(a,c,"bangpai-video",true)}}},4);l.BangPaiVideo||function(){function a(){a.superclass.constructor.apply(this,
arguments)}function b(e){return e._4e_name()==="img"&&!!e.hasClass(c)&&e}var m=["img."+c];g.extend(a,o,{_config:function(){this._cls=c;this._type="bangpai-video";this._contentCls="ke-toolbar-video";this._tip="\u63d2\u5165\u89c6\u9891";this._contextMenu=d;this._flashRules=m}});o.registerBubble("bangpai-video","\u89c6\u9891\u94fe\u63a5\uff1a ",b);l.BangPaiVideo=a;var d={"\u89c6\u9891\u5c5e\u6027":function(e){var p=e.getSelection();p=(p=p&&p.getStartElement())&&b(p);e=e._toolbars["bangpai-video"];p&&e.show(null,p)}};l.add({"bangpai-video/dialog":{attach:false,charset:"utf-8",
requires:["flash/dialog"],path:l.Utils.debugUrl("biz/bangpai/plugins/video/dialog/plugin.js")}})}();j.addPlugin(function(){new l.BangPaiVideo(j)})},{attach:false,requires:["flash/support"]});
