KISSY.Editor.add("bangpai-music",function(l){function h(e){return/xiami\.com/i.test(e)}var o=KISSY,i=o.Editor,j=i.Flash,m=l.htmlDataProcessor,n=m&&m.dataFilter;n&&n.addRules({elements:{object:function(e){var c=e.attributes;if(!(c.classid&&String(c.classid).toLowerCase())){for(c=0;c<e.children.length;c++)if(e.children[c].name=="embed"){if(!j.isFlashEmbed(e.children[c]))return null;if(h(e.children[c].attributes.src))return m.createFakeParserElement(e,"ke_xiami","bangpai-music",true)}return null}for(c=
0;c<e.children.length;c++){var g=e.children[c];if(g.name=="param"&&g.attributes.name=="movie")if(h(g.attributes.value))return m.createFakeParserElement(e,"ke_xiami","bangpai-music",true)}},embed:function(e){if(!j.isFlashEmbed(e))return null;if(h(e.attributes.src))return m.createFakeParserElement(e,"ke_xiami","bangpai-music",true)}}},4);i.BangPaiMusic||function(){function e(){e.superclass.constructor.apply(this,arguments)}window.bangpai_xiami=function(c){bangpai_xiami.instance._listSearch(c)};o.extend(e,
j,{_config:function(){this._cls="ke_xiami";this._type="bangpai-music";this._title="\u641c\u7d22\u97f3\u4e50";this._bodyHtml="<div><p><input class='ke-xiami-url' style='width:290px' value='\u8f93\u5165\u60f3\u8981\u6dfb\u52a0\u7684\u6b4c\u66f2\u540d\u3001\u4e13\u8f91\u540d\u3001\u827a\u4eba\u540d'/> <button>\u641c\u7d22</button></p><div class='ke-xiami-list'></div></div>";this._footHtml="";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u867e\u7c73\u97f3\u4e50";this._flashRules=this._contextMenu=
null},_initD:function(){var c=this,g=c.d,a=g.el.one("button"),b=g.el.one(".ke-xiami-url");c._xiamia_list=g.el.one(".ke-xiami-list");c._url="http://www.xiami.com/app/nineteen/search/key/${key}/page/1?random=${random}&callback=bangpai_xiami";a.on("click",function(){var k={key:encodeURIComponent(b.val()),random:(new Date).valueOf()},p=c._url.replace(/\${([^}]+)}/g,function(d,f){return k[f]});bangpai_xiami.instance=c;o.getScript(p)},c)},_listSearch:function(c){c=c.results;var g="<ul>";for(var a in c)g+=
"<li>"+decodeURIComponent(c[a].song_name)+"</li>";g+="</ul>";this._xiamia_list.html(g)},_updateD:function(){},_dbclick:function(){},_getDWidth:function(){return 257},_getDURl:function(){},_getDHeight:function(){return 33}});i.BangPaiMusic=e}();l.addPlugin(function(){new i.BangPaiMusic(l)})},{attach:false,requires:["flashsupport"]});
KISSY.Editor.add("bangpai-video",function(l){function h(a){for(var b=0;b<g.length;b++){var k=g[b];if(k.reg.test(a))return k}}var o=KISSY,i=o.Editor,j="ke_video",m=i.Utils.getFlashUrl,n=i.Flash,e=l.htmlDataProcessor,c=e&&e.dataFilter;c&&c.addRules({elements:{object:function(a){var b=a.attributes;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++)if(a.children[b].name=="embed"){if(!n.isFlashEmbed(a.children[b]))return null;if(h(a.children[b].attributes.src))return e.createFakeParserElement(a,
j,"bangpai-video",true)}return null}for(b=0;b<a.children.length;b++){var k=a.children[b];if(k.name=="param"&&k.attributes.name=="movie")if(h(k.attributes.value))return e.createFakeParserElement(a,j,"bangpai-video",true)}},embed:function(a){if(!n.isFlashEmbed(a))return null;if(h(a.attributes.src))return e.createFakeParserElement(a,j,"bangpai-video",true)}}},4);var g=[{reg:/youku\.com/i,width:480,height:400,detect:function(a){var b=a.match(/id_([^.]+)\.html$/);if(b)return"http://player.youku.com/player.php/sid/"+
b[1]+"/v.swf";if(/\.swf$/.test(a))return a}},{reg:/tudou\.com/i,width:480,height:400,detect:function(a){var b=a.match(/\/view\/([^/]+)\/$/);if(b)return"http://www.tudou.com/v/"+b[1]+"/v.swf";if(/\.swf$/.test(a))return a}},{reg:/ku6\.com/i,width:480,height:400,detect:function(a){var b=a.match(/show\/([^.]+)\.html$/);if(b)return"http://player.ku6.com/refer/"+b[1]+"/v.swf";if(/\.swf$/.test(a))return a}}];i.BangPaiVideo||function(){function a(){a.superclass.constructor.apply(this,arguments)}function b(d){return d._4e_ascendant(function(f){return f._4e_name()===
"img"&&!!f.hasClass(j)},true)}var k=["img."+j];o.extend(a,n,{_config:function(){this._cls=j;this._type="bangpai-video";this._title="\u89c6\u9891\u5c5e\u6027";this._bodyHtml="<div><p style='margin-bottom:5px'>\u9700\u8981\u5206\u4eab\u7684\u89c6\u9891\u94fe\u63a5\uff1a\u652f\u6301 \u571f\u8c46\uff0c\u4f18\u9177\uff0cku6 \u89c6\u9891\u5206\u4eab</p><p><label><span style='color:#0066CC;font-weight:bold;'>\u89c6\u9891\u94fe\u63a5\uff1a </span><input class='ke-video-url' style='width:230px' value='\u8bf7\u8f93\u5165\u5982 http://www.xxx.com/xxx.swf'/></label></p></div>";
this._footHtml="<button class='ke-video-ok'>\u786e\u5b9a</button> <button class='ke-video-cancel'>\u53d6\u6d88</button>";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165\u89c6\u9891";this._contextMenu=p;this._flashRules=k},_initD:function(){var d=this,f=d.d;d.dUrl=f.el.one(".ke-video-url");var q=f.el.one(".ke-video-ok");f=f.el.one(".ke-video-cancel");q.on("click",d._gen,d);f.on("click",function(){d.d.hide()})},_getDWidth:function(){var d=this.dUrl.val();return(d=h(d))&&d.width},_getDURl:function(){var d=
this.dUrl.val(),f=h(d);if(f)return f.detect(d);else alert("\u4e0d\u652f\u6301\u8be5\u94fe\u63a5\u6765\u6e90!")},_getDHeight:function(){var d=this.dUrl.val();return(d=h(d))&&d.height},_getFlashUrl:function(d){return m(d)},_updateD:function(){var d=this.editor,f=this.selectedFlash;f?this.dUrl.val(this._getFlashUrl(d.restoreRealElement(f))):this.dUrl.val("\u8bf7\u8f93\u5165\u5982 http://www.xxx.com/xxx.swf")}});n.registerBubble("bangpai-video","\u89c6\u9891\u94fe\u63a5\uff1a ",b);i.BangPaiVideo=a;var p=
{"\u7f16\u8f91\u89c6\u9891":function(d){var f=d.getSelection();f=(f=f&&f.getStartElement())&&b(f);d=d._toolbars["bangpai-video"];if(f){d.selectedFlash=f;d.show()}}}}();l.addPlugin(function(){new i.BangPaiVideo(l)})},{attach:false,requires:["flashsupport"]});
