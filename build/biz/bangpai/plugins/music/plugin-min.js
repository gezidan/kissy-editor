KISSY.Editor.add("bangpai-music",function(f){function g(b){return/xiami\.com/i.test(b)}var h=KISSY,e=h.Editor,i=e.Flash,d=f.htmlDataProcessor,k=d&&d.dataFilter;k&&k.addRules({elements:{object:function(b){var a=b.attributes;if(!(a.classid&&String(a.classid).toLowerCase())){for(a=0;a<b.children.length;a++)if(b.children[a].name=="embed"){if(!i.isFlashEmbed(b.children[a]))return null;if(g(b.children[a].attributes.src))return d.createFakeParserElement(b,"ke_xiami","bangpai-music",true)}return null}for(a=
0;a<b.children.length;a++){var c=b.children[a];if(c.name=="param"&&c.attributes.name=="movie")if(g(c.attributes.value))return d.createFakeParserElement(b,"ke_xiami","bangpai-music",true)}},embed:function(b){if(!i.isFlashEmbed(b))return null;if(g(b.attributes.src))return d.createFakeParserElement(b,"ke_xiami","bangpai-music",true)}}},4);e.BangPaiMusic||function(){function b(){b.superclass.constructor.apply(this,arguments)}window.bangpai_xiami=function(a){bangpai_xiami.instance._listSearch(a)};h.extend(b,
i,{_config:function(){this._cls="ke_xiami";this._type="bangpai-music";this._title="\u641c\u7d22\u97f3\u4e50";this._bodyHtml="<div><p><input class='ke-xiami-url' style='width:290px' value='\u8f93\u5165\u60f3\u8981\u6dfb\u52a0\u7684\u6b4c\u66f2\u540d\u3001\u4e13\u8f91\u540d\u3001\u827a\u4eba\u540d'/> <button>\u641c\u7d22</button></p><div class='ke-xiami-list'></div></div>";this._footHtml="";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u867e\u7c73\u97f3\u4e50";this._flashRules=this._contextMenu=
null},_initD:function(){var a=this,c=a.d,j=c.el.one("button"),l=c.el.one(".ke-xiami-url");a._xiamia_list=c.el.one(".ke-xiami-list");a._url="http://www.xiami.com/app/nineteen/search/key/${key}/page/1?random=${random}&callback=bangpai_xiami";j.on("click",function(){var m={key:encodeURIComponent(l.val()),random:(new Date).valueOf()},o=a._url.replace(/\${([^}]+)}/g,function(p,n){return m[n]});bangpai_xiami.instance=a;h.getScript(o)},a)},_listSearch:function(a){a=a.results;var c="<ul>";for(var j in a)c+=
"<li>"+decodeURIComponent(a[j].song_name)+"</li>";c+="</ul>";this._xiamia_list.html(c)},_updateD:function(){},_dbclick:function(){},_getDWidth:function(){return 257},_getDURl:function(){},_getDHeight:function(){return 33}});e.BangPaiMusic=b}();f.addPlugin(function(){new e.BangPaiMusic(f)})},{attach:false,requires:["flashsupport"]});
