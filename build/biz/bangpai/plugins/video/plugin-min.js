KISSY.Editor.add("bangpai-video",function(k){function i(a){for(var d=0;d<l.length;d++){var e=l[d];if(e.reg.test(a))return e}}var m=KISSY,g=m.Editor,f="ke_video",o=g.Utils.getFlashUrl,j=g.Flash,h=k.htmlDataProcessor,n=h&&h.dataFilter;n&&n.addRules({elements:{object:function(a){var d=a.attributes;if(!(d.classid&&String(d.classid).toLowerCase())){for(d=0;d<a.children.length;d++)if(a.children[d].name=="embed"){if(!j.isFlashEmbed(a.children[d]))return null;if(i(a.children[d].attributes.src))return h.createFakeParserElement(a,
f,"bangpai-video",true)}return null}for(d=0;d<a.children.length;d++){var e=a.children[d];if(e.name=="param"&&e.attributes.name=="movie")if(i(e.attributes.value))return h.createFakeParserElement(a,f,"bangpai-video",true)}},embed:function(a){if(!j.isFlashEmbed(a))return null;if(i(a.attributes.src))return h.createFakeParserElement(a,f,"bangpai-video",true)}}},4);var l=[{reg:/youku\.com/i,width:480,height:400,detect:function(a){if(/\.swf$/.test(a))return a}},{reg:/tudou\.com/i,width:480,height:400,detect:function(a){if(/\.swf$/.test(a))return a}},
{reg:/ku6\.com/i,width:480,height:400,detect:function(a){if(/\.swf$/.test(a))return a}}];g.BangPaiVideo||function(){function a(){a.superclass.constructor.apply(this,arguments)}function d(c){return c._4e_ascendant(function(b){return b._4e_name()==="img"&&!!b.hasClass(f)},true)}var e=["img."+f];m.extend(a,j,{_config:function(){this._cls=f;this._type="bangpai-video";this._title="\u89c6\u9891\u5c5e\ufffd?";this._bodyHtml="<div><p style='margin-bottom:5px'>\ufffd?\ufffd\ufffd\u5206\u4eab\u7684\u89c6\u9891\u94fe\u63a5\uff1a\u652f\u6301 \u571f\u8c46\uff0c\u4f18\u9177\uff0cku6 \u89c6\u9891\u5206\u4eab</p><p><label><span style='color:#0066CC;font-weight:bold;'>\u89c6\u9891\u94fe\u63a5\ufffd?</span><input class='ke-video-url' style='width:230px' value='\u8bf7\u8f93\u5165\u5982 http://www.xxx.com/xxx.swf'/></label></p></div>";
this._footHtml="<button class='ke-video-ok'>\u786e\u5b9a</button> <button class='ke-video-cancel'>\u53d6\u6d88</button>";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165\u89c6\u9891";this._contextMenu=p;this._flashRules=e},_initD:function(){var c=this,b=c.d;c.dUrl=b.el.one(".ke-video-url");var q=b.el.one(".ke-video-ok");b=b.el.one(".ke-video-cancel");q.on("click",c._gen,c);b.on("click",function(){c.d.hide()})},_getDInfo:function(){var c=this.dUrl.val(),b=i(c);if(b){(c=b.detect(c))||alert("\u8bf7\u8f93\u5165\u5982 http://www.xxx.com/xxx.swf");
return{url:c,attrs:{height:b.height,width:b.width}}}else alert("\u4e0d\u652f\u6301\u8be5\u94fe\u63a5\u6765\u6e90!")},_getFlashUrl:function(c){return o(c)},_updateD:function(){var c=this.editor,b=this.selectedFlash;b?this.dUrl.val(this._getFlashUrl(c.restoreRealElement(b))):this.dUrl.val("\u8bf7\u8f93\u5165\u5982 http://www.xxx.com/xxx.swf")}});j.registerBubble("bangpai-video","\u89c6\u9891\u94fe\u63a5\ufffd?",d);g.BangPaiVideo=a;var p={"\u89c6\u9891\u5c5e\ufffd?":function(c){var b=c.getSelection();
b=(b=b&&b.getStartElement())&&d(b);c=c._toolbars["bangpai-video"];b&&c.show(null,b)}}}();k.addPlugin(function(){new g.BangPaiVideo(k)})},{attach:false,requires:["flashsupport"]});
