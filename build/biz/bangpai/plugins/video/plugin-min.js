KISSY.Editor.add("bangpai-video",function(l){function i(b){for(var d=0;d<n.length;d++){var e=n[d];if(e.reg.test(b))return e}}var m=KISSY,j=m.Editor,f="ke_video",k=j.Flash,g=l.htmlDataProcessor,o=g&&g.dataFilter;o&&o.addRules({elements:{object:function(b){var d=b.attributes;if(!(d.classid&&String(d.classid).toLowerCase())){for(d=0;d<b.children.length;d++)if(b.children[d].name=="embed"){if(!k.isFlashEmbed(b.children[d]))break;if(i(b.children[d].attributes.src))return g.createFakeParserElement(b,f,"bangpai-video",
true)}return null}for(d=0;d<b.children.length;d++){var e=b.children[d];if(e.name=="param"&&e.attributes.name=="movie")if(i(e.attributes.value))return g.createFakeParserElement(b,f,"bangpai-video",true)}},embed:function(b){if(!k.isFlashEmbed(b))return null;if(i(b.attributes.src))return g.createFakeParserElement(b,f,"bangpai-video",true)}}},4);var n=[{reg:/youku\.com/i,width:480,height:400,detect:function(b){var d=b.match(/id_([^.]+)\.html$/);if(d)return"http://player.youku.com/player.php/sid/"+d[1]+
"/v.swf";b.match(/v_playlist\/([^.]+)\.html$/);return b}},{reg:/tudou\.com/i,width:480,height:400,detect:function(b){return b}},{reg:/ku6\.com/i,width:480,height:400,detect:function(b){var d=b.match(/show[^\/]*\/([^.]+)\.html$/);if(d)return"http://player.ku6.com/refer/"+d[1]+"/v.swf";return b}}];j.BangPaiVideo||function(){function b(){b.superclass.constructor.apply(this,arguments)}function d(a){return a._4e_name()==="img"&&!!a.hasClass(f)&&a}var e=["img."+f];m.extend(b,k,{_config:function(){var a=
this.editor.cfg.pluginConfig;this._cls=f;this._type="bangpai-video";this._title="视频属性";this._bodyHtml="<table><tr><td colspan='2'>需要分享的视频链接：支持 土豆，优酷，ku6 视频分享</td></tr><tr><td colspan='2'><label><span style='color:#0066CC;font-weight:bold;'>视频链接： </span><input class='ke-video-url' style='width:230px' value='http://'/></label></td></tr><tr><td><label>宽度： </span> <input  data-verify='^自动|((?!0$)\\d+(.\\d+)?)$'  data-warning='宽度请输入正数' class='ke-video-width' style='width:60px' value='自动'/> 像素 </label></td><td><label> 高度： </span> <input  data-verify='^自动|((?!0$)\\d+(.\\d+)?)$'  data-warning='高度请输入正数' class='ke-video-height' style='width:60px' value='自动'/> 像素 </label></td></tr><tr><td><label>对齐： <select class='ke-video-align'><option value=''>无</option><option value='left'>左对齐</option><option value='right'>右对齐</option></select></td><td><label>间距： </span> <input  data-verify='^\\d+(.\\d+)?$'  data-warning='间距请输入非负数字' class='ke-video-margin' style='width:60px' value='5'/> 像素</label></td></tr></table>";
this._footHtml="<button class='ke-video-ok'>确定</button> <button class='ke-video-cancel'>取消</button>";this._contentCls="ke-toolbar-video";this._tip="插入视频";this._contextMenu=q;this._flashRules=e;this.urlCfg=a["bangpai-video"]&&a["bangpai-video"].urlCfg},_initD:function(){var a=this,c=a.d;a.dUrl=c.el.one(".ke-video-url");a.dAlign=c.el.one(".ke-video-align");a.dMargin=c.el.one(".ke-video-margin");a.dWidth=c.el.one(".ke-video-width");a.dHeight=c.el.one(".ke-video-height");var h=c.el.one(".ke-video-ok");
c=c.el.one(".ke-video-cancel");h.on("click",a._gen,a);c.on("click",function(){a.d.hide()})},_getDInfo:function(){var a=this.dUrl.val(),c=i(a);if(c)if(a=c.detect(a))return{url:a,attrs:{height:parseInt(this.dHeight.val())||c.height,width:parseInt(this.dWidth.val())||c.width,align:this.dAlign.val(),style:"margin:"+(parseInt(this.dMargin.val())||0)+"px;"}};else alert("http://");else alert("不支持该链接来源!")},_gen:function(){var a=this.dUrl.val(),c=this.urlCfg;if(c)for(var h=0;h<c.length;h++){var p=c[h];if(p.reg.test(a)){this.d.loading();
b.dynamicUrl.origin=a;b.dynamicUrl.instance=this;m.getScript(p.url.replace(/@url@/,encodeURIComponent(a)).replace(/@callback@/,encodeURIComponent("KISSY.Editor.BangPaiVideo.dynamicUrl")));return}}b.superclass._gen.call(this)},_dynamicUrlPrepare:function(a){this.dUrl.val(a);this.d.unloading();b.superclass._gen.call(this)},_updateD:function(){var a=this.editor,c=this.selectedFlash;if(c){a=a.restoreRealElement(c);this.dUrl.val(this._getFlashUrl(a));this.dAlign.val(a.attr("align"));this.dMargin.val(parseInt(a._4e_style("margin"))||
0);this.dWidth.val(a.attr("width"));this.dHeight.val(a.attr("height"))}else{this.dUrl.val("http://");this.dAlign.val("");this.dMargin.val("5");this.dWidth.val("自动");this.dHeight.val("自动")}}});b.dynamicUrl=function(a,c){a===b.dynamicUrl.origin&&b.dynamicUrl.instance._dynamicUrlPrepare(c)};k.registerBubble("bangpai-video","视频链接： ",d);j.BangPaiVideo=b;var q={"视频属性":function(a){var c=a.getSelection();c=(c=c&&c.getStartElement())&&d(c);a=a._toolbars["bangpai-video"];c&&a.show(null,c)}}}();l.addPlugin(function(){new j.BangPaiVideo(l)})},
{attach:false,requires:["flashsupport"]});
