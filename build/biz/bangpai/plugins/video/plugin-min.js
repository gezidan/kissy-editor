KISSY.Editor.add("bangpai-video",function(j){function k(a){for(var b=0;b<l.length;b++){var c=l[b];if(c.reg.test(a))return c}}var n=KISSY,g=n.Editor,h="ke_video",m=g.Flash,i=j.htmlDataProcessor,o=i&&i.dataFilter,l=[{reg:/youku\.com/i,width:480,height:400,detect:function(a){var b=a.match(/id_([^.]+)\.html$/);if(b)return"http://player.youku.com/player.php/sid/"+b[1]+"/v.swf";b=a.match(/v_playlist\/([^.]+)\.html$/);if(!b)return a}},{reg:/tudou\.com/i,width:480,height:400,detect:function(a){return a}},
{reg:/ku6\.com/i,width:480,height:400,detect:function(a){var b=a.match(/show[^\/]*\/([^.]+)\.html$/);if(b)return"http://player.ku6.com/refer/"+b[1]+"/v.swf";return a}}],e=j.cfg.pluginConfig;e["bangpai-video"]=e["bangpai-video"]||{};e=e["bangpai-video"];e.providers&&l.push.apply(l,e.providers);e.getProvider=k;o&&o.addRules({elements:{object:function(a){var b=a.attributes;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++)if(a.children[b].name=="embed"){if(!m.isFlashEmbed(a.children[b]))break;
if(k(a.children[b].attributes.src))return i.createFakeParserElement(a,h,"bangpai-video",true)}return null}for(b=0;b<a.children.length;b++){var c=a.children[b];if(c.name=="param"&&c.attributes.name=="movie")if(k(c.attributes.value))return i.createFakeParserElement(a,h,"bangpai-video",true)}},embed:function(a){if(!m.isFlashEmbed(a))return null;if(k(a.attributes.src))return i.createFakeParserElement(a,h,"bangpai-video",true)}}},4);g.BangPaiVideo||function(){function a(){a.superclass.constructor.apply(this,
arguments)}function b(d){return d._4e_name()==="img"&&!!d.hasClass(h)&&d}var c=["img."+h];n.extend(a,m,{_config:function(){this._cls=h;this._type="bangpai-video";this._contentCls="ke-toolbar-video";this._tip="\u63d2\u5165\u89c6\u9891";this._contextMenu=p;this._flashRules=c}});m.registerBubble("bangpai-video","\u89c6\u9891\u94fe\u63a5\uff1a ",b);g.BangPaiVideo=a;var p={"\u89c6\u9891\u5c5e\u6027":function(d){var f=d.getSelection();f=(f=f&&f.getStartElement())&&b(f);d=d._toolbars["bangpai-video"];f&&d.show(null,f)}};g.add({"bangpai-video/dialog":{attach:false,charset:"utf-8",
requires:["flash/dialog"],path:g.Utils.debugUrl("biz/bangpai/plugins/video/dialog/plugin.js")}})}();j.addPlugin(function(){new g.BangPaiVideo(j)})},{attach:false,requires:["flash/support"]});
