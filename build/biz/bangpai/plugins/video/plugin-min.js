KISSY.Editor.add("bangpai-video",function(k){function h(b){for(var c=0;c<l.length;c++){var e=l[c];if(e.reg.test(b))return e}}var m=KISSY,i=m.Editor,f="ke_video",j=i.Flash,g=k.htmlDataProcessor,n=g&&g.dataFilter;n&&n.addRules({elements:{object:function(b){var c=b.attributes;if(!(c.classid&&String(c.classid).toLowerCase())){for(c=0;c<b.children.length;c++)if(b.children[c].name=="embed"){if(!j.isFlashEmbed(b.children[c]))return null;if(h(b.children[c].attributes.src))return g.createFakeParserElement(b,
f,"bangpai-video",true)}return null}for(c=0;c<b.children.length;c++){var e=b.children[c];if(e.name=="param"&&e.attributes.name=="movie")if(h(e.attributes.value))return g.createFakeParserElement(b,f,"bangpai-video",true)}},embed:function(b){if(!j.isFlashEmbed(b))return null;if(h(b.attributes.src))return g.createFakeParserElement(b,f,"bangpai-video",true)}}},4);var l=[{reg:/youku\.com/i,width:480,height:400,detect:function(b){var c=b.match(/id_([^.]+)\.html$/);if(c)return"http://player.youku.com/player.php/sid/"+
c[1]+"/v.swf";return b}},{reg:/tudou\.com/i,width:480,height:400,detect:function(b){var c=b.match(/\/view\/([^/]+)\/$/);if(c)return"http://www.tudou.com/v/"+c[1]+"/v.swf";return b}},{reg:/ku6\.com/i,width:480,height:400,detect:function(b){var c=b.match(/show[^\/]*\/([^.]+)\.html$/);if(c)return"http://player.ku6.com/refer/"+c[1]+"/v.swf";return b}}];i.BangPaiVideo||function(){function b(){b.superclass.constructor.apply(this,arguments)}function c(a){return a._4e_name()==="img"&&!!a.hasClass(f)&&a}var e=
["img."+f];m.extend(b,j,{_config:function(){this._cls=f;this._type="bangpai-video";this._title="\u89c6\u9891\u5c5e\u6027";this._bodyHtml="<table><tr><td colspan='2'>\u9700\u8981\u5206\u4eab\u7684\u89c6\u9891\u94fe\u63a5\uff1a\u652f\u6301 \u571f\u8c46\uff0c\u4f18\u9177\uff0cku6 \u89c6\u9891\u5206\u4eab</td></tr><tr><td colspan='2'><label><span style='color:#0066CC;font-weight:bold;'>\u89c6\u9891\u94fe\u63a5\uff1a </span><input class='ke-video-url' style='width:230px' value='http://'/></label></td></tr><tr><td><label>\u5bbd\u5ea6\uff1a </span> <input  data-verify='^\u81ea\u52a8|((?!0$)\\d+(.\\d+)?)$'  data-warning='\u5bbd\u5ea6\u8bf7\u8f93\u5165\u6b63\u6570' class='ke-video-width' style='width:60px' value='\u81ea\u52a8'/> \u50cf\u7d20 </label></td><td><label> \u9ad8\u5ea6\uff1a </span> <input  data-verify='^\u81ea\u52a8|((?!0$)\\d+(.\\d+)?)$'  data-warning='\u9ad8\u5ea6\u8bf7\u8f93\u5165\u6b63\u6570' class='ke-video-height' style='width:60px' value='\u81ea\u52a8'/> \u50cf\u7d20 </label></td></tr><tr><td><label>\u5bf9\u9f50\uff1a <select class='ke-video-align'><option value=''>\u65e0</option><option value='left'>\u5de6\u5bf9\u9f50</option><option value='right'>\u53f3\u5bf9\u9f50</option></select></td><td><label>\u95f4\u8ddd\uff1a </span> <input  data-verify='^\\d+(.\\d+)?$'  data-warning='\u95f4\u8ddd\u8bf7\u8f93\u5165\u975e\u8d1f\u6570\u5b57' class='ke-video-margin' style='width:60px' value='5'/> \u50cf\u7d20</label></td></tr></table>";
this._footHtml="<button class='ke-video-ok'>\u786e\u5b9a</button> <button class='ke-video-cancel'>\u53d6\u6d88</button>";this._contentCls="ke-toolbar-video";this._tip="\u63d2\u5165\u89c6\u9891";this._contextMenu=o;this._flashRules=e},_initD:function(){var a=this,d=a.d;a.dUrl=d.el.one(".ke-video-url");a.dAlign=d.el.one(".ke-video-align");a.dMargin=d.el.one(".ke-video-margin");a.dWidth=d.el.one(".ke-video-width");a.dHeight=d.el.one(".ke-video-height");var p=d.el.one(".ke-video-ok");d=d.el.one(".ke-video-cancel");
p.on("click",a._gen,a);d.on("click",function(){a.d.hide()})},_getDInfo:function(){var a=this.dUrl.val(),d=h(a);if(d)if(a=d.detect(a))return{url:a,attrs:{height:parseInt(this.dHeight.val())||d.height,width:parseInt(this.dWidth.val())||d.width,align:this.dAlign.val(),style:"margin:"+(parseInt(this.dMargin.val())||0)+"px;"}};else alert("http://");else alert("\u4e0d\u652f\u6301\u8be5\u94fe\u63a5\u6765\u6e90!")},_updateD:function(){var a=this.editor,d=this.selectedFlash;if(d){a=a.restoreRealElement(d);
this.dUrl.val(this._getFlashUrl(a));this.dAlign.val(a.attr("align"));this.dMargin.val(parseInt(a._4e_style("margin"))||0);this.dWidth.val(a.attr("width"));this.dHeight.val(a.attr("height"))}else{this.dUrl.val("http://");this.dAlign.val("");this.dMargin.val("5");this.dWidth.val("\u81ea\u52a8");this.dHeight.val("\u81ea\u52a8")}}});j.registerBubble("bangpai-video","\u89c6\u9891\u94fe\u63a5\uff1a ",c);i.BangPaiVideo=b;var o={"\u89c6\u9891\u5c5e\u6027":function(a){var d=a.getSelection();d=(d=d&&d.getStartElement())&&
c(d);a=a._toolbars["bangpai-video"];d&&a.show(null,d)}}}();k.addPlugin(function(){new i.BangPaiVideo(k)})},{attach:false,requires:["flashsupport"]});
