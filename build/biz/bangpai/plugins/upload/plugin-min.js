KISSY.Editor.add("bangpai-upload",function(p){var e=KISSY,h=e.Editor;if(!h.BangPaiUpload){(function(){function l(a){this.editor=a;this._init()}var q=e.DOM,g=e.Node,m=[],t=h.Config.base+h.Utils.debugUrl("biz/bangpai/plugins/upload/uploader.swf");g=e.Node;var i={};name="ke-bangpai-upload";q.addStyleSheet(".ke-upload-list {width:90%;margin:10px auto;}.ke-upload-list td {padding:0.5em;}","ke-BangPaiUpload");e.augment(l,e.EventTarget,{_init:function(){var a=this.editor.cfg.pluginConfig["bangpai-upload"],
b=a.holder,c=e.isString(b)?e.one(b):b,d=(new g("<div style='position:relative'>")).appendTo(c);b=(new g("<button disabled='disabled'>选择文件</button>")).appendTo(d);var n=(new g("<button>清除列表</button>")).appendTo(d),k=b.offset(),r=d.offset();d=(new g("<div style='"+("position:absolute;top:"+(r.top-k.top)+"px;left:"+(r.left-k.left)+"px;width:"+b.width()+"px;height:"+b.height()+"px;z-index:9999;")+"'>")).appendTo(d);var o=(new g("<div><table class='ke-upload-list'><tbody></tbody></table></div>")).appendTo(c).one("tbody");
c=(new g("<p><button>开始上传</button></p>")).appendTo(c).one("button");k=e.guid(name);m[k]=this;this.btn=b;this.up=c;this.on("contentReady",this._ready,this);var s=h.Utils.flash.createSWFRuntime(t,{holder:d,attrs:{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale",width:b.width(),height:b.height()},flashVars:{allowedDomain:location.hostname,shareData:true,swfID:k,jsEntry:"KISSY.Editor.BangPaiUpload.EventHandler",browser:name,useCompression:true,hand:true,btn:true}});this.flash=s;this._list=
o;this._ds=a.serverUrl;this._dsp=a.serverParams||{};o.on("click",function(f){var j=new g(f.target);f.halt();if(!j.hasClass("ke-upload-insert"))if(j.hasClass("ke-upload-delete")){f=j.parent("tr");j=f.attr("fid");s.removeFile(j);i[j].destroy();delete i[j];f._4e_remove()}});n.on("click",function(){for(var f in i)i.hasOwnProperty(f)&&i[f].destroy();for(i={};f=o[0].firstChild;)q._4e_remove(f)});this.on("select",this._onSelect,this);this.on("progress",this._onProgress,this);this.on("complete",this._onComplete,
this);this.on("uploadCompleteData",this._onUploadCompleteData,this)},_onComplete:function(a){console.log("_onComplete",a)},_onUploadCompleteData:function(a){console.log("_onUploadCompleteData",a)},_onProgress:function(a){console.log("_onProgress",a)},_onSelect:function(a){var b=this._list;if(a=a.files)for(var c=0;c<a.length;c++){var d=a[c],n=(new g("<tr fid='"+d.fid+"'><td>"+d.name+"</td><td>"+Math.floor(d.size/1E3)+"k</td><td class='ke-upload-progress'></td><td><a href='#' class='ke-upload-insert' style='display:none'>[插入]</a> &nbsp; <a href='#' class='ke-upload-delete'>[取消/删除]</a> &nbsp; </td></tr>")).appendTo(b);
i[d.fid]=new h.ProgressBar({container:n.one(".ke-upload-progress"),width:"100px",height:"18px"})}},_ready:function(){var a=this,b=a.flash,c=a.up;a.btn[0].disabled=false;b.browse(true,[{desc:"图片文件( png,jpg,jpeg,gif )",ext:"*.jpeg;*.jpg;*.png;*.gif"}]);c.on("click",function(){b.upload(a._ds,a._dsp,true)})},_eventHandler:function(a){var b=a.type;console.log(b);if(b==="log")e.log(a.message);else b&&this.fire(b,a)}});l.EventHandler=function(a,b){m[a]._eventHandler.call(m[a],b)};h.BangPaiUpload=l})();p.addPlugin(function(){new h.BangPaiUpload(p)})}},
{attach:false,requires:["flashutils","progressbar"]});
