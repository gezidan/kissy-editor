/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-03 15:06:45
*/
KISSY.add("editor",function(c,w){function i(a,d){function x(e){for(var m=i.Env.mods,g=0;g<e.length;g++){for(var f=e[g],k=q,n=0;n<g;n++)if(f==e[n]){k=r;break}n=m[f];if(k&&n){k=c.clone(n);f=f+"_"+g;k.name=f;e[g]=f;m[f]||(m[f]=k)}}}var b=this;if(!(b instanceof i))return new i(a,d);if(c.isString(a))a=c.one(a);a=y._4e_wrap(a);d=d||{};d.pluginConfig=d.pluginConfig||{};b.cfg=d;d.pluginConfig=d.pluginConfig;b.cfg=d;c.app(b,c.EventTarget);var t=["htmldataprocessor","enterkey","clipboard"],s=q;b.use=function(e,
m){e=e.split(",");x(e);if(!s)for(var g=0;g<t.length;g++){var f=t[g];c.inArray(f,e)||e.unshift(f)}c.use.call(b,e.join(","),function(){b.ready(function(){m&&m.call(b);if(!s){b.setData(a.val());if(d.focus)b.focus();else{var k=b.getSelection();k&&k.removeAllRanges()}b.fire("save");s=r}})},{order:r,global:i});return b};b.use=b.use;b.init(a);return b}function u(a){var d=c.Config.debug;a=d?d==="dev"?"../src/"+a:a:a.replace(/\.(js|css)/i,"-min.$1");a+=a.indexOf("?")!=-1?"&":"?";a+="t="+encodeURIComponent("2010-12-03 15:06:45");
return a}var y=c.DOM,r=true,q=false;c.app(i,c.EventTarget);i.Config.base=c.Config.base+"editor/";var l=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],j,p,h,o,v={};j=0;for(p=l.length;j<p;j++){h=l[j];if(c.isString(h))h=l[j]={name:h+"",requires:null};o=h.requires||[];h.requires=o.concat(["button"])}l=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar",{name:"contextmenu"},{name:"bubbleview"},{name:"select"}].concat(l);
j=0;for(p=l.length;j<p;j++){h=l[j];o=h.name;v[o]={attach:q,charset:"utf-8",requires:h.requires,csspath:h.useCss?u("plugins/"+o+"/plugin.css"):w,path:u("plugins/"+o+"/plugin.js")}}i.add(v);c.Editor=i;c.Editor=i});
