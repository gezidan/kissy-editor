KISSY.add("editor",function(x,H){function I(g,p){function a(m){for(var l=I.Env.mods,c=0;c<m.length;c++){for(var f=m[c],i=false,k=0;k<c;k++)if(f==m[k]){i=true;break}k=l[f];if(i&&k){i=x.clone(k);f=f+"_"+c;i.name=f;m[c]=f;l[f]||(l[f]=i)}}}var b=this;if(!(b instanceof I))return new I(g,p);if(x.isString(g))g=x.one(g);g=D._4e_wrap(g);p=p||{};p.pluginConfig=p.pluginConfig||{};b.cfg=p;x.app(b,x.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],e=false;b.use=function(m,l){m=m.split(",");a(m);
for(var c=0;c<d.length;c++){var f=d[c];x.inArray(f,m)||m.unshift(f)}x.use.call(b,m.join(","),function(){b.ready(function(){l&&l.call(b);if(!e){b.setData(g.val());if(p.focus)b.focus();else{var i=b.getSelection();i&&i.removeAllRanges()}b.fire("save");e=true}})},{order:true,global:I});return b};b.init(g)}function y(g){if(!E)return g.replace(/\.(js|css)/i,"-min.$1");if(E==="dev")return"../src/"+g;return g}var D=x.DOM;x.app(I,x.EventTarget);I.Config.base=x.Config.base+"editor/";var E=x.Config.debug,n=
{htmlparser:{attach:false,path:y("plugins/htmldataprocessor/htmlparser/htmlparser.js?t=2010-10-25 21:12:12")}},r=["utils","focusmanager","definition","dtd","dom","elementpath","walker","range","domiterator","selection","styles"],h=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},
{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",requires:["flash/support"]},{name:"flash/dialog",requires:["flash"]},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","overlay","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor",requires:["htmlparser-text"]},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["overlay","tabs"]},"indent","justify",{name:"link",
requires:["bubbleview"]},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["overlay","contextmenu"]},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],j=[{name:"htmlparser-basicwriter",requires:["htmlparser"]},{name:"htmlparser-element",requires:["htmlparser-fragment"]},{name:"htmlparser-filter",
requires:["htmlparser-element"]},{name:"htmlparser-fragment",requires:["htmlparser-htmlwriter"]},{name:"htmlparser-htmlwriter",requires:["htmlparser-basicwriter"]},{name:"htmlparser-text",requires:["htmlparser-comment"]},{name:"htmlparser-comment",requires:["htmlparser-filter"]}],s,t,A,u;s=0;for(t=h.length;s<t;s++){A=h[s];if(x.isString(A))A=h[s]={name:A};A.requires=A.requires||[];A.requires=A.requires.concat(["button"])}h=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},
{name:"dd"},{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(h);s=0;for(t=h.length;s<t;s++){A=h[s];u=A.name;n[u]={attach:false,charset:"utf-8",requires:A.requires,csspath:A.useCss?y("plugins/"+u+"/plugin.css?t=2010-10-25 21:12:12"):H,path:y("plugins/"+u+"/plugin.js?t=2010-10-25 21:12:12")}}s=0;for(t=j.length;s<t;s++){A=j[s];h=H;if(!x.isString(A)){h=A.requires;A=A.name}n[A]={attach:false,
charset:"utf-8",requires:h,path:y("plugins/htmldataprocessor/htmlparser/"+A.substring(11)+".js?t=2010-10-25 21:12:12")}}s=0;for(t=r.length;s<t;s++){A=r[s];n[A]={host:"editor",requires:s>0?r[s-1]:[]}}I.add(n);x.Editor=I});
KISSY.Editor.add("utils",function(x){var H=KISSY,I=H.Node,y=H.DOM,D=H.UA,E=H.Event;x.Utils={debugUrl:function(n){var r=H.Config.debug;if(!r)return n.replace(/\.(js|css)/i,"-min.$1");if(r==="dev")return"../src/"+n;return n},lazyRun:function(n,r,h){var j=n[r],s=n[h];n[r]=function(){j.apply(this,arguments);n[r]=n[h];return s.apply(this,arguments)}},getXY:function(n,r,h,j){h=h.defaultView||h.parentWindow;n-=y.scrollLeft(h);r-=y.scrollTop(h);if(j)if(h!=(j.defaultView||j.parentWindow)&&h.frameElement){j=
y._4e_getOffset(h.frameElement,j);n+=j.left;r+=j.top}return{left:n,top:r}},tryThese:function(){for(var n,r=0,h=arguments.length;r<h;r++){var j=arguments[r];try{n=j();break}catch(s){}}return n},arrayCompare:function(n,r){if(!n&&!r)return true;if(!n||!r||n.length!=r.length)return false;for(var h=0;h<n.length;h++)if(n[h]!==r[h])return false;return true},getByAddress:function(n,r,h){n=n.documentElement;for(var j=0;n&&j<r.length;j++){var s=r[j];if(h)for(var t=-1,A=0;A<n.childNodes.length;A++){var u=n.childNodes[A];
if(!(h===true&&u.nodeType==3&&u.previousSibling&&u.previousSibling.nodeType==3)){t++;if(t==s){n=u;break}}}else n=n.childNodes[s]}return n?new I(n):null},clearAllMarkers:function(n){for(var r in n)n[r]._4e_clearMarkers(n,true)},htmlEncodeAttr:function(n){return n.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(n){return n.replace(/^\s+/,"")},rtrim:function(n){return n.replace(/\s+$/,"")},trim:function(n){return this.ltrim(this.rtrim(n))},mix:function(){for(var n={},
r=0;r<arguments.length;r++)n=H.mix(n,arguments[r]);return n},isCustomDomain:function(){if(!D.ie)return false;var n=document.domain,r=window.location.hostname;return n!=r&&n!="["+r+"]"},duplicateStr:function(n,r){return Array(r+1).join(n)},throttle:function(n,r,h){h=h||150;if(h===-1)return function(){n.apply(r,arguments)};var j=(new Date).getTime();return function(){var s=(new Date).getTime();if(s-j>h){j=s;n.apply(r,arguments)}}},buffer:function(n,r,h){h=h||0;var j=null;return function(){j&&clearTimeout(j);
var s=arguments;j=setTimeout(function(){return n.apply(r,s)},h)}},isNumber:function(n){return/^\d+(.\d+)?$/.test(H.trim(n))},verifyInputs:function(n){for(var r=0;r<n.length;r++){var h=y._4e_wrap(n[r]),j=H.trim(h.val()),s=h.attr("data-verify");h=h.attr("data-warning");if(s&&!RegExp(s).test(j)){alert(h);return}}return true},sourceDisable:function(n,r){n.on("sourcemode",r.disable,r);n.on("wysiwygmode",r.enable,r)},resetInput:function(n){var r=n.attr("placeholder");if(r&&!D.webkit){n.val(r);n.addClass("ke-input-tip")}else D.webkit&&
n.val("")},placeholder:function(n,r){n.attr("placeholder",r);if(!D.webkit){n.on("blur",function(){if(!H.trim(n.val())){n.val(r);n.addClass("ke-input-tip")}});n.on("focus",function(){H.trim(n.val())==r&&n.val("");n.removeClass("ke-input-tip")})}},clean:function(n){n=n[0]||n;for(var r=H.makeArray(n.childNodes),h=0;h<r.length;h++){var j=r[h];j.nodeType==x.NODE.NODE_TEXT&&!H.trim(j.nodeValue)&&n.removeChild(j)}},htmlEncode:function(n){return!n?n:String(n).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,
"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(n){return!n?n:String(n).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(n,r){return n.toLowerCase()==r.toLowerCase()},normParams:function(n){n=H.clone(n);for(var r in n)if(n.hasOwnProperty(r)){var h=n[r];if(H.isFunction(h))n[r]=h()}return n},doFormUpload:function(n,r,h){function j(){var a={responseText:"",responseXML:null};a.argument=n?n.argument:null;try{var b;if((b=D.ie?t.contentWindow.document:
t.contentDocument||window.frames[s].document)&&b.body)a.responseText=b.body.innerHTML;a.responseXML=b&&b.XMLDocument?b.XMLDocument:b}catch(d){}E.remove(t,"load",j);n.callback&&n.callback(a);setTimeout(function(){y._4e_remove(t)},100)}var s=H.guid("form-upload-"),t=document.createElement("iframe");t.id=s;t.name=s;t.className="ke-hidden";if(D.ie)t.src="javascript:false";document.body.appendChild(t);if(D.ie)document.frames[s].name=s;var A=y._4e_unwrap(n.form),u={target:A.target,method:A.method,encoding:A.encoding,
enctype:A.enctype,action:A.action};A.target=s;A.method="POST";A.enctype=A.encoding="multipart/form-data";if(h)A.action=h;var g;if(r){g=[];r=x.Utils.normParams(r);for(var p in r)if(r.hasOwnProperty(p)){h=document.createElement("input");h.type="hidden";h.name=p;h.value=r[p];A.appendChild(h);g.push(h)}}E.on(t,"load",j);A.submit();A.target=u.target;A.method=u.method;A.enctype=u.enctype;A.encoding=u.encoding;A.action=u.action;if(g){r=0;for(A=g.length;r<A;r++)y._4e_remove(g[r])}}}});
KISSY.Editor.add("focusmanager",function(x){function H(){this.iframeFocus=true;r=this}function I(){this.iframeFocus=false;r=null}var y=KISSY,D=y.DOM,E=y.Event;y={};var n={},r;y={refreshAll:function(){for(var h in n){var j=n[h];j.document.designMode="off";j.document.designMode="on"}},currentInstance:function(){return r},getInstance:function(h){return n[h]},add:function(h){var j=D._4e_getWin(h.document);E.on(j,"focus",H,h);E.on(j,"blur",I,h)},register:function(h){n[h._UUID]=h},remove:function(h){delete n[h._UUID];
var j=D._4e_getWin(h.document);E.remove(j,"focus",H,h);E.remove(j,"blur",I,h)}};x.focusManager=y;x.getInstances=function(){return n}});
KISSY.Editor.add("definition",function(x){function H(g,p){return j+"<html><head><title>${title}</title><link href='"+x.Config.base+s+"' rel='stylesheet'/><style>"+(p||"")+"</style></head><body class='ke-editor'>&nbsp;"+(g?'<script id="ke_actscript" type="text/javascript">'+(x.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+g+'");<\/script>':"")+"</body></html>"}var I=KISSY,y=I.UA,D=I.DOM,E=I.Node,n=I.Event,r=x.focusManager,h=x.Utils.tryThese,
j="<!doctype html>",s=x.Utils.debugUrl("theme/editor-iframe.css"),t=1,A="document.open();"+(x.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();",u="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(y.ie?"javascript:void(function(){"+encodeURIComponent(A)+
"}())":"")+'"  tabIndex="'+(y.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";x.SOURCE_MODE=0;x.WYSIWYG_MODE=1;I.augment(x,{init:function(g){if(y.ie)D.addClass(document.body,"ie"+y.ie);else if(y.gecko)D.addClass(document.body,"gecko");else y.webkit&&D.addClass(document.body,"webkit");var p=this,a=new E(u.replace(/\$\(tabIndex\)/,g.attr("tabIndex")));a.on("mousedown",function(e){if(y.webkit){var m=D._4e_name(e.target);
if(m=="select"||m=="option")return true}e.halt()});g.on("mousedown",function(e){e.stopPropagation()});p.editorWrap=a;p._UUID=t++;r.register(p);p.wrap=a.one(".ke-textarea-wrap");p.iframe=p.wrap.one("iframe");p.toolBarDiv=a.one(".ke-editor-tools");p.textarea=g;p.statusDiv=a.one(".ke-editor-status");p.toolBarDiv._4e_unselectable();p._commands={};p._dialogs={};var b=g._4e_style("width"),d=g._4e_style("height");if(b){a.css("width",b);g.css("width","100%")}p.textarea.css("display","none");a.insertAfter(g);
p.wrap[0].appendChild(g[0]);if(d){p.wrap.css("height",d);g.css("height","100%")}a=p.iframe;p.on("dataReady",function(){p._ready=true;x.fire("instanceCreated",{editor:p})});y.gecko?a.on("load",p._setUpIFrame,p):p._setUpIFrame();p.cfg.attachForm&&g[0].form&&p._attachForm()},_attachForm:function(){(new E(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(g,p){var a=this,b=x.SimpleOverlay;b.loading();a.use(g,function(){var d=a.getDialog(g);p(d);b.unloading()})},addDialog:function(g,
p){this._dialogs[g]=p},getDialog:function(g){return this._dialogs[g]},addPlugin:function(g){this.ready(g)},addCommand:function(g,p){this._commands[g]=p},hasCommand:function(g){return this._commands[g]},execCommand:function(g){var p=this._commands[g],a=I.makeArray(arguments);a.shift();a.unshift(this);return p.exec.apply(p,a)},getMode:function(){return this.textarea.css("display")=="none"?x.WYSIWYG_MODE:x.SOURCE_MODE},getData:function(g){var p;if(this.getMode()==x.WYSIWYG_MODE){p=this.document.body.innerHTML;
if(this.htmlDataProcessor)p=this.htmlDataProcessor.toHtml(p,"p")}else p=this.textarea.val();if(!g){p=p||"";p=p.replace(/\s+/g," ")}return p},setData:function(g){var p;if(this.htmlDataProcessor)p=this.htmlDataProcessor.toDataFormat(g,"p");this.document.body.innerHTML=p;this.getMode()!=x.WYSIWYG_MODE&&this.textarea.val(g)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(g){g=g||0;return g+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},_setRawData:function(g){this.document.body.innerHTML=
g},_prepareIFrameHtml:H,getSelection:function(){var g=new x.Selection(this.document);return!g||g.isInvalid?null:g},focus:function(){var g=this.doc,p=D._4e_getWin(g);y.webkit&&p&&p.parent&&p.parent.focus();p&&p.focus();g&&g.body.focus();this.notifySelectionChange()},blur:function(){D._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(g){var p=this.cfg,a=this.document;p.customStyle=p.customStyle||"";p.customStyle+="\n"+g;p=a.createElement("style");a.getElementsByTagName("head")[0].appendChild(p);
if(p.styleSheet)p.styleSheet.cssText=g;else p.appendChild(a.createTextNode(g))},_setUpIFrame:function(){function g(){e=d.document;p.document=e;a.detach();e.open("text/html","replace");e.write(b);e.close()}var p=this,a=p.iframe,b=H(p._UUID,p.cfg.customStyle),d=a[0].contentWindow,e;try{e=d.document}catch(m){a[0].src=a[0].src;if(y.ie<7){setTimeout(g,10);return}}g()},ready:function(g){this._ready?g():this.on("dataReady",g)},_monitor:function(){var g=this;g._monitorId&&clearTimeout(g._monitorId);g._monitorId=
setTimeout(function(){var p=g.getSelection();if(p&&!p.isInvalid){var a=p.getStartElement(),b=new x.ElementPath(a);if(!g.previousPath||!g.previousPath.compare(b)){g.previousPath=b;g.fire("selectionChange",{selection:p,path:b,element:a})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(g,p){var a=this;a.focus();var b=g._4e_name(),d=x.XHTML_DTD,e=x.RANGE,m=x.NODE,l=d.$block[b],c=a.getSelection(),f=c.getRanges(),i,k,o,z,K;a.fire("save");for(var J=
f.length-1;J>=0;J--){i=f[J];i.deleteContents();k=!J&&g||g._4e_clone(true);p&&p(k);if(l)for(;(z=i.getCommonAncestor(false,true))&&(K=d[z._4e_name()])&&!(K&&K[b]);)if(z._4e_name()in d.span)i.splitElement(z);else if(i.checkStartOfBlock()&&i.checkEndOfBlock()){i.setStartBefore(z);i.collapse(true);z._4e_remove()}else i.splitBlock();i.insertNode(k);o||(o=k)}b=o._4e_nextSourceNode(true);d=a.document;K=x.XHTML_DTD;if(K.$inline[k._4e_name()]){b=new E(d.createTextNode(" "));b.insertAfter(o)}else if(b){if(b._4e_name()==
"br"&&K[b.parent()._4e_name()].p){K=new E("<p>&nbsp;</p>",null,d);b[0].parentNode.replaceChild(K[0],b[0]);b=K}}else{K=new E("<p>&nbsp;</p>",null,d);K.insertAfter(o);b=K}i.moveToPosition(o,e.POSITION_AFTER_END);b&&b[0].nodeType==m.NODE_ELEMENT&&i.moveToElementEditablePosition(b);c.selectRanges([i]);a.focus();k&&k._4e_scrollIntoView();setTimeout(function(){a.fire("save")},10);return k},insertHtml:function(g){var p=this;if(p.htmlDataProcessor)g=p.htmlDataProcessor.toDataFormat(g);if(y.webkit){g=D.create(g,
null,this.document);g=g.nodeType==11?I.makeArray(g.childNodes):[g];for(var a=0;a<g.length;a++)p.insertElement(new E(g[a]))}else{p.focus();p.fire("save");a=p.getSelection();if(y.ie){a=a.getNative();a.type=="Control"&&a.clear();a.createRange().pasteHTML(g)}else p.document.execCommand("inserthtml",false,g);p.focus();setTimeout(function(){p.fire("save")},10)}}});x._initIFrame=function(g){function p(k){h(function(){d.designMode="on";setTimeout(function(){d.designMode="off";l.focus();if(!arguments.callee.retry)arguments.callee.retry=
true},50)},function(){d.designMode="off";D.attr(l,"contentEditable",false);D.attr(l,"contentEditable",true);!k&&p(1)})}var a=r.getInstance(g);g=a.textarea[0];var b=a.iframe[0].contentWindow,d=a.document,e=a.cfg,m=d.getElementById("ke_actscript");D._4e_remove(m);var l=d.body;if(y.ie){l.hideFocus=true;l.disabled=true;l.contentEditable=true;l.removeAttribute("disabled")}else setTimeout(function(){if(y.gecko||y.opera)l.contentEditable=true;else if(y.webkit)l.parentNode.contentEditable=true;else d.designMode=
"on"},0);if(y.webkit){n.on(d,"click",function(k){var o=new E(k.target);I.inArray(o._4e_name(),["input","select"])&&k.preventDefault()});n.on(d,"mouseup",function(k){var o=new E(k.target);I.inArray(o._4e_name(),["input","textarea"])&&k.preventDefault()})}if(y.gecko||y.ie||y.opera){var c;c=new E(D.insertAfter((new E('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],g));c.on("focus",function(){a.focus()});a.activateGecko=function(){y.gecko&&a.iframeFocus&&
c[0].focus()};a.on("destroy",function(){})}if(y.ie&&d.compatMode=="CSS1Compat"||y.gecko||y.opera){var f=new E(d.documentElement);f.on("mousedown",function(k){if(k.target==f[0]){y.gecko&&p(false);c[0].focus()}})}n.on(b,"focus",function(){if(y.gecko)p(false);else y.opera&&l.focus();a.notifySelectionChange()});y.gecko&&n.on(a.document,"mousedown",function(){a.iframeFocus||p(false)});if(y.ie){n.on(d,"keydown",function(k){if(k.keyCode in{8:1,46:1}){var o=a.getSelection(),z=o.getSelectedElement();if(z){a.fire("save");
var K=o.getRanges()[0].createBookmark();z._4e_remove();o.selectBookmarks([K]);a.fire("save");k.preventDefault()}}});if(d.compatMode=="CSS1Compat"){var i={33:1,34:1};n.on(d,"keydown",function(k){k.keyCode in i&&setTimeout(function(){a.getSelection().scrollIntoView()},0)})}}setTimeout(function(){y.ie&&setTimeout(function(){if(d){l.runtimeStyle.marginBottom="0px";l.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){a.fire("dataReady");var k=e.disableObjectResizing,o=e.disableInlineTableEditing;
if(k||o)try{d.execCommand("enableObjectResizing",false,!k);d.execCommand("enableInlineTableEditing",false,!o)}catch(z){n.on(l,y.ie?"resizestart":"resize",function(K){if(k||D._4e_name(K.target)==="table"&&o)K.preventDefault()})}},10);y.webkit&&n.on(d,"mousedown",function(k){k=new E(k.target);I.inArray(k._4e_name(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(k)});y.gecko&&n.on(d,"dragstart",function(k){var o=new E(k.target);o._4e_name()==="img"&&/ke_/.test(o[0].className)&&
k.preventDefault()});r.add(a)};x.baseZIndex=function(g){var p=g,a=x.getInstances(),b;for(b in a){if(!a.hasOwnProperty(b))return;p=Math.max(p,a[b].baseZIndex(g))}return p}});
KISSY.Editor.add("dtd",function(x){x.XHTML_DTD=function(){var H=function(l){for(var c=arguments.length-1;c>0;)KISSY.mix(l,arguments[c--]);return l},I={isindex:1,fieldset:1},y={input:1,button:1,select:1,textarea:1,label:1},D=H({a:1},y),E=H({iframe:1},D),n={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},r={ins:1,del:1,script:1,style:1},h=H({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},r),j=H({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},h),s=H({p:1},j);y=H({iframe:1},j,y);j={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var t=H({a:1},y),A={tr:1},u={"#":1},g=H({param:1},j),p=H({form:1},I,E,n,s),a={li:1},b={base:1,link:1,meta:1,title:1},d=H(b,{style:1,script:1}),e={head:1,body:1},m={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:H({html:1},e,b),$block:m,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:t,$body:H({script:1,style:1},m),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:e,head:d,style:u,body:p,base:{},link:{},meta:{},title:u,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:p,td:p,br:{},th:p,center:p,kbd:t,button:H(s,n),basefont:{},h5:t,h4:t,samp:t,h6:t,ol:a,h1:t,h3:t,option:u,h2:t,form:H(I,E,n,s),select:{optgroup:1,option:1},font:t,ins:t,menu:a,abbr:t,label:t,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:t,script:u,tfoot:A,cite:t,li:p,input:{},iframe:p,strong:t,textarea:u,noframes:p,big:t,small:t,span:t,hr:{},dt:t,sub:t,optgroup:{option:1},param:{},bdo:t,"var":t,div:p,object:g,sup:t,dd:p,strike:t,area:{},dir:a,map:H({area:1,form:1,p:1},I,r,n),applet:g,dl:{dt:1,dd:1},del:t,isindex:{},fieldset:H({legend:1},j),thead:A,ul:a,acronym:t,b:t,a:y,blockquote:p,caption:t,i:t,u:t,tbody:A,s:t,address:H(E,s),tt:t,legend:t,q:t,pre:H(h,D),p:t,em:t,dfn:t}}()});
KISSY.Editor.add("dom",function(x){function H(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var I=KISSY,y=I.DOM,D=I.UA,E=I.Node,n=x.Utils,r={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};x.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};x.POSITION={};var h=x.NODE,j=x.POSITION;j.POSITION_IDENTICAL=0;j.POSITION_DISCONNECTED=
1;j.POSITION_FOLLOWING=2;j.POSITION_PRECEDING=4;j.POSITION_IS_CONTAINED=8;j.POSITION_CONTAINS=16;var s={},t={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},A={hr:1},u=function(a){return a[0]||a},g=function(a){if(a&&!a[0])return new E(a);return a},p={_4e_wrap:g,_4e_unwrap:u,_4e_equals:function(a,b){if(!a&&!b)return true;if(!a||!b)return false;a=u(a);b=u(b);return a===
b},_4e_isBlockBoundary:function(a,b){a=g(a);var d=I.mix(I.mix({},A),b||{});return t[a.css("display")]||d[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=u(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},_4e_first:function(a,b){a=u(a);var d=a.firstChild;if((d=d&&new E(d))&&b&&!b(d))d=d._4e_next(b);return d},_4e_move:function(a,b,d){a._4e_remove();a=u(a);
b=u(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},_4e_name:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(D.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},_4e_isIdentical:function(a,b){if(a._4e_name()!=b._4e_name())return false;var d=a[0].attributes,e=b[0].attributes,m=d.length,l=e.length;if(!D.ie&&m!=l)return false;for(var c=0;c<m;c++){var f=d[c];if((!D.ie||f.specified&&f.nodeName!="_ke_expando")&&f.nodeValue!=b.attr(f.nodeName))return false}if(D.ie)for(c=0;c<l;c++){f=
e[c];if(f.specified&&f.nodeName!="_ke_expando"&&f.nodeValue!=a.attr(f.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=u(a).childNodes;for(var b=0,d=a.length;b<d;b++){var e=a[b],m=e.nodeType;if(!(m==h.NODE_ELEMENT&&e.getAttribute("_ke_bookmark")))if(m==h.NODE_ELEMENT&&!p._4e_isEmptyInlineRemoveable(e)||m==h.NODE_TEXT&&I.trim(e.nodeValue))return false}return true},_4e_moveChildren:function(a,b,d){a=u(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},_4e_mergeSiblings:function(){function a(b,d,e){if(d[0]&&d[0].nodeType==h.NODE_ELEMENT){for(var m=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemoveable();){m.push(d);d=e?new E(d[0].nextSibling):new E(d[0].previousSibling);if(!d[0]||d[0].nodeType!=h.NODE_ELEMENT)return}if(b._4e_isIdentical(d)){for(var l=e?b[0].lastChild:b[0].firstChild;m.length;)m.shift()._4e_move(b,!e);d._4e_moveChildren(b,!e);d._4e_remove();l[0]&&l[0].nodeType==
h.NODE_ELEMENT&&l._4e_mergeSiblings()}}}return function(b){if(b[0])if(r[b._4e_name()]||b._4e_name()=="a"){a(b,new E(b[0].nextSibling),true);a(b,new E(b[0].previousSibling))}}}(),_4e_unselectable:D.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:D.webkit?function(a){a=u(a);a.style.KhtmlUserSelect="none"}:function(a){a=u(a);if(D.ie||D.opera){var b,d=0;for(a.unselectable="on";b=a.all[d++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable=
"on"}}},_4e_getOffset:function(a,b){a=u(a);var d,e=0;d=0;var m=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,l=a.ownerDocument,c=l.documentElement;b=b||l;if(a.getBoundingClientRect){if(a!==l.body&&c!==a){d=a.getBoundingClientRect();e=d.left+(b===l?y.scrollLeft(m):0);d=d.top+(b===l?y.scrollTop(m):0)}if(b)if(m!=(b.defaultView||b.parentWindow)&&m.frameElement){m=p._4e_getOffset(m.frameElement,b);e+=m.left;d+=m.top}}return{left:e,top:d}},_4e_getFrameDocument:function(a){return(a=u(a))&&a.contentWindow.document},
_4e_splitText:function(a,b){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=h.NODE_TEXT)){if(D.ie&&b==a.nodeValue.length){var e=d.createTextNode("");y.insertAfter(e,a);return new E(e)}e=new E(a.splitText(b));if(D.ie==8){d=d.createTextNode("");y.insertAfter(d,e[0]);d.parentNode.removeChild(d)}return e}},_4e_parents:function(a,b){a=g(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},_4e_clone:function(a,b,d){a=u(a);a=a.cloneNode(b);if(!d){var e=function(m){if(m.nodeType==h.NODE_ELEMENT){m.removeAttribute("id",
false);m.removeAttribute("_ke_expando",false);m=m.childNodes;for(var l=0;l<m.length;l++)e(m[l])}};e(a)}return new E(a)},_4e_nextSourceNode:function(a,b,d,e){a=u(a);if(e&&!e.call){var m=e[0]||e;e=function(c){c=c[0]||c;return c!==m}}b=!b&&a.firstChild;var l=new E(a);if(!b){if(a.nodeType==h.NODE_ELEMENT&&e&&e(a,true)===false)return null;b=a.nextSibling}for(;!b&&(l=l.parent());){if(e&&e(l,true)===false)return null;b=l[0].nextSibling}if(!b)return null;b=y._4e_wrap(b);if(e&&e(b)===false)return null;if(d&&
d!=b[0].nodeType)return b._4e_nextSourceNode(false,d,e);return b},_4e_previousSourceNode:function(a,b,d,e){a=u(a);if(e&&!e.call){var m=e[0]||e;e=function(c){c=c[0]||c;return c!==m}}b=!b&&a.lastChild;var l=new E(a);if(!b){if(a.nodeType==h.NODE_ELEMENT&&e&&e(a,true)===false)return null;b=a.previousSibling}for(;!b&&(l=l.parent());){if(e&&e(l,true)===false)return null;b=l[0].previousSibling}if(!b)return null;b=y._4e_wrap(b);if(e&&e(b)===false)return null;if(d&&b[0].nodeType!=d)return b._4e_previousSourceNode(false,
d,e);return b},_4e_contains:D.ie||D.webkit?function(a,b){a=u(a);b=u(b);return b.nodeType!=h.NODE_ELEMENT?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=u(a);b=u(b);return!!(a.compareDocumentPosition(b)&16)},_4e_commonAncestor:function(a,b){if(a._4e_equals(b))return a;if(b[0].nodeType!=h.NODE_TEXT&&b._4e_contains(a))return b;var d=a[0].nodeType==h.NODE_TEXT?a.parent():a;do if(d[0].nodeType!=h.NODE_TEXT&&d._4e_contains(b))return d;while(d=d.parent());return null},_4e_ascendant:function(a,
b,d){a=u(a);if(!d)a=a.parentNode;if(b&&!I.isFunction(b)){var e=b;b=function(m){return m._4e_name()==e}}for(;a&&a.nodeType!=9;){if(!b||b(new E(a))===true)return new E(a);a=a.parentNode}return null},_4e_hasAttribute:function(a,b){a=u(a);var d=a.attributes.getNamedItem(b);return!!(d&&d.specified)},_4e_hasAttributes:D.ie?function(a){a=u(a);for(var b=a.attributes,d=0;d<b.length;d++){var e=b[d];switch(e.nodeName){case "class":if(a.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(e.specified)return true}}return false}:
function(a){a=u(a);D.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},_4e_position:function(a,b){var d=u(a),e=u(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(e);if(d==e)return j.POSITION_IDENTICAL;if(d.nodeType==h.NODE_ELEMENT&&e.nodeType==h.NODE_ELEMENT){if(d.contains){if(d.contains(e))return j.POSITION_CONTAINS+j.POSITION_PRECEDING;if(e.contains(d))return j.POSITION_IS_CONTAINED+j.POSITION_FOLLOWING}if("sourceIndex"in
d)return d.sourceIndex<0||e.sourceIndex<0?j.POSITION_DISCONNECTED:d.sourceIndex<e.sourceIndex?j.POSITION_PRECEDING:j.POSITION_FOLLOWING}d=a._4e_address();e=b._4e_address();for(var m=Math.min(d.length,e.length),l=0;l<=m-1;l++)if(d[l]!=e[l]){if(l<m)return d[l]<e[l]?j.POSITION_PRECEDING:j.POSITION_FOLLOWING;break}return d.length<e.length?j.POSITION_CONTAINS+j.POSITION_PRECEDING:j.POSITION_IS_CONTAINED+j.POSITION_FOLLOWING},_4e_address:function(a,b){a=u(a);for(var d=[],e=a.ownerDocument.documentElement,
m=a;m&&m!=e;){var l=m.parentNode,c=-1;if(l){for(var f=0;f<l.childNodes.length;f++){var i=l.childNodes[f];if(!(b&&i.nodeType==3&&i.previousSibling&&i.previousSibling.nodeType==3)){c++;if(i==m)break}}d.unshift(c)}m=l}return d},_4e_breakParent:function(a,b){var d=new x.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var e=d.extractContents();d.insertNode(a._4e_remove());a[0].parentNode.insertBefore(e,a[0].nextSibling)},_4e_style:function(a,b,d){if(d!==undefined)return a.css(b,d);a=a[0]||
a;return a.style[H(b)]},_4e_remove:function(a,b){var d=u(a),e=d.parentNode;if(e){if(b)for(var m;m=d.firstChild;)e.insertBefore(d.removeChild(m),d);e.removeChild(d)}return a},_4e_trim:function(a){y._4e_ltrim(a);y._4e_rtrim(a)},_4e_ltrim:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==h.NODE_TEXT){var d=n.ltrim(b.nodeValue),e=b.nodeValue.length;if(d){if(d.length<e){(new E(b))._4e_splitText(e-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){a=
u(a);for(var b;b=a.lastChild;){if(b.type==h.NODE_TEXT){var d=n.rtrim(b.nodeValue),e=b.nodeValue.length;if(d){if(d.length<e){(new E(b))._4e_splitText(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!D.ie&&!D.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},_4e_appendBogus:function(a){a=u(a);for(var b=a.lastChild;b&&b.nodeType==h.NODE_TEXT&&!I.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==h.NODE_TEXT||y._4e_name(b)!==
"br"){b=D.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");D.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},_4e_previous:function(a,b){var d=u(a),e;do e=(d=d.previousSibling)&&new E(d);while(e&&b&&!b(e));return e},_4e_last:function(a,b){a=y._4e_wrap(a);var d=a[0].lastChild;if((d=d&&new E(d))&&b&&!b(d))d=d._4e_previous(b);return d},_4e_next:function(a,b){var d=u(a),e;do e=(d=d.nextSibling)&&new E(d);while(e&&b&&!b(e));return e},_4e_outerHtml:function(a){a=u(a);
if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML},_4e_setMarker:function(a,b,d,e){a=y._4e_wrap(a);var m=a._4e_getData("list_marker_id")||a._4e_setData("list_marker_id",I.guid())._4e_getData("list_marker_id"),l=a._4e_getData("list_marker_names")||a._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");b[m]=a;l[d]=1;return a._4e_setData(d,e)},_4e_clearMarkers:function(a,b,d){a=g(a);
var e=a._4e_getData("list_marker_names"),m=a._4e_getData("list_marker_id"),l;for(l in e)a._4e_removeData(l);a._4e_removeData("list_marker_names");if(d){a._4e_removeData("list_marker_id");delete b[m]}},_4e_setData:function(a,b,d){var e=y._4e_getUniqueId(a);(s[e]||(s[e]={}))[b]=d;return a},_4e_getData:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");return(d=d&&s[d])&&d[b]},_4e_removeData:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");var e=(d=d&&s[d])&&d[b];typeof e!="undefined"&&
d&&delete d[b];I.isEmptyObject(d)&&y._4e_clearData(a);return e||null},_4e_clearData:function(a){a=u(a);var b=a.getAttribute("_ke_expando");b&&delete s[b];b&&a.removeAttribute("_ke_expando")},_4e_getUniqueId:function(a){a=u(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=I.guid();a.setAttribute("_ke_expando",b);return b},_4e_copyAttributes:function(a,b,d){a=u(a);var e=a.attributes;d=d||{};for(var m=0;m<e.length;m++){var l=e[m],c=l.nodeName.toLowerCase(),f;if(!(c in d))if(c=="checked"&&(f=y.attr(a,
c)))b.attr(c,f);else if(l.specified||D.ie&&l.nodeValue&&c=="value"){f=y.attr(a,c);if(f===null)f=l.nodeValue;b.attr(c,f)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=y._4e_name(a);var b=x.XHTML_DTD;return(a=!b.$nonEditable[a]&&(b[a]||b.span))&&a["#"]},_4e_scrollIntoView:function(a){a=g(a);var b=a[0].ownerDocument,d=y.scrollLeft(b),e=y.scrollTop(b),m=a.offset(),l=m.left;m=m.top;if(y.viewportHeight(b)+e<m||m<e||y.viewportWidth(b)+d<l||l<d)a.scrollIntoView(b)},
_4e_getElementsByTagName:function(a,b,d){a=u(a);if(!D.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new E(a[b]));return d}};I.DOM._4e_inject=function(a){I.mix(y,a);for(var b in a)a.hasOwnProperty(b)&&function(d){E.prototype[d]=function(){var e=[].slice.call(arguments,0);e.unshift(this);return a[d].apply(null,e)}}(b)};I.DOM._4e_inject(p)});
KISSY.Editor.add("elementpath",function(x){function H(j){var s=null,t=null,A=[];for(j=j;j&&j[0];){if(j[0].nodeType==E.NODE_ELEMENT){if(!this.lastElement)this.lastElement=j;var u=j._4e_name();if(n.ie&&j[0].scopeName!="HTML")u=j[0].scopeName.toLowerCase()+":"+u;if(!t){if(!s&&r[u])s=j;if(h[u]){var g;if(g=!s){if(g=u=="div"){a:{g=j;g=g[0]||g;g=g.childNodes;for(var p=0,a=g.length;p<a;p++){var b=g[p];if(b.nodeType==E.NODE_ELEMENT&&D.$block[b.nodeName.toLowerCase()]){g=true;break a}}g=false}g=!g}g=g}if(g)s=
j;else t=j}}A.push(j);if(u=="body")break}j=j.parent()}this.block=s;this.blockLimit=t;this.elements=A}var I=KISSY,y=I.DOM,D=x.XHTML_DTD,E=x.NODE,n=I.UA,r={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},h={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};H.prototype={compare:function(j){var s=this.elements;j=j&&j.elements;if(!j||s.length!=j.length)return false;for(var t=0;t<s.length;t++)if(!y._4e_equals(s[t],j[t]))return false;return true},contains:function(j){for(var s=
this.elements,t=0;t<s.length;t++)if(s[t]._4e_name()in j)return s[t];return null}};x.ElementPath=H});
KISSY.Editor.add("walker",function(x){function H(h,j){if(this._.end)return null;var s,t=this.range,A,u=this.guard,g=this.type,p=h?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;t.trim();if(t.collapsed){this.end();return null}}if(!h&&!this._.guardLTR){var a=t.endContainer,b=new r(a[0].childNodes[t.endOffset]);this._.guardLTR=function(l,c){return(l=n._4e_wrap(l))&&l[0]&&(!c||!n._4e_equals(a,l))&&(!b[0]||!l._4e_equals(b))&&(l[0].nodeType!=E.NODE_ELEMENT||!c||l._4e_name()!=
"body")}}if(h&&!this._.guardRTL){var d=t.startContainer,e=t.startOffset>0&&new r(d[0].childNodes[t.startOffset-1]);this._.guardRTL=function(l,c){return(l=n._4e_wrap(l))&&l[0]&&(!c||!l._4e_equals(d))&&(!e[0]||!l._4e_equals(e))&&(l[0].nodeType!=E.NODE_ELEMENT||!c||l._4e_name()!="body")}}var m=h?this._.guardRTL:this._.guardLTR;A=u?function(l,c){if(m(l,c)===false)return false;return u(l,c)}:m;if(this.current)s=this.current[p](false,g,A);else if(h){s=t.endContainer;if(t.endOffset>0){s=new r(s[0].childNodes[t.endOffset-
1]);if(A(s)===false)s=null}else s=A(s,true)===false?null:s._4e_previousSourceNode(true,g,A)}else{s=t.startContainer;if((s=new r(s[0].childNodes[t.startOffset]))&&s[0]){if(A(s)===false)s=null}else s=A(t.startContainer,true)===false?null:t.startContainer._4e_nextSourceNode(true,g,A)}for(;s&&s[0]&&!this._.end;){this.current=s;if(!this.evaluator||this.evaluator(s)!==false){if(!j)return s}else if(j&&this.evaluator)return false;s=s[p](false,g,A)}this.end();return this.current=null}function I(h){for(var j,
s=null;j=H.call(this,h);)s=j;return s}function y(h){this.range=h;this._={}}var D=KISSY,E=x.NODE,n=D.DOM,r=D.Node;D.augment(y,{end:function(){this._.end=1},next:function(){return H.call(this)},previous:function(){return H.call(this,true)},checkForward:function(){return H.call(this,false,true)!==false},checkBackward:function(){return H.call(this,true,true)!==false},lastForward:function(){return I.call(this)},lastBackward:function(){return I.call(this,true)},reset:function(){delete this.current;this._=
{}}});y.blockBoundary=function(h){return function(j){j=n._4e_wrap(j);return!(j&&j[0].nodeType==E.NODE_ELEMENT&&j._4e_isBlockBoundary(h))}};y.listItemBoundary=function(){return this.blockBoundary({br:1})};y.bookmark=function(h,j){function s(t){return t&&t[0]&&t._4e_name()=="span"&&t.attr("_ke_bookmark")}return function(t){var A,u;A=t&&t[0]&&t[0].nodeType==E.NODE_TEXT&&(u=t.parent())&&s(u);A=h?A:A||s(t);return j^A}};y.whitespaces=function(h){return function(j){j=(j=j[0]||j)&&j.nodeType==E.NODE_TEXT&&
!D.trim(j.nodeValue);return h^j}};y.invisible=function(h){var j=y.whitespaces();return function(s){s=j(s)||s[0].nodeType==E.NODE_ELEMENT&&!s[0].offsetHeight;return h^s}};x.Walker=y});
KISSY.Editor.add("range",function(x){function H(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=true;this.document=c}function I(c){var f=c[0].nodeType!=h.NODE_TEXT&&c._4e_name()in p.$removeEmpty,i=!r.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return f||i||c}function y(c){return!m(c)&&!l(c)}function D(c){var f=false,i=t.bookmark(true);return function(k){if(i(k))return true;if(k[0].nodeType==h.NODE_TEXT){if(r.trim(k[0].nodeValue).length)return false}else if(k[0].nodeType==
h.NODE_ELEMENT)if(!e[k._4e_name()])if(!c&&!g.ie&&k._4e_name()=="br"&&!f)f=true;else return false;return true}}function E(c,f){function i(k){return k&&k.nodeName=="span"&&k.getAttribute("_ke_bookmark")}return function(k){var o,z;o=k&&!k.nodeName&&(z=k.parentNode)&&i(z);o=c?o:o||i(k);return f^o}}function n(c){return function(f){f=(f=f[0]||f)&&f.nodeType==h.NODE_TEXT&&!r.trim(f.nodeValue);return c^f}}x.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var r=KISSY,h=x.NODE,j=x.RANGE,s=x.POSITION,t=x.Walker,A=r.DOM,u=x.Utils.getByAddress,g=r.UA,p=x.XHTML_DTD,a=x.ElementPath,b=r.Node,d={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};H.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+
":"+this.endOffset);return c.join("<br/>")};r.augment(H,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&A._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var c=this.startContainer,f=this.startOffset;if(c[0].nodeType!=h.NODE_ELEMENT)if(f)f>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;f=this.endOffset;if(c[0].nodeType!=h.NODE_ELEMENT)if(f)f>=c[0].nodeValue.length&&
this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c._4e_index()+1)},setStartBefore:function(c){this.setStart(c.parent(),c._4e_index())},setEndAfter:function(c){this.setEnd(c.parent(),c._4e_index()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c._4e_index())},optimizeBookmark:function(){var c=this.startContainer,f=this.endContainer;c&&c._4e_name()=="span"&&c.attr("_ke_bookmark")&&this.setStartAt(c,j.POSITION_BEFORE_START);f&&f._4e_name()=="span"&&
f.attr("_ke_bookmark")&&this.setEndAt(f,j.POSITION_AFTER_END)},setStart:function(c,f){if(c[0].nodeType==h.NODE_ELEMENT&&d[c._4e_name()]){c=c.parent();f=c._4e_index()}this.startContainer=c;this.startOffset=f;if(!this.endContainer){this.endContainer=c;this.endOffset=f}this.updateCollapsed()},setEnd:function(c,f){if(c[0].nodeType==h.NODE_ELEMENT&&d[c._4e_name()]){c=c.parent();f=c._4e_index()+1}this.endContainer=c;this.endOffset=f;if(!this.startContainer){this.startContainer=c;this.startOffset=f}this.updateCollapsed()},
setStartAt:function(c,f){switch(f){case j.POSITION_AFTER_START:this.setStart(c,0);break;case j.POSITION_BEFORE_END:c[0].nodeType==h.NODE_TEXT?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case j.POSITION_BEFORE_START:this.setStartBefore(c);break;case j.POSITION_AFTER_END:this.setStartAfter(c)}this.updateCollapsed()},setEndAt:function(c,f){switch(f){case j.POSITION_AFTER_START:this.setEnd(c,0);break;case j.POSITION_BEFORE_END:c[0].nodeType==h.NODE_TEXT?this.setEnd(c,
c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case j.POSITION_BEFORE_START:this.setEndBefore(c);break;case j.POSITION_AFTER_END:this.setEndAfter(c)}this.updateCollapsed()},execContentsAction:function(c,f){var i=this.startContainer,k=this.endContainer,o=this.startOffset,z=this.endOffset,K,J=this.document,L;this.optimizeBookmark();if(k[0].nodeType==h.NODE_TEXT)k=k._4e_splitText(z);else if(k[0].childNodes.length>0)if(z>=k[0].childNodes.length){k=new b(k[0].appendChild(J.createTextNode("")));
L=true}else k=new b(k[0].childNodes[z]);if(i[0].nodeType==h.NODE_TEXT){i._4e_splitText(o);if(i._4e_equals(k))k=new b(i[0].nextSibling)}else if(o)if(o>=i[0].childNodes.length){K=new b(J.createTextNode(""));i.append(K);i=K;K=true}else i=new b(i[0].childNodes[o].previousSibling);else{K=new b(J.createTextNode(""));(o=i[0].firstChild)?A.insertBefore(K[0],o):i.append(K);i=K;K=true}o=i._4e_parents();z=k._4e_parents();var M,P,O;for(M=0;M<o.length;M++){P=o[M];O=z[M];if(!P._4e_equals(O))break}J=f;for(var q,
C,v,w=M;w<o.length;w++){q=o[w];if(J&&!q._4e_equals(i))C=J.appendChild(q._4e_clone()[0]);for(q=q[0].nextSibling;q;){if(A._4e_equals(z[w],q)||A._4e_equals(k,q))break;v=q.nextSibling;if(c==2)J.appendChild(q.cloneNode(true));else{q.parentNode.removeChild(q);c==1&&J.appendChild(q)}q=v}if(C)J=C}J=f;for(M=M;M<z.length;M++){q=z[M];if(c>0&&!q._4e_equals(k))C=J.appendChild(q._4e_clone()[0]);if(!o[M]||!q.parent()._4e_equals(o[M].parent()))for(q=q[0].previousSibling;q;){if(A._4e_equals(o[M],q)||A._4e_equals(i,
q))break;v=q.previousSibling;if(c==2)J.insertBefore(q.cloneNode(true),J.firstChild);else{A._4e_remove(q);c==1&&J.insertBefore(q,J.firstChild)}q=v}if(C)J=C}if(c==2){O=this.startContainer[0];if(O.nodeType==h.NODE_TEXT&&O.nextSibling&&O.nextSibling.nodeType==h.NODE_TEXT){O.data+=O.nextSibling.data;O.parentNode.removeChild(O.nextSibling)}O=this.endContainer[0];if(O.nodeType==h.NODE_TEXT&&O.nextSibling&&O.nextSibling.nodeType==h.NODE_TEXT){O.data+=O.nextSibling.data;O.parentNode.removeChild(O.nextSibling)}}else{if(P&&
O&&(!i.parent()._4e_equals(P.parent())||!k.parent()._4e_equals(O.parent()))){P=O._4e_index();K&&O.parent()._4e_equals(i.parent())&&P--;this.setStart(O.parent(),P)}this.collapse(true)}K&&i._4e_remove();L&&k[0].parentNode&&k._4e_remove()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=true},clone:function(){var c=new H(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},getEnclosedNode:function(){var c=this.clone();c.optimize();if(c.startContainer[0].nodeType!=h.NODE_ELEMENT||c.endContainer[0].nodeType!=h.NODE_ELEMENT)return null;var f=new x.Walker(c),i=E(true,undefined),k=n(true);c.evaluator=function(o){return k(o)&&i(o)};c=f.next();f.reset();f=f.previous();return c&&c._4e_equals(f)?c:null},shrink:function(c,f){if(!this.collapsed){c=c||
j.SHRINK_TEXT;var i=this.clone(),k=this.startContainer,o=this.endContainer,z=this.startOffset,K=this.endOffset,J=1,L=1;if(k&&k[0].nodeType==h.NODE_TEXT)if(z)if(z>=k[0].nodeValue.length)i.setStartAfter(k);else{i.setStartBefore(k);J=0}else i.setStartBefore(k);if(o&&o[0].nodeType==h.NODE_TEXT)if(K)if(K>=o[0].nodeValue.length)i.setEndAfter(o);else{i.setEndAfter(o);L=0}else i.setEndBefore(o);i=new t(i);i.evaluator=function(P){P=P[0]||P;return P.nodeType==(c==j.SHRINK_ELEMENT?h.NODE_ELEMENT:h.NODE_TEXT)};
var M;i.guard=function(P,O){P=P[0]||P;if(c==j.SHRINK_ELEMENT&&P.nodeType==h.NODE_TEXT)return false;if(O&&P==M)return false;if(!O&&P.nodeType==h.NODE_ELEMENT)M=P;return true};if(J)(k=i[c==j.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(k,f?j.POSITION_AFTER_START:j.POSITION_BEFORE_START);if(L){i.reset();(i=i[c==j.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(i,f?j.POSITION_BEFORE_END:j.POSITION_AFTER_END)}return!!(J||L)}},getTouchedStartNode:function(){var c=this.startContainer;
if(this.collapsed||c[0].nodeType!=h.NODE_ELEMENT)return c;return c.childNodes[this.startOffset]||c},createBookmark2:function(c){var f=this.startContainer,i=this.endContainer,k=this.startOffset,o=this.endOffset,z,K;if(!f||!i)return{start:0,end:0};if(c){if(f[0].nodeType==h.NODE_ELEMENT)if((z=new b(f[0].childNodes[k]))&&z[0]&&z[0].nodeType==h.NODE_TEXT&&k>0&&z[0].previousSibling.nodeType==h.NODE_TEXT){f=z;k=0}for(;f[0].nodeType==h.NODE_TEXT&&(K=f._4e_previous())&&K[0].nodeType==h.NODE_TEXT;){f=K;k+=
K[0].nodeValue.length}if(!this.collapsed){if(i[0].nodeType==h.NODE_ELEMENT)if((z=new b(i[0].childNodes[o]))&&z[0]&&z[0].nodeType==h.NODE_TEXT&&o>0&&z[0].previousSibling.nodeType==h.NODE_TEXT){i=z;o=0}for(;i[0].nodeType==h.NODE_TEXT&&(K=i._4e_previous())&&K[0].nodeType==h.NODE_TEXT;){i=K;o+=K[0].nodeValue.length}}}return{start:f._4e_address(c),end:this.collapsed?null:i._4e_address(c),startOffset:k,endOffset:o,normalized:c,is2:true}},createBookmark:function(c){var f,i,k,o;f=new b("<span>",null,this.document);
f.attr("_ke_bookmark",1);f.css("display","none");f.html("&nbsp;");if(c){k=r.guid("ke_bm_");f.attr("id",k+"S")}if(!this.collapsed){i=f._4e_clone();i.html("&nbsp;");c&&i.attr("id",k+"E");o=this.clone();o.collapse();o.insertNode(i)}o=this.clone();o.collapse(true);o.insertNode(f);if(i){this.setStartAfter(f);this.setEndBefore(i)}else this.moveToPosition(f,j.POSITION_AFTER_END);return{startNode:c?k+"S":f,endNode:c?k+"E":i,serializable:c}},moveToPosition:function(c,f){this.setStartAt(c,f);this.collapse(true)},
trim:function(c,f){var i=this.startContainer,k=this.startOffset,o=this.collapsed;if((!c||o)&&i[0]&&i[0].nodeType==h.NODE_TEXT){if(k)if(k>=i[0].nodeValue.length){k=i._4e_index()+1;i=i.parent()}else{var z=i._4e_splitText(k);k=i._4e_index()+1;i=i.parent();if(A._4e_equals(this.startContainer,this.endContainer))this.setEnd(z,this.endOffset-this.startOffset);else if(A._4e_equals(i,this.endContainer))this.endOffset+=1}else{k=i._4e_index();i=i.parent()}this.setStart(i,k);if(o){this.collapse(true);return}}i=
this.endContainer;k=this.endOffset;if(!(f||o)&&i[0]&&i[0].nodeType==h.NODE_TEXT){if(k){k>=i.nodeValue.length||i._4e_splitText(k);k=i._4e_index()+1}else k=i._4e_index();i=i.parent();this.setEnd(i,k)}},insertNode:function(c){this.optimizeBookmark();this.trim(false,true);var f=this.startContainer,i=f[0].childNodes[this.startOffset];this.optimizeBookmark();this.trim(false,true);i?A.insertBefore(c[0]||c,i):f[0].appendChild(c[0]||c);A._4e_equals(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},
moveToBookmark:function(c){if(c.is2){var f=u(this.document,c.start,c.normalized),i=c.startOffset,k=c.end&&u(this.document,c.end,c.normalized);c=c.endOffset;this.setStart(f,i);k?this.setEnd(k,c):this.collapse(true)}else{f=(i=c.serializable)?r.one("#"+c.startNode,this.document):c.startNode;c=i?r.one("#"+c.endNode,this.document):c.endNode;this.setStartBefore(f);f._4e_remove();if(c&&c[0]){this.setEndBefore(c);c._4e_remove()}else this.collapse(true)}},getCommonAncestor:function(c,f){var i=this.startContainer,
k=this.endContainer;i=A._4e_equals(i,k)?c&&i[0].nodeType==h.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new b(i[0].childNodes[this.startOffset]):i:i._4e_commonAncestor(k);return f&&i[0].nodeType==h.NODE_TEXT?i.parent():i},enlarge:function(c){switch(c){case j.ENLARGE_ELEMENT:if(this.collapsed)break;c=this.getCommonAncestor();var f=new b(this.document.body),i,k,o,z,K,J=false,L,M;L=this.startContainer;M=this.startOffset;if(L[0].nodeType==h.NODE_TEXT){if(M){L=!r.trim(L[0].nodeValue.substring(0,M)).length&&
L;J=!!L}if(L)if(!(z=L[0].previousSibling))o=L.parent()}else{if(M)z=L[0].childNodes[M-1]||L[0].lastChild;z||(o=L)}for(;o||z;){if(o&&!z){if(!K&&A._4e_equals(o,c))K=true;if(!f._4e_contains(o))break;if(!J||o.css("display")!="inline"){J=false;if(K)i=o;else this.setStartBefore(o)}z=o[0].previousSibling}for(;z;){L=false;if(z.nodeType==h.NODE_TEXT){M=z.nodeValue;if(/[^\s\ufeff]/.test(M))z=null;L=/[\s\ufeff]$/.test(M)}else if(z.offsetWidth>0&&!z.getAttribute("_ke_bookmark"))if(J&&p.$removeEmpty[z.nodeName.toLowerCase()]){M=
A.text(z);if(/[^\s\ufeff]/.test(M))z=null;else for(var P=z.all||z.getElementsByTagName("*"),O=0,q;q=P[O++];)if(!p.$removeEmpty[q.nodeName.toLowerCase()]){z=null;break}if(z)L=!!M.length}else z=null;if(L)if(J)if(K)i=o;else o&&this.setStartBefore(o);else J=true;if(z){L=z.previousSibling;if(!o&&!L){o=new b(z);z=null;break}z=L}else o=null}if(o)o=o.parent()}L=this.endContainer;M=this.endOffset;o=z=null;K=J=false;if(L[0].nodeType==h.NODE_TEXT){L=!r.trim(L[0].nodeValue.substring(M)).length&&L;J=!(L&&L[0].nodeValue.length);
if(L)if(!(z=L[0].nextSibling))o=L.parent()}else(z=L[0].childNodes[M])||(o=L);for(;o||z;){if(o&&!z){if(!K&&A._4e_equals(o,c))K=true;if(!f._4e_contains(o))break;if(!J||o.css("display")!="inline"){J=false;if(K)k=o;else o&&this.setEndAfter(o)}z=o[0].nextSibling}for(;z;){L=false;if(z.nodeType==h.NODE_TEXT){M=z.nodeValue;if(/[^\s\ufeff]/.test(M))z=null;L=/^[\s\ufeff]/.test(M)}else if(z.offsetWidth>0&&!z.getAttribute("_ke_bookmark"))if(J&&p.$removeEmpty[z.nodeName.toLowerCase()]){M=A.text(z);if(/[^\s\ufeff]/.test(M))z=
null;else{P=z.all||z.getElementsByTagName("*");for(O=0;q=P[O++];)if(!p.$removeEmpty[q.nodeName.toLowerCase()]){z=null;break}}if(z)L=!!M.length}else z=null;if(L)if(J)if(K)k=o;else this.setEndAfter(o);if(z){L=z.nextSibling;if(!o&&!L){o=new b(z);z=null;break}z=L}else o=null}if(o)o=o.parent()}if(i&&k){c=i._4e_contains(k)?k:i;this.setStartBefore(c);this.setEndAfter(c)}break;case j.ENLARGE_BLOCK_CONTENTS:case j.ENLARGE_LIST_ITEM_CONTENTS:o=new H(this.document);f=new b(this.document.body);o.setStartAt(f,
j.POSITION_AFTER_START);o.setEnd(this.startContainer,this.startOffset);o=new t(o);var C,v,w=t.blockBoundary(c==j.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),B=function(G){var F=w(G);F||(C=G);return F};i=function(G){var F=B(G);if(!F&&G[0]&&G._4e_name()=="br")v=G;return F};o.guard=B;o=o.lastBackward();C=C||f;this.setStartAt(C,C._4e_name()!="br"&&(!o&&this.checkStartOfBlock()||o&&C._4e_contains(o))?j.POSITION_AFTER_START:j.POSITION_AFTER_END);o=this.clone();o.collapse();o.setEndAt(f,j.POSITION_BEFORE_END);
o=new t(o);o.guard=c==j.ENLARGE_LIST_ITEM_CONTENTS?i:B;C=null;o=o.lastForward();C=C||f;this.setEndAt(C,!o&&this.checkEndOfBlock()||o&&C._4e_contains(o)?j.POSITION_BEFORE_END:j.POSITION_BEFORE_START);v&&this.setEndAfter(v)}},checkStartOfBlock:function(){var c=this.startContainer,f=this.startOffset;if(f&&c[0].nodeType==h.NODE_TEXT)if(r.trim(c[0].nodeValue.substring(0,f)).length)return false;this.trim();c=new a(this.startContainer);f=this.clone();f.collapse(true);f.setStartAt(c.block||c.blockLimit,j.POSITION_AFTER_START);
c=new t(f);c.evaluator=D(true);return c.checkBackward()},checkEndOfBlock:function(){var c=this.endContainer,f=this.endOffset;if(c[0].nodeType==h.NODE_TEXT)if(r.trim(c[0].nodeValue.substring(f)).length)return false;this.trim();c=new a(this.endContainer);f=this.clone();f.collapse(false);f.setEndAt(c.block||c.blockLimit,j.POSITION_BEFORE_END);c=new t(f);c.evaluator=D(false);return c.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var c=
this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,c);return c},checkBoundaryOfElement:function(c,f){var i=this.clone();i[f==j.START?"setStartAt":"setEndAt"](c,f==j.START?j.POSITION_AFTER_START:j.POSITION_BEFORE_END);i=new t(i);i.evaluator=I;return i[f==j.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var c=this.startContainer,f=this.endContainer,i=this.startOffset,k=this.endOffset,o;if(c[0].nodeType==h.NODE_ELEMENT){o=c[0].childNodes.length;if(o>
i)c=new b(c[0].childNodes[i]);else if(o<1)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new b(c);c=c._4e_nextSourceNode()||c}}if(f[0].nodeType==h.NODE_ELEMENT){o=f[0].childNodes.length;if(o>k)f=(new b(f[0].childNodes[k]))._4e_previousSourceNode(true);else if(o<1)f=f._4e_previousSourceNode();else{for(f=f[0];f.lastChild;)f=f.lastChild;f=new b(f)}}if(c._4e_position(f)&s.POSITION_FOLLOWING)c=f;return{startNode:c,endNode:f}},fixBlock:function(c,f){var i=this.createBookmark(),
k=new b(this.document.createElement(f));this.collapse(c);this.enlarge(j.ENLARGE_BLOCK_CONTENTS);k[0].appendChild(this.extractContents());k._4e_trim();g.ie||k._4e_appendBogus();this.insertNode(k);this.moveToBookmark(i);return k},splitBlock:function(c){var f=new a(this.startContainer),i=new a(this.endContainer),k=f.block,o=i.block,z=null;if(!f.blockLimit._4e_equals(i.blockLimit))return null;if(c!="br"){if(!k){k=this.fixBlock(true,c);o=(new a(this.endContainer)).block}o||(o=this.fixBlock(false,c))}c=
k&&this.checkStartOfBlock();f=o&&this.checkEndOfBlock();this.deleteContents();if(k&&A._4e_equals(k,o))if(f){z=new a(this.startContainer);this.moveToPosition(o,j.POSITION_AFTER_END);o=null}else if(c){z=new a(this.startContainer);this.moveToPosition(k,j.POSITION_BEFORE_START);k=null}else{o=this.splitElement(k);!g.ie&&!r.inArray(k._4e_name(),["ul","ol"])&&k._4e_appendBogus()}return{previousBlock:k,nextBlock:o,wasStartOfBlock:c,wasEndOfBlock:f,elementPath:z}},splitElement:function(c){if(!this.collapsed)return null;
this.setEndAt(c,j.POSITION_BEFORE_END);var f=this.extractContents(),i=c._4e_clone(false);i[0].appendChild(f);i.insertAfter(c);this.moveToPosition(c,j.POSITION_AFTER_END);return i},moveToElementEditablePosition:function(c,f){var i,k=x.XHTML_DTD;if(k.$empty[c._4e_name()])return false;for(;c&&c[0].nodeType==h.NODE_ELEMENT;){if(i=c._4e_isEditable())this.moveToPosition(c,f?j.POSITION_BEFORE_END:j.POSITION_AFTER_START);else if(k.$inline[c._4e_name()]){this.moveToPosition(c,f?j.POSITION_AFTER_END:j.POSITION_BEFORE_START);
return true}if((c=k.$empty[c._4e_name()]?c[f?"_4e_previous":"_4e_next"](y):c[f?"_4e_last":"_4e_first"](y))&&c[0].nodeType==h.NODE_TEXT){this.moveToPosition(c,f?j.POSITION_AFTER_END:j.POSITION_BEFORE_START);return true}}return i},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==h.NODE_TEXT?c[0].nodeValue.length:c[0].childNodes.length)}});var e={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},m=new t.whitespaces,l=new t.bookmark;x.Range=H});
KISSY.Editor.add("domiterator",function(x){function H(A){if(!(arguments.length<1)){this.range=A;this.forceBrBreak=false;this.enlargeBr=true;this.enforceRealBlocks=false;this._||(this._={})}}var I=KISSY,y=I.UA,D=x.Walker,E=x.Range,n=x.RANGE,r=x.NODE,h=x.ElementPath,j=I.Node,s=I.DOM,t=/^[\r\n\t ]*$/;D.bookmark();I.augment(H,{getNextParagraph:function(A){var u,g,p,a,b;if(!this._.lastNode){g=this.range.clone();g.shrink(n.SHRINK_ELEMENT,true);g.enlarge(this.forceBrBreak||!this.enlargeBr?n.ENLARGE_LIST_ITEM_CONTENTS:
n.ENLARGE_BLOCK_CONTENTS);var d=new D(g),e=D.bookmark(true,true);d.evaluator=e;this._.nextNode=d.next();d=new D(g);d.evaluator=e;d=d.previous();this._.lastNode=d._4e_nextSourceNode(true);if(this._.lastNode&&this._.lastNode[0].nodeType==r.NODE_TEXT&&!I.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){e=new E(g.document);e.moveToPosition(this._.lastNode,n.POSITION_AFTER_END);if(e.checkEndOfBlock()){e=new h(e.endContainer);this._.lastNode=(e.block||e.blockLimit)._4e_nextSourceNode(true)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new j(g.document.createTextNode(""));s.insertAfter(this._.lastNode[0],d[0])}g=null}e=this._.nextNode;d=this._.lastNode;for(this._.nextNode=null;e;){var m=false,l=e[0].nodeType!=r.NODE_ELEMENT,c=false;if(l){if(e[0].nodeType==r.NODE_TEXT)if(t.test(e[0].nodeValue))l=false}else{var f=e._4e_name();if(e._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(f=="br")l=true;else if(!g&&!e[0].childNodes.length&&f!="hr"){u=e;p=e._4e_equals(d);break}if(g){g.setEndAt(e,n.POSITION_BEFORE_START);
if(f!="br")this._.nextNode=e}m=true}else{if(e[0].firstChild){if(!g){g=new E(this.range.document);g.setStartAt(e,n.POSITION_BEFORE_START)}e=new j(e[0].firstChild);continue}l=true}}if(l&&!g){g=new E(this.range.document);g.setStartAt(e,n.POSITION_BEFORE_START)}p=(!m||l)&&e._4e_equals(d);if(g&&!m)for(;!e[0].nextSibling&&!p;){f=e.parent();if(f._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){m=true;p||f._4e_equals(d);break}e=f;l=true;p=e._4e_equals(d);c=true}l&&g.setEndAt(e,n.POSITION_AFTER_END);e=e._4e_nextSourceNode(c,
null,d);if((p=!e)||m&&g)break}if(!u){if(!g){this._.docEndMarker&&this._.docEndMarker._4e_remove();return this._.nextNode=null}u=new h(g.startContainer);e=u.blockLimit;m={div:1,th:1,td:1};u=u.block;if((!u||!u[0])&&!this.enforceRealBlocks&&m[e._4e_name()]&&g.checkStartOfBlock()&&g.checkEndOfBlock())u=e;else if(!u||this.enforceRealBlocks&&u._4e_name()=="li"){u=new j(this.range.document.createElement(A||"p"));u[0].appendChild(g.extractContents());u._4e_trim();g.insertNode(u);a=b=true}else if(u._4e_name()!=
"li"){if(!g.checkStartOfBlock()||!g.checkEndOfBlock()){u=u._4e_clone(false);u[0].appendChild(g.extractContents());u._4e_trim();b=g.splitBlock();a=!b.wasStartOfBlock;b=!b.wasEndOfBlock;g.insertNode(u)}}else if(!p)this._.nextNode=u._4e_equals(d)?null:g.getBoundaryNodes().endNode._4e_nextSourceNode(true,null,d)}if(a){g=new j(u[0].previousSibling);if(g[0]&&g[0].nodeType==r.NODE_ELEMENT)if(g._4e_name()=="br")g._4e_remove();else g[0].lastChild&&s._4e_name(g[0].lastChild)=="br"&&s._4e_remove(g[0].lastChild)}if(b){g=
D.bookmark(false,true);a=new j(u[0].lastChild);if(a[0]&&a[0].nodeType==r.NODE_ELEMENT&&a._4e_name()=="br")if(y.ie||a._4e_previous(g)||a._4e_next(g))a._4e_remove()}if(!this._.nextNode)this._.nextNode=p||u._4e_equals(d)?null:u._4e_nextSourceNode(true,null,d);return u}});E.prototype.createIterator=function(){return new H(this)}});
KISSY.Editor.add("selection",function(x){function H(b){this.document=b;this._={cache:{}};if(D.ie){var d=this.getNative().createRange();if(!d||d.item&&d.item(0).ownerDocument!=b||d.parentElement&&d.parentElement().ownerDocument!=b)this.isInvalid=true}}function I(b){var d=b.document,e=new r(d.body),m=new r(d.documentElement);if(D.ie){if(D.ie<8||document.documentMode==7)m.on("click",function(J){E._4e_name(J.target)==="html"&&b.getSelection().getRanges()[0].select()});var l,c,f=1;m.on("mousedown",function(){f=
0});m.on("mouseup",function(){f=1});e.on("focusin",function(J){if(E._4e_name(J.target)=="body")if(l){try{f&&l.select()}catch(L){}l=null}});e.on("focus",function(){c=true;k()});e.on("beforedeactivate",function(J){if(!J.relatedTarget){c=false;f=1}});n.on(E._4e_getWin(d),"blur",function(){d&&d.selection.empty()});e.on("mousedown",function(){i()});e.on("mouseup",function(){c=true;setTimeout(function(){k(true)},0)});e.on("keydown",i);e.on("keyup",function(){c=true;k()});n.on(d,"selectionchange",k);var i=
function(){c=false},k=function(J){if(c){var L=b.document,M=b.getSelection(),P=M&&M.getType(),O=M&&M.getNative();if(J&&O&&P==h.SELECTION_NONE)if(!L.queryCommandEnabled("InsertImage")){setTimeout(function(){k(true)},50);return}var q;if(!(O&&P==h.SELECTION_TEXT&&(q=E._4e_name(O.createRange().parentElement()))&&q in{input:1,textarea:1})){l=O&&M.getRanges()[0];b._monitor()}}}}else{n.on(d,"mouseup",b._monitor,b);n.on(d,"keyup",b._monitor,b)}var o={table:1,pre:1},z=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
K=x.Walker.whitespaces(true);x.Walker.bookmark(false,true);b.on("selectionChange",function(J){var L=J.path;J=(J=J.selection)&&J.getRanges()[0];var M=L.blockLimit;if(J)if(J.collapse&&!L.block&&M._4e_name()=="body"){L=J.fixBlock(true,"p");if(L._4e_outerHtml().match(z))if((M=L._4e_next(K))&&M[0].nodeType==s.NODE_ELEMENT&&!o[M._4e_name()]){J.moveToElementEditablePosition(M);L._4e_remove()}else if((M=L._4e_previous(K))&&M[0].nodeType==s.NODE_ELEMENT&&!o[M._4e_name()]){J.moveToElementEditablePosition(M,
M._4e_outerHtml().match(z)?false:true);L._4e_remove()}J.select();D.ie||b.notifySelectionChange()}})}x.SELECTION={};var y=KISSY,D=y.UA,E=y.DOM,n=y.Event,r=y.Node,h=x.SELECTION,j=x.RANGE,s=x.NODE,t=x.Walker,A=x.Range;h.SELECTION_NONE=1;h.SELECTION_TEXT=2;h.SELECTION_ELEMENT=3;var u={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};y.augment(H,{getNative:D.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=
this.document.selection)}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=E._4e_getWin(this.document).getSelection())},getType:D.ie?function(){var b=this._.cache;if(b.type)return b.type;var d=h.SELECTION_NONE;try{var e=this.getNative(),m=e.type;if(m=="Text")d=h.SELECTION_TEXT;if(m=="Control")d=h.SELECTION_ELEMENT;if(e.createRange().parentElement)d=h.SELECTION_TEXT}catch(l){}return b.type=d}:function(){var b=this._.cache;if(b.type)return b.type;var d=h.SELECTION_TEXT,e=this.getNative();
if(e){if(e.rangeCount==1){e=e.getRangeAt(0);var m=e.startContainer;if(m==e.endContainer&&m.nodeType==s.NODE_ELEMENT&&e.endOffset-e.startOffset===1&&u[m.childNodes[e.startOffset].nodeName.toLowerCase()])d=h.SELECTION_ELEMENT}}else d=h.SELECTION_NONE;return b.type=d},getRanges:D.ie?function(){var b=function(d,e){d=d.duplicate();d.collapse(e);for(var m=d.parentElement(),l=m.childNodes,c,f=0;f<l.length;f++){var i=l[f];if(i.nodeType==s.NODE_ELEMENT){c=d.duplicate();c.moveToElementText(i);i=c.compareEndPoints("StartToStart",
d);var k=c.compareEndPoints("EndToStart",d);c.collapse();if(i>0)break;else if(!i||k==1&&i==-1)return{container:m,offset:f};else if(!k)return{container:m,offset:f+1};c=null}}if(!c){c=d.duplicate();c.moveToElementText(m);c.collapse(false)}c.setEndPoint("StartToStart",d);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=l[--f].nodeValue.length}catch(o){c=0}return c===0?{container:m,offset:f}:{container:l[f],offset:-c}};return function(){var d=this._.cache;if(d.ranges)return d.ranges;var e=
this.getNative(),m=e&&e.createRange(),l=this.getType();if(!e)return[];if(l==h.SELECTION_TEXT){e=new A(this.document);l=b(m,true);e.setStart(new r(l.container),l.offset);l=b(m);e.setEnd(new r(l.container),l.offset);return d.ranges=[e]}else if(l==h.SELECTION_ELEMENT){d=this._.cache.ranges=[];for(l=0;l<m.length;l++){var c=m.item(l),f=c.parentNode,i=0;for(e=new A(this.document);i<f.childNodes.length&&f.childNodes[i]!=c;i++);e.setStart(new r(f),i);e.setEnd(new r(f),i+1);d.push(e)}return d}return d.ranges=
[]}}():function(){var b=this._.cache;if(b.ranges)return b.ranges;var d=[],e=this.getNative();if(!e)return[];for(var m=0;m<e.rangeCount;m++){var l=e.getRangeAt(m),c=new A(this.document);c.setStart(new r(l.startContainer),l.startOffset);c.setEnd(new r(l.endContainer),l.endOffset);d.push(c)}return b.ranges=d},getStartElement:function(){var b=this._.cache;if(b.startElement!==undefined)return b.startElement;var d,e=this.getNative();switch(this.getType()){case h.SELECTION_ELEMENT:return this.getSelectedElement();
case h.SELECTION_TEXT:var m=this.getRanges()[0];if(m)if(!m.collapsed){for(m.optimize();;){d=m.startContainer;if(m.startOffset==(d[0].nodeType===s.NODE_ELEMENT?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())m.setStartAfter(d);else break}d=m.startContainer;if(d[0].nodeType!=s.NODE_ELEMENT)return d.parent();d=new r(d[0].childNodes[m.startOffset]);if(!d[0]||d[0].nodeType!=s.NODE_ELEMENT)return m.startContainer;for(m=d[0].firstChild;m&&m.nodeType==s.NODE_ELEMENT;){d=new r(m);m=
m.firstChild}return d}if(D.ie){m=e.createRange();m.collapse(true);d=m.parentElement()}else if((d=e.anchorNode)&&d.nodeType!=s.NODE_ELEMENT)d=d.parentNode}return b.startElement=d?E._4e_wrap(d):null},getSelectedElement:function(){var b=this._.cache;if(b.selectedElement!==undefined)return b.selectedElement;var d=this,e;if(D.ie){e=d.getNative().createRange();e=e.item&&e.item(0)}e||(e=function(){for(var m=d.getRanges()[0],l,c,f=2;f&&!((l=m.getEnclosedNode())&&l[0].nodeType==s.NODE_ELEMENT&&u[l._4e_name()]&&
(c=l));f--)m.shrink(j.SHRINK_ELEMENT);return c&&c[0]}());return b.selectedElement=E._4e_wrap(e)},reset:function(){this._.cache={}},selectElement:function(b){var d;if(D.ie)try{d=this.document.body.createControlRange();d.addElement(b[0]);d.select()}catch(e){d=this.document.body.createTextRange();d.moveToElementText(b[0]);d.select()}finally{}else{d=this.document.createRange();d.selectNode(b[0]);b=this.getNative();b.removeAllRanges();b.addRange(d)}this.reset()},selectRanges:function(b){if(D.ie)b[0]&&
b[0].select();else{var d=this.getNative();if(!d)return;d.removeAllRanges();for(var e=0;e<b.length;e++){var m=b[e],l=this.document.createRange(),c=m.startContainer;m.collapsed&&D.gecko&&D.gecko<1.09&&c[0].nodeType==s.NODE_ELEMENT&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));l.setStart(c[0],m.startOffset);l.setEnd(m.endContainer[0],m.endOffset);d.addRange(l)}}this.reset()},createBookmarks2:function(b){for(var d=[],e=this.getRanges(),m=0;m<e.length;m++)d.push(e[m].createBookmark2(b));
return d},createBookmarks:function(b){for(var d=[],e=this.getRanges(),m=e.length,l=this.document,c,f=0;f<m;f++){d.push(c=e[f].createBookmark(b,true));var i=(b=c.serializable)?y.one("#"+c.startNode,l):c.startNode;c=b?y.one("#"+c.endNode,l):c.endNode;for(var k=f+1;k<m;k++){var o=e[k],z=o.startContainer,K=o.endContainer;E._4e_equals(z,i.parent())&&o.startOffset++;E._4e_equals(z,c.parent())&&o.startOffset++;E._4e_equals(K,i.parent())&&o.endOffset++;E._4e_equals(K,c.parent())&&o.endOffset++}}return d},
selectBookmarks:function(b){for(var d=[],e=0;e<b.length;e++){var m=new A(this.document);m.moveToBookmark(b[e]);d.push(m)}this.selectRanges(d);return this},getCommonAncestor:function(){var b=this.getRanges();return b[0].startContainer._4e_commonAncestor(b[b.length-1].endContainer)},scrollIntoView:function(){var b=this.getStartElement();b&&b._4e_scrollIntoView()},removeAllRanges:function(){var b=this.getNative();D.ie?b.clear():b.removeAllRanges()}});x.Selection=H;var g={table:1,tbody:1,tr:1},p=t.whitespaces(true),
a=/\ufeff|\u00a0/;A.prototype.select=D.ie?function(b){var d=this.collapsed,e,m;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var l=this.startContainer[0].childNodes[this.startOffset];if(l.nodeType==s.NODE_ELEMENT){(new H(this.document)).selectElement(new r(l));return}}if(this.startContainer[0].nodeType==s.NODE_ELEMENT&&this.startContainer._4e_name()in g||this.endContainer[0].nodeType==s.NODE_ELEMENT&&this.endContainer._4e_name()in g)this.shrink(j.SHRINK_ELEMENT,
true);var c=this.createBookmark();l=c.startNode;var f;if(!d)f=c.endNode;c=this.document.body.createTextRange();c.moveToElementText(l[0]);c.moveStart("character",1);if(f){b=this.document.body.createTextRange();b.moveToElementText(f[0]);c.setEndPoint("EndToEnd",b);c.moveEnd("character",-1)}else{for(e=l[0].nextSibling;e&&!p(e);)e=e.nextSibling;e=!(e&&e.nodeValue&&e.nodeValue.match(a))&&(b||!l[0].previousSibling||l[0].previousSibling&&E._4e_name(l[0].previousSibling)=="br");m=this.document.createElement("span");
m.innerHTML="&#65279;";m=new r(m);E.insertBefore(m[0],l[0]);e&&E.insertBefore(this.document.createTextNode("\ufeff"),l[0])}this.setStartBefore(l);l._4e_remove();if(d){if(e){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(m){this.moveToPosition(m,j.POSITION_BEFORE_START);m._4e_remove()}}else{this.setEndBefore(f);f._4e_remove();c.select()}}:function(){var b=this.startContainer;this.collapsed&&b[0].nodeType==s.NODE_ELEMENT&&!b[0].childNodes.length&&b[0].appendChild(this.document.createTextNode(""));
var d=this.document.createRange();d.setStart(b[0],this.startOffset);try{d.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(true);d.setEnd(this.endContainer[0],this.endOffset)}else throw e;}b=new H(this.document);b=(!b||b.isInvalid?null:b).getNative();b.removeAllRanges();b.addRange(d)};x.on("instanceCreated",function(b){I(b.editor)})});
KISSY.Editor.add("styles",function(x){function H(q,C){for(var v in q)q[v]=q[v].replace(O,function(w,B){return C[B]})}function I(q,C){if(C){q=e.clone(q);H(q.attributes,C);H(q.styles,C)}var v=this.element=(q.element||"*").toLowerCase();this.type=v=="#"||L[v]?l.STYLE_BLOCK:M[v]?l.STYLE_OBJECT:l.STYLE_INLINE;this._={definition:q}}function y(q,C){var v=C?this.removeFromRange:this.applyToRange;q.body.focus();for(var w=new f(q),B=w.getRanges(),G=0;G<B.length;G++)v.call(this,B[G]);w.selectRanges(B)}function D(q,
C){var v;v=q.element;if(v=="*")v="span";v=new z(C.createElement(v));return E(v,q)}function E(q,C){var v=C._.definition,w=v.attributes;v=I.getStyleText(v);if(w)for(var B in w)q.attr(B,w[B]);if(v)q[0].style.cssText=v;return q}function n(q){var C=q.createBookmark(true),v=q.createIterator();v.enforceRealBlocks=true;v.enlargeBr=true;for(var w,B=q.document;w=v.getNextParagraph();){var G=D(this,B);w=w;var F=G;G=F._4e_name=="pre";var N=w._4e_name=="pre",T=!G&&N;if(G&&!N){N=w;F=F;T=N.html();T=r(T,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,
"");T=T.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");T=T.replace(/([ \t\n\r]+|&nbsp;)/g," ");T=T.replace(/<br\b[^>]*>/gi,"\n");if(K.ie){N=N[0].ownerDocument.createElement("div");N.appendChild(F[0]);F[0].outerHTML="<pre>"+T+"</pre>";F=new z(N.firstChild);F._4e_remove()}else F.html(T);F=F}else if(T)F=j(h(w),F);else w._4e_moveChildren(F);w[0].parentNode.replaceChild(F[0],w[0]);if(G){w=F;G=void 0;if((G=w._4e_previousSourceNode(true,i.NODE_ELEMENT))&&G._4e_name()=="pre"){F=r(G.html(),/\n$/,"")+"\n\n"+
r(w.html(),/^\n/,"");if(K.ie)w[0].outerHTML="<pre>"+F+"</pre>";else w.html(F);G._4e_remove()}}}q.moveToBookmark(C)}function r(q,C,v){var w="",B="";q=q.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(G,F,N){F&&(w=F);N&&(B=N);return""});return w+q.replace(C,v)+B}function h(q){var C=[];r(q._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(v,w,B){return w+"</pre>"+B+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(v,
w){C.push(w)});return C}function j(q,C){for(var v=C[0].ownerDocument.createDocumentFragment(),w=0;w<q.length;w++){var B=q[w];B=B.replace(/(\r\n|\r)/g,"\n");B=r(B,/^[ \t]*\n/,"");B=r(B,/\n$/,"");B=r(B,/^[ \t]+|[ \t]+$/g,function(F,N){return F.length==1?"&nbsp;":N?" "+Array(F.length).join("&nbsp;"):Array(F.length).join("&nbsp;")+" "});B=B.replace(/\n/g,"<br>");B=B.replace(/[ \t]{2,}/g,function(F){return Array(F.length).join("&nbsp;")+" "});var G=C._4e_clone();G.html(B);v.appendChild(G[0])}return v}
function s(q){var C=q.document;if(q.collapsed){C=D(this,C);q.insertNode(C);q.moveToPosition(C,c.POSITION_BEFORE_END)}else{var v=this.element,w=this._.definition,B,G=x.XHTML_DTD[v]||(B=true,x.XHTML_DTD.span),F=q.createBookmark();q.enlarge(c.ENLARGE_ELEMENT);q.trim();var N=q.createBookmark(),T=N.startNode;N=N.endNode;for(var S=T,V;S&&S[0];){var Q=false;if(m._4e_equals(S,N)){S=null;Q=true}else{var R=S[0].nodeType,Y=R==i.NODE_ELEMENT?S._4e_name():null;if(Y&&S.attr("_ke_bookmark")){S=S._4e_nextSourceNode(true);
continue}if(!Y||G[Y]&&(S._4e_position(N)|k.POSITION_PRECEDING|k.POSITION_IDENTICAL|k.POSITION_IS_CONTAINED)==k.POSITION_PRECEDING+k.POSITION_IDENTICAL+k.POSITION_IS_CONTAINED&&(!w.childRule||w.childRule(S))){var U=S.parent();if(U&&U[0]&&((x.XHTML_DTD[U._4e_name()]||x.XHTML_DTD.span)[v]||B)&&(!w.parentRule||w.parentRule(U))){if(!V&&(!Y||!x.XHTML_DTD.$removeEmpty[Y]||(S._4e_position(N)|k.POSITION_PRECEDING|k.POSITION_IDENTICAL|k.POSITION_IS_CONTAINED)==k.POSITION_PRECEDING+k.POSITION_IDENTICAL+k.POSITION_IS_CONTAINED)){V=
new o(C);V.setStartBefore(S)}if(R==i.NODE_TEXT||R==i.NODE_ELEMENT&&!S[0].childNodes.length){R=S;for(var W;!R[0].nextSibling&&(W=R.parent(),G[W._4e_name()])&&(W._4e_position(T)|k.POSITION_FOLLOWING|k.POSITION_IDENTICAL|k.POSITION_IS_CONTAINED)==k.POSITION_FOLLOWING+k.POSITION_IDENTICAL+k.POSITION_IS_CONTAINED&&(!w.childRule||w.childRule(W));)R=W;V.setEndAfter(R);R[0].nextSibling||(Q=true)}}else Q=true}else Q=true;S=S._4e_nextSourceNode()}if(Q&&V&&!V.collapsed){Q=D(this,C);for(R=V.getCommonAncestor();Q&&
R&&Q[0]&&R[0];){if(R._4e_name()==v){for(var X in w.attributes)Q.attr(X)==R.attr(X)&&Q[0].removeAttribute(X);for(var aa in w.styles)Q._4e_style(aa)==R._4e_style(aa)&&Q._4e_style(aa,"");if(!Q._4e_hasAttributes()){Q=null;break}}R=R.parent()}if(Q){Q[0].appendChild(V.extractContents());R=Q;Y=g(this);U=R.all(this.element);for(var Z=U.length;--Z>=0;)p(this,new z(U[Z]));var $=void 0;for($ in Y)if($!=this.element){U=R.all($);for(Z=U.length-1;Z>=0;Z--){var ba=new z(U[Z]);b(ba,Y[$])}}V.insertNode(Q);Q._4e_mergeSiblings();
K.ie||Q[0].normalize()}V=null}}T._4e_remove();N._4e_remove();q.moveToBookmark(F);q.shrink(c.SHRINK_TEXT)}}function t(q){q.enlarge(c.ENLARGE_ELEMENT);var C=q.createBookmark(),v=C.startNode;if(q.collapsed){for(var w=new J(v.parent()),B,G=0,F;G<w.elements.length&&(F=w.elements[G]);G++){if(F==w.block||F==w.blockLimit)break;if(this.checkElementRemovable(F)){var N=q.checkBoundaryOfElement(F,c.END),T=!N&&q.checkBoundaryOfElement(F,c.START);if(T||N){B=F;B.match=T?"start":"end"}else{F._4e_mergeSiblings();
F._4e_name()==this.element?p(this,F):b(F,g(this)[F._4e_name()])}}}if(B&&B[0]){F=v;for(G=0;;G++){N=w.elements[G];if(m._4e_equals(N,B))break;else if(N.match)continue;else N=N._4e_clone();N[0].appendChild(F[0]);F=N}m[B.match=="start"?"insertBefore":"insertAfter"](F[0],B[0])}}else{var S=C.endNode,V=this;w=function(){for(var Q=new J(v.parent()),R=new J(S.parent()),Y=null,U=null,W=0;W<Q.elements.length;W++){var X=Q.elements[W];if(X==Q.block||X==Q.blockLimit)break;if(V.checkElementRemovable(X))Y=X}for(W=
0;W<R.elements.length;W++){X=R.elements[W];if(X==R.block||X==R.blockLimit)break;if(V.checkElementRemovable(X))U=X}U&&S._4e_breakParent(U);Y&&v._4e_breakParent(Y)};w();for(B=new z(v[0].nextSibling);B[0]!==S[0];){G=B._4e_nextSourceNode();if(B[0]&&B[0].nodeType==i.NODE_ELEMENT&&this.checkElementRemovable(B)){B._4e_name()==this.element?p(this,B):b(B,g(this)[B._4e_name()]);if(G[0].nodeType==i.NODE_ELEMENT&&G._4e_contains(v)){w();G=new z(v[0].nextSibling)}}B=G}}q.moveToBookmark(C)}function A(q){var C={};
q.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(v,w,B){C[w]=B});return C}function u(q,C){var v;if(C!==false){v=document.createElement("span");v.style.cssText=q;v=v.style.cssText||""}else v=q;return v.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function g(q){if(q._.overrides)return q._.overrides;var C=q._.overrides={},v=q._.definition.overrides;if(v){e.isArray(v)||(v=[v]);for(var w=0;w<v.length;w++){var B=v[w],G,F;if(typeof B==
"string")G=B.toLowerCase();else{G=B.element?B.element.toLowerCase():q.element;F=B.attributes}B=C[G]||(C[G]={});if(F){B=B.attributes=B.attributes||[];for(var N in F)B.push([N.toLowerCase(),F[N]])}}}return C}function p(q,C){var v=q._.definition,w=e.mix(e.mix({},v.attributes),g(q)[C._4e_name()]);v=v.styles;var B=e.isEmptyObject(w)&&e.isEmptyObject(v),G;for(G in w)if(!((G=="class"||q._.definition.fullMatch)&&C.attr(G)!=a(G,w[G]))){B=B||!!C._4e_hasAttribute(G);C.removeAttr(G)}for(var F in v)if(!(q._.definition.fullMatch&&
C._4e_style(F)!=a(F,v[F],true))){B=B||!!C._4e_style(F);C._4e_style(F,"")}B&&d(C)}function a(q,C,v){var w=new z("<span></span>");w[v?"_4e_style":"attr"](q,C);return w[v?"_4e_style":"attr"](q)}function b(q,C){var v=C&&C.attributes;if(v)for(var w=0;w<v.length;w++){var B=v[w][0],G;if(G=q.attr(B)){var F=v[w][1];if(F===null||F.test&&F.test(G)||typeof F=="string"&&G==F)q[0].removeAttribute(B)}}d(q)}function d(q){if(!q._4e_hasAttributes()){var C=q[0].firstChild,v=q[0].lastChild;q._4e_remove(true);if(C){C.nodeType==
i.NODE_ELEMENT&&m._4e_mergeSiblings(C);v&&!C===v&&v.nodeType==i.NODE_ELEMENT&&m._4e_mergeSiblings(v)}}}var e=KISSY,m=e.DOM,l=x.STYLE={},c=x.RANGE,f=x.Selection,i=x.NODE,k=x.POSITION,o=x.Range,z=e.Node,K=e.UA,J=x.ElementPath,L={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},M={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},P=/\s*(?:;\s*|$)/,O=/#\((.+?)\)/g;l.STYLE_BLOCK=1;l.STYLE_INLINE=2;l.STYLE_OBJECT=3;I.prototype={apply:function(q){y.call(this,
q,false)},remove:function(q){y.call(this,q,true)},applyToRange:function(q){return(this.applyToRange=this.type==l.STYLE_INLINE?s:this.type==l.STYLE_BLOCK?n:this.type==l.STYLE_OBJECT?null:null).call(this,q)},removeFromRange:function(q){return(this.removeFromRange=this.type==l.STYLE_INLINE?t:null).call(this,q)},applyToObject:function(q){E(q,this)},checkElementRemovable:function(q,C){if(!q)return false;var v=this._.definition;if(q._4e_name()==this.element){if(!C&&!q._4e_hasAttributes())return true;var w=
v._AC;if(w)v=w;else{w={};var B=0,G=v.attributes;if(G)for(var F in G){B++;w[F]=G[F]}if(G=I.getStyleText(v)){w.style||B++;w.style=G}w._length=B;v=v._AC=w}if(v._length){for(var N in v)if(N!="_length"){B=q.attr(N)||"";if(N=="style")a:{w=v[N];B=u(B,false);typeof w=="string"&&(w=A(w));typeof B=="string"&&(B=A(B));G=void 0;for(G in w)if(!(G in B&&(B[G]==w[G]||w[G]=="inherit"||B[G]=="inherit"))){w=false;break a}w=true}else w=v[N]==B;if(w){if(!C)return true}else if(C)return false}if(C)return true}else return true}if(N=
g(this)[q._4e_name()]){if(!(v=N.attributes))return true;for(w=0;w<v.length;w++){N=v[w][0];if(N=q.attr(N)){B=v[w][1];if(B===null||typeof B=="string"&&N==B||B.test&&B.test(N))return true}}}return false},checkActive:function(q){switch(this.type){case l.STYLE_BLOCK:return this.checkElementRemovable(q.block||q.blockLimit,true);case l.STYLE_OBJECT:case l.STYLE_INLINE:for(var C=q.elements,v=0,w;v<C.length;v++){w=C[v];if(!(this.type==l.STYLE_INLINE&&(m._4e_equals(w,q.block)||m._4e_equals(w,q.blockLimit))))if(!(this.type==
l.STYLE_OBJECT&&!(w._4e_name()in M)))if(this.checkElementRemovable(w,true))return true}}return false}};I.getStyleText=function(q){var C=q._ST;if(C)return C;C=q.styles;var v=q.attributes&&q.attributes.style||"",w="";if(v.length)v=v.replace(P,";");for(var B in C){var G=C[B],F=(B+":"+G).replace(P,";");if(G=="inherit")w+=F;else v+=F}if(v.length)v=u(v);v+=w;return q._ST=v};x.Style=I});
