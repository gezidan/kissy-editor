KISSY.add("editor",function(y,C){function H(u,k){function v(c){for(var q=H.Env.mods,l=0;l<c.length;l++){for(var b=c[l],g=false,h=0;h<l;h++)if(b==c[h]){g=true;break}h=q[b];if(g&&h){g=y.clone(h);b=b+"_"+l;g.name=b;c[l]=b;q[b]||(q[b]=g)}}}var a=this;if(!(a instanceof H))return new H(u,k);if(y.isString(u))u=y.one(u);u=t._4e_wrap(u);k=k||{};k.pluginConfig=k.pluginConfig||{};a.cfg=k;y.app(a,y.EventTarget);var e=["htmldataprocessor","enterkey","clipboard"],d=false;a.use=function(c,q){c=c.split(",");v(c);
if(!d)for(var l=0;l<e.length;l++){var b=e[l];y.inArray(b,c)||c.unshift(b)}y.use.call(a,c.join(","),function(){a.ready(function(){q&&q.call(a);if(!d){a.setData(u.val());if(k.focus)a.focus();else{var g=a.getSelection();g&&g.removeAllRanges()}a.fire("save");d=true}})},{order:true,global:H});return a};a.init(u);return a}function z(u){if(!s)return u.replace(/\.(js|css)/i,"-min.$1");if(s==="dev")return"../src/"+u;return u}var t=y.DOM;y.app(H,y.EventTarget);H.Config.base=y.Config.base+"editor/";var s=y.Config.debug,
i=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu",
"fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},
{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],p,j,f,o,n={};p=0;for(j=i.length;p<j;p++){f=i[p];if(y.isString(f))f=i[p]={name:f};o=f.requires||[];var A=["button"];f.name.indexOf("/dialog")!=-1&&A.push("overlay");f.requires=o.concat(A)}i=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},
{name:"select",requires:["overlay"]}].concat(i);p=0;for(j=i.length;p<j;p++){f=i[p];o=f.name;n[o]={attach:false,charset:"utf-8",requires:f.requires,csspath:f.useCss?z("plugins/"+o+"/plugin.css?t="+encodeURIComponent("2010-10-29 19:20:07")+""):C,path:z("plugins/"+o+"/plugin.js?t="+encodeURIComponent("2010-10-29 19:20:07")+"")}}H.add(n);y.Editor=H;y.log(["utils","focusmanager","definition","dtd","dom","elementpath","walker","range","domiterator","selection","styles","htmlparser","htmlparser-basicwriter",
"htmlparser-comment","htmlparser-element","htmlparser-filter","htmlparser-fragment","htmlparser-htmlwriter","htmlparser-text"])});
KISSY.Editor.add("utils",function(y){var C=KISSY,H=C.Node,z=C.DOM,t=C.UA,s=C.Event;y.Utils={debugUrl:function(i){var p=C.Config.debug;if(!p)return i.replace(/\.(js|css)/i,"-min.$1");if(p==="dev")return"../src/"+i;return i},lazyRun:function(i,p,j){var f=i[p],o=i[j];i[p]=function(){f.apply(this,arguments);i[p]=i[j];return o.apply(this,arguments)}},getXY:function(i,p,j,f){j=j.defaultView||j.parentWindow;i-=z.scrollLeft(j);p-=z.scrollTop(j);if(f)if(j!=(f.defaultView||f.parentWindow)&&j.frameElement){f=
z._4e_getOffset(j.frameElement,f);i+=f.left;p+=f.top}return{left:i,top:p}},tryThese:function(){for(var i,p=0,j=arguments.length;p<j;p++){var f=arguments[p];try{i=f();break}catch(o){}}return i},arrayCompare:function(i,p){if(!i&&!p)return true;if(!i||!p||i.length!=p.length)return false;for(var j=0;j<i.length;j++)if(i[j]!==p[j])return false;return true},getByAddress:function(i,p,j){i=i.documentElement;for(var f=0;i&&f<p.length;f++){var o=p[f];if(j)for(var n=-1,A=0;A<i.childNodes.length;A++){var u=i.childNodes[A];
if(!(j===true&&u.nodeType==3&&u.previousSibling&&u.previousSibling.nodeType==3)){n++;if(n==o){i=u;break}}}else i=i.childNodes[o]}return i?new H(i):null},clearAllMarkers:function(i){for(var p in i)i[p]._4e_clearMarkers(i,true)},htmlEncodeAttr:function(i){return i.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(i){return i.replace(/^\s+/,"")},rtrim:function(i){return i.replace(/\s+$/,"")},trim:function(i){return this.ltrim(this.rtrim(i))},mix:function(){for(var i={},
p=0;p<arguments.length;p++)i=C.mix(i,arguments[p]);return i},isCustomDomain:function(){if(!t.ie)return false;var i=document.domain,p=window.location.hostname;return i!=p&&i!="["+p+"]"},duplicateStr:function(i,p){return Array(p+1).join(i)},throttle:function(i,p,j){j=j||150;if(j===-1)return function(){i.apply(p,arguments)};var f=(new Date).getTime();return function(){var o=(new Date).getTime();if(o-f>j){f=o;i.apply(p,arguments)}}},buffer:function(i,p,j){j=j||0;var f=null;return function(){f&&clearTimeout(f);
var o=arguments;f=setTimeout(function(){return i.apply(p,o)},j)}},isNumber:function(i){return/^\d+(.\d+)?$/.test(C.trim(i))},verifyInputs:function(i){for(var p=0;p<i.length;p++){var j=z._4e_wrap(i[p]),f=C.trim(j.val()),o=j.attr("data-verify");j=j.attr("data-warning");if(o&&!RegExp(o).test(f)){alert(j);return}}return true},sourceDisable:function(i,p){i.on("sourcemode",p.disable,p);i.on("wysiwygmode",p.enable,p)},resetInput:function(i){var p=i.attr("placeholder");if(p&&!t.webkit){i.val(p);i.addClass("ke-input-tip")}else t.webkit&&
i.val("")},placeholder:function(i,p){i.attr("placeholder",p);if(!t.webkit){i.on("blur",function(){if(!C.trim(i.val())){i.val(p);i.addClass("ke-input-tip")}});i.on("focus",function(){C.trim(i.val())==p&&i.val("");i.removeClass("ke-input-tip")})}},clean:function(i){i=i[0]||i;for(var p=C.makeArray(i.childNodes),j=0;j<p.length;j++){var f=p[j];f.nodeType==y.NODE.NODE_TEXT&&!C.trim(f.nodeValue)&&i.removeChild(f)}},htmlEncode:function(i){return!i?i:String(i).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,
"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(i){return!i?i:String(i).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(i,p){return i.toLowerCase()==p.toLowerCase()},normParams:function(i){i=C.clone(i);for(var p in i)if(i.hasOwnProperty(p)){var j=i[p];if(C.isFunction(j))i[p]=j()}return i},doFormUpload:function(i,p,j){function f(){var a={responseText:"",responseXML:null};a.argument=i?i.argument:null;try{var e;if((e=t.ie?n.contentWindow.document:
n.contentDocument||window.frames[o].document)&&e.body)a.responseText=e.body.innerHTML;a.responseXML=e&&e.XMLDocument?e.XMLDocument:e}catch(d){}s.remove(n,"load",f);i.callback&&i.callback(a);setTimeout(function(){z._4e_remove(n)},100)}var o=C.guid("form-upload-"),n=document.createElement("iframe");n.id=o;n.name=o;n.className="ke-hidden";if(t.ie)n.src="javascript:false";document.body.appendChild(n);if(t.ie)document.frames[o].name=o;var A=z._4e_unwrap(i.form),u={target:A.target,method:A.method,encoding:A.encoding,
enctype:A.enctype,action:A.action};A.target=o;A.method="POST";A.enctype=A.encoding="multipart/form-data";if(j)A.action=j;var k;if(p){k=[];p=y.Utils.normParams(p);for(var v in p)if(p.hasOwnProperty(v)){j=document.createElement("input");j.type="hidden";j.name=v;j.value=p[v];A.appendChild(j);k.push(j)}}s.on(n,"load",f);A.submit();A.target=u.target;A.method=u.method;A.enctype=u.enctype;A.encoding=u.encoding;A.action=u.action;if(k){p=0;for(A=k.length;p<A;p++)z._4e_remove(k[p])}}}});
KISSY.Editor.add("focusmanager",function(y){function C(){this.iframeFocus=true;p=this}function H(){this.iframeFocus=false;p=null}var z=KISSY,t=z.DOM,s=z.Event;z={};var i={},p;z={refreshAll:function(){for(var j in i){var f=i[j];f.document.designMode="off";f.document.designMode="on"}},currentInstance:function(){return p},getInstance:function(j){return i[j]},add:function(j){var f=t._4e_getWin(j.document);s.on(f,"focus",C,j);s.on(f,"blur",H,j)},register:function(j){i[j._UUID]=j},remove:function(j){delete i[j._UUID];
var f=t._4e_getWin(j.document);s.remove(f,"focus",C,j);s.remove(f,"blur",H,j)}};y.focusManager=z;y.getInstances=function(){return i}});
KISSY.Editor.add("definition",function(y){function C(k,v){return f+"<html><head><title>${title}</title><link href='"+y.Config.base+o+"' rel='stylesheet'/><style>"+(v||"")+"</style></head><body class='ke-editor'>&nbsp;"+(k?'<script id="ke_actscript" type="text/javascript">'+(y.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+k+'");<\/script>':"")+"</body></html>"}var H=KISSY,z=H.UA,t=H.DOM,s=H.Node,i=H.Event,p=y.focusManager,j=y.Utils.tryThese,
f="<!doctype html>",o=y.Utils.debugUrl("theme/editor-iframe.css"),n=1,A="document.open();"+(y.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();",u="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(z.ie?"javascript:void(function(){"+encodeURIComponent(A)+
"}())":"")+'"  tabIndex="'+(z.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";y.SOURCE_MODE=0;y.WYSIWYG_MODE=1;H.augment(y,{init:function(k){if(z.ie)t.addClass(document.body,"ie"+z.ie);else if(z.gecko)t.addClass(document.body,"gecko");else z.webkit&&t.addClass(document.body,"webkit");var v=this,a=new s(u.replace(/\$\(tabIndex\)/,k.attr("tabIndex")));a.on("mousedown",function(c){if(z.webkit){var q=t._4e_name(c.target);
if(q=="select"||q=="option")return true}c.halt()});k.on("mousedown",function(c){c.stopPropagation()});v.editorWrap=a;v._UUID=n++;p.register(v);v.wrap=a.one(".ke-textarea-wrap");v.iframe=v.wrap.one("iframe");v.toolBarDiv=a.one(".ke-editor-tools");v.textarea=k;v.statusDiv=a.one(".ke-editor-status");v.toolBarDiv._4e_unselectable();v._commands={};v._dialogs={};var e=k._4e_style("width"),d=k._4e_style("height");if(e){a.css("width",e);k.css("width","100%")}v.textarea.css("display","none");a.insertAfter(k);
v.wrap[0].appendChild(k[0]);if(d){v.wrap.css("height",d);k.css("height","100%")}a=v.iframe;v.on("dataReady",function(){v._ready=true;y.fire("instanceCreated",{editor:v})});z.gecko?a.on("load",v._setUpIFrame,v):v._setUpIFrame();v.cfg.attachForm&&k[0].form&&v._attachForm()},_attachForm:function(){(new s(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(k,v){var a=this,e=y.SimpleOverlay;e.loading();a.use(k,function(){var d=a.getDialog(k);v(d);e.unloading()})},addDialog:function(k,
v){this._dialogs[k]=v},getDialog:function(k){return this._dialogs[k]},addPlugin:function(k){this.ready(k)},addCommand:function(k,v){this._commands[k]=v},hasCommand:function(k){return this._commands[k]},execCommand:function(k){var v=this._commands[k],a=H.makeArray(arguments);a.shift();a.unshift(this);return v.exec.apply(v,a)},getMode:function(){return this.textarea.css("display")=="none"?y.WYSIWYG_MODE:y.SOURCE_MODE},getData:function(k){var v;v=this.getMode()==y.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)v=k?this.htmlDataProcessor.toHtml(v,"p"):this.htmlDataProcessor.toServer(v,"p");return v},setData:function(k){var v;if(this.htmlDataProcessor)v=this.htmlDataProcessor.toDataFormat(k,"p");this.document.body.innerHTML=v;this.getMode()!=y.WYSIWYG_MODE&&this.textarea.val(k)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(k){k=k||0;return k+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},_setRawData:function(k){this.document.body.innerHTML=
k},_prepareIFrameHtml:C,getSelection:function(){return y.Selection.getSelection(this.document)},focus:function(){var k=this.document,v=t._4e_getWin(k);z.webkit&&v&&v.parent&&v.parent.focus();v&&v.focus();k&&k.body.focus();this.notifySelectionChange()},blur:function(){t._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(k){var v=this.cfg,a=this.document;v.customStyle=v.customStyle||"";v.customStyle+="\n"+k;v=a.createElement("style");a.getElementsByTagName("head")[0].appendChild(v);
if(v.styleSheet)v.styleSheet.cssText=k;else v.appendChild(a.createTextNode(k))},_setUpIFrame:function(){function k(){c=d.document;v.document=c;a.detach();c.open("text/html","replace");c.write(e);c.close()}var v=this,a=v.iframe,e=C(v._UUID,v.cfg.customStyle),d=a[0].contentWindow,c;try{c=d.document}catch(q){a[0].src=a[0].src;if(z.ie<7){setTimeout(k,10);return}}k()},ready:function(k){this._ready?k():this.on("dataReady",k)},_monitor:function(){var k=this;k._monitorId&&clearTimeout(k._monitorId);k._monitorId=
setTimeout(function(){var v=k.getSelection();if(v&&!v.isInvalid){var a=v.getStartElement(),e=new y.ElementPath(a);if(!k.previousPath||!k.previousPath.compare(e)){k.previousPath=e;k.fire("selectionChange",{selection:v,path:e,element:a})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(k,v){var a=this;a.focus();var e=k._4e_name(),d=y.XHTML_DTD,c=y.RANGE,q=y.NODE,l=d.$block[e],b=a.getSelection(),g=b&&b.getRanges(),h,m,r,x,F;if(!g||g.length==0){var L=
arguments,I=L.callee;setTimeout(function(){I.apply(a,L)},30)}else{a.fire("save");for(var M=g.length-1;M>=0;M--){h=g[M];h.deleteContents();m=!M&&k||k._4e_clone(true);v&&v(m);if(l)for(;(x=h.getCommonAncestor(false,true))&&(F=d[x._4e_name()])&&!(F&&F[e]);)if(x._4e_name()in d.span)h.splitElement(x);else if(h.checkStartOfBlock()&&h.checkEndOfBlock()){h.setStartBefore(x);h.collapse(true);x._4e_remove()}else h.splitBlock();h.insertNode(m);r||(r=m)}e=r._4e_nextSourceNode(true);d=a.document;F=y.XHTML_DTD;
if(F.$inline[m._4e_name()]){e=new s(d.createTextNode(" "));e.insertAfter(r)}else if(e){if(e._4e_name()=="br"&&F[e.parent()._4e_name()].p){F=new s("<p>&nbsp;</p>",null,d);e[0].parentNode.replaceChild(F[0],e[0]);e=F}}else{F=new s("<p>&nbsp;</p>",null,d);F.insertAfter(r);e=F}h.moveToPosition(r,c.POSITION_AFTER_END);e&&e[0].nodeType==q.NODE_ELEMENT&&h.moveToElementEditablePosition(e);b.selectRanges([h]);a.focus();m&&m._4e_scrollIntoView();setTimeout(function(){a.fire("save")},10);return m}},insertHtml:function(k){var v=
this;if(v.htmlDataProcessor)k=v.htmlDataProcessor.toDataFormat(k);if(z.webkit){var a=t.create(k,null,this.document);a=a.nodeType==11?H.makeArray(a.childNodes):[a];for(var e=0;e<a.length;e++)v.insertElement(new s(a[e]))}else{v.focus();e=(a=v.getSelection())&&a.getRanges();if(!e||e.length==0){var d=arguments,c=d.callee;setTimeout(function(){c.apply(v,d)},30)}else{v.fire("save");if(z.ie){a=a.getNative();a.type=="Control"&&a.clear();a.createRange().pasteHTML(k)}else v.document.execCommand("inserthtml",
false,k);v.focus();setTimeout(function(){v.fire("save")},10)}}}});y._initIFrame=function(k){function v(m){j(function(){d.designMode="on";setTimeout(function(){d.designMode="off";l.focus();if(!arguments.callee.retry)arguments.callee.retry=true},50)},function(){d.designMode="off";t.attr(l,"contentEditable",false);t.attr(l,"contentEditable",true);!m&&v(1)})}var a=p.getInstance(k);k=a.textarea[0];var e=a.iframe[0].contentWindow,d=a.document,c=a.cfg,q=d.getElementById("ke_actscript");t._4e_remove(q);var l=
d.body;if(z.ie){l.hideFocus=true;l.disabled=true;l.contentEditable=true;l.removeAttribute("disabled")}else setTimeout(function(){if(z.gecko||z.opera)l.contentEditable=true;else if(z.webkit)l.parentNode.contentEditable=true;else d.designMode="on"},0);if(z.webkit){i.on(d,"click",function(m){var r=new s(m.target);H.inArray(r._4e_name(),["input","select"])&&m.preventDefault()});i.on(d,"mouseup",function(m){var r=new s(m.target);H.inArray(r._4e_name(),["input","textarea"])&&m.preventDefault()})}if(z.gecko||
z.ie||z.opera){var b;b=new s(t.insertAfter((new s('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],k));b.on("focus",function(){a.focus()});a.activateGecko=function(){z.gecko&&a.iframeFocus&&b[0].focus()};a.on("destroy",function(){})}if(z.ie&&d.compatMode=="CSS1Compat"||z.gecko||z.opera){var g=new s(d.documentElement);g.on("mousedown",function(m){if(m.target==g[0]){z.gecko&&v(false);b[0].focus()}})}i.on(e,"focus",function(){if(z.gecko)v(false);else z.opera&&
l.focus();a.notifySelectionChange()});z.gecko&&i.on(a.document,"mousedown",function(){a.iframeFocus||v(false)});if(z.ie){i.on(d,"keydown",function(m){if(m.keyCode in{8:1,46:1}){var r=a.getSelection(),x=r.getSelectedElement();if(x){a.fire("save");var F=r.getRanges()[0].createBookmark();x._4e_remove();r.selectBookmarks([F]);a.fire("save");m.preventDefault()}}});if(d.compatMode=="CSS1Compat"){var h={33:1,34:1};i.on(d,"keydown",function(m){m.keyCode in h&&setTimeout(function(){a.getSelection().scrollIntoView()},
0)})}}setTimeout(function(){z.ie&&setTimeout(function(){if(d){l.runtimeStyle.marginBottom="0px";l.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){a.fire("dataReady");var m=c.disableObjectResizing,r=c.disableInlineTableEditing;if(m||r)try{d.execCommand("enableObjectResizing",false,!m);d.execCommand("enableInlineTableEditing",false,!r)}catch(x){i.on(l,z.ie?"resizestart":"resize",function(F){if(m||t._4e_name(F.target)==="table"&&r)F.preventDefault()})}},10);z.webkit&&i.on(d,"mousedown",
function(m){m=new s(m.target);H.inArray(m._4e_name(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(m)});z.gecko&&i.on(d,"dragstart",function(m){var r=new s(m.target);r._4e_name()==="img"&&/ke_/.test(r[0].className)&&m.preventDefault()});p.add(a)}});
KISSY.Editor.add("zindex",function(){var y=KISSY,C=y.Editor;if(!C.zIndexManager){C.zIndexManager={};y.mix(C.zIndexManager,{BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,SELECT:1200});C.baseZIndex=function(H){var z=H,t=C.getInstances(),s;for(s in t){if(!t.hasOwnProperty(s))return;z=Math.max(z,t[s].baseZIndex(H))}return z}}});
KISSY.Editor.add("dtd",function(y){y.XHTML_DTD=function(){var C=function(l){for(var b=arguments.length-1;b>0;)KISSY.mix(l,arguments[b--]);return l},H={isindex:1,fieldset:1},z={input:1,button:1,select:1,textarea:1,label:1},t=C({a:1},z),s=C({iframe:1},t),i={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},p={ins:1,del:1,script:1,style:1},j=C({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},p),f=C({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},j),o=C({p:1},f);z=C({iframe:1},f,z);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var n=C({a:1},z),A={tr:1},u={"#":1},k=C({param:1},f),v=C({form:1},H,s,i,o),a={li:1},e={base:1,link:1,meta:1,title:1},d=C(e,{style:1,script:1}),c={head:1,body:1},q={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:C({html:1},c,e),$block:q,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:n,$body:C({script:1,style:1},q),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:c,head:d,style:u,body:v,base:{},link:{},meta:{},title:u,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:v,td:v,br:{},th:v,center:v,kbd:n,button:C(o,i),basefont:{},h5:n,h4:n,samp:n,h6:n,ol:a,h1:n,h3:n,option:u,h2:n,form:C(H,s,i,o),select:{optgroup:1,option:1},font:n,ins:n,menu:a,abbr:n,label:n,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:n,script:u,tfoot:A,cite:n,li:v,input:{},iframe:v,strong:n,textarea:u,noframes:v,big:n,small:n,span:n,hr:{},dt:n,sub:n,optgroup:{option:1},param:{},bdo:n,"var":n,div:v,object:k,sup:n,dd:v,strike:n,area:{},dir:a,map:C({area:1,form:1,p:1},H,p,i),applet:k,dl:{dt:1,dd:1},del:n,isindex:{},fieldset:C({legend:1},f),thead:A,ul:a,acronym:n,b:n,a:z,blockquote:v,caption:n,i:n,u:n,tbody:A,s:n,address:C(s,o),tt:n,legend:n,q:n,pre:C(j,t),p:n,em:n,dfn:n}}()});
KISSY.Editor.add("dom",function(y){function C(a){return a.replace(/-(\w)/g,function(e,d){return d.toUpperCase()})}var H=KISSY,z=H.DOM,t=H.UA,s=H.Node,i=y.Utils,p={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};y.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};y.POSITION={};var j=y.NODE,f=y.POSITION;f.POSITION_IDENTICAL=0;f.POSITION_DISCONNECTED=
1;f.POSITION_FOLLOWING=2;f.POSITION_PRECEDING=4;f.POSITION_IS_CONTAINED=8;f.POSITION_CONTAINS=16;var o={},n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},A={hr:1},u=function(a){return a[0]||a},k=function(a){if(a&&!a[0])return new s(a);return a},v={_4e_wrap:k,_4e_unwrap:u,_4e_equals:function(a,e){if(!a&&!e)return true;if(!a||!e)return false;a=u(a);e=u(e);return a===
e},_4e_isBlockBoundary:function(a,e){a=k(a);var d=H.mix(H.mix({},A),e||{});return n[a.css("display")]||d[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=u(a);for(var e=a.parentNode.childNodes,d=0;d<e.length;d++)if(e[d]===a)return d;return-1},_4e_first:function(a,e){a=u(a);var d=a.firstChild;if((d=d&&new s(d))&&e&&!e(d))d=d._4e_next(e);return d},_4e_move:function(a,e,d){a._4e_remove();a=u(a);
e=u(e);d?e.insertBefore(a,e.firstChild):e.appendChild(a)},_4e_name:function(a){a=u(a);var e=a.nodeName.toLowerCase();if(t.ie)if((a=a.scopeName)&&a!="HTML")e=a.toLowerCase()+":"+e;return e},_4e_isIdentical:function(a,e){if(a._4e_name()!=e._4e_name())return false;var d=a[0].attributes,c=e[0].attributes,q=d.length,l=c.length;if(!t.ie&&q!=l)return false;for(var b=0;b<q;b++){var g=d[b];if((!t.ie||g.specified&&g.nodeName!="_ke_expando")&&g.nodeValue!=e.attr(g.nodeName))return false}if(t.ie)for(b=0;b<l;b++){g=
c[b];if(g.specified&&g.nodeName!="_ke_expando"&&g.nodeValue!=a.attr(g.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=u(a).childNodes;for(var e=0,d=a.length;e<d;e++){var c=a[e],q=c.nodeType;if(!(q==j.NODE_ELEMENT&&c.getAttribute("_ke_bookmark")))if(q==j.NODE_ELEMENT&&!v._4e_isEmptyInlineRemoveable(c)||q==j.NODE_TEXT&&H.trim(c.nodeValue))return false}return true},_4e_moveChildren:function(a,e,d){a=u(a);e=e[0]||e;if(a!=e)if(d)for(;d=a.lastChild;)e.insertBefore(a.removeChild(d),
e.firstChild);else for(;d=a.firstChild;)e.appendChild(a.removeChild(d))},_4e_mergeSiblings:function(){function a(e,d,c){if(d[0]&&d[0].nodeType==j.NODE_ELEMENT){for(var q=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemoveable();){q.push(d);d=c?new s(d[0].nextSibling):new s(d[0].previousSibling);if(!d[0]||d[0].nodeType!=j.NODE_ELEMENT)return}if(e._4e_isIdentical(d)){for(var l=c?e[0].lastChild:e[0].firstChild;q.length;)q.shift()._4e_move(e,!c);d._4e_moveChildren(e,!c);d._4e_remove();l[0]&&l[0].nodeType==
j.NODE_ELEMENT&&l._4e_mergeSiblings()}}}return function(e){if(e[0])if(p[e._4e_name()]||e._4e_name()=="a"){a(e,new s(e[0].nextSibling),true);a(e,new s(e[0].previousSibling))}}}(),_4e_unselectable:t.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:t.webkit?function(a){a=u(a);a.style.KhtmlUserSelect="none"}:function(a){a=u(a);if(t.ie||t.opera){var e,d=0;for(a.unselectable="on";e=a.all[d++];)switch(e.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:e.unselectable=
"on"}}},_4e_getOffset:function(a,e){a=u(a);var d,c=0;d=0;var q=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,l=a.ownerDocument,b=l.documentElement;e=e||l;if(a.getBoundingClientRect){if(a!==l.body&&b!==a){d=a.getBoundingClientRect();c=d.left+(e===l?z.scrollLeft(q):0);d=d.top+(e===l?z.scrollTop(q):0)}if(e)if(q!=(e.defaultView||e.parentWindow)&&q.frameElement){q=v._4e_getOffset(q.frameElement,e);c+=q.left;d+=q.top}}return{left:c,top:d}},_4e_getFrameDocument:function(a){return(a=u(a))&&a.contentWindow.document},
_4e_splitText:function(a,e){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=j.NODE_TEXT)){if(t.ie&&e==a.nodeValue.length){var c=d.createTextNode("");z.insertAfter(c,a);return new s(c)}c=new s(a.splitText(e));if(t.ie==8){d=d.createTextNode("");z.insertAfter(d,c[0]);d.parentNode.removeChild(d)}return c}},_4e_parents:function(a,e){a=k(a);var d=[];do d[e?"push":"unshift"](a);while(a=a.parent());return d},_4e_clone:function(a,e,d){a=u(a);a=a.cloneNode(e);if(!d){var c=function(q){if(q.nodeType==j.NODE_ELEMENT){q.removeAttribute("id",
false);q.removeAttribute("_ke_expando",false);q=q.childNodes;for(var l=0;l<q.length;l++)c(q[l])}};c(a)}return new s(a)},_4e_nextSourceNode:function(a,e,d,c){a=u(a);if(c&&!c.call){var q=c[0]||c;c=function(b){b=b[0]||b;return b!==q}}e=!e&&a.firstChild;var l=new s(a);if(!e){if(a.nodeType==j.NODE_ELEMENT&&c&&c(a,true)===false)return null;e=a.nextSibling}for(;!e&&(l=l.parent());){if(c&&c(l,true)===false)return null;e=l[0].nextSibling}if(!e)return null;e=z._4e_wrap(e);if(c&&c(e)===false)return null;if(d&&
d!=e[0].nodeType)return e._4e_nextSourceNode(false,d,c);return e},_4e_previousSourceNode:function(a,e,d,c){a=u(a);if(c&&!c.call){var q=c[0]||c;c=function(b){b=b[0]||b;return b!==q}}e=!e&&a.lastChild;var l=new s(a);if(!e){if(a.nodeType==j.NODE_ELEMENT&&c&&c(a,true)===false)return null;e=a.previousSibling}for(;!e&&(l=l.parent());){if(c&&c(l,true)===false)return null;e=l[0].previousSibling}if(!e)return null;e=z._4e_wrap(e);if(c&&c(e)===false)return null;if(d&&e[0].nodeType!=d)return e._4e_previousSourceNode(false,
d,c);return e},_4e_contains:t.ie||t.webkit?function(a,e){a=u(a);e=u(e);return e.nodeType!=j.NODE_ELEMENT?a.contains(e.parentNode):a!=e&&a.contains(e)}:function(a,e){a=u(a);e=u(e);return!!(a.compareDocumentPosition(e)&16)},_4e_commonAncestor:function(a,e){if(a._4e_equals(e))return a;if(e[0].nodeType!=j.NODE_TEXT&&e._4e_contains(a))return e;var d=a[0].nodeType==j.NODE_TEXT?a.parent():a;do if(d[0].nodeType!=j.NODE_TEXT&&d._4e_contains(e))return d;while(d=d.parent());return null},_4e_ascendant:function(a,
e,d){a=u(a);if(!d)a=a.parentNode;if(e&&!H.isFunction(e)){var c=e;e=function(q){return q._4e_name()==c}}for(;a&&a.nodeType!=9;){if(!e||e(new s(a))===true)return new s(a);a=a.parentNode}return null},_4e_hasAttribute:function(a,e){a=u(a);var d=a.attributes.getNamedItem(e);return!!(d&&d.specified)},_4e_hasAttributes:t.ie?function(a){a=u(a);for(var e=a.attributes,d=0;d<e.length;d++){var c=e[d];switch(c.nodeName){case "class":if(a.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(c.specified)return true}}return false}:
function(a){a=u(a);t.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},_4e_position:function(a,e){var d=u(a),c=u(e);if(d.compareDocumentPosition)return d.compareDocumentPosition(c);if(d==c)return f.POSITION_IDENTICAL;if(d.nodeType==j.NODE_ELEMENT&&c.nodeType==j.NODE_ELEMENT){if(d.contains){if(d.contains(c))return f.POSITION_CONTAINS+f.POSITION_PRECEDING;if(c.contains(d))return f.POSITION_IS_CONTAINED+f.POSITION_FOLLOWING}if("sourceIndex"in
d)return d.sourceIndex<0||c.sourceIndex<0?f.POSITION_DISCONNECTED:d.sourceIndex<c.sourceIndex?f.POSITION_PRECEDING:f.POSITION_FOLLOWING}d=a._4e_address();c=e._4e_address();for(var q=Math.min(d.length,c.length),l=0;l<=q-1;l++)if(d[l]!=c[l]){if(l<q)return d[l]<c[l]?f.POSITION_PRECEDING:f.POSITION_FOLLOWING;break}return d.length<c.length?f.POSITION_CONTAINS+f.POSITION_PRECEDING:f.POSITION_IS_CONTAINED+f.POSITION_FOLLOWING},_4e_address:function(a,e){a=u(a);for(var d=[],c=a.ownerDocument.documentElement,
q=a;q&&q!=c;){var l=q.parentNode,b=-1;if(l){for(var g=0;g<l.childNodes.length;g++){var h=l.childNodes[g];if(!(e&&h.nodeType==3&&h.previousSibling&&h.previousSibling.nodeType==3)){b++;if(h==q)break}}d.unshift(b)}q=l}return d},_4e_breakParent:function(a,e){var d=new y.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(e);var c=d.extractContents();d.insertNode(a._4e_remove());a[0].parentNode.insertBefore(c,a[0].nextSibling)},_4e_style:function(a,e,d){if(d!==undefined)return a.css(e,d);a=a[0]||
a;return a.style[C(e)]},_4e_remove:function(a,e){var d=u(a),c=d.parentNode;if(c){if(e)for(var q;q=d.firstChild;)c.insertBefore(d.removeChild(q),d);c.removeChild(d)}return a},_4e_trim:function(a){z._4e_ltrim(a);z._4e_rtrim(a)},_4e_ltrim:function(a){a=u(a);for(var e;e=a.firstChild;){if(e.nodeType==j.NODE_TEXT){var d=i.ltrim(e.nodeValue),c=e.nodeValue.length;if(d){if(d.length<c){(new s(e))._4e_splitText(c-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(e);continue}}break}},_4e_rtrim:function(a){a=
u(a);for(var e;e=a.lastChild;){if(e.type==j.NODE_TEXT){var d=i.rtrim(e.nodeValue),c=e.nodeValue.length;if(d){if(d.length<c){(new s(e))._4e_splitText(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(e);continue}}break}if(!t.ie&&!t.opera)(e=a.lastChild)&&e.nodeType==1&&e.nodeName.toLowerCase()=="br"&&e.parentNode.removeChild(e)},_4e_appendBogus:function(a){a=u(a);for(var e=a.lastChild;e&&e.nodeType==j.NODE_TEXT&&!H.trim(e.nodeValue);)e=e.previousSibling;if(!e||e.nodeType==j.NODE_TEXT||z._4e_name(e)!==
"br"){e=t.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");t.gecko&&e.setAttribute("type","_moz");a.appendChild(e)}},_4e_previous:function(a,e){var d=u(a),c;do c=(d=d.previousSibling)&&new s(d);while(c&&e&&!e(c));return c},_4e_last:function(a,e){a=z._4e_wrap(a);var d=a[0].lastChild;if((d=d&&new s(d))&&e&&!e(d))d=d._4e_previous(e);return d},_4e_next:function(a,e){var d=u(a),c;do c=(d=d.nextSibling)&&new s(d);while(c&&e&&!e(c));return c},_4e_outerHtml:function(a){a=u(a);
if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var e=a.ownerDocument.createElement("div");e.appendChild(a.cloneNode(true));return e.innerHTML},_4e_setMarker:function(a,e,d,c){a=z._4e_wrap(a);var q=a._4e_getData("list_marker_id")||a._4e_setData("list_marker_id",H.guid())._4e_getData("list_marker_id"),l=a._4e_getData("list_marker_names")||a._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");e[q]=a;l[d]=1;return a._4e_setData(d,c)},_4e_clearMarkers:function(a,e,d){a=k(a);
var c=a._4e_getData("list_marker_names"),q=a._4e_getData("list_marker_id"),l;for(l in c)a._4e_removeData(l);a._4e_removeData("list_marker_names");if(d){a._4e_removeData("list_marker_id");delete e[q]}},_4e_setData:function(a,e,d){var c=z._4e_getUniqueId(a);(o[c]||(o[c]={}))[e]=d;return a},_4e_getData:function(a,e){a=u(a);var d=a.getAttribute("_ke_expando");return(d=d&&o[d])&&d[e]},_4e_removeData:function(a,e){a=u(a);var d=a.getAttribute("_ke_expando");var c=(d=d&&o[d])&&d[e];typeof c!="undefined"&&
d&&delete d[e];H.isEmptyObject(d)&&z._4e_clearData(a);return c||null},_4e_clearData:function(a){a=u(a);var e=a.getAttribute("_ke_expando");e&&delete o[e];e&&a.removeAttribute("_ke_expando")},_4e_getUniqueId:function(a){a=u(a);var e=a.getAttribute("_ke_expando");if(e)return e;e=H.guid();a.setAttribute("_ke_expando",e);return e},_4e_copyAttributes:function(a,e,d){a=u(a);var c=a.attributes;d=d||{};for(var q=0;q<c.length;q++){var l=c[q],b=l.nodeName.toLowerCase(),g;if(!(b in d))if(b=="checked"&&(g=z.attr(a,
b)))e.attr(b,g);else if(l.specified||t.ie&&l.nodeValue&&b=="value"){g=z.attr(a,b);if(g===null)g=l.nodeValue;e.attr(b,g)}}if(a.style.cssText!=="")e[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=z._4e_name(a);var e=y.XHTML_DTD;return(a=!e.$nonEditable[a]&&(e[a]||e.span))&&a["#"]},_4e_scrollIntoView:function(a){a=k(a);var e=a[0].ownerDocument,d=z.scrollLeft(e),c=z.scrollTop(e),q=a.offset(),l=q.left;q=q.top;if(z.viewportHeight(e)+c<q||q<c||z.viewportWidth(e)+d<l||l<d)a.scrollIntoView(e)},
_4e_getElementsByTagName:function(a,e,d){a=u(a);if(!t.ie&&d)e=d+":"+e;d=[];a=a.getElementsByTagName(e);for(e=0;e<a.length;e++)d.push(new s(a[e]));return d}};H.DOM._4e_inject=function(a){H.mix(z,a);for(var e in a)a.hasOwnProperty(e)&&function(d){s.prototype[d]=function(){var c=[].slice.call(arguments,0);c.unshift(this);return a[d].apply(null,c)}}(e)};H.DOM._4e_inject(v)});
KISSY.Editor.add("elementpath",function(y){function C(f){var o=null,n=null,A=[];for(f=f;f&&f[0];){if(f[0].nodeType==s.NODE_ELEMENT){if(!this.lastElement)this.lastElement=f;var u=f._4e_name();if(i.ie&&f[0].scopeName!="HTML")u=f[0].scopeName.toLowerCase()+":"+u;if(!n){if(!o&&p[u])o=f;if(j[u]){var k;if(k=!o){if(k=u=="div"){a:{k=f;k=k[0]||k;k=k.childNodes;for(var v=0,a=k.length;v<a;v++){var e=k[v];if(e.nodeType==s.NODE_ELEMENT&&t.$block[e.nodeName.toLowerCase()]){k=true;break a}}k=false}k=!k}k=k}if(k)o=
f;else n=f}}A.push(f);if(u=="body")break}f=f.parent()}this.block=o;this.blockLimit=n;this.elements=A}var H=KISSY,z=H.DOM,t=y.XHTML_DTD,s=y.NODE,i=H.UA,p={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};C.prototype={compare:function(f){var o=this.elements;f=f&&f.elements;if(!f||o.length!=f.length)return false;for(var n=0;n<o.length;n++)if(!z._4e_equals(o[n],f[n]))return false;return true},contains:function(f){for(var o=
this.elements,n=0;n<o.length;n++)if(o[n]._4e_name()in f)return o[n];return null}};y.ElementPath=C});
KISSY.Editor.add("walker",function(y){function C(j,f){if(this._.end)return null;var o,n=this.range,A,u=this.guard,k=this.type,v=j?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;n.trim();if(n.collapsed){this.end();return null}}if(!j&&!this._.guardLTR){var a=n.endContainer,e=new p(a[0].childNodes[n.endOffset]);this._.guardLTR=function(l,b){return(l=i._4e_wrap(l))&&l[0]&&(!b||!i._4e_equals(a,l))&&(!e[0]||!l._4e_equals(e))&&(l[0].nodeType!=s.NODE_ELEMENT||!b||l._4e_name()!=
"body")}}if(j&&!this._.guardRTL){var d=n.startContainer,c=n.startOffset>0&&new p(d[0].childNodes[n.startOffset-1]);this._.guardRTL=function(l,b){return(l=i._4e_wrap(l))&&l[0]&&(!b||!l._4e_equals(d))&&(!c[0]||!l._4e_equals(c))&&(l[0].nodeType!=s.NODE_ELEMENT||!b||l._4e_name()!="body")}}var q=j?this._.guardRTL:this._.guardLTR;A=u?function(l,b){if(q(l,b)===false)return false;return u(l,b)}:q;if(this.current)o=this.current[v](false,k,A);else if(j){o=n.endContainer;if(n.endOffset>0){o=new p(o[0].childNodes[n.endOffset-
1]);if(A(o)===false)o=null}else o=A(o,true)===false?null:o._4e_previousSourceNode(true,k,A)}else{o=n.startContainer;if((o=new p(o[0].childNodes[n.startOffset]))&&o[0]){if(A(o)===false)o=null}else o=A(n.startContainer,true)===false?null:n.startContainer._4e_nextSourceNode(true,k,A)}for(;o&&o[0]&&!this._.end;){this.current=o;if(!this.evaluator||this.evaluator(o)!==false){if(!f)return o}else if(f&&this.evaluator)return false;o=o[v](false,k,A)}this.end();return this.current=null}function H(j){for(var f,
o=null;f=C.call(this,j);)o=f;return o}function z(j){this.range=j;this._={}}var t=KISSY,s=y.NODE,i=t.DOM,p=t.Node;t.augment(z,{end:function(){this._.end=1},next:function(){return C.call(this)},previous:function(){return C.call(this,true)},checkForward:function(){return C.call(this,false,true)!==false},checkBackward:function(){return C.call(this,true,true)!==false},lastForward:function(){return H.call(this)},lastBackward:function(){return H.call(this,true)},reset:function(){delete this.current;this._=
{}}});z.blockBoundary=function(j){return function(f){f=i._4e_wrap(f);return!(f&&f[0].nodeType==s.NODE_ELEMENT&&f._4e_isBlockBoundary(j))}};z.listItemBoundary=function(){return this.blockBoundary({br:1})};z.bookmark=function(j,f){function o(n){return n&&n[0]&&n._4e_name()=="span"&&n.attr("_ke_bookmark")}return function(n){var A,u;A=n&&n[0]&&n[0].nodeType==s.NODE_TEXT&&(u=n.parent())&&o(u);A=j?A:A||o(n);return f^A}};z.whitespaces=function(j){return function(f){f=(f=f[0]||f)&&f.nodeType==s.NODE_TEXT&&
!t.trim(f.nodeValue);return j^f}};z.invisible=function(j){var f=z.whitespaces();return function(o){o=f(o)||o[0].nodeType==s.NODE_ELEMENT&&!o[0].offsetHeight;return j^o}};y.Walker=z});
KISSY.Editor.add("range",function(y){function C(b){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=true;this.document=b}function H(b){var g=b[0].nodeType!=j.NODE_TEXT&&b._4e_name()in v.$removeEmpty,h=!p.trim(b[0].nodeValue);b=!!b.parent().attr("_ke_bookmark");return g||h||b}function z(b){return!q(b)&&!l(b)}function t(b){var g=false,h=n.bookmark(true);return function(m){if(h(m))return true;if(m[0].nodeType==j.NODE_TEXT){if(p.trim(m[0].nodeValue).length)return false}else if(m[0].nodeType==
j.NODE_ELEMENT)if(!c[m._4e_name()])if(!b&&!k.ie&&m._4e_name()=="br"&&!g)g=true;else return false;return true}}function s(b,g){function h(m){return m&&m.nodeName=="span"&&m.getAttribute("_ke_bookmark")}return function(m){var r,x;r=m&&!m.nodeName&&(x=m.parentNode)&&h(x);r=b?r:r||h(m);return g^r}}function i(b){return function(g){g=(g=g[0]||g)&&g.nodeType==j.NODE_TEXT&&!p.trim(g.nodeValue);return b^g}}y.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var p=KISSY,j=y.NODE,f=y.RANGE,o=y.POSITION,n=y.Walker,A=p.DOM,u=y.Utils.getByAddress,k=p.UA,v=y.XHTML_DTD,a=y.ElementPath,e=p.Node,d={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};C.prototype.toString=function(){var b=[];b.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);b.push((this.endContainer[0].id||this.endContainer[0].nodeName)+
":"+this.endOffset);return b.join("<br/>")};p.augment(C,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&A._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var b=this.startContainer,g=this.startOffset;if(b[0].nodeType!=j.NODE_ELEMENT)if(g)g>=b[0].nodeValue.length&&this.setStartAfter(b);else this.setStartBefore(b);b=this.endContainer;g=this.endOffset;if(b[0].nodeType!=j.NODE_ELEMENT)if(g)g>=b[0].nodeValue.length&&
this.setEndAfter(b);else this.setEndBefore(b)},setStartAfter:function(b){this.setStart(b.parent(),b._4e_index()+1)},setStartBefore:function(b){this.setStart(b.parent(),b._4e_index())},setEndAfter:function(b){this.setEnd(b.parent(),b._4e_index()+1)},setEndBefore:function(b){this.setEnd(b.parent(),b._4e_index())},optimizeBookmark:function(){var b=this.startContainer,g=this.endContainer;b&&b._4e_name()=="span"&&b.attr("_ke_bookmark")&&this.setStartAt(b,f.POSITION_BEFORE_START);g&&g._4e_name()=="span"&&
g.attr("_ke_bookmark")&&this.setEndAt(g,f.POSITION_AFTER_END)},setStart:function(b,g){if(b[0].nodeType==j.NODE_ELEMENT&&d[b._4e_name()]){b=b.parent();g=b._4e_index()}this.startContainer=b;this.startOffset=g;if(!this.endContainer){this.endContainer=b;this.endOffset=g}this.updateCollapsed()},setEnd:function(b,g){if(b[0].nodeType==j.NODE_ELEMENT&&d[b._4e_name()]){b=b.parent();g=b._4e_index()+1}this.endContainer=b;this.endOffset=g;if(!this.startContainer){this.startContainer=b;this.startOffset=g}this.updateCollapsed()},
setStartAt:function(b,g){switch(g){case f.POSITION_AFTER_START:this.setStart(b,0);break;case f.POSITION_BEFORE_END:b[0].nodeType==j.NODE_TEXT?this.setStart(b,b[0].nodeValue.length):this.setStart(b,b[0].childNodes.length);break;case f.POSITION_BEFORE_START:this.setStartBefore(b);break;case f.POSITION_AFTER_END:this.setStartAfter(b)}this.updateCollapsed()},setEndAt:function(b,g){switch(g){case f.POSITION_AFTER_START:this.setEnd(b,0);break;case f.POSITION_BEFORE_END:b[0].nodeType==j.NODE_TEXT?this.setEnd(b,
b[0].nodeValue.length):this.setEnd(b,b[0].childNodes.length);break;case f.POSITION_BEFORE_START:this.setEndBefore(b);break;case f.POSITION_AFTER_END:this.setEndAfter(b)}this.updateCollapsed()},execContentsAction:function(b,g){var h=this.startContainer,m=this.endContainer,r=this.startOffset,x=this.endOffset,F,L=this.document,I;this.optimizeBookmark();if(m[0].nodeType==j.NODE_TEXT)m=m._4e_splitText(x);else if(m[0].childNodes.length>0)if(x>=m[0].childNodes.length){m=new e(m[0].appendChild(L.createTextNode("")));
I=true}else m=new e(m[0].childNodes[x]);if(h[0].nodeType==j.NODE_TEXT){h._4e_splitText(r);if(h._4e_equals(m))m=new e(h[0].nextSibling)}else if(r)if(r>=h[0].childNodes.length){F=new e(L.createTextNode(""));h.append(F);h=F;F=true}else h=new e(h[0].childNodes[r].previousSibling);else{F=new e(L.createTextNode(""));(r=h[0].firstChild)?A.insertBefore(F[0],r):h.append(F);h=F;F=true}r=h._4e_parents();x=m._4e_parents();var M,O,P;for(M=0;M<r.length;M++){O=r[M];P=x[M];if(!O._4e_equals(P))break}L=g;for(var w,
G,B,D=M;D<r.length;D++){w=r[D];if(L&&!w._4e_equals(h))G=L.appendChild(w._4e_clone()[0]);for(w=w[0].nextSibling;w;){if(A._4e_equals(x[D],w)||A._4e_equals(m,w))break;B=w.nextSibling;if(b==2)L.appendChild(w.cloneNode(true));else{w.parentNode.removeChild(w);b==1&&L.appendChild(w)}w=B}if(G)L=G}L=g;for(M=M;M<x.length;M++){w=x[M];if(b>0&&!w._4e_equals(m))G=L.appendChild(w._4e_clone()[0]);if(!r[M]||!w.parent()._4e_equals(r[M].parent()))for(w=w[0].previousSibling;w;){if(A._4e_equals(r[M],w)||A._4e_equals(h,
w))break;B=w.previousSibling;if(b==2)L.insertBefore(w.cloneNode(true),L.firstChild);else{A._4e_remove(w);b==1&&L.insertBefore(w,L.firstChild)}w=B}if(G)L=G}if(b==2){P=this.startContainer[0];if(P.nodeType==j.NODE_TEXT&&P.nextSibling&&P.nextSibling.nodeType==j.NODE_TEXT){P.data+=P.nextSibling.data;P.parentNode.removeChild(P.nextSibling)}P=this.endContainer[0];if(P.nodeType==j.NODE_TEXT&&P.nextSibling&&P.nextSibling.nodeType==j.NODE_TEXT){P.data+=P.nextSibling.data;P.parentNode.removeChild(P.nextSibling)}}else{if(O&&
P&&(!h.parent()._4e_equals(O.parent())||!m.parent()._4e_equals(P.parent()))){O=P._4e_index();F&&P.parent()._4e_equals(h.parent())&&O--;this.setStart(P.parent(),O)}this.collapse(true)}F&&h._4e_remove();I&&m[0].parentNode&&m._4e_remove()},collapse:function(b){if(b){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=true},clone:function(){var b=new C(this.document);b.startContainer=this.startContainer;
b.startOffset=this.startOffset;b.endContainer=this.endContainer;b.endOffset=this.endOffset;b.collapsed=this.collapsed;return b},getEnclosedNode:function(){var b=this.clone();b.optimize();if(b.startContainer[0].nodeType!=j.NODE_ELEMENT||b.endContainer[0].nodeType!=j.NODE_ELEMENT)return null;var g=new y.Walker(b),h=s(true,undefined),m=i(true);b.evaluator=function(r){return m(r)&&h(r)};b=g.next();g.reset();g=g.previous();return b&&b._4e_equals(g)?b:null},shrink:function(b,g){if(!this.collapsed){b=b||
f.SHRINK_TEXT;var h=this.clone(),m=this.startContainer,r=this.endContainer,x=this.startOffset,F=this.endOffset,L=1,I=1;if(m&&m[0].nodeType==j.NODE_TEXT)if(x)if(x>=m[0].nodeValue.length)h.setStartAfter(m);else{h.setStartBefore(m);L=0}else h.setStartBefore(m);if(r&&r[0].nodeType==j.NODE_TEXT)if(F)if(F>=r[0].nodeValue.length)h.setEndAfter(r);else{h.setEndAfter(r);I=0}else h.setEndBefore(r);h=new n(h);h.evaluator=function(O){O=O[0]||O;return O.nodeType==(b==f.SHRINK_ELEMENT?j.NODE_ELEMENT:j.NODE_TEXT)};
var M;h.guard=function(O,P){O=O[0]||O;if(b==f.SHRINK_ELEMENT&&O.nodeType==j.NODE_TEXT)return false;if(P&&O==M)return false;if(!P&&O.nodeType==j.NODE_ELEMENT)M=O;return true};if(L)(m=h[b==f.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(m,g?f.POSITION_AFTER_START:f.POSITION_BEFORE_START);if(I){h.reset();(h=h[b==f.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(h,g?f.POSITION_BEFORE_END:f.POSITION_AFTER_END)}return!!(L||I)}},getTouchedStartNode:function(){var b=this.startContainer;
if(this.collapsed||b[0].nodeType!=j.NODE_ELEMENT)return b;return b.childNodes[this.startOffset]||b},createBookmark2:function(b){var g=this.startContainer,h=this.endContainer,m=this.startOffset,r=this.endOffset,x,F;if(!g||!h)return{start:0,end:0};if(b){if(g[0].nodeType==j.NODE_ELEMENT)if((x=new e(g[0].childNodes[m]))&&x[0]&&x[0].nodeType==j.NODE_TEXT&&m>0&&x[0].previousSibling.nodeType==j.NODE_TEXT){g=x;m=0}for(;g[0].nodeType==j.NODE_TEXT&&(F=g._4e_previous())&&F[0].nodeType==j.NODE_TEXT;){g=F;m+=
F[0].nodeValue.length}if(!this.collapsed){if(h[0].nodeType==j.NODE_ELEMENT)if((x=new e(h[0].childNodes[r]))&&x[0]&&x[0].nodeType==j.NODE_TEXT&&r>0&&x[0].previousSibling.nodeType==j.NODE_TEXT){h=x;r=0}for(;h[0].nodeType==j.NODE_TEXT&&(F=h._4e_previous())&&F[0].nodeType==j.NODE_TEXT;){h=F;r+=F[0].nodeValue.length}}}return{start:g._4e_address(b),end:this.collapsed?null:h._4e_address(b),startOffset:m,endOffset:r,normalized:b,is2:true}},createBookmark:function(b){var g,h,m,r;g=new e("<span>",null,this.document);
g.attr("_ke_bookmark",1);g.css("display","none");g.html("&nbsp;");if(b){m=p.guid("ke_bm_");g.attr("id",m+"S")}if(!this.collapsed){h=g._4e_clone();h.html("&nbsp;");b&&h.attr("id",m+"E");r=this.clone();r.collapse();r.insertNode(h)}r=this.clone();r.collapse(true);r.insertNode(g);if(h){this.setStartAfter(g);this.setEndBefore(h)}else this.moveToPosition(g,f.POSITION_AFTER_END);return{startNode:b?m+"S":g,endNode:b?m+"E":h,serializable:b}},moveToPosition:function(b,g){this.setStartAt(b,g);this.collapse(true)},
trim:function(b,g){var h=this.startContainer,m=this.startOffset,r=this.collapsed;if((!b||r)&&h[0]&&h[0].nodeType==j.NODE_TEXT){if(m)if(m>=h[0].nodeValue.length){m=h._4e_index()+1;h=h.parent()}else{var x=h._4e_splitText(m);m=h._4e_index()+1;h=h.parent();if(A._4e_equals(this.startContainer,this.endContainer))this.setEnd(x,this.endOffset-this.startOffset);else if(A._4e_equals(h,this.endContainer))this.endOffset+=1}else{m=h._4e_index();h=h.parent()}this.setStart(h,m);if(r){this.collapse(true);return}}h=
this.endContainer;m=this.endOffset;if(!(g||r)&&h[0]&&h[0].nodeType==j.NODE_TEXT){if(m){m>=h.nodeValue.length||h._4e_splitText(m);m=h._4e_index()+1}else m=h._4e_index();h=h.parent();this.setEnd(h,m)}},insertNode:function(b){this.optimizeBookmark();this.trim(false,true);var g=this.startContainer,h=g[0].childNodes[this.startOffset];this.optimizeBookmark();this.trim(false,true);h?A.insertBefore(b[0]||b,h):g[0].appendChild(b[0]||b);A._4e_equals(b.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(b)},
moveToBookmark:function(b){if(b.is2){var g=u(this.document,b.start,b.normalized),h=b.startOffset,m=b.end&&u(this.document,b.end,b.normalized);b=b.endOffset;this.setStart(g,h);m?this.setEnd(m,b):this.collapse(true)}else{g=(h=b.serializable)?p.one("#"+b.startNode,this.document):b.startNode;b=h?p.one("#"+b.endNode,this.document):b.endNode;this.setStartBefore(g);g._4e_remove();if(b&&b[0]){this.setEndBefore(b);b._4e_remove()}else this.collapse(true)}},getCommonAncestor:function(b,g){var h=this.startContainer,
m=this.endContainer;h=A._4e_equals(h,m)?b&&h[0].nodeType==j.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new e(h[0].childNodes[this.startOffset]):h:h._4e_commonAncestor(m);return g&&h[0].nodeType==j.NODE_TEXT?h.parent():h},enlarge:function(b){switch(b){case f.ENLARGE_ELEMENT:if(this.collapsed)break;b=this.getCommonAncestor();var g=new e(this.document.body),h,m,r,x,F,L=false,I,M;I=this.startContainer;M=this.startOffset;if(I[0].nodeType==j.NODE_TEXT){if(M){I=!p.trim(I[0].nodeValue.substring(0,M)).length&&
I;L=!!I}if(I)if(!(x=I[0].previousSibling))r=I.parent()}else{if(M)x=I[0].childNodes[M-1]||I[0].lastChild;x||(r=I)}for(;r||x;){if(r&&!x){if(!F&&A._4e_equals(r,b))F=true;if(!g._4e_contains(r))break;if(!L||r.css("display")!="inline"){L=false;if(F)h=r;else this.setStartBefore(r)}x=r[0].previousSibling}for(;x;){I=false;if(x.nodeType==j.NODE_TEXT){M=x.nodeValue;if(/[^\s\ufeff]/.test(M))x=null;I=/[\s\ufeff]$/.test(M)}else if(x.offsetWidth>0&&!x.getAttribute("_ke_bookmark"))if(L&&v.$removeEmpty[x.nodeName.toLowerCase()]){M=
A.text(x);if(/[^\s\ufeff]/.test(M))x=null;else for(var O=x.all||x.getElementsByTagName("*"),P=0,w;w=O[P++];)if(!v.$removeEmpty[w.nodeName.toLowerCase()]){x=null;break}if(x)I=!!M.length}else x=null;if(I)if(L)if(F)h=r;else r&&this.setStartBefore(r);else L=true;if(x){I=x.previousSibling;if(!r&&!I){r=new e(x);x=null;break}x=I}else r=null}if(r)r=r.parent()}I=this.endContainer;M=this.endOffset;r=x=null;F=L=false;if(I[0].nodeType==j.NODE_TEXT){I=!p.trim(I[0].nodeValue.substring(M)).length&&I;L=!(I&&I[0].nodeValue.length);
if(I)if(!(x=I[0].nextSibling))r=I.parent()}else(x=I[0].childNodes[M])||(r=I);for(;r||x;){if(r&&!x){if(!F&&A._4e_equals(r,b))F=true;if(!g._4e_contains(r))break;if(!L||r.css("display")!="inline"){L=false;if(F)m=r;else r&&this.setEndAfter(r)}x=r[0].nextSibling}for(;x;){I=false;if(x.nodeType==j.NODE_TEXT){M=x.nodeValue;if(/[^\s\ufeff]/.test(M))x=null;I=/^[\s\ufeff]/.test(M)}else if(x.offsetWidth>0&&!x.getAttribute("_ke_bookmark"))if(L&&v.$removeEmpty[x.nodeName.toLowerCase()]){M=A.text(x);if(/[^\s\ufeff]/.test(M))x=
null;else{O=x.all||x.getElementsByTagName("*");for(P=0;w=O[P++];)if(!v.$removeEmpty[w.nodeName.toLowerCase()]){x=null;break}}if(x)I=!!M.length}else x=null;if(I)if(L)if(F)m=r;else this.setEndAfter(r);if(x){I=x.nextSibling;if(!r&&!I){r=new e(x);x=null;break}x=I}else r=null}if(r)r=r.parent()}if(h&&m){b=h._4e_contains(m)?m:h;this.setStartBefore(b);this.setEndAfter(b)}break;case f.ENLARGE_BLOCK_CONTENTS:case f.ENLARGE_LIST_ITEM_CONTENTS:r=new C(this.document);g=new e(this.document.body);r.setStartAt(g,
f.POSITION_AFTER_START);r.setEnd(this.startContainer,this.startOffset);r=new n(r);var G,B,D=n.blockBoundary(b==f.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),E=function(K){var J=D(K);J||(G=K);return J};h=function(K){var J=E(K);if(!J&&K[0]&&K._4e_name()=="br")B=K;return J};r.guard=E;r=r.lastBackward();G=G||g;this.setStartAt(G,G._4e_name()!="br"&&(!r&&this.checkStartOfBlock()||r&&G._4e_contains(r))?f.POSITION_AFTER_START:f.POSITION_AFTER_END);r=this.clone();r.collapse();r.setEndAt(g,f.POSITION_BEFORE_END);
r=new n(r);r.guard=b==f.ENLARGE_LIST_ITEM_CONTENTS?h:E;G=null;r=r.lastForward();G=G||g;this.setEndAt(G,!r&&this.checkEndOfBlock()||r&&G._4e_contains(r)?f.POSITION_BEFORE_END:f.POSITION_BEFORE_START);B&&this.setEndAfter(B)}},checkStartOfBlock:function(){var b=this.startContainer,g=this.startOffset;if(g&&b[0].nodeType==j.NODE_TEXT)if(p.trim(b[0].nodeValue.substring(0,g)).length)return false;this.trim();b=new a(this.startContainer);g=this.clone();g.collapse(true);g.setStartAt(b.block||b.blockLimit,f.POSITION_AFTER_START);
b=new n(g);b.evaluator=t(true);return b.checkBackward()},checkEndOfBlock:function(){var b=this.endContainer,g=this.endOffset;if(b[0].nodeType==j.NODE_TEXT)if(p.trim(b[0].nodeValue.substring(g)).length)return false;this.trim();b=new a(this.endContainer);g=this.clone();g.collapse(false);g.setEndAt(b.block||b.blockLimit,f.POSITION_BEFORE_END);b=new n(g);b.evaluator=t(false);return b.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var b=
this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,b);return b},checkBoundaryOfElement:function(b,g){var h=this.clone();h[g==f.START?"setStartAt":"setEndAt"](b,g==f.START?f.POSITION_AFTER_START:f.POSITION_BEFORE_END);h=new n(h);h.evaluator=H;return h[g==f.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var b=this.startContainer,g=this.endContainer,h=this.startOffset,m=this.endOffset,r;if(b[0].nodeType==j.NODE_ELEMENT){r=b[0].childNodes.length;if(r>
h)b=new e(b[0].childNodes[h]);else if(r<1)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=new e(b);b=b._4e_nextSourceNode()||b}}if(g[0].nodeType==j.NODE_ELEMENT){r=g[0].childNodes.length;if(r>m)g=(new e(g[0].childNodes[m]))._4e_previousSourceNode(true);else if(r<1)g=g._4e_previousSourceNode();else{for(g=g[0];g.lastChild;)g=g.lastChild;g=new e(g)}}if(b._4e_position(g)&o.POSITION_FOLLOWING)b=g;return{startNode:b,endNode:g}},fixBlock:function(b,g){var h=this.createBookmark(),
m=new e(this.document.createElement(g));this.collapse(b);this.enlarge(f.ENLARGE_BLOCK_CONTENTS);m[0].appendChild(this.extractContents());m._4e_trim();k.ie||m._4e_appendBogus();this.insertNode(m);this.moveToBookmark(h);return m},splitBlock:function(b){var g=new a(this.startContainer),h=new a(this.endContainer),m=g.block,r=h.block,x=null;if(!g.blockLimit._4e_equals(h.blockLimit))return null;if(b!="br"){if(!m){m=this.fixBlock(true,b);r=(new a(this.endContainer)).block}r||(r=this.fixBlock(false,b))}b=
m&&this.checkStartOfBlock();g=r&&this.checkEndOfBlock();this.deleteContents();if(m&&A._4e_equals(m,r))if(g){x=new a(this.startContainer);this.moveToPosition(r,f.POSITION_AFTER_END);r=null}else if(b){x=new a(this.startContainer);this.moveToPosition(m,f.POSITION_BEFORE_START);m=null}else{r=this.splitElement(m);!k.ie&&!p.inArray(m._4e_name(),["ul","ol"])&&m._4e_appendBogus()}return{previousBlock:m,nextBlock:r,wasStartOfBlock:b,wasEndOfBlock:g,elementPath:x}},splitElement:function(b){if(!this.collapsed)return null;
this.setEndAt(b,f.POSITION_BEFORE_END);var g=this.extractContents(),h=b._4e_clone(false);h[0].appendChild(g);h.insertAfter(b);this.moveToPosition(b,f.POSITION_AFTER_END);return h},moveToElementEditablePosition:function(b,g){var h,m=y.XHTML_DTD;if(m.$empty[b._4e_name()])return false;for(;b&&b[0].nodeType==j.NODE_ELEMENT;){if(h=b._4e_isEditable())this.moveToPosition(b,g?f.POSITION_BEFORE_END:f.POSITION_AFTER_START);else if(m.$inline[b._4e_name()]){this.moveToPosition(b,g?f.POSITION_AFTER_END:f.POSITION_BEFORE_START);
return true}if((b=m.$empty[b._4e_name()]?b[g?"_4e_previous":"_4e_next"](z):b[g?"_4e_last":"_4e_first"](z))&&b[0].nodeType==j.NODE_TEXT){this.moveToPosition(b,g?f.POSITION_AFTER_END:f.POSITION_BEFORE_START);return true}}return h},selectNodeContents:function(b){this.setStart(b,0);this.setEnd(b,b[0].nodeType==j.NODE_TEXT?b[0].nodeValue.length:b[0].childNodes.length)}});var c={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},q=new n.whitespaces,l=new n.bookmark;y.Range=C});
KISSY.Editor.add("domiterator",function(y){function C(A){if(!(arguments.length<1)){this.range=A;this.forceBrBreak=false;this.enlargeBr=true;this.enforceRealBlocks=false;this._||(this._={})}}var H=KISSY,z=H.UA,t=y.Walker,s=y.Range,i=y.RANGE,p=y.NODE,j=y.ElementPath,f=H.Node,o=H.DOM,n=/^[\r\n\t ]*$/;t.bookmark();H.augment(C,{getNextParagraph:function(A){var u,k,v,a,e;if(!this._.lastNode){k=this.range.clone();k.shrink(i.SHRINK_ELEMENT,true);k.enlarge(this.forceBrBreak||!this.enlargeBr?i.ENLARGE_LIST_ITEM_CONTENTS:
i.ENLARGE_BLOCK_CONTENTS);var d=new t(k),c=t.bookmark(true,true);d.evaluator=c;this._.nextNode=d.next();d=new t(k);d.evaluator=c;d=d.previous();this._.lastNode=d._4e_nextSourceNode(true);if(this._.lastNode&&this._.lastNode[0].nodeType==p.NODE_TEXT&&!H.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){c=new s(k.document);c.moveToPosition(this._.lastNode,i.POSITION_AFTER_END);if(c.checkEndOfBlock()){c=new j(c.endContainer);this._.lastNode=(c.block||c.blockLimit)._4e_nextSourceNode(true)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new f(k.document.createTextNode(""));o.insertAfter(this._.lastNode[0],d[0])}k=null}c=this._.nextNode;d=this._.lastNode;for(this._.nextNode=null;c;){var q=false,l=c[0].nodeType!=p.NODE_ELEMENT,b=false;if(l){if(c[0].nodeType==p.NODE_TEXT)if(n.test(c[0].nodeValue))l=false}else{var g=c._4e_name();if(c._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(g=="br")l=true;else if(!k&&!c[0].childNodes.length&&g!="hr"){u=c;v=c._4e_equals(d);break}if(k){k.setEndAt(c,i.POSITION_BEFORE_START);
if(g!="br")this._.nextNode=c}q=true}else{if(c[0].firstChild){if(!k){k=new s(this.range.document);k.setStartAt(c,i.POSITION_BEFORE_START)}c=new f(c[0].firstChild);continue}l=true}}if(l&&!k){k=new s(this.range.document);k.setStartAt(c,i.POSITION_BEFORE_START)}v=(!q||l)&&c._4e_equals(d);if(k&&!q)for(;!c[0].nextSibling&&!v;){g=c.parent();if(g._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){q=true;v||g._4e_equals(d);break}c=g;l=true;v=c._4e_equals(d);b=true}l&&k.setEndAt(c,i.POSITION_AFTER_END);c=c._4e_nextSourceNode(b,
null,d);if((v=!c)||q&&k)break}if(!u){if(!k){this._.docEndMarker&&this._.docEndMarker._4e_remove();return this._.nextNode=null}u=new j(k.startContainer);c=u.blockLimit;q={div:1,th:1,td:1};u=u.block;if((!u||!u[0])&&!this.enforceRealBlocks&&q[c._4e_name()]&&k.checkStartOfBlock()&&k.checkEndOfBlock())u=c;else if(!u||this.enforceRealBlocks&&u._4e_name()=="li"){u=new f(this.range.document.createElement(A||"p"));u[0].appendChild(k.extractContents());u._4e_trim();k.insertNode(u);a=e=true}else if(u._4e_name()!=
"li"){if(!k.checkStartOfBlock()||!k.checkEndOfBlock()){u=u._4e_clone(false);u[0].appendChild(k.extractContents());u._4e_trim();e=k.splitBlock();a=!e.wasStartOfBlock;e=!e.wasEndOfBlock;k.insertNode(u)}}else if(!v)this._.nextNode=u._4e_equals(d)?null:k.getBoundaryNodes().endNode._4e_nextSourceNode(true,null,d)}if(a){k=new f(u[0].previousSibling);if(k[0]&&k[0].nodeType==p.NODE_ELEMENT)if(k._4e_name()=="br")k._4e_remove();else k[0].lastChild&&o._4e_name(k[0].lastChild)=="br"&&o._4e_remove(k[0].lastChild)}if(e){k=
t.bookmark(false,true);a=new f(u[0].lastChild);if(a[0]&&a[0].nodeType==p.NODE_ELEMENT&&a._4e_name()=="br")if(z.ie||a._4e_previous(k)||a._4e_next(k))a._4e_remove()}if(!this._.nextNode)this._.nextNode=v||u._4e_equals(d)?null:u._4e_nextSourceNode(true,null,d);return u}});s.prototype.createIterator=function(){return new C(this)}});
KISSY.Editor.add("selection",function(y){function C(d){this.document=d;this._={cache:{}};if(s.ie){var c=this.getNative().createRange();if(!c||c.item&&c.item(0).ownerDocument!=d||c.parentElement&&c.parentElement().ownerDocument!=d)this.isInvalid=true}}function H(d){d=new C(d);return!d||d.isInvalid?null:d}function z(d){var c=d.document,q=new j(c.body),l=new j(c.documentElement);if(s.ie){if(s.ie<8||document.documentMode==7)l.on("click",function(I){i._4e_name(I.target)==="html"&&d.getSelection().getRanges()[0].select()});
var b,g,h=1;l.on("mousedown",function(){h=0});l.on("mouseup",function(){h=1});q.on("focusin",function(I){if(i._4e_name(I.target)=="body")if(b){try{h&&b.select()}catch(M){}b=null}});q.on("focus",function(){g=true;r()});q.on("beforedeactivate",function(I){if(!I.relatedTarget){g=false;h=1}});p.on(i._4e_getWin(c),"blur",function(){c&&c.selection.empty()});q.on("mousedown",function(){m()});q.on("mouseup",function(){g=true;setTimeout(function(){r(true)},0)});q.on("keydown",m);q.on("keyup",function(){g=
true;r()});p.on(c,"selectionchange",r);var m=function(){g=false},r=function(I){if(g){var M=d.document,O=d.getSelection(),P=O&&O.getType(),w=O&&O.getNative();if(I&&w&&P==f.SELECTION_NONE)if(!M.queryCommandEnabled("InsertImage")){setTimeout(function(){r(true)},50);return}var G;if(!(w&&P==f.SELECTION_TEXT&&(G=i._4e_name(w.createRange().parentElement()))&&G in{input:1,textarea:1})){b=w&&O.getRanges()[0];d._monitor()}}}}else{p.on(c,"mouseup",d._monitor,d);p.on(c,"keyup",d._monitor,d)}var x={table:1,pre:1},
F=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,L=y.Walker.whitespaces(true);d.on("selectionChange",function(I){var M=I.path;I=(I=I.selection)&&I.getRanges()[0];var O=M.blockLimit;if(I)if(I.collapse&&!M.block&&O._4e_name()=="body"){M=I.fixBlock(true,"p");if(M._4e_outerHtml().match(F))if((O=M._4e_next(L))&&O[0].nodeType==n.NODE_ELEMENT&&!x[O._4e_name()]){I.moveToElementEditablePosition(O);M._4e_remove()}else if((O=M._4e_previous(L))&&
O[0].nodeType==n.NODE_ELEMENT&&!x[O._4e_name()]){I.moveToElementEditablePosition(O,O._4e_outerHtml().match(F)?false:true);M._4e_remove()}I.select();s.ie||d.notifySelectionChange()}})}y.SELECTION={};var t=KISSY,s=t.UA,i=t.DOM,p=t.Event,j=t.Node,f=y.SELECTION,o=y.RANGE,n=y.NODE,A=y.Walker,u=y.Range;f.SELECTION_NONE=1;f.SELECTION_TEXT=2;f.SELECTION_ELEMENT=3;var k={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};
t.augment(C,{getNative:s.ie?function(){var d=this._.cache;return d.nativeSel||(d.nativeSel=this.document.selection)}:function(){var d=this._.cache;return d.nativeSel||(d.nativeSel=i._4e_getWin(this.document).getSelection())},getType:s.ie?function(){var d=this._.cache;if(d.type)return d.type;var c=f.SELECTION_NONE;try{var q=this.getNative(),l=q.type;if(l=="Text")c=f.SELECTION_TEXT;if(l=="Control")c=f.SELECTION_ELEMENT;if(q.createRange().parentElement)c=f.SELECTION_TEXT}catch(b){}return d.type=c}:function(){var d=
this._.cache;if(d.type)return d.type;var c=f.SELECTION_TEXT,q=this.getNative();if(q){if(q.rangeCount==1){q=q.getRangeAt(0);var l=q.startContainer;if(l==q.endContainer&&l.nodeType==n.NODE_ELEMENT&&q.endOffset-q.startOffset===1&&k[l.childNodes[q.startOffset].nodeName.toLowerCase()])c=f.SELECTION_ELEMENT}}else c=f.SELECTION_NONE;return d.type=c},getRanges:s.ie?function(){var d=function(c,q){c=c.duplicate();c.collapse(q);for(var l=c.parentElement(),b=l.childNodes,g,h=0;h<b.length;h++){var m=b[h];if(m.nodeType==
n.NODE_ELEMENT){g=c.duplicate();g.moveToElementText(m);m=g.compareEndPoints("StartToStart",c);var r=g.compareEndPoints("EndToStart",c);g.collapse();if(m>0)break;else if(!m||r==1&&m==-1)return{container:l,offset:h};else if(!r)return{container:l,offset:h+1};g=null}}if(!g){g=c.duplicate();g.moveToElementText(l);g.collapse(false)}g.setEndPoint("StartToStart",c);g=g.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;g>0;)g-=b[--h].nodeValue.length}catch(x){g=0}return g===0?{container:l,offset:h}:{container:b[h],
offset:-g}};return function(){var c=this._.cache;if(c.ranges)return c.ranges;var q=this.getNative(),l=q&&q.createRange(),b=this.getType();if(!q)return[];if(b==f.SELECTION_TEXT){q=new u(this.document);b=d(l,true);q.setStart(new j(b.container),b.offset);b=d(l);q.setEnd(new j(b.container),b.offset);return c.ranges=[q]}else if(b==f.SELECTION_ELEMENT){c=c.ranges=[];for(b=0;b<l.length;b++){var g=l.item(b),h=g.parentNode,m=0;for(q=new u(this.document);m<h.childNodes.length&&h.childNodes[m]!=g;m++);q.setStart(new j(h),
m);q.setEnd(new j(h),m+1);c.push(q)}return c}return c.ranges=[]}}():function(){var d=this._.cache;if(d.ranges)return d.ranges;var c=[],q=this.getNative();if(!q)return[];for(var l=0;l<q.rangeCount;l++){var b=q.getRangeAt(l),g=new u(this.document);g.setStart(new j(b.startContainer),b.startOffset);g.setEnd(new j(b.endContainer),b.endOffset);c.push(g)}return d.ranges=c},getStartElement:function(){var d=this._.cache;if(d.startElement!==undefined)return d.startElement;var c,q=this.getNative();switch(this.getType()){case f.SELECTION_ELEMENT:return this.getSelectedElement();
case f.SELECTION_TEXT:var l=this.getRanges()[0];if(l)if(!l.collapsed){for(l.optimize();;){c=l.startContainer;if(l.startOffset==(c[0].nodeType===n.NODE_ELEMENT?c[0].childNodes.length:c[0].nodeValue.length)&&!c._4e_isBlockBoundary())l.setStartAfter(c);else break}c=l.startContainer;if(c[0].nodeType!=n.NODE_ELEMENT)return c.parent();c=new j(c[0].childNodes[l.startOffset]);if(!c[0]||c[0].nodeType!=n.NODE_ELEMENT)return l.startContainer;for(l=c[0].firstChild;l&&l.nodeType==n.NODE_ELEMENT;){c=new j(l);l=
l.firstChild}return c}if(s.ie){l=q.createRange();l.collapse(true);c=l.parentElement()}else if((c=q.anchorNode)&&c.nodeType!=n.NODE_ELEMENT)c=c.parentNode}return d.startElement=c?i._4e_wrap(c):null},getSelectedElement:function(){var d=this,c,q=d._.cache;if(q.selectedElement!==undefined)return q.selectedElement;if(s.ie){c=d.getNative().createRange();c=c.item&&c.item(0)}c||(c=function(){for(var l=d.getRanges()[0],b,g,h=2;h&&!((b=l.getEnclosedNode())&&b[0].nodeType==n.NODE_ELEMENT&&k[b._4e_name()]&&(g=
b));h--)l.shrink(o.SHRINK_ELEMENT);return g&&g[0]}());return q.selectedElement=i._4e_wrap(c)},reset:function(){this._.cache={}},selectElement:function(d){var c;if(s.ie)try{c=this.document.body.createControlRange();c.addElement(d[0]);c.select()}catch(q){c=this.document.body.createTextRange();c.moveToElementText(d[0]);c.select()}finally{}else{c=this.document.createRange();c.selectNode(d[0]);d=this.getNative();d.removeAllRanges();d.addRange(c)}this.reset()},selectRanges:function(d){if(s.ie)d[0]&&d[0].select();
else{var c=this.getNative();if(!c)return;c.removeAllRanges();for(var q=0;q<d.length;q++){var l=d[q],b=this.document.createRange(),g=l.startContainer;l.collapsed&&s.gecko&&s.gecko<1.09&&g[0].nodeType==n.NODE_ELEMENT&&!g[0].childNodes.length&&g[0].appendChild(this.document.createTextNode(""));b.setStart(g[0],l.startOffset);b.setEnd(l.endContainer[0],l.endOffset);c.addRange(b)}}this.reset()},createBookmarks2:function(d){for(var c=[],q=this.getRanges(),l=0;l<q.length;l++)c.push(q[l].createBookmark2(d));
return c},createBookmarks:function(d){for(var c=[],q=this.getRanges(),l=q.length,b=this.document,g,h=0;h<l;h++){c.push(g=q[h].createBookmark(d,true));var m=(d=g.serializable)?t.one("#"+g.startNode,b):g.startNode;g=d?t.one("#"+g.endNode,b):g.endNode;for(var r=h+1;r<l;r++){var x=q[r],F=x.startContainer,L=x.endContainer;i._4e_equals(F,m.parent())&&x.startOffset++;i._4e_equals(F,g.parent())&&x.startOffset++;i._4e_equals(L,m.parent())&&x.endOffset++;i._4e_equals(L,g.parent())&&x.endOffset++}}return c},
selectBookmarks:function(d){for(var c=[],q=0;q<d.length;q++){var l=new u(this.document);l.moveToBookmark(d[q]);c.push(l)}this.selectRanges(c);return this},getCommonAncestor:function(){var d=this.getRanges();return d[0].startContainer._4e_commonAncestor(d[d.length-1].endContainer)},scrollIntoView:function(){var d=this.getStartElement();d&&d._4e_scrollIntoView()},removeAllRanges:function(){var d=this.getNative();s.ie?d.clear():d.removeAllRanges()}});y.Selection=C;var v={table:1,tbody:1,tr:1},a=A.whitespaces(true),
e=/\ufeff|\u00a0/;u.prototype.select=s.ie?function(d){var c=this.collapsed,q,l;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var b=this.startContainer[0].childNodes[this.startOffset];if(b.nodeType==n.NODE_ELEMENT){(new C(this.document)).selectElement(new j(b));return}}if(this.startContainer[0].nodeType==n.NODE_ELEMENT&&this.startContainer._4e_name()in v||this.endContainer[0].nodeType==n.NODE_ELEMENT&&this.endContainer._4e_name()in v)this.shrink(o.SHRINK_ELEMENT,
true);var g=this.createBookmark();b=g.startNode;var h;if(!c)h=g.endNode;g=this.document.body.createTextRange();g.moveToElementText(b[0]);g.moveStart("character",1);if(h){d=this.document.body.createTextRange();d.moveToElementText(h[0]);g.setEndPoint("EndToEnd",d);g.moveEnd("character",-1)}else{for(q=b[0].nextSibling;q&&!a(q);)q=q.nextSibling;q=!(q&&q.nodeValue&&q.nodeValue.match(e))&&(d||!b[0].previousSibling||b[0].previousSibling&&i._4e_name(b[0].previousSibling)=="br");l=this.document.createElement("span");
l.innerHTML="&#65279;";l=new j(l);i.insertBefore(l[0],b[0]);q&&i.insertBefore(this.document.createTextNode("\ufeff"),b[0])}this.setStartBefore(b);b._4e_remove();if(c){if(q){g.moveStart("character",-1);g.select();this.document.selection.clear()}else g.select();if(l){this.moveToPosition(l,o.POSITION_BEFORE_START);l._4e_remove()}}else{this.setEndBefore(h);h._4e_remove();g.select()}}:function(){var d=this.startContainer;this.collapsed&&d[0].nodeType==n.NODE_ELEMENT&&!d[0].childNodes.length&&d[0].appendChild(this.document.createTextNode(""));
var c=this.document.createRange();c.setStart(d[0],this.startOffset);try{c.setEnd(this.endContainer[0],this.endOffset)}catch(q){if(q.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(true);c.setEnd(this.endContainer[0],this.endOffset)}else throw q;}d=H(this.document).getNative();d.removeAllRanges();d.addRange(c)};C.getSelection=H;y.on("instanceCreated",function(d){z(d.editor)})});
KISSY.Editor.add("styles",function(y){function C(w,G){for(var B in w)w[B]=w[B].replace(P,function(D,E){return G[E]})}function H(w,G){if(G){w=c.clone(w);C(w.attributes,G);C(w.styles,G)}var B=this.element=(w.element||"*").toLowerCase();this.type=B=="#"||I[B]?l.STYLE_BLOCK:M[B]?l.STYLE_OBJECT:l.STYLE_INLINE;this._={definition:w}}function z(w,G){var B=G?this.removeFromRange:this.applyToRange;w.body.focus();for(var D=new g(w),E=D.getRanges(),K=0;K<E.length;K++)B.call(this,E[K]);D.selectRanges(E)}function t(w,
G){var B;B=w.element;if(B=="*")B="span";B=new x(G.createElement(B));return s(B,w)}function s(w,G){var B=G._.definition,D=B.attributes;B=H.getStyleText(B);if(D)for(var E in D)w.attr(E,D[E]);if(B)w[0].style.cssText=B;return w}function i(w){var G=w.createBookmark(true),B=w.createIterator();B.enforceRealBlocks=true;B.enlargeBr=true;for(var D,E=w.document;D=B.getNextParagraph();){var K=t(this,E);D=D;var J=K;K=J._4e_name=="pre";var N=D._4e_name=="pre",T=!K&&N;if(K&&!N){N=D;J=J;T=N.html();T=p(T,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,
"");T=T.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");T=T.replace(/([ \t\n\r]+|&nbsp;)/g," ");T=T.replace(/<br\b[^>]*>/gi,"\n");if(F.ie){N=N[0].ownerDocument.createElement("div");N.appendChild(J[0]);J[0].outerHTML="<pre>"+T+"</pre>";J=new x(N.firstChild);J._4e_remove()}else J.html(T);J=J}else if(T)J=f(j(D),J);else D._4e_moveChildren(J);D[0].parentNode.replaceChild(J[0],D[0]);if(K){D=J;K=void 0;if((K=D._4e_previousSourceNode(true,h.NODE_ELEMENT))&&K._4e_name()=="pre"){J=p(K.html(),/\n$/,"")+"\n\n"+
p(D.html(),/^\n/,"");if(F.ie)D[0].outerHTML="<pre>"+J+"</pre>";else D.html(J);K._4e_remove()}}}w.moveToBookmark(G)}function p(w,G,B){var D="",E="";w=w.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(K,J,N){J&&(D=J);N&&(E=N);return""});return D+w.replace(G,B)+E}function j(w){var G=[];p(w._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(B,D,E){return D+"</pre>"+E+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(B,
D){G.push(D)});return G}function f(w,G){for(var B=G[0].ownerDocument.createDocumentFragment(),D=0;D<w.length;D++){var E=w[D];E=E.replace(/(\r\n|\r)/g,"\n");E=p(E,/^[ \t]*\n/,"");E=p(E,/\n$/,"");E=p(E,/^[ \t]+|[ \t]+$/g,function(J,N){return J.length==1?"&nbsp;":N?" "+Array(J.length).join("&nbsp;"):Array(J.length).join("&nbsp;")+" "});E=E.replace(/\n/g,"<br>");E=E.replace(/[ \t]{2,}/g,function(J){return Array(J.length).join("&nbsp;")+" "});var K=G._4e_clone();K.html(E);B.appendChild(K[0])}return B}
function o(w){var G=w.document;if(w.collapsed){G=t(this,G);w.insertNode(G);w.moveToPosition(G,b.POSITION_BEFORE_END)}else{var B=this.element,D=this._.definition,E,K=y.XHTML_DTD[B]||(E=true,y.XHTML_DTD.span),J=w.createBookmark();w.enlarge(b.ENLARGE_ELEMENT);w.trim();var N=w.createBookmark(),T=N.startNode;N=N.endNode;for(var S=T,V;S&&S[0];){var Q=false;if(q._4e_equals(S,N)){S=null;Q=true}else{var R=S[0].nodeType,Y=R==h.NODE_ELEMENT?S._4e_name():null;if(Y&&S.attr("_ke_bookmark")){S=S._4e_nextSourceNode(true);
continue}if(!Y||K[Y]&&(S._4e_position(N)|m.POSITION_PRECEDING|m.POSITION_IDENTICAL|m.POSITION_IS_CONTAINED)==m.POSITION_PRECEDING+m.POSITION_IDENTICAL+m.POSITION_IS_CONTAINED&&(!D.childRule||D.childRule(S))){var U=S.parent();if(U&&U[0]&&((y.XHTML_DTD[U._4e_name()]||y.XHTML_DTD.span)[B]||E)&&(!D.parentRule||D.parentRule(U))){if(!V&&(!Y||!y.XHTML_DTD.$removeEmpty[Y]||(S._4e_position(N)|m.POSITION_PRECEDING|m.POSITION_IDENTICAL|m.POSITION_IS_CONTAINED)==m.POSITION_PRECEDING+m.POSITION_IDENTICAL+m.POSITION_IS_CONTAINED)){V=
new r(G);V.setStartBefore(S)}if(R==h.NODE_TEXT||R==h.NODE_ELEMENT&&!S[0].childNodes.length){R=S;for(var W;!R[0].nextSibling&&(W=R.parent(),K[W._4e_name()])&&(W._4e_position(T)|m.POSITION_FOLLOWING|m.POSITION_IDENTICAL|m.POSITION_IS_CONTAINED)==m.POSITION_FOLLOWING+m.POSITION_IDENTICAL+m.POSITION_IS_CONTAINED&&(!D.childRule||D.childRule(W));)R=W;V.setEndAfter(R);R[0].nextSibling||(Q=true)}}else Q=true}else Q=true;S=S._4e_nextSourceNode()}if(Q&&V&&!V.collapsed){Q=t(this,G);for(R=V.getCommonAncestor();Q&&
R&&Q[0]&&R[0];){if(R._4e_name()==B){for(var X in D.attributes)Q.attr(X)==R.attr(X)&&Q[0].removeAttribute(X);for(var aa in D.styles)Q._4e_style(aa)==R._4e_style(aa)&&Q._4e_style(aa,"");if(!Q._4e_hasAttributes()){Q=null;break}}R=R.parent()}if(Q){Q[0].appendChild(V.extractContents());R=Q;Y=k(this);U=R.all(this.element);for(var Z=U.length;--Z>=0;)v(this,new x(U[Z]));var $=void 0;for($ in Y)if($!=this.element){U=R.all($);for(Z=U.length-1;Z>=0;Z--){var ba=new x(U[Z]);e(ba,Y[$])}}V.insertNode(Q);Q._4e_mergeSiblings();
F.ie||Q[0].normalize()}V=null}}T._4e_remove();N._4e_remove();w.moveToBookmark(J);w.shrink(b.SHRINK_TEXT)}}function n(w){w.enlarge(b.ENLARGE_ELEMENT);var G=w.createBookmark(),B=G.startNode;if(w.collapsed){for(var D=new L(B.parent()),E,K=0,J;K<D.elements.length&&(J=D.elements[K]);K++){if(J==D.block||J==D.blockLimit)break;if(this.checkElementRemovable(J)){var N=w.checkBoundaryOfElement(J,b.END),T=!N&&w.checkBoundaryOfElement(J,b.START);if(T||N){E=J;E.match=T?"start":"end"}else{J._4e_mergeSiblings();
J._4e_name()==this.element?v(this,J):e(J,k(this)[J._4e_name()])}}}if(E&&E[0]){J=B;for(K=0;;K++){N=D.elements[K];if(q._4e_equals(N,E))break;else if(N.match)continue;else N=N._4e_clone();N[0].appendChild(J[0]);J=N}q[E.match=="start"?"insertBefore":"insertAfter"](J[0],E[0])}}else{var S=G.endNode,V=this;D=function(){for(var Q=new L(B.parent()),R=new L(S.parent()),Y=null,U=null,W=0;W<Q.elements.length;W++){var X=Q.elements[W];if(X==Q.block||X==Q.blockLimit)break;if(V.checkElementRemovable(X))Y=X}for(W=
0;W<R.elements.length;W++){X=R.elements[W];if(X==R.block||X==R.blockLimit)break;if(V.checkElementRemovable(X))U=X}U&&S._4e_breakParent(U);Y&&B._4e_breakParent(Y)};D();for(E=new x(B[0].nextSibling);E[0]!==S[0];){K=E._4e_nextSourceNode();if(E[0]&&E[0].nodeType==h.NODE_ELEMENT&&this.checkElementRemovable(E)){E._4e_name()==this.element?v(this,E):e(E,k(this)[E._4e_name()]);if(K[0].nodeType==h.NODE_ELEMENT&&K._4e_contains(B)){D();K=new x(B[0].nextSibling)}}E=K}}w.moveToBookmark(G)}function A(w){var G={};
w.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(B,D,E){G[D]=E});return G}function u(w,G){var B;if(G!==false){B=document.createElement("span");B.style.cssText=w;B=B.style.cssText||""}else B=w;return B.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function k(w){if(w._.overrides)return w._.overrides;var G=w._.overrides={},B=w._.definition.overrides;if(B){c.isArray(B)||(B=[B]);for(var D=0;D<B.length;D++){var E=B[D],K,J;if(typeof E==
"string")K=E.toLowerCase();else{K=E.element?E.element.toLowerCase():w.element;J=E.attributes}E=G[K]||(G[K]={});if(J){E=E.attributes=E.attributes||[];for(var N in J)E.push([N.toLowerCase(),J[N]])}}}return G}function v(w,G){var B=w._.definition,D=c.mix(c.mix({},B.attributes),k(w)[G._4e_name()]);B=B.styles;var E=c.isEmptyObject(D)&&c.isEmptyObject(B),K;for(K in D)if(!((K=="class"||w._.definition.fullMatch)&&G.attr(K)!=a(K,D[K]))){E=E||!!G._4e_hasAttribute(K);G.removeAttr(K)}for(var J in B)if(!(w._.definition.fullMatch&&
G._4e_style(J)!=a(J,B[J],true))){E=E||!!G._4e_style(J);G._4e_style(J,"")}E&&d(G)}function a(w,G,B){var D=new x("<span></span>");D[B?"_4e_style":"attr"](w,G);return D[B?"_4e_style":"attr"](w)}function e(w,G){var B=G&&G.attributes;if(B)for(var D=0;D<B.length;D++){var E=B[D][0],K;if(K=w.attr(E)){var J=B[D][1];if(J===null||J.test&&J.test(K)||typeof J=="string"&&K==J)w[0].removeAttribute(E)}}d(w)}function d(w){if(!w._4e_hasAttributes()){var G=w[0].firstChild,B=w[0].lastChild;w._4e_remove(true);if(G){G.nodeType==
h.NODE_ELEMENT&&q._4e_mergeSiblings(G);B&&!G===B&&B.nodeType==h.NODE_ELEMENT&&q._4e_mergeSiblings(B)}}}var c=KISSY,q=c.DOM,l=y.STYLE={},b=y.RANGE,g=y.Selection,h=y.NODE,m=y.POSITION,r=y.Range,x=c.Node,F=c.UA,L=y.ElementPath,I={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},M={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},O=/\s*(?:;\s*|$)/,P=/#\((.+?)\)/g;l.STYLE_BLOCK=1;l.STYLE_INLINE=2;l.STYLE_OBJECT=3;H.prototype={apply:function(w){z.call(this,
w,false)},remove:function(w){z.call(this,w,true)},applyToRange:function(w){return(this.applyToRange=this.type==l.STYLE_INLINE?o:this.type==l.STYLE_BLOCK?i:this.type==l.STYLE_OBJECT?null:null).call(this,w)},removeFromRange:function(w){return(this.removeFromRange=this.type==l.STYLE_INLINE?n:null).call(this,w)},applyToObject:function(w){s(w,this)},checkElementRemovable:function(w,G){if(!w)return false;var B=this._.definition;if(w._4e_name()==this.element){if(!G&&!w._4e_hasAttributes())return true;var D=
B._AC;if(D)B=D;else{D={};var E=0,K=B.attributes;if(K)for(var J in K){E++;D[J]=K[J]}if(K=H.getStyleText(B)){D.style||E++;D.style=K}D._length=E;B=B._AC=D}if(B._length){for(var N in B)if(N!="_length"){E=w.attr(N)||"";if(N=="style")a:{D=B[N];E=u(E,false);typeof D=="string"&&(D=A(D));typeof E=="string"&&(E=A(E));K=void 0;for(K in D)if(!(K in E&&(E[K]==D[K]||D[K]=="inherit"||E[K]=="inherit"))){D=false;break a}D=true}else D=B[N]==E;if(D){if(!G)return true}else if(G)return false}if(G)return true}else return true}if(N=
k(this)[w._4e_name()]){if(!(B=N.attributes))return true;for(D=0;D<B.length;D++){N=B[D][0];if(N=w.attr(N)){E=B[D][1];if(E===null||typeof E=="string"&&N==E||E.test&&E.test(N))return true}}}return false},checkActive:function(w){switch(this.type){case l.STYLE_BLOCK:return this.checkElementRemovable(w.block||w.blockLimit,true);case l.STYLE_OBJECT:case l.STYLE_INLINE:for(var G=w.elements,B=0,D;B<G.length;B++){D=G[B];if(!(this.type==l.STYLE_INLINE&&(q._4e_equals(D,w.block)||q._4e_equals(D,w.blockLimit))))if(!(this.type==
l.STYLE_OBJECT&&!(D._4e_name()in M)))if(this.checkElementRemovable(D,true))return true}}return false}};H.getStyleText=function(w){var G=w._ST;if(G)return G;G=w.styles;var B=w.attributes&&w.attributes.style||"",D="";if(B.length)B=B.replace(O,";");for(var E in G){var K=G[E],J=(E+":"+K).replace(O,";");if(K=="inherit")D+=J;else B+=J}if(B.length)B=u(B);B+=D;return w._ST=B};y.Style=H});
KISSY.Editor.add("htmlparser",function(){function y(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var C=KISSY,H=C.Editor,z=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,t={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},s=H.XHTML_DTD;C.augment(y,{onTagOpen:function(){},onTagClose:function(){},
onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(i){for(var p,j,f=0,o;p=this._.htmlPartsRegex.exec(i);){j=p.index;if(j>f){f=i.substring(f,j);o?o.push(f):this.onText(f)}f=this._.htmlPartsRegex.lastIndex;if(j=p[1]){j=j.toLowerCase();if(o&&s.$cdata[j]){this.onCDATA(o.join(""));o=null}if(!o){this.onTagClose(j);continue}}if(o)o.push(p[0]);else if(j=p[3]){j=j.toLowerCase();if(!/="/.test(j)){var n={},A;p=p[4];var u=!!(p&&p.charAt(p.length-1)=="/");if(p)for(;A=z.exec(p);){var k=
A[1].toLowerCase();A=A[2]||A[3]||A[4]||"";n[k]=!A&&t[k]?k:A}this.onTagOpen(j,n,u);if(!o&&s.$cdata[j])o=[]}}else if(j=p[2])this.onComment(j)}i.length>f&&this.onText(i.substring(f,i.length))}});H.HtmlParser=y});
KISSY.Editor.add("htmlparser-basicwriter",function(){function y(){this._={output:[]}}var C=KISSY,H=C.Editor,z=H.Utils;C.augment(y,{openTag:function(t){this._.output.push("<",t)},openTagClose:function(t,s){s?this._.output.push(" />"):this._.output.push(">")},attribute:function(t,s){if(typeof s=="string")s=z.htmlEncodeAttr(s);this._.output.push(" ",t,'="',s,'"')},closeTag:function(t){this._.output.push("</",t,">")},text:function(t){this._.output.push(t)},comment:function(t){this._.output.push("<!--",
t,"--\>")},write:function(t){this._.output.push(t)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(t){var s=this._.output.join("");t&&this.reset();return s}});H.HtmlParser.BasicWriter=y});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function y(){y.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=false;this.sortAttributes=true;this._.indent=false;this._.indentation="";this._.rules={};var t=H.XHTML_DTD,s;for(s in z.mix({},t.$nonBodyContent,t.$block,t.$listItem,t.$tableContent))this.setRules(s,{indent:true,breakBeforeOpen:true,breakAfterOpen:true,breakBeforeClose:!t[s]["#"],breakAfterClose:true});
this.setRules("br",{breakAfterOpen:true});this.setRules("title",{indent:false,breakAfterOpen:false});this.setRules("style",{indent:false,breakBeforeClose:true});this.setRules("pre",{indent:false})}var C=KISSY,H=C.Editor,z=H.Utils;C.extend(y,H.HtmlParser.BasicWriter,{openTag:function(t){var s=this._.rules[t];if(this._.indent)this.indentation();else if(s&&s.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",t)},openTagClose:function(t,s){var i=this._.rules[t];if(s)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(i&&i.indent)this._.indentation+=this.indentationChars}i&&i.breakAfterOpen&&this.lineBreak()},attribute:function(t,s){if(typeof s=="string"){this.forceSimpleAmpersand&&(s=s.replace(/&amp;/g,"&"));s=z.htmlEncodeAttr(s)}this._.output.push(" ",t,'="',s,'"')},closeTag:function(t){var s=this._.rules[t];if(s&&s.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(s&&s.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",t,">");s&&s.breakAfterClose&&this.lineBreak()},text:function(t){if(this._.indent){this.indentation();t=z.ltrim(t)}this._.output.push(t)},comment:function(t){this._.indent&&this.indentation();this._.output.push("<!--",t,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=true},indentation:function(){this._.output.push(this._.indentation);this._.indent=false},setRules:function(t,s){var i=this._.rules[t];
if(i)z.mix(i,s);else this._.rules[t]=s}});H.HtmlParser.HtmlWriter=y});
KISSY.Editor.add("htmlparser-fragment",function(){function y(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false}}var C=KISSY.Editor,H={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},z=KISSY,t=C.Utils,s=C.NODE,i=C.XHTML_DTD,p=t.mix({table:1,ul:1,ol:1,dl:1},i.table,i.ul,i.ol,i.dl),j=i.$list,f=i.$listItem;y.FromHtml=function(o,n){function A(h){var m;if(e.length>0)for(var r=0;r<e.length;r++){var x=e[r],F=x.name,L=i[F],I=c.name&&i[c.name];if((!I||
I[F])&&(!h||!L||L[h]||!i[h])){if(!m){u();m=1}x=x.clone();x.parent=c;c=x;e.splice(r,1);r--}}}function u(){for(;d.length;)c.add(d.shift())}function k(h,m,r){m=m||c||a;if(n&&!m.type){var x,F;if((x=h.attributes&&(F=h.attributes._ke_real_element_type)?F:h.name)&&!(x in i.$body)&&!(x in i.$nonBodyContent)){x=c;c=m;v.onTagOpen(n,{});m=c;if(r)c=x}}if(h._.isBlockLike&&h.name!="pre"){r=h.children.length;if((x=h.children[r-1])&&x.type==s.NODE_TEXT)if(F=t.rtrim(x.value))x.value=F;else h.children.length=r-1}m.add(h);
if(h.returnPoint){c=h.returnPoint;delete h.returnPoint}}var v=new C.HtmlParser,a=new y,e=[],d=[],c=a,q=false,l;v.onTagOpen=function(h,m,r){var x=new C.HtmlParser.Element(h,m);if(x.isUnknown&&r)x.isEmpty=true;if(i.$removeEmpty[h])e.push(x);else{if(h=="pre")q=true;else if(h=="br"&&q){c.add(new C.HtmlParser.Text("\n"));return}if(h=="br")d.push(x);else{var F=c.name,L=F&&(i[F]||(c._.isBlockLike?i.div:i.span));if(L&&!x.isUnknown&&!c.isUnknown&&!L[h]){L=false;var I;if(h in j&&F in j){F=c.children;(F=F[F.length-
1])&&F.name in f||k(F=new C.HtmlParser.Element("li"),c);l=c;I=F}else if(h==F)k(c,c.parent);else{if(p[F])l||(l=c);else{k(c,c.parent,true);H[F]||e.unshift(c)}L=true}c=I?I:c.returnPoint||c.parent;if(L){v.onTagOpen.apply(this,arguments);return}}A(h);u();x.parent=c;x.returnPoint=l;l=0;if(x.isEmpty)k(x);else c=x}}};v.onTagClose=function(h){for(var m=e.length-1;m>=0;m--)if(h==e[m].name){e.splice(m,1);return}for(var r=[],x=[],F=c;F.type&&F.name!=h;){F._.isBlockLike||x.unshift(F);r.push(F);F=F.parent}if(F.type){for(m=
0;m<r.length;m++){var L=r[m];k(L,L.parent)}c=F;if(c.name=="pre")q=false;F._.isBlockLike&&u();k(F,F.parent);if(F==c)c=c.parent;e=e.concat(x)}if(h=="body")n=false};v.onText=function(h){if(!c._.hasInlineStarted&&!q){h=t.ltrim(h);if(h.length===0)return}u();A();if(n&&(!c.type||c.name=="body")&&t.trim(h))this.onTagOpen(n,{});q||(h=h.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));c.add(new C.HtmlParser.Text(h))};v.onCDATA=function(){};v.onComment=function(h){c.add(new C.HtmlParser.Comment(h))};v.parse(o);for(u();c.type;){var b=
c.parent,g=c;if(n&&(!b.type||b.name=="body")&&!i.$body[g.name]){c=b;v.onTagOpen(n,{});b=c}b.add(g);c=b}return a};z.augment(y,{add:function(o){var n=this.children.length;if(n=n>0&&this.children[n-1]||null){if(o._.isBlockLike&&n.type==s.NODE_TEXT){n.value=t.rtrim(n.value);if(n.value.length===0){this.children.pop();this.add(o);return}}n.next=o}o.previous=n;o.parent=this;this.children.push(o);this._.hasInlineStarted=o.type==s.NODE_TEXT||o.type==s.NODE_ELEMENT&&!o._.isBlockLike},writeHtml:function(o,n){var A;
this.filterChildren=function(){var u=new C.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,u,n,true);u=u.getHtml();this.children=(new y.FromHtml(u)).children;A=1};!this.name&&n&&n.onFragment(this);this.writeChildrenHtml(o,A?null:n)},writeChildrenHtml:function(o,n){for(var A=0;A<this.children.length;A++)this.children[A].writeHtml(o,n)}});C.HtmlParser.Fragment=y});
KISSY.Editor.add("htmlparser-element",function(){function y(t,s){this.name=t;this.attributes=s||(s={});this.children=[];var i=s._ke_real_element_type||t,p=C.XHTML_DTD;i=!!(p.$nonBodyContent[i]||p.$block[i]||p.$listItem[i]||p.$tableContent[i]||p.$nonEditable[i]||i=="br");var j=!!p.$empty[t];this.isEmpty=j;this.isUnknown=!p[t];this._={isBlockLike:i,hasInlineStarted:j||!i}}var C=KISSY.Editor,H=C.NODE,z=function(t,s){t=t[0];s=s[0];return t<s?-1:t>s?1:0};KISSY.augment(y,{type:H.NODE_ELEMENT,add:C.HtmlParser.Fragment.prototype.add,
clone:function(){return new y(this.name,this.attributes)},writeHtml:function(t,s){var i=this.attributes,p=this,j=p.name,f,o,n,A;p.filterChildren=function(){if(!A){var v=new C.HtmlParser.BasicWriter;C.HtmlParser.Fragment.prototype.writeChildrenHtml.call(p,v,s);p.children=(new C.HtmlParser.Fragment.FromHtml(v.getHtml())).children;A=1}};if(s){for(;;){if(!(j=s.onElementName(j)))return;p.name=j;if(!(p=s.onElement(p)))return;p.parent=this.parent;if(p.name==j)break;if(p.type!=H.NODE_ELEMENT){p.writeHtml(t,
s);return}j=p.name;if(!j){this.writeChildrenHtml.call(p,t,A?null:s);return}}i=p.attributes}t.openTag(j,i);for(var u=[],k=0;k<2;k++)for(f in i){o=f;n=i[f];if(k==1)u.push([f,n]);else if(s){for(;;)if(o=s.onAttributeName(f))if(o!=f){delete i[f];f=o}else break;else{delete i[f];break}if(o)if((n=s.onAttribute(p,o,n))===false)delete i[o];else i[o]=n}}t.sortAttributes&&u.sort(z);i=u.length;for(k=0;k<i;k++){f=u[k];t.attribute(f[0],f[1])}t.openTagClose(j,p.isEmpty);if(!p.isEmpty){this.writeChildrenHtml.call(p,
t,A?null:s);t.closeTag(j)}},writeChildrenHtml:function(){C.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});C.HtmlParser.Element=y});
KISSY.Editor.add("htmlparser-filter",function(){function y(f){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};f&&this.addRules(f,10)}function C(f,o){for(var n=0;f&&n<o.length;n++){var A=o[n];f=f.replace(A[0],A[1])}return f}function H(f,o,n){if(typeof o=="function")o=[o];var A,u;u=f.length;var k=o&&o.length;if(k){for(A=0;A<u&&f[A].pri<n;A++);for(u=k-1;u>=0;u--)if(k=o[u]){k.pri=n;f.splice(A,0,k)}}}function z(f,o,n){if(o)for(var A in o){var u=f[A];f[A]=t(u,o[A],
n);u||f.$length++}}function t(f,o,n){if(o){o.pri=n;if(f){if(f.splice)H(f,o,n);else{f=f.pri>n?[o,f]:[f,o];f.filter=s}return f}else return o.filter=o}}function s(f){for(var o=f.type||f instanceof p.HtmlParser.Fragment,n=0;n<this.length;n++){if(o)var A=f.type,u=f.name;var k=this[n].apply(window,arguments);if(k===false)return k;if(o){if(k&&(k.name!=u||k.type!=A))return k}else if(typeof k!="string")return k;k!=undefined&&(f=k)}return f}var i=KISSY,p=i.Editor,j=p.NODE;i.augment(y,{addRules:function(f,o){if(typeof o!=
"number")o=10;H(this._.elementNames,f.elementNames,o);H(this._.attributeNames,f.attributeNames,o);z(this._.elements,f.elements,o);z(this._.attributes,f.attributes,o);this._.text=t(this._.text,f.text,o)||this._.text;this._.comment=t(this._.comment,f.comment,o)||this._.comment;this._.root=t(this._.root,f.root,o)||this._.root},onElementName:function(f){return C(f,this._.elementNames)},onAttributeName:function(f){return C(f,this._.attributeNames)},onText:function(f){var o=this._.text;return o?o.filter(f):
f},onComment:function(f,o){var n=this._.comment;return n?n.filter(f,o):f},onFragment:function(f){var o=this._.root;return o?o.filter(f):f},onElement:function(f){for(var o=[this._.elements["^"],this._.elements[f.name],this._.elements.$],n,A=0;A<3;A++)if(n=o[A]){n=n.filter(f,this);if(n===false)return null;if(n&&n!=f)return this.onNode(n);if(f.parent&&!f.name)break}return f},onNode:function(f){var o=f.type;return o==j.NODE_ELEMENT?this.onElement(f):o==j.NODE_TEXT?new p.HtmlParser.Text(this.onText(f.value)):
null},onAttribute:function(f,o,n){if(o=this._.attributes[o]){f=o.filter(n,f,this);if(f===false)return false;if(typeof f!="undefined")return f}return n}});p.HtmlParser.Filter=y});KISSY.Editor.add("htmlparser-text",function(){function y(z){this.value=z;this._={isBlockLike:false}}var C=KISSY,H=C.Editor;C.augment(y,{type:H.NODE.NODE_TEXT,writeHtml:function(z,t){var s=this.value;t&&!(s=t.onText(s,this))||z.text(s)}});H.HtmlParser.Text=y});
KISSY.Editor.add("htmlparser-comment",function(){function y(z){this.value=z;this._={isBlockLike:false}}var C=KISSY.Editor,H=C.NODE;C.HtmlParser.Comment=y;y.prototype={constructor:y,type:H.NODE_COMMENT,writeHtml:function(z,t){var s=this.value;if(t){if(!(s=t.onComment(s,this)))return;if(typeof s!="string"){s.parent=this.parent;s.writeHtml(z,t);return}}z.comment(s)}}});
