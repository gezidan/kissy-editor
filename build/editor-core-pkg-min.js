KISSY.add("editor",function(x,C){function G(u,i){function v(e){for(var r=G.Env.mods,o=0;o<e.length;o++){for(var c=e[o],k=false,g=0;g<o;g++)if(c==e[g]){k=true;break}g=r[c];if(k&&g){k=x.clone(g);c=c+"_"+o;k.name=c;e[o]=c;r[c]||(r[c]=k)}}}var a=this;if(!(a instanceof G))return new G(u,i);if(x.isString(u))u=x.one(u);u=s._4e_wrap(u);i=i||{};i.pluginConfig=i.pluginConfig||{};a.cfg=i;x.app(a,x.EventTarget);var b=["htmldataprocessor","enterkey","clipboard"],d=false;a.use=function(e,r){e=e.split(",");v(e);
if(!d)for(var o=0;o<b.length;o++){var c=b[o];x.inArray(c,e)||e.unshift(c)}x.use.call(a,e.join(","),function(){a.ready(function(){r&&r.call(a);if(!d){a.setData(u.val());if(i.focus)a.focus();else{var k=a.getSelection();k&&k.removeAllRanges()}a.fire("save");d=true}})},{order:true,global:G});return a};a.init(u);return a}function z(u){if(!t)return u.replace(/\.(js|css)/i,"-min.$1");if(t==="dev")return"../src/"+u;return u}var s=x.DOM;x.app(G,x.EventTarget);G.Config.base=x.Config.base+"editor/";var t=x.Config.debug,
j=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu",
"fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},
{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],n,h,f,l,p={};n=0;for(h=j.length;n<h;n++){f=j[n];if(x.isString(f))f=j[n]={name:f};l=f.requires||[];var A=["button"];f.name.indexOf("/dialog")!=-1&&A.push("overlay");f.requires=l.concat(A)}j=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},{name:"dd"},{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},
{name:"select",requires:["overlay"]}].concat(j);n=0;for(h=j.length;n<h;n++){f=j[n];l=f.name;p[l]={attach:false,charset:"utf-8",requires:f.requires,csspath:f.useCss?z("plugins/"+l+"/plugin.css?t="+encodeURIComponent("2010-10-27 17:33:10")+""):C,path:z("plugins/"+l+"/plugin.js?t="+encodeURIComponent("2010-10-27 17:33:10")+"")}}G.add(p);x.Editor=G;x.log(["utils","focusmanager","definition","dtd","dom","elementpath","walker","range","domiterator","selection","styles","htmlparser","htmlparser-basicwriter","htmlparser-comment",
"htmlparser-element","htmlparser-filter","htmlparser-fragment","htmlparser-htmlwriter","htmlparser-text"])});
KISSY.Editor.add("utils",function(x){var C=KISSY,G=C.Node,z=C.DOM,s=C.UA,t=C.Event;x.Utils={debugUrl:function(j){var n=C.Config.debug;if(!n)return j.replace(/\.(js|css)/i,"-min.$1");if(n==="dev")return"../src/"+j;return j},lazyRun:function(j,n,h){var f=j[n],l=j[h];j[n]=function(){f.apply(this,arguments);j[n]=j[h];return l.apply(this,arguments)}},getXY:function(j,n,h,f){h=h.defaultView||h.parentWindow;j-=z.scrollLeft(h);n-=z.scrollTop(h);if(f)if(h!=(f.defaultView||f.parentWindow)&&h.frameElement){f=
z._4e_getOffset(h.frameElement,f);j+=f.left;n+=f.top}return{left:j,top:n}},tryThese:function(){for(var j,n=0,h=arguments.length;n<h;n++){var f=arguments[n];try{j=f();break}catch(l){}}return j},arrayCompare:function(j,n){if(!j&&!n)return true;if(!j||!n||j.length!=n.length)return false;for(var h=0;h<j.length;h++)if(j[h]!==n[h])return false;return true},getByAddress:function(j,n,h){j=j.documentElement;for(var f=0;j&&f<n.length;f++){var l=n[f];if(h)for(var p=-1,A=0;A<j.childNodes.length;A++){var u=j.childNodes[A];
if(!(h===true&&u.nodeType==3&&u.previousSibling&&u.previousSibling.nodeType==3)){p++;if(p==l){j=u;break}}}else j=j.childNodes[l]}return j?new G(j):null},clearAllMarkers:function(j){for(var n in j)j[n]._4e_clearMarkers(j,true)},htmlEncodeAttr:function(j){return j.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(j){return j.replace(/^\s+/,"")},rtrim:function(j){return j.replace(/\s+$/,"")},trim:function(j){return this.ltrim(this.rtrim(j))},mix:function(){for(var j={},
n=0;n<arguments.length;n++)j=C.mix(j,arguments[n]);return j},isCustomDomain:function(){if(!s.ie)return false;var j=document.domain,n=window.location.hostname;return j!=n&&j!="["+n+"]"},duplicateStr:function(j,n){return Array(n+1).join(j)},throttle:function(j,n,h){h=h||150;if(h===-1)return function(){j.apply(n,arguments)};var f=(new Date).getTime();return function(){var l=(new Date).getTime();if(l-f>h){f=l;j.apply(n,arguments)}}},buffer:function(j,n,h){h=h||0;var f=null;return function(){f&&clearTimeout(f);
var l=arguments;f=setTimeout(function(){return j.apply(n,l)},h)}},isNumber:function(j){return/^\d+(.\d+)?$/.test(C.trim(j))},verifyInputs:function(j){for(var n=0;n<j.length;n++){var h=z._4e_wrap(j[n]),f=C.trim(h.val()),l=h.attr("data-verify");h=h.attr("data-warning");if(l&&!RegExp(l).test(f)){alert(h);return}}return true},sourceDisable:function(j,n){j.on("sourcemode",n.disable,n);j.on("wysiwygmode",n.enable,n)},resetInput:function(j){var n=j.attr("placeholder");if(n&&!s.webkit){j.val(n);j.addClass("ke-input-tip")}else s.webkit&&
j.val("")},placeholder:function(j,n){j.attr("placeholder",n);if(!s.webkit){j.on("blur",function(){if(!C.trim(j.val())){j.val(n);j.addClass("ke-input-tip")}});j.on("focus",function(){C.trim(j.val())==n&&j.val("");j.removeClass("ke-input-tip")})}},clean:function(j){j=j[0]||j;for(var n=C.makeArray(j.childNodes),h=0;h<n.length;h++){var f=n[h];f.nodeType==x.NODE.NODE_TEXT&&!C.trim(f.nodeValue)&&j.removeChild(f)}},htmlEncode:function(j){return!j?j:String(j).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,
"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(j){return!j?j:String(j).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(j,n){return j.toLowerCase()==n.toLowerCase()},normParams:function(j){j=C.clone(j);for(var n in j)if(j.hasOwnProperty(n)){var h=j[n];if(C.isFunction(h))j[n]=h()}return j},doFormUpload:function(j,n,h){function f(){var a={responseText:"",responseXML:null};a.argument=j?j.argument:null;try{var b;if((b=s.ie?p.contentWindow.document:
p.contentDocument||window.frames[l].document)&&b.body)a.responseText=b.body.innerHTML;a.responseXML=b&&b.XMLDocument?b.XMLDocument:b}catch(d){}t.remove(p,"load",f);j.callback&&j.callback(a);setTimeout(function(){z._4e_remove(p)},100)}var l=C.guid("form-upload-"),p=document.createElement("iframe");p.id=l;p.name=l;p.className="ke-hidden";if(s.ie)p.src="javascript:false";document.body.appendChild(p);if(s.ie)document.frames[l].name=l;var A=z._4e_unwrap(j.form),u={target:A.target,method:A.method,encoding:A.encoding,
enctype:A.enctype,action:A.action};A.target=l;A.method="POST";A.enctype=A.encoding="multipart/form-data";if(h)A.action=h;var i;if(n){i=[];n=x.Utils.normParams(n);for(var v in n)if(n.hasOwnProperty(v)){h=document.createElement("input");h.type="hidden";h.name=v;h.value=n[v];A.appendChild(h);i.push(h)}}t.on(p,"load",f);A.submit();A.target=u.target;A.method=u.method;A.enctype=u.enctype;A.encoding=u.encoding;A.action=u.action;if(i){n=0;for(A=i.length;n<A;n++)z._4e_remove(i[n])}}}});
KISSY.Editor.add("focusmanager",function(x){function C(){this.iframeFocus=true;n=this}function G(){this.iframeFocus=false;n=null}var z=KISSY,s=z.DOM,t=z.Event;z={};var j={},n;z={refreshAll:function(){for(var h in j){var f=j[h];f.document.designMode="off";f.document.designMode="on"}},currentInstance:function(){return n},getInstance:function(h){return j[h]},add:function(h){var f=s._4e_getWin(h.document);t.on(f,"focus",C,h);t.on(f,"blur",G,h)},register:function(h){j[h._UUID]=h},remove:function(h){delete j[h._UUID];
var f=s._4e_getWin(h.document);t.remove(f,"focus",C,h);t.remove(f,"blur",G,h)}};x.focusManager=z;x.getInstances=function(){return j}});
KISSY.Editor.add("definition",function(x){function C(i,v){return f+"<html><head><title>${title}</title><link href='"+x.Config.base+l+"' rel='stylesheet'/><style>"+(v||"")+"</style></head><body class='ke-editor'>&nbsp;"+(i?'<script id="ke_actscript" type="text/javascript">'+(x.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+i+'");<\/script>':"")+"</body></html>"}var G=KISSY,z=G.UA,s=G.DOM,t=G.Node,j=G.Event,n=x.focusManager,h=x.Utils.tryThese,
f="<!doctype html>",l=x.Utils.debugUrl("theme/editor-iframe.css"),p=1,A="document.open();"+(x.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();",u="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(z.ie?"javascript:void(function(){"+encodeURIComponent(A)+
"}())":"")+'"  tabIndex="'+(z.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";x.SOURCE_MODE=0;x.WYSIWYG_MODE=1;G.augment(x,{init:function(i){if(z.ie)s.addClass(document.body,"ie"+z.ie);else if(z.gecko)s.addClass(document.body,"gecko");else z.webkit&&s.addClass(document.body,"webkit");var v=this,a=new t(u.replace(/\$\(tabIndex\)/,i.attr("tabIndex")));a.on("mousedown",function(e){if(z.webkit){var r=s._4e_name(e.target);
if(r=="select"||r=="option")return true}e.halt()});i.on("mousedown",function(e){e.stopPropagation()});v.editorWrap=a;v._UUID=p++;n.register(v);v.wrap=a.one(".ke-textarea-wrap");v.iframe=v.wrap.one("iframe");v.toolBarDiv=a.one(".ke-editor-tools");v.textarea=i;v.statusDiv=a.one(".ke-editor-status");v.toolBarDiv._4e_unselectable();v._commands={};v._dialogs={};var b=i._4e_style("width"),d=i._4e_style("height");if(b){a.css("width",b);i.css("width","100%")}v.textarea.css("display","none");a.insertAfter(i);
v.wrap[0].appendChild(i[0]);if(d){v.wrap.css("height",d);i.css("height","100%")}a=v.iframe;v.on("dataReady",function(){v._ready=true;x.fire("instanceCreated",{editor:v})});z.gecko?a.on("load",v._setUpIFrame,v):v._setUpIFrame();v.cfg.attachForm&&i[0].form&&v._attachForm()},_attachForm:function(){(new t(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(i,v){var a=this,b=x.SimpleOverlay;b.loading();a.use(i,function(){var d=a.getDialog(i);v(d);b.unloading()})},addDialog:function(i,
v){this._dialogs[i]=v},getDialog:function(i){return this._dialogs[i]},addPlugin:function(i){this.ready(i)},addCommand:function(i,v){this._commands[i]=v},hasCommand:function(i){return this._commands[i]},execCommand:function(i){var v=this._commands[i],a=G.makeArray(arguments);a.shift();a.unshift(this);return v.exec.apply(v,a)},getMode:function(){return this.textarea.css("display")=="none"?x.WYSIWYG_MODE:x.SOURCE_MODE},getData:function(i){var v;if(this.getMode()==x.WYSIWYG_MODE){v=this.document.body.innerHTML;
if(this.htmlDataProcessor)v=this.htmlDataProcessor.toHtml(v,"p")}else v=this.textarea.val();if(!i){v=v||"";v=v.replace(/\s+/g," ")}return v},setData:function(i){var v;if(this.htmlDataProcessor)v=this.htmlDataProcessor.toDataFormat(i,"p");this.document.body.innerHTML=v;this.getMode()!=x.WYSIWYG_MODE&&this.textarea.val(i)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(i){i=i||0;return i+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},_setRawData:function(i){this.document.body.innerHTML=
i},_prepareIFrameHtml:C,getSelection:function(){var i=new x.Selection(this.document);return!i||i.isInvalid?null:i},focus:function(){var i=this.document,v=s._4e_getWin(i);z.webkit&&v&&v.parent&&v.parent.focus();v&&v.focus();i&&i.body.focus();this.notifySelectionChange()},blur:function(){s._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(i){var v=this.cfg,a=this.document;v.customStyle=v.customStyle||"";v.customStyle+="\n"+i;v=a.createElement("style");
a.getElementsByTagName("head")[0].appendChild(v);if(v.styleSheet)v.styleSheet.cssText=i;else v.appendChild(a.createTextNode(i))},_setUpIFrame:function(){function i(){e=d.document;v.document=e;a.detach();e.open("text/html","replace");e.write(b);e.close()}var v=this,a=v.iframe,b=C(v._UUID,v.cfg.customStyle),d=a[0].contentWindow,e;try{e=d.document}catch(r){a[0].src=a[0].src;if(z.ie<7){setTimeout(i,10);return}}i()},ready:function(i){this._ready?i():this.on("dataReady",i)},_monitor:function(){var i=this;
i._monitorId&&clearTimeout(i._monitorId);i._monitorId=setTimeout(function(){var v=i.getSelection();if(v&&!v.isInvalid){var a=v.getStartElement(),b=new x.ElementPath(a);if(!i.previousPath||!i.previousPath.compare(b)){i.previousPath=b;i.fire("selectionChange",{selection:v,path:b,element:a})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(i,v){var a=this;a.focus();var b=i._4e_name(),d=x.XHTML_DTD,e=x.RANGE,r=x.NODE,o=d.$block[b],c=a.getSelection(),
k=c.getRanges(),g,m,q,y,F;a.fire("save");for(var J=k.length-1;J>=0;J--){g=k[J];g.deleteContents();m=!J&&i||i._4e_clone(true);v&&v(m);if(o)for(;(y=g.getCommonAncestor(false,true))&&(F=d[y._4e_name()])&&!(F&&F[b]);)if(y._4e_name()in d.span)g.splitElement(y);else if(g.checkStartOfBlock()&&g.checkEndOfBlock()){g.setStartBefore(y);g.collapse(true);y._4e_remove()}else g.splitBlock();g.insertNode(m);q||(q=m)}b=q._4e_nextSourceNode(true);d=a.document;F=x.XHTML_DTD;if(F.$inline[m._4e_name()]){b=new t(d.createTextNode(" "));
b.insertAfter(q)}else if(b){if(b._4e_name()=="br"&&F[b.parent()._4e_name()].p){F=new t("<p>&nbsp;</p>",null,d);b[0].parentNode.replaceChild(F[0],b[0]);b=F}}else{F=new t("<p>&nbsp;</p>",null,d);F.insertAfter(q);b=F}g.moveToPosition(q,e.POSITION_AFTER_END);b&&b[0].nodeType==r.NODE_ELEMENT&&g.moveToElementEditablePosition(b);c.selectRanges([g]);a.focus();m&&m._4e_scrollIntoView();setTimeout(function(){a.fire("save")},10);return m},insertHtml:function(i){var v=this;if(v.htmlDataProcessor)i=v.htmlDataProcessor.toDataFormat(i);
if(z.webkit){i=s.create(i,null,this.document);i=i.nodeType==11?G.makeArray(i.childNodes):[i];for(var a=0;a<i.length;a++)v.insertElement(new t(i[a]))}else{v.focus();v.fire("save");a=v.getSelection();if(z.ie){a=a.getNative();a.type=="Control"&&a.clear();a.createRange().pasteHTML(i)}else v.document.execCommand("inserthtml",false,i);v.focus();setTimeout(function(){v.fire("save")},10)}}});x._initIFrame=function(i){function v(m){h(function(){d.designMode="on";setTimeout(function(){d.designMode="off";o.focus();
if(!arguments.callee.retry)arguments.callee.retry=true},50)},function(){d.designMode="off";s.attr(o,"contentEditable",false);s.attr(o,"contentEditable",true);!m&&v(1)})}var a=n.getInstance(i);i=a.textarea[0];var b=a.iframe[0].contentWindow,d=a.document,e=a.cfg,r=d.getElementById("ke_actscript");s._4e_remove(r);var o=d.body;if(z.ie){o.hideFocus=true;o.disabled=true;o.contentEditable=true;o.removeAttribute("disabled")}else setTimeout(function(){if(z.gecko||z.opera)o.contentEditable=true;else if(z.webkit)o.parentNode.contentEditable=
true;else d.designMode="on"},0);if(z.webkit){j.on(d,"click",function(m){var q=new t(m.target);G.inArray(q._4e_name(),["input","select"])&&m.preventDefault()});j.on(d,"mouseup",function(m){var q=new t(m.target);G.inArray(q._4e_name(),["input","textarea"])&&m.preventDefault()})}if(z.gecko||z.ie||z.opera){var c;c=new t(s.insertAfter((new t('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],i));c.on("focus",function(){a.focus()});a.activateGecko=function(){z.gecko&&
a.iframeFocus&&c[0].focus()};a.on("destroy",function(){})}if(z.ie&&d.compatMode=="CSS1Compat"||z.gecko||z.opera){var k=new t(d.documentElement);k.on("mousedown",function(m){if(m.target==k[0]){z.gecko&&v(false);c[0].focus()}})}j.on(b,"focus",function(){if(z.gecko)v(false);else z.opera&&o.focus();a.notifySelectionChange()});z.gecko&&j.on(a.document,"mousedown",function(){a.iframeFocus||v(false)});if(z.ie){j.on(d,"keydown",function(m){if(m.keyCode in{8:1,46:1}){var q=a.getSelection(),y=q.getSelectedElement();
if(y){a.fire("save");var F=q.getRanges()[0].createBookmark();y._4e_remove();q.selectBookmarks([F]);a.fire("save");m.preventDefault()}}});if(d.compatMode=="CSS1Compat"){var g={33:1,34:1};j.on(d,"keydown",function(m){m.keyCode in g&&setTimeout(function(){a.getSelection().scrollIntoView()},0)})}}setTimeout(function(){z.ie&&setTimeout(function(){if(d){o.runtimeStyle.marginBottom="0px";o.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){a.fire("dataReady");var m=e.disableObjectResizing,q=e.disableInlineTableEditing;
if(m||q)try{d.execCommand("enableObjectResizing",false,!m);d.execCommand("enableInlineTableEditing",false,!q)}catch(y){j.on(o,z.ie?"resizestart":"resize",function(F){if(m||s._4e_name(F.target)==="table"&&q)F.preventDefault()})}},10);z.webkit&&j.on(d,"mousedown",function(m){m=new t(m.target);G.inArray(m._4e_name(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(m)});z.gecko&&j.on(d,"dragstart",function(m){var q=new t(m.target);q._4e_name()==="img"&&/ke_/.test(q[0].className)&&
m.preventDefault()});n.add(a)}});KISSY.Editor.add("zindex",function(){var x=KISSY,C=x.Editor;if(!C.zIndexManager){C.zIndexManager={};x.mix(C.zIndexManager,{BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:1500,MAXIMIZE:900,OVERLAY:9999,LOADING:99999,SELECT:1200});C.baseZIndex=function(G){var z=G,s=C.getInstances(),t;for(t in s){if(!s.hasOwnProperty(t))return;z=Math.max(z,s[t].baseZIndex(G))}return z}}});
KISSY.Editor.add("dtd",function(x){x.XHTML_DTD=function(){var C=function(o){for(var c=arguments.length-1;c>0;)KISSY.mix(o,arguments[c--]);return o},G={isindex:1,fieldset:1},z={input:1,button:1,select:1,textarea:1,label:1},s=C({a:1},z),t=C({iframe:1},s),j={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},n={ins:1,del:1,script:1,style:1},h=C({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},n),f=C({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},h),l=C({p:1},f);z=C({iframe:1},f,z);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var p=C({a:1},z),A={tr:1},u={"#":1},i=C({param:1},f),v=C({form:1},G,t,j,l),a={li:1},b={base:1,link:1,meta:1,title:1},d=C(b,{style:1,script:1}),e={head:1,body:1},r={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:C({html:1},e,b),$block:r,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:p,$body:C({script:1,style:1},r),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:e,head:d,style:u,body:v,base:{},link:{},meta:{},title:u,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:v,td:v,br:{},th:v,center:v,kbd:p,button:C(l,j),basefont:{},h5:p,h4:p,samp:p,h6:p,ol:a,h1:p,h3:p,option:u,h2:p,form:C(G,t,j,l),select:{optgroup:1,option:1},font:p,ins:p,menu:a,abbr:p,label:p,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:p,script:u,tfoot:A,cite:p,li:v,input:{},iframe:v,strong:p,textarea:u,noframes:v,big:p,small:p,span:p,hr:{},dt:p,sub:p,optgroup:{option:1},param:{},bdo:p,"var":p,div:v,object:i,sup:p,dd:v,strike:p,area:{},dir:a,map:C({area:1,form:1,p:1},G,n,j),applet:i,dl:{dt:1,dd:1},del:p,isindex:{},fieldset:C({legend:1},f),thead:A,ul:a,acronym:p,b:p,a:z,blockquote:v,caption:p,i:p,u:p,tbody:A,s:p,address:C(t,l),tt:p,legend:p,q:p,pre:C(h,s),p:p,em:p,dfn:p}}()});
KISSY.Editor.add("dom",function(x){function C(a){return a.replace(/-(\w)/g,function(b,d){return d.toUpperCase()})}var G=KISSY,z=G.DOM,s=G.UA,t=G.Node,j=x.Utils,n={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};x.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};x.POSITION={};var h=x.NODE,f=x.POSITION;f.POSITION_IDENTICAL=0;f.POSITION_DISCONNECTED=
1;f.POSITION_FOLLOWING=2;f.POSITION_PRECEDING=4;f.POSITION_IS_CONTAINED=8;f.POSITION_CONTAINS=16;var l={},p={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},A={hr:1},u=function(a){return a[0]||a},i=function(a){if(a&&!a[0])return new t(a);return a},v={_4e_wrap:i,_4e_unwrap:u,_4e_equals:function(a,b){if(!a&&!b)return true;if(!a||!b)return false;a=u(a);b=u(b);return a===
b},_4e_isBlockBoundary:function(a,b){a=i(a);var d=G.mix(G.mix({},A),b||{});return p[a.css("display")]||d[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=u(a);for(var b=a.parentNode.childNodes,d=0;d<b.length;d++)if(b[d]===a)return d;return-1},_4e_first:function(a,b){a=u(a);var d=a.firstChild;if((d=d&&new t(d))&&b&&!b(d))d=d._4e_next(b);return d},_4e_move:function(a,b,d){a._4e_remove();a=u(a);
b=u(b);d?b.insertBefore(a,b.firstChild):b.appendChild(a)},_4e_name:function(a){a=u(a);var b=a.nodeName.toLowerCase();if(s.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},_4e_isIdentical:function(a,b){if(a._4e_name()!=b._4e_name())return false;var d=a[0].attributes,e=b[0].attributes,r=d.length,o=e.length;if(!s.ie&&r!=o)return false;for(var c=0;c<r;c++){var k=d[c];if((!s.ie||k.specified&&k.nodeName!="_ke_expando")&&k.nodeValue!=b.attr(k.nodeName))return false}if(s.ie)for(c=0;c<o;c++){k=
e[c];if(k.specified&&k.nodeName!="_ke_expando"&&k.nodeValue!=a.attr(k.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=u(a).childNodes;for(var b=0,d=a.length;b<d;b++){var e=a[b],r=e.nodeType;if(!(r==h.NODE_ELEMENT&&e.getAttribute("_ke_bookmark")))if(r==h.NODE_ELEMENT&&!v._4e_isEmptyInlineRemoveable(e)||r==h.NODE_TEXT&&G.trim(e.nodeValue))return false}return true},_4e_moveChildren:function(a,b,d){a=u(a);b=b[0]||b;if(a!=b)if(d)for(;d=a.lastChild;)b.insertBefore(a.removeChild(d),
b.firstChild);else for(;d=a.firstChild;)b.appendChild(a.removeChild(d))},_4e_mergeSiblings:function(){function a(b,d,e){if(d[0]&&d[0].nodeType==h.NODE_ELEMENT){for(var r=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemoveable();){r.push(d);d=e?new t(d[0].nextSibling):new t(d[0].previousSibling);if(!d[0]||d[0].nodeType!=h.NODE_ELEMENT)return}if(b._4e_isIdentical(d)){for(var o=e?b[0].lastChild:b[0].firstChild;r.length;)r.shift()._4e_move(b,!e);d._4e_moveChildren(b,!e);d._4e_remove();o[0]&&o[0].nodeType==
h.NODE_ELEMENT&&o._4e_mergeSiblings()}}}return function(b){if(b[0])if(n[b._4e_name()]||b._4e_name()=="a"){a(b,new t(b[0].nextSibling),true);a(b,new t(b[0].previousSibling))}}}(),_4e_unselectable:s.gecko?function(a){a=u(a);a.style.MozUserSelect="none"}:s.webkit?function(a){a=u(a);a.style.KhtmlUserSelect="none"}:function(a){a=u(a);if(s.ie||s.opera){var b,d=0;for(a.unselectable="on";b=a.all[d++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable=
"on"}}},_4e_getOffset:function(a,b){a=u(a);var d,e=0;d=0;var r=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,o=a.ownerDocument,c=o.documentElement;b=b||o;if(a.getBoundingClientRect){if(a!==o.body&&c!==a){d=a.getBoundingClientRect();e=d.left+(b===o?z.scrollLeft(r):0);d=d.top+(b===o?z.scrollTop(r):0)}if(b)if(r!=(b.defaultView||b.parentWindow)&&r.frameElement){r=v._4e_getOffset(r.frameElement,b);e+=r.left;d+=r.top}}return{left:e,top:d}},_4e_getFrameDocument:function(a){return(a=u(a))&&a.contentWindow.document},
_4e_splitText:function(a,b){a=u(a);var d=a.ownerDocument;if(!(!a||a.nodeType!=h.NODE_TEXT)){if(s.ie&&b==a.nodeValue.length){var e=d.createTextNode("");z.insertAfter(e,a);return new t(e)}e=new t(a.splitText(b));if(s.ie==8){d=d.createTextNode("");z.insertAfter(d,e[0]);d.parentNode.removeChild(d)}return e}},_4e_parents:function(a,b){a=i(a);var d=[];do d[b?"push":"unshift"](a);while(a=a.parent());return d},_4e_clone:function(a,b,d){a=u(a);a=a.cloneNode(b);if(!d){var e=function(r){if(r.nodeType==h.NODE_ELEMENT){r.removeAttribute("id",
false);r.removeAttribute("_ke_expando",false);r=r.childNodes;for(var o=0;o<r.length;o++)e(r[o])}};e(a)}return new t(a)},_4e_nextSourceNode:function(a,b,d,e){a=u(a);if(e&&!e.call){var r=e[0]||e;e=function(c){c=c[0]||c;return c!==r}}b=!b&&a.firstChild;var o=new t(a);if(!b){if(a.nodeType==h.NODE_ELEMENT&&e&&e(a,true)===false)return null;b=a.nextSibling}for(;!b&&(o=o.parent());){if(e&&e(o,true)===false)return null;b=o[0].nextSibling}if(!b)return null;b=z._4e_wrap(b);if(e&&e(b)===false)return null;if(d&&
d!=b[0].nodeType)return b._4e_nextSourceNode(false,d,e);return b},_4e_previousSourceNode:function(a,b,d,e){a=u(a);if(e&&!e.call){var r=e[0]||e;e=function(c){c=c[0]||c;return c!==r}}b=!b&&a.lastChild;var o=new t(a);if(!b){if(a.nodeType==h.NODE_ELEMENT&&e&&e(a,true)===false)return null;b=a.previousSibling}for(;!b&&(o=o.parent());){if(e&&e(o,true)===false)return null;b=o[0].previousSibling}if(!b)return null;b=z._4e_wrap(b);if(e&&e(b)===false)return null;if(d&&b[0].nodeType!=d)return b._4e_previousSourceNode(false,
d,e);return b},_4e_contains:s.ie||s.webkit?function(a,b){a=u(a);b=u(b);return b.nodeType!=h.NODE_ELEMENT?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=u(a);b=u(b);return!!(a.compareDocumentPosition(b)&16)},_4e_commonAncestor:function(a,b){if(a._4e_equals(b))return a;if(b[0].nodeType!=h.NODE_TEXT&&b._4e_contains(a))return b;var d=a[0].nodeType==h.NODE_TEXT?a.parent():a;do if(d[0].nodeType!=h.NODE_TEXT&&d._4e_contains(b))return d;while(d=d.parent());return null},_4e_ascendant:function(a,
b,d){a=u(a);if(!d)a=a.parentNode;if(b&&!G.isFunction(b)){var e=b;b=function(r){return r._4e_name()==e}}for(;a&&a.nodeType!=9;){if(!b||b(new t(a))===true)return new t(a);a=a.parentNode}return null},_4e_hasAttribute:function(a,b){a=u(a);var d=a.attributes.getNamedItem(b);return!!(d&&d.specified)},_4e_hasAttributes:s.ie?function(a){a=u(a);for(var b=a.attributes,d=0;d<b.length;d++){var e=b[d];switch(e.nodeName){case "class":if(a.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(e.specified)return true}}return false}:
function(a){a=u(a);s.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},_4e_position:function(a,b){var d=u(a),e=u(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(e);if(d==e)return f.POSITION_IDENTICAL;if(d.nodeType==h.NODE_ELEMENT&&e.nodeType==h.NODE_ELEMENT){if(d.contains){if(d.contains(e))return f.POSITION_CONTAINS+f.POSITION_PRECEDING;if(e.contains(d))return f.POSITION_IS_CONTAINED+f.POSITION_FOLLOWING}if("sourceIndex"in
d)return d.sourceIndex<0||e.sourceIndex<0?f.POSITION_DISCONNECTED:d.sourceIndex<e.sourceIndex?f.POSITION_PRECEDING:f.POSITION_FOLLOWING}d=a._4e_address();e=b._4e_address();for(var r=Math.min(d.length,e.length),o=0;o<=r-1;o++)if(d[o]!=e[o]){if(o<r)return d[o]<e[o]?f.POSITION_PRECEDING:f.POSITION_FOLLOWING;break}return d.length<e.length?f.POSITION_CONTAINS+f.POSITION_PRECEDING:f.POSITION_IS_CONTAINED+f.POSITION_FOLLOWING},_4e_address:function(a,b){a=u(a);for(var d=[],e=a.ownerDocument.documentElement,
r=a;r&&r!=e;){var o=r.parentNode,c=-1;if(o){for(var k=0;k<o.childNodes.length;k++){var g=o.childNodes[k];if(!(b&&g.nodeType==3&&g.previousSibling&&g.previousSibling.nodeType==3)){c++;if(g==r)break}}d.unshift(c)}r=o}return d},_4e_breakParent:function(a,b){var d=new x.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);var e=d.extractContents();d.insertNode(a._4e_remove());a[0].parentNode.insertBefore(e,a[0].nextSibling)},_4e_style:function(a,b,d){if(d!==undefined)return a.css(b,d);a=a[0]||
a;return a.style[C(b)]},_4e_remove:function(a,b){var d=u(a),e=d.parentNode;if(e){if(b)for(var r;r=d.firstChild;)e.insertBefore(d.removeChild(r),d);e.removeChild(d)}return a},_4e_trim:function(a){z._4e_ltrim(a);z._4e_rtrim(a)},_4e_ltrim:function(a){a=u(a);for(var b;b=a.firstChild;){if(b.nodeType==h.NODE_TEXT){var d=j.ltrim(b.nodeValue),e=b.nodeValue.length;if(d){if(d.length<e){(new t(b))._4e_splitText(e-d.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){a=
u(a);for(var b;b=a.lastChild;){if(b.type==h.NODE_TEXT){var d=j.rtrim(b.nodeValue),e=b.nodeValue.length;if(d){if(d.length<e){(new t(b))._4e_splitText(d.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!s.ie&&!s.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},_4e_appendBogus:function(a){a=u(a);for(var b=a.lastChild;b&&b.nodeType==h.NODE_TEXT&&!G.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==h.NODE_TEXT||z._4e_name(b)!==
"br"){b=s.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");s.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},_4e_previous:function(a,b){var d=u(a),e;do e=(d=d.previousSibling)&&new t(d);while(e&&b&&!b(e));return e},_4e_last:function(a,b){a=z._4e_wrap(a);var d=a[0].lastChild;if((d=d&&new t(d))&&b&&!b(d))d=d._4e_previous(b);return d},_4e_next:function(a,b){var d=u(a),e;do e=(d=d.nextSibling)&&new t(d);while(e&&b&&!b(e));return e},_4e_outerHtml:function(a){a=u(a);
if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML},_4e_setMarker:function(a,b,d,e){a=z._4e_wrap(a);var r=a._4e_getData("list_marker_id")||a._4e_setData("list_marker_id",G.guid())._4e_getData("list_marker_id"),o=a._4e_getData("list_marker_names")||a._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");b[r]=a;o[d]=1;return a._4e_setData(d,e)},_4e_clearMarkers:function(a,b,d){a=i(a);
var e=a._4e_getData("list_marker_names"),r=a._4e_getData("list_marker_id"),o;for(o in e)a._4e_removeData(o);a._4e_removeData("list_marker_names");if(d){a._4e_removeData("list_marker_id");delete b[r]}},_4e_setData:function(a,b,d){var e=z._4e_getUniqueId(a);(l[e]||(l[e]={}))[b]=d;return a},_4e_getData:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");return(d=d&&l[d])&&d[b]},_4e_removeData:function(a,b){a=u(a);var d=a.getAttribute("_ke_expando");var e=(d=d&&l[d])&&d[b];typeof e!="undefined"&&
d&&delete d[b];G.isEmptyObject(d)&&z._4e_clearData(a);return e||null},_4e_clearData:function(a){a=u(a);var b=a.getAttribute("_ke_expando");b&&delete l[b];b&&a.removeAttribute("_ke_expando")},_4e_getUniqueId:function(a){a=u(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=G.guid();a.setAttribute("_ke_expando",b);return b},_4e_copyAttributes:function(a,b,d){a=u(a);var e=a.attributes;d=d||{};for(var r=0;r<e.length;r++){var o=e[r],c=o.nodeName.toLowerCase(),k;if(!(c in d))if(c=="checked"&&(k=z.attr(a,
c)))b.attr(c,k);else if(o.specified||s.ie&&o.nodeValue&&c=="value"){k=z.attr(a,c);if(k===null)k=o.nodeValue;b.attr(c,k)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=z._4e_name(a);var b=x.XHTML_DTD;return(a=!b.$nonEditable[a]&&(b[a]||b.span))&&a["#"]},_4e_scrollIntoView:function(a){a=i(a);var b=a[0].ownerDocument,d=z.scrollLeft(b),e=z.scrollTop(b),r=a.offset(),o=r.left;r=r.top;if(z.viewportHeight(b)+e<r||r<e||z.viewportWidth(b)+d<o||o<d)a.scrollIntoView(b)},
_4e_getElementsByTagName:function(a,b,d){a=u(a);if(!s.ie&&d)b=d+":"+b;d=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(new t(a[b]));return d}};G.DOM._4e_inject=function(a){G.mix(z,a);for(var b in a)a.hasOwnProperty(b)&&function(d){t.prototype[d]=function(){var e=[].slice.call(arguments,0);e.unshift(this);return a[d].apply(null,e)}}(b)};G.DOM._4e_inject(v)});
KISSY.Editor.add("elementpath",function(x){function C(f){var l=null,p=null,A=[];for(f=f;f&&f[0];){if(f[0].nodeType==t.NODE_ELEMENT){if(!this.lastElement)this.lastElement=f;var u=f._4e_name();if(j.ie&&f[0].scopeName!="HTML")u=f[0].scopeName.toLowerCase()+":"+u;if(!p){if(!l&&n[u])l=f;if(h[u]){var i;if(i=!l){if(i=u=="div"){a:{i=f;i=i[0]||i;i=i.childNodes;for(var v=0,a=i.length;v<a;v++){var b=i[v];if(b.nodeType==t.NODE_ELEMENT&&s.$block[b.nodeName.toLowerCase()]){i=true;break a}}i=false}i=!i}i=i}if(i)l=
f;else p=f}}A.push(f);if(u=="body")break}f=f.parent()}this.block=l;this.blockLimit=p;this.elements=A}var G=KISSY,z=G.DOM,s=x.XHTML_DTD,t=x.NODE,j=G.UA,n={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},h={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};C.prototype={compare:function(f){var l=this.elements;f=f&&f.elements;if(!f||l.length!=f.length)return false;for(var p=0;p<l.length;p++)if(!z._4e_equals(l[p],f[p]))return false;return true},contains:function(f){for(var l=
this.elements,p=0;p<l.length;p++)if(l[p]._4e_name()in f)return l[p];return null}};x.ElementPath=C});
KISSY.Editor.add("walker",function(x){function C(h,f){if(this._.end)return null;var l,p=this.range,A,u=this.guard,i=this.type,v=h?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;p.trim();if(p.collapsed){this.end();return null}}if(!h&&!this._.guardLTR){var a=p.endContainer,b=new n(a[0].childNodes[p.endOffset]);this._.guardLTR=function(o,c){return(o=j._4e_wrap(o))&&o[0]&&(!c||!j._4e_equals(a,o))&&(!b[0]||!o._4e_equals(b))&&(o[0].nodeType!=t.NODE_ELEMENT||!c||o._4e_name()!=
"body")}}if(h&&!this._.guardRTL){var d=p.startContainer,e=p.startOffset>0&&new n(d[0].childNodes[p.startOffset-1]);this._.guardRTL=function(o,c){return(o=j._4e_wrap(o))&&o[0]&&(!c||!o._4e_equals(d))&&(!e[0]||!o._4e_equals(e))&&(o[0].nodeType!=t.NODE_ELEMENT||!c||o._4e_name()!="body")}}var r=h?this._.guardRTL:this._.guardLTR;A=u?function(o,c){if(r(o,c)===false)return false;return u(o,c)}:r;if(this.current)l=this.current[v](false,i,A);else if(h){l=p.endContainer;if(p.endOffset>0){l=new n(l[0].childNodes[p.endOffset-
1]);if(A(l)===false)l=null}else l=A(l,true)===false?null:l._4e_previousSourceNode(true,i,A)}else{l=p.startContainer;if((l=new n(l[0].childNodes[p.startOffset]))&&l[0]){if(A(l)===false)l=null}else l=A(p.startContainer,true)===false?null:p.startContainer._4e_nextSourceNode(true,i,A)}for(;l&&l[0]&&!this._.end;){this.current=l;if(!this.evaluator||this.evaluator(l)!==false){if(!f)return l}else if(f&&this.evaluator)return false;l=l[v](false,i,A)}this.end();return this.current=null}function G(h){for(var f,
l=null;f=C.call(this,h);)l=f;return l}function z(h){this.range=h;this._={}}var s=KISSY,t=x.NODE,j=s.DOM,n=s.Node;s.augment(z,{end:function(){this._.end=1},next:function(){return C.call(this)},previous:function(){return C.call(this,true)},checkForward:function(){return C.call(this,false,true)!==false},checkBackward:function(){return C.call(this,true,true)!==false},lastForward:function(){return G.call(this)},lastBackward:function(){return G.call(this,true)},reset:function(){delete this.current;this._=
{}}});z.blockBoundary=function(h){return function(f){f=j._4e_wrap(f);return!(f&&f[0].nodeType==t.NODE_ELEMENT&&f._4e_isBlockBoundary(h))}};z.listItemBoundary=function(){return this.blockBoundary({br:1})};z.bookmark=function(h,f){function l(p){return p&&p[0]&&p._4e_name()=="span"&&p.attr("_ke_bookmark")}return function(p){var A,u;A=p&&p[0]&&p[0].nodeType==t.NODE_TEXT&&(u=p.parent())&&l(u);A=h?A:A||l(p);return f^A}};z.whitespaces=function(h){return function(f){f=(f=f[0]||f)&&f.nodeType==t.NODE_TEXT&&
!s.trim(f.nodeValue);return h^f}};z.invisible=function(h){var f=z.whitespaces();return function(l){l=f(l)||l[0].nodeType==t.NODE_ELEMENT&&!l[0].offsetHeight;return h^l}};x.Walker=z});
KISSY.Editor.add("range",function(x){function C(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=true;this.document=c}function G(c){var k=c[0].nodeType!=h.NODE_TEXT&&c._4e_name()in v.$removeEmpty,g=!n.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return k||g||c}function z(c){return!r(c)&&!o(c)}function s(c){var k=false,g=p.bookmark(true);return function(m){if(g(m))return true;if(m[0].nodeType==h.NODE_TEXT){if(n.trim(m[0].nodeValue).length)return false}else if(m[0].nodeType==
h.NODE_ELEMENT)if(!e[m._4e_name()])if(!c&&!i.ie&&m._4e_name()=="br"&&!k)k=true;else return false;return true}}function t(c,k){function g(m){return m&&m.nodeName=="span"&&m.getAttribute("_ke_bookmark")}return function(m){var q,y;q=m&&!m.nodeName&&(y=m.parentNode)&&g(y);q=c?q:q||g(m);return k^q}}function j(c){return function(k){k=(k=k[0]||k)&&k.nodeType==h.NODE_TEXT&&!n.trim(k.nodeValue);return c^k}}x.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var n=KISSY,h=x.NODE,f=x.RANGE,l=x.POSITION,p=x.Walker,A=n.DOM,u=x.Utils.getByAddress,i=n.UA,v=x.XHTML_DTD,a=x.ElementPath,b=n.Node,d={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};C.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+
":"+this.endOffset);return c.join("<br/>")};n.augment(C,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&A._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var c=this.startContainer,k=this.startOffset;if(c[0].nodeType!=h.NODE_ELEMENT)if(k)k>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;k=this.endOffset;if(c[0].nodeType!=h.NODE_ELEMENT)if(k)k>=c[0].nodeValue.length&&
this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c._4e_index()+1)},setStartBefore:function(c){this.setStart(c.parent(),c._4e_index())},setEndAfter:function(c){this.setEnd(c.parent(),c._4e_index()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c._4e_index())},optimizeBookmark:function(){var c=this.startContainer,k=this.endContainer;c&&c._4e_name()=="span"&&c.attr("_ke_bookmark")&&this.setStartAt(c,f.POSITION_BEFORE_START);k&&k._4e_name()=="span"&&
k.attr("_ke_bookmark")&&this.setEndAt(k,f.POSITION_AFTER_END)},setStart:function(c,k){if(c[0].nodeType==h.NODE_ELEMENT&&d[c._4e_name()]){c=c.parent();k=c._4e_index()}this.startContainer=c;this.startOffset=k;if(!this.endContainer){this.endContainer=c;this.endOffset=k}this.updateCollapsed()},setEnd:function(c,k){if(c[0].nodeType==h.NODE_ELEMENT&&d[c._4e_name()]){c=c.parent();k=c._4e_index()+1}this.endContainer=c;this.endOffset=k;if(!this.startContainer){this.startContainer=c;this.startOffset=k}this.updateCollapsed()},
setStartAt:function(c,k){switch(k){case f.POSITION_AFTER_START:this.setStart(c,0);break;case f.POSITION_BEFORE_END:c[0].nodeType==h.NODE_TEXT?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case f.POSITION_BEFORE_START:this.setStartBefore(c);break;case f.POSITION_AFTER_END:this.setStartAfter(c)}this.updateCollapsed()},setEndAt:function(c,k){switch(k){case f.POSITION_AFTER_START:this.setEnd(c,0);break;case f.POSITION_BEFORE_END:c[0].nodeType==h.NODE_TEXT?this.setEnd(c,
c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case f.POSITION_BEFORE_START:this.setEndBefore(c);break;case f.POSITION_AFTER_END:this.setEndAfter(c)}this.updateCollapsed()},execContentsAction:function(c,k){var g=this.startContainer,m=this.endContainer,q=this.startOffset,y=this.endOffset,F,J=this.document,L;this.optimizeBookmark();if(m[0].nodeType==h.NODE_TEXT)m=m._4e_splitText(y);else if(m[0].childNodes.length>0)if(y>=m[0].childNodes.length){m=new b(m[0].appendChild(J.createTextNode("")));
L=true}else m=new b(m[0].childNodes[y]);if(g[0].nodeType==h.NODE_TEXT){g._4e_splitText(q);if(g._4e_equals(m))m=new b(g[0].nextSibling)}else if(q)if(q>=g[0].childNodes.length){F=new b(J.createTextNode(""));g.append(F);g=F;F=true}else g=new b(g[0].childNodes[q].previousSibling);else{F=new b(J.createTextNode(""));(q=g[0].firstChild)?A.insertBefore(F[0],q):g.append(F);g=F;F=true}q=g._4e_parents();y=m._4e_parents();var M,P,O;for(M=0;M<q.length;M++){P=q[M];O=y[M];if(!P._4e_equals(O))break}J=k;for(var w,
H,B,D=M;D<q.length;D++){w=q[D];if(J&&!w._4e_equals(g))H=J.appendChild(w._4e_clone()[0]);for(w=w[0].nextSibling;w;){if(A._4e_equals(y[D],w)||A._4e_equals(m,w))break;B=w.nextSibling;if(c==2)J.appendChild(w.cloneNode(true));else{w.parentNode.removeChild(w);c==1&&J.appendChild(w)}w=B}if(H)J=H}J=k;for(M=M;M<y.length;M++){w=y[M];if(c>0&&!w._4e_equals(m))H=J.appendChild(w._4e_clone()[0]);if(!q[M]||!w.parent()._4e_equals(q[M].parent()))for(w=w[0].previousSibling;w;){if(A._4e_equals(q[M],w)||A._4e_equals(g,
w))break;B=w.previousSibling;if(c==2)J.insertBefore(w.cloneNode(true),J.firstChild);else{A._4e_remove(w);c==1&&J.insertBefore(w,J.firstChild)}w=B}if(H)J=H}if(c==2){O=this.startContainer[0];if(O.nodeType==h.NODE_TEXT&&O.nextSibling&&O.nextSibling.nodeType==h.NODE_TEXT){O.data+=O.nextSibling.data;O.parentNode.removeChild(O.nextSibling)}O=this.endContainer[0];if(O.nodeType==h.NODE_TEXT&&O.nextSibling&&O.nextSibling.nodeType==h.NODE_TEXT){O.data+=O.nextSibling.data;O.parentNode.removeChild(O.nextSibling)}}else{if(P&&
O&&(!g.parent()._4e_equals(P.parent())||!m.parent()._4e_equals(O.parent()))){P=O._4e_index();F&&O.parent()._4e_equals(g.parent())&&P--;this.setStart(O.parent(),P)}this.collapse(true)}F&&g._4e_remove();L&&m[0].parentNode&&m._4e_remove()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=true},clone:function(){var c=new C(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},getEnclosedNode:function(){var c=this.clone();c.optimize();if(c.startContainer[0].nodeType!=h.NODE_ELEMENT||c.endContainer[0].nodeType!=h.NODE_ELEMENT)return null;var k=new x.Walker(c),g=t(true,undefined),m=j(true);c.evaluator=function(q){return m(q)&&g(q)};c=k.next();k.reset();k=k.previous();return c&&c._4e_equals(k)?c:null},shrink:function(c,k){if(!this.collapsed){c=c||
f.SHRINK_TEXT;var g=this.clone(),m=this.startContainer,q=this.endContainer,y=this.startOffset,F=this.endOffset,J=1,L=1;if(m&&m[0].nodeType==h.NODE_TEXT)if(y)if(y>=m[0].nodeValue.length)g.setStartAfter(m);else{g.setStartBefore(m);J=0}else g.setStartBefore(m);if(q&&q[0].nodeType==h.NODE_TEXT)if(F)if(F>=q[0].nodeValue.length)g.setEndAfter(q);else{g.setEndAfter(q);L=0}else g.setEndBefore(q);g=new p(g);g.evaluator=function(P){P=P[0]||P;return P.nodeType==(c==f.SHRINK_ELEMENT?h.NODE_ELEMENT:h.NODE_TEXT)};
var M;g.guard=function(P,O){P=P[0]||P;if(c==f.SHRINK_ELEMENT&&P.nodeType==h.NODE_TEXT)return false;if(O&&P==M)return false;if(!O&&P.nodeType==h.NODE_ELEMENT)M=P;return true};if(J)(m=g[c==f.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(m,k?f.POSITION_AFTER_START:f.POSITION_BEFORE_START);if(L){g.reset();(g=g[c==f.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(g,k?f.POSITION_BEFORE_END:f.POSITION_AFTER_END)}return!!(J||L)}},getTouchedStartNode:function(){var c=this.startContainer;
if(this.collapsed||c[0].nodeType!=h.NODE_ELEMENT)return c;return c.childNodes[this.startOffset]||c},createBookmark2:function(c){var k=this.startContainer,g=this.endContainer,m=this.startOffset,q=this.endOffset,y,F;if(!k||!g)return{start:0,end:0};if(c){if(k[0].nodeType==h.NODE_ELEMENT)if((y=new b(k[0].childNodes[m]))&&y[0]&&y[0].nodeType==h.NODE_TEXT&&m>0&&y[0].previousSibling.nodeType==h.NODE_TEXT){k=y;m=0}for(;k[0].nodeType==h.NODE_TEXT&&(F=k._4e_previous())&&F[0].nodeType==h.NODE_TEXT;){k=F;m+=
F[0].nodeValue.length}if(!this.collapsed){if(g[0].nodeType==h.NODE_ELEMENT)if((y=new b(g[0].childNodes[q]))&&y[0]&&y[0].nodeType==h.NODE_TEXT&&q>0&&y[0].previousSibling.nodeType==h.NODE_TEXT){g=y;q=0}for(;g[0].nodeType==h.NODE_TEXT&&(F=g._4e_previous())&&F[0].nodeType==h.NODE_TEXT;){g=F;q+=F[0].nodeValue.length}}}return{start:k._4e_address(c),end:this.collapsed?null:g._4e_address(c),startOffset:m,endOffset:q,normalized:c,is2:true}},createBookmark:function(c){var k,g,m,q;k=new b("<span>",null,this.document);
k.attr("_ke_bookmark",1);k.css("display","none");k.html("&nbsp;");if(c){m=n.guid("ke_bm_");k.attr("id",m+"S")}if(!this.collapsed){g=k._4e_clone();g.html("&nbsp;");c&&g.attr("id",m+"E");q=this.clone();q.collapse();q.insertNode(g)}q=this.clone();q.collapse(true);q.insertNode(k);if(g){this.setStartAfter(k);this.setEndBefore(g)}else this.moveToPosition(k,f.POSITION_AFTER_END);return{startNode:c?m+"S":k,endNode:c?m+"E":g,serializable:c}},moveToPosition:function(c,k){this.setStartAt(c,k);this.collapse(true)},
trim:function(c,k){var g=this.startContainer,m=this.startOffset,q=this.collapsed;if((!c||q)&&g[0]&&g[0].nodeType==h.NODE_TEXT){if(m)if(m>=g[0].nodeValue.length){m=g._4e_index()+1;g=g.parent()}else{var y=g._4e_splitText(m);m=g._4e_index()+1;g=g.parent();if(A._4e_equals(this.startContainer,this.endContainer))this.setEnd(y,this.endOffset-this.startOffset);else if(A._4e_equals(g,this.endContainer))this.endOffset+=1}else{m=g._4e_index();g=g.parent()}this.setStart(g,m);if(q){this.collapse(true);return}}g=
this.endContainer;m=this.endOffset;if(!(k||q)&&g[0]&&g[0].nodeType==h.NODE_TEXT){if(m){m>=g.nodeValue.length||g._4e_splitText(m);m=g._4e_index()+1}else m=g._4e_index();g=g.parent();this.setEnd(g,m)}},insertNode:function(c){this.optimizeBookmark();this.trim(false,true);var k=this.startContainer,g=k[0].childNodes[this.startOffset];this.optimizeBookmark();this.trim(false,true);g?A.insertBefore(c[0]||c,g):k[0].appendChild(c[0]||c);A._4e_equals(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},
moveToBookmark:function(c){if(c.is2){var k=u(this.document,c.start,c.normalized),g=c.startOffset,m=c.end&&u(this.document,c.end,c.normalized);c=c.endOffset;this.setStart(k,g);m?this.setEnd(m,c):this.collapse(true)}else{k=(g=c.serializable)?n.one("#"+c.startNode,this.document):c.startNode;c=g?n.one("#"+c.endNode,this.document):c.endNode;this.setStartBefore(k);k._4e_remove();if(c&&c[0]){this.setEndBefore(c);c._4e_remove()}else this.collapse(true)}},getCommonAncestor:function(c,k){var g=this.startContainer,
m=this.endContainer;g=A._4e_equals(g,m)?c&&g[0].nodeType==h.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new b(g[0].childNodes[this.startOffset]):g:g._4e_commonAncestor(m);return k&&g[0].nodeType==h.NODE_TEXT?g.parent():g},enlarge:function(c){switch(c){case f.ENLARGE_ELEMENT:if(this.collapsed)break;c=this.getCommonAncestor();var k=new b(this.document.body),g,m,q,y,F,J=false,L,M;L=this.startContainer;M=this.startOffset;if(L[0].nodeType==h.NODE_TEXT){if(M){L=!n.trim(L[0].nodeValue.substring(0,M)).length&&
L;J=!!L}if(L)if(!(y=L[0].previousSibling))q=L.parent()}else{if(M)y=L[0].childNodes[M-1]||L[0].lastChild;y||(q=L)}for(;q||y;){if(q&&!y){if(!F&&A._4e_equals(q,c))F=true;if(!k._4e_contains(q))break;if(!J||q.css("display")!="inline"){J=false;if(F)g=q;else this.setStartBefore(q)}y=q[0].previousSibling}for(;y;){L=false;if(y.nodeType==h.NODE_TEXT){M=y.nodeValue;if(/[^\s\ufeff]/.test(M))y=null;L=/[\s\ufeff]$/.test(M)}else if(y.offsetWidth>0&&!y.getAttribute("_ke_bookmark"))if(J&&v.$removeEmpty[y.nodeName.toLowerCase()]){M=
A.text(y);if(/[^\s\ufeff]/.test(M))y=null;else for(var P=y.all||y.getElementsByTagName("*"),O=0,w;w=P[O++];)if(!v.$removeEmpty[w.nodeName.toLowerCase()]){y=null;break}if(y)L=!!M.length}else y=null;if(L)if(J)if(F)g=q;else q&&this.setStartBefore(q);else J=true;if(y){L=y.previousSibling;if(!q&&!L){q=new b(y);y=null;break}y=L}else q=null}if(q)q=q.parent()}L=this.endContainer;M=this.endOffset;q=y=null;F=J=false;if(L[0].nodeType==h.NODE_TEXT){L=!n.trim(L[0].nodeValue.substring(M)).length&&L;J=!(L&&L[0].nodeValue.length);
if(L)if(!(y=L[0].nextSibling))q=L.parent()}else(y=L[0].childNodes[M])||(q=L);for(;q||y;){if(q&&!y){if(!F&&A._4e_equals(q,c))F=true;if(!k._4e_contains(q))break;if(!J||q.css("display")!="inline"){J=false;if(F)m=q;else q&&this.setEndAfter(q)}y=q[0].nextSibling}for(;y;){L=false;if(y.nodeType==h.NODE_TEXT){M=y.nodeValue;if(/[^\s\ufeff]/.test(M))y=null;L=/^[\s\ufeff]/.test(M)}else if(y.offsetWidth>0&&!y.getAttribute("_ke_bookmark"))if(J&&v.$removeEmpty[y.nodeName.toLowerCase()]){M=A.text(y);if(/[^\s\ufeff]/.test(M))y=
null;else{P=y.all||y.getElementsByTagName("*");for(O=0;w=P[O++];)if(!v.$removeEmpty[w.nodeName.toLowerCase()]){y=null;break}}if(y)L=!!M.length}else y=null;if(L)if(J)if(F)m=q;else this.setEndAfter(q);if(y){L=y.nextSibling;if(!q&&!L){q=new b(y);y=null;break}y=L}else q=null}if(q)q=q.parent()}if(g&&m){c=g._4e_contains(m)?m:g;this.setStartBefore(c);this.setEndAfter(c)}break;case f.ENLARGE_BLOCK_CONTENTS:case f.ENLARGE_LIST_ITEM_CONTENTS:q=new C(this.document);k=new b(this.document.body);q.setStartAt(k,
f.POSITION_AFTER_START);q.setEnd(this.startContainer,this.startOffset);q=new p(q);var H,B,D=p.blockBoundary(c==f.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),E=function(K){var I=D(K);I||(H=K);return I};g=function(K){var I=E(K);if(!I&&K[0]&&K._4e_name()=="br")B=K;return I};q.guard=E;q=q.lastBackward();H=H||k;this.setStartAt(H,H._4e_name()!="br"&&(!q&&this.checkStartOfBlock()||q&&H._4e_contains(q))?f.POSITION_AFTER_START:f.POSITION_AFTER_END);q=this.clone();q.collapse();q.setEndAt(k,f.POSITION_BEFORE_END);
q=new p(q);q.guard=c==f.ENLARGE_LIST_ITEM_CONTENTS?g:E;H=null;q=q.lastForward();H=H||k;this.setEndAt(H,!q&&this.checkEndOfBlock()||q&&H._4e_contains(q)?f.POSITION_BEFORE_END:f.POSITION_BEFORE_START);B&&this.setEndAfter(B)}},checkStartOfBlock:function(){var c=this.startContainer,k=this.startOffset;if(k&&c[0].nodeType==h.NODE_TEXT)if(n.trim(c[0].nodeValue.substring(0,k)).length)return false;this.trim();c=new a(this.startContainer);k=this.clone();k.collapse(true);k.setStartAt(c.block||c.blockLimit,f.POSITION_AFTER_START);
c=new p(k);c.evaluator=s(true);return c.checkBackward()},checkEndOfBlock:function(){var c=this.endContainer,k=this.endOffset;if(c[0].nodeType==h.NODE_TEXT)if(n.trim(c[0].nodeValue.substring(k)).length)return false;this.trim();c=new a(this.endContainer);k=this.clone();k.collapse(false);k.setEndAt(c.block||c.blockLimit,f.POSITION_BEFORE_END);c=new p(k);c.evaluator=s(false);return c.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var c=
this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,c);return c},checkBoundaryOfElement:function(c,k){var g=this.clone();g[k==f.START?"setStartAt":"setEndAt"](c,k==f.START?f.POSITION_AFTER_START:f.POSITION_BEFORE_END);g=new p(g);g.evaluator=G;return g[k==f.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var c=this.startContainer,k=this.endContainer,g=this.startOffset,m=this.endOffset,q;if(c[0].nodeType==h.NODE_ELEMENT){q=c[0].childNodes.length;if(q>
g)c=new b(c[0].childNodes[g]);else if(q<1)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new b(c);c=c._4e_nextSourceNode()||c}}if(k[0].nodeType==h.NODE_ELEMENT){q=k[0].childNodes.length;if(q>m)k=(new b(k[0].childNodes[m]))._4e_previousSourceNode(true);else if(q<1)k=k._4e_previousSourceNode();else{for(k=k[0];k.lastChild;)k=k.lastChild;k=new b(k)}}if(c._4e_position(k)&l.POSITION_FOLLOWING)c=k;return{startNode:c,endNode:k}},fixBlock:function(c,k){var g=this.createBookmark(),
m=new b(this.document.createElement(k));this.collapse(c);this.enlarge(f.ENLARGE_BLOCK_CONTENTS);m[0].appendChild(this.extractContents());m._4e_trim();i.ie||m._4e_appendBogus();this.insertNode(m);this.moveToBookmark(g);return m},splitBlock:function(c){var k=new a(this.startContainer),g=new a(this.endContainer),m=k.block,q=g.block,y=null;if(!k.blockLimit._4e_equals(g.blockLimit))return null;if(c!="br"){if(!m){m=this.fixBlock(true,c);q=(new a(this.endContainer)).block}q||(q=this.fixBlock(false,c))}c=
m&&this.checkStartOfBlock();k=q&&this.checkEndOfBlock();this.deleteContents();if(m&&A._4e_equals(m,q))if(k){y=new a(this.startContainer);this.moveToPosition(q,f.POSITION_AFTER_END);q=null}else if(c){y=new a(this.startContainer);this.moveToPosition(m,f.POSITION_BEFORE_START);m=null}else{q=this.splitElement(m);!i.ie&&!n.inArray(m._4e_name(),["ul","ol"])&&m._4e_appendBogus()}return{previousBlock:m,nextBlock:q,wasStartOfBlock:c,wasEndOfBlock:k,elementPath:y}},splitElement:function(c){if(!this.collapsed)return null;
this.setEndAt(c,f.POSITION_BEFORE_END);var k=this.extractContents(),g=c._4e_clone(false);g[0].appendChild(k);g.insertAfter(c);this.moveToPosition(c,f.POSITION_AFTER_END);return g},moveToElementEditablePosition:function(c,k){var g,m=x.XHTML_DTD;if(m.$empty[c._4e_name()])return false;for(;c&&c[0].nodeType==h.NODE_ELEMENT;){if(g=c._4e_isEditable())this.moveToPosition(c,k?f.POSITION_BEFORE_END:f.POSITION_AFTER_START);else if(m.$inline[c._4e_name()]){this.moveToPosition(c,k?f.POSITION_AFTER_END:f.POSITION_BEFORE_START);
return true}if((c=m.$empty[c._4e_name()]?c[k?"_4e_previous":"_4e_next"](z):c[k?"_4e_last":"_4e_first"](z))&&c[0].nodeType==h.NODE_TEXT){this.moveToPosition(c,k?f.POSITION_AFTER_END:f.POSITION_BEFORE_START);return true}}return g},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==h.NODE_TEXT?c[0].nodeValue.length:c[0].childNodes.length)}});var e={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},r=new p.whitespaces,o=new p.bookmark;x.Range=C});
KISSY.Editor.add("domiterator",function(x){function C(A){if(!(arguments.length<1)){this.range=A;this.forceBrBreak=false;this.enlargeBr=true;this.enforceRealBlocks=false;this._||(this._={})}}var G=KISSY,z=G.UA,s=x.Walker,t=x.Range,j=x.RANGE,n=x.NODE,h=x.ElementPath,f=G.Node,l=G.DOM,p=/^[\r\n\t ]*$/;s.bookmark();G.augment(C,{getNextParagraph:function(A){var u,i,v,a,b;if(!this._.lastNode){i=this.range.clone();i.shrink(j.SHRINK_ELEMENT,true);i.enlarge(this.forceBrBreak||!this.enlargeBr?j.ENLARGE_LIST_ITEM_CONTENTS:
j.ENLARGE_BLOCK_CONTENTS);var d=new s(i),e=s.bookmark(true,true);d.evaluator=e;this._.nextNode=d.next();d=new s(i);d.evaluator=e;d=d.previous();this._.lastNode=d._4e_nextSourceNode(true);if(this._.lastNode&&this._.lastNode[0].nodeType==n.NODE_TEXT&&!G.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){e=new t(i.document);e.moveToPosition(this._.lastNode,j.POSITION_AFTER_END);if(e.checkEndOfBlock()){e=new h(e.endContainer);this._.lastNode=(e.block||e.blockLimit)._4e_nextSourceNode(true)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new f(i.document.createTextNode(""));l.insertAfter(this._.lastNode[0],d[0])}i=null}e=this._.nextNode;d=this._.lastNode;for(this._.nextNode=null;e;){var r=false,o=e[0].nodeType!=n.NODE_ELEMENT,c=false;if(o){if(e[0].nodeType==n.NODE_TEXT)if(p.test(e[0].nodeValue))o=false}else{var k=e._4e_name();if(e._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(k=="br")o=true;else if(!i&&!e[0].childNodes.length&&k!="hr"){u=e;v=e._4e_equals(d);break}if(i){i.setEndAt(e,j.POSITION_BEFORE_START);
if(k!="br")this._.nextNode=e}r=true}else{if(e[0].firstChild){if(!i){i=new t(this.range.document);i.setStartAt(e,j.POSITION_BEFORE_START)}e=new f(e[0].firstChild);continue}o=true}}if(o&&!i){i=new t(this.range.document);i.setStartAt(e,j.POSITION_BEFORE_START)}v=(!r||o)&&e._4e_equals(d);if(i&&!r)for(;!e[0].nextSibling&&!v;){k=e.parent();if(k._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){r=true;v||k._4e_equals(d);break}e=k;o=true;v=e._4e_equals(d);c=true}o&&i.setEndAt(e,j.POSITION_AFTER_END);e=e._4e_nextSourceNode(c,
null,d);if((v=!e)||r&&i)break}if(!u){if(!i){this._.docEndMarker&&this._.docEndMarker._4e_remove();return this._.nextNode=null}u=new h(i.startContainer);e=u.blockLimit;r={div:1,th:1,td:1};u=u.block;if((!u||!u[0])&&!this.enforceRealBlocks&&r[e._4e_name()]&&i.checkStartOfBlock()&&i.checkEndOfBlock())u=e;else if(!u||this.enforceRealBlocks&&u._4e_name()=="li"){u=new f(this.range.document.createElement(A||"p"));u[0].appendChild(i.extractContents());u._4e_trim();i.insertNode(u);a=b=true}else if(u._4e_name()!=
"li"){if(!i.checkStartOfBlock()||!i.checkEndOfBlock()){u=u._4e_clone(false);u[0].appendChild(i.extractContents());u._4e_trim();b=i.splitBlock();a=!b.wasStartOfBlock;b=!b.wasEndOfBlock;i.insertNode(u)}}else if(!v)this._.nextNode=u._4e_equals(d)?null:i.getBoundaryNodes().endNode._4e_nextSourceNode(true,null,d)}if(a){i=new f(u[0].previousSibling);if(i[0]&&i[0].nodeType==n.NODE_ELEMENT)if(i._4e_name()=="br")i._4e_remove();else i[0].lastChild&&l._4e_name(i[0].lastChild)=="br"&&l._4e_remove(i[0].lastChild)}if(b){i=
s.bookmark(false,true);a=new f(u[0].lastChild);if(a[0]&&a[0].nodeType==n.NODE_ELEMENT&&a._4e_name()=="br")if(z.ie||a._4e_previous(i)||a._4e_next(i))a._4e_remove()}if(!this._.nextNode)this._.nextNode=v||u._4e_equals(d)?null:u._4e_nextSourceNode(true,null,d);return u}});t.prototype.createIterator=function(){return new C(this)}});
KISSY.Editor.add("selection",function(x){function C(b){this.document=b;this._={cache:{}};if(s.ie){var d=this.getNative().createRange();if(!d||d.item&&d.item(0).ownerDocument!=b||d.parentElement&&d.parentElement().ownerDocument!=b)this.isInvalid=true}}function G(b){var d=b.document,e=new n(d.body),r=new n(d.documentElement);if(s.ie){if(s.ie<8||document.documentMode==7)r.on("click",function(J){t._4e_name(J.target)==="html"&&b.getSelection().getRanges()[0].select()});var o,c,k=1;r.on("mousedown",function(){k=
0});r.on("mouseup",function(){k=1});e.on("focusin",function(J){if(t._4e_name(J.target)=="body")if(o){try{k&&o.select()}catch(L){}o=null}});e.on("focus",function(){c=true;m()});e.on("beforedeactivate",function(J){if(!J.relatedTarget){c=false;k=1}});j.on(t._4e_getWin(d),"blur",function(){d&&d.selection.empty()});e.on("mousedown",function(){g()});e.on("mouseup",function(){c=true;setTimeout(function(){m(true)},0)});e.on("keydown",g);e.on("keyup",function(){c=true;m()});j.on(d,"selectionchange",m);var g=
function(){c=false},m=function(J){if(c){var L=b.document,M=b.getSelection(),P=M&&M.getType(),O=M&&M.getNative();if(J&&O&&P==h.SELECTION_NONE)if(!L.queryCommandEnabled("InsertImage")){setTimeout(function(){m(true)},50);return}var w;if(!(O&&P==h.SELECTION_TEXT&&(w=t._4e_name(O.createRange().parentElement()))&&w in{input:1,textarea:1})){o=O&&M.getRanges()[0];b._monitor()}}}}else{j.on(d,"mouseup",b._monitor,b);j.on(d,"keyup",b._monitor,b)}var q={table:1,pre:1},y=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
F=x.Walker.whitespaces(true);b.on("selectionChange",function(J){var L=J.path;J=(J=J.selection)&&J.getRanges()[0];var M=L.blockLimit;if(J)if(J.collapse&&!L.block&&M._4e_name()=="body"){L=J.fixBlock(true,"p");if(L._4e_outerHtml().match(y))if((M=L._4e_next(F))&&M[0].nodeType==l.NODE_ELEMENT&&!q[M._4e_name()]){J.moveToElementEditablePosition(M);L._4e_remove()}else if((M=L._4e_previous(F))&&M[0].nodeType==l.NODE_ELEMENT&&!q[M._4e_name()]){J.moveToElementEditablePosition(M,M._4e_outerHtml().match(y)?false:
true);L._4e_remove()}J.select();s.ie||b.notifySelectionChange()}})}x.SELECTION={};var z=KISSY,s=z.UA,t=z.DOM,j=z.Event,n=z.Node,h=x.SELECTION,f=x.RANGE,l=x.NODE,p=x.Walker,A=x.Range;h.SELECTION_NONE=1;h.SELECTION_TEXT=2;h.SELECTION_ELEMENT=3;var u={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};z.augment(C,{getNative:s.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.selection)}:
function(){return this._.cache.nativeSel||(this._.cache.nativeSel=t._4e_getWin(this.document).getSelection())},getType:s.ie?function(){var b=this._.cache;if(b.type)return b.type;var d=h.SELECTION_NONE;try{var e=this.getNative(),r=e.type;if(r=="Text")d=h.SELECTION_TEXT;if(r=="Control")d=h.SELECTION_ELEMENT;if(e.createRange().parentElement)d=h.SELECTION_TEXT}catch(o){}return b.type=d}:function(){var b=this._.cache;if(b.type)return b.type;var d=h.SELECTION_TEXT,e=this.getNative();if(e){if(e.rangeCount==
1){e=e.getRangeAt(0);var r=e.startContainer;if(r==e.endContainer&&r.nodeType==l.NODE_ELEMENT&&e.endOffset-e.startOffset===1&&u[r.childNodes[e.startOffset].nodeName.toLowerCase()])d=h.SELECTION_ELEMENT}}else d=h.SELECTION_NONE;return b.type=d},getRanges:s.ie?function(){var b=function(d,e){d=d.duplicate();d.collapse(e);for(var r=d.parentElement(),o=r.childNodes,c,k=0;k<o.length;k++){var g=o[k];if(g.nodeType==l.NODE_ELEMENT){c=d.duplicate();c.moveToElementText(g);g=c.compareEndPoints("StartToStart",
d);var m=c.compareEndPoints("EndToStart",d);c.collapse();if(g>0)break;else if(!g||m==1&&g==-1)return{container:r,offset:k};else if(!m)return{container:r,offset:k+1};c=null}}if(!c){c=d.duplicate();c.moveToElementText(r);c.collapse(false)}c.setEndPoint("StartToStart",d);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=o[--k].nodeValue.length}catch(q){c=0}return c===0?{container:r,offset:k}:{container:o[k],offset:-c}};return function(){var d=this._.cache;if(d.ranges)return d.ranges;var e=
this.getNative(),r=e&&e.createRange(),o=this.getType();if(!e)return[];if(o==h.SELECTION_TEXT){e=new A(this.document);o=b(r,true);e.setStart(new n(o.container),o.offset);o=b(r);e.setEnd(new n(o.container),o.offset);return d.ranges=[e]}else if(o==h.SELECTION_ELEMENT){d=this._.cache.ranges=[];for(o=0;o<r.length;o++){var c=r.item(o),k=c.parentNode,g=0;for(e=new A(this.document);g<k.childNodes.length&&k.childNodes[g]!=c;g++);e.setStart(new n(k),g);e.setEnd(new n(k),g+1);d.push(e)}return d}return d.ranges=
[]}}():function(){var b=this._.cache;if(b.ranges)return b.ranges;var d=[],e=this.getNative();if(!e)return[];for(var r=0;r<e.rangeCount;r++){var o=e.getRangeAt(r),c=new A(this.document);c.setStart(new n(o.startContainer),o.startOffset);c.setEnd(new n(o.endContainer),o.endOffset);d.push(c)}return b.ranges=d},getStartElement:function(){var b=this._.cache;if(b.startElement!==undefined)return b.startElement;var d,e=this.getNative();switch(this.getType()){case h.SELECTION_ELEMENT:return this.getSelectedElement();
case h.SELECTION_TEXT:var r=this.getRanges()[0];if(r)if(!r.collapsed){for(r.optimize();;){d=r.startContainer;if(r.startOffset==(d[0].nodeType===l.NODE_ELEMENT?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())r.setStartAfter(d);else break}d=r.startContainer;if(d[0].nodeType!=l.NODE_ELEMENT)return d.parent();d=new n(d[0].childNodes[r.startOffset]);if(!d[0]||d[0].nodeType!=l.NODE_ELEMENT)return r.startContainer;for(r=d[0].firstChild;r&&r.nodeType==l.NODE_ELEMENT;){d=new n(r);r=
r.firstChild}return d}if(s.ie){r=e.createRange();r.collapse(true);d=r.parentElement()}else if((d=e.anchorNode)&&d.nodeType!=l.NODE_ELEMENT)d=d.parentNode}return b.startElement=d?t._4e_wrap(d):null},getSelectedElement:function(){var b=this._.cache;if(b.selectedElement!==undefined)return b.selectedElement;var d=this,e;if(s.ie){e=d.getNative().createRange();e=e.item&&e.item(0)}e||(e=function(){for(var r=d.getRanges()[0],o,c,k=2;k&&!((o=r.getEnclosedNode())&&o[0].nodeType==l.NODE_ELEMENT&&u[o._4e_name()]&&
(c=o));k--)r.shrink(f.SHRINK_ELEMENT);return c&&c[0]}());return b.selectedElement=t._4e_wrap(e)},reset:function(){this._.cache={}},selectElement:function(b){var d;if(s.ie)try{d=this.document.body.createControlRange();d.addElement(b[0]);d.select()}catch(e){d=this.document.body.createTextRange();d.moveToElementText(b[0]);d.select()}finally{}else{d=this.document.createRange();d.selectNode(b[0]);b=this.getNative();b.removeAllRanges();b.addRange(d)}this.reset()},selectRanges:function(b){if(s.ie)b[0]&&
b[0].select();else{var d=this.getNative();if(!d)return;d.removeAllRanges();for(var e=0;e<b.length;e++){var r=b[e],o=this.document.createRange(),c=r.startContainer;r.collapsed&&s.gecko&&s.gecko<1.09&&c[0].nodeType==l.NODE_ELEMENT&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));o.setStart(c[0],r.startOffset);o.setEnd(r.endContainer[0],r.endOffset);d.addRange(o)}}this.reset()},createBookmarks2:function(b){for(var d=[],e=this.getRanges(),r=0;r<e.length;r++)d.push(e[r].createBookmark2(b));
return d},createBookmarks:function(b){for(var d=[],e=this.getRanges(),r=e.length,o=this.document,c,k=0;k<r;k++){d.push(c=e[k].createBookmark(b,true));var g=(b=c.serializable)?z.one("#"+c.startNode,o):c.startNode;c=b?z.one("#"+c.endNode,o):c.endNode;for(var m=k+1;m<r;m++){var q=e[m],y=q.startContainer,F=q.endContainer;t._4e_equals(y,g.parent())&&q.startOffset++;t._4e_equals(y,c.parent())&&q.startOffset++;t._4e_equals(F,g.parent())&&q.endOffset++;t._4e_equals(F,c.parent())&&q.endOffset++}}return d},
selectBookmarks:function(b){for(var d=[],e=0;e<b.length;e++){var r=new A(this.document);r.moveToBookmark(b[e]);d.push(r)}this.selectRanges(d);return this},getCommonAncestor:function(){var b=this.getRanges();return b[0].startContainer._4e_commonAncestor(b[b.length-1].endContainer)},scrollIntoView:function(){var b=this.getStartElement();b&&b._4e_scrollIntoView()},removeAllRanges:function(){var b=this.getNative();s.ie?b.clear():b.removeAllRanges()}});x.Selection=C;var i={table:1,tbody:1,tr:1},v=p.whitespaces(true),
a=/\ufeff|\u00a0/;A.prototype.select=s.ie?function(b){var d=this.collapsed,e,r;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var o=this.startContainer[0].childNodes[this.startOffset];if(o.nodeType==l.NODE_ELEMENT){(new C(this.document)).selectElement(new n(o));return}}if(this.startContainer[0].nodeType==l.NODE_ELEMENT&&this.startContainer._4e_name()in i||this.endContainer[0].nodeType==l.NODE_ELEMENT&&this.endContainer._4e_name()in i)this.shrink(f.SHRINK_ELEMENT,
true);var c=this.createBookmark();o=c.startNode;var k;if(!d)k=c.endNode;c=this.document.body.createTextRange();c.moveToElementText(o[0]);c.moveStart("character",1);if(k){b=this.document.body.createTextRange();b.moveToElementText(k[0]);c.setEndPoint("EndToEnd",b);c.moveEnd("character",-1)}else{for(e=o[0].nextSibling;e&&!v(e);)e=e.nextSibling;e=!(e&&e.nodeValue&&e.nodeValue.match(a))&&(b||!o[0].previousSibling||o[0].previousSibling&&t._4e_name(o[0].previousSibling)=="br");r=this.document.createElement("span");
r.innerHTML="&#65279;";r=new n(r);t.insertBefore(r[0],o[0]);e&&t.insertBefore(this.document.createTextNode("\ufeff"),o[0])}this.setStartBefore(o);o._4e_remove();if(d){if(e){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(r){this.moveToPosition(r,f.POSITION_BEFORE_START);r._4e_remove()}}else{this.setEndBefore(k);k._4e_remove();c.select()}}:function(){var b=this.startContainer;this.collapsed&&b[0].nodeType==l.NODE_ELEMENT&&!b[0].childNodes.length&&b[0].appendChild(this.document.createTextNode(""));
var d=this.document.createRange();d.setStart(b[0],this.startOffset);try{d.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(true);d.setEnd(this.endContainer[0],this.endOffset)}else throw e;}b=new C(this.document);b=(!b||b.isInvalid?null:b).getNative();b.removeAllRanges();b.addRange(d)};x.on("instanceCreated",function(b){G(b.editor)})});
KISSY.Editor.add("styles",function(x){function C(w,H){for(var B in w)w[B]=w[B].replace(O,function(D,E){return H[E]})}function G(w,H){if(H){w=e.clone(w);C(w.attributes,H);C(w.styles,H)}var B=this.element=(w.element||"*").toLowerCase();this.type=B=="#"||L[B]?o.STYLE_BLOCK:M[B]?o.STYLE_OBJECT:o.STYLE_INLINE;this._={definition:w}}function z(w,H){var B=H?this.removeFromRange:this.applyToRange;w.body.focus();for(var D=new k(w),E=D.getRanges(),K=0;K<E.length;K++)B.call(this,E[K]);D.selectRanges(E)}function s(w,
H){var B;B=w.element;if(B=="*")B="span";B=new y(H.createElement(B));return t(B,w)}function t(w,H){var B=H._.definition,D=B.attributes;B=G.getStyleText(B);if(D)for(var E in D)w.attr(E,D[E]);if(B)w[0].style.cssText=B;return w}function j(w){var H=w.createBookmark(true),B=w.createIterator();B.enforceRealBlocks=true;B.enlargeBr=true;for(var D,E=w.document;D=B.getNextParagraph();){var K=s(this,E);D=D;var I=K;K=I._4e_name=="pre";var N=D._4e_name=="pre",T=!K&&N;if(K&&!N){N=D;I=I;T=N.html();T=n(T,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,
"");T=T.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");T=T.replace(/([ \t\n\r]+|&nbsp;)/g," ");T=T.replace(/<br\b[^>]*>/gi,"\n");if(F.ie){N=N[0].ownerDocument.createElement("div");N.appendChild(I[0]);I[0].outerHTML="<pre>"+T+"</pre>";I=new y(N.firstChild);I._4e_remove()}else I.html(T);I=I}else if(T)I=f(h(D),I);else D._4e_moveChildren(I);D[0].parentNode.replaceChild(I[0],D[0]);if(K){D=I;K=void 0;if((K=D._4e_previousSourceNode(true,g.NODE_ELEMENT))&&K._4e_name()=="pre"){I=n(K.html(),/\n$/,"")+"\n\n"+
n(D.html(),/^\n/,"");if(F.ie)D[0].outerHTML="<pre>"+I+"</pre>";else D.html(I);K._4e_remove()}}}w.moveToBookmark(H)}function n(w,H,B){var D="",E="";w=w.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(K,I,N){I&&(D=I);N&&(E=N);return""});return D+w.replace(H,B)+E}function h(w){var H=[];n(w._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(B,D,E){return D+"</pre>"+E+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(B,
D){H.push(D)});return H}function f(w,H){for(var B=H[0].ownerDocument.createDocumentFragment(),D=0;D<w.length;D++){var E=w[D];E=E.replace(/(\r\n|\r)/g,"\n");E=n(E,/^[ \t]*\n/,"");E=n(E,/\n$/,"");E=n(E,/^[ \t]+|[ \t]+$/g,function(I,N){return I.length==1?"&nbsp;":N?" "+Array(I.length).join("&nbsp;"):Array(I.length).join("&nbsp;")+" "});E=E.replace(/\n/g,"<br>");E=E.replace(/[ \t]{2,}/g,function(I){return Array(I.length).join("&nbsp;")+" "});var K=H._4e_clone();K.html(E);B.appendChild(K[0])}return B}
function l(w){var H=w.document;if(w.collapsed){H=s(this,H);w.insertNode(H);w.moveToPosition(H,c.POSITION_BEFORE_END)}else{var B=this.element,D=this._.definition,E,K=x.XHTML_DTD[B]||(E=true,x.XHTML_DTD.span),I=w.createBookmark();w.enlarge(c.ENLARGE_ELEMENT);w.trim();var N=w.createBookmark(),T=N.startNode;N=N.endNode;for(var S=T,V;S&&S[0];){var Q=false;if(r._4e_equals(S,N)){S=null;Q=true}else{var R=S[0].nodeType,Y=R==g.NODE_ELEMENT?S._4e_name():null;if(Y&&S.attr("_ke_bookmark")){S=S._4e_nextSourceNode(true);
continue}if(!Y||K[Y]&&(S._4e_position(N)|m.POSITION_PRECEDING|m.POSITION_IDENTICAL|m.POSITION_IS_CONTAINED)==m.POSITION_PRECEDING+m.POSITION_IDENTICAL+m.POSITION_IS_CONTAINED&&(!D.childRule||D.childRule(S))){var U=S.parent();if(U&&U[0]&&((x.XHTML_DTD[U._4e_name()]||x.XHTML_DTD.span)[B]||E)&&(!D.parentRule||D.parentRule(U))){if(!V&&(!Y||!x.XHTML_DTD.$removeEmpty[Y]||(S._4e_position(N)|m.POSITION_PRECEDING|m.POSITION_IDENTICAL|m.POSITION_IS_CONTAINED)==m.POSITION_PRECEDING+m.POSITION_IDENTICAL+m.POSITION_IS_CONTAINED)){V=
new q(H);V.setStartBefore(S)}if(R==g.NODE_TEXT||R==g.NODE_ELEMENT&&!S[0].childNodes.length){R=S;for(var W;!R[0].nextSibling&&(W=R.parent(),K[W._4e_name()])&&(W._4e_position(T)|m.POSITION_FOLLOWING|m.POSITION_IDENTICAL|m.POSITION_IS_CONTAINED)==m.POSITION_FOLLOWING+m.POSITION_IDENTICAL+m.POSITION_IS_CONTAINED&&(!D.childRule||D.childRule(W));)R=W;V.setEndAfter(R);R[0].nextSibling||(Q=true)}}else Q=true}else Q=true;S=S._4e_nextSourceNode()}if(Q&&V&&!V.collapsed){Q=s(this,H);for(R=V.getCommonAncestor();Q&&
R&&Q[0]&&R[0];){if(R._4e_name()==B){for(var X in D.attributes)Q.attr(X)==R.attr(X)&&Q[0].removeAttribute(X);for(var aa in D.styles)Q._4e_style(aa)==R._4e_style(aa)&&Q._4e_style(aa,"");if(!Q._4e_hasAttributes()){Q=null;break}}R=R.parent()}if(Q){Q[0].appendChild(V.extractContents());R=Q;Y=i(this);U=R.all(this.element);for(var Z=U.length;--Z>=0;)v(this,new y(U[Z]));var $=void 0;for($ in Y)if($!=this.element){U=R.all($);for(Z=U.length-1;Z>=0;Z--){var ba=new y(U[Z]);b(ba,Y[$])}}V.insertNode(Q);Q._4e_mergeSiblings();
F.ie||Q[0].normalize()}V=null}}T._4e_remove();N._4e_remove();w.moveToBookmark(I);w.shrink(c.SHRINK_TEXT)}}function p(w){w.enlarge(c.ENLARGE_ELEMENT);var H=w.createBookmark(),B=H.startNode;if(w.collapsed){for(var D=new J(B.parent()),E,K=0,I;K<D.elements.length&&(I=D.elements[K]);K++){if(I==D.block||I==D.blockLimit)break;if(this.checkElementRemovable(I)){var N=w.checkBoundaryOfElement(I,c.END),T=!N&&w.checkBoundaryOfElement(I,c.START);if(T||N){E=I;E.match=T?"start":"end"}else{I._4e_mergeSiblings();
I._4e_name()==this.element?v(this,I):b(I,i(this)[I._4e_name()])}}}if(E&&E[0]){I=B;for(K=0;;K++){N=D.elements[K];if(r._4e_equals(N,E))break;else if(N.match)continue;else N=N._4e_clone();N[0].appendChild(I[0]);I=N}r[E.match=="start"?"insertBefore":"insertAfter"](I[0],E[0])}}else{var S=H.endNode,V=this;D=function(){for(var Q=new J(B.parent()),R=new J(S.parent()),Y=null,U=null,W=0;W<Q.elements.length;W++){var X=Q.elements[W];if(X==Q.block||X==Q.blockLimit)break;if(V.checkElementRemovable(X))Y=X}for(W=
0;W<R.elements.length;W++){X=R.elements[W];if(X==R.block||X==R.blockLimit)break;if(V.checkElementRemovable(X))U=X}U&&S._4e_breakParent(U);Y&&B._4e_breakParent(Y)};D();for(E=new y(B[0].nextSibling);E[0]!==S[0];){K=E._4e_nextSourceNode();if(E[0]&&E[0].nodeType==g.NODE_ELEMENT&&this.checkElementRemovable(E)){E._4e_name()==this.element?v(this,E):b(E,i(this)[E._4e_name()]);if(K[0].nodeType==g.NODE_ELEMENT&&K._4e_contains(B)){D();K=new y(B[0].nextSibling)}}E=K}}w.moveToBookmark(H)}function A(w){var H={};
w.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(B,D,E){H[D]=E});return H}function u(w,H){var B;if(H!==false){B=document.createElement("span");B.style.cssText=w;B=B.style.cssText||""}else B=w;return B.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(w){if(w._.overrides)return w._.overrides;var H=w._.overrides={},B=w._.definition.overrides;if(B){e.isArray(B)||(B=[B]);for(var D=0;D<B.length;D++){var E=B[D],K,I;if(typeof E==
"string")K=E.toLowerCase();else{K=E.element?E.element.toLowerCase():w.element;I=E.attributes}E=H[K]||(H[K]={});if(I){E=E.attributes=E.attributes||[];for(var N in I)E.push([N.toLowerCase(),I[N]])}}}return H}function v(w,H){var B=w._.definition,D=e.mix(e.mix({},B.attributes),i(w)[H._4e_name()]);B=B.styles;var E=e.isEmptyObject(D)&&e.isEmptyObject(B),K;for(K in D)if(!((K=="class"||w._.definition.fullMatch)&&H.attr(K)!=a(K,D[K]))){E=E||!!H._4e_hasAttribute(K);H.removeAttr(K)}for(var I in B)if(!(w._.definition.fullMatch&&
H._4e_style(I)!=a(I,B[I],true))){E=E||!!H._4e_style(I);H._4e_style(I,"")}E&&d(H)}function a(w,H,B){var D=new y("<span></span>");D[B?"_4e_style":"attr"](w,H);return D[B?"_4e_style":"attr"](w)}function b(w,H){var B=H&&H.attributes;if(B)for(var D=0;D<B.length;D++){var E=B[D][0],K;if(K=w.attr(E)){var I=B[D][1];if(I===null||I.test&&I.test(K)||typeof I=="string"&&K==I)w[0].removeAttribute(E)}}d(w)}function d(w){if(!w._4e_hasAttributes()){var H=w[0].firstChild,B=w[0].lastChild;w._4e_remove(true);if(H){H.nodeType==
g.NODE_ELEMENT&&r._4e_mergeSiblings(H);B&&!H===B&&B.nodeType==g.NODE_ELEMENT&&r._4e_mergeSiblings(B)}}}var e=KISSY,r=e.DOM,o=x.STYLE={},c=x.RANGE,k=x.Selection,g=x.NODE,m=x.POSITION,q=x.Range,y=e.Node,F=e.UA,J=x.ElementPath,L={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},M={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},P=/\s*(?:;\s*|$)/,O=/#\((.+?)\)/g;o.STYLE_BLOCK=1;o.STYLE_INLINE=2;o.STYLE_OBJECT=3;G.prototype={apply:function(w){z.call(this,
w,false)},remove:function(w){z.call(this,w,true)},applyToRange:function(w){return(this.applyToRange=this.type==o.STYLE_INLINE?l:this.type==o.STYLE_BLOCK?j:this.type==o.STYLE_OBJECT?null:null).call(this,w)},removeFromRange:function(w){return(this.removeFromRange=this.type==o.STYLE_INLINE?p:null).call(this,w)},applyToObject:function(w){t(w,this)},checkElementRemovable:function(w,H){if(!w)return false;var B=this._.definition;if(w._4e_name()==this.element){if(!H&&!w._4e_hasAttributes())return true;var D=
B._AC;if(D)B=D;else{D={};var E=0,K=B.attributes;if(K)for(var I in K){E++;D[I]=K[I]}if(K=G.getStyleText(B)){D.style||E++;D.style=K}D._length=E;B=B._AC=D}if(B._length){for(var N in B)if(N!="_length"){E=w.attr(N)||"";if(N=="style")a:{D=B[N];E=u(E,false);typeof D=="string"&&(D=A(D));typeof E=="string"&&(E=A(E));K=void 0;for(K in D)if(!(K in E&&(E[K]==D[K]||D[K]=="inherit"||E[K]=="inherit"))){D=false;break a}D=true}else D=B[N]==E;if(D){if(!H)return true}else if(H)return false}if(H)return true}else return true}if(N=
i(this)[w._4e_name()]){if(!(B=N.attributes))return true;for(D=0;D<B.length;D++){N=B[D][0];if(N=w.attr(N)){E=B[D][1];if(E===null||typeof E=="string"&&N==E||E.test&&E.test(N))return true}}}return false},checkActive:function(w){switch(this.type){case o.STYLE_BLOCK:return this.checkElementRemovable(w.block||w.blockLimit,true);case o.STYLE_OBJECT:case o.STYLE_INLINE:for(var H=w.elements,B=0,D;B<H.length;B++){D=H[B];if(!(this.type==o.STYLE_INLINE&&(r._4e_equals(D,w.block)||r._4e_equals(D,w.blockLimit))))if(!(this.type==
o.STYLE_OBJECT&&!(D._4e_name()in M)))if(this.checkElementRemovable(D,true))return true}}return false}};G.getStyleText=function(w){var H=w._ST;if(H)return H;H=w.styles;var B=w.attributes&&w.attributes.style||"",D="";if(B.length)B=B.replace(P,";");for(var E in H){var K=H[E],I=(E+":"+K).replace(P,";");if(K=="inherit")D+=I;else B+=I}if(B.length)B=u(B);B+=D;return w._ST=B};x.Style=G});
KISSY.Editor.add("htmlparser",function(){function x(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var C=KISSY,G=C.Editor,z=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,s={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},t=G.XHTML_DTD;C.augment(x,{onTagOpen:function(){},onTagClose:function(){},
onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(j){for(var n,h,f=0,l;n=this._.htmlPartsRegex.exec(j);){h=n.index;if(h>f){f=j.substring(f,h);l?l.push(f):this.onText(f)}f=this._.htmlPartsRegex.lastIndex;if(h=n[1]){h=h.toLowerCase();if(l&&t.$cdata[h]){this.onCDATA(l.join(""));l=null}if(!l){this.onTagClose(h);continue}}if(l)l.push(n[0]);else if(h=n[3]){h=h.toLowerCase();var p={},A;n=n[4];var u=!!(n&&n.charAt(n.length-1)=="/");if(n)for(;A=z.exec(n);){var i=A[1].toLowerCase();
A=A[2]||A[3]||A[4]||"";p[i]=!A&&s[i]?i:A}this.onTagOpen(h,p,u);if(!l&&t.$cdata[h])l=[]}else if(h=n[2])this.onComment(h)}j.length>f&&this.onText(j.substring(f,j.length))}});G.HtmlParser=x});
KISSY.Editor.add("htmlparser-basicwriter",function(){function x(){this._={output:[]}}var C=KISSY,G=C.Editor,z=G.Utils;C.augment(x,{openTag:function(s){this._.output.push("<",s)},openTagClose:function(s,t){t?this._.output.push(" />"):this._.output.push(">")},attribute:function(s,t){if(typeof t=="string")t=z.htmlEncodeAttr(t);this._.output.push(" ",s,'="',t,'"')},closeTag:function(s){this._.output.push("</",s,">")},text:function(s){this._.output.push(s)},comment:function(s){this._.output.push("<!--",
s,"--\>")},write:function(s){this._.output.push(s)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(s){var t=this._.output.join("");s&&this.reset();return t}});G.HtmlParser.BasicWriter=x});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function x(){x.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=false;this.sortAttributes=true;this._.indent=false;this._.indentation="";this._.rules={};var s=G.XHTML_DTD,t;for(t in z.mix({},s.$nonBodyContent,s.$block,s.$listItem,s.$tableContent))this.setRules(t,{indent:true,breakBeforeOpen:true,breakAfterOpen:true,breakBeforeClose:!s[t]["#"],breakAfterClose:true});
this.setRules("br",{breakAfterOpen:true});this.setRules("title",{indent:false,breakAfterOpen:false});this.setRules("style",{indent:false,breakBeforeClose:true});this.setRules("pre",{indent:false})}var C=KISSY,G=C.Editor,z=G.Utils;C.extend(x,G.HtmlParser.BasicWriter,{openTag:function(s){var t=this._.rules[s];if(this._.indent)this.indentation();else if(t&&t.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",s)},openTagClose:function(s,t){var j=this._.rules[s];if(t)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(j&&j.indent)this._.indentation+=this.indentationChars}j&&j.breakAfterOpen&&this.lineBreak()},attribute:function(s,t){if(typeof t=="string"){this.forceSimpleAmpersand&&(t=t.replace(/&amp;/g,"&"));t=z.htmlEncodeAttr(t)}this._.output.push(" ",s,'="',t,'"')},closeTag:function(s){var t=this._.rules[s];if(t&&t.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(t&&t.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",s,">");t&&t.breakAfterClose&&this.lineBreak()},text:function(s){if(this._.indent){this.indentation();s=z.ltrim(s)}this._.output.push(s)},comment:function(s){this._.indent&&this.indentation();this._.output.push("<!--",s,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=true},indentation:function(){this._.output.push(this._.indentation);this._.indent=false},setRules:function(s,t){var j=this._.rules[s];
if(j)z.mix(j,t);else this._.rules[s]=t}});G.HtmlParser.HtmlWriter=x});
KISSY.Editor.add("htmlparser-fragment",function(){function x(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false}}var C=KISSY.Editor,G={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},z=KISSY,s=C.Utils,t=C.NODE,j=C.XHTML_DTD,n=s.mix({table:1,ul:1,ol:1,dl:1},j.table,j.ul,j.ol,j.dl),h=j.$list,f=j.$listItem;x.FromHtml=function(l,p){function A(g){var m;if(b.length>0)for(var q=0;q<b.length;q++){var y=b[q],F=y.name,J=j[F],L=e.name&&j[e.name];if((!L||
L[F])&&(!g||!J||J[g]||!j[g])){if(!m){u();m=1}y=y.clone();y.parent=e;e=y;b.splice(q,1);q--}}}function u(){for(;d.length;)e.add(d.shift())}function i(g,m,q){m=m||e||a;if(p&&!m.type){var y,F;if((y=g.attributes&&(F=g.attributes._ke_real_element_type)?F:g.name)&&!(y in j.$body)&&!(y in j.$nonBodyContent)){y=e;e=m;v.onTagOpen(p,{});m=e;if(q)e=y}}if(g._.isBlockLike&&g.name!="pre"){q=g.children.length;if((y=g.children[q-1])&&y.type==t.NODE_TEXT)if(F=s.rtrim(y.value))y.value=F;else g.children.length=q-1}m.add(g);
if(g.returnPoint){e=g.returnPoint;delete g.returnPoint}}var v=new C.HtmlParser,a=new x,b=[],d=[],e=a,r=false,o;v.onTagOpen=function(g,m,q){var y=new C.HtmlParser.Element(g,m);if(y.isUnknown&&q)y.isEmpty=true;if(j.$removeEmpty[g])b.push(y);else{if(g=="pre")r=true;else if(g=="br"&&r){e.add(new C.HtmlParser.Text("\n"));return}if(g=="br")d.push(y);else{var F=e.name,J=F&&(j[F]||(e._.isBlockLike?j.div:j.span));if(J&&!y.isUnknown&&!e.isUnknown&&!J[g]){J=false;var L;if(g in h&&F in h){F=e.children;(F=F[F.length-
1])&&F.name in f||i(F=new C.HtmlParser.Element("li"),e);o=e;L=F}else if(g==F)i(e,e.parent);else{if(n[F])o||(o=e);else{i(e,e.parent,true);G[F]||b.unshift(e)}J=true}e=L?L:e.returnPoint||e.parent;if(J){v.onTagOpen.apply(this,arguments);return}}A(g);u();y.parent=e;y.returnPoint=o;o=0;if(y.isEmpty)i(y);else e=y}}};v.onTagClose=function(g){for(var m=b.length-1;m>=0;m--)if(g==b[m].name){b.splice(m,1);return}for(var q=[],y=[],F=e;F.type&&F.name!=g;){F._.isBlockLike||y.unshift(F);q.push(F);F=F.parent}if(F.type){for(m=
0;m<q.length;m++){var J=q[m];i(J,J.parent)}e=F;if(e.name=="pre")r=false;F._.isBlockLike&&u();i(F,F.parent);if(F==e)e=e.parent;b=b.concat(y)}if(g=="body")p=false};v.onText=function(g){if(!e._.hasInlineStarted&&!r){g=s.ltrim(g);if(g.length===0)return}u();A();if(p&&(!e.type||e.name=="body")&&s.trim(g))this.onTagOpen(p,{});r||(g=g.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));e.add(new C.HtmlParser.Text(g))};v.onCDATA=function(){};v.onComment=function(g){e.add(new C.HtmlParser.Comment(g))};v.parse(l);for(u();e.type;){var c=
e.parent,k=e;if(p&&(!c.type||c.name=="body")&&!j.$body[k.name]){e=c;v.onTagOpen(p,{});c=e}c.add(k);e=c}return a};z.augment(x,{add:function(l){var p=this.children.length;if(p=p>0&&this.children[p-1]||null){if(l._.isBlockLike&&p.type==t.NODE_TEXT){p.value=s.rtrim(p.value);if(p.value.length===0){this.children.pop();this.add(l);return}}p.next=l}l.previous=p;l.parent=this;this.children.push(l);this._.hasInlineStarted=l.type==t.NODE_TEXT||l.type==t.NODE_ELEMENT&&!l._.isBlockLike},writeHtml:function(l,p){var A;
this.filterChildren=function(){var u=new C.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,u,p,true);u=u.getHtml();this.children=(new x.FromHtml(u)).children;A=1};!this.name&&p&&p.onFragment(this);this.writeChildrenHtml(l,A?null:p)},writeChildrenHtml:function(l,p){for(var A=0;A<this.children.length;A++)this.children[A].writeHtml(l,p)}});C.HtmlParser.Fragment=x});
KISSY.Editor.add("htmlparser-element",function(){function x(s,t){this.name=s;this.attributes=t||(t={});this.children=[];var j=t._ke_real_element_type||s,n=C.XHTML_DTD;j=!!(n.$nonBodyContent[j]||n.$block[j]||n.$listItem[j]||n.$tableContent[j]||n.$nonEditable[j]||j=="br");var h=!!n.$empty[s];this.isEmpty=h;this.isUnknown=!n[s];this._={isBlockLike:j,hasInlineStarted:h||!j}}var C=KISSY.Editor,G=C.NODE,z=function(s,t){s=s[0];t=t[0];return s<t?-1:s>t?1:0};KISSY.augment(x,{type:G.NODE_ELEMENT,add:C.HtmlParser.Fragment.prototype.add,
clone:function(){return new x(this.name,this.attributes)},writeHtml:function(s,t){var j=this.attributes,n=this,h=n.name,f,l,p,A;n.filterChildren=function(){if(!A){var v=new C.HtmlParser.BasicWriter;C.HtmlParser.Fragment.prototype.writeChildrenHtml.call(n,v,t);n.children=(new C.HtmlParser.Fragment.FromHtml(v.getHtml())).children;A=1}};if(t){for(;;){if(!(h=t.onElementName(h)))return;n.name=h;if(!(n=t.onElement(n)))return;n.parent=this.parent;if(n.name==h)break;if(n.type!=G.NODE_ELEMENT){n.writeHtml(s,
t);return}h=n.name;if(!h){this.writeChildrenHtml.call(n,s,A?null:t);return}}j=n.attributes}s.openTag(h,j);for(var u=[],i=0;i<2;i++)for(f in j){l=f;p=j[f];if(i==1)u.push([f,p]);else if(t){for(;;)if(l=t.onAttributeName(f))if(l!=f){delete j[f];f=l}else break;else{delete j[f];break}if(l)if((p=t.onAttribute(n,l,p))===false)delete j[l];else j[l]=p}}s.sortAttributes&&u.sort(z);j=u.length;for(i=0;i<j;i++){f=u[i];s.attribute(f[0],f[1])}s.openTagClose(h,n.isEmpty);if(!n.isEmpty){this.writeChildrenHtml.call(n,
s,A?null:t);s.closeTag(h)}},writeChildrenHtml:function(){C.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});C.HtmlParser.Element=x});
KISSY.Editor.add("htmlparser-filter",function(){function x(f){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};f&&this.addRules(f,10)}function C(f,l){for(var p=0;f&&p<l.length;p++){var A=l[p];f=f.replace(A[0],A[1])}return f}function G(f,l,p){if(typeof l=="function")l=[l];var A,u;u=f.length;var i=l&&l.length;if(i){for(A=0;A<u&&f[A].pri<p;A++);for(u=i-1;u>=0;u--)if(i=l[u]){i.pri=p;f.splice(A,0,i)}}}function z(f,l,p){if(l)for(var A in l){var u=f[A];f[A]=s(u,l[A],
p);u||f.$length++}}function s(f,l,p){if(l){l.pri=p;if(f){if(f.splice)G(f,l,p);else{f=f.pri>p?[l,f]:[f,l];f.filter=t}return f}else return l.filter=l}}function t(f){for(var l=f.type||f instanceof n.HtmlParser.Fragment,p=0;p<this.length;p++){if(l)var A=f.type,u=f.name;var i=this[p].apply(window,arguments);if(i===false)return i;if(l){if(i&&(i.name!=u||i.type!=A))return i}else if(typeof i!="string")return i;i!=undefined&&(f=i)}return f}var j=KISSY,n=j.Editor,h=n.NODE;j.augment(x,{addRules:function(f,l){if(typeof l!=
"number")l=10;G(this._.elementNames,f.elementNames,l);G(this._.attributeNames,f.attributeNames,l);z(this._.elements,f.elements,l);z(this._.attributes,f.attributes,l);this._.text=s(this._.text,f.text,l)||this._.text;this._.comment=s(this._.comment,f.comment,l)||this._.comment;this._.root=s(this._.root,f.root,l)||this._.root},onElementName:function(f){return C(f,this._.elementNames)},onAttributeName:function(f){return C(f,this._.attributeNames)},onText:function(f){var l=this._.text;return l?l.filter(f):
f},onComment:function(f,l){var p=this._.comment;return p?p.filter(f,l):f},onFragment:function(f){var l=this._.root;return l?l.filter(f):f},onElement:function(f){for(var l=[this._.elements["^"],this._.elements[f.name],this._.elements.$],p,A=0;A<3;A++)if(p=l[A]){p=p.filter(f,this);if(p===false)return null;if(p&&p!=f)return this.onNode(p);if(f.parent&&!f.name)break}return f},onNode:function(f){var l=f.type;return l==h.NODE_ELEMENT?this.onElement(f):l==h.NODE_TEXT?new n.HtmlParser.Text(this.onText(f.value)):
null},onAttribute:function(f,l,p){if(l=this._.attributes[l]){f=l.filter(p,f,this);if(f===false)return false;if(typeof f!="undefined")return f}return p}});n.HtmlParser.Filter=x});KISSY.Editor.add("htmlparser-text",function(){function x(z){this.value=z;this._={isBlockLike:false}}var C=KISSY,G=C.Editor;C.augment(x,{type:G.NODE.NODE_TEXT,writeHtml:function(z,s){var t=this.value;s&&!(t=s.onText(t,this))||z.text(t)}});G.HtmlParser.Text=x});
KISSY.Editor.add("htmlparser-comment",function(){function x(z){this.value=z;this._={isBlockLike:false}}var C=KISSY.Editor,G=C.NODE;C.HtmlParser.Comment=x;x.prototype={constructor:x,type:G.NODE_COMMENT,writeHtml:function(z,s){var t=this.value;if(s){if(!(t=s.onComment(t,this)))return;if(typeof t!="string"){t.parent=this.parent;t.writeHtml(z,s);return}}z.comment(t)}}});
