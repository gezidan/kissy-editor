/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-29 19:04:14
*/
KISSY.add("editor",function(g,p){function t(j,b){function d(x){for(var u=t.Env.mods,q=0;q<x.length;q++){for(var A=x[q],B=n,C=0;C<q;C++)if(A==x[C]){B=o;break}C=u[A];if(B&&C){B=g.clone(C);A=A+"_"+q;B.name=A;x[q]=A;u[A]||(u[A]=B)}}}var h=this;if(!(h instanceof t))return new t(j,b);if(g.isString(j))j=g.one(j);j=k._4e_wrap(j);b=b||{};b.pluginConfig=b.pluginConfig||{};h.cfg=b;b.pluginConfig=b.pluginConfig;h.cfg=b;g.app(h,g.EventTarget);var s=["htmldataprocessor","enterkey","clipboard"],y=n;h.use=function(x,
u){x=x.split(",");d(x);if(!y)for(var q=0;q<s.length;q++){var A=s[q];g.inArray(A,x)||x.unshift(A)}g.use.call(h,x.join(","),function(){h.ready(function(){u&&u.call(h);if(!y){h.setData(j.val());if(b.focus)h.focus();else{var B=h.getSelection();B&&B.removeAllRanges()}h.fire("save");y=o}})},{order:o,global:t});return h};h.use=h.use;h.init(j);return h}function r(j){var b=g.Config.debug;j=b?b==="dev"?"../src/"+j:j:j.replace(/\.(js|css)/i,"-min.$1");j+=j.indexOf("?")!=-1?"&":"?";j+="t="+encodeURIComponent("2010-11-29 19:04:14");
return j}var k=g.DOM,o=true,n=false;g.app(t,g.EventTarget);t.Config.base=g.Config.base+"editor/";var m=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport",requires:["overlay"]},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localStorage"]},{name:"flash",requires:["fakeobjects"]},
"flash/dialog",{name:"flash/support",requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},
"preview","removeformat","smiley",{name:"smiley/support",requires:["overlay"]},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],l,c,f,e,i={};l=0;for(c=m.length;l<c;l++){f=m[l];if(g.isString(f))f=m[l]={name:f+"",requires:null};e=f.requires||[];var w=["button"];f.name.indexOf("/dialog")!=-1&&w.push("overlay");f.requires=e.concat(w)}m=["ext",
{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button",requires:["ext"]},"dd","progressbar",{name:"overlay",requires:["dd","ext"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(m);l=0;for(c=m.length;l<c;l++){f=m[l];e=f.name;i[e]={attach:n,charset:"utf-8",requires:f.requires,csspath:f.useCss?r("plugins/"+e+"/plugin.css"):p,path:r("plugins/"+e+"/plugin.js")}}t.add(i);g.Editor=t;g.Editor=t});
KISSY.Editor.add("utils",function(g){var p=null,t=KISSY,r=t.Node,k=t.DOM,o=t.UA,n=t.Event,m;m=o.ie?document.documentMode||o.ie:void 0;var l={debugUrl:function(c){var f=t.Config.debug;c=f?f==="dev"?"../src/"+c:c:c.replace(/\.(js|css)/i,"-min.$1");c+=c.indexOf("?")!=-1?"&":"?";c+="t="+encodeURIComponent("2010-11-29 19:04:14");return c},lazyRun:function(c,f,e){var i=c[f],w=c[e];c[f]=function(){i.apply(this,arguments);c[f]=c[e];return w.apply(this,arguments)}},getXY:function(c,f,e,i){e=e.defaultView||
e.parentWindow;c-=k.scrollLeft(e);f-=k.scrollTop(e);if(i)if(e!=(i.defaultView||i.parentWindow)&&e.frameElement){i=k._4e_getOffset(e.frameElement,i);c+=i.left;f+=i.top}return{left:c,top:f}},tryThese:function(){for(var c,f=0,e=arguments.length;f<e;f++){var i=arguments[f];try{c=i();break}catch(w){}}return c},arrayCompare:function(c,f){if(!c&&!f)return true;if(!c||!f||c.length!=f.length)return false;for(var e=0;e<c.length;e++)if(c[e]!==f[e])return false;return true},getByAddress:function(c,f,e){c=c.documentElement;
for(var i=0;c&&i<f.length;i++){var w=f[i];if(e)for(var j=-1,b=0;b<c.childNodes.length;b++){var d=c.childNodes[b];if(!(e===true&&d.nodeType==3&&d.previousSibling&&d.previousSibling.nodeType==3)){j++;if(j==w){c=d;break}}}else c=c.childNodes[w]}return c?new r(c):p},clearAllMarkers:function(c){for(var f in c)c[f]._4e_clearMarkers(c,true)},htmlEncodeAttr:function(c){return c.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(c){return c.replace(/^\s+/,"")},rtrim:function(c){return c.replace(/\s+$/,
"")},trim:function(c){return this.ltrim(this.rtrim(c))},mix:function(){for(var c={},f=0;f<arguments.length;f++)c=t.mix(c,arguments[f]);return c},isCustomDomain:function(){if(!o.ie)return false;var c=document.domain,f=window.location.hostname;return c!=f&&c!="["+f+"]"},duplicateStr:function(c,f){return Array(f+1).join(c)},throttle:function(c,f,e){e=e||150;if(e===-1)return function(){c.apply(f,arguments)};var i=(new Date).getTime();return function(){var w=(new Date).getTime();if(w-i>e){i=w;c.apply(f,
arguments)}}},buffer:function(c,f,e){e=e||0;var i=p;return function(){i&&clearTimeout(i);var w=arguments;i=setTimeout(function(){return c.apply(f,w)},e)}},isNumber:function(c){return/^\d+(.\d+)?$/.test(t.trim(c))},verifyInputs:function(c){for(var f=0;f<c.length;f++){var e=k._4e_wrap(c[f]),i=t.trim(e.val()),w=e.attr("data-verify");e=e.attr("data-warning");if(w&&!RegExp(w).test(i)){alert(e);return false}}return true},sourceDisable:function(c,f){c.on("sourcemode",f.disable,f);c.on("wysiwygmode",f.enable,
f)},resetInput:function(c){var f=c.attr("placeholder");if(f&&!o.webkit){c.addClass("ke-input-tip");c.val(f)}else o.webkit&&c.val("")},valInput:function(c,f){c.removeClass("ke-input-tip");c.val(f)},placeholder:function(c,f){c.attr("placeholder",f);if(!o.webkit){c.on("blur",function(){if(!t.trim(c.val())){c.addClass("ke-input-tip");c.val(f)}});c.on("focus",function(){c.removeClass("ke-input-tip");t.trim(c.val())==f&&c.val("")})}},clean:function(c){c=c[0]||c;for(var f=t.makeArray(c.childNodes),e=0;e<
f.length;e++){var i=f[e];i.nodeType==g.NODE.NODE_TEXT&&!t.trim(i.nodeValue)&&c.removeChild(i)}},htmlEncode:function(c){return!c?c:String(c).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(c){return!c?c:String(c).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(c,f){return c.toLowerCase()==f.toLowerCase()},normParams:function(c){c=t.clone(c);for(var f in c)if(c.hasOwnProperty(f)){var e=
c[f];if(t.isFunction(e))c[f]=e()}return c},doFormUpload:function(c,f,e){function i(){var y={responseText:"",responseXML:p};y.argument=c?c.argument:p;try{var x;if((x=o.ie?j.contentWindow.document:j.contentDocument||window.frames[w].document)&&x.body)y.responseText=x.body.innerHTML;y.responseXML=x&&x.XMLDocument?x.XMLDocument:x}catch(u){t.log(u)}n.remove(j,"load",i);c.callback&&c.callback(y);setTimeout(function(){k._4e_remove(j)},100)}var w=t.guid("form-upload-"),j=document.createElement("iframe");
j.id=w;j.name=w;j.className="ke-hidden";var b="document.open();"+(l.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(o.ie)j.src=o.ie?"javascript:void(function(){"+encodeURIComponent(b)+"}())":"";t.log("doFormUpload : "+j.src);document.body.appendChild(j);if(o.ie)document.frames[w].name=w;b=k._4e_unwrap(c.form);var d={target:b.target,method:b.method,encoding:b.encoding,enctype:b.enctype,action:b.action};b.target=w;b.method="POST";b.enctype=b.encoding="multipart/form-data";
if(e)b.action=e;var h;if(f){h=[];f=g.Utils.normParams(f);for(var s in f)if(f.hasOwnProperty(s)){e=document.createElement("input");e.type="hidden";e.name=s;e.value=f[s];b.appendChild(e);h.push(e)}}n.on(j,"load",i);b.submit();b.target=d.target;b.method=d.method;b.enctype=d.enctype;b.encoding=d.encoding;b.action=d.action;if(h){f=0;for(s=h.length;f<s;f++)k._4e_remove(h[f])}return j},extern:function(c,f){for(var e in f)c[e]=f[e]},map:function(c,f){for(var e=0;e<c.length;e++)c[e]=f(c[e]);return c},ieEngine:m,
preventFocus:function(c){o.ie?c._4e_unselectable():c.attr("onmousedown","return false;")},isFlashEmbed:function(c){c=c.attributes;return c.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(c.src||"")}};g.Utils=l;g.Utils=l;l.extern(l,{debugUrl:l.debugUrl,lazyRun:l.lazyRun,getXY:l.getXY,tryThese:l.tryThese,arrayCompare:l.arrayCompare,getByAddress:l.getByAddress,clearAllMarkers:l.clearAllMarkers,htmlEncodeAttr:l.htmlEncodeAttr,ltrim:l.ltrim,rtrim:l.rtrim,trim:l.trim,mix:l.mix,isCustomDomain:l.isCustomDomain,
duplicateStr:l.duplicateStr,buffer:l.buffer,isNumber:l.isNumber,verifyInputs:l.verifyInputs,sourceDisable:l.sourceDisable,resetInput:l.resetInput,placeholder:l.placeholder,clean:l.clean,htmlEncode:l.htmlEncode,htmlDecode:l.htmlDecode,equalsIgnoreCase:l.equalsIgnoreCase,normParams:l.normParams,throttle:l.throttle,doFormUpload:l.doFormUpload,map:l.map})});
KISSY.Editor.add("dom",function(g){function p(b){return b.replace(/-(\w)/g,function(d,h){return h.toUpperCase()})}var t=KISSY,r=t.DOM,k=t.UA,o=t.Node,n=g.Utils,m={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};g.NODE=g.NODE;g.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};g.POSITION=g.POSITION;var l=g.NODE,c=g.POSITION,f={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},e={hr:1},i=function(b){return b[0]||b},w=function(b){if(b&&!b[0])return new o(b);return b},j={_4e_wrap:w,_4e_unwrap:i,_4e_equals:function(b,d){if(!b&&!d)return true;if(!b||!d)return false;b=i(b);d=i(d);
return b===d},_4e_isBlockBoundary:function(b,d){b=w(b);var h=t.mix(t.mix({},e),d||{});return f[b.css("display")]||h[b._4e_name()]},_4e_getWin:function(b){return b&&"scrollTo"in b&&b.document?b:b&&b.nodeType===9?b.defaultView||b.parentWindow:false},_4e_index:function(b){b=i(b);for(var d=b.parentNode.childNodes,h=0;h<d.length;h++)if(d[h]===b)return h;return-1},_4e_first:function(b,d){b=i(b);var h=b.firstChild;if((h=h&&new o(h))&&d&&!d(h))h=h._4e_next(d);return h},_4e_move:function(b,d,h){b=i(b);r._4e_remove(b);
d=i(d);h?d.insertBefore(b,d.firstChild):d.appendChild(b)},_4e_name:function(b){b=i(b);var d=b.nodeName.toLowerCase();if(k.ie)if((b=b.scopeName)&&b!="HTML")d=b.toLowerCase()+":"+d;return d},_4e_isIdentical:function(b,d){if(b._4e_name()!=d._4e_name())return false;var h=b[0].attributes,s=d[0].attributes,y=h.length,x=s.length;if(y!=x)return false;for(var u=0;u<y;u++){var q=h[u],A=q.name;if(q.specified&&b.attr(A)!=d.attr(A))return false}if(n.ieEngine<8)for(u=0;u<x;u++){q=s[u];A=q.name;if(q.specified&&
b.attr(A)!=d.attr(A))return false}return true},_4e_isEmptyInlineRemoveable:function(b){b=i(b).childNodes;for(var d=0,h=b.length;d<h;d++){var s=b[d],y=s.nodeType;if(!(y==l.NODE_ELEMENT&&s.getAttribute("_ke_bookmark")))if(y==l.NODE_ELEMENT&&!j._4e_isEmptyInlineRemoveable(s)||y==l.NODE_TEXT&&t.trim(s.nodeValue))return false}return true},_4e_moveChildren:function(b,d,h){b=i(b);d=d[0]||d;if(b!=d)if(h)for(;h=b.lastChild;)d.insertBefore(b.removeChild(h),d.firstChild);else for(;h=b.firstChild;)d.appendChild(b.removeChild(h))},
_4e_mergeSiblings:function(){function b(d,h,s){if(h[0]&&h[0].nodeType==l.NODE_ELEMENT){for(var y=[];h.attr("_ke_bookmark")||h._4e_isEmptyInlineRemoveable();){y.push(h);h=s?new o(h[0].nextSibling):new o(h[0].previousSibling);if(!h[0]||h[0].nodeType!=l.NODE_ELEMENT)return}if(d._4e_isIdentical(h)){for(var x=s?d[0].lastChild:d[0].firstChild;y.length;)y.shift()._4e_move(d,!s);h._4e_moveChildren(d,!s);h._4e_remove();x[0]&&x[0].nodeType==l.NODE_ELEMENT&&x._4e_mergeSiblings()}}}return function(d){if(d[0])if(m[d._4e_name()]||
d._4e_name()=="a"){b(d,new o(d[0].nextSibling),true);b(d,new o(d[0].previousSibling))}}}(),_4e_unselectable:k.gecko?function(b){b=i(b);b.style.MozUserSelect="none"}:k.webkit?function(b){b=i(b);b.style.KhtmlUserSelect="none"}:function(b){b=i(b);if(k.ie||k.opera){var d=0;b.unselectable="on";for(var h=b.getElementsByTagName("*");b=h[d++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},_4e_getOffset:function(b,d){b=i(b);var h,
s=0;h=0;var y=b.ownerDocument.defaultView||b.ownerDocument.parentWindow,x=b.ownerDocument,u=x.documentElement;d=d||x;if(b.getBoundingClientRect){if(b!==x.body&&u!==b){h=b.getBoundingClientRect();s=h.left+(d===x?r.scrollLeft(y):0);h=h.top+(d===x?r.scrollTop(y):0)}if(d)if(y!=(d.defaultView||d.parentWindow)&&y.frameElement){y=j._4e_getOffset(y.frameElement,d);s+=y.left;h+=y.top}}return{left:s,top:h}},_4e_getFrameDocument:function(b){return(b=i(b))&&b.contentWindow.document},_4e_splitText:function(b,
d){b=i(b);var h=b.ownerDocument;if(!(!b||b.nodeType!=l.NODE_TEXT)){if(k.ie&&d==b.nodeValue.length){var s=h.createTextNode("");r.insertAfter(s,b);return new o(s)}s=new o(b.splitText(d));if(h.documentMode){h=h.createTextNode("");r.insertAfter(h,s[0]);r._4e_remove(h)}return s}},_4e_parents:function(b,d){b=w(b);var h=[];do h[d?"push":"unshift"](b);while(b=b.parent());return h},_4e_clone:function(b,d,h){b=i(b);b=b.cloneNode(d);if(!h){var s=function(y){if(y.nodeType==l.NODE_ELEMENT){y.removeAttribute("id");
y=y.childNodes;for(var x=0;x<y.length;x++)s(y[x])}};s(b)}return new o(b)},_4e_nextSourceNode:function(b,d,h,s){b=i(b);if(s&&!s.call){var y=s[0]||s;s=function(u){u=u[0]||u;return u!==y}}d=!d&&b.firstChild;var x=new o(b);if(!d){if(b.nodeType==l.NODE_ELEMENT&&s&&s(b,true)===false)return null;d=b.nextSibling}for(;!d&&(x=x.parent());){if(s&&s(x,true)===false)return null;d=x[0].nextSibling}if(!d)return null;d=r._4e_wrap(d);if(s&&s(d)===false)return null;if(h&&h!=d[0].nodeType)return d._4e_nextSourceNode(false,
h,s);return d},_4e_previousSourceNode:function(b,d,h,s){b=i(b);if(s&&!s.call){var y=s[0]||s;s=function(u){u=u[0]||u;return u!==y}}d=!d&&b.lastChild;var x=new o(b);if(!d){if(b.nodeType==l.NODE_ELEMENT&&s&&s(b,true)===false)return null;d=b.previousSibling}for(;!d&&(x=x.parent());){if(s&&s(x,true)===false)return null;d=x[0].previousSibling}if(!d)return null;d=r._4e_wrap(d);if(s&&s(d)===false)return null;if(h&&d[0].nodeType!=h)return d._4e_previousSourceNode(false,h,s);return d},_4e_commonAncestor:function(b,
d){if(b._4e_equals(d))return b;if(d[0].nodeType!=l.NODE_TEXT&&d.contains(b))return d;var h=b[0].nodeType==l.NODE_TEXT?b.parent():b;do if(h[0].nodeType!=l.NODE_TEXT&&h.contains(d))return h;while(h=h.parent());return null},_4e_ascendant:function(b,d,h){b=i(b);if(!h)b=b.parentNode;if(d&&!t.isFunction(d)){var s=d;d=function(y){return y._4e_name()==s}}for(;b&&b.nodeType!=9;){if(!d||d(new o(b))===true)return new o(b);b=b.parentNode}return null},_4e_hasAttribute:n.ieEngine<9?function(b,d){b=i(b);var h=b.attributes[d];
return!!(h&&h.specified)}:function(b,d){b=i(b);return b.hasAttribute(d)},_4e_hasAttributes:n.ieEngine<9?function(b){b=i(b);for(var d=b.attributes,h=0;h<d.length;h++){var s=d[h];switch(s.name){case "class":if(b.getAttribute("class"))return true;break;default:if(s.specified)return true}}return false}:function(b){b=i(b);k.gecko&&b.removeAttribute("_moz_dirty");return b.hasAttributes()},_4e_position:function(b,d){var h=i(b),s=i(d);if(h.compareDocumentPosition)return h.compareDocumentPosition(s);if(h==
s)return c.POSITION_IDENTICAL;if(h.nodeType==l.NODE_ELEMENT&&s.nodeType==l.NODE_ELEMENT){if(h.contains){if(h.contains(s))return c.POSITION_CONTAINS+c.POSITION_PRECEDING;if(s.contains(h))return c.POSITION_IS_CONTAINED+c.POSITION_FOLLOWING}if("sourceIndex"in h)return h.sourceIndex<0||s.sourceIndex<0?c.POSITION_DISCONNECTED:h.sourceIndex<s.sourceIndex?c.POSITION_PRECEDING:c.POSITION_FOLLOWING}h=b._4e_address();s=d._4e_address();for(var y=Math.min(h.length,s.length),x=0;x<=y-1;x++)if(h[x]!=s[x]){if(x<
y)return h[x]<s[x]?c.POSITION_PRECEDING:c.POSITION_FOLLOWING;break}return h.length<s.length?c.POSITION_CONTAINS+c.POSITION_PRECEDING:c.POSITION_IS_CONTAINED+c.POSITION_FOLLOWING},_4e_address:function(b,d){b=i(b);for(var h=[],s=b.ownerDocument.documentElement,y=b;y&&y!=s;){var x=y.parentNode,u=-1;if(x){for(var q=0;q<x.childNodes.length;q++){var A=x.childNodes[q];if(!(d&&A.nodeType==3&&A.previousSibling&&A.previousSibling.nodeType==3)){u++;if(A==y)break}}h.unshift(u)}y=x}return h},_4e_breakParent:function(b,
d){var h=new g.Range(b[0].ownerDocument);h.setStartAfter(b);h.setEndAfter(d);var s=h.extractContents();h.insertNode(b._4e_remove());b[0].parentNode.insertBefore(s,b[0].nextSibling)},_4e_style:function(b,d,h){b=w(b);if(h!==undefined)return b.css(d,h);b=i(b);return b.style[p(d)]},_4e_remove:function(b,d){var h=i(b),s=h.parentNode;if(s){if(d)for(var y;y=h.firstChild;)s.insertBefore(h.removeChild(y),h);s.removeChild(h)}return b},_4e_trim:function(b){r._4e_ltrim(b);r._4e_rtrim(b)},_4e_ltrim:function(b){b=
i(b);for(var d;d=b.firstChild;){if(d.nodeType==l.NODE_TEXT){var h=n.ltrim(d.nodeValue),s=d.nodeValue.length;if(h){if(h.length<s){(new o(d))._4e_splitText(s-h.length);b.removeChild(b.firstChild)}}else{b.removeChild(d);continue}}break}},_4e_rtrim:function(b){b=i(b);for(var d;d=b.lastChild;){if(d.type==l.NODE_TEXT){var h=n.rtrim(d.nodeValue),s=d.nodeValue.length;if(h){if(h.length<s){(new o(d))._4e_splitText(h.length);b.removeChild(b.lastChild)}}else{b.removeChild(d);continue}}break}if(!k.ie&&!k.opera)(d=
b.lastChild)&&d.nodeType==1&&d.nodeName.toLowerCase()=="br"&&d.parentNode.removeChild(d)},_4e_appendBogus:function(b){b=i(b);for(var d=b.lastChild;d&&d.nodeType==l.NODE_TEXT&&!t.trim(d.nodeValue);)d=d.previousSibling;if(!d||d.nodeType==l.NODE_TEXT||r._4e_name(d)!=="br"){d=k.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br");k.gecko&&d.setAttribute("type","_moz");b.appendChild(d)}},_4e_previous:function(b,d){var h=i(b),s;do s=(h=h.previousSibling)&&new o(h);while(s&&d&&!d(s));
return s},_4e_last:function(b,d){b=r._4e_wrap(b);var h=b[0].lastChild;if((h=h&&new o(h))&&d&&!d(h))h=h._4e_previous(d);return h},_4e_next:function(b,d){var h=i(b),s;do s=(h=h.nextSibling)&&new o(h);while(s&&d&&!d(s));return s},_4e_outerHtml:function(b){b=i(b);if(b.outerHTML)return b.outerHTML.replace(/<\?[^>]*>/,"");var d=b.ownerDocument.createElement("div");d.appendChild(b.cloneNode(true));return d.innerHTML},_4e_setMarker:function(b,d,h,s){b=r._4e_wrap(b);var y=b.data("list_marker_id")||b.data("list_marker_id",
t.guid()).data("list_marker_id"),x=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");d[y]=b;x[h]=1;return b.data(h,s)},_4e_clearMarkers:function(b,d,h){b=w(b);var s=b.data("list_marker_names"),y=b.data("list_marker_id"),x;for(x in s)b.removeData(x);b.removeData("list_marker_names");if(h){b.removeData("list_marker_id");delete d[y]}},_4e_copyAttributes:function(b,d,h){b=i(b);d=w(d);var s=b.attributes;h=h||{};for(var y=0;y<s.length;y++){var x=s[y],u=x.name.toLowerCase(),
q;if(!(u in h))if(u=="checked"&&(q=r.attr(b,u)))d.attr(u,q);else if(x.specified||k.ie&&x.value&&u=="value"){q=r.attr(b,u);if(q===null)q=x.nodeValue;d.attr(u,q)}}if(b.style.cssText!=="")d[0].style.cssText=b.style.cssText},_4e_isEditable:function(b){b=r._4e_name(b);var d=g.XHTML_DTD;return(b=!d.$nonEditable[b]&&(d[b]||d.span))&&b["#"]},_4e_scrollIntoView:function(b){b=w(b);var d=b[0].ownerDocument,h=r.scrollLeft(d),s=r.scrollTop(d),y=b.offset(),x=y.left;y=y.top;if(r.viewportHeight(d)+s<y||y<s||r.viewportWidth(d)+
h<x||x<h)b.scrollIntoView(d)},_4e_getElementsByTagName:function(b,d,h){b=i(b);if(!k.ie&&h)d=h+":"+d;h=[];b=b.getElementsByTagName(d);for(d=0;d<b.length;d++)h.push(new o(b[d]));return h}};t.DOM._4e_inject=function(b){t.mix(r,b);for(var d in b)b.hasOwnProperty(d)&&function(h){o.prototype[h]=function(){var s=[].slice.call(arguments,0);s.unshift(this);return b[h].apply(null,s)}}(d)};n.extern(j,{_4e_wrap:j._4e_wrap,_4e_unwrap:j._4e_unwrap,_4e_equals:j._4e_equals,_4e_isBlockBoundary:j._4e_isBlockBoundary,
_4e_getWin:j._4e_getWin,_4e_index:j._4e_index,_4e_first:j._4e_first,_4e_move:j._4e_move,_4e_name:j._4e_name,_4e_isIdentical:j._4e_isIdentical,_4e_isEmptyInlineRemoveable:j._4e_isEmptyInlineRemoveable,_4e_moveChildren:j._4e_moveChildren,_4e_mergeSiblings:j._4e_mergeSiblings,_4e_unselectable:j._4e_unselectable,_4e_getOffset:j._4e_getOffset,_4e_getFrameDocument:j._4e_getFrameDocument,_4e_splitText:j._4e_splitText,_4e_parents:j._4e_parents,_4e_clone:j._4e_clone,_4e_nextSourceNode:j._4e_nextSourceNode,
_4e_previousSourceNode:j._4e_previousSourceNode,_4e_commonAncestor:j._4e_commonAncestor,_4e_ascendant:j._4e_ascendant,_4e_hasAttribute:j._4e_hasAttribute,_4e_hasAttributes:j._4e_hasAttributes,_4e_position:j._4e_position,_4e_address:j._4e_address,_4e_breakParent:j._4e_breakParent,_4e_style:j._4e_style,_4e_remove:j._4e_remove,_4e_trim:j._4e_trim,_4e_ltrim:j._4e_ltrim,_4e_rtrim:j._4e_rtrim,_4e_appendBogus:j._4e_appendBogus,_4e_last:j._4e_last,_4e_previous:j._4e_previous,_4e_next:j._4e_next,_4e_outerHtml:j._4e_outerHtml,
_4e_setMarker:j._4e_setMarker,_4e_clearMarkers:j._4e_clearMarkers,_4e_getUniqueId:j._4e_getUniqueId,_4e_copyAttributes:j._4e_copyAttributes,_4e_isEditable:j._4e_isEditable,_4e_scrollIntoView:j._4e_scrollIntoView,_4e_getElementsByTagName:j._4e_getElementsByTagName});r._4e_inject(j)});
KISSY.Editor.add("focusmanager",function(g){function p(){this.iframeFocus=c;m=this;r.log(this._UUID+" focus")}function t(){this.iframeFocus=f;m=e;r.log(this._UUID+" blur")}var r=KISSY,k=r.DOM,o=r.Event,n={},m,l={refreshAll:function(){for(var i in n){var w=n[i];w.document.designMode="off";w.document.designMode="on"}},currentInstance:function(){return m},getInstance:function(i){return n[i]},add:function(i){var w=k._4e_getWin(i.document);o.on(w,"focus",p,i);o.on(w,"blur",t,i)},register:function(i){n[i._UUID]=
i},remove:function(i){delete n[i._UUID];var w=k._4e_getWin(i.document);o.remove(w,"focus",p,i);o.remove(w,"blur",t,i)}},c=true,f=false,e=null;g.focusManager=l;g.focusManager=l;g.getInstances=function(){return n};g.getInstances=g.getInstances});
KISSY.Editor.add("definition",function(g){var p=true,t=false,r=g.Utils,k=document,o=KISSY,n=o.UA,m=o.DOM,l=o.Node,c=o.Event,f=g.focusManager,e=r.tryThese,i=r.debugUrl("theme/editor-iframe.css"),w=1,j="document.open();"+(r.isCustomDomain()?'document.domain="'+k.domain+'";':"")+"document.close();",b="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(n.ie?"javascript:void(function(){"+encodeURIComponent(j)+"}())":"")+'"  tabIndex="'+(n.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";g.SOURCE_MODE=0;g.WYSIWYG_MODE=1;g.SOURCE_MODE=g.SOURCE_MODE;g.WYSIWYG_MODE=g.WYSIWYG_MODE;o.augment(g,{init:function(d){if(n.ie)m.addClass(k.body,"ie"+n.ie);else if(n.gecko)m.addClass(k.body,"gecko");else n.webkit&&m.addClass(k.body,"webkit");var h=this,s=new l(b.replace(/\$\(tabIndex\)/,
d.attr("tabIndex")));h.editorWrap=s;h._UUID=w++;f.register(h);h.wrap=s.one(".ke-textarea-wrap");h.wrap=h.wrap;h.iframe=h.wrap.one("iframe");h.iframe=h.iframe;h.toolBarDiv=s.one(".ke-editor-tools");h.toolBarDiv=h.toolBarDiv;h.textarea=d;h.textarea=h.textarea;h.statusDiv=s.one(".ke-editor-status");h.statusDiv=h.statusDiv;r.preventFocus(h.toolBarDiv);h._commands={};h._dialogs={};var y=d._4e_style("width"),x=d._4e_style("height");if(y){s.css("width",y);d.css("width","100%")}h.textarea.css("display","none");
s.insertAfter(d);h.wrap[0].appendChild(d[0]);if(x){h.wrap.css("height",x);d.css("height","100%")}s=h.iframe;h.on("dataReady",function(){h._ready=p;g.fire("instanceCreated",{editor:h})});n.gecko?s.on("load",h._setUpIFrame,h):h._setUpIFrame();h.cfg.attachForm&&d[0].form&&h._attachForm()},_attachForm:function(){(new l(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(d,h){var s=this,y=g.Overlay;y.loading();s.use(d,function(){var x=s.getDialog(d);if(x){h(x);y.unloading()}else o.later(arguments.callee,
50,false,s)})},addDialog:function(d,h){this._dialogs[d]=h},getDialog:function(d){return this._dialogs[d]},addCommand:function(d,h){this._commands[d]=h},hasCommand:function(d){return this._commands[d]},execCommand:function(d){var h=this._commands[d],s=o.makeArray(arguments);s.shift();s.unshift(this);return h.exec.apply(h,s)},getMode:function(){return this.textarea.css("display")=="none"?g.WYSIWYG_MODE:g.SOURCE_MODE},getData:function(d){var h;h=this.getMode()==g.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)h=d?this.htmlDataProcessor.toHtml(h,"p"):this.htmlDataProcessor.toServer(h,"p");h=o.trim(h);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(h))h="";return h},setData:function(d){var h=d;if(this.htmlDataProcessor)h=this.htmlDataProcessor.toDataFormat(d,"p");this.document.body.innerHTML=h;this.getMode()!=g.WYSIWYG_MODE&&this.textarea.val(d)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(d){d=d||0;return d+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(d){this.document.body.innerHTML=d},_prepareIFrameHtml:function(d){var h=this.cfg,s=h.customLink,y="";if(s)for(var x=0;x<s.length;x++)y+='<link href="'+s[x]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+g.Config.base+i+"' rel='stylesheet'/><style>"+(h.customStyle||"")+"</style>"+y+"</head><body class='ke-editor'>&nbsp;"+(d?'<script id="ke_actscript" type="text/javascript">'+(r.isCustomDomain()?'document.domain="'+k.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+d+'");<\/script>':"")+"</body></html>"},getSelection:function(){return g.Selection.getSelection(this.document)},focus:function(){var d=this.document,h=m._4e_getWin(d);n.webkit&&h&&h.parent&&h.parent.focus();h&&h.focus();d&&d.body.focus();this.notifySelectionChange()},blur:function(){m._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(d){var h=this.cfg,s=this.document;h.customStyle=h.customStyle||"";h.customStyle+=
"\n"+d;h=s.createElement("style");s.getElementsByTagName("head")[0].appendChild(h);if(h.styleSheet)h.styleSheet.cssText=d;else h.appendChild(s.createTextNode(d))},addCustomLink:function(d){var h=this.cfg,s=this.document;h.customLink=h.customLink||[];h.customLink.push(d);h=s.createElement("link");h.rel="stylesheet";s.getElementsByTagName("head")[0].appendChild(h);h.href=d},removeCustomLink:function(d){for(var h=this.cfg,s=o.makeArray(this.document.getElementsByTagName("link")),y=0;y<s.length;y++)s[y].href==
d&&m._4e_remove(s[y]);h.customLink=h.customLink||[];h=h.customLink;d=o.indexOf(d,h);d!=-1&&h.splice(d,1)},_setUpIFrame:function(){function d(){u=x.document;h.document=u;s.detach();u.open("text/html","replace");u.write(y);u.close()}var h=this,s=h.iframe,y=h._prepareIFrameHtml(h._UUID),x=s[0].contentWindow,u;try{u=x.document}catch(q){s[0].src=s[0].src;if(n.ie<7){setTimeout(d,10);return}}d()},ready:function(d){this._ready?d():this.on("dataReady",d)},_monitor:function(){var d=this;d._monitorId&&clearTimeout(d._monitorId);
d._monitorId=setTimeout(function(){var h=d.getSelection();if(h&&!h.isInvalid){var s=h.getStartElement(),y=new g.ElementPath(s);if(!d.previousPath||!d.previousPath.compare(y)){d.previousPath=y;d.fire("selectionChange",{selection:h,path:y,element:s})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(d,h){var s=this;s.focus();var y=d._4e_name(),x=g.XHTML_DTD,u=g.RANGE,q=g.NODE,A=x.$block[y],B=s.getSelection(),C=B&&B.getRanges(),v,z,E,F,D;if(!C||
C.length==0){var G=arguments,M=G.callee;setTimeout(function(){M.apply(s,G)},30)}else{s.fire("save");for(var N=C.length-1;N>=0;N--){v=C[N];v.deleteContents();z=!N&&d||d._4e_clone(p);h&&h(z);if(A)for(;(F=v.getCommonAncestor(t,p))&&(D=x[F._4e_name()])&&!(D&&D[y]);)if(F._4e_name()in x.span)v.splitElement(F);else if(v.checkStartOfBlock()&&v.checkEndOfBlock()){v.setStartBefore(F);v.collapse(p);F._4e_remove()}else v.splitBlock();v.insertNode(z);E||(E=z)}if(E){y=E._4e_nextSourceNode(p);x=s.document;D=g.XHTML_DTD;
if(D.$inline[z._4e_name()]){y=new l(x.createTextNode(" "));y.insertAfter(E)}else if(y){if(y._4e_name()=="br"&&D[y.parent()._4e_name()].p){D=new l("<p>&nbsp;</p>",null,x);y[0].parentNode.replaceChild(D[0],y[0]);y=D}}else{D=new l("<p>&nbsp;</p>",null,x);D.insertAfter(E);y=D}v.moveToPosition(E,u.POSITION_AFTER_END);y&&y[0].nodeType==q.NODE_ELEMENT&&v.moveToElementEditablePosition(y);B.selectRanges([v]);s.focus();z&&z._4e_scrollIntoView();setTimeout(function(){s.fire("save")},10);return z}}},insertHtml:function(d){var h=
this;if(h.htmlDataProcessor)d=h.htmlDataProcessor.toDataFormat(d);if(n.webkit){var s=m.create(d,null,this.document);s=s.nodeType==11?o.makeArray(s.childNodes):[s];for(var y=0;y<s.length;y++)h.insertElement(new l(s[y]))}else{h.focus();y=(s=h.getSelection())&&s.getRanges();if(!y||y.length==0){var x=arguments,u=x.callee;setTimeout(function(){u.apply(h,x)},30)}else{h.fire("save");if(n.ie){s=s.getNative();s.type=="Control"&&s.clear();s.createRange().pasteHTML(d)}else h.document.execCommand("inserthtml",
t,d);h.focus();setTimeout(function(){h.fire("save")},10)}}}});g._initIFrame=function(d){function h(z){e(function(){x.designMode="on";setTimeout(function(){x.designMode="off";A.focus();if(!arguments.callee.retry)arguments.callee.retry=p},50)},function(){x.designMode="off";m.attr(A,"contentEditable",t);m.attr(A,"contentEditable",p);!z&&h(1)})}var s=f.getInstance(d);d=s.textarea[0];var y=s.iframe[0].contentWindow,x=s.document,u=s.cfg,q=x.getElementById("ke_actscript");m._4e_remove(q);var A=x.body;if(n.ie){A.hideFocus=
p;A.disabled=p;A.contentEditable=p;A.removeAttribute("disabled")}else setTimeout(function(){if(n.gecko||n.opera)A.contentEditable=p;else if(n.webkit)A.parentNode.contentEditable=p;else x.designMode="on"},0);if(n.webkit){c.on(x,"click",function(z){var E=new l(z.target);o.inArray(E._4e_name(),["input","select"])&&z.preventDefault()});c.on(x,"mouseup",function(z){var E=new l(z.target);o.inArray(E._4e_name(),["input","textarea"])&&z.preventDefault()})}if(n.gecko||n.ie||n.opera){var B;B=new l(m.insertAfter((new l('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
d));B.on("focus",function(){s.focus()});s.activateGecko=function(){n.gecko&&s.iframeFocus&&B[0].focus()};s.on("destroy",function(){})}if(n.ie&&x.compatMode=="CSS1Compat"||n.gecko||n.opera){var C=new l(x.documentElement);C.on("mousedown",function(z){if(z.target==C[0]){n.gecko&&h(t);B[0].focus()}})}c.on(y,"focus",function(){if(n.gecko)h(t);else n.opera&&A.focus();s.notifySelectionChange()});n.gecko&&c.on(s.document,"mousedown",function(){s.iframeFocus||h(t)});if(n.ie){c.on(x,"keydown",function(z){if(z.keyCode in
{8:1,46:1}){var E=s.getSelection(),F=E.getSelectedElement();if(F){s.fire("save");var D=E.getRanges()[0].createBookmark();F._4e_remove();E.selectBookmarks([D]);s.fire("save");z.preventDefault()}}});if(x.compatMode=="CSS1Compat"){var v={33:1,34:1};c.on(x,"keydown",function(z){z.keyCode in v&&setTimeout(function(){s.getSelection().scrollIntoView()},0)})}}setTimeout(function(){n.ie&&setTimeout(function(){if(x){A.runtimeStyle.marginBottom="0px";A.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){s.fire("dataReady");
var z=u.disableObjectResizing,E=u.disableInlineTableEditing;if(z||E)try{x.execCommand("enableObjectResizing",t,!z);x.execCommand("enableInlineTableEditing",t,!E)}catch(F){c.on(A,n.ie?"resizestart":"resize",function(D){if(z||m._4e_name(D.target)==="table"&&E)D.preventDefault()})}},10);n.webkit&&c.on(x,"mousedown",function(z){z=new l(z.target);o.inArray(z._4e_name(),["img","hr","input","textarea","select"])&&s.getSelection().selectElement(z)});n.gecko&&c.on(x,"dragstart",function(z){var E=new l(z.target);
E._4e_name()==="img"&&/ke_/.test(E[0].className)&&z.preventDefault()});f.add(s)};j=g.prototype;r.extern(j,{setData:j.setData,getData:j.getData,insertElement:j.insertElement,insertHtml:j.insertHtml,ready:j.ready,addCustomStyle:j.addCustomStyle,addCommand:j.addCommand,hasCommand:j.hasCommand,execCommand:j.execCommand,useDialog:j.useDialog,addDialog:j.addDialog,getDialog:j.getDialog,getMode:j.getMode,sync:j.sync,baseZIndex:j.baseZIndex,getSelection:j.getSelection,focus:j.focus,blur:j.blur,notifySelectionChange:j.notifySelectionChange})});
KISSY.Editor.add("zindex",function(){var g=KISSY.Editor;if(!g.zIndexManager){g.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};g.baseZIndex=function(p){var t=p,r=g.getInstances(),k;for(k in r){if(!r.hasOwnProperty(k))return;t=Math.max(t,r[k].baseZIndex(p))}return t};g.baseZIndex=g.baseZIndex;g.zIndexManager=g.zIndexManager}});
KISSY.Editor.add("dtd",function(g){g.XHTML_DTD=function(){function p(u){for(var q=arguments.length-1;q>0;)KISSY.mix(u,arguments[q--]);return u}var t={isindex:1,fieldset:1},r={input:1,button:1,select:1,textarea:1,label:1},k=p({a:1},r),o=p({iframe:1},k),n={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},m={ins:1,del:1,script:1,style:1},l=p({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},m),c=p({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},l),f=p({p:1},c);r=p({iframe:1},c,r);c={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=p({a:1},r),i={tr:1},w={"#":1},j=p({param:1},c),b=p({form:1},t,o,n,f),d={li:1},h={base:1,link:1,meta:1,title:1},s=p(h,{style:1,script:1}),y={head:1,body:1},x={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:p({html:1},y,h),$block:x,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:e,$body:p({script:1,style:1},x),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:y,head:s,style:w,body:b,base:{},link:{},meta:{},title:w,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:b,td:b,br:{},th:b,center:b,kbd:e,button:p(f,n),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:d,h1:e,h3:e,option:w,h2:e,form:p(t,o,n,f),select:{optgroup:1,option:1},font:e,ins:e,menu:d,abbr:e,label:e,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:w,tfoot:i,cite:e,li:b,input:{},iframe:b,strong:e,textarea:w,noframes:b,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:b,object:j,sup:e,dd:b,strike:e,area:{},dir:d,map:p({area:1,form:1,p:1},t,m,n),applet:j,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:p({legend:1},c),thead:i,ul:d,acronym:e,b:e,a:r,blockquote:b,caption:e,i:e,u:e,tbody:i,s:e,address:p(o,f),tt:e,legend:e,q:e,pre:p(l,k),p:e,em:e,dfn:e}}();g.XHTML_DTD=
g.XHTML_DTD});
KISSY.Editor.add("elementpath",function(g){function p(c){var f=o,e=o,i=[];for(c=c;c&&c[0];){if(c[0].nodeType==k.NODE_ELEMENT){if(!this.lastElement)this.lastElement=c;var w=c._4e_name();if(!e){if(!f&&n[w])f=c;if(m[w]){var j;if(j=!f){if(j=w=="div"){a:{j=c;j=j[0]||j;j=j.childNodes;for(var b=0,d=j.length;b<d;b++){var h=j[b];if(h.nodeType==k.NODE_ELEMENT&&r.$block[h.nodeName.toLowerCase()]){j=true;break a}}j=false}j=!j}j=j}if(j)f=c;else e=c}}i.push(c);if(w=="body")break}c=c.parent()}this.block=this.block=
f;this.blockLimit=this.blockLimit=e;this.elements=this.elements=i}var t=KISSY.DOM,r=g.XHTML_DTD,k=g.NODE,o=null,n={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},m={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};p.prototype={compare:function(c){var f=this.elements;c=c&&c.elements;if(!c||f.length!=c.length)return false;for(var e=0;e<f.length;e++)if(!t._4e_equals(f[e],c[e]))return false;return true},contains:function(c){for(var f=this.elements,e=0;e<
f.length;e++)if(f[e]._4e_name()in c)return f[e];return o}};g.ElementPath=g.ElementPath=p;var l=p.prototype;g.Utils.extern(l,{compare:l.compare,contains:l.contains})});
KISSY.Editor.add("walker",function(g){function p(i,w){if(this._.end)return n;var j,b=this.range,d,h=this.guard,s=this.type,y=i?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;b.trim();if(b.collapsed){this.end();return n}}if(!i&&!this._.guardLTR){var x=b.endContainer,u=new f(x[0].childNodes[b.endOffset]);this._.guardLTR=function(C,v){return(C=c._4e_wrap(C))&&C[0]&&(!v||!c._4e_equals(x,C))&&(!u[0]||!C._4e_equals(u))&&(C[0].nodeType!=l.NODE_ELEMENT||!v||C._4e_name()!="body")}}if(i&&
!this._.guardRTL){var q=b.startContainer,A=b.startOffset>0&&new f(q[0].childNodes[b.startOffset-1]);this._.guardRTL=function(C,v){return(C=c._4e_wrap(C))&&C[0]&&(!v||!C._4e_equals(q))&&(!A[0]||!C._4e_equals(A))&&(C[0].nodeType!=l.NODE_ELEMENT||!v||C._4e_name()!="body")}}var B=i?this._.guardRTL:this._.guardLTR;d=h?function(C,v){if(B(C,v)===o)return o;return h(C,v)}:B;if(this.current)j=this.current[y](o,s,d);else if(i){j=b.endContainer;if(b.endOffset>0){j=new f(j[0].childNodes[b.endOffset-1]);if(d(j)===
o)j=n}else j=d(j,k)===o?n:j._4e_previousSourceNode(k,s,d)}else{j=b.startContainer;if((j=new f(j[0].childNodes[b.startOffset]))&&j[0]){if(d(j)===o)j=n}else j=d(b.startContainer,k)===o?n:b.startContainer._4e_nextSourceNode(k,s,d)}for(;j&&j[0]&&!this._.end;){this.current=j;if(!this.evaluator||this.evaluator(j)!==o){if(!w)return j}else if(w&&this.evaluator)return o;j=j[y](o,s,d)}this.end();return this.current=n}function t(i){for(var w,j=n;w=p.call(this,i);)j=w;return j}function r(i){this.range=i;this._=
{}}var k=true,o=false,n=null,m=KISSY,l=g.NODE,c=m.DOM,f=m.Node;m.augment(r,{end:function(){this._.end=1},next:function(){return p.call(this)},previous:function(){return p.call(this,k)},checkForward:function(){return p.call(this,o,k)!==o},checkBackward:function(){return p.call(this,k,k)!==o},lastForward:function(){return t.call(this)},lastBackward:function(){return t.call(this,k)},reset:function(){delete this.current;this._={}}});r.blockBoundary=function(i){return function(w){w=c._4e_wrap(w);return!(w&&
w[0].nodeType==l.NODE_ELEMENT&&w._4e_isBlockBoundary(i))}};r.listItemBoundary=function(){return this.blockBoundary({br:1})};r.bookmark=function(i,w){function j(b){return b&&b[0]&&b._4e_name()=="span"&&b.attr("_ke_bookmark")}return function(b){var d,h;d=b&&b[0]&&b[0].nodeType==l.NODE_TEXT&&(h=b.parent())&&j(h);d=i?d:d||j(b);return w^d}};r.whitespaces=function(i){return function(w){w=(w=w[0]||w)&&w.nodeType==l.NODE_TEXT&&!m.trim(w.nodeValue);return i^w}};r.invisible=function(i){var w=r.whitespaces();
return function(j){j=w(j)||j[0].nodeType==l.NODE_ELEMENT&&!j[0].offsetHeight;return i^j}};g.Walker=r;g.Walker=r;var e=r.prototype;g.Utils.extern(e,{end:e.end,next:e.next,previous:e.previous,checkForward:e.checkForward,checkBackward:e.checkBackward,lastForward:e.lastForward,lastBackward:e.lastBackward,reset:e.reset});g.Utils.extern(r,{blockBoundary:r.blockBoundary,listItemBoundary:r.listItemBoundary,bookmark:r.bookmark,whitespaces:r.whitespaces,invisible:r.invisible})});
KISSY.Editor.add("range",function(g){function p(v){this.endOffset=this.endContainer=this.startOffset=this.startContainer=c;this.collapsed=m;this.document=v}function t(v){var z=v[0].nodeType!=e.NODE_TEXT&&v._4e_name()in s.$removeEmpty,E=!f.trim(v[0].nodeValue);v=!!v.parent().attr("_ke_bookmark");return z||E||v}function r(v){return!A(v)&&!B(v)}function k(v){var z=l,E=j.bookmark(m);return function(F){if(E(F))return m;if(F[0].nodeType==e.NODE_TEXT){if(f.trim(F[0].nodeValue).length)return l}else if(F[0].nodeType==
e.NODE_ELEMENT)if(!q[F._4e_name()])if(!v&&!h.ie&&F._4e_name()=="br"&&!z)z=m;else return l;return m}}function o(v,z){function E(F){return F&&F.nodeName=="span"&&F.getAttribute("_ke_bookmark")}return function(F){var D,G;D=F&&!F.nodeName&&(G=F.parentNode)&&E(G);D=v?D:D||E(F);return z^D}}function n(v){return function(z){z=(z=z[0]||z)&&z.nodeType==e.NODE_TEXT&&!f.trim(z.nodeValue);return v^z}}g.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};g.RANGE=g.RANGE;var m=true,l=false,c=null,f=KISSY,e=g.NODE,i=g.RANGE,w=g.POSITION,j=g.Walker,b=f.DOM,d=g.Utils.getByAddress,h=f.UA,s=g.XHTML_DTD,y=g.ElementPath,x=f.Node,u={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};p.prototype.toString=function(){var v=[];v.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);v.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return v.join("<br/>")};f.augment(p,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&b._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var v=this.startContainer,z=this.startOffset;if(v[0].nodeType!=e.NODE_ELEMENT)if(z)z>=v[0].nodeValue.length&&this.setStartAfter(v);else this.setStartBefore(v);v=this.endContainer;z=this.endOffset;if(v[0].nodeType!=e.NODE_ELEMENT)if(z)z>=
v[0].nodeValue.length&&this.setEndAfter(v);else this.setEndBefore(v)},setStartAfter:function(v){this.setStart(v.parent(),v._4e_index()+1)},setStartBefore:function(v){this.setStart(v.parent(),v._4e_index())},setEndAfter:function(v){this.setEnd(v.parent(),v._4e_index()+1)},setEndBefore:function(v){this.setEnd(v.parent(),v._4e_index())},optimizeBookmark:function(){var v=this.startContainer,z=this.endContainer;v&&v._4e_name()=="span"&&v.attr("_ke_bookmark")&&this.setStartAt(v,i.POSITION_BEFORE_START);
z&&z._4e_name()=="span"&&z.attr("_ke_bookmark")&&this.setEndAt(z,i.POSITION_AFTER_END)},setStart:function(v,z){if(v[0].nodeType==e.NODE_ELEMENT&&u[v._4e_name()]){v=v.parent();z=v._4e_index()}this.startContainer=v;this.startOffset=z;if(!this.endContainer){this.endContainer=v;this.endOffset=z}this.updateCollapsed()},setEnd:function(v,z){if(v[0].nodeType==e.NODE_ELEMENT&&u[v._4e_name()]){v=v.parent();z=v._4e_index()+1}this.endContainer=v;this.endOffset=z;if(!this.startContainer){this.startContainer=
v;this.startOffset=z}this.updateCollapsed()},setStartAt:function(v,z){switch(z){case i.POSITION_AFTER_START:this.setStart(v,0);break;case i.POSITION_BEFORE_END:v[0].nodeType==e.NODE_TEXT?this.setStart(v,v[0].nodeValue.length):this.setStart(v,v[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setStartBefore(v);break;case i.POSITION_AFTER_END:this.setStartAfter(v)}this.updateCollapsed()},setEndAt:function(v,z){switch(z){case i.POSITION_AFTER_START:this.setEnd(v,0);break;case i.POSITION_BEFORE_END:v[0].nodeType==
e.NODE_TEXT?this.setEnd(v,v[0].nodeValue.length):this.setEnd(v,v[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setEndBefore(v);break;case i.POSITION_AFTER_END:this.setEndAfter(v)}this.updateCollapsed()},execContentsAction:function(v,z){var E=this.startContainer,F=this.endContainer,D=this.startOffset,G=this.endOffset,M,N=this.document,Q;this.optimizeBookmark();if(F[0].nodeType==e.NODE_TEXT)F=F._4e_splitText(G);else if(F[0].childNodes.length>0)if(G>=F[0].childNodes.length){F=new x(F[0].appendChild(N.createTextNode("")));
Q=m}else F=new x(F[0].childNodes[G]);if(E[0].nodeType==e.NODE_TEXT){E._4e_splitText(D);if(E._4e_equals(F))F=new x(E[0].nextSibling)}else if(D)if(D>=E[0].childNodes.length){M=new x(N.createTextNode(""));E.append(M);E=M;M=m}else E=new x(E[0].childNodes[D].previousSibling);else{M=new x(N.createTextNode(""));E.prepend(M);E=M;M=m}D=E._4e_parents();G=F._4e_parents();var R,V,T;for(R=0;R<D.length;R++){V=D[R];T=G[R];if(!V._4e_equals(T))break}N=z;for(var U,W,H,L=R;L<D.length;L++){U=D[L];W=N&&!U._4e_equals(E)?
N.appendChild(U._4e_clone()[0]):null;for(U=U[0].nextSibling;U;){if(b._4e_equals(G[L],U)||b._4e_equals(F,U))break;H=U.nextSibling;if(v==2)N.appendChild(U.cloneNode(m));else{b._4e_remove(U);v==1&&N.appendChild(U)}U=H}if(W)N=W}N=z;for(R=R;R<G.length;R++){U=G[R];W=N&&v>0&&!U._4e_equals(F)?N.appendChild(U._4e_clone()[0]):null;if(!D[R]||!U.parent()._4e_equals(D[R].parent()))for(U=U[0].previousSibling;U;){if(b._4e_equals(D[R],U)||b._4e_equals(E,U))break;H=U.previousSibling;if(v==2)N.insertBefore(U.cloneNode(m),
N.firstChild);else{b._4e_remove(U);v==1&&N.insertBefore(U,N.firstChild)}U=H}if(W)N=W}if(v==2){T=this.startContainer[0];if(T.nodeType==e.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==e.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}T=this.endContainer[0];if(T.nodeType==e.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==e.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}}else{if(V&&T&&(!E.parent()._4e_equals(V.parent())||!F.parent()._4e_equals(T.parent()))){V=
T._4e_index();M&&T.parent()._4e_equals(E.parent())&&V--;this.setStart(T.parent(),V)}this.collapse(m)}M&&E._4e_remove();Q&&F[0].parentNode&&F._4e_remove()},collapse:function(v){if(v){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=m},clone:function(){var v=new p(this.document);v.startContainer=this.startContainer;v.startOffset=this.startOffset;v.endContainer=this.endContainer;v.endOffset=
this.endOffset;v.collapsed=this.collapsed;return v},getEnclosedNode:function(){var v=this.clone();v.optimize();if(v.startContainer[0].nodeType!=e.NODE_ELEMENT||v.endContainer[0].nodeType!=e.NODE_ELEMENT)return c;var z=new g.Walker(v),E=o(m,undefined),F=n(m);v.evaluator=function(D){return F(D)&&E(D)};v=z.next();z.reset();z=z.previous();return v&&v._4e_equals(z)?v:c},shrink:function(v,z){if(!this.collapsed){v=v||i.SHRINK_TEXT;var E=this.clone(),F=this.startContainer,D=this.endContainer,G=this.startOffset,
M=this.endOffset,N=1,Q=1;if(F&&F[0].nodeType==e.NODE_TEXT)if(G)if(G>=F[0].nodeValue.length)E.setStartAfter(F);else{E.setStartBefore(F);N=0}else E.setStartBefore(F);if(D&&D[0].nodeType==e.NODE_TEXT)if(M)if(M>=D[0].nodeValue.length)E.setEndAfter(D);else{E.setEndAfter(D);Q=0}else E.setEndBefore(D);E=new j(E);E.evaluator=function(V){V=V[0]||V;return V.nodeType==(v==i.SHRINK_ELEMENT?e.NODE_ELEMENT:e.NODE_TEXT)};var R;E.guard=function(V,T){V=V[0]||V;if(v==i.SHRINK_ELEMENT&&V.nodeType==e.NODE_TEXT)return l;
if(T&&V==R)return l;if(!T&&V.nodeType==e.NODE_ELEMENT)R=V;return m};if(N)(F=E[v==i.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(F,z?i.POSITION_AFTER_START:i.POSITION_BEFORE_START);if(Q){E.reset();(E=E[v==i.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(E,z?i.POSITION_BEFORE_END:i.POSITION_AFTER_END)}return!!(N||Q)}},getTouchedStartNode:function(){var v=this.startContainer;if(this.collapsed||v[0].nodeType!=e.NODE_ELEMENT)return v;return v.childNodes[this.startOffset]||v},createBookmark2:function(v){var z=
this.startContainer,E=this.endContainer,F=this.startOffset,D=this.endOffset,G,M;if(!z||!E)return{start:0,end:0};if(v){if(z[0].nodeType==e.NODE_ELEMENT)if((G=new x(z[0].childNodes[F]))&&G[0]&&G[0].nodeType==e.NODE_TEXT&&F>0&&G[0].previousSibling.nodeType==e.NODE_TEXT){z=G;F=0}for(;z[0].nodeType==e.NODE_TEXT&&(M=z._4e_previous())&&M[0].nodeType==e.NODE_TEXT;){z=M;F+=M[0].nodeValue.length}if(!this.collapsed){if(E[0].nodeType==e.NODE_ELEMENT)if((G=new x(E[0].childNodes[D]))&&G[0]&&G[0].nodeType==e.NODE_TEXT&&
D>0&&G[0].previousSibling.nodeType==e.NODE_TEXT){E=G;D=0}for(;E[0].nodeType==e.NODE_TEXT&&(M=E._4e_previous())&&M[0].nodeType==e.NODE_TEXT;){E=M;D+=M[0].nodeValue.length}}}return{start:z._4e_address(v),end:this.collapsed?c:E._4e_address(v),startOffset:F,endOffset:D,normalized:v,is2:m}},createBookmark:function(v){var z,E,F,D,G=this.collapsed;z=new x("<span>",c,this.document);z.attr("_ke_bookmark",1);z.css("display","none");z.html("&nbsp;");if(v){F=f.guid("ke_bm_");z.attr("id",F+"S")}if(!G){E=z._4e_clone();
E.html("&nbsp;");v&&E.attr("id",F+"E");D=this.clone();D.collapse();D.insertNode(E)}D=this.clone();D.collapse(m);D.insertNode(z);if(E){this.setStartAfter(z);this.setEndBefore(E)}else this.moveToPosition(z,i.POSITION_AFTER_END);return{startNode:v?F+"S":z,endNode:v?F+"E":E,serializable:v,collapsed:G}},moveToPosition:function(v,z){this.setStartAt(v,z);this.collapse(m)},trim:function(v,z){var E=this.startContainer,F=this.startOffset,D=this.collapsed;if((!v||D)&&E[0]&&E[0].nodeType==e.NODE_TEXT){if(F)if(F>=
E[0].nodeValue.length){F=E._4e_index()+1;E=E.parent()}else{var G=E._4e_splitText(F);F=E._4e_index()+1;E=E.parent();if(b._4e_equals(this.startContainer,this.endContainer))this.setEnd(G,this.endOffset-this.startOffset);else if(b._4e_equals(E,this.endContainer))this.endOffset+=1}else{F=E._4e_index();E=E.parent()}this.setStart(E,F);if(D){this.collapse(m);return}}E=this.endContainer;F=this.endOffset;if(!(z||D)&&E[0]&&E[0].nodeType==e.NODE_TEXT){if(F){F>=E.nodeValue.length||E._4e_splitText(F);F=E._4e_index()+
1}else F=E._4e_index();E=E.parent();this.setEnd(E,F)}},insertNode:function(v){this.optimizeBookmark();this.trim(l,m);var z=this.startContainer;z[0].insertBefore(v[0]||v,z[0].childNodes[this.startOffset]||null);b._4e_equals(v.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(v)},moveToBookmark:function(v){if(v.is2){var z=d(this.document,v.start,v.normalized),E=v.startOffset,F=v.end&&d(this.document,v.end,v.normalized);v=v.endOffset;this.setStart(z,E);F?this.setEnd(F,v):this.collapse(m)}else{z=
(E=v.serializable)?f.one("#"+v.startNode,this.document):v.startNode;v=E?f.one("#"+v.endNode,this.document):v.endNode;this.setStartBefore(z);z._4e_remove();if(v&&v[0]){this.setEndBefore(v);v._4e_remove()}else this.collapse(m)}},getCommonAncestor:function(v,z){var E=this.startContainer,F=this.endContainer;E=b._4e_equals(E,F)?v&&E[0].nodeType==e.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new x(E[0].childNodes[this.startOffset]):E:E._4e_commonAncestor(F);return z&&E[0].nodeType==e.NODE_TEXT?E.parent():
E},enlarge:function(v){switch(v){case i.ENLARGE_ELEMENT:if(this.collapsed)break;v=this.getCommonAncestor();var z=new x(this.document.body),E,F,D,G,M,N=l,Q,R;Q=this.startContainer;R=this.startOffset;if(Q[0].nodeType==e.NODE_TEXT){if(R){Q=!f.trim(Q[0].nodeValue.substring(0,R)).length&&Q;N=!!Q}if(Q)if(!(G=Q[0].previousSibling))D=Q.parent()}else{if(R)G=Q[0].childNodes[R-1]||Q[0].lastChild;G||(D=Q)}for(;D||G;){if(D&&!G){if(!M&&b._4e_equals(D,v))M=m;if(!z.contains(D))break;if(!N||D.css("display")!="inline"){N=
l;if(M)E=D;else this.setStartBefore(D)}G=D[0].previousSibling}for(;G;){Q=l;if(G.nodeType==e.NODE_TEXT){R=G.nodeValue;if(/[^\s\ufeff]/.test(R))G=c;Q=/[\s\ufeff]$/.test(R)}else if(G.offsetWidth>0&&!G.getAttribute("_ke_bookmark"))if(N&&s.$removeEmpty[G.nodeName.toLowerCase()]){R=b.text(G);if(/[^\s\ufeff]/.test(R))G=c;else for(var V=G.all||G.getElementsByTagName("*"),T=0,U;U=V[T++];)if(!s.$removeEmpty[U.nodeName.toLowerCase()]){G=c;break}if(G)Q=!!R.length}else G=c;if(Q)if(N)if(M)E=D;else D&&this.setStartBefore(D);
else N=m;if(G){Q=G.previousSibling;if(!D&&!Q){D=new x(G);G=c;break}G=Q}else D=c}if(D)D=D.parent()}Q=this.endContainer;R=this.endOffset;D=G=c;M=N=l;if(Q[0].nodeType==e.NODE_TEXT){Q=!f.trim(Q[0].nodeValue.substring(R)).length&&Q;N=!(Q&&Q[0].nodeValue.length);if(Q)if(!(G=Q[0].nextSibling))D=Q.parent()}else(G=Q[0].childNodes[R])||(D=Q);for(;D||G;){if(D&&!G){if(!M&&b._4e_equals(D,v))M=m;if(!z.contains(D))break;if(!N||D.css("display")!="inline"){N=l;if(M)F=D;else D&&this.setEndAfter(D)}G=D[0].nextSibling}for(;G;){Q=
l;if(G.nodeType==e.NODE_TEXT){R=G.nodeValue;if(/[^\s\ufeff]/.test(R))G=c;Q=/^[\s\ufeff]/.test(R)}else if(G.offsetWidth>0&&!G.getAttribute("_ke_bookmark"))if(N&&s.$removeEmpty[G.nodeName.toLowerCase()]){R=b.text(G);if(/[^\s\ufeff]/.test(R))G=c;else{V=G.all||G.getElementsByTagName("*");for(T=0;U=V[T++];)if(!s.$removeEmpty[U.nodeName.toLowerCase()]){G=c;break}}if(G)Q=!!R.length}else G=c;if(Q)if(N)if(M)F=D;else this.setEndAfter(D);if(G){Q=G.nextSibling;if(!D&&!Q){D=new x(G);G=c;break}G=Q}else D=c}if(D)D=
D.parent()}if(E&&F){v=E.contains(F)?F:E;this.setStartBefore(v);this.setEndAfter(v)}break;case i.ENLARGE_BLOCK_CONTENTS:case i.ENLARGE_LIST_ITEM_CONTENTS:D=new p(this.document);z=new x(this.document.body);D.setStartAt(z,i.POSITION_AFTER_START);D.setEnd(this.startContainer,this.startOffset);D=new j(D);var W,H,L=j.blockBoundary(v==i.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:c),J=function(I){var K=L(I);K||(W=I);return K};E=function(I){var K=J(I);if(!K&&I[0]&&I._4e_name()=="br")H=I;return K};D.guard=J;D=D.lastBackward();
W=W||z;this.setStartAt(W,W._4e_name()!="br"&&(!D&&this.checkStartOfBlock()||D&&W.contains(D))?i.POSITION_AFTER_START:i.POSITION_AFTER_END);D=this.clone();D.collapse();D.setEndAt(z,i.POSITION_BEFORE_END);D=new j(D);D.guard=v==i.ENLARGE_LIST_ITEM_CONTENTS?E:J;W=c;D=D.lastForward();W=W||z;this.setEndAt(W,!D&&this.checkEndOfBlock()||D&&W.contains(D)?i.POSITION_BEFORE_END:i.POSITION_BEFORE_START);H&&this.setEndAfter(H)}},checkStartOfBlock:function(){var v=this.startContainer,z=this.startOffset;if(z&&v[0].nodeType==
e.NODE_TEXT)if(f.trim(v[0].nodeValue.substring(0,z)).length)return l;this.trim();v=new y(this.startContainer);z=this.clone();z.collapse(m);z.setStartAt(v.block||v.blockLimit,i.POSITION_AFTER_START);v=new j(z);v.evaluator=k(m);return v.checkBackward()},checkEndOfBlock:function(){var v=this.endContainer,z=this.endOffset;if(v[0].nodeType==e.NODE_TEXT)if(f.trim(v[0].nodeValue.substring(z)).length)return l;this.trim();v=new y(this.endContainer);z=this.clone();z.collapse(l);z.setEndAt(v.block||v.blockLimit,
i.POSITION_BEFORE_END);v=new j(z);v.evaluator=k(l);return v.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var v=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,v);return v},checkBoundaryOfElement:function(v,z){var E=this.clone();E[z==i.START?"setStartAt":"setEndAt"](v,z==i.START?i.POSITION_AFTER_START:i.POSITION_BEFORE_END);E=new j(E);E.evaluator=t;return E[z==i.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var v=this.startContainer,z=this.endContainer,E=this.startOffset,F=this.endOffset,D;if(v[0].nodeType==e.NODE_ELEMENT){D=v[0].childNodes.length;if(D>E)v=new x(v[0].childNodes[E]);else if(D<1)v=v._4e_previousSourceNode();else{for(v=v[0];v.lastChild;)v=v.lastChild;v=new x(v);v=v._4e_nextSourceNode()||v}}if(z[0].nodeType==e.NODE_ELEMENT){D=z[0].childNodes.length;if(D>F)z=(new x(z[0].childNodes[F]))._4e_previousSourceNode(m);else if(D<1)z=z._4e_previousSourceNode();else{for(z=
z[0];z.lastChild;)z=z.lastChild;z=new x(z)}}if(v._4e_position(z)&w.POSITION_FOLLOWING)v=z;return{startNode:v,endNode:z}},fixBlock:function(v,z){var E=this.createBookmark(),F=new x(this.document.createElement(z));this.collapse(v);this.enlarge(i.ENLARGE_BLOCK_CONTENTS);F[0].appendChild(this.extractContents());F._4e_trim();h.ie||F._4e_appendBogus();this.insertNode(F);this.moveToBookmark(E);return F},splitBlock:function(v){var z=new y(this.startContainer),E=new y(this.endContainer),F=z.block,D=E.block,
G=c;if(!z.blockLimit._4e_equals(E.blockLimit))return c;if(v!="br"){if(!F){F=this.fixBlock(m,v);D=(new y(this.endContainer)).block}D||(D=this.fixBlock(l,v))}v=F&&this.checkStartOfBlock();z=D&&this.checkEndOfBlock();this.deleteContents();if(F&&b._4e_equals(F,D))if(z){G=new y(this.startContainer);this.moveToPosition(D,i.POSITION_AFTER_END);D=c}else if(v){G=new y(this.startContainer);this.moveToPosition(F,i.POSITION_BEFORE_START);F=c}else{D=this.splitElement(F);!h.ie&&!f.inArray(F._4e_name(),["ul","ol"])&&
F._4e_appendBogus()}return{previousBlock:F,nextBlock:D,wasStartOfBlock:v,wasEndOfBlock:z,elementPath:G}},splitElement:function(v){if(!this.collapsed)return c;this.setEndAt(v,i.POSITION_BEFORE_END);var z=this.extractContents(),E=v._4e_clone(l);E[0].appendChild(z);E.insertAfter(v);this.moveToPosition(v,i.POSITION_AFTER_END);return E},moveToElementEditablePosition:function(v,z){var E,F=g.XHTML_DTD;if(F.$empty[v._4e_name()])return l;for(;v&&v[0].nodeType==e.NODE_ELEMENT;){if(E=v._4e_isEditable())this.moveToPosition(v,
z?i.POSITION_BEFORE_END:i.POSITION_AFTER_START);else if(F.$inline[v._4e_name()]){this.moveToPosition(v,z?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);return m}if((v=F.$empty[v._4e_name()]?v[z?"_4e_previous":"_4e_next"](r):v[z?"_4e_last":"_4e_first"](r))&&v[0].nodeType==e.NODE_TEXT){this.moveToPosition(v,z?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);return m}}return E},selectNodeContents:function(v){this.setStart(v,0);this.setEnd(v,v[0].nodeType==e.NODE_TEXT?v[0].nodeValue.length:v[0].childNodes.length)}});
var q={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},A=new j.whitespaces,B=new j.bookmark;g.Range=p;g.Range=p;var C=p.prototype;g.Utils.extern(C,{updateCollapsed:C.updateCollapsed,optimize:C.optimize,setStartAfter:C.setStartAfter,setEndAfter:C.setEndAfter,setStartBefore:C.setStartBefore,setEndBefore:C.setEndBefore,optimizeBookmark:C.optimizeBookmark,setStart:C.setStart,setEnd:C.setEnd,
setStartAt:C.setStartAt,setEndAt:C.setEndAt,execContentsAction:C.execContentsAction,collapse:C.collapse,clone:C.clone,getEnclosedNode:C.getEnclosedNode,shrink:C.shrink,getTouchedStartNode:C.getTouchedStartNode,createBookmark2:C.createBookmark2,createBookmark:C.createBookmark,moveToPosition:C.moveToPosition,trim:C.trim,insertNode:C.insertNode,moveToBookmark:C.moveToBookmark,getCommonAncestor:C.getCommonAncestor,enlarge:C.enlarge,checkStartOfBlock:C.checkStartOfBlock,checkEndOfBlock:C.checkEndOfBlock,
deleteContents:C.deleteContents,extractContents:C.extractContents,checkBoundaryOfElement:C.checkBoundaryOfElement,getBoundaryNodes:C.getBoundaryNodes,fixBlock:C.fixBlock,splitBlock:C.splitBlock,splitElement:C.splitElement,moveToElementEditablePosition:C.moveToElementEditablePosition,selectNodeContents:C.selectNodeContents})});
KISSY.Editor.add("domiterator",function(g){function p(j){if(!(arguments.length<1)){this.range=j;this.forceBrBreak=r;this.enlargeBr=t;this.enforceRealBlocks=r;this._||(this._={})}}var t=true,r=false,k=KISSY,o=k.UA,n=g.Walker,m=g.Range,l=g.RANGE,c=g.NODE,f=g.ElementPath,e=k.Node,i=k.DOM,w=/^[\r\n\t ]*$/;k.augment(p,{getNextParagraph:function(j){var b,d,h,s,y;if(!this._.lastNode){d=this.range.clone();d.shrink(l.SHRINK_ELEMENT,t);d.enlarge(this.forceBrBreak||!this.enlargeBr?l.ENLARGE_LIST_ITEM_CONTENTS:
l.ENLARGE_BLOCK_CONTENTS);var x=new n(d),u=n.bookmark(t,t);x.evaluator=u;this._.nextNode=x.next();x=new n(d);x.evaluator=u;x=x.previous();this._.lastNode=x._4e_nextSourceNode(t);if(this._.lastNode&&this._.lastNode[0].nodeType==c.NODE_TEXT&&!k.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){u=new m(d.document);u.moveToPosition(this._.lastNode,l.POSITION_AFTER_END);if(u.checkEndOfBlock()){u=new f(u.endContainer);this._.lastNode=(u.block||u.blockLimit)._4e_nextSourceNode(t)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new e(d.document.createTextNode(""));i.insertAfter(this._.lastNode[0],x[0])}d=null}u=this._.nextNode;x=this._.lastNode;for(this._.nextNode=null;u;){var q=r,A=u[0].nodeType!=c.NODE_ELEMENT,B=r;if(A){if(u[0].nodeType==c.NODE_TEXT)if(w.test(u[0].nodeValue))A=r}else{var C=u._4e_name();if(u._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(C=="br")A=t;else if(!d&&!u[0].childNodes.length&&C!="hr"){b=u;h=u._4e_equals(x);break}if(d){d.setEndAt(u,l.POSITION_BEFORE_START);if(C!="br")this._.nextNode=
u}q=t}else{if(u[0].firstChild){if(!d){d=new m(this.range.document);d.setStartAt(u,l.POSITION_BEFORE_START)}u=new e(u[0].firstChild);continue}A=t}}if(A&&!d){d=new m(this.range.document);d.setStartAt(u,l.POSITION_BEFORE_START)}h=(!q||A)&&u._4e_equals(x);if(d&&!q)for(;!u[0].nextSibling&&!h;){C=u.parent();if(C._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){q=t;h||C._4e_equals(x);break}u=C;A=t;h=u._4e_equals(x);B=t}A&&d.setEndAt(u,l.POSITION_AFTER_END);u=u._4e_nextSourceNode(B,null,x);if((h=!u)||q&&d)break}if(!b){if(!d){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}b=new f(d.startContainer);u=b.blockLimit;q={div:1,th:1,td:1};b=b.block;if((!b||!b[0])&&!this.enforceRealBlocks&&q[u._4e_name()]&&d.checkStartOfBlock()&&d.checkEndOfBlock())b=u;else if(!b||this.enforceRealBlocks&&b._4e_name()=="li"){b=new e(this.range.document.createElement(j||"p"));b[0].appendChild(d.extractContents());b._4e_trim();d.insertNode(b);s=y=t}else if(b._4e_name()!="li"){if(!d.checkStartOfBlock()||!d.checkEndOfBlock()){b=b._4e_clone(r);
b[0].appendChild(d.extractContents());b._4e_trim();y=d.splitBlock();s=!y.wasStartOfBlock;y=!y.wasEndOfBlock;d.insertNode(b)}}else if(!h)this._.nextNode=b._4e_equals(x)?null:d.getBoundaryNodes().endNode._4e_nextSourceNode(t,null,x)}if(s){d=new e(b[0].previousSibling);if(d[0]&&d[0].nodeType==c.NODE_ELEMENT)if(d._4e_name()=="br")d._4e_remove();else d[0].lastChild&&i._4e_name(d[0].lastChild)=="br"&&i._4e_remove(d[0].lastChild)}if(y){d=n.bookmark(r,t);s=new e(b[0].lastChild);if(s[0]&&s[0].nodeType==c.NODE_ELEMENT&&
s._4e_name()=="br")if(o.ie||s._4e_previous(d)||s._4e_next(d))s._4e_remove()}if(!this._.nextNode)this._.nextNode=h||b._4e_equals(x)?null:b._4e_nextSourceNode(t,null,x);return b}});m.prototype.createIterator=function(){return new p(this)}});
KISSY.Editor.add("selection",function(g){function p(u){this.document=this.document=u;this._={cache:{}};if(l.ie){var q=this.getNative().createRange();if(!q||q.item&&q.item(0).ownerDocument!=u||q.parentElement&&q.parentElement().ownerDocument!=u)this.isInvalid=k}}function t(u){u=new p(u);return!u||u.isInvalid?n:u}function r(u){var q=u.document,A=new e(q.body),B=new e(q.documentElement);if(l.ie){if(l.ie<8||document.documentMode==7)B.on("click",function(N){c._4e_name(N.target)==="html"&&u.getSelection().getRanges()[0].select()});
var C,v,z=1;B.on("mousedown",function(){z=0});B.on("mouseup",function(){z=1});A.on("focusin",function(N){if(c._4e_name(N.target)=="body")if(C){try{z&&C.select()}catch(Q){}C=n}});A.on("focus",function(){v=k;F()});A.on("beforedeactivate",function(N){if(!N.relatedTarget){v=o;z=1}});f.on(c._4e_getWin(q),"blur",function(){q&&q.selection.empty()});A.on("mousedown",function(){E()});A.on("mouseup",function(){v=k;setTimeout(function(){F(k)},0)});var E=function(){v=o},F=function(N){if(v){var Q=u.document,R=
u.getSelection(),V=R&&R.getType(),T=R&&R.getNative();if(N&&T&&V==i.SELECTION_NONE)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){F(k)},50);return}var U;if(!(T&&V==i.SELECTION_TEXT&&(U=c._4e_name(T.createRange().parentElement()))&&U in{input:1,textarea:1})){C=T&&R.getRanges()[0];u._monitor()}}};A.on("keydown",E);A.on("keyup",function(){v=k;F()});f.on(q,"selectionchange",F)}else{f.on(q,"mouseup",u._monitor,u);f.on(q,"keyup",u._monitor,u)}var D={table:1,pre:1},G=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
M=g.Walker.whitespaces(k);u.on("selectionChange",function(N){var Q=N.path;N=(N=N.selection)&&N.getRanges()[0];if(!(!N||!N.collapsed||Q.block))if(Q.blockLimit._4e_name()=="body"){Q=N.fixBlock(k,"p");if(Q._4e_outerHtml().match(G)){var R=Q._4e_next(M);if(R&&R[0].nodeType==j.NODE_ELEMENT&&!D[R._4e_name()]){N.moveToElementEditablePosition(R);Q._4e_remove()}else if((R=Q._4e_previous(M))&&R[0].nodeType==j.NODE_ELEMENT&&!D[R._4e_name()]){N.moveToElementEditablePosition(R,R._4e_outerHtml().match(G)?o:k);Q._4e_remove()}}N.select();
l.ie||u.notifySelectionChange()}})}g.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var k=true,o=false,n=null,m=KISSY,l=m.UA,c=m.DOM,f=m.Event,e=m.Node,i=g.SELECTION,w=g.RANGE,j=g.NODE,b=g.Walker,d=g.Range,h={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};m.augment(p,{getNative:l.ie?function(){var u=this._.cache;return u.nativeSel||(u.nativeSel=this.document.selection)}:function(){var u=
this._.cache;return u.nativeSel||(u.nativeSel=c._4e_getWin(this.document).getSelection())},getType:l.ie?function(){var u=this._.cache;if(u.type)return u.type;var q=i.SELECTION_NONE;try{var A=this.getNative(),B=A.type;if(B=="Text")q=i.SELECTION_TEXT;if(B=="Control")q=i.SELECTION_ELEMENT;if(A.createRange().parentElement)q=i.SELECTION_TEXT}catch(C){}return u.type=q}:function(){var u=this._.cache;if(u.type)return u.type;var q=i.SELECTION_TEXT,A=this.getNative();if(A){if(A.rangeCount==1){A=A.getRangeAt(0);
var B=A.startContainer;if(B==A.endContainer&&B.nodeType==j.NODE_ELEMENT&&A.endOffset-A.startOffset===1&&h[B.childNodes[A.startOffset].nodeName.toLowerCase()])q=i.SELECTION_ELEMENT}}else q=i.SELECTION_NONE;return u.type=q},getRanges:l.ie?function(){var u=function(q,A){q=q.duplicate();q.collapse(A);for(var B=q.parentElement(),C=B.childNodes,v,z=0;z<C.length;z++){var E=C[z];if(E.nodeType==j.NODE_ELEMENT){v=q.duplicate();v.moveToElementText(E);E=v.compareEndPoints("StartToStart",q);var F=v.compareEndPoints("EndToStart",
q);v.collapse();if(E>0)break;else if(!E||F==1&&E==-1)return{container:B,offset:z};else if(!F)return{container:B,offset:z+1};v=n}}if(!v){v=q.duplicate();v.moveToElementText(B);v.collapse(o)}v.setEndPoint("StartToStart",q);v=v.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;v>0;)v-=C[--z].nodeValue.length}catch(D){v=0}return v===0?{container:B,offset:z}:{container:C[z],offset:-v}};return function(){var q=this._.cache;if(q.ranges)return q.ranges;var A=this.getNative(),B=A&&A.createRange(),C=this.getType();
if(!A)return[];if(C==i.SELECTION_TEXT){A=new d(this.document);C=u(B,k);A.setStart(new e(C.container),C.offset);C=u(B);A.setEnd(new e(C.container),C.offset);return q.ranges=[A]}else if(C==i.SELECTION_ELEMENT){q=q.ranges=[];for(C=0;C<B.length;C++){var v=B.item(C),z=v.parentNode,E=0;for(A=new d(this.document);E<z.childNodes.length&&z.childNodes[E]!=v;E++);A.setStart(new e(z),E);A.setEnd(new e(z),E+1);q.push(A)}return q}return q.ranges=[]}}():function(){var u=this._.cache;if(u.ranges)return u.ranges;
var q=[],A=this.getNative();if(!A)return[];for(var B=0;B<A.rangeCount;B++){var C=A.getRangeAt(B),v=new d(this.document);v.setStart(new e(C.startContainer),C.startOffset);v.setEnd(new e(C.endContainer),C.endOffset);q.push(v)}return u.ranges=q},getStartElement:function(){var u=this._.cache;if(u.startElement!==undefined)return u.startElement;var q,A=this.getNative();switch(this.getType()){case i.SELECTION_ELEMENT:return this.getSelectedElement();case i.SELECTION_TEXT:var B=this.getRanges()[0];if(B)if(!B.collapsed){for(B.optimize();k;){q=
B.startContainer;if(B.startOffset==(q[0].nodeType===j.NODE_ELEMENT?q[0].childNodes.length:q[0].nodeValue.length)&&!q._4e_isBlockBoundary())B.setStartAfter(q);else break}q=B.startContainer;if(q[0].nodeType!=j.NODE_ELEMENT)return q.parent();q=new e(q[0].childNodes[B.startOffset]);if(!q[0]||q[0].nodeType!=j.NODE_ELEMENT)return B.startContainer;for(B=q[0].firstChild;B&&B.nodeType==j.NODE_ELEMENT;){q=new e(B);B=B.firstChild}return q}if(l.ie){B=A.createRange();B.collapse(k);q=B.parentElement()}else if((q=
A.anchorNode)&&q.nodeType!=j.NODE_ELEMENT)q=q.parentNode}return u.startElement=q?c._4e_wrap(q):n},getSelectedElement:function(){var u=this,q,A=u._.cache;if(A.selectedElement!==undefined)return A.selectedElement;if(l.ie){q=u.getNative().createRange();q=q.item&&q.item(0)}q||(q=function(){for(var B=u.getRanges()[0],C,v,z=2;z&&!((C=B.getEnclosedNode())&&C[0].nodeType==j.NODE_ELEMENT&&h[C._4e_name()]&&(v=C));z--)B.shrink(w.SHRINK_ELEMENT);return v&&v[0]}());return A.selectedElement=c._4e_wrap(q)},reset:function(){this._.cache=
{}},selectElement:function(u){var q;if(l.ie)try{q=this.document.body.createControlRange();q.addElement(u[0]);q.select()}catch(A){q=this.document.body.createTextRange();q.moveToElementText(u[0]);q.select()}finally{}else{q=this.document.createRange();q.selectNode(u[0]);u=this.getNative();u.removeAllRanges();u.addRange(q)}this.reset()},selectRanges:function(u){if(l.ie){if(u.length>1){var q=u[u.length-1];u[0].setEnd(q.endContainer,q.endOffset);u.length=1}u[0]&&u[0].select()}else{q=this.getNative();if(!q)return;
q.removeAllRanges();for(var A=0;A<u.length;A++){var B=u[A],C=this.document.createRange(),v=B.startContainer;B.collapsed&&l.gecko&&l.gecko<1.09&&v[0].nodeType==j.NODE_ELEMENT&&!v[0].childNodes.length&&v[0].appendChild(this.document.createTextNode(""));C.setStart(v[0],B.startOffset);C.setEnd(B.endContainer[0],B.endOffset);q.addRange(C)}}this.reset()},createBookmarks2:function(u){for(var q=[],A=this.getRanges(),B=0;B<A.length;B++)q.push(A[B].createBookmark2(u));return q},createBookmarks:function(u,q){var A=
[],B=this.document,C;q=q||this.getRanges();for(var v=q.length,z=0;z<v;z++){A.push(C=q[z].createBookmark(u,k));var E=(u=C.serializable)?m.one("#"+C.startNode,B):C.startNode;C=u?m.one("#"+C.endNode,B):C.endNode;for(var F=z+1;F<v;F++){var D=q[F],G=D.startContainer,M=D.endContainer;c._4e_equals(G,E.parent())&&D.startOffset++;c._4e_equals(G,C.parent())&&D.startOffset++;c._4e_equals(M,E.parent())&&D.endOffset++;c._4e_equals(M,C.parent())&&D.endOffset++}}return A},selectBookmarks:function(u){for(var q=[],
A=0;A<u.length;A++){var B=new d(this.document);B.moveToBookmark(u[A]);q.push(B)}this.selectRanges(q);return this},getCommonAncestor:function(){var u=this.getRanges();return u[0].startContainer._4e_commonAncestor(u[u.length-1].endContainer)},scrollIntoView:function(){var u=this.getStartElement();u&&u._4e_scrollIntoView()},removeAllRanges:function(){var u=this.getNative();if(l.ie)u&&u.clear();else u&&u.removeAllRanges()}});var s={table:1,tbody:1,tr:1},y=b.whitespaces(k),x=/\ufeff|\u00a0/;d.prototype.select=
d.prototype.select=l.ie?function(u){var q=this.collapsed,A,B;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var C=this.startContainer[0].childNodes[this.startOffset];if(C.nodeType==j.NODE_ELEMENT){(new p(this.document)).selectElement(new e(C));return}}if(this.startContainer[0].nodeType==j.NODE_ELEMENT&&this.startContainer._4e_name()in s||this.endContainer[0].nodeType==j.NODE_ELEMENT&&this.endContainer._4e_name()in s)this.shrink(w.SHRINK_ELEMENT,k);var v=this.createBookmark();
C=v.startNode;var z;if(!q)z=v.endNode;v=this.document.body.createTextRange();v.moveToElementText(C[0]);v.moveStart("character",1);if(z){u=this.document.body.createTextRange();u.moveToElementText(z[0]);v.setEndPoint("EndToEnd",u);v.moveEnd("character",-1)}else{for(A=C[0].nextSibling;A&&!y(A);)A=A.nextSibling;A=!(A&&A.nodeValue&&A.nodeValue.match(x))&&(u||!C[0].previousSibling||C[0].previousSibling&&c._4e_name(C[0].previousSibling)=="br");B=this.document.createElement("span");B.innerHTML="&#65279;";
B=(new e(B)).insertBefore(C);A&&c.insertBefore(this.document.createTextNode("\ufeff"),C)}this.setStartBefore(C);C._4e_remove();if(q){if(A){v.moveStart("character",-1);v.select();this.document.selection.clear()}else v.select();if(B){this.moveToPosition(B,w.POSITION_BEFORE_START);B._4e_remove()}}else{this.setEndBefore(z);z._4e_remove();v.select()}}:function(){var u=this.startContainer;this.collapsed&&u[0].nodeType==j.NODE_ELEMENT&&!u[0].childNodes.length&&u[0].appendChild(this.document.createTextNode(""));
var q=this.document.createRange();q.setStart(u[0],this.startOffset);try{q.setEnd(this.endContainer[0],this.endOffset)}catch(A){if(A.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(k);q.setEnd(this.endContainer[0],this.endOffset)}else throw A;}u=t(this.document).getNative();u.removeAllRanges();u.addRange(q)};p.getSelection=t;g.Selection=p;g.Selection=p;b=p.prototype;g.Utils.extern(b,{getNative:b.getNative,getType:b.getType,getRanges:b.getRanges,getStartElement:b.getStartElement,getSelectedElement:b.getSelectedElement,
reset:b.reset,selectElement:b.selectElement,selectRanges:b.selectRanges,createBookmarks2:b.createBookmarks2,createBookmarks:b.createBookmarks,getCommonAncestor:b.getCommonAncestor,scrollIntoView:b.scrollIntoView,selectBookmarks:b.selectBookmarks,removeAllRanges:b.removeAllRanges});g.on("instanceCreated",function(u){r(u.editor)})});
KISSY.Editor.add("styles",function(g){function p(H,L){for(var J in H)H[J]=H[J].replace(U,function(I,K){return L[K]})}function t(H,L){if(L){H=A.clone(H);p(H.attributes,L);p(H.styles,L)}var J=this.element=this.element=(H.element||"*").toLowerCase();this.type=this.type=J=="#"||R[J]?v.STYLE_BLOCK:V[J]?v.STYLE_OBJECT:v.STYLE_INLINE;this._={definition:H}}function r(H,L){var J=L?this.removeFromRange:this.applyToRange;H.body.focus();for(var I=new E(H),K=I.getRanges(),P=0;P<K.length;P++)J.call(this,K[P]);
I.selectRanges(K)}function k(H,L){var J;J=H.element;if(J=="*")J="span";J=new M(L.createElement(J));return o(J,H)}function o(H,L){var J=L._.definition,I=J.attributes;J=t.getStyleText(J);if(I)for(var K in I)H.attr(K,I[K]);if(J)H[0].style.cssText=J;return H}function n(H){var L=H.createBookmark(x),J=H.createIterator();J.enforceRealBlocks=x;J.enlargeBr=x;for(var I,K=H.document;I=J.getNextParagraph();){var P=k(this,K);I=I;var O=P;P=O._4e_name=="pre";var S=I._4e_name=="pre",$=!P&&S;if(P&&!S){S=I;O=O;$=S.html();
$=m($,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");$=$.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");$=$.replace(/([ \t\n\r]+|&nbsp;)/g," ");$=$.replace(/<br\b[^>]*>/gi,"\n");if(N.ie){S=S[0].ownerDocument.createElement("div");S.appendChild(O[0]);O[0].outerHTML="<pre>"+$+"</pre>";O=new M(S.firstChild);O._4e_remove()}else O.html($);O=O}else if($)O=c(l(I),O);else I._4e_moveChildren(O);I[0].parentNode.replaceChild(O[0],I[0]);if(P){I=O;P=void 0;if((P=I._4e_previousSourceNode(x,F.NODE_ELEMENT))&&P._4e_name()==
"pre"){O=m(P.html(),/\n$/,"")+"\n\n"+m(I.html(),/^\n/,"");if(N.ie)I[0].outerHTML="<pre>"+O+"</pre>";else I.html(O);P._4e_remove()}}}H.moveToBookmark(L)}function m(H,L,J){var I="",K="";H=H.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(P,O,S){O&&(I=O);S&&(K=S);return""});return I+H.replace(L,J)+K}function l(H){var L=[];m(H._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(J,I,K){return I+"</pre>"+K+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(J,I){L.push(I)});return L}function c(H,L){for(var J=L[0].ownerDocument.createDocumentFragment(),I=0;I<H.length;I++){var K=H[I];K=K.replace(/(\r\n|\r)/g,"\n");K=m(K,/^[ \t]*\n/,"");K=m(K,/\n$/,"");K=m(K,/^[ \t]+|[ \t]+$/g,function(O,S){return O.length==1?"&nbsp;":S?" "+Array(O.length).join("&nbsp;"):Array(O.length).join("&nbsp;")+" "});K=K.replace(/\n/g,"<br>");K=K.replace(/[ \t]{2,}/g,function(O){return Array(O.length).join("&nbsp;")+" "});var P=L._4e_clone();P.html(K);J.appendChild(P[0])}return J}
function f(H){var L=H.document;if(H.collapsed){L=k(this,L);H.insertNode(L);H.moveToPosition(L,z.POSITION_BEFORE_END)}else{var J=this.element,I=this._.definition,K,P=g.XHTML_DTD[J]||(K=x,g.XHTML_DTD.span),O=H.createBookmark();H.enlarge(z.ENLARGE_ELEMENT);H.trim();var S=H.createBookmark(),$=S.startNode;S=S.endNode;for(var Y=$,aa;Y&&Y[0];){var X=u;if(C._4e_equals(Y,S)){Y=q;X=x}else{var Z=Y[0].nodeType,da=Z==F.NODE_ELEMENT?Y._4e_name():q;if(da&&Y.attr("_ke_bookmark")){Y=Y._4e_nextSourceNode(x);continue}if(!da||
P[da]&&(Y._4e_position(S)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(Y))){var ea=Y.parent();if(ea&&ea[0]&&((g.XHTML_DTD[ea._4e_name()]||g.XHTML_DTD.span)[J]||K)&&(!I.parentRule||I.parentRule(ea))){if(!aa&&(!da||!g.XHTML_DTD.$removeEmpty[da]||(Y._4e_position(S)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED)){aa=
new G(L);aa.setStartBefore(Y)}if(Z==F.NODE_TEXT||Z==F.NODE_ELEMENT&&!Y[0].childNodes.length){Z=Y;var ba;for(da=Z._4e_next(function(ga){return!ga.attr("_ke_bookmark")});!da&&(ba=Z.parent(),P[ba._4e_name()])&&(ba._4e_position($)|D.POSITION_FOLLOWING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_FOLLOWING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(ba));)Z=ba;aa.setEndAfter(Z);Z[0].nextSibling||(X=x)}}else X=x}else X=x;Y=Y._4e_nextSourceNode()}if(X&&aa&&!aa.collapsed){X=
k(this,L);for(Z=aa.getCommonAncestor();X&&Z&&X[0]&&Z[0];){if(Z._4e_name()==J){for(var ca in I.attributes)X.attr(ca)==Z.attr(ca)&&X[0].removeAttribute(ca);for(var fa in I.styles)X._4e_style(fa)==Z._4e_style(fa)&&X._4e_style(fa,"");if(!X._4e_hasAttributes()){X=q;break}}Z=Z.parent()}if(X){X[0].appendChild(aa.extractContents());h(this,X);aa.insertNode(X);X._4e_mergeSiblings();N.ie||X[0].normalize()}aa=q}}$._4e_remove();S._4e_remove();H.moveToBookmark(O);H.shrink(z.SHRINK_TEXT)}}function e(H){H.enlarge(z.ENLARGE_ELEMENT);
var L=H.createBookmark(),J=L.startNode;if(H.collapsed){for(var I=new Q(J.parent()),K,P=0,O;P<I.elements.length&&(O=I.elements[P]);P++){if(O==I.block||O==I.blockLimit)break;if(this.checkElementRemovable(O)){var S=H.checkBoundaryOfElement(O,z.END),$=!S&&H.checkBoundaryOfElement(O,z.START);if($||S){K=O;K.match=$?"start":"end"}else{O._4e_mergeSiblings();O._4e_name()==this.element?b(this,O):s(O,j(this)[O._4e_name()])}}}if(K&&K[0]){O=J;for(P=0;;P++){S=I.elements[P];if(C._4e_equals(S,K))break;else if(S.match)continue;
else S=S._4e_clone();S[0].appendChild(O[0]);O=S}C[K.match=="start"?"insertBefore":"insertAfter"](O,K)}}else{var Y=L.endNode,aa=this;I=function(){for(var X=new Q(J.parent()),Z=new Q(Y.parent()),da=q,ea=q,ba=0;ba<X.elements.length;ba++){var ca=X.elements[ba];if(ca==X.block||ca==X.blockLimit)break;if(aa.checkElementRemovable(ca))da=ca}for(ba=0;ba<Z.elements.length;ba++){ca=Z.elements[ba];if(ca==Z.block||ca==Z.blockLimit)break;if(aa.checkElementRemovable(ca))ea=ca}ea&&Y._4e_breakParent(ea);da&&J._4e_breakParent(da)};
I();for(K=new M(J[0].nextSibling);K[0]!==Y[0];){P=K._4e_nextSourceNode();if(K[0]&&K[0].nodeType==F.NODE_ELEMENT&&this.checkElementRemovable(K)){K._4e_name()==this.element?b(this,K):s(K,j(this)[K._4e_name()]);if(P[0].nodeType==F.NODE_ELEMENT&&P.contains(J)){I();P=new M(J[0].nextSibling)}}K=P}}H.moveToBookmark(L)}function i(H){var L={};H.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(J,I,K){L[I]=K});return L}function w(H,L){var J;if(L!==u){J=document.createElement("span");
J.style.cssText=H;J=J.style.cssText||""}else J=H;return J.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function j(H){if(H._.overrides)return H._.overrides;var L=H._.overrides={},J=H._.definition.overrides;if(J){A.isArray(J)||(J=[J]);for(var I=0;I<J.length;I++){var K=J[I],P,O;if(typeof K=="string")P=K.toLowerCase();else{P=K.element?K.element.toLowerCase():H.element;O=K.attributes}K=L[P]||(L[P]={});if(O){K=K.attributes=K.attributes||[];for(var S in O)K.push([S.toLowerCase(),
O[S]])}}}return L}function b(H,L){var J=H._.definition,I=B.mix(J.attributes,j(H)[L._4e_name()]);J=J.styles;var K=A.isEmptyObject(I)&&A.isEmptyObject(J),P;for(P in I)if(!((P=="class"||H._.definition.fullMatch)&&L.attr(P)!=d(P,I[P]))){K=K||!!L._4e_hasAttribute(P);L.removeAttr(P)}for(var O in J)if(!(H._.definition.fullMatch&&L._4e_style(O)!=d(O,J[O],x))){K=K||!!L._4e_style(O);L._4e_style(O,"")}y(L)}function d(H,L,J){var I=new M("<span>");I[J?"_4e_style":"attr"](H,L);return I[J?"_4e_style":"attr"](H)}
function h(H,L){for(var J=j(H),I=L.all(H.element),K=I.length;--K>=0;)b(H,new M(I[K]));for(var P in J)if(P!=H.element){I=L.all(P);for(K=I.length-1;K>=0;K--){var O=new M(I[K]);s(O,J[P])}}}function s(H,L){var J=L&&L.attributes;if(J)for(var I=0;I<J.length;I++){var K=J[I][0],P;if(P=H.attr(K)){var O=J[I][1];if(O===q||O.test&&O.test(P)||typeof O=="string"&&P==O)H[0].removeAttribute(K)}}y(H)}function y(H){if(!H._4e_hasAttributes()){var L=H[0].firstChild,J=H[0].lastChild;H._4e_remove(x);if(L){L.nodeType==
F.NODE_ELEMENT&&C._4e_mergeSiblings(L);J&&L!=J&&J.nodeType==F.NODE_ELEMENT&&C._4e_mergeSiblings(J)}}}var x=true,u=false,q=null,A=KISSY,B=g.Utils,C=A.DOM,v={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},z=g.RANGE,E=g.Selection,F=g.NODE,D=g.POSITION,G=g.Range,M=A.Node,N=A.UA,Q=g.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},V={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},T=/\s*(?:;\s*|$)/g,U=/#\((.+?)\)/g;g.STYLE=v;t.prototype={apply:function(H){r.call(this,
H,u)},remove:function(H){r.call(this,H,x)},applyToRange:function(H){return(this.applyToRange=this.type==v.STYLE_INLINE?f:this.type==v.STYLE_BLOCK?n:this.type==v.STYLE_OBJECT?q:q).call(this,H)},removeFromRange:function(H){return(this.removeFromRange=this.type==v.STYLE_INLINE?e:q).call(this,H)},applyToObject:function(H){o(H,this)},checkElementRemovable:function(H,L){if(!H)return u;var J=this._.definition;if(H._4e_name()==this.element){if(!L&&!H._4e_hasAttributes())return x;var I=J._AC;if(I)J=I;else{I=
{};var K=0,P=J.attributes;if(P)for(var O in P){K++;I[O]=P[O]}if(P=t.getStyleText(J)){I.style||K++;I.style=P}I._length=K;J=J._AC=I}if(J._length){for(var S in J)if(S!="_length"){K=H.attr(S)||"";if(S=="style")a:{I=J[S];K=w(K,u);typeof I=="string"&&(I=i(I));typeof K=="string"&&(K=i(K));P=void 0;for(P in I)if(!(P in K&&(K[P]==I[P]||I[P]=="inherit"||K[P]=="inherit"))){I=u;break a}I=x}else I=J[S]==K;if(I){if(!L)return x}else if(L)return u}if(L)return x}else return x}if(S=j(this)[H._4e_name()]){if(!(J=S.attributes))return x;
for(I=0;I<J.length;I++){S=J[I][0];if(S=H.attr(S)){K=J[I][1];if(K===q||typeof K=="string"&&S==K||K.test&&K.test(S))return x}}}return u},checkActive:function(H){switch(this.type){case v.STYLE_BLOCK:return this.checkElementRemovable(H.block||H.blockLimit,x);case v.STYLE_OBJECT:case v.STYLE_INLINE:for(var L=H.elements,J=0,I;J<L.length;J++){I=L[J];if(!(this.type==v.STYLE_INLINE&&(C._4e_equals(I,H.block)||C._4e_equals(I,H.blockLimit))))if(!(this.type==v.STYLE_OBJECT&&!(I._4e_name()in V)))if(this.checkElementRemovable(I,
x))return x}}return u}};t.getStyleText=function(H){var L=H._ST;if(L)return L;L=H.styles;var J=H.attributes&&H.attributes.style||"",I="";if(J.length)J=J.replace(T,";");for(var K in L){var P=L[K],O=(K+":"+P).replace(T,";");if(P=="inherit")I+=O;else J+=O}if(J.length)J=w(J);J+=I;return H._ST=J};g.Style=t;g.Style=t;var W=t.prototype;g.Utils.extern(W,{apply:W.apply,remove:W.remove,applyToRange:W.applyToRange,removeFromRange:W.removeFromRange,applyToObject:W.applyToObject,checkElementRemovable:W.checkElementRemovable,
checkActive:W.checkActive})});
KISSY.Editor.add("htmlparser",function(){function g(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var p=KISSY,t=function(){},r=p.Editor,k=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,o={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},n=r.XHTML_DTD;p.augment(g,{onTagOpen:t,onTagClose:t,
onText:t,onCDATA:t,onComment:t,parse:function(m){for(var l,c,f=0,e;l=this._.htmlPartsRegex.exec(m);){c=l.index;if(c>f){f=m.substring(f,c);e?e.push(f):this.onText(f)}f=this._.htmlPartsRegex.lastIndex;if(c=l[1]){c=c.toLowerCase();if(e&&n.$cdata[c]){this.onCDATA(e.join(""));e=null}if(!e){this.onTagClose(c);continue}}if(e)e.push(l[0]);else if(c=l[3]){c=c.toLowerCase();if(!/="/.test(c)){var i={},w;l=l[4];var j=!!(l&&l.charAt(l.length-1)=="/");if(l)for(;w=k.exec(l);){var b=w[1].toLowerCase();w=w[2]||w[3]||
w[4]||"";i[b]=!w&&o[b]?b:w}this.onTagOpen(c,i,j);if(!e&&n.$cdata[c])e=[]}}else if(c=l[2])this.onComment(c)}m.length>f&&this.onText(m.substring(f,m.length))}});r.HtmlParser=g;r.HtmlParser=g});
KISSY.Editor.add("htmlparser-basicwriter",function(){function g(){this._={output:[]}}var p=KISSY,t=p.Editor,r=t.Utils;p.augment(g,{openTag:function(k){this._.output.push("<",k)},openTagClose:function(k,o){o?this._.output.push(" />"):this._.output.push(">")},attribute:function(k,o){if(typeof o=="string")o=r.htmlEncodeAttr(o);this._.output.push(" ",k,'="',o,'"')},closeTag:function(k){this._.output.push("</",k,">")},text:function(k){this._.output.push(k)},comment:function(k){this._.output.push("<!--",
k,"--\>")},write:function(k){this._.output.push(k)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(k){var o=this._.output.join("");k&&this.reset();return o}});t.HtmlParser.BasicWriter=g;t.HtmlParser.BasicWriter=g;p=g.prototype;t.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,write:p.write,reset:p.reset,getHtml:p.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function g(){g.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=o;this.sortAttributes=k;this._.indent=o;this._.indentation="";this._.rules={};var n=t.XHTML_DTD,m;for(m in r.mix({},n.$nonBodyContent,n.$block,n.$listItem,n.$tableContent))this.setRules(m,{indent:k,breakBeforeOpen:k,breakAfterOpen:k,breakBeforeClose:!n[m]["#"],breakAfterClose:k});this.setRules("br",
{breakAfterOpen:k});this.setRules("title",{indent:o,breakAfterOpen:o});this.setRules("style",{indent:o,breakBeforeClose:k});this.setRules("pre",{indent:o})}var p=KISSY,t=p.Editor,r=t.Utils,k=true,o=false;p.extend(g,t.HtmlParser.BasicWriter,{openTag:function(n){var m=this._.rules[n];if(this._.indent)this.indentation();else if(m&&m.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",n)},openTagClose:function(n,m){var l=this._.rules[n];if(m)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(l&&l.indent)this._.indentation+=this.indentationChars}l&&l.breakAfterOpen&&this.lineBreak()},attribute:function(n,m){if(typeof m=="string"){this.forceSimpleAmpersand&&(m=m.replace(/&amp;/g,"&"));m=r.htmlEncodeAttr(m)}this._.output.push(" ",n,'="',m,'"')},closeTag:function(n){var m=this._.rules[n];if(m&&m.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(m&&m.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",n,">");m&&m.breakAfterClose&&this.lineBreak()},text:function(n){if(this._.indent){this.indentation();n=r.ltrim(n)}this._.output.push(n)},comment:function(n){this._.indent&&this.indentation();this._.output.push("<!--",n,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=k},indentation:function(){this._.output.push(this._.indentation);this._.indent=o},setRules:function(n,m){var l=this._.rules[n];if(l)r.mix(l,
m);else this._.rules[n]=m}});t.HtmlParser.HtmlWriter=g;t.HtmlParser.HtmlWriter=g;p=g.prototype;t.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,lineBreak:p.lineBreak,indentation:p.indentation,setRules:p.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function g(){this.children=[];this.parent=r;this._={isBlockLike:p,hasInlineStarted:t}}var p=true,t=false,r=null,k=KISSY.Editor,o={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},n=KISSY,m=k.Utils,l=k.NODE,c=k.XHTML_DTD,f=m.mix({table:1,ul:1,ol:1,dl:1},c.table,c.ul,c.ol,c.dl),e=c.$list,i=c.$listItem;g.FromHtml=function(w,j){function b(z){var E;if(x.length>0)for(var F=0;F<x.length;F++){var D=x[F],G=D.name,M=c[G],N=q.name&&c[q.name];
if((!N||N[G])&&(!z||!M||M[z]||!c[z])){if(!E){d();E=1}D=D.clone();D.parent=q;q=D;x.splice(F,1);F--}}}function d(){for(;u.length;)q.add(u.shift())}function h(z,E,F){E=E||q||y;if(j&&!E.type){var D,G;if((D=z.attributes&&(G=z.attributes._ke_real_element_type)?G:z.name)&&!(D in c.$body)&&!(D in c.$nonBodyContent)){D=q;q=E;s.onTagOpen(j,{});E=q;if(F)q=D}}if(z._.isBlockLike&&z.name!="pre"){F=z.children.length;if((D=z.children[F-1])&&D.type==l.NODE_TEXT)if(G=m.rtrim(D.value))D.value=G;else z.children.length=
F-1}E.add(z);if(z.returnPoint){q=z.returnPoint;delete z.returnPoint}}var s=new k.HtmlParser,y=new g,x=[],u=[],q=y,A=t,B;s.onTagOpen=function(z,E,F){var D=new k.HtmlParser.Element(z,E);if(D.isUnknown&&F)D.isEmpty=p;if(c.$removeEmpty[z])x.push(D);else{if(z=="pre")A=p;else if(z=="br"&&A){q.add(new k.HtmlParser.Text("\n"));return}if(z=="br")u.push(D);else{var G=q.name,M=G&&(c[G]||(q._.isBlockLike?c.div:c.span));if(M&&!D.isUnknown&&!q.isUnknown&&!M[z]){M=t;var N;if(z in e&&G in e){G=q.children;(G=G[G.length-
1])&&G.name in i||h(G=new k.HtmlParser.Element("li"),q);B=q;N=G}else if(z==G)h(q,q.parent);else{if(f[G])B||(B=q);else{h(q,q.parent,p);o[G]||x.unshift(q)}M=p}q=N?N:q.returnPoint||q.parent;if(M){s.onTagOpen.apply(this,arguments);return}}b(z);d();D.parent=q;D.returnPoint=B;B=0;if(D.isEmpty)h(D);else q=D}}};s.onTagClose=function(z){for(var E=x.length-1;E>=0;E--)if(z==x[E].name){x.splice(E,1);return}for(var F=[],D=[],G=q;G.type&&G.name!=z;){G._.isBlockLike||D.unshift(G);F.push(G);G=G.parent}if(G.type){for(E=
0;E<F.length;E++){var M=F[E];h(M,M.parent)}q=G;if(q.name=="pre")A=t;G._.isBlockLike&&d();h(G,G.parent);if(G==q)q=q.parent;x=x.concat(D)}if(z=="body")j=t};s.onText=function(z){if(!q._.hasInlineStarted&&!A){z=m.ltrim(z);if(z.length===0)return}d();b();if(j&&(!q.type||q.name=="body")&&m.trim(z))this.onTagOpen(j,{});A||(z=z.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));q.add(new k.HtmlParser.Text(z))};s.onCDATA=function(){};s.onComment=function(z){q.add(new k.HtmlParser.Comment(z))};s.parse(w);for(d();q.type;){var C=
q.parent,v=q;if(j&&(!C.type||C.name=="body")&&!c.$body[v.name]){q=C;s.onTagOpen(j,{});C=q}C.add(v);q=C}return y};n.augment(g,{add:function(w){var j=this.children.length;if(j=j>0&&this.children[j-1]||r){if(w._.isBlockLike&&j.type==l.NODE_TEXT){j.value=m.rtrim(j.value);if(j.value.length===0){this.children.pop();this.add(w);return}}j.next=w}w.previous=j;w.parent=this;this.children.push(w);this._.hasInlineStarted=w.type==l.NODE_TEXT||w.type==l.NODE_ELEMENT&&!w._.isBlockLike},writeHtml:function(w,j){var b;
this.filterChildren=this.filterChildren=function(){var d=new k.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,d,j,p);d=d.getHtml();this.children=(new g.FromHtml(d)).children;b=1};!this.name&&j&&j.onFragment(this);this.writeChildrenHtml(w,b?r:j)},writeChildrenHtml:function(w,j){for(var b=0;b<this.children.length;b++)this.children[b].writeHtml(w,j)}});k.HtmlParser.Fragment=g;k.HtmlParser.Fragment=g;g.FromHtml=g.FromHtml;n=g.prototype;k.Utils.extern(n,{add:n.add,writeHtml:n.writeHtml,writeChildrenHtml:n.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function g(o,n){this.name=o;this.attributes=n||(n={});this.children=[];var m=n._ke_real_element_type||o,l=p.XHTML_DTD;m=!!(l.$nonBodyContent[m]||l.$block[m]||l.$listItem[m]||l.$tableContent[m]||l.$nonEditable[m]||m=="br");var c=!!l.$empty[o];this.isEmpty=c;this.isUnknown=!l[o];this._={isBlockLike:m,hasInlineStarted:c||!m}}var p=KISSY.Editor,t=p.NODE,r=function(o,n){o=o[0];n=n[0];return o<n?-1:o>n?1:0};KISSY.augment(g,{type:t.NODE_ELEMENT,add:p.HtmlParser.Fragment.prototype.add,
clone:function(){return new g(this.name,this.attributes)},writeHtml:function(o,n){var m=this.attributes,l=this,c=l.name,f,e,i,w;l.filterChildren=function(){if(!w){var d=new p.HtmlParser.BasicWriter;p.HtmlParser.Fragment.prototype.writeChildrenHtml.call(l,d,n);l.children=(new p.HtmlParser.Fragment.FromHtml(d.getHtml())).children;w=1}};l.filterChildren=l.filterChildren;if(n){for(;;){if(!(c=n.onElementName(c)))return;l.name=c;if(!(l=n.onElement(l)))return;l.parent=this.parent;if(l.name==c)break;if(l.type!=
t.NODE_ELEMENT){l.writeHtml(o,n);return}c=l.name;if(!c){this.writeChildrenHtml.call(l,o,w?null:n);return}}m=l.attributes}o.openTag(c,m);for(var j=[],b=0;b<2;b++)for(f in m){e=f;i=m[f];if(b==1)j.push([f,i]);else if(n){for(;;)if(e=n.onAttributeName(f))if(e!=f){delete m[f];f=e}else break;else{delete m[f];break}if(e)if((i=n.onAttribute(l,e,i))===false)delete m[e];else m[e]=i}}o.sortAttributes&&j.sort(r);m=j.length;for(b=0;b<m;b++){f=j[b];o.attribute(f[0],f[1])}o.openTagClose(c,l.isEmpty);if(!l.isEmpty){this.writeChildrenHtml.call(l,
o,w?null:n);o.closeTag(c)}},writeChildrenHtml:function(){p.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});p.HtmlParser.Element=g;p.HtmlParser.Element=g;var k=g.prototype;p.Utils.extern(k,{type:k.type,add:k.add,clone:k.clone,writeHtml:k.writeHtml,writeChildrenHtml:k.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function g(f){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};f&&this.addRules(f,10)}function p(f,e){for(var i=0;f&&i<e.length;i++){var w=e[i];f=f.replace(w[0],w[1])}return f}function t(f,e,i){if(typeof e=="function")e=[e];var w,j;j=f.length;var b=e&&e.length;if(b){for(w=0;w<j&&f[w].pri<i;w++);for(j=b-1;j>=0;j--)if(b=e[j]){b.pri=i;f.splice(w,0,b)}}}function r(f,e,i){if(e)for(var w in e){var j=f[w];f[w]=k(j,e[w],
i);j||f.$length++}}function k(f,e,i){if(e){e.pri=i;if(f){if(f.splice)t(f,e,i);else{f=f.pri>i?[e,f]:[f,e];f.filter=o}return f}else return e.filter=e}}function o(f){for(var e=f.type||f instanceof m.HtmlParser.Fragment,i=0;i<this.length;i++){if(e)var w=f.type,j=f.name;var b=this[i].apply(window,arguments);if(b===c)return b;if(e){if(b&&(b.name!=j||b.type!=w))return b}else if(typeof b!="string")return b;b!=undefined&&(f=b)}return f}var n=KISSY,m=n.Editor,l=m.NODE,c=false;n.augment(g,{addRules:function(f,
e){if(typeof e!="number")e=10;t(this._.elementNames,f.elementNames,e);t(this._.attributeNames,f.attributeNames,e);r(this._.elements,f.elements,e);r(this._.attributes,f.attributes,e);this._.text=k(this._.text,f.text,e)||this._.text;this._.comment=k(this._.comment,f.comment,e)||this._.comment;this._.root=k(this._.root,f.root,e)||this._.root},onElementName:function(f){return p(f,this._.elementNames)},onAttributeName:function(f){return p(f,this._.attributeNames)},onText:function(f){var e=this._.text;
return e?e.filter(f):f},onComment:function(f,e){var i=this._.comment;return i?i.filter(f,e):f},onFragment:function(f){var e=this._.root;return e?e.filter(f):f},onElement:function(f){for(var e=[this._.elements["^"],this._.elements[f.name],this._.elements.$],i,w=0;w<3;w++)if(i=e[w]){i=i.filter(f,this);if(i===c)return null;if(i&&i!=f)return this.onNode(i);if(f.parent&&!f.name)break}return f},onNode:function(f){var e=f.type;return e==l.NODE_ELEMENT?this.onElement(f):e==l.NODE_TEXT?new m.HtmlParser.Text(this.onText(f.value)):
null},onAttribute:function(f,e,i){if(e=this._.attributes[e]){f=e.filter(i,f,this);if(f===c)return c;if(typeof f!="undefined")return f}return i}});m.HtmlParser.Filter=g;n=g.prototype;m.Utils.extern(n,{addRules:n.addRules,onElementName:n.onElementName,onAttributeName:n.onAttributeName,onText:n.onText,onComment:n.onComment,onFragment:n.onFragment,onElement:n.onElement,onNode:n.onNode,onAttribute:n.onAttribute});m.HtmlParser.Filter=g});
KISSY.Editor.add("htmlparser-text",function(){function g(k){this.value=k;this._={isBlockLike:r}}var p=KISSY,t=p.Editor,r=false;p.augment(g,{type:t.NODE.NODE_TEXT,writeHtml:function(k,o){var n=this.value;o&&!(n=o.onText(n,this))||k.text(n)}});t.HtmlParser.Text=g;t.HtmlParser.Text=g});
KISSY.Editor.add("htmlparser-comment",function(){function g(r){this.value=r;this._={isBlockLike:false}}var p=KISSY.Editor,t=p.NODE;p.HtmlParser.Comment=g;p.HtmlParser.Comment=g;g.prototype={constructor:g,type:t.NODE_COMMENT,writeHtml:function(r,k){var o=this.value;if(k){if(!(o=k.onComment(o,this)))return;if(typeof o!="string"){o.parent=this.parent;o.writeHtml(r,k);return}}r.comment(o)}}});
KISSY.Editor.add("bubbleview",function(){var g=KISSY.Editor,p=KISSY,t=p.Event,r=p.DOM;if(!g.BubbleView){var k=p.Base.create(g.Overlay,[],{init:function(){this.on("renderUI",this._renderUIBubbleView,this)},_renderUIBubbleView:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var n=this._selectedEl,m=n._4e_getOffset(document);m.top+=n.height()+5;k.superclass.show.call(this);this.set("xy",[m.left,m.top])}},{ATTRS:{focus4e:false,zIndex:{value:g.baseZIndex(g.zIndexManager.BUBBLE_VIEW)}}}),
o={};k.attach=function(n){var m=n.pluginName;p.mix(n,o[m].cfg,false);var l=n.pluginContext,c=n.func,f=n.editor,e=n.bubble;f.on("selectionChange",function(i){i=i.path;var w=i.elements;if(i&&w)if(i=i.lastElement)if(i=c(i)){w=o[m];if(!w.bubble){w.bubble=new k;w.bubble.renderer();w.cfg.init&&w.cfg.init.call(w.bubble)}e=w.bubble;e._selectedEl=i;e._plugin=l;e.hide();e.show()}else if(e){e._selectedEl=e._plugin=null;e.hide()}});t.on(r._4e_getWin(f.document),"scroll blur",function(){e&&e.hide()})};k.register=
function(n){var m=n.pluginName;o[m]=o[m]||{cfg:n};t.on(document,"click",function(){n.bubble&&n.bubble.hide()});n.editor&&k.attach(n)};g.BubbleView=k}});
KISSY.Editor.add("button",function(){var g=KISSY,p=g.Editor;if(!p.TripleButton){var t=g.Base.create([g.Ext.Box],{init:function(){this.on("bindUI",this._bindUIButton,this)},_bindUIButton:function(){var r=this,k=r.get("el");k.on("click",r._action,r);k.on("mousedown",function(){r.get("state")=="off"&&k.addClass("ke-triplebutton-active")});k.on("mouseup mouseleave",function(){r.get("state")=="off"&&k.hasClass("ke-triplebutton-active")&&setTimeout(function(){k.removeClass("ke-triplebutton-active")},300)})},
_uiSetTitle:function(){this.get("el").attr("title",this.get("title"))},_uiSetContentCls:function(r){var k=this.get("el");if(r!==undefined){k.html("<span class='ke-toolbar-item "+r+"'>");k._4e_unselectable()}},_uiSetText:function(r){var k=this.get("el");r!==undefined&&k.html(r)},_uiSetState:function(r){this["_"+r]()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(r){this.fire(this.get("state")+
"Click",r);r.type=this.get("state")+"Click";this.fire("click",r);r.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){var r=this.get("el");r.removeClass("ke-triplebutton-off ke-triplebutton-disabled");r.addClass("ke-triplebutton-on")},_off:function(){var r=this.get("el");r.removeClass("ke-triplebutton-on ke-triplebutton-disabled");r.addClass("ke-triplebutton-off")},_disabled:function(){var r=this.get("el");r.removeClass("ke-triplebutton-off ke-triplebutton-on");
r.addClass("ke-triplebutton-disabled")}},{ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elAttrs:{href:{value:"#"}},elTagName:{value:"a"},title:{},contentCls:{},text:{}}});t.ON="on";t.OFF="off";t.DISABLED="disabled";t.ON_CLASS="ke-triplebutton-on";t.OFF_CLASS="ke-triplebutton-off";t.DISABLED_CLASS="ke-triplebutton-disabled";p.TripleButton=t;p.prototype.addButton=function(r,k){var o=this,n=new t({render:o.toolBarDiv,autoRender:true,title:k.title,text:k.text,contentCls:k.contentCls}),
m={btn:n,editor:o,cfg:k,call:function(){var l=g.makeArray(arguments),c=l.shift();return k[c].apply(m,l)},reload:function(l){g.mix(k,l);n.enable();o.on("selectionChange",function(){k.selectionChange&&k.selectionChange.apply(m,arguments)});n.on("click",function(c){var f=c.type;k[f]&&k[f].apply(m,arguments)});if(k.mode==p.WYSIWYG_MODE){o.on("wysiwygmode",n.enable,n);o.on("sourcemode",n.disable,n)}k.init&&k.init.call(m)}};k.loading?n.disable():m.reload();return m}}});
KISSY.Editor.add("clipboard",function(g){var p=KISSY,t=p.Editor,r=p.Node,k=p.UA,o=t.Range,n=t.RANGE,m=p.Event;t.Paste||function(){function l(d){this.editor=d;this._init()}function c(d){if(!(!k.ie||d.document.compatMode=="BackCompat")){var h=d.getSelection(),s;if(h.getType()==j.SELECTION_ELEMENT&&(s=h.getSelectedElement())){var y=h.getRanges()[0],x=new r(d.document.createTextNode(""));x.insertBefore(s);y.setStartBefore(x);y.setEndAfter(s);h.selectRanges([y]);setTimeout(function(){if(s.parent()){x.remove();
h.selectElement(s)}},0)}}}p.augment(l,{_init:function(){var d=this.editor;k.ie?m.on(d.document,"keydown",this._paste,this):m.on(d.document,"paste",this._paste,this);d.addCommand("copy",new w("copy"));d.addCommand("cut",new w("cut"));d.addCommand("paste",new w("paste"))},_paste:function(d){if(!(d.type==="keydown"&&!(d.keyCode===86&&(d.ctrlKey||d.metaKey)))){var h=this,s=h.editor,y=s.document;if(h._running)d.halt();else{var x=s.getSelection();d=new o(y);var u=new r(k.webkit?"<body></body>":"<div></div>",
null,y);k.webkit&&u[0].appendChild(y.createTextNode("\u00a0"));y.body.appendChild(u[0]);u.css({position:"absolute",top:x.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});u.css("left","-1000px");var q=x.createBookmarks();d.setStartAt(u,n.POSITION_AFTER_START);d.setEndAt(u,n.POSITION_BEFORE_END);d.select(true);h._running=true;setTimeout(function(){u._4e_remove();var A;u=k.webkit&&(A=u._4e_first())&&A.hasClass("Apple-style-span")?A:u;x.selectBookmarks(q);s.insertHtml(u.html());
h._running=false},0)}}}});t.Paste=l;var f=function(d,h){var s=d.document,y=new r(s.body),x=false,u=function(){x=true};y.on(h,u);(k.ie>7?s:s.selection.createRange()).execCommand(h);y.detach(h,u);return x},e=k.ie?function(d,h){return f(d,h)}:function(d,h){try{return d.document.execCommand(h)}catch(s){return false}},i={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},w=function(d){this.type=
d;this.canUndo=this.type=="cut"};w.prototype={exec:function(d){this.type=="cut"&&c(d);(d=e(d,this.type))||alert(i[this.type]);return d}};var j=t.Selection,b={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};t.on("contextmenu",function(d){var h=d.contextmenu,s=h.cfg.editor,y=h.elDom,x={copy:0,cut:0,paste:0},u;for(u in x){if(!x.hasOwnProperty(u))break;x[u]=y.one(".ke-paste-"+u);(function(q){var A=x[q];if(!A){A=(new r("<a href='#'class='ke-paste-"+q+"'>"+b[q]+"</a>")).appendTo(y);A.on("click",function(B){B.halt();if(!A.hasClass("ke-menuitem-disable")){h.hide();
setTimeout(function(){s.execCommand(q)},30)}})}x[q]=A})(u);d=x[u];(s.document.queryCommandEnabled(u)?true:false)?d.removeClass("ke-menuitem-disable"):d.addClass("ke-menuitem-disable")}})}();g.ready(function(){new t.Paste(g)})});
KISSY.Editor.add("color",function(g){var p=KISSY.Editor;g.ready(function(){var t=g.cfg.pluginConfig;false!==t.forecolor&&function(){var r=g.addButton("color",{styles:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},title:"\u6587\u672c\u989c\u8272",loading:true,contentCls:"ke-toolbar-color"});p.use("colorsupport",function(){r.reload(p.ColorSupport)})}();false!==t.bgcolor&&function(){var r=g.addButton("color",{styles:{element:"span",styles:{"background-color":"#(color)"}},
title:"\u80cc\u666f\u989c\u8272",loading:true,contentCls:"ke-toolbar-bgcolor"});p.use("colorsupport",function(){r.reload(p.ColorSupport)})}()})});
KISSY.Editor.add("colorsupport",function(){function g(){if(!l){l="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var c=0;c<3;c++){l+="<div class='ke-color-palette'><table>";for(var f=m[c],e=f.length/8,i=0;i<e;i++){l+="<tr>";for(var w=0;w<8;w++){var j="#"+f[8*i+w];l+="<td>";l+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+j+"'></a>";l+="</td>"}l+="</tr>"}l+="</table></div>"}l+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
var p=KISSY,t=p.Editor,r=p.Node,k=p.Event,o=t.Overlay,n=p.DOM;n.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var m=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],l;t.ColorSupport={offClick:function(c){var f=this.cfg,e=this.colorWin;e&&e.get("visible")?e.hide():f._prepare.call(this,c)},_prepare:function(){var c=this,f=c.cfg,e=document,i=c.btn,w=c.editor,j;g();c.colorWin=new o({elCls:"ks-popup",content:l,focus4e:false,autoRender:true,width:"170px",zIndex:w.baseZIndex(t.zIndexManager.POPUP_MENU)});var b=c.colorWin;j=b.get("contentEl");j.on("click",f._selectColor,c);k.on(e,"click",f._hidePanel,c);k.on(w.document,
"click",f._hidePanel,c);b.on("show",i.bon,i);b.on("hide",i.boff,i);j.one(".ke-color-others").on("click",function(d){d.halt();b.hide();w.useDialog("color/dialog",function(h){h.show(c)})});f._prepare=f._show;f._show.call(c)},_show:function(){var c=this.btn.get("el"),f=this.colorWin,e=parseInt(f.get("width")),i=n.viewportWidth();f.align(c,["bl","tl"],[0,2]);f.get("x")+e>i-30&&f.set("x",i-30-e);f.show()},_hidePanel:function(c){var f=this.btn.get("el");c=c.target;var e=this.colorWin;f._4e_equals(c)||f.contains(c)||
e.hide()},_selectColor:function(c){c.halt();var f=this.cfg;c=new r(c.target);if(c._4e_name()=="a"&&!c.hasClass("ke-button")){f._applyColor.call(this,c._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(c){var f=this.editor,e=f.document,i=this.cfg.styles;f.fire("save");c?(new t.Style(i,{color:c})).apply(e):(new t.Style(i,{color:"inherit"})).remove(e);f.fire("save")}}});
KISSY.Editor.add("contextmenu",function(){function g(c){this.cfg=c;t.Utils.lazyRun(this,"_prepareShow","_realShow")}function p(c,f){for(var e=0;e<f.length;e++){var i=f[e];if(r.isFunction(i)){if(i(new k(c)))return true}else if(o.test(c,i))return true}return false}var t=KISSY.Editor,r=KISSY,k=r.Node,o=r.DOM,n=r.Event;if(!t.ContextMenu){g.ATTRS={editor:{}};var m=[];g.register=function(c){var f=new g(c),e=c.editor.document;m.push({doc:e,rules:c.rules||[],instance:f});if(!e.ke_contextmenu){e.ke_contextmenu=
1;n.on(e,"mousedown",g.hide);n.on(e,"contextmenu",function(i){g.hide.call(this);for(var w=new k(i.target);w;){var j=false;if(w._4e_name()=="body")break;for(var b=0;b<m.length;b++){var d=m[b].instance,h=m[b].rules;if(e===m[b].doc&&p(w[0],h)){i.preventDefault();j=true;setTimeout(function(){d.show(t.Utils.getXY(i.pageX,i.pageY,e,document))},30);break}}if(j)break;w=w.parent()}})}return f};g.hide=function(){for(var c=0;c<m.length;c++){var f=m[c].instance;this===m[c].doc&&f.hide()}};var l=t.Overlay;r.augment(g,
{_init:function(){var c=this,f=c.cfg,e=f.funcs;c.el=new l({content:"<div>",width:f.width,elCls:"ke-menu"});c.el.renderer();c.elDom=c.el.get("contentEl").one("div");f=c.elDom;for(var i in e){var w=new k("<a href='#'>"+i+"</a>");f[0].appendChild(w[0]);(function(j,b){j._4e_unselectable();j.on("click",function(d){c.hide();d.halt();setTimeout(b,30)})})(w,e[i])}},hide:function(){this.el&&this.el.hide()},_realShow:function(c){t.fire("contextmenu",{contextmenu:this});this.el.set("xy",[c.left,c.top]);this.el.show()},
_prepareShow:function(){this._init()},show:function(c){this._prepareShow(c)}});t.ContextMenu=g}});
KISSY.add("dd",function(g){function p(){p.superclass.constructor.apply(this,arguments);this._init()}function t(n,m,l){l=l||150;if(l===-1)return function(){n.apply(m,arguments)};var c=g.now();return function(){var f=g.now();if(f-c>l){c=f;n.apply(m,arguments)}}}var r=g.Event,k=g.DOM,o=g.Node;g.DD={};p.ATTRS={bufferTime:{value:200},activeDrag:{}};g.extend(p,g.Base,{_init:function(){this._showShimMove=t(this._move,this,30)},_move:function(n){var m=this.get("activeDrag");g.log("move");if(m){n.preventDefault();
this._clearSelection();m._move(n)}},_start:function(n){var m=this,l=m.get("bufferTime")||0;m._registerEvent();if(l)m._bufferTimer=setTimeout(function(){m._bufferStart(n)},l);else m._bufferStart(n)},_bufferStart:function(n){this.set("activeDrag",n);this._activeShim();n._start()},_end:function(n){var m=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(m){m._end(n);this.set("activeDrag",
null)}},_activeShim:function(){var n=document;this._shim=(new o("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:999999;'></div>")).appendTo(n.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:k.docHeight()});this._clearSelection()},_clearSelection:function(){g.log("_clearSelection");if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection)try{document.selection.empty()}catch(n){}},
_registerEvent:function(){var n=document;g.log("_registerEvent");r.on(n,"mouseup",this._end,this);r.on(n,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var n=document;g.log("_unregisterEvent");r.remove(n,"mousemove",this._showShimMove,this);r.remove(n,"mouseup",this._end,this)}});g.DD.DDM=new p});
KISSY.add("dd-draggable",function(g){function p(){p.superclass.constructor.apply(this,arguments);this._init()}var t=g.UA;p.ATTRS={node:{setter:function(r){return g.one(r)}},handlers:{value:[],setter:function(r){if(r)for(var k=0;k<r.length;k++)r[k]=g.one(r[k])}}};g.extend(p,g.Base,{_init:function(){var r=this.get("node"),k=this.get("handlers");if(k.length==0)k[0]=r;for(var o=0;o<k.length;o++){var n=k[o],m=n.css("cursor");if(n[0]!=r[0])if(!m||m==="auto")n.css("cursor","move")}r.on("mousedown",this._handleMouseDown,
this)},destroy:function(){for(var r=this.get("node"),k=this.get("handlers"),o=0;o<k.length;o++){var n=k[o];n.css("cursor")=="move"&&n.css("cursor","auto")}r.detach("mousedown",this._handleMouseDown,this)},_check:function(r){for(var k=this.get("handlers"),o=0;o<k.length;o++){var n=k[o];if(n.contains(r)||n[0]==r[0])return true}return false},_handleMouseDown:function(r){if(this._check(new g.Node(r.target))){t.webkit||r.preventDefault();g.DD.DDM._start(this);var k=this.get("node"),o=r.pageX;r=r.pageY;
k=k.offset();this.startMousePos={left:o,top:r};this.startNodePos=k;this._diff={left:o-k.left,top:r-k.top};this.set("diff",this._diff)}},_move:function(r){var k=this.get("diff");g.mix(r,{left:r.pageX-k.left,top:r.pageY-k.top});this.fire("drag",r)},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});g.Draggable=p},{host:"dd"});KISSY.Editor.add("dd",function(){});KISSY.Editor.add("draft",function(g){var p=KISSY.Editor;g.ready(function(){p.use("draft/support",function(){p.storeReady(function(){new p.Draft(g)})})})});
KISSY.Editor.add("draft/support",function(){function g(c,f,e){for(c+="";c.length<f;)c=e+c;return c}function p(c){if(r.isNumber(c))c=new Date(c);return c instanceof Date?[c.getFullYear(),"-",g(c.getMonth()+1,2,"0"),"-",g(c.getDate(),2,"0")," ",g(c.getHours(),2,"0"),":",g(c.getMinutes(),2,"0"),":",g(c.getSeconds(),2,"0")].join(""):c}function t(c){this.editor=c;this._init()}var r=KISSY,k=r.Editor,o=r.Node,n=r.Event,m=r.JSON,l=window[k.STORE];r.augment(t,{_init:function(){var c=this,f=c.editor,e=f.statusDiv,
i=f.cfg.pluginConfig;i.draft=i.draft||{};c.draftInterval=i.draft.interval=i.draft.interval||5;c.draftLimit=i.draft.limit=i.draft.limit||5;e=(new o("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+i.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);c.timeTip=(new o("<span class='ke-draft-time'>")).appendTo(e);var w=(new o("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(e),j=new k.Select({container:e,
menuContainer:document.body,doc:f.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),b=l.getItem("ke-draft-save"),d=[];c.versions=j;if(b)d=r.isString(b)?m.parse(decodeURIComponent(b)):b;c.drafts=d;c.sync();w.on("click",function(){c.save(false)});(function(){var h=f.textarea[0].form;h&&n.on(h,"submit",function(){c.save(false)})})();setInterval(function(){c.save(true)},c.draftInterval*60*1E3);j.on("click",c.recover,c);c.holder=e;if(i.draft.helpHtml){i=new k.TripleButton({cls:"ke-draft-help",
title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:e});i.on("click",function(){c._prepareHelp()});k.Utils.lazyRun(c,"_prepareHelp","_realHelp");c.helpBtn=i.el}c._holder=e},_prepareHelp:function(){var c=this,f=c.editor,e=c.helpBtn,i=new o(f.cfg.pluginConfig.draft.helpHtml||""),w=new o("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
i.append(w);i.css({border:"1px solid #ACB4BE","text-align":"left"});c._help=new r.Overlay({content:i,autoRender:true,width:i.width()+"px",mask:false});c._help.el.css("border","none");c._help.arrow=w;n.on([document,f.document],"click",function(j){j=j.target;j==e[0]||e.contains(j)||c._help.hide()})},_realHelp:function(){var c=this._help,f=this.helpBtn,e=c.arrow;c.show();f=f.offset();c.el.offset({left:f.left-c.el.width()+17,top:f.top-c.el.height()-7});e.offset({left:f.left-2,top:f.top-8})},disable:function(){this.holder.css("visibility",
"hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var c=this.draftLimit,f=this.timeTip,e=this.versions,i=this.drafts;i.length>c&&i.splice(0,i.length-c);c=[];for(var w,j=0;j<i.length;j++){w=i[j];w=(w.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+p(w.date);c.push({name:w,value:j})}e.set("items",c.reverse());f.html(w);l.setItem("ke-draft-save",encodeURIComponent(m.stringify(i)))},save:function(c){var f=this.drafts,e=this.editor.getData(true);if(e){if(f[f.length-1]&&e==f[f.length-1].content)f.length-=
1;this.drafts=f.concat({content:e,date:(new Date).getTime(),auto:c});this.sync()}},recover:function(c){var f=this.editor,e=this.drafts;c=c.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+p(e[c].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){f.fire("save");f.setData(e[c].content);f.fire("save")}}});k.Draft=t});
KISSY.Editor.add("elementpaths",function(g){var p=KISSY.Editor,t=KISSY,r=t.Node,k=t.DOM;p.ElementPaths||function(){function o(n){this.cfg=n;this._cache=[];this._init()}k.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");t.augment(o,{_init:function(){var n=this.cfg.editor;this.holder=new r("<span>");this.holder.appendTo(n.statusDiv);n.on("selectionChange",this._selectionChange,this);
p.Utils.sourceDisable(n,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(n){var m=this.cfg.editor,l=this.holder;n=n.path.elements;var c,f;c=this._cache;for(f=0;f<c.length;f++){c[f].detach("click");c[f]._4e_remove()}this._cache=[];for(f=0;f<n.length;f++){c=n[f];var e=new r("<a href='#' class='elementpath'>"+(c.attr("_ke_real_element_type")||c._4e_name())+"</a>");this._cache.push(e);(function(i){e.on("click",
function(w){w.halt();m.focus();setTimeout(function(){m.getSelection().selectElement(i)},50)})})(c);l.prepend(e)}}});p.ElementPaths=o}();g.ready(function(){new p.ElementPaths({editor:g})})});
KISSY.Editor.add("enterkey",function(g){var p=KISSY.Editor,t=KISSY,r=t.UA,k=/^h[1-6]$/,o=p.XHTML_DTD,n=t.Node,m=t.Event,l=p.Walker,c=p.ElementPath;p.enterBlock||function(){function f(e){m.on(e.document,"keydown",function(i){if(i.keyCode===13)if(!i.shiftKey){e.fire("save");var w=e.execCommand("enterBlock");e.fire("save");w!==false&&i.preventDefault()}})}f.enterBlock=function(e){var i;i=e.getSelection().getRanges();for(var w=i.length-1;w>0;w--)i[w].deleteContents();i=i[0];w=i.document;if(i.checkStartOfBlock()&&
i.checkEndOfBlock()){var j=(new c(i.startContainer)).block;if(j&&(j._4e_name()=="li"||j.parent()._4e_name()=="li"))if(e.hasCommand("outdent")){e.fire("save");e.execCommand("outdent");e.fire("save");return}else return false}var b=i.splitBlock("p");if(b){e=b.previousBlock;j=b.nextBlock;var d=b.wasStartOfBlock,h=b.wasEndOfBlock,s;if(j){s=j.parent();if(s._4e_name()=="li"){j._4e_breakParent(s);j._4e_move(j._4e_next(),true)}}else if(e&&(s=e.parent())&&s._4e_name()=="li"){e._4e_breakParent(s);i.moveToElementEditablePosition(e._4e_next());
e._4e_move(e._4e_previous())}if(!d&&!h){if(j._4e_name()=="li"&&(s=j._4e_first(l.invisible(true)))&&t.inArray(s._4e_name(),["ul","ol"]))(r.ie?new n(w.createTextNode("\u00a0")):new n(w.createElement("br"))).insertBefore(s);j&&i.moveToElementEditablePosition(j)}else{var y;if(e){if(e._4e_name()=="li"||!k.test(e._4e_name()))y=e._4e_clone()}else if(j)y=j._4e_clone();y||(y=new n("<p>",null,w));if(s=b.elementPath){b=0;for(var x=s.elements.length;b<x;b++){var u=s.elements[b];if(u._4e_equals(s.block)||u._4e_equals(s.blockLimit))break;
if(o.$removeEmpty[u._4e_name()]){u=u._4e_clone();y._4e_moveChildren(u);y.append(u)}}}r.ie||y._4e_appendBogus();i.insertNode(y);if(r.ie&&d&&(!h||!e[0].childNodes.length)){i.moveToElementEditablePosition(h?e:y);i.select()}i.moveToElementEditablePosition(d&&!h?j:y)}if(!r.ie)if(j){y=new n(w.createElement("span"));y.html("&nbsp;");i.insertNode(y);y._4e_scrollIntoView();i.deleteContents()}else y._4e_scrollIntoView();i.select()}};p.EnterKey=f}();g.ready(function(){g.addCommand("enterBlock",{exec:p.EnterKey.enterBlock});
p.EnterKey(g)})});
KISSY.add("ext-align",function(g){function p(){g.log("align init");this.on("bindUI",this._bindUIAlign,this);this.on("renderUI",this._renderUIAlign,this);this.on("syncUI",this._syncUIAlign,this)}function t(k,o){var n=o.charAt(0),m=o.charAt(1),l,c,f,e;if(k){k=g.one(k);l=k.offset();c=k[0].offsetWidth;f=k[0].offsetHeight}else{l={left:r.scrollLeft(),top:r.scrollTop()};c=r.viewportWidth();f=r.viewportHeight()}e=l.left;l=l.top;if(n==="c")l+=f/2;else if(n==="b")l+=f;if(m==="c")e+=c/2;else if(m==="r")e+=c;
return{left:e,top:l}}g.namespace("Ext");var r=g.DOM;g.mix(p,{TL:"tl",TC:"tc",TR:"tr",CL:"cl",CC:"cc",CR:"cr",BL:"bl",BC:"bc",BR:"br"});p.ATTRS={align:{}};p.prototype={_bindUIAlign:function(){g.log("_bindUIAlign")},_renderUIAlign:function(){g.log("_renderUIAlign")},_syncUIAlign:function(){g.log("_syncUIAlign")},_uiSetAlign:function(k){g.log("_uiSetAlign");g.isPlainObject(k)&&this.align(k.node,k.points,k.offset)},align:function(k,o,n){var m,l=this.get("el");n=n||[0,0];m=r.offset(l);k=t(k,o[0]);o=t(l,
o[1]);o=[o.left-k.left,o.top-k.top];this.set("xy",[m.left-o[0]+ +n[0],m.top-o[1]+ +n[1]])},center:function(k){this.set("align",{node:k,points:[p.CC,p.CC],offset:[0,0]})},__destructor:function(){g.log("align __destructor")}};g.Ext.Align=p});
KISSY.add("ext-box",function(g){function p(){g.log("box init");this.on("renderUI",this._renderUIBoxExt,this);this.on("syncUI",this._syncUIBoxExt,this);this.on("bindUI",this._bindUIBoxExt,this)}g.namespace("Ext");var t=document,r=g.Node;p.ATTRS={el:{setter:function(k){if(g.isString(k))return g.one(k)}},elCls:{},elStyle:{},width:{},height:{},elTagName:{value:"div"},elAttrs:{},elOrder:{value:1},html:{value:false}};p.HTML_PARSER={el:function(k){return k}};p.prototype={_syncUIBoxExt:function(){g.log("_syncUIBoxExt")},
_bindUIBoxExt:function(){g.log("_bindUIBoxExt")},_renderUIBoxExt:function(){g.log("_renderUIBoxExt");var k=this.get("render")||g.one(t.body),o=this.get("el");k=new r(k);if(!o){o=new r("<"+this.get("elTagName")+">");this.get("elOrder")?k.append(o):k.prepend(o);this.set("el",o)}},_uiSetElAttrs:function(k){g.log("_uiSetElAttrs");k&&this.get("el").attr(k)},_uiSetElCls:function(k){k&&this.get("el").addClass(k)},_uiSetElStyle:function(k){g.log("_uiSetElStyle");k&&this.get("el").css(k)},_uiSetWidth:function(k){g.log("_uiSetWidth");
k&&this.get("el").width(k)},_uiSetHeight:function(k){g.log("_uiSetHeight");k&&this.get("el").height(k)},_uiSetHtml:function(k){g.log("_uiSetHtml");k!==false&&this.get("el").html(k)},__destructor:function(){g.log("box __destructor");var k=this.get("el");if(k){k.detach();k.remove()}}};g.Ext.Box=p});
KISSY.add("ext-overlay-close",function(g){function p(){g.log("close init");this.on("renderUI",this._rendUICloseExt,this);this.on("bindUI",this._bindUICloseExt,this);this.on("syncUI",this._syncUICloseExt,this)}g.namespace("Ext");var t=g.Node;p.ATTRS={closable:{value:true},closeBtn:{}};p.HTML_PARSER={closeBtn:".ks-ext-close"};p.prototype={_syncUICloseExt:function(){g.log("_syncUICloseExt")},_uiSetClosable:function(r){g.log("_uiSetClosable");var k=this.get("closeBtn");if(k)r?k.show():k.hide()},_rendUICloseExt:function(){g.log("_rendUICloseExt");
var r=this.get("closeBtn"),k=this.get("contentEl");if(!r&&k){r=(new t("<a href='#' class='ks-ext-close'><span class='ks-ext-close-x'>X</span></a>")).appendTo(k);this.set("closeBtn",r)}},_bindUICloseExt:function(){g.log("_bindUICloseExt");var r=this,k=r.get("closeBtn");k&&k.on("click",function(o){r.hide();o.halt()})},__destructor:function(){g.log("close-ext __destructor");var r=this.get("closeBtn");r&&r.detach()}};g.Ext.Close=p});
KISSY.add("ext-constrain",function(g){function p(){g.log("constrain init");this.on("bindUI",this._bindUIConstrain,this);this.on("renderUI",this._renderUIConstrain,this);this.on("syncUI",this._syncUIConstrain,this)}function t(k){var o=undefined;if(!k)return o;var n=this.get("el");if(k!==true){k=g.one(k);o=k.offset();g.mix(o,{maxLeft:o.left+k[0].offsetWidth-n[0].offsetWidth,maxTop:o.top+k[0].offsetHeight-n[0].offsetHeight})}else{k=document.documentElement.clientWidth;o={left:r.scrollLeft(),top:r.scrollTop()};
g.mix(o,{maxLeft:o.left+k-n[0].offsetWidth,maxTop:o.top+r.viewportHeight()-n[0].offsetHeight})}return o}g.namespace("Ext");var r=g.DOM;p.ATTRS={constrain:{value:false}};p.prototype={_bindUIConstrain:function(){g.log("_bindUIConstrain")},_renderUIConstrain:function(){g.log("_renderUIConstrain");var k=this,o=k.getDefAttrs(),n=o.x;o=o.y;var m=n.setter,l=o.setter;n.setter=function(c){var f=m&&m(c);if(f===undefined)f=c;if(!k.get("constrain"))return f;c=t.call(k,k.get("constrain"));return Math.min(Math.max(f,
c.left),c.maxLeft)};o.setter=function(c){var f=l&&l(c);if(f===undefined)f=c;if(!k.get("constrain"))return f;c=t.call(k,k.get("constrain"));return Math.min(Math.max(f,c.top),c.maxTop)};k.addAttr("x",n);k.addAttr("y",o)},_syncUIConstrain:function(){g.log("_syncUIConstrain")},__destructor:function(){g.log("constrain-ext __destructor")}};g.Ext.Constrain=p});
KISSY.add("ext-contentbox",function(g){function p(){g.log("contentbox init");this.on("renderUI",this._renderUIContentBox,this);this.on("syncUI",this._syncUIContentBox,this);this.on("bindUI",this._bindUIContentBox,this)}g.namespace("Ext");var t=g.Node;p.ATTRS={contentEl:{},contentElAttrs:{},contentTagName:{value:"div"},content:{}};p.HTML_PARSER={contentEl:".ks-contentbox"};p.prototype={_syncUIContentBox:function(){g.log("_syncUIContentBox")},_bindUIContentBox:function(){g.log("_bindUIContentBox")},
_renderUIContentBox:function(){g.log("_renderUIContentBox");var r=this.get("contentEl"),k=this.get("el");if(!r){r=(new t("<"+this.get("contentTagName")+" class='ks-contentbox'>")).appendTo(k);this.set("contentEl",r)}},_uiSetContentElAttrs:function(r){g.log("_uiSetContentElAttrs");r&&this.get("contentEl").attr(r)},_uiSetContent:function(r){g.log("_uiSetContent");r!==undefined&&this.get("contentEl").html(r)},__destructor:function(){g.log("contentbox __destructor")}};g.Ext.ContentBox=p});
KISSY.add("ext-drag",function(g){function p(){g.log("drag init");this.on("bindUI",this._bindUIDragExt,this);this.on("renderUI",this._renderUIDragExt,this);this.on("syncUIUI",this._syncUIDragExt,this)}g.namespace("Ext");p.ATTRS={handlers:{value:[]},draggable:{value:true}};p.prototype={_uiSetHandlers:function(t){g.log("_uiSetHanlders");t&&t.length>0&&this.__drag.set("handlers",t)},_syncUIDragExt:function(){g.log("_syncUIDragExt")},_renderUIDragExt:function(){g.log("_renderUIDragExt")},_bindUIDragExt:function(){g.log("_bindUIDragExt");
var t=this.get("el");this.__drag=new g.Draggable({node:t,handlers:this.get("handlers")})},_uiSetDraggable:function(t){g.log("_uiSetDraggable");var r=this.__drag;if(t){r.detach("drag");r.on("drag",this._dragExtAction,this)}else r.detach("drag")},_dragExtAction:function(t){this.set("xy",[t.left,t.top])},__destructor:function(){g.log("DragExt __destructor");var t=this.__drag;t&&t.destroy()}};g.Ext.Drag=p});
KISSY.add("ext-loading",function(g){function p(){g.log("LoadingExt init")}g.namespace("Ext");p.prototype={loading:function(){if(!this._loadingExtEl)this._loadingExtEl=(new g.Node("<div class='ks-ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'>")).appendTo(this.get("el"));this._loadingExtEl.show()},unloading:function(){var t=this._loadingExtEl;t&&t.hide()}};g.Ext.Loading=p});
KISSY.add("ext-mask",function(g){function p(){g.log("mask init");this.on("bindUI",this._bindUIMask,this);this.on("renderUI",this._renderUIMask,this);this.on("syncUI",this._syncUIMask,this)}g.namespace("Ext");var t,r=g.UA,k=0;p.ATTRS={mask:{value:false}};p.prototype={_bindUIMask:function(){g.log("_bindUIMask")},_renderUIMask:function(){g.log("_renderUIMask")},_syncUIMask:function(){g.log("_syncUIMask")},_uiSetMask:function(o){g.log("_uiSetMask");if(o){this.on("show",this._maskExtShow,this);this.on("hide",
this._maskExtHide,this)}else{this.detach("show",this._maskExtShow,this);this.detach("hide",this._maskExtHide,this)}},_maskExtShow:function(){if(!t){t=(new g.Node("<div class='ks-ext-mask'>")).prependTo(document.body);t.css({position:"absolute",left:0,top:0,width:"100%",height:g.DOM.docHeight()});r.ie==6&&t.append("<iframe style='width:100%;height:expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'>")}t.css({"z-index":this.get("zIndex")-1});k++;t.show()},_maskExtHide:function(){k--;
if(k<=0)k=0;k||t&&t.hide()},__destructor:function(){g.log("mask __destructor")}};g.Ext.Mask=p});
KISSY.add("ext-position",function(g){function p(){g.log("position init");this.on("bindUI",this._bindUIPosition,this);this.on("renderUI",this._renderUIPosition,this);this.on("syncUI",this._syncUIPosition,this)}g.namespace("Ext");var t=document,r=g.Event;p.ATTRS={x:{},y:{},xy:{setter:function(k){var o=g.makeArray(k);if(o.length){o[0]&&this.set("x",o[0]);o[1]&&this.set("y",o[1])}return k}},zIndex:{value:9999},visible:{value:undefined}};p.prototype={_syncUIPosition:function(){g.log("_syncUIPosition")},
_renderUIPosition:function(){g.log("_renderUIPosition");this.get("el").addClass("ks-ext-position");this.get("el").css("display","")},_bindUIPosition:function(){g.log("_bindUIPosition")},_uiSetZIndex:function(k){g.log("_uiSetZIndex");k!==undefined&&this.get("el").css("z-index",k)},_uiSetX:function(k){g.log("_uiSetX");k!==undefined&&this.get("el").offset({left:k})},_uiSetY:function(k){g.log("_uiSetY");k!==undefined&&this.get("el").offset({top:k})},_uiSetVisible:function(k){if(k!==undefined){g.log("_uiSetVisible");
this.get("el").css("visibility",k?"visible":"hidden");this[k?"_bindKey":"_unbindKey"]();this.fire(k?"show":"hide")}},_bindKey:function(){r.on(t,"keydown",this._esc,this)},_unbindKey:function(){r.remove(t,"keydown",this._esc,this)},_esc:function(k){k.keyCode===27&&this.hide()},move:function(k,o){if(g.isArray(k)){o=k[1];k=k[0]}this.set("xy",[k,o])},show:function(){this._firstShow()},_firstShow:function(){this.renderer();this._realShow();this._firstShow=this._realShow},_realShow:function(){this.set("visible",
true)},hide:function(){this.set("visible",false)},__destructor:function(){g.log("position __destructor")}};g.Ext.Position=p});
KISSY.add("ext-shim",function(g){function p(){g.log("shim init");this.on("renderUI",this._renderUIShimExt,this);this.on("bindUI",this._bindUIShimExt,this);this.on("syncUI",this._syncUIShimExt,this)}g.namespace("Ext");var t=g.Node;p.prototype={_syncUIShimExt:function(){g.log("_syncUIShimExt")},_bindUIShimExt:function(){g.log("_bindUIShimExt")},_renderUIShimExt:function(){g.log("_renderUIShimExt");var r=this.get("el"),k=new t("<iframe style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth);top: 0;opacity: 0;filter: alpha(opacity=0);left: 0;z-index: -1;height: expression(this.parentNode.offsetHeight);'>");
r.prepend(k)},__destructor:function(){g.log("shim __destructor")}};g.Ext.Shim=p});
KISSY.add("ext-stdmod",function(g){function p(){g.log("stdmod init");this.on("renderUI",this._renderUIStdMod,this);this.on("syncUI",this._syncUIStdMod,this);this.on("bindUI",this._bindUIStdMod,this)}g.namespace("Ext");var t=g.Node;p.ATTRS={header:{},body:{},footer:{},bodyStyle:{},headerContent:{value:false},bodyContent:{value:false},footerContent:{value:false}};p.HTML_PARSER={header:".ks-stdmod-header",body:".ks-stdmod-body",footer:".ks-stdmod-footer"};p.prototype={_bindUIStdMod:function(){g.log("_bindUIStdMod")},
_syncUIStdMod:function(){g.log("_syncUIStdMod")},_setStdModContent:function(r,k){if(k!==false)if(g.isString(k))this.get(r).html(k);else{this.get(r).html("");this.get(r).append(k)}},_uiSetBodyStyle:function(r){r!==undefined&&this.get("body").css(r)},_uiSetBodyContent:function(r){g.log("_uiSetBodyContent");this._setStdModContent("body",r)},_uiSetHeaderContent:function(r){g.log("_uiSetHeaderContent");this._setStdModContent("header",r)},_uiSetFooterContent:function(r){g.log("_uiSetFooterContent");this._setStdModContent("footer",
r)},_renderUIStdMod:function(){g.log("_renderUIStdMod");var r=this.get("contentEl"),k=this.get("header"),o=this.get("body"),n=this.get("footer");this.get("headerContent");this.get("bodyContent");this.get("footerContent");if(!k){k=(new t("<div class='ks-stdmod-header'>")).appendTo(r);this.set("header",k)}if(!o){o=(new t("<div class='ks-stdmod-body'>")).appendTo(r);this.set("body",o)}if(!n){n=(new t("<div class='ks-stdmod-footer'>")).appendTo(r);this.set("footer",n)}},__destructor:function(){g.log("stdmod __destructor")}};
g.Ext.StdMod=p});KISSY.Editor.add("ext",function(){});
KISSY.Editor.add("fakeobjects",function(g){var p=KISSY.Editor,t=KISSY,r=t.Node,k=p.NODE,o=p.Config.base+"theme/spacer.gif",n=p.HtmlParser;p=t.Editor;var m=(g=g.htmlDataProcessor)&&g.htmlFilter,l={elements:{$:function(c){var f=c.attributes;if((f=(f=(f=f&&f._ke_realelement)&&new n.Fragment.FromHtml(decodeURIComponent(f)))&&f.children[0])&&c.attributes._ke_resizable){var e=c.attributes.style;if(e){var i=/(?:^|\s)width\s*:\s*(\d+)/i.exec(e);c=i&&i[1];e=(i=/(?:^|\s)height\s*:\s*(\d+)/i.exec(e))&&i[1];
if(c)f.attributes.width=c;if(e)f.attributes.height=e}}return f}}};m&&m.addRules(l);g&&t.mix(g,{createFakeParserElement:function(c,f,e,i,w){var j;j=new n.BasicWriter;c.writeHtml(j);j=j.getHtml();var b=c.attributes.style;if(c.attributes.width)b="width:"+c.attributes.width+"px;"+b;if(c.attributes.height)b="height:"+c.attributes.height+"px;"+b;c={"class":f,src:o,_ke_realelement:encodeURIComponent(j),_ke_real_node_type:c.type,style:b,align:c.attributes.align||""};w&&delete w.width;w&&delete w.height;w&&
t.mix(c,w,false);if(e)c._ke_real_element_type=e;if(i)c._ke_resizable=i;return new n.Element("img",c)}});t.augment(p,{createFakeElement:function(c,f,e,i,w,j){var b=c.attr("style")||"";if(c.attr("width"))b="width:"+c.attr("width")+"px;"+b;if(c.attr("height"))b="height:"+c.attr("height")+"px;"+b;c={"class":f,src:o,_ke_realelement:encodeURIComponent(w||c._4e_outerHtml()),_ke_real_node_type:c[0].nodeType,style:b};j&&delete j.width;j&&delete j.height;j&&t.mix(c,j,false);if(e)c._ke_real_element_type=e;if(i)c._ke_resizable=
i;return new r("<img/>",c,this.document)},restoreRealElement:function(c){if(c.attr("_ke_real_node_type")!=k.NODE_ELEMENT)return null;c=decodeURIComponent(c.attr("_ke_realelement"));var f=new r("<div>",null,this.document);f.html(c);return f._4e_first(function(e){return e[0].nodeType==k.NODE_ELEMENT})._4e_remove()}})});
KISSY.Editor.add("flash",function(g){g.ready(function(){var p=KISSY,t=p.Editor,r=g.htmlDataProcessor,k=g.cfg.pluginConfig,o=r&&r.dataFilter;o&&o.addRules({elements:{object:function(n){var m=n.attributes;if(!(m.classid&&String(m.classid).toLowerCase())){for(m=0;m<n.children.length;m++)if(n.children[m].name=="embed"){if(!t.Utils.isFlashEmbed(n.children[m]))break;return r.createFakeParserElement(n,"ke_flash","flash",true)}return null}return r.createFakeParserElement(n,"ke_flash","flash",true)},embed:function(n){if(!t.Utils.isFlashEmbed(n))return null;
return r.createFakeParserElement(n,"ke_flash","flash",true)}}},5);t.use("flash/support",function(){var n=t.Flash;g.addCommand("insertFlash",{exec:function(){var m=p.makeArray(arguments);return t.Flash.Insert.apply(null,m)}});if(!k.flash||k.flash.btn!==false)new n(g)})})});
KISSY.Editor.add("flash/support",function(){function g(i){this.editor=i;this._init()}function p(i){return i._4e_name()==="img"&&!!i.hasClass(c)&&i}var t=KISSY.Editor,r=KISSY,k=r.UA,o=r.Event,n=t.ContextMenu,m=r.Node,l=t.BubbleView,c="ke_flash",f=t.Utils.flash;r.augment(g,{_config:function(){this._cls=c;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=e;this._flashRules=["img."+c]},_init:function(){this._config();var i=this,w=i.editor,j={},b=i._contextMenu;
w.addButton("flash",{contentCls:i._contentCls,title:i._tip,offClick:function(){i.show()}});if(b)for(var d in b)(function(h){j[h]=function(){b[h](i)}})(d);n.register({editor:w,rules:i._flashRules,width:"120px",funcs:j});l.attach({pluginName:i._type,editor:i.editor,pluginContext:i});o.on(w.document,"dblclick",i._dbclick,i)},_getFlashUrl:function(i){return f.getUrl(i)},_updateTip:function(i,w){var j=this.editor.restoreRealElement(w);if(j){j=this._getFlashUrl(j);i.html(j);i.attr("href",j)}},_dbclick:function(i){var w=
new m(i.target);if(w._4e_name()==="img"&&w.hasClass(this._cls)){this.show(null,w);i.halt()}},show:function(i,w){this.editor.useDialog(this._type+"/dialog",function(j){j.show(w)})}});t.Flash=g;g.registerBubble=function(i,w,j){l.register({pluginName:i,func:j,init:function(){var b=this,d=b.get("contentEl");d.html(w+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=d.one(".ke-bubbleview-url"),s=d.one(".ke-bubbleview-change"),y=d.one(".ke-bubbleview-remove");t.Utils.preventFocus(d);s.on("click",function(x){b._plugin.show(null,b._selectedEl);x.halt()});y.on("click",function(x){var u=b._plugin;if(k.webkit){var q=u.editor.getSelection().getRanges();q&&q[0]&&(q[0].collapse(true)||1)&&q[0].select()}b._selectedEl._4e_remove();b.hide();u.editor.notifySelectionChange();x.halt()});b.on("show",function(){var x=b._selectedEl;x&&b._plugin._updateTip(h,x)})}})};g.registerBubble("flash",
"Flash \u7f51\u5740\uff1a ",p);g.checkFlash=p;var e={"Flash\u5c5e\u6027":function(i){var w=i.editor.getSelection();w=w&&w.getStartElement();(w=p(w))&&i.show(null,w)}};g.CLS_FLASH=c;g.TYPE_FLASH="flash";g.Insert=function(i,w,j,b,d){w=f.createSWF(w,{attrs:j},i.document);var h=w.el;j=i.createFakeElement?i.createFakeElement(h,b||"ke_flash",d||"flash",true,w.html,j):h;return j=i.insertElement(j)};t.Flash=g});
KISSY.Editor.add("flashbridge",function(){function g(f){this._init(f)}function p(f){var e=r.isString(f)?f.match(/(\d)+/g):f;f=f;if(r.isArray(e))f=parseFloat(e[0]+"."+t(e[1],3)+t(e[2],5));return f||0}function t(f,e){for(var i=(f+"").length;i++<e;)f="0"+f;return f}var r=KISSY,k=r.Editor;if(!k.FlashBridge){var o={};r.augment(g,r.EventTarget,{_init:function(f){var e=r.guid("flashbridge-");f.flashVars=f.flashVars||{};f.attrs=f.attrs||{};f.params=f.params||{};var i=f.flashVars,w=f.params;r.mix(f.attrs,
{id:e,width:"100%",height:"100%"},false);r.mix(w,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);r.mix(i,{shareData:false,useCompression:false},false);w={YUISwfId:e,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(f.ajbridge)w={swfID:e,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};r.mix(i,w);o[e]=this;this.id=e;this.swf=k.Utils.flash.createSWFRuntime(f.movie,f);this._expose(f.methods)},_expose:function(f){for(var e=this,i=0;i<f.length;i++)(function(w){e[w]=
function(){return e._callSWF(w,r.makeArray(arguments))}})(f[i])},_callSWF:function(f,e){e=e||[];try{if(this.swf[f])return this.swf[f].apply(this.swf,e)}catch(i){var w="";if(e.length!==0)w="'"+e.join("', '")+"'";return(new Function("self","return self.swf."+f+"("+w+");"))(this)}},_eventHandler:function(f){var e=f.type;if(e==="log")r.log(f.message);else e&&this.fire(e,f)},_destroy:function(){delete o[this.id]}});g.EventHandler=function(f,e){var i=o[f];i&&setTimeout(function(){i._eventHandler.call(i,
e)},100)};k.FlashBridge=g;var n=r.UA,m,l,c=true;n.fpv=function(f){if(f||c){c=false;var e;if(navigator.plugins&&navigator.mimeTypes.length)e=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(i){}m=e?e.match(/(\d)+/g):void 0;l=p(m)}return m};n.fpvGEQ=function(f,e){c&&n.fpv(e);return!!l&&l>=p(f)}}});
KISSY.Editor.add("flashutils",function(){var g=KISSY,p=g.Editor,t=p.Utils.flash;if(!t){var r=g.DOM,k=g.Node,o=g.UA;t={getUrl:function(n){var m="",l=p.NODE;if(n._4e_name()=="object"){n=n[0].childNodes;for(var c=0;c<n.length;c++)if(n[c].nodeType==l.NODE_ELEMENT)if((r.attr(n[c],"name")||"").toLowerCase()=="movie")m=r.attr(n[c],"value");else if(r._4e_name(n[c])=="embed")m=r.attr(n[c],"src");else if(r._4e_name(n[c])=="object")m=r.attr(n[c],"data")}else if(n._4e_name()=="embed")m=n.attr("src");return m},
createSWF:function(n,m,l){var c=m.attrs||{},f=m.flashVars,e="",i="";m=m.params||{};var w="";l=l||document;g.mix(c,{wmode:"transparent"});for(var j in c)if(c.hasOwnProperty(j))e+=j+"='"+c[j]+"' ";g.mix(m,{quality:"high",movie:n,wmode:"transparent"});for(var b in m)if(m.hasOwnProperty(b))i+="<param name='"+b+"' value='"+m[b]+"'/>";if(f){for(var d in f)if(f.hasOwnProperty(d))w+="&"+d+"="+encodeURIComponent(f[d]);w=w.substring(1)}n="<object "+e+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
i+(w?'<param name="flashVars" value="'+w+'"/>':"")+"<embed "+e+" "+(w?'FlashVars="'+w+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+n+'"  type="application/x-shockwave-flash"/></object>';return{el:new k(n,null,l),html:n}},createSWFRuntime2:function(n,m,l){l=l||document;var c=(new k("<div style='width:0;height:0;overflow:hidden;'>",null,l)).appendTo(l.body);c=t.createSWF.apply(this,arguments).el.appendTo(c);o.ie||(c=c.one("object"));return c[0]},createSWFRuntime:function(n,
m,l){var c=m.attrs||{},f=m.flashVars||{},e=m.params||{},i="",w="",j="";l=l||document;c.id=c.id||g.guid("ke-runtimeflash-");for(var b in c)if(c.hasOwnProperty(b))i+=b+"='"+c[b]+"' ";for(var d in e)if(e.hasOwnProperty(d))w+="<param name='"+d+"' value='"+e[d]+"'/>";for(var h in f)if(f.hasOwnProperty(h))j+="&"+h+"="+encodeURIComponent(f[h]);j=j.substring(1);n=o.ie?"<object "+i+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+w+'<param name="movie" value="'+n+'" />'+(j?'<param name="flashVars" value="'+
j+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+n+"' "+i+">"+w+(j?'<param name="flashVars" value="'+j+'"/>':"")+"</object>";var s=m.holder;if(!s){s=(new k("<div style='"+(m.style?m.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,l)).appendTo(l.body);setTimeout(function(){s.offset({left:r.scrollLeft(),top:r.scrollTop()})},100)}s.html(n);return l.getElementById(c.id)}};p.Utils.flash=t}});
KISSY.Editor.add("font",function(g){function p(y){for(var x=[],u=0;u<y.length;u++)x.push({name:y[u],value:y[u]});return x}var t=KISSY,r=t.Editor,k=r.Style,o=r.TripleButton,n=g.cfg.pluginConfig,m=t.Node,l=n["font-size"],c,f,e;if(l!==false){l=l||{};t.mix(l,{items:p(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var i={},w=[],j={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(s=0;s<l.items.length;s++){c=
l.items[s];f=c.name;e=c.attrs;c=c.value;i[c]=new k(j,{size:c});w.push({name:f,value:c,attrs:e})}n["font-size"]=l}var b=n["font-family"];if(b!==false){b=b||{};t.mix(b,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},
{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var d={},h=[];j={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};var s;n["font-family"]=b;for(s=0;s<b.items.length;s++){c=b.items[s];f=c.name;e=c.attrs||{};c=c.value;e.style=e.style||"";e.style+=";font-family:"+c;d[c]=new k(j,{family:c});h.push({name:f,value:c,attrs:e})}}r.FontSelect||function(){function y(u){y.superclass.constructor.call(this,u);this._init()}
y.ATTRS={title:{},html:{},styles:{},editor:{}};var x=r.Select;t.extend(y,t.Base,{_init:function(){var u=this.get("editor"),q=u.toolBarDiv;this.get("html");this.el=new x({container:q,doc:u.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new m(document.body)});this.el.on("click",this._vChange,this);u.on("selectionChange",this._selectionChange,this);r.Utils.sourceDisable(u,this)},disable:function(){this.el.set("state",
x.DISABLED)},enable:function(){this.el.set("state",x.ENABLED)},_vChange:function(u){var q=this.get("editor"),A=u.newVal;u=u.prevVal;var B=this.get("styles");q.focus();q.fire("save");B=B[A];if(A==u){B.remove(q.document);this.el.set("value","")}else B.apply(q.document);q.fire("save")},_selectionChange:function(u){this.get("editor");u=u.path.elements;for(var q=this.get("styles"),A=0,B;A<u.length;A++){B=u[A];for(var C in q)if(q[C].checkElementRemovable(B,true)){this.el.set("value",C);return}}this.el.reset("value")}});
r.FontSelect=y}();g.ready(function(){false!==n["font-size"]&&new r.FontSelect({editor:g,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:l.width,styles:i,html:w});false!==n["font-family"]&&new r.FontSelect({editor:g,title:"\u5b57\u4f53",width:"110px",popUpWidth:b.width,styles:d,html:h});var y={mode:r.WYSIWYG_MODE,offClick:function(){var x=this.editor,u=this.cfg.style;x.fire("save");u.apply(x.document);x.fire("save");x.notifySelectionChange();x.focus()},onClick:function(){var x=this.editor,u=this.cfg.style;
x.fire("save");u.remove(x.document);x.fire("save");x.notifySelectionChange();x.focus()},selectionChange:function(x){var u=this.btn;this.cfg.style.checkActive(x.path)?u.set("state",o.ON):u.set("state",o.OFF)}};false!==n["font-bold"]&&g.addButton("font-bold",t.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",style:new k({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},y));false!==n["font-italic"]&&g.addButton("font-italic",t.mix({contentCls:"ke-toolbar-italic",
title:"\u659c\u4f53 ",style:new k({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},y));false!==n["font-underline"]&&g.addButton("font-underline",t.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new k({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})},y));false!==n["font-strikeThrough"]&&g.addButton("font-underline",t.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new k({element:"del",overrides:[{element:"span",
attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})},y))})});
KISSY.Editor.add("format",function(g){var p=KISSY.Editor,t=KISSY,r=t.Node,k=[],o={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},n={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},m={},l=p.Style,c;for(c in o)if(o[c]){m[o[c]]=new l({element:o[c]});k.push({name:c,value:o[c],attrs:{style:"font-size:"+n[o[c]]}})}p.Format||function(){function f(i){f.superclass.constructor.call(this,i);this._init()}f.ATTRS={editor:{}};var e=p.Select;t.extend(f,t.Base,
{_init:function(){var i=this.get("editor");this.el=new e({container:i.toolBarDiv,value:"",doc:i.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new r(document.body)});this.el.on("click",this._vChange,this);i.on("selectionChange",this._selectionChange,this);p.Utils.sourceDisable(i,this)},disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.ENABLED)},_vChange:function(i){var w=this.get("editor"),
j=i.newVal;i=i.prevVal;w.fire("save");if(j!=i)m[j].apply(w.document);else{m.p.apply(w.document);this.el.set("value","p")}w.fire("save")},_selectionChange:function(i){this.get("editor");i=i.path;for(var w in m)if(m[w].checkActive(i)){this.el.set("value",w);return}this.el.reset("value")}});p.Format=f}();g.ready(function(){new p.Format({editor:g,html:k,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(g){var p=p,t=KISSY,r=t.Editor,k=t.Node,o=t.UA,n=r.NODE,m=r.HtmlParser,l=new m.Filter,c=new m.Filter,f=r.XHTML_DTD;if(!g.htmlDataProcessor){(function(){var e=r.HtmlParser.Fragment.prototype,i=r.HtmlParser.Element.prototype;e.onlyChild=i.onlyChild=function(){var w=this.children;return w.length==1&&w[0]||null};i.removeAnyChildWithName=function(w){for(var j=this.children,b=[],d,h=0;h<j.length;h++){d=j[h];if(d.name){if(d.name==w){b.push(d);j.splice(h--,1)}b=
b.concat(d.removeAnyChildWithName(w))}}return b};i.getAncestor=function(w){for(var j=this.parent;j&&!(j.name&&j.name.match(w));)j=j.parent;return j};e.firstChild=i.firstChild=function(w){for(var j,b=0;b<this.children.length;b++){j=this.children[b];if(w(j))return j;else if(j.name)if(j=j.firstChild(w))return j}return null};i.addStyle=function(w,j,b){var d="";if(typeof j=="string")d+=w+":"+j+";";else{if(typeof w=="object")for(var h in w){if(w.hasOwnProperty(h))d+=h+":"+w[h]+";"}else d+=w;b=j}if(!this.attributes)this.attributes=
{};w=this.attributes.style||"";w=(b?[d,w]:[w,d]).join(";");this.attributes.style=w.replace(/^;|;(?=;)/,"")};f.parentOf=function(w){var j={},b;for(b in this)if(b.indexOf("$")==-1&&this[b][w])j[b]=1;return j}})();(function(){function e(q){if(/mso-list\s*:\s*Ignore/i.test(q.attributes&&q.attributes.style))return true;return p}function i(q,A){var B=new r.HtmlParser.Element("ke:listbullet"),C;if(q)if(q[2]){q=isNaN(q[1])?/^[a-z]+$/.test(q[1])?"lower-alpha":/^[A-Z]+$/.test(q[1])?"upper-alpha":"decimal":
"decimal";C="ol"}else{q=/[l\u00B7\u2002]/.test(q[1])?"disc":/[\u006F\u00D8]/.test(q[1])?"circle":/[\u006E\u25C6]/.test(q[1])?"square":"disc";C="ul"}else{q="decimal";C="ol"}B.attributes={"ke:listtype":C,style:"list-style-type:"+q+";"};B.add(new r.HtmlParser.Text(A));return B}function w(q){var A=q.attributes,B;if((B=q.removeAnyChildWithName("ke:listbullet"))&&B.length&&(B=B[0])){q.name="ke:li";if(A.style)A.style=j([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(C){C=C.split(" ");
C=C[3]||C[1]||C[0];C=parseInt(C,10);if(!h&&s&&C>s)h=C-s;A["ke:margin"]=s=C}]],p)(A.style,q)||"";B=B.attributes;q.addStyle(B.style);t.mix(A,B);return true}return false}function j(q,A){return function(B,C){var v=[];B.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(E,F,D){F=F.toLowerCase();F=="font-family"&&(D=D.replace(/["']/g,""));for(var G,M,N,Q=0;Q<q.length;Q++)if(q[Q]){E=q[Q][0];G=q[Q][1];M=q[Q][2];N=q[Q][3];if(F.match(E)&&(!G||D.match(G))){F=N||F;A&&(M=M||D);if(typeof M==
"function")M=M(D,C,F);if(M&&M.push){F=M[0];M=M[1]}typeof M=="string"&&v.push([F,M]);return}}!A&&v.push([F,D])});for(var z=0;z<v.length;z++)v[z]=v[z].join(":");return v.length?v.join(";")+";":false}}function b(q){q=q.children;for(var A,B,C,v,z,E,F,D=0;D<q.length;D++){A=q[D];if("ke:li"==A.name){A.name="li";A=A;B=A.attributes;C=A.attributes["ke:listtype"];v=parseInt(B["ke:indent"],10)||h&&Math.ceil(B["ke:margin"]/h)||1;B.style&&(B.style=j([["list-style-type",C=="ol"?"decimal":"disc"]],p)(B.style)||"");
if(E){if(v>F){E=new r.HtmlParser.Element(C);E.add(A);z.add(E)}else{if(v<F){z=F-v;for(var G;z--&&(G=E.parent);)E=G.parent}E.add(A)}q.splice(D--,1)}else{E=new r.HtmlParser.Element(C);E.add(A);q[D]=E}z=A;F=v}else E=null}h=0}var d=j([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],p),h,s=0,y=f.parentOf("ol"),x={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(q){q.filterChildren();
b(q)},elements:{font:function(q){delete q.name},p:function(q){q.filterChildren();if(w(q))return p},$:function(q){var A=q.name||"";A.indexOf(":")!=-1&&A.indexOf("ke")==-1&&delete q.name;var B=q.attributes.style;if(A=="span"&&(!B||!d(B)))delete q.name;if(A in y){q.filterChildren();b(q)}},span:function(q){if(!o.gecko&&e(q.parent))return false;if(!o.gecko&&e(q)){q=(q=q.firstChild(function(B){return B.value||B.name=="img"}))&&(q.value||"l.");var A=q.match(/^([^\s]+?)([.)]?)$/);return i(A,q)}},a:function(q){q=
q.attributes;if(q.href)q._ke_saved_href=q.href}},comment:!o.ie?function(q,A){var B=q.match(/<img.*?>/),C=q.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(C){C=(B=C[1]||B&&"l.")&&B.match(/>([^\s]+?)([.)]?)</);return i(C,B)}if(o.gecko&&B){B=r.HtmlParser.Fragment.FromHtml(B[0]).children[0];(C=(C=(C=A.previous)&&C.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&C[1])&&(B.attributes.src=C);return B}return false}:function(){return false},attributes:{"class":function(q){if(/(^|\s+)ke_/.test(q))return q;
return false},style:function(q){q=d(q);if(!q)return false;return q}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},u={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(q){var A=q.parent;if(A&&A.name=="object"){var B=A.attributes.width;A=A.attributes.height;B&&(q.attributes.width=B);A&&(q.attributes.height=A)}},param:function(q){q.children=[];q.isEmpty=true;return q},a:function(q){if(!(q.children.length||q.attributes.name))return false;q=q.attributes;if(q._ke_saved_href)q.href=
q._ke_saved_href},td:function(q){for(var A=q.children,B=0;B<A.length;B++)if(A[B].name=="br"){A.splice(B,1);--B}if(!q.children.length){A=new r.HtmlParser.Text("&nbsp;");q.children.push(A)}},span:function(q){if(!q.children.length)return false}},attributes:{style:function(q){if(!t.trim(q))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(o.ie)u.attributes.style=function(q){return q.toLowerCase()};l.addRules(u);c.addRules(x)})();(function(){function e(u){for(var q=u.children.length,
A=u.children[q-1];A&&A.type==n.NODE_TEXT&&!t.trim(A.value);)A=u.children[--q];return A}function i(u){var q=e(u);return!q||q.type==n.NODE_ELEMENT&&q.name=="br"||u.name=="form"&&q.name=="input"}function w(u,q){var A=u.children,B=e(u);if(B){if((q||!o.ie)&&B.type==n.NODE_ELEMENT&&B.name=="br")A.pop();B.type==n.NODE_TEXT&&d.test(B.value)&&A.pop()}}function j(u){w(u,true);if(i(u))o.ie?u.add(new r.HtmlParser.Text("\u00a0")):u.add(new r.HtmlParser.Element("br",{}))}function b(u){w(u);i(u)&&u.add(new r.HtmlParser.Text("\u00a0"))}
var d=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,h=r.XHTML_DTD,s=r.Utils.mix({},h.$block,h.$listItem,h.$tableContent),y;for(y in s)"br"in h[y]||delete s[y];delete s.pre;h={elements:{}};var x={elements:{}};for(y in s){h.elements[y]=j;x.elements[y]=b}c.addRules(h);l.addRules(x)})();(function(){l.addRules({text:function(e){return e.replace(/\xa0/g,"&nbsp;")}})})();g.htmlDataProcessor={htmlFilter:l,dataFilter:c,toHtml:function(e,i){var w=new m.HtmlWriter;m.Fragment.FromHtml(e,i).writeHtml(w,l);return w.getHtml(true)},
toDataFormat:function(e,i){if(o.gecko)e=e.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var w=new k("<div>");w.html("a"+e);e=w.html().substr(1);w=new m.BasicWriter;var j=m.Fragment.FromHtml(e,i);w.reset();j.writeHtml(w,c);return w.getHtml(true)},toServer:function(e,i){var w=new m.BasicWriter;m.Fragment.FromHtml(e,i).writeHtml(w,l);return w.getHtml(true)}}}});
KISSY.Editor.add("image",function(g){var p=KISSY,t=p.Editor,r=p.UA,k=p.Node,o=p.Event,n=t.BubbleView,m=function(l){return l._4e_name()==="img"&&!/(^|\s+)ke_/.test(l[0].className)&&l};g.ready(function(){var l=g.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",offClick:function(){this.call("show")},_updateTip:function(i,w){var j=w.attr("src");i.html(j);i.attr("href",j)},show:function(i,w){this.editor.useDialog("image/dialog",function(j){j.show(w)})}}),c={"\u56fe\u7247\u5c5e\u6027":function(i){i=(i=i.getSelection())&&
i.getStartElement();(i=m(i))&&l.call("show",null,i)}},f={},e;for(e in c)(function(i){f[i]=function(){c[i](g)}})(e);t.ContextMenu.register({editor:g,rules:[m],width:"120px",funcs:f});o.on(g.document,"dblclick",function(i){var w=new k(i.target);i.halt();m(w)&&l.call("show",null,w)});n.register({pluginName:"image",pluginContext:l,editor:g,func:m,init:function(){var i=this,w=i.get("contentEl");w.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var j=w.one(".ke-bubbleview-url"),b=w.one(".ke-bubbleview-change"),d=w.one(".ke-bubbleview-remove");t.Utils.preventFocus(w);b.on("click",function(h){i._plugin.call("show",null,i._selectedEl);h.halt()});d.on("click",function(h){var s=i._plugin;if(r.webkit){var y=s.editor.getSelection().getRanges();y&&y[0]&&(y[0].collapse(true)||1)&&y[0].select()}i._selectedEl._4e_remove();i.hide();s.editor.notifySelectionChange();h.halt()});i.on("show",function(){var h=i._selectedEl;h&&i._plugin.call("_updateTip",
j,h)})}})})});KISSY.Editor.add("indent",function(g){var p=KISSY.Editor;g.ready(function(){var t=g.addButton("outdent",{title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-outdent",type:"outdent",loading:true}),r=g.addButton("indent",{title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-indent",type:"indent",loading:true});p.use("indent/support",function(){t.reload(p.IndentSupport);r.reload(p.IndentSupport)});g.addCommand("indent",{exec:function(){r.call("offClick")}});g.addCommand("outdent",{exec:function(){t.call("offClick")}})})});
KISSY.Editor.add("indent/support",function(){function g(j){this.type=j;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function p(j){return j[0].nodeType==e.NODE_ELEMENT&&j._4e_name()=="li"}function t(j,b){for(var d=j.startContainer,h=j.endContainer;d&&!d.parent()._4e_equals(b);)d=d.parent();for(;h&&!h.parent()._4e_equals(b);)h=h.parent();if(d&&h){var s=d;d=[];for(var y=false;!y;){if(s._4e_equals(h))y=true;d.push(s);s=s.next()}if(!(d.length<1)){s=b._4e_parents(true);
for(h=0;h<s.length;h++)if(o[s[h]._4e_name()]){b=s[h];break}s=this.type=="indent"?1:-1;h=d[0];y=d[d.length-1];d={};var x=k.ListUtils.listToArray(b,d),u=x[y.data("listarray_index")].indent;for(h=h.data("listarray_index");h<=y.data("listarray_index");h++){x[h].indent+=s;var q=x[h].parent;x[h].parent=new c(q[0].ownerDocument.createElement(q._4e_name()))}for(h=y.data("listarray_index")+1;h<x.length&&x[h].indent>u;h++)x[h].indent+=s;y=k.ListUtils.arrayToList(x,d,null,"p",0);s=[];if(this.type=="outdent"){var A;
if((A=b.parent())&&A._4e_name()=="li"){x=y.listNode.childNodes;var B;for(h=x.length-1;h>=0;h--)if((B=new c(x[h]))&&B._4e_name()=="li")s.push(B)}}if(y){l.insertBefore(y.listNode,b);b._4e_remove()}if(s&&s.length)for(h=0;h<s.length;h++){for(y=B=s[h];(y=y.next())&&y._4e_name()in o;){f.ie&&!B._4e_first(function(C){return i(C)&&w(C)})&&B[0].appendChild(j.document.createTextNode("\u00a0"));B[0].appendChild(y[0])}l.insertAfter(B[0],A[0])}k.Utils.clearAllMarkers(d)}}}function r(j){var b=parseInt(j._4e_style(this.indentCssProperty),
10);if(isNaN(b))b=0;b+=(this.type=="indent"?1:-1)*this.indentOffset;if(b<0)return false;b=Math.max(b,0);b=Math.ceil(b/this.indentOffset)*this.indentOffset;j.css(this.indentCssProperty,b?b+this.indentUnit:"");j[0].style.cssText===""&&j.removeAttr("style");return true}var k=KISSY.Editor,o={ol:1,ul:1},n=KISSY,m=k.Walker,l=n.DOM,c=n.Node,f=n.UA,e=k.NODE,i=m.whitespaces(true),w=m.bookmark(false,true);n.augment(g,{exec:function(j){for(var b=(j=j.getSelection())&&j.getRanges()[0],d=b.startContainer,h=b.endContainer,
s=b.getCommonAncestor();s&&!(s[0].nodeType==e.NODE_ELEMENT&&o[s._4e_name()]);)s=s.parent();if(s&&d[0].nodeType==e.NODE_ELEMENT&&d._4e_name()in o){d=new m(b);d.evaluator=p;b.startContainer=d.next()}if(s&&h[0].nodeType==e.NODE_ELEMENT&&h._4e_name()in o){d=new m(b);d.evaluator=p;b.endContainer=d.previous()}h=j.createBookmarks(true);if(s){for(d=s._4e_first();d&&d._4e_name()!="li";)d=d.next();var y=b.startContainer;(d[0]==y[0]||d.contains(y))&&r.call(this,s)||t.call(this,b,s)}else{b=b.createIterator();
b.enforceRealBlocks=true;for(b.enlargeBr=true;s=b.getNextParagraph();)r.call(this,s)}j.selectBookmarks(h)}});k.IndentSupport={init:function(){this.indentCommand=new g(this.cfg.type)},offClick:function(){var j=this,b=j.editor;b.fire("save");setTimeout(function(){j.indentCommand.exec(b);b.fire("save");b.notifySelectionChange()},10)},selectionChange:function(j){if(this.cfg.type=="outdent"){var b=j.path,d=b.blockLimit;j=this.btn;if(b.contains(o))j.boff();else(b=b.block||d)&&b._4e_style(this.indentCommand.indentCssProperty)?
j.boff():j.disable()}}}});
KISSY.Editor.add("justify",function(g){var p=KISSY,t=p.Editor.TripleButton,r=/(-moz-|-webkit-|start|auto)/gi;g.ready(function(){var k={offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var o=this.editor,n=o.getSelection(),m=this.btn.get("state");if(n){var l=n.createBookmarks(),c=n.getRanges(),f,e;o.fire("save");for(var i=c.length-1;i>=0;i--){f=c[i].createIterator();for(f.enlargeBr=true;e=f.getNextParagraph();){e.removeAttr("align");m==t.OFF?e.css("text-align",
this.cfg.v):e.css("text-align","")}}o.notifySelectionChange();n.selectBookmarks(l);o.fire("save")}},selectionChange:function(o){var n=this.btn;o=o.path;o=o.block||o.blockLimit;if(!o||o._4e_name()==="body")n.boff();else(o.css("text-align").replace(r,"")||"left")==this.cfg.v?n.bon():n.boff()}};g.addButton("alignleft",p.mix({contentCls:"ke-toolbar-alignleft",title:"\u5de6\u5bf9\u9f50",v:"left"},k));g.addButton("aligncenter",p.mix({contentCls:"ke-toolbar-aligncenter",title:"\u5c45\u4e2d\u5bf9\u9f50",v:"center"},k));g.addButton("alignright",
p.mix({contentCls:"ke-toolbar-alignright",title:"\u53f3\u5bf9\u9f50",v:"right"},k))})});
KISSY.Editor.add("link",function(g){function p(n){return n._4e_ascendant(function(m){return m._4e_name()==="a"&&!!m.attr("href")},true)}var t=KISSY.Editor,r=t.Style,k=t.BubbleView,o={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};g.ready(function(){var n=g.addButton("link",{contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:t.WYSIWYG_MODE,_getSelectedLink:function(){var m=this.editor.getSelection();if(m=m&&m.getStartElement())m=p(m);return m},
_getSelectionLinkUrl:function(){var m=this.cfg._getSelectedLink.call(this);if(m)return m.attr("_ke_saved_href")||m.attr("href")},_removeLink:function(m){var l=this.editor;l.fire("save");var c=l.getSelection(),f=c.getRanges()[0];if(f&&f.collapsed){f=c.createBookmarks();m._4e_remove(true);c.selectBookmarks(f)}else if(f){m=m[0];c=m.attributes;f={};for(var e=0;e<c.length;e++){var i=c[e];if(i.specified)f[i.name]=i.value}if(m.style.cssText)f.style=m.style.cssText;(new r(o,f)).remove(l.document)}l.fire("save");
l.notifySelectionChange()},_link:function(m){var l=this.editor,c=this.cfg._getSelectedLink.call(this);m._ke_saved_href=m.href;if(c){l.fire("save");c.attr(m);l.fire("save")}else{c=(c=l.getSelection())&&c.getRanges()[0];if(!c||c.collapsed){a=new Node("<a>"+url+"</a>",m,l.document);l.insertElement(a)}else{l.fire("save");(new r(o,m)).apply(l.document);l.fire("save")}}l.notifySelectionChange()},offClick:function(){var m=this;m.editor.useDialog("link/dialog",function(l){l.show(m)})}});k.register({pluginName:"link",
editor:g,pluginContext:n,func:p,init:function(){var m=this,l=m.get("contentEl");l.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var c=l.one(".ke-bubbleview-url"),f=l.one(".ke-bubbleview-change"),e=l.one(".ke-bubbleview-remove");t.Utils.preventFocus(l);f.on("click",function(i){m._plugin.call("offClick");i.halt()});e.on("click",function(i){m._plugin.call("_removeLink",
m._selectedEl);i.halt()});m.on("show",function(){var i=m._selectedEl;if(i){i=i.attr("_ke_saved_href")||i.attr("href");c.html(i);c.attr("href",i)}})}})})});KISSY.Editor.add("list",function(g){var p=KISSY.Editor;g.ready(function(){var t=g.addButton("ul",{title:"\u9879\u76ee\u5217\u8868",contentCls:"ke-toolbar-ul",loading:true,type:"ul"}),r=g.addButton("ol",{title:"\u7f16\u53f7\u5217\u8868",contentCls:"ke-toolbar-ol",loading:true,type:"ol"});p.use("list/support",function(){t.reload(p.ListSupport);r.reload(p.ListSupport)})})});
KISSY.Editor.add("list/support",function(){function g(b){this.type=b}var p=KISSY.Editor,t={ol:1,ul:1},r=["ol","ul"],k=KISSY,o=p.RANGE,n=p.ElementPath,m=p.Walker,l=p.NODE,c=k.UA,f=k.Node,e=k.DOM,i={listToArray:function(b,d,h,s,y){if(!t[b._4e_name()])return[];s||(s=0);h||(h=[]);for(var x=0,u=b[0].childNodes.length;x<u;x++){var q=new f(b[0].childNodes[x]);if(q._4e_name()=="li"){var A={parent:b,indent:s,element:q,contents:[]};if(y)A.grandparent=y;else{A.grandparent=b.parent();if(A.grandparent&&A.grandparent._4e_name()==
"li")A.grandparent=A.grandparent.parent()}d&&q._4e_setMarker(d,"listarray_index",h.length);h.push(A);for(var B=0,C=q[0].childNodes.length,v;B<C;B++){v=new f(q[0].childNodes[B]);v[0].nodeType==l.NODE_ELEMENT&&t[v._4e_name()]?i.listToArray(v,d,h,s+1,A.grandparent):A.contents.push(v)}}}return h},arrayToList:function(b,d,h,s){h||(h=0);if(!b||b.length<h+1)return null;for(var y=b[h].parent[0].ownerDocument,x=y.createDocumentFragment(),u=null,q=h,A=Math.max(b[h].indent,0),B=null;;){var C=b[q];if(C.indent==
A){if(!u||b[q].parent._4e_name()!=u._4e_name()){u=b[q].parent._4e_clone(false,true);x.appendChild(u[0])}B=u[0].appendChild(C.element._4e_clone(false,true)[0]);for(var v=0;v<C.contents.length;v++)B.appendChild(C.contents[v]._4e_clone(true,true)[0]);q++}else if(C.indent==Math.max(A,0)+1){q=i.arrayToList(b,null,q,s);B.appendChild(q.listNode);q=q.nextIndex}else if(C.indent==-1&&!h&&C.grandparent){if(t[C.grandparent._4e_name()])B=C.element._4e_clone(false,true)[0];else if(C.grandparent._4e_name()!="td"){B=
y.createElement(s);C.element._4e_copyAttributes(new f(B))}else B=y.createDocumentFragment();for(v=0;v<C.contents.length;v++){u=C.contents[v]._4e_clone(true,true);B.nodeType==l.NODE_DOCUMENT_FRAGMENT&&C.element._4e_copyAttributes(new f(u));B.appendChild(u[0])}if(B.nodeType==l.NODE_DOCUMENT_FRAGMENT&&q!=b.length-1){B.lastChild&&B.lastChild.nodeType==l.NODE_ELEMENT&&B.lastChild.getAttribute("type")=="_moz"&&e._4e_remove(B.lastChild);e._4e_appendBogus(B)}if(B.nodeType==l.NODE_ELEMENT&&e._4e_name(B)==
s&&B.firstChild){e._4e_trim(B);u=B.firstChild;if(u.nodeType==l.NODE_ELEMENT&&e._4e_isBlockBoundary(u)){u=y.createDocumentFragment();e._4e_moveChildren(B,u);B=u}}u=e._4e_name(B);if(!c.ie&&(u=="div"||u=="p"))e._4e_appendBogus(B);x.appendChild(B);u=null;q++}else return null;if(b.length<=q||Math.max(b[q].indent,0)<A)break}if(d)for(b=new f(x.firstChild);b&&b[0];){b[0].nodeType==l.NODE_ELEMENT&&b._4e_clearMarkers(d,true);b=b._4e_nextSourceNode()}return{listNode:x,nextIndex:q}}},w=/^h[1-6]$/;g.prototype=
{changeListType:function(b,d,h,s){var y=i.listToArray(d.root,h),x=[];for(b=0;b<d.contents.length;b++){var u=d.contents[b];u=u._4e_ascendant("li",true);if(!(!u||!u[0]||u.data("list_item_processed"))){x.push(u);u._4e_setMarker(h,"list_item_processed",true)}}u=new f(d.root[0].ownerDocument.createElement(this.type));for(b=0;b<x.length;b++){var q=x[b].data("listarray_index");y[q].parent=u}h=i.arrayToList(y,h,null,"p");var A;y=h.listNode.childNodes.length;for(b=0;b<y&&(A=new f(h.listNode.childNodes[b]));b++)A._4e_name()==
this.type&&s.push(A);e.insertBefore(h.listNode,d.root);d.root._4e_remove()},createList:function(b,d,h){var s=d.contents;b=d.root[0].ownerDocument;var y=[];if(s.length==1&&s[0][0]===d.root[0]){var x=new f(b.createElement("div"));s[0][0].nodeType!=l.NODE_TEXT&&s[0]._4e_moveChildren(x);s[0][0].appendChild(x[0]);s[0]=x}d=d.contents[0].parent();for(x=0;x<s.length;x++)d=d._4e_commonAncestor(s[x].parent());for(x=0;x<s.length;x++)for(var u=s[x],q;q=u.parent();){if(q[0]===d[0]){y.push(u);break}u=q}if(!(y.length<
1)){s=new f(y[y.length-1][0].nextSibling);x=new f(b.createElement(this.type));for(h.push(x);y.length;){h=y.shift();u=new f(b.createElement("li"));if(w.test(h._4e_name()))u[0].appendChild(h[0]);else{h._4e_copyAttributes(u);h._4e_moveChildren(u);h._4e_remove()}x[0].appendChild(u[0]);c.ie||u._4e_appendBogus()}s[0]?e.insertBefore(x,s):d.append(x)}},removeList:function(b,d,h){function s(v){if((B=new f(A[v?"firstChild":"lastChild"]))&&!(B[0].nodeType==l.NODE_ELEMENT&&B._4e_isBlockBoundary())&&(C=d.root[v?
"_4e_previous":"_4e_next"](m.whitespaces(true)))&&!(B[0].nodeType==l.NODE_ELEMENT&&C._4e_isBlockBoundary({br:1})))e[v?"insertBefore":"insertAfter"](b.document.createElement("br"),B)}for(var y=i.listToArray(d.root,h),x=[],u=0;u<d.contents.length;u++){var q=d.contents[u];q=q._4e_ascendant("li",true);if(!(!q||q.data("list_item_processed"))){x.push(q);q._4e_setMarker(h,"list_item_processed",true)}}q=null;for(u=0;u<x.length;u++){q=x[u].data("listarray_index");y[q].indent=-1;q=q}for(u=q+1;u<y.length;u++)if(y[u].indent>
Math.max(y[u-1].indent,0)){x=y[u-1].indent+1-y[u].indent;for(q=y[u].indent;y[u]&&y[u].indent>=q;){y[u].indent+=x;u++}u--}var A=i.arrayToList(y,h,null,"p").listNode,B,C;s(true);s(undefined);e.insertBefore(A,d.root);d.root._4e_remove()},exec:function(b){var d=b.getSelection(),h=d&&d.getRanges();if(!(!h||h.length<1)){for(var s=d.createBookmarks(true),y=[],x={};h.length>0;){var u=h.shift(),q=u.getBoundaryNodes(),A=q.startNode,B=q.endNode;A[0].nodeType==l.NODE_ELEMENT&&A._4e_name()=="td"&&u.setStartAt(q.startNode,
o.POSITION_AFTER_START);B[0].nodeType==l.NODE_ELEMENT&&B._4e_name()=="td"&&u.setEndAt(q.endNode,o.POSITION_BEFORE_END);u=u.createIterator();for(u.forceBrBreak=false;q=u.getNextParagraph();)if(!q.data("list_block")){q._4e_setMarker(x,"list_block",1);B=new n(q);var C=B.elements,v=null,z=false,E=B.blockLimit,F;for(A=C.length-1;A>=0&&(F=C[A]);A--)if(t[F._4e_name()]&&E.contains(F)){E.removeData("list_group_object");if(A=F.data("list_group_object"))A.contents.push(q);else{A={root:F,contents:[q]};y.push(A);
F._4e_setMarker(x,"list_group_object",A)}z=true;break}if(!z){B=E||B.block;if(B.data("list_group_object"))B.data("list_group_object").contents.push(q);else{A={root:B,contents:[q]};B._4e_setMarker(x,"list_group_object",A);y.push(A)}}}}for(h=[];y.length>0;){A=y.shift();if(this.state=="off")if(t[A.root._4e_name()])this.changeListType(b,A,x,h);else{p.Utils.clearAllMarkers(x);this.createList(b,A,h)}else this.state=="on"&&t[A.root._4e_name()]&&this.removeList(b,A,x)}for(A=0;A<h.length;A++){v=h[A];var D=
this;(b=function(G){var M=v[G?"_4e_previous":"_4e_next"](m.whitespaces(true));if(M&&M[0]&&M._4e_name()==D.type){M._4e_remove();M._4e_moveChildren(v,G?true:false)}})();b(true)}p.Utils.clearAllMarkers(x);d.selectBookmarks(s)}}};var j=p.TripleButton;p.ListUtils=i;p.ListSupport={init:function(){this.listCommand=new g(this.cfg.type)},selectionChange:function(b){var d=this.cfg.type,h=b.path,s;b=this.btn;var y=h.blockLimit;h=h.elements;if(y){if(h)for(var x=0;x<h.length&&(s=h[x])&&s[0]!==y[0];x++){var u=
k.indexOf(h[x]._4e_name(),r);if(u!==-1)if(r[u]===d){b.set("state",j.ON);return}else break}b.set("state",j.OFF)}},offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var b=this.editor,d=this.btn;b.fire("save");this.listCommand.state=d.get("state");this.listCommand.exec(b);b.fire("save");b.notifySelectionChange()}}});
KISSY.Editor.add("localStorage",function(){var g=KISSY,p=g.Editor,t;t=p.STORE="localStorage";if(!p.storeReady){p.storeReady=function(k){p.on("storeReady",k)};p.on("storeReady",function(){p.storeReady=function(k){k()};p.detach("storeReady")})}if(window[t])window[t]._ke||p.fire("storeReady");else{var r=p.Config.base+p.Utils.debugUrl("plugins/localStorage/swfstore.swf?rand="+ +new Date);window[t]=new p.FlashBridge({movie:r,methods:["setItem","removeItem","getValueOf"]});g.mix(window[t],{_ke:1,getItem:function(k){return this.getValueOf(k)}});
window[t].on("contentReady",function(){p.fire("storeReady")})}});KISSY.Editor.add("maximize",function(g){var p=KISSY,t=p.Editor;p.UA.gecko<1.92||g.ready(function(){var r=g.addButton("maximize",{title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize",loading:true});t.use("maximize/support",function(){r.reload(t.Maximize)})})});
KISSY.Editor.add("maximize/support",function(){var g=KISSY.Editor,p=KISSY,t=p.UA,r=p.Node,k=p.Event,o=p.DOM,n;o.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");var m={};p.mix(m,{onClick:function(){var l=this,c=l.editor;l._resize&&k.remove(window,"resize",l._resize);l.call("_saveEditorStatus");l.call("_restoreState");l.btn.boff();setTimeout(function(){l.call("_restoreEditorStatus");c.notifySelectionChange();c.fire("restoreWindow")},30)},_restoreState:function(){var l=document,c=this.editor,
f=this._savedParents;if(f){for(var e=0;e<f.length;e++){var i=f[e];i.el.css("position",i.position)}this._savedParents=null}c.wrap.css({height:this.iframeHeight});o.css(l.body,{width:"",height:"",overflow:""});l.documentElement.style.overflow="";c.editorWrap.css({position:"static",width:this.editorWrapWidth});n.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);l=this.btn.get("el");l.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");l.attr("title",
"\u5168\u5c4f");t.ie<8&&this.editor.toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var l=this.editor,c=[],f=l.editorWrap;this.iframeHeight=l.wrap._4e_style("height");this.editorWrapWidth=f._4e_style("width");this.scrollLeft=o.scrollLeft();this.scrollTop=o.scrollTop();window.scrollTo(0,0);for(l=f.parent();l;){f=l.css("position");if(f!="static"){c.push({el:l,position:f});l.css("position","static")}l=l.parent()}this._savedParents=c;c=this.btn.get("el");c.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
c.attr("title","\u53d6\u6d88\u5168\u5c4f");t.ie<8&&this.editor.toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var l=this.editor;this.savedRanges=null;if(t.gecko&&l.iframeFocus)this.savedRanges=(l=l.getSelection())&&l.getRanges()},_restoreEditorStatus:function(){var l=this.editor,c=l.getSelection(),f=this.savedRanges;l.activateGecko();f&&c&&c.selectRanges(f);if(l.iframeFocus&&c)(l=c.getStartElement())&&l[0]&&l._4e_scrollIntoView();t.ie<8&&this.btn.get("el").one("span").css("background-image",
"")},_maximize:function(l){var c=document,f=this.editor,e=f.editorWrap,i=o.viewportHeight(),w=o.viewportWidth(),j=f.statusDiv?f.statusDiv[0].offsetHeight:0,b=f.toolBarDiv[0].offsetHeight;if(t.ie)c.body.style.overflow="hidden";else o.css(c.body,{width:0,height:0,overflow:"hidden"});c.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:f.baseZIndex(g.zIndexManager.MAXIMIZE),width:w+"px"});n.css({zIndex:f.baseZIndex(g.zIndexManager.MAXIMIZE-5),height:i+"px",width:w+"px"});e.offset({left:0,
top:0});n.css({left:0,top:0});f.wrap.css({height:i-j-b+"px"});l!==true&&arguments.callee.call(this,true)},_real:function(){var l=this,c=l.editor;l.call("_saveEditorStatus");l.call("_saveSate");l.call("_maximize");l._resize=l._resize||g.Utils.buffer(l.cfg._maximize,l,100);k.on(window,"resize",l._resize);l.btn.bon();setTimeout(function(){l.call("_restoreEditorStatus");c.notifySelectionChange();c.fire("maximizeWindow")},30)},offClick:function(){n||(n=(new r("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(document.body));
this.call("_real")}});g.Maximize=m});
KISSY.Editor.add("music",function(g){var p=KISSY.Editor,t=g.htmlDataProcessor,r=t&&t.dataFilter;g.ready(function(){r&&r.addRules({elements:{object:function(k){var o=k.attributes;if(!(o.classid&&String(o.classid).toLowerCase())){for(o=0;o<k.children.length;o++)if(k.children[o].name=="embed"){if(!p.Utils.isFlashEmbed(k.children[o]))break;if(k.children[o].attributes.src.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(k,"ke_music","music",true)}return null}for(o=0;o<k.children.length;o++){var n=
k.children[o];if(n.name=="param"&&n.attributes.name=="movie")if(n.attributes.value.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(k,"ke_music","music",true)}},embed:function(k){if(!p.Utils.isFlashEmbed(k))return null;if(k.attributes.src.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(k,"ke_music","music",true)}}},4);p.use("music/support",function(){new p.MusicInserter(g)})})});
KISSY.Editor.add("music/support",function(){function g(e){g.superclass.constructor.apply(this,arguments);e.cfg.disableObjectResizing||k.on(e.document.body,m.ie?"resizestart":"resize",function(i){o.hasClass(i.target,l)&&i.preventDefault()})}function p(e){return e._4e_name()==="img"&&!!e.hasClass(l)&&e}var t=KISSY,r=t.Editor,k=t.Event,o=t.DOM,n=r.Flash,m=t.UA,l="ke_music",c=["img."+l];t.extend(g,n,{_config:function(){this._cls=l;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";
this._contextMenu=f;this._flashRules=c}});n.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",p);r.MusicInserter=g;var f={"\u97f3\u4e50\u5c5e\u6027":function(e){var i=e.editor.getSelection();(i=(i=i&&i.getStartElement())&&p(i))&&e.show(null,i)}}});
KISSY.add("overlay",function(g){var p=g.Base.create([g.Ext.Box,g.Ext.ContentBox,g.Ext.Position,g.Ext.Loading,g.UA.ie==6?g.Ext.Shim:null,g.Ext.Align,g.Ext.Mask],{init:function(){g.log("Overlay init");this.on("bindUI",this._bindUIOverlay,this);this.on("renderUI",this._renderUIOverlay,this);this.on("syncUI",this._syncUIOverlay,this)},_renderUIOverlay:function(){g.log("_renderUIOverlay");this.get("el").addClass("ks-overlay")},_syncUIOverlay:function(){g.log("_syncUIOverlay")},_bindUIOverlay:function(){g.log("_bindUIOverlay")},
destructor:function(){g.log("overlay destructor")}},{ATTRS:{elOrder:0}});g.Overlay=p},{requires:["core"]});
KISSY.add("dialog",function(g){g.Dialog=g.Base.create(g.Overlay,[g.Ext.StdMod,g.Ext.Close,g.Ext.Drag,g.Ext.Constrain],{init:function(){g.log("dialog init");this.on("renderUI",this._rendUIDialog,this);this.on("bindUI",this._bindUIDialog,this);this.on("syncUI",this._syncUIDialog,this)},_rendUIDialog:function(){g.log("_rendUIDialog");this.get("el").addClass("ks-dialog");this.set("handlers",[this.get("header")])},_bindUIDialog:function(){g.log("_bindUIDialog")},_syncUIDialog:function(){g.log("_syncUIDialog")},
destructor:function(){g.log("Dialog destructor")}})},{host:"overlay"});
KISSY.Editor.add("ext-focus",function(){function g(){p.log("FocusExt init");this.on("renderUI",this._renderUIFocusExt,this);this.on("bindUI",this._bindUIFocusExt,this);this.on("syncUI",this._syncUIFocusExt,this)}var p=KISSY,t=p.UA,r=p.Editor,k=r.focusManager;r.namespace("Ext");g.ATTRS={focus4e:{value:true}};g.prototype={_uiSetFocus4e:function(o){if(o){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",
this._hide4FocusExt,this)}},_syncUIFocusExt:function(){p.log("_syncUIFocusExt")},_renderUIFocusExt:function(){p.log("_renderUIFocusExt")},_bindUIFocusExt:function(){this._focus4e=(new p.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var o=this._focusEditor=k.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(t.ie&&o){var n=o.document.selection.createRange();
if(n)if(n.item&&n.item(0).ownerDocument==o.document){o=document.body.createTextRange();o.moveToElementText(this.get("el")._4e_first()[0]);o.collapse(true);o.select()}}},_hide4FocusExt:function(){var o=this._focusEditor;o&&o.focus()}};r.Ext.Focus=g},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var g=KISSY,p=g.Editor;if(!p.Overlay){var t=g.Base.create(g.Overlay,[p.Ext.Focus],{init:function(){g.log("Overlay4E init");this.on("syncUI",this._syncUIOverlay4E,this)},_syncUIOverlay4E:function(){g.log("_syncUIOverlay4E");p.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}}),r=g.Base.create(g.Dialog,[p.Ext.Focus],{show:function(){this.center();var o=this.get("y");if(o-g.DOM.scrollTop()>200){o=g.DOM.scrollTop()+
200;this.set("y",o)}r.superclass.show.call(this)}},{ATTRS:{constrain:{value:true},zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}});p.Overlay=t;p.Dialog=r;var k;p.Overlay.loading=function(){k||(k=new p.Overlay({x:0,focus4e:false,width:"100%",y:0,zIndex:p.baseZIndex(p.zIndexManager.LOADING),elCls:"ke-global-loading"}));k.set("height",g.DOM.docHeight());k.show();k.loading()};p.Overlay.unloading=function(){k&&k.hide()}}});
KISSY.Editor.add("pagebreak",function(g){var p=KISSY.Node,t=g.htmlDataProcessor,r=t&&t.dataFilter;r&&r.addRules({elements:{div:function(k){var o=k.attributes;var n=(o=o&&o.style)&&k.children.length==1&&k.children[0];if((n=n&&n.name=="span"&&n.attributes.style)&&/page-break-after\s*:\s*always/i.test(o)&&/display\s*:\s*none/i.test(n))return t.createFakeParserElement(k,"ke_pagebreak","div")}}});g.ready(function(){g.addButton("page-break",{title:"\u5206\u9875",contentCls:"ke-toolbar-pagebreak",offClick:function(){var k=
this.editor,o=new p('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,k.document);o=k.createFakeElement?k.createFakeElement(o,"ke_pagebreak","div",true,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'):o;o=(new p("<div>",null,k.document)).append(o);k.insertElement(o)}})})});
KISSY.Editor.add("preview",function(g){g.ready(function(){g.addButton("preview",{title:"\u9884\u89c8",contentCls:"ke-toolbar-preview",offClick:function(){var p=this.editor,t=640,r=420,k=80;try{var o=window.screen;t=Math.round(o.width*0.8);r=Math.round(o.height*0.7);k=Math.round(o.width*0.1)}catch(n){}p=p._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+p.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");t=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+
t+",height="+r+",left="+k);r=t.document;r.open();r.write(p);r.close();t.focus()}})})});
KISSY.Editor.add("progressbar",function(){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var p=KISSY,t=p.Editor;if(!t.ProgressBar){var r=p.Node;p.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
g.ATTRS={container:{},width:{},height:{},progress:{value:0}};p.extend(g,p.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var k=this.get("height"),o=new r("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+k+";'></div>"),n=this.get("container");k=(new r("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(k)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(o);var m=(new r("<span class='ke-progressbar-title'>")).appendTo(o);
n&&o.appendTo(n);this.el=o;this._title=m;this._p=k;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(k){k=k.newVal;this._p.css("width",k+"%");this._title.html(k+"%")}});t.ProgressBar=g}});
KISSY.Editor.add("removeformat",function(g){function p(l,c){for(var f=0;f<c.length;f++)l.removeAttr(c[f])}var t=KISSY.Editor,r=t.RANGE,k=t.ElementPath,o=t.NODE,n="class,style,lang,width,height,align,hspace,valign".split(/,/),m=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");g.ready(function(){g.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:t.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var l=
this.editor;m.lastIndex=0;var c=l.getSelection().getRanges();l.fire("save");for(var f=0,e;e=c[f];f++)if(!e.collapsed){e.enlarge(r.ENLARGE_ELEMENT);var i=e.createBookmark(),w=i.startNode,j=i.endNode,b=function(d){for(var h=new k(d),s=h.elements,y=1,x;x=s[y];y++){if(x._4e_equals(h.block)||x._4e_equals(h.blockLimit))break;m.test(x._4e_name())&&d._4e_breakParent(x)}};b(w);b(j);for(w=w._4e_nextSourceNode(true,o.NODE_ELEMENT);w;){if(w._4e_equals(j))break;b=w._4e_nextSourceNode(false,o.NODE_ELEMENT);w._4e_name()==
"img"&&w.attr("_ke_realelement")||(m.test(w._4e_name())?w._4e_remove(true):p(w,n));w=b}e.moveToBookmark(i)}l.getSelection().selectRanges(c);l.fire("save")}})})});
KISSY.Editor.add("resize",function(g){var p=KISSY,t=p.Node,r=p.Draggable;g.ready(function(){var k=g.statusDiv,o=new t("<div class='ke-resizer'>"),n=g.cfg.pluginConfig.resize||{};n=n.direction||["x","y"];o.appendTo(k);g.on("maximizeWindow",function(){o.css("display","none")});g.on("restoreWindow",function(){o.css("display","")});k=new r({node:o});var m=0,l=0,c=g.wrap,f=g.editorWrap;k.on("dragstart",function(){m=c.height();l=f.width()});k.on("drag",function(e){var i=e.pageX-this.startMousePos.left;
e=e.pageY-this.startMousePos.top;p.inArray("y",n)&&c.height(m+e);p.inArray("x",n)&&f.width(l+i)})})});
KISSY.Editor.add("select",function(){function g(m){g.superclass.constructor.call(this,m);this._init()}var p=KISSY,t=p.Node,r=p.Event,k=p.DOM,o=p.Editor;if(!o.Select){g.DISABLED=0;g.ENABLED=1;var n=o.XHTML_DTD;g.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var m=this.el.parent();m;){var l=m._4e_name();if(n[l]&&n[l].div)return m;m=m.parent()}return new t(document.body)}},state:{value:1}};g.decorate=
function(m){for(var l=m.width(),c=[],f=m.all("option"),e=0;e<f.length;e++){var i=f[e];c.push({name:k.html(i),value:k.attr(i,"value")})}return new g({width:l+"px",el:m,items:c,cls:"ke-combox",value:m.val()})};p.extend(g,p.Base,{_init:function(){var m=this.get("container"),l=this.get("el"),c=new t("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
f=this.get("title")||"",e=this.get("cls"),i=c.one(".ke-select-text"),w=c.one(".ke-select-text-inner");c.one(".ke-select-drop");this.get("value")!==undefined?w.html(this._findNameByV(this.get("value"))):w.html(f);i.css("width",this.get("width"));c._4e_unselectable();f&&c.attr("title",f);e&&c.addClass(e);if(l)l[0].parentNode.replaceChild(c[0],l[0]);else m&&c.appendTo(m);c.on("click",this._click,this);this.el=c;this.title=w;this._focusA=c.one("a.ke-select");o.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(m){var l=this.get("title")||"",c=this.get("items");if(this.get("showValue"))return m||l;for(var f=0;f<c.length;f++){var e=c[f];if(e.value==m){l=e.name;break}}return l},_valueChange:function(m){this.title.html(this._findNameByV(m.newVal))},_itemsChange:function(m){m=m.newVal;var l=this._selectList;l.html("");if(m)for(var c=0;c<m.length;c++){var f=m[c];(new t("<a class='ke-select-menu-item' href='#' data-value='"+
f.value+"'>"+f.name+"</a>",f.attrs)).appendTo(l)._4e_unselectable()}this.as=l.all("a")},val:function(m){if(m!==undefined){this.set("value",m);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var m=this,l=m.el,c=m.get("popUpWidth"),f=m._focusA,e=new o.Overlay({render:m.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:c?c:l.width(),zIndex:o.baseZIndex(o.zIndexManager.SELECT),focusMgr:false}),i=m.get("items");
e.renderer();c=e.get("contentEl").one("div");m.menu=e;r.on(window,"resize",m._resize,m);m.get("title")&&(new t("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+m.get("title")+"</div>")).appendTo(c);m._selectList=(new t("<div>")).appendTo(c);m._itemsChange({newVal:i});e.on("show",function(){f.addClass("ke-select-active")});e.on("hide",function(){f.removeClass("ke-select-active")});r.on([document,m.get("doc")],"click",function(w){l.contains(w.target)||e.hide()});c.on("click",
m._select,m);m.as=m._selectList.all("a");r.on(c[0],"mouseenter",function(){m.as.removeClass("ke-menu-selected")});m.on("afterItemsChange",m._itemsChange,m);m.menuNode=c},_stateChange:function(m){var l=this.el;m.newVal==1?l.removeClass("ke-select-disabled"):l.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(m){m.halt();var l=this.menu,c=this.menuNode;if(m=(new t(m.target))._4e_ascendant(function(i){return c.contains(i)&&
i._4e_name()=="a"},true)){var f=this.get("value"),e=m.attr("data-value");this.set("value",e);this.fire("click",{newVal:e,prevVal:f,name:m.html()});l.hide()}},_real:function(){var m=this.el,l=m.offset(),c=p.clone(l),f=this.menu.get("el").height(),e=this.menu.get("el").width(),i=k.scrollTop(),w=k.scrollLeft(),j=k.viewportHeight(),b=k.viewportWidth();b=w+b-60;j=i+j;var d=l.top+(m.height()-2);m=l.left+m.width()-2;var h=this.get("align"),s=h[0];if(h[1]=="b"){l.top=d;if(l.top+f>j&&c.top-i>j-d)l.top=c.top-
f}else{l.top=c.top-f;if(l.top<i&&c.top-i<j-d)l.top=d}if(s=="l"){if(l.left+e>b&&m-w>b-c.left)l.left=m-e}else{l.left=m-e;if(l.left<w&&m-w<b-c.left)l.left=c.left}this.menu.set("xy",[l.left,l.top]);this.menu.show()},_click:function(m){m.preventDefault();m=this.el;var l=this.get("value");if(!m.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();l&&this.menu&&this.as.each(function(c){c.attr("data-value")==l?c.addClass("ke-menu-selected"):c.removeClass("ke-menu-selected")})}}});
o.Select=g}});KISSY.Editor.add("separator",function(g){g.ready(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(g.toolBarDiv)})});KISSY.Editor.add("smiley",function(g){var p=KISSY.Editor;g.ready(function(){var t=g.addButton("smiley",{contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",loading:true});p.use("smiley/support",function(){t.reload(p.SmileySupport)})})});
KISSY.Editor.add("smiley/support",function(){var g=KISSY,p=g.Event,t=g.Editor,r=g.DOM;r.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");var k;t.SmileySupport={_selectSmiley:function(o){o.halt();
var n=this.editor;o=o.target;var m;if(r._4e_name(o)=="a"&&(m=r.attr(o,"data-icon"))){m=new g.Node("<img class='ke_smiley'alt='' src='"+m+"'/>",null,n.document);n.insertElement(m);this.smileyWin.hide()}},_hidePanel:function(o){var n=this.btn.get("el");o=o.target;var m=this.smileyWin;n._4e_equals(o)||n.contains(o)||m.hide()},_show:function(){var o=this.smileyWin;o&&o.get("visible")?o.hide():this.call("_prepare")},_prepare:function(){var o=this.cfg,n=this.btn,m=this.editor,l;if(!k){k="<div class='ke-smiley-sprite'>";
for(l=0;l<=98;l++)k+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+l+".gif'></a>";k+="</div>"}l=k;l=this.smileyWin=new t.Overlay({content:l,focus4e:false,width:"297px",autoRender:true,elCls:"ks-popup",zIndex:m.baseZIndex(t.zIndexManager.POPUP_MENU),mask:false});this.smileyPanel=l.get("contentEl");l.on("show",n.bon,n);l.on("hide",n.boff,n);this.smileyPanel.on("click",o._selectSmiley,this);p.on(document,"click",o._hidePanel,this);p.on(m.document,"click",o._hidePanel,this);this.cfg._prepare=
this.cfg._real;this.call("_real")},_real:function(){var o=this.btn.get("el"),n=o.offset();n.top+=o.height()+5;if(n.left+this.smileyPanel.width()>r.viewportWidth()-60)n.left=r.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[n.left,n.top]);this.smileyWin.show()},offClick:function(){this.call("_prepare")},onClick:function(){this.call("_prepare")}}});
KISSY.Editor.add("sourcearea",function(g){var p=KISSY.Editor;KISSY.UA.gecko<1.92||g.ready(function(){var t=p.SOURCE_MODE,r=p.WYSIWYG_MODE;g.addButton("sourcearea",{title:"\u6e90\u7801",contentCls:"ke-toolbar-source",init:function(){var k=this.btn,o=this.editor;o.on("wysiwygmode",k.boff,k);o.on("sourcemode",k.bon,k)},offClick:function(){this.editor.execCommand("sourceAreaSupport",t)},onClick:function(){this.editor.execCommand("sourceAreaSupport",r)}})})});
KISSY.Editor.add("sourcearea/support",function(g){var p=KISSY,t=p.Editor,r=p.UA;t.SourceAreaSupport||function(){function k(){var m=this.mapper={};m[o]=this._show;m[n]=this._hide}var o=t.SOURCE_MODE,n=t.WYSIWYG_MODE;p.augment(k,{exec:function(m,l){var c=this.mapper;c[l]&&c[l].call(this,m)},_show:function(m){m.textarea.val(m.getData(true));this._showSource(m);m.fire("sourcemode")},_showSource:function(m){var l=m.textarea,c=m.iframe;l.css("display","");c.css("display","none");r.ie<8&&l.css("height",
m.wrap.css("height"));l[0].focus()},_hideSource:function(m){var l=m.textarea;m.iframe.css("display","");l.css("display","none")},_hide:function(m){var l=m.textarea;this._hideSource(m);m.fire("save");m.setData(l.val());m.fire("wysiwygmode");m.fire("save");r.gecko&&m.activateGecko()}});t.SourceAreaSupport=new k}();g.addCommand("sourceAreaSupport",t.SourceAreaSupport)});
KISSY.Editor.add("table",function(g){var p=KISSY,t=p.Editor,r=p.trim,k=(p.UA.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border"),o=g.htmlDataProcessor;
p=o&&o.dataFilter;o=o&&o.htmlFilter;p&&p.addRules({elements:{table:function(n){n=n.attributes;var m=n["class"],l=parseInt(n.border,10);if(!l||l<=0)n["class"]=(m||"")+" ke_show_border"}}});o&&o.addRules({elements:{table:function(n){n=n.attributes;var m=n["class"];if(m)n["class"]=r(m.replace("ke_show_border","").replace(/\s{2}/," "))}}});g.ready(function(){var n=g.addButton("table",{contentCls:"ke-toolbar-table",title:"\u63d2\u5165\u8868\u683c",loading:true});t.use("table/support",function(){var m=new t.TableUI(g);n.reload({offClick:function(){m._tableShow()}})});
g.addCustomStyle(k)})});
KISSY.Editor.add("table/support",function(){function g(j){var b=this,d={},h;for(h in w)(function(s){d[s]=function(){j.fire("save");w[s](b);j.fire("save")}})(h);f.ContextMenu.register({editor:j,rules:e,width:"120px",funcs:d});b.editor=j}function p(j){function b(A){if(!(s.length>0))if(A[0].nodeType==KEN.NODE_ELEMENT&&i.test(A._4e_name())&&!A.data("selected_cell")){A._4e_setMarker(y,"selected_cell",true);s.push(A)}}for(var d=j.createBookmarks(),h=j.getRanges(),s=[],y={},x=0;x<h.length;x++){var u=h[x];
if(u.collapsed){u=u.getCommonAncestor();(u=u._4e_ascendant("td",true)||u._4e_ascendant("th",true))&&s.push(u)}else{u=new Walker(u);var q;for(u.guard=b;q=u.next();)if((q=q.parent())&&i.test(q._4e_name())&&!q.data("selected_cell")){q._4e_setMarker(y,"selected_cell",true);s.push(q)}}}f.Utils.clearAllMarkers(y);j.selectBookmarks(d);return s}function t(j,b){var d=j.getStartElement()._4e_ascendant("tr");if(d){var h=d._4e_clone(true);h.insertBefore(d);d=(b?h[0]:d[0]).cells;for(h=0;h<d.length;h++){d[h].innerHTML=
"";l.ie||(new c(d[h]))._4e_appendBogus()}}}function r(j){if(j instanceof f.Selection){var b=p(j),d=b.length;j=[];for(var h,s,y=0;y<d;y++){var x=b[y].parent(),u=x[0].rowIndex;!y&&(h=u-1);j[u]=x;y==d-1&&(s=u+1)}y=x._4e_ascendant("table");h=new c(s<y[0].rows.length&&y[0].rows[s]||h>0&&y[0].rows[h]||y[0].parentNode);for(y=j.length;y>=0;y--)j[y]&&r(j[y]);return h}else if(j instanceof c){y=j._4e_ascendant("table");y[0].rows.length==1?y._4e_remove():j._4e_remove()}return 0}function k(j,b){var d=j.getStartElement();
if(d=d._4e_ascendant("td",true)||d._4e_ascendant("th",true))for(var h=d._4e_ascendant("table"),s=d[0].cellIndex,y=0;y<h[0].rows.length;y++){var x=h[0].rows[y];if(!(x.cells.length<s+1)){d=new c(x.cells[s].cloneNode(false));l.ie||d._4e_appendBogus();x=new c(x.cells[s]);b?d.insertBefore(x):d.insertAfter(x)}}}function o(j){if(j instanceof f.Selection){var b=p(j),d,h=[];j=b[0]&&b[0]._4e_ascendant("table");var s,y,x;s=0;for(y=b.length;s<y;s++)h.push(b[s][0].cellIndex);h.sort();s=1;for(y=h.length;s<y;s++)if(h[s]-
h[s-1]>1){x=h[s-1]+1;break}x||(x=h[0]>0?h[0]-1:h[h.length-1]+1);h=j[0].rows;s=0;for(y=h.length;s<y;s++)if(d=h[s].cells[x])break;d=d?new c(d):j._4e_previous();for(x=b.length-1;x>=0;x--)b[x]&&o(b[x]);return d}else if(j instanceof c){b=j._4e_ascendant("table");if(!b)return null;d=j[0].cellIndex;for(x=b[0].rows.length-1;x>=0;x--){j=new c(b[0].rows[x]);if(!d&&j[0].cells.length==1)r(j);else j[0].cells[d]&&j[0].removeChild(j[0].cells[d])}}return null}function n(j,b){var d=new f.Range(j[0].ownerDocument);
if(!d.moveToElementEditablePosition(j,b?true:undefined)){d.selectNodeContents(j);d.collapse(b?false:true)}d.select(true)}var m=KISSY,l=m.UA,c=m.Node,f=m.Editor,e=["tr","th","td","tbody","table"];m.augment(g,{_tableShow:function(j,b,d){this.editor.useDialog("table/dialog",function(h){h.show(b,d)})}});var i=/^(?:td|th)$/,w={"\u8868\u683c\u5c5e\u6027":function(j){var b=j.editor.getSelection(),d=b&&b.getStartElement();if(b=d&&d._4e_ascendant("table",true)){d=d._4e_ascendant(function(h){h=h._4e_name();return h=="td"||h==
"th"},true);j._tableShow(null,b,d)}},"\u5220\u9664\u8868\u683c":function(j){var b=(j=j.editor.getSelection())&&j.getStartElement();if(b=b&&b._4e_ascendant("table",true)){j.selectElement(b);var d=j.getRanges()[0];d.collapse();j.selectRanges([d]);j=b.parent();j[0].childNodes.length==1&&j._4e_name()!="body"&&j._4e_name()!="td"?j._4e_remove():b._4e_remove()}},"\u5220\u9664\u884c ":function(j){j=j.editor.getSelection();n(r(j),undefined)},"\u5220\u9664\u5217 ":function(j){j=j.editor.getSelection();(j=o(j))&&n(j,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(j){j=j.editor.getSelection();
t(j,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(j){j=j.editor.getSelection();t(j,undefined)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(j){j=j.editor.getSelection();k(j,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(j){j=j.editor.getSelection();k(j,undefined)}};f.TableUI=g});
KISSY.Editor.add("tabs",function(){function g(o){this.cfg=o;this._init()}var p=KISSY,t=p.Editor,r=p.DOM,k=p.Node;if(!t.Tabs){p.augment(g,p.EventTarget,{_init:function(){var o=this,n=o.cfg,m=n.tabs,l=n.contents.children("div"),c=m.children("li");m.on("click",function(f){f=new k(f.target);if(f=f._4e_ascendant(function(i){return i._4e_name()==="li"&&m.contains(i)},true)){c.removeClass("ke-tab-selected");var e=f.attr("rel");f.addClass("ke-tab-selected");l.hide();r.show(l[p.indexOf(f[0],c)]);o.fire(e)}})},
getTab:function(o){var n=this.cfg,m=n.tabs;n=n.contents.children("div");m=m.children("li");for(var l=0;l<m.length;l++){var c=new k(m[l]),f=new k(n[l]);if(p.isNumber(o)&&o==l||p.isString(o)&&o==c.attr("rel"))return{tab:c,content:f}}},remove:function(o){o=this.getTab(o);o.tab.remove();o.content.remove()},_getActivate:function(){var o=this.cfg,n=o.tabs;o.contents.children("div");o=n.children("li");for(n=0;n<o.length;n++){var m=new k(o[n]);if(m.hasClass("ke-tab-selected"))return m.attr("rel")}},activate:function(o){if(arguments.length==
0)return this._getActivate();var n=this.cfg,m=n.tabs;n=n.contents.children("div");m.children("li").removeClass("ke-tab-selected");n.hide();m=this.getTab(o);m.tab.addClass("ke-tab-selected");m.content.show()}});t.Tabs=g}});
KISSY.Editor.add("templates",function(g){var p=KISSY,t=p.Node,r=p.Editor.Dialog;p.DOM.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");g.ready(function(){g.addButton("templates",{contentCls:"ke-toolbar-template",
title:"\u6a21\u677f",offClick:function(){this.cfg._prepare.call(this)},_prepare:function(){for(var k=this.editor,o=k.cfg.pluginConfig.templates||[],n="<div class='ke-tpl'>",m=0;m<o.length;m++)n+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+o[m].demo+"</a>";n+="</div>";var l=new r({width:500,mask:true,autoRender:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:n});l.get("el").all(".ke-tpl-list").on("click",function(c){c.halt();c=(new t(c.target))._4e_index();c!=-1&&k.insertHtml(o[c].html);l.hide()});
this.ui=l;this.cfg.show.call(this);this.cfg._prepare=this.cfg.show},show:function(){this.ui.show()}})})});
KISSY.Editor.add("undo",function(g){var p=KISSY,t=p.Editor,r=t.Utils.arrayCompare,k=p.UA,o=p.Event;t.UndoManager||function(){function n(f){var e=f._getRawData(),i;if(e)i=f.getSelection();this.contents=e;this.bookmarks=i&&i.createBookmarks2(true)}function m(f){this.history=[];this.index=-1;this.editor=f;this.bufferRunner=t.Utils.buffer(this.save,this,500);this._init()}p.augment(n,{equals:function(f){if(this.contents!=f.contents)return false;var e=this.bookmarks;f=f.bookmarks;if(e||f){if(!e||!f||e.length!=
f.length)return false;for(var i=0;i<e.length;i++){var w=e[i],j=f[i];if(w.startOffset!=j.startOffset||w.endOffset!=j.endOffset||!r(w.start,j.start)||!r(w.end,j.end))return false}}return true}});var l={16:1,17:1,18:1},c={37:1,38:1,39:1,40:1,33:1,34:1};p.augment(m,{_keyMonitor:function(){var f=this.editor;o.on([f.document,f.textarea],"keydown",function(e){var i=e.keyCode;if(!(i in c||i in l))if(i===90&&(e.ctrlKey||e.metaKey)){f.fire("restore",{d:-1});e.halt()}else if(i===89&&(e.ctrlKey||e.metaKey)){f.fire("restore",
{d:1});e.halt()}else f.fire("save",{buffer:1})})},_init:function(){var f=this,e=f.editor;e.on("save",function(i){if(e.getMode()==t.WYSIWYG_MODE)i.buffer?f.bufferRunner():f.save()});e.on("restore",function(i){e.getMode()==t.WYSIWYG_MODE&&f.restore(i)});f._keyMonitor()},save:function(){var f=this.history,e=this.index;f.length>e+1&&f.splice(e+1,f.length-e-1);var i=this.editor;e=f[f.length-1];var w=new n(i);if(!e||!e.equals(w)){f.length===30&&f.shift();f.push(w);this.index=e=f.length-1;i.fire("afterSave",
{history:f,index:e})}},restore:function(f){f=f.d;var e=this.history,i=this.editor,w=e[this.index+f];if(w){i._setRawData(w.contents);if(w.bookmarks)i.getSelection().selectBookmarks(w.bookmarks);else if(k.ie){w=i.document.body.createTextRange();w.collapse(true);w.select()}(w=i.getSelection())&&w.scrollIntoView();this.index+=f;i.fire("afterRestore",{history:e,index:this.index});i.notifySelectionChange()}}});t.UndoManager=m}();g.ready(function(){new t.UndoManager(g);var n={redo:1,undo:-1},m={mode:t.WYSIWYG_MODE,
init:function(){this.editor.on("afterSave afterRestore",this.cfg._respond,this);this.btn.disable()},offClick:function(){this.editor.fire("restore",{d:n[this.cfg.flag]})}},l=p.mix({title:"\u64a4\u9500",flag:"undo",contentCls:"ke-toolbar-undo",_respond:function(c){var f=this.btn;c.index>0?f.boff():f.disable()}},m,false);m=p.mix({title:"\u91cd\u505a",flag:"redo",contentCls:"ke-toolbar-redo",_respond:function(c){var f=this.btn;c.index<c.history.length-1?f.boff():f.disable()}},m,false);g.addButton("undo",l);g.addButton("undo",
m)})});
