/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-30 14:09:47
*/
KISSY.add("editor",function(g,o){function s(h,c){function d(w){for(var v=s.Env.mods,r=0;r<w.length;r++){for(var z=w[r],E=n,B=0;B<r;B++)if(z==w[B]){E=q;break}B=v[z];if(E&&B){E=g.clone(B);z=z+"_"+r;E.name=z;w[r]=z;v[z]||(v[z]=E)}}}var j=this;if(!(j instanceof s))return new s(h,c);if(g.isString(h))h=g.one(h);h=m._4e_wrap(h);c=c||{};c.pluginConfig=c.pluginConfig||{};j.cfg=c;c.pluginConfig=c.pluginConfig;j.cfg=c;g.app(j,g.EventTarget);var t=["htmldataprocessor","enterkey","clipboard"],y=n;j.use=function(w,
v){w=w.split(",");d(w);if(!y)for(var r=0;r<t.length;r++){var z=t[r];g.inArray(z,w)||w.unshift(z)}g.use.call(j,w.join(","),function(){j.ready(function(){v&&v.call(j);if(!y){j.setData(h.val());if(c.focus)j.focus();else{var E=j.getSelection();E&&E.removeAllRanges()}j.fire("save");y=q}})},{order:q,global:s});return j};j.use=j.use;j.init(h);return j}function p(h){var c=g.Config.debug;h=c?c==="dev"?"../src/"+h:h:h.replace(/\.(js|css)/i,"-min.$1");h+=h.indexOf("?")!=-1?"&":"?";h+="t="+encodeURIComponent("2010-11-30 14:09:47");
return h}var m=g.DOM,q=true,n=false;g.app(s,g.EventTarget);s.Config.base=g.Config.base+"editor/";var k=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport",requires:["overlay"]},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},
"flash/dialog",{name:"flash/support",requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},
"preview","removeformat","smiley",{name:"smiley/support",requires:["overlay"]},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],l,b,e,f,i={};l=0;for(b=k.length;l<b;l++){e=k[l];if(g.isString(e))e=k[l]={name:e+"",requires:null};f=e.requires||[];var u=["button"];e.name.indexOf("/dialog")!=-1&&u.push("overlay");e.requires=f.concat(u)}k=["uibase",
{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button",requires:["uibase"]},"dd","progressbar",{name:"overlay",requires:["dd","uibase"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(k);l=0;for(b=k.length;l<b;l++){e=k[l];f=e.name;i[f]={attach:n,charset:"utf-8",requires:e.requires,csspath:e.useCss?p("plugins/"+f+"/plugin.css"):o,path:p("plugins/"+f+"/plugin.js")}}s.add(i);g.Editor=s;g.Editor=s});
KISSY.Editor.add("utils",function(g){var o=null,s=KISSY,p=s.Node,m=s.DOM,q=s.UA,n=s.Event,k;k=q.ie?document.documentMode||q.ie:void 0;var l={debugUrl:function(b){var e=s.Config.debug;b=e?e==="dev"?"../src/"+b:b:b.replace(/\.(js|css)/i,"-min.$1");b+=b.indexOf("?")!=-1?"&":"?";b+="t="+encodeURIComponent("2010-11-30 14:09:47");return b},lazyRun:function(b,e,f){var i=b[e],u=b[f];b[e]=function(){i.apply(this,arguments);b[e]=b[f];return u.apply(this,arguments)}},getXY:function(b,e,f,i){f=f.defaultView||
f.parentWindow;b-=m.scrollLeft(f);e-=m.scrollTop(f);if(i)if(f!=(i.defaultView||i.parentWindow)&&f.frameElement){i=m._4e_getOffset(f.frameElement,i);b+=i.left;e+=i.top}return{left:b,top:e}},tryThese:function(){for(var b,e=0,f=arguments.length;e<f;e++){var i=arguments[e];try{b=i();break}catch(u){}}return b},arrayCompare:function(b,e){if(!b&&!e)return true;if(!b||!e||b.length!=e.length)return false;for(var f=0;f<b.length;f++)if(b[f]!==e[f])return false;return true},getByAddress:function(b,e,f){b=b.documentElement;
for(var i=0;b&&i<e.length;i++){var u=e[i];if(f)for(var h=-1,c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];if(!(f===true&&d.nodeType==3&&d.previousSibling&&d.previousSibling.nodeType==3)){h++;if(h==u){b=d;break}}}else b=b.childNodes[u]}return b?new p(b):o},clearAllMarkers:function(b){for(var e in b)b[e]._4e_clearMarkers(b,true)},htmlEncodeAttr:function(b){return b.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(b){return b.replace(/^\s+/,"")},rtrim:function(b){return b.replace(/\s+$/,
"")},trim:function(b){return this.ltrim(this.rtrim(b))},mix:function(){for(var b={},e=0;e<arguments.length;e++)b=s.mix(b,arguments[e]);return b},isCustomDomain:function(){if(!q.ie)return false;var b=document.domain,e=window.location.hostname;return b!=e&&b!="["+e+"]"},duplicateStr:function(b,e){return Array(e+1).join(b)},throttle:function(b,e,f){f=f||150;if(f===-1)return function(){b.apply(e,arguments)};var i=(new Date).getTime();return function(){var u=(new Date).getTime();if(u-i>f){i=u;b.apply(e,
arguments)}}},buffer:function(b,e,f){f=f||0;var i=o;return function(){i&&clearTimeout(i);var u=arguments;i=setTimeout(function(){return b.apply(e,u)},f)}},isNumber:function(b){return/^\d+(.\d+)?$/.test(s.trim(b))},verifyInputs:function(b){for(var e=0;e<b.length;e++){var f=m._4e_wrap(b[e]),i=s.trim(f.val()),u=f.attr("data-verify");f=f.attr("data-warning");if(u&&!RegExp(u).test(i)){alert(f);return false}}return true},sourceDisable:function(b,e){b.on("sourcemode",e.disable,e);b.on("wysiwygmode",e.enable,
e)},resetInput:function(b){var e=b.attr("placeholder");if(e&&!q.webkit){b.addClass("ke-input-tip");b.val(e)}else q.webkit&&b.val("")},valInput:function(b,e){b.removeClass("ke-input-tip");b.val(e)},placeholder:function(b,e){b.attr("placeholder",e);if(!q.webkit){b.on("blur",function(){if(!s.trim(b.val())){b.addClass("ke-input-tip");b.val(e)}});b.on("focus",function(){b.removeClass("ke-input-tip");s.trim(b.val())==e&&b.val("")})}},clean:function(b){b=b[0]||b;for(var e=s.makeArray(b.childNodes),f=0;f<
e.length;f++){var i=e[f];i.nodeType==g.NODE.NODE_TEXT&&!s.trim(i.nodeValue)&&b.removeChild(i)}},htmlEncode:function(b){return!b?b:String(b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(b){return!b?b:String(b).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(b,e){return b.toLowerCase()==e.toLowerCase()},normParams:function(b){b=s.clone(b);for(var e in b)if(b.hasOwnProperty(e)){var f=
b[e];if(s.isFunction(f))b[e]=f()}return b},doFormUpload:function(b,e,f){function i(){var y={responseText:"",responseXML:o};y.argument=b?b.argument:o;try{var w;if((w=q.ie?h.contentWindow.document:h.contentDocument||window.frames[u].document)&&w.body)y.responseText=w.body.innerHTML;y.responseXML=w&&w.XMLDocument?w.XMLDocument:w}catch(v){s.log(v)}n.remove(h,"load",i);b.callback&&b.callback(y);setTimeout(function(){m._4e_remove(h)},100)}var u=s.guid("form-upload-"),h=document.createElement("iframe");
h.id=u;h.name=u;h.className="ke-hidden";var c="document.open();"+(l.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(q.ie)h.src=q.ie?"javascript:void(function(){"+encodeURIComponent(c)+"}())":"";s.log("doFormUpload : "+h.src);document.body.appendChild(h);if(q.ie)document.frames[u].name=u;c=m._4e_unwrap(b.form);var d={target:c.target,method:c.method,encoding:c.encoding,enctype:c.enctype,action:c.action};c.target=u;c.method="POST";c.enctype=c.encoding="multipart/form-data";
if(f)c.action=f;var j;if(e){j=[];e=g.Utils.normParams(e);for(var t in e)if(e.hasOwnProperty(t)){f=document.createElement("input");f.type="hidden";f.name=t;f.value=e[t];c.appendChild(f);j.push(f)}}n.on(h,"load",i);c.submit();c.target=d.target;c.method=d.method;c.enctype=d.enctype;c.encoding=d.encoding;c.action=d.action;if(j){e=0;for(t=j.length;e<t;e++)m._4e_remove(j[e])}return h},extern:function(b,e){for(var f in e)b[f]=e[f]},map:function(b,e){for(var f=0;f<b.length;f++)b[f]=e(b[f]);return b},ieEngine:k,
preventFocus:function(b){q.ie?b._4e_unselectable():b.attr("onmousedown","return false;")},isFlashEmbed:function(b){b=b.attributes;return b.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(b.src||"")}};g.Utils=l;g.Utils=l;l.extern(l,{debugUrl:l.debugUrl,lazyRun:l.lazyRun,getXY:l.getXY,tryThese:l.tryThese,arrayCompare:l.arrayCompare,getByAddress:l.getByAddress,clearAllMarkers:l.clearAllMarkers,htmlEncodeAttr:l.htmlEncodeAttr,ltrim:l.ltrim,rtrim:l.rtrim,trim:l.trim,mix:l.mix,isCustomDomain:l.isCustomDomain,
duplicateStr:l.duplicateStr,buffer:l.buffer,isNumber:l.isNumber,verifyInputs:l.verifyInputs,sourceDisable:l.sourceDisable,resetInput:l.resetInput,placeholder:l.placeholder,clean:l.clean,htmlEncode:l.htmlEncode,htmlDecode:l.htmlDecode,equalsIgnoreCase:l.equalsIgnoreCase,normParams:l.normParams,throttle:l.throttle,doFormUpload:l.doFormUpload,map:l.map})});
KISSY.Editor.add("dom",function(g){function o(c){return c.replace(/-(\w)/g,function(d,j){return j.toUpperCase()})}var s=KISSY,p=s.DOM,m=s.UA,q=s.Node,n=g.Utils,k={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};g.NODE=g.NODE;g.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};g.POSITION=g.POSITION;var l=g.NODE,b=g.POSITION,e={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},f={hr:1},i=function(c){return c[0]||c},u=function(c){if(c&&!c[0])return new q(c);return c},h={_4e_wrap:u,_4e_unwrap:i,_4e_equals:function(c,d){if(!c&&!d)return true;if(!c||!d)return false;c=i(c);d=i(d);
return c===d},_4e_isBlockBoundary:function(c,d){c=u(c);var j=s.mix(s.mix({},f),d||{});return e[c.css("display")]||j[c._4e_name()]},_4e_getWin:function(c){return c&&"scrollTo"in c&&c.document?c:c&&c.nodeType===9?c.defaultView||c.parentWindow:false},_4e_index:function(c){c=i(c);for(var d=c.parentNode.childNodes,j=0;j<d.length;j++)if(d[j]===c)return j;return-1},_4e_first:function(c,d){c=i(c);var j=c.firstChild;if((j=j&&new q(j))&&d&&!d(j))j=j._4e_next(d);return j},_4e_move:function(c,d,j){c=i(c);p._4e_remove(c);
d=i(d);j?d.insertBefore(c,d.firstChild):d.appendChild(c)},_4e_name:function(c){c=i(c);var d=c.nodeName.toLowerCase();if(m.ie)if((c=c.scopeName)&&c!="HTML")d=c.toLowerCase()+":"+d;return d},_4e_isIdentical:function(c,d){if(c._4e_name()!=d._4e_name())return false;var j=c[0].attributes,t=d[0].attributes,y=j.length,w=t.length;if(y!=w)return false;for(var v=0;v<y;v++){var r=j[v],z=r.name;if(r.specified&&c.attr(z)!=d.attr(z))return false}if(n.ieEngine<8)for(v=0;v<w;v++){r=t[v];z=r.name;if(r.specified&&
c.attr(z)!=d.attr(z))return false}return true},_4e_isEmptyInlineRemoveable:function(c){c=i(c).childNodes;for(var d=0,j=c.length;d<j;d++){var t=c[d],y=t.nodeType;if(!(y==l.NODE_ELEMENT&&t.getAttribute("_ke_bookmark")))if(y==l.NODE_ELEMENT&&!h._4e_isEmptyInlineRemoveable(t)||y==l.NODE_TEXT&&s.trim(t.nodeValue))return false}return true},_4e_moveChildren:function(c,d,j){c=i(c);d=d[0]||d;if(c!=d)if(j)for(;j=c.lastChild;)d.insertBefore(c.removeChild(j),d.firstChild);else for(;j=c.firstChild;)d.appendChild(c.removeChild(j))},
_4e_mergeSiblings:function(){function c(d,j,t){if(j[0]&&j[0].nodeType==l.NODE_ELEMENT){for(var y=[];j.attr("_ke_bookmark")||j._4e_isEmptyInlineRemoveable();){y.push(j);j=t?new q(j[0].nextSibling):new q(j[0].previousSibling);if(!j[0]||j[0].nodeType!=l.NODE_ELEMENT)return}if(d._4e_isIdentical(j)){for(var w=t?d[0].lastChild:d[0].firstChild;y.length;)y.shift()._4e_move(d,!t);j._4e_moveChildren(d,!t);j._4e_remove();w[0]&&w[0].nodeType==l.NODE_ELEMENT&&w._4e_mergeSiblings()}}}return function(d){if(d[0])if(k[d._4e_name()]||
d._4e_name()=="a"){c(d,new q(d[0].nextSibling),true);c(d,new q(d[0].previousSibling))}}}(),_4e_unselectable:m.gecko?function(c){c=i(c);c.style.MozUserSelect="none"}:m.webkit?function(c){c=i(c);c.style.KhtmlUserSelect="none"}:function(c){c=i(c);if(m.ie||m.opera){var d=0;c.unselectable="on";for(var j=c.getElementsByTagName("*");c=j[d++];)switch(c.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:c.unselectable="on"}}},_4e_getOffset:function(c,d){c=i(c);var j,
t=0;j=0;var y=c.ownerDocument.defaultView||c.ownerDocument.parentWindow,w=c.ownerDocument,v=w.documentElement;d=d||w;if(c.getBoundingClientRect){if(c!==w.body&&v!==c){j=c.getBoundingClientRect();t=j.left+(d===w?p.scrollLeft(y):0);j=j.top+(d===w?p.scrollTop(y):0)}if(d)if(y!=(d.defaultView||d.parentWindow)&&y.frameElement){y=h._4e_getOffset(y.frameElement,d);t+=y.left;j+=y.top}}return{left:t,top:j}},_4e_getFrameDocument:function(c){return(c=i(c))&&c.contentWindow.document},_4e_splitText:function(c,
d){c=i(c);var j=c.ownerDocument;if(!(!c||c.nodeType!=l.NODE_TEXT)){if(m.ie&&d==c.nodeValue.length){var t=j.createTextNode("");p.insertAfter(t,c);return new q(t)}t=new q(c.splitText(d));if(j.documentMode){j=j.createTextNode("");p.insertAfter(j,t[0]);p._4e_remove(j)}return t}},_4e_parents:function(c,d){c=u(c);var j=[];do j[d?"push":"unshift"](c);while(c=c.parent());return j},_4e_clone:function(c,d,j){c=i(c);c=c.cloneNode(d);if(!j){var t=function(y){if(y.nodeType==l.NODE_ELEMENT){y.removeAttribute("id");
y=y.childNodes;for(var w=0;w<y.length;w++)t(y[w])}};t(c)}return new q(c)},_4e_nextSourceNode:function(c,d,j,t){c=i(c);if(t&&!t.call){var y=t[0]||t;t=function(v){v=v[0]||v;return v!==y}}d=!d&&c.firstChild;var w=new q(c);if(!d){if(c.nodeType==l.NODE_ELEMENT&&t&&t(c,true)===false)return null;d=c.nextSibling}for(;!d&&(w=w.parent());){if(t&&t(w,true)===false)return null;d=w[0].nextSibling}if(!d)return null;d=p._4e_wrap(d);if(t&&t(d)===false)return null;if(j&&j!=d[0].nodeType)return d._4e_nextSourceNode(false,
j,t);return d},_4e_previousSourceNode:function(c,d,j,t){c=i(c);if(t&&!t.call){var y=t[0]||t;t=function(v){v=v[0]||v;return v!==y}}d=!d&&c.lastChild;var w=new q(c);if(!d){if(c.nodeType==l.NODE_ELEMENT&&t&&t(c,true)===false)return null;d=c.previousSibling}for(;!d&&(w=w.parent());){if(t&&t(w,true)===false)return null;d=w[0].previousSibling}if(!d)return null;d=p._4e_wrap(d);if(t&&t(d)===false)return null;if(j&&d[0].nodeType!=j)return d._4e_previousSourceNode(false,j,t);return d},_4e_commonAncestor:function(c,
d){if(c._4e_equals(d))return c;if(d[0].nodeType!=l.NODE_TEXT&&d.contains(c))return d;var j=c[0].nodeType==l.NODE_TEXT?c.parent():c;do if(j[0].nodeType!=l.NODE_TEXT&&j.contains(d))return j;while(j=j.parent());return null},_4e_ascendant:function(c,d,j){c=i(c);if(!j)c=c.parentNode;if(d&&!s.isFunction(d)){var t=d;d=function(y){return y._4e_name()==t}}for(;c&&c.nodeType!=9;){if(!d||d(new q(c))===true)return new q(c);c=c.parentNode}return null},_4e_hasAttribute:n.ieEngine<9?function(c,d){c=i(c);var j=c.attributes[d];
return!!(j&&j.specified)}:function(c,d){c=i(c);return c.hasAttribute(d)},_4e_hasAttributes:n.ieEngine<9?function(c){c=i(c);for(var d=c.attributes,j=0;j<d.length;j++){var t=d[j];switch(t.name){case "class":if(c.getAttribute("class"))return true;break;default:if(t.specified)return true}}return false}:function(c){c=i(c);m.gecko&&c.removeAttribute("_moz_dirty");return c.hasAttributes()},_4e_position:function(c,d){var j=i(c),t=i(d);if(j.compareDocumentPosition)return j.compareDocumentPosition(t);if(j==
t)return b.POSITION_IDENTICAL;if(j.nodeType==l.NODE_ELEMENT&&t.nodeType==l.NODE_ELEMENT){if(j.contains){if(j.contains(t))return b.POSITION_CONTAINS+b.POSITION_PRECEDING;if(t.contains(j))return b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING}if("sourceIndex"in j)return j.sourceIndex<0||t.sourceIndex<0?b.POSITION_DISCONNECTED:j.sourceIndex<t.sourceIndex?b.POSITION_PRECEDING:b.POSITION_FOLLOWING}j=c._4e_address();t=d._4e_address();for(var y=Math.min(j.length,t.length),w=0;w<=y-1;w++)if(j[w]!=t[w]){if(w<
y)return j[w]<t[w]?b.POSITION_PRECEDING:b.POSITION_FOLLOWING;break}return j.length<t.length?b.POSITION_CONTAINS+b.POSITION_PRECEDING:b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING},_4e_address:function(c,d){c=i(c);for(var j=[],t=c.ownerDocument.documentElement,y=c;y&&y!=t;){var w=y.parentNode,v=-1;if(w){for(var r=0;r<w.childNodes.length;r++){var z=w.childNodes[r];if(!(d&&z.nodeType==3&&z.previousSibling&&z.previousSibling.nodeType==3)){v++;if(z==y)break}}j.unshift(v)}y=w}return j},_4e_breakParent:function(c,
d){var j=new g.Range(c[0].ownerDocument);j.setStartAfter(c);j.setEndAfter(d);var t=j.extractContents();j.insertNode(c._4e_remove());c[0].parentNode.insertBefore(t,c[0].nextSibling)},_4e_style:function(c,d,j){c=u(c);if(j!==undefined)return c.css(d,j);c=i(c);return c.style[o(d)]},_4e_remove:function(c,d){var j=i(c),t=j.parentNode;if(t){if(d)for(var y;y=j.firstChild;)t.insertBefore(j.removeChild(y),j);t.removeChild(j)}return c},_4e_trim:function(c){p._4e_ltrim(c);p._4e_rtrim(c)},_4e_ltrim:function(c){c=
i(c);for(var d;d=c.firstChild;){if(d.nodeType==l.NODE_TEXT){var j=n.ltrim(d.nodeValue),t=d.nodeValue.length;if(j){if(j.length<t){(new q(d))._4e_splitText(t-j.length);c.removeChild(c.firstChild)}}else{c.removeChild(d);continue}}break}},_4e_rtrim:function(c){c=i(c);for(var d;d=c.lastChild;){if(d.type==l.NODE_TEXT){var j=n.rtrim(d.nodeValue),t=d.nodeValue.length;if(j){if(j.length<t){(new q(d))._4e_splitText(j.length);c.removeChild(c.lastChild)}}else{c.removeChild(d);continue}}break}if(!m.ie&&!m.opera)(d=
c.lastChild)&&d.nodeType==1&&d.nodeName.toLowerCase()=="br"&&d.parentNode.removeChild(d)},_4e_appendBogus:function(c){c=i(c);for(var d=c.lastChild;d&&d.nodeType==l.NODE_TEXT&&!s.trim(d.nodeValue);)d=d.previousSibling;if(!d||d.nodeType==l.NODE_TEXT||p._4e_name(d)!=="br"){d=m.opera?c.ownerDocument.createTextNode(""):c.ownerDocument.createElement("br");m.gecko&&d.setAttribute("type","_moz");c.appendChild(d)}},_4e_previous:function(c,d){var j=i(c),t;do t=(j=j.previousSibling)&&new q(j);while(t&&d&&!d(t));
return t},_4e_last:function(c,d){c=p._4e_wrap(c);var j=c[0].lastChild;if((j=j&&new q(j))&&d&&!d(j))j=j._4e_previous(d);return j},_4e_next:function(c,d){var j=i(c),t;do t=(j=j.nextSibling)&&new q(j);while(t&&d&&!d(t));return t},_4e_outerHtml:function(c){c=i(c);if(c.outerHTML)return c.outerHTML.replace(/<\?[^>]*>/,"");var d=c.ownerDocument.createElement("div");d.appendChild(c.cloneNode(true));return d.innerHTML},_4e_setMarker:function(c,d,j,t){c=p._4e_wrap(c);var y=c.data("list_marker_id")||c.data("list_marker_id",
s.guid()).data("list_marker_id"),w=c.data("list_marker_names")||c.data("list_marker_names",{}).data("list_marker_names");d[y]=c;w[j]=1;return c.data(j,t)},_4e_clearMarkers:function(c,d,j){c=u(c);var t=c.data("list_marker_names"),y=c.data("list_marker_id"),w;for(w in t)c.removeData(w);c.removeData("list_marker_names");if(j){c.removeData("list_marker_id");delete d[y]}},_4e_copyAttributes:function(c,d,j){c=i(c);d=u(d);var t=c.attributes;j=j||{};for(var y=0;y<t.length;y++){var w=t[y],v=w.name.toLowerCase(),
r;if(!(v in j))if(v=="checked"&&(r=p.attr(c,v)))d.attr(v,r);else if(w.specified||m.ie&&w.value&&v=="value"){r=p.attr(c,v);if(r===null)r=w.nodeValue;d.attr(v,r)}}if(c.style.cssText!=="")d[0].style.cssText=c.style.cssText},_4e_isEditable:function(c){c=p._4e_name(c);var d=g.XHTML_DTD;return(c=!d.$nonEditable[c]&&(d[c]||d.span))&&c["#"]},_4e_scrollIntoView:function(c){c=u(c);var d=c[0].ownerDocument,j=p.scrollLeft(d),t=p.scrollTop(d),y=c.offset(),w=y.left;y=y.top;if(p.viewportHeight(d)+t<y||y<t||p.viewportWidth(d)+
j<w||w<j)c.scrollIntoView(d)},_4e_getElementsByTagName:function(c,d,j){c=i(c);if(!m.ie&&j)d=j+":"+d;j=[];c=c.getElementsByTagName(d);for(d=0;d<c.length;d++)j.push(new q(c[d]));return j}};s.DOM._4e_inject=function(c){s.mix(p,c);for(var d in c)c.hasOwnProperty(d)&&function(j){q.prototype[j]=function(){var t=[].slice.call(arguments,0);t.unshift(this);return c[j].apply(null,t)}}(d)};n.extern(h,{_4e_wrap:h._4e_wrap,_4e_unwrap:h._4e_unwrap,_4e_equals:h._4e_equals,_4e_isBlockBoundary:h._4e_isBlockBoundary,
_4e_getWin:h._4e_getWin,_4e_index:h._4e_index,_4e_first:h._4e_first,_4e_move:h._4e_move,_4e_name:h._4e_name,_4e_isIdentical:h._4e_isIdentical,_4e_isEmptyInlineRemoveable:h._4e_isEmptyInlineRemoveable,_4e_moveChildren:h._4e_moveChildren,_4e_mergeSiblings:h._4e_mergeSiblings,_4e_unselectable:h._4e_unselectable,_4e_getOffset:h._4e_getOffset,_4e_getFrameDocument:h._4e_getFrameDocument,_4e_splitText:h._4e_splitText,_4e_parents:h._4e_parents,_4e_clone:h._4e_clone,_4e_nextSourceNode:h._4e_nextSourceNode,
_4e_previousSourceNode:h._4e_previousSourceNode,_4e_commonAncestor:h._4e_commonAncestor,_4e_ascendant:h._4e_ascendant,_4e_hasAttribute:h._4e_hasAttribute,_4e_hasAttributes:h._4e_hasAttributes,_4e_position:h._4e_position,_4e_address:h._4e_address,_4e_breakParent:h._4e_breakParent,_4e_style:h._4e_style,_4e_remove:h._4e_remove,_4e_trim:h._4e_trim,_4e_ltrim:h._4e_ltrim,_4e_rtrim:h._4e_rtrim,_4e_appendBogus:h._4e_appendBogus,_4e_last:h._4e_last,_4e_previous:h._4e_previous,_4e_next:h._4e_next,_4e_outerHtml:h._4e_outerHtml,
_4e_setMarker:h._4e_setMarker,_4e_clearMarkers:h._4e_clearMarkers,_4e_getUniqueId:h._4e_getUniqueId,_4e_copyAttributes:h._4e_copyAttributes,_4e_isEditable:h._4e_isEditable,_4e_scrollIntoView:h._4e_scrollIntoView,_4e_getElementsByTagName:h._4e_getElementsByTagName});p._4e_inject(h)});
KISSY.Editor.add("focusmanager",function(g){function o(){this.iframeFocus=b;k=this;p.log(this._UUID+" focus")}function s(){this.iframeFocus=e;k=f;p.log(this._UUID+" blur")}var p=KISSY,m=p.DOM,q=p.Event,n={},k,l={refreshAll:function(){for(var i in n){var u=n[i];u.document.designMode="off";u.document.designMode="on"}},currentInstance:function(){return k},getInstance:function(i){return n[i]},add:function(i){var u=m._4e_getWin(i.document);q.on(u,"focus",o,i);q.on(u,"blur",s,i)},register:function(i){n[i._UUID]=
i},remove:function(i){delete n[i._UUID];var u=m._4e_getWin(i.document);q.remove(u,"focus",o,i);q.remove(u,"blur",s,i)}},b=true,e=false,f=null;g.focusManager=l;g.focusManager=l;g.getInstances=function(){return n};g.getInstances=g.getInstances});
KISSY.Editor.add("definition",function(g){var o=true,s=false,p=g.Utils,m=document,q=KISSY,n=q.UA,k=q.DOM,l=q.Node,b=q.Event,e=g.focusManager,f=p.tryThese,i=p.debugUrl("theme/editor-iframe.css"),u=1,h="document.open();"+(p.isCustomDomain()?'document.domain="'+m.domain+'";':"")+"document.close();",c="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(n.ie?"javascript:void(function(){"+encodeURIComponent(h)+"}())":"")+'"  tabIndex="'+(n.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";g.SOURCE_MODE=0;g.WYSIWYG_MODE=1;g.SOURCE_MODE=g.SOURCE_MODE;g.WYSIWYG_MODE=g.WYSIWYG_MODE;q.augment(g,{init:function(d){if(n.ie)k.addClass(m.body,"ie"+n.ie);else if(n.gecko)k.addClass(m.body,"gecko");else n.webkit&&k.addClass(m.body,"webkit");var j=this,t=new l(c.replace(/\$\(tabIndex\)/,
d.attr("tabIndex")));j.editorWrap=t;j._UUID=u++;e.register(j);j.wrap=t.one(".ke-textarea-wrap");j.wrap=j.wrap;j.iframe=j.wrap.one("iframe");j.iframe=j.iframe;j.toolBarDiv=t.one(".ke-editor-tools");j.toolBarDiv=j.toolBarDiv;j.textarea=d;j.textarea=j.textarea;j.statusDiv=t.one(".ke-editor-status");j.statusDiv=j.statusDiv;p.preventFocus(j.toolBarDiv);j._commands={};j._dialogs={};var y=d._4e_style("width"),w=d._4e_style("height");if(y){t.css("width",y);d.css("width","100%")}j.textarea.css("display","none");
t.insertAfter(d);j.wrap[0].appendChild(d[0]);if(w){j.wrap.css("height",w);d.css("height","100%")}t=j.iframe;j.on("dataReady",function(){j._ready=o;g.fire("instanceCreated",{editor:j})});n.gecko?t.on("load",j._setUpIFrame,j):j._setUpIFrame();j.cfg.attachForm&&d[0].form&&j._attachForm()},_attachForm:function(){(new l(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(d,j){var t=this,y=g.Overlay;y.loading();t.use(d,function(){var w=t.getDialog(d);if(w){j(w);y.unloading()}else q.later(arguments.callee,
50,false,t)})},addDialog:function(d,j){this._dialogs[d]=j},getDialog:function(d){return this._dialogs[d]},addCommand:function(d,j){this._commands[d]=j},hasCommand:function(d){return this._commands[d]},execCommand:function(d){var j=this._commands[d],t=q.makeArray(arguments);t.shift();t.unshift(this);return j.exec.apply(j,t)},getMode:function(){return this.textarea.css("display")=="none"?g.WYSIWYG_MODE:g.SOURCE_MODE},getData:function(d){var j;j=this.getMode()==g.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)j=d?this.htmlDataProcessor.toHtml(j,"p"):this.htmlDataProcessor.toServer(j,"p");j=q.trim(j);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(j))j="";return j},setData:function(d){var j=d;if(this.htmlDataProcessor)j=this.htmlDataProcessor.toDataFormat(d,"p");this.document.body.innerHTML=j;this.getMode()!=g.WYSIWYG_MODE&&this.textarea.val(d)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(d){d=d||0;return d+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(d){this.document.body.innerHTML=d},_prepareIFrameHtml:function(d){var j=this.cfg,t=j.customLink,y="";if(t)for(var w=0;w<t.length;w++)y+='<link href="'+t[w]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+g.Config.base+i+"' rel='stylesheet'/><style>"+(j.customStyle||"")+"</style>"+y+"</head><body class='ke-editor'>&nbsp;"+(d?'<script id="ke_actscript" type="text/javascript">'+(p.isCustomDomain()?'document.domain="'+m.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+d+'");<\/script>':"")+"</body></html>"},getSelection:function(){return g.Selection.getSelection(this.document)},focus:function(){var d=this.document,j=k._4e_getWin(d);n.webkit&&j&&j.parent&&j.parent.focus();j&&j.focus();d&&d.body.focus();this.notifySelectionChange()},blur:function(){k._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(d){var j=this.cfg,t=this.document;j.customStyle=j.customStyle||"";j.customStyle+=
"\n"+d;j=t.createElement("style");t.getElementsByTagName("head")[0].appendChild(j);if(j.styleSheet)j.styleSheet.cssText=d;else j.appendChild(t.createTextNode(d))},addCustomLink:function(d){var j=this.cfg,t=this.document;j.customLink=j.customLink||[];j.customLink.push(d);j=t.createElement("link");j.rel="stylesheet";t.getElementsByTagName("head")[0].appendChild(j);j.href=d},removeCustomLink:function(d){for(var j=this.cfg,t=q.makeArray(this.document.getElementsByTagName("link")),y=0;y<t.length;y++)t[y].href==
d&&k._4e_remove(t[y]);j.customLink=j.customLink||[];j=j.customLink;d=q.indexOf(d,j);d!=-1&&j.splice(d,1)},_setUpIFrame:function(){function d(){v=w.document;j.document=v;t.detach();v.open("text/html","replace");v.write(y);v.close()}var j=this,t=j.iframe,y=j._prepareIFrameHtml(j._UUID),w=t[0].contentWindow,v;try{v=w.document}catch(r){t[0].src=t[0].src;if(n.ie<7){setTimeout(d,10);return}}d()},ready:function(d){this._ready?d():this.on("dataReady",d)},_monitor:function(){var d=this;d._monitorId&&clearTimeout(d._monitorId);
d._monitorId=setTimeout(function(){var j=d.getSelection();if(j&&!j.isInvalid){var t=j.getStartElement(),y=new g.ElementPath(t);if(!d.previousPath||!d.previousPath.compare(y)){d.previousPath=y;d.fire("selectionChange",{selection:j,path:y,element:t})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(d,j){var t=this;t.focus();var y=d._4e_name(),w=g.XHTML_DTD,v=g.RANGE,r=g.NODE,z=w.$block[y],E=t.getSelection(),B=E&&E.getRanges(),x,A,D,F,C;if(!B||
B.length==0){var G=arguments,M=G.callee;setTimeout(function(){M.apply(t,G)},30)}else{t.fire("save");for(var N=B.length-1;N>=0;N--){x=B[N];x.deleteContents();A=!N&&d||d._4e_clone(o);j&&j(A);if(z)for(;(F=x.getCommonAncestor(s,o))&&(C=w[F._4e_name()])&&!(C&&C[y]);)if(F._4e_name()in w.span)x.splitElement(F);else if(x.checkStartOfBlock()&&x.checkEndOfBlock()){x.setStartBefore(F);x.collapse(o);F._4e_remove()}else x.splitBlock();x.insertNode(A);D||(D=A)}if(D){y=D._4e_nextSourceNode(o);w=t.document;C=g.XHTML_DTD;
if(C.$inline[A._4e_name()]){y=new l(w.createTextNode(" "));y.insertAfter(D)}else if(y){if(y._4e_name()=="br"&&C[y.parent()._4e_name()].p){C=new l("<p>&nbsp;</p>",null,w);y[0].parentNode.replaceChild(C[0],y[0]);y=C}}else{C=new l("<p>&nbsp;</p>",null,w);C.insertAfter(D);y=C}x.moveToPosition(D,v.POSITION_AFTER_END);y&&y[0].nodeType==r.NODE_ELEMENT&&x.moveToElementEditablePosition(y);E.selectRanges([x]);t.focus();A&&A._4e_scrollIntoView();setTimeout(function(){t.fire("save")},10);return A}}},insertHtml:function(d){var j=
this;if(j.htmlDataProcessor)d=j.htmlDataProcessor.toDataFormat(d);if(n.webkit){var t=k.create(d,null,this.document);t=t.nodeType==11?q.makeArray(t.childNodes):[t];for(var y=0;y<t.length;y++)j.insertElement(new l(t[y]))}else{j.focus();y=(t=j.getSelection())&&t.getRanges();if(!y||y.length==0){var w=arguments,v=w.callee;setTimeout(function(){v.apply(j,w)},30)}else{j.fire("save");if(n.ie){t=t.getNative();t.type=="Control"&&t.clear();t.createRange().pasteHTML(d)}else j.document.execCommand("inserthtml",
s,d);j.focus();setTimeout(function(){j.fire("save")},10)}}}});g._initIFrame=function(d){function j(A){f(function(){w.designMode="on";setTimeout(function(){w.designMode="off";z.focus();if(!arguments.callee.retry)arguments.callee.retry=o},50)},function(){w.designMode="off";k.attr(z,"contentEditable",s);k.attr(z,"contentEditable",o);!A&&j(1)})}var t=e.getInstance(d);d=t.textarea[0];var y=t.iframe[0].contentWindow,w=t.document,v=t.cfg,r=w.getElementById("ke_actscript");k._4e_remove(r);var z=w.body;if(n.ie){z.hideFocus=
o;z.disabled=o;z.contentEditable=o;z.removeAttribute("disabled")}else setTimeout(function(){if(n.gecko||n.opera)z.contentEditable=o;else if(n.webkit)z.parentNode.contentEditable=o;else w.designMode="on"},0);if(n.webkit){b.on(w,"click",function(A){var D=new l(A.target);q.inArray(D._4e_name(),["input","select"])&&A.preventDefault()});b.on(w,"mouseup",function(A){var D=new l(A.target);q.inArray(D._4e_name(),["input","textarea"])&&A.preventDefault()})}if(n.gecko||n.ie||n.opera){var E;E=new l(k.insertAfter((new l('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
d));E.on("focus",function(){t.focus()});t.activateGecko=function(){n.gecko&&t.iframeFocus&&E[0].focus()};t.on("destroy",function(){})}if(n.ie&&w.compatMode=="CSS1Compat"||n.gecko||n.opera){var B=new l(w.documentElement);B.on("mousedown",function(A){if((new l(A.target))[0]==B[0]){n.gecko&&j(s);E[0].focus()}})}b.on(y,"focus",function(){if(n.gecko)j(s);else n.opera&&z.focus();t.notifySelectionChange()});n.gecko&&b.on(t.document,"mousedown",function(){t.iframeFocus||j(s)});if(n.ie){b.on(w,"keydown",function(A){if(A.keyCode in
{8:1,46:1}){var D=t.getSelection(),F=D.getSelectedElement();if(F){t.fire("save");var C=D.getRanges()[0].createBookmark();F._4e_remove();D.selectBookmarks([C]);t.fire("save");A.preventDefault()}}});if(w.compatMode=="CSS1Compat"){var x={33:1,34:1};b.on(w,"keydown",function(A){A.keyCode in x&&setTimeout(function(){t.getSelection().scrollIntoView()},0)})}}setTimeout(function(){n.ie&&setTimeout(function(){if(w){z.runtimeStyle.marginBottom="0px";z.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){t.fire("dataReady");
var A=v.disableObjectResizing,D=v.disableInlineTableEditing;if(A||D)try{w.execCommand("enableObjectResizing",s,!A);w.execCommand("enableInlineTableEditing",s,!D)}catch(F){b.on(z,n.ie?"resizestart":"resize",function(C){var G=new l(C.target);if(A||G._4e_name()==="table"&&D)C.preventDefault()})}},10);n.webkit&&b.on(w,"mousedown",function(A){A=new l(A.target);q.inArray(A._4e_name(),["img","hr","input","textarea","select"])&&t.getSelection().selectElement(A)});n.gecko&&b.on(w,"dragstart",function(A){var D=
new l(A.target);D._4e_name()==="img"&&/ke_/.test(D[0].className)&&A.preventDefault()});e.add(t)};h=g.prototype;p.extern(h,{setData:h.setData,getData:h.getData,insertElement:h.insertElement,insertHtml:h.insertHtml,ready:h.ready,addCustomStyle:h.addCustomStyle,addCommand:h.addCommand,hasCommand:h.hasCommand,execCommand:h.execCommand,useDialog:h.useDialog,addDialog:h.addDialog,getDialog:h.getDialog,getMode:h.getMode,sync:h.sync,baseZIndex:h.baseZIndex,getSelection:h.getSelection,focus:h.focus,blur:h.blur,
notifySelectionChange:h.notifySelectionChange})});KISSY.Editor.add("zindex",function(){var g=KISSY.Editor;if(!g.zIndexManager){g.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};g.baseZIndex=function(o){var s=o,p=g.getInstances(),m;for(m in p){if(!p.hasOwnProperty(m))return;s=Math.max(s,p[m].baseZIndex(o))}return s};g.baseZIndex=g.baseZIndex;g.zIndexManager=g.zIndexManager}});
KISSY.Editor.add("dtd",function(g){g.XHTML_DTD=function(){function o(v){for(var r=arguments.length-1;r>0;)KISSY.mix(v,arguments[r--]);return v}var s={isindex:1,fieldset:1},p={input:1,button:1,select:1,textarea:1,label:1},m=o({a:1},p),q=o({iframe:1},m),n={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},k={ins:1,del:1,script:1,style:1},l=o({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},k),b=o({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},l),e=o({p:1},b);p=o({iframe:1},b,p);b={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var f=o({a:1},p),i={tr:1},u={"#":1},h=o({param:1},b),c=o({form:1},s,q,n,e),d={li:1},j={base:1,link:1,meta:1,title:1},t=o(j,{style:1,script:1}),y={head:1,body:1},w={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:o({html:1},y,j),$block:w,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:f,$body:o({script:1,style:1},w),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:y,head:t,style:u,body:c,base:{},link:{},meta:{},title:u,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:c,td:c,br:{},th:c,center:c,kbd:f,button:o(e,n),basefont:{},h5:f,h4:f,samp:f,h6:f,ol:d,h1:f,h3:f,option:u,h2:f,form:o(s,q,n,e),select:{optgroup:1,option:1},font:f,ins:f,menu:d,abbr:f,label:f,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:f,script:u,tfoot:i,cite:f,li:c,input:{},iframe:c,strong:f,textarea:u,noframes:c,big:f,small:f,span:f,hr:{},dt:f,sub:f,optgroup:{option:1},param:{},bdo:f,"var":f,div:c,object:h,sup:f,dd:c,strike:f,area:{},dir:d,map:o({area:1,form:1,p:1},s,k,n),applet:h,dl:{dt:1,dd:1},del:f,isindex:{},fieldset:o({legend:1},b),thead:i,ul:d,acronym:f,b:f,a:p,blockquote:c,caption:f,i:f,u:f,tbody:i,s:f,address:o(q,e),tt:f,legend:f,q:f,pre:o(l,m),p:f,em:f,dfn:f}}();g.XHTML_DTD=
g.XHTML_DTD});
KISSY.Editor.add("elementpath",function(g){function o(b){var e=q,f=q,i=[];for(b=b;b&&b[0];){if(b[0].nodeType==m.NODE_ELEMENT){if(!this.lastElement)this.lastElement=b;var u=b._4e_name();if(!f){if(!e&&n[u])e=b;if(k[u]){var h;if(h=!e){if(h=u=="div"){a:{h=b;h=h[0]||h;h=h.childNodes;for(var c=0,d=h.length;c<d;c++){var j=h[c];if(j.nodeType==m.NODE_ELEMENT&&p.$block[j.nodeName.toLowerCase()]){h=true;break a}}h=false}h=!h}h=h}if(h)e=b;else f=b}}i.push(b);if(u=="body")break}b=b.parent()}this.block=this.block=
e;this.blockLimit=this.blockLimit=f;this.elements=this.elements=i}var s=KISSY.DOM,p=g.XHTML_DTD,m=g.NODE,q=null,n={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},k={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};o.prototype={compare:function(b){var e=this.elements;b=b&&b.elements;if(!b||e.length!=b.length)return false;for(var f=0;f<e.length;f++)if(!s._4e_equals(e[f],b[f]))return false;return true},contains:function(b){for(var e=this.elements,f=0;f<
e.length;f++)if(e[f]._4e_name()in b)return e[f];return q}};g.ElementPath=g.ElementPath=o;var l=o.prototype;g.Utils.extern(l,{compare:l.compare,contains:l.contains})});
KISSY.Editor.add("walker",function(g){function o(i,u){if(this._.end)return n;var h,c=this.range,d,j=this.guard,t=this.type,y=i?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;c.trim();if(c.collapsed){this.end();return n}}if(!i&&!this._.guardLTR){var w=c.endContainer,v=new e(w[0].childNodes[c.endOffset]);this._.guardLTR=function(B,x){return(B=b._4e_wrap(B))&&B[0]&&(!x||!b._4e_equals(w,B))&&(!v[0]||!B._4e_equals(v))&&(B[0].nodeType!=l.NODE_ELEMENT||!x||B._4e_name()!="body")}}if(i&&
!this._.guardRTL){var r=c.startContainer,z=c.startOffset>0&&new e(r[0].childNodes[c.startOffset-1]);this._.guardRTL=function(B,x){return(B=b._4e_wrap(B))&&B[0]&&(!x||!B._4e_equals(r))&&(!z[0]||!B._4e_equals(z))&&(B[0].nodeType!=l.NODE_ELEMENT||!x||B._4e_name()!="body")}}var E=i?this._.guardRTL:this._.guardLTR;d=j?function(B,x){if(E(B,x)===q)return q;return j(B,x)}:E;if(this.current)h=this.current[y](q,t,d);else if(i){h=c.endContainer;if(c.endOffset>0){h=new e(h[0].childNodes[c.endOffset-1]);if(d(h)===
q)h=n}else h=d(h,m)===q?n:h._4e_previousSourceNode(m,t,d)}else{h=c.startContainer;if((h=new e(h[0].childNodes[c.startOffset]))&&h[0]){if(d(h)===q)h=n}else h=d(c.startContainer,m)===q?n:c.startContainer._4e_nextSourceNode(m,t,d)}for(;h&&h[0]&&!this._.end;){this.current=h;if(!this.evaluator||this.evaluator(h)!==q){if(!u)return h}else if(u&&this.evaluator)return q;h=h[y](q,t,d)}this.end();return this.current=n}function s(i){for(var u,h=n;u=o.call(this,i);)h=u;return h}function p(i){this.range=i;this._=
{}}var m=true,q=false,n=null,k=KISSY,l=g.NODE,b=k.DOM,e=k.Node;k.augment(p,{end:function(){this._.end=1},next:function(){return o.call(this)},previous:function(){return o.call(this,m)},checkForward:function(){return o.call(this,q,m)!==q},checkBackward:function(){return o.call(this,m,m)!==q},lastForward:function(){return s.call(this)},lastBackward:function(){return s.call(this,m)},reset:function(){delete this.current;this._={}}});p.blockBoundary=function(i){return function(u){u=b._4e_wrap(u);return!(u&&
u[0].nodeType==l.NODE_ELEMENT&&u._4e_isBlockBoundary(i))}};p.listItemBoundary=function(){return this.blockBoundary({br:1})};p.bookmark=function(i,u){function h(c){return c&&c[0]&&c._4e_name()=="span"&&c.attr("_ke_bookmark")}return function(c){var d,j;d=c&&c[0]&&c[0].nodeType==l.NODE_TEXT&&(j=c.parent())&&h(j);d=i?d:d||h(c);return u^d}};p.whitespaces=function(i){return function(u){u=(u=u[0]||u)&&u.nodeType==l.NODE_TEXT&&!k.trim(u.nodeValue);return i^u}};p.invisible=function(i){var u=p.whitespaces();
return function(h){h=u(h)||h[0].nodeType==l.NODE_ELEMENT&&!h[0].offsetHeight;return i^h}};g.Walker=p;g.Walker=p;var f=p.prototype;g.Utils.extern(f,{end:f.end,next:f.next,previous:f.previous,checkForward:f.checkForward,checkBackward:f.checkBackward,lastForward:f.lastForward,lastBackward:f.lastBackward,reset:f.reset});g.Utils.extern(p,{blockBoundary:p.blockBoundary,listItemBoundary:p.listItemBoundary,bookmark:p.bookmark,whitespaces:p.whitespaces,invisible:p.invisible})});
KISSY.Editor.add("range",function(g){function o(x){this.endOffset=this.endContainer=this.startOffset=this.startContainer=b;this.collapsed=k;this.document=x}function s(x){var A=x[0].nodeType!=f.NODE_TEXT&&x._4e_name()in t.$removeEmpty,D=!e.trim(x[0].nodeValue);x=!!x.parent().attr("_ke_bookmark");return A||D||x}function p(x){return!z(x)&&!E(x)}function m(x){var A=l,D=h.bookmark(k);return function(F){if(D(F))return k;if(F[0].nodeType==f.NODE_TEXT){if(e.trim(F[0].nodeValue).length)return l}else if(F[0].nodeType==
f.NODE_ELEMENT)if(!r[F._4e_name()])if(!x&&!j.ie&&F._4e_name()=="br"&&!A)A=k;else return l;return k}}function q(x,A){function D(F){return F&&F.nodeName=="span"&&F.getAttribute("_ke_bookmark")}return function(F){var C,G;C=F&&!F.nodeName&&(G=F.parentNode)&&D(G);C=x?C:C||D(F);return A^C}}function n(x){return function(A){A=(A=A[0]||A)&&A.nodeType==f.NODE_TEXT&&!e.trim(A.nodeValue);return x^A}}g.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};g.RANGE=g.RANGE;var k=true,l=false,b=null,e=KISSY,f=g.NODE,i=g.RANGE,u=g.POSITION,h=g.Walker,c=e.DOM,d=g.Utils.getByAddress,j=e.UA,t=g.XHTML_DTD,y=g.ElementPath,w=e.Node,v={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};o.prototype.toString=function(){var x=[];x.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);x.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return x.join("<br/>")};e.augment(o,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&c._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var x=this.startContainer,A=this.startOffset;if(x[0].nodeType!=f.NODE_ELEMENT)if(A)A>=x[0].nodeValue.length&&this.setStartAfter(x);else this.setStartBefore(x);x=this.endContainer;A=this.endOffset;if(x[0].nodeType!=f.NODE_ELEMENT)if(A)A>=
x[0].nodeValue.length&&this.setEndAfter(x);else this.setEndBefore(x)},setStartAfter:function(x){this.setStart(x.parent(),x._4e_index()+1)},setStartBefore:function(x){this.setStart(x.parent(),x._4e_index())},setEndAfter:function(x){this.setEnd(x.parent(),x._4e_index()+1)},setEndBefore:function(x){this.setEnd(x.parent(),x._4e_index())},optimizeBookmark:function(){var x=this.startContainer,A=this.endContainer;x&&x._4e_name()=="span"&&x.attr("_ke_bookmark")&&this.setStartAt(x,i.POSITION_BEFORE_START);
A&&A._4e_name()=="span"&&A.attr("_ke_bookmark")&&this.setEndAt(A,i.POSITION_AFTER_END)},setStart:function(x,A){if(x[0].nodeType==f.NODE_ELEMENT&&v[x._4e_name()]){x=x.parent();A=x._4e_index()}this.startContainer=x;this.startOffset=A;if(!this.endContainer){this.endContainer=x;this.endOffset=A}this.updateCollapsed()},setEnd:function(x,A){if(x[0].nodeType==f.NODE_ELEMENT&&v[x._4e_name()]){x=x.parent();A=x._4e_index()+1}this.endContainer=x;this.endOffset=A;if(!this.startContainer){this.startContainer=
x;this.startOffset=A}this.updateCollapsed()},setStartAt:function(x,A){switch(A){case i.POSITION_AFTER_START:this.setStart(x,0);break;case i.POSITION_BEFORE_END:x[0].nodeType==f.NODE_TEXT?this.setStart(x,x[0].nodeValue.length):this.setStart(x,x[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setStartBefore(x);break;case i.POSITION_AFTER_END:this.setStartAfter(x)}this.updateCollapsed()},setEndAt:function(x,A){switch(A){case i.POSITION_AFTER_START:this.setEnd(x,0);break;case i.POSITION_BEFORE_END:x[0].nodeType==
f.NODE_TEXT?this.setEnd(x,x[0].nodeValue.length):this.setEnd(x,x[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setEndBefore(x);break;case i.POSITION_AFTER_END:this.setEndAfter(x)}this.updateCollapsed()},execContentsAction:function(x,A){var D=this.startContainer,F=this.endContainer,C=this.startOffset,G=this.endOffset,M,N=this.document,Q;this.optimizeBookmark();if(F[0].nodeType==f.NODE_TEXT)F=F._4e_splitText(G);else if(F[0].childNodes.length>0)if(G>=F[0].childNodes.length){F=new w(F[0].appendChild(N.createTextNode("")));
Q=k}else F=new w(F[0].childNodes[G]);if(D[0].nodeType==f.NODE_TEXT){D._4e_splitText(C);if(D._4e_equals(F))F=new w(D[0].nextSibling)}else if(C)if(C>=D[0].childNodes.length){M=new w(N.createTextNode(""));D.append(M);D=M;M=k}else D=new w(D[0].childNodes[C].previousSibling);else{M=new w(N.createTextNode(""));D.prepend(M);D=M;M=k}C=D._4e_parents();G=F._4e_parents();var R,V,T;for(R=0;R<C.length;R++){V=C[R];T=G[R];if(!V._4e_equals(T))break}N=A;for(var U,W,H,L=R;L<C.length;L++){U=C[L];W=N&&!U._4e_equals(D)?
N.appendChild(U._4e_clone()[0]):null;for(U=U[0].nextSibling;U;){if(c._4e_equals(G[L],U)||c._4e_equals(F,U))break;H=U.nextSibling;if(x==2)N.appendChild(U.cloneNode(k));else{c._4e_remove(U);x==1&&N.appendChild(U)}U=H}if(W)N=W}N=A;for(R=R;R<G.length;R++){U=G[R];W=N&&x>0&&!U._4e_equals(F)?N.appendChild(U._4e_clone()[0]):null;if(!C[R]||!U.parent()._4e_equals(C[R].parent()))for(U=U[0].previousSibling;U;){if(c._4e_equals(C[R],U)||c._4e_equals(D,U))break;H=U.previousSibling;if(x==2)N.insertBefore(U.cloneNode(k),
N.firstChild);else{c._4e_remove(U);x==1&&N.insertBefore(U,N.firstChild)}U=H}if(W)N=W}if(x==2){T=this.startContainer[0];if(T.nodeType==f.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==f.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}T=this.endContainer[0];if(T.nodeType==f.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==f.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}}else{if(V&&T&&(!D.parent()._4e_equals(V.parent())||!F.parent()._4e_equals(T.parent()))){V=
T._4e_index();M&&T.parent()._4e_equals(D.parent())&&V--;this.setStart(T.parent(),V)}this.collapse(k)}M&&D._4e_remove();Q&&F[0].parentNode&&F._4e_remove()},collapse:function(x){if(x){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=k},clone:function(){var x=new o(this.document);x.startContainer=this.startContainer;x.startOffset=this.startOffset;x.endContainer=this.endContainer;x.endOffset=
this.endOffset;x.collapsed=this.collapsed;return x},getEnclosedNode:function(){var x=this.clone();x.optimize();if(x.startContainer[0].nodeType!=f.NODE_ELEMENT||x.endContainer[0].nodeType!=f.NODE_ELEMENT)return b;var A=new g.Walker(x),D=q(k,undefined),F=n(k);x.evaluator=function(C){return F(C)&&D(C)};x=A.next();A.reset();A=A.previous();return x&&x._4e_equals(A)?x:b},shrink:function(x,A){if(!this.collapsed){x=x||i.SHRINK_TEXT;var D=this.clone(),F=this.startContainer,C=this.endContainer,G=this.startOffset,
M=this.endOffset,N=1,Q=1;if(F&&F[0].nodeType==f.NODE_TEXT)if(G)if(G>=F[0].nodeValue.length)D.setStartAfter(F);else{D.setStartBefore(F);N=0}else D.setStartBefore(F);if(C&&C[0].nodeType==f.NODE_TEXT)if(M)if(M>=C[0].nodeValue.length)D.setEndAfter(C);else{D.setEndAfter(C);Q=0}else D.setEndBefore(C);D=new h(D);D.evaluator=function(V){V=V[0]||V;return V.nodeType==(x==i.SHRINK_ELEMENT?f.NODE_ELEMENT:f.NODE_TEXT)};var R;D.guard=function(V,T){V=V[0]||V;if(x==i.SHRINK_ELEMENT&&V.nodeType==f.NODE_TEXT)return l;
if(T&&V==R)return l;if(!T&&V.nodeType==f.NODE_ELEMENT)R=V;return k};if(N)(F=D[x==i.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(F,A?i.POSITION_AFTER_START:i.POSITION_BEFORE_START);if(Q){D.reset();(D=D[x==i.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(D,A?i.POSITION_BEFORE_END:i.POSITION_AFTER_END)}return!!(N||Q)}},getTouchedStartNode:function(){var x=this.startContainer;if(this.collapsed||x[0].nodeType!=f.NODE_ELEMENT)return x;return x.childNodes[this.startOffset]||x},createBookmark2:function(x){var A=
this.startContainer,D=this.endContainer,F=this.startOffset,C=this.endOffset,G,M;if(!A||!D)return{start:0,end:0};if(x){if(A[0].nodeType==f.NODE_ELEMENT)if((G=new w(A[0].childNodes[F]))&&G[0]&&G[0].nodeType==f.NODE_TEXT&&F>0&&G[0].previousSibling.nodeType==f.NODE_TEXT){A=G;F=0}for(;A[0].nodeType==f.NODE_TEXT&&(M=A._4e_previous())&&M[0].nodeType==f.NODE_TEXT;){A=M;F+=M[0].nodeValue.length}if(!this.collapsed){if(D[0].nodeType==f.NODE_ELEMENT)if((G=new w(D[0].childNodes[C]))&&G[0]&&G[0].nodeType==f.NODE_TEXT&&
C>0&&G[0].previousSibling.nodeType==f.NODE_TEXT){D=G;C=0}for(;D[0].nodeType==f.NODE_TEXT&&(M=D._4e_previous())&&M[0].nodeType==f.NODE_TEXT;){D=M;C+=M[0].nodeValue.length}}}return{start:A._4e_address(x),end:this.collapsed?b:D._4e_address(x),startOffset:F,endOffset:C,normalized:x,is2:k}},createBookmark:function(x){var A,D,F,C,G=this.collapsed;A=new w("<span>",b,this.document);A.attr("_ke_bookmark",1);A.css("display","none");A.html("&nbsp;");if(x){F=e.guid("ke_bm_");A.attr("id",F+"S")}if(!G){D=A._4e_clone();
D.html("&nbsp;");x&&D.attr("id",F+"E");C=this.clone();C.collapse();C.insertNode(D)}C=this.clone();C.collapse(k);C.insertNode(A);if(D){this.setStartAfter(A);this.setEndBefore(D)}else this.moveToPosition(A,i.POSITION_AFTER_END);return{startNode:x?F+"S":A,endNode:x?F+"E":D,serializable:x,collapsed:G}},moveToPosition:function(x,A){this.setStartAt(x,A);this.collapse(k)},trim:function(x,A){var D=this.startContainer,F=this.startOffset,C=this.collapsed;if((!x||C)&&D[0]&&D[0].nodeType==f.NODE_TEXT){if(F)if(F>=
D[0].nodeValue.length){F=D._4e_index()+1;D=D.parent()}else{var G=D._4e_splitText(F);F=D._4e_index()+1;D=D.parent();if(c._4e_equals(this.startContainer,this.endContainer))this.setEnd(G,this.endOffset-this.startOffset);else if(c._4e_equals(D,this.endContainer))this.endOffset+=1}else{F=D._4e_index();D=D.parent()}this.setStart(D,F);if(C){this.collapse(k);return}}D=this.endContainer;F=this.endOffset;if(!(A||C)&&D[0]&&D[0].nodeType==f.NODE_TEXT){if(F){F>=D.nodeValue.length||D._4e_splitText(F);F=D._4e_index()+
1}else F=D._4e_index();D=D.parent();this.setEnd(D,F)}},insertNode:function(x){this.optimizeBookmark();this.trim(l,k);var A=this.startContainer;A[0].insertBefore(x[0]||x,A[0].childNodes[this.startOffset]||null);c._4e_equals(x.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(x)},moveToBookmark:function(x){if(x.is2){var A=d(this.document,x.start,x.normalized),D=x.startOffset,F=x.end&&d(this.document,x.end,x.normalized);x=x.endOffset;this.setStart(A,D);F?this.setEnd(F,x):this.collapse(k)}else{A=
(D=x.serializable)?e.one("#"+x.startNode,this.document):x.startNode;x=D?e.one("#"+x.endNode,this.document):x.endNode;this.setStartBefore(A);A._4e_remove();if(x&&x[0]){this.setEndBefore(x);x._4e_remove()}else this.collapse(k)}},getCommonAncestor:function(x,A){var D=this.startContainer,F=this.endContainer;D=c._4e_equals(D,F)?x&&D[0].nodeType==f.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new w(D[0].childNodes[this.startOffset]):D:D._4e_commonAncestor(F);return A&&D[0].nodeType==f.NODE_TEXT?D.parent():
D},enlarge:function(x){switch(x){case i.ENLARGE_ELEMENT:if(this.collapsed)break;x=this.getCommonAncestor();var A=new w(this.document.body),D,F,C,G,M,N=l,Q,R;Q=this.startContainer;R=this.startOffset;if(Q[0].nodeType==f.NODE_TEXT){if(R){Q=!e.trim(Q[0].nodeValue.substring(0,R)).length&&Q;N=!!Q}if(Q)if(!(G=Q[0].previousSibling))C=Q.parent()}else{if(R)G=Q[0].childNodes[R-1]||Q[0].lastChild;G||(C=Q)}for(;C||G;){if(C&&!G){if(!M&&c._4e_equals(C,x))M=k;if(!A.contains(C))break;if(!N||C.css("display")!="inline"){N=
l;if(M)D=C;else this.setStartBefore(C)}G=C[0].previousSibling}for(;G;){Q=l;if(G.nodeType==f.NODE_TEXT){R=G.nodeValue;if(/[^\s\ufeff]/.test(R))G=b;Q=/[\s\ufeff]$/.test(R)}else if(G.offsetWidth>0&&!G.getAttribute("_ke_bookmark"))if(N&&t.$removeEmpty[G.nodeName.toLowerCase()]){R=c.text(G);if(/[^\s\ufeff]/.test(R))G=b;else for(var V=G.all||G.getElementsByTagName("*"),T=0,U;U=V[T++];)if(!t.$removeEmpty[U.nodeName.toLowerCase()]){G=b;break}if(G)Q=!!R.length}else G=b;if(Q)if(N)if(M)D=C;else C&&this.setStartBefore(C);
else N=k;if(G){Q=G.previousSibling;if(!C&&!Q){C=new w(G);G=b;break}G=Q}else C=b}if(C)C=C.parent()}Q=this.endContainer;R=this.endOffset;C=G=b;M=N=l;if(Q[0].nodeType==f.NODE_TEXT){Q=!e.trim(Q[0].nodeValue.substring(R)).length&&Q;N=!(Q&&Q[0].nodeValue.length);if(Q)if(!(G=Q[0].nextSibling))C=Q.parent()}else(G=Q[0].childNodes[R])||(C=Q);for(;C||G;){if(C&&!G){if(!M&&c._4e_equals(C,x))M=k;if(!A.contains(C))break;if(!N||C.css("display")!="inline"){N=l;if(M)F=C;else C&&this.setEndAfter(C)}G=C[0].nextSibling}for(;G;){Q=
l;if(G.nodeType==f.NODE_TEXT){R=G.nodeValue;if(/[^\s\ufeff]/.test(R))G=b;Q=/^[\s\ufeff]/.test(R)}else if(G.offsetWidth>0&&!G.getAttribute("_ke_bookmark"))if(N&&t.$removeEmpty[G.nodeName.toLowerCase()]){R=c.text(G);if(/[^\s\ufeff]/.test(R))G=b;else{V=G.all||G.getElementsByTagName("*");for(T=0;U=V[T++];)if(!t.$removeEmpty[U.nodeName.toLowerCase()]){G=b;break}}if(G)Q=!!R.length}else G=b;if(Q)if(N)if(M)F=C;else this.setEndAfter(C);if(G){Q=G.nextSibling;if(!C&&!Q){C=new w(G);G=b;break}G=Q}else C=b}if(C)C=
C.parent()}if(D&&F){x=D.contains(F)?F:D;this.setStartBefore(x);this.setEndAfter(x)}break;case i.ENLARGE_BLOCK_CONTENTS:case i.ENLARGE_LIST_ITEM_CONTENTS:C=new o(this.document);A=new w(this.document.body);C.setStartAt(A,i.POSITION_AFTER_START);C.setEnd(this.startContainer,this.startOffset);C=new h(C);var W,H,L=h.blockBoundary(x==i.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:b),J=function(I){var K=L(I);K||(W=I);return K};D=function(I){var K=J(I);if(!K&&I[0]&&I._4e_name()=="br")H=I;return K};C.guard=J;C=C.lastBackward();
W=W||A;this.setStartAt(W,W._4e_name()!="br"&&(!C&&this.checkStartOfBlock()||C&&W.contains(C))?i.POSITION_AFTER_START:i.POSITION_AFTER_END);C=this.clone();C.collapse();C.setEndAt(A,i.POSITION_BEFORE_END);C=new h(C);C.guard=x==i.ENLARGE_LIST_ITEM_CONTENTS?D:J;W=b;C=C.lastForward();W=W||A;this.setEndAt(W,!C&&this.checkEndOfBlock()||C&&W.contains(C)?i.POSITION_BEFORE_END:i.POSITION_BEFORE_START);H&&this.setEndAfter(H)}},checkStartOfBlock:function(){var x=this.startContainer,A=this.startOffset;if(A&&x[0].nodeType==
f.NODE_TEXT)if(e.trim(x[0].nodeValue.substring(0,A)).length)return l;this.trim();x=new y(this.startContainer);A=this.clone();A.collapse(k);A.setStartAt(x.block||x.blockLimit,i.POSITION_AFTER_START);x=new h(A);x.evaluator=m(k);return x.checkBackward()},checkEndOfBlock:function(){var x=this.endContainer,A=this.endOffset;if(x[0].nodeType==f.NODE_TEXT)if(e.trim(x[0].nodeValue.substring(A)).length)return l;this.trim();x=new y(this.endContainer);A=this.clone();A.collapse(l);A.setEndAt(x.block||x.blockLimit,
i.POSITION_BEFORE_END);x=new h(A);x.evaluator=m(l);return x.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var x=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,x);return x},checkBoundaryOfElement:function(x,A){var D=this.clone();D[A==i.START?"setStartAt":"setEndAt"](x,A==i.START?i.POSITION_AFTER_START:i.POSITION_BEFORE_END);D=new h(D);D.evaluator=s;return D[A==i.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var x=this.startContainer,A=this.endContainer,D=this.startOffset,F=this.endOffset,C;if(x[0].nodeType==f.NODE_ELEMENT){C=x[0].childNodes.length;if(C>D)x=new w(x[0].childNodes[D]);else if(C<1)x=x._4e_previousSourceNode();else{for(x=x[0];x.lastChild;)x=x.lastChild;x=new w(x);x=x._4e_nextSourceNode()||x}}if(A[0].nodeType==f.NODE_ELEMENT){C=A[0].childNodes.length;if(C>F)A=(new w(A[0].childNodes[F]))._4e_previousSourceNode(k);else if(C<1)A=A._4e_previousSourceNode();else{for(A=
A[0];A.lastChild;)A=A.lastChild;A=new w(A)}}if(x._4e_position(A)&u.POSITION_FOLLOWING)x=A;return{startNode:x,endNode:A}},fixBlock:function(x,A){var D=this.createBookmark(),F=new w(this.document.createElement(A));this.collapse(x);this.enlarge(i.ENLARGE_BLOCK_CONTENTS);F[0].appendChild(this.extractContents());F._4e_trim();j.ie||F._4e_appendBogus();this.insertNode(F);this.moveToBookmark(D);return F},splitBlock:function(x){var A=new y(this.startContainer),D=new y(this.endContainer),F=A.block,C=D.block,
G=b;if(!A.blockLimit._4e_equals(D.blockLimit))return b;if(x!="br"){if(!F){F=this.fixBlock(k,x);C=(new y(this.endContainer)).block}C||(C=this.fixBlock(l,x))}x=F&&this.checkStartOfBlock();A=C&&this.checkEndOfBlock();this.deleteContents();if(F&&c._4e_equals(F,C))if(A){G=new y(this.startContainer);this.moveToPosition(C,i.POSITION_AFTER_END);C=b}else if(x){G=new y(this.startContainer);this.moveToPosition(F,i.POSITION_BEFORE_START);F=b}else{C=this.splitElement(F);!j.ie&&!e.inArray(F._4e_name(),["ul","ol"])&&
F._4e_appendBogus()}return{previousBlock:F,nextBlock:C,wasStartOfBlock:x,wasEndOfBlock:A,elementPath:G}},splitElement:function(x){if(!this.collapsed)return b;this.setEndAt(x,i.POSITION_BEFORE_END);var A=this.extractContents(),D=x._4e_clone(l);D[0].appendChild(A);D.insertAfter(x);this.moveToPosition(x,i.POSITION_AFTER_END);return D},moveToElementEditablePosition:function(x,A){var D,F=g.XHTML_DTD;if(F.$empty[x._4e_name()])return l;for(;x&&x[0].nodeType==f.NODE_ELEMENT;){if(D=x._4e_isEditable())this.moveToPosition(x,
A?i.POSITION_BEFORE_END:i.POSITION_AFTER_START);else if(F.$inline[x._4e_name()]){this.moveToPosition(x,A?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);return k}if((x=F.$empty[x._4e_name()]?x[A?"_4e_previous":"_4e_next"](p):x[A?"_4e_last":"_4e_first"](p))&&x[0].nodeType==f.NODE_TEXT){this.moveToPosition(x,A?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);return k}}return D},selectNodeContents:function(x){this.setStart(x,0);this.setEnd(x,x[0].nodeType==f.NODE_TEXT?x[0].nodeValue.length:x[0].childNodes.length)}});
var r={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},z=new h.whitespaces,E=new h.bookmark;g.Range=o;g.Range=o;var B=o.prototype;g.Utils.extern(B,{updateCollapsed:B.updateCollapsed,optimize:B.optimize,setStartAfter:B.setStartAfter,setEndAfter:B.setEndAfter,setStartBefore:B.setStartBefore,setEndBefore:B.setEndBefore,optimizeBookmark:B.optimizeBookmark,setStart:B.setStart,setEnd:B.setEnd,
setStartAt:B.setStartAt,setEndAt:B.setEndAt,execContentsAction:B.execContentsAction,collapse:B.collapse,clone:B.clone,getEnclosedNode:B.getEnclosedNode,shrink:B.shrink,getTouchedStartNode:B.getTouchedStartNode,createBookmark2:B.createBookmark2,createBookmark:B.createBookmark,moveToPosition:B.moveToPosition,trim:B.trim,insertNode:B.insertNode,moveToBookmark:B.moveToBookmark,getCommonAncestor:B.getCommonAncestor,enlarge:B.enlarge,checkStartOfBlock:B.checkStartOfBlock,checkEndOfBlock:B.checkEndOfBlock,
deleteContents:B.deleteContents,extractContents:B.extractContents,checkBoundaryOfElement:B.checkBoundaryOfElement,getBoundaryNodes:B.getBoundaryNodes,fixBlock:B.fixBlock,splitBlock:B.splitBlock,splitElement:B.splitElement,moveToElementEditablePosition:B.moveToElementEditablePosition,selectNodeContents:B.selectNodeContents})});
KISSY.Editor.add("domiterator",function(g){function o(h){if(!(arguments.length<1)){this.range=h;this.forceBrBreak=p;this.enlargeBr=s;this.enforceRealBlocks=p;this._||(this._={})}}var s=true,p=false,m=KISSY,q=m.UA,n=g.Walker,k=g.Range,l=g.RANGE,b=g.NODE,e=g.ElementPath,f=m.Node,i=m.DOM,u=/^[\r\n\t ]*$/;m.augment(o,{getNextParagraph:function(h){var c,d,j,t,y;if(!this._.lastNode){d=this.range.clone();d.shrink(l.SHRINK_ELEMENT,s);d.enlarge(this.forceBrBreak||!this.enlargeBr?l.ENLARGE_LIST_ITEM_CONTENTS:
l.ENLARGE_BLOCK_CONTENTS);var w=new n(d),v=n.bookmark(s,s);w.evaluator=v;this._.nextNode=w.next();w=new n(d);w.evaluator=v;w=w.previous();this._.lastNode=w._4e_nextSourceNode(s);if(this._.lastNode&&this._.lastNode[0].nodeType==b.NODE_TEXT&&!m.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){v=new k(d.document);v.moveToPosition(this._.lastNode,l.POSITION_AFTER_END);if(v.checkEndOfBlock()){v=new e(v.endContainer);this._.lastNode=(v.block||v.blockLimit)._4e_nextSourceNode(s)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new f(d.document.createTextNode(""));i.insertAfter(this._.lastNode[0],w[0])}d=null}v=this._.nextNode;w=this._.lastNode;for(this._.nextNode=null;v;){var r=p,z=v[0].nodeType!=b.NODE_ELEMENT,E=p;if(z){if(v[0].nodeType==b.NODE_TEXT)if(u.test(v[0].nodeValue))z=p}else{var B=v._4e_name();if(v._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(B=="br")z=s;else if(!d&&!v[0].childNodes.length&&B!="hr"){c=v;j=v._4e_equals(w);break}if(d){d.setEndAt(v,l.POSITION_BEFORE_START);if(B!="br")this._.nextNode=
v}r=s}else{if(v[0].firstChild){if(!d){d=new k(this.range.document);d.setStartAt(v,l.POSITION_BEFORE_START)}v=new f(v[0].firstChild);continue}z=s}}if(z&&!d){d=new k(this.range.document);d.setStartAt(v,l.POSITION_BEFORE_START)}j=(!r||z)&&v._4e_equals(w);if(d&&!r)for(;!v[0].nextSibling&&!j;){B=v.parent();if(B._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){r=s;j||B._4e_equals(w);break}v=B;z=s;j=v._4e_equals(w);E=s}z&&d.setEndAt(v,l.POSITION_AFTER_END);v=v._4e_nextSourceNode(E,null,w);if((j=!v)||r&&d)break}if(!c){if(!d){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}c=new e(d.startContainer);v=c.blockLimit;r={div:1,th:1,td:1};c=c.block;if((!c||!c[0])&&!this.enforceRealBlocks&&r[v._4e_name()]&&d.checkStartOfBlock()&&d.checkEndOfBlock())c=v;else if(!c||this.enforceRealBlocks&&c._4e_name()=="li"){c=new f(this.range.document.createElement(h||"p"));c[0].appendChild(d.extractContents());c._4e_trim();d.insertNode(c);t=y=s}else if(c._4e_name()!="li"){if(!d.checkStartOfBlock()||!d.checkEndOfBlock()){c=c._4e_clone(p);
c[0].appendChild(d.extractContents());c._4e_trim();y=d.splitBlock();t=!y.wasStartOfBlock;y=!y.wasEndOfBlock;d.insertNode(c)}}else if(!j)this._.nextNode=c._4e_equals(w)?null:d.getBoundaryNodes().endNode._4e_nextSourceNode(s,null,w)}if(t){d=new f(c[0].previousSibling);if(d[0]&&d[0].nodeType==b.NODE_ELEMENT)if(d._4e_name()=="br")d._4e_remove();else d[0].lastChild&&i._4e_name(d[0].lastChild)=="br"&&i._4e_remove(d[0].lastChild)}if(y){d=n.bookmark(p,s);t=new f(c[0].lastChild);if(t[0]&&t[0].nodeType==b.NODE_ELEMENT&&
t._4e_name()=="br")if(q.ie||t._4e_previous(d)||t._4e_next(d))t._4e_remove()}if(!this._.nextNode)this._.nextNode=j||c._4e_equals(w)?null:c._4e_nextSourceNode(s,null,w);return c}});k.prototype.createIterator=function(){return new o(this)}});
KISSY.Editor.add("selection",function(g){function o(v){this.document=this.document=v;this._={cache:{}};if(l.ie){var r=this.getNative().createRange();if(!r||r.item&&r.item(0).ownerDocument!=v||r.parentElement&&r.parentElement().ownerDocument!=v)this.isInvalid=m}}function s(v){v=new o(v);return!v||v.isInvalid?n:v}function p(v){var r=v.document,z=new f(r.body),E=new f(r.documentElement);if(l.ie){if(l.ie<8||document.documentMode==7)E.on("click",function(N){(new f(N.target))._4e_name()==="html"&&v.getSelection().getRanges()[0].select()});
var B,x,A=1;E.on("mousedown",function(){A=0});E.on("mouseup",function(){A=1});z.on("focusin",function(N){if((new f(N.target))._4e_name()=="body")if(B){try{A&&B.select()}catch(Q){}B=n}});z.on("focus",function(){x=m;F()});z.on("beforedeactivate",function(N){if(!N.relatedTarget){x=q;A=1}});e.on(b._4e_getWin(r),"blur",function(){r&&r.selection.empty()});z.on("mousedown",function(){D()});z.on("mouseup",function(){x=m;setTimeout(function(){F(m)},0)});var D=function(){x=q},F=function(N){if(x){var Q=v.document,
R=v.getSelection(),V=R&&R.getType(),T=R&&R.getNative();if(N&&T&&V==i.SELECTION_NONE)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){F(m)},50);return}var U;if(!(T&&V==i.SELECTION_TEXT&&(U=b._4e_name(T.createRange().parentElement()))&&U in{input:1,textarea:1})){B=T&&R.getRanges()[0];v._monitor()}}};z.on("keydown",D);z.on("keyup",function(){x=m;F()});e.on(r,"selectionchange",F)}else{e.on(r,"mouseup",v._monitor,v);e.on(r,"keyup",v._monitor,v)}var C={table:1,pre:1},G=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
M=g.Walker.whitespaces(m);v.on("selectionChange",function(N){var Q=N.path;N=(N=N.selection)&&N.getRanges()[0];if(!(!N||!N.collapsed||Q.block))if(Q.blockLimit._4e_name()=="body"){Q=N.fixBlock(m,"p");if(Q._4e_outerHtml().match(G)){var R=Q._4e_next(M);if(R&&R[0].nodeType==h.NODE_ELEMENT&&!C[R._4e_name()]){N.moveToElementEditablePosition(R);Q._4e_remove()}else if((R=Q._4e_previous(M))&&R[0].nodeType==h.NODE_ELEMENT&&!C[R._4e_name()]){N.moveToElementEditablePosition(R,R._4e_outerHtml().match(G)?q:m);Q._4e_remove()}}N.select();
l.ie||v.notifySelectionChange()}})}g.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var m=true,q=false,n=null,k=KISSY,l=k.UA,b=k.DOM,e=k.Event,f=k.Node,i=g.SELECTION,u=g.RANGE,h=g.NODE,c=g.Walker,d=g.Range,j={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};k.augment(o,{getNative:l.ie?function(){var v=this._.cache;return v.nativeSel||(v.nativeSel=this.document.selection)}:function(){var v=
this._.cache;return v.nativeSel||(v.nativeSel=b._4e_getWin(this.document).getSelection())},getType:l.ie?function(){var v=this._.cache;if(v.type)return v.type;var r=i.SELECTION_NONE;try{var z=this.getNative(),E=z.type;if(E=="Text")r=i.SELECTION_TEXT;if(E=="Control")r=i.SELECTION_ELEMENT;if(z.createRange().parentElement)r=i.SELECTION_TEXT}catch(B){}return v.type=r}:function(){var v=this._.cache;if(v.type)return v.type;var r=i.SELECTION_TEXT,z=this.getNative();if(z){if(z.rangeCount==1){z=z.getRangeAt(0);
var E=z.startContainer;if(E==z.endContainer&&E.nodeType==h.NODE_ELEMENT&&z.endOffset-z.startOffset===1&&j[E.childNodes[z.startOffset].nodeName.toLowerCase()])r=i.SELECTION_ELEMENT}}else r=i.SELECTION_NONE;return v.type=r},getRanges:l.ie?function(){var v=function(r,z){r=r.duplicate();r.collapse(z);for(var E=r.parentElement(),B=E.childNodes,x,A=0;A<B.length;A++){var D=B[A];if(D.nodeType==h.NODE_ELEMENT){x=r.duplicate();x.moveToElementText(D);D=x.compareEndPoints("StartToStart",r);var F=x.compareEndPoints("EndToStart",
r);x.collapse();if(D>0)break;else if(!D||F==1&&D==-1)return{container:E,offset:A};else if(!F)return{container:E,offset:A+1};x=n}}if(!x){x=r.duplicate();x.moveToElementText(E);x.collapse(q)}x.setEndPoint("StartToStart",r);x=x.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;x>0;)x-=B[--A].nodeValue.length}catch(C){x=0}return x===0?{container:E,offset:A}:{container:B[A],offset:-x}};return function(){var r=this._.cache;if(r.ranges)return r.ranges;var z=this.getNative(),E=z&&z.createRange(),B=this.getType();
if(!z)return[];if(B==i.SELECTION_TEXT){z=new d(this.document);B=v(E,m);z.setStart(new f(B.container),B.offset);B=v(E);z.setEnd(new f(B.container),B.offset);return r.ranges=[z]}else if(B==i.SELECTION_ELEMENT){r=r.ranges=[];for(B=0;B<E.length;B++){var x=E.item(B),A=x.parentNode,D=0;for(z=new d(this.document);D<A.childNodes.length&&A.childNodes[D]!=x;D++);z.setStart(new f(A),D);z.setEnd(new f(A),D+1);r.push(z)}return r}return r.ranges=[]}}():function(){var v=this._.cache;if(v.ranges)return v.ranges;
var r=[],z=this.getNative();if(!z)return[];for(var E=0;E<z.rangeCount;E++){var B=z.getRangeAt(E),x=new d(this.document);x.setStart(new f(B.startContainer),B.startOffset);x.setEnd(new f(B.endContainer),B.endOffset);r.push(x)}return v.ranges=r},getStartElement:function(){var v=this._.cache;if(v.startElement!==undefined)return v.startElement;var r,z=this.getNative();switch(this.getType()){case i.SELECTION_ELEMENT:return this.getSelectedElement();case i.SELECTION_TEXT:var E=this.getRanges()[0];if(E)if(!E.collapsed){for(E.optimize();m;){r=
E.startContainer;if(E.startOffset==(r[0].nodeType===h.NODE_ELEMENT?r[0].childNodes.length:r[0].nodeValue.length)&&!r._4e_isBlockBoundary())E.setStartAfter(r);else break}r=E.startContainer;if(r[0].nodeType!=h.NODE_ELEMENT)return r.parent();r=new f(r[0].childNodes[E.startOffset]);if(!r[0]||r[0].nodeType!=h.NODE_ELEMENT)return E.startContainer;for(E=r[0].firstChild;E&&E.nodeType==h.NODE_ELEMENT;){r=new f(E);E=E.firstChild}return r}if(l.ie){E=z.createRange();E.collapse(m);r=E.parentElement()}else if((r=
z.anchorNode)&&r.nodeType!=h.NODE_ELEMENT)r=r.parentNode}return v.startElement=r?b._4e_wrap(r):n},getSelectedElement:function(){var v=this,r,z=v._.cache;if(z.selectedElement!==undefined)return z.selectedElement;if(l.ie){r=v.getNative().createRange();r=r.item&&r.item(0)}r||(r=function(){for(var E=v.getRanges()[0],B,x,A=2;A&&!((B=E.getEnclosedNode())&&B[0].nodeType==h.NODE_ELEMENT&&j[B._4e_name()]&&(x=B));A--)E.shrink(u.SHRINK_ELEMENT);return x&&x[0]}());return z.selectedElement=b._4e_wrap(r)},reset:function(){this._.cache=
{}},selectElement:function(v){var r;if(l.ie)try{r=this.document.body.createControlRange();r.addElement(v[0]);r.select()}catch(z){r=this.document.body.createTextRange();r.moveToElementText(v[0]);r.select()}finally{}else{r=this.document.createRange();r.selectNode(v[0]);v=this.getNative();v.removeAllRanges();v.addRange(r)}this.reset()},selectRanges:function(v){if(l.ie){if(v.length>1){var r=v[v.length-1];v[0].setEnd(r.endContainer,r.endOffset);v.length=1}v[0]&&v[0].select()}else{r=this.getNative();if(!r)return;
r.removeAllRanges();for(var z=0;z<v.length;z++){var E=v[z],B=this.document.createRange(),x=E.startContainer;E.collapsed&&l.gecko&&l.gecko<1.09&&x[0].nodeType==h.NODE_ELEMENT&&!x[0].childNodes.length&&x[0].appendChild(this.document.createTextNode(""));B.setStart(x[0],E.startOffset);B.setEnd(E.endContainer[0],E.endOffset);r.addRange(B)}}this.reset()},createBookmarks2:function(v){for(var r=[],z=this.getRanges(),E=0;E<z.length;E++)r.push(z[E].createBookmark2(v));return r},createBookmarks:function(v,r){var z=
[],E=this.document,B;r=r||this.getRanges();for(var x=r.length,A=0;A<x;A++){z.push(B=r[A].createBookmark(v,m));var D=(v=B.serializable)?k.one("#"+B.startNode,E):B.startNode;B=v?k.one("#"+B.endNode,E):B.endNode;for(var F=A+1;F<x;F++){var C=r[F],G=C.startContainer,M=C.endContainer;b._4e_equals(G,D.parent())&&C.startOffset++;b._4e_equals(G,B.parent())&&C.startOffset++;b._4e_equals(M,D.parent())&&C.endOffset++;b._4e_equals(M,B.parent())&&C.endOffset++}}return z},selectBookmarks:function(v){for(var r=[],
z=0;z<v.length;z++){var E=new d(this.document);E.moveToBookmark(v[z]);r.push(E)}this.selectRanges(r);return this},getCommonAncestor:function(){var v=this.getRanges();return v[0].startContainer._4e_commonAncestor(v[v.length-1].endContainer)},scrollIntoView:function(){var v=this.getStartElement();v&&v._4e_scrollIntoView()},removeAllRanges:function(){var v=this.getNative();if(l.ie)v&&v.clear();else v&&v.removeAllRanges()}});var t={table:1,tbody:1,tr:1},y=c.whitespaces(m),w=/\ufeff|\u00a0/;d.prototype.select=
d.prototype.select=l.ie?function(v){var r=this.collapsed,z,E;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var B=this.startContainer[0].childNodes[this.startOffset];if(B.nodeType==h.NODE_ELEMENT){(new o(this.document)).selectElement(new f(B));return}}if(this.startContainer[0].nodeType==h.NODE_ELEMENT&&this.startContainer._4e_name()in t||this.endContainer[0].nodeType==h.NODE_ELEMENT&&this.endContainer._4e_name()in t)this.shrink(u.SHRINK_ELEMENT,m);var x=this.createBookmark();
B=x.startNode;var A;if(!r)A=x.endNode;x=this.document.body.createTextRange();x.moveToElementText(B[0]);x.moveStart("character",1);if(A){v=this.document.body.createTextRange();v.moveToElementText(A[0]);x.setEndPoint("EndToEnd",v);x.moveEnd("character",-1)}else{for(z=B[0].nextSibling;z&&!y(z);)z=z.nextSibling;z=!(z&&z.nodeValue&&z.nodeValue.match(w))&&(v||!B[0].previousSibling||B[0].previousSibling&&b._4e_name(B[0].previousSibling)=="br");E=this.document.createElement("span");E.innerHTML="&#65279;";
E=(new f(E)).insertBefore(B);z&&b.insertBefore(this.document.createTextNode("\ufeff"),B)}this.setStartBefore(B);B._4e_remove();if(r){if(z){x.moveStart("character",-1);x.select();this.document.selection.clear()}else x.select();if(E){this.moveToPosition(E,u.POSITION_BEFORE_START);E._4e_remove()}}else{this.setEndBefore(A);A._4e_remove();x.select()}}:function(){var v=this.startContainer;this.collapsed&&v[0].nodeType==h.NODE_ELEMENT&&!v[0].childNodes.length&&v[0].appendChild(this.document.createTextNode(""));
var r=this.document.createRange();r.setStart(v[0],this.startOffset);try{r.setEnd(this.endContainer[0],this.endOffset)}catch(z){if(z.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(m);r.setEnd(this.endContainer[0],this.endOffset)}else throw z;}v=s(this.document).getNative();v.removeAllRanges();v.addRange(r)};o.getSelection=s;g.Selection=o;g.Selection=o;c=o.prototype;g.Utils.extern(c,{getNative:c.getNative,getType:c.getType,getRanges:c.getRanges,getStartElement:c.getStartElement,getSelectedElement:c.getSelectedElement,
reset:c.reset,selectElement:c.selectElement,selectRanges:c.selectRanges,createBookmarks2:c.createBookmarks2,createBookmarks:c.createBookmarks,getCommonAncestor:c.getCommonAncestor,scrollIntoView:c.scrollIntoView,selectBookmarks:c.selectBookmarks,removeAllRanges:c.removeAllRanges});g.on("instanceCreated",function(v){p(v.editor)})});
KISSY.Editor.add("styles",function(g){function o(H,L){for(var J in H)H[J]=H[J].replace(U,function(I,K){return L[K]})}function s(H,L){if(L){H=z.clone(H);o(H.attributes,L);o(H.styles,L)}var J=this.element=this.element=(H.element||"*").toLowerCase();this.type=this.type=J=="#"||R[J]?x.STYLE_BLOCK:V[J]?x.STYLE_OBJECT:x.STYLE_INLINE;this._={definition:H}}function p(H,L){var J=L?this.removeFromRange:this.applyToRange;H.body.focus();for(var I=new D(H),K=I.getRanges(),P=0;P<K.length;P++)J.call(this,K[P]);
I.selectRanges(K)}function m(H,L){var J;J=H.element;if(J=="*")J="span";J=new M(L.createElement(J));return q(J,H)}function q(H,L){var J=L._.definition,I=J.attributes;J=s.getStyleText(J);if(I)for(var K in I)H.attr(K,I[K]);if(J)H[0].style.cssText=J;return H}function n(H){var L=H.createBookmark(w),J=H.createIterator();J.enforceRealBlocks=w;J.enlargeBr=w;for(var I,K=H.document;I=J.getNextParagraph();){var P=m(this,K);I=I;var O=P;P=O._4e_name=="pre";var S=I._4e_name=="pre",$=!P&&S;if(P&&!S){S=I;O=O;$=S.html();
$=k($,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");$=$.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");$=$.replace(/([ \t\n\r]+|&nbsp;)/g," ");$=$.replace(/<br\b[^>]*>/gi,"\n");if(N.ie){S=S[0].ownerDocument.createElement("div");S.appendChild(O[0]);O[0].outerHTML="<pre>"+$+"</pre>";O=new M(S.firstChild);O._4e_remove()}else O.html($);O=O}else if($)O=b(l(I),O);else I._4e_moveChildren(O);I[0].parentNode.replaceChild(O[0],I[0]);if(P){I=O;P=void 0;if((P=I._4e_previousSourceNode(w,F.NODE_ELEMENT))&&P._4e_name()==
"pre"){O=k(P.html(),/\n$/,"")+"\n\n"+k(I.html(),/^\n/,"");if(N.ie)I[0].outerHTML="<pre>"+O+"</pre>";else I.html(O);P._4e_remove()}}}H.moveToBookmark(L)}function k(H,L,J){var I="",K="";H=H.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(P,O,S){O&&(I=O);S&&(K=S);return""});return I+H.replace(L,J)+K}function l(H){var L=[];k(H._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(J,I,K){return I+"</pre>"+K+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(J,I){L.push(I)});return L}function b(H,L){for(var J=L[0].ownerDocument.createDocumentFragment(),I=0;I<H.length;I++){var K=H[I];K=K.replace(/(\r\n|\r)/g,"\n");K=k(K,/^[ \t]*\n/,"");K=k(K,/\n$/,"");K=k(K,/^[ \t]+|[ \t]+$/g,function(O,S){return O.length==1?"&nbsp;":S?" "+Array(O.length).join("&nbsp;"):Array(O.length).join("&nbsp;")+" "});K=K.replace(/\n/g,"<br>");K=K.replace(/[ \t]{2,}/g,function(O){return Array(O.length).join("&nbsp;")+" "});var P=L._4e_clone();P.html(K);J.appendChild(P[0])}return J}
function e(H){var L=H.document;if(H.collapsed){L=m(this,L);H.insertNode(L);H.moveToPosition(L,A.POSITION_BEFORE_END)}else{var J=this.element,I=this._.definition,K,P=g.XHTML_DTD[J]||(K=w,g.XHTML_DTD.span),O=H.createBookmark();H.enlarge(A.ENLARGE_ELEMENT);H.trim();var S=H.createBookmark(),$=S.startNode;S=S.endNode;for(var Y=$,aa;Y&&Y[0];){var X=v;if(B._4e_equals(Y,S)){Y=r;X=w}else{var Z=Y[0].nodeType,da=Z==F.NODE_ELEMENT?Y._4e_name():r;if(da&&Y.attr("_ke_bookmark")){Y=Y._4e_nextSourceNode(w);continue}if(!da||
P[da]&&(Y._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(Y))){var ea=Y.parent();if(ea&&ea[0]&&((g.XHTML_DTD[ea._4e_name()]||g.XHTML_DTD.span)[J]||K)&&(!I.parentRule||I.parentRule(ea))){if(!aa&&(!da||!g.XHTML_DTD.$removeEmpty[da]||(Y._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED)){aa=
new G(L);aa.setStartBefore(Y)}if(Z==F.NODE_TEXT||Z==F.NODE_ELEMENT&&!Y[0].childNodes.length){Z=Y;var ba;for(da=Z._4e_next(function(ga){return!ga.attr("_ke_bookmark")});!da&&(ba=Z.parent(),P[ba._4e_name()])&&(ba._4e_position($)|C.POSITION_FOLLOWING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_FOLLOWING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(ba));)Z=ba;aa.setEndAfter(Z);Z[0].nextSibling||(X=w)}}else X=w}else X=w;Y=Y._4e_nextSourceNode()}if(X&&aa&&!aa.collapsed){X=
m(this,L);for(Z=aa.getCommonAncestor();X&&Z&&X[0]&&Z[0];){if(Z._4e_name()==J){for(var ca in I.attributes)X.attr(ca)==Z.attr(ca)&&X[0].removeAttribute(ca);for(var fa in I.styles)X._4e_style(fa)==Z._4e_style(fa)&&X._4e_style(fa,"");if(!X._4e_hasAttributes()){X=r;break}}Z=Z.parent()}if(X){X[0].appendChild(aa.extractContents());j(this,X);aa.insertNode(X);X._4e_mergeSiblings();N.ie||X[0].normalize()}aa=r}}$._4e_remove();S._4e_remove();H.moveToBookmark(O);H.shrink(A.SHRINK_TEXT)}}function f(H){H.enlarge(A.ENLARGE_ELEMENT);
var L=H.createBookmark(),J=L.startNode;if(H.collapsed){for(var I=new Q(J.parent()),K,P=0,O;P<I.elements.length&&(O=I.elements[P]);P++){if(O==I.block||O==I.blockLimit)break;if(this.checkElementRemovable(O)){var S=H.checkBoundaryOfElement(O,A.END),$=!S&&H.checkBoundaryOfElement(O,A.START);if($||S){K=O;K.match=$?"start":"end"}else{O._4e_mergeSiblings();O._4e_name()==this.element?c(this,O):t(O,h(this)[O._4e_name()])}}}if(K&&K[0]){O=J;for(P=0;;P++){S=I.elements[P];if(B._4e_equals(S,K))break;else if(S.match)continue;
else S=S._4e_clone();S[0].appendChild(O[0]);O=S}B[K.match=="start"?"insertBefore":"insertAfter"](O,K)}}else{var Y=L.endNode,aa=this;I=function(){for(var X=new Q(J.parent()),Z=new Q(Y.parent()),da=r,ea=r,ba=0;ba<X.elements.length;ba++){var ca=X.elements[ba];if(ca==X.block||ca==X.blockLimit)break;if(aa.checkElementRemovable(ca))da=ca}for(ba=0;ba<Z.elements.length;ba++){ca=Z.elements[ba];if(ca==Z.block||ca==Z.blockLimit)break;if(aa.checkElementRemovable(ca))ea=ca}ea&&Y._4e_breakParent(ea);da&&J._4e_breakParent(da)};
I();for(K=new M(J[0].nextSibling);K[0]!==Y[0];){P=K._4e_nextSourceNode();if(K[0]&&K[0].nodeType==F.NODE_ELEMENT&&this.checkElementRemovable(K)){K._4e_name()==this.element?c(this,K):t(K,h(this)[K._4e_name()]);if(P[0].nodeType==F.NODE_ELEMENT&&P.contains(J)){I();P=new M(J[0].nextSibling)}}K=P}}H.moveToBookmark(L)}function i(H){var L={};H.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(J,I,K){L[I]=K});return L}function u(H,L){var J;if(L!==v){J=document.createElement("span");
J.style.cssText=H;J=J.style.cssText||""}else J=H;return J.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function h(H){if(H._.overrides)return H._.overrides;var L=H._.overrides={},J=H._.definition.overrides;if(J){z.isArray(J)||(J=[J]);for(var I=0;I<J.length;I++){var K=J[I],P,O;if(typeof K=="string")P=K.toLowerCase();else{P=K.element?K.element.toLowerCase():H.element;O=K.attributes}K=L[P]||(L[P]={});if(O){K=K.attributes=K.attributes||[];for(var S in O)K.push([S.toLowerCase(),
O[S]])}}}return L}function c(H,L){var J=H._.definition,I=E.mix(J.attributes,h(H)[L._4e_name()]);J=J.styles;var K=z.isEmptyObject(I)&&z.isEmptyObject(J),P;for(P in I)if(!((P=="class"||H._.definition.fullMatch)&&L.attr(P)!=d(P,I[P]))){K=K||!!L._4e_hasAttribute(P);L.removeAttr(P)}for(var O in J)if(!(H._.definition.fullMatch&&L._4e_style(O)!=d(O,J[O],w))){K=K||!!L._4e_style(O);L._4e_style(O,"")}y(L)}function d(H,L,J){var I=new M("<span>");I[J?"_4e_style":"attr"](H,L);return I[J?"_4e_style":"attr"](H)}
function j(H,L){for(var J=h(H),I=L.all(H.element),K=I.length;--K>=0;)c(H,new M(I[K]));for(var P in J)if(P!=H.element){I=L.all(P);for(K=I.length-1;K>=0;K--){var O=new M(I[K]);t(O,J[P])}}}function t(H,L){var J=L&&L.attributes;if(J)for(var I=0;I<J.length;I++){var K=J[I][0],P;if(P=H.attr(K)){var O=J[I][1];if(O===r||O.test&&O.test(P)||typeof O=="string"&&P==O)H[0].removeAttribute(K)}}y(H)}function y(H){if(!H._4e_hasAttributes()){var L=H[0].firstChild,J=H[0].lastChild;H._4e_remove(w);if(L){L.nodeType==
F.NODE_ELEMENT&&B._4e_mergeSiblings(L);J&&L!=J&&J.nodeType==F.NODE_ELEMENT&&B._4e_mergeSiblings(J)}}}var w=true,v=false,r=null,z=KISSY,E=g.Utils,B=z.DOM,x={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},A=g.RANGE,D=g.Selection,F=g.NODE,C=g.POSITION,G=g.Range,M=z.Node,N=z.UA,Q=g.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},V={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},T=/\s*(?:;\s*|$)/g,U=/#\((.+?)\)/g;g.STYLE=x;s.prototype={apply:function(H){p.call(this,
H,v)},remove:function(H){p.call(this,H,w)},applyToRange:function(H){return(this.applyToRange=this.type==x.STYLE_INLINE?e:this.type==x.STYLE_BLOCK?n:this.type==x.STYLE_OBJECT?r:r).call(this,H)},removeFromRange:function(H){return(this.removeFromRange=this.type==x.STYLE_INLINE?f:r).call(this,H)},applyToObject:function(H){q(H,this)},checkElementRemovable:function(H,L){if(!H)return v;var J=this._.definition;if(H._4e_name()==this.element){if(!L&&!H._4e_hasAttributes())return w;var I=J._AC;if(I)J=I;else{I=
{};var K=0,P=J.attributes;if(P)for(var O in P){K++;I[O]=P[O]}if(P=s.getStyleText(J)){I.style||K++;I.style=P}I._length=K;J=J._AC=I}if(J._length){for(var S in J)if(S!="_length"){K=H.attr(S)||"";if(S=="style")a:{I=J[S];K=u(K,v);typeof I=="string"&&(I=i(I));typeof K=="string"&&(K=i(K));P=void 0;for(P in I)if(!(P in K&&(K[P]==I[P]||I[P]=="inherit"||K[P]=="inherit"))){I=v;break a}I=w}else I=J[S]==K;if(I){if(!L)return w}else if(L)return v}if(L)return w}else return w}if(S=h(this)[H._4e_name()]){if(!(J=S.attributes))return w;
for(I=0;I<J.length;I++){S=J[I][0];if(S=H.attr(S)){K=J[I][1];if(K===r||typeof K=="string"&&S==K||K.test&&K.test(S))return w}}}return v},checkActive:function(H){switch(this.type){case x.STYLE_BLOCK:return this.checkElementRemovable(H.block||H.blockLimit,w);case x.STYLE_OBJECT:case x.STYLE_INLINE:for(var L=H.elements,J=0,I;J<L.length;J++){I=L[J];if(!(this.type==x.STYLE_INLINE&&(B._4e_equals(I,H.block)||B._4e_equals(I,H.blockLimit))))if(!(this.type==x.STYLE_OBJECT&&!(I._4e_name()in V)))if(this.checkElementRemovable(I,
w))return w}}return v}};s.getStyleText=function(H){var L=H._ST;if(L)return L;L=H.styles;var J=H.attributes&&H.attributes.style||"",I="";if(J.length)J=J.replace(T,";");for(var K in L){var P=L[K],O=(K+":"+P).replace(T,";");if(P=="inherit")I+=O;else J+=O}if(J.length)J=u(J);J+=I;return H._ST=J};g.Style=s;g.Style=s;var W=s.prototype;g.Utils.extern(W,{apply:W.apply,remove:W.remove,applyToRange:W.applyToRange,removeFromRange:W.removeFromRange,applyToObject:W.applyToObject,checkElementRemovable:W.checkElementRemovable,
checkActive:W.checkActive})});
KISSY.Editor.add("htmlparser",function(){function g(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var o=KISSY,s=function(){},p=o.Editor,m=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,q={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},n=p.XHTML_DTD;o.augment(g,{onTagOpen:s,onTagClose:s,
onText:s,onCDATA:s,onComment:s,parse:function(k){for(var l,b,e=0,f;l=this._.htmlPartsRegex.exec(k);){b=l.index;if(b>e){e=k.substring(e,b);f?f.push(e):this.onText(e)}e=this._.htmlPartsRegex.lastIndex;if(b=l[1]){b=b.toLowerCase();if(f&&n.$cdata[b]){this.onCDATA(f.join(""));f=null}if(!f){this.onTagClose(b);continue}}if(f)f.push(l[0]);else if(b=l[3]){b=b.toLowerCase();if(!/="/.test(b)){var i={},u;l=l[4];var h=!!(l&&l.charAt(l.length-1)=="/");if(l)for(;u=m.exec(l);){var c=u[1].toLowerCase();u=u[2]||u[3]||
u[4]||"";i[c]=!u&&q[c]?c:u}this.onTagOpen(b,i,h);if(!f&&n.$cdata[b])f=[]}}else if(b=l[2])this.onComment(b)}k.length>e&&this.onText(k.substring(e,k.length))}});p.HtmlParser=g;p.HtmlParser=g});
KISSY.Editor.add("htmlparser-basicwriter",function(){function g(){this._={output:[]}}var o=KISSY,s=o.Editor,p=s.Utils;o.augment(g,{openTag:function(m){this._.output.push("<",m)},openTagClose:function(m,q){q?this._.output.push(" />"):this._.output.push(">")},attribute:function(m,q){if(typeof q=="string")q=p.htmlEncodeAttr(q);this._.output.push(" ",m,'="',q,'"')},closeTag:function(m){this._.output.push("</",m,">")},text:function(m){this._.output.push(m)},comment:function(m){this._.output.push("<!--",
m,"--\>")},write:function(m){this._.output.push(m)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(m){var q=this._.output.join("");m&&this.reset();return q}});s.HtmlParser.BasicWriter=g;s.HtmlParser.BasicWriter=g;o=g.prototype;s.Utils.extern(o,{openTag:o.openTag,openTagClose:o.openTagClose,attribute:o.attribute,closeTag:o.closeTag,text:o.text,comment:o.comment,write:o.write,reset:o.reset,getHtml:o.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function g(){g.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=q;this.sortAttributes=m;this._.indent=q;this._.indentation="";this._.rules={};var n=s.XHTML_DTD,k;for(k in p.mix({},n.$nonBodyContent,n.$block,n.$listItem,n.$tableContent))this.setRules(k,{indent:m,breakBeforeOpen:m,breakAfterOpen:m,breakBeforeClose:!n[k]["#"],breakAfterClose:m});this.setRules("br",
{breakAfterOpen:m});this.setRules("title",{indent:q,breakAfterOpen:q});this.setRules("style",{indent:q,breakBeforeClose:m});this.setRules("pre",{indent:q})}var o=KISSY,s=o.Editor,p=s.Utils,m=true,q=false;o.extend(g,s.HtmlParser.BasicWriter,{openTag:function(n){var k=this._.rules[n];if(this._.indent)this.indentation();else if(k&&k.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",n)},openTagClose:function(n,k){var l=this._.rules[n];if(k)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(l&&l.indent)this._.indentation+=this.indentationChars}l&&l.breakAfterOpen&&this.lineBreak()},attribute:function(n,k){if(typeof k=="string"){this.forceSimpleAmpersand&&(k=k.replace(/&amp;/g,"&"));k=p.htmlEncodeAttr(k)}this._.output.push(" ",n,'="',k,'"')},closeTag:function(n){var k=this._.rules[n];if(k&&k.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(k&&k.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",n,">");k&&k.breakAfterClose&&this.lineBreak()},text:function(n){if(this._.indent){this.indentation();n=p.ltrim(n)}this._.output.push(n)},comment:function(n){this._.indent&&this.indentation();this._.output.push("<!--",n,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=m},indentation:function(){this._.output.push(this._.indentation);this._.indent=q},setRules:function(n,k){var l=this._.rules[n];if(l)p.mix(l,
k);else this._.rules[n]=k}});s.HtmlParser.HtmlWriter=g;s.HtmlParser.HtmlWriter=g;o=g.prototype;s.Utils.extern(o,{openTag:o.openTag,openTagClose:o.openTagClose,attribute:o.attribute,closeTag:o.closeTag,text:o.text,comment:o.comment,lineBreak:o.lineBreak,indentation:o.indentation,setRules:o.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function g(){this.children=[];this.parent=p;this._={isBlockLike:o,hasInlineStarted:s}}var o=true,s=false,p=null,m=KISSY.Editor,q={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},n=KISSY,k=m.Utils,l=m.NODE,b=m.XHTML_DTD,e=k.mix({table:1,ul:1,ol:1,dl:1},b.table,b.ul,b.ol,b.dl),f=b.$list,i=b.$listItem;g.FromHtml=function(u,h){function c(A){var D;if(w.length>0)for(var F=0;F<w.length;F++){var C=w[F],G=C.name,M=b[G],N=r.name&&b[r.name];
if((!N||N[G])&&(!A||!M||M[A]||!b[A])){if(!D){d();D=1}C=C.clone();C.parent=r;r=C;w.splice(F,1);F--}}}function d(){for(;v.length;)r.add(v.shift())}function j(A,D,F){D=D||r||y;if(h&&!D.type){var C,G;if((C=A.attributes&&(G=A.attributes._ke_real_element_type)?G:A.name)&&!(C in b.$body)&&!(C in b.$nonBodyContent)){C=r;r=D;t.onTagOpen(h,{});D=r;if(F)r=C}}if(A._.isBlockLike&&A.name!="pre"){F=A.children.length;if((C=A.children[F-1])&&C.type==l.NODE_TEXT)if(G=k.rtrim(C.value))C.value=G;else A.children.length=
F-1}D.add(A);if(A.returnPoint){r=A.returnPoint;delete A.returnPoint}}var t=new m.HtmlParser,y=new g,w=[],v=[],r=y,z=s,E;t.onTagOpen=function(A,D,F){var C=new m.HtmlParser.Element(A,D);if(C.isUnknown&&F)C.isEmpty=o;if(b.$removeEmpty[A])w.push(C);else{if(A=="pre")z=o;else if(A=="br"&&z){r.add(new m.HtmlParser.Text("\n"));return}if(A=="br")v.push(C);else{var G=r.name,M=G&&(b[G]||(r._.isBlockLike?b.div:b.span));if(M&&!C.isUnknown&&!r.isUnknown&&!M[A]){M=s;var N;if(A in f&&G in f){G=r.children;(G=G[G.length-
1])&&G.name in i||j(G=new m.HtmlParser.Element("li"),r);E=r;N=G}else if(A==G)j(r,r.parent);else{if(e[G])E||(E=r);else{j(r,r.parent,o);q[G]||w.unshift(r)}M=o}r=N?N:r.returnPoint||r.parent;if(M){t.onTagOpen.apply(this,arguments);return}}c(A);d();C.parent=r;C.returnPoint=E;E=0;if(C.isEmpty)j(C);else r=C}}};t.onTagClose=function(A){for(var D=w.length-1;D>=0;D--)if(A==w[D].name){w.splice(D,1);return}for(var F=[],C=[],G=r;G.type&&G.name!=A;){G._.isBlockLike||C.unshift(G);F.push(G);G=G.parent}if(G.type){for(D=
0;D<F.length;D++){var M=F[D];j(M,M.parent)}r=G;if(r.name=="pre")z=s;G._.isBlockLike&&d();j(G,G.parent);if(G==r)r=r.parent;w=w.concat(C)}if(A=="body")h=s};t.onText=function(A){if(!r._.hasInlineStarted&&!z){A=k.ltrim(A);if(A.length===0)return}d();c();if(h&&(!r.type||r.name=="body")&&k.trim(A))this.onTagOpen(h,{});z||(A=A.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));r.add(new m.HtmlParser.Text(A))};t.onCDATA=function(){};t.onComment=function(A){r.add(new m.HtmlParser.Comment(A))};t.parse(u);for(d();r.type;){var B=
r.parent,x=r;if(h&&(!B.type||B.name=="body")&&!b.$body[x.name]){r=B;t.onTagOpen(h,{});B=r}B.add(x);r=B}return y};n.augment(g,{add:function(u){var h=this.children.length;if(h=h>0&&this.children[h-1]||p){if(u._.isBlockLike&&h.type==l.NODE_TEXT){h.value=k.rtrim(h.value);if(h.value.length===0){this.children.pop();this.add(u);return}}h.next=u}u.previous=h;u.parent=this;this.children.push(u);this._.hasInlineStarted=u.type==l.NODE_TEXT||u.type==l.NODE_ELEMENT&&!u._.isBlockLike},writeHtml:function(u,h){var c;
this.filterChildren=this.filterChildren=function(){var d=new m.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,d,h,o);d=d.getHtml();this.children=(new g.FromHtml(d)).children;c=1};!this.name&&h&&h.onFragment(this);this.writeChildrenHtml(u,c?p:h)},writeChildrenHtml:function(u,h){for(var c=0;c<this.children.length;c++)this.children[c].writeHtml(u,h)}});m.HtmlParser.Fragment=g;m.HtmlParser.Fragment=g;g.FromHtml=g.FromHtml;n=g.prototype;m.Utils.extern(n,{add:n.add,writeHtml:n.writeHtml,writeChildrenHtml:n.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function g(q,n){this.name=q;this.attributes=n||(n={});this.children=[];var k=n._ke_real_element_type||q,l=o.XHTML_DTD;k=!!(l.$nonBodyContent[k]||l.$block[k]||l.$listItem[k]||l.$tableContent[k]||l.$nonEditable[k]||k=="br");var b=!!l.$empty[q];this.isEmpty=b;this.isUnknown=!l[q];this._={isBlockLike:k,hasInlineStarted:b||!k}}var o=KISSY.Editor,s=o.NODE,p=function(q,n){q=q[0];n=n[0];return q<n?-1:q>n?1:0};KISSY.augment(g,{type:s.NODE_ELEMENT,add:o.HtmlParser.Fragment.prototype.add,
clone:function(){return new g(this.name,this.attributes)},writeHtml:function(q,n){var k=this.attributes,l=this,b=l.name,e,f,i,u;l.filterChildren=function(){if(!u){var d=new o.HtmlParser.BasicWriter;o.HtmlParser.Fragment.prototype.writeChildrenHtml.call(l,d,n);l.children=(new o.HtmlParser.Fragment.FromHtml(d.getHtml())).children;u=1}};l.filterChildren=l.filterChildren;if(n){for(;;){if(!(b=n.onElementName(b)))return;l.name=b;if(!(l=n.onElement(l)))return;l.parent=this.parent;if(l.name==b)break;if(l.type!=
s.NODE_ELEMENT){l.writeHtml(q,n);return}b=l.name;if(!b){this.writeChildrenHtml.call(l,q,u?null:n);return}}k=l.attributes}q.openTag(b,k);for(var h=[],c=0;c<2;c++)for(e in k){f=e;i=k[e];if(c==1)h.push([e,i]);else if(n){for(;;)if(f=n.onAttributeName(e))if(f!=e){delete k[e];e=f}else break;else{delete k[e];break}if(f)if((i=n.onAttribute(l,f,i))===false)delete k[f];else k[f]=i}}q.sortAttributes&&h.sort(p);k=h.length;for(c=0;c<k;c++){e=h[c];q.attribute(e[0],e[1])}q.openTagClose(b,l.isEmpty);if(!l.isEmpty){this.writeChildrenHtml.call(l,
q,u?null:n);q.closeTag(b)}},writeChildrenHtml:function(){o.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});o.HtmlParser.Element=g;o.HtmlParser.Element=g;var m=g.prototype;o.Utils.extern(m,{type:m.type,add:m.add,clone:m.clone,writeHtml:m.writeHtml,writeChildrenHtml:m.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function g(e){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};e&&this.addRules(e,10)}function o(e,f){for(var i=0;e&&i<f.length;i++){var u=f[i];e=e.replace(u[0],u[1])}return e}function s(e,f,i){if(typeof f=="function")f=[f];var u,h;h=e.length;var c=f&&f.length;if(c){for(u=0;u<h&&e[u].pri<i;u++);for(h=c-1;h>=0;h--)if(c=f[h]){c.pri=i;e.splice(u,0,c)}}}function p(e,f,i){if(f)for(var u in f){var h=e[u];e[u]=m(h,f[u],
i);h||e.$length++}}function m(e,f,i){if(f){f.pri=i;if(e){if(e.splice)s(e,f,i);else{e=e.pri>i?[f,e]:[e,f];e.filter=q}return e}else return f.filter=f}}function q(e){for(var f=e.type||e instanceof k.HtmlParser.Fragment,i=0;i<this.length;i++){if(f)var u=e.type,h=e.name;var c=this[i].apply(window,arguments);if(c===b)return c;if(f){if(c&&(c.name!=h||c.type!=u))return c}else if(typeof c!="string")return c;c!=undefined&&(e=c)}return e}var n=KISSY,k=n.Editor,l=k.NODE,b=false;n.augment(g,{addRules:function(e,
f){if(typeof f!="number")f=10;s(this._.elementNames,e.elementNames,f);s(this._.attributeNames,e.attributeNames,f);p(this._.elements,e.elements,f);p(this._.attributes,e.attributes,f);this._.text=m(this._.text,e.text,f)||this._.text;this._.comment=m(this._.comment,e.comment,f)||this._.comment;this._.root=m(this._.root,e.root,f)||this._.root},onElementName:function(e){return o(e,this._.elementNames)},onAttributeName:function(e){return o(e,this._.attributeNames)},onText:function(e){var f=this._.text;
return f?f.filter(e):e},onComment:function(e,f){var i=this._.comment;return i?i.filter(e,f):e},onFragment:function(e){var f=this._.root;return f?f.filter(e):e},onElement:function(e){for(var f=[this._.elements["^"],this._.elements[e.name],this._.elements.$],i,u=0;u<3;u++)if(i=f[u]){i=i.filter(e,this);if(i===b)return null;if(i&&i!=e)return this.onNode(i);if(e.parent&&!e.name)break}return e},onNode:function(e){var f=e.type;return f==l.NODE_ELEMENT?this.onElement(e):f==l.NODE_TEXT?new k.HtmlParser.Text(this.onText(e.value)):
null},onAttribute:function(e,f,i){if(f=this._.attributes[f]){e=f.filter(i,e,this);if(e===b)return b;if(typeof e!="undefined")return e}return i}});k.HtmlParser.Filter=g;n=g.prototype;k.Utils.extern(n,{addRules:n.addRules,onElementName:n.onElementName,onAttributeName:n.onAttributeName,onText:n.onText,onComment:n.onComment,onFragment:n.onFragment,onElement:n.onElement,onNode:n.onNode,onAttribute:n.onAttribute});k.HtmlParser.Filter=g});
KISSY.Editor.add("htmlparser-text",function(){function g(m){this.value=m;this._={isBlockLike:p}}var o=KISSY,s=o.Editor,p=false;o.augment(g,{type:s.NODE.NODE_TEXT,writeHtml:function(m,q){var n=this.value;q&&!(n=q.onText(n,this))||m.text(n)}});s.HtmlParser.Text=g;s.HtmlParser.Text=g});
KISSY.Editor.add("htmlparser-comment",function(){function g(p){this.value=p;this._={isBlockLike:false}}var o=KISSY.Editor,s=o.NODE;o.HtmlParser.Comment=g;o.HtmlParser.Comment=g;g.prototype={constructor:g,type:s.NODE_COMMENT,writeHtml:function(p,m){var q=this.value;if(m){if(!(q=m.onComment(q,this)))return;if(typeof q!="string"){q.parent=this.parent;q.writeHtml(p,m);return}}p.comment(q)}}});
KISSY.Editor.add("bubbleview",function(){var g=KISSY.Editor,o=KISSY,s=o.Event,p=o.DOM;if(!g.BubbleView){var m=o.UIBase.create(g.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var n=this._selectedEl,k=n._4e_getOffset(document);k.top+=n.height()+5;m.superclass.show.call(this);this.set("xy",[k.left,k.top])}},{ATTRS:{focus4e:false,zIndex:{value:g.baseZIndex(g.zIndexManager.BUBBLE_VIEW)}}}),q={};m.attach=function(n){var k=n.pluginName;o.mix(n,q[k].cfg,
false);var l=n.pluginContext,b=n.func,e=n.editor,f=n.bubble;e.on("selectionChange",function(i){i=i.path;var u=i.elements;if(i&&u)if(i=i.lastElement)if(i=b(i)){u=q[k];if(!u.bubble){u.bubble=new m({autoRender:true});u.cfg.init&&u.cfg.init.call(u.bubble)}f=u.bubble;f._selectedEl=i;f._plugin=l;f.hide();f.show()}else if(f){f._selectedEl=f._plugin=null;f.hide()}});s.on(p._4e_getWin(e.document),"scroll blur",function(){f&&f.hide()})};m.register=function(n){var k=n.pluginName;q[k]=q[k]||{cfg:n};s.on(document,
"click",function(){n.bubble&&n.bubble.hide()});n.editor&&m.attach(n)};g.BubbleView=m}});
KISSY.Editor.add("button",function(){var g=KISSY,o=g.Editor;if(!o.TripleButton){var s=g.UIBase.create([g.UIBase.Box],{bindUI:function(){var p=this,m=p.get("el");m.on("click",p._action,p);m.on("mousedown",function(){p.get("state")=="off"&&m.addClass("ke-triplebutton-active")});m.on("mouseup mouseleave",function(){p.get("state")=="off"&&m.hasClass("ke-triplebutton-active")&&setTimeout(function(){m.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"))},
_uiSetContentCls:function(p){var m=this.get("el");if(p!==undefined){m.html("<span class='ke-toolbar-item "+p+"'>");m._4e_unselectable()}},_uiSetText:function(p){var m=this.get("el");p!==undefined&&m.html(p)},_uiSetState:function(p){this["_"+p]()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(p){this.fire(this.get("state")+"Click",p);p.type=this.get("state")+"Click";
this.fire("click",p);p.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){var p=this.get("el");p.removeClass("ke-triplebutton-off ke-triplebutton-disabled");p.addClass("ke-triplebutton-on")},_off:function(){var p=this.get("el");p.removeClass("ke-triplebutton-on ke-triplebutton-disabled");p.addClass("ke-triplebutton-off")},_disabled:function(){var p=this.get("el");p.removeClass("ke-triplebutton-off ke-triplebutton-on");p.addClass("ke-triplebutton-disabled")}},
{ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elAttrs:{href:{value:"#"}},elTagName:{value:"a"},title:{},contentCls:{},text:{}}});s.ON="on";s.OFF="off";s.DISABLED="disabled";s.ON_CLASS="ke-triplebutton-on";s.OFF_CLASS="ke-triplebutton-off";s.DISABLED_CLASS="ke-triplebutton-disabled";o.TripleButton=s;o.prototype.addButton=function(p,m){var q=this,n=new s({render:q.toolBarDiv,autoRender:true,title:m.title,text:m.text,contentCls:m.contentCls}),k={btn:n,editor:q,cfg:m,
call:function(){var l=g.makeArray(arguments),b=l.shift();return m[b].apply(k,l)},reload:function(l){g.mix(m,l);n.enable();q.on("selectionChange",function(){q.getMode()!=o.SOURCE_MODE&&m.selectionChange&&m.selectionChange.apply(k,arguments)});n.on("click",function(b){var e=b.type;m[e]&&m[e].apply(k,arguments)});if(m.mode==o.WYSIWYG_MODE){q.on("wysiwygmode",n.enable,n);q.on("sourcemode",n.disable,n)}m.init&&m.init.call(k)}};m.loading?n.disable():k.reload();return k}}});
KISSY.Editor.add("clipboard",function(g){var o=KISSY,s=o.Editor,p=o.Node,m=o.UA,q=s.Range,n=s.RANGE,k=o.Event;s.Paste||function(){function l(d){this.editor=d;this._init()}function b(d){if(!(!m.ie||d.document.compatMode=="BackCompat")){var j=d.getSelection(),t;if(j.getType()==h.SELECTION_ELEMENT&&(t=j.getSelectedElement())){var y=j.getRanges()[0],w=new p(d.document.createTextNode(""));w.insertBefore(t);y.setStartBefore(w);y.setEndAfter(t);j.selectRanges([y]);setTimeout(function(){if(t.parent()){w.remove();
j.selectElement(t)}},0)}}}o.augment(l,{_init:function(){var d=this.editor;m.ie?k.on(d.document,"keydown",this._paste,this):k.on(d.document,"paste",this._paste,this);d.addCommand("copy",new u("copy"));d.addCommand("cut",new u("cut"));d.addCommand("paste",new u("paste"))},_paste:function(d){if(!(d.type==="keydown"&&!(d.keyCode===86&&(d.ctrlKey||d.metaKey)))){var j=this,t=j.editor,y=t.document;if(j._running)d.halt();else{var w=t.getSelection();d=new q(y);var v=new p(m.webkit?"<body></body>":"<div></div>",
null,y);m.webkit&&v[0].appendChild(y.createTextNode("\u00a0"));y.body.appendChild(v[0]);v.css({position:"absolute",top:w.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});v.css("left","-1000px");var r=w.createBookmarks();d.setStartAt(v,n.POSITION_AFTER_START);d.setEndAt(v,n.POSITION_BEFORE_END);d.select(true);j._running=true;setTimeout(function(){v._4e_remove();var z;v=m.webkit&&(z=v._4e_first())&&z.hasClass("Apple-style-span")?z:v;w.selectBookmarks(r);t.insertHtml(v.html());
j._running=false},0)}}}});s.Paste=l;var e=function(d,j){var t=d.document,y=new p(t.body),w=false,v=function(){w=true};y.on(j,v);(m.ie>7?t:t.selection.createRange()).execCommand(j);y.detach(j,v);return w},f=m.ie?function(d,j){return e(d,j)}:function(d,j){try{return d.document.execCommand(j)}catch(t){return false}},i={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},u=function(d){this.type=
d;this.canUndo=this.type=="cut"};u.prototype={exec:function(d){this.type=="cut"&&b(d);(d=f(d,this.type))||alert(i[this.type]);return d}};var h=s.Selection,c={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};s.on("contextmenu",function(d){var j=d.contextmenu,t=j.cfg.editor,y=j.elDom,w={copy:0,cut:0,paste:0},v;for(v in w){if(!w.hasOwnProperty(v))break;w[v]=y.one(".ke-paste-"+v);(function(r){var z=w[r];if(!z){z=(new p("<a href='#'class='ke-paste-"+r+"'>"+c[r]+"</a>")).appendTo(y);z.on("click",function(E){E.halt();if(!z.hasClass("ke-menuitem-disable")){j.hide();
setTimeout(function(){t.execCommand(r)},30)}})}w[r]=z})(v);d=w[v];(t.document.queryCommandEnabled(v)?true:false)?d.removeClass("ke-menuitem-disable"):d.addClass("ke-menuitem-disable")}})}();g.ready(function(){new s.Paste(g)})});
KISSY.Editor.add("color",function(g){var o=KISSY.Editor;g.ready(function(){var s=g.cfg.pluginConfig;false!==s.forecolor&&function(){var p=g.addButton("color",{styles:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},mode:o.WYSIWYG_MODE,title:"\u6587\u672c\u989c\u8272",loading:true,contentCls:"ke-toolbar-color"});o.use("colorsupport",function(){p.reload(o.ColorSupport)})}();false!==s.bgcolor&&function(){var p=g.addButton("color",{styles:{element:"span",styles:{"background-color":"#(color)"}},
title:"\u80cc\u666f\u989c\u8272",mode:o.WYSIWYG_MODE,loading:true,contentCls:"ke-toolbar-bgcolor"});o.use("colorsupport",function(){p.reload(o.ColorSupport)})}()})});
KISSY.Editor.add("colorsupport",function(){function g(){if(!l){l="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var b=0;b<3;b++){l+="<div class='ke-color-palette'><table>";for(var e=k[b],f=e.length/8,i=0;i<f;i++){l+="<tr>";for(var u=0;u<8;u++){var h="#"+e[8*i+u];l+="<td>";l+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+h+"'></a>";l+="</td>"}l+="</tr>"}l+="</table></div>"}l+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
var o=KISSY,s=o.Editor,p=o.Node,m=o.Event,q=s.Overlay,n=o.DOM;n.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var k=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],l;s.ColorSupport={offClick:function(b){var e=this.cfg,f=this.colorWin;f&&f.get("visible")?f.hide():e._prepare.call(this,b)},_prepare:function(){var b=this,e=b.cfg,f=document,i=b.btn,u=b.editor,h;g();b.colorWin=new q({elCls:"ks-popup",content:l,focus4e:false,autoRender:true,width:"170px",zIndex:u.baseZIndex(s.zIndexManager.POPUP_MENU)});var c=b.colorWin;h=c.get("contentEl");h.on("click",e._selectColor,b);m.on(f,"click",e._hidePanel,b);m.on(u.document,
"click",e._hidePanel,b);c.on("show",i.bon,i);c.on("hide",i.boff,i);h.one(".ke-color-others").on("click",function(d){d.halt();c.hide();u.useDialog("color/dialog",function(j){j.show(b)})});e._prepare=e._show;e._show.call(b)},_show:function(){var b=this.btn.get("el"),e=this.colorWin,f=parseInt(e.get("width")),i=n.viewportWidth();e.align(b,["bl","tl"],[0,2]);e.get("x")+f>i-30&&e.set("x",i-30-f);e.show()},_hidePanel:function(b){var e=this.btn.get("el");b=new p(b.target);var f=this.colorWin;e._4e_equals(b)||
e.contains(b)||f.hide()},_selectColor:function(b){b.halt();var e=this.cfg;b=new p(b.target);if(b._4e_name()=="a"&&!b.hasClass("ke-button")){e._applyColor.call(this,b._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(b){var e=this.editor,f=e.document,i=this.cfg.styles;e.fire("save");b?(new s.Style(i,{color:b})).apply(f):(new s.Style(i,{color:"inherit"})).remove(f);e.fire("save")}}});
KISSY.Editor.add("contextmenu",function(){function g(b){this.cfg=b;s.Utils.lazyRun(this,"_prepareShow","_realShow")}function o(b,e){for(var f=0;f<e.length;f++){var i=e[f];if(p.isFunction(i)){if(i(new m(b)))return true}else if(q.test(b,i))return true}return false}var s=KISSY.Editor,p=KISSY,m=p.Node,q=p.DOM,n=p.Event;if(!s.ContextMenu){g.ATTRS={editor:{}};var k=[];g.register=function(b){var e=new g(b),f=b.editor.document;k.push({doc:f,rules:b.rules||[],instance:e});if(!f.ke_contextmenu){f.ke_contextmenu=
1;n.on(f,"mousedown",g.hide);n.on(f,"contextmenu",function(i){g.hide.call(this);for(var u=new m(i.target);u;){var h=false;if(u._4e_name()=="body")break;for(var c=0;c<k.length;c++){var d=k[c].instance,j=k[c].rules;if(f===k[c].doc&&o(u[0],j)){i.preventDefault();h=true;setTimeout(function(){d.show(s.Utils.getXY(i.pageX,i.pageY,f,document))},30);break}}if(h)break;u=u.parent()}})}return e};g.hide=function(){for(var b=0;b<k.length;b++){var e=k[b].instance;this===k[b].doc&&e.hide()}};var l=s.Overlay;p.augment(g,
{_init:function(){var b=this,e=b.cfg,f=e.funcs;b.el=new l({content:"<div>",autoRender:true,width:e.width,elCls:"ke-menu"});b.elDom=b.el.get("contentEl").one("div");e=b.elDom;for(var i in f){var u=new m("<a href='#'>"+i+"</a>");e[0].appendChild(u[0]);(function(h,c){h._4e_unselectable();h.on("click",function(d){b.hide();d.halt();setTimeout(c,30)})})(u,f[i])}},hide:function(){this.el&&this.el.hide()},_realShow:function(b){s.fire("contextmenu",{contextmenu:this});this.el.set("xy",[b.left,b.top]);this.el.show()},
_prepareShow:function(){this._init()},show:function(b){this._prepareShow(b)}});s.ContextMenu=g}});
KISSY.add("dd",function(g){function o(){o.superclass.constructor.apply(this,arguments);this._init()}function s(n,k,l){l=l||150;if(l===-1)return function(){n.apply(k,arguments)};var b=g.now();return function(){var e=g.now();if(e-b>l){b=e;n.apply(k,arguments)}}}var p=g.Event,m=g.DOM,q=g.Node;g.DD={};o.ATTRS={bufferTime:{value:200},activeDrag:{}};g.extend(o,g.Base,{_init:function(){this._showShimMove=s(this._move,this,30)},_move:function(n){var k=this.get("activeDrag");g.log("move");if(k){n.preventDefault();
this._clearSelection();k._move(n)}},_start:function(n){var k=this,l=k.get("bufferTime")||0;k._registerEvent();if(l)k._bufferTimer=setTimeout(function(){k._bufferStart(n)},l);else k._bufferStart(n)},_bufferStart:function(n){this.set("activeDrag",n);this._activeShim();n._start()},_end:function(n){var k=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(k){k._end(n);this.set("activeDrag",
null)}},_activeShim:function(){var n=document;this._shim=(new q("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:999999;'></div>")).appendTo(n.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:m.docHeight()});this._clearSelection()},_clearSelection:function(){g.log("_clearSelection");if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection)try{document.selection.empty()}catch(n){}},
_registerEvent:function(){var n=document;g.log("_registerEvent");p.on(n,"mouseup",this._end,this);p.on(n,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var n=document;g.log("_unregisterEvent");p.remove(n,"mousemove",this._showShimMove,this);p.remove(n,"mouseup",this._end,this)}});g.DD.DDM=new o});
KISSY.add("dd-draggable",function(g){function o(){o.superclass.constructor.apply(this,arguments);this._init()}var s=g.UA;o.ATTRS={node:{setter:function(p){return g.one(p)}},handlers:{value:[],setter:function(p){if(p)for(var m=0;m<p.length;m++)p[m]=g.one(p[m])}}};g.extend(o,g.Base,{_init:function(){var p=this.get("node"),m=this.get("handlers");if(m.length==0)m[0]=p;for(var q=0;q<m.length;q++){var n=m[q],k=n.css("cursor");if(n[0]!=p[0])if(!k||k==="auto")n.css("cursor","move")}p.on("mousedown",this._handleMouseDown,
this)},destroy:function(){for(var p=this.get("node"),m=this.get("handlers"),q=0;q<m.length;q++){var n=m[q];n.css("cursor")=="move"&&n.css("cursor","auto")}p.detach("mousedown",this._handleMouseDown,this)},_check:function(p){for(var m=this.get("handlers"),q=0;q<m.length;q++){var n=m[q];if(n.contains(p)||n[0]==p[0])return true}return false},_handleMouseDown:function(p){if(this._check(new g.Node(p.target))){s.webkit||p.preventDefault();g.DD.DDM._start(this);var m=this.get("node"),q=p.pageX;p=p.pageY;
m=m.offset();this.startMousePos={left:q,top:p};this.startNodePos=m;this._diff={left:q-m.left,top:p-m.top};this.set("diff",this._diff)}},_move:function(p){var m=this.get("diff");g.mix(p,{left:p.pageX-m.left,top:p.pageY-m.top});this.fire("drag",p)},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});g.Draggable=o},{host:"dd"});KISSY.Editor.add("dd",function(){});KISSY.Editor.add("draft",function(g){var o=KISSY.Editor;g.ready(function(){o.use("draft/support",function(){o.storeReady(function(){new o.Draft(g)})})})});
KISSY.Editor.add("draft/support",function(){function g(b,e,f){for(b+="";b.length<e;)b=f+b;return b}function o(b){if(p.isNumber(b))b=new Date(b);return b instanceof Date?[b.getFullYear(),"-",g(b.getMonth()+1,2,"0"),"-",g(b.getDate(),2,"0")," ",g(b.getHours(),2,"0"),":",g(b.getMinutes(),2,"0"),":",g(b.getSeconds(),2,"0")].join(""):b}function s(b){this.editor=b;this._init()}var p=KISSY,m=p.Editor,q=p.Node,n=p.Event,k=p.JSON,l=window[m.STORE];p.augment(s,{_init:function(){var b=this,e=b.editor,f=e.statusDiv,
i=e.cfg.pluginConfig;i.draft=i.draft||{};b.draftInterval=i.draft.interval=i.draft.interval||5;b.draftLimit=i.draft.limit=i.draft.limit||5;f=(new q("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+i.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(f);b.timeTip=(new q("<span class='ke-draft-time'>")).appendTo(f);var u=(new q("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(f),h=new m.Select({container:f,
menuContainer:document.body,doc:e.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),c=l.getItem("ke-draft-save"),d=[];b.versions=h;if(c)d=p.isString(c)?k.parse(decodeURIComponent(c)):c;b.drafts=d;b.sync();u.on("click",function(){b.save(false)});(function(){var j=e.textarea[0].form;j&&n.on(j,"submit",function(){b.save(false)})})();setInterval(function(){b.save(true)},b.draftInterval*60*1E3);h.on("click",b.recover,b);b.holder=f;if(i.draft.helpHtml){i=new m.TripleButton({cls:"ke-draft-help",
title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:f});i.on("click",function(){b._prepareHelp()});m.Utils.lazyRun(b,"_prepareHelp","_realHelp");b.helpBtn=i.el}b._holder=f},_prepareHelp:function(){var b=this,e=b.editor,f=b.helpBtn,i=new q(e.cfg.pluginConfig.draft.helpHtml||""),u=new q("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
i.append(u);i.css({border:"1px solid #ACB4BE","text-align":"left"});b._help=new p.Overlay({content:i,autoRender:true,width:i.width()+"px",mask:false});b._help.el.css("border","none");b._help.arrow=u;n.on([document,e.document],"click",function(h){h=new q(h.target);h[0]==f[0]||f.contains(h)||b._help.hide()})},_realHelp:function(){var b=this._help,e=this.helpBtn,f=b.arrow;b.show();e=e.offset();b.el.offset({left:e.left-b.el.width()+17,top:e.top-b.el.height()-7});f.offset({left:e.left-2,top:e.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var b=this.draftLimit,e=this.timeTip,f=this.versions,i=this.drafts;i.length>b&&i.splice(0,i.length-b);b=[];for(var u,h=0;h<i.length;h++){u=i[h];u=(u.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+o(u.date);b.push({name:u,value:h})}f.set("items",b.reverse());e.html(u);l.setItem("ke-draft-save",encodeURIComponent(k.stringify(i)))},save:function(b){var e=this.drafts,f=this.editor.getData(true);if(f){if(e[e.length-
1]&&f==e[e.length-1].content)e.length-=1;this.drafts=e.concat({content:f,date:(new Date).getTime(),auto:b});this.sync()}},recover:function(b){var e=this.editor,f=this.drafts;b=b.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+o(f[b].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){e.fire("save");e.setData(f[b].content);e.fire("save")}}});m.Draft=s});
KISSY.Editor.add("elementpaths",function(g){var o=KISSY.Editor,s=KISSY,p=s.Node,m=s.DOM;o.ElementPaths||function(){function q(n){this.cfg=n;this._cache=[];this._init()}m.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");s.augment(q,{_init:function(){var n=this.cfg.editor;this.holder=new p("<span>");this.holder.appendTo(n.statusDiv);n.on("selectionChange",this._selectionChange,this);
o.Utils.sourceDisable(n,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(n){var k=this.cfg.editor,l=this.holder;n=n.path.elements;var b,e;b=this._cache;for(e=0;e<b.length;e++){b[e].detach("click");b[e]._4e_remove()}this._cache=[];for(e=0;e<n.length;e++){b=n[e];var f=new p("<a href='#' class='elementpath'>"+(b.attr("_ke_real_element_type")||b._4e_name())+"</a>");this._cache.push(f);(function(i){f.on("click",
function(u){u.halt();k.focus();setTimeout(function(){k.getSelection().selectElement(i)},50)})})(b);l.prepend(f)}}});o.ElementPaths=q}();g.ready(function(){new o.ElementPaths({editor:g})})});
KISSY.Editor.add("enterkey",function(g){var o=KISSY.Editor,s=KISSY,p=s.UA,m=/^h[1-6]$/,q=o.XHTML_DTD,n=s.Node,k=s.Event,l=o.Walker,b=o.ElementPath;o.enterBlock||function(){function e(f){k.on(f.document,"keydown",function(i){if(i.keyCode===13)if(!i.shiftKey){f.fire("save");var u=f.execCommand("enterBlock");f.fire("save");u!==false&&i.preventDefault()}})}e.enterBlock=function(f){var i;i=f.getSelection().getRanges();for(var u=i.length-1;u>0;u--)i[u].deleteContents();i=i[0];u=i.document;if(i.checkStartOfBlock()&&
i.checkEndOfBlock()){var h=(new b(i.startContainer)).block;if(h&&(h._4e_name()=="li"||h.parent()._4e_name()=="li"))if(f.hasCommand("outdent")){f.fire("save");f.execCommand("outdent");f.fire("save");return}else return false}var c=i.splitBlock("p");if(c){f=c.previousBlock;h=c.nextBlock;var d=c.wasStartOfBlock,j=c.wasEndOfBlock,t;if(h){t=h.parent();if(t._4e_name()=="li"){h._4e_breakParent(t);h._4e_move(h._4e_next(),true)}}else if(f&&(t=f.parent())&&t._4e_name()=="li"){f._4e_breakParent(t);i.moveToElementEditablePosition(f._4e_next());
f._4e_move(f._4e_previous())}if(!d&&!j){if(h._4e_name()=="li"&&(t=h._4e_first(l.invisible(true)))&&s.inArray(t._4e_name(),["ul","ol"]))(p.ie?new n(u.createTextNode("\u00a0")):new n(u.createElement("br"))).insertBefore(t);h&&i.moveToElementEditablePosition(h)}else{var y;if(f){if(f._4e_name()=="li"||!m.test(f._4e_name()))y=f._4e_clone()}else if(h)y=h._4e_clone();y||(y=new n("<p>",null,u));if(t=c.elementPath){c=0;for(var w=t.elements.length;c<w;c++){var v=t.elements[c];if(v._4e_equals(t.block)||v._4e_equals(t.blockLimit))break;
if(q.$removeEmpty[v._4e_name()]){v=v._4e_clone();y._4e_moveChildren(v);y.append(v)}}}p.ie||y._4e_appendBogus();i.insertNode(y);if(p.ie&&d&&(!j||!f[0].childNodes.length)){i.moveToElementEditablePosition(j?f:y);i.select()}i.moveToElementEditablePosition(d&&!j?h:y)}if(!p.ie)if(h){y=new n(u.createElement("span"));y.html("&nbsp;");i.insertNode(y);y._4e_scrollIntoView();i.deleteContents()}else y._4e_scrollIntoView();i.select()}};o.EnterKey=e}();g.ready(function(){g.addCommand("enterBlock",{exec:o.EnterKey.enterBlock});
o.EnterKey(g)})});
KISSY.Editor.add("fakeobjects",function(g){var o=KISSY.Editor,s=KISSY,p=s.Node,m=o.NODE,q=o.Config.base+"theme/spacer.gif",n=o.HtmlParser;o=s.Editor;var k=(g=g.htmlDataProcessor)&&g.htmlFilter,l={elements:{$:function(b){var e=b.attributes;if((e=(e=(e=e&&e._ke_realelement)&&new n.Fragment.FromHtml(decodeURIComponent(e)))&&e.children[0])&&b.attributes._ke_resizable){var f=b.attributes.style;if(f){var i=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f);b=i&&i[1];f=(i=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&i[1];
if(b)e.attributes.width=b;if(f)e.attributes.height=f}}return e}}};k&&k.addRules(l);g&&s.mix(g,{createFakeParserElement:function(b,e,f,i,u){var h;h=new n.BasicWriter;b.writeHtml(h);h=h.getHtml();var c=b.attributes.style;if(b.attributes.width)c="width:"+b.attributes.width+"px;"+c;if(b.attributes.height)c="height:"+b.attributes.height+"px;"+c;b={"class":e,src:q,_ke_realelement:encodeURIComponent(h),_ke_real_node_type:b.type,style:c,align:b.attributes.align||""};u&&delete u.width;u&&delete u.height;u&&
s.mix(b,u,false);if(f)b._ke_real_element_type=f;if(i)b._ke_resizable=i;return new n.Element("img",b)}});s.augment(o,{createFakeElement:function(b,e,f,i,u,h){var c=b.attr("style")||"";if(b.attr("width"))c="width:"+b.attr("width")+"px;"+c;if(b.attr("height"))c="height:"+b.attr("height")+"px;"+c;b={"class":e,src:q,_ke_realelement:encodeURIComponent(u||b._4e_outerHtml()),_ke_real_node_type:b[0].nodeType,style:c};h&&delete h.width;h&&delete h.height;h&&s.mix(b,h,false);if(f)b._ke_real_element_type=f;if(i)b._ke_resizable=
i;return new p("<img/>",b,this.document)},restoreRealElement:function(b){if(b.attr("_ke_real_node_type")!=m.NODE_ELEMENT)return null;b=decodeURIComponent(b.attr("_ke_realelement"));var e=new p("<div>",null,this.document);e.html(b);return e._4e_first(function(f){return f[0].nodeType==m.NODE_ELEMENT})._4e_remove()}})});
KISSY.Editor.add("flash",function(g){g.ready(function(){var o=KISSY,s=o.Editor,p=g.htmlDataProcessor,m=g.cfg.pluginConfig,q=p&&p.dataFilter;q&&q.addRules({elements:{object:function(n){var k=n.attributes;if(!(k.classid&&String(k.classid).toLowerCase())){for(k=0;k<n.children.length;k++)if(n.children[k].name=="embed"){if(!s.Utils.isFlashEmbed(n.children[k]))break;return p.createFakeParserElement(n,"ke_flash","flash",true)}return null}return p.createFakeParserElement(n,"ke_flash","flash",true)},embed:function(n){if(!s.Utils.isFlashEmbed(n))return null;
return p.createFakeParserElement(n,"ke_flash","flash",true)}}},5);s.use("flash/support",function(){var n=s.Flash;g.addCommand("insertFlash",{exec:function(){var k=o.makeArray(arguments);return s.Flash.Insert.apply(null,k)}});if(!m.flash||m.flash.btn!==false)new n(g)})})});
KISSY.Editor.add("flash/support",function(){function g(i){this.editor=i;this._init()}function o(i){return i._4e_name()==="img"&&!!i.hasClass(b)&&i}var s=KISSY.Editor,p=KISSY,m=p.UA,q=p.Event,n=s.ContextMenu,k=p.Node,l=s.BubbleView,b="ke_flash",e=s.Utils.flash;p.augment(g,{_config:function(){this._cls=b;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=f;this._flashRules=["img."+b]},_init:function(){this._config();var i=this,u=i.editor,h={},c=i._contextMenu;
u.addButton("flash",{contentCls:i._contentCls,title:i._tip,mode:s.WYSIWYG_MODE,offClick:function(){i.show()}});if(c)for(var d in c)(function(j){h[j]=function(){c[j](i)}})(d);n.register({editor:u,rules:i._flashRules,width:"120px",funcs:h});l.attach({pluginName:i._type,editor:i.editor,pluginContext:i});q.on(u.document,"dblclick",i._dbclick,i)},_getFlashUrl:function(i){return e.getUrl(i)},_updateTip:function(i,u){var h=this.editor.restoreRealElement(u);if(h){h=this._getFlashUrl(h);i.html(h);i.attr("href",
h)}},_dbclick:function(i){var u=new k(i.target);if(u._4e_name()==="img"&&u.hasClass(this._cls)){this.show(null,u);i.halt()}},show:function(i,u){this.editor.useDialog(this._type+"/dialog",function(h){h.show(u)})}});s.Flash=g;g.registerBubble=function(i,u,h){l.register({pluginName:i,func:h,init:function(){var c=this,d=c.get("contentEl");d.html(u+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var j=d.one(".ke-bubbleview-url"),t=d.one(".ke-bubbleview-change"),y=d.one(".ke-bubbleview-remove");s.Utils.preventFocus(d);t.on("click",function(w){c._plugin.show(null,c._selectedEl);w.halt()});y.on("click",function(w){var v=c._plugin;if(m.webkit){var r=v.editor.getSelection().getRanges();r&&r[0]&&(r[0].collapse(true)||1)&&r[0].select()}c._selectedEl._4e_remove();c.hide();v.editor.notifySelectionChange();w.halt()});c.on("show",function(){var w=c._selectedEl;w&&c._plugin._updateTip(j,w)})}})};g.registerBubble("flash",
"Flash \u7f51\u5740\uff1a ",o);g.checkFlash=o;var f={"Flash\u5c5e\u6027":function(i){var u=i.editor.getSelection();u=u&&u.getStartElement();(u=o(u))&&i.show(null,u)}};g.CLS_FLASH=b;g.TYPE_FLASH="flash";g.Insert=function(i,u,h,c,d){u=e.createSWF(u,{attrs:h},i.document);var j=u.el;h=i.createFakeElement?i.createFakeElement(j,c||"ke_flash",d||"flash",true,u.html,h):j;return h=i.insertElement(h)};s.Flash=g});
KISSY.Editor.add("flashbridge",function(){function g(e){this._init(e)}function o(e){var f=p.isString(e)?e.match(/(\d)+/g):e;e=e;if(p.isArray(f))e=parseFloat(f[0]+"."+s(f[1],3)+s(f[2],5));return e||0}function s(e,f){for(var i=(e+"").length;i++<f;)e="0"+e;return e}var p=KISSY,m=p.Editor;if(!m.FlashBridge){var q={};p.augment(g,p.EventTarget,{_init:function(e){var f=p.guid("flashbridge-");e.flashVars=e.flashVars||{};e.attrs=e.attrs||{};e.params=e.params||{};var i=e.flashVars,u=e.params;p.mix(e.attrs,
{id:f,width:"100%",height:"100%"},false);p.mix(u,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);p.mix(i,{shareData:false,useCompression:false},false);u={YUISwfId:f,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(e.ajbridge)u={swfID:f,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};p.mix(i,u);q[f]=this;this.id=f;this.swf=m.Utils.flash.createSWFRuntime(e.movie,e);this._expose(e.methods)},_expose:function(e){for(var f=this,i=0;i<e.length;i++)(function(u){f[u]=
function(){return f._callSWF(u,p.makeArray(arguments))}})(e[i])},_callSWF:function(e,f){f=f||[];try{if(this.swf[e])return this.swf[e].apply(this.swf,f)}catch(i){var u="";if(f.length!==0)u="'"+f.join("', '")+"'";return(new Function("self","return self.swf."+e+"("+u+");"))(this)}},_eventHandler:function(e){var f=e.type;if(f==="log")p.log(e.message);else f&&this.fire(f,e)},_destroy:function(){delete q[this.id]}});g.EventHandler=function(e,f){var i=q[e];i&&setTimeout(function(){i._eventHandler.call(i,
f)},100)};m.FlashBridge=g;var n=p.UA,k,l,b=true;n.fpv=function(e){if(e||b){b=false;var f;if(navigator.plugins&&navigator.mimeTypes.length)f=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{f=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(i){}k=f?f.match(/(\d)+/g):void 0;l=o(k)}return k};n.fpvGEQ=function(e,f){b&&n.fpv(f);return!!l&&l>=o(e)}}});
KISSY.Editor.add("flashutils",function(){var g=KISSY,o=g.Editor,s=o.Utils.flash;if(!s){var p=g.DOM,m=g.Node,q=g.UA;s={getUrl:function(n){var k="",l=o.NODE;if(n._4e_name()=="object"){n=n[0].childNodes;for(var b=0;b<n.length;b++)if(n[b].nodeType==l.NODE_ELEMENT)if((p.attr(n[b],"name")||"").toLowerCase()=="movie")k=p.attr(n[b],"value");else if(p._4e_name(n[b])=="embed")k=p.attr(n[b],"src");else if(p._4e_name(n[b])=="object")k=p.attr(n[b],"data")}else if(n._4e_name()=="embed")k=n.attr("src");return k},
createSWF:function(n,k,l){var b=k.attrs||{},e=k.flashVars,f="",i="";k=k.params||{};var u="";l=l||document;g.mix(b,{wmode:"transparent"});for(var h in b)if(b.hasOwnProperty(h))f+=h+"='"+b[h]+"' ";g.mix(k,{quality:"high",movie:n,wmode:"transparent"});for(var c in k)if(k.hasOwnProperty(c))i+="<param name='"+c+"' value='"+k[c]+"'/>";if(e){for(var d in e)if(e.hasOwnProperty(d))u+="&"+d+"="+encodeURIComponent(e[d]);u=u.substring(1)}n="<object "+f+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
i+(u?'<param name="flashVars" value="'+u+'"/>':"")+"<embed "+f+" "+(u?'FlashVars="'+u+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+n+'"  type="application/x-shockwave-flash"/></object>';return{el:new m(n,null,l),html:n}},createSWFRuntime2:function(n,k,l){l=l||document;var b=(new m("<div style='width:0;height:0;overflow:hidden;'>",null,l)).appendTo(l.body);b=s.createSWF.apply(this,arguments).el.appendTo(b);q.ie||(b=b.one("object"));return b[0]},createSWFRuntime:function(n,
k,l){var b=k.attrs||{},e=k.flashVars||{},f=k.params||{},i="",u="",h="";l=l||document;b.id=b.id||g.guid("ke-runtimeflash-");for(var c in b)if(b.hasOwnProperty(c))i+=c+"='"+b[c]+"' ";for(var d in f)if(f.hasOwnProperty(d))u+="<param name='"+d+"' value='"+f[d]+"'/>";for(var j in e)if(e.hasOwnProperty(j))h+="&"+j+"="+encodeURIComponent(e[j]);h=h.substring(1);n=q.ie?"<object "+i+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+u+'<param name="movie" value="'+n+'" />'+(h?'<param name="flashVars" value="'+
h+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+n+"' "+i+">"+u+(h?'<param name="flashVars" value="'+h+'"/>':"")+"</object>";var t=k.holder;if(!t){t=(new m("<div style='"+(k.style?k.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,l)).appendTo(l.body);setTimeout(function(){t.offset({left:p.scrollLeft(),top:p.scrollTop()})},100)}t.html(n);return l.getElementById(b.id)}};o.Utils.flash=s}});
KISSY.Editor.add("font",function(g){function o(y){for(var w=[],v=0;v<y.length;v++)w.push({name:y[v],value:y[v]});return w}var s=KISSY,p=s.Editor,m=p.Style,q=p.TripleButton,n=g.cfg.pluginConfig,k=s.Node,l=n["font-size"],b,e,f;if(l!==false){l=l||{};s.mix(l,{items:o(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var i={},u=[],h={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(t=0;t<l.items.length;t++){b=
l.items[t];e=b.name;f=b.attrs;b=b.value;i[b]=new m(h,{size:b});u.push({name:e,value:b,attrs:f})}n["font-size"]=l}var c=n["font-family"];if(c!==false){c=c||{};s.mix(c,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},
{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var d={},j=[];h={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};var t;n["font-family"]=c;for(t=0;t<c.items.length;t++){b=c.items[t];e=b.name;f=b.attrs||{};b=b.value;f.style=f.style||"";f.style+=";font-family:"+b;d[b]=new m(h,{family:b});j.push({name:e,value:b,attrs:f})}}p.FontSelect||function(){function y(v){y.superclass.constructor.call(this,v);this._init()}
y.ATTRS={title:{},html:{},styles:{},editor:{}};var w=p.Select;s.extend(y,s.Base,{_init:function(){var v=this.get("editor"),r=v.toolBarDiv;this.get("html");this.el=new w({container:r,doc:v.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new k(document.body)});this.el.on("click",this._vChange,this);v.on("selectionChange",this._selectionChange,this);p.Utils.sourceDisable(v,this)},disable:function(){this.el.set("state",
w.DISABLED)},enable:function(){this.el.set("state",w.ENABLED)},_vChange:function(v){var r=this.get("editor"),z=v.newVal;v=v.prevVal;var E=this.get("styles");r.focus();r.fire("save");E=E[z];if(z==v){E.remove(r.document);this.el.set("value","")}else E.apply(r.document);r.fire("save")},_selectionChange:function(v){this.get("editor");v=v.path.elements;for(var r=this.get("styles"),z=0,E;z<v.length;z++){E=v[z];for(var B in r)if(r[B].checkElementRemovable(E,true)){this.el.set("value",B);return}}this.el.reset("value")}});
p.FontSelect=y}();g.ready(function(){false!==n["font-size"]&&new p.FontSelect({editor:g,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:l.width,styles:i,html:u});false!==n["font-family"]&&new p.FontSelect({editor:g,title:"\u5b57\u4f53",width:"110px",popUpWidth:c.width,styles:d,html:j});var y={mode:p.WYSIWYG_MODE,offClick:function(){var w=this.editor,v=this.cfg.style;w.fire("save");v.apply(w.document);w.fire("save");w.notifySelectionChange();w.focus()},onClick:function(){var w=this.editor,v=this.cfg.style;
w.fire("save");v.remove(w.document);w.fire("save");w.notifySelectionChange();w.focus()},selectionChange:function(w){var v=this.btn;this.cfg.style.checkActive(w.path)?v.set("state",q.ON):v.set("state",q.OFF)}};false!==n["font-bold"]&&g.addButton("font-bold",s.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",style:new m({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},y));false!==n["font-italic"]&&g.addButton("font-italic",s.mix({contentCls:"ke-toolbar-italic",
title:"\u659c\u4f53 ",style:new m({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},y));false!==n["font-underline"]&&g.addButton("font-underline",s.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new m({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})},y));false!==n["font-strikeThrough"]&&g.addButton("font-underline",s.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new m({element:"del",overrides:[{element:"span",
attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})},y))})});
KISSY.Editor.add("format",function(g){var o=KISSY.Editor,s=KISSY,p=s.Node,m=[],q={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},n={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},k={},l=o.Style,b;for(b in q)if(q[b]){k[q[b]]=new l({element:q[b]});m.push({name:b,value:q[b],attrs:{style:"font-size:"+n[q[b]]}})}o.Format||function(){function e(i){e.superclass.constructor.call(this,i);this._init()}e.ATTRS={editor:{}};var f=o.Select;s.extend(e,s.Base,
{_init:function(){var i=this.get("editor");this.el=new f({container:i.toolBarDiv,value:"",doc:i.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new p(document.body)});this.el.on("click",this._vChange,this);i.on("selectionChange",this._selectionChange,this);o.Utils.sourceDisable(i,this)},disable:function(){this.el.set("state",f.DISABLED)},enable:function(){this.el.set("state",f.ENABLED)},_vChange:function(i){var u=this.get("editor"),
h=i.newVal;i=i.prevVal;u.fire("save");if(h!=i)k[h].apply(u.document);else{k.p.apply(u.document);this.el.set("value","p")}u.fire("save")},_selectionChange:function(i){this.get("editor");i=i.path;for(var u in k)if(k[u].checkActive(i)){this.el.set("value",u);break}}});o.Format=e}();g.ready(function(){new o.Format({editor:g,html:m,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(g){var o=o,s=KISSY,p=s.Editor,m=s.Node,q=s.UA,n=p.NODE,k=p.HtmlParser,l=new k.Filter,b=new k.Filter,e=p.XHTML_DTD;if(!g.htmlDataProcessor){(function(){var f=p.HtmlParser.Fragment.prototype,i=p.HtmlParser.Element.prototype;f.onlyChild=i.onlyChild=function(){var u=this.children;return u.length==1&&u[0]||null};i.removeAnyChildWithName=function(u){for(var h=this.children,c=[],d,j=0;j<h.length;j++){d=h[j];if(d.name){if(d.name==u){c.push(d);h.splice(j--,1)}c=
c.concat(d.removeAnyChildWithName(u))}}return c};i.getAncestor=function(u){for(var h=this.parent;h&&!(h.name&&h.name.match(u));)h=h.parent;return h};f.firstChild=i.firstChild=function(u){for(var h,c=0;c<this.children.length;c++){h=this.children[c];if(u(h))return h;else if(h.name)if(h=h.firstChild(u))return h}return null};i.addStyle=function(u,h,c){var d="";if(typeof h=="string")d+=u+":"+h+";";else{if(typeof u=="object")for(var j in u){if(u.hasOwnProperty(j))d+=j+":"+u[j]+";"}else d+=u;c=h}if(!this.attributes)this.attributes=
{};u=this.attributes.style||"";u=(c?[d,u]:[u,d]).join(";");this.attributes.style=u.replace(/^;|;(?=;)/,"")};e.parentOf=function(u){var h={},c;for(c in this)if(c.indexOf("$")==-1&&this[c][u])h[c]=1;return h}})();(function(){function f(r){if(/mso-list\s*:\s*Ignore/i.test(r.attributes&&r.attributes.style))return true;return o}function i(r,z){var E=new p.HtmlParser.Element("ke:listbullet"),B;if(r)if(r[2]){r=isNaN(r[1])?/^[a-z]+$/.test(r[1])?"lower-alpha":/^[A-Z]+$/.test(r[1])?"upper-alpha":"decimal":
"decimal";B="ol"}else{r=/[l\u00B7\u2002]/.test(r[1])?"disc":/[\u006F\u00D8]/.test(r[1])?"circle":/[\u006E\u25C6]/.test(r[1])?"square":"disc";B="ul"}else{r="decimal";B="ol"}E.attributes={"ke:listtype":B,style:"list-style-type:"+r+";"};E.add(new p.HtmlParser.Text(z));return E}function u(r){var z=r.attributes,E;if((E=r.removeAnyChildWithName("ke:listbullet"))&&E.length&&(E=E[0])){r.name="ke:li";if(z.style)z.style=h([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");
B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!j&&t&&B>t)j=B-t;z["ke:margin"]=t=B}]],o)(z.style,r)||"";E=E.attributes;r.addStyle(E.style);s.mix(z,E);return true}return false}function h(r,z){return function(E,B){var x=[];E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(D,F,C){F=F.toLowerCase();F=="font-family"&&(C=C.replace(/["']/g,""));for(var G,M,N,Q=0;Q<r.length;Q++)if(r[Q]){D=r[Q][0];G=r[Q][1];M=r[Q][2];N=r[Q][3];if(F.match(D)&&(!G||C.match(G))){F=N||F;z&&(M=M||C);if(typeof M==
"function")M=M(C,B,F);if(M&&M.push){F=M[0];M=M[1]}typeof M=="string"&&x.push([F,M]);return}}!z&&x.push([F,C])});for(var A=0;A<x.length;A++)x[A]=x[A].join(":");return x.length?x.join(";")+";":false}}function c(r){r=r.children;for(var z,E,B,x,A,D,F,C=0;C<r.length;C++){z=r[C];if("ke:li"==z.name){z.name="li";z=z;E=z.attributes;B=z.attributes["ke:listtype"];x=parseInt(E["ke:indent"],10)||j&&Math.ceil(E["ke:margin"]/j)||1;E.style&&(E.style=h([["list-style-type",B=="ol"?"decimal":"disc"]],o)(E.style)||"");
if(D){if(x>F){D=new p.HtmlParser.Element(B);D.add(z);A.add(D)}else{if(x<F){A=F-x;for(var G;A--&&(G=D.parent);)D=G.parent}D.add(z)}r.splice(C--,1)}else{D=new p.HtmlParser.Element(B);D.add(z);r[C]=D}A=z;F=x}else D=null}j=0}var d=h([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],o),j,t=0,y=e.parentOf("ol"),w={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(r){r.filterChildren();
c(r)},elements:{font:function(r){delete r.name},p:function(r){r.filterChildren();if(u(r))return o},$:function(r){var z=r.name||"";z.indexOf(":")!=-1&&z.indexOf("ke")==-1&&delete r.name;var E=r.attributes.style;if(z=="span"&&(!E||!d(E)))delete r.name;if(z in y){r.filterChildren();c(r)}},span:function(r){if(!q.gecko&&f(r.parent))return false;if(!q.gecko&&f(r)){r=(r=r.firstChild(function(E){return E.value||E.name=="img"}))&&(r.value||"l.");var z=r.match(/^([^\s]+?)([.)]?)$/);return i(z,r)}},a:function(r){r=
r.attributes;if(r.href)r._ke_saved_href=r.href}},comment:!q.ie?function(r,z){var E=r.match(/<img.*?>/),B=r.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(E=B[1]||E&&"l.")&&E.match(/>([^\s]+?)([.)]?)</);return i(B,E)}if(q.gecko&&E){E=p.HtmlParser.Fragment.FromHtml(E[0]).children[0];(B=(B=(B=z.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(E.attributes.src=B);return E}return false}:function(){return false},attributes:{"class":function(r){if(/(^|\s+)ke_/.test(r))return r;
return false},style:function(r){r=d(r);if(!r)return false;return r}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},v={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(r){var z=r.parent;if(z&&z.name=="object"){var E=z.attributes.width;z=z.attributes.height;E&&(r.attributes.width=E);z&&(r.attributes.height=z)}},param:function(r){r.children=[];r.isEmpty=true;return r},a:function(r){if(!(r.children.length||r.attributes.name))return false;r=r.attributes;if(r._ke_saved_href)r.href=
r._ke_saved_href},td:function(r){for(var z=r.children,E=0;E<z.length;E++)if(z[E].name=="br"){z.splice(E,1);--E}if(!r.children.length){z=new p.HtmlParser.Text("&nbsp;");r.children.push(z)}},span:function(r){if(!r.children.length)return false}},attributes:{style:function(r){if(!s.trim(r))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(q.ie)v.attributes.style=function(r){return r.toLowerCase()};l.addRules(v);b.addRules(w)})();(function(){function f(v){for(var r=v.children.length,
z=v.children[r-1];z&&z.type==n.NODE_TEXT&&!s.trim(z.value);)z=v.children[--r];return z}function i(v){var r=f(v);return!r||r.type==n.NODE_ELEMENT&&r.name=="br"||v.name=="form"&&r.name=="input"}function u(v,r){var z=v.children,E=f(v);if(E){if((r||!q.ie)&&E.type==n.NODE_ELEMENT&&E.name=="br")z.pop();E.type==n.NODE_TEXT&&d.test(E.value)&&z.pop()}}function h(v){u(v,true);if(i(v))q.ie?v.add(new p.HtmlParser.Text("\u00a0")):v.add(new p.HtmlParser.Element("br",{}))}function c(v){u(v);i(v)&&v.add(new p.HtmlParser.Text("\u00a0"))}
var d=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,j=p.XHTML_DTD,t=p.Utils.mix({},j.$block,j.$listItem,j.$tableContent),y;for(y in t)"br"in j[y]||delete t[y];delete t.pre;j={elements:{}};var w={elements:{}};for(y in t){j.elements[y]=h;w.elements[y]=c}b.addRules(j);l.addRules(w)})();(function(){l.addRules({text:function(f){return f.replace(/\xa0/g,"&nbsp;")}})})();g.htmlDataProcessor={htmlFilter:l,dataFilter:b,toHtml:function(f,i){var u=new k.HtmlWriter;k.Fragment.FromHtml(f,i).writeHtml(u,l);return u.getHtml(true)},
toDataFormat:function(f,i){if(q.gecko)f=f.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var u=new m("<div>");u.html("a"+f);f=u.html().substr(1);u=new k.BasicWriter;var h=k.Fragment.FromHtml(f,i);u.reset();h.writeHtml(u,b);return u.getHtml(true)},toServer:function(f,i){var u=new k.BasicWriter;k.Fragment.FromHtml(f,i).writeHtml(u,l);return u.getHtml(true)}}}});
KISSY.Editor.add("image",function(g){var o=KISSY,s=o.Editor,p=o.UA,m=o.Node,q=o.Event,n=s.BubbleView,k=function(l){return l._4e_name()==="img"&&!/(^|\s+)ke_/.test(l[0].className)&&l};g.ready(function(){var l=g.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:s.WYSIWYG_MODE,offClick:function(){this.call("show")},_updateTip:function(i,u){var h=u.attr("src");i.html(h);i.attr("href",h)},show:function(i,u){this.editor.useDialog("image/dialog",function(h){h.show(u)})}}),b={"\u56fe\u7247\u5c5e\u6027":function(i){i=
(i=i.getSelection())&&i.getStartElement();(i=k(i))&&l.call("show",null,i)}},e={},f;for(f in b)(function(i){e[i]=function(){b[i](g)}})(f);s.ContextMenu.register({editor:g,rules:[k],width:"120px",funcs:e});q.on(g.document,"dblclick",function(i){var u=new m(i.target);i.halt();k(u)&&l.call("show",null,u)});n.register({pluginName:"image",pluginContext:l,editor:g,func:k,init:function(){var i=this,u=i.get("contentEl");u.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=u.one(".ke-bubbleview-url"),c=u.one(".ke-bubbleview-change"),d=u.one(".ke-bubbleview-remove");s.Utils.preventFocus(u);c.on("click",function(j){i._plugin.call("show",null,i._selectedEl);j.halt()});d.on("click",function(j){var t=i._plugin;if(p.webkit){var y=t.editor.getSelection().getRanges();y&&y[0]&&(y[0].collapse(true)||1)&&y[0].select()}i._selectedEl._4e_remove();i.hide();t.editor.notifySelectionChange();j.halt()});i.on("show",function(){var j=i._selectedEl;j&&i._plugin.call("_updateTip",
h,j)})}})})});
KISSY.Editor.add("indent",function(g){var o=KISSY.Editor;g.ready(function(){var s=g.addButton("outdent",{title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:o.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent",type:"outdent",loading:true}),p=g.addButton("indent",{title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:o.WYSIWYG_MODE,contentCls:"ke-toolbar-indent",type:"indent",loading:true});o.use("indent/support",function(){s.reload(o.IndentSupport);p.reload(o.IndentSupport)});g.addCommand("indent",{exec:function(){p.call("offClick")}});g.addCommand("outdent",{exec:function(){s.call("offClick")}})})});
KISSY.Editor.add("indent/support",function(){function g(h){this.type=h;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function o(h){return h[0].nodeType==f.NODE_ELEMENT&&h._4e_name()=="li"}function s(h,c){for(var d=h.startContainer,j=h.endContainer;d&&!d.parent()._4e_equals(c);)d=d.parent();for(;j&&!j.parent()._4e_equals(c);)j=j.parent();if(d&&j){var t=d;d=[];for(var y=false;!y;){if(t._4e_equals(j))y=true;d.push(t);t=t.next()}if(!(d.length<1)){t=c._4e_parents(true);
for(j=0;j<t.length;j++)if(q[t[j]._4e_name()]){c=t[j];break}t=this.type=="indent"?1:-1;j=d[0];y=d[d.length-1];d={};var w=m.ListUtils.listToArray(c,d),v=w[y.data("listarray_index")].indent;for(j=j.data("listarray_index");j<=y.data("listarray_index");j++){w[j].indent+=t;var r=w[j].parent;w[j].parent=new b(r[0].ownerDocument.createElement(r._4e_name()))}for(j=y.data("listarray_index")+1;j<w.length&&w[j].indent>v;j++)w[j].indent+=t;y=m.ListUtils.arrayToList(w,d,null,"p",0);t=[];if(this.type=="outdent"){var z;
if((z=c.parent())&&z._4e_name()=="li"){w=y.listNode.childNodes;var E;for(j=w.length-1;j>=0;j--)if((E=new b(w[j]))&&E._4e_name()=="li")t.push(E)}}if(y){l.insertBefore(y.listNode,c);c._4e_remove()}if(t&&t.length)for(j=0;j<t.length;j++){for(y=E=t[j];(y=y.next())&&y._4e_name()in q;){e.ie&&!E._4e_first(function(B){return i(B)&&u(B)})&&E[0].appendChild(h.document.createTextNode("\u00a0"));E[0].appendChild(y[0])}l.insertAfter(E[0],z[0])}m.Utils.clearAllMarkers(d)}}}function p(h){var c=parseInt(h._4e_style(this.indentCssProperty),
10);if(isNaN(c))c=0;c+=(this.type=="indent"?1:-1)*this.indentOffset;if(c<0)return false;c=Math.max(c,0);c=Math.ceil(c/this.indentOffset)*this.indentOffset;h.css(this.indentCssProperty,c?c+this.indentUnit:"");h[0].style.cssText===""&&h.removeAttr("style");return true}var m=KISSY.Editor,q={ol:1,ul:1},n=KISSY,k=m.Walker,l=n.DOM,b=n.Node,e=n.UA,f=m.NODE,i=k.whitespaces(true),u=k.bookmark(false,true);n.augment(g,{exec:function(h){for(var c=(h=h.getSelection())&&h.getRanges()[0],d=c.startContainer,j=c.endContainer,
t=c.getCommonAncestor();t&&!(t[0].nodeType==f.NODE_ELEMENT&&q[t._4e_name()]);)t=t.parent();if(t&&d[0].nodeType==f.NODE_ELEMENT&&d._4e_name()in q){d=new k(c);d.evaluator=o;c.startContainer=d.next()}if(t&&j[0].nodeType==f.NODE_ELEMENT&&j._4e_name()in q){d=new k(c);d.evaluator=o;c.endContainer=d.previous()}j=h.createBookmarks(true);if(t){for(d=t._4e_first();d&&d._4e_name()!="li";)d=d.next();var y=c.startContainer;(d[0]==y[0]||d.contains(y))&&p.call(this,t)||s.call(this,c,t)}else{c=c.createIterator();
c.enforceRealBlocks=true;for(c.enlargeBr=true;t=c.getNextParagraph();)p.call(this,t)}h.selectBookmarks(j)}});m.IndentSupport={init:function(){this.indentCommand=new g(this.cfg.type)},offClick:function(){var h=this,c=h.editor;c.fire("save");setTimeout(function(){h.indentCommand.exec(c);c.fire("save");c.notifySelectionChange()},10)},selectionChange:function(h){if(this.cfg.type=="outdent"){var c=h.path,d=c.blockLimit;h=this.btn;if(c.contains(q))h.boff();else(c=c.block||d)&&c._4e_style(this.indentCommand.indentCssProperty)?
h.boff():h.disable()}}}});
KISSY.Editor.add("justify",function(g){var o=KISSY,s=o.Editor,p=s.TripleButton,m=/(-moz-|-webkit-|start|auto)/gi;g.ready(function(){var q={mode:s.WYSIWYG_MODE,offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var n=this.editor,k=n.getSelection(),l=this.btn.get("state");if(k){var b=k.createBookmarks(),e=k.getRanges(),f,i;n.fire("save");for(var u=e.length-1;u>=0;u--){f=e[u].createIterator();for(f.enlargeBr=true;i=f.getNextParagraph();){i.removeAttr("align");l==
p.OFF?i.css("text-align",this.cfg.v):i.css("text-align","")}}n.notifySelectionChange();k.selectBookmarks(b);n.fire("save")}},selectionChange:function(n){var k=this.btn;n=n.path;n=n.block||n.blockLimit;if(!n||n._4e_name()==="body")k.boff();else(n.css("text-align").replace(m,"")||"left")==this.cfg.v?k.bon():k.boff()}};g.addButton("alignleft",o.mix({contentCls:"ke-toolbar-alignleft",title:"\u5de6\u5bf9\u9f50",v:"left"},q));g.addButton("aligncenter",o.mix({contentCls:"ke-toolbar-aligncenter",title:"\u5c45\u4e2d\u5bf9\u9f50",v:"center"},
q));g.addButton("alignright",o.mix({contentCls:"ke-toolbar-alignright",title:"\u53f3\u5bf9\u9f50",v:"right"},q))})});
KISSY.Editor.add("link",function(g){function o(n){return n._4e_ascendant(function(k){return k._4e_name()==="a"&&!!k.attr("href")},true)}var s=KISSY.Editor,p=s.Style,m=s.BubbleView,q={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};g.ready(function(){var n=g.addButton("link",{contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:s.WYSIWYG_MODE,_getSelectedLink:function(){var k=this.editor.getSelection();if(k=k&&k.getStartElement())k=o(k);return k},
_getSelectionLinkUrl:function(){var k=this.cfg._getSelectedLink.call(this);if(k)return k.attr("_ke_saved_href")||k.attr("href")},_removeLink:function(k){var l=this.editor;l.fire("save");var b=l.getSelection(),e=b.getRanges()[0];if(e&&e.collapsed){e=b.createBookmarks();k._4e_remove(true);b.selectBookmarks(e)}else if(e){k=k[0];b=k.attributes;e={};for(var f=0;f<b.length;f++){var i=b[f];if(i.specified)e[i.name]=i.value}if(k.style.cssText)e.style=k.style.cssText;(new p(q,e)).remove(l.document)}l.fire("save");
l.notifySelectionChange()},_link:function(k){var l=this.editor,b=this.cfg._getSelectedLink.call(this);k._ke_saved_href=k.href;if(b){l.fire("save");b.attr(k);l.fire("save")}else{b=(b=l.getSelection())&&b.getRanges()[0];if(!b||b.collapsed){a=new Node("<a>"+url+"</a>",k,l.document);l.insertElement(a)}else{l.fire("save");(new p(q,k)).apply(l.document);l.fire("save")}}l.notifySelectionChange()},offClick:function(){var k=this;k.editor.useDialog("link/dialog",function(l){l.show(k)})}});m.register({pluginName:"link",
editor:g,pluginContext:n,func:o,init:function(){var k=this,l=k.get("contentEl");l.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var b=l.one(".ke-bubbleview-url"),e=l.one(".ke-bubbleview-change"),f=l.one(".ke-bubbleview-remove");s.Utils.preventFocus(l);e.on("click",function(i){k._plugin.call("offClick");i.halt()});f.on("click",function(i){k._plugin.call("_removeLink",
k._selectedEl);i.halt()});k.on("show",function(){var i=k._selectedEl;if(i){i=i.attr("_ke_saved_href")||i.attr("href");b.html(i);b.attr("href",i)}})}})})});KISSY.Editor.add("list",function(g){var o=KISSY.Editor;g.ready(function(){var s=g.addButton("ul",{title:"\u9879\u76ee\u5217\u8868",mode:o.WYSIWYG_MODE,contentCls:"ke-toolbar-ul",loading:true,type:"ul"}),p=g.addButton("ol",{title:"\u7f16\u53f7\u5217\u8868",mode:o.WYSIWYG_MODE,contentCls:"ke-toolbar-ol",loading:true,type:"ol"});o.use("list/support",function(){s.reload(o.ListSupport);p.reload(o.ListSupport)})})});
KISSY.Editor.add("list/support",function(){function g(h){this.type=h}var o=KISSY.Editor,s={ol:1,ul:1},p=["ol","ul"],m=KISSY,q=o.RANGE,n=o.ElementPath,k=o.Walker,l=o.NODE,b=m.UA,e=m.Node,f=m.DOM,i={listToArray:function(h,c,d,j,t){if(!s[h._4e_name()])return[];j||(j=0);d||(d=[]);for(var y=0,w=h[0].childNodes.length;y<w;y++){var v=new e(h[0].childNodes[y]);if(v._4e_name()=="li"){var r={parent:h,indent:j,element:v,contents:[]};if(t)r.grandparent=t;else{r.grandparent=h.parent();if(r.grandparent&&r.grandparent._4e_name()==
"li")r.grandparent=r.grandparent.parent()}c&&v._4e_setMarker(c,"listarray_index",d.length);d.push(r);for(var z=0,E=v[0].childNodes.length,B;z<E;z++){B=new e(v[0].childNodes[z]);B[0].nodeType==l.NODE_ELEMENT&&s[B._4e_name()]?i.listToArray(B,c,d,j+1,r.grandparent):r.contents.push(B)}}}return d},arrayToList:function(h,c,d,j){d||(d=0);if(!h||h.length<d+1)return null;for(var t=h[d].parent[0].ownerDocument,y=t.createDocumentFragment(),w=null,v=d,r=Math.max(h[d].indent,0),z=null;;){var E=h[v];if(E.indent==
r){if(!w||h[v].parent._4e_name()!=w._4e_name()){w=h[v].parent._4e_clone(false,true);y.appendChild(w[0])}z=w[0].appendChild(E.element._4e_clone(false,true)[0]);for(var B=0;B<E.contents.length;B++)z.appendChild(E.contents[B]._4e_clone(true,true)[0]);v++}else if(E.indent==Math.max(r,0)+1){v=i.arrayToList(h,null,v,j);z.appendChild(v.listNode);v=v.nextIndex}else if(E.indent==-1&&!d&&E.grandparent){if(s[E.grandparent._4e_name()])z=E.element._4e_clone(false,true)[0];else if(E.grandparent._4e_name()!="td"){z=
t.createElement(j);E.element._4e_copyAttributes(new e(z))}else z=t.createDocumentFragment();for(B=0;B<E.contents.length;B++){w=E.contents[B]._4e_clone(true,true);z.nodeType==l.NODE_DOCUMENT_FRAGMENT&&E.element._4e_copyAttributes(new e(w));z.appendChild(w[0])}if(z.nodeType==l.NODE_DOCUMENT_FRAGMENT&&v!=h.length-1){z.lastChild&&z.lastChild.nodeType==l.NODE_ELEMENT&&z.lastChild.getAttribute("type")=="_moz"&&f._4e_remove(z.lastChild);f._4e_appendBogus(z)}if(z.nodeType==l.NODE_ELEMENT&&f._4e_name(z)==
j&&z.firstChild){f._4e_trim(z);w=z.firstChild;if(w.nodeType==l.NODE_ELEMENT&&f._4e_isBlockBoundary(w)){w=t.createDocumentFragment();f._4e_moveChildren(z,w);z=w}}w=f._4e_name(z);if(!b.ie&&(w=="div"||w=="p"))f._4e_appendBogus(z);y.appendChild(z);w=null;v++}else return null;if(h.length<=v||Math.max(h[v].indent,0)<r)break}if(c)for(h=new e(y.firstChild);h&&h[0];){h[0].nodeType==l.NODE_ELEMENT&&h._4e_clearMarkers(c,true);h=h._4e_nextSourceNode()}return{listNode:y,nextIndex:v}}},u=/^h[1-6]$/;g.prototype=
{changeListType:function(h,c,d,j){var t=i.listToArray(c.root,d),y=[];for(h=0;h<c.contents.length;h++){var w=c.contents[h];w=w._4e_ascendant("li",true);if(!(!w||!w[0]||w.data("list_item_processed"))){y.push(w);w._4e_setMarker(d,"list_item_processed",true)}}w=new e(c.root[0].ownerDocument.createElement(this.type));for(h=0;h<y.length;h++){var v=y[h].data("listarray_index");t[v].parent=w}d=i.arrayToList(t,d,null,"p");var r;t=d.listNode.childNodes.length;for(h=0;h<t&&(r=new e(d.listNode.childNodes[h]));h++)r._4e_name()==
this.type&&j.push(r);f.insertBefore(d.listNode,c.root);c.root._4e_remove()},createList:function(h,c,d){var j=c.contents;h=c.root[0].ownerDocument;var t=[];if(j.length==1&&j[0][0]===c.root[0]){var y=new e(h.createElement("div"));j[0][0].nodeType!=l.NODE_TEXT&&j[0]._4e_moveChildren(y);j[0][0].appendChild(y[0]);j[0]=y}c=c.contents[0].parent();for(y=0;y<j.length;y++)c=c._4e_commonAncestor(j[y].parent());for(y=0;y<j.length;y++)for(var w=j[y],v;v=w.parent();){if(v[0]===c[0]){t.push(w);break}w=v}if(!(t.length<
1)){j=new e(t[t.length-1][0].nextSibling);y=new e(h.createElement(this.type));for(d.push(y);t.length;){d=t.shift();w=new e(h.createElement("li"));if(u.test(d._4e_name()))w[0].appendChild(d[0]);else{d._4e_copyAttributes(w);d._4e_moveChildren(w);d._4e_remove()}y[0].appendChild(w[0]);b.ie||w._4e_appendBogus()}j[0]?f.insertBefore(y,j):c.append(y)}},removeList:function(h,c,d){function j(B){if((z=new e(r[B?"firstChild":"lastChild"]))&&!(z[0].nodeType==l.NODE_ELEMENT&&z._4e_isBlockBoundary())&&(E=c.root[B?
"_4e_previous":"_4e_next"](k.whitespaces(true)))&&!(z[0].nodeType==l.NODE_ELEMENT&&E._4e_isBlockBoundary({br:1})))f[B?"insertBefore":"insertAfter"](h.document.createElement("br"),z)}for(var t=i.listToArray(c.root,d),y=[],w=0;w<c.contents.length;w++){var v=c.contents[w];v=v._4e_ascendant("li",true);if(!(!v||v.data("list_item_processed"))){y.push(v);v._4e_setMarker(d,"list_item_processed",true)}}v=null;for(w=0;w<y.length;w++){v=y[w].data("listarray_index");t[v].indent=-1;v=v}for(w=v+1;w<t.length;w++)if(t[w].indent>
Math.max(t[w-1].indent,0)){y=t[w-1].indent+1-t[w].indent;for(v=t[w].indent;t[w]&&t[w].indent>=v;){t[w].indent+=y;w++}w--}var r=i.arrayToList(t,d,null,"p").listNode,z,E;j(true);j(undefined);f.insertBefore(r,c.root);c.root._4e_remove()},exec:function(h){var c=h.getSelection(),d=c&&c.getRanges();if(!(!d||d.length<1)){for(var j=c.createBookmarks(true),t=[],y={};d.length>0;){var w=d.shift(),v=w.getBoundaryNodes(),r=v.startNode,z=v.endNode;r[0].nodeType==l.NODE_ELEMENT&&r._4e_name()=="td"&&w.setStartAt(v.startNode,
q.POSITION_AFTER_START);z[0].nodeType==l.NODE_ELEMENT&&z._4e_name()=="td"&&w.setEndAt(v.endNode,q.POSITION_BEFORE_END);w=w.createIterator();for(w.forceBrBreak=false;v=w.getNextParagraph();)if(!v.data("list_block")){v._4e_setMarker(y,"list_block",1);z=new n(v);var E=z.elements,B=null,x=false,A=z.blockLimit,D;for(r=E.length-1;r>=0&&(D=E[r]);r--)if(s[D._4e_name()]&&A.contains(D)){A.removeData("list_group_object");if(r=D.data("list_group_object"))r.contents.push(v);else{r={root:D,contents:[v]};t.push(r);
D._4e_setMarker(y,"list_group_object",r)}x=true;break}if(!x){z=A||z.block;if(z.data("list_group_object"))z.data("list_group_object").contents.push(v);else{r={root:z,contents:[v]};z._4e_setMarker(y,"list_group_object",r);t.push(r)}}}}for(d=[];t.length>0;){r=t.shift();if(this.state=="off")if(s[r.root._4e_name()])this.changeListType(h,r,y,d);else{o.Utils.clearAllMarkers(y);this.createList(h,r,d)}else this.state=="on"&&s[r.root._4e_name()]&&this.removeList(h,r,y)}for(r=0;r<d.length;r++){B=d[r];var F=
this;(h=function(C){var G=B[C?"_4e_previous":"_4e_next"](k.whitespaces(true));if(G&&G[0]&&G._4e_name()==F.type){G._4e_remove();G._4e_moveChildren(B,C?true:false)}})();h(true)}o.Utils.clearAllMarkers(y);c.selectBookmarks(j)}}};o.ListUtils=i;o.ListSupport={init:function(){this.listCommand=new g(this.cfg.type)},selectionChange:function(h){var c=this.cfg.type,d=h.path,j;h=this.btn;var t=d.blockLimit;d=d.elements;if(t){if(d)for(var y=0;y<d.length&&(j=d[y])&&j[0]!==t[0];y++){var w=m.indexOf(d[y]._4e_name(),
p);if(w!==-1)if(p[w]===c){h.bon();return}else break}h.boff()}},offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var h=this.editor,c=this.btn;h.fire("save");this.listCommand.state=c.get("state");this.listCommand.exec(h);h.fire("save");h.notifySelectionChange()}}});
KISSY.Editor.add("localstorage",function(){var g=KISSY,o=g.Editor,s;s=o.STORE="localStorage";if(!o.storeReady){o.storeReady=function(m){o.on("storeReady",m)};o.on("storeReady",function(){o.storeReady=function(m){m()};o.detach("storeReady")})}if(window[s])window[s]._ke||o.fire("storeReady");else{var p=o.Config.base+o.Utils.debugUrl("plugins/localstorage/swfstore.swf?rand="+ +new Date);window[s]=new o.FlashBridge({movie:p,methods:["setItem","removeItem","getValueOf"]});g.mix(window[s],{_ke:1,getItem:function(m){return this.getValueOf(m)}});
window[s].on("contentReady",function(){o.fire("storeReady")})}});KISSY.Editor.add("maximize",function(g){var o=KISSY,s=o.Editor;o.UA.gecko<1.92||g.ready(function(){var p=g.addButton("maximize",{title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize",loading:true});s.use("maximize/support",function(){p.reload(s.Maximize)})})});
KISSY.Editor.add("maximize/support",function(){var g=KISSY.Editor,o=KISSY,s=o.UA,p=o.Node,m=o.Event,q=o.DOM,n;q.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");var k={};o.mix(k,{onClick:function(){var l=this,b=l.editor;l._resize&&m.remove(window,"resize",l._resize);l.call("_saveEditorStatus");l.call("_restoreState");l.btn.boff();setTimeout(function(){l.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("restoreWindow")},30)},_restoreState:function(){var l=document,b=this.editor,
e=this._savedParents;if(e){for(var f=0;f<e.length;f++){var i=e[f];i.el.css("position",i.position)}this._savedParents=null}b.wrap.css({height:this.iframeHeight});q.css(l.body,{width:"",height:"",overflow:""});l.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:this.editorWrapWidth});n.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);l=this.btn.get("el");l.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");l.attr("title",
"\u5168\u5c4f");s.ie<8&&this.editor.toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var l=this.editor,b=[],e=l.editorWrap;this.iframeHeight=l.wrap._4e_style("height");this.editorWrapWidth=e._4e_style("width");this.scrollLeft=q.scrollLeft();this.scrollTop=q.scrollTop();window.scrollTo(0,0);for(l=e.parent();l;){e=l.css("position");if(e!="static"){b.push({el:l,position:e});l.css("position","static")}l=l.parent()}this._savedParents=b;b=this.btn.get("el");b.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
b.attr("title","\u53d6\u6d88\u5168\u5c4f");s.ie<8&&this.editor.toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var l=this.editor;this.savedRanges=null;if(s.gecko&&l.iframeFocus)this.savedRanges=(l=l.getSelection())&&l.getRanges()},_restoreEditorStatus:function(){var l=this.editor,b=l.getSelection(),e=this.savedRanges;l.activateGecko();e&&b&&b.selectRanges(e);if(l.iframeFocus&&b)(l=b.getStartElement())&&l[0]&&l._4e_scrollIntoView();s.ie<8&&this.btn.get("el").one("span").css("background-image",
"")},_maximize:function(l){var b=document,e=this.editor,f=e.editorWrap,i=q.viewportHeight(),u=q.viewportWidth(),h=e.statusDiv?e.statusDiv[0].offsetHeight:0,c=e.toolBarDiv[0].offsetHeight;if(s.ie)b.body.style.overflow="hidden";else q.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";f.css({position:"absolute",zIndex:e.baseZIndex(g.zIndexManager.MAXIMIZE),width:u+"px"});n.css({zIndex:e.baseZIndex(g.zIndexManager.MAXIMIZE-5),height:i+"px",width:u+"px"});f.offset({left:0,
top:0});n.css({left:0,top:0});e.wrap.css({height:i-h-c+"px"});l!==true&&arguments.callee.call(this,true)},_real:function(){var l=this,b=l.editor;l.call("_saveEditorStatus");l.call("_saveSate");l.call("_maximize");l._resize=l._resize||g.Utils.buffer(l.cfg._maximize,l,100);m.on(window,"resize",l._resize);l.btn.bon();setTimeout(function(){l.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("maximizeWindow")},30)},offClick:function(){n||(n=(new p("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(document.body));
this.call("_real")}});g.Maximize=k});
KISSY.Editor.add("music",function(g){var o=KISSY.Editor,s=g.htmlDataProcessor,p=s&&s.dataFilter;g.ready(function(){p&&p.addRules({elements:{object:function(m){var q=m.attributes;if(!(q.classid&&String(q.classid).toLowerCase())){for(q=0;q<m.children.length;q++)if(m.children[q].name=="embed"){if(!o.Utils.isFlashEmbed(m.children[q]))break;if(m.children[q].attributes.src.indexOf("niftyplayer.swf")!=-1)return s.createFakeParserElement(m,"ke_music","music",true)}return null}for(q=0;q<m.children.length;q++){var n=
m.children[q];if(n.name=="param"&&n.attributes.name=="movie")if(n.attributes.value.indexOf("niftyplayer.swf")!=-1)return s.createFakeParserElement(m,"ke_music","music",true)}},embed:function(m){if(!o.Utils.isFlashEmbed(m))return null;if(m.attributes.src.indexOf("niftyplayer.swf")!=-1)return s.createFakeParserElement(m,"ke_music","music",true)}}},4);o.use("music/support",function(){new o.MusicInserter(g)})})});
KISSY.Editor.add("music/support",function(){function g(e){g.superclass.constructor.apply(this,arguments);e.cfg.disableObjectResizing||m.on(e.document.body,n.ie?"resizestart":"resize",function(f){(new s.Node(f.target)).hasClass(k)&&f.preventDefault()})}function o(e){return e._4e_name()==="img"&&!!e.hasClass(k)&&e}var s=KISSY,p=s.Editor,m=s.Event,q=p.Flash,n=s.UA,k="ke_music",l=["img."+k];s.extend(g,q,{_config:function(){this._cls=k;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";
this._contextMenu=b;this._flashRules=l}});q.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",o);p.MusicInserter=g;var b={"\u97f3\u4e50\u5c5e\u6027":function(e){var f=e.editor.getSelection();(f=(f=f&&f.getStartElement())&&o(f))&&e.show(null,f)}}});
KISSY.add("overlay",function(g){g.Overlay=g.UIBase.create([g.UIBase.Box,g.UIBase.ContentBox,g.UIBase.Position,g.UIBase.Loading,g.UA.ie==6?g.UIBase.Shim:null,g.UIBase.Align,g.UIBase.Mask],{initializer:function(){g.log("Overlay init")},renderUI:function(){g.log("_renderUIOverlay");this.get("el").addClass("ks-overlay")},syncUI:function(){g.log("_syncUIOverlay")},bindUI:function(){g.log("_bindUIOverlay")},destructor:function(){g.log("overlay destructor")}})},{requires:["core"]});
KISSY.add("dialog",function(g){g.Dialog=g.UIBase.create(g.Overlay,[g.UIBase.StdMod,g.UIBase.Close,g.UIBase.Drag,g.UIBase.Constrain],{initializer:function(){g.log("dialog init")},renderUI:function(){g.log("_renderUIDialog");this.get("el").addClass("ks-dialog");this.set("handlers",[this.get("header")])},bindUI:function(){g.log("_bindUIDialog")},syncUI:function(){g.log("_syncUIDialog")},destructor:function(){g.log("Dialog destructor")}})},{host:"overlay"});
KISSY.Editor.add("ext-focus",function(){function g(){o.log("FocusExt init")}var o=KISSY,s=o.UA,p=o.Editor,m=p.focusManager;p.namespace("UIBase");g.ATTRS={focus4e:{value:true}};g.prototype={_uiSetFocus4e:function(q){if(q){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){o.log("_syncUIFocusExt")},__renderUI:function(){o.log("_renderUIFocusExt")},__bindUI:function(){this._focus4e=
(new o.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var q=this._focusEditor=m.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(s.ie&&q){var n=q.document.selection.createRange();if(n)if(n.item&&n.item(0).ownerDocument==q.document){q=document.body.createTextRange();q.moveToElementText(this.get("el")._4e_first()[0]);q.collapse(true);
q.select()}}},_hide4FocusExt:function(){var q=this._focusEditor;q&&q.focus()}};p.UIBase.Focus=g},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var g=KISSY,o=g.Editor;if(!o.Overlay){var s=g.UIBase.create(g.Overlay,[o.UIBase.Focus],{init:function(){g.log("Overlay4E init")},syncUI:function(){g.log("_syncUIOverlay4E");o.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:o.baseZIndex(o.zIndexManager.OVERLAY)}}}),p=g.UIBase.create(g.Dialog,[o.UIBase.Focus],{show:function(){this.center();var q=this.get("y");if(q-g.DOM.scrollTop()>200){q=g.DOM.scrollTop()+200;this.set("y",q)}p.superclass.show.call(this)}},
{ATTRS:{constrain:{value:true},zIndex:{value:o.baseZIndex(o.zIndexManager.OVERLAY)}}});o.Overlay=s;o.Dialog=p;var m;o.Overlay.loading=function(){m||(m=new o.Overlay({x:0,focus4e:false,width:g.UA.ie==6?g.DOM.docWidth():"100%",y:0,zIndex:o.baseZIndex(o.zIndexManager.LOADING),elCls:"ke-global-loading"}));m.set("height",g.DOM.docHeight());m.show();m.loading()};o.Overlay.unloading=function(){m&&m.hide()}}});
KISSY.Editor.add("pagebreak",function(g){var o=KISSY,s=o.Editor,p=o.Node,m=g.htmlDataProcessor;(o=m&&m.dataFilter)&&o.addRules({elements:{div:function(q){var n=q.attributes;var k=(n=n&&n.style)&&q.children.length==1&&q.children[0];if((k=k&&k.name=="span"&&k.attributes.style)&&/page-break-after\s*:\s*always/i.test(n)&&/display\s*:\s*none/i.test(k))return m.createFakeParserElement(q,"ke_pagebreak","div")}}});g.ready(function(){g.addButton("page-break",{title:"\u5206\u9875",mode:s.WYSIWYG_MODE,contentCls:"ke-toolbar-pagebreak",
offClick:function(){var q=this.editor,n=new p('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,q.document);n=q.createFakeElement?q.createFakeElement(n,"ke_pagebreak","div",true,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'):n;n=(new p("<div>",null,q.document)).append(n);q.insertElement(n)}})})});
KISSY.Editor.add("preview",function(g){g.ready(function(){g.addButton("preview",{title:"\u9884\u89c8",contentCls:"ke-toolbar-preview",offClick:function(){var o=this.editor,s=640,p=420,m=80;try{var q=window.screen;s=Math.round(q.width*0.8);p=Math.round(q.height*0.7);m=Math.round(q.width*0.1)}catch(n){}o=o._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+o.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");s=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+
s+",height="+p+",left="+m);p=s.document;p.open();p.write(o);p.close();s.focus()}})})});
KISSY.Editor.add("progressbar",function(){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var o=KISSY,s=o.Editor;if(!s.ProgressBar){var p=o.Node;o.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
g.ATTRS={container:{},width:{},height:{},progress:{value:0}};o.extend(g,o.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var m=this.get("height"),q=new p("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+m+";'></div>"),n=this.get("container");m=(new p("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(m)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(q);var k=(new p("<span class='ke-progressbar-title'>")).appendTo(q);
n&&q.appendTo(n);this.el=q;this._title=k;this._p=m;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(m){m=m.newVal;this._p.css("width",m+"%");this._title.html(m+"%")}});s.ProgressBar=g}});
KISSY.Editor.add("removeformat",function(g){function o(l,b){for(var e=0;e<b.length;e++)l.removeAttr(b[e])}var s=KISSY.Editor,p=s.RANGE,m=s.ElementPath,q=s.NODE,n="class,style,lang,width,height,align,hspace,valign".split(/,/),k=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");g.ready(function(){g.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:s.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var l=
this.editor;k.lastIndex=0;var b=l.getSelection().getRanges();l.fire("save");for(var e=0,f;f=b[e];e++)if(!f.collapsed){f.enlarge(p.ENLARGE_ELEMENT);var i=f.createBookmark(),u=i.startNode,h=i.endNode,c=function(d){for(var j=new m(d),t=j.elements,y=1,w;w=t[y];y++){if(w._4e_equals(j.block)||w._4e_equals(j.blockLimit))break;k.test(w._4e_name())&&d._4e_breakParent(w)}};c(u);c(h);for(u=u._4e_nextSourceNode(true,q.NODE_ELEMENT);u;){if(u._4e_equals(h))break;c=u._4e_nextSourceNode(false,q.NODE_ELEMENT);u._4e_name()==
"img"&&u.attr("_ke_realelement")||(k.test(u._4e_name())?u._4e_remove(true):o(u,n));u=c}f.moveToBookmark(i)}l.getSelection().selectRanges(b);l.fire("save")}})})});
KISSY.Editor.add("resize",function(g){var o=KISSY,s=o.Node,p=o.Draggable;g.ready(function(){var m=g.statusDiv,q=new s("<div class='ke-resizer'>"),n=g.cfg.pluginConfig.resize||{};n=n.direction||["x","y"];q.appendTo(m);g.on("maximizeWindow",function(){q.css("display","none")});g.on("restoreWindow",function(){q.css("display","")});m=new p({node:q});var k=0,l=0,b=g.wrap,e=g.editorWrap;m.on("dragstart",function(){k=b.height();l=e.width()});m.on("drag",function(f){var i=f.pageX-this.startMousePos.left;
f=f.pageY-this.startMousePos.top;o.inArray("y",n)&&b.height(k+f);o.inArray("x",n)&&e.width(l+i)})})});
KISSY.Editor.add("select",function(){function g(k){g.superclass.constructor.call(this,k);this._init()}var o=KISSY,s=o.Node,p=o.Event,m=o.DOM,q=o.Editor;if(!q.Select){g.DISABLED=0;g.ENABLED=1;var n=q.XHTML_DTD;g.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var k=this.el.parent();k;){var l=k._4e_name();if(n[l]&&n[l].div)return k;k=k.parent()}return new s(document.body)}},state:{value:1}};g.decorate=
function(k){for(var l=k.width(),b=[],e=k.all("option"),f=0;f<e.length;f++){var i=e[f];b.push({name:m.html(i),value:m.attr(i,"value")})}return new g({width:l+"px",el:k,items:b,cls:"ke-combox",value:k.val()})};o.extend(g,o.Base,{_init:function(){var k=this.get("container"),l=this.get("el"),b=new s("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
e=this.get("title")||"",f=this.get("cls"),i=b.one(".ke-select-text"),u=b.one(".ke-select-text-inner");b.one(".ke-select-drop");this.get("value")!==undefined?u.html(this._findNameByV(this.get("value"))):u.html(e);i.css("width",this.get("width"));b._4e_unselectable();e&&b.attr("title",e);f&&b.addClass(f);if(l)l[0].parentNode.replaceChild(b[0],l[0]);else k&&b.appendTo(k);b.on("click",this._click,this);this.el=b;this.title=u;this._focusA=b.one("a.ke-select");q.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(k){var l=this.get("title")||"",b=this.get("items");if(this.get("showValue"))return k||l;for(var e=0;e<b.length;e++){var f=b[e];if(f.value==k){l=f.name;break}}return l},_valueChange:function(k){this.title.html(this._findNameByV(k.newVal))},_itemsChange:function(k){k=k.newVal;var l=this._selectList;l.html("");if(k)for(var b=0;b<k.length;b++){var e=k[b];(new s("<a class='ke-select-menu-item' href='#' data-value='"+
e.value+"'>"+e.name+"</a>",e.attrs)).appendTo(l)._4e_unselectable()}this.as=l.all("a")},val:function(k){if(k!==undefined){this.set("value",k);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var k=this,l=k.el,b=k.get("popUpWidth"),e=k._focusA,f=new q.Overlay({autoRender:true,render:k.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:b?b:l.width(),zIndex:q.baseZIndex(q.zIndexManager.SELECT),focusMgr:false}),
i=k.get("items");b=f.get("contentEl").one("div");k.menu=f;p.on(window,"resize",k._resize,k);k.get("title")&&(new s("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+k.get("title")+"</div>")).appendTo(b);k._selectList=(new s("<div>")).appendTo(b);k._itemsChange({newVal:i});f.on("show",function(){e.addClass("ke-select-active")});f.on("hide",function(){e.removeClass("ke-select-active")});p.on([document,k.get("doc")],"click",function(u){l.contains(u.target)||f.hide()});b.on("click",
k._select,k);k.as=k._selectList.all("a");p.on(b[0],"mouseenter",function(){k.as.removeClass("ke-menu-selected")});k.on("afterItemsChange",k._itemsChange,k);k.menuNode=b},_stateChange:function(k){var l=this.el;k.newVal==1?l.removeClass("ke-select-disabled"):l.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(k){k.halt();var l=this.menu,b=this.menuNode;if(k=(new s(k.target))._4e_ascendant(function(i){return b.contains(i)&&
i._4e_name()=="a"},true)){var e=this.get("value"),f=k.attr("data-value");this.set("value",f);this.fire("click",{newVal:f,prevVal:e,name:k.html()});l.hide()}},_real:function(){var k=this.el,l=k.offset(),b=o.clone(l),e=this.menu.get("el").height(),f=this.menu.get("el").width(),i=m.scrollTop(),u=m.scrollLeft(),h=m.viewportHeight(),c=m.viewportWidth();c=u+c-60;h=i+h;var d=l.top+(k.height()-2);k=l.left+k.width()-2;var j=this.get("align"),t=j[0];if(j[1]=="b"){l.top=d;if(l.top+e>h&&b.top-i>h-d)l.top=b.top-
e}else{l.top=b.top-e;if(l.top<i&&b.top-i<h-d)l.top=d}if(t=="l"){if(l.left+f>c&&k-u>c-b.left)l.left=k-f}else{l.left=k-f;if(l.left<u&&k-u<c-b.left)l.left=b.left}this.menu.set("xy",[l.left,l.top]);this.menu.show()},_click:function(k){k.preventDefault();k=this.el;var l=this.get("value");if(!k.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();l&&this.menu&&this.as.each(function(b){b.attr("data-value")==l?b.addClass("ke-menu-selected"):b.removeClass("ke-menu-selected")})}}});
q.Select=g}});KISSY.Editor.add("separator",function(g){g.ready(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(g.toolBarDiv)})});KISSY.Editor.add("smiley",function(g){var o=KISSY.Editor;g.ready(function(){var s=g.addButton("smiley",{contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",mode:o.WYSIWYG_MODE,loading:true});o.use("smiley/support",function(){s.reload(o.SmileySupport)})})});
KISSY.Editor.add("smiley/support",function(){var g=KISSY,o=g.Event,s=g.Editor,p=g.DOM;p.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");var m;s.SmileySupport={_selectSmiley:function(q){q.halt();
var n=this.editor;q=new g.Node(q.target);var k;if(q._4e_name()=="a"&&(k=q.attr("data-icon"))){k=new g.Node("<img class='ke_smiley'alt='' src='"+k+"'/>",null,n.document);n.insertElement(k);this.smileyWin.hide()}},_hidePanel:function(q){var n=this.btn.get("el");q=new g.Node(q.target);var k=this.smileyWin;n._4e_equals(q)||n.contains(q)||k.hide()},_show:function(){var q=this.smileyWin;q&&q.get("visible")?q.hide():this.call("_prepare")},_prepare:function(){var q=this.cfg,n=this.btn,k=this.editor,l;if(!m){m=
"<div class='ke-smiley-sprite'>";for(l=0;l<=98;l++)m+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+l+".gif'></a>";m+="</div>"}l=m;l=this.smileyWin=new s.Overlay({content:l,focus4e:false,width:"297px",autoRender:true,elCls:"ks-popup",zIndex:k.baseZIndex(s.zIndexManager.POPUP_MENU),mask:false});this.smileyPanel=l.get("contentEl");l.on("show",n.bon,n);l.on("hide",n.boff,n);this.smileyPanel.on("click",q._selectSmiley,this);o.on(document,"click",q._hidePanel,this);o.on(k.document,
"click",q._hidePanel,this);this.cfg._prepare=this.cfg._real;this.call("_real")},_real:function(){var q=this.btn.get("el"),n=q.offset();n.top+=q.height()+5;if(n.left+this.smileyPanel.width()>p.viewportWidth()-60)n.left=p.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[n.left,n.top]);this.smileyWin.show()},offClick:function(){this.call("_prepare")},onClick:function(){this.call("_prepare")}}});
KISSY.Editor.add("sourcearea",function(g){var o=KISSY.Editor;KISSY.UA.gecko<1.92||g.ready(function(){var s=o.SOURCE_MODE,p=o.WYSIWYG_MODE;g.addButton("sourcearea",{title:"\u6e90\u7801",contentCls:"ke-toolbar-source",init:function(){var m=this.btn,q=this.editor;q.on("wysiwygmode",m.boff,m);q.on("sourcemode",m.bon,m)},offClick:function(){this.editor.execCommand("sourceAreaSupport",s)},onClick:function(){this.editor.execCommand("sourceAreaSupport",p)}})})});
KISSY.Editor.add("sourcearea/support",function(g){var o=KISSY,s=o.Editor,p=o.UA;s.SourceAreaSupport||function(){function m(){var k=this.mapper={};k[q]=this._show;k[n]=this._hide}var q=s.SOURCE_MODE,n=s.WYSIWYG_MODE;o.augment(m,{exec:function(k,l){var b=this.mapper;b[l]&&b[l].call(this,k)},_show:function(k){k.textarea.val(k.getData(true));this._showSource(k);k.fire("sourcemode")},_showSource:function(k){var l=k.textarea,b=k.iframe;l.css("display","");b.css("display","none");p.ie<8&&l.css("height",
k.wrap.css("height"));l[0].focus()},_hideSource:function(k){var l=k.textarea;k.iframe.css("display","");l.css("display","none")},_hide:function(k){var l=k.textarea;this._hideSource(k);k.fire("save");k.setData(l.val());k.fire("wysiwygmode");k.fire("save");p.gecko&&k.activateGecko()}});s.SourceAreaSupport=new m}();g.addCommand("sourceAreaSupport",s.SourceAreaSupport)});
KISSY.Editor.add("table",function(g){var o=KISSY,s=o.Editor,p=o.trim,m=(o.UA.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border"),q=g.htmlDataProcessor;
o=q&&q.dataFilter;q=q&&q.htmlFilter;o&&o.addRules({elements:{table:function(n){n=n.attributes;var k=n["class"],l=parseInt(n.border,10);if(!l||l<=0)n["class"]=(k||"")+" ke_show_border"}}});q&&q.addRules({elements:{table:function(n){n=n.attributes;var k=n["class"];if(k)n["class"]=p(k.replace("ke_show_border","").replace(/\s{2}/," "))}}});g.ready(function(){var n=g.addButton("table",{contentCls:"ke-toolbar-table",mode:s.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c",loading:true});s.use("table/support",function(){var k=
new s.TableUI(g);n.reload({offClick:function(){k._tableShow()}})});g.addCustomStyle(m)})});
KISSY.Editor.add("table/support",function(){function g(h){var c=this,d={},j;for(j in u)(function(t){d[t]=function(){h.fire("save");u[t](c);h.fire("save")}})(j);e.ContextMenu.register({editor:h,rules:f,width:"120px",funcs:d});c.editor=h}function o(h){function c(z){if(!(t.length>0))if(z[0].nodeType==KEN.NODE_ELEMENT&&i.test(z._4e_name())&&!z.data("selected_cell")){z._4e_setMarker(y,"selected_cell",true);t.push(z)}}for(var d=h.createBookmarks(),j=h.getRanges(),t=[],y={},w=0;w<j.length;w++){var v=j[w];
if(v.collapsed){v=v.getCommonAncestor();(v=v._4e_ascendant("td",true)||v._4e_ascendant("th",true))&&t.push(v)}else{v=new Walker(v);var r;for(v.guard=c;r=v.next();)if((r=r.parent())&&i.test(r._4e_name())&&!r.data("selected_cell")){r._4e_setMarker(y,"selected_cell",true);t.push(r)}}}e.Utils.clearAllMarkers(y);h.selectBookmarks(d);return t}function s(h,c){var d=h.getStartElement()._4e_ascendant("tr");if(d){var j=d._4e_clone(true);j.insertBefore(d);d=(c?j[0]:d[0]).cells;for(j=0;j<d.length;j++){d[j].innerHTML=
"";l.ie||(new b(d[j]))._4e_appendBogus()}}}function p(h){if(h instanceof e.Selection){var c=o(h),d=c.length;h=[];for(var j,t,y=0;y<d;y++){var w=c[y].parent(),v=w[0].rowIndex;!y&&(j=v-1);h[v]=w;y==d-1&&(t=v+1)}y=w._4e_ascendant("table");j=new b(t<y[0].rows.length&&y[0].rows[t]||j>0&&y[0].rows[j]||y[0].parentNode);for(y=h.length;y>=0;y--)h[y]&&p(h[y]);return j}else if(h instanceof b){y=h._4e_ascendant("table");y[0].rows.length==1?y._4e_remove():h._4e_remove()}return 0}function m(h,c){var d=h.getStartElement();
if(d=d._4e_ascendant("td",true)||d._4e_ascendant("th",true))for(var j=d._4e_ascendant("table"),t=d[0].cellIndex,y=0;y<j[0].rows.length;y++){var w=j[0].rows[y];if(!(w.cells.length<t+1)){d=new b(w.cells[t].cloneNode(false));l.ie||d._4e_appendBogus();w=new b(w.cells[t]);c?d.insertBefore(w):d.insertAfter(w)}}}function q(h){if(h instanceof e.Selection){var c=o(h),d,j=[];h=c[0]&&c[0]._4e_ascendant("table");var t,y,w;t=0;for(y=c.length;t<y;t++)j.push(c[t][0].cellIndex);j.sort();t=1;for(y=j.length;t<y;t++)if(j[t]-
j[t-1]>1){w=j[t-1]+1;break}w||(w=j[0]>0?j[0]-1:j[j.length-1]+1);j=h[0].rows;t=0;for(y=j.length;t<y;t++)if(d=j[t].cells[w])break;d=d?new b(d):h._4e_previous();for(w=c.length-1;w>=0;w--)c[w]&&q(c[w]);return d}else if(h instanceof b){c=h._4e_ascendant("table");if(!c)return null;d=h[0].cellIndex;for(w=c[0].rows.length-1;w>=0;w--){h=new b(c[0].rows[w]);if(!d&&h[0].cells.length==1)p(h);else h[0].cells[d]&&h[0].removeChild(h[0].cells[d])}}return null}function n(h,c){var d=new e.Range(h[0].ownerDocument);
if(!d.moveToElementEditablePosition(h,c?true:undefined)){d.selectNodeContents(h);d.collapse(c?false:true)}d.select(true)}var k=KISSY,l=k.UA,b=k.Node,e=k.Editor,f=["tr","th","td","tbody","table"];k.augment(g,{_tableShow:function(h,c,d){this.editor.useDialog("table/dialog",function(j){j.show(c,d)})}});var i=/^(?:td|th)$/,u={"\u8868\u683c\u5c5e\u6027":function(h){var c=h.editor.getSelection(),d=c&&c.getStartElement();if(c=d&&d._4e_ascendant("table",true)){d=d._4e_ascendant(function(j){j=j._4e_name();return j=="td"||j==
"th"},true);h._tableShow(null,c,d)}},"\u5220\u9664\u8868\u683c":function(h){var c=(h=h.editor.getSelection())&&h.getStartElement();if(c=c&&c._4e_ascendant("table",true)){h.selectElement(c);var d=h.getRanges()[0];d.collapse();h.selectRanges([d]);h=c.parent();h[0].childNodes.length==1&&h._4e_name()!="body"&&h._4e_name()!="td"?h._4e_remove():c._4e_remove()}},"\u5220\u9664\u884c ":function(h){h=h.editor.getSelection();n(p(h),undefined)},"\u5220\u9664\u5217 ":function(h){h=h.editor.getSelection();(h=q(h))&&n(h,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(h){h=h.editor.getSelection();
s(h,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(h){h=h.editor.getSelection();s(h,undefined)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(h){h=h.editor.getSelection();m(h,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(h){h=h.editor.getSelection();m(h,undefined)}};e.TableUI=g});
KISSY.Editor.add("tabs",function(){function g(q){this.cfg=q;this._init()}var o=KISSY,s=o.Editor,p=o.DOM,m=o.Node;if(!s.Tabs){o.augment(g,o.EventTarget,{_init:function(){var q=this,n=q.cfg,k=n.tabs,l=n.contents.children("div"),b=k.children("li");k.on("click",function(e){e=new m(e.target);if(e=e._4e_ascendant(function(i){return i._4e_name()==="li"&&k.contains(i)},true)){b.removeClass("ke-tab-selected");var f=e.attr("rel");e.addClass("ke-tab-selected");l.hide();p.show(l[o.indexOf(e[0],b)]);q.fire(f)}})},
getTab:function(q){var n=this.cfg,k=n.tabs;n=n.contents.children("div");k=k.children("li");for(var l=0;l<k.length;l++){var b=new m(k[l]),e=new m(n[l]);if(o.isNumber(q)&&q==l||o.isString(q)&&q==b.attr("rel"))return{tab:b,content:e}}},remove:function(q){q=this.getTab(q);q.tab.remove();q.content.remove()},_getActivate:function(){var q=this.cfg,n=q.tabs;q.contents.children("div");q=n.children("li");for(n=0;n<q.length;n++){var k=new m(q[n]);if(k.hasClass("ke-tab-selected"))return k.attr("rel")}},activate:function(q){if(arguments.length==
0)return this._getActivate();var n=this.cfg,k=n.tabs;n=n.contents.children("div");k.children("li").removeClass("ke-tab-selected");n.hide();k=this.getTab(q);k.tab.addClass("ke-tab-selected");k.content.show()}});s.Tabs=g}});
KISSY.Editor.add("templates",function(g){var o=KISSY,s=o.Editor,p=o.Node,m=s.Dialog;o.DOM.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");g.ready(function(){g.addButton("templates",
{contentCls:"ke-toolbar-template",title:"\u6a21\u677f",mode:s.WYSIWYG_MODE,offClick:function(){this.cfg._prepare.call(this)},_prepare:function(){for(var q=this.editor,n=q.cfg.pluginConfig.templates||[],k="<div class='ke-tpl'>",l=0;l<n.length;l++)k+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+n[l].demo+"</a>";k+="</div>";var b=new m({width:500,mask:true,autoRender:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:k});b.get("el").all(".ke-tpl-list").on("click",function(e){e.halt();e=(new p(e.target))._4e_index();
e!=-1&&q.insertHtml(n[e].html);b.hide()});this.ui=b;this.cfg.show.call(this);this.cfg._prepare=this.cfg.show},show:function(){this.ui.show()}})})});
KISSY.add("uibase",function(g){function o(k){m.apply(this,arguments);for(var l=this.constructor;l;){if(k&&k[p]&&l.HTML_PARSER)if(k[p]=g.one(k[p])){var b=k[p],e=l.HTML_PARSER,f=void 0,i=void 0;for(f in e)if(e.hasOwnProperty(f)){i=e[f];if(g.isFunction(i))this.__set(f,i.call(this,b));else if(g.isString(i))this.__set(f,b.one(i));else g.isArray(i)&&i[0]&&this.__set(f,b.all(i[0]))}}l=l.superclass&&l.superclass.constructor}s(this,"initializer","constructor");k&&k.autoRender&&this.render()}function s(k,l,
b){for(var e=k.constructor,f=[],i,u,h;e;){h=[];if(u=e.__ks_exts)for(var c=0;c<u.length;c++)if(i=u[c]){if(b!="constructor")i=u[c].prototype[b];i&&h.push(i)}if(i=e.prototype[l])h.push(i);h.length&&f.push.apply(f,h.reverse());e=e.superclass&&e.superclass.constructor}for(c=f.length-1;c>=0;c--)f[c]&&f[c].call(k)}var p="srcNode",m=g.Base,q=g.Attribute.__capitalFirst,n=function(){};o.HTML_PARSER={};o.ATTRS={render:{valueFn:function(){return document.body}},rendered:{value:false}};g.extend(o,m,{render:function(){if(!this.get("rendered")){this._renderUI();
this.fire("renderUI");s(this,"renderUI","__renderUI");this._bindUI();this.fire("bindUI");s(this,"bindUI","__bindUI");this._syncUI();this.fire("syncUI");s(this,"syncUI","__syncUI");this.set("rendered",true)}},_renderUI:n,renderUI:n,_bindUI:function(){var k=this,l=k.__getDefAttrs(),b,e;for(b in l)if(l.hasOwnProperty(b)){e="_uiSet"+q(b);k[e]&&function(f,i){k.on("after"+q(f)+"Change",function(u){k[i](u.newVal,u)})}(b,e)}},bindUI:n,_syncUI:function(){var k=this.__getDefAttrs(),l;for(l in k)if(k.hasOwnProperty(l)){var b=
"_uiSet"+q(l);this[b]&&this[b](this.get(l))}},syncUI:n,destroy:function(){for(var k=this.constructor,l,b,e;k;){(b=k.prototype.destructor)&&b.apply(this);if(l=k.__ks_exts)for(e=l.length-1;e>=0;e--)(b=l[e]&&l[e].prototype.__destructor)&&b.apply(this);k=k.superclass&&k.superclass.constructor}this.fire("destroy");this.detach()}});o.create=function(k,l,b,e){function f(){o.apply(this,arguments)}if(g.isArray(k)){e=b;b=l;l=k;k=o}k=k||o;g.extend(f,k,b,e);if(l){f.__ks_exts=l;g.each(l,function(i){if(i){g.each(["ATTRS",
"HTML_PARSER"],function(u){if(i[u]){f[u]=f[u]||{};g.mix(f[u],i[u],false)}});g.augment(f,i,false)}})}return f};g.UIBase=o});
KISSY.add("uibase-align",function(g){function o(){}function s(m,q){var n=q.charAt(0),k=q.charAt(1),l,b,e,f;if(m){m=g.one(m);l=m.offset();b=m[0].offsetWidth;e=m[0].offsetHeight}else{l={left:p.scrollLeft(),top:p.scrollTop()};b=p.viewportWidth();e=p.viewportHeight()}f=l.left;l=l.top;if(n==="c")l+=e/2;else if(n==="b")l+=e;if(k==="c")f+=b/2;else if(k==="r")f+=b;return{left:f,top:l}}var p=g.DOM;g.mix(o,{TL:"tl",TC:"tc",TR:"tr",CL:"cl",CC:"cc",CR:"cr",BL:"bl",BC:"bc",BR:"br"});o.ATTRS={align:{}};o.prototype=
{_uiSetAlign:function(m){g.isPlainObject(m)&&this.align(m.node,m.points,m.offset)},align:function(m,q,n){var k,l=this.get("el");n=n||[0,0];k=p.offset(l);m=s(m,q[0]);q=s(l,q[1]);q=[q.left-m.left,q.top-m.top];this.set("xy",[k.left-q[0]+ +n[0],k.top-q[1]+ +n[1]])},center:function(m){this.set("align",{node:m,points:[o.CC,o.CC],offset:[0,0]})}};g.UIBase.Align=o});
KISSY.add("uibase-box",function(g){function o(){g.log("box init")}g.namespace("UIBase");var s=g.Node;g.mix(o,{APPEND:1,INSERT:0});o.ATTRS={el:{setter:function(p){if(g.isString(p))return g.one(p)}},elCls:{},elStyle:{},width:{},height:{},elTagName:{value:"div"},elAttrs:{},elOrder:{value:1},html:{value:false}};o.HTML_PARSER={el:function(p){return p}};o.prototype={__syncUI:function(){g.log("_syncUIBoxExt")},__bindUI:function(){g.log("_bindUIBoxExt")},__renderUI:function(){g.log("_renderUIBoxExt");var p=
this.get("render"),m=this.get("el");p=new s(p);if(!m){m=new s("<"+this.get("elTagName")+">");this.get("elOrder")?p.append(m):p.prepend(m);this.set("el",m)}},_uiSetElAttrs:function(p){g.log("_uiSetElAttrs");p&&this.get("el").attr(p)},_uiSetElCls:function(p){p&&this.get("el").addClass(p)},_uiSetElStyle:function(p){g.log("_uiSetElStyle");p&&this.get("el").css(p)},_uiSetWidth:function(p){g.log("_uiSetWidth");p&&this.get("el").width(p)},_uiSetHeight:function(p){g.log("_uiSetHeight");p&&this.get("el").height(p)},
_uiSetHtml:function(p){g.log("_uiSetHtml");p!==false&&this.get("el").html(p)},__destructor:function(){g.log("box __destructor");var p=this.get("el");if(p){p.detach();p.remove()}}};g.UIBase.Box=o});
KISSY.add("uibase-close",function(g){function o(){g.log("close init")}g.namespace("UIBase");var s=g.Node;o.ATTRS={closable:{value:true},closeBtn:{}};o.HTML_PARSER={closeBtn:".ks-ext-close"};o.prototype={__syncUI:function(){g.log("_syncUICloseExt")},_uiSetClosable:function(p){g.log("_uiSetClosable");var m=this.get("closeBtn");if(m)p?m.show():m.hide()},__renderUI:function(){g.log("_renderUICloseExt");var p=this.get("closeBtn"),m=this.get("contentEl");if(!p&&m){p=(new s("<a href='#' class='ks-ext-close'><span class='ks-ext-close-x'>X</span></a>")).appendTo(m);
this.set("closeBtn",p)}},__bindUI:function(){g.log("_bindUICloseExt");var p=this,m=p.get("closeBtn");m&&m.on("click",function(q){p.hide();q.halt()})},__destructor:function(){g.log("close-ext __destructor");var p=this.get("closeBtn");p&&p.detach()}};g.UIBase.Close=o});
KISSY.add("uibase-constrain",function(g){function o(){g.log("constrain init")}function s(m){var q;if(!m)return q;var n=this.get("el");if(m!==true){m=g.one(m);q=m.offset();g.mix(q,{maxLeft:q.left+m[0].offsetWidth-n[0].offsetWidth,maxTop:q.top+m[0].offsetHeight-n[0].offsetHeight})}else{m=document.documentElement.clientWidth;q={left:p.scrollLeft(),top:p.scrollTop()};g.mix(q,{maxLeft:q.left+m-n[0].offsetWidth,maxTop:q.top+p.viewportHeight()-n[0].offsetHeight})}return q}g.namespace("UIBase");var p=g.DOM;
o.ATTRS={constrain:{value:false}};o.prototype={__bindUI:function(){g.log("_bindUIConstrain")},__renderUI:function(){g.log("_renderUIConstrain");var m=this,q=m.__getDefAttrs(),n=q.x;q=q.y;var k=n.setter,l=q.setter;n.setter=function(b){var e=k&&k(b);if(e===undefined)e=b;if(!m.get("constrain"))return e;b=s.call(m,m.get("constrain"));return Math.min(Math.max(e,b.left),b.maxLeft)};q.setter=function(b){var e=l&&l(b);if(e===undefined)e=b;if(!m.get("constrain"))return e;b=s.call(m,m.get("constrain"));return Math.min(Math.max(e,
b.top),b.maxTop)};m.addAttr("x",n);m.addAttr("y",q)},__syncUI:function(){g.log("_syncUIConstrain")},__destructor:function(){g.log("constrain-ext __destructor")}};g.UIBase.Constrain=o});
KISSY.add("uibase-contentbox",function(g){function o(){g.log("contentbox init")}g.namespace("UIBase");var s=g.Node;o.ATTRS={contentEl:{},contentElAttrs:{},contentTagName:{value:"div"},content:{}};o.HTML_PARSER={contentEl:".ks-contentbox"};o.prototype={__syncUI:function(){g.log("_syncUIContentBox")},__bindUI:function(){g.log("_bindUIContentBox")},__renderUI:function(){g.log("_renderUIContentBox");var p=this.get("contentEl"),m=this.get("el");if(!p){p=(new s("<"+this.get("contentTagName")+" class='ks-contentbox'>")).appendTo(m);
this.set("contentEl",p)}},_uiSetContentElAttrs:function(p){g.log("_uiSetContentElAttrs");p&&this.get("contentEl").attr(p)},_uiSetContent:function(p){g.log("_uiSetContent");p!==undefined&&this.get("contentEl").html(p)},__destructor:function(){g.log("contentbox __destructor")}};g.UIBase.ContentBox=o});
KISSY.add("uibase-drag",function(g){function o(){g.log("drag init")}g.namespace("UIBase");o.ATTRS={handlers:{value:[]},draggable:{value:true}};o.prototype={_uiSetHandlers:function(s){g.log("_uiSetHanlders");s&&s.length>0&&this.__drag.set("handlers",s)},__syncUI:function(){g.log("_syncUIDragExt")},__renderUI:function(){g.log("_renderUIDragExt")},__bindUI:function(){g.log("_bindUIDragExt");var s=this.get("el");this.__drag=new g.Draggable({node:s,handlers:this.get("handlers")})},_uiSetDraggable:function(s){g.log("_uiSetDraggable");
var p=this.__drag;if(s){p.detach("drag");p.on("drag",this._dragExtAction,this)}else p.detach("drag")},_dragExtAction:function(s){this.set("xy",[s.left,s.top])},__destructor:function(){g.log("DragExt __destructor");var s=this.__drag;s&&s.destroy()}};g.UIBase.Drag=o});
KISSY.add("uibase-loading",function(g){function o(){g.log("LoadingExt init")}g.namespace("UIBase");o.prototype={loading:function(){if(!this._loadingExtEl)this._loadingExtEl=(new g.Node("<div class='ks-ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'>")).appendTo(this.get("el"));this._loadingExtEl.show()},unloading:function(){var s=this._loadingExtEl;s&&s.hide()}};g.UIBase.Loading=o});
KISSY.add("uibase-mask",function(g){function o(){g.log("mask init")}g.namespace("UIBase");var s,p=g.UA,m=0;o.ATTRS={mask:{value:false}};o.prototype={__bindUI:function(){g.log("_bindUIMask")},__renderUI:function(){g.log("_renderUIMask")},__syncUI:function(){g.log("_syncUIMask")},_uiSetMask:function(q){g.log("_uiSetMask");if(q){this.on("show",this._maskExtShow);this.on("hide",this._maskExtHide)}else{this.detach("show",this._maskExtShow);this.detach("hide",this._maskExtHide)}},_maskExtShow:function(){if(!s){s=
(new g.Node("<div class='ks-ext-mask'>")).prependTo(document.body);s.css({position:"absolute",left:0,top:0,width:p.ie6?g.DOM.docWidth():"100%",height:g.DOM.docHeight()});p.ie==6&&s.append("<iframe style='width:100%;height:expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'>")}s.css({"z-index":this.get("zIndex")-1});m++;s.show()},_maskExtHide:function(){m--;if(m<=0)m=0;m||s&&s.hide()},__destructor:function(){g.log("mask __destructor")}};g.UIBase.Mask=o});
KISSY.add("uibase-position",function(g){function o(){g.log("position init")}g.namespace("UIBase");var s=document,p=g.Event;o.ATTRS={x:{},y:{},xy:{setter:function(m){var q=g.makeArray(m);if(q.length){q[0]&&this.set("x",q[0]);q[1]&&this.set("y",q[1])}return m}},zIndex:{value:9999},visible:{value:undefined}};o.prototype={__syncUI:function(){g.log("_syncUIPosition")},__renderUI:function(){g.log("_renderUIPosition");var m=this.get("el");m.addClass("ks-ext-position");m.css("display","")},__bindUI:function(){g.log("_bindUIPosition")},
_uiSetZIndex:function(m){g.log("_uiSetZIndex");m!==undefined&&this.get("el").css("z-index",m)},_uiSetX:function(m){g.log("_uiSetX");m!==undefined&&this.get("el").offset({left:m})},_uiSetY:function(m){g.log("_uiSetY");m!==undefined&&this.get("el").offset({top:m})},_uiSetVisible:function(m){if(m!==undefined){g.log("_uiSetVisible");this.get("el").css("visibility",m?"visible":"hidden");this[m?"_bindKey":"_unbindKey"]();this.fire(m?"show":"hide")}},_bindKey:function(){p.on(s,"keydown",this._esc,this)},
_unbindKey:function(){p.remove(s,"keydown",this._esc,this)},_esc:function(m){m.keyCode===27&&this.hide()},move:function(m,q){if(g.isArray(m)){q=m[1];m=m[0]}this.set("xy",[m,q])},show:function(){this._firstShow()},_firstShow:function(){this.render();this._realShow();this._firstShow=this._realShow},_realShow:function(){this.set("visible",true)},hide:function(){this.set("visible",false)},__destructor:function(){g.log("position __destructor")}};g.UIBase.Position=o});
KISSY.add("uibase-shim",function(g){function o(){g.log("shim init")}g.namespace("UIBase");var s=g.Node;o.prototype={__syncUI:function(){g.log("_syncUIShimExt")},__bindUI:function(){g.log("_bindUIShimExt")},__renderUI:function(){g.log("_renderUIShimExt");var p=this.get("el"),m=new s("<iframe style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth);top: 0;opacity: 0;filter: alpha(opacity=0);left: 0;z-index: -1;height: expression(this.parentNode.offsetHeight);'>");p.prepend(m)},
__destructor:function(){g.log("shim __destructor")}};g.UIBase.Shim=o});
KISSY.add("uibase-stdmod",function(g){function o(){g.log("stdmod init")}g.namespace("UIBase");var s=g.Node;o.ATTRS={header:{},body:{},footer:{},bodyStyle:{},headerContent:{value:false},bodyContent:{value:false},footerContent:{value:false}};o.HTML_PARSER={header:".ks-stdmod-header",body:".ks-stdmod-body",footer:".ks-stdmod-footer"};o.prototype={__bindUI:function(){g.log("_bindUIStdMod")},__syncUI:function(){g.log("_syncUIStdMod")},_setStdModContent:function(p,m){if(m!==false)if(g.isString(m))this.get(p).html(m);
else{this.get(p).html("");this.get(p).append(m)}},_uiSetBodyStyle:function(p){p!==undefined&&this.get("body").css(p)},_uiSetBodyContent:function(p){g.log("_uiSetBodyContent");this._setStdModContent("body",p)},_uiSetHeaderContent:function(p){g.log("_uiSetHeaderContent");this._setStdModContent("header",p)},_uiSetFooterContent:function(p){g.log("_uiSetFooterContent");this._setStdModContent("footer",p)},__renderUI:function(){g.log("_renderUIStdMod");var p=this.get("contentEl"),m=this.get("header"),q=
this.get("body"),n=this.get("footer");this.get("headerContent");this.get("bodyContent");this.get("footerContent");if(!m){m=(new s("<div class='ks-stdmod-header'>")).appendTo(p);this.set("header",m)}if(!q){q=(new s("<div class='ks-stdmod-body'>")).appendTo(p);this.set("body",q)}if(!n){n=(new s("<div class='ks-stdmod-footer'>")).appendTo(p);this.set("footer",n)}},__destructor:function(){g.log("stdmod __destructor")}};g.UIBase.StdMod=o});KISSY.Editor.add("uibase",function(){});
KISSY.Editor.add("undo",function(g){var o=KISSY,s=o.Editor,p=s.Utils.arrayCompare,m=o.UA,q=o.Event;s.UndoManager||function(){function n(e){var f=e._getRawData(),i;if(f)i=e.getSelection();this.contents=f;this.bookmarks=i&&i.createBookmarks2(true)}function k(e){this.history=[];this.index=-1;this.editor=e;this.bufferRunner=s.Utils.buffer(this.save,this,500);this._init()}o.augment(n,{equals:function(e){if(this.contents!=e.contents)return false;var f=this.bookmarks;e=e.bookmarks;if(f||e){if(!f||!e||f.length!=
e.length)return false;for(var i=0;i<f.length;i++){var u=f[i],h=e[i];if(u.startOffset!=h.startOffset||u.endOffset!=h.endOffset||!p(u.start,h.start)||!p(u.end,h.end))return false}}return true}});var l={16:1,17:1,18:1},b={37:1,38:1,39:1,40:1,33:1,34:1};o.augment(k,{_keyMonitor:function(){var e=this.editor;q.on([e.document,e.textarea],"keydown",function(f){var i=f.keyCode;if(!(i in b||i in l))if(i===90&&(f.ctrlKey||f.metaKey)){e.fire("restore",{d:-1});f.halt()}else if(i===89&&(f.ctrlKey||f.metaKey)){e.fire("restore",
{d:1});f.halt()}else e.fire("save",{buffer:1})})},_init:function(){var e=this,f=e.editor;f.on("save",function(i){if(f.getMode()==s.WYSIWYG_MODE)i.buffer?e.bufferRunner():e.save()});f.on("restore",function(i){f.getMode()==s.WYSIWYG_MODE&&e.restore(i)});e._keyMonitor()},save:function(){var e=this.history,f=this.index;e.length>f+1&&e.splice(f+1,e.length-f-1);var i=this.editor;f=e[e.length-1];var u=new n(i);if(!f||!f.equals(u)){e.length===30&&e.shift();e.push(u);this.index=f=e.length-1;i.fire("afterSave",
{history:e,index:f})}},restore:function(e){e=e.d;var f=this.history,i=this.editor,u=f[this.index+e];if(u){i._setRawData(u.contents);if(u.bookmarks)i.getSelection().selectBookmarks(u.bookmarks);else if(m.ie){u=i.document.body.createTextRange();u.collapse(true);u.select()}(u=i.getSelection())&&u.scrollIntoView();this.index+=e;i.fire("afterRestore",{history:f,index:this.index});i.notifySelectionChange()}}});s.UndoManager=k}();g.ready(function(){new s.UndoManager(g);var n={redo:1,undo:-1},k={mode:s.WYSIWYG_MODE,
init:function(){this.editor.on("afterSave afterRestore",this.cfg._respond,this);this.btn.disable()},offClick:function(){this.editor.fire("restore",{d:n[this.cfg.flag]})}},l=o.mix({title:"\u64a4\u9500",flag:"undo",contentCls:"ke-toolbar-undo",_respond:function(b){var e=this.btn;b.index>0?e.boff():e.disable()}},k,false);k=o.mix({title:"\u91cd\u505a",flag:"redo",contentCls:"ke-toolbar-redo",_respond:function(b){var e=this.btn;b.index<b.history.length-1?e.boff():e.disable()}},k,false);g.addButton("undo",l);g.addButton("undo",
k)})});
