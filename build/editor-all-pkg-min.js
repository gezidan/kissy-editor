/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-15 15:11:30
*/
KISSY.add("editor",function(l,p){function r(s,h){function a(x){for(var o=r.Env.mods,y=0;y<x.length;y++){for(var w=x[y],A=m,E=0;E<y;E++)if(w==x[E]){A=q;break}E=o[w];if(A&&E){A=l.clone(E);w=w+"_"+y;A.name=w;x[y]=w;o[w]||(o[w]=A)}}}var c=this;if(!(c instanceof r))return new r(s,h);if(l.isString(s))s=l.one(s);s=u._4e_wrap(s);h=h||{};h.pluginConfig=h.pluginConfig||{};c.cfg=h;h.pluginConfig=h.pluginConfig;c.cfg=h;l.app(c,l.EventTarget);var f=["htmldataprocessor","enterkey","clipboard"],k=m;c.use=function(x,
o){x=x.split(",");a(x);if(!k)for(var y=0;y<f.length;y++){var w=f[y];l.inArray(w,x)||x.unshift(w)}c.ready(function(){l.use.call(c,x.join(","),function(){o&&o.call(c);if(!k){c.setData(s.val());if(h.focus)c.focus();else{var A=c.getSelection();A&&A.removeAllRanges()}c.fire("save");k=q}},{order:q,global:r})});return c};c.use=c.use;c.init(s);return c}function v(s){var h=l.Config.debug;s=h?h==="dev"?"../src/"+s:s:s.replace(/\.(js|css)/i,"-min.$1");s+=s.indexOf("?")!=-1?"&":"?";s+="t="+encodeURIComponent("2010-12-15 15:11:30");
return s}var u=l.DOM,q=true,m=false;l.app(r,l.EventTarget);r.Config.base=l.Config.base+"editor/";var j=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],i,b,d,e,g={};i=0;for(b=j.length;i<b;i++){d=j[i];if(l.isString(d))d=j[i]={name:d+"",requires:null};e=d.requires||[];d.requires=e.concat(["button"])}j=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar","overlay",{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",
requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(j);i=0;for(b=j.length;i<b;i++){d=j[i];e=d.name||d;g[e]={attach:m,charset:"utf-8",requires:d.requires,csspath:d.useCss?v("plugins/"+e+"/plugin.css"):p,path:v("plugins/"+e+"/plugin.js")}}r.add(g);l.Editor=r;l.Editor=r});
KISSY.Editor.add("utils",function(l){var p=null,r=KISSY,v=r.Node,u=r.DOM,q=r.UA,m=r.Event,j;j=q.ie?document.documentMode||q.ie:void 0;var i={debugUrl:function(b){var d=r.Config.debug;b=d?d==="dev"?"../src/"+b:b:b.replace(/\.(js|css)/i,"-min.$1");b+=b.indexOf("?")!=-1?"&":"?";b+="t="+encodeURIComponent("2010-12-15 15:11:30");return b},lazyRun:function(b,d,e){var g=b[d],s=b[e];b[d]=function(){g.apply(this,arguments);b[d]=b[e];return s.apply(this,arguments)}},getXY:function(b,d,e,g){e=e.defaultView||
e.parentWindow;b-=u.scrollLeft(e);d-=u.scrollTop(e);if(g)if(e!=(g.defaultView||g.parentWindow)&&e.frameElement){g=u._4e_getOffset(e.frameElement,g);b+=g.left;d+=g.top}return{left:b,top:d}},tryThese:function(){for(var b,d=0,e=arguments.length;d<e;d++){var g=arguments[d];try{b=g();break}catch(s){}}return b},arrayCompare:function(b,d){if(!b&&!d)return true;if(!b||!d||b.length!=d.length)return false;for(var e=0;e<b.length;e++)if(b[e]!==d[e])return false;return true},getByAddress:function(b,d,e){b=b.documentElement;
for(var g=0;b&&g<d.length;g++){var s=d[g];if(e)for(var h=-1,a=0;a<b.childNodes.length;a++){var c=b.childNodes[a];if(!(e===true&&c.nodeType==3&&c.previousSibling&&c.previousSibling.nodeType==3)){h++;if(h==s){b=c;break}}}else b=b.childNodes[s]}return b?new v(b):p},clearAllMarkers:function(b){for(var d in b)b[d]._4e_clearMarkers(b,true)},htmlEncodeAttr:function(b){return b.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(b){return b.replace(/^\s+/,"")},rtrim:function(b){return b.replace(/\s+$/,
"")},trim:function(b){return this.ltrim(this.rtrim(b))},mix:function(){for(var b={},d=0;d<arguments.length;d++)b=r.mix(b,arguments[d]);return b},isCustomDomain:function(){if(!q.ie)return false;var b=document.domain,d=window.location.hostname;return b!=d&&b!="["+d+"]"},duplicateStr:function(b,d){return Array(d+1).join(b)},throttle:function(b,d,e){e=e||150;if(e===-1)return function(){b.apply(d,arguments)};var g=(new Date).getTime();return function(){var s=(new Date).getTime();if(s-g>e){g=s;b.apply(d,
arguments)}}},buffer:function(b,d,e){e=e||0;var g=p;return function(){g&&clearTimeout(g);var s=arguments;g=setTimeout(function(){return b.apply(d,s)},e)}},isNumber:function(b){return/^\d+(.\d+)?$/.test(r.trim(b))},verifyInputs:function(b){for(var d=0;d<b.length;d++){var e=u._4e_wrap(b[d]),g=r.trim(e.val()),s=e.attr("data-verify");e=e.attr("data-warning");if(s&&!RegExp(s).test(g)){alert(e);return false}}return true},sourceDisable:function(b,d){b.on("sourcemode",d.disable,d);b.on("wysiwygmode",d.enable,
d)},resetInput:function(b){var d=b.attr("placeholder");if(d&&!q.webkit){b.addClass("ke-input-tip");b.val(d)}else q.webkit&&b.val("")},valInput:function(b,d){b.removeClass("ke-input-tip");b.val(d)},placeholder:function(b,d){b.attr("placeholder",d);if(!q.webkit){b.on("blur",function(){if(!r.trim(b.val())){b.addClass("ke-input-tip");b.val(d)}});b.on("focus",function(){b.removeClass("ke-input-tip");r.trim(b.val())==d&&b.val("")})}},clean:function(b){b=b[0]||b;for(var d=r.makeArray(b.childNodes),e=0;e<
d.length;e++){var g=d[e];g.nodeType==l.NODE.NODE_TEXT&&!r.trim(g.nodeValue)&&b.removeChild(g)}},htmlEncode:function(b){return!b?b:String(b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(b){return!b?b:String(b).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(b,d){return b.toLowerCase()==d.toLowerCase()},normParams:function(b){b=r.clone(b);for(var d in b)if(b.hasOwnProperty(d)){var e=
b[d];if(r.isFunction(e))b[d]=e()}return b},doFormUpload:function(b,d,e){function g(){var x={responseText:"",responseXML:p};x.argument=b?b.argument:p;try{var o;if((o=q.ie?h.contentWindow.document:h.contentDocument||window.frames[s].document)&&o.body)x.responseText=o.body.innerHTML;x.responseXML=o&&o.XMLDocument?o.XMLDocument:o}catch(y){r.log(y)}m.remove(h,"load",g);b.callback&&b.callback(x);setTimeout(function(){u._4e_remove(h)},100)}var s=r.guid("form-upload-"),h=document.createElement("iframe");
h.id=s;h.name=s;h.className="ke-hidden";var a="document.open();"+(i.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(q.ie)h.src=q.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";r.log("doFormUpload : "+h.src);document.body.appendChild(h);if(q.ie)document.frames[s].name=s;a=u._4e_unwrap(b.form);var c={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=s;a.method="POST";a.enctype=a.encoding="multipart/form-data";
if(e)a.action=e;var f;if(d){f=[];d=l.Utils.normParams(d);for(var k in d)if(d.hasOwnProperty(k)){e=document.createElement("input");e.type="hidden";e.name=k;e.value=d[k];a.appendChild(e);f.push(e)}}m.on(h,"load",g);a.submit();a.target=c.target;a.method=c.method;a.enctype=c.enctype;a.encoding=c.encoding;a.action=c.action;if(f){d=0;for(k=f.length;d<k;d++)u._4e_remove(f[d])}return h},extern:function(b,d){for(var e in d)b[e]=d[e]},map:function(b,d){for(var e=0;e<b.length;e++)b[e]=d(b[e]);return b},ieEngine:j,
preventFocus:function(b){q.ie?b._4e_unselectable():b.attr("onmousedown","return false;")},isFlashEmbed:function(b){b=b.attributes;return b.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(b.src||"")}};l.Utils=i;l.Utils=i;q.ieEngine=i.ieEngine;i.extern(i,{debugUrl:i.debugUrl,lazyRun:i.lazyRun,getXY:i.getXY,tryThese:i.tryThese,arrayCompare:i.arrayCompare,getByAddress:i.getByAddress,clearAllMarkers:i.clearAllMarkers,htmlEncodeAttr:i.htmlEncodeAttr,ltrim:i.ltrim,rtrim:i.rtrim,trim:i.trim,
mix:i.mix,isCustomDomain:i.isCustomDomain,duplicateStr:i.duplicateStr,buffer:i.buffer,isNumber:i.isNumber,verifyInputs:i.verifyInputs,sourceDisable:i.sourceDisable,resetInput:i.resetInput,placeholder:i.placeholder,clean:i.clean,htmlEncode:i.htmlEncode,htmlDecode:i.htmlDecode,equalsIgnoreCase:i.equalsIgnoreCase,normParams:i.normParams,throttle:i.throttle,doFormUpload:i.doFormUpload,map:i.map})});
KISSY.Editor.add("dom",function(l){function p(a){return a.replace(/-(\w)/g,function(c,f){return f.toUpperCase()})}var r=KISSY,v=r.DOM,u=r.UA,q=r.Node,m=l.Utils,j={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};l.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};l.NODE=l.NODE;l.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};l.POSITION=l.POSITION;var i=l.NODE,b=l.POSITION,d={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},e={hr:1},g=function(a){return a[0]||a},s=function(a){if(a&&!a[0])return new q(a);return a},h={_4e_wrap:s,_4e_unwrap:g,_4e_equals:function(a,c){if(!a&&!c)return true;if(!a||!c)return false;a=g(a);c=g(c);
return a===c},_4e_isBlockBoundary:function(a,c){a=s(a);var f=r.mix(r.mix({},e),c||{});return d[a.css("display")]||f[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=g(a);for(var c=a.parentNode.childNodes,f=0;f<c.length;f++)if(c[f]===a)return f;return-1},_4e_first:function(a,c){a=g(a);var f=a.firstChild;if((f=f&&new q(f))&&c&&!c(f))f=f._4e_next(c);return f},_4e_move:function(a,c,f){a=g(a);v._4e_remove(a);
c=g(c);f?c.insertBefore(a,c.firstChild):c.appendChild(a)},_4e_name:function(a){a=g(a);var c=a.nodeName.toLowerCase();if(u.ie)if((a=a.scopeName)&&a!="HTML")c=a.toLowerCase()+":"+c;return c},_4e_isIdentical:function(a,c){if(a._4e_name()!=c._4e_name())return false;var f=a[0].attributes,k=c[0].attributes,x=f.length,o=k.length;if(x!=o)return false;for(var y=0;y<x;y++){var w=f[y],A=w.name;if(w.specified&&a.attr(A)!=c.attr(A))return false}if(m.ieEngine<8)for(y=0;y<o;y++){w=k[y];A=w.name;if(w.specified&&
a.attr(A)!=c.attr(A))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=g(a).childNodes;for(var c=0,f=a.length;c<f;c++){var k=a[c],x=k.nodeType;if(!(x==i.NODE_ELEMENT&&k.getAttribute("_ke_bookmark")))if(x==i.NODE_ELEMENT&&!h._4e_isEmptyInlineRemoveable(k)||x==i.NODE_TEXT&&r.trim(k.nodeValue))return false}return true},_4e_moveChildren:function(a,c,f){a=g(a);c=c[0]||c;if(a!=c)if(f)for(;f=a.lastChild;)c.insertBefore(a.removeChild(f),c.firstChild);else for(;f=a.firstChild;)c.appendChild(a.removeChild(f))},
_4e_mergeSiblings:function(){function a(c,f,k){if(f[0]&&f[0].nodeType==i.NODE_ELEMENT){for(var x=[];f.attr("_ke_bookmark")||f._4e_isEmptyInlineRemoveable();){x.push(f);f=k?new q(f[0].nextSibling):new q(f[0].previousSibling);if(!f[0]||f[0].nodeType!=i.NODE_ELEMENT)return}if(c._4e_isIdentical(f)){for(var o=k?c[0].lastChild:c[0].firstChild;x.length;)x.shift()._4e_move(c,!k);f._4e_moveChildren(c,!k);f._4e_remove();o[0]&&o[0].nodeType==i.NODE_ELEMENT&&o._4e_mergeSiblings()}}}return function(c){if(c[0])if(j[c._4e_name()]||
c._4e_name()=="a"){a(c,new q(c[0].nextSibling),true);a(c,new q(c[0].previousSibling))}}}(),_4e_unselectable:u.gecko?function(a){a=g(a);a.style.MozUserSelect="none"}:u.webkit?function(a){a=g(a);a.style.KhtmlUserSelect="none"}:function(a){a=g(a);if(u.ie||u.opera){var c=0;a.setAttribute("unselectable","on");for(var f=a.getElementsByTagName("*");a=f[c++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},_4e_getOffset:function(a,
c){a=g(a);var f,k=0;f=0;var x=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,o=a.ownerDocument,y=o.documentElement;c=c||o;if(a.getBoundingClientRect){if(a!==o.body&&y!==a){f=a.getBoundingClientRect();k=f.left+(c===o?v.scrollLeft(x):0);f=f.top+(c===o?v.scrollTop(x):0)}if(c)if(x!=(c.defaultView||c.parentWindow)&&x.frameElement){x=h._4e_getOffset(x.frameElement,c);k+=x.left;f+=x.top}}return{left:k,top:f}},_4e_getFrameDocument:function(a){return(a=g(a))&&a.contentWindow.document},_4e_splitText:function(a,
c){a=g(a);var f=a.ownerDocument;if(!(!a||a.nodeType!=i.NODE_TEXT)){if(u.ie&&c==a.nodeValue.length){var k=f.createTextNode("");v.insertAfter(k,a);return new q(k)}k=new q(a.splitText(c));if(f.documentMode){f=f.createTextNode("");v.insertAfter(f,k[0]);v._4e_remove(f)}return k}},_4e_parents:function(a,c){a=s(a);var f=[];do f[c?"push":"unshift"](a);while(a=a.parent());return f},_4e_clone:function(a,c,f){a=g(a);a=a.cloneNode(c);if(!f){var k=function(x){if(x.nodeType==i.NODE_ELEMENT){x.removeAttribute("id");
x=x.childNodes;for(var o=0;o<x.length;o++)k(x[o])}};k(a)}return new q(a)},_4e_nextSourceNode:function(a,c,f,k){a=g(a);if(k&&!k.call){var x=k[0]||k;k=function(y){y=y[0]||y;return y!==x}}c=!c&&a.firstChild;var o=new q(a);if(!c){if(a.nodeType==i.NODE_ELEMENT&&k&&k(a,true)===false)return null;c=a.nextSibling}for(;!c&&(o=o.parent());){if(k&&k(o,true)===false)return null;c=o[0].nextSibling}if(!c)return null;c=v._4e_wrap(c);if(k&&k(c)===false)return null;if(f&&f!=c[0].nodeType)return c._4e_nextSourceNode(false,
f,k);return c},_4e_previousSourceNode:function(a,c,f,k){a=g(a);if(k&&!k.call){var x=k[0]||k;k=function(y){y=y[0]||y;return y!==x}}c=!c&&a.lastChild;var o=new q(a);if(!c){if(a.nodeType==i.NODE_ELEMENT&&k&&k(a,true)===false)return null;c=a.previousSibling}for(;!c&&(o=o.parent());){if(k&&k(o,true)===false)return null;c=o[0].previousSibling}if(!c)return null;c=v._4e_wrap(c);if(k&&k(c)===false)return null;if(f&&c[0].nodeType!=f)return c._4e_previousSourceNode(false,f,k);return c},_4e_commonAncestor:function(a,
c){if(a._4e_equals(c))return a;if(c[0].nodeType!=i.NODE_TEXT&&c.contains(a))return c;var f=a[0].nodeType==i.NODE_TEXT?a.parent():a;do if(f[0].nodeType!=i.NODE_TEXT&&f.contains(c))return f;while(f=f.parent());return null},_4e_ascendant:function(a,c,f){a=g(a);if(!f)a=a.parentNode;if(c&&!r.isFunction(c)){var k=c;c=function(x){return x._4e_name()==k}}for(;a&&a.nodeType!=9;){if(!c||c(new q(a))===true)return new q(a);a=a.parentNode}return null},_4e_hasAttribute:m.ieEngine<9?function(a,c){a=g(a);var f=a.attributes[c];
return!!(f&&f.specified)}:function(a,c){a=g(a);return a.hasAttribute(c)},_4e_hasAttributes:m.ieEngine<9?function(a){a=g(a);for(var c=a.attributes,f=0;f<c.length;f++){var k=c[f];switch(k.name){case "class":if(a.getAttribute("class"))return true;break;default:if(k.specified)return true}}return false}:function(a){a=g(a);u.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},_4e_position:function(a,c){var f=g(a),k=g(c);if(f.compareDocumentPosition)return f.compareDocumentPosition(k);if(f==
k)return b.POSITION_IDENTICAL;if(f.nodeType==i.NODE_ELEMENT&&k.nodeType==i.NODE_ELEMENT){if(f.contains){if(f.contains(k))return b.POSITION_CONTAINS+b.POSITION_PRECEDING;if(k.contains(f))return b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING}if("sourceIndex"in f)return f.sourceIndex<0||k.sourceIndex<0?b.POSITION_DISCONNECTED:f.sourceIndex<k.sourceIndex?b.POSITION_PRECEDING:b.POSITION_FOLLOWING}f=a._4e_address();k=c._4e_address();for(var x=Math.min(f.length,k.length),o=0;o<=x-1;o++)if(f[o]!=k[o]){if(o<
x)return f[o]<k[o]?b.POSITION_PRECEDING:b.POSITION_FOLLOWING;break}return f.length<k.length?b.POSITION_CONTAINS+b.POSITION_PRECEDING:b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING},_4e_address:function(a,c){a=g(a);for(var f=[],k=a.ownerDocument.documentElement,x=a;x&&x!=k;){var o=x.parentNode,y=-1;if(o){for(var w=0;w<o.childNodes.length;w++){var A=o.childNodes[w];if(!(c&&A.nodeType==3&&A.previousSibling&&A.previousSibling.nodeType==3)){y++;if(A==x)break}}f.unshift(y)}x=o}return f},_4e_breakParent:function(a,
c){var f=new l.Range(a[0].ownerDocument);f.setStartAfter(a);f.setEndAfter(c);var k=f.extractContents();f.insertNode(a._4e_remove());a[0].parentNode.insertBefore(k,a[0].nextSibling)},_4e_style:function(a,c,f){a=s(a);if(f!==undefined)return a.css(c,f);a=g(a);return a.style[p(c)]},_4e_remove:function(a,c){var f=g(a),k=f.parentNode;if(k){if(c)for(var x;x=f.firstChild;)k.insertBefore(f.removeChild(x),f);k.removeChild(f)}return a},_4e_trim:function(a){v._4e_ltrim(a);v._4e_rtrim(a)},_4e_ltrim:function(a){a=
g(a);for(var c;c=a.firstChild;){if(c.nodeType==i.NODE_TEXT){var f=m.ltrim(c.nodeValue),k=c.nodeValue.length;if(f){if(f.length<k){(new q(c))._4e_splitText(k-f.length);a.removeChild(a.firstChild)}}else{a.removeChild(c);continue}}break}},_4e_rtrim:function(a){a=g(a);for(var c;c=a.lastChild;){if(c.type==i.NODE_TEXT){var f=m.rtrim(c.nodeValue),k=c.nodeValue.length;if(f){if(f.length<k){(new q(c))._4e_splitText(f.length);a.removeChild(a.lastChild)}}else{a.removeChild(c);continue}}break}if(!u.ie&&!u.opera)(c=
a.lastChild)&&c.nodeType==1&&c.nodeName.toLowerCase()=="br"&&c.parentNode.removeChild(c)},_4e_appendBogus:function(a){a=g(a);for(var c=a.lastChild;c&&c.nodeType==i.NODE_TEXT&&!r.trim(c.nodeValue);)c=c.previousSibling;if(!c||c.nodeType==i.NODE_TEXT||v._4e_name(c)!=="br"){c=u.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");u.gecko&&c.setAttribute("type","_moz");a.appendChild(c)}},_4e_previous:function(a,c){var f=g(a),k;do k=(f=f.previousSibling)&&new q(f);while(k&&c&&!c(k));
return k},_4e_last:function(a,c){a=v._4e_wrap(a);var f=a[0].lastChild;if((f=f&&new q(f))&&c&&!c(f))f=f._4e_previous(c);return f},_4e_next:function(a,c){var f=g(a),k;do k=(f=f.nextSibling)&&new q(f);while(k&&c&&!c(k));return k},_4e_outerHtml:function(a){a=g(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var c=a.ownerDocument.createElement("div");c.appendChild(a.cloneNode(true));return c.innerHTML},_4e_setMarker:function(a,c,f,k){a=v._4e_wrap(a);var x=a.data("list_marker_id")||a.data("list_marker_id",
r.guid()).data("list_marker_id"),o=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");c[x]=a;o[f]=1;return a.data(f,k)},_4e_clearMarkers:function(a,c,f){a=s(a);var k=a.data("list_marker_names"),x=a.data("list_marker_id"),o;for(o in k)a.removeData(o);a.removeData("list_marker_names");if(f){a.removeData("list_marker_id");delete c[x]}},_4e_copyAttributes:function(a,c,f){a=g(a);c=s(c);var k=a.attributes;f=f||{};for(var x=0;x<k.length;x++){var o=k[x],y=o.name.toLowerCase(),
w;if(!(y in f))if(y=="checked"&&(w=v.attr(a,y)))c.attr(y,w);else if(o.specified||u.ie&&o.value&&y=="value"){w=v.attr(a,y);if(w===null)w=o.nodeValue;c.attr(y,w)}}if(a.style.cssText!=="")c[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=v._4e_name(a);var c=l.XHTML_DTD;return(a=!c.$nonEditable[a]&&(c[a]||c.span))&&a["#"]},_4e_scrollIntoView:function(a){a=s(a);var c=a[0].ownerDocument,f=v.scrollLeft(c),k=v.scrollTop(c),x=a.offset(),o=x.left;x=x.top;if(v.viewportHeight(c)+k<x||x<k||v.viewportWidth(c)+
f<o||o<f)a.scrollIntoView(c)},_4e_getElementsByTagName:function(a,c,f){a=g(a);if(!u.ie&&f)c=f+":"+c;f=[];a=a.getElementsByTagName(c);for(c=0;c<a.length;c++)f.push(new q(a[c]));return f}};r.DOM._4e_inject=function(a){r.mix(v,a);for(var c in a)a.hasOwnProperty(c)&&function(f){q.prototype[f]=function(){var k=[].slice.call(arguments,0);k.unshift(this);return a[f].apply(null,k)}}(c)};m.extern(h,{_4e_wrap:h._4e_wrap,_4e_unwrap:h._4e_unwrap,_4e_equals:h._4e_equals,_4e_isBlockBoundary:h._4e_isBlockBoundary,
_4e_getWin:h._4e_getWin,_4e_index:h._4e_index,_4e_first:h._4e_first,_4e_move:h._4e_move,_4e_name:h._4e_name,_4e_isIdentical:h._4e_isIdentical,_4e_isEmptyInlineRemoveable:h._4e_isEmptyInlineRemoveable,_4e_moveChildren:h._4e_moveChildren,_4e_mergeSiblings:h._4e_mergeSiblings,_4e_unselectable:h._4e_unselectable,_4e_getOffset:h._4e_getOffset,_4e_getFrameDocument:h._4e_getFrameDocument,_4e_splitText:h._4e_splitText,_4e_parents:h._4e_parents,_4e_clone:h._4e_clone,_4e_nextSourceNode:h._4e_nextSourceNode,
_4e_previousSourceNode:h._4e_previousSourceNode,_4e_commonAncestor:h._4e_commonAncestor,_4e_ascendant:h._4e_ascendant,_4e_hasAttribute:h._4e_hasAttribute,_4e_hasAttributes:h._4e_hasAttributes,_4e_position:h._4e_position,_4e_address:h._4e_address,_4e_breakParent:h._4e_breakParent,_4e_style:h._4e_style,_4e_remove:h._4e_remove,_4e_trim:h._4e_trim,_4e_ltrim:h._4e_ltrim,_4e_rtrim:h._4e_rtrim,_4e_appendBogus:h._4e_appendBogus,_4e_last:h._4e_last,_4e_previous:h._4e_previous,_4e_next:h._4e_next,_4e_outerHtml:h._4e_outerHtml,
_4e_setMarker:h._4e_setMarker,_4e_clearMarkers:h._4e_clearMarkers,_4e_getUniqueId:h._4e_getUniqueId,_4e_copyAttributes:h._4e_copyAttributes,_4e_isEditable:h._4e_isEditable,_4e_scrollIntoView:h._4e_scrollIntoView,_4e_getElementsByTagName:h._4e_getElementsByTagName});v._4e_inject(h)});
KISSY.Editor.add("focusmanager",function(l){function p(){this.iframeFocus=b;j=this;v.log(this._UUID+" focus")}function r(){this.iframeFocus=d;j=e;v.log(this._UUID+" blur")}var v=KISSY,u=v.DOM,q=v.Event,m={},j,i={refreshAll:function(){for(var g in m){var s=m[g];s.document.designMode="off";s.document.designMode="on"}},currentInstance:function(){return j},getInstance:function(g){return m[g]},add:function(g){var s=u._4e_getWin(g.document);q.on(s,"focus",p,g);q.on(s,"blur",r,g)},register:function(g){m[g._UUID]=
g},remove:function(g){delete m[g._UUID];var s=u._4e_getWin(g.document);q.remove(s,"focus",p,g);q.remove(s,"blur",r,g)}},b=true,d=false,e=null;l.focusManager=i;l.focusManager=i;l.getInstances=function(){return m};l.getInstances=l.getInstances});
KISSY.Editor.add("definition",function(l){var p=true,r=false,v=l.Utils,u=document,q=KISSY,m=q.UA,j=q.DOM,i=q.Node,b=q.Event,d=l.focusManager,e=v.tryThese,g=v.debugUrl("theme/editor-iframe.css"),s=1,h="document.open();"+(v.isCustomDomain()?'document.domain="'+u.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(m.ie?"javascript:void(function(){"+encodeURIComponent(h)+"}())":"")+'"  tabIndex="'+(m.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";l.SOURCE_MODE=0;l.WYSIWYG_MODE=1;l.SOURCE_MODE=l.SOURCE_MODE;l.WYSIWYG_MODE=l.WYSIWYG_MODE;q.augment(l,{init:function(c){if(m.ie)j.addClass(u.body,"ke-ie"+m.ie);else if(m.gecko)j.addClass(u.body,"ke-gecko");else m.webkit&&j.addClass(u.body,"ke-webkit");var f=this,k=new i(a.replace(/\$\(tabIndex\)/,
c.attr("tabIndex")));f.editorWrap=k;f._UUID=s++;d.register(f);f.wrap=k.one(".ke-textarea-wrap");f.wrap=f.wrap;f.iframe=f.wrap.one("iframe");f.iframe=f.iframe;f.toolBarDiv=k.one(".ke-editor-tools");f.toolBarDiv=f.toolBarDiv;f.textarea=c;f.textarea=f.textarea;f.statusDiv=k.one(".ke-editor-status");f.statusDiv=f.statusDiv;v.preventFocus(f.toolBarDiv);f._commands={};f._dialogs={};var x=c._4e_style("width"),o=c._4e_style("height");if(x){k.css("width",x);c.css("width","100%")}f.textarea.css("display","none");
k.insertAfter(c);f.wrap[0].appendChild(c[0]);if(o){f.wrap.css("height",o);c.css("height","100%")}k=f.iframe;f.on("dataReady",function(){f._ready=p;l.fire("instanceCreated",{editor:f})});m.gecko?k.on("load",f._setUpIFrame,f):f._setUpIFrame();f.cfg.attachForm&&c[0].form&&f._attachForm()},_attachForm:function(){(new i(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(c,f){var k=this,x=l.Overlay;x.loading();k.use(c,function(){var o=k.getDialog(c);if(o){f(o);x.unloading()}else q.later(arguments.callee,
50,false,k)})},addDialog:function(c,f){this._dialogs[c]=f},getDialog:function(c){return this._dialogs[c]},addCommand:function(c,f){this._commands[c]=f},hasCommand:function(c){return this._commands[c]},execCommand:function(c){var f=this._commands[c],k=q.makeArray(arguments);k.shift();k.unshift(this);return f.exec.apply(f,k)},getMode:function(){return this.textarea.css("display")=="none"?l.WYSIWYG_MODE:l.SOURCE_MODE},getData:function(c){var f;f=this.getMode()==l.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)f=c?this.htmlDataProcessor.toHtml(f,"p"):this.htmlDataProcessor.toServer(f,"p");f=q.trim(f);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(f))f="";return f},setData:function(c){var f=c;if(this.htmlDataProcessor)f=this.htmlDataProcessor.toDataFormat(c,"p");this.document.body.innerHTML=f;this.getMode()!=l.WYSIWYG_MODE&&this.textarea.val(c)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(c){c=c||0;return c+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(c){this.document.body.innerHTML=c},_prepareIFrameHtml:function(c){var f=this.cfg,k=f.customLink,x="";if(k)for(var o=0;o<k.length;o++)x+='<link href="'+k[o]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+l.Config.base+g+"' rel='stylesheet'/><style>"+(f.customStyle||"")+"</style>"+x+"</head><body class='ke-editor'>&nbsp;"+(c?'<script id="ke_actscript" type="text/javascript">'+(v.isCustomDomain()?'document.domain="'+u.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+c+'");<\/script>':"")+"</body></html>"},getSelection:function(){return l.Selection.getSelection(this.document)},focus:function(){var c=this.document,f=j._4e_getWin(c);m.webkit&&f&&f.parent&&f.parent.focus();m.webkit&&f&&f.focus();c&&c.body.focus();this.notifySelectionChange()},blur:function(){j._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(c){var f=this.cfg,k=this.document;f.customStyle=f.customStyle||
"";f.customStyle+="\n"+c;f=k.createElement("style");k.getElementsByTagName("head")[0].appendChild(f);if(f.styleSheet)f.styleSheet.cssText=c;else f.appendChild(k.createTextNode(c))},addCustomLink:function(c){var f=this.cfg,k=this.document;f.customLink=f.customLink||[];f.customLink.push(c);f=k.createElement("link");f.rel="stylesheet";k.getElementsByTagName("head")[0].appendChild(f);f.href=c},removeCustomLink:function(c){for(var f=this.cfg,k=q.makeArray(this.document.getElementsByTagName("link")),x=
0;x<k.length;x++)k[x].href==c&&j._4e_remove(k[x]);f.customLink=f.customLink||[];f=f.customLink;c=q.indexOf(c,f);c!=-1&&f.splice(c,1)},_setUpIFrame:function(){function c(){y=o.document;f.document=y;k.detach();y.open("text/html","replace");y.write(x);y.close()}var f=this,k=f.iframe,x=f._prepareIFrameHtml(f._UUID),o=k[0].contentWindow,y;try{y=o.document}catch(w){k[0].src=k[0].src;if(m.ie<7){setTimeout(c,10);return}}c()},ready:function(c){this._ready?c():this.on("dataReady",c)},_monitor:function(){var c=
this;c._monitorId&&clearTimeout(c._monitorId);c._monitorId=setTimeout(function(){var f=c.getSelection();if(f&&!f.isInvalid){var k=f.getStartElement(),x=new l.ElementPath(k);if(!c.previousPath||!c.previousPath.compare(x)){c.previousPath=x;c.fire("selectionChange",{selection:f,path:x,element:k})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(c,f,k){var x=this;x.focus();setTimeout(function(){var o,y=c._4e_name(),w=l.XHTML_DTD,A=l.RANGE,E=l.NODE,
z=w.$block[y],n=x.getSelection(),t=n&&n.getRanges(),B,D,C,F;if(!t||t.length==0){var M=arguments,P=M.callee;setTimeout(function(){P.apply(x,M)},30)}else{x.fire("save");for(var L=t.length-1;L>=0;L--){B=t[L];B.deleteContents();o=!L&&c||c._4e_clone(p);f&&f(o);if(z)for(;(C=B.getCommonAncestor(r,p))&&(F=w[C._4e_name()])&&!(F&&F[y]);)if(C._4e_name()in w.span)B.splitElement(C);else if(B.checkStartOfBlock()&&B.checkEndOfBlock()){B.setStartBefore(C);B.collapse(p);C._4e_remove()}else B.splitBlock();B.insertNode(o);
D||(D=o)}if(D){y=D._4e_nextSourceNode(p);w=x.document;F=l.XHTML_DTD;if(F.$inline[o._4e_name()]){y=new i(w.createTextNode(" "));y.insertAfter(D)}else if(y){if(y._4e_name()=="br"&&F[y.parent()._4e_name()].p){F=new i("<p>&nbsp;</p>",null,w);y[0].parentNode.replaceChild(F[0],y[0]);y=F}}else{F=new i("<p>&nbsp;</p>",null,w);F.insertAfter(D);y=F}B.moveToPosition(D,A.POSITION_AFTER_END);y&&y[0].nodeType==E.NODE_ELEMENT&&B.moveToElementEditablePosition(y);n.selectRanges([B]);x.focus();o&&o._4e_scrollIntoView();
setTimeout(function(){x.fire("save")},10);k&&k(o)}}},0)},insertHtml:function(c){var f=this;if(f.htmlDataProcessor)c=f.htmlDataProcessor.toDataFormat(c);if(m.webkit){var k=j.create(c,null,f.document);k=k.nodeType==11?q.makeArray(k.childNodes):[k];for(var x=0;x<k.length;x++)f.insertElement(new i(k[x]))}else{f.focus();setTimeout(function(){var o=f.getSelection(),y=o&&o.getRanges();if(!y||y.length==0){var w=arguments,A=w.callee;setTimeout(function(){A.apply(f,w)},30)}else{f.fire("save");if(m.ie){o=o.getNative();
o.type=="Control"&&o.clear();o.createRange().pasteHTML(c)}else f.document.execCommand("inserthtml",r,c);setTimeout(function(){f.fire("save")},10)}},0)}}});l._initIFrame=function(c){function f(t){e(function(){o.designMode="on";setTimeout(function(){o.designMode="off";A.focus();if(!arguments.callee.retry)arguments.callee.retry=p},50)},function(){o.designMode="off";j.attr(A,"contentEditable",r);j.attr(A,"contentEditable",p);!t&&f(1)})}var k=d.getInstance(c);c=k.textarea[0];var x=k.iframe[0].contentWindow,
o=k.document,y=k.cfg,w=o.getElementById("ke_actscript");j._4e_remove(w);var A=o.body;if(m.ie){A.hideFocus=p;A.disabled=p;A.contentEditable=p;A.removeAttribute("disabled")}else setTimeout(function(){if(m.gecko||m.opera)A.contentEditable=p;else if(m.webkit)A.parentNode.contentEditable=p;else o.designMode="on"},0);if(m.webkit){b.on(o,"click",function(t){var B=new i(t.target);q.inArray(B._4e_name(),["input","select"])&&t.preventDefault()});b.on(o,"mouseup",function(t){var B=new i(t.target);q.inArray(B._4e_name(),
["input","textarea"])&&t.preventDefault()})}if(m.gecko||m.ie||m.opera){var E;E=new i(j.insertAfter((new i('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],c));E.on("focus",function(){k.focus()});k.activateGecko=function(){m.gecko&&k.iframeFocus&&E[0].focus()};k.on("destroy",function(){})}if(m.ie&&o.compatMode=="CSS1Compat"||m.gecko||m.opera){var z=new i(o.documentElement);z.on("mousedown",function(t){if((new i(t.target))[0]==z[0]){m.gecko&&f(r);E[0].focus()}})}b.on(x,
"focus",function(){if(m.gecko)f(r);else m.opera&&A.focus();k.notifySelectionChange()});m.gecko&&b.on(k.document,"mousedown",function(){k.iframeFocus||f(r)});if(m.ie){b.on(o,"keydown",function(t){if(t.keyCode in{8:1,46:1}){var B=k.getSelection(),D=B.getSelectedElement();if(D){k.fire("save");var C=B.getRanges()[0].createBookmark();D._4e_remove();B.selectBookmarks([C]);k.fire("save");t.preventDefault()}}});if(o.compatMode=="CSS1Compat"){var n={33:1,34:1};b.on(o,"keydown",function(t){t.keyCode in n&&
setTimeout(function(){k.getSelection().scrollIntoView()},0)})}}setTimeout(function(){m.ie&&setTimeout(function(){if(o){A.runtimeStyle.marginBottom="0px";A.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){k.fire("dataReady");var t=y.disableObjectResizing,B=y.disableInlineTableEditing;if(t||B)try{o.execCommand("enableObjectResizing",r,!t);o.execCommand("enableInlineTableEditing",r,!B)}catch(D){b.on(A,m.ie?"resizestart":"resize",function(C){var F=new i(C.target);if(t||F._4e_name()==="table"&&
B)C.preventDefault()})}},10);m.webkit&&b.on(o,"mousedown",function(t){t=new i(t.target);q.inArray(t._4e_name(),["img","hr","input","textarea","select"])&&k.getSelection().selectElement(t)});m.gecko&&b.on(o,"dragstart",function(t){var B=new i(t.target);B._4e_name()==="img"&&/ke_/.test(B[0].className)&&t.preventDefault()});d.add(k)};h=l.prototype;v.extern(h,{setData:h.setData,getData:h.getData,insertElement:h.insertElement,insertHtml:h.insertHtml,ready:h.ready,addCustomStyle:h.addCustomStyle,addCommand:h.addCommand,
hasCommand:h.hasCommand,execCommand:h.execCommand,useDialog:h.useDialog,addDialog:h.addDialog,getDialog:h.getDialog,getMode:h.getMode,sync:h.sync,baseZIndex:h.baseZIndex,getSelection:h.getSelection,focus:h.focus,blur:h.blur,notifySelectionChange:h.notifySelectionChange})});
KISSY.Editor.add("zindex",function(){var l=KISSY.Editor;if(!l.zIndexManager){l.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};l.baseZIndex=function(p){var r=p,v=l.getInstances(),u;for(u in v){if(!v.hasOwnProperty(u))return;r=Math.max(r,v[u].baseZIndex(p))}return r};l.baseZIndex=l.baseZIndex;l.zIndexManager=l.zIndexManager}});
KISSY.Editor.add("dtd",function(l){l.XHTML_DTD=function(){function p(y){for(var w=arguments.length-1;w>0;)KISSY.mix(y,arguments[w--]);return y}var r={isindex:1,fieldset:1},v={input:1,button:1,select:1,textarea:1,label:1},u=p({a:1},v),q=p({iframe:1},u),m={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},i=p({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),b=p({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),d=p({p:1},b);v=p({iframe:1},b,v);b={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=p({a:1},v),g={tr:1},s={"#":1},h=p({param:1},b),a=p({form:1},r,q,m,d),c={li:1},f={base:1,link:1,meta:1,title:1},k=p(f,{style:1,script:1}),x={head:1,body:1},o={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:p({html:1},x,f),$block:o,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:e,$body:p({script:1,style:1},o),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:x,head:k,style:s,body:a,base:{},link:{},meta:{},title:s,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:p(d,m),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:c,h1:e,h3:e,option:s,h2:e,form:p(r,q,m,d),select:{optgroup:1,option:1},font:e,ins:e,menu:c,abbr:e,label:e,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:s,tfoot:g,cite:e,li:a,input:{},iframe:a,strong:e,textarea:s,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:h,sup:e,dd:a,strike:e,area:{},dir:c,map:p({area:1,form:1,p:1},r,j,m),applet:h,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:p({legend:1},b),thead:g,ul:c,acronym:e,b:e,a:v,blockquote:a,caption:e,i:e,u:e,tbody:g,s:e,address:p(q,d),tt:e,legend:e,q:e,pre:p(i,u),p:e,em:e,dfn:e}}();l.XHTML_DTD=
l.XHTML_DTD});
KISSY.Editor.add("elementpath",function(l){function p(b){var d=q,e=q,g=[];for(b=b;b&&b[0];){if(b[0].nodeType==u.NODE_ELEMENT){if(!this.lastElement)this.lastElement=b;var s=b._4e_name();if(!e){if(!d&&m[s])d=b;if(j[s]){var h;if(h=!d){if(h=s=="div"){a:{h=b;h=h[0]||h;h=h.childNodes;for(var a=0,c=h.length;a<c;a++){var f=h[a];if(f.nodeType==u.NODE_ELEMENT&&v.$block[f.nodeName.toLowerCase()]){h=true;break a}}h=false}h=!h}h=h}if(h)d=b;else e=b}}g.push(b);if(s=="body")break}b=b.parent()}this.block=this.block=
d;this.blockLimit=this.blockLimit=e;this.elements=this.elements=g}var r=KISSY.DOM,v=l.XHTML_DTD,u=l.NODE,q=null,m={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};p.prototype={compare:function(b){var d=this.elements;b=b&&b.elements;if(!b||d.length!=b.length)return false;for(var e=0;e<d.length;e++)if(!r._4e_equals(d[e],b[e]))return false;return true},contains:function(b){for(var d=this.elements,e=0;e<
d.length;e++)if(d[e]._4e_name()in b)return d[e];return q}};l.ElementPath=l.ElementPath=p;var i=p.prototype;l.Utils.extern(i,{compare:i.compare,contains:i.contains})});
KISSY.Editor.add("walker",function(l){function p(g,s){if(this._.end)return m;var h,a=this.range,c,f=this.guard,k=this.type,x=g?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;a.trim();if(a.collapsed){this.end();return m}}if(!g&&!this._.guardLTR){var o=a.endContainer,y=new d(o[0].childNodes[a.endOffset]);this._.guardLTR=function(z,n){return(z=b._4e_wrap(z))&&z[0]&&(!n||!b._4e_equals(o,z))&&(!y[0]||!z._4e_equals(y))&&(z[0].nodeType!=i.NODE_ELEMENT||!n||z._4e_name()!="body")}}if(g&&
!this._.guardRTL){var w=a.startContainer,A=a.startOffset>0&&new d(w[0].childNodes[a.startOffset-1]);this._.guardRTL=function(z,n){return(z=b._4e_wrap(z))&&z[0]&&(!n||!z._4e_equals(w))&&(!A[0]||!z._4e_equals(A))&&(z[0].nodeType!=i.NODE_ELEMENT||!n||z._4e_name()!="body")}}var E=g?this._.guardRTL:this._.guardLTR;c=f?function(z,n){if(E(z,n)===q)return q;return f(z,n)}:E;if(this.current)h=this.current[x](q,k,c);else if(g){h=a.endContainer;if(a.endOffset>0){h=new d(h[0].childNodes[a.endOffset-1]);if(c(h)===
q)h=m}else h=c(h,u)===q?m:h._4e_previousSourceNode(u,k,c)}else{h=a.startContainer;if((h=new d(h[0].childNodes[a.startOffset]))&&h[0]){if(c(h)===q)h=m}else h=c(a.startContainer,u)===q?m:a.startContainer._4e_nextSourceNode(u,k,c)}for(;h&&h[0]&&!this._.end;){this.current=h;if(!this.evaluator||this.evaluator(h)!==q){if(!s)return h}else if(s&&this.evaluator)return q;h=h[x](q,k,c)}this.end();return this.current=m}function r(g){for(var s,h=m;s=p.call(this,g);)h=s;return h}function v(g){this.range=g;this._=
{}}var u=true,q=false,m=null,j=KISSY,i=l.NODE,b=j.DOM,d=j.Node;j.augment(v,{end:function(){this._.end=1},next:function(){return p.call(this)},previous:function(){return p.call(this,u)},checkForward:function(){return p.call(this,q,u)!==q},checkBackward:function(){return p.call(this,u,u)!==q},lastForward:function(){return r.call(this)},lastBackward:function(){return r.call(this,u)},reset:function(){delete this.current;this._={}}});v.blockBoundary=function(g){return function(s){s=b._4e_wrap(s);return!(s&&
s[0].nodeType==i.NODE_ELEMENT&&s._4e_isBlockBoundary(g))}};v.listItemBoundary=function(){return this.blockBoundary({br:1})};v.bookmark=function(g,s){function h(a){return a&&a[0]&&a._4e_name()=="span"&&a.attr("_ke_bookmark")}return function(a){var c,f;c=a&&a[0]&&a[0].nodeType==i.NODE_TEXT&&(f=a.parent())&&h(f);c=g?c:c||h(a);return s^c}};v.whitespaces=function(g){return function(s){s=(s=s[0]||s)&&s.nodeType==i.NODE_TEXT&&!j.trim(s.nodeValue);return g^s}};v.invisible=function(g){var s=v.whitespaces();
return function(h){h=s(h)||h[0].nodeType==i.NODE_ELEMENT&&!h[0].offsetHeight;return g^h}};l.Walker=v;l.Walker=v;var e=v.prototype;l.Utils.extern(e,{end:e.end,next:e.next,previous:e.previous,checkForward:e.checkForward,checkBackward:e.checkBackward,lastForward:e.lastForward,lastBackward:e.lastBackward,reset:e.reset});l.Utils.extern(v,{blockBoundary:v.blockBoundary,listItemBoundary:v.listItemBoundary,bookmark:v.bookmark,whitespaces:v.whitespaces,invisible:v.invisible})});
KISSY.Editor.add("range",function(l){function p(n){this.endOffset=this.endContainer=this.startOffset=this.startContainer=b;this.collapsed=j;this.document=n}function r(n){var t=n[0].nodeType!=e.NODE_TEXT&&n._4e_name()in k.$removeEmpty,B=!d.trim(n[0].nodeValue);n=!!n.parent().attr("_ke_bookmark");return t||B||n}function v(n){return!A(n)&&!E(n)}function u(n){var t=i,B=h.bookmark(j);return function(D){if(B(D))return j;if(D[0].nodeType==e.NODE_TEXT){if(d.trim(D[0].nodeValue).length)return i}else if(D[0].nodeType==
e.NODE_ELEMENT)if(!w[D._4e_name()])if(!n&&!f.ie&&D._4e_name()=="br"&&!t)t=j;else return i;return j}}function q(n,t){function B(D){return D&&D.nodeName=="span"&&D.getAttribute("_ke_bookmark")}return function(D){var C,F;C=D&&!D.nodeName&&(F=D.parentNode)&&B(F);C=n?C:C||B(D);return t^C}}function m(n){return function(t){t=(t=t[0]||t)&&t.nodeType==e.NODE_TEXT&&!d.trim(t.nodeValue);return n^t}}l.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};l.RANGE=l.RANGE;var j=true,i=false,b=null,d=KISSY,e=l.NODE,g=l.RANGE,s=l.POSITION,h=l.Walker,a=d.DOM,c=l.Utils.getByAddress,f=d.UA,k=l.XHTML_DTD,x=l.ElementPath,o=d.Node,y={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};p.prototype.toString=function(){var n=[];n.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);n.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return n.join("<br/>")};d.augment(p,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&a._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var n=this.startContainer,t=this.startOffset;if(n[0].nodeType!=e.NODE_ELEMENT)if(t)t>=n[0].nodeValue.length&&this.setStartAfter(n);else this.setStartBefore(n);n=this.endContainer;t=this.endOffset;if(n[0].nodeType!=e.NODE_ELEMENT)if(t)t>=
n[0].nodeValue.length&&this.setEndAfter(n);else this.setEndBefore(n)},setStartAfter:function(n){this.setStart(n.parent(),n._4e_index()+1)},setStartBefore:function(n){this.setStart(n.parent(),n._4e_index())},setEndAfter:function(n){this.setEnd(n.parent(),n._4e_index()+1)},setEndBefore:function(n){this.setEnd(n.parent(),n._4e_index())},optimizeBookmark:function(){var n=this.startContainer,t=this.endContainer;n&&n._4e_name()=="span"&&n.attr("_ke_bookmark")&&this.setStartAt(n,g.POSITION_BEFORE_START);
t&&t._4e_name()=="span"&&t.attr("_ke_bookmark")&&this.setEndAt(t,g.POSITION_AFTER_END)},setStart:function(n,t){if(n[0].nodeType==e.NODE_ELEMENT&&y[n._4e_name()]){n=n.parent();t=n._4e_index()}this.startContainer=n;this.startOffset=t;if(!this.endContainer){this.endContainer=n;this.endOffset=t}this.updateCollapsed()},setEnd:function(n,t){if(n[0].nodeType==e.NODE_ELEMENT&&y[n._4e_name()]){n=n.parent();t=n._4e_index()+1}this.endContainer=n;this.endOffset=t;if(!this.startContainer){this.startContainer=
n;this.startOffset=t}this.updateCollapsed()},setStartAt:function(n,t){switch(t){case g.POSITION_AFTER_START:this.setStart(n,0);break;case g.POSITION_BEFORE_END:n[0].nodeType==e.NODE_TEXT?this.setStart(n,n[0].nodeValue.length):this.setStart(n,n[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setStartBefore(n);break;case g.POSITION_AFTER_END:this.setStartAfter(n)}this.updateCollapsed()},setEndAt:function(n,t){switch(t){case g.POSITION_AFTER_START:this.setEnd(n,0);break;case g.POSITION_BEFORE_END:n[0].nodeType==
e.NODE_TEXT?this.setEnd(n,n[0].nodeValue.length):this.setEnd(n,n[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setEndBefore(n);break;case g.POSITION_AFTER_END:this.setEndAfter(n)}this.updateCollapsed()},execContentsAction:function(n,t){var B=this.startContainer,D=this.endContainer,C=this.startOffset,F=this.endOffset,M,P=this.document,L;this.optimizeBookmark();if(D[0].nodeType==e.NODE_TEXT)D=D._4e_splitText(F);else if(D[0].childNodes.length>0)if(F>=D[0].childNodes.length){D=new o(D[0].appendChild(P.createTextNode("")));
L=j}else D=new o(D[0].childNodes[F]);if(B[0].nodeType==e.NODE_TEXT){B._4e_splitText(C);if(B._4e_equals(D))D=new o(B[0].nextSibling)}else if(C)if(C>=B[0].childNodes.length){M=new o(P.createTextNode(""));B.append(M);B=M;M=j}else B=new o(B[0].childNodes[C].previousSibling);else{M=new o(P.createTextNode(""));B.prepend(M);B=M;M=j}C=B._4e_parents();F=D._4e_parents();var Q,R,T;for(Q=0;Q<C.length;Q++){R=C[Q];T=F[Q];if(!R._4e_equals(T))break}P=t;for(var U,V,G,K=Q;K<C.length;K++){U=C[K];V=P&&!U._4e_equals(B)?
P.appendChild(U._4e_clone()[0]):null;for(U=U[0].nextSibling;U;){if(a._4e_equals(F[K],U)||a._4e_equals(D,U))break;G=U.nextSibling;if(n==2)P.appendChild(U.cloneNode(j));else{a._4e_remove(U);n==1&&P.appendChild(U)}U=G}if(V)P=V}P=t;for(Q=Q;Q<F.length;Q++){U=F[Q];V=P&&n>0&&!U._4e_equals(D)?P.appendChild(U._4e_clone()[0]):null;if(!C[Q]||!U.parent()._4e_equals(C[Q].parent()))for(U=U[0].previousSibling;U;){if(a._4e_equals(C[Q],U)||a._4e_equals(B,U))break;G=U.previousSibling;if(n==2)P.insertBefore(U.cloneNode(j),
P.firstChild);else{a._4e_remove(U);n==1&&P.insertBefore(U,P.firstChild)}U=G}if(V)P=V}if(n==2){T=this.startContainer[0];if(T.nodeType==e.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==e.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}T=this.endContainer[0];if(T.nodeType==e.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==e.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}}else{if(R&&T&&(!B.parent()._4e_equals(R.parent())||!D.parent()._4e_equals(T.parent()))){R=
T._4e_index();M&&T.parent()._4e_equals(B.parent())&&R--;this.setStart(T.parent(),R)}this.collapse(j)}M&&B._4e_remove();L&&D[0].parentNode&&D._4e_remove()},collapse:function(n){if(n){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=j},clone:function(){var n=new p(this.document);n.startContainer=this.startContainer;n.startOffset=this.startOffset;n.endContainer=this.endContainer;n.endOffset=
this.endOffset;n.collapsed=this.collapsed;return n},getEnclosedNode:function(){var n=this.clone();n.optimize();if(n.startContainer[0].nodeType!=e.NODE_ELEMENT||n.endContainer[0].nodeType!=e.NODE_ELEMENT)return b;var t=new l.Walker(n),B=q(j,undefined),D=m(j);n.evaluator=function(C){return D(C)&&B(C)};n=t.next();t.reset();t=t.previous();return n&&n._4e_equals(t)?n:b},shrink:function(n,t){if(!this.collapsed){n=n||g.SHRINK_TEXT;var B=this.clone(),D=this.startContainer,C=this.endContainer,F=this.startOffset,
M=this.endOffset,P=1,L=1;if(D&&D[0].nodeType==e.NODE_TEXT)if(F)if(F>=D[0].nodeValue.length)B.setStartAfter(D);else{B.setStartBefore(D);P=0}else B.setStartBefore(D);if(C&&C[0].nodeType==e.NODE_TEXT)if(M)if(M>=C[0].nodeValue.length)B.setEndAfter(C);else{B.setEndAfter(C);L=0}else B.setEndBefore(C);B=new h(B);B.evaluator=function(R){R=R[0]||R;return R.nodeType==(n==g.SHRINK_ELEMENT?e.NODE_ELEMENT:e.NODE_TEXT)};var Q;B.guard=function(R,T){R=R[0]||R;if(n==g.SHRINK_ELEMENT&&R.nodeType==e.NODE_TEXT)return i;
if(T&&R==Q)return i;if(!T&&R.nodeType==e.NODE_ELEMENT)Q=R;return j};if(P)(D=B[n==g.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(D,t?g.POSITION_AFTER_START:g.POSITION_BEFORE_START);if(L){B.reset();(B=B[n==g.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(B,t?g.POSITION_BEFORE_END:g.POSITION_AFTER_END)}return!!(P||L)}},getTouchedStartNode:function(){var n=this.startContainer;if(this.collapsed||n[0].nodeType!=e.NODE_ELEMENT)return n;return n.childNodes[this.startOffset]||n},createBookmark2:function(n){var t=
this.startContainer,B=this.endContainer,D=this.startOffset,C=this.endOffset,F,M;if(!t||!B)return{start:0,end:0};if(n){if(t[0].nodeType==e.NODE_ELEMENT)if((F=new o(t[0].childNodes[D]))&&F[0]&&F[0].nodeType==e.NODE_TEXT&&D>0&&F[0].previousSibling.nodeType==e.NODE_TEXT){t=F;D=0}for(;t[0].nodeType==e.NODE_TEXT&&(M=t._4e_previous())&&M[0].nodeType==e.NODE_TEXT;){t=M;D+=M[0].nodeValue.length}if(!this.collapsed){if(B[0].nodeType==e.NODE_ELEMENT)if((F=new o(B[0].childNodes[C]))&&F[0]&&F[0].nodeType==e.NODE_TEXT&&
C>0&&F[0].previousSibling.nodeType==e.NODE_TEXT){B=F;C=0}for(;B[0].nodeType==e.NODE_TEXT&&(M=B._4e_previous())&&M[0].nodeType==e.NODE_TEXT;){B=M;C+=M[0].nodeValue.length}}}return{start:t._4e_address(n),end:this.collapsed?b:B._4e_address(n),startOffset:D,endOffset:C,normalized:n,is2:j}},createBookmark:function(n){var t,B,D,C,F=this.collapsed;t=new o("<span>",b,this.document);t.attr("_ke_bookmark",1);t.css("display","none");t.html("&nbsp;");if(n){D=d.guid("ke_bm_");t.attr("id",D+"S")}if(!F){B=t._4e_clone();
B.html("&nbsp;");n&&B.attr("id",D+"E");C=this.clone();C.collapse();C.insertNode(B)}C=this.clone();C.collapse(j);C.insertNode(t);if(B){this.setStartAfter(t);this.setEndBefore(B)}else this.moveToPosition(t,g.POSITION_AFTER_END);return{startNode:n?D+"S":t,endNode:n?D+"E":B,serializable:n,collapsed:F}},moveToPosition:function(n,t){this.setStartAt(n,t);this.collapse(j)},trim:function(n,t){var B=this.startContainer,D=this.startOffset,C=this.collapsed;if((!n||C)&&B[0]&&B[0].nodeType==e.NODE_TEXT){if(D)if(D>=
B[0].nodeValue.length){D=B._4e_index()+1;B=B.parent()}else{var F=B._4e_splitText(D);D=B._4e_index()+1;B=B.parent();if(a._4e_equals(this.startContainer,this.endContainer))this.setEnd(F,this.endOffset-this.startOffset);else if(a._4e_equals(B,this.endContainer))this.endOffset+=1}else{D=B._4e_index();B=B.parent()}this.setStart(B,D);if(C){this.collapse(j);return}}B=this.endContainer;D=this.endOffset;if(!(t||C)&&B[0]&&B[0].nodeType==e.NODE_TEXT){if(D){D>=B.nodeValue.length||B._4e_splitText(D);D=B._4e_index()+
1}else D=B._4e_index();B=B.parent();this.setEnd(B,D)}},insertNode:function(n){this.optimizeBookmark();this.trim(i,j);var t=this.startContainer;t[0].insertBefore(n[0]||n,t[0].childNodes[this.startOffset]||null);a._4e_equals(n.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(n)},moveToBookmark:function(n){if(n.is2){var t=c(this.document,n.start,n.normalized),B=n.startOffset,D=n.end&&c(this.document,n.end,n.normalized);n=n.endOffset;this.setStart(t,B);D?this.setEnd(D,n):this.collapse(j)}else{t=
(B=n.serializable)?d.one("#"+n.startNode,this.document):n.startNode;n=B?d.one("#"+n.endNode,this.document):n.endNode;this.setStartBefore(t);t._4e_remove();if(n&&n[0]){this.setEndBefore(n);n._4e_remove()}else this.collapse(j)}},getCommonAncestor:function(n,t){var B=this.startContainer,D=this.endContainer;B=a._4e_equals(B,D)?n&&B[0].nodeType==e.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new o(B[0].childNodes[this.startOffset]):B:B._4e_commonAncestor(D);return t&&B[0].nodeType==e.NODE_TEXT?B.parent():
B},enlarge:function(n){switch(n){case g.ENLARGE_ELEMENT:if(this.collapsed)break;n=this.getCommonAncestor();var t=new o(this.document.body),B,D,C,F,M,P=i,L,Q;L=this.startContainer;Q=this.startOffset;if(L[0].nodeType==e.NODE_TEXT){if(Q){L=!d.trim(L[0].nodeValue.substring(0,Q)).length&&L;P=!!L}if(L)if(!(F=L[0].previousSibling))C=L.parent()}else{if(Q)F=L[0].childNodes[Q-1]||L[0].lastChild;F||(C=L)}for(;C||F;){if(C&&!F){if(!M&&a._4e_equals(C,n))M=j;if(!t.contains(C))break;if(!P||C.css("display")!="inline"){P=
i;if(M)B=C;else this.setStartBefore(C)}F=C[0].previousSibling}for(;F;){L=i;if(F.nodeType==e.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=b;L=/[\s\ufeff]$/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&k.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=b;else for(var R=F.all||F.getElementsByTagName("*"),T=0,U;U=R[T++];)if(!k.$removeEmpty[U.nodeName.toLowerCase()]){F=b;break}if(F)L=!!Q.length}else F=b;if(L)if(P)if(M)B=C;else C&&this.setStartBefore(C);
else P=j;if(F){L=F.previousSibling;if(!C&&!L){C=new o(F);F=b;break}F=L}else C=b}if(C)C=C.parent()}L=this.endContainer;Q=this.endOffset;C=F=b;M=P=i;if(L[0].nodeType==e.NODE_TEXT){L=!d.trim(L[0].nodeValue.substring(Q)).length&&L;P=!(L&&L[0].nodeValue.length);if(L)if(!(F=L[0].nextSibling))C=L.parent()}else(F=L[0].childNodes[Q])||(C=L);for(;C||F;){if(C&&!F){if(!M&&a._4e_equals(C,n))M=j;if(!t.contains(C))break;if(!P||C.css("display")!="inline"){P=i;if(M)D=C;else C&&this.setEndAfter(C)}F=C[0].nextSibling}for(;F;){L=
i;if(F.nodeType==e.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=b;L=/^[\s\ufeff]/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&k.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=b;else{R=F.all||F.getElementsByTagName("*");for(T=0;U=R[T++];)if(!k.$removeEmpty[U.nodeName.toLowerCase()]){F=b;break}}if(F)L=!!Q.length}else F=b;if(L)if(P)if(M)D=C;else this.setEndAfter(C);if(F){L=F.nextSibling;if(!C&&!L){C=new o(F);F=b;break}F=L}else C=b}if(C)C=
C.parent()}if(B&&D){n=B.contains(D)?D:B;this.setStartBefore(n);this.setEndAfter(n)}break;case g.ENLARGE_BLOCK_CONTENTS:case g.ENLARGE_LIST_ITEM_CONTENTS:C=new p(this.document);t=new o(this.document.body);C.setStartAt(t,g.POSITION_AFTER_START);C.setEnd(this.startContainer,this.startOffset);C=new h(C);var V,G,K=h.blockBoundary(n==g.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:b),I=function(H){var J=K(H);J||(V=H);return J};B=function(H){var J=I(H);if(!J&&H[0]&&H._4e_name()=="br")G=H;return J};C.guard=I;C=C.lastBackward();
V=V||t;this.setStartAt(V,V._4e_name()!="br"&&(!C&&this.checkStartOfBlock()||C&&V.contains(C))?g.POSITION_AFTER_START:g.POSITION_AFTER_END);C=this.clone();C.collapse();C.setEndAt(t,g.POSITION_BEFORE_END);C=new h(C);C.guard=n==g.ENLARGE_LIST_ITEM_CONTENTS?B:I;V=b;C=C.lastForward();V=V||t;this.setEndAt(V,!C&&this.checkEndOfBlock()||C&&V.contains(C)?g.POSITION_BEFORE_END:g.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},checkStartOfBlock:function(){var n=this.startContainer,t=this.startOffset;if(t&&n[0].nodeType==
e.NODE_TEXT)if(d.trim(n[0].nodeValue.substring(0,t)).length)return i;this.trim();n=new x(this.startContainer);t=this.clone();t.collapse(j);t.setStartAt(n.block||n.blockLimit,g.POSITION_AFTER_START);n=new h(t);n.evaluator=u(j);return n.checkBackward()},checkEndOfBlock:function(){var n=this.endContainer,t=this.endOffset;if(n[0].nodeType==e.NODE_TEXT)if(d.trim(n[0].nodeValue.substring(t)).length)return i;this.trim();n=new x(this.endContainer);t=this.clone();t.collapse(i);t.setEndAt(n.block||n.blockLimit,
g.POSITION_BEFORE_END);n=new h(t);n.evaluator=u(i);return n.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var n=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,n);return n},checkBoundaryOfElement:function(n,t){var B=this.clone();B[t==g.START?"setStartAt":"setEndAt"](n,t==g.START?g.POSITION_AFTER_START:g.POSITION_BEFORE_END);B=new h(B);B.evaluator=r;return B[t==g.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var n=this.startContainer,t=this.endContainer,B=this.startOffset,D=this.endOffset,C;if(n[0].nodeType==e.NODE_ELEMENT){C=n[0].childNodes.length;if(C>B)n=new o(n[0].childNodes[B]);else if(C<1)n=n._4e_previousSourceNode();else{for(n=n[0];n.lastChild;)n=n.lastChild;n=new o(n);n=n._4e_nextSourceNode()||n}}if(t[0].nodeType==e.NODE_ELEMENT){C=t[0].childNodes.length;if(C>D)t=(new o(t[0].childNodes[D]))._4e_previousSourceNode(j);else if(C<1)t=t._4e_previousSourceNode();else{for(t=
t[0];t.lastChild;)t=t.lastChild;t=new o(t)}}if(n._4e_position(t)&s.POSITION_FOLLOWING)n=t;return{startNode:n,endNode:t}},fixBlock:function(n,t){var B=this.createBookmark(),D=new o(this.document.createElement(t));this.collapse(n);this.enlarge(g.ENLARGE_BLOCK_CONTENTS);D[0].appendChild(this.extractContents());D._4e_trim();f.ie||D._4e_appendBogus();this.insertNode(D);this.moveToBookmark(B);return D},splitBlock:function(n){var t=new x(this.startContainer),B=new x(this.endContainer),D=t.block,C=B.block,
F=b;if(!t.blockLimit._4e_equals(B.blockLimit))return b;if(n!="br"){if(!D){D=this.fixBlock(j,n);C=(new x(this.endContainer)).block}C||(C=this.fixBlock(i,n))}n=D&&this.checkStartOfBlock();t=C&&this.checkEndOfBlock();this.deleteContents();if(D&&a._4e_equals(D,C))if(t){F=new x(this.startContainer);this.moveToPosition(C,g.POSITION_AFTER_END);C=b}else if(n){F=new x(this.startContainer);this.moveToPosition(D,g.POSITION_BEFORE_START);D=b}else{C=this.splitElement(D);!f.ie&&!d.inArray(D._4e_name(),["ul","ol"])&&
D._4e_appendBogus()}return{previousBlock:D,nextBlock:C,wasStartOfBlock:n,wasEndOfBlock:t,elementPath:F}},splitElement:function(n){if(!this.collapsed)return b;this.setEndAt(n,g.POSITION_BEFORE_END);var t=this.extractContents(),B=n._4e_clone(i);B[0].appendChild(t);B.insertAfter(n);this.moveToPosition(n,g.POSITION_AFTER_END);return B},moveToElementEditablePosition:function(n,t){var B,D=l.XHTML_DTD;if(D.$empty[n._4e_name()])return i;for(;n&&n[0].nodeType==e.NODE_ELEMENT;){if(B=n._4e_isEditable())this.moveToPosition(n,
t?g.POSITION_BEFORE_END:g.POSITION_AFTER_START);else if(D.$inline[n._4e_name()]){this.moveToPosition(n,t?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return j}if((n=D.$empty[n._4e_name()]?n[t?"_4e_previous":"_4e_next"](v):n[t?"_4e_last":"_4e_first"](v))&&n[0].nodeType==e.NODE_TEXT){this.moveToPosition(n,t?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return j}}return B},selectNodeContents:function(n){this.setStart(n,0);this.setEnd(n,n[0].nodeType==e.NODE_TEXT?n[0].nodeValue.length:n[0].childNodes.length)}});
var w={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},A=new h.whitespaces,E=new h.bookmark;l.Range=p;l.Range=p;var z=p.prototype;l.Utils.extern(z,{updateCollapsed:z.updateCollapsed,optimize:z.optimize,setStartAfter:z.setStartAfter,setEndAfter:z.setEndAfter,setStartBefore:z.setStartBefore,setEndBefore:z.setEndBefore,optimizeBookmark:z.optimizeBookmark,setStart:z.setStart,setEnd:z.setEnd,
setStartAt:z.setStartAt,setEndAt:z.setEndAt,execContentsAction:z.execContentsAction,collapse:z.collapse,clone:z.clone,getEnclosedNode:z.getEnclosedNode,shrink:z.shrink,getTouchedStartNode:z.getTouchedStartNode,createBookmark2:z.createBookmark2,createBookmark:z.createBookmark,moveToPosition:z.moveToPosition,trim:z.trim,insertNode:z.insertNode,moveToBookmark:z.moveToBookmark,getCommonAncestor:z.getCommonAncestor,enlarge:z.enlarge,checkStartOfBlock:z.checkStartOfBlock,checkEndOfBlock:z.checkEndOfBlock,
deleteContents:z.deleteContents,extractContents:z.extractContents,checkBoundaryOfElement:z.checkBoundaryOfElement,getBoundaryNodes:z.getBoundaryNodes,fixBlock:z.fixBlock,splitBlock:z.splitBlock,splitElement:z.splitElement,moveToElementEditablePosition:z.moveToElementEditablePosition,selectNodeContents:z.selectNodeContents})});
KISSY.Editor.add("domiterator",function(l){function p(h){if(!(arguments.length<1)){this.range=h;this.forceBrBreak=v;this.enlargeBr=r;this.enforceRealBlocks=v;this._||(this._={})}}var r=true,v=false,u=KISSY,q=u.UA,m=l.Walker,j=l.Range,i=l.RANGE,b=l.NODE,d=l.ElementPath,e=u.Node,g=u.DOM,s=/^[\r\n\t ]*$/;u.augment(p,{getNextParagraph:function(h){var a,c,f,k,x;if(!this._.lastNode){c=this.range.clone();c.shrink(i.SHRINK_ELEMENT,r);c.enlarge(this.forceBrBreak||!this.enlargeBr?i.ENLARGE_LIST_ITEM_CONTENTS:
i.ENLARGE_BLOCK_CONTENTS);var o=new m(c),y=m.bookmark(r,r);o.evaluator=y;this._.nextNode=o.next();o=new m(c);o.evaluator=y;o=o.previous();this._.lastNode=o._4e_nextSourceNode(r);if(this._.lastNode&&this._.lastNode[0].nodeType==b.NODE_TEXT&&!u.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){y=new j(c.document);y.moveToPosition(this._.lastNode,i.POSITION_AFTER_END);if(y.checkEndOfBlock()){y=new d(y.endContainer);this._.lastNode=(y.block||y.blockLimit)._4e_nextSourceNode(r)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new e(c.document.createTextNode(""));g.insertAfter(this._.lastNode[0],o[0])}c=null}y=this._.nextNode;o=this._.lastNode;for(this._.nextNode=null;y;){var w=v,A=y[0].nodeType!=b.NODE_ELEMENT,E=v;if(A){if(y[0].nodeType==b.NODE_TEXT)if(s.test(y[0].nodeValue))A=v}else{var z=y._4e_name();if(y._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(z=="br")A=r;else if(!c&&!y[0].childNodes.length&&z!="hr"){a=y;f=y._4e_equals(o);break}if(c){c.setEndAt(y,i.POSITION_BEFORE_START);if(z!="br")this._.nextNode=
y}w=r}else{if(y[0].firstChild){if(!c){c=new j(this.range.document);c.setStartAt(y,i.POSITION_BEFORE_START)}y=new e(y[0].firstChild);continue}A=r}}if(A&&!c){c=new j(this.range.document);c.setStartAt(y,i.POSITION_BEFORE_START)}f=(!w||A)&&y._4e_equals(o);if(c&&!w)for(;!y[0].nextSibling&&!f;){z=y.parent();if(z._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){w=r;f||z._4e_equals(o);break}y=z;A=r;f=y._4e_equals(o);E=r}A&&c.setEndAt(y,i.POSITION_AFTER_END);y=y._4e_nextSourceNode(E,null,o);if((f=!y)||w&&c)break}if(!a){if(!c){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}a=new d(c.startContainer);y=a.blockLimit;w={div:1,th:1,td:1};a=a.block;if((!a||!a[0])&&!this.enforceRealBlocks&&w[y._4e_name()]&&c.checkStartOfBlock()&&c.checkEndOfBlock())a=y;else if(!a||this.enforceRealBlocks&&a._4e_name()=="li"){a=new e(this.range.document.createElement(h||"p"));a[0].appendChild(c.extractContents());a._4e_trim();c.insertNode(a);k=x=r}else if(a._4e_name()!="li"){if(!c.checkStartOfBlock()||!c.checkEndOfBlock()){a=a._4e_clone(v);
a[0].appendChild(c.extractContents());a._4e_trim();x=c.splitBlock();k=!x.wasStartOfBlock;x=!x.wasEndOfBlock;c.insertNode(a)}}else if(!f)this._.nextNode=a._4e_equals(o)?null:c.getBoundaryNodes().endNode._4e_nextSourceNode(r,null,o)}if(k){c=new e(a[0].previousSibling);if(c[0]&&c[0].nodeType==b.NODE_ELEMENT)if(c._4e_name()=="br")c._4e_remove();else c[0].lastChild&&g._4e_name(c[0].lastChild)=="br"&&g._4e_remove(c[0].lastChild)}if(x){c=m.bookmark(v,r);k=new e(a[0].lastChild);if(k[0]&&k[0].nodeType==b.NODE_ELEMENT&&
k._4e_name()=="br")if(q.ie||k._4e_previous(c)||k._4e_next(c))k._4e_remove()}if(!this._.nextNode)this._.nextNode=f||a._4e_equals(o)?null:a._4e_nextSourceNode(r,null,o);return a}});j.prototype.createIterator=function(){return new p(this)}});
KISSY.Editor.add("selection",function(l){function p(w){this.document=this.document=w;this._={cache:{}};if(a){var A=this.getNative().createRange();if(!A||A.item&&A.item(0).ownerDocument!=w||A.parentElement&&A.parentElement().ownerDocument!=w)this.isInvalid=u}}function r(w){w=new p(w);return!w||w.isInvalid?m:w}function v(w){var A=w.document,E=new e(A.body),z=new e(A.documentElement);if(i.ie){if(i.ie<8||document.documentMode==7)z.on("click",function(L){(new e(L.target))._4e_name()==="html"&&w.getSelection().getRanges()[0].select()});
var n,t,B=1;z.on("mousedown",function(){B=0});z.on("mouseup",function(){B=1});E.on("focusin",function(L){if((new e(L.target))._4e_name()=="body")if(n){try{B&&n.select()}catch(Q){}n=m}});E.on("focus",function(){t=u;C()});E.on("beforedeactivate",function(L){if(!L.relatedTarget){t=q;B=1}});d.on(b._4e_getWin(A),"blur",function(){A&&A.selection.empty()});E.on("mousedown",function(){D()});E.on("mouseup",function(){t=u;setTimeout(function(){C(u)},0)});var D=function(){t=q},C=function(L){if(t){var Q=w.document,
R=w.getSelection(),T=R&&R.getType(),U=R&&R.getNative();if(L&&U&&T==g.SELECTION_NONE)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){C(u)},50);return}var V;if(!(U&&T==g.SELECTION_TEXT&&(V=b._4e_name(R.getStartElement()))&&V in{input:1,textarea:1})){n=U&&R.getRanges()[0];w._monitor()}}};E.on("keydown",D);E.on("keyup",function(){t=u;C()});d.on(A,"selectionchange",C)}else{d.on(A,"mouseup",w._monitor,w);d.on(A,"keyup",w._monitor,w)}var F={table:1,pre:1},M=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
P=l.Walker.whitespaces(u);w.on("selectionChange",function(L){var Q=L.path;L=(L=L.selection)&&L.getRanges()[0];if(!(!L||!L.collapsed||Q.block))if(Q.blockLimit._4e_name()=="body"){Q=L.fixBlock(u,"p");if(Q._4e_outerHtml().match(M)){var R=Q._4e_next(P);if(R&&R[0].nodeType==h.NODE_ELEMENT&&!F[R._4e_name()]){L.moveToElementEditablePosition(R);Q._4e_remove()}else if((R=Q._4e_previous(P))&&R[0].nodeType==h.NODE_ELEMENT&&!F[R._4e_name()]){L.moveToElementEditablePosition(R,R._4e_outerHtml().match(M)?q:u);Q._4e_remove()}}L.select();
a||w.notifySelectionChange()}})}l.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var u=true,q=false,m=null,j=KISSY,i=j.UA,b=j.DOM,d=j.Event,e=j.Node,g=l.SELECTION,s=l.RANGE,h=l.NODE,a=!window.getSelection,c=l.Walker,f=l.Range,k={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};j.augment(p,{getNative:!a?function(){var w=this._.cache;return w.nativeSel||(w.nativeSel=b._4e_getWin(this.document).getSelection())}:
function(){var w=this._.cache;return w.nativeSel||(w.nativeSel=this.document.selection)},getType:!a?function(){var w=this._.cache;if(w.type)return w.type;var A=g.SELECTION_TEXT,E=this.getNative();if(E){if(E.rangeCount==1){E=E.getRangeAt(0);var z=E.startContainer;if(z==E.endContainer&&z.nodeType==h.NODE_ELEMENT&&E.endOffset-E.startOffset===1&&k[z.childNodes[E.startOffset].nodeName.toLowerCase()])A=g.SELECTION_ELEMENT}}else A=g.SELECTION_NONE;return w.type=A}:function(){var w=this._.cache;if(w.type)return w.type;
var A=g.SELECTION_NONE;try{var E=this.getNative(),z=E.type;if(z=="Text")A=g.SELECTION_TEXT;if(z=="Control")A=g.SELECTION_ELEMENT;if(E.createRange().parentElement)A=g.SELECTION_TEXT}catch(n){}return w.type=A},getRanges:a?function(){var w=function(A,E){A=A.duplicate();A.collapse(E);for(var z=A.parentElement(),n=z.childNodes,t,B=0;B<n.length;B++){var D=n[B];if(D.nodeType==h.NODE_ELEMENT){t=A.duplicate();t.moveToElementText(D);D=t.compareEndPoints("StartToStart",A);var C=t.compareEndPoints("EndToStart",
A);t.collapse();if(D>0)break;else if(!D||C==1&&D==-1)return{container:z,offset:B};else if(!C)return{container:z,offset:B+1};t=m}}if(!t){t=A.duplicate();t.moveToElementText(z);t.collapse(q)}t.setEndPoint("StartToStart",A);t=t.text.replace(/\r\n|\r/g,"\n").length;try{for(;t>0;)t-=n[--B].nodeValue.length}catch(F){t=0}return t===0?{container:z,offset:B}:{container:n[B],offset:-t}};return function(){var A=this._.cache;if(A.ranges)return A.ranges;var E=this.getNative(),z=E&&E.createRange(),n=this.getType();
if(!E)return[];if(n==g.SELECTION_TEXT){E=new f(this.document);n=w(z,u);E.setStart(new e(n.container),n.offset);n=w(z);E.setEnd(new e(n.container),n.offset);return A.ranges=[E]}else if(n==g.SELECTION_ELEMENT){A=A.ranges=[];for(n=0;n<z.length;n++){var t=z.item(n),B=t.parentNode,D=0;for(E=new f(this.document);D<B.childNodes.length&&B.childNodes[D]!=t;D++);E.setStart(new e(B),D);E.setEnd(new e(B),D+1);A.push(E)}return A}return A.ranges=[]}}():function(){var w=this._.cache;if(w.ranges)return w.ranges;
var A=[],E=this.getNative();if(!E)return[];for(var z=0;z<E.rangeCount;z++){var n=E.getRangeAt(z),t=new f(this.document);t.setStart(new e(n.startContainer),n.startOffset);t.setEnd(new e(n.endContainer),n.endOffset);A.push(t)}return w.ranges=A},getStartElement:function(){var w=this._.cache;if(w.startElement!==undefined)return w.startElement;var A,E=this.getNative();switch(this.getType()){case g.SELECTION_ELEMENT:return this.getSelectedElement();case g.SELECTION_TEXT:var z=this.getRanges()[0];if(z)if(!z.collapsed){for(z.optimize();u;){A=
z.startContainer;if(z.startOffset==(A[0].nodeType===h.NODE_ELEMENT?A[0].childNodes.length:A[0].nodeValue.length)&&!A._4e_isBlockBoundary())z.setStartAfter(A);else break}A=z.startContainer;if(A[0].nodeType!=h.NODE_ELEMENT)return A.parent();A=new e(A[0].childNodes[z.startOffset]);if(!A[0]||A[0].nodeType!=h.NODE_ELEMENT)return z.startContainer;for(z=A[0].firstChild;z&&z.nodeType==h.NODE_ELEMENT;){A=new e(z);z=z.firstChild}return A}if(a){z=E.createRange();z.collapse(u);A=z.parentElement()}else if((A=
E.anchorNode)&&A.nodeType!=h.NODE_ELEMENT)A=A.parentNode}return w.startElement=A?b._4e_wrap(A):m},getSelectedElement:function(){var w=this,A,E=w._.cache;if(E.selectedElement!==undefined)return E.selectedElement;if(a){A=w.getNative().createRange();A=A.item&&A.item(0)}A||(A=function(){for(var z=w.getRanges()[0],n,t,B=2;B&&!((n=z.getEnclosedNode())&&n[0].nodeType==h.NODE_ELEMENT&&k[n._4e_name()]&&(t=n));B--)z.shrink(s.SHRINK_ELEMENT);return t&&t[0]}());return E.selectedElement=b._4e_wrap(A)},reset:function(){this._.cache=
{}},selectElement:function(w){var A,E=this.document;if(a)try{A=E.body.createControlRange();A.addElement(w[0]);A.select()}catch(z){A=E.body.createTextRange();A.moveToElementText(w[0]);A.select()}finally{}else{A=E.createRange();A.selectNode(w[0]);w=this.getNative();w.removeAllRanges();w.addRange(A)}this.reset()},selectRanges:function(w){if(a){if(w.length>1){var A=w[w.length-1];w[0].setEnd(A.endContainer,A.endOffset);w.length=1}w[0]&&w[0].select()}else{A=this.getNative();if(!A)return;A.removeAllRanges();
for(var E=0;E<w.length;E++){var z=w[E],n=this.document.createRange(),t=z.startContainer;z.collapsed&&i.gecko&&i.gecko<1.09&&t[0].nodeType==h.NODE_ELEMENT&&!t[0].childNodes.length&&t[0].appendChild(this.document.createTextNode(""));n.setStart(t[0],z.startOffset);n.setEnd(z.endContainer[0],z.endOffset);A.addRange(n)}}this.reset()},createBookmarks2:function(w){for(var A=[],E=this.getRanges(),z=0;z<E.length;z++)A.push(E[z].createBookmark2(w));return A},createBookmarks:function(w,A){var E=[],z=this.document,
n;A=A||this.getRanges();for(var t=A.length,B=0;B<t;B++){E.push(n=A[B].createBookmark(w,u));var D=(w=n.serializable)?j.one("#"+n.startNode,z):n.startNode;n=w?j.one("#"+n.endNode,z):n.endNode;for(var C=B+1;C<t;C++){var F=A[C],M=F.startContainer,P=F.endContainer;b._4e_equals(M,D.parent())&&F.startOffset++;b._4e_equals(M,n.parent())&&F.startOffset++;b._4e_equals(P,D.parent())&&F.endOffset++;b._4e_equals(P,n.parent())&&F.endOffset++}}return E},selectBookmarks:function(w){for(var A=[],E=0;E<w.length;E++){var z=
new f(this.document);z.moveToBookmark(w[E]);A.push(z)}this.selectRanges(A);return this},getCommonAncestor:function(){var w=this.getRanges();return w[0].startContainer._4e_commonAncestor(w[w.length-1].endContainer)},scrollIntoView:function(){var w=this.getStartElement();w&&w._4e_scrollIntoView()},removeAllRanges:function(){var w=this.getNative();if(a)w&&w.clear();else w&&w.removeAllRanges()}});var x={table:1,tbody:1,tr:1},o=c.whitespaces(u),y=/\ufeff|\u00a0/;f.prototype.select=f.prototype.select=!a?
function(){var w=this.startContainer;this.collapsed&&w[0].nodeType==h.NODE_ELEMENT&&!w[0].childNodes.length&&w[0].appendChild(this.document.createTextNode(""));var A=this.document.createRange();A.setStart(w[0],this.startOffset);try{A.setEnd(this.endContainer[0],this.endOffset)}catch(E){if(E.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(u);A.setEnd(this.endContainer[0],this.endOffset)}else throw E;}w=r(this.document).getNative();w.removeAllRanges();w.addRange(A)}:function(w){var A=
this.collapsed,E,z;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var n=this.startContainer[0].childNodes[this.startOffset];if(n.nodeType==h.NODE_ELEMENT){(new p(this.document)).selectElement(new e(n));return}}if(this.startContainer[0].nodeType==h.NODE_ELEMENT&&this.startContainer._4e_name()in x||this.endContainer[0].nodeType==h.NODE_ELEMENT&&this.endContainer._4e_name()in x)this.shrink(s.SHRINK_ELEMENT,u);var t=this.createBookmark();n=t.startNode;var B;if(!A)B=
t.endNode;t=this.document.body.createTextRange();t.moveToElementText(n[0]);t.moveStart("character",1);if(B){w=this.document.body.createTextRange();w.moveToElementText(B[0]);t.setEndPoint("EndToEnd",w);t.moveEnd("character",-1)}else{for(E=n[0].nextSibling;E&&!o(E);)E=E.nextSibling;E=!(E&&E.nodeValue&&E.nodeValue.match(y))&&(w||!n[0].previousSibling||n[0].previousSibling&&b._4e_name(n[0].previousSibling)=="br");z=new e(this.document.createElement("span"));z.html("&#65279;");z.insertBefore(n);E&&b.insertBefore(this.document.createTextNode("\ufeff"),
n)}this.setStartBefore(n);n._4e_remove();if(A){if(E){t.moveStart("character",-1);t.select();this.document.selection.clear()}else t.select();if(z){this.moveToPosition(z,s.POSITION_BEFORE_START);z._4e_remove()}}else{this.setEndBefore(B);B._4e_remove();t.select()}};p.getSelection=r;l.Selection=p;l.Selection=p;c=p.prototype;l.Utils.extern(c,{getNative:c.getNative,getType:c.getType,getRanges:c.getRanges,getStartElement:c.getStartElement,getSelectedElement:c.getSelectedElement,reset:c.reset,selectElement:c.selectElement,
selectRanges:c.selectRanges,createBookmarks2:c.createBookmarks2,createBookmarks:c.createBookmarks,getCommonAncestor:c.getCommonAncestor,scrollIntoView:c.scrollIntoView,selectBookmarks:c.selectBookmarks,removeAllRanges:c.removeAllRanges});l.on("instanceCreated",function(w){v(w.editor)})});
KISSY.Editor.add("styles",function(l){function p(G,K){for(var I in G)G[I]=G[I].replace(U,function(H,J){return K[J]})}function r(G,K){if(K){G=A.clone(G);p(G.attributes,K);p(G.styles,K)}var I=this.element=this.element=(G.element||"*").toLowerCase();this.type=this.type=I=="#"||Q[I]?n.STYLE_BLOCK:R[I]?n.STYLE_OBJECT:n.STYLE_INLINE;this._={definition:G}}function v(G,K){var I=K?this.removeFromRange:this.applyToRange;G.body.focus();for(var H=new B(G),J=H.getRanges(),O=0;O<J.length;O++)I.call(this,J[O]);
H.selectRanges(J)}function u(G,K){var I;I=G.element;if(I=="*")I="span";I=new M(K.createElement(I));return q(I,G)}function q(G,K){var I=K._.definition,H=I.attributes;I=r.getStyleText(I);if(H)for(var J in H)G.attr(J,H[J]);if(I)G[0].style.cssText=I;return G}function m(G){var K=G.createBookmark(o),I=G.createIterator();I.enforceRealBlocks=o;I.enlargeBr=o;for(var H,J=G.document;H=I.getNextParagraph();){var O=u(this,J);H=H;var N=O;O=N._4e_name=="pre";var S=H._4e_name=="pre",Z=!O&&S;if(O&&!S){S=H;N=N;Z=S.html();
Z=j(Z,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");Z=Z.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");Z=Z.replace(/([ \t\n\r]+|&nbsp;)/g," ");Z=Z.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){S=S[0].ownerDocument.createElement("div");S.appendChild(N[0]);N[0].outerHTML="<pre>"+Z+"</pre>";N=new M(S.firstChild);N._4e_remove()}else N.html(Z);N=N}else if(Z)N=b(i(H),N);else H._4e_moveChildren(N);H[0].parentNode.replaceChild(N[0],H[0]);if(O){H=N;O=void 0;if((O=H._4e_previousSourceNode(o,D.NODE_ELEMENT))&&O._4e_name()==
"pre"){N=j(O.html(),/\n$/,"")+"\n\n"+j(H.html(),/^\n/,"");if(P.ie)H[0].outerHTML="<pre>"+N+"</pre>";else H.html(N);O._4e_remove()}}}G.moveToBookmark(K)}function j(G,K,I){var H="",J="";G=G.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(O,N,S){N&&(H=N);S&&(J=S);return""});return H+G.replace(K,I)+J}function i(G){var K=[];j(G._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(I,H,J){return H+"</pre>"+J+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(I,H){K.push(H)});return K}function b(G,K){for(var I=K[0].ownerDocument.createDocumentFragment(),H=0;H<G.length;H++){var J=G[H];J=J.replace(/(\r\n|\r)/g,"\n");J=j(J,/^[ \t]*\n/,"");J=j(J,/\n$/,"");J=j(J,/^[ \t]+|[ \t]+$/g,function(N,S){return N.length==1?"&nbsp;":S?" "+Array(N.length).join("&nbsp;"):Array(N.length).join("&nbsp;")+" "});J=J.replace(/\n/g,"<br>");J=J.replace(/[ \t]{2,}/g,function(N){return Array(N.length).join("&nbsp;")+" "});var O=K._4e_clone();O.html(J);I.appendChild(O[0])}return I}
function d(G){var K=G.document;if(G.collapsed){K=u(this,K);G.insertNode(K);G.moveToPosition(K,t.POSITION_BEFORE_END)}else{var I=this.element,H=this._.definition,J,O=l.XHTML_DTD[I]||(J=o,l.XHTML_DTD.span),N=G.createBookmark();G.enlarge(t.ENLARGE_ELEMENT);G.trim();var S=G.createBookmark(),Z=S.startNode;S=S.endNode;for(var X=Z,$;X&&X[0];){var W=y;if(z._4e_equals(X,S)){X=w;W=o}else{var Y=X[0].nodeType,ca=Y==D.NODE_ELEMENT?X._4e_name():w;if(ca&&X.attr("_ke_bookmark")){X=X._4e_nextSourceNode(o);continue}if(!ca||
O[ca]&&(X._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(X))){var da=X.parent();if(da&&da[0]&&((l.XHTML_DTD[da._4e_name()]||l.XHTML_DTD.span)[I]||J)&&(!H.parentRule||H.parentRule(da))){if(!$&&(!ca||!l.XHTML_DTD.$removeEmpty[ca]||(X._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED)){$=
new F(K);$.setStartBefore(X)}if(Y==D.NODE_TEXT||Y==D.NODE_ELEMENT&&!X[0].childNodes.length){Y=X;var aa;for(ca=Y._4e_next(function(fa){return!fa.attr("_ke_bookmark")});!ca&&(aa=Y.parent(),O[aa._4e_name()])&&(aa._4e_position(Z)|C.POSITION_FOLLOWING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_FOLLOWING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(aa));)Y=aa;$.setEndAfter(Y);Y[0].nextSibling||(W=o)}}else W=o}else W=o;X=X._4e_nextSourceNode()}if(W&&$&&!$.collapsed){W=
u(this,K);for(Y=$.getCommonAncestor();W&&Y&&W[0]&&Y[0];){if(Y._4e_name()==I){for(var ba in H.attributes)W.attr(ba)==Y.attr(ba)&&W[0].removeAttribute(ba);for(var ea in H.styles)W._4e_style(ea)==Y._4e_style(ea)&&W._4e_style(ea,"");if(!W._4e_hasAttributes()){W=w;break}}Y=Y.parent()}if(W){W[0].appendChild($.extractContents());f(this,W);$.insertNode(W);W._4e_mergeSiblings();P.ie||W[0].normalize()}$=w}}Z._4e_remove();S._4e_remove();G.moveToBookmark(N);G.shrink(t.SHRINK_TEXT)}}function e(G){G.enlarge(t.ENLARGE_ELEMENT);
var K=G.createBookmark(),I=K.startNode;if(G.collapsed){for(var H=new L(I.parent()),J,O=0,N;O<H.elements.length&&(N=H.elements[O]);O++){if(N==H.block||N==H.blockLimit)break;if(this.checkElementRemovable(N)){var S=G.checkBoundaryOfElement(N,t.END),Z=!S&&G.checkBoundaryOfElement(N,t.START);if(Z||S){J=N;J.match=Z?"start":"end"}else{N._4e_mergeSiblings();N._4e_name()==this.element?a(this,N):k(N,h(this)[N._4e_name()])}}}if(J&&J[0]){N=I;for(O=0;;O++){S=H.elements[O];if(z._4e_equals(S,J))break;else if(S.match)continue;
else S=S._4e_clone();S[0].appendChild(N[0]);N=S}z[J.match=="start"?"insertBefore":"insertAfter"](N,J)}}else{var X=K.endNode,$=this;H=function(){for(var W=new L(I.parent()),Y=new L(X.parent()),ca=w,da=w,aa=0;aa<W.elements.length;aa++){var ba=W.elements[aa];if(ba==W.block||ba==W.blockLimit)break;if($.checkElementRemovable(ba))ca=ba}for(aa=0;aa<Y.elements.length;aa++){ba=Y.elements[aa];if(ba==Y.block||ba==Y.blockLimit)break;if($.checkElementRemovable(ba))da=ba}da&&X._4e_breakParent(da);ca&&I._4e_breakParent(ca)};
H();for(J=new M(I[0].nextSibling);J[0]!==X[0];){O=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==D.NODE_ELEMENT&&this.checkElementRemovable(J)){J._4e_name()==this.element?a(this,J):k(J,h(this)[J._4e_name()]);if(O[0].nodeType==D.NODE_ELEMENT&&O.contains(I)){H();O=new M(I[0].nextSibling)}}J=O}}G.moveToBookmark(K)}function g(G){var K={};G.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(I,H,J){K[H]=J});return K}function s(G,K){var I;if(K!==y){I=document.createElement("span");
I.style.cssText=G;I=I.style.cssText||""}else I=G;return I.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function h(G){if(G._.overrides)return G._.overrides;var K=G._.overrides={},I=G._.definition.overrides;if(I){A.isArray(I)||(I=[I]);for(var H=0;H<I.length;H++){var J=I[H],O,N;if(typeof J=="string")O=J.toLowerCase();else{O=J.element?J.element.toLowerCase():G.element;N=J.attributes}J=K[O]||(K[O]={});if(N){J=J.attributes=J.attributes||[];for(var S in N)J.push([S.toLowerCase(),
N[S]])}}}return K}function a(G,K){var I=G._.definition,H=E.mix(I.attributes,h(G)[K._4e_name()]);I=I.styles;var J=A.isEmptyObject(H)&&A.isEmptyObject(I),O;for(O in H)if(!((O=="class"||G._.definition.fullMatch)&&K.attr(O)!=c(O,H[O]))){J=J||!!K._4e_hasAttribute(O);K.removeAttr(O)}for(var N in I)if(!(G._.definition.fullMatch&&K._4e_style(N)!=c(N,I[N],o))){J=J||!!K._4e_style(N);K._4e_style(N,"")}x(K)}function c(G,K,I){var H=new M("<span>");H[I?"_4e_style":"attr"](G,K);return H[I?"_4e_style":"attr"](G)}
function f(G,K){for(var I=h(G),H=K.all(G.element),J=H.length;--J>=0;)a(G,new M(H[J]));for(var O in I)if(O!=G.element){H=K.all(O);for(J=H.length-1;J>=0;J--){var N=new M(H[J]);k(N,I[O])}}}function k(G,K){var I=K&&K.attributes;if(I)for(var H=0;H<I.length;H++){var J=I[H][0],O;if(O=G.attr(J)){var N=I[H][1];if(N===w||N.test&&N.test(O)||typeof N=="string"&&O==N)G[0].removeAttribute(J)}}x(G)}function x(G){if(!G._4e_hasAttributes()){var K=G[0].firstChild,I=G[0].lastChild;G._4e_remove(o);if(K){K.nodeType==
D.NODE_ELEMENT&&z._4e_mergeSiblings(K);I&&K!=I&&I.nodeType==D.NODE_ELEMENT&&z._4e_mergeSiblings(I)}}}var o=true,y=false,w=null,A=KISSY,E=l.Utils,z=A.DOM,n={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},t=l.RANGE,B=l.Selection,D=l.NODE,C=l.POSITION,F=l.Range,M=A.Node,P=A.UA,L=l.ElementPath,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},R={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},T=/\s*(?:;\s*|$)/g,U=/#\((.+?)\)/g;l.STYLE=n;r.prototype={apply:function(G){v.call(this,
G,y)},remove:function(G){v.call(this,G,o)},applyToRange:function(G){return(this.applyToRange=this.type==n.STYLE_INLINE?d:this.type==n.STYLE_BLOCK?m:this.type==n.STYLE_OBJECT?w:w).call(this,G)},removeFromRange:function(G){return(this.removeFromRange=this.type==n.STYLE_INLINE?e:w).call(this,G)},applyToObject:function(G){q(G,this)},checkElementRemovable:function(G,K){if(!G)return y;var I=this._.definition;if(G._4e_name()==this.element){if(!K&&!G._4e_hasAttributes())return o;var H=I._AC;if(H)I=H;else{H=
{};var J=0,O=I.attributes;if(O)for(var N in O){J++;H[N]=O[N]}if(O=r.getStyleText(I)){H.style||J++;H.style=O}H._length=J;I=I._AC=H}if(I._length){for(var S in I)if(S!="_length"){J=G.attr(S)||"";if(S=="style")a:{H=I[S];J=s(J,y);typeof H=="string"&&(H=g(H));typeof J=="string"&&(J=g(J));O=void 0;for(O in H)if(!(O in J&&(J[O]==H[O]||H[O]=="inherit"||J[O]=="inherit"))){H=y;break a}H=o}else H=I[S]==J;if(H){if(!K)return o}else if(K)return y}if(K)return o}else return o}if(S=h(this)[G._4e_name()]){if(!(I=S.attributes))return o;
for(H=0;H<I.length;H++){S=I[H][0];if(S=G.attr(S)){J=I[H][1];if(J===w||typeof J=="string"&&S==J||J.test&&J.test(S))return o}}}return y},checkActive:function(G){switch(this.type){case n.STYLE_BLOCK:return this.checkElementRemovable(G.block||G.blockLimit,o);case n.STYLE_OBJECT:case n.STYLE_INLINE:for(var K=G.elements,I=0,H;I<K.length;I++){H=K[I];if(!(this.type==n.STYLE_INLINE&&(z._4e_equals(H,G.block)||z._4e_equals(H,G.blockLimit))))if(!(this.type==n.STYLE_OBJECT&&!(H._4e_name()in R)))if(this.checkElementRemovable(H,
o))return o}}return y}};r.getStyleText=function(G){var K=G._ST;if(K)return K;K=G.styles;var I=G.attributes&&G.attributes.style||"",H="";if(I.length)I=I.replace(T,";");for(var J in K){var O=K[J],N=(J+":"+O).replace(T,";");if(O=="inherit")H+=N;else I+=N}if(I.length)I=s(I);I+=H;return G._ST=I};l.Style=r;l.Style=r;var V=r.prototype;l.Utils.extern(V,{apply:V.apply,remove:V.remove,applyToRange:V.applyToRange,removeFromRange:V.removeFromRange,applyToObject:V.applyToObject,checkElementRemovable:V.checkElementRemovable,
checkActive:V.checkActive})});
KISSY.Editor.add("htmlparser",function(){function l(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var p=KISSY,r=function(){},v=p.Editor,u=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,q={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},m=v.XHTML_DTD;p.augment(l,{onTagOpen:r,onTagClose:r,
onText:r,onCDATA:r,onComment:r,parse:function(j){for(var i,b,d=0,e;i=this._.htmlPartsRegex.exec(j);){b=i.index;if(b>d){d=j.substring(d,b);e?e.push(d):this.onText(d)}d=this._.htmlPartsRegex.lastIndex;if(b=i[1]){b=b.toLowerCase();if(e&&m.$cdata[b]){this.onCDATA(e.join(""));e=null}if(!e){this.onTagClose(b);continue}}if(e)e.push(i[0]);else if(b=i[3]){b=b.toLowerCase();if(!/="/.test(b)){var g={},s;i=i[4];var h=!!(i&&i.charAt(i.length-1)=="/");if(i)for(;s=u.exec(i);){var a=s[1].toLowerCase();s=s[2]||s[3]||
s[4]||"";g[a]=!s&&q[a]?a:s}this.onTagOpen(b,g,h);if(!e&&m.$cdata[b])e=[]}}else if(b=i[2])this.onComment(b)}j.length>d&&this.onText(j.substring(d,j.length))}});v.HtmlParser=l;v.HtmlParser=l});
KISSY.Editor.add("htmlparser-basicwriter",function(){function l(){this._={output:[]}}var p=KISSY,r=p.Editor,v=r.Utils;p.augment(l,{openTag:function(u){this._.output.push("<",u)},openTagClose:function(u,q){q?this._.output.push(" />"):this._.output.push(">")},attribute:function(u,q){if(typeof q=="string")q=v.htmlEncodeAttr(q);this._.output.push(" ",u,'="',q,'"')},closeTag:function(u){this._.output.push("</",u,">")},text:function(u){this._.output.push(u)},comment:function(u){this._.output.push("<!--",
u,"--\>")},write:function(u){this._.output.push(u)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(u){var q=this._.output.join("");u&&this.reset();return q}});r.HtmlParser.BasicWriter=l;r.HtmlParser.BasicWriter=l;p=l.prototype;r.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,write:p.write,reset:p.reset,getHtml:p.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function l(){l.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=q;this.sortAttributes=u;this._.indent=q;this._.indentation="";this._.rules={};var m=r.XHTML_DTD,j;for(j in v.mix({},m.$nonBodyContent,m.$block,m.$listItem,m.$tableContent))this.setRules(j,{indent:u,breakBeforeOpen:u,breakAfterOpen:u,breakBeforeClose:!m[j]["#"],breakAfterClose:u});this.setRules("br",
{breakAfterOpen:u});this.setRules("title",{indent:q,breakAfterOpen:q});this.setRules("style",{indent:q,breakBeforeClose:u});this.setRules("pre",{indent:q})}var p=KISSY,r=p.Editor,v=r.Utils,u=true,q=false;p.extend(l,r.HtmlParser.BasicWriter,{openTag:function(m){var j=this._.rules[m];if(this._.indent)this.indentation();else if(j&&j.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",m)},openTagClose:function(m,j){var i=this._.rules[m];if(j)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(i&&i.indent)this._.indentation+=this.indentationChars}i&&i.breakAfterOpen&&this.lineBreak()},attribute:function(m,j){if(typeof j=="string"){this.forceSimpleAmpersand&&(j=j.replace(/&amp;/g,"&"));j=v.htmlEncodeAttr(j)}this._.output.push(" ",m,'="',j,'"')},closeTag:function(m){var j=this._.rules[m];if(j&&j.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(j&&j.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",m,">");j&&j.breakAfterClose&&this.lineBreak()},text:function(m){if(this._.indent){this.indentation();m=v.ltrim(m)}this._.output.push(m)},comment:function(m){this._.indent&&this.indentation();this._.output.push("<!--",m,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=u},indentation:function(){this._.output.push(this._.indentation);this._.indent=q},setRules:function(m,j){var i=this._.rules[m];if(i)v.mix(i,
j);else this._.rules[m]=j}});r.HtmlParser.HtmlWriter=l;r.HtmlParser.HtmlWriter=l;p=l.prototype;r.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,lineBreak:p.lineBreak,indentation:p.indentation,setRules:p.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function l(){this.children=[];this.parent=v;this._={isBlockLike:p,hasInlineStarted:r}}var p=true,r=false,v=null,u=KISSY.Editor,q={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},m=KISSY,j=u.Utils,i=u.NODE,b=u.XHTML_DTD,d=j.mix({table:1,ul:1,ol:1,dl:1},b.table,b.ul,b.ol,b.dl),e=b.$list,g=b.$listItem;l.FromHtml=function(s,h){function a(t){var B;if(o.length>0)for(var D=0;D<o.length;D++){var C=o[D],F=C.name,M=b[F],P=w.name&&b[w.name];
if((!P||P[F])&&(!t||!M||M[t]||!b[t])){if(!B){c();B=1}C=C.clone();C.parent=w;w=C;o.splice(D,1);D--}}}function c(){for(;y.length;)w.add(y.shift())}function f(t,B,D){B=B||w||x;if(h&&!B.type){var C,F;if((C=t.attributes&&(F=t.attributes._ke_real_element_type)?F:t.name)&&!(C in b.$body)&&!(C in b.$nonBodyContent)){C=w;w=B;k.onTagOpen(h,{});B=w;if(D)w=C}}if(t._.isBlockLike&&t.name!="pre"){D=t.children.length;if((C=t.children[D-1])&&C.type==i.NODE_TEXT)if(F=j.rtrim(C.value))C.value=F;else t.children.length=
D-1}B.add(t);if(t.returnPoint){w=t.returnPoint;delete t.returnPoint}}var k=new u.HtmlParser,x=new l,o=[],y=[],w=x,A=r,E;k.onTagOpen=function(t,B,D){var C=new u.HtmlParser.Element(t,B);if(C.isUnknown&&D)C.isEmpty=p;if(b.$removeEmpty[t])o.push(C);else{if(t==="pre")A=p;else if(t==="br"&&A){w.add(new u.HtmlParser.Text("\n"));return}if(t==="br")y.push(C);else{var F=w.name,M=F&&(b[F]||(w._.isBlockLike?b.div:b.span));if(M&&!C.isUnknown&&!w.isUnknown&&!M[t]){M=r;var P;if(t in e&&F in e){F=w.children;(F=F[F.length-
1])&&F.name in g||f(F=new u.HtmlParser.Element("li"),w);E=w;P=F}else if(t==F)f(w,w.parent);else{if(d[F])E||(E=w);else{f(w,w.parent,p);q[F]||o.unshift(w)}M=p}w=P?P:w.returnPoint||w.parent;if(M){k.onTagOpen.apply(this,arguments);return}}a(t);c();C.parent=w;C.returnPoint=E;E=0;if(C.isEmpty)f(C);else w=C}}};k.onTagClose=function(t){for(var B=o.length-1;B>=0;B--)if(t==o[B].name){o.splice(B,1);return}for(var D=[],C=[],F=w;F.type&&F.name!=t;){F._.isBlockLike||C.unshift(F);D.push(F);F=F.parent}if(F.type){for(B=
0;B<D.length;B++){var M=D[B];f(M,M.parent)}w=F;if(w.name=="pre")A=r;F._.isBlockLike&&c();f(F,F.parent);if(F==w)w=w.parent;o=o.concat(C)}if(t=="body")h=r};k.onText=function(t){if(!w._.hasInlineStarted&&!A){t=j.ltrim(t);if(t.length===0)return}c();a();if(h&&(!w.type||w.name=="body")&&j.trim(t))this.onTagOpen(h,{});A||(t=t.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));w.add(new u.HtmlParser.Text(t))};k.onCDATA=function(){};k.onComment=function(t){w.add(new u.HtmlParser.Comment(t))};k.parse(s);for(c();w.type;){var z=
w.parent,n=w;if(h&&(!z.type||z.name=="body")&&!b.$body[n.name]){w=z;k.onTagOpen(h,{});z=w}z.add(n);w=z}return x};m.augment(l,{add:function(s){var h=this.children.length;if(h=h>0&&this.children[h-1]||v){if(s._.isBlockLike&&h.type==i.NODE_TEXT){h.value=j.rtrim(h.value);if(h.value.length===0){this.children.pop();this.add(s);return}}h.next=s}s.previous=h;s.parent=this;this.children.push(s);this._.hasInlineStarted=s.type==i.NODE_TEXT||s.type==i.NODE_ELEMENT&&!s._.isBlockLike},writeHtml:function(s,h){var a;
this.filterChildren=this.filterChildren=function(){var c=new u.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,c,h,p);c=c.getHtml();this.children=(new l.FromHtml(c)).children;a=1};!this.name&&h&&h.onFragment(this);this.writeChildrenHtml(s,a?v:h)},writeChildrenHtml:function(s,h){for(var a=0;a<this.children.length;a++)this.children[a].writeHtml(s,h)}});u.HtmlParser.Fragment=l;u.HtmlParser.Fragment=l;l.FromHtml=l.FromHtml;m=l.prototype;u.Utils.extern(m,{add:m.add,writeHtml:m.writeHtml,writeChildrenHtml:m.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function l(q,m){this.name=q;this.attributes=m||(m={});this.children=[];var j=m._ke_real_element_type||q,i=p.XHTML_DTD;j=!!(i.$nonBodyContent[j]||i.$block[j]||i.$listItem[j]||i.$tableContent[j]||i.$nonEditable[j]||j=="br");var b=!!i.$empty[q];this.isEmpty=b;this.isUnknown=!i[q];this._={isBlockLike:j,hasInlineStarted:b||!j}}var p=KISSY.Editor,r=p.NODE,v=function(q,m){q=q[0];m=m[0];return q<m?-1:q>m?1:0};KISSY.augment(l,{type:r.NODE_ELEMENT,add:p.HtmlParser.Fragment.prototype.add,
clone:function(){return new l(this.name,this.attributes)},writeHtml:function(q,m){var j=this.attributes,i=this,b=i.name,d,e,g,s;i.filterChildren=function(){if(!s){var c=new p.HtmlParser.BasicWriter;p.HtmlParser.Fragment.prototype.writeChildrenHtml.call(i,c,m);i.children=(new p.HtmlParser.Fragment.FromHtml(c.getHtml())).children;s=1}};i.filterChildren=i.filterChildren;if(m){for(;;){if(!(b=m.onElementName(b)))return;i.name=b;if(!(i=m.onElement(i)))return;i.parent=this.parent;if(i.name==b)break;if(i.type!=
r.NODE_ELEMENT){i.writeHtml(q,m);return}b=i.name;if(!b){this.writeChildrenHtml.call(i,q,s?null:m);return}}j=i.attributes}q.openTag(b,j);for(var h=[],a=0;a<2;a++)for(d in j){e=d;g=j[d];if(a==1)h.push([d,g]);else if(m){for(;;)if(e=m.onAttributeName(d))if(e!=d){delete j[d];d=e}else break;else{delete j[d];break}if(e)if((g=m.onAttribute(i,e,g))===false)delete j[e];else j[e]=g}}q.sortAttributes&&h.sort(v);j=h.length;for(a=0;a<j;a++){d=h[a];q.attribute(d[0],d[1])}q.openTagClose(b,i.isEmpty);if(!i.isEmpty){this.writeChildrenHtml.call(i,
q,s?null:m);q.closeTag(b)}},writeChildrenHtml:function(){p.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});p.HtmlParser.Element=l;p.HtmlParser.Element=l;var u=l.prototype;p.Utils.extern(u,{type:u.type,add:u.add,clone:u.clone,writeHtml:u.writeHtml,writeChildrenHtml:u.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function l(d){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};d&&this.addRules(d,10)}function p(d,e){for(var g=0;d&&g<e.length;g++){var s=e[g];d=d.replace(s[0],s[1])}return d}function r(d,e,g){if(typeof e=="function")e=[e];var s,h;h=d.length;var a=e&&e.length;if(a){for(s=0;s<h&&d[s].pri<g;s++);for(h=a-1;h>=0;h--)if(a=e[h]){a.pri=g;d.splice(s,0,a)}}}function v(d,e,g){if(e)for(var s in e){var h=d[s];d[s]=u(h,e[s],
g);h||d.$length++}}function u(d,e,g){if(e){e.pri=g;if(d){if(d.splice)r(d,e,g);else{d=d.pri>g?[e,d]:[d,e];d.filter=q}return d}else return e.filter=e}}function q(d){for(var e=d.type||d instanceof j.HtmlParser.Fragment,g=0;g<this.length;g++){if(e)var s=d.type,h=d.name;var a=this[g].apply(window,arguments);if(a===b)return a;if(e){if(a&&(a.name!=h||a.type!=s))return a}else if(typeof a!="string")return a;a!=undefined&&(d=a)}return d}var m=KISSY,j=m.Editor,i=j.NODE,b=false;m.augment(l,{addRules:function(d,
e){if(typeof e!="number")e=10;r(this._.elementNames,d.elementNames,e);r(this._.attributeNames,d.attributeNames,e);v(this._.elements,d.elements,e);v(this._.attributes,d.attributes,e);this._.text=u(this._.text,d.text,e)||this._.text;this._.comment=u(this._.comment,d.comment,e)||this._.comment;this._.root=u(this._.root,d.root,e)||this._.root},onElementName:function(d){return p(d,this._.elementNames)},onAttributeName:function(d){return p(d,this._.attributeNames)},onText:function(d){var e=this._.text;
return e?e.filter(d):d},onComment:function(d,e){var g=this._.comment;return g?g.filter(d,e):d},onFragment:function(d){var e=this._.root;return e?e.filter(d):d},onElement:function(d){for(var e=[this._.elements["^"],this._.elements[d.name],this._.elements.$],g,s=0;s<3;s++)if(g=e[s]){g=g.filter(d,this);if(g===b)return null;if(g&&g!=d)return this.onNode(g);if(d.parent&&!d.name)break}return d},onNode:function(d){var e=d.type;return e==i.NODE_ELEMENT?this.onElement(d):e==i.NODE_TEXT?new j.HtmlParser.Text(this.onText(d.value)):
null},onAttribute:function(d,e,g){if(e=this._.attributes[e]){d=e.filter(g,d,this);if(d===b)return b;if(typeof d!="undefined")return d}return g}});j.HtmlParser.Filter=l;m=l.prototype;j.Utils.extern(m,{addRules:m.addRules,onElementName:m.onElementName,onAttributeName:m.onAttributeName,onText:m.onText,onComment:m.onComment,onFragment:m.onFragment,onElement:m.onElement,onNode:m.onNode,onAttribute:m.onAttribute});j.HtmlParser.Filter=l});
KISSY.Editor.add("htmlparser-text",function(){function l(u){this.value=u;this._={isBlockLike:v}}var p=KISSY,r=p.Editor,v=false;p.augment(l,{type:r.NODE.NODE_TEXT,writeHtml:function(u,q){var m=this.value;q&&!(m=q.onText(m,this))||u.text(m)}});r.HtmlParser.Text=l;r.HtmlParser.Text=l});
KISSY.Editor.add("htmlparser-comment",function(){function l(v){this.value=v;this._={isBlockLike:false}}var p=KISSY.Editor,r=p.NODE;p.HtmlParser.Comment=l;p.HtmlParser.Comment=l;l.prototype={constructor:l,type:r.NODE_COMMENT,writeHtml:function(v,u){var q=this.value;if(u){if(!(q=u.onComment(q,this)))return;if(typeof q!="string"){q.parent=this.parent;q.writeHtml(v,u);return}}v.comment(q)}}});
KISSY.Editor.add("bubbleview",function(){var l=KISSY.Editor,p=KISSY,r=p.Event,v=p.DOM;if(!l.BubbleView){var u=p.UIBase.create(l.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var m=this._selectedEl,j=m._4e_getOffset(document);j.top+=m.height()+5;u.superclass.show.call(this);this.set("xy",[j.left,j.top])}},{ATTRS:{focus4e:false,zIndex:{value:l.baseZIndex(l.zIndexManager.BUBBLE_VIEW)}}}),q={};u.attach=function(m){var j=m.pluginName;p.mix(m,q[j].cfg,
false);var i=m.pluginContext,b=m.func,d=m.editor,e=m.bubble;d.on("selectionChange",function(g){g=g.path;var s=g.elements;if(g&&s)if(g=g.lastElement)if(g=b(g)){s=q[j];if(!s.bubble){s.bubble=new u({autoRender:true});s.cfg.init&&s.cfg.init.call(s.bubble)}e=s.bubble;e._selectedEl=g;e._plugin=i;e.hide();e.show()}else if(e){e._selectedEl=e._plugin=null;e.hide()}});r.on(v._4e_getWin(d.document),"scroll blur",function(){e&&e.hide()})};u.register=function(m){var j=m.pluginName;q[j]=q[j]||{cfg:m};r.on(document,
"click",function(){m.bubble&&m.bubble.hide()});m.editor&&u.attach(m)};l.BubbleView=u}});
KISSY.Editor.add("button",function(){var l=KISSY,p=l.Editor;if(!p.TripleButton){var r=l.UIBase.create([l.UIBase.Box],{bindUI:function(){var v=this,u=v.get("el");u.on("click",v._action,v);u.on("mousedown",function(){v.get("state")=="off"&&u.addClass("ke-triplebutton-active")});u.on("mouseup mouseleave",function(){v.get("state")=="off"&&u.hasClass("ke-triplebutton-active")&&setTimeout(function(){u.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"))},
_uiSetContentCls:function(v){var u=this.get("el");if(v!==undefined){u.html("<span class='ke-toolbar-item "+v+"'>");u._4e_unselectable()}},_uiSetText:function(v){var u=this.get("el");v!==undefined&&u.html(v)},_uiSetState:function(v){this["_"+v]()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(v){this.fire(this.get("state")+"Click",v);v.type=this.get("state")+"Click";
this.fire("click",v);v.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-disabled");v.addClass("ke-triplebutton-on")},_off:function(){var v=this.get("el");v.removeClass("ke-triplebutton-on ke-triplebutton-disabled");v.addClass("ke-triplebutton-off")},_disabled:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-on");v.addClass("ke-triplebutton-disabled")}},
{ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elAttrs:{value:{hideFocus:true,tabIndex:-1}},elTagName:{value:"a"},title:{},contentCls:{},text:{}}});r.ON="on";r.OFF="off";r.DISABLED="disabled";r.ON_CLASS="ke-triplebutton-on";r.OFF_CLASS="ke-triplebutton-off";r.DISABLED_CLASS="ke-triplebutton-disabled";p.TripleButton=r;p.prototype.addButton=function(v,u){var q=this,m=new r({render:q.toolBarDiv,autoRender:true,title:u.title,text:u.text,contentCls:u.contentCls}),j={btn:m,
editor:q,cfg:u,call:function(){var i=l.makeArray(arguments),b=i.shift();return u[b].apply(j,i)},reload:function(i){l.mix(u,i);m.enable();q.on("selectionChange",function(){q.getMode()!=p.SOURCE_MODE&&u.selectionChange&&u.selectionChange.apply(j,arguments)});m.on("click",function(b){var d=b.type;u[d]&&u[d].apply(j,arguments)});if(u.mode==p.WYSIWYG_MODE){q.on("wysiwygmode",m.enable,m);q.on("sourcemode",m.disable,m)}u.init&&u.init.call(j)}};u.loading?m.disable():j.reload(undefined);return j}}});
KISSY.Editor.add("clipboard",function(l){var p=KISSY,r=p.Editor,v=p.Node,u=p.UA,q=r.Range,m=r.RANGE,j=p.Event;r.Paste||function(){function i(c){this.editor=c;this._init()}function b(c){if(!(!u.ie||c.document.compatMode=="BackCompat")){var f=c.getSelection(),k;if(f.getType()==h.SELECTION_ELEMENT&&(k=f.getSelectedElement())){var x=f.getRanges()[0],o=new v(c.document.createTextNode(""));o.insertBefore(k);x.setStartBefore(o);x.setEndAfter(k);f.selectRanges([x]);setTimeout(function(){if(k.parent()){o.remove();
f.selectElement(k)}},0)}}}p.augment(i,{_init:function(){var c=this.editor;u.ie?j.on(c.document,"keydown",this._paste,this):j.on(c.document,"paste",this._paste,this);c.addCommand("copy",new s("copy"));c.addCommand("cut",new s("cut"));c.addCommand("paste",new s("paste"))},_paste:function(c){if(!(c.type==="keydown"&&!(c.keyCode===86&&(c.ctrlKey||c.metaKey)))){var f=this,k=f.editor,x=k.document;if(f._running)c.halt();else{var o=k.getSelection();c=new q(x);var y=new v(u.webkit?"<body></body>":"<div></div>",
null,x);u.webkit&&y[0].appendChild(x.createTextNode("\u00a0"));x.body.appendChild(y[0]);y.css({position:"absolute",top:o.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});y.css("left","-1000px");var w=o.createBookmarks();c.setStartAt(y,m.POSITION_AFTER_START);c.setEndAt(y,m.POSITION_BEFORE_END);c.select(true);f._running=true;setTimeout(function(){y._4e_remove();var A;y=u.webkit&&(A=y._4e_first())&&A.hasClass("Apple-style-span")?A:y;o.selectBookmarks(w);k.insertHtml(y.html());
f._running=false},0)}}}});r.Paste=i;var d=function(c,f){var k=c.document,x=new v(k.body),o=false,y=function(){o=true};x.on(f,y);(u.ie>7?k:k.selection.createRange()).execCommand(f);x.detach(f,y);return o},e=u.ie?function(c,f){return d(c,f)}:function(c,f){try{return c.document.execCommand(f)}catch(k){return false}},g={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},s=function(c){this.type=
c;this.canUndo=this.type=="cut"};s.prototype={exec:function(c){this.type=="cut"&&b(c);(c=e(c,this.type))||alert(g[this.type]);return c}};var h=r.Selection,a={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};r.on("contextmenu",function(c){var f=c.contextmenu,k=f.cfg.editor,x=f.elDom,o={copy:0,cut:0,paste:0},y;for(y in o){if(!o.hasOwnProperty(y))break;o[y]=x.one(".ke-paste-"+y);(function(w){var A=o[w];if(!A){A=(new v("<a href='#'class='ke-paste-"+w+"'>"+a[w]+"</a>")).appendTo(x);A.on("click",function(E){E.halt();if(!A.hasClass("ke-menuitem-disable")){f.hide();
setTimeout(function(){k.execCommand(w)},30)}})}o[w]=A})(y);c=o[y];(k.document.queryCommandEnabled(y)?true:false)?c.removeClass("ke-menuitem-disable"):c.addClass("ke-menuitem-disable")}})}();l.ready(function(){new r.Paste(l)})});
KISSY.Editor.add("color",function(l){var p=KISSY.Editor;l.ready(function(){var r=l.cfg.pluginConfig;false!==r.forecolor&&function(){var v=l.addButton("color",{styles:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},mode:p.WYSIWYG_MODE,title:"\u6587\u672c\u989c\u8272",loading:true,contentCls:"ke-toolbar-color"});p.use("colorsupport",function(){v.reload(p.ColorSupport)})}();false!==r.bgcolor&&function(){var v=l.addButton("color",{styles:{element:"span",styles:{"background-color":"#(color)"}},
title:"\u80cc\u666f\u989c\u8272",mode:p.WYSIWYG_MODE,loading:true,contentCls:"ke-toolbar-bgcolor"});p.use("colorsupport",function(){v.reload(p.ColorSupport)})}()})});
KISSY.Editor.add("colorsupport",function(){function l(){if(!i){i="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var b=0;b<3;b++){i+="<div class='ke-color-palette'><table>";for(var d=j[b],e=d.length/8,g=0;g<e;g++){i+="<tr>";for(var s=0;s<8;s++){var h="#"+d[8*g+s];i+="<td>";i+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+h+"'></a>";i+="</td>"}i+="</tr>"}i+="</table></div>"}i+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
var p=KISSY,r=p.Editor,v=p.Node,u=p.Event,q=r.Overlay,m=p.DOM;m.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var j=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],i;r.ColorSupport={offClick:function(b){var d=this.cfg,e=this.colorWin;e&&e.get("visible")?e.hide():d._prepare.call(this,b)},_prepare:function(){var b=this,d=b.cfg,e=document,g=b.btn,s=b.editor,h;l();b.colorWin=new q({elCls:"ks-popup",content:i,focus4e:false,autoRender:true,width:"170px",zIndex:s.baseZIndex(r.zIndexManager.POPUP_MENU)});var a=b.colorWin;h=a.get("contentEl");h.on("click",d._selectColor,b);u.on(e,"click",d._hidePanel,b);u.on(s.document,
"click",d._hidePanel,b);a.on("show",g.bon,g);a.on("hide",g.boff,g);h.one(".ke-color-others").on("click",function(c){c.halt();a.hide();s.useDialog("color/dialog",function(f){f.show(b)})});d._prepare=d._show;d._show.call(b)},_show:function(){var b=this.btn.get("el"),d=this.colorWin,e=parseInt(d.get("width")),g=m.viewportWidth();d.align(b,["bl","tl"],[0,2]);d.get("x")+e>g-30&&d.set("x",g-30-e);d.show()},_hidePanel:function(b){var d=this.btn.get("el");b=new v(b.target);var e=this.colorWin;d._4e_equals(b)||
d.contains(b)||e.hide()},_selectColor:function(b){b.halt();var d=this.cfg;b=new v(b.target);if(b._4e_name()=="a"&&!b.hasClass("ke-button")){d._applyColor.call(this,b._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(b){var d=this.editor,e=d.document,g=this.cfg.styles;d.fire("save");b?(new r.Style(g,{color:b})).apply(e):(new r.Style(g,{color:"inherit"})).remove(e);d.fire("save")}}});
KISSY.Editor.add("contextmenu",function(){function l(b){this.cfg=b;r.Utils.lazyRun(this,"_prepareShow","_realShow")}function p(b,d){for(var e=0;e<d.length;e++){var g=d[e];if(v.isFunction(g)){if(g(new u(b)))return true}else if(q.test(b,g))return true}return false}var r=KISSY.Editor,v=KISSY,u=v.Node,q=v.DOM,m=v.Event;if(!r.ContextMenu){l.ATTRS={editor:{}};var j=[];l.register=function(b){var d=new l(b),e=b.editor.document;j.push({doc:e,rules:b.rules||[],instance:d});if(!e.ke_contextmenu){e.ke_contextmenu=
1;m.on(e,"mousedown",l.hide);m.on(e,"contextmenu",function(g){l.hide.call(this);for(var s=new u(g.target);s;){var h=false;if(s._4e_name()=="body")break;for(var a=0;a<j.length;a++){var c=j[a].instance,f=j[a].rules;if(e===j[a].doc&&p(s[0],f)){g.preventDefault();h=true;var k=g.pageX,x=g.pageY;if(!k){a=s._4e_getOffset();k=a.left;x=a.top}setTimeout(function(){c.show(r.Utils.getXY(k,x,e,document))},30);break}}if(h)break;s=s.parent()}})}return d};l.hide=function(){for(var b=0;b<j.length;b++){var d=j[b].instance;
this===j[b].doc&&d.hide()}};var i=r.Overlay;v.augment(l,{_init:function(){var b=this,d=b.cfg,e=d.funcs;b.el=new i({content:"<div>",autoRender:true,width:d.width,elCls:"ke-menu"});b.elDom=b.el.get("contentEl").one("div");d=b.elDom;for(var g in e){var s=new u("<a href='#'>"+g+"</a>");d[0].appendChild(s[0]);(function(h,a){h._4e_unselectable();h.on("click",function(c){b.hide();c.halt();setTimeout(a,30)})})(s,e[g])}},hide:function(){this.el&&this.el.hide()},_realShow:function(b){r.fire("contextmenu",{contextmenu:this});
this.el.set("xy",[b.left,b.top]);this.el.show()},_prepareShow:function(){this._init()},show:function(b){this._prepareShow(b)}});r.ContextMenu=l}});KISSY.Editor.add("draft",function(l){var p=KISSY.Editor;l.ready(function(){p.use("draft/support",function(){p.storeReady(function(){new p.Draft(l)})})})});
KISSY.Editor.add("draft/support",function(){function l(b,d,e){for(b+="";b.length<d;)b=e+b;return b}function p(b){if(v.isNumber(b))b=new Date(b);return b instanceof Date?[b.getFullYear(),"-",l(b.getMonth()+1,2,"0"),"-",l(b.getDate(),2,"0")," ",l(b.getHours(),2,"0"),":",l(b.getMinutes(),2,"0"),":",l(b.getSeconds(),2,"0")].join(""):b}function r(b){this.editor=b;this._init()}var v=KISSY,u=v.Editor,q=v.Node,m=v.Event,j=v.JSON,i=window[u.STORE];v.augment(r,{_init:function(){var b=this,d=b.editor,e=d.statusDiv,
g=d.cfg.pluginConfig;g.draft=g.draft||{};b.draftInterval=g.draft.interval=g.draft.interval||5;b.draftLimit=g.draft.limit=g.draft.limit||5;e=(new q("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+g.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);b.timeTip=(new q("<span class='ke-draft-time'>")).appendTo(e);var s=(new q("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(e),h=new u.Select({container:e,
menuContainer:document.body,doc:d.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),a=i.getItem("ke-draft-save"),c=[];b.versions=h;if(a)c=v.isString(a)?j.parse(decodeURIComponent(a)):a;b.drafts=c;b.sync();s.on("click",function(){b.save(false)});(function(){var f=d.textarea[0].form;f&&m.on(f,"submit",function(){b.save(false)})})();setInterval(function(){b.save(true)},b.draftInterval*60*1E3);h.on("click",b.recover,b);b.holder=e;if(g.draft.helpHtml){g=new u.TripleButton({cls:"ke-draft-help",
title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:e});g.on("click",function(){b._prepareHelp()});u.Utils.lazyRun(b,"_prepareHelp","_realHelp");b.helpBtn=g.el}b._holder=e},_prepareHelp:function(){var b=this,d=b.editor,e=b.helpBtn,g=new q(d.cfg.pluginConfig.draft.helpHtml||""),s=new q("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
g.append(s);g.css({border:"1px solid #ACB4BE","text-align":"left"});b._help=new v.Overlay({content:g,autoRender:true,width:g.width()+"px",mask:false});b._help.el.css("border","none");b._help.arrow=s;m.on([document,d.document],"click",function(h){h=new q(h.target);h[0]==e[0]||e.contains(h)||b._help.hide()})},_realHelp:function(){var b=this._help,d=this.helpBtn,e=b.arrow;b.show();d=d.offset();b.el.offset({left:d.left-b.el.width()+17,top:d.top-b.el.height()-7});e.offset({left:d.left-2,top:d.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var b=this.draftLimit,d=this.timeTip,e=this.versions,g=this.drafts;g.length>b&&g.splice(0,g.length-b);b=[];for(var s,h=0;h<g.length;h++){s=g[h];s=(s.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+p(s.date);b.push({name:s,value:h})}e.set("items",b.reverse());d.html(s);i.setItem("ke-draft-save",encodeURIComponent(j.stringify(g)))},save:function(b){var d=this.drafts,e=this.editor.getData(true);if(e){if(d[d.length-
1]&&e==d[d.length-1].content)d.length-=1;this.drafts=d.concat({content:e,date:(new Date).getTime(),auto:b});this.sync()}},recover:function(b){var d=this.editor,e=this.drafts;b=b.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+p(e[b].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){d.fire("save");d.setData(e[b].content);d.fire("save")}}});u.Draft=r});
KISSY.Editor.add("elementpaths",function(l){var p=KISSY.Editor,r=KISSY,v=r.Node,u=r.DOM;p.ElementPaths||function(){function q(m){this.cfg=m;this._cache=[];this._init()}u.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");r.augment(q,{_init:function(){var m=this.cfg.editor;this.holder=new v("<span>");this.holder.appendTo(m.statusDiv);m.on("selectionChange",this._selectionChange,this);
p.Utils.sourceDisable(m,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(m){var j=this.cfg.editor,i=this.holder;m=m.path.elements;var b,d;b=this._cache;for(d=0;d<b.length;d++){b[d].detach("click");b[d]._4e_remove()}this._cache=[];for(d=0;d<m.length;d++){b=m[d];var e=new v("<a href='#' class='elementpath'>"+(b.attr("_ke_real_element_type")||b._4e_name())+"</a>");this._cache.push(e);(function(g){e.on("click",
function(s){s.halt();j.focus();setTimeout(function(){j.getSelection().selectElement(g)},50)})})(b);i.prepend(e)}}});p.ElementPaths=q}();l.ready(function(){new p.ElementPaths({editor:l})})});
KISSY.Editor.add("enterkey",function(l){var p=KISSY,r=p.Editor,v=p.UA,u=/^h[1-6]$/,q=r.XHTML_DTD,m=p.Node,j=p.Event,i=r.Walker,b=r.ElementPath;r.enterBlock||function(){function d(e){j.on(e.document,"keydown",function(g){if(g.keyCode===13)if(!g.shiftKey){e.fire("save");var s=e.execCommand("enterBlock");e.fire("save");s!==false&&g.preventDefault()}})}d.enterBlock=function(e){var g;g=e.getSelection().getRanges();for(var s=g.length-1;s>0;s--)g[s].deleteContents();g=g[0];s=g.document;if(g.checkStartOfBlock()&&
g.checkEndOfBlock()){var h=(new b(g.startContainer)).block;if(h&&(h._4e_name()=="li"||h.parent()._4e_name()=="li"))if(e.hasCommand("outdent")){e.fire("save");e.execCommand("outdent");e.fire("save");return true}else return false}var a=g.splitBlock("p");if(!a)return true;e=a.previousBlock;h=a.nextBlock;var c=a.wasStartOfBlock,f=a.wasEndOfBlock,k;if(h){k=h.parent();if(k._4e_name()=="li"){h._4e_breakParent(k);h._4e_move(h._4e_next(),true)}}else if(e&&(k=e.parent())&&k._4e_name()=="li"){e._4e_breakParent(k);
g.moveToElementEditablePosition(e._4e_next());e._4e_move(e._4e_previous())}if(!c&&!f){if(h._4e_name()=="li"&&(k=h._4e_first(i.invisible(true)))&&p.inArray(k._4e_name(),["ul","ol"]))(v.ie?new m(s.createTextNode("\u00a0")):new m(s.createElement("br"))).insertBefore(k);h&&g.moveToElementEditablePosition(h)}else{var x;if(e){if(e._4e_name()=="li"||!u.test(e._4e_name()))x=e._4e_clone()}else if(h)x=h._4e_clone();x||(x=new m("<p>",null,s));if(k=a.elementPath){a=0;for(var o=k.elements.length;a<o;a++){var y=k.elements[a];
if(y._4e_equals(k.block)||y._4e_equals(k.blockLimit))break;if(q.$removeEmpty[y._4e_name()]){y=y._4e_clone();x._4e_moveChildren(y);x.append(y)}}}v.ie||x._4e_appendBogus();g.insertNode(x);if(v.ie&&c&&(!f||!e[0].childNodes.length)){g.moveToElementEditablePosition(f?e:x);g.select()}g.moveToElementEditablePosition(c&&!f?h:x)}if(!v.ie)if(h){x=new m(s.createElement("span"));x.html("&nbsp;");g.insertNode(x);x._4e_scrollIntoView();g.deleteContents()}else x._4e_scrollIntoView();g.select();return true};r.EnterKey=
d}();l.ready(function(){l.addCommand("enterBlock",{exec:r.EnterKey.enterBlock});r.EnterKey(l)})});
KISSY.Editor.add("fakeobjects",function(l){var p=KISSY.Editor,r=KISSY,v=r.Node,u=p.NODE,q=p.Config.base+"theme/spacer.gif",m=p.HtmlParser;p=r.Editor;var j=(l=l.htmlDataProcessor)&&l.htmlFilter,i={elements:{$:function(b){var d=b.attributes;if((d=(d=(d=d&&d._ke_realelement)&&new m.Fragment.FromHtml(decodeURIComponent(d)))&&d.children[0])&&b.attributes._ke_resizable){var e=b.attributes.style;if(e){var g=/(?:^|\s)width\s*:\s*(\d+)/i.exec(e);b=g&&g[1];e=(g=/(?:^|\s)height\s*:\s*(\d+)/i.exec(e))&&g[1];
if(b)d.attributes.width=b;if(e)d.attributes.height=e}}return d}}};j&&j.addRules(i);l&&r.mix(l,{createFakeParserElement:function(b,d,e,g,s){var h;h=new m.BasicWriter;b.writeHtml(h);h=h.getHtml();var a=b.attributes.style;if(b.attributes.width)a="width:"+b.attributes.width+"px;"+a;if(b.attributes.height)a="height:"+b.attributes.height+"px;"+a;b={"class":d,src:q,_ke_realelement:encodeURIComponent(h),_ke_real_node_type:b.type,style:a,align:b.attributes.align||""};s&&delete s.width;s&&delete s.height;s&&
r.mix(b,s,false);if(e)b._ke_real_element_type=e;if(g)b._ke_resizable=g;return new m.Element("img",b)}});r.augment(p,{createFakeElement:function(b,d,e,g,s,h){var a=b.attr("style")||"";if(b.attr("width"))a="width:"+b.attr("width")+"px;"+a;if(b.attr("height"))a="height:"+b.attr("height")+"px;"+a;b={"class":d,src:q,_ke_realelement:encodeURIComponent(s||b._4e_outerHtml()),_ke_real_node_type:b[0].nodeType,style:a};h&&delete h.width;h&&delete h.height;h&&r.mix(b,h,false);if(e)b._ke_real_element_type=e;if(g)b._ke_resizable=
g;return new v("<img/>",b,this.document)},restoreRealElement:function(b){if(b.attr("_ke_real_node_type")!=u.NODE_ELEMENT)return null;b=decodeURIComponent(b.attr("_ke_realelement"));var d=new v("<div>",null,this.document);d.html(b);return d._4e_first(function(e){return e[0].nodeType==u.NODE_ELEMENT})._4e_remove()}})});
KISSY.Editor.add("flash",function(l){var p=KISSY,r=p.Editor,v=l.htmlDataProcessor,u=l.cfg.pluginConfig,q=v&&v.dataFilter;q&&q.addRules({elements:{object:function(j){var i=j.attributes;if(!(i.classid&&String(i.classid).toLowerCase())){for(i=0;i<j.children.length;i++)if(j.children[i].name=="embed"){if(!r.Utils.isFlashEmbed(j.children[i]))break;return v.createFakeParserElement(j,"ke_flash","flash",true)}return null}return v.createFakeParserElement(j,"ke_flash","flash",true)},embed:function(j){if(!r.Utils.isFlashEmbed(j))return null;
return v.createFakeParserElement(j,"ke_flash","flash",true)}}},5);var m;if(!u.flash||u.flash.btn!==false)m=l.addButton("flash",{contentCls:"ke-toolbar-flash",title:"\u63d2\u5165Flash",mode:r.WYSIWYG_MODE,loading:true});r.use("flash/support",function(){var j=new r.Flash(l);l.addCommand("insertFlash",{exec:function(){var i=p.makeArray(arguments);return r.Flash.Insert.apply(null,i)}});m&&m.reload({offClick:function(){j.show()}})})});
KISSY.Editor.add("flash/support",function(){function l(g){this.editor=g;this._init()}function p(g){return g._4e_name()==="img"&&!!g.hasClass(b)&&g}var r=KISSY,v=r.Editor,u=r.UA,q=r.Event,m=v.ContextMenu,j=r.Node,i=v.BubbleView,b="ke_flash",d=v.Utils.flash;r.augment(l,{_config:function(){this._cls=b;this._type="flash";this._contextMenu=e;this._flashRules=["img."+b]},_init:function(){this._config();var g=this,s=g.editor,h={},a=g._contextMenu;if(a)for(var c in a)(function(f){h[f]=function(){a[f](g)}})(c);
m.register({editor:s,rules:g._flashRules,width:"120px",funcs:h});i.attach({pluginName:g._type,editor:g.editor,pluginContext:g});q.on(s.document,"dblclick",g._dbclick,g)},_getFlashUrl:function(g){return d.getUrl(g)},_updateTip:function(g,s){var h=this.editor.restoreRealElement(s);if(h){h=this._getFlashUrl(h);g.html(h);g.attr("href",h)}},_dbclick:function(g){var s=new j(g.target);if(s._4e_name()==="img"&&s.hasClass(this._cls)){this.show(null,s);g.halt()}},show:function(g,s){this.editor.useDialog(this._type+
"/dialog",function(h){h.show(s)})}});v.Flash=l;l.registerBubble=function(g,s,h){i.register({pluginName:g,func:h,init:function(){var a=this,c=a.get("contentEl");c.html(s+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var f=c.one(".ke-bubbleview-url"),k=c.one(".ke-bubbleview-change"),x=c.one(".ke-bubbleview-remove");v.Utils.preventFocus(c);k.on("click",
function(o){a._plugin.show(null,a._selectedEl);o.halt()});x.on("click",function(o){var y=a._plugin;if(u.webkit){var w=y.editor.getSelection().getRanges();w&&w[0]&&(w[0].collapse(true)||1)&&w[0].select()}a._selectedEl._4e_remove();a.hide();y.editor.notifySelectionChange();o.halt()});a.on("show",function(){var o=a._selectedEl;o&&a._plugin._updateTip(f,o)})}})};l.registerBubble("flash","Flash \u7f51\u5740\uff1a ",p);l.checkFlash=p;var e={"Flash\u5c5e\u6027":function(g){var s=g.editor.getSelection();s=s&&s.getStartElement();
(s=p(s))&&g.show(null,s)}};l.CLS_FLASH=b;l.TYPE_FLASH="flash";l.Insert=function(g,s,h,a,c,f){s=d.createSWF(s,{attrs:h},g.document);var k=s.el;h=g.createFakeElement?g.createFakeElement(k,a||"ke_flash",c||"flash",true,s.html,h):k;g.insertElement(h,null,f)};v.Flash=l});
KISSY.Editor.add("flashbridge",function(){function l(d){this._init(d)}function p(d){var e=v.isString(d)?d.match(/(\d)+/g):d;d=d;if(v.isArray(e))d=parseFloat(e[0]+"."+r(e[1],3)+r(e[2],5));return d||0}function r(d,e){for(var g=(d+"").length;g++<e;)d="0"+d;return d}var v=KISSY,u=v.Editor;if(!u.FlashBridge){var q={};v.augment(l,v.EventTarget,{_init:function(d){var e=v.guid("flashbridge-");d.flashVars=d.flashVars||{};d.attrs=d.attrs||{};d.params=d.params||{};var g=d.flashVars,s=d.params;v.mix(d.attrs,
{id:e,width:"100%",height:"100%"},false);v.mix(s,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);v.mix(g,{shareData:false,useCompression:false},false);s={YUISwfId:e,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(d.ajbridge)s={swfID:e,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};v.mix(g,s);q[e]=this;this.id=e;this.swf=u.Utils.flash.createSWFRuntime(d.movie,d);this._expose(d.methods)},_expose:function(d){for(var e=this,g=0;g<d.length;g++)(function(s){e[s]=
function(){return e._callSWF(s,v.makeArray(arguments))}})(d[g])},_callSWF:function(d,e){e=e||[];try{if(this.swf[d])return this.swf[d].apply(this.swf,e)}catch(g){var s="";if(e.length!==0)s="'"+e.join("', '")+"'";return(new Function("self","return self.swf."+d+"("+s+");"))(this)}},_eventHandler:function(d){var e=d.type;if(e==="log")v.log(d.message);else e&&this.fire(e,d)},_destroy:function(){delete q[this.id]}});l.EventHandler=function(d,e){var g=q[d];g&&setTimeout(function(){g._eventHandler.call(g,
e)},100)};u.FlashBridge=l;var m=v.UA,j,i,b=true;m.fpv=function(d){if(d||b){b=false;var e;if(navigator.plugins&&navigator.mimeTypes.length)e=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(g){}j=e?e.match(/(\d)+/g):void 0;i=p(j)}return j};m.fpvGEQ=function(d,e){b&&m.fpv(e);return!!i&&i>=p(d)}}});
KISSY.Editor.add("flashutils",function(){var l=KISSY,p=l.Editor,r=p.Utils.flash;if(!r){var v=l.DOM,u=l.Node,q=l.UA;r={getUrl:function(m){var j="",i=p.NODE;if(m._4e_name()=="object"){m=m[0].childNodes;for(var b=0;b<m.length;b++)if(m[b].nodeType==i.NODE_ELEMENT)if((v.attr(m[b],"name")||"").toLowerCase()=="movie")j=v.attr(m[b],"value");else if(v._4e_name(m[b])=="embed")j=v.attr(m[b],"src");else if(v._4e_name(m[b])=="object")j=v.attr(m[b],"data")}else if(m._4e_name()=="embed")j=m.attr("src");return j},
createSWF:function(m,j,i){var b=j.attrs||{},d=j.flashVars,e="",g="";j=j.params||{};var s="";i=i||document;l.mix(b,{wmode:"transparent"});for(var h in b)if(b.hasOwnProperty(h))e+=h+"='"+b[h]+"' ";l.mix(j,{quality:"high",movie:m,wmode:"transparent"});for(var a in j)if(j.hasOwnProperty(a))g+="<param name='"+a+"' value='"+j[a]+"'/>";if(d){for(var c in d)if(d.hasOwnProperty(c))s+="&"+c+"="+encodeURIComponent(d[c]);s=s.substring(1)}m="<object "+e+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
g+(s?'<param name="flashVars" value="'+s+'"/>':"")+"<embed "+e+" "+(s?'FlashVars="'+s+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+m+'"  type="application/x-shockwave-flash"/></object>';return{el:new u(m,null,i),html:m}},createSWFRuntime2:function(m,j,i){i=i||document;var b=(new u("<div style='width:0;height:0;overflow:hidden;'>",null,i)).appendTo(i.body);b=r.createSWF.apply(this,arguments).el.appendTo(b);q.ie||(b=b.one("object"));return b[0]},createSWFRuntime:function(m,
j,i){var b=j.attrs||{},d=j.flashVars||{},e=j.params||{},g="",s="",h="";i=i||document;b.id=b.id||l.guid("ke-runtimeflash-");for(var a in b)if(b.hasOwnProperty(a))g+=a+"='"+b[a]+"' ";for(var c in e)if(e.hasOwnProperty(c))s+="<param name='"+c+"' value='"+e[c]+"'/>";for(var f in d)if(d.hasOwnProperty(f))h+="&"+f+"="+encodeURIComponent(d[f]);h=h.substring(1);m=q.ie?"<object "+g+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+s+'<param name="movie" value="'+m+'" />'+(h?'<param name="flashVars" value="'+
h+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+m+"' "+g+">"+s+(h?'<param name="flashVars" value="'+h+'"/>':"")+"</object>";var k=j.holder;if(!k){k=(new u("<div style='"+(j.style?j.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,i)).appendTo(i.body);setTimeout(function(){k.offset({left:v.scrollLeft(),top:v.scrollTop()})},100)}k.html(m);return i.getElementById(b.id)}};p.Utils.flash=r}});
KISSY.Editor.add("font",function(l){function p(x){for(var o=[],y=0;y<x.length;y++)o.push({name:x[y],value:x[y]});return o}var r=KISSY,v=r.Editor,u=v.Style,q=v.TripleButton,m=l.cfg.pluginConfig,j=r.Node,i=m["font-size"],b,d,e;if(i!==false){i=i||{};r.mix(i,{items:p(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var g={},s=[],h={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(k=0;k<i.items.length;k++){b=
i.items[k];d=b.name;e=b.attrs;b=b.value;g[b]=new u(h,{size:b});s.push({name:d,value:b,attrs:e})}m["font-size"]=i}var a=m["font-family"];if(a!==false){a=a||{};r.mix(a,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},
{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var c={},f=[];h={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};var k;m["font-family"]=a;for(k=0;k<a.items.length;k++){b=a.items[k];d=b.name;e=b.attrs||{};b=b.value;e.style=e.style||"";e.style+=";font-family:"+b;c[b]=new u(h,{family:b});f.push({name:d,value:b,attrs:e})}}v.FontSelect||function(){function x(y){x.superclass.constructor.call(this,y);this._init()}
x.ATTRS={title:{},html:{},styles:{},editor:{}};var o=v.Select;r.extend(x,r.Base,{_init:function(){var y=this.get("editor"),w=y.toolBarDiv;this.get("html");this.el=new o({container:w,doc:y.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new j(document.body)});this.el.on("click",this._vChange,this);y.on("selectionChange",this._selectionChange,this);v.Utils.sourceDisable(y,this)},disable:function(){this.el.set("state",
o.DISABLED)},enable:function(){this.el.set("state",o.ENABLED)},_vChange:function(y){var w=this.get("editor"),A=y.newVal;y=y.prevVal;var E=this.get("styles");w.focus();w.fire("save");E=E[A];if(A==y){E.remove(w.document);this.el.set("value","")}else E.apply(w.document);w.fire("save")},_selectionChange:function(y){this.get("editor");y=y.path.elements;for(var w=this.get("styles"),A=0,E;A<y.length;A++){E=y[A];for(var z in w)if(w[z].checkElementRemovable(E,true)){this.el.set("value",z);return}}this.el.reset("value")}});
v.FontSelect=x}();l.ready(function(){false!==m["font-size"]&&new v.FontSelect({editor:l,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:i.width,styles:g,html:s});false!==m["font-family"]&&new v.FontSelect({editor:l,title:"\u5b57\u4f53",width:"110px",popUpWidth:a.width,styles:c,html:f});var x={mode:v.WYSIWYG_MODE,offClick:function(){var o=this.editor,y=this.cfg.style;o.fire("save");y.apply(o.document);o.fire("save");o.notifySelectionChange();o.focus()},onClick:function(){var o=this.editor,y=this.cfg.style;
o.fire("save");y.remove(o.document);o.fire("save");o.notifySelectionChange();o.focus()},selectionChange:function(o){var y=this.btn;this.cfg.style.checkActive(o.path)?y.set("state",q.ON):y.set("state",q.OFF)}};false!==m["font-bold"]&&l.addButton("font-bold",r.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",style:new u({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},x));false!==m["font-italic"]&&l.addButton("font-italic",r.mix({contentCls:"ke-toolbar-italic",
title:"\u659c\u4f53 ",style:new u({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},x));false!==m["font-underline"]&&l.addButton("font-underline",r.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new u({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})},x));false!==m["font-strikeThrough"]&&l.addButton("font-underline",r.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new u({element:"del",overrides:[{element:"span",
attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})},x))})});
KISSY.Editor.add("format",function(l){var p=KISSY.Editor,r=KISSY,v=r.Node,u=[],q={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},m={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},j={},i=p.Style,b;for(b in q)if(q[b]){j[q[b]]=new i({element:q[b]});u.push({name:b,value:q[b],attrs:{style:"font-size:"+m[q[b]]}})}p.Format||function(){function d(g){d.superclass.constructor.call(this,g);this._init()}d.ATTRS={editor:{}};var e=p.Select;r.extend(d,r.Base,
{_init:function(){var g=this.get("editor");this.el=new e({container:g.toolBarDiv,value:"",doc:g.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new v(document.body)});this.el.on("click",this._vChange,this);g.on("selectionChange",this._selectionChange,this);p.Utils.sourceDisable(g,this)},disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.ENABLED)},_vChange:function(g){var s=this.get("editor"),
h=g.newVal;g=g.prevVal;s.fire("save");if(h!=g)j[h].apply(s.document);else{j.p.apply(s.document);this.el.set("value","p")}s.fire("save")},_selectionChange:function(g){this.get("editor");g=g.path;for(var s in j)if(j[s].checkActive(g)){this.el.set("value",s);break}}});p.Format=d}();l.ready(function(){new p.Format({editor:l,html:u,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(l){function p(h){return h.replace(g,function(a,c,f,k,x){return k=="src"&&s.test(a)?a:"<"+c+f+" _ke_saved_"+f+x+">"})}var r=r,v=KISSY,u=v.Editor,q=v.Node,m=v.UA,j=u.NODE,i=u.HtmlParser,b=new i.Filter,d=new i.Filter,e=u.XHTML_DTD;if(!l.htmlDataProcessor){(function(){var h=u.HtmlParser.Fragment.prototype,a=u.HtmlParser.Element.prototype;h.onlyChild=a.onlyChild=function(){var c=this.children;return c.length==1&&c[0]||null};a.removeAnyChildWithName=function(c){for(var f=
this.children,k=[],x,o=0;o<f.length;o++){x=f[o];if(x.name){if(x.name==c){k.push(x);f.splice(o--,1)}k=k.concat(x.removeAnyChildWithName(c))}}return k};a.getAncestor=function(c){for(var f=this.parent;f&&!(f.name&&f.name.match(c));)f=f.parent;return f};h.firstChild=a.firstChild=function(c){for(var f,k=0;k<this.children.length;k++){f=this.children[k];if(c(f))return f;else if(f.name)if(f=f.firstChild(c))return f}return null};a.addStyle=function(c,f,k){var x="";if(typeof f=="string")x+=c+":"+f+";";else{if(typeof c==
"object")for(var o in c){if(c.hasOwnProperty(o))x+=o+":"+c[o]+";"}else x+=c;k=f}if(!this.attributes)this.attributes={};c=this.attributes.style||"";c=(k?[x,c]:[c,x]).join(";");this.attributes.style=c.replace(/^;|;(?=;)/,"")};e.parentOf=function(c){var f={},k;for(k in this)if(k.indexOf("$")==-1&&this[k][c])f[k]=1;return f}})();(function(){function h(z){if(/mso-list\s*:\s*Ignore/i.test(z.attributes&&z.attributes.style))return true;return r}function a(z,n){var t=new u.HtmlParser.Element("ke:listbullet"),
B;if(z)if(z[2]){z=isNaN(z[1])?/^[a-z]+$/.test(z[1])?"lower-alpha":/^[A-Z]+$/.test(z[1])?"upper-alpha":"decimal":"decimal";B="ol"}else{z=/[l\u00B7\u2002]/.test(z[1])?"disc":/[\u006F\u00D8]/.test(z[1])?"circle":/[\u006E\u25C6]/.test(z[1])?"square":"disc";B="ul"}else{z="decimal";B="ol"}t.attributes={"ke:listtype":B,style:"list-style-type:"+z+";"};t.add(new u.HtmlParser.Text(n));return t}function c(z){var n=z.attributes,t;if((t=z.removeAnyChildWithName("ke:listbullet"))&&t.length&&(t=t[0])){z.name="ke:li";
if(n.style)n.style=f([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!o&&y&&B>y)o=B-y;n["ke:margin"]=y=B}]],r)(n.style,z)||"";t=t.attributes;z.addStyle(t.style);v.mix(n,t);return true}return false}function f(z,n){return function(t,B){var D=[];t.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(F,M,P){M=M.toLowerCase();M=="font-family"&&(P=P.replace(/["']/g,""));for(var L,Q,R,T=0;T<z.length;T++)if(z[T]){F=
z[T][0];L=z[T][1];Q=z[T][2];R=z[T][3];if(M.match(F)&&(!L||P.match(L))){M=R||M;n&&(Q=Q||P);if(typeof Q=="function")Q=Q(P,B,M);if(Q&&Q.push){M=Q[0];Q=Q[1]}typeof Q=="string"&&D.push([M,Q]);return}}!n&&D.push([M,P])});for(var C=0;C<D.length;C++)D[C]=D[C].join(":");return D.length?D.join(";")+";":false}}function k(z){z=z.children;for(var n,t,B,D,C,F,M,P=0;P<z.length;P++){n=z[P];if("ke:li"==n.name){n.name="li";n=n;t=n.attributes;B=n.attributes["ke:listtype"];D=parseInt(t["ke:indent"],10)||o&&Math.ceil(t["ke:margin"]/
o)||1;t.style&&(t.style=f([["list-style-type",B=="ol"?"decimal":"disc"]],r)(t.style)||"");if(F){if(D>M){F=new u.HtmlParser.Element(B);F.add(n);C.add(F)}else{if(D<M){C=M-D;for(var L;C--&&(L=F.parent);)F=L.parent}F.add(n)}z.splice(P--,1)}else{F=new u.HtmlParser.Element(B);F.add(n);z[P]=F}C=n;M=D}else F=null}o=0}var x=f([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],r),o,y=0,w=e.parentOf("ol"),A={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,
""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(z){z.filterChildren();k(z)},elements:{font:function(z){delete z.name},p:function(z){z.filterChildren();if(c(z))return r},$:function(z){var n=z.name||"";n.indexOf(":")!=-1&&n.indexOf("ke")==-1&&delete z.name;var t=z.attributes.style;if(n=="span"&&(!t||!x(t)))delete z.name;if(n in w){z.filterChildren();k(z)}},span:function(z){if(!m.gecko&&h(z.parent))return false;if(!m.gecko&&h(z)){z=(z=z.firstChild(function(t){return t.value||
t.name=="img"}))&&(z.value||"l.");var n=z.match(/^([^\s]+?)([.)]?)$/);return a(n,z)}}},comment:!m.ie?function(z,n){var t=z.match(/<img.*?>/),B=z.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(t=B[1]||t&&"l.")&&t.match(/>([^\s]+?)([.)]?)</);return a(B,t)}if(m.gecko&&t){t=u.HtmlParser.Fragment.FromHtml(t[0]).children[0];(B=(B=(B=n.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(t.attributes.src=B);return t}return false}:function(){return false},attributes:{"class":function(z){if(/(^|\s+)ke_/.test(z))return z;
return false},style:function(z){z=x(z);if(!z)return false;return z}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},E={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{$:function(z){var n=z.attributes;if(n)for(var t=["name","href","src"],B,D=0;D<t.length;D++){B="_ke_saved_"+t[D];B in n&&delete n[t[D]]}return z},embed:function(z){var n=z.parent;if(n&&n.name=="object"){var t=n.attributes.width;n=n.attributes.height;t&&(z.attributes.width=t);n&&(z.attributes.height=n)}},param:function(z){z.children=
[];z.isEmpty=true;return z},a:function(z){if(!(z.children.length||z.attributes.name||z.attributes._ke_saved_name))return false},td:function(z){for(var n=z.children,t=0;t<n.length;t++)if(n[t].name=="br"){n.splice(t,1);--t}if(!z.children.length){n=new u.HtmlParser.Text("&nbsp;");z.children.push(n)}},span:function(z){if(!z.children.length)return false}},attributes:{style:function(z){if(!v.trim(z))return false}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(m.ie)E.attributes.style=
function(z){return z.toLowerCase()};b.addRules(E);d.addRules(A)})();(function(){function h(E){for(var z=E.children.length,n=E.children[z-1];n&&n.type==j.NODE_TEXT&&!v.trim(n.value);)n=E.children[--z];return n}function a(E){var z=h(E);return!z||z.type==j.NODE_ELEMENT&&z.name=="br"||E.name=="form"&&z.name=="input"}function c(E,z){var n=E.children,t=h(E);if(t){if((z||!m.ie)&&t.type==j.NODE_ELEMENT&&t.name=="br")n.pop();t.type==j.NODE_TEXT&&x.test(t.value)&&n.pop()}}function f(E){c(E,true);if(a(E))m.ie?
E.add(new u.HtmlParser.Text("\u00a0")):E.add(new u.HtmlParser.Element("br",{}))}function k(E){c(E);a(E)&&E.add(new u.HtmlParser.Text("\u00a0"))}var x=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,o=u.XHTML_DTD,y=u.Utils.mix({},o.$block,o.$listItem,o.$tableContent),w;for(w in y)"br"in o[w]||delete y[w];delete y.pre;o={elements:{}};var A={elements:{}};for(w in y){o.elements[w]=f;A.elements[w]=k}d.addRules(o);b.addRules(A)})();(function(){b.addRules({text:function(h){return h.replace(/\xa0/g,"&nbsp;")}})})();var g=/<((?:a|area|img|input)[\s\S]*?\s)((href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+)))([^>]*)>/gi,
s=/\s_cke_saved_src\s*=/;l.htmlDataProcessor={htmlFilter:b,dataFilter:d,toHtml:function(h,a){var c=new i.HtmlWriter;i.Fragment.FromHtml(h,a).writeHtml(c,b);return c.getHtml(true)},toDataFormat:function(h,a){if(m.gecko)h=h.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");h=p(h);var c=new q("<div>");c.html("a"+h);h=c.html().substr(1);c=new i.BasicWriter;var f=i.Fragment.FromHtml(h,a);c.reset();f.writeHtml(c,d);return c.getHtml(true)},toServer:function(h,a){var c=new i.BasicWriter;
i.Fragment.FromHtml(h,a).writeHtml(c,b);return c.getHtml(true)}}}});
KISSY.Editor.add("image",function(l){var p=KISSY,r=p.Editor,v=p.UA,u=p.Node,q=p.Event,m=r.BubbleView,j=function(i){return i._4e_name()==="img"&&!/(^|\s+)ke_/.test(i[0].className)&&i};l.ready(function(){var i=l.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:r.WYSIWYG_MODE,offClick:function(){this.call("show")},_updateTip:function(g,s){var h=s.attr("src");g.html(h);g.attr("href",h)},show:function(g,s){this.editor.useDialog("image/dialog",function(h){h.show(s)})}}),b={"\u56fe\u7247\u5c5e\u6027":function(g){g=
(g=g.getSelection())&&g.getStartElement();(g=j(g))&&i.call("show",null,g)}},d={},e;for(e in b)(function(g){d[g]=function(){b[g](l)}})(e);r.ContextMenu.register({editor:l,rules:[j],width:"120px",funcs:d});q.on(l.document,"dblclick",function(g){var s=new u(g.target);g.halt();j(s)&&i.call("show",null,s)});m.register({pluginName:"image",pluginContext:i,editor:l,func:j,init:function(){var g=this,s=g.get("contentEl");s.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=s.one(".ke-bubbleview-url"),a=s.one(".ke-bubbleview-change"),c=s.one(".ke-bubbleview-remove");r.Utils.preventFocus(s);a.on("click",function(f){g._plugin.call("show",null,g._selectedEl);f.halt()});c.on("click",function(f){var k=g._plugin;if(v.webkit){var x=k.editor.getSelection().getRanges();x&&x[0]&&(x[0].collapse(true)||1)&&x[0].select()}g._selectedEl._4e_remove();g.hide();k.editor.notifySelectionChange();f.halt()});g.on("show",function(){var f=g._selectedEl;f&&g._plugin.call("_updateTip",
h,f)})}})})});
KISSY.Editor.add("indent",function(l){var p=KISSY.Editor;l.ready(function(){var r=l.addButton("outdent",{title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent",type:"outdent",loading:true}),v=l.addButton("indent",{title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-indent",type:"indent",loading:true});p.use("indent/support",function(){r.reload(p.IndentSupport);v.reload(p.IndentSupport)});l.addCommand("indent",{exec:function(){v.call("offClick")}});l.addCommand("outdent",{exec:function(){r.call("offClick")}})})});
KISSY.Editor.add("indent/support",function(){function l(h){this.type=h;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function p(h){return h[0].nodeType==e.NODE_ELEMENT&&h._4e_name()=="li"}function r(h,a){for(var c=h.startContainer,f=h.endContainer;c&&!c.parent()._4e_equals(a);)c=c.parent();for(;f&&!f.parent()._4e_equals(a);)f=f.parent();if(c&&f){var k=c;c=[];for(var x=false;!x;){if(k._4e_equals(f))x=true;c.push(k);k=k.next()}if(!(c.length<1)){k=a._4e_parents(true);
for(f=0;f<k.length;f++)if(q[k[f]._4e_name()]){a=k[f];break}k=this.type=="indent"?1:-1;f=c[0];x=c[c.length-1];c={};var o=u.ListUtils.listToArray(a,c),y=o[x.data("listarray_index")].indent;for(f=f.data("listarray_index");f<=x.data("listarray_index");f++){o[f].indent+=k;var w=o[f].parent;o[f].parent=new b(w[0].ownerDocument.createElement(w._4e_name()))}for(f=x.data("listarray_index")+1;f<o.length&&o[f].indent>y;f++)o[f].indent+=k;x=u.ListUtils.arrayToList(o,c,null,"p",0);k=[];if(this.type=="outdent"){var A;
if((A=a.parent())&&A._4e_name()=="li"){o=x.listNode.childNodes;var E;for(f=o.length-1;f>=0;f--)if((E=new b(o[f]))&&E._4e_name()=="li")k.push(E)}}if(x){i.insertBefore(x.listNode,a);a._4e_remove()}if(k&&k.length)for(f=0;f<k.length;f++){for(x=E=k[f];(x=x.next())&&x._4e_name()in q;){d.ie&&!E._4e_first(function(z){return g(z)&&s(z)})&&E[0].appendChild(h.document.createTextNode("\u00a0"));E[0].appendChild(x[0])}i.insertAfter(E[0],A[0])}u.Utils.clearAllMarkers(c)}}}function v(h){var a=parseInt(h._4e_style(this.indentCssProperty),
10);if(isNaN(a))a=0;a+=(this.type=="indent"?1:-1)*this.indentOffset;if(a<0)return false;a=Math.max(a,0);a=Math.ceil(a/this.indentOffset)*this.indentOffset;h.css(this.indentCssProperty,a?a+this.indentUnit:"");h[0].style.cssText===""&&h.removeAttr("style");return true}var u=KISSY.Editor,q={ol:1,ul:1},m=KISSY,j=u.Walker,i=m.DOM,b=m.Node,d=m.UA,e=u.NODE,g=j.whitespaces(true),s=j.bookmark(false,true);m.augment(l,{exec:function(h){for(var a=(h=h.getSelection())&&h.getRanges()[0],c=a.startContainer,f=a.endContainer,
k=a.getCommonAncestor();k&&!(k[0].nodeType==e.NODE_ELEMENT&&q[k._4e_name()]);)k=k.parent();if(k&&c[0].nodeType==e.NODE_ELEMENT&&c._4e_name()in q){c=new j(a);c.evaluator=p;a.startContainer=c.next()}if(k&&f[0].nodeType==e.NODE_ELEMENT&&f._4e_name()in q){c=new j(a);c.evaluator=p;a.endContainer=c.previous()}f=h.createBookmarks(true);if(k){for(c=k._4e_first();c&&c._4e_name()!="li";)c=c.next();var x=a.startContainer;(c[0]==x[0]||c.contains(x))&&v.call(this,k)||r.call(this,a,k)}else{a=a.createIterator();
a.enforceRealBlocks=true;for(a.enlargeBr=true;k=a.getNextParagraph();)v.call(this,k)}h.selectBookmarks(f)}});u.IndentSupport={init:function(){this.indentCommand=new l(this.cfg.type)},offClick:function(){var h=this,a=h.editor;a.fire("save");setTimeout(function(){h.indentCommand.exec(a);a.fire("save");a.notifySelectionChange()},10)},selectionChange:function(h){if(this.cfg.type=="outdent"){var a=h.path,c=a.blockLimit;h=this.btn;if(a.contains(q))h.boff();else(a=a.block||c)&&a._4e_style(this.indentCommand.indentCssProperty)?
h.boff():h.disable()}}}});
KISSY.Editor.add("justify",function(l){var p=KISSY,r=p.Editor,v=r.TripleButton,u=/(-moz-|-webkit-|start|auto)/gi;l.ready(function(){var q={mode:r.WYSIWYG_MODE,offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var m=this.editor,j=m.getSelection(),i=this.btn.get("state");if(j){var b=j.createBookmarks(),d=j.getRanges(),e,g;m.fire("save");for(var s=d.length-1;s>=0;s--){e=d[s].createIterator();for(e.enlargeBr=true;g=e.getNextParagraph();){g.removeAttr("align");i==
v.OFF?g.css("text-align",this.cfg.v):g.css("text-align","")}}m.notifySelectionChange();j.selectBookmarks(b);m.fire("save")}},selectionChange:function(m){var j=this.btn;m=m.path;m=m.block||m.blockLimit;if(!m||m._4e_name()==="body")j.boff();else(m.css("text-align").replace(u,"")||"left")==this.cfg.v?j.bon():j.boff()}};l.addButton("alignleft",p.mix({contentCls:"ke-toolbar-alignleft",title:"\u5de6\u5bf9\u9f50",v:"left"},q));l.addButton("aligncenter",p.mix({contentCls:"ke-toolbar-aligncenter",title:"\u5c45\u4e2d\u5bf9\u9f50",v:"center"},
q));l.addButton("alignright",p.mix({contentCls:"ke-toolbar-alignright",title:"\u53f3\u5bf9\u9f50",v:"right"},q))})});
KISSY.Editor.add("link",function(l){function p(i){return i._4e_ascendant(function(b){return b._4e_name()==="a"&&!!b.attr("href")},true)}var r=KISSY,v=r.Editor,u=r.Node,q=v.Style,m=v.BubbleView,j={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};l.ready(function(){var i=l.addButton("link",{contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:v.WYSIWYG_MODE,_getSelectedLink:function(){var b=this.editor.getSelection();if(b=b&&b.getStartElement())b=
p(b);return b},_getSelectionLinkUrl:function(){var b=this.cfg._getSelectedLink.call(this);if(b)return b.attr("_ke_saved_href")||b.attr("href")},_removeLink:function(b){var d=this.editor;d.fire("save");var e=d.getSelection(),g=e.getRanges()[0];if(g&&g.collapsed){g=e.createBookmarks();b._4e_remove(true);e.selectBookmarks(g)}else if(g){b=b[0];e=b.attributes;g={};for(var s=0;s<e.length;s++){var h=e[s];if(h.specified)g[h.name]=h.value}if(b.style.cssText)g.style=b.style.cssText;(new q(j,g)).remove(d.document)}d.fire("save");
d.notifySelectionChange()},_link:function(b){var d=this.editor,e=this.cfg._getSelectedLink.call(this);b._ke_saved_href=b.href;if(e){d.fire("save");e.attr(b);d.fire("save")}else{e=(e=d.getSelection())&&e.getRanges()[0];if(!e||e.collapsed){b=new u("<a>"+b.href+"</a>",b,d.document);d.insertElement(b)}else{d.fire("save");(new q(j,b)).apply(d.document);d.fire("save")}}d.notifySelectionChange()},offClick:function(){var b=this;b.editor.useDialog("link/dialog",function(d){d.show(b)})}});m.register({pluginName:"link",
editor:l,pluginContext:i,func:p,init:function(){var b=this,d=b.get("contentEl");d.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var e=d.one(".ke-bubbleview-url"),g=d.one(".ke-bubbleview-change"),s=d.one(".ke-bubbleview-remove");v.Utils.preventFocus(d);g.on("click",function(h){b._plugin.call("offClick");h.halt()});s.on("click",function(h){b._plugin.call("_removeLink",
b._selectedEl);h.halt()});b.on("show",function(){var h=b._selectedEl;if(h){h=h.attr("_ke_saved_href")||h.attr("href");e.html(h);e.attr("href",h)}})}})})});KISSY.Editor.add("list",function(l){var p=KISSY.Editor;l.ready(function(){var r=l.addButton("ul",{title:"\u9879\u76ee\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ul",loading:true,type:"ul"}),v=l.addButton("ol",{title:"\u7f16\u53f7\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ol",loading:true,type:"ol"});p.use("list/support",function(){r.reload(p.ListSupport);v.reload(p.ListSupport)})})});
KISSY.Editor.add("list/support",function(){function l(h){this.type=h}var p=KISSY.Editor,r={ol:1,ul:1},v=["ol","ul"],u=KISSY,q=p.RANGE,m=p.ElementPath,j=p.Walker,i=p.NODE,b=u.UA,d=u.Node,e=u.DOM,g={listToArray:function(h,a,c,f,k){if(!r[h._4e_name()])return[];f||(f=0);c||(c=[]);for(var x=0,o=h[0].childNodes.length;x<o;x++){var y=new d(h[0].childNodes[x]);if(y._4e_name()=="li"){var w={parent:h,indent:f,element:y,contents:[]};if(k)w.grandparent=k;else{w.grandparent=h.parent();if(w.grandparent&&w.grandparent._4e_name()==
"li")w.grandparent=w.grandparent.parent()}a&&y._4e_setMarker(a,"listarray_index",c.length);c.push(w);for(var A=0,E=y[0].childNodes.length,z;A<E;A++){z=new d(y[0].childNodes[A]);z[0].nodeType==i.NODE_ELEMENT&&r[z._4e_name()]?g.listToArray(z,a,c,f+1,w.grandparent):w.contents.push(z)}}}return c},arrayToList:function(h,a,c,f){c||(c=0);if(!h||h.length<c+1)return null;for(var k=h[c].parent[0].ownerDocument,x=k.createDocumentFragment(),o=null,y=c,w=Math.max(h[c].indent,0),A=null;;){var E=h[y];if(E.indent==
w){if(!o||h[y].parent._4e_name()!=o._4e_name()){o=h[y].parent._4e_clone(false,true);x.appendChild(o[0])}A=o[0].appendChild(E.element._4e_clone(false,true)[0]);for(var z=0;z<E.contents.length;z++)A.appendChild(E.contents[z]._4e_clone(true,true)[0]);y++}else if(E.indent==Math.max(w,0)+1){y=g.arrayToList(h,null,y,f);A.appendChild(y.listNode);y=y.nextIndex}else if(E.indent==-1&&!c&&E.grandparent){if(r[E.grandparent._4e_name()])A=E.element._4e_clone(false,true)[0];else if(E.grandparent._4e_name()!="td"){A=
k.createElement(f);E.element._4e_copyAttributes(new d(A))}else A=k.createDocumentFragment();for(z=0;z<E.contents.length;z++){o=E.contents[z]._4e_clone(true,true);A.nodeType==i.NODE_DOCUMENT_FRAGMENT&&E.element._4e_copyAttributes(new d(o));A.appendChild(o[0])}if(A.nodeType==i.NODE_DOCUMENT_FRAGMENT&&y!=h.length-1){A.lastChild&&A.lastChild.nodeType==i.NODE_ELEMENT&&A.lastChild.getAttribute("type")=="_moz"&&e._4e_remove(A.lastChild);e._4e_appendBogus(A)}if(A.nodeType==i.NODE_ELEMENT&&e._4e_name(A)==
f&&A.firstChild){e._4e_trim(A);o=A.firstChild;if(o.nodeType==i.NODE_ELEMENT&&e._4e_isBlockBoundary(o)){o=k.createDocumentFragment();e._4e_moveChildren(A,o);A=o}}o=e._4e_name(A);if(!b.ie&&(o=="div"||o=="p"))e._4e_appendBogus(A);x.appendChild(A);o=null;y++}else return null;if(h.length<=y||Math.max(h[y].indent,0)<w)break}if(a)for(h=new d(x.firstChild);h&&h[0];){h[0].nodeType==i.NODE_ELEMENT&&h._4e_clearMarkers(a,true);h=h._4e_nextSourceNode()}return{listNode:x,nextIndex:y}}},s=/^h[1-6]$/;l.prototype=
{changeListType:function(h,a,c,f){var k=g.listToArray(a.root,c,undefined,undefined,undefined),x=[];for(h=0;h<a.contents.length;h++){var o=a.contents[h];o=o._4e_ascendant("li",true);if(!(!o||!o[0]||o.data("list_item_processed"))){x.push(o);o._4e_setMarker(c,"list_item_processed",true)}}o=new d(a.root[0].ownerDocument.createElement(this.type));for(h=0;h<x.length;h++){var y=x[h].data("listarray_index");k[y].parent=o}c=g.arrayToList(k,c,null,"p");var w;k=c.listNode.childNodes.length;for(h=0;h<k&&(w=new d(c.listNode.childNodes[h]));h++)w._4e_name()==
this.type&&f.push(w);e.insertBefore(c.listNode,a.root);a.root._4e_remove()},createList:function(h,a,c){var f=a.contents;h=a.root[0].ownerDocument;var k=[];if(f.length==1&&f[0][0]===a.root[0]){var x=new d(h.createElement("div"));f[0][0].nodeType!=i.NODE_TEXT&&f[0]._4e_moveChildren(x);f[0][0].appendChild(x[0]);f[0]=x}a=a.contents[0].parent();for(x=0;x<f.length;x++)a=a._4e_commonAncestor(f[x].parent());for(x=0;x<f.length;x++)for(var o=f[x],y;y=o.parent();){if(y[0]===a[0]){k.push(o);break}o=y}if(!(k.length<
1)){f=new d(k[k.length-1][0].nextSibling);x=new d(h.createElement(this.type));for(c.push(x);k.length;){c=k.shift();o=new d(h.createElement("li"));if(s.test(c._4e_name()))o[0].appendChild(c[0]);else{c._4e_copyAttributes(o);c._4e_moveChildren(o);c._4e_remove()}x[0].appendChild(o[0]);b.ie||o._4e_appendBogus()}f[0]?e.insertBefore(x,f):a.append(x)}},removeList:function(h,a,c){function f(z){if((A=new d(w[z?"firstChild":"lastChild"]))&&!(A[0].nodeType==i.NODE_ELEMENT&&A._4e_isBlockBoundary())&&(E=a.root[z?
"_4e_previous":"_4e_next"](j.whitespaces(true)))&&!(A[0].nodeType==i.NODE_ELEMENT&&E._4e_isBlockBoundary({br:1})))e[z?"insertBefore":"insertAfter"](h.document.createElement("br"),A)}for(var k=g.listToArray(a.root,c,undefined,undefined,undefined),x=[],o=0;o<a.contents.length;o++){var y=a.contents[o];y=y._4e_ascendant("li",true);if(!(!y||y.data("list_item_processed"))){x.push(y);y._4e_setMarker(c,"list_item_processed",true)}}y=null;for(o=0;o<x.length;o++){y=x[o].data("listarray_index");k[y].indent=
-1;y=y}for(o=y+1;o<k.length;o++)if(k[o].indent>Math.max(k[o-1].indent,0)){x=k[o-1].indent+1-k[o].indent;for(y=k[o].indent;k[o]&&k[o].indent>=y;){k[o].indent+=x;o++}o--}var w=g.arrayToList(k,c,null,"p").listNode,A,E;f(true);f(undefined);e.insertBefore(w,a.root);a.root._4e_remove()},exec:function(h){var a=h.getSelection(),c=a&&a.getRanges();if(!(!c||c.length<1)){for(var f=a.createBookmarks(true),k=[],x={};c.length>0;){var o=c.shift(),y=o.getBoundaryNodes(),w=y.startNode,A=y.endNode;w[0].nodeType==i.NODE_ELEMENT&&
w._4e_name()=="td"&&o.setStartAt(y.startNode,q.POSITION_AFTER_START);A[0].nodeType==i.NODE_ELEMENT&&A._4e_name()=="td"&&o.setEndAt(y.endNode,q.POSITION_BEFORE_END);o=o.createIterator();for(o.forceBrBreak=false;y=o.getNextParagraph();)if(!y.data("list_block")){y._4e_setMarker(x,"list_block",1);A=new m(y);var E=A.elements,z=null,n=false,t=A.blockLimit,B;for(w=E.length-1;w>=0&&(B=E[w]);w--)if(r[B._4e_name()]&&t.contains(B)){t.removeData("list_group_object");if(w=B.data("list_group_object"))w.contents.push(y);
else{w={root:B,contents:[y]};k.push(w);B._4e_setMarker(x,"list_group_object",w)}n=true;break}if(!n){A=t||A.block;if(A.data("list_group_object"))A.data("list_group_object").contents.push(y);else{w={root:A,contents:[y]};A._4e_setMarker(x,"list_group_object",w);k.push(w)}}}}for(c=[];k.length>0;){w=k.shift();if(this.state=="off")if(r[w.root._4e_name()])this.changeListType(h,w,x,c);else{p.Utils.clearAllMarkers(x);this.createList(h,w,c)}else this.state=="on"&&r[w.root._4e_name()]&&this.removeList(h,w,x)}for(w=
0;w<c.length;w++){z=c[w];var D=this;(h=function(C){var F=z[C?"_4e_previous":"_4e_next"](j.whitespaces(true));if(F&&F[0]&&F._4e_name()==D.type){F._4e_remove();F._4e_moveChildren(z,C?true:false)}})();h(true)}p.Utils.clearAllMarkers(x);a.selectBookmarks(f)}}};p.ListUtils=g;p.ListSupport={init:function(){this.listCommand=new l(this.cfg.type)},selectionChange:function(h){var a=this.cfg.type,c=h.path,f;h=this.btn;var k=c.blockLimit;c=c.elements;if(k){if(c)for(var x=0;x<c.length&&(f=c[x])&&f[0]!==k[0];x++){var o=
u.indexOf(c[x]._4e_name(),v);if(o!==-1)if(v[o]===a){h.bon();return}else break}h.boff()}},offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var h=this.editor,a=this.btn;h.fire("save");this.listCommand.state=a.get("state");this.listCommand.exec(h);h.fire("save");h.notifySelectionChange()}}});
KISSY.Editor.add("localstorage",function(){var l=KISSY,p=l.Editor,r;r=p.STORE="localStorage";if(!p.storeReady){p.storeReady=function(u){p.on("storeReady",u)};p.on("storeReady",function(){p.storeReady=function(u){u()};p.detach("storeReady")})}if(window[r])window[r]._ke||p.fire("storeReady");else{var v=p.Config.base+p.Utils.debugUrl("plugins/localstorage/swfstore.swf?rand="+ +new Date);window[r]=new p.FlashBridge({movie:v,methods:["setItem","removeItem","getValueOf"]});l.mix(window[r],{_ke:1,getItem:function(u){return this.getValueOf(u)}});
window[r].on("contentReady",function(){p.fire("storeReady")})}});KISSY.Editor.add("maximize",function(l){var p=KISSY,r=p.Editor;p.UA.gecko<1.92||l.ready(function(){var v=l.addButton("maximize",{title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize",loading:true});r.use("maximize/support",function(){v.reload(r.Maximize)})})});
KISSY.Editor.add("maximize/support",function(){var l=KISSY.Editor,p=KISSY,r=p.UA,v=p.Node,u=p.Event,q=p.DOM,m;q.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");var j={};p.mix(j,{onClick:function(){var i=this,b=i.editor;i._resize&&u.remove(window,"resize",i._resize);i.call("_saveEditorStatus");i.call("_restoreState");i.btn.boff();setTimeout(function(){i.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("restoreWindow")},30)},_restoreState:function(){var i=document,b=this.editor,
d=this._savedParents;if(d){for(var e=0;e<d.length;e++){var g=d[e];g.el.css("position",g.position)}this._savedParents=null}b.wrap.css({height:this.iframeHeight});q.css(i.body,{width:"",height:"",overflow:""});i.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:this.editorWrapWidth});m.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);i=this.btn.get("el");i.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");i.attr("title",
"\u5168\u5c4f");r.ie<8&&this.editor.toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var i=this.editor,b=[],d=i.editorWrap;this.iframeHeight=i.wrap._4e_style("height");this.editorWrapWidth=d._4e_style("width");this.scrollLeft=q.scrollLeft();this.scrollTop=q.scrollTop();window.scrollTo(0,0);for(i=d.parent();i;){d=i.css("position");if(d!="static"){b.push({el:i,position:d});i.css("position","static")}i=i.parent()}this._savedParents=b;b=this.btn.get("el");b.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
b.attr("title","\u53d6\u6d88\u5168\u5c4f");r.ie<8&&this.editor.toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var i=this.editor;this.savedRanges=null;if(r.gecko&&i.iframeFocus)this.savedRanges=(i=i.getSelection())&&i.getRanges()},_restoreEditorStatus:function(){var i=this.editor,b=i.getSelection(),d=this.savedRanges;i.activateGecko();d&&b&&b.selectRanges(d);if(i.iframeFocus&&b)(i=b.getStartElement())&&i[0]&&i._4e_scrollIntoView();r.ie<8&&this.btn.get("el").one("span").css("background-image",
"")},_maximize:function(i){var b=document,d=this.editor,e=d.editorWrap,g=q.viewportHeight(),s=q.viewportWidth(),h=d.statusDiv?d.statusDiv[0].offsetHeight:0,a=d.toolBarDiv[0].offsetHeight;if(r.ie)b.body.style.overflow="hidden";else q.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:d.baseZIndex(l.zIndexManager.MAXIMIZE),width:s+"px"});m.css({zIndex:d.baseZIndex(l.zIndexManager.MAXIMIZE-5),height:g+"px",width:s+"px"});e.offset({left:0,
top:0});m.css({left:0,top:0});d.wrap.css({height:g-h-a+"px"});i!==true&&arguments.callee.call(this,true)},_real:function(){var i=this,b=i.editor;i.call("_saveEditorStatus");i.call("_saveSate");i.call("_maximize");i._resize=i._resize||l.Utils.buffer(i.cfg._maximize,i,100);u.on(window,"resize",i._resize);i.btn.bon();setTimeout(function(){i.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("maximizeWindow")},30)},offClick:function(){m||(m=(new v("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(document.body));
this.call("_real")}});l.Maximize=j});
KISSY.Editor.add("music",function(l){var p=KISSY.Editor,r=l.htmlDataProcessor,v=r&&r.dataFilter;v&&v.addRules({elements:{object:function(q){var m=q.attributes;if(!(m.classid&&String(m.classid).toLowerCase())){for(m=0;m<q.children.length;m++)if(q.children[m].name=="embed"){if(!p.Utils.isFlashEmbed(q.children[m]))break;if(q.children[m].attributes.src.indexOf("niftyplayer.swf")!=-1)return r.createFakeParserElement(q,"ke_music","music",true)}return null}for(m=0;m<q.children.length;m++){var j=q.children[m];
if(j.name=="param"&&j.attributes.name=="movie")if(j.attributes.value.indexOf("niftyplayer.swf")!=-1)return r.createFakeParserElement(q,"ke_music","music",true)}},embed:function(q){if(!p.Utils.isFlashEmbed(q))return null;if(q.attributes.src.indexOf("niftyplayer.swf")!=-1)return r.createFakeParserElement(q,"ke_music","music",true)}}},4);var u=l.addButton("music",{contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u97f3\u4e50",mode:p.WYSIWYG_MODE,loading:true});p.use("music/support",function(){var q=new p.MusicInserter(l);
u.reload({offClick:function(){q.show()}})})});
KISSY.Editor.add("music/support",function(){function l(d){l.superclass.constructor.apply(this,arguments);d.cfg.disableObjectResizing||u.on(d.document.body,m.ie?"resizestart":"resize",function(e){(new r.Node(e.target)).hasClass(j)&&e.preventDefault()})}function p(d){return d._4e_name()==="img"&&!!d.hasClass(j)&&d}var r=KISSY,v=r.Editor,u=r.Event,q=v.Flash,m=r.UA,j="ke_music",i=["img."+j];r.extend(l,q,{_config:function(){this._cls=j;this._type="music";this._contextMenu=b;this._flashRules=i}});q.registerBubble("music",
"\u97f3\u4e50\u7f51\u5740\uff1a ",p);v.MusicInserter=l;var b={"\u97f3\u4e50\u5c5e\u6027":function(d){var e=d.editor.getSelection();(e=(e=e&&e.getStartElement())&&p(e))&&d.show(null,e)}}});
KISSY.Editor.add("ext-focus",function(){function l(){}var p=KISSY,r=p.UA,v=p.Editor,u=v.focusManager;v.namespace("UIBase");l.ATTRS={focus4e:{value:true}};l.prototype={_uiSetFocus4e:function(q){if(q){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){},__renderUI:function(){},__bindUI:function(){this._focus4e=(new p.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},
_show4FocusExt:function(){var q=this._focusEditor=u.currentInstance();if(r.ie&&q){window.focus();document.body.focus();this._focus4e[0].focus();var m=q.document.selection.createRange();if(m)if(m.item&&m.item(0).ownerDocument==q.document){q=document.body.createTextRange();q.moveToElementText(this.get("el")._4e_first()[0]);q.collapse(true);q.select()}}},_hide4FocusExt:function(){var q=this._focusEditor;q&&q.focus()}};v.UIBase.Focus=l},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var l=KISSY,p=l.UIBase,r=l.Editor;if(!r.Overlay){var v=p.create(l.Overlay,[r.UIBase.Focus],{init:function(){},syncUI:function(){r.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:r.baseZIndex(r.zIndexManager.OVERLAY)}}}),u=p.create(l.Dialog,[r.UIBase.Focus],{show:function(){this.center();var m=this.get("y");if(m-l.DOM.scrollTop()>200){m=l.DOM.scrollTop()+200;this.set("y",m)}u.superclass.show.call(this)}},{ATTRS:{constrain:{value:true},zIndex:{value:r.baseZIndex(r.zIndexManager.OVERLAY)}}});
r.Overlay=v;r.Dialog=u;var q;r.Overlay.loading=function(){q||(q=new r.Overlay({x:0,focus4e:false,width:l.UA.ie==6?l.DOM.docWidth():"100%",y:0,zIndex:r.baseZIndex(r.zIndexManager.LOADING),elCls:"ke-global-loading"}));q.set("height",l.DOM.docHeight());q.show();q.loading()};r.Overlay.unloading=function(){q&&q.hide()}}});
KISSY.Editor.add("pagebreak",function(l){var p=KISSY,r=p.Editor,v=p.Node,u=l.htmlDataProcessor;(p=u&&u.dataFilter)&&p.addRules({elements:{div:function(q){var m=q.attributes;var j=(m=m&&m.style)&&q.children.length==1&&q.children[0];if((j=j&&j.name=="span"&&j.attributes.style)&&/page-break-after\s*:\s*always/i.test(m)&&/display\s*:\s*none/i.test(j))return u.createFakeParserElement(q,"ke_pagebreak","div")}}});l.ready(function(){l.addButton("page-break",{title:"\u5206\u9875",mode:r.WYSIWYG_MODE,contentCls:"ke-toolbar-pagebreak",
offClick:function(){var q=this.editor,m=new v('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,q.document);m=q.createFakeElement?q.createFakeElement(m,"ke_pagebreak","div",false,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'):m;var j=q.getSelection();if(j=j&&j.getRanges()[0]){q.fire("save");for(var i=j.startContainer,b=i;i._4e_name()!=="body";){b=i;i=i.parent()}j.collapse(true);j.splitElement(b);m.insertAfter(b);
q.fire("save")}}})})});
KISSY.Editor.add("preview",function(l){l.ready(function(){l.addButton("preview",{title:"\u9884\u89c8",contentCls:"ke-toolbar-preview",offClick:function(){var p=this.editor,r=640,v=420,u=80;try{var q=window.screen;r=Math.round(q.width*0.8);v=Math.round(q.height*0.7);u=Math.round(q.width*0.1)}catch(m){}p=p._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+p.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");r=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+r+
",height="+v+",left="+u);v=r.document;v.open();v.write(p);v.close();r.focus()}})})});
KISSY.Editor.add("progressbar",function(){function l(){l.superclass.constructor.apply(this,arguments);this._init()}var p=KISSY,r=p.Editor;if(!r.ProgressBar){var v=p.Node;p.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
l.ATTRS={container:{},width:{},height:{},progress:{value:0}};p.extend(l,p.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var u=this.get("height"),q=new v("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+u+";'></div>"),m=this.get("container");u=(new v("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(u)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(q);var j=(new v("<span class='ke-progressbar-title'>")).appendTo(q);
m&&q.appendTo(m);this.el=q;this._title=j;this._p=u;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(u){u=u.newVal;this._p.css("width",u+"%");this._title.html(u+"%")}});r.ProgressBar=l}});
KISSY.Editor.add("removeformat",function(l){function p(i,b){for(var d=0;d<b.length;d++)i.removeAttr(b[d])}var r=KISSY.Editor,v=r.RANGE,u=r.ElementPath,q=r.NODE,m="class,style,lang,width,height,align,hspace,valign".split(/,/),j=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");l.ready(function(){l.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:r.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var i=
this.editor;j.lastIndex=0;var b=i.getSelection().getRanges();i.fire("save");for(var d=0,e;e=b[d];d++)if(!e.collapsed){e.enlarge(v.ENLARGE_ELEMENT);var g=e.createBookmark(),s=g.startNode,h=g.endNode,a=function(c){for(var f=new u(c),k=f.elements,x=1,o;o=k[x];x++){if(o._4e_equals(f.block)||o._4e_equals(f.blockLimit))break;j.test(o._4e_name())&&c._4e_breakParent(o)}};a(s);a(h);for(s=s._4e_nextSourceNode(true,q.NODE_ELEMENT);s;){if(s._4e_equals(h))break;a=s._4e_nextSourceNode(false,q.NODE_ELEMENT);s._4e_name()==
"img"&&s.attr("_ke_realelement")||(j.test(s._4e_name())?s._4e_remove(true):p(s,m));s=a}e.moveToBookmark(g)}i.getSelection().selectRanges(b);i.fire("save")}})})});
KISSY.Editor.add("resize",function(l){var p=KISSY,r=p.Node;l.ready(function(){p.use("dd",function(){var v=p.Draggable,u=l.statusDiv,q=new r("<div class='ke-resizer'>"),m=l.cfg.pluginConfig.resize||{};m=m.direction||["x","y"];q.appendTo(u);l.on("maximizeWindow",function(){q.css("display","none")});l.on("restoreWindow",function(){q.css("display","")});v=new v({node:q});var j=0,i=0,b=l.wrap,d=l.editorWrap;v.on("dragstart",function(){j=b.height();i=d.width()});v.on("drag",function(e){var g=e.left-this.startNodePos.left;
e=e.top-this.startNodePos.top;p.inArray("y",m)&&b.height(j+e);p.inArray("x",m)&&d.width(i+g)})})})});
KISSY.Editor.add("select",function(){function l(j){l.superclass.constructor.call(this,j);this._init()}var p=KISSY,r=p.Node,v=p.Event,u=p.DOM,q=p.Editor;if(!q.Select){l.DISABLED=0;l.ENABLED=1;var m=q.XHTML_DTD;l.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var j=this.el.parent();j;){var i=j._4e_name();if(m[i]&&m[i].div)return j;j=j.parent()}return new r(document.body)}},state:{value:1}};l.decorate=
function(j){for(var i=j.width(),b=[],d=j.all("option"),e=0;e<d.length;e++){var g=d[e];b.push({name:u.html(g),value:u.attr(g,"value")})}return new l({width:i+"px",el:j,items:b,cls:"ke-combox",value:j.val()})};p.extend(l,p.Base,{_init:function(){var j=this.get("container"),i=this.get("el"),b=new r("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
d=this.get("title")||"",e=this.get("cls"),g=b.one(".ke-select-text"),s=b.one(".ke-select-text-inner");b.one(".ke-select-drop");this.get("value")!==undefined?s.html(this._findNameByV(this.get("value"))):s.html(d);g.css("width",this.get("width"));b._4e_unselectable();d&&b.attr("title",d);e&&b.addClass(e);if(i)i[0].parentNode.replaceChild(b[0],i[0]);else j&&b.appendTo(j);b.on("click",this._click,this);this.el=b;this.title=s;this._focusA=b.one("a.ke-select");q.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(j){var i=this.get("title")||"",b=this.get("items");if(this.get("showValue"))return j||i;for(var d=0;d<b.length;d++){var e=b[d];if(e.value==j){i=e.name;break}}return i},_valueChange:function(j){this.title.html(this._findNameByV(j.newVal))},_itemsChange:function(j){j=j.newVal;var i=this._selectList;i.html("");if(j)for(var b=0;b<j.length;b++){var d=j[b];(new r("<a class='ke-select-menu-item' href='#' data-value='"+
d.value+"'>"+d.name+"</a>",d.attrs)).appendTo(i)._4e_unselectable()}this.as=i.all("a")},val:function(j){if(j!==undefined){this.set("value",j);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){function j(h){h=new r(h.target);b.contains(h)||b._4e_equals(h)||g.hide()}var i=this,b=i.el,d=i.get("popUpWidth"),e=i._focusA,g=new q.Overlay({autoRender:true,render:i.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:d?
d:b.width(),zIndex:q.baseZIndex(q.zIndexManager.SELECT),focusMgr:false}),s=i.get("items");d=g.get("contentEl").one("div");i.menu=g;v.on(window,"resize",i._resize,i);i.get("title")&&(new r("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+i.get("title")+"</div>")).appendTo(d);i._selectList=(new r("<div>")).appendTo(d);i._itemsChange({newVal:s});g.on("show",function(){e.addClass("ke-select-active")});g.on("hide",function(){e.removeClass("ke-select-active")});v.on(document,
"click",j);i.get("doc")&&v.on(i.get("doc"),"click",j);d.on("click",i._select,i);i.as=i._selectList.all("a");v.on(d[0],"mouseenter",function(){i.as.removeClass("ke-menu-selected")});i.on("afterItemsChange",i._itemsChange,i);i.menuNode=d},_stateChange:function(j){var i=this.el;j.newVal==1?i.removeClass("ke-select-disabled"):i.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(j){j.halt();var i=this.menu,b=this.menuNode;if(j=
(new r(j.target))._4e_ascendant(function(g){return b.contains(g)&&g._4e_name()=="a"},true)){var d=this.get("value"),e=j.attr("data-value");this.set("value",e);this.fire("click",{newVal:e,prevVal:d,name:j.html()});i.hide()}},_real:function(){var j=this.el,i=j.offset(),b=p.clone(i),d=this.menu.get("el").height(),e=this.menu.get("el").width(),g=u.scrollTop(),s=u.scrollLeft(),h=u.viewportHeight(),a=u.viewportWidth();a=s+a-60;h=g+h;var c=i.top+(j.height()-2);j=i.left+j.width()-2;var f=this.get("align"),
k=f[0];if(f[1]=="b"){i.top=c;if(i.top+d>h&&b.top-g>h-c)i.top=b.top-d}else{i.top=b.top-d;if(i.top<g&&b.top-g<h-c)i.top=c}if(k=="l"){if(i.left+e>a&&j-s>a-b.left)i.left=j-e}else{i.left=j-e;if(i.left<s&&j-s<a-b.left)i.left=b.left}this.menu.set("xy",[i.left,i.top]);this.menu.show()},_click:function(j){j.preventDefault();j=this.el;var i=this.get("value");if(!j.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();i&&this.menu&&this.as.each(function(b){b.attr("data-value")==
i?b.addClass("ke-menu-selected"):b.removeClass("ke-menu-selected")})}}});q.Select=l}});KISSY.Editor.add("separator",function(l){l.ready(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(l.toolBarDiv)})});KISSY.Editor.add("smiley",function(l){var p=KISSY.Editor;l.ready(function(){var r=l.addButton("smiley",{contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",mode:p.WYSIWYG_MODE,loading:true});p.use("smiley/support",function(){r.reload(p.SmileySupport)})})});
KISSY.Editor.add("smiley/support",function(){var l=KISSY,p=l.Event,r=l.Editor,v=l.DOM;v.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");var u;r.SmileySupport={_selectSmiley:function(q){q.halt();
var m=this.editor;q=new l.Node(q.target);var j;if(q._4e_name()=="a"&&(j=q.attr("data-icon"))){j=new l.Node("<img class='ke_smiley'alt='' src='"+j+"'/>",null,m.document);m.insertElement(j);this.smileyWin.hide()}},_hidePanel:function(q){var m=this.btn.get("el");q=new l.Node(q.target);var j=this.smileyWin;m._4e_equals(q)||m.contains(q)||j.hide()},_show:function(){var q=this.smileyWin;q&&q.get("visible")?q.hide():this.call("_prepare")},_prepare:function(){var q=this.cfg,m=this.btn,j=this.editor,i;if(!u){u=
"<div class='ke-smiley-sprite'>";for(i=0;i<=98;i++)u+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+i+".gif'></a>";u+="</div>"}i=u;i=this.smileyWin=new r.Overlay({content:i,focus4e:false,width:"297px",autoRender:true,elCls:"ks-popup",zIndex:j.baseZIndex(r.zIndexManager.POPUP_MENU),mask:false});this.smileyPanel=i.get("contentEl");i.on("show",m.bon,m);i.on("hide",m.boff,m);this.smileyPanel.on("click",q._selectSmiley,this);p.on(document,"click",q._hidePanel,this);p.on(j.document,
"click",q._hidePanel,this);this.cfg._prepare=this.cfg._real;this.call("_real")},_real:function(){var q=this.btn.get("el"),m=q.offset();m.top+=q.height()+5;if(m.left+this.smileyPanel.width()>v.viewportWidth()-60)m.left=v.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[m.left,m.top]);this.smileyWin.show()},offClick:function(){this.call("_prepare")},onClick:function(){this.call("_prepare")}}});
KISSY.Editor.add("sourcearea",function(l){var p=KISSY.Editor;KISSY.UA.gecko<1.92||l.ready(function(){var r=p.SOURCE_MODE,v=p.WYSIWYG_MODE;l.addButton("sourcearea",{title:"\u6e90\u7801",contentCls:"ke-toolbar-source",init:function(){var u=this.btn,q=this.editor;q.on("wysiwygmode",u.boff,u);q.on("sourcemode",u.bon,u)},offClick:function(){this.editor.execCommand("sourceAreaSupport",r)},onClick:function(){this.editor.execCommand("sourceAreaSupport",v)}})})});
KISSY.Editor.add("sourcearea/support",function(l){var p=KISSY,r=p.Editor,v=p.UA;r.SourceAreaSupport||function(){function u(){var j=this.mapper={};j[q]=this._show;j[m]=this._hide}var q=r.SOURCE_MODE,m=r.WYSIWYG_MODE;p.augment(u,{exec:function(j,i){var b=this.mapper;b[i]&&b[i].call(this,j)},_show:function(j){j.textarea.val(j.getData(true));this._showSource(j);j.fire("sourcemode")},_showSource:function(j){var i=j.textarea,b=j.iframe;i.css("display","");b.css("display","none");v.ieEngine<8&&i.css("height",
j.wrap.css("height"));i[0].focus()},_hideSource:function(j){var i=j.textarea;j.iframe.css("display","");i.css("display","none")},_hide:function(j){var i=j.textarea;this._hideSource(j);j.fire("save");j.setData(i.val());j.fire("wysiwygmode");j.fire("save");v.gecko&&j.activateGecko()}});r.SourceAreaSupport=new u}();l.addCommand("sourceAreaSupport",r.SourceAreaSupport)});
KISSY.Editor.add("table",function(l){var p=KISSY,r=p.Editor,v=p.trim,u=(p.UA.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border"),q=l.htmlDataProcessor;
p=q&&q.dataFilter;q=q&&q.htmlFilter;p&&p.addRules({elements:{table:function(m){m=m.attributes;var j=m["class"],i=parseInt(m.border,10);if(!i||i<=0)m["class"]=(j||"")+" ke_show_border"}}});q&&q.addRules({elements:{table:function(m){m=m.attributes;var j=m["class"];if(j)m["class"]=v(j.replace("ke_show_border","").replace(/\s{2}/," "))}}});l.ready(function(){var m=l.addButton("table",{contentCls:"ke-toolbar-table",mode:r.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c",loading:true});r.use("table/support",function(){var j=
new r.TableUI(l);m.reload({offClick:function(){j._tableShow()}})});l.addCustomStyle(u)})});
KISSY.Editor.add("table/support",function(){function l(a){var c=this,f={},k;for(k in h)(function(x){f[x]=function(){a.fire("save");h[x](c);a.fire("save")}})(k);d.ContextMenu.register({editor:a,rules:g,width:"120px",funcs:f});c.editor=a}function p(a){function c(E){if(!(x.length>0))if(E[0].nodeType==e.NODE_ELEMENT&&s.test(E._4e_name())&&!E.data("selected_cell")){E._4e_setMarker(o,"selected_cell",true);x.push(E)}}for(var f=a.createBookmarks(),k=a.getRanges(),x=[],o={},y=0;y<k.length;y++){var w=k[y];
if(w.collapsed){w=w.getCommonAncestor();(w=w._4e_ascendant("td",true)||w._4e_ascendant("th",true))&&x.push(w)}else{w=new Walker(w);var A;for(w.guard=c;A=w.next();)if((A=A.parent())&&s.test(A._4e_name())&&!A.data("selected_cell")){A._4e_setMarker(o,"selected_cell",true);x.push(A)}}}d.Utils.clearAllMarkers(o);a.selectBookmarks(f);return x}function r(a,c){var f=a.getStartElement()._4e_ascendant("tr");if(f){var k=f._4e_clone(true);k.insertBefore(f);f=(c?k[0]:f[0]).cells;for(k=0;k<f.length;k++){f[k].innerHTML=
"";i.ie||(new b(f[k]))._4e_appendBogus()}}}function v(a){if(a instanceof d.Selection){var c=p(a),f=c.length;a=[];for(var k,x,o=0;o<f;o++){var y=c[o].parent(),w=y[0].rowIndex;!o&&(k=w-1);a[w]=y;o==f-1&&(x=w+1)}o=y._4e_ascendant("table");k=new b(x<o[0].rows.length&&o[0].rows[x]||k>0&&o[0].rows[k]||o[0].parentNode);for(o=a.length;o>=0;o--)a[o]&&v(a[o]);return k}else if(a instanceof b){o=a._4e_ascendant("table");o[0].rows.length==1?o._4e_remove():a._4e_remove()}return 0}function u(a,c){var f=a.getStartElement();
if(f=f._4e_ascendant("td",true)||f._4e_ascendant("th",true))for(var k=f._4e_ascendant("table"),x=f[0].cellIndex,o=0;o<k[0].rows.length;o++){var y=k[0].rows[o];if(!(y.cells.length<x+1)){f=new b(y.cells[x].cloneNode(false));i.ie||f._4e_appendBogus();y=new b(y.cells[x]);c?f.insertBefore(y):f.insertAfter(y)}}}function q(a){if(a instanceof d.Selection){var c=p(a),f,k=[];a=c[0]&&c[0]._4e_ascendant("table");var x,o,y;x=0;for(o=c.length;x<o;x++)k.push(c[x][0].cellIndex);k.sort();x=1;for(o=k.length;x<o;x++)if(k[x]-
k[x-1]>1){y=k[x-1]+1;break}y||(y=k[0]>0?k[0]-1:k[k.length-1]+1);k=a[0].rows;x=0;for(o=k.length;x<o;x++)if(f=k[x].cells[y])break;f=f?new b(f):a._4e_previous();for(y=c.length-1;y>=0;y--)c[y]&&q(c[y]);return f}else if(a instanceof b){c=a._4e_ascendant("table");if(!c)return null;f=a[0].cellIndex;for(y=c[0].rows.length-1;y>=0;y--){a=new b(c[0].rows[y]);if(!f&&a[0].cells.length==1)v(a);else a[0].cells[f]&&a[0].removeChild(a[0].cells[f])}}return null}function m(a,c){var f=new d.Range(a[0].ownerDocument);
if(!f.moveToElementEditablePosition(a,c?true:undefined)){f.selectNodeContents(a);f.collapse(c?false:true)}f.select(true)}var j=KISSY,i=j.UA,b=j.Node,d=j.Editor,e=d.NODE,g=["tr","th","td","tbody","table"];j.augment(l,{_tableShow:function(a,c,f){this.editor.useDialog("table/dialog",function(k){k.show(c,f)})}});var s=/^(?:td|th)$/,h={"\u8868\u683c\u5c5e\u6027":function(a){var c=a.editor.getSelection(),f=c&&c.getStartElement();if(c=f&&f._4e_ascendant("table",true)){f=f._4e_ascendant(function(k){k=k._4e_name();return k==
"td"||k=="th"},true);a._tableShow(null,c,f)}},"\u5220\u9664\u8868\u683c":function(a){var c=(a=a.editor.getSelection())&&a.getStartElement();if(c=c&&c._4e_ascendant("table",true)){a.selectElement(c);var f=a.getRanges()[0];f.collapse();a.selectRanges([f]);a=c.parent();a[0].childNodes.length==1&&a._4e_name()!="body"&&a._4e_name()!="td"?a._4e_remove():c._4e_remove()}},"\u5220\u9664\u884c ":function(a){a=a.editor.getSelection();m(v(a),undefined)},"\u5220\u9664\u5217 ":function(a){a=a.editor.getSelection();(a=q(a))&&m(a,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(a){a=a.editor.getSelection();
r(a,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(a){a=a.editor.getSelection();r(a,undefined)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(a){a=a.editor.getSelection();u(a,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(a){a=a.editor.getSelection();u(a,undefined)}};d.TableUI=l});
KISSY.Editor.add("tabs",function(){function l(q){this.cfg=q;this._init()}var p=KISSY,r=p.Editor,v=p.DOM,u=p.Node;if(!r.Tabs){p.augment(l,p.EventTarget,{_init:function(){var q=this,m=q.cfg,j=m.tabs,i=m.contents.children("div"),b=j.children("li");j.on("click",function(d){d=new u(d.target);if(d=d._4e_ascendant(function(g){return g._4e_name()==="li"&&j.contains(g)},true)){b.removeClass("ke-tab-selected");var e=d.attr("rel");d.addClass("ke-tab-selected");i.hide();v.show(i[p.indexOf(d[0],b)]);q.fire(e)}})},
getTab:function(q){var m=this.cfg,j=m.tabs;m=m.contents.children("div");j=j.children("li");for(var i=0;i<j.length;i++){var b=new u(j[i]),d=new u(m[i]);if(p.isNumber(q)&&q==i||p.isString(q)&&q==b.attr("rel"))return{tab:b,content:d}}},remove:function(q){q=this.getTab(q);q.tab.remove();q.content.remove()},_getActivate:function(){for(var q=this.cfg.tabs.children("li"),m=0;m<q.length;m++){var j=new u(q[m]);if(j.hasClass("ke-tab-selected"))return j.attr("rel")}},activate:function(q){if(arguments.length==
0)return this._getActivate();var m=this.cfg,j=m.tabs;m=m.contents.children("div");j.children("li").removeClass("ke-tab-selected");m.hide();j=this.getTab(q);j.tab.addClass("ke-tab-selected");j.content.show()}});r.Tabs=l}});
KISSY.Editor.add("templates",function(l){var p=KISSY,r=p.Editor,v=p.Node;p.DOM.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");l.ready(function(){l.addButton("templates",{contentCls:"ke-toolbar-template",
title:"\u6a21\u677f",mode:r.WYSIWYG_MODE,offClick:function(){this.cfg._prepare.call(this)},_prepare:function(){for(var u=this.editor,q=u.cfg.pluginConfig.templates||[],m="<div class='ke-tpl'>",j=0;j<q.length;j++)m+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+q[j].demo+"</a>";m+="</div>";var i=new r.Dialog({width:500,mask:true,autoRender:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:m});i.get("el").all(".ke-tpl-list").on("click",function(b){b.halt();b=(new v(b.target))._4e_index();b!=-1&&u.insertHtml(q[b].html);
i.hide()});this.ui=i;this.cfg.show.call(this);this.cfg._prepare=this.cfg.show},show:function(){this.ui.show()}})})});
KISSY.Editor.add("undo",function(l){var p=KISSY,r=p.Editor,v=r.Utils.arrayCompare,u=p.UA,q=p.Event;r.UndoManager||function(){function m(d){var e=d._getRawData(),g;if(e)g=d.getSelection();this.contents=e;this.bookmarks=g&&g.createBookmarks2(true)}function j(d){this.history=[];this.index=-1;this.editor=d;this.bufferRunner=r.Utils.buffer(this.save,this,500);this._init()}p.augment(m,{equals:function(d){if(this.contents!=d.contents)return false;var e=this.bookmarks;d=d.bookmarks;if(e||d){if(!e||!d||e.length!=
d.length)return false;for(var g=0;g<e.length;g++){var s=e[g],h=d[g];if(s.startOffset!=h.startOffset||s.endOffset!=h.endOffset||!v(s.start,h.start)||!v(s.end,h.end))return false}}return true}});var i={16:1,17:1,18:1},b={37:1,38:1,39:1,40:1,33:1,34:1};p.augment(j,{_keyMonitor:function(){var d=this.editor;q.on([d.document,d.textarea],"keydown",function(e){var g=e.keyCode;if(!(g in b||g in i))if(g===90&&(e.ctrlKey||e.metaKey)){d.fire("restore",{d:-1});e.halt()}else if(g===89&&(e.ctrlKey||e.metaKey)){d.fire("restore",
{d:1});e.halt()}else d.fire("save",{buffer:1})})},_init:function(){var d=this,e=d.editor;e.on("save",function(g){if(e.getMode()==r.WYSIWYG_MODE)g.buffer?d.bufferRunner():d.save()});e.on("restore",function(g){e.getMode()==r.WYSIWYG_MODE&&d.restore(g)});d._keyMonitor()},save:function(){var d=this.history,e=this.index;d.length>e+1&&d.splice(e+1,d.length-e-1);var g=this.editor;e=d[d.length-1];var s=new m(g);if(!e||!e.equals(s)){d.length===30&&d.shift();d.push(s);this.index=e=d.length-1;g.fire("afterSave",
{history:d,index:e})}},restore:function(d){d=d.d;var e=this.history,g=this.editor,s=e[this.index+d];if(s){g._setRawData(s.contents);if(s.bookmarks)g.getSelection().selectBookmarks(s.bookmarks);else if(u.ie){s=g.document.body.createTextRange();s.collapse(true);s.select()}(s=g.getSelection())&&s.scrollIntoView();this.index+=d;g.fire("afterRestore",{history:e,index:this.index});g.notifySelectionChange()}}});r.UndoManager=j}();l.ready(function(){new r.UndoManager(l);var m={redo:1,undo:-1},j={mode:r.WYSIWYG_MODE,
init:function(){this.editor.on("afterSave afterRestore",this.cfg._respond,this);this.btn.disable()},offClick:function(){this.editor.fire("restore",{d:m[this.cfg.flag]})}},i=p.mix({title:"\u64a4\u9500",flag:"undo",contentCls:"ke-toolbar-undo",_respond:function(b){var d=this.btn;b.index>0?d.boff():d.disable()}},j,false);j=p.mix({title:"\u91cd\u505a",flag:"redo",contentCls:"ke-toolbar-redo",_respond:function(b){var d=this.btn;b.index<b.history.length-1?d.boff():d.disable()}},j,false);l.addButton("undo",i);l.addButton("undo",
j)})});
