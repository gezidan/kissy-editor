/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-19 15:41:38
*/
KISSY.add("editor",function(g,l){function s(k,a){function d(z){for(var t=s.Env.mods,o=0;o<z.length;o++){for(var A=z[o],x=p,B=0;B<o;B++)if(A==z[B]){x=u;break}B=t[A];if(x&&B){x=g.clone(B);A=A+"_"+o;x.name=A;z[o]=A;t[A]||(t[A]=x)}}}var f=this;if(!(f instanceof s))return new s(k,a);if(g.isString(k))k=g.one(k);k=n._4e_wrap(k);a=a||{};a.pluginConfig=a.pluginConfig||{};f.cfg=a;a.pluginConfig=a.pluginConfig;f.cfg=a;g.app(f,g.EventTarget);var r=["htmldataprocessor","enterkey","clipboard"],w=p;f.use=function(z,
t){z=z.split(",");d(z);if(!w)for(var o=0;o<r.length;o++){var A=r[o];g.inArray(A,z)||z.unshift(A)}g.use.call(f,z.join(","),function(){f.ready(function(){t&&t.call(f);if(!w){f.setData(k.val());if(a.focus)f.focus();else{var x=f.getSelection();x&&x.removeAllRanges()}f.fire("save");w=u}})},{order:u,global:s});return f};f.use=f.use;f.init(k);return f}function v(k){var a=g.Config.debug;k=a?a==="dev"?"../src/"+k:k:k.replace(/\.(js|css)/i,"-min.$1");k+=k.indexOf("?")!=-1?"&":"?";k+="t="+encodeURIComponent("2010-11-19 15:41:38");
return k}var n=g.DOM,u=true,p=false;g.app(s,g.EventTarget);s.Config.base=g.Config.base+"editor/";var j=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},
{name:"flash",requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},
"preview","removeformat",{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],q,e,c,b,h={};q=0;for(e=j.length;q<e;q++){c=j[q];if(g.isString(c))c=j[q]={name:c+"",requires:null};b=c.requires||[];var m=["button"];c.name.indexOf("/dialog")!=-1&&m.push("overlay");c.requires=b.concat(m)}j=[{name:"localStorage",requires:["flashutils","flashbridge"]},
{name:"button"},{name:"dd"},{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(j);q=0;for(e=j.length;q<e;q++){c=j[q];b=c.name;h[b]={attach:p,charset:"utf-8",requires:c.requires,csspath:c.useCss?v("plugins/"+b+"/plugin.css"):l,path:v("plugins/"+b+"/plugin.js")}}s.add(h);g.Editor=s;g.Editor=s});
KISSY.Editor.add("utils",function(g){var l=null,s=KISSY,v=s.Node,n=s.DOM,u=s.UA,p=s.Event,j;j=u.ie?document.documentMode||u.ie:void 0;var q={debugUrl:function(e){var c=s.Config.debug;e=c?c==="dev"?"../src/"+e:e:e.replace(/\.(js|css)/i,"-min.$1");e+=e.indexOf("?")!=-1?"&":"?";e+="t="+encodeURIComponent("2010-11-19 17:29:25");return e},lazyRun:function(e,c,b){var h=e[c],m=e[b];e[c]=function(){h.apply(this,arguments);e[c]=e[b];return m.apply(this,arguments)}},getXY:function(e,c,b,h){b=b.defaultView||
b.parentWindow;e-=n.scrollLeft(b);c-=n.scrollTop(b);if(h)if(b!=(h.defaultView||h.parentWindow)&&b.frameElement){h=n._4e_getOffset(b.frameElement,h);e+=h.left;c+=h.top}return{left:e,top:c}},tryThese:function(){for(var e,c=0,b=arguments.length;c<b;c++){var h=arguments[c];try{e=h();break}catch(m){}}return e},arrayCompare:function(e,c){if(!e&&!c)return true;if(!e||!c||e.length!=c.length)return false;for(var b=0;b<e.length;b++)if(e[b]!==c[b])return false;return true},getByAddress:function(e,c,b){e=e.documentElement;
for(var h=0;e&&h<c.length;h++){var m=c[h];if(b)for(var k=-1,a=0;a<e.childNodes.length;a++){var d=e.childNodes[a];if(!(b===true&&d.nodeType==3&&d.previousSibling&&d.previousSibling.nodeType==3)){k++;if(k==m){e=d;break}}}else e=e.childNodes[m]}return e?new v(e):l},clearAllMarkers:function(e){for(var c in e)e[c]._4e_clearMarkers(e,true)},htmlEncodeAttr:function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(e){return e.replace(/^\s+/,"")},rtrim:function(e){return e.replace(/\s+$/,
"")},trim:function(e){return this.ltrim(this.rtrim(e))},mix:function(){for(var e={},c=0;c<arguments.length;c++)e=s.mix(e,arguments[c]);return e},isCustomDomain:function(){if(!u.ie)return false;var e=document.domain,c=window.location.hostname;return e!=c&&e!="["+c+"]"},duplicateStr:function(e,c){return Array(c+1).join(e)},throttle:function(e,c,b){b=b||150;if(b===-1)return function(){e.apply(c,arguments)};var h=(new Date).getTime();return function(){var m=(new Date).getTime();if(m-h>b){h=m;e.apply(c,
arguments)}}},buffer:function(e,c,b){b=b||0;var h=l;return function(){h&&clearTimeout(h);var m=arguments;h=setTimeout(function(){return e.apply(c,m)},b)}},isNumber:function(e){return/^\d+(.\d+)?$/.test(s.trim(e))},verifyInputs:function(e){for(var c=0;c<e.length;c++){var b=n._4e_wrap(e[c]),h=s.trim(b.val()),m=b.attr("data-verify");b=b.attr("data-warning");if(m&&!RegExp(m).test(h)){alert(b);return false}}return true},sourceDisable:function(e,c){e.on("sourcemode",c.disable,c);e.on("wysiwygmode",c.enable,
c)},resetInput:function(e){var c=e.attr("placeholder");if(c&&!u.webkit){e.addClass("ke-input-tip");e.val(c)}else u.webkit&&e.val("")},valInput:function(e,c){e.removeClass("ke-input-tip");e.val(c)},placeholder:function(e,c){e.attr("placeholder",c);if(!u.webkit){e.on("blur",function(){if(!s.trim(e.val())){e.addClass("ke-input-tip");e.val(c)}});e.on("focus",function(){e.removeClass("ke-input-tip");s.trim(e.val())==c&&e.val("")})}},clean:function(e){e=e[0]||e;for(var c=s.makeArray(e.childNodes),b=0;b<
c.length;b++){var h=c[b];h.nodeType==g.NODE.NODE_TEXT&&!s.trim(h.nodeValue)&&e.removeChild(h)}},htmlEncode:function(e){return!e?e:String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(e){return!e?e:String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(e,c){return e.toLowerCase()==c.toLowerCase()},normParams:function(e){e=s.clone(e);for(var c in e)if(e.hasOwnProperty(c)){var b=
e[c];if(s.isFunction(b))e[c]=b()}return e},doFormUpload:function(e,c,b){function h(){var w={responseText:"",responseXML:l};w.argument=e?e.argument:l;try{var z;if((z=u.ie?k.contentWindow.document:k.contentDocument||window.frames[m].document)&&z.body)w.responseText=z.body.innerHTML;w.responseXML=z&&z.XMLDocument?z.XMLDocument:z}catch(t){s.log(t)}p.remove(k,"load",h);e.callback&&e.callback(w);setTimeout(function(){n._4e_remove(k)},100)}var m=s.guid("form-upload-"),k=document.createElement("iframe");
k.id=m;k.name=m;k.className="ke-hidden";var a="document.open();"+(q.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(u.ie)k.src=u.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";s.log("doFormUpload : "+k.src);document.body.appendChild(k);if(u.ie)document.frames[m].name=m;a=n._4e_unwrap(e.form);var d={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=m;a.method="POST";a.enctype=a.encoding="multipart/form-data";
if(b)a.action=b;var f;if(c){f=[];c=g.Utils.normParams(c);for(var r in c)if(c.hasOwnProperty(r)){b=document.createElement("input");b.type="hidden";b.name=r;b.value=c[r];a.appendChild(b);f.push(b)}}p.on(k,"load",h);a.submit();a.target=d.target;a.method=d.method;a.enctype=d.enctype;a.encoding=d.encoding;a.action=d.action;if(f){c=0;for(r=f.length;c<r;c++)n._4e_remove(f[c])}return k},extern:function(e,c){for(var b in c)e[b]=c[b]},map:function(e,c){for(var b=0;b<e.length;b++)e[b]=c(e[b]);return e},ieEngine:j,
preventFocus:function(e){u.ie?e._4e_unselectable():e.attr("onmousedown","return false;")}};g.Utils=q;g.Utils=q;q.extern(q,{debugUrl:q.debugUrl,lazyRun:q.lazyRun,getXY:q.getXY,tryThese:q.tryThese,arrayCompare:q.arrayCompare,getByAddress:q.getByAddress,clearAllMarkers:q.clearAllMarkers,htmlEncodeAttr:q.htmlEncodeAttr,ltrim:q.ltrim,rtrim:q.rtrim,trim:q.trim,mix:q.mix,isCustomDomain:q.isCustomDomain,duplicateStr:q.duplicateStr,buffer:q.buffer,isNumber:q.isNumber,verifyInputs:q.verifyInputs,sourceDisable:q.sourceDisable,
resetInput:q.resetInput,placeholder:q.placeholder,clean:q.clean,htmlEncode:q.htmlEncode,htmlDecode:q.htmlDecode,equalsIgnoreCase:q.equalsIgnoreCase,normParams:q.normParams,throttle:q.throttle,doFormUpload:q.doFormUpload,map:q.map})});
KISSY.Editor.add("focusmanager",function(g){function l(){this.iframeFocus=e;j=this;v.log(this._UUID+" focus")}function s(){this.iframeFocus=c;j=b;v.log(this._UUID+" blur")}var v=KISSY,n=v.DOM,u=v.Event,p={},j,q={refreshAll:function(){for(var h in p){var m=p[h];m.document.designMode="off";m.document.designMode="on"}},currentInstance:function(){return j},getInstance:function(h){return p[h]},add:function(h){var m=n._4e_getWin(h.document);u.on(m,"focus",l,h);u.on(m,"blur",s,h)},register:function(h){p[h._UUID]=
h},remove:function(h){delete p[h._UUID];var m=n._4e_getWin(h.document);u.remove(m,"focus",l,h);u.remove(m,"blur",s,h)}},e=true,c=false,b=null;g.focusManager=q;g.focusManager=q;g.getInstances=function(){return p};g.getInstances=g.getInstances});
KISSY.Editor.add("definition",function(g){var l=true,s=false,v=g.Utils,n=document,u=KISSY,p=u.UA,j=u.DOM,q=u.Node,e=u.Event,c=g.focusManager,b=v.tryThese,h=v.debugUrl("theme/editor-iframe.css"),m=1,k="document.open();"+(v.isCustomDomain()?'document.domain="'+n.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(p.ie?"javascript:void(function(){"+encodeURIComponent(k)+"}())":"")+'"  tabIndex="'+(p.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";g.SOURCE_MODE=0;g.WYSIWYG_MODE=1;g.SOURCE_MODE=g.SOURCE_MODE;g.WYSIWYG_MODE=g.WYSIWYG_MODE;u.augment(g,{init:function(d){if(p.ie)j.addClass(n.body,"ie"+p.ie);else if(p.gecko)j.addClass(n.body,"gecko");else p.webkit&&j.addClass(n.body,"webkit");var f=this,r=new q(a.replace(/\$\(tabIndex\)/,
d.attr("tabIndex")));f.editorWrap=r;f._UUID=m++;c.register(f);f.wrap=r.one(".ke-textarea-wrap");f.wrap=f.wrap;f.iframe=f.wrap.one("iframe");f.iframe=f.iframe;f.toolBarDiv=r.one(".ke-editor-tools");f.toolBarDiv=f.toolBarDiv;f.textarea=d;f.textarea=f.textarea;f.statusDiv=r.one(".ke-editor-status");f.statusDiv=f.statusDiv;v.preventFocus(f.toolBarDiv);f._commands={};f._dialogs={};var w=d._4e_style("width"),z=d._4e_style("height");if(w){r.css("width",w);d.css("width","100%")}f.textarea.css("display","none");
r.insertAfter(d);f.wrap[0].appendChild(d[0]);if(z){f.wrap.css("height",z);d.css("height","100%")}r=f.iframe;f.on("dataReady",function(){f._ready=l;g.fire("instanceCreated",{editor:f})});p.gecko?r.on("load",f._setUpIFrame,f):f._setUpIFrame();f.cfg.attachForm&&d[0].form&&f._attachForm()},_attachForm:function(){(new q(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(d,f){var r=this,w=g.Overlay;w.loading();r.use(d,function(){var z=r.getDialog(d);f(z);w.unloading()})},addDialog:function(d,
f){this._dialogs[d]=f},getDialog:function(d){return this._dialogs[d]},addPlugin:function(d){this.ready(d)},addCommand:function(d,f){this._commands[d]=f},hasCommand:function(d){return this._commands[d]},execCommand:function(d){var f=this._commands[d],r=u.makeArray(arguments);r.shift();r.unshift(this);return f.exec.apply(f,r)},getMode:function(){return this.textarea.css("display")=="none"?g.WYSIWYG_MODE:g.SOURCE_MODE},getData:function(d){var f;f=this.getMode()==g.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)f=d?this.htmlDataProcessor.toHtml(f,"p"):this.htmlDataProcessor.toServer(f,"p");f=u.trim(f);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(f))f="";return f},setData:function(d){var f=d;if(this.htmlDataProcessor)f=this.htmlDataProcessor.toDataFormat(d,"p");this.document.body.innerHTML=f;this.getMode()!=g.WYSIWYG_MODE&&this.textarea.val(d)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(d){d=d||0;return d+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(d){this.document.body.innerHTML=d},_prepareIFrameHtml:function(d){var f=this.cfg,r=f.customLink,w="";if(r)for(var z=0;z<r.length;z++)w+='<link href="'+r[z]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+g.Config.base+h+"' rel='stylesheet'/><style>"+(f.customStyle||"")+"</style>"+w+"</head><body class='ke-editor'>&nbsp;"+(d?'<script id="ke_actscript" type="text/javascript">'+(v.isCustomDomain()?'document.domain="'+n.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+d+'");<\/script>':"")+"</body></html>"},getSelection:function(){return g.Selection.getSelection(this.document)},focus:function(){var d=this.document,f=j._4e_getWin(d);p.webkit&&f&&f.parent&&f.parent.focus();f&&f.focus();d&&d.body.focus();this.notifySelectionChange()},blur:function(){j._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(d){var f=this.cfg,r=this.document;f.customStyle=f.customStyle||"";f.customStyle+=
"\n"+d;f=r.createElement("style");r.getElementsByTagName("head")[0].appendChild(f);if(f.styleSheet)f.styleSheet.cssText=d;else f.appendChild(r.createTextNode(d))},addCustomLink:function(d){var f=this.cfg,r=this.document;f.customLink=f.customLink||[];f.customLink.push(d);f=r.createElement("link");f.rel="stylesheet";r.getElementsByTagName("head")[0].appendChild(f);f.href=d},removeCustomLink:function(d){for(var f=this.cfg,r=u.makeArray(this.document.getElementsByTagName("link")),w=0;w<r.length;w++)r[w].href==
d&&j._4e_remove(r[w]);f.customLink=f.customLink||[];f=f.customLink;d=u.indexOf(d,f);d!=-1&&f.splice(d,1)},_setUpIFrame:function(){function d(){t=z.document;f.document=t;r.detach();t.open("text/html","replace");t.write(w);t.close()}var f=this,r=f.iframe,w=f._prepareIFrameHtml(f._UUID),z=r[0].contentWindow,t;try{t=z.document}catch(o){r[0].src=r[0].src;if(p.ie<7){setTimeout(d,10);return}}d()},ready:function(d){this._ready?d():this.on("dataReady",d)},_monitor:function(){var d=this;d._monitorId&&clearTimeout(d._monitorId);
d._monitorId=setTimeout(function(){var f=d.getSelection();if(f&&!f.isInvalid){var r=f.getStartElement(),w=new g.ElementPath(r);if(!d.previousPath||!d.previousPath.compare(w)){d.previousPath=w;d.fire("selectionChange",{selection:f,path:w,element:r})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(d,f){var r=this;r.focus();var w=d._4e_name(),z=g.XHTML_DTD,t=g.RANGE,o=g.NODE,A=z.$block[w],x=r.getSelection(),B=x&&x.getRanges(),i,y,C,E,D;if(!B||
B.length==0){var F=arguments,K=F.callee;setTimeout(function(){K.apply(r,F)},30)}else{r.fire("save");for(var M=B.length-1;M>=0;M--){i=B[M];i.deleteContents();y=!M&&d||d._4e_clone(l);f&&f(y);if(A)for(;(E=i.getCommonAncestor(s,l))&&(D=z[E._4e_name()])&&!(D&&D[w]);)if(E._4e_name()in z.span)i.splitElement(E);else if(i.checkStartOfBlock()&&i.checkEndOfBlock()){i.setStartBefore(E);i.collapse(l);E._4e_remove()}else i.splitBlock();i.insertNode(y);C||(C=y)}if(C){w=C._4e_nextSourceNode(l);z=r.document;D=g.XHTML_DTD;
if(D.$inline[y._4e_name()]){w=new q(z.createTextNode(" "));w.insertAfter(C)}else if(w){if(w._4e_name()=="br"&&D[w.parent()._4e_name()].p){D=new q("<p>&nbsp;</p>",null,z);w[0].parentNode.replaceChild(D[0],w[0]);w=D}}else{D=new q("<p>&nbsp;</p>",null,z);D.insertAfter(C);w=D}i.moveToPosition(C,t.POSITION_AFTER_END);w&&w[0].nodeType==o.NODE_ELEMENT&&i.moveToElementEditablePosition(w);x.selectRanges([i]);r.focus();y&&y._4e_scrollIntoView();setTimeout(function(){r.fire("save")},10);return y}}},insertHtml:function(d){var f=
this;if(f.htmlDataProcessor)d=f.htmlDataProcessor.toDataFormat(d);if(p.webkit){var r=j.create(d,null,this.document);r=r.nodeType==11?u.makeArray(r.childNodes):[r];for(var w=0;w<r.length;w++)f.insertElement(new q(r[w]))}else{f.focus();w=(r=f.getSelection())&&r.getRanges();if(!w||w.length==0){var z=arguments,t=z.callee;setTimeout(function(){t.apply(f,z)},30)}else{f.fire("save");if(p.ie){r=r.getNative();r.type=="Control"&&r.clear();r.createRange().pasteHTML(d)}else f.document.execCommand("inserthtml",
s,d);f.focus();setTimeout(function(){f.fire("save")},10)}}}});g._initIFrame=function(d){function f(y){b(function(){z.designMode="on";setTimeout(function(){z.designMode="off";A.focus();if(!arguments.callee.retry)arguments.callee.retry=l},50)},function(){z.designMode="off";j.attr(A,"contentEditable",s);j.attr(A,"contentEditable",l);!y&&f(1)})}var r=c.getInstance(d);d=r.textarea[0];var w=r.iframe[0].contentWindow,z=r.document,t=r.cfg,o=z.getElementById("ke_actscript");j._4e_remove(o);var A=z.body;if(p.ie){A.hideFocus=
l;A.disabled=l;A.contentEditable=l;A.removeAttribute("disabled")}else setTimeout(function(){if(p.gecko||p.opera)A.contentEditable=l;else if(p.webkit)A.parentNode.contentEditable=l;else z.designMode="on"},0);if(p.webkit){e.on(z,"click",function(y){var C=new q(y.target);u.inArray(C._4e_name(),["input","select"])&&y.preventDefault()});e.on(z,"mouseup",function(y){var C=new q(y.target);u.inArray(C._4e_name(),["input","textarea"])&&y.preventDefault()})}if(p.gecko||p.ie||p.opera){var x;x=new q(j.insertAfter((new q('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
d));x.on("focus",function(){r.focus()});r.activateGecko=function(){p.gecko&&r.iframeFocus&&x[0].focus()};r.on("destroy",function(){})}if(p.ie&&z.compatMode=="CSS1Compat"||p.gecko||p.opera){var B=new q(z.documentElement);B.on("mousedown",function(y){if(y.target==B[0]){p.gecko&&f(s);x[0].focus()}})}e.on(w,"focus",function(){if(p.gecko)f(s);else p.opera&&A.focus();r.notifySelectionChange()});p.gecko&&e.on(r.document,"mousedown",function(){r.iframeFocus||f(s)});if(p.ie){e.on(z,"keydown",function(y){if(y.keyCode in
{8:1,46:1}){var C=r.getSelection(),E=C.getSelectedElement();if(E){r.fire("save");var D=C.getRanges()[0].createBookmark();E._4e_remove();C.selectBookmarks([D]);r.fire("save");y.preventDefault()}}});if(z.compatMode=="CSS1Compat"){var i={33:1,34:1};e.on(z,"keydown",function(y){y.keyCode in i&&setTimeout(function(){r.getSelection().scrollIntoView()},0)})}}setTimeout(function(){p.ie&&setTimeout(function(){if(z){A.runtimeStyle.marginBottom="0px";A.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){r.fire("dataReady");
var y=t.disableObjectResizing,C=t.disableInlineTableEditing;if(y||C)try{z.execCommand("enableObjectResizing",s,!y);z.execCommand("enableInlineTableEditing",s,!C)}catch(E){e.on(A,p.ie?"resizestart":"resize",function(D){if(y||j._4e_name(D.target)==="table"&&C)D.preventDefault()})}},10);p.webkit&&e.on(z,"mousedown",function(y){y=new q(y.target);u.inArray(y._4e_name(),["img","hr","input","textarea","select"])&&r.getSelection().selectElement(y)});p.gecko&&e.on(z,"dragstart",function(y){var C=new q(y.target);
C._4e_name()==="img"&&/ke_/.test(C[0].className)&&y.preventDefault()});c.add(r)};k=g.prototype;v.extern(k,{setData:k.setData,getData:k.getData,insertElement:k.insertElement,insertHtml:k.insertHtml,ready:k.ready,addCustomStyle:k.addCustomStyle,addCommand:k.addCommand,hasCommand:k.hasCommand,execCommand:k.execCommand,addPlugin:k.addPlugin,useDialog:k.useDialog,addDialog:k.addDialog,getDialog:k.getDialog,getMode:k.getMode,sync:k.sync,baseZIndex:k.baseZIndex,getSelection:k.getSelection,focus:k.focus,
blur:k.blur,notifySelectionChange:k.notifySelectionChange})});KISSY.Editor.add("zindex",function(){var g=KISSY.Editor;if(!g.zIndexManager){g.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};g.baseZIndex=function(l){var s=l,v=g.getInstances(),n;for(n in v){if(!v.hasOwnProperty(n))return;s=Math.max(s,v[n].baseZIndex(l))}return s};g.baseZIndex=g.baseZIndex;g.zIndexManager=g.zIndexManager}});
KISSY.Editor.add("dtd",function(g){g.XHTML_DTD=function(){function l(t){for(var o=arguments.length-1;o>0;)KISSY.mix(t,arguments[o--]);return t}var s={isindex:1,fieldset:1},v={input:1,button:1,select:1,textarea:1,label:1},n=l({a:1},v),u=l({iframe:1},n),p={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},q=l({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),e=l({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},q),c=l({p:1},e);v=l({iframe:1},e,v);e={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var b=l({a:1},v),h={tr:1},m={"#":1},k=l({param:1},e),a=l({form:1},s,u,p,c),d={li:1},f={base:1,link:1,meta:1,title:1},r=l(f,{style:1,script:1}),w={head:1,body:1},z={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:l({html:1},w,f),$block:z,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:b,$body:l({script:1,style:1},z),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:w,head:r,style:m,body:a,base:{},link:{},meta:{},title:m,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:b,button:l(c,p),basefont:{},h5:b,h4:b,samp:b,h6:b,ol:d,h1:b,h3:b,option:m,h2:b,form:l(s,u,p,c),select:{optgroup:1,option:1},font:b,ins:b,menu:d,abbr:b,label:b,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:b,script:m,tfoot:h,cite:b,li:a,input:{},iframe:a,strong:b,textarea:m,noframes:a,big:b,small:b,span:b,hr:{},dt:b,sub:b,optgroup:{option:1},param:{},bdo:b,"var":b,div:a,object:k,sup:b,dd:a,strike:b,area:{},dir:d,map:l({area:1,form:1,p:1},s,j,p),applet:k,dl:{dt:1,dd:1},del:b,isindex:{},fieldset:l({legend:1},e),thead:h,ul:d,acronym:b,b:b,a:v,blockquote:a,caption:b,i:b,u:b,tbody:h,s:b,address:l(u,c),tt:b,legend:b,q:b,pre:l(q,n),p:b,em:b,dfn:b}}();g.XHTML_DTD=
g.XHTML_DTD});
KISSY.Editor.add("dom",function(g){function l(a){return a.replace(/-(\w)/g,function(d,f){return f.toUpperCase()})}var s=KISSY,v=s.DOM,n=s.UA,u=s.Node,p=g.Utils,j={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};g.NODE=g.NODE;g.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};g.POSITION=g.POSITION;var q=g.NODE,e=g.POSITION,c={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},b={hr:1},h=function(a){return a[0]||a},m=function(a){if(a&&!a[0])return new u(a);return a},k={_4e_wrap:m,_4e_unwrap:h,_4e_equals:function(a,d){if(!a&&!d)return true;if(!a||!d)return false;a=h(a);d=h(d);
return a===d},_4e_isBlockBoundary:function(a,d){a=m(a);var f=s.mix(s.mix({},b),d||{});return c[a.css("display")]||f[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=h(a);for(var d=a.parentNode.childNodes,f=0;f<d.length;f++)if(d[f]===a)return f;return-1},_4e_first:function(a,d){a=h(a);var f=a.firstChild;if((f=f&&new u(f))&&d&&!d(f))f=f._4e_next(d);return f},_4e_move:function(a,d,f){a=h(a);v._4e_remove(a);
d=h(d);f?d.insertBefore(a,d.firstChild):d.appendChild(a)},_4e_name:function(a){a=h(a);var d=a.nodeName.toLowerCase();if(n.ie)if((a=a.scopeName)&&a!="HTML")d=a.toLowerCase()+":"+d;return d},_4e_isIdentical:function(a,d){if(a._4e_name()!=d._4e_name())return false;var f=a[0].attributes,r=d[0].attributes,w=f.length,z=r.length;if(w!=z)return false;for(var t=0;t<w;t++){var o=f[t],A=o.name;if(o.specified&&a.attr(A)!=d.attr(A))return false}if(p.ieEngine<8)for(t=0;t<z;t++){o=r[t];A=o.name;if(o.specified&&
a.attr(A)!=d.attr(A))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=h(a).childNodes;for(var d=0,f=a.length;d<f;d++){var r=a[d],w=r.nodeType;if(!(w==q.NODE_ELEMENT&&r.getAttribute("_ke_bookmark")))if(w==q.NODE_ELEMENT&&!k._4e_isEmptyInlineRemoveable(r)||w==q.NODE_TEXT&&s.trim(r.nodeValue))return false}return true},_4e_moveChildren:function(a,d,f){a=h(a);d=d[0]||d;if(a!=d)if(f)for(;f=a.lastChild;)d.insertBefore(a.removeChild(f),d.firstChild);else for(;f=a.firstChild;)d.appendChild(a.removeChild(f))},
_4e_mergeSiblings:function(){function a(d,f,r){if(f[0]&&f[0].nodeType==q.NODE_ELEMENT){for(var w=[];f.attr("_ke_bookmark")||f._4e_isEmptyInlineRemoveable();){w.push(f);f=r?new u(f[0].nextSibling):new u(f[0].previousSibling);if(!f[0]||f[0].nodeType!=q.NODE_ELEMENT)return}if(d._4e_isIdentical(f)){for(var z=r?d[0].lastChild:d[0].firstChild;w.length;)w.shift()._4e_move(d,!r);f._4e_moveChildren(d,!r);f._4e_remove();z[0]&&z[0].nodeType==q.NODE_ELEMENT&&z._4e_mergeSiblings()}}}return function(d){if(d[0])if(j[d._4e_name()]||
d._4e_name()=="a"){a(d,new u(d[0].nextSibling),true);a(d,new u(d[0].previousSibling))}}}(),_4e_unselectable:n.gecko?function(a){a=h(a);a.style.MozUserSelect="none"}:n.webkit?function(a){a=h(a);a.style.KhtmlUserSelect="none"}:function(a){a=h(a);if(n.ie||n.opera){var d=0;a.unselectable="on";for(var f=a.getElementsByTagName("*");a=f[d++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.unselectable="on"}}},_4e_getOffset:function(a,d){a=h(a);var f,
r=0;f=0;var w=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,z=a.ownerDocument,t=z.documentElement;d=d||z;if(a.getBoundingClientRect){if(a!==z.body&&t!==a){f=a.getBoundingClientRect();r=f.left+(d===z?v.scrollLeft(w):0);f=f.top+(d===z?v.scrollTop(w):0)}if(d)if(w!=(d.defaultView||d.parentWindow)&&w.frameElement){w=k._4e_getOffset(w.frameElement,d);r+=w.left;f+=w.top}}return{left:r,top:f}},_4e_getFrameDocument:function(a){return(a=h(a))&&a.contentWindow.document},_4e_splitText:function(a,
d){a=h(a);var f=a.ownerDocument;if(!(!a||a.nodeType!=q.NODE_TEXT)){if(n.ie&&d==a.nodeValue.length){var r=f.createTextNode("");v.insertAfter(r,a);return new u(r)}r=new u(a.splitText(d));if(f.documentMode){f=f.createTextNode("");v.insertAfter(f,r[0]);v._4e_remove(f)}return r}},_4e_parents:function(a,d){a=m(a);var f=[];do f[d?"push":"unshift"](a);while(a=a.parent());return f},_4e_clone:function(a,d,f){a=h(a);a=a.cloneNode(d);if(!f){var r=function(w){if(w.nodeType==q.NODE_ELEMENT){w.removeAttribute("id");
w=w.childNodes;for(var z=0;z<w.length;z++)r(w[z])}};r(a)}return new u(a)},_4e_nextSourceNode:function(a,d,f,r){a=h(a);if(r&&!r.call){var w=r[0]||r;r=function(t){t=t[0]||t;return t!==w}}d=!d&&a.firstChild;var z=new u(a);if(!d){if(a.nodeType==q.NODE_ELEMENT&&r&&r(a,true)===false)return null;d=a.nextSibling}for(;!d&&(z=z.parent());){if(r&&r(z,true)===false)return null;d=z[0].nextSibling}if(!d)return null;d=v._4e_wrap(d);if(r&&r(d)===false)return null;if(f&&f!=d[0].nodeType)return d._4e_nextSourceNode(false,
f,r);return d},_4e_previousSourceNode:function(a,d,f,r){a=h(a);if(r&&!r.call){var w=r[0]||r;r=function(t){t=t[0]||t;return t!==w}}d=!d&&a.lastChild;var z=new u(a);if(!d){if(a.nodeType==q.NODE_ELEMENT&&r&&r(a,true)===false)return null;d=a.previousSibling}for(;!d&&(z=z.parent());){if(r&&r(z,true)===false)return null;d=z[0].previousSibling}if(!d)return null;d=v._4e_wrap(d);if(r&&r(d)===false)return null;if(f&&d[0].nodeType!=f)return d._4e_previousSourceNode(false,f,r);return d},_4e_commonAncestor:function(a,
d){if(a._4e_equals(d))return a;if(d[0].nodeType!=q.NODE_TEXT&&d.contains(a))return d;var f=a[0].nodeType==q.NODE_TEXT?a.parent():a;do if(f[0].nodeType!=q.NODE_TEXT&&f.contains(d))return f;while(f=f.parent());return null},_4e_ascendant:function(a,d,f){a=h(a);if(!f)a=a.parentNode;if(d&&!s.isFunction(d)){var r=d;d=function(w){return w._4e_name()==r}}for(;a&&a.nodeType!=9;){if(!d||d(new u(a))===true)return new u(a);a=a.parentNode}return null},_4e_hasAttribute:p.ieEngine<9?function(a,d){a=h(a);var f=a.attributes[d];
return!!(f&&f.specified)}:function(a,d){a=h(a);return a.hasAttribute(d)},_4e_hasAttributes:p.ieEngine<9?function(a){a=h(a);for(var d=a.attributes,f=0;f<d.length;f++){var r=d[f];switch(r.name){case "class":if(a.getAttribute("class"))return true;break;default:if(r.specified)return true}}return false}:function(a){a=h(a);n.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},_4e_position:function(a,d){var f=h(a),r=h(d);if(f.compareDocumentPosition)return f.compareDocumentPosition(r);if(f==
r)return e.POSITION_IDENTICAL;if(f.nodeType==q.NODE_ELEMENT&&r.nodeType==q.NODE_ELEMENT){if(f.contains){if(f.contains(r))return e.POSITION_CONTAINS+e.POSITION_PRECEDING;if(r.contains(f))return e.POSITION_IS_CONTAINED+e.POSITION_FOLLOWING}if("sourceIndex"in f)return f.sourceIndex<0||r.sourceIndex<0?e.POSITION_DISCONNECTED:f.sourceIndex<r.sourceIndex?e.POSITION_PRECEDING:e.POSITION_FOLLOWING}f=a._4e_address();r=d._4e_address();for(var w=Math.min(f.length,r.length),z=0;z<=w-1;z++)if(f[z]!=r[z]){if(z<
w)return f[z]<r[z]?e.POSITION_PRECEDING:e.POSITION_FOLLOWING;break}return f.length<r.length?e.POSITION_CONTAINS+e.POSITION_PRECEDING:e.POSITION_IS_CONTAINED+e.POSITION_FOLLOWING},_4e_address:function(a,d){a=h(a);for(var f=[],r=a.ownerDocument.documentElement,w=a;w&&w!=r;){var z=w.parentNode,t=-1;if(z){for(var o=0;o<z.childNodes.length;o++){var A=z.childNodes[o];if(!(d&&A.nodeType==3&&A.previousSibling&&A.previousSibling.nodeType==3)){t++;if(A==w)break}}f.unshift(t)}w=z}return f},_4e_breakParent:function(a,
d){var f=new g.Range(a[0].ownerDocument);f.setStartAfter(a);f.setEndAfter(d);var r=f.extractContents();f.insertNode(a._4e_remove());a[0].parentNode.insertBefore(r,a[0].nextSibling)},_4e_style:function(a,d,f){a=m(a);if(f!==undefined)return a.css(d,f);a=h(a);return a.style[l(d)]},_4e_remove:function(a,d){var f=h(a),r=f.parentNode;if(r){if(d)for(var w;w=f.firstChild;)r.insertBefore(f.removeChild(w),f);r.removeChild(f)}return a},_4e_trim:function(a){v._4e_ltrim(a);v._4e_rtrim(a)},_4e_ltrim:function(a){a=
h(a);for(var d;d=a.firstChild;){if(d.nodeType==q.NODE_TEXT){var f=p.ltrim(d.nodeValue),r=d.nodeValue.length;if(f){if(f.length<r){(new u(d))._4e_splitText(r-f.length);a.removeChild(a.firstChild)}}else{a.removeChild(d);continue}}break}},_4e_rtrim:function(a){a=h(a);for(var d;d=a.lastChild;){if(d.type==q.NODE_TEXT){var f=p.rtrim(d.nodeValue),r=d.nodeValue.length;if(f){if(f.length<r){(new u(d))._4e_splitText(f.length);a.removeChild(a.lastChild)}}else{a.removeChild(d);continue}}break}if(!n.ie&&!n.opera)(d=
a.lastChild)&&d.nodeType==1&&d.nodeName.toLowerCase()=="br"&&d.parentNode.removeChild(d)},_4e_appendBogus:function(a){a=h(a);for(var d=a.lastChild;d&&d.nodeType==q.NODE_TEXT&&!s.trim(d.nodeValue);)d=d.previousSibling;if(!d||d.nodeType==q.NODE_TEXT||v._4e_name(d)!=="br"){d=n.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");n.gecko&&d.setAttribute("type","_moz");a.appendChild(d)}},_4e_previous:function(a,d){var f=h(a),r;do r=(f=f.previousSibling)&&new u(f);while(r&&d&&!d(r));
return r},_4e_last:function(a,d){a=v._4e_wrap(a);var f=a[0].lastChild;if((f=f&&new u(f))&&d&&!d(f))f=f._4e_previous(d);return f},_4e_next:function(a,d){var f=h(a),r;do r=(f=f.nextSibling)&&new u(f);while(r&&d&&!d(r));return r},_4e_outerHtml:function(a){a=h(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var d=a.ownerDocument.createElement("div");d.appendChild(a.cloneNode(true));return d.innerHTML},_4e_setMarker:function(a,d,f,r){a=v._4e_wrap(a);var w=a.data("list_marker_id")||a.data("list_marker_id",
s.guid()).data("list_marker_id"),z=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");d[w]=a;z[f]=1;return a.data(f,r)},_4e_clearMarkers:function(a,d,f){a=m(a);var r=a.data("list_marker_names"),w=a.data("list_marker_id"),z;for(z in r)a.removeData(z);a.removeData("list_marker_names");if(f){a.removeData("list_marker_id");delete d[w]}},_4e_copyAttributes:function(a,d,f){a=h(a);d=m(d);var r=a.attributes;f=f||{};for(var w=0;w<r.length;w++){var z=r[w],t=z.name.toLowerCase(),
o;if(!(t in f))if(t=="checked"&&(o=v.attr(a,t)))d.attr(t,o);else if(z.specified||n.ie&&z.value&&t=="value"){o=v.attr(a,t);if(o===null)o=z.nodeValue;d.attr(t,o)}}if(a.style.cssText!=="")d[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=v._4e_name(a);var d=g.XHTML_DTD;return(a=!d.$nonEditable[a]&&(d[a]||d.span))&&a["#"]},_4e_scrollIntoView:function(a){a=m(a);var d=a[0].ownerDocument,f=v.scrollLeft(d),r=v.scrollTop(d),w=a.offset(),z=w.left;w=w.top;if(v.viewportHeight(d)+r<w||w<r||v.viewportWidth(d)+
f<z||z<f)a.scrollIntoView(d)},_4e_getElementsByTagName:function(a,d,f){a=h(a);if(!n.ie&&f)d=f+":"+d;f=[];a=a.getElementsByTagName(d);for(d=0;d<a.length;d++)f.push(new u(a[d]));return f}};s.DOM._4e_inject=function(a){s.mix(v,a);for(var d in a)a.hasOwnProperty(d)&&function(f){u.prototype[f]=function(){var r=[].slice.call(arguments,0);r.unshift(this);return a[f].apply(null,r)}}(d)};p.extern(k,{_4e_wrap:k._4e_wrap,_4e_unwrap:k._4e_unwrap,_4e_equals:k._4e_equals,_4e_isBlockBoundary:k._4e_isBlockBoundary,
_4e_getWin:k._4e_getWin,_4e_index:k._4e_index,_4e_first:k._4e_first,_4e_move:k._4e_move,_4e_name:k._4e_name,_4e_isIdentical:k._4e_isIdentical,_4e_isEmptyInlineRemoveable:k._4e_isEmptyInlineRemoveable,_4e_moveChildren:k._4e_moveChildren,_4e_mergeSiblings:k._4e_mergeSiblings,_4e_unselectable:k._4e_unselectable,_4e_getOffset:k._4e_getOffset,_4e_getFrameDocument:k._4e_getFrameDocument,_4e_splitText:k._4e_splitText,_4e_parents:k._4e_parents,_4e_clone:k._4e_clone,_4e_nextSourceNode:k._4e_nextSourceNode,
_4e_previousSourceNode:k._4e_previousSourceNode,_4e_commonAncestor:k._4e_commonAncestor,_4e_ascendant:k._4e_ascendant,_4e_hasAttribute:k._4e_hasAttribute,_4e_hasAttributes:k._4e_hasAttributes,_4e_position:k._4e_position,_4e_address:k._4e_address,_4e_breakParent:k._4e_breakParent,_4e_style:k._4e_style,_4e_remove:k._4e_remove,_4e_trim:k._4e_trim,_4e_ltrim:k._4e_ltrim,_4e_rtrim:k._4e_rtrim,_4e_appendBogus:k._4e_appendBogus,_4e_last:k._4e_last,_4e_previous:k._4e_previous,_4e_next:k._4e_next,_4e_outerHtml:k._4e_outerHtml,
_4e_setMarker:k._4e_setMarker,_4e_clearMarkers:k._4e_clearMarkers,_4e_getUniqueId:k._4e_getUniqueId,_4e_copyAttributes:k._4e_copyAttributes,_4e_isEditable:k._4e_isEditable,_4e_scrollIntoView:k._4e_scrollIntoView,_4e_getElementsByTagName:k._4e_getElementsByTagName});v._4e_inject(k)});
KISSY.Editor.add("elementpath",function(g){function l(e){var c=u,b=u,h=[];for(e=e;e&&e[0];){if(e[0].nodeType==n.NODE_ELEMENT){if(!this.lastElement)this.lastElement=e;var m=e._4e_name();if(!b){if(!c&&p[m])c=e;if(j[m]){var k;if(k=!c){if(k=m=="div"){a:{k=e;k=k[0]||k;k=k.childNodes;for(var a=0,d=k.length;a<d;a++){var f=k[a];if(f.nodeType==n.NODE_ELEMENT&&v.$block[f.nodeName.toLowerCase()]){k=true;break a}}k=false}k=!k}k=k}if(k)c=e;else b=e}}h.push(e);if(m=="body")break}e=e.parent()}this.block=this.block=
c;this.blockLimit=this.blockLimit=b;this.elements=this.elements=h}var s=KISSY.DOM,v=g.XHTML_DTD,n=g.NODE,u=null,p={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};l.prototype={compare:function(e){var c=this.elements;e=e&&e.elements;if(!e||c.length!=e.length)return false;for(var b=0;b<c.length;b++)if(!s._4e_equals(c[b],e[b]))return false;return true},contains:function(e){for(var c=this.elements,b=0;b<
c.length;b++)if(c[b]._4e_name()in e)return c[b];return u}};g.ElementPath=g.ElementPath=l;var q=l.prototype;g.Utils.extern(q,{compare:q.compare,contains:q.contains})});
KISSY.Editor.add("walker",function(g){function l(h,m){if(this._.end)return p;var k,a=this.range,d,f=this.guard,r=this.type,w=h?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;a.trim();if(a.collapsed){this.end();return p}}if(!h&&!this._.guardLTR){var z=a.endContainer,t=new c(z[0].childNodes[a.endOffset]);this._.guardLTR=function(B,i){return(B=e._4e_wrap(B))&&B[0]&&(!i||!e._4e_equals(z,B))&&(!t[0]||!B._4e_equals(t))&&(B[0].nodeType!=q.NODE_ELEMENT||!i||B._4e_name()!="body")}}if(h&&
!this._.guardRTL){var o=a.startContainer,A=a.startOffset>0&&new c(o[0].childNodes[a.startOffset-1]);this._.guardRTL=function(B,i){return(B=e._4e_wrap(B))&&B[0]&&(!i||!B._4e_equals(o))&&(!A[0]||!B._4e_equals(A))&&(B[0].nodeType!=q.NODE_ELEMENT||!i||B._4e_name()!="body")}}var x=h?this._.guardRTL:this._.guardLTR;d=f?function(B,i){if(x(B,i)===u)return u;return f(B,i)}:x;if(this.current)k=this.current[w](u,r,d);else if(h){k=a.endContainer;if(a.endOffset>0){k=new c(k[0].childNodes[a.endOffset-1]);if(d(k)===
u)k=p}else k=d(k,n)===u?p:k._4e_previousSourceNode(n,r,d)}else{k=a.startContainer;if((k=new c(k[0].childNodes[a.startOffset]))&&k[0]){if(d(k)===u)k=p}else k=d(a.startContainer,n)===u?p:a.startContainer._4e_nextSourceNode(n,r,d)}for(;k&&k[0]&&!this._.end;){this.current=k;if(!this.evaluator||this.evaluator(k)!==u){if(!m)return k}else if(m&&this.evaluator)return u;k=k[w](u,r,d)}this.end();return this.current=p}function s(h){for(var m,k=p;m=l.call(this,h);)k=m;return k}function v(h){this.range=h;this._=
{}}var n=true,u=false,p=null,j=KISSY,q=g.NODE,e=j.DOM,c=j.Node;j.augment(v,{end:function(){this._.end=1},next:function(){return l.call(this)},previous:function(){return l.call(this,n)},checkForward:function(){return l.call(this,u,n)!==u},checkBackward:function(){return l.call(this,n,n)!==u},lastForward:function(){return s.call(this)},lastBackward:function(){return s.call(this,n)},reset:function(){delete this.current;this._={}}});v.blockBoundary=function(h){return function(m){m=e._4e_wrap(m);return!(m&&
m[0].nodeType==q.NODE_ELEMENT&&m._4e_isBlockBoundary(h))}};v.listItemBoundary=function(){return this.blockBoundary({br:1})};v.bookmark=function(h,m){function k(a){return a&&a[0]&&a._4e_name()=="span"&&a.attr("_ke_bookmark")}return function(a){var d,f;d=a&&a[0]&&a[0].nodeType==q.NODE_TEXT&&(f=a.parent())&&k(f);d=h?d:d||k(a);return m^d}};v.whitespaces=function(h){return function(m){m=(m=m[0]||m)&&m.nodeType==q.NODE_TEXT&&!j.trim(m.nodeValue);return h^m}};v.invisible=function(h){var m=v.whitespaces();
return function(k){k=m(k)||k[0].nodeType==q.NODE_ELEMENT&&!k[0].offsetHeight;return h^k}};g.Walker=v;g.Walker=v;var b=v.prototype;g.Utils.extern(b,{end:b.end,next:b.next,previous:b.previous,checkForward:b.checkForward,checkBackward:b.checkBackward,lastForward:b.lastForward,lastBackward:b.lastBackward,reset:b.reset});g.Utils.extern(v,{blockBoundary:v.blockBoundary,listItemBoundary:v.listItemBoundary,bookmark:v.bookmark,whitespaces:v.whitespaces,invisible:v.invisible})});
KISSY.Editor.add("range",function(g){function l(i){this.endOffset=this.endContainer=this.startOffset=this.startContainer=e;this.collapsed=j;this.document=i}function s(i){var y=i[0].nodeType!=b.NODE_TEXT&&i._4e_name()in r.$removeEmpty,C=!c.trim(i[0].nodeValue);i=!!i.parent().attr("_ke_bookmark");return y||C||i}function v(i){return!A(i)&&!x(i)}function n(i){var y=q,C=k.bookmark(j);return function(E){if(C(E))return j;if(E[0].nodeType==b.NODE_TEXT){if(c.trim(E[0].nodeValue).length)return q}else if(E[0].nodeType==
b.NODE_ELEMENT)if(!o[E._4e_name()])if(!i&&!f.ie&&E._4e_name()=="br"&&!y)y=j;else return q;return j}}function u(i,y){function C(E){return E&&E.nodeName=="span"&&E.getAttribute("_ke_bookmark")}return function(E){var D,F;D=E&&!E.nodeName&&(F=E.parentNode)&&C(F);D=i?D:D||C(E);return y^D}}function p(i){return function(y){y=(y=y[0]||y)&&y.nodeType==b.NODE_TEXT&&!c.trim(y.nodeValue);return i^y}}g.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};g.RANGE=g.RANGE;var j=true,q=false,e=null,c=KISSY,b=g.NODE,h=g.RANGE,m=g.POSITION,k=g.Walker,a=c.DOM,d=g.Utils.getByAddress,f=c.UA,r=g.XHTML_DTD,w=g.ElementPath,z=c.Node,t={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};l.prototype.toString=function(){var i=[];i.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);i.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return i.join("<br/>")};c.augment(l,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&a._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var i=this.startContainer,y=this.startOffset;if(i[0].nodeType!=b.NODE_ELEMENT)if(y)y>=i[0].nodeValue.length&&this.setStartAfter(i);else this.setStartBefore(i);i=this.endContainer;y=this.endOffset;if(i[0].nodeType!=b.NODE_ELEMENT)if(y)y>=
i[0].nodeValue.length&&this.setEndAfter(i);else this.setEndBefore(i)},setStartAfter:function(i){this.setStart(i.parent(),i._4e_index()+1)},setStartBefore:function(i){this.setStart(i.parent(),i._4e_index())},setEndAfter:function(i){this.setEnd(i.parent(),i._4e_index()+1)},setEndBefore:function(i){this.setEnd(i.parent(),i._4e_index())},optimizeBookmark:function(){var i=this.startContainer,y=this.endContainer;i&&i._4e_name()=="span"&&i.attr("_ke_bookmark")&&this.setStartAt(i,h.POSITION_BEFORE_START);
y&&y._4e_name()=="span"&&y.attr("_ke_bookmark")&&this.setEndAt(y,h.POSITION_AFTER_END)},setStart:function(i,y){if(i[0].nodeType==b.NODE_ELEMENT&&t[i._4e_name()]){i=i.parent();y=i._4e_index()}this.startContainer=i;this.startOffset=y;if(!this.endContainer){this.endContainer=i;this.endOffset=y}this.updateCollapsed()},setEnd:function(i,y){if(i[0].nodeType==b.NODE_ELEMENT&&t[i._4e_name()]){i=i.parent();y=i._4e_index()+1}this.endContainer=i;this.endOffset=y;if(!this.startContainer){this.startContainer=
i;this.startOffset=y}this.updateCollapsed()},setStartAt:function(i,y){switch(y){case h.POSITION_AFTER_START:this.setStart(i,0);break;case h.POSITION_BEFORE_END:i[0].nodeType==b.NODE_TEXT?this.setStart(i,i[0].nodeValue.length):this.setStart(i,i[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setStartBefore(i);break;case h.POSITION_AFTER_END:this.setStartAfter(i)}this.updateCollapsed()},setEndAt:function(i,y){switch(y){case h.POSITION_AFTER_START:this.setEnd(i,0);break;case h.POSITION_BEFORE_END:i[0].nodeType==
b.NODE_TEXT?this.setEnd(i,i[0].nodeValue.length):this.setEnd(i,i[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setEndBefore(i);break;case h.POSITION_AFTER_END:this.setEndAfter(i)}this.updateCollapsed()},execContentsAction:function(i,y){var C=this.startContainer,E=this.endContainer,D=this.startOffset,F=this.endOffset,K,M=this.document,N;this.optimizeBookmark();if(E[0].nodeType==b.NODE_TEXT)E=E._4e_splitText(F);else if(E[0].childNodes.length>0)if(F>=E[0].childNodes.length){E=new z(E[0].appendChild(M.createTextNode("")));
N=j}else E=new z(E[0].childNodes[F]);if(C[0].nodeType==b.NODE_TEXT){C._4e_splitText(D);if(C._4e_equals(E))E=new z(C[0].nextSibling)}else if(D)if(D>=C[0].childNodes.length){K=new z(M.createTextNode(""));C.append(K);C=K;K=j}else C=new z(C[0].childNodes[D].previousSibling);else{K=new z(M.createTextNode(""));C.prepend(K);C=K;K=j}D=C._4e_parents();F=E._4e_parents();var Q,U,S;for(Q=0;Q<D.length;Q++){U=D[Q];S=F[Q];if(!U._4e_equals(S))break}M=y;for(var T,V,G,L=Q;L<D.length;L++){T=D[L];V=M&&!T._4e_equals(C)?
M.appendChild(T._4e_clone()[0]):null;for(T=T[0].nextSibling;T;){if(a._4e_equals(F[L],T)||a._4e_equals(E,T))break;G=T.nextSibling;if(i==2)M.appendChild(T.cloneNode(j));else{a._4e_remove(T);i==1&&M.appendChild(T)}T=G}if(V)M=V}M=y;for(Q=Q;Q<F.length;Q++){T=F[Q];V=M&&i>0&&!T._4e_equals(E)?M.appendChild(T._4e_clone()[0]):null;if(!D[Q]||!T.parent()._4e_equals(D[Q].parent()))for(T=T[0].previousSibling;T;){if(a._4e_equals(D[Q],T)||a._4e_equals(C,T))break;G=T.previousSibling;if(i==2)M.insertBefore(T.cloneNode(j),
M.firstChild);else{a._4e_remove(T);i==1&&M.insertBefore(T,M.firstChild)}T=G}if(V)M=V}if(i==2){S=this.startContainer[0];if(S.nodeType==b.NODE_TEXT&&S.nextSibling&&S.nextSibling.nodeType==b.NODE_TEXT){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}S=this.endContainer[0];if(S.nodeType==b.NODE_TEXT&&S.nextSibling&&S.nextSibling.nodeType==b.NODE_TEXT){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}}else{if(U&&S&&(!C.parent()._4e_equals(U.parent())||!E.parent()._4e_equals(S.parent()))){U=
S._4e_index();K&&S.parent()._4e_equals(C.parent())&&U--;this.setStart(S.parent(),U)}this.collapse(j)}K&&C._4e_remove();N&&E[0].parentNode&&E._4e_remove()},collapse:function(i){if(i){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=j},clone:function(){var i=new l(this.document);i.startContainer=this.startContainer;i.startOffset=this.startOffset;i.endContainer=this.endContainer;i.endOffset=
this.endOffset;i.collapsed=this.collapsed;return i},getEnclosedNode:function(){var i=this.clone();i.optimize();if(i.startContainer[0].nodeType!=b.NODE_ELEMENT||i.endContainer[0].nodeType!=b.NODE_ELEMENT)return e;var y=new g.Walker(i),C=u(j,undefined),E=p(j);i.evaluator=function(D){return E(D)&&C(D)};i=y.next();y.reset();y=y.previous();return i&&i._4e_equals(y)?i:e},shrink:function(i,y){if(!this.collapsed){i=i||h.SHRINK_TEXT;var C=this.clone(),E=this.startContainer,D=this.endContainer,F=this.startOffset,
K=this.endOffset,M=1,N=1;if(E&&E[0].nodeType==b.NODE_TEXT)if(F)if(F>=E[0].nodeValue.length)C.setStartAfter(E);else{C.setStartBefore(E);M=0}else C.setStartBefore(E);if(D&&D[0].nodeType==b.NODE_TEXT)if(K)if(K>=D[0].nodeValue.length)C.setEndAfter(D);else{C.setEndAfter(D);N=0}else C.setEndBefore(D);C=new k(C);C.evaluator=function(U){U=U[0]||U;return U.nodeType==(i==h.SHRINK_ELEMENT?b.NODE_ELEMENT:b.NODE_TEXT)};var Q;C.guard=function(U,S){U=U[0]||U;if(i==h.SHRINK_ELEMENT&&U.nodeType==b.NODE_TEXT)return q;
if(S&&U==Q)return q;if(!S&&U.nodeType==b.NODE_ELEMENT)Q=U;return j};if(M)(E=C[i==h.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(E,y?h.POSITION_AFTER_START:h.POSITION_BEFORE_START);if(N){C.reset();(C=C[i==h.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(C,y?h.POSITION_BEFORE_END:h.POSITION_AFTER_END)}return!!(M||N)}},getTouchedStartNode:function(){var i=this.startContainer;if(this.collapsed||i[0].nodeType!=b.NODE_ELEMENT)return i;return i.childNodes[this.startOffset]||i},createBookmark2:function(i){var y=
this.startContainer,C=this.endContainer,E=this.startOffset,D=this.endOffset,F,K;if(!y||!C)return{start:0,end:0};if(i){if(y[0].nodeType==b.NODE_ELEMENT)if((F=new z(y[0].childNodes[E]))&&F[0]&&F[0].nodeType==b.NODE_TEXT&&E>0&&F[0].previousSibling.nodeType==b.NODE_TEXT){y=F;E=0}for(;y[0].nodeType==b.NODE_TEXT&&(K=y._4e_previous())&&K[0].nodeType==b.NODE_TEXT;){y=K;E+=K[0].nodeValue.length}if(!this.collapsed){if(C[0].nodeType==b.NODE_ELEMENT)if((F=new z(C[0].childNodes[D]))&&F[0]&&F[0].nodeType==b.NODE_TEXT&&
D>0&&F[0].previousSibling.nodeType==b.NODE_TEXT){C=F;D=0}for(;C[0].nodeType==b.NODE_TEXT&&(K=C._4e_previous())&&K[0].nodeType==b.NODE_TEXT;){C=K;D+=K[0].nodeValue.length}}}return{start:y._4e_address(i),end:this.collapsed?e:C._4e_address(i),startOffset:E,endOffset:D,normalized:i,is2:j}},createBookmark:function(i){var y,C,E,D,F=this.collapsed;y=new z("<span>",e,this.document);y.attr("_ke_bookmark",1);y.css("display","none");y.html("&nbsp;");if(i){E=c.guid("ke_bm_");y.attr("id",E+"S")}if(!F){C=y._4e_clone();
C.html("&nbsp;");i&&C.attr("id",E+"E");D=this.clone();D.collapse();D.insertNode(C)}D=this.clone();D.collapse(j);D.insertNode(y);if(C){this.setStartAfter(y);this.setEndBefore(C)}else this.moveToPosition(y,h.POSITION_AFTER_END);return{startNode:i?E+"S":y,endNode:i?E+"E":C,serializable:i,collapsed:F}},moveToPosition:function(i,y){this.setStartAt(i,y);this.collapse(j)},trim:function(i,y){var C=this.startContainer,E=this.startOffset,D=this.collapsed;if((!i||D)&&C[0]&&C[0].nodeType==b.NODE_TEXT){if(E)if(E>=
C[0].nodeValue.length){E=C._4e_index()+1;C=C.parent()}else{var F=C._4e_splitText(E);E=C._4e_index()+1;C=C.parent();if(a._4e_equals(this.startContainer,this.endContainer))this.setEnd(F,this.endOffset-this.startOffset);else if(a._4e_equals(C,this.endContainer))this.endOffset+=1}else{E=C._4e_index();C=C.parent()}this.setStart(C,E);if(D){this.collapse(j);return}}C=this.endContainer;E=this.endOffset;if(!(y||D)&&C[0]&&C[0].nodeType==b.NODE_TEXT){if(E){E>=C.nodeValue.length||C._4e_splitText(E);E=C._4e_index()+
1}else E=C._4e_index();C=C.parent();this.setEnd(C,E)}},insertNode:function(i){this.optimizeBookmark();this.trim(q,j);var y=this.startContainer;y[0].insertBefore(i[0]||i,y[0].childNodes[this.startOffset]||null);a._4e_equals(i.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(i)},moveToBookmark:function(i){if(i.is2){var y=d(this.document,i.start,i.normalized),C=i.startOffset,E=i.end&&d(this.document,i.end,i.normalized);i=i.endOffset;this.setStart(y,C);E?this.setEnd(E,i):this.collapse(j)}else{y=
(C=i.serializable)?c.one("#"+i.startNode,this.document):i.startNode;i=C?c.one("#"+i.endNode,this.document):i.endNode;this.setStartBefore(y);y._4e_remove();if(i&&i[0]){this.setEndBefore(i);i._4e_remove()}else this.collapse(j)}},getCommonAncestor:function(i,y){var C=this.startContainer,E=this.endContainer;C=a._4e_equals(C,E)?i&&C[0].nodeType==b.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new z(C[0].childNodes[this.startOffset]):C:C._4e_commonAncestor(E);return y&&C[0].nodeType==b.NODE_TEXT?C.parent():
C},enlarge:function(i){switch(i){case h.ENLARGE_ELEMENT:if(this.collapsed)break;i=this.getCommonAncestor();var y=new z(this.document.body),C,E,D,F,K,M=q,N,Q;N=this.startContainer;Q=this.startOffset;if(N[0].nodeType==b.NODE_TEXT){if(Q){N=!c.trim(N[0].nodeValue.substring(0,Q)).length&&N;M=!!N}if(N)if(!(F=N[0].previousSibling))D=N.parent()}else{if(Q)F=N[0].childNodes[Q-1]||N[0].lastChild;F||(D=N)}for(;D||F;){if(D&&!F){if(!K&&a._4e_equals(D,i))K=j;if(!y.contains(D))break;if(!M||D.css("display")!="inline"){M=
q;if(K)C=D;else this.setStartBefore(D)}F=D[0].previousSibling}for(;F;){N=q;if(F.nodeType==b.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=e;N=/[\s\ufeff]$/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(M&&r.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=e;else for(var U=F.all||F.getElementsByTagName("*"),S=0,T;T=U[S++];)if(!r.$removeEmpty[T.nodeName.toLowerCase()]){F=e;break}if(F)N=!!Q.length}else F=e;if(N)if(M)if(K)C=D;else D&&this.setStartBefore(D);
else M=j;if(F){N=F.previousSibling;if(!D&&!N){D=new z(F);F=e;break}F=N}else D=e}if(D)D=D.parent()}N=this.endContainer;Q=this.endOffset;D=F=e;K=M=q;if(N[0].nodeType==b.NODE_TEXT){N=!c.trim(N[0].nodeValue.substring(Q)).length&&N;M=!(N&&N[0].nodeValue.length);if(N)if(!(F=N[0].nextSibling))D=N.parent()}else(F=N[0].childNodes[Q])||(D=N);for(;D||F;){if(D&&!F){if(!K&&a._4e_equals(D,i))K=j;if(!y.contains(D))break;if(!M||D.css("display")!="inline"){M=q;if(K)E=D;else D&&this.setEndAfter(D)}F=D[0].nextSibling}for(;F;){N=
q;if(F.nodeType==b.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=e;N=/^[\s\ufeff]/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(M&&r.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=e;else{U=F.all||F.getElementsByTagName("*");for(S=0;T=U[S++];)if(!r.$removeEmpty[T.nodeName.toLowerCase()]){F=e;break}}if(F)N=!!Q.length}else F=e;if(N)if(M)if(K)E=D;else this.setEndAfter(D);if(F){N=F.nextSibling;if(!D&&!N){D=new z(F);F=e;break}F=N}else D=e}if(D)D=
D.parent()}if(C&&E){i=C.contains(E)?E:C;this.setStartBefore(i);this.setEndAfter(i)}break;case h.ENLARGE_BLOCK_CONTENTS:case h.ENLARGE_LIST_ITEM_CONTENTS:D=new l(this.document);y=new z(this.document.body);D.setStartAt(y,h.POSITION_AFTER_START);D.setEnd(this.startContainer,this.startOffset);D=new k(D);var V,G,L=k.blockBoundary(i==h.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:e),I=function(H){var J=L(H);J||(V=H);return J};C=function(H){var J=I(H);if(!J&&H[0]&&H._4e_name()=="br")G=H;return J};D.guard=I;D=D.lastBackward();
V=V||y;this.setStartAt(V,V._4e_name()!="br"&&(!D&&this.checkStartOfBlock()||D&&V.contains(D))?h.POSITION_AFTER_START:h.POSITION_AFTER_END);D=this.clone();D.collapse();D.setEndAt(y,h.POSITION_BEFORE_END);D=new k(D);D.guard=i==h.ENLARGE_LIST_ITEM_CONTENTS?C:I;V=e;D=D.lastForward();V=V||y;this.setEndAt(V,!D&&this.checkEndOfBlock()||D&&V.contains(D)?h.POSITION_BEFORE_END:h.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},checkStartOfBlock:function(){var i=this.startContainer,y=this.startOffset;if(y&&i[0].nodeType==
b.NODE_TEXT)if(c.trim(i[0].nodeValue.substring(0,y)).length)return q;this.trim();i=new w(this.startContainer);y=this.clone();y.collapse(j);y.setStartAt(i.block||i.blockLimit,h.POSITION_AFTER_START);i=new k(y);i.evaluator=n(j);return i.checkBackward()},checkEndOfBlock:function(){var i=this.endContainer,y=this.endOffset;if(i[0].nodeType==b.NODE_TEXT)if(c.trim(i[0].nodeValue.substring(y)).length)return q;this.trim();i=new w(this.endContainer);y=this.clone();y.collapse(q);y.setEndAt(i.block||i.blockLimit,
h.POSITION_BEFORE_END);i=new k(y);i.evaluator=n(q);return i.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var i=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,i);return i},checkBoundaryOfElement:function(i,y){var C=this.clone();C[y==h.START?"setStartAt":"setEndAt"](i,y==h.START?h.POSITION_AFTER_START:h.POSITION_BEFORE_END);C=new k(C);C.evaluator=s;return C[y==h.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var i=this.startContainer,y=this.endContainer,C=this.startOffset,E=this.endOffset,D;if(i[0].nodeType==b.NODE_ELEMENT){D=i[0].childNodes.length;if(D>C)i=new z(i[0].childNodes[C]);else if(D<1)i=i._4e_previousSourceNode();else{for(i=i[0];i.lastChild;)i=i.lastChild;i=new z(i);i=i._4e_nextSourceNode()||i}}if(y[0].nodeType==b.NODE_ELEMENT){D=y[0].childNodes.length;if(D>E)y=(new z(y[0].childNodes[E]))._4e_previousSourceNode(j);else if(D<1)y=y._4e_previousSourceNode();else{for(y=
y[0];y.lastChild;)y=y.lastChild;y=new z(y)}}if(i._4e_position(y)&m.POSITION_FOLLOWING)i=y;return{startNode:i,endNode:y}},fixBlock:function(i,y){var C=this.createBookmark(),E=new z(this.document.createElement(y));this.collapse(i);this.enlarge(h.ENLARGE_BLOCK_CONTENTS);E[0].appendChild(this.extractContents());E._4e_trim();f.ie||E._4e_appendBogus();this.insertNode(E);this.moveToBookmark(C);return E},splitBlock:function(i){var y=new w(this.startContainer),C=new w(this.endContainer),E=y.block,D=C.block,
F=e;if(!y.blockLimit._4e_equals(C.blockLimit))return e;if(i!="br"){if(!E){E=this.fixBlock(j,i);D=(new w(this.endContainer)).block}D||(D=this.fixBlock(q,i))}i=E&&this.checkStartOfBlock();y=D&&this.checkEndOfBlock();this.deleteContents();if(E&&a._4e_equals(E,D))if(y){F=new w(this.startContainer);this.moveToPosition(D,h.POSITION_AFTER_END);D=e}else if(i){F=new w(this.startContainer);this.moveToPosition(E,h.POSITION_BEFORE_START);E=e}else{D=this.splitElement(E);!f.ie&&!c.inArray(E._4e_name(),["ul","ol"])&&
E._4e_appendBogus()}return{previousBlock:E,nextBlock:D,wasStartOfBlock:i,wasEndOfBlock:y,elementPath:F}},splitElement:function(i){if(!this.collapsed)return e;this.setEndAt(i,h.POSITION_BEFORE_END);var y=this.extractContents(),C=i._4e_clone(q);C[0].appendChild(y);C.insertAfter(i);this.moveToPosition(i,h.POSITION_AFTER_END);return C},moveToElementEditablePosition:function(i,y){var C,E=g.XHTML_DTD;if(E.$empty[i._4e_name()])return q;for(;i&&i[0].nodeType==b.NODE_ELEMENT;){if(C=i._4e_isEditable())this.moveToPosition(i,
y?h.POSITION_BEFORE_END:h.POSITION_AFTER_START);else if(E.$inline[i._4e_name()]){this.moveToPosition(i,y?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);return j}if((i=E.$empty[i._4e_name()]?i[y?"_4e_previous":"_4e_next"](v):i[y?"_4e_last":"_4e_first"](v))&&i[0].nodeType==b.NODE_TEXT){this.moveToPosition(i,y?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);return j}}return C},selectNodeContents:function(i){this.setStart(i,0);this.setEnd(i,i[0].nodeType==b.NODE_TEXT?i[0].nodeValue.length:i[0].childNodes.length)}});
var o={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},A=new k.whitespaces,x=new k.bookmark;g.Range=l;g.Range=l;var B=l.prototype;g.Utils.extern(B,{updateCollapsed:B.updateCollapsed,optimize:B.optimize,setStartAfter:B.setStartAfter,setEndAfter:B.setEndAfter,setStartBefore:B.setStartBefore,setEndBefore:B.setEndBefore,optimizeBookmark:B.optimizeBookmark,setStart:B.setStart,setEnd:B.setEnd,
setStartAt:B.setStartAt,setEndAt:B.setEndAt,execContentsAction:B.execContentsAction,collapse:B.collapse,clone:B.clone,getEnclosedNode:B.getEnclosedNode,shrink:B.shrink,getTouchedStartNode:B.getTouchedStartNode,createBookmark2:B.createBookmark2,createBookmark:B.createBookmark,moveToPosition:B.moveToPosition,trim:B.trim,insertNode:B.insertNode,moveToBookmark:B.moveToBookmark,getCommonAncestor:B.getCommonAncestor,enlarge:B.enlarge,checkStartOfBlock:B.checkStartOfBlock,checkEndOfBlock:B.checkEndOfBlock,
deleteContents:B.deleteContents,extractContents:B.extractContents,checkBoundaryOfElement:B.checkBoundaryOfElement,getBoundaryNodes:B.getBoundaryNodes,fixBlock:B.fixBlock,splitBlock:B.splitBlock,splitElement:B.splitElement,moveToElementEditablePosition:B.moveToElementEditablePosition,selectNodeContents:B.selectNodeContents})});
KISSY.Editor.add("domiterator",function(g){function l(k){if(!(arguments.length<1)){this.range=k;this.forceBrBreak=v;this.enlargeBr=s;this.enforceRealBlocks=v;this._||(this._={})}}var s=true,v=false,n=KISSY,u=n.UA,p=g.Walker,j=g.Range,q=g.RANGE,e=g.NODE,c=g.ElementPath,b=n.Node,h=n.DOM,m=/^[\r\n\t ]*$/;n.augment(l,{getNextParagraph:function(k){var a,d,f,r,w;if(!this._.lastNode){d=this.range.clone();d.shrink(q.SHRINK_ELEMENT,s);d.enlarge(this.forceBrBreak||!this.enlargeBr?q.ENLARGE_LIST_ITEM_CONTENTS:
q.ENLARGE_BLOCK_CONTENTS);var z=new p(d),t=p.bookmark(s,s);z.evaluator=t;this._.nextNode=z.next();z=new p(d);z.evaluator=t;z=z.previous();this._.lastNode=z._4e_nextSourceNode(s);if(this._.lastNode&&this._.lastNode[0].nodeType==e.NODE_TEXT&&!n.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){t=new j(d.document);t.moveToPosition(this._.lastNode,q.POSITION_AFTER_END);if(t.checkEndOfBlock()){t=new c(t.endContainer);this._.lastNode=(t.block||t.blockLimit)._4e_nextSourceNode(s)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new b(d.document.createTextNode(""));h.insertAfter(this._.lastNode[0],z[0])}d=null}t=this._.nextNode;z=this._.lastNode;for(this._.nextNode=null;t;){var o=v,A=t[0].nodeType!=e.NODE_ELEMENT,x=v;if(A){if(t[0].nodeType==e.NODE_TEXT)if(m.test(t[0].nodeValue))A=v}else{var B=t._4e_name();if(t._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(B=="br")A=s;else if(!d&&!t[0].childNodes.length&&B!="hr"){a=t;f=t._4e_equals(z);break}if(d){d.setEndAt(t,q.POSITION_BEFORE_START);if(B!="br")this._.nextNode=
t}o=s}else{if(t[0].firstChild){if(!d){d=new j(this.range.document);d.setStartAt(t,q.POSITION_BEFORE_START)}t=new b(t[0].firstChild);continue}A=s}}if(A&&!d){d=new j(this.range.document);d.setStartAt(t,q.POSITION_BEFORE_START)}f=(!o||A)&&t._4e_equals(z);if(d&&!o)for(;!t[0].nextSibling&&!f;){B=t.parent();if(B._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){o=s;f||B._4e_equals(z);break}t=B;A=s;f=t._4e_equals(z);x=s}A&&d.setEndAt(t,q.POSITION_AFTER_END);t=t._4e_nextSourceNode(x,null,z);if((f=!t)||o&&d)break}if(!a){if(!d){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}a=new c(d.startContainer);t=a.blockLimit;o={div:1,th:1,td:1};a=a.block;if((!a||!a[0])&&!this.enforceRealBlocks&&o[t._4e_name()]&&d.checkStartOfBlock()&&d.checkEndOfBlock())a=t;else if(!a||this.enforceRealBlocks&&a._4e_name()=="li"){a=new b(this.range.document.createElement(k||"p"));a[0].appendChild(d.extractContents());a._4e_trim();d.insertNode(a);r=w=s}else if(a._4e_name()!="li"){if(!d.checkStartOfBlock()||!d.checkEndOfBlock()){a=a._4e_clone(v);
a[0].appendChild(d.extractContents());a._4e_trim();w=d.splitBlock();r=!w.wasStartOfBlock;w=!w.wasEndOfBlock;d.insertNode(a)}}else if(!f)this._.nextNode=a._4e_equals(z)?null:d.getBoundaryNodes().endNode._4e_nextSourceNode(s,null,z)}if(r){d=new b(a[0].previousSibling);if(d[0]&&d[0].nodeType==e.NODE_ELEMENT)if(d._4e_name()=="br")d._4e_remove();else d[0].lastChild&&h._4e_name(d[0].lastChild)=="br"&&h._4e_remove(d[0].lastChild)}if(w){d=p.bookmark(v,s);r=new b(a[0].lastChild);if(r[0]&&r[0].nodeType==e.NODE_ELEMENT&&
r._4e_name()=="br")if(u.ie||r._4e_previous(d)||r._4e_next(d))r._4e_remove()}if(!this._.nextNode)this._.nextNode=f||a._4e_equals(z)?null:a._4e_nextSourceNode(s,null,z);return a}});j.prototype.createIterator=function(){return new l(this)}});
KISSY.Editor.add("selection",function(g){function l(t){this.document=this.document=t;this._={cache:{}};if(q.ie){var o=this.getNative().createRange();if(!o||o.item&&o.item(0).ownerDocument!=t||o.parentElement&&o.parentElement().ownerDocument!=t)this.isInvalid=n}}function s(t){t=new l(t);return!t||t.isInvalid?p:t}function v(t){var o=t.document,A=new b(o.body),x=new b(o.documentElement);if(q.ie){if(q.ie<8||document.documentMode==7)x.on("click",function(M){e._4e_name(M.target)==="html"&&t.getSelection().getRanges()[0].select()});
var B,i,y=1;x.on("mousedown",function(){y=0});x.on("mouseup",function(){y=1});A.on("focusin",function(M){if(e._4e_name(M.target)=="body")if(B){try{y&&B.select()}catch(N){}B=p}});A.on("focus",function(){i=n;E()});A.on("beforedeactivate",function(M){if(!M.relatedTarget){i=u;y=1}});c.on(e._4e_getWin(o),"blur",function(){o&&o.selection.empty()});A.on("mousedown",function(){C()});A.on("mouseup",function(){i=n;setTimeout(function(){E(n)},0)});var C=function(){i=u},E=function(M){if(i){var N=t.document,Q=
t.getSelection(),U=Q&&Q.getType(),S=Q&&Q.getNative();if(M&&S&&U==h.SELECTION_NONE)if(!N.queryCommandEnabled("InsertImage")){setTimeout(function(){E(n)},50);return}var T;if(!(S&&U==h.SELECTION_TEXT&&(T=e._4e_name(S.createRange().parentElement()))&&T in{input:1,textarea:1})){B=S&&Q.getRanges()[0];t._monitor()}}};A.on("keydown",C);A.on("keyup",function(){i=n;E()});c.on(o,"selectionchange",E)}else{c.on(o,"mouseup",t._monitor,t);c.on(o,"keyup",t._monitor,t)}var D={table:1,pre:1},F=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
K=g.Walker.whitespaces(n);t.on("selectionChange",function(M){var N=M.path;M=(M=M.selection)&&M.getRanges()[0];if(!(!M||!M.collapsed||N.block))if(N.blockLimit._4e_name()=="body"){N=M.fixBlock(n,"p");if(N._4e_outerHtml().match(F)){var Q=N._4e_next(K);if(Q&&Q[0].nodeType==k.NODE_ELEMENT&&!D[Q._4e_name()]){M.moveToElementEditablePosition(Q);N._4e_remove()}else if((Q=N._4e_previous(K))&&Q[0].nodeType==k.NODE_ELEMENT&&!D[Q._4e_name()]){M.moveToElementEditablePosition(Q,Q._4e_outerHtml().match(F)?u:n);N._4e_remove()}}M.select();
q.ie||t.notifySelectionChange()}})}g.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var n=true,u=false,p=null,j=KISSY,q=j.UA,e=j.DOM,c=j.Event,b=j.Node,h=g.SELECTION,m=g.RANGE,k=g.NODE,a=g.Walker,d=g.Range,f={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};j.augment(l,{getNative:q.ie?function(){var t=this._.cache;return t.nativeSel||(t.nativeSel=this.document.selection)}:function(){var t=
this._.cache;return t.nativeSel||(t.nativeSel=e._4e_getWin(this.document).getSelection())},getType:q.ie?function(){var t=this._.cache;if(t.type)return t.type;var o=h.SELECTION_NONE;try{var A=this.getNative(),x=A.type;if(x=="Text")o=h.SELECTION_TEXT;if(x=="Control")o=h.SELECTION_ELEMENT;if(A.createRange().parentElement)o=h.SELECTION_TEXT}catch(B){}return t.type=o}:function(){var t=this._.cache;if(t.type)return t.type;var o=h.SELECTION_TEXT,A=this.getNative();if(A){if(A.rangeCount==1){A=A.getRangeAt(0);
var x=A.startContainer;if(x==A.endContainer&&x.nodeType==k.NODE_ELEMENT&&A.endOffset-A.startOffset===1&&f[x.childNodes[A.startOffset].nodeName.toLowerCase()])o=h.SELECTION_ELEMENT}}else o=h.SELECTION_NONE;return t.type=o},getRanges:q.ie?function(){var t=function(o,A){o=o.duplicate();o.collapse(A);for(var x=o.parentElement(),B=x.childNodes,i,y=0;y<B.length;y++){var C=B[y];if(C.nodeType==k.NODE_ELEMENT){i=o.duplicate();i.moveToElementText(C);C=i.compareEndPoints("StartToStart",o);var E=i.compareEndPoints("EndToStart",
o);i.collapse();if(C>0)break;else if(!C||E==1&&C==-1)return{container:x,offset:y};else if(!E)return{container:x,offset:y+1};i=p}}if(!i){i=o.duplicate();i.moveToElementText(x);i.collapse(u)}i.setEndPoint("StartToStart",o);i=i.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;i>0;)i-=B[--y].nodeValue.length}catch(D){i=0}return i===0?{container:x,offset:y}:{container:B[y],offset:-i}};return function(){var o=this._.cache;if(o.ranges)return o.ranges;var A=this.getNative(),x=A&&A.createRange(),B=this.getType();
if(!A)return[];if(B==h.SELECTION_TEXT){A=new d(this.document);B=t(x,n);A.setStart(new b(B.container),B.offset);B=t(x);A.setEnd(new b(B.container),B.offset);return o.ranges=[A]}else if(B==h.SELECTION_ELEMENT){o=o.ranges=[];for(B=0;B<x.length;B++){var i=x.item(B),y=i.parentNode,C=0;for(A=new d(this.document);C<y.childNodes.length&&y.childNodes[C]!=i;C++);A.setStart(new b(y),C);A.setEnd(new b(y),C+1);o.push(A)}return o}return o.ranges=[]}}():function(){var t=this._.cache;if(t.ranges)return t.ranges;
var o=[],A=this.getNative();if(!A)return[];for(var x=0;x<A.rangeCount;x++){var B=A.getRangeAt(x),i=new d(this.document);i.setStart(new b(B.startContainer),B.startOffset);i.setEnd(new b(B.endContainer),B.endOffset);o.push(i)}return t.ranges=o},getStartElement:function(){var t=this._.cache;if(t.startElement!==undefined)return t.startElement;var o,A=this.getNative();switch(this.getType()){case h.SELECTION_ELEMENT:return this.getSelectedElement();case h.SELECTION_TEXT:var x=this.getRanges()[0];if(x)if(!x.collapsed){for(x.optimize();n;){o=
x.startContainer;if(x.startOffset==(o[0].nodeType===k.NODE_ELEMENT?o[0].childNodes.length:o[0].nodeValue.length)&&!o._4e_isBlockBoundary())x.setStartAfter(o);else break}o=x.startContainer;if(o[0].nodeType!=k.NODE_ELEMENT)return o.parent();o=new b(o[0].childNodes[x.startOffset]);if(!o[0]||o[0].nodeType!=k.NODE_ELEMENT)return x.startContainer;for(x=o[0].firstChild;x&&x.nodeType==k.NODE_ELEMENT;){o=new b(x);x=x.firstChild}return o}if(q.ie){x=A.createRange();x.collapse(n);o=x.parentElement()}else if((o=
A.anchorNode)&&o.nodeType!=k.NODE_ELEMENT)o=o.parentNode}return t.startElement=o?e._4e_wrap(o):p},getSelectedElement:function(){var t=this,o,A=t._.cache;if(A.selectedElement!==undefined)return A.selectedElement;if(q.ie){o=t.getNative().createRange();o=o.item&&o.item(0)}o||(o=function(){for(var x=t.getRanges()[0],B,i,y=2;y&&!((B=x.getEnclosedNode())&&B[0].nodeType==k.NODE_ELEMENT&&f[B._4e_name()]&&(i=B));y--)x.shrink(m.SHRINK_ELEMENT);return i&&i[0]}());return A.selectedElement=e._4e_wrap(o)},reset:function(){this._.cache=
{}},selectElement:function(t){var o;if(q.ie)try{o=this.document.body.createControlRange();o.addElement(t[0]);o.select()}catch(A){o=this.document.body.createTextRange();o.moveToElementText(t[0]);o.select()}finally{}else{o=this.document.createRange();o.selectNode(t[0]);t=this.getNative();t.removeAllRanges();t.addRange(o)}this.reset()},selectRanges:function(t){if(q.ie){if(t.length>1){var o=t[t.length-1];t[0].setEnd(o.endContainer,o.endOffset);t.length=1}t[0]&&t[0].select()}else{o=this.getNative();if(!o)return;
o.removeAllRanges();for(var A=0;A<t.length;A++){var x=t[A],B=this.document.createRange(),i=x.startContainer;x.collapsed&&q.gecko&&q.gecko<1.09&&i[0].nodeType==k.NODE_ELEMENT&&!i[0].childNodes.length&&i[0].appendChild(this.document.createTextNode(""));B.setStart(i[0],x.startOffset);B.setEnd(x.endContainer[0],x.endOffset);o.addRange(B)}}this.reset()},createBookmarks2:function(t){for(var o=[],A=this.getRanges(),x=0;x<A.length;x++)o.push(A[x].createBookmark2(t));return o},createBookmarks:function(t,o){var A=
[],x=this.document,B;o=o||this.getRanges();for(var i=o.length,y=0;y<i;y++){A.push(B=o[y].createBookmark(t,n));var C=(t=B.serializable)?j.one("#"+B.startNode,x):B.startNode;B=t?j.one("#"+B.endNode,x):B.endNode;for(var E=y+1;E<i;E++){var D=o[E],F=D.startContainer,K=D.endContainer;e._4e_equals(F,C.parent())&&D.startOffset++;e._4e_equals(F,B.parent())&&D.startOffset++;e._4e_equals(K,C.parent())&&D.endOffset++;e._4e_equals(K,B.parent())&&D.endOffset++}}return A},selectBookmarks:function(t){for(var o=[],
A=0;A<t.length;A++){var x=new d(this.document);x.moveToBookmark(t[A]);o.push(x)}this.selectRanges(o);return this},getCommonAncestor:function(){var t=this.getRanges();return t[0].startContainer._4e_commonAncestor(t[t.length-1].endContainer)},scrollIntoView:function(){var t=this.getStartElement();t&&t._4e_scrollIntoView()},removeAllRanges:function(){var t=this.getNative();if(q.ie)t&&t.clear();else t&&t.removeAllRanges()}});var r={table:1,tbody:1,tr:1},w=a.whitespaces(n),z=/\ufeff|\u00a0/;d.prototype.select=
d.prototype.select=q.ie?function(t){var o=this.collapsed,A,x;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var B=this.startContainer[0].childNodes[this.startOffset];if(B.nodeType==k.NODE_ELEMENT){(new l(this.document)).selectElement(new b(B));return}}if(this.startContainer[0].nodeType==k.NODE_ELEMENT&&this.startContainer._4e_name()in r||this.endContainer[0].nodeType==k.NODE_ELEMENT&&this.endContainer._4e_name()in r)this.shrink(m.SHRINK_ELEMENT,n);var i=this.createBookmark();
B=i.startNode;var y;if(!o)y=i.endNode;i=this.document.body.createTextRange();i.moveToElementText(B[0]);i.moveStart("character",1);if(y){t=this.document.body.createTextRange();t.moveToElementText(y[0]);i.setEndPoint("EndToEnd",t);i.moveEnd("character",-1)}else{for(A=B[0].nextSibling;A&&!w(A);)A=A.nextSibling;A=!(A&&A.nodeValue&&A.nodeValue.match(z))&&(t||!B[0].previousSibling||B[0].previousSibling&&e._4e_name(B[0].previousSibling)=="br");x=this.document.createElement("span");x.innerHTML="&#65279;";
x=(new b(x)).insertBefore(B);A&&e.insertBefore(this.document.createTextNode("\ufeff"),B)}this.setStartBefore(B);B._4e_remove();if(o){if(A){i.moveStart("character",-1);i.select();this.document.selection.clear()}else i.select();if(x){this.moveToPosition(x,m.POSITION_BEFORE_START);x._4e_remove()}}else{this.setEndBefore(y);y._4e_remove();i.select()}}:function(){var t=this.startContainer;this.collapsed&&t[0].nodeType==k.NODE_ELEMENT&&!t[0].childNodes.length&&t[0].appendChild(this.document.createTextNode(""));
var o=this.document.createRange();o.setStart(t[0],this.startOffset);try{o.setEnd(this.endContainer[0],this.endOffset)}catch(A){if(A.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(n);o.setEnd(this.endContainer[0],this.endOffset)}else throw A;}t=s(this.document).getNative();t.removeAllRanges();t.addRange(o)};l.getSelection=s;g.Selection=l;g.Selection=l;a=l.prototype;g.Utils.extern(a,{getNative:a.getNative,getType:a.getType,getRanges:a.getRanges,getStartElement:a.getStartElement,getSelectedElement:a.getSelectedElement,
reset:a.reset,selectElement:a.selectElement,selectRanges:a.selectRanges,createBookmarks2:a.createBookmarks2,createBookmarks:a.createBookmarks,getCommonAncestor:a.getCommonAncestor,scrollIntoView:a.scrollIntoView,selectBookmarks:a.selectBookmarks,removeAllRanges:a.removeAllRanges});g.on("instanceCreated",function(t){v(t.editor)})});
KISSY.Editor.add("styles",function(g){function l(G,L){for(var I in G)G[I]=G[I].replace(T,function(H,J){return L[J]})}function s(G,L){if(L){G=A.clone(G);l(G.attributes,L);l(G.styles,L)}var I=this.element=this.element=(G.element||"*").toLowerCase();this.type=this.type=I=="#"||Q[I]?i.STYLE_BLOCK:U[I]?i.STYLE_OBJECT:i.STYLE_INLINE;this._={definition:G}}function v(G,L){var I=L?this.removeFromRange:this.applyToRange;G.body.focus();for(var H=new C(G),J=H.getRanges(),P=0;P<J.length;P++)I.call(this,J[P]);
H.selectRanges(J)}function n(G,L){var I;I=G.element;if(I=="*")I="span";I=new K(L.createElement(I));return u(I,G)}function u(G,L){var I=L._.definition,H=I.attributes;I=s.getStyleText(I);if(H)for(var J in H)G.attr(J,H[J]);if(I)G[0].style.cssText=I;return G}function p(G){var L=G.createBookmark(z),I=G.createIterator();I.enforceRealBlocks=z;I.enlargeBr=z;for(var H,J=G.document;H=I.getNextParagraph();){var P=n(this,J);H=H;var O=P;P=O._4e_name=="pre";var R=H._4e_name=="pre",Z=!P&&R;if(P&&!R){R=H;O=O;Z=R.html();
Z=j(Z,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");Z=Z.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");Z=Z.replace(/([ \t\n\r]+|&nbsp;)/g," ");Z=Z.replace(/<br\b[^>]*>/gi,"\n");if(M.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(O[0]);O[0].outerHTML="<pre>"+Z+"</pre>";O=new K(R.firstChild);O._4e_remove()}else O.html(Z);O=O}else if(Z)O=e(q(H),O);else H._4e_moveChildren(O);H[0].parentNode.replaceChild(O[0],H[0]);if(P){H=O;P=void 0;if((P=H._4e_previousSourceNode(z,E.NODE_ELEMENT))&&P._4e_name()==
"pre"){O=j(P.html(),/\n$/,"")+"\n\n"+j(H.html(),/^\n/,"");if(M.ie)H[0].outerHTML="<pre>"+O+"</pre>";else H.html(O);P._4e_remove()}}}G.moveToBookmark(L)}function j(G,L,I){var H="",J="";G=G.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(P,O,R){O&&(H=O);R&&(J=R);return""});return H+G.replace(L,I)+J}function q(G){var L=[];j(G._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(I,H,J){return H+"</pre>"+J+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(I,H){L.push(H)});return L}function e(G,L){for(var I=L[0].ownerDocument.createDocumentFragment(),H=0;H<G.length;H++){var J=G[H];J=J.replace(/(\r\n|\r)/g,"\n");J=j(J,/^[ \t]*\n/,"");J=j(J,/\n$/,"");J=j(J,/^[ \t]+|[ \t]+$/g,function(O,R){return O.length==1?"&nbsp;":R?" "+Array(O.length).join("&nbsp;"):Array(O.length).join("&nbsp;")+" "});J=J.replace(/\n/g,"<br>");J=J.replace(/[ \t]{2,}/g,function(O){return Array(O.length).join("&nbsp;")+" "});var P=L._4e_clone();P.html(J);I.appendChild(P[0])}return I}
function c(G){var L=G.document;if(G.collapsed){L=n(this,L);G.insertNode(L);G.moveToPosition(L,y.POSITION_BEFORE_END)}else{var I=this.element,H=this._.definition,J,P=g.XHTML_DTD[I]||(J=z,g.XHTML_DTD.span),O=G.createBookmark();G.enlarge(y.ENLARGE_ELEMENT);G.trim();var R=G.createBookmark(),Z=R.startNode;R=R.endNode;for(var X=Z,$;X&&X[0];){var W=t;if(B._4e_equals(X,R)){X=o;W=z}else{var Y=X[0].nodeType,ca=Y==E.NODE_ELEMENT?X._4e_name():o;if(ca&&X.attr("_ke_bookmark")){X=X._4e_nextSourceNode(z);continue}if(!ca||
P[ca]&&(X._4e_position(R)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(X))){var da=X.parent();if(da&&da[0]&&((g.XHTML_DTD[da._4e_name()]||g.XHTML_DTD.span)[I]||J)&&(!H.parentRule||H.parentRule(da))){if(!$&&(!ca||!g.XHTML_DTD.$removeEmpty[ca]||(X._4e_position(R)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED)){$=
new F(L);$.setStartBefore(X)}if(Y==E.NODE_TEXT||Y==E.NODE_ELEMENT&&!X[0].childNodes.length){Y=X;var aa;for(ca=Y._4e_next(function(fa){return!fa.attr("_ke_bookmark")});!ca&&(aa=Y.parent(),P[aa._4e_name()])&&(aa._4e_position(Z)|D.POSITION_FOLLOWING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_FOLLOWING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(aa));)Y=aa;$.setEndAfter(Y);Y[0].nextSibling||(W=z)}}else W=z}else W=z;X=X._4e_nextSourceNode()}if(W&&$&&!$.collapsed){W=
n(this,L);for(Y=$.getCommonAncestor();W&&Y&&W[0]&&Y[0];){if(Y._4e_name()==I){for(var ba in H.attributes)W.attr(ba)==Y.attr(ba)&&W[0].removeAttribute(ba);for(var ea in H.styles)W._4e_style(ea)==Y._4e_style(ea)&&W._4e_style(ea,"");if(!W._4e_hasAttributes()){W=o;break}}Y=Y.parent()}if(W){W[0].appendChild($.extractContents());f(this,W);$.insertNode(W);W._4e_mergeSiblings();M.ie||W[0].normalize()}$=o}}Z._4e_remove();R._4e_remove();G.moveToBookmark(O);G.shrink(y.SHRINK_TEXT)}}function b(G){G.enlarge(y.ENLARGE_ELEMENT);
var L=G.createBookmark(),I=L.startNode;if(G.collapsed){for(var H=new N(I.parent()),J,P=0,O;P<H.elements.length&&(O=H.elements[P]);P++){if(O==H.block||O==H.blockLimit)break;if(this.checkElementRemovable(O)){var R=G.checkBoundaryOfElement(O,y.END),Z=!R&&G.checkBoundaryOfElement(O,y.START);if(Z||R){J=O;J.match=Z?"start":"end"}else{O._4e_mergeSiblings();O._4e_name()==this.element?a(this,O):r(O,k(this)[O._4e_name()])}}}if(J&&J[0]){O=I;for(P=0;;P++){R=H.elements[P];if(B._4e_equals(R,J))break;else if(R.match)continue;
else R=R._4e_clone();R[0].appendChild(O[0]);O=R}B[J.match=="start"?"insertBefore":"insertAfter"](O,J)}}else{var X=L.endNode,$=this;H=function(){for(var W=new N(I.parent()),Y=new N(X.parent()),ca=o,da=o,aa=0;aa<W.elements.length;aa++){var ba=W.elements[aa];if(ba==W.block||ba==W.blockLimit)break;if($.checkElementRemovable(ba))ca=ba}for(aa=0;aa<Y.elements.length;aa++){ba=Y.elements[aa];if(ba==Y.block||ba==Y.blockLimit)break;if($.checkElementRemovable(ba))da=ba}da&&X._4e_breakParent(da);ca&&I._4e_breakParent(ca)};
H();for(J=new K(I[0].nextSibling);J[0]!==X[0];){P=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==E.NODE_ELEMENT&&this.checkElementRemovable(J)){J._4e_name()==this.element?a(this,J):r(J,k(this)[J._4e_name()]);if(P[0].nodeType==E.NODE_ELEMENT&&P.contains(I)){H();P=new K(I[0].nextSibling)}}J=P}}G.moveToBookmark(L)}function h(G){var L={};G.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(I,H,J){L[H]=J});return L}function m(G,L){var I;if(L!==t){I=document.createElement("span");
I.style.cssText=G;I=I.style.cssText||""}else I=G;return I.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function k(G){if(G._.overrides)return G._.overrides;var L=G._.overrides={},I=G._.definition.overrides;if(I){A.isArray(I)||(I=[I]);for(var H=0;H<I.length;H++){var J=I[H],P,O;if(typeof J=="string")P=J.toLowerCase();else{P=J.element?J.element.toLowerCase():G.element;O=J.attributes}J=L[P]||(L[P]={});if(O){J=J.attributes=J.attributes||[];for(var R in O)J.push([R.toLowerCase(),
O[R]])}}}return L}function a(G,L){var I=G._.definition,H=x.mix(I.attributes,k(G)[L._4e_name()]);I=I.styles;var J=A.isEmptyObject(H)&&A.isEmptyObject(I),P;for(P in H)if(!((P=="class"||G._.definition.fullMatch)&&L.attr(P)!=d(P,H[P]))){J=J||!!L._4e_hasAttribute(P);L.removeAttr(P)}for(var O in I)if(!(G._.definition.fullMatch&&L._4e_style(O)!=d(O,I[O],z))){J=J||!!L._4e_style(O);L._4e_style(O,"")}w(L)}function d(G,L,I){var H=new K("<span>");H[I?"_4e_style":"attr"](G,L);return H[I?"_4e_style":"attr"](G)}
function f(G,L){for(var I=k(G),H=L.all(G.element),J=H.length;--J>=0;)a(G,new K(H[J]));for(var P in I)if(P!=G.element){H=L.all(P);for(J=H.length-1;J>=0;J--){var O=new K(H[J]);r(O,I[P])}}}function r(G,L){var I=L&&L.attributes;if(I)for(var H=0;H<I.length;H++){var J=I[H][0],P;if(P=G.attr(J)){var O=I[H][1];if(O===o||O.test&&O.test(P)||typeof O=="string"&&P==O)G[0].removeAttribute(J)}}w(G)}function w(G){if(!G._4e_hasAttributes()){var L=G[0].firstChild,I=G[0].lastChild;G._4e_remove(z);if(L){L.nodeType==
E.NODE_ELEMENT&&B._4e_mergeSiblings(L);I&&L!=I&&I.nodeType==E.NODE_ELEMENT&&B._4e_mergeSiblings(I)}}}var z=true,t=false,o=null,A=KISSY,x=g.Utils,B=A.DOM,i={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},y=g.RANGE,C=g.Selection,E=g.NODE,D=g.POSITION,F=g.Range,K=A.Node,M=A.UA,N=g.ElementPath,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},U={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},S=/\s*(?:;\s*|$)/,T=/#\((.+?)\)/g;g.STYLE=i;s.prototype={apply:function(G){v.call(this,
G,t)},remove:function(G){v.call(this,G,z)},applyToRange:function(G){return(this.applyToRange=this.type==i.STYLE_INLINE?c:this.type==i.STYLE_BLOCK?p:this.type==i.STYLE_OBJECT?o:o).call(this,G)},removeFromRange:function(G){return(this.removeFromRange=this.type==i.STYLE_INLINE?b:o).call(this,G)},applyToObject:function(G){u(G,this)},checkElementRemovable:function(G,L){if(!G)return t;var I=this._.definition;if(G._4e_name()==this.element){if(!L&&!G._4e_hasAttributes())return z;var H=I._AC;if(H)I=H;else{H=
{};var J=0,P=I.attributes;if(P)for(var O in P){J++;H[O]=P[O]}if(P=s.getStyleText(I)){H.style||J++;H.style=P}H._length=J;I=I._AC=H}if(I._length){for(var R in I)if(R!="_length"){J=G.attr(R)||"";if(R=="style")a:{H=I[R];J=m(J,t);typeof H=="string"&&(H=h(H));typeof J=="string"&&(J=h(J));P=void 0;for(P in H)if(!(P in J&&(J[P]==H[P]||H[P]=="inherit"||J[P]=="inherit"))){H=t;break a}H=z}else H=I[R]==J;if(H){if(!L)return z}else if(L)return t}if(L)return z}else return z}if(R=k(this)[G._4e_name()]){if(!(I=R.attributes))return z;
for(H=0;H<I.length;H++){R=I[H][0];if(R=G.attr(R)){J=I[H][1];if(J===o||typeof J=="string"&&R==J||J.test&&J.test(R))return z}}}return t},checkActive:function(G){switch(this.type){case i.STYLE_BLOCK:return this.checkElementRemovable(G.block||G.blockLimit,z);case i.STYLE_OBJECT:case i.STYLE_INLINE:for(var L=G.elements,I=0,H;I<L.length;I++){H=L[I];if(!(this.type==i.STYLE_INLINE&&(B._4e_equals(H,G.block)||B._4e_equals(H,G.blockLimit))))if(!(this.type==i.STYLE_OBJECT&&!(H._4e_name()in U)))if(this.checkElementRemovable(H,
z))return z}}return t}};s.getStyleText=function(G){var L=G._ST;if(L)return L;L=G.styles;var I=G.attributes&&G.attributes.style||"",H="";if(I.length)I=I.replace(S,";");for(var J in L){var P=L[J],O=(J+":"+P).replace(S,";");if(P=="inherit")H+=O;else I+=O}if(I.length)I=m(I);I+=H;return G._ST=I};g.Style=s;g.Style=s;var V=s.prototype;g.Utils.extern(V,{apply:V.apply,remove:V.remove,applyToRange:V.applyToRange,removeFromRange:V.removeFromRange,applyToObject:V.applyToObject,checkElementRemovable:V.checkElementRemovable,
checkActive:V.checkActive})});
KISSY.Editor.add("htmlparser",function(){function g(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var l=KISSY,s=function(){},v=l.Editor,n=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,u={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},p=v.XHTML_DTD;l.augment(g,{onTagOpen:s,onTagClose:s,
onText:s,onCDATA:s,onComment:s,parse:function(j){for(var q,e,c=0,b;q=this._.htmlPartsRegex.exec(j);){e=q.index;if(e>c){c=j.substring(c,e);b?b.push(c):this.onText(c)}c=this._.htmlPartsRegex.lastIndex;if(e=q[1]){e=e.toLowerCase();if(b&&p.$cdata[e]){this.onCDATA(b.join(""));b=null}if(!b){this.onTagClose(e);continue}}if(b)b.push(q[0]);else if(e=q[3]){e=e.toLowerCase();if(!/="/.test(e)){var h={},m;q=q[4];var k=!!(q&&q.charAt(q.length-1)=="/");if(q)for(;m=n.exec(q);){var a=m[1].toLowerCase();m=m[2]||m[3]||
m[4]||"";h[a]=!m&&u[a]?a:m}this.onTagOpen(e,h,k);if(!b&&p.$cdata[e])b=[]}}else if(e=q[2])this.onComment(e)}j.length>c&&this.onText(j.substring(c,j.length))}});v.HtmlParser=g;v.HtmlParser=g});
KISSY.Editor.add("htmlparser-basicwriter",function(){function g(){this._={output:[]}}var l=KISSY,s=l.Editor,v=s.Utils;l.augment(g,{openTag:function(n){this._.output.push("<",n)},openTagClose:function(n,u){u?this._.output.push(" />"):this._.output.push(">")},attribute:function(n,u){if(typeof u=="string")u=v.htmlEncodeAttr(u);this._.output.push(" ",n,'="',u,'"')},closeTag:function(n){this._.output.push("</",n,">")},text:function(n){this._.output.push(n)},comment:function(n){this._.output.push("<!--",
n,"--\>")},write:function(n){this._.output.push(n)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(n){var u=this._.output.join("");n&&this.reset();return u}});s.HtmlParser.BasicWriter=g;s.HtmlParser.BasicWriter=g;l=g.prototype;s.Utils.extern(l,{openTag:l.openTag,openTagClose:l.openTagClose,attribute:l.attribute,closeTag:l.closeTag,text:l.text,comment:l.comment,write:l.write,reset:l.reset,getHtml:l.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function g(){g.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=u;this.sortAttributes=n;this._.indent=u;this._.indentation="";this._.rules={};var p=s.XHTML_DTD,j;for(j in v.mix({},p.$nonBodyContent,p.$block,p.$listItem,p.$tableContent))this.setRules(j,{indent:n,breakBeforeOpen:n,breakAfterOpen:n,breakBeforeClose:!p[j]["#"],breakAfterClose:n});this.setRules("br",
{breakAfterOpen:n});this.setRules("title",{indent:u,breakAfterOpen:u});this.setRules("style",{indent:u,breakBeforeClose:n});this.setRules("pre",{indent:u})}var l=KISSY,s=l.Editor,v=s.Utils,n=true,u=false;l.extend(g,s.HtmlParser.BasicWriter,{openTag:function(p){var j=this._.rules[p];if(this._.indent)this.indentation();else if(j&&j.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",p)},openTagClose:function(p,j){var q=this._.rules[p];if(j)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(q&&q.indent)this._.indentation+=this.indentationChars}q&&q.breakAfterOpen&&this.lineBreak()},attribute:function(p,j){if(typeof j=="string"){this.forceSimpleAmpersand&&(j=j.replace(/&amp;/g,"&"));j=v.htmlEncodeAttr(j)}this._.output.push(" ",p,'="',j,'"')},closeTag:function(p){var j=this._.rules[p];if(j&&j.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(j&&j.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",p,">");j&&j.breakAfterClose&&this.lineBreak()},text:function(p){if(this._.indent){this.indentation();p=v.ltrim(p)}this._.output.push(p)},comment:function(p){this._.indent&&this.indentation();this._.output.push("<!--",p,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=n},indentation:function(){this._.output.push(this._.indentation);this._.indent=u},setRules:function(p,j){var q=this._.rules[p];if(q)v.mix(q,
j);else this._.rules[p]=j}});s.HtmlParser.HtmlWriter=g;s.HtmlParser.HtmlWriter=g;l=g.prototype;s.Utils.extern(l,{openTag:l.openTag,openTagClose:l.openTagClose,attribute:l.attribute,closeTag:l.closeTag,text:l.text,comment:l.comment,lineBreak:l.lineBreak,indentation:l.indentation,setRules:l.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function g(){this.children=[];this.parent=v;this._={isBlockLike:l,hasInlineStarted:s}}var l=true,s=false,v=null,n=KISSY.Editor,u={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},p=KISSY,j=n.Utils,q=n.NODE,e=n.XHTML_DTD,c=j.mix({table:1,ul:1,ol:1,dl:1},e.table,e.ul,e.ol,e.dl),b=e.$list,h=e.$listItem;g.FromHtml=function(m,k){function a(y){var C;if(z.length>0)for(var E=0;E<z.length;E++){var D=z[E],F=D.name,K=e[F],M=o.name&&e[o.name];
if((!M||M[F])&&(!y||!K||K[y]||!e[y])){if(!C){d();C=1}D=D.clone();D.parent=o;o=D;z.splice(E,1);E--}}}function d(){for(;t.length;)o.add(t.shift())}function f(y,C,E){C=C||o||w;if(k&&!C.type){var D,F;if((D=y.attributes&&(F=y.attributes._ke_real_element_type)?F:y.name)&&!(D in e.$body)&&!(D in e.$nonBodyContent)){D=o;o=C;r.onTagOpen(k,{});C=o;if(E)o=D}}if(y._.isBlockLike&&y.name!="pre"){E=y.children.length;if((D=y.children[E-1])&&D.type==q.NODE_TEXT)if(F=j.rtrim(D.value))D.value=F;else y.children.length=
E-1}C.add(y);if(y.returnPoint){o=y.returnPoint;delete y.returnPoint}}var r=new n.HtmlParser,w=new g,z=[],t=[],o=w,A=s,x;r.onTagOpen=function(y,C,E){var D=new n.HtmlParser.Element(y,C);if(D.isUnknown&&E)D.isEmpty=l;if(e.$removeEmpty[y])z.push(D);else{if(y=="pre")A=l;else if(y=="br"&&A){o.add(new n.HtmlParser.Text("\n"));return}if(y=="br")t.push(D);else{var F=o.name,K=F&&(e[F]||(o._.isBlockLike?e.div:e.span));if(K&&!D.isUnknown&&!o.isUnknown&&!K[y]){K=s;var M;if(y in b&&F in b){F=o.children;(F=F[F.length-
1])&&F.name in h||f(F=new n.HtmlParser.Element("li"),o);x=o;M=F}else if(y==F)f(o,o.parent);else{if(c[F])x||(x=o);else{f(o,o.parent,l);u[F]||z.unshift(o)}K=l}o=M?M:o.returnPoint||o.parent;if(K){r.onTagOpen.apply(this,arguments);return}}a(y);d();D.parent=o;D.returnPoint=x;x=0;if(D.isEmpty)f(D);else o=D}}};r.onTagClose=function(y){for(var C=z.length-1;C>=0;C--)if(y==z[C].name){z.splice(C,1);return}for(var E=[],D=[],F=o;F.type&&F.name!=y;){F._.isBlockLike||D.unshift(F);E.push(F);F=F.parent}if(F.type){for(C=
0;C<E.length;C++){var K=E[C];f(K,K.parent)}o=F;if(o.name=="pre")A=s;F._.isBlockLike&&d();f(F,F.parent);if(F==o)o=o.parent;z=z.concat(D)}if(y=="body")k=s};r.onText=function(y){if(!o._.hasInlineStarted&&!A){y=j.ltrim(y);if(y.length===0)return}d();a();if(k&&(!o.type||o.name=="body")&&j.trim(y))this.onTagOpen(k,{});A||(y=y.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));o.add(new n.HtmlParser.Text(y))};r.onCDATA=function(){};r.onComment=function(y){o.add(new n.HtmlParser.Comment(y))};r.parse(m);for(d();o.type;){var B=
o.parent,i=o;if(k&&(!B.type||B.name=="body")&&!e.$body[i.name]){o=B;r.onTagOpen(k,{});B=o}B.add(i);o=B}return w};p.augment(g,{add:function(m){var k=this.children.length;if(k=k>0&&this.children[k-1]||v){if(m._.isBlockLike&&k.type==q.NODE_TEXT){k.value=j.rtrim(k.value);if(k.value.length===0){this.children.pop();this.add(m);return}}k.next=m}m.previous=k;m.parent=this;this.children.push(m);this._.hasInlineStarted=m.type==q.NODE_TEXT||m.type==q.NODE_ELEMENT&&!m._.isBlockLike},writeHtml:function(m,k){var a;
this.filterChildren=this.filterChildren=function(){var d=new n.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,d,k,l);d=d.getHtml();this.children=(new g.FromHtml(d)).children;a=1};!this.name&&k&&k.onFragment(this);this.writeChildrenHtml(m,a?v:k)},writeChildrenHtml:function(m,k){for(var a=0;a<this.children.length;a++)this.children[a].writeHtml(m,k)}});n.HtmlParser.Fragment=g;n.HtmlParser.Fragment=g;g.FromHtml=g.FromHtml;p=g.prototype;n.Utils.extern(p,{add:p.add,writeHtml:p.writeHtml,writeChildrenHtml:p.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function g(u,p){this.name=u;this.attributes=p||(p={});this.children=[];var j=p._ke_real_element_type||u,q=l.XHTML_DTD;j=!!(q.$nonBodyContent[j]||q.$block[j]||q.$listItem[j]||q.$tableContent[j]||q.$nonEditable[j]||j=="br");var e=!!q.$empty[u];this.isEmpty=e;this.isUnknown=!q[u];this._={isBlockLike:j,hasInlineStarted:e||!j}}var l=KISSY.Editor,s=l.NODE,v=function(u,p){u=u[0];p=p[0];return u<p?-1:u>p?1:0};KISSY.augment(g,{type:s.NODE_ELEMENT,add:l.HtmlParser.Fragment.prototype.add,
clone:function(){return new g(this.name,this.attributes)},writeHtml:function(u,p){var j=this.attributes,q=this,e=q.name,c,b,h,m;q.filterChildren=function(){if(!m){var d=new l.HtmlParser.BasicWriter;l.HtmlParser.Fragment.prototype.writeChildrenHtml.call(q,d,p);q.children=(new l.HtmlParser.Fragment.FromHtml(d.getHtml())).children;m=1}};q.filterChildren=q.filterChildren;if(p){for(;;){if(!(e=p.onElementName(e)))return;q.name=e;if(!(q=p.onElement(q)))return;q.parent=this.parent;if(q.name==e)break;if(q.type!=
s.NODE_ELEMENT){q.writeHtml(u,p);return}e=q.name;if(!e){this.writeChildrenHtml.call(q,u,m?null:p);return}}j=q.attributes}u.openTag(e,j);for(var k=[],a=0;a<2;a++)for(c in j){b=c;h=j[c];if(a==1)k.push([c,h]);else if(p){for(;;)if(b=p.onAttributeName(c))if(b!=c){delete j[c];c=b}else break;else{delete j[c];break}if(b)if((h=p.onAttribute(q,b,h))===false)delete j[b];else j[b]=h}}u.sortAttributes&&k.sort(v);j=k.length;for(a=0;a<j;a++){c=k[a];u.attribute(c[0],c[1])}u.openTagClose(e,q.isEmpty);if(!q.isEmpty){this.writeChildrenHtml.call(q,
u,m?null:p);u.closeTag(e)}},writeChildrenHtml:function(){l.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});l.HtmlParser.Element=g;l.HtmlParser.Element=g;var n=g.prototype;l.Utils.extern(n,{type:n.type,add:n.add,clone:n.clone,writeHtml:n.writeHtml,writeChildrenHtml:n.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function g(c){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};c&&this.addRules(c,10)}function l(c,b){for(var h=0;c&&h<b.length;h++){var m=b[h];c=c.replace(m[0],m[1])}return c}function s(c,b,h){if(typeof b=="function")b=[b];var m,k;k=c.length;var a=b&&b.length;if(a){for(m=0;m<k&&c[m].pri<h;m++);for(k=a-1;k>=0;k--)if(a=b[k]){a.pri=h;c.splice(m,0,a)}}}function v(c,b,h){if(b)for(var m in b){var k=c[m];c[m]=n(k,b[m],
h);k||c.$length++}}function n(c,b,h){if(b){b.pri=h;if(c){if(c.splice)s(c,b,h);else{c=c.pri>h?[b,c]:[c,b];c.filter=u}return c}else return b.filter=b}}function u(c){for(var b=c.type||c instanceof j.HtmlParser.Fragment,h=0;h<this.length;h++){if(b)var m=c.type,k=c.name;var a=this[h].apply(window,arguments);if(a===e)return a;if(b){if(a&&(a.name!=k||a.type!=m))return a}else if(typeof a!="string")return a;a!=undefined&&(c=a)}return c}var p=KISSY,j=p.Editor,q=j.NODE,e=false;p.augment(g,{addRules:function(c,
b){if(typeof b!="number")b=10;s(this._.elementNames,c.elementNames,b);s(this._.attributeNames,c.attributeNames,b);v(this._.elements,c.elements,b);v(this._.attributes,c.attributes,b);this._.text=n(this._.text,c.text,b)||this._.text;this._.comment=n(this._.comment,c.comment,b)||this._.comment;this._.root=n(this._.root,c.root,b)||this._.root},onElementName:function(c){return l(c,this._.elementNames)},onAttributeName:function(c){return l(c,this._.attributeNames)},onText:function(c){var b=this._.text;
return b?b.filter(c):c},onComment:function(c,b){var h=this._.comment;return h?h.filter(c,b):c},onFragment:function(c){var b=this._.root;return b?b.filter(c):c},onElement:function(c){for(var b=[this._.elements["^"],this._.elements[c.name],this._.elements.$],h,m=0;m<3;m++)if(h=b[m]){h=h.filter(c,this);if(h===e)return null;if(h&&h!=c)return this.onNode(h);if(c.parent&&!c.name)break}return c},onNode:function(c){var b=c.type;return b==q.NODE_ELEMENT?this.onElement(c):b==q.NODE_TEXT?new j.HtmlParser.Text(this.onText(c.value)):
null},onAttribute:function(c,b,h){if(b=this._.attributes[b]){c=b.filter(h,c,this);if(c===e)return e;if(typeof c!="undefined")return c}return h}});j.HtmlParser.Filter=g;p=g.prototype;j.Utils.extern(p,{addRules:p.addRules,onElementName:p.onElementName,onAttributeName:p.onAttributeName,onText:p.onText,onComment:p.onComment,onFragment:p.onFragment,onElement:p.onElement,onNode:p.onNode,onAttribute:p.onAttribute});j.HtmlParser.Filter=g});
KISSY.Editor.add("htmlparser-text",function(){function g(n){this.value=n;this._={isBlockLike:v}}var l=KISSY,s=l.Editor,v=false;l.augment(g,{type:s.NODE.NODE_TEXT,writeHtml:function(n,u){var p=this.value;u&&!(p=u.onText(p,this))||n.text(p)}});s.HtmlParser.Text=g;s.HtmlParser.Text=g});
KISSY.Editor.add("htmlparser-comment",function(){function g(v){this.value=v;this._={isBlockLike:false}}var l=KISSY.Editor,s=l.NODE;l.HtmlParser.Comment=g;l.HtmlParser.Comment=g;g.prototype={constructor:g,type:s.NODE_COMMENT,writeHtml:function(v,n){var u=this.value;if(n){if(!(u=n.onComment(u,this)))return;if(typeof u!="string"){u.parent=this.parent;u.writeHtml(v,n);return}}v.comment(u)}}});
KISSY.Editor.add("bgcolor",function(g){var l=KISSY.Editor.ColorSupport,s={element:"span",styles:{"background-color":"#(color)"}};g.addPlugin(function(){new l({editor:g,styles:s,title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-bgcolor",text:"bgcolor"})})});
KISSY.Editor.add("bubbleview",function(){var g=KISSY.Editor,l=KISSY,s=l.Event,v=l.DOM;if(!g.BubbleView){var n=l.Base.create(g.Overlay,[],{init:function(){this.on("renderUI",this._renderUIBubbleView,this)},_renderUIBubbleView:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var p=this._selectedEl,j=p._4e_getOffset(document);j.top+=p.height()+5;n.superclass.show.call(this);this.set("xy",[j.left,j.top])}},{ATTRS:{focus4e:false,zIndex:{value:g.baseZIndex(g.zIndexManager.BUBBLE_VIEW)}}}),
u={};n.attach=function(p){var j=p.pluginInstance,q=p.pluginName;p=j.editor;var e=u[q];if(e){var c=e.cfg.func,b=u[q].bubble;p.on("selectionChange",function(h){h=h.path;var m=h.elements;if(h&&m)if(h=h.lastElement)if(h=c(h)){m=u[q];if(!m.bubble){m.bubble=new n;m.bubble.renderer();m.cfg.init&&m.cfg.init.call(m.bubble)}b=m.bubble;b._selectedEl=h;b._plugin=j;b.hide();b.show()}else if(b){b._selectedEl=b._plugin=null;b.hide()}});s.on(v._4e_getWin(p.document),"scroll blur",function(){b&&b.hide()});s.on(document,
"click",function(){b&&b.hide()})}};n.register=function(p){u[p.pluginName]={cfg:p}};g.BubbleView=n}});
KISSY.Editor.add("button",function(){function g(n){g.superclass.constructor.call(this,n);this._init()}var l=KISSY.Editor,s=KISSY,v=s.Node;if(!l.TripleButton){g.ON="on";g.OFF="off";g.DISABLED="disabled";g.ON_CLASS="ke-triplebutton-on";g.OFF_CLASS="ke-triplebutton-off";g.DISABLED_CLASS="ke-triplebutton-disabled";g.ATTRS={state:{value:"off"},container:{},text:{},contentCls:{},cls:{},el:{}};s.extend(g,s.Base,{_init:function(){var n=this,u=n.get("container"),p=n.get("el"),j=n.get("title"),q=n.get("text"),
e=n.get("contentCls");n.el=new v("<a class='ke-triplebutton ke-triplebutton-off' href='#' role=\"button\"></a>");var c=n.el;c._4e_unselectable();n._attachCls();if(q)c.html(q);else if(e){c.html("<span class='ke-toolbar-item "+e+"'></span>");c.one("span")._4e_unselectable()}j&&c.attr("title",j);if(p)p[0].parentNode.replaceChild(c[0],p[0]);else u&&u.append(c);c.on("click",n._action,n);n.on("afterStateChange",n._stateChange,n);if(!n.get("cls")){c.on("mousedown",function(){n.get("state")=="off"&&c.addClass("ke-triplebutton-active")});
c.on("mouseup mouseleave",function(){n.get("state")=="off"&&c.hasClass("ke-triplebutton-active")&&setTimeout(function(){c.removeClass("ke-triplebutton-active")},300)})}},_attachCls:function(){var n=this.get("cls");n&&this.el.addClass(n)},_stateChange:function(n){this["_"+n.newVal]();this._attachCls()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(n){this.fire(this.get("state")+
"Click",n);this.fire("click",n);n.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.el[0].className="ke-triplebutton ke-triplebutton-on"},_off:function(){this.el[0].className="ke-triplebutton ke-triplebutton-off"},_disabled:function(){this.el[0].className="ke-triplebutton ke-triplebutton-disabled"}});l.TripleButton=g}});
KISSY.Editor.add("clipboard",function(g){var l=KISSY,s=l.Editor,v=l.Node,n=l.UA,u=s.Range,p=s.RANGE,j=l.Event;s.Paste||function(){function q(d){this.editor=d;this._init()}function e(d){if(!(!n.ie||d.document.compatMode=="BackCompat")){var f=d.getSelection(),r;if(f.getType()==k.SELECTION_ELEMENT&&(r=f.getSelectedElement())){var w=f.getRanges()[0],z=new v(d.document.createTextNode(""));z.insertBefore(r);w.setStartBefore(z);w.setEndAfter(r);f.selectRanges([w]);setTimeout(function(){if(r.parent()){z.remove();
f.selectElement(r)}},0)}}}l.augment(q,{_init:function(){var d=this.editor;n.ie?j.on(d.document,"keydown",this._paste,this):j.on(d.document,"paste",this._paste,this);d.addCommand("copy",new m("copy"));d.addCommand("cut",new m("cut"));d.addCommand("paste",new m("paste"))},_paste:function(d){if(!(d.type==="keydown"&&!(d.keyCode===86&&(d.ctrlKey||d.metaKey)))){var f=this,r=f.editor,w=r.document;if(f._running)d.halt();else{var z=r.getSelection();d=new u(w);var t=new v(n.webkit?"<body></body>":"<div></div>",
null,w);n.webkit&&t[0].appendChild(w.createTextNode("\u00a0"));w.body.appendChild(t[0]);t.css({position:"absolute",top:z.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});t.css("left","-1000px");var o=z.createBookmarks();d.setStartAt(t,p.POSITION_AFTER_START);d.setEndAt(t,p.POSITION_BEFORE_END);d.select(true);f._running=true;setTimeout(function(){t._4e_remove();var A;t=n.webkit&&(A=t._4e_first())&&A.hasClass("Apple-style-span")?A:t;z.selectBookmarks(o);r.insertHtml(t.html());
f._running=false},0)}}}});s.Paste=q;var c=function(d,f){var r=d.document,w=new v(r.body),z=false,t=function(){z=true};w.on(f,t);(n.ie>7?r:r.selection.createRange()).execCommand(f);w.detach(f,t);return z},b=n.ie?function(d,f){return c(d,f)}:function(d,f){try{return d.document.execCommand(f)}catch(r){return false}},h={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},m=function(d){this.type=
d;this.canUndo=this.type=="cut"};m.prototype={exec:function(d){this.type=="cut"&&e(d);(d=b(d,this.type))||alert(h[this.type]);return d}};var k=s.Selection,a={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};s.on("contextmenu",function(d){var f=d.contextmenu,r=f.cfg.editor,w=f.elDom,z={copy:0,cut:0,paste:0},t;for(t in z){if(!z.hasOwnProperty(t))break;z[t]=w.one(".ke-paste-"+t);(function(o){var A=z[o];if(!A){A=(new v("<a href='#'class='ke-paste-"+o+"'>"+a[o]+"</a>")).appendTo(w);A.on("click",function(x){x.halt();if(!A.hasClass("ke-menuitem-disable")){f.hide();
setTimeout(function(){r.execCommand(o)},30)}})}z[o]=A})(t);d=z[t];(r.document.queryCommandEnabled(t)?true:false)?d.removeClass("ke-menuitem-disable"):d.addClass("ke-menuitem-disable")}})}();g.addPlugin(function(){new s.Paste(g)})});
KISSY.Editor.add("colorsupport",function(){function g(w){return("0"+w).slice(w.length-1,w.length+1)}function l(w){w=n.trim(w);if(w.charAt(0)=="#")w=w.substring(1);w=w.replace(/\s+/g,"");var z="";if(/^[0-9a-f]{3,3}$/i.test(w))z=w.replace(/[0-9a-f]/ig,function(o){return o+o});else{var t=w.match(c);if(t&&t[0])for(w=1;w<4;w++)z+=g(parseInt(t[w]).toString(16));else z=w}return"#"+z.toLowerCase()}function s(w){s.superclass.constructor.call(this,w);this._init()}var v=KISSY.Editor,n=KISSY,u=n.Node,p=n.Event,
j=v.Overlay,q=v.TripleButton,e=n.DOM;if(!v.ColorSupport){e.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");for(var c=/^rgb\((\d+),(\d+),(\d+)\)$/i,b=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394",
"351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"]],h="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>",m=0;m<3;m++){h+="<div class='ke-color-palette'><table>";for(var k=b[m],a=k.length/8,d=0;d<a;d++){h+="<tr>";for(var f=0;f<8;f++){var r=l(k[8*d+f]);h+="<td>";h+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+r+"'></a>";h+="</td>"}h+="</tr>"}h+="</table></div>"}h+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>";
s.ATTRS={editor:{},styles:{},contentCls:{},text:{}};n.extend(s,n.Base,{_init:function(){var w=this.get("editor"),z=new q({container:w.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});z.on("offClick onClick",this._showColors,this);this.el=z;v.Utils.lazyRun(this,"_prepare","_real");v.Utils.sourceDisable(w,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(w){var z=this.el.el;w=w.target;var t=this.colorWin;z._4e_equals(w)||z.contains(w)||
t.hide()},_selectColor:function(w){w.halt();w=w.target;if(e._4e_name(w)=="a"&&!e.hasClass(w,"ke-button")){w=new u(w);this._applyColor(l(w._4e_style("background-color")));this.colorWin.hide()}},_applyColor:function(w){var z=this.get("editor"),t=z.document,o=this.get("styles");z.fire("save");w?(new v.Style(o,{color:w})).apply(t):(new v.Style(o,{color:"inherit"})).remove(t);z.fire("save")},_prepare:function(){var w=this,z=document,t=w.el,o=w.get("editor"),A;w.colorWin=new j({elCls:"ks-popup",content:h,
focus4e:false,width:"170px",zIndex:o.baseZIndex(v.zIndexManager.POPUP_MENU)});var x=w.colorWin;x.renderer();A=x.get("contentEl");A.on("click",w._selectColor,w);w.colorPanel=A;p.on(z,"click",w._hidePanel,w);p.on(o.document,"click",w._hidePanel,w);x.on("show",t.bon,t);x.on("hide",t.boff,t);A.one(".ke-color-others").on("click",function(B){B.halt();x.hide();o.useDialog("colorsupport/dialog",function(i){i.show(w)})})},_real:function(){var w=this.el.el,z=this.colorPanel,t=w.offset();t.top+=w.height()+5;
if(t.left+z.width()>e.viewportWidth()-60)t.left=e.viewportWidth()-z.width()-60;this.colorWin.set("xy",[t.left,t.top]);this.colorWin.show()},_showColors:function(w){var z=this.colorWin;z&&z.get("visible")?z.hide():this._prepare(w)}});v.ColorSupport=s}});
KISSY.Editor.add("contextmenu",function(){function g(e){this.cfg=e;s.Utils.lazyRun(this,"_prepareShow","_realShow")}function l(e,c){for(var b=0;b<c.length;b++){var h=c[b];if(v.isFunction(h)){if(h(new n(e)))return true}else if(u.test(e,h))return true}return false}var s=KISSY.Editor,v=KISSY,n=v.Node,u=v.DOM,p=v.Event;if(!s.ContextMenu){g.ATTRS={editor:{}};var j=[];g.register=function(e){var c=new g(e),b=e.editor.document;j.push({doc:b,rules:e.rules||[],instance:c});if(!b.ke_contextmenu){b.ke_contextmenu=
1;p.on(b,"mousedown",g.hide);p.on(b,"contextmenu",function(h){g.hide.call(this);for(var m=new n(h.target);m;){var k=false;if(m._4e_name()=="body")break;for(var a=0;a<j.length;a++){var d=j[a].instance,f=j[a].rules;if(b===j[a].doc&&l(m[0],f)){h.preventDefault();k=true;setTimeout(function(){d.show(s.Utils.getXY(h.pageX,h.pageY,b,document))},30);break}}if(k)break;m=m.parent()}})}return c};g.hide=function(){for(var e=0;e<j.length;e++){var c=j[e].instance;this===j[e].doc&&c.hide()}};var q=s.Overlay;v.augment(g,
{_init:function(){var e=this,c=e.cfg,b=c.funcs;e.el=new q({content:"<div>",width:c.width,elCls:"ke-menu"});e.el.renderer();e.elDom=e.el.get("contentEl").one("div");c=e.elDom;for(var h in b){var m=new n("<a href='#'>"+h+"</a>");c[0].appendChild(m[0]);(function(k,a){k._4e_unselectable();k.on("click",function(d){e.hide();d.halt();setTimeout(a,30)})})(m,b[h])}},hide:function(){this.el&&this.el.hide()},_realShow:function(e){s.fire("contextmenu",{contextmenu:this});this.el.set("xy",[e.left,e.top]);this.el.show()},
_prepareShow:function(){this._init()},show:function(e){this._prepareShow(e)}});s.ContextMenu=g}});
KISSY.add("dd",function(g){function l(){l.superclass.constructor.apply(this,arguments);this._init()}function s(p,j,q){q=q||150;if(q===-1)return function(){p.apply(j,arguments)};var e=g.now();return function(){var c=g.now();if(c-e>q){e=c;p.apply(j,arguments)}}}var v=g.Event,n=g.DOM,u=g.Node;g.DD={};l.ATTRS={bufferTime:{value:200},activeDrag:{}};g.extend(l,g.Base,{_init:function(){this._showShimMove=s(this._move,this,30)},_move:function(p){var j=this.get("activeDrag");g.log("move");if(j){p.preventDefault();
this._clearSelection();j._move(p)}},_start:function(p){var j=this,q=j.get("bufferTime")||0;j._registerEvent();if(q)j._bufferTimer=setTimeout(function(){j._bufferStart(p)},q);else j._bufferStart(p)},_bufferStart:function(p){this.set("activeDrag",p);this._activeShim();p._start()},_end:function(p){var j=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(j){j._end(p);this.set("activeDrag",
null)}},_activeShim:function(){var p=document;this._shim=(new u("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:999999;'></div>")).appendTo(p.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:n.docHeight()});this._clearSelection()},_clearSelection:function(){g.log("_clearSelection");if(window.getSelection)window.getSelection().removeAllRanges();else document.selection&&document.selection.empty()},
_registerEvent:function(){var p=document;g.log("_registerEvent");v.on(p,"mouseup",this._end,this);v.on(p,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var p=document;g.log("_unregisterEvent");v.remove(p,"mousemove",this._showShimMove,this);v.remove(p,"mouseup",this._end,this)}});g.DD.DDM=new l});
KISSY.add("dd-draggable",function(g){function l(){l.superclass.constructor.apply(this,arguments);this._init()}var s=g.UA,v=g.Node;l.ATTRS={node:{setter:function(n){return new v(n)}},handlers:{value:{},setter:function(n){if(n)for(var u=0;u<n.length;u++)n[u]=new v(n[u])}}};g.extend(l,g.Base,{_init:function(){var n=this.get("node"),u=this.get("handlers");if(g.isEmptyObject(u))u[n[0].id]=n;for(var p in u)if(u.hasOwnProperty(p)){var j=u[p],q=j.css("cursor");if(j[0]!=n[0])if(!q||q==="auto")j.css("cursor",
"move")}n.on("mousedown",this._handleMouseDown,this)},destroy:function(){var n=this.get("node"),u=this.get("handlers"),p;for(p in u)if(u.hasOwnProperty(p)){var j=u[p];j.css("cursor")=="move"&&j.css("cursor","auto")}n.detach("mousedown",this._handleMouseDown,this)},_check:function(n){var u=this.get("handlers"),p;for(p in u)if(u.hasOwnProperty(p))if(u[p].contains(n)||u[p][0]==n[0])return true;return false},_handleMouseDown:function(n){if(this._check(new g.Node(n.target))){s.webkit||n.preventDefault();
g.DD.DDM._start(this);var u=this.get("node"),p=n.pageX;n=n.pageY;u=u.offset();this.startMousePos={left:p,top:n};this.startNodePos=u;this._diff={left:p-u.left,top:n-u.top};this.set("diff",this._diff)}},_move:function(n){var u=this.get("diff");g.mix(n,{left:n.pageX-u.left,top:n.pageY-u.top});this.fire("drag",n)},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});g.Draggable=l},{host:"dd"});KISSY.Editor.add("dd",function(){});
KISSY.Editor.add("draft",function(g){var l=KISSY,s=l.Editor;s.Draft||function(){function v(c,b,h){for(c+="";c.length<b;)c=h+c;return c}function n(c){if(l.isNumber(c))c=new Date(c);return c instanceof Date?[c.getFullYear(),"-",v(c.getMonth()+1,2,"0"),"-",v(c.getDate(),2,"0")," ",v(c.getHours(),2,"0"),":",v(c.getMinutes(),2,"0"),":",v(c.getSeconds(),2,"0")].join(""):c}function u(c){this.editor=c;this._init()}var p=l.Node,j=l.Event,q=l.JSON,e=window[s.STORE];l.augment(u,{_init:function(){var c=this,
b=c.editor,h=b.statusDiv,m=b.cfg.pluginConfig;m.draft=m.draft||{};c.draftInterval=m.draft.interval=m.draft.interval||5;c.draftLimit=m.draft.limit=m.draft.limit||5;h=(new p("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+m.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(h);c.timeTip=(new p("<span class='ke-draft-time'>")).appendTo(h);var k=(new p("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(h),
a=new s.Select({container:h,menuContainer:document.body,doc:b.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),d=e.getItem("ke-draft-save"),f=[];c.versions=a;if(d)f=l.isString(d)?q.parse(decodeURIComponent(d)):d;c.drafts=f;c.sync();k.on("click",function(){c.save(false)});(function(){var r=b.textarea[0].form;r&&j.on(r,"submit",function(){c.save(false)})})();setInterval(function(){c.save(true)},c.draftInterval*60*1E3);a.on("click",c.recover,c);c.holder=h;if(m.draft.helpHtml){m=
new s.TripleButton({cls:"ke-draft-help",title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:h});m.on("click",function(){c._prepareHelp()});s.Utils.lazyRun(c,"_prepareHelp","_realHelp");c.helpBtn=m.el}c._holder=h},_prepareHelp:function(){var c=this,b=c.editor,h=c.helpBtn,m=new p(b.cfg.pluginConfig.draft.helpHtml||""),k=new p("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
m.append(k);m.css({border:"1px solid #ACB4BE","text-align":"left"});c._help=new l.Overlay({content:m,width:m.width()+"px",mask:false});c._help.renderer();c._help.el.css("border","none");c._help.arrow=k;j.on([document,b.document],"click",function(a){a=a.target;a==h[0]||h.contains(a)||c._help.hide()})},_realHelp:function(){var c=this._help,b=this.helpBtn,h=c.arrow;c.show();b=b.offset();c.el.offset({left:b.left-c.el.width()+17,top:b.top-c.el.height()-7});h.offset({left:b.left-2,top:b.top-8})},disable:function(){this.holder.css("visibility",
"hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var c=this.draftLimit,b=this.timeTip,h=this.versions,m=this.drafts;m.length>c&&m.splice(0,m.length-c);c=[];for(var k,a=0;a<m.length;a++){k=m[a];k=(k.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+n(k.date);c.push({name:k,value:a})}h.set("items",c.reverse());b.html(k);e.setItem("ke-draft-save",encodeURIComponent(q.stringify(m)))},save:function(c){var b=this.drafts,h=g.getData(true);if(h){if(b[b.length-1]&&h==b[b.length-1].content)b.length-=1;
this.drafts=b.concat({content:h,date:(new Date).getTime(),auto:c});this.sync()}},recover:function(c){var b=this.editor,h=this.drafts;c=c.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+n(h[c].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){b.fire("save");b.setData(h[c].content);b.fire("save")}}});s.Draft=u}();g.addPlugin(function(){s.storeReady(function(){new s.Draft(g)})})});
KISSY.Editor.add("elementpaths",function(g){var l=KISSY.Editor,s=KISSY,v=s.Node,n=s.DOM;l.ElementPaths||function(){function u(p){this.cfg=p;this._cache=[];this._init()}n.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");s.augment(u,{_init:function(){var p=this.cfg.editor;this.holder=new v("<span>");this.holder.appendTo(p.statusDiv);p.on("selectionChange",this._selectionChange,this);
l.Utils.sourceDisable(p,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(p){var j=this.cfg.editor,q=this.holder;p=p.path.elements;var e,c;e=this._cache;for(c=0;c<e.length;c++){e[c].detach("click");e[c]._4e_remove()}this._cache=[];for(c=0;c<p.length;c++){e=p[c];var b=new v("<a href='#' class='elementpath'>"+(e.attr("_ke_real_element_type")||e._4e_name())+"</a>");this._cache.push(b);(function(h){b.on("click",
function(m){m.halt();j.focus();setTimeout(function(){j.getSelection().selectElement(h)},50)})})(e);q.prepend(b)}}});l.ElementPaths=u}();g.addPlugin(function(){new l.ElementPaths({editor:g})})});
KISSY.Editor.add("enterkey",function(g){var l=KISSY.Editor,s=KISSY,v=s.UA,n=/^h[1-6]$/,u=l.XHTML_DTD,p=s.Node,j=s.Event,q=l.Walker,e=l.ElementPath;l.enterBlock||function(){function c(b){j.on(b.document,"keydown",function(h){if(h.keyCode===13)if(!h.shiftKey){b.fire("save");var m=b.execCommand("enterBlock");b.fire("save");m!==false&&h.preventDefault()}})}c.enterBlock=function(b){var h;h=b.getSelection().getRanges();for(var m=h.length-1;m>0;m--)h[m].deleteContents();h=h[0];m=h.document;if(h.checkStartOfBlock()&&
h.checkEndOfBlock()){var k=(new e(h.startContainer)).block;if(k&&(k._4e_name()=="li"||k.parent()._4e_name()=="li"))if(b.hasCommand("outdent")){b.fire("save");b.execCommand("outdent");b.fire("save");return}else return false}var a=h.splitBlock("p");if(a){b=a.previousBlock;k=a.nextBlock;var d=a.wasStartOfBlock,f=a.wasEndOfBlock,r;if(k){r=k.parent();if(r._4e_name()=="li"){k._4e_breakParent(r);k._4e_move(k._4e_next(),true)}}else if(b&&(r=b.parent())&&r._4e_name()=="li"){b._4e_breakParent(r);h.moveToElementEditablePosition(b._4e_next());
b._4e_move(b._4e_previous())}if(!d&&!f){if(k._4e_name()=="li"&&(r=k._4e_first(q.invisible(true)))&&s.inArray(r._4e_name(),["ul","ol"]))(v.ie?new p(m.createTextNode("\u00a0")):new p(m.createElement("br"))).insertBefore(r);k&&h.moveToElementEditablePosition(k)}else{var w;if(b){if(b._4e_name()=="li"||!n.test(b._4e_name()))w=b._4e_clone()}else if(k)w=k._4e_clone();w||(w=new p("<p>",null,m));if(r=a.elementPath){a=0;for(var z=r.elements.length;a<z;a++){var t=r.elements[a];if(t._4e_equals(r.block)||t._4e_equals(r.blockLimit))break;
if(u.$removeEmpty[t._4e_name()]){t=t._4e_clone();w._4e_moveChildren(t);w.append(t)}}}v.ie||w._4e_appendBogus();h.insertNode(w);if(v.ie&&d&&(!f||!b[0].childNodes.length)){h.moveToElementEditablePosition(f?b:w);h.select()}h.moveToElementEditablePosition(d&&!f?k:w)}if(!v.ie)if(k){w=new p(m.createElement("span"));w.html("&nbsp;");h.insertNode(w);w._4e_scrollIntoView();h.deleteContents()}else w._4e_scrollIntoView();h.select()}};l.EnterKey=c}();g.addPlugin(function(){g.addCommand("enterBlock",{exec:l.EnterKey.enterBlock});
l.EnterKey(g)})});
KISSY.Editor.add("fakeobjects",function(g){var l=KISSY.Editor,s=KISSY,v=s.Node,n=l.NODE,u=l.Config.base+"theme/spacer.gif",p=l.HtmlParser;l=s.Editor;var j=(g=g.htmlDataProcessor)&&g.htmlFilter,q={elements:{$:function(e){var c=e.attributes;if((c=(c=(c=c&&c._ke_realelement)&&new p.Fragment.FromHtml(decodeURIComponent(c)))&&c.children[0])&&e.attributes._ke_resizable){var b=e.attributes.style;if(b){var h=/(?:^|\s)width\s*:\s*(\d+)/i.exec(b);e=h&&h[1];b=(h=/(?:^|\s)height\s*:\s*(\d+)/i.exec(b))&&h[1];
if(e)c.attributes.width=e;if(b)c.attributes.height=b}}return c}}};j&&j.addRules(q);g&&s.mix(g,{createFakeParserElement:function(e,c,b,h,m){var k;k=new p.BasicWriter;e.writeHtml(k);k=k.getHtml();var a=e.attributes.style;if(e.attributes.width)a="width:"+e.attributes.width+"px;"+a;if(e.attributes.height)a="height:"+e.attributes.height+"px;"+a;e={"class":c,src:u,_ke_realelement:encodeURIComponent(k),_ke_real_node_type:e.type,style:a,align:e.attributes.align||""};m&&delete m.width;m&&delete m.height;m&&
s.mix(e,m,false);if(b)e._ke_real_element_type=b;if(h)e._ke_resizable=h;return new p.Element("img",e)}});s.augment(l,{createFakeElement:function(e,c,b,h,m,k){var a=e.attr("style")||"";if(e.attr("width"))a="width:"+e.attr("width")+"px;"+a;if(e.attr("height"))a="height:"+e.attr("height")+"px;"+a;e={"class":c,src:u,_ke_realelement:encodeURIComponent(m||e._4e_outerHtml()),_ke_real_node_type:e[0].nodeType,style:a};k&&delete k.width;k&&delete k.height;k&&s.mix(e,k,false);if(b)e._ke_real_element_type=b;if(h)e._ke_resizable=
h;return new v("<img/>",e,this.document)},restoreRealElement:function(e){if(e.attr("_ke_real_node_type")!=n.NODE_ELEMENT)return null;e=decodeURIComponent(e.attr("_ke_realelement"));var c=new v("<div>",null,this.document);c.html(e);return c._4e_first(function(b){return b[0].nodeType==n.NODE_ELEMENT})._4e_remove()}})});KISSY.Editor.add("flash",function(g){g.addPlugin(function(){new KISSY.Editor.Flash(g)})});
KISSY.Editor.add("flash/support",function(g){var l=KISSY.Editor,s=KISSY,v=s.UA,n=s.Event,u=l.ContextMenu,p=s.Node,j=l.BubbleView,q=l.TripleButton,e=g.htmlDataProcessor,c="ke_flash",b=l.Utils.flash;g=e&&e.dataFilter;l.Flash||function(){function h(d){this.editor=d;this._init()}function m(d){return d._4e_name()==="img"&&!!d.hasClass(c)&&d}var k=/\.swf(?:$|\?)/i;h.isFlashEmbed=function(d){d=d.attributes;return d.type=="application/x-shockwave-flash"||k.test(d.src||"")};s.augment(h,{_config:function(){this._cls=
c;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=a;this._flashRules=["img."+c]},_init:function(){this._config();var d=this.editor,f={},r=this._contextMenu;d._toolbars=d._toolbars||{};d._toolbars[this._type]=this;this.el=new q({container:d.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("offClick",this.show,this);if(r)for(var w in r)(function(z){f[z]=function(){r[z](d)}})(w);u.register({editor:d,rules:this._flashRules,width:"120px",
funcs:f});j.attach({pluginName:this._type,pluginInstance:this});n.on(d.document,"dblclick",this._dbclick,this);l.Utils.sourceDisable(d,this)},disable:function(){this.el.set("state",q.DISABLED)},enable:function(){this.el.set("state",q.OFF)},_getFlashUrl:function(d){return b.getUrl(d)},_updateTip:function(d,f){var r=this.editor.restoreRealElement(f);if(r){r=this._getFlashUrl(r);d.html(r);d.attr("href",r)}},_dbclick:function(d){var f=new p(d.target);if(f._4e_name()==="img"&&f.hasClass(this._cls)){this.show(null,
f);d.halt()}},show:function(d,f){this.editor.useDialog(this._type+"/dialog",function(r){r.show(f)})}});l.Flash=h;h.registerBubble=function(d,f,r){j.register({pluginName:d,func:r,init:function(){var w=this,z=w.get("contentEl");z.html(f+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var t=z.one(".ke-bubbleview-url"),o=z.one(".ke-bubbleview-change"),A=
z.one(".ke-bubbleview-remove");l.Utils.preventFocus(z);o.on("click",function(x){w._plugin.show(null,w._selectedEl);x.halt()});A.on("click",function(x){var B=w._plugin;if(v.webkit){var i=B.editor.getSelection().getRanges();i&&i[0]&&(i[0].collapse(true)||1)&&i[0].select()}w._selectedEl._4e_remove();w.hide();B.editor.notifySelectionChange();x.halt()});w.on("show",function(){var x=w._selectedEl;x&&w._plugin._updateTip(t,x)})}})};h.registerBubble("flash","Flash \u7f51\u5740\uff1a ",m);h.checkFlash=m;var a={"Flash\u5c5e\u6027":function(d){var f=
d.getSelection();f=f&&f.getStartElement();f=m(f);d=d._toolbars.flash;f&&d.show(null,f)}};h.CLS_FLASH=c;h.TYPE_FLASH="flash"}();g&&g.addRules({elements:{object:function(h){var m=h.attributes;if(!(m.classid&&String(m.classid).toLowerCase())){for(m=0;m<h.children.length;m++)if(h.children[m].name=="embed"){if(!l.Flash.isFlashEmbed(h.children[m]))break;return e.createFakeParserElement(h,c,"flash",true)}return null}return e.createFakeParserElement(h,c,"flash",true)},embed:function(h){if(!l.Flash.isFlashEmbed(h))return null;
return e.createFakeParserElement(h,c,"flash",true)}}},5)});
KISSY.Editor.add("flashbridge",function(){function g(c){this._init(c)}function l(c){var b=v.isString(c)?c.match(/(\d)+/g):c;c=c;if(v.isArray(b))c=parseFloat(b[0]+"."+s(b[1],3)+s(b[2],5));return c||0}function s(c,b){for(var h=(c+"").length;h++<b;)c="0"+c;return c}var v=KISSY,n=v.Editor;if(!n.FlashBridge){var u={};v.augment(g,v.EventTarget,{_init:function(c){var b=v.guid("flashbridge-");c.flashVars=c.flashVars||{};c.attrs=c.attrs||{};c.params=c.params||{};var h=c.flashVars,m=c.params;v.mix(c.attrs,
{id:b,width:"100%",height:"100%"},false);v.mix(m,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);v.mix(h,{shareData:false,useCompression:false},false);m={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(c.ajbridge)m={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};v.mix(h,m);u[b]=this;this.id=b;this.swf=n.Utils.flash.createSWFRuntime(c.movie,c);this._expose(c.methods)},_expose:function(c){for(var b=this,h=0;h<c.length;h++)(function(m){b[m]=
function(){return b._callSWF(m,v.makeArray(arguments))}})(c[h])},_callSWF:function(c,b){b=b||[];try{if(this.swf[c])return this.swf[c].apply(this.swf,b)}catch(h){var m="";if(b.length!==0)m="'"+b.join("', '")+"'";return(new Function("self","return self.swf."+c+"("+m+");"))(this)}},_eventHandler:function(c){var b=c.type;if(b==="log")v.log(c.message);else b&&this.fire(b,c)},_destroy:function(){delete u[this.id]}});g.EventHandler=function(c,b){var h=u[c];h&&setTimeout(function(){h._eventHandler.call(h,
b)},100)};n.FlashBridge=g;var p=v.UA,j,q,e=true;p.fpv=function(c){if(c||e){e=false;var b;if(navigator.plugins&&navigator.mimeTypes.length)b=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{b=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(h){}j=b?b.match(/(\d)+/g):void 0;q=l(j)}return j};p.fpvGEQ=function(c,b){e&&p.fpv(b);return!!q&&q>=l(c)}}});
KISSY.Editor.add("flashutils",function(){var g=KISSY,l=g.Editor,s=l.Utils.flash;if(!s){var v=g.DOM,n=g.Node,u=g.UA;s={getUrl:function(p){var j="",q=l.NODE;if(p._4e_name()=="object"){p=p[0].childNodes;for(var e=0;e<p.length;e++)if(p[e].nodeType==q.NODE_ELEMENT)if((v.attr(p[e],"name")||"").toLowerCase()=="movie")j=v.attr(p[e],"value");else if(v._4e_name(p[e])=="embed")j=v.attr(p[e],"src");else if(v._4e_name(p[e])=="object")j=v.attr(p[e],"data")}else if(p._4e_name()=="embed")j=p.attr("src");return j},
createSWF:function(p,j,q){var e=j.attrs||{},c=j.flashVars,b="",h="";j=j.params||{};var m="";q=q||document;g.mix(e,{wmode:"transparent"});for(var k in e)if(e.hasOwnProperty(k))b+=k+"='"+e[k]+"' ";g.mix(j,{quality:"high",movie:p,wmode:"transparent"});for(var a in j)if(j.hasOwnProperty(a))h+="<param name='"+a+"' value='"+j[a]+"'/>";if(c){for(var d in c)if(c.hasOwnProperty(d))m+="&"+d+"="+encodeURIComponent(c[d]);m=m.substring(1)}p="<object "+b+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
h+(m?'<param name="flashVars" value="'+m+'"/>':"")+"<embed "+b+" "+(m?'FlashVars="'+m+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+p+'"  type="application/x-shockwave-flash"/></object>';return{el:new n(p,null,q),html:p}},createSWFRuntime2:function(p,j,q){q=q||document;var e=(new n("<div style='width:0;height:0;overflow:hidden;'>",null,q)).appendTo(q.body);e=s.createSWF.apply(this,arguments).el.appendTo(e);u.ie||(e=e.one("object"));return e[0]},createSWFRuntime:function(p,
j,q){var e=j.attrs||{},c=j.flashVars||{},b=j.params||{},h="",m="",k="";q=q||document;e.id=e.id||g.guid("ke-runtimeflash-");for(var a in e)if(e.hasOwnProperty(a))h+=a+"='"+e[a]+"' ";for(var d in b)if(b.hasOwnProperty(d))m+="<param name='"+d+"' value='"+b[d]+"'/>";for(var f in c)if(c.hasOwnProperty(f))k+="&"+f+"="+encodeURIComponent(c[f]);k=k.substring(1);p=u.ie?"<object "+h+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+m+'<param name="movie" value="'+p+'" />'+(k?'<param name="flashVars" value="'+
k+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+p+"' "+h+">"+m+(k?'<param name="flashVars" value="'+k+'"/>':"")+"</object>";var r=j.holder;if(!r){r=(new n("<div style='"+(j.style?j.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,q)).appendTo(q.body);setTimeout(function(){r.offset({left:v.scrollLeft(),top:v.scrollTop()})},100)}r.html(p);return q.getElementById(e.id)}};l.Utils.flash=s}});
KISSY.Editor.add("font",function(g){function l(z){for(var t=[],o=0;o<z.length;o++)t.push({name:z[o],value:z[o]});return t}var s=KISSY,v=s.Editor,n=v.Style,u=v.TripleButton,p=g.cfg.pluginConfig,j=s.Node,q=p["font-size"];if(q!==false){q=q||{};s.mix(q,{items:l(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var e={},c=[],b={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(w=0;w<q.items.length;w++){var h=
q.items[w],m=h.name,k=h.attrs;h=h.value;e[h]=new n(b,{size:h});c.push({name:m,value:h,attrs:k})}p["font-size"]=q}e.inherit=new n(b,{size:"inherit"});var a=p["font-family"];if(a!==false){a=a||{};s.mix(a,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},
{name:"Arial",value:"Arial"},{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var d={},f=[],r={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]},w;p["font-family"]=a;for(w=0;w<a.items.length;w++){h=a.items[w];m=h.name;k=h.attrs||{};b=h.value;k.style=k.style||"";k.style+=";font-family:"+b;d[b]=new n(r,{family:b});f.push({name:m,value:b,attrs:k})}}d.inherit=new n(r,{family:"inherit"});v.Font||function(){function z(A){z.superclass.constructor.call(this,
A);this._init()}function t(A){t.superclass.constructor.call(this,A);this._init()}z.ATTRS={title:{},html:{},styles:{},editor:{}};var o=v.Select;s.extend(z,s.Base,{_init:function(){var A=this.get("editor"),x=A.toolBarDiv;this.get("html");this.el=new o({container:x,doc:A.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new j(document.body)});this.el.on("click",this._vChange,this);A.on("selectionChange",
this._selectionChange,this);v.Utils.sourceDisable(A,this)},disable:function(){this.el.set("state",o.DISABLED)},enable:function(){this.el.set("state",o.ENABLED)},_vChange:function(A){var x=this.get("editor"),B=A.newVal;A=A.prevVal;var i=this.get("styles");x.focus();x.fire("save");i=i[B];if(B==A){i.remove(x.document);this.el.set("value","")}else i.apply(x.document);x.fire("save")},_selectionChange:function(A){this.get("editor");A=A.path.elements;for(var x=this.get("styles"),B=0,i;B<A.length;B++){i=
A[B];for(var y in x)if(x[y].checkElementRemovable(i,true)){this.el.set("value",y);return}}this.el.reset("value")}});t.ATTRS={editor:{},text:{},contentCls:{},title:{},style:{}};s.extend(t,s.Base,{_init:function(){var A=this.get("editor"),x=this.get("text");this.get("style");var B=this.get("title");this.el=new u({text:x,title:B,contentCls:this.get("contentCls"),container:A.toolBarDiv});this.el.on("offClick",this._on,this);this.el.on("onClick",this._off,this);A.on("selectionChange",this._selectionChange,
this);v.Utils.sourceDisable(A,this)},disable:function(){this.el.set("state",u.DISABLED)},enable:function(){this.el.set("state",u.OFF)},_on:function(){var A=this.get("editor");this.get("text");var x=this.get("style");this.get("title");A.fire("save");x.apply(A.document);A.fire("save");A.notifySelectionChange();A.focus()},_off:function(){var A=this.get("editor");this.get("text");var x=this.get("style");this.get("title");A.fire("save");x.remove(A.document);A.fire("save");A.notifySelectionChange();A.focus()},
_selectionChange:function(A){this.get("editor");this.get("text");var x=this.get("style");this.get("title");var B=this.el;A=A.path;if(B.get("state")!=u.DISABLED)x.checkActive(A)?B.set("state",u.ON):B.set("state",u.OFF)}});z.SingleFont=t;v.Font=z}();g.addPlugin(function(){false!==p["font-size"]&&new v.Font({editor:g,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:q.width,styles:e,html:c});false!==p["font-family"]&&new v.Font({editor:g,title:"\u5b57\u4f53",width:"110px",popUpWidth:a.width,styles:d,html:f});
false!==p["font-bold"]&&new v.Font.SingleFont({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",editor:g,style:new n({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})});false!==p["font-italic"]&&new v.Font.SingleFont({contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 ",editor:g,style:new n({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})});false!==p["font-underline"]&&new v.Font.SingleFont({contentCls:"ke-toolbar-underline",
title:"\u4e0b\u5212\u7ebf ",editor:g,style:new n({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})});false!==p["font-strikeThrough"]&&new v.Font.SingleFont({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",editor:g,style:new n({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})})})});
KISSY.Editor.add("forecolor",function(g){var l=KISSY.Editor.ColorSupport,s={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]};g.addPlugin(function(){new l({editor:g,styles:s,title:"\u6587\u672c\u989c\u8272",contentCls:"ke-toolbar-color",text:"color"})})});
KISSY.Editor.add("format",function(g){var l=KISSY.Editor,s=KISSY,v=s.Node,n=[],u={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},p={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},j={},q=l.Style,e;for(e in u)if(u[e]){j[u[e]]=new q({element:u[e]});n.push({name:e,value:u[e],attrs:{style:"font-size:"+p[u[e]]}})}l.Format||function(){function c(h){c.superclass.constructor.call(this,h);this._init()}c.ATTRS={editor:{}};var b=l.Select;s.extend(c,s.Base,
{_init:function(){var h=this.get("editor");this.el=new b({container:h.toolBarDiv,value:"",doc:h.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new v(document.body)});this.el.on("click",this._vChange,this);h.on("selectionChange",this._selectionChange,this);l.Utils.sourceDisable(h,this)},disable:function(){this.el.set("state",b.DISABLED)},enable:function(){this.el.set("state",b.ENABLED)},_vChange:function(h){var m=this.get("editor"),
k=h.newVal;h=h.prevVal;m.fire("save");if(k!=h)j[k].apply(m.document);else{j.p.apply(m.document);this.el.set("value","p")}m.fire("save")},_selectionChange:function(h){this.get("editor");h=h.path;for(var m in j)if(j[m].checkActive(h)){this.el.set("value",m);return}this.el.reset("value")}});l.Format=c}();g.addPlugin(function(){new l.Format({editor:g,html:n,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(g){var l=l,s=KISSY,v=s.Editor,n=s.Node,u=s.UA,p=v.NODE,j=v.HtmlParser,q=new j.Filter,e=new j.Filter,c=v.XHTML_DTD;if(!g.htmlDataProcessor){(function(){var b=v.HtmlParser.Fragment.prototype,h=v.HtmlParser.Element.prototype;b.onlyChild=h.onlyChild=function(){var m=this.children;return m.length==1&&m[0]||null};h.removeAnyChildWithName=function(m){for(var k=this.children,a=[],d,f=0;f<k.length;f++){d=k[f];if(d.name){if(d.name==m){a.push(d);k.splice(f--,1)}a=
a.concat(d.removeAnyChildWithName(m))}}return a};h.getAncestor=function(m){for(var k=this.parent;k&&!(k.name&&k.name.match(m));)k=k.parent;return k};b.firstChild=h.firstChild=function(m){for(var k,a=0;a<this.children.length;a++){k=this.children[a];if(m(k))return k;else if(k.name)if(k=k.firstChild(m))return k}return null};h.addStyle=function(m,k,a){var d="";if(typeof k=="string")d+=m+":"+k+";";else{if(typeof m=="object")for(var f in m){if(m.hasOwnProperty(f))d+=f+":"+m[f]+";"}else d+=m;a=k}if(!this.attributes)this.attributes=
{};m=this.attributes.style||"";m=(a?[d,m]:[m,d]).join(";");this.attributes.style=m.replace(/^;|;(?=;)/,"")};c.parentOf=function(m){var k={},a;for(a in this)if(a.indexOf("$")==-1&&this[a][m])k[a]=1;return k}})();(function(){function b(o){if(/mso-list\s*:\s*Ignore/i.test(o.attributes&&o.attributes.style))return true;return l}function h(o,A){var x=new v.HtmlParser.Element("ke:listbullet"),B;if(o)if(o[2]){o=isNaN(o[1])?/^[a-z]+$/.test(o[1])?"lower-alpha":/^[A-Z]+$/.test(o[1])?"upper-alpha":"decimal":
"decimal";B="ol"}else{o=/[l\u00B7\u2002]/.test(o[1])?"disc":/[\u006F\u00D8]/.test(o[1])?"circle":/[\u006E\u25C6]/.test(o[1])?"square":"disc";B="ul"}else{o="decimal";B="ol"}x.attributes={"ke:listtype":B,style:"list-style-type:"+o+";"};x.add(new v.HtmlParser.Text(A));return x}function m(o){var A=o.attributes,x;if((x=o.removeAnyChildWithName("ke:listbullet"))&&x.length&&(x=x[0])){o.name="ke:li";if(A.style)A.style=k([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");
B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!f&&r&&B>r)f=B-r;A["ke:margin"]=r=B}]],l)(A.style,o)||"";x=x.attributes;o.addStyle(x.style);s.mix(A,x);return true}return false}function k(o,A){return function(x,B){var i=[];x.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(C,E,D){E=E.toLowerCase();E=="font-family"&&(D=D.replace(/["']/g,""));for(var F,K,M,N=0;N<o.length;N++)if(o[N]){C=o[N][0];F=o[N][1];K=o[N][2];M=o[N][3];if(E.match(C)&&(!F||D.match(F))){E=M||E;A&&(K=K||D);if(typeof K==
"function")K=K(D,B,E);if(K&&K.push){E=K[0];K=K[1]}typeof K=="string"&&i.push([E,K]);return}}!A&&i.push([E,D])});for(var y=0;y<i.length;y++)i[y]=i[y].join(":");return i.length?i.join(";")+";":false}}function a(o){o=o.children;for(var A,x,B,i,y,C,E,D=0;D<o.length;D++){A=o[D];if("ke:li"==A.name){A.name="li";A=A;x=A.attributes;B=A.attributes["ke:listtype"];i=parseInt(x["ke:indent"],10)||f&&Math.ceil(x["ke:margin"]/f)||1;x.style&&(x.style=k([["list-style-type",B=="ol"?"decimal":"disc"]],l)(x.style)||"");
if(C){if(i>E){C=new v.HtmlParser.Element(B);C.add(A);y.add(C)}else{if(i<E){y=E-i;for(var F;y--&&(F=C.parent);)C=F.parent}C.add(A)}o.splice(D--,1)}else{C=new v.HtmlParser.Element(B);C.add(A);o[D]=C}y=A;E=i}else C=null}f=0}var d=k([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],l),f,r=0,w=c.parentOf("ol"),z={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(o){o.filterChildren();
a(o)},elements:{font:function(o){delete o.name},p:function(o){o.filterChildren();if(m(o))return l},$:function(o){var A=o.name||"";A.indexOf(":")!=-1&&A.indexOf("ke")==-1&&delete o.name;var x=o.attributes.style;if(A=="span"&&(!x||!d(x)))delete o.name;if(A in w){o.filterChildren();a(o)}},span:function(o){if(!u.gecko&&b(o.parent))return false;if(!u.gecko&&b(o)){o=(o=o.firstChild(function(x){return x.value||x.name=="img"}))&&(o.value||"l.");var A=o.match(/^([^\s]+?)([.)]?)$/);return h(A,o)}},a:function(o){o=
o.attributes;if(o.href)o._ke_saved_href=o.href}},comment:!u.ie?function(o,A){var x=o.match(/<img.*?>/),B=o.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(x=B[1]||x&&"l.")&&x.match(/>([^\s]+?)([.)]?)</);return h(B,x)}if(u.gecko&&x){x=v.HtmlParser.Fragment.FromHtml(x[0]).children[0];(B=(B=(B=A.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(x.attributes.src=B);return x}return false}:function(){return false},attributes:{"class":function(o){if(/(^|\s+)ke_/.test(o))return o;
return false},style:function(o){o=d(o);if(!o)return false;return o}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},t={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(o){var A=o.parent;if(A&&A.name=="object"){var x=A.attributes.width;A=A.attributes.height;x&&(o.attributes.width=x);A&&(o.attributes.height=A)}},param:function(o){o.children=[];o.isEmpty=true;return o},a:function(o){if(!(o.children.length||o.attributes.name))return false;o=o.attributes;if(o._ke_saved_href)o.href=
o._ke_saved_href},td:function(o){for(var A=o.children,x=0;x<A.length;x++)if(A[x].name=="br"){A.splice(x,1);--x}if(!o.children.length){A=new v.HtmlParser.Text("&nbsp;");o.children.push(A)}},span:function(o){if(!o.children.length)return false}},attributes:{style:function(o){if(!s.trim(o))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(u.ie)t.attributes.style=function(o){return o.toLowerCase()};q.addRules(t);e.addRules(z)})();(function(){function b(t){for(var o=t.children.length,
A=t.children[o-1];A&&A.type==p.NODE_TEXT&&!s.trim(A.value);)A=t.children[--o];return A}function h(t){var o=b(t);return!o||o.type==p.NODE_ELEMENT&&o.name=="br"||t.name=="form"&&o.name=="input"}function m(t,o){var A=t.children,x=b(t);if(x){if((o||!u.ie)&&x.type==p.NODE_ELEMENT&&x.name=="br")A.pop();x.type==p.NODE_TEXT&&d.test(x.value)&&A.pop()}}function k(t){m(t,true);if(h(t))u.ie?t.add(new v.HtmlParser.Text("\u00a0")):t.add(new v.HtmlParser.Element("br",{}))}function a(t){m(t);h(t)&&t.add(new v.HtmlParser.Text("\u00a0"))}
var d=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,f=v.XHTML_DTD,r=v.Utils.mix({},f.$block,f.$listItem,f.$tableContent),w;for(w in r)"br"in f[w]||delete r[w];delete r.pre;f={elements:{}};var z={elements:{}};for(w in r){f.elements[w]=k;z.elements[w]=a}e.addRules(f);q.addRules(z)})();(function(){q.addRules({text:function(b){return b.replace(/\xa0/g,"&nbsp;")}})})();g.htmlDataProcessor={htmlFilter:q,dataFilter:e,toHtml:function(b,h){var m=new j.HtmlWriter;j.Fragment.FromHtml(b,h).writeHtml(m,q);return m.getHtml(true)},
toDataFormat:function(b,h){if(u.gecko)b=b.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var m=new n("<div>");m.html("a"+b);b=m.html().substr(1);m=new j.BasicWriter;var k=j.Fragment.FromHtml(b,h);m.reset();k.writeHtml(m,e);return m.getHtml(true)},toServer:function(b,h){var m=new j.BasicWriter;j.Fragment.FromHtml(b,h).writeHtml(m,q);return m.getHtml(true)}}}});
KISSY.Editor.add("image",function(g){var l=KISSY.Editor,s=KISSY,v=s.UA,n=s.Node,u=s.Event,p=l.BubbleView;l.ImageInserter||function(){function j(b){j.superclass.constructor.call(this,b);this._init()}var q=function(b){return b._4e_name()==="img"&&!/(^|\s+)ke_/.test(b[0].className)&&b},e=l.TripleButton;j.ATTRS={editor:{}};var c={"\u56fe\u7247\u5c5e\u6027":function(b){var h=b.getSelection();h=h&&h.getStartElement();h=q(h);b=b._toolbars.image;h&&b.show(null,h)}};s.extend(j,s.Base,{_init:function(){var b=this.get("editor"),
h=b.toolBarDiv,m={};this.editor=b;this.el=new e({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",container:h});this.el.on("offClick",this.show,this);u.on(b.document,"dblclick",this._dblclick,this);l.Utils.lazyRun(this,"_prepare","_real");b._toolbars=b._toolbars||{};b._toolbars.image=this;if(c){for(var k in c)(function(a){m[a]=function(){c[a](b)}})(k);l.ContextMenu.register({editor:b,rules:[q],width:"120px",funcs:m})}p.attach({pluginName:"image",pluginInstance:this});l.Utils.sourceDisable(b,this)},disable:function(){this.el.disable()},
enable:function(){this.el.boff()},_dblclick:function(b){var h=new n(b.target);if(q(h)){this.show(null,h);b.halt()}},_updateTip:function(b,h){var m=h.attr("src");b.html(m);b.attr("href",m)},show:function(b,h){this.get("editor").useDialog("image/dialog",function(m){m.show(h)})}});l.ImageInserter=j;(function(b,h,m){p.register({pluginName:b,func:m,init:function(){var k=this,a=k.get("contentEl");a.html(h+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var d=a.one(".ke-bubbleview-url"),f=a.one(".ke-bubbleview-change"),r=a.one(".ke-bubbleview-remove");l.Utils.preventFocus(a);f.on("click",function(w){k._plugin.show(null,k._selectedEl);w.halt()});r.on("click",function(w){var z=k._plugin;if(v.webkit){var t=z.editor.getSelection().getRanges();t&&t[0]&&(t[0].collapse(true)||1)&&t[0].select()}k._selectedEl._4e_remove();k.hide();z.editor.notifySelectionChange();w.halt()});k.on("show",function(){var w=k._selectedEl;w&&k._plugin._updateTip(d,w)})}})})("image",
"\u56fe\u7247\u7f51\u5740\uff1a ",q)}();g.addPlugin(function(){new l.ImageInserter({editor:g})})});
KISSY.Editor.add("indent",function(g){var l=KISSY.Editor,s={ol:1,ul:1},v=KISSY,n=l.Walker,u=v.DOM,p=v.Node,j=v.UA,q=l.NODE;l.Indent||function(){function e(f){this.type=f;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function c(f){return f[0].nodeType==q.NODE_ELEMENT&&f._4e_name()=="li"}function b(f,r){for(var w=f.startContainer,z=f.endContainer;w&&!w.parent()._4e_equals(r);)w=w.parent();for(;z&&!z.parent()._4e_equals(r);)z=z.parent();if(w&&z){var t=w;w=[];for(var o=
false;!o;){if(t._4e_equals(z))o=true;w.push(t);t=t.next()}if(!(w.length<1)){t=r._4e_parents(true);for(z=0;z<t.length;z++)if(s[t[z]._4e_name()]){r=t[z];break}t=this.type=="indent"?1:-1;z=w[0];o=w[w.length-1];w={};var A=l.ListUtils.listToArray(r,w),x=A[o.data("listarray_index")].indent;for(z=z.data("listarray_index");z<=o.data("listarray_index");z++){A[z].indent+=t;var B=A[z].parent;A[z].parent=new p(B[0].ownerDocument.createElement(B._4e_name()))}for(z=o.data("listarray_index")+1;z<A.length&&A[z].indent>
x;z++)A[z].indent+=t;o=l.ListUtils.arrayToList(A,w,null,"p",0);t=[];if(this.type=="outdent"){var i;if((i=r.parent())&&i._4e_name()=="li"){A=o.listNode.childNodes;var y;for(z=A.length-1;z>=0;z--)if((y=new p(A[z]))&&y._4e_name()=="li")t.push(y)}}if(o){u.insertBefore(o.listNode,r);r._4e_remove()}if(t&&t.length)for(z=0;z<t.length;z++){for(o=y=t[z];(o=o.next())&&o._4e_name()in s;){j.ie&&!y._4e_first(function(C){return k(C)&&a(C)})&&y[0].appendChild(f.document.createTextNode("\u00a0"));y[0].appendChild(o[0])}u.insertAfter(y[0],
i[0])}l.Utils.clearAllMarkers(w)}}}function h(f){var r=parseInt(f._4e_style(this.indentCssProperty),10);if(isNaN(r))r=0;r+=(this.type=="indent"?1:-1)*this.indentOffset;if(r<0)return false;r=Math.max(r,0);r=Math.ceil(r/this.indentOffset)*this.indentOffset;f.css(this.indentCssProperty,r?r+this.indentUnit:"");f[0].style.cssText===""&&f.removeAttr("style");return true}function m(f){m.superclass.constructor.call(this,f);f=this.get("editor").toolBarDiv;this.el=new d({container:f,contentCls:this.get("contentCls"),
title:this.get("title")});this.indentCommand=new e(this.get("type"));this._init()}var k=n.whitespaces(true),a=n.bookmark(false,true);v.augment(e,{exec:function(f){for(var r=(f=f.getSelection())&&f.getRanges()[0],w=r.startContainer,z=r.endContainer,t=r.getCommonAncestor();t&&!(t[0].nodeType==q.NODE_ELEMENT&&s[t._4e_name()]);)t=t.parent();if(t&&w[0].nodeType==q.NODE_ELEMENT&&w._4e_name()in s){w=new n(r);w.evaluator=c;r.startContainer=w.next()}if(t&&z[0].nodeType==q.NODE_ELEMENT&&z._4e_name()in s){w=
new n(r);w.evaluator=c;r.endContainer=w.previous()}z=f.createBookmarks(true);if(t){for(w=t._4e_first();w&&w._4e_name()!="li";)w=w.next();var o=r.startContainer;(w[0]==o[0]||w.contains(o))&&h.call(this,t)||b.call(this,r,t)}else{r=r.createIterator();r.enforceRealBlocks=true;for(r.enlargeBr=true;t=r.getNextParagraph();)h.call(this,t)}f.selectBookmarks(z)}});var d=l.TripleButton;m.ATTRS={type:{},contentCls:{},editor:{}};v.extend(m,v.Base,{_init:function(){var f=this.get("editor"),r=this.el;r.on("offClick",
this.exec,this);this.get("type")=="outdent"?f.on("selectionChange",this._selectionChange,this):r.set("state",d.OFF);l.Utils.sourceDisable(f,this)},disable:function(){this.el.set("state",d.DISABLED)},enable:function(){this.el.set("state",d.OFF)},exec:function(){var f=this.get("editor"),r=this;f.fire("save");setTimeout(function(){r.indentCommand.exec(f);f.fire("save");f.notifySelectionChange()},10)},_selectionChange:function(f){this.get("editor");this.get("type");var r=f.path,w=r.blockLimit;f=this.el;
if(r.contains(s))f.set("state",d.OFF);else(r=r.block||w)&&r._4e_style(this.indentCommand.indentCssProperty)?f.set("state",d.OFF):f.set("state",d.DISABLED)}});l.Indent=m}();g.addPlugin(function(){g.addCommand("outdent",new l.Indent({editor:g,title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-outdent",type:"outdent"}));g.addCommand("indent",new l.Indent({editor:g,title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-indent",type:"indent"}))})});
KISSY.Editor.add("justify",function(g){var l=KISSY.Editor,s=KISSY,v=l.TripleButton;l.Justify||function(){function n(p,j,q,e){this.editor=p;this.v=j;this.contentCls=e;this.title=q;this._init()}var u=/(-moz-|-webkit-|start|auto)/gi;s.augment(n,{_init:function(){var p=this.editor;this.el=new v({contentCls:this.contentCls,title:this.title,container:p.toolBarDiv});p.on("selectionChange",this._selectionChange,this);this.el.on("offClick",this._effect,this);l.Utils.sourceDisable(p,this)},disable:function(){this.el.set("state",
v.DISABLED)},enable:function(){this.el.set("state",v.OFF)},_effect:function(){var p=this.editor,j=p.getSelection(),q=this.el.get("state");if(j){var e=j.createBookmarks(),c=j.getRanges(),b,h;p.fire("save");for(var m=c.length-1;m>=0;m--){b=c[m].createIterator();for(b.enlargeBr=true;h=b.getNextParagraph();){h.removeAttr("align");q==v.OFF?h.css("text-align",this.v):h.css("text-align","")}}p.notifySelectionChange();j.selectBookmarks(e);p.fire("save")}},_selectionChange:function(p){var j=this.el;p=p.path;
p=p.block||p.blockLimit;if(!p||p._4e_name()==="body")j.set("state",v.OFF);else(p.css("text-align").replace(u,"")||"left")==this.v?j.set("state",v.ON):j.set("state",v.OFF)}});l.Justify=n}();g.addPlugin(function(){new l.Justify(g,"left","\u5de6\u5bf9\u9f50 ","ke-toolbar-alignleft");new l.Justify(g,"center","\u5c45\u4e2d\u5bf9\u9f50 ","ke-toolbar-aligncenter");new l.Justify(g,"right","\u53f3\u5bf9\u9f50 ","ke-toolbar-alignright")})});
KISSY.Editor.add("link",function(g){var l=KISSY,s=l.Editor;s.Link||function(){function v(c){this.editor=c;this._init()}function n(c){return c._4e_ascendant(function(b){return b._4e_name()==="a"&&!!b.attr("href")},true)}function u(c,b){for(var h=c[0],m=h.attributes,k={},a=0;a<m.length;a++){var d=m[a];if(d.specified)k[d.name]=d.value}if(h.style.cssText)k.style=h.style.cssText;h=new j(e,k);b.fire("save");h.remove(b.document);b.fire("save")}var p=s.TripleButton,j=s.Style,q=s.BubbleView,e={element:"a",
attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};v.link_Style=e;v._ke_saved_href="_ke_saved_href";v.checkLink=n;q.register({pluginName:"link",func:n,init:function(){var c=this,b=c.get("contentEl");b.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var h=b.one(".ke-bubbleview-url"),m=b.one(".ke-bubbleview-change"),
k=b.one(".ke-bubbleview-remove");s.Utils.preventFocus(b);m.on("click",function(a){c._plugin.show();a.halt()});k.on("click",function(a){var d=c._plugin.editor;u(c._selectedEl,d);d.notifySelectionChange();a.halt()});c.on("show",function(){var a=c._selectedEl;if(a){a=a.attr("_ke_saved_href")||a.attr("href");h.html(a);h.attr("href",a)}})}});v._removeLink=u;l.augment(v,{_init:function(){var c=this.editor;this.el=new p({container:c.toolBarDiv,contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5 "});this.el.on("offClick",
this.show,this);q.attach({pluginName:"link",pluginInstance:this});s.Utils.sourceDisable(c,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},show:function(){this.editor.useDialog("link/dialog",function(c){c.show()})}});s.Link=v}();g.addPlugin(function(){new s.Link(g)})});
KISSY.Editor.add("list",function(g){var l=KISSY.Editor,s={ol:1,ul:1},v=["ol","ul"],n=KISSY,u=l.RANGE,p=l.ElementPath,j=l.Walker,q=l.NODE,e=n.UA,c=n.Node,b=n.DOM;l.List||function(){function h(f){this.type=f}function m(f){m.superclass.constructor.call(this,f);f=this.get("editor").toolBarDiv;this.el=new d({contentCls:this.get("contentCls"),title:this.get("title"),container:f});this.listCommand=new h(this.get("type"));this.listCommand.state=this.get("status");this._init()}var k={listToArray:function(f,
r,w,z,t){if(!s[f._4e_name()])return[];z||(z=0);w||(w=[]);for(var o=0,A=f[0].childNodes.length;o<A;o++){var x=new c(f[0].childNodes[o]);if(x._4e_name()=="li"){var B={parent:f,indent:z,element:x,contents:[]};if(t)B.grandparent=t;else{B.grandparent=f.parent();if(B.grandparent&&B.grandparent._4e_name()=="li")B.grandparent=B.grandparent.parent()}r&&x._4e_setMarker(r,"listarray_index",w.length);w.push(B);for(var i=0,y=x[0].childNodes.length,C;i<y;i++){C=new c(x[0].childNodes[i]);C[0].nodeType==q.NODE_ELEMENT&&
s[C._4e_name()]?k.listToArray(C,r,w,z+1,B.grandparent):B.contents.push(C)}}}return w},arrayToList:function(f,r,w,z){w||(w=0);if(!f||f.length<w+1)return null;for(var t=f[w].parent[0].ownerDocument,o=t.createDocumentFragment(),A=null,x=w,B=Math.max(f[w].indent,0),i=null;;){var y=f[x];if(y.indent==B){if(!A||f[x].parent._4e_name()!=A._4e_name()){A=f[x].parent._4e_clone(false,true);o.appendChild(A[0])}i=A[0].appendChild(y.element._4e_clone(false,true)[0]);for(var C=0;C<y.contents.length;C++)i.appendChild(y.contents[C]._4e_clone(true,
true)[0]);x++}else if(y.indent==Math.max(B,0)+1){x=k.arrayToList(f,null,x,z);i.appendChild(x.listNode);x=x.nextIndex}else if(y.indent==-1&&!w&&y.grandparent){if(s[y.grandparent._4e_name()])i=y.element._4e_clone(false,true)[0];else if(y.grandparent._4e_name()!="td"){i=t.createElement(z);y.element._4e_copyAttributes(new c(i))}else i=t.createDocumentFragment();for(C=0;C<y.contents.length;C++){A=y.contents[C]._4e_clone(true,true);i.nodeType==q.NODE_DOCUMENT_FRAGMENT&&y.element._4e_copyAttributes(new c(A));
i.appendChild(A[0])}if(i.nodeType==q.NODE_DOCUMENT_FRAGMENT&&x!=f.length-1){i.lastChild&&i.lastChild.nodeType==q.NODE_ELEMENT&&i.lastChild.getAttribute("type")=="_moz"&&b._4e_remove(i.lastChild);b._4e_appendBogus(i)}if(i.nodeType==q.NODE_ELEMENT&&b._4e_name(i)==z&&i.firstChild){b._4e_trim(i);A=i.firstChild;if(A.nodeType==q.NODE_ELEMENT&&b._4e_isBlockBoundary(A)){A=t.createDocumentFragment();b._4e_moveChildren(i,A);i=A}}A=b._4e_name(i);if(!e.ie&&(A=="div"||A=="p"))b._4e_appendBogus(i);o.appendChild(i);
A=null;x++}else return null;if(f.length<=x||Math.max(f[x].indent,0)<B)break}if(r)for(f=new c(o.firstChild);f&&f[0];){f[0].nodeType==q.NODE_ELEMENT&&f._4e_clearMarkers(r,true);f=f._4e_nextSourceNode()}return{listNode:o,nextIndex:x}}},a=/^h[1-6]$/;h.prototype={changeListType:function(f,r,w,z){var t=k.listToArray(r.root,w),o=[];for(f=0;f<r.contents.length;f++){var A=r.contents[f];A=A._4e_ascendant("li",true);if(!(!A||!A[0]||A.data("list_item_processed"))){o.push(A);A._4e_setMarker(w,"list_item_processed",
true)}}A=new c(r.root[0].ownerDocument.createElement(this.type));for(f=0;f<o.length;f++){var x=o[f].data("listarray_index");t[x].parent=A}w=k.arrayToList(t,w,null,"p");var B;t=w.listNode.childNodes.length;for(f=0;f<t&&(B=new c(w.listNode.childNodes[f]));f++)B._4e_name()==this.type&&z.push(B);b.insertBefore(w.listNode,r.root);r.root._4e_remove()},createList:function(f,r,w){var z=r.contents;f=r.root[0].ownerDocument;var t=[];if(z.length==1&&z[0][0]===r.root[0]){var o=new c(f.createElement("div"));z[0][0].nodeType!=
q.NODE_TEXT&&z[0]._4e_moveChildren(o);z[0][0].appendChild(o[0]);z[0]=o}r=r.contents[0].parent();for(o=0;o<z.length;o++)r=r._4e_commonAncestor(z[o].parent());for(o=0;o<z.length;o++)for(var A=z[o],x;x=A.parent();){if(x[0]===r[0]){t.push(A);break}A=x}if(!(t.length<1)){z=new c(t[t.length-1][0].nextSibling);o=new c(f.createElement(this.type));for(w.push(o);t.length;){w=t.shift();A=new c(f.createElement("li"));if(a.test(w._4e_name()))A[0].appendChild(w[0]);else{w._4e_copyAttributes(A);w._4e_moveChildren(A);
w._4e_remove()}o[0].appendChild(A[0]);e.ie||A._4e_appendBogus()}z[0]?b.insertBefore(o,z):r.append(o)}},removeList:function(f,r,w){function z(C){if((i=new c(B[C?"firstChild":"lastChild"]))&&!(i[0].nodeType==q.NODE_ELEMENT&&i._4e_isBlockBoundary())&&(y=r.root[C?"_4e_previous":"_4e_next"](j.whitespaces(true)))&&!(i[0].nodeType==q.NODE_ELEMENT&&y._4e_isBlockBoundary({br:1})))b[C?"insertBefore":"insertAfter"](f.document.createElement("br"),i)}for(var t=k.listToArray(r.root,w),o=[],A=0;A<r.contents.length;A++){var x=
r.contents[A];x=x._4e_ascendant("li",true);if(!(!x||x.data("list_item_processed"))){o.push(x);x._4e_setMarker(w,"list_item_processed",true)}}x=null;for(A=0;A<o.length;A++){x=o[A].data("listarray_index");t[x].indent=-1;x=x}for(A=x+1;A<t.length;A++)if(t[A].indent>Math.max(t[A-1].indent,0)){o=t[A-1].indent+1-t[A].indent;for(x=t[A].indent;t[A]&&t[A].indent>=x;){t[A].indent+=o;A++}A--}var B=k.arrayToList(t,w,null,"p").listNode,i,y;z(true);z(undefined);b.insertBefore(B,r.root);r.root._4e_remove()},exec:function(f){var r=
f.getSelection(),w=r&&r.getRanges();if(!(!w||w.length<1)){for(var z=r.createBookmarks(true),t=[],o={};w.length>0;){var A=w.shift(),x=A.getBoundaryNodes(),B=x.startNode,i=x.endNode;B[0].nodeType==q.NODE_ELEMENT&&B._4e_name()=="td"&&A.setStartAt(x.startNode,u.POSITION_AFTER_START);i[0].nodeType==q.NODE_ELEMENT&&i._4e_name()=="td"&&A.setEndAt(x.endNode,u.POSITION_BEFORE_END);A=A.createIterator();for(A.forceBrBreak=false;x=A.getNextParagraph();)if(!x.data("list_block")){x._4e_setMarker(o,"list_block",
1);i=new p(x);var y=i.elements,C=null,E=false,D=i.blockLimit,F;for(B=y.length-1;B>=0&&(F=y[B]);B--)if(s[F._4e_name()]&&D.contains(F)){D.removeData("list_group_object");if(B=F.data("list_group_object"))B.contents.push(x);else{B={root:F,contents:[x]};t.push(B);F._4e_setMarker(o,"list_group_object",B)}E=true;break}if(!E){i=D||i.block;if(i.data("list_group_object"))i.data("list_group_object").contents.push(x);else{B={root:i,contents:[x]};i._4e_setMarker(o,"list_group_object",B);t.push(B)}}}}for(w=[];t.length>
0;){B=t.shift();if(this.state=="off")if(s[B.root._4e_name()])this.changeListType(f,B,o,w);else{l.Utils.clearAllMarkers(o);this.createList(f,B,w)}else this.state=="on"&&s[B.root._4e_name()]&&this.removeList(f,B,o)}for(B=0;B<w.length;B++){C=w[B];var K=this;(f=function(M){var N=C[M?"_4e_previous":"_4e_next"](j.whitespaces(true));if(N&&N[0]&&N._4e_name()==K.type){N._4e_remove();N._4e_moveChildren(C,M?true:false)}})();f(true)}l.Utils.clearAllMarkers(o);r.selectBookmarks(z)}}};var d=l.TripleButton;m.ATTRS=
{editor:{},type:{},contentCls:{}};n.extend(m,n.Base,{_init:function(){var f=this.get("editor");this.el.on("offClick onClick",this._change,this);f.on("selectionChange",this._selectionChange,this);l.Utils.sourceDisable(f,this)},disable:function(){this.el.set("state",d.DISABLED)},enable:function(){this.el.set("state",d.OFF)},_change:function(){var f=this.get("editor");this.get("type");var r=this.el;f.fire("save");this.listCommand.state=r.get("state");this.listCommand.exec(f);f.fire("save");f.notifySelectionChange()},
_selectionChange:function(f){this.get("editor");var r=this.get("type"),w=f.path,z;f=this.el;var t=w.blockLimit;w=w.elements;if(t){if(w)for(var o=0;o<w.length&&(z=w[o])&&z[0]!==t[0];o++){var A=n.indexOf(w[o]._4e_name(),v);if(A!==-1)if(v[A]===r){f.set("state",d.ON);return}else break}f.set("state",d.OFF)}}});l.ListUtils=k;l.List=m}();g.addPlugin(function(){new l.List({editor:g,title:"\u9879\u76ee\u5217\u8868",contentCls:"ke-toolbar-ul",type:"ul"});new l.List({editor:g,title:"\u7f16\u53f7\u5217\u8868",contentCls:"ke-toolbar-ol",type:"ol"})})});
KISSY.Editor.add("localStorage",function(){var g=KISSY,l=g.Editor,s;s=l.STORE="localStorage";if(!l.storeReady){l.storeReady=function(n){l.on("storeReady",n)};l.on("storeReady",function(){l.storeReady=function(n){n()};l.detach("storeReady")})}if(window[s])window[s]._ke||l.fire("storeReady");else{var v=l.Config.base+l.Utils.debugUrl("plugins/localStorage/swfstore.swf?rand="+ +new Date);window[s]=new l.FlashBridge({movie:v,methods:["setItem","removeItem","getValueOf"]});g.mix(window[s],{_ke:1,getItem:function(n){return this.getValueOf(n)}});
window[s].on("contentReady",function(){l.fire("storeReady")})}});
KISSY.Editor.add("maximize",function(g){var l=KISSY.Editor,s=KISSY,v=s.UA,n=s.Node,u=s.Event,p=l.TripleButton,j=s.DOM,q;if(!(v.gecko<1.92)){l.Maximize||function(){function e(c){this.editor=c;this._init()}j.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");e.init=function(){q=(new n("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>")).appendTo(document.body);e.init=null};s.augment(e,{_init:function(){var c=this.editor,b=
new p({container:c.toolBarDiv,title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"});this.el=b;b.on("offClick",this.maximize,this);b.on("onClick",this.restore,this);l.Utils.lazyRun(this,"_prepare","_real");this._toolBarDiv=c.toolBarDiv},restore:function(){var c=this,b=c.editor;c._resize&&u.remove(window,"resize",c._resize);c._saveEditorStatus();c._restoreState();c.el.boff();setTimeout(function(){c._restoreEditorStatus();b.notifySelectionChange();b.fire("restoreWindow")},30)},_restoreState:function(){var c=
document,b=this.editor,h=this._savedParents;if(h){for(var m=0;m<h.length;m++){var k=h[m];k.el.css("position",k.position)}this._savedParents=null}b.wrap.css({height:this.iframeHeight});j.css(c.body,{width:"",height:"",overflow:""});c.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:this.editorWrapWidth});q.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);c=this.el.el;c.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");
c.attr("title","\u5168\u5c4f");v.ie<8&&this._toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var c=this.editor,b=[],h=c.editorWrap;this.iframeHeight=c.wrap._4e_style("height");this.editorWrapWidth=h._4e_style("width");this.scrollLeft=j.scrollLeft();this.scrollTop=j.scrollTop();window.scrollTo(0,0);for(c=h.parent();c;){h=c.css("position");if(h!="static"){b.push({el:c,position:h});c.css("position","static")}c=c.parent()}this._savedParents=b;b=this.el.el;this.el.el.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
b.attr("title","\u53d6\u6d88\u5168\u5c4f");v.ie<8&&this._toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var c=this.editor;this.savedRanges=null;if(v.gecko&&c.iframeFocus)this.savedRanges=(c=c.getSelection())&&c.getRanges()},_restoreEditorStatus:function(){var c=this.editor,b=c.getSelection(),h=this.savedRanges;c.activateGecko();h&&b&&b.selectRanges(h);if(c.iframeFocus&&b)(c=b.getStartElement())&&c[0]&&c._4e_scrollIntoView();v.ie<8&&this.el.el.one("span").css("background-image","")},_maximize:function(c){var b=
document,h=this.editor,m=h.editorWrap,k=j.viewportHeight(),a=j.viewportWidth(),d=h.statusDiv?h.statusDiv[0].offsetHeight:0,f=h.toolBarDiv[0].offsetHeight;if(v.ie)b.body.style.overflow="hidden";else j.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";m.css({position:"absolute",zIndex:h.baseZIndex(l.zIndexManager.MAXIMIZE),width:a+"px"});q.css({zIndex:h.baseZIndex(l.zIndexManager.MAXIMIZE-5),height:k+"px",width:a+"px"});m.offset({left:0,top:0});q.css({left:0,
top:0});h.wrap.css({height:k-d-f+"px"});c!==true&&arguments.callee.call(this,true)},_real:function(){var c=this,b=c.editor;c._saveEditorStatus();c._saveSate();c._maximize();c._resize=c._resize||l.Utils.buffer(c._maximize,c,100);u.on(window,"resize",c._resize);c.el.set("state",p.ON);setTimeout(function(){c._restoreEditorStatus();b.notifySelectionChange();b.fire("maximizeWindow")},30)},_prepare:function(){e.init&&e.init()},maximize:function(){this._prepare()}});l.Maximize=e}();g.addPlugin(function(){new l.Maximize(g)})}});
KISSY.Editor.add("music",function(g){var l=KISSY.Editor,s=KISSY,v=s.DOM,n=s.UA,u=s.Event,p=l.Flash,j="ke_music",q=g.htmlDataProcessor,e=q&&q.dataFilter;e&&e.addRules({elements:{object:function(c){var b=c.attributes;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<c.children.length;b++)if(c.children[b].name=="embed"){if(!p.isFlashEmbed(c.children[b]))break;if(c.children[b].attributes.src.indexOf("niftyplayer.swf")!=-1)return q.createFakeParserElement(c,j,"music",true)}return null}for(b=
0;b<c.children.length;b++){var h=c.children[b];if(h.name=="param"&&h.attributes.name=="movie")if(h.attributes.value.indexOf("niftyplayer.swf")!=-1)return q.createFakeParserElement(c,j,"music",true)}},embed:function(c){if(!p.isFlashEmbed(c))return null;if(c.attributes.src.indexOf("niftyplayer.swf")!=-1)return q.createFakeParserElement(c,j,"music",true)}}},4);l.MusicInserter||function(){function c(k){c.superclass.constructor.apply(this,arguments);k.cfg.disableObjectResizing||u.on(k.document.body,n.ie?
"resizestart":"resize",function(a){v.hasClass(a.target,j)&&a.preventDefault()})}function b(k){return k._4e_name()==="img"&&!!k.hasClass(j)&&k}var h=["img."+j];s.extend(c,p,{_config:function(){this._cls=j;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";this._contextMenu=m;this._flashRules=h}});p.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",b);l.MusicInserter=c;var m={"\u97f3\u4e50\u5c5e\u6027":function(k){var a=k.getSelection();a=(a=a&&a.getStartElement())&&b(a);k=k._toolbars.music;a&&k.show(null,a)}}}();g.addPlugin(function(){new l.MusicInserter(g)})});
KISSY.add("ext-align",function(g){function l(){g.log("align init");this.on("bindUI",this._bindUIAlign,this);this.on("renderUI",this._renderUIAlign,this);this.on("syncUI",this._syncUIAlign,this)}function s(u,p){var j=p.charAt(0),q=p.charAt(1),e,c,b,h;if(u){u=new n(u);e=u.offset();c=u[0].offsetWidth;b=u[0].offsetHeight}else{e={left:v.scrollLeft(),top:v.scrollTop()};c=v.viewportWidth();b=v.viewportHeight()}h=e.left;e=e.top;if(j==="c")e+=b/2;else if(j==="b")e+=b;if(q==="c")h+=c/2;else if(q==="r")h+=c;
return{left:h,top:e}}g.namespace("Ext");var v=g.DOM,n=g.Node;g.mix(l,{TL:"tl",TC:"tc",TR:"tr",CL:"cl",CC:"cc",CR:"cr",BL:"bl",BC:"bc",BR:"br"});l.ATTRS={align:{}};l.prototype={_bindUIAlign:function(){g.log("_bindUIAlign")},_renderUIAlign:function(){g.log("_renderUIAlign")},_syncUIAlign:function(){g.log("_syncUIAlign")},_uiSetAlign:function(u){g.log("_uiSetAlign");g.isPlainObject(u)&&this.align(u.node,u.points,u.offset)},align:function(u,p,j){var q,e=this.get("el");q=v.offset(e);u=s(u,p[0]);p=s(e,
p[1]);p=[p.left-u.left,p.top-u.top];this.set("xy",[q.left-p[0]+ +j[0],q.top-p[1]+ +j[1]])},center:function(u){this.set("align",{node:u,points:[l.CC,l.CC],offset:[0,0]})},__destructor:function(){g.log("align __destructor")}};g.Ext.Align=l});
KISSY.add("ext-box",function(g){function l(){g.log("box init");this.on("renderUI",this._renderUIBoxExt,this);this.on("syncUI",this._syncUIBoxExt,this);this.on("bindUI",this._bindUIBoxExt,this)}g.namespace("Ext");var s=document,v=g.Node;l.ATTRS={el:{setter:function(n){if(g.isString(n))return g.one(n)}},elCls:{},elStyle:{},width:{},height:{},html:{value:false}};l.HTML_PARSER={el:function(n){return n}};l.prototype={_syncUIBoxExt:function(){g.log("_syncUIBoxExt")},_bindUIBoxExt:function(){g.log("_bindUIBoxExt")},
_renderUIBoxExt:function(){g.log("_renderUIBoxExt");var n=this.get("render")||g.one(s.body),u=this.get("el");n=new v(n);if(!u){u=new v("<div>");n.prepend(u);this.set("el",u)}},_uiSetElCls:function(n){g.log("_uiSetElCls");n&&this.get("el").addClass(n)},_uiSetElStyle:function(n){g.log("_uiSetElStyle");n&&this.get("el").css(n)},_uiSetWidth:function(n){g.log("_uiSetWidth");n&&this.get("el").width(n)},_uiSetHeight:function(n){g.log("_uiSetHeight");n&&this.get("el").height(n)},_uiSetHtml:function(n){g.log("_uiSetHtml");
n!==false&&this.get("el").html(n)},__destructor:function(){g.log("box __destructor");var n=this.get("el");if(n){n.detach();n.remove()}}};g.Ext.Box=l});
KISSY.add("ext-overlay-close",function(g){function l(){g.log("close init");this.on("renderUI",this._rendUICloseExt,this);this.on("bindUI",this._bindUICloseExt,this);this.on("syncUI",this._syncUICloseExt,this)}g.namespace("Ext");var s=g.Node;l.ATTRS={closable:{value:true},closeBtn:{}};l.HTML_PARSER={closeBtn:".ks-ext-close"};l.prototype={_syncUICloseExt:function(){g.log("_syncUICloseExt")},_uiSetClosable:function(v){g.log("_uiSetClosable");var n=this.get("closeBtn");if(n)v?n.show():n.hide()},_rendUICloseExt:function(){g.log("_rendUICloseExt");
var v=this.get("closeBtn"),n=this.get("contentEl");if(!v&&n){v=(new s("<a href='#' class='ks-ext-close'><span class='ks-ext-close-x'>X</span></a>")).appendTo(n);this.set("closeBtn",v)}},_bindUICloseExt:function(){g.log("_bindUICloseExt");var v=this,n=v.get("closeBtn");n&&n.on("click",function(u){v.hide();u.halt()})},__destructor:function(){g.log("close-ext __destructor");var v=this.get("closeBtn");v&&v.detach()}};g.Ext.Close=l});
KISSY.add("ext-constrain",function(g){function l(){g.log("constrain init");this.on("bindUI",this._bindUIConstrain,this);this.on("renderUI",this._renderUIConstrain,this);this.on("syncUI",this._syncUIConstrain,this)}function s(u){var p=undefined;if(!u)return p;var j=this.get("el");if(u!==true){u=new n(u);p=u.offset();g.mix(p,{maxLeft:p.left+u[0].offsetWidth-j[0].offsetWidth,maxTop:p.top+u[0].offsetHeight-j[0].offsetHeight})}else{p={left:v.scrollLeft(),top:v.scrollTop()};g.mix(p,{maxLeft:p.left+v.viewportWidth()-
j[0].offsetWidth,maxTop:p.top+v.viewportHeight()-j[0].offsetHeight})}return p}g.namespace("Ext");var v=g.DOM,n=g.Node;l.ATTRS={constrain:{value:false}};l.prototype={_bindUIConstrain:function(){g.log("_bindUIConstrain");var u=this;u.on("beforeXChange",function(p){p=p.newVal;var j=s.call(u,u.get("constrain"));if(j)if(p>=j.maxLeft||p<=j.left)return false});u.on("beforeYChange",function(p){p=p.newVal;var j=s.call(u,u.get("constrain"));if(j)if(p>=j.maxTop||p<=j.top)return false})},_renderUIConstrain:function(){g.log("_renderUIConstrain")},
_syncUIConstrain:function(){g.log("_syncUIConstrain")},_uiSetConstrain:function(){g.log("_uiSetConstrain")},__destructor:function(){g.log("constrain-ext __destructor")}};g.Ext.Constrain=l});
KISSY.add("ext-contentbox",function(g){function l(){g.log("contentbox init");this.on("renderUI",this._renderUIContentBox,this);this.on("syncUI",this._syncUIContentBox,this);this.on("bindUI",this._bindUIContentBox,this)}g.namespace("Ext");var s=g.Node;l.ATTRS={contentEl:{},content:{}};l.HTML_PARSER={contentEl:".ks-contentbox"};l.prototype={_syncUIContentBox:function(){g.log("_syncUIContentBox")},_bindUIContentBox:function(){g.log("_bindUIContentBox")},_renderUIContentBox:function(){g.log("_renderUIContentBox");
var v=this.get("contentEl"),n=this.get("el");if(!v){v=(new s("<div class='ks-contentbox'>")).appendTo(n);this.set("contentEl",v)}},_uiSetContent:function(v){g.log("_uiSetContent");v!==undefined&&this.get("contentEl").html(v)},__destructor:function(){g.log("contentbox __destructor")}};g.Ext.ContentBox=l});
KISSY.add("ext-drag",function(g){function l(){g.log("drag init");this.on("bindUI",this._bindUIDragExt,this);this.on("renderUI",this._renderUIDragExt,this);this.on("syncUIUI",this._syncUIDragExt,this)}g.namespace("Ext");l.ATTRS={handlers:{value:[]},draggable:{value:true}};l.prototype={_uiSetHanlders:function(s){g.log("_uiSetHanlders");s&&s.length>0&&this.__drag.set("handlers",s)},_syncUIDragExt:function(){g.log("_syncUIDragExt")},_renderUIDragExt:function(){g.log("_renderUIDragExt")},_bindUIDragExt:function(){g.log("_bindUIDragExt");
var s=this.get("el");this.__drag=new g.Draggable({node:s,handlers:this.get("handlers")})},_uiSetDraggable:function(s){g.log("_uiSetDraggable");var v=this.__drag;s?v.on("drag",this._dragExtAction,this):v.detach("drag")},_dragExtAction:function(s){this.set("xy",[s.left,s.top])},__destructor:function(){g.log("DragExt __destructor");var s=this.__drag;s&&s.destroy()}};g.Ext.Drag=l});
KISSY.add("ext-loading",function(g){function l(){g.log("LoadingExt init")}g.namespace("Ext");l.prototype={loading:function(){if(!this._loadingExtEl)this._loadingExtEl=(new g.Node("<div class='ks-ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'>")).appendTo(this.get("el"));this._loadingExtEl.show()},unloading:function(){var s=this._loadingExtEl;s&&s.hide()}};g.Ext.Loading=l});
KISSY.add("ext-mask",function(g){function l(){g.log("mask init");this.on("bindUI",this._bindUIMask,this);this.on("renderUI",this._renderUIMask,this);this.on("syncUI",this._syncUIMask,this)}g.namespace("Ext");var s,v=g.UA,n=0;l.ATTRS={mask:{value:false}};l.prototype={_bindUIMask:function(){g.log("_bindUIMask")},_renderUIMask:function(){g.log("_renderUIMask")},_syncUIMask:function(){g.log("_syncUIMask")},_uiSetMask:function(u){g.log("_uiSetMask");if(u){this.on("show",this._maskExtShow,this);this.on("hide",
this._maskExtHide,this)}else{this.detach("show",this._maskExtShow,this);this.detach("hide",this._maskExtHide,this)}},_maskExtShow:function(){if(!s){s=(new g.Node("<div class='ks-ext-mask'>")).prependTo(document.body);s.css({position:"absolute",width:"100%",height:g.DOM.docHeight()});v.ie==6&&s.append("<iframe style='width:100%;height:expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'>")}s.css({"z-index":this.get("zIndex")-1});n++;s.show()},_maskExtHide:function(){n--;if(n<=
0)n=0;n||s&&s.hide()},__destructor:function(){g.log("mask __destructor")}};g.Ext.Mask=l});
KISSY.add("ext-position",function(g){function l(){g.log("position init");this.on("bindUI",this._bindUIPosition,this);this.on("renderUI",this._renderUIPosition,this);this.on("syncUI",this._syncUIPosition,this)}g.namespace("Ext");var s=document,v=g.Event;l.ATTRS={x:{},y:{},xy:{setter:function(n){var u=g.makeArray(n);if(u.length){u[0]&&this.set("x",u[0]);u[1]&&this.set("y",u[1])}return n}},zIndex:{value:9999},visible:{value:undefined}};l.prototype={_syncUIPosition:function(){g.log("_syncUIPosition")},
_renderUIPosition:function(){g.log("_renderUIPosition");this.get("el").addClass("ks-ext-position");this.get("el").css("display","")},_bindUIPosition:function(){g.log("_bindUIPosition")},_uiSetZIndex:function(n){g.log("_uiSetZIndex");n!==undefined&&this.get("el").css("z-index",n)},_uiSetX:function(n){g.log("_uiSetX");n!==undefined&&this.get("el").offset({left:n})},_uiSetY:function(n){g.log("_uiSetY");n!==undefined&&this.get("el").offset({top:n})},_uiSetVisible:function(n){if(n!==undefined){g.log("_uiSetVisible");
this.get("el").css("visibility",n?"visible":"hidden");this[n?"_bindKey":"_unbindKey"]();this.fire(n?"show":"hide")}},_bindKey:function(){v.on(s,"keydown",this._esc,this)},_unbindKey:function(){v.remove(s,"keydown",this._esc,this)},_esc:function(n){n.keyCode===27&&this.hide()},move:function(n,u){if(g.isArray(n)){u=n[1];n=n[0]}this.set("xy",[n,u])},show:function(){this._firstShow()},_firstShow:function(){this.renderer();this._realShow();this._firstShow=this._realShow},_realShow:function(){this.set("visible",
true)},hide:function(){this.set("visible",false)},__destructor:function(){g.log("position __destructor")}};g.Ext.Position=l});
KISSY.add("ext-shim",function(g){function l(){g.log("shim init");this.on("renderUI",this._renderUIShimExt,this);this.on("bindUI",this._bindUIShimExt,this);this.on("syncUI",this._syncUIShimExt,this)}g.namespace("Ext");var s=g.Node;l.prototype={_syncUIShimExt:function(){g.log("_syncUIShimExt")},_bindUIShimExt:function(){g.log("_bindUIShimExt")},_renderUIShimExt:function(){g.log("_renderUIShimExt");var v=this.get("el"),n=new s("<iframe style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth);top: 0;opacity: 0;filter: alpha(opacity=0);left: 0;z-index: -1;height: expression(this.parentNode.offsetHeight);'>");
v.prepend(n)},__destructor:function(){g.log("shim __destructor")}};g.Ext.Shim=l});
KISSY.add("ext-stdmod",function(g){function l(){g.log("stdmod init");this.on("renderUI",this._renderUIStdMod,this);this.on("syncUI",this._syncUIStdMod,this);this.on("bindUI",this._bindUIStdMod,this)}g.namespace("Ext");var s=g.Node;l.ATTRS={header:{},body:{},footer:{},headerContent:{value:false},bodyContent:{value:false},footerContent:{value:false}};l.HTML_PARSER={header:".ks-stdmod-header",body:".ks-stdmod-body",footer:".ks-stdmod-footer"};l.prototype={_bindUIStdMod:function(){g.log("_bindUIStdMod")},
_syncUIStdMod:function(){g.log("_syncUIStdMod")},_setStdModContent:function(v,n){if(n!==false)if(g.isString(n))this.get(v).html(n);else{this.get(v).html("");this.get(v).append(n)}},_uiSetBodyContent:function(v){g.log("_uiSetBodyContent");this._setStdModContent("body",v)},_uiSetHeaderContent:function(v){g.log("_uiSetHeaderContent");this._setStdModContent("header",v)},_uiSetFooterContent:function(v){g.log("_uiSetFooterContent");this._setStdModContent("footer",v)},_renderUIStdMod:function(){g.log("_renderUIStdMod");
var v=this.get("contentEl"),n=this.get("header"),u=this.get("body"),p=this.get("footer");this.get("headerContent");this.get("bodyContent");this.get("footerContent");if(!n){n=(new s("<div class='ks-stdmod-header'>")).appendTo(v);this.set("header",n)}if(!u){u=(new s("<div class='ks-stdmod-body'>")).appendTo(v);this.set("body",u)}if(!p){p=(new s("<div class='ks-stdmod-footer'>")).appendTo(v);this.set("footer",p)}},__destructor:function(){g.log("stdmod __destructor")}};g.Ext.StdMod=l});
KISSY.add("overlay",function(g){var l=g.Base.create([g.Ext.Box,g.Ext.ContentBox,g.Ext.Position,g.Ext.Loading,g.UA.ie==6?g.Ext.Shim:null,g.Ext.Align,g.Ext.Mask],{init:function(){g.log("Overlay init");this.on("bindUI",this._bindUIOverlay,this);this.on("renderUI",this._renderUIOverlay,this);this.on("syncUI",this._syncUIOverlay,this)},_renderUIOverlay:function(){g.log("_renderUIOverlay");this.get("el").addClass("ks-overlay")},_syncUIOverlay:function(){g.log("_syncUIOverlay")},_bindUIOverlay:function(){g.log("_bindUIOverlay")},
destructor:function(){g.log("overlay destructor")}});g.Overlay=l},{requires:["core"]});
KISSY.add("dialog",function(g){g.Dialog=g.Base.create(g.Overlay,[g.Ext.StdMod,g.Ext.Close,g.Ext.Drag,g.Ext.Constrain],{init:function(){g.log("dialog init");this.on("renderUI",this._rendUIDialog,this);this.on("bindUI",this._bindUIDialog,this);this.on("syncUI",this._syncUIDialog,this)},_rendUIDialog:function(){g.log("_rendUIDialog");this.get("el").addClass("ks-dialog");this.set("handlers",[this.get("header")])},_bindUIDialog:function(){g.log("_bindUIDialog")},_syncUIDialog:function(){g.log("_syncUIDialog")},
destructor:function(){g.log("Dialog destructor")}})},{host:"overlay"});
KISSY.Editor.add("ext-focus",function(){function g(){l.log("FocusExt init");this.on("renderUI",this._renderUIFocusExt,this);this.on("bindUI",this._bindUIFocusExt,this);this.on("syncUI",this._syncUIFocusExt,this)}var l=KISSY,s=l.UA,v=l.Editor,n=v.focusManager;v.namespace("Ext");g.ATTRS={focus4e:{value:true}};g.prototype={_uiSetFocus4e:function(u){if(u){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",
this._hide4FocusExt,this)}},_syncUIFocusExt:function(){l.log("_syncUIFocusExt")},_renderUIFocusExt:function(){l.log("_renderUIFocusExt")},_bindUIFocusExt:function(){this._focus4e=(new l.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var u=this._focusEditor=n.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(s.ie&&u){var p=u.document.selection.createRange();
if(p)if(p.item&&p.item(0).ownerDocument==u.document){u=document.body.createTextRange();u.moveToElementText(this.get("el")._4e_first()[0]);u.collapse(true);u.select()}}},_hide4FocusExt:function(){var u=this._focusEditor;u&&u.focus()}};v.Ext.Focus=g},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var g=KISSY,l=g.Editor;if(!l.Overlay){var s=g.Base.create(g.Overlay,[l.Ext.Focus],{init:function(){g.log("Overlay4E init");this.on("syncUI",this._syncUIOverlay4E,this)},_syncUIOverlay4E:function(){g.log("_syncUIOverlay4E");l.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:l.baseZIndex(l.zIndexManager.OVERLAY)}}}),v=g.Base.create(g.Dialog,[l.Ext.Focus],{show:function(){this.center();var u=this.get("y");if(u-g.DOM.scrollTop()>200){u=g.DOM.scrollTop()+
200;this.set("y",u)}v.superclass.show.call(this)}},{ATTRS:{zIndex:{value:l.baseZIndex(l.zIndexManager.OVERLAY)}}});l.Overlay=s;l.Dialog=v;var n;l.Overlay.loading=function(){n||(n=new l.Overlay({x:0,focus4e:false,width:"100%",y:0,zIndex:l.baseZIndex(l.zIndexManager.LOADING),elCls:"ke-global-loading"}));n.set("height",g.DOM.docHeight());n.show();n.loading()};l.Overlay.unloading=function(){n&&n.hide()}}});
KISSY.Editor.add("pagebreak",function(g){var l=KISSY,s=l.Editor,v=g.htmlDataProcessor,n=v&&v.dataFilter,u="ke_pagebreak",p="div";n&&n.addRules({elements:{div:function(j){var q=j.attributes;var e=(q=q&&q.style)&&j.children.length==1&&j.children[0];if((e=e&&e.name=="span"&&e.attributes.style)&&/page-break-after\s*:\s*always/i.test(q)&&/display\s*:\s*none/i.test(e))return v.createFakeParserElement(j,u,p)}}});s.PageBreak||function(){function j(b){var h=new e({container:b.toolBarDiv,title:"\u5206\u9875",contentCls:"ke-toolbar-pagebreak"});
h.on("offClick",function(){var m=new q(c,null,b.document);m=b.createFakeElement?b.createFakeElement(m,u,p,true,c):m;m=(new q("<div>",null,b.document)).append(m);b.insertElement(m)});this.el=h;s.Utils.sourceDisable(b,this)}var q=l.Node,e=s.TripleButton,c='<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>';l.augment(j,{disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.OFF)}});s.PageBreak=j}();g.addPlugin(function(){new s.PageBreak(g)})});
KISSY.Editor.add("preview",function(g){var l=KISSY.Editor,s=KISSY,v=l.TripleButton;l.Preview||function(){function n(u){this.editor=u;this._init()}s.augment(n,{_init:function(){this.el=new v({container:this.editor.toolBarDiv,title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"});this.el.on("offClick",this._show,this)},_show:function(){var u=this.editor,p=640,j=420,q=80;try{var e=window.screen;p=Math.round(e.width*0.8);j=Math.round(e.height*0.7);q=Math.round(e.width*0.1)}catch(c){}u=u._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,
"<body>\n"+u.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");p=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+p+",height="+j+",left="+q);p.document.open();p.document.write(u);p.document.close();p.focus()}});l.Preview=n}();g.addPlugin(function(){new l.Preview(g)})});
KISSY.Editor.add("progressbar",function(){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var l=KISSY,s=l.Editor;if(!s.ProgressBar){var v=l.Node;l.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
g.ATTRS={container:{},width:{},height:{},progress:{value:0}};l.extend(g,l.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var n=this.get("height"),u=new v("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+n+";'></div>"),p=this.get("container");n=(new v("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(n)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(u);var j=(new v("<span class='ke-progressbar-title'>")).appendTo(u);
p&&u.appendTo(p);this.el=u;this._title=j;this._p=n;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(n){n=n.newVal;this._p.css("width",n+"%");this._title.html(n+"%")}});s.ProgressBar=g}});
KISSY.Editor.add("removeformat",function(g){function l(b){this.editor=b;this._init()}function s(b,h){for(var m=0;m<h.length;m++)b.removeAttr(h[m])}var v=KISSY.Editor,n=KISSY,u=v.RANGE,p=v.ElementPath,j=v.NODE,q=v.TripleButton,e="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s",c="class,style,lang,width,height,align,hspace,valign".split(",");e=RegExp("^(?:"+e.replace(/,/g,"|")+")$","i");n.augment(l,{_init:function(){var b=this.editor;this.el=new q({title:"\u6e05\u9664\u683c\u5f0f",
contentCls:"ke-toolbar-removeformat",container:b.toolBarDiv});this.el.on("offClick",this._remove,this);v.Utils.sourceDisable(b,this)},disable:function(){this.el.set("state",q.DISABLED)},enable:function(){this.el.set("state",q.OFF)},_remove:function(){var b=this.editor,h=e;h.lastIndex=0;var m=b.getSelection().getRanges();b.fire("save");for(var k=0,a;a=m[k];k++)if(!a.collapsed){a.enlarge(u.ENLARGE_ELEMENT);var d=a.createBookmark(),f=d.startNode,r=d.endNode,w=function(z){for(var t=new p(z),o=t.elements,
A=1,x;x=o[A];A++){if(x._4e_equals(t.block)||x._4e_equals(t.blockLimit))break;h.test(x._4e_name())&&z._4e_breakParent(x)}};w(f);w(r);for(f=f._4e_nextSourceNode(true,j.NODE_ELEMENT);f;){if(f._4e_equals(r))break;w=f._4e_nextSourceNode(false,j.NODE_ELEMENT);f._4e_name()=="img"&&f.attr("_ke_realelement")||(h.test(f._4e_name())?f._4e_remove(true):s(f,c));f=w}a.moveToBookmark(d)}b.getSelection().selectRanges(m);b.fire("save")}});g.addPlugin(function(){new l(g)})});
KISSY.Editor.add("resize",function(g){var l=KISSY,s=l.Editor,v=l.Node;s.Resizer||function(){function n(p){this.editor=p;this._init()}var u=l.Draggable;l.augment(n,{_init:function(){var p=this.editor,j=p.statusDiv,q=new v("<div class='ke-resizer'></div>"),e=p.cfg.pluginConfig.resize||{};e=e.direction||["x","y"];q.appendTo(j);p.on("maximizeWindow",function(){q.css("display","none")});p.on("restoreWindow",function(){q.css("display","")});j=new u({node:q,handlers:[q]});var c=0,b=0,h=p.wrap,m=p.editorWrap;
j.on("dragstart",function(){c=h.height();b=m.width()});j.on("drag",function(k){var a=k.pageX-this.startMousePos.left;k=k.pageY-this.startMousePos.top;l.inArray("y",e)&&h.height(c+k);l.inArray("x",e)&&m.width(b+a)})}});s.Resizer=n}();g.addPlugin(function(){new s.Resizer(g)})});
KISSY.Editor.add("select",function(){function g(j){g.superclass.constructor.call(this,j);this._init()}var l=KISSY,s=l.Node,v=l.Event,n=l.DOM,u=l.Editor;if(!u.Select){g.DISABLED=0;g.ENABLED=1;var p=u.XHTML_DTD;g.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var j=this.el.parent();j;){var q=j._4e_name();if(p[q]&&p[q].div)return j;j=j.parent()}return new s(document.body)}},state:{value:1}};g.decorate=
function(j){for(var q=j.width(),e=[],c=j.all("option"),b=0;b<c.length;b++){var h=c[b];e.push({name:n.html(h),value:n.attr(h,"value")})}return new g({width:q+"px",el:j,items:e,cls:"ke-combox",value:j.val()})};l.extend(g,l.Base,{_init:function(){var j=this.get("container"),q=this.get("el"),e=new s("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
c=this.get("title")||"",b=this.get("cls"),h=e.one(".ke-select-text"),m=e.one(".ke-select-text-inner");e.one(".ke-select-drop");this.get("value")!==undefined?m.html(this._findNameByV(this.get("value"))):m.html(c);h.css("width",this.get("width"));e._4e_unselectable();c&&e.attr("title",c);b&&e.addClass(b);if(q)q[0].parentNode.replaceChild(e[0],q[0]);else j&&e.appendTo(j);e.on("click",this._click,this);this.el=e;this.title=m;this._focusA=e.one("a.ke-select");u.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(j){var q=this.get("title")||"",e=this.get("items");if(this.get("showValue"))return j||q;for(var c=0;c<e.length;c++){var b=e[c];if(b.value==j){q=b.name;break}}return q},_valueChange:function(j){this.title.html(this._findNameByV(j.newVal))},_itemsChange:function(j){j=j.newVal;var q=this._selectList;q.html("");if(j)for(var e=0;e<j.length;e++){var c=j[e];(new s("<a class='ke-select-menu-item' href='#' data-value='"+
c.value+"'>"+c.name+"</a>",c.attrs)).appendTo(q)._4e_unselectable()}this.as=q.all("a")},val:function(j){if(j!==undefined){this.set("value",j);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var j=this,q=j.el,e=j.get("popUpWidth"),c=j._focusA,b=new u.Overlay({render:j.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:e?e:q.width(),zIndex:u.baseZIndex(u.zIndexManager.SELECT),focusMgr:false}),h=j.get("items");
b.renderer();e=b.get("contentEl").one("div");j.menu=b;v.on(window,"resize",j._resize,j);j.get("title")&&(new s("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+j.get("title")+"</div>")).appendTo(e);j._selectList=(new s("<div>")).appendTo(e);j._itemsChange({newVal:h});b.on("show",function(){c.addClass("ke-select-active")});b.on("hide",function(){c.removeClass("ke-select-active")});v.on([document,j.get("doc")],"click",function(m){q.contains(m.target)||b.hide()});e.on("click",
j._select,j);j.as=j._selectList.all("a");v.on(e[0],"mouseenter",function(){j.as.removeClass("ke-menu-selected")});j.on("afterItemsChange",j._itemsChange,j);j.menuNode=e},_stateChange:function(j){var q=this.el;j.newVal==1?q.removeClass("ke-select-disabled"):q.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(j){j.halt();var q=this.menu,e=this.menuNode;if(j=(new s(j.target))._4e_ascendant(function(h){return e.contains(h)&&
h._4e_name()=="a"},true)){var c=this.get("value"),b=j.attr("data-value");this.set("value",b);this.fire("click",{newVal:b,prevVal:c,name:j.html()});q.hide()}},_real:function(){var j=this.el,q=j.offset(),e=l.clone(q),c=this.menu.get("el").height(),b=this.menu.get("el").width(),h=n.scrollTop(),m=n.scrollLeft(),k=n.viewportHeight(),a=n.viewportWidth();a=m+a-60;k=h+k;var d=q.top+(j.height()-2);j=q.left+j.width()-2;var f=this.get("align"),r=f[0];if(f[1]=="b"){q.top=d;if(q.top+c>k&&e.top-h>k-d)q.top=e.top-
c}else{q.top=e.top-c;if(q.top<h&&e.top-h<k-d)q.top=d}if(r=="l"){if(q.left+b>a&&j-m>a-e.left)q.left=j-b}else{q.left=j-b;if(q.left<m&&j-m<a-e.left)q.left=e.left}this.menu.set("xy",[q.left,q.top]);this.menu.show()},_click:function(j){j.preventDefault();j=this.el;var q=this.get("value");if(!j.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();q&&this.menu&&this.as.each(function(e){e.attr("data-value")==q?e.addClass("ke-menu-selected"):e.removeClass("ke-menu-selected")})}}});
u.Select=g}});KISSY.Editor.add("separator",function(g){g.addPlugin(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(g.toolBarDiv)})});
KISSY.Editor.add("smiley",function(g){var l=KISSY.Editor,s=KISSY,v=s.DOM,n=s.Event,u=s.Node,p=l.Overlay,j=l.TripleButton;l.Smiley||function(){function q(b){this.editor=b;this._init()}v.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");
for(var e="<div class='ke-smiley-sprite'>",c=0;c<=98;c++)e+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+c+".gif'></a>";e+="</div>";s.augment(q,{_init:function(){var b=this.editor;this.el=new j({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",container:b.toolBarDiv});this.el.on("offClick onClick",this._show,this);l.Utils.lazyRun(this,"_prepare","_real");l.Utils.sourceDisable(b,this)},disable:function(){this.el.set("state",j.DISABLED)},enable:function(){this.el.set("state",j.OFF)},
_hidePanel:function(b){var h=this.el.el;b=b.target;var m=this.smileyWin;h._4e_equals(b)||h.contains(b)||m.hide()},_selectSmiley:function(b){b.halt();var h=this.editor;b=b.target;var m;if(v._4e_name(b)=="a"&&(m=v.attr(b,"data-icon"))){m=new u("<img class='ke_smiley'alt='' src='"+m+"'/>",null,h.document);h.insertElement(m);this.smileyWin.hide()}},_prepare:function(){var b=this.el,h=this.editor,m=this.smileyWin=new p({content:e,focus4e:false,width:"297px",elCls:"ks-popup",zIndex:h.baseZIndex(l.zIndexManager.POPUP_MENU),
mask:false});m.renderer();this.smileyPanel=m.get("contentEl");m.on("show",b.bon,b);m.on("hide",b.boff,b);this.smileyPanel.on("click",this._selectSmiley,this);n.on(document,"click",this._hidePanel,this);n.on(h.document,"click",this._hidePanel,this)},_real:function(){var b=this.el.el.offset();b.top+=this.el.el.height()+5;if(b.left+this.smileyPanel.width()>v.viewportWidth()-60)b.left=v.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[b.left,b.top]);this.smileyWin.show()},_show:function(b){var h=
this.smileyWin;h&&h.get("visible")?h.hide():this._prepare(b)}});l.Smiley=q}();g.addPlugin(function(){new l.Smiley(g)})});
KISSY.Editor.add("sourcearea",function(g){var l=KISSY.Editor,s=KISSY,v=l.TripleButton;if(!(s.UA.gecko<1.92)){l.SourceArea||function(){function n(j){this.editor=j;this._init()}var u=l.SOURCE_MODE,p=l.WYSIWYG_MODE;s.augment(n,{_init:function(){var j=this.editor;var q=this.el=new v({container:j.toolBarDiv,title:"\u6e90\u7801",contentCls:"ke-toolbar-source"});q.on("offClick",this._show,this);q.on("onClick",this._hide,this);j.on("sourcemode",function(){q.bon()});j.on("wysiwygmode",function(){q.boff()})},_show:function(){this.editor.execCommand("sourceAreaSupport",
u);this.el.bon()},_hide:function(){var j=this.el;this.editor.execCommand("sourceAreaSupport",p);j.boff()}});l.SourceArea=n}();g.addPlugin(function(){new l.SourceArea(g)})}});
KISSY.Editor.add("sourcearea/support",function(g){var l=KISSY,s=l.Editor,v=l.UA;s.SourceAreaSupport||function(){function n(){var j=this.mapper={};j[u]=this._show;j[p]=this._hide}var u=s.SOURCE_MODE,p=s.WYSIWYG_MODE;l.augment(n,{exec:function(j,q){var e=this.mapper;e[q]&&e[q].call(this,j)},_show:function(j){j.textarea.val(j.getData(true));this._showSource(j);j.fire("sourcemode")},_showSource:function(j){var q=j.textarea,e=j.iframe;q.css("display","");e.css("display","none");v.ie<8&&q.css("height",
j.wrap.css("height"));q[0].focus()},_hideSource:function(j){var q=j.textarea;j.iframe.css("display","");q.css("display","none")},_hide:function(j){var q=j.textarea;this._hideSource(j);j.fire("save");j.setData(q.val());j.fire("wysiwygmode");j.fire("save");v.gecko&&j.activateGecko()}});s.SourceAreaSupport=new n}();g.addPlugin(function(){g.addCommand("sourceAreaSupport",s.SourceAreaSupport)})});
KISSY.Editor.add("table",function(g,l){var s=KISSY,v=s.Editor,n=s.Node,u=v.Walker,p=s.UA,j=v.NODE,q=v.TripleButton,e=v.ContextMenu,c=["tr","th","td","tbody","table"],b=s.trim,h;h=(p.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th",
"{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border");var m=g.htmlDataProcessor,k=m&&m.dataFilter;m=m&&m.htmlFilter;k&&k.addRules({elements:{table:function(a){a=a.attributes;var d=a["class"],f=parseInt(a.border,10);if(!f||f<=0)a["class"]=(d||"")+" ke_show_border"}}});m&&m.addRules({elements:{table:function(a){a=a.attributes;var d=a["class"];if(d)a["class"]=b(d.replace("ke_show_border","").replace(/\s{2}/," "))}}});v.TableUI||function(){function a(x){this.editor=x;x._toolbars=
x._toolbars||{};x._toolbars.table=this;this._init()}function d(x){function B(M){if(!(C.length>0))if(M[0].nodeType==j.NODE_ELEMENT&&o.test(M._4e_name())&&!M.data("selected_cell")){M._4e_setMarker(E,"selected_cell",true);C.push(M)}}for(var i=x.createBookmarks(),y=x.getRanges(),C=[],E={},D=0;D<y.length;D++){var F=y[D];if(F.collapsed){F=F.getCommonAncestor();(F=F._4e_ascendant("td",true)||F._4e_ascendant("th",true))&&C.push(F)}else{F=new u(F);var K;for(F.guard=B;K=F.next();)if((K=K.parent())&&o.test(K._4e_name())&&
!K.data("selected_cell")){K._4e_setMarker(E,"selected_cell",true);C.push(K)}}}v.Utils.clearAllMarkers(E);x.selectBookmarks(i);return C}function f(x,B){var i=x.getStartElement()._4e_ascendant("tr");if(i){var y=i._4e_clone(true);y.insertBefore(i);i=(B?y[0]:i[0]).cells;for(y=0;y<i.length;y++){i[y].innerHTML="";p.ie||(new n(i[y]))._4e_appendBogus()}}}function r(x){if(x instanceof v.Selection){var B=d(x),i=B.length;x=[];for(var y,C,E=0;E<i;E++){var D=B[E].parent(),F=D[0].rowIndex;!E&&(y=F-1);x[F]=D;E==
i-1&&(C=F+1)}E=D._4e_ascendant("table");y=new n(C<E[0].rows.length&&E[0].rows[C]||y>0&&E[0].rows[y]||E[0].parentNode);for(E=x.length;E>=0;E--)x[E]&&r(x[E]);return y}else if(x instanceof n){E=x._4e_ascendant("table");E[0].rows.length==1?E._4e_remove():x._4e_remove()}return 0}function w(x,B){var i=x.getStartElement();if(i=i._4e_ascendant("td",true)||i._4e_ascendant("th",true))for(var y=i._4e_ascendant("table"),C=i[0].cellIndex,E=0;E<y[0].rows.length;E++){var D=y[0].rows[E];if(!(D.cells.length<C+1)){i=
new n(D.cells[C].cloneNode(false));p.ie||i._4e_appendBogus();D=new n(D.cells[C]);B?i.insertBefore(D):i.insertAfter(D)}}}function z(x){if(x instanceof v.Selection){var B=d(x),i,y=[];x=B[0]&&B[0]._4e_ascendant("table");var C,E,D;C=0;for(E=B.length;C<E;C++)y.push(B[C][0].cellIndex);y.sort();C=1;for(E=y.length;C<E;C++)if(y[C]-y[C-1]>1){D=y[C-1]+1;break}D||(D=y[0]>0?y[0]-1:y[y.length-1]+1);y=x[0].rows;C=0;for(E=y.length;C<E;C++)if(i=y[C].cells[D])break;i=i?new n(i):x._4e_previous();for(D=B.length-1;D>=
0;D--)B[D]&&z(B[D]);return i}else if(x instanceof n){B=x._4e_ascendant("table");if(!B)return null;i=x[0].cellIndex;for(D=B[0].rows.length-1;D>=0;D--){x=new n(B[0].rows[D]);if(!i&&x[0].cells.length==1)r(x);else x[0].cells[i]&&x[0].removeChild(x[0].cells[i])}}return null}function t(x,B){var i=new v.Range(x[0].ownerDocument);if(!i.moveToElementEditablePosition(x,B?true:l)){i.selectNodeContents(x);i.collapse(B?false:true)}i.select(true)}a.showBorderClassName="ke_show_border";s.augment(a,{_init:function(){var x=
this.editor,B={};this.el=new q({contentCls:"ke-toolbar-table",title:"\u63d2\u5165\u8868\u683c",container:x.toolBarDiv});this.el.on("offClick",this._tableShow,this);for(var i in A)(function(y){B[y]=function(){x.fire("save");A[y](x);x.fire("save")}})(i);e.register({editor:x,rules:c,width:"120px",funcs:B});v.Utils.sourceDisable(x,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_tableShow:function(x,B,i){this.editor.useDialog("table/dialog",function(y){y.show(B,i)})}});var o=/^(?:td|th)$/,
A={"\u8868\u683c\u5c5e\u6027":function(x){var B=x.getSelection(),i=B&&B.getStartElement();if(B=i&&i._4e_ascendant("table",true)){x=x._toolbars.table;i=i._4e_ascendant(function(y){y=y._4e_name();return y=="td"||y=="th"},true);x._tableShow(null,B,i)}},"\u5220\u9664\u8868\u683c":function(x){var B=(x=x.getSelection())&&x.getStartElement();if(B=B&&B._4e_ascendant("table",true)){x.selectElement(B);var i=x.getRanges()[0];i.collapse();x.selectRanges([i]);x=B.parent();x[0].childNodes.length==1&&x._4e_name()!="body"&&x._4e_name()!="td"?x._4e_remove():
B._4e_remove()}},"\u5220\u9664\u884c ":function(x){x=x.getSelection();t(r(x),l)},"\u5220\u9664\u5217 ":function(x){x=x.getSelection();(x=z(x))&&t(x,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(x){x=x.getSelection();f(x,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(x){x=x.getSelection();f(x,l)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(x){x=x.getSelection();w(x,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(x){x=x.getSelection();w(x,l)}};v.TableUI=a}();g.addPlugin(function(){new v.TableUI(g);g.addCustomStyle(h)})});
KISSY.Editor.add("tabs",function(){function g(u){this.cfg=u;this._init()}var l=KISSY,s=l.Editor,v=l.DOM,n=l.Node;if(!s.Tabs){l.augment(g,l.EventTarget,{_init:function(){var u=this,p=u.cfg,j=p.tabs,q=p.contents.children("div"),e=j.children("li");j.on("click",function(c){c=new n(c.target);if(c=c._4e_ascendant(function(h){return h._4e_name()==="li"&&j.contains(h)},true)){e.removeClass("ke-tab-selected");var b=c.attr("rel");c.addClass("ke-tab-selected");q.hide();v.show(q[l.indexOf(c[0],e)]);u.fire(b)}})},
getTab:function(u){var p=this.cfg,j=p.tabs;p=p.contents.children("div");j=j.children("li");for(var q=0;q<j.length;q++){var e=new n(j[q]),c=new n(p[q]);if(l.isNumber(u)&&u==q||l.isString(u)&&u==e.attr("rel"))return{tab:e,content:c}}},remove:function(u){u=this.getTab(u);u.tab.remove();u.content.remove()},_getActivate:function(){var u=this.cfg,p=u.tabs;u.contents.children("div");u=p.children("li");for(p=0;p<u.length;p++){var j=new n(u[p]);if(j.hasClass("ke-tab-selected"))return j.attr("rel")}},activate:function(u){if(arguments.length==
0)return this._getActivate();var p=this.cfg,j=p.tabs;p=p.contents.children("div");j.children("li").removeClass("ke-tab-selected");p.hide();j=this.getTab(u);j.tab.addClass("ke-tab-selected");j.content.show()}});s.Tabs=g}});
KISSY.Editor.add("templates",function(g){var l=KISSY.Editor,s=KISSY,v=s.Node,n=s.DOM,u=l.TripleButton,p=l.Dialog;l.TplUI||function(){function j(q){this.editor=q;this._init()}n.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");
s.augment(j,{_init:function(){var q=this.editor,e=new u({container:q.toolBarDiv,contentCls:"ke-toolbar-template",title:"\u6a21\u677f"});e.on("offClick",this._show,this);l.Utils.lazyRun(this,"_prepare","_real");this.el=e;l.Utils.sourceDisable(q,this)},disable:function(){this.el.set("state",u.DISABLED)},enable:function(){this.el.set("state",u.OFF)},_prepare:function(){for(var q=this.editor,e=q.cfg.pluginConfig.templates||[],c="<div class='ke-tpl'>",b=0;b<e.length;b++)c+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+
e[b].demo+"</a>";c+="</div>";this._initDialogOk=true;var h=new p({width:500,mask:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:c});h.renderer();h.get("el").all(".ke-tpl-list").on("click",function(m){m.halt();m=(new v(m.target))._4e_index();m!=-1&&q.insertHtml(e[m].html);h.hide()});this.ui=h},_real:function(){this.ui.show()},_show:function(){this._prepare()}});l.TplUI=j}();g.addPlugin(function(){new l.TplUI(g)})});
KISSY.Editor.add("undo",function(g){var l=KISSY,s=l.Editor,v=s.Utils.arrayCompare,n=l.UA,u=l.Event;s.UndoManager||function(){function p(m){var k=m._getRawData();m=k&&m.getSelection();this.contents=k;this.bookmarks=m&&m.createBookmarks2(true)}function j(m){this.history=[];this.index=-1;this.editor=m;this.bufferRunner=s.Utils.buffer(this.save,this,500);this._init()}function q(m,k,a,d){this.editor=m;this.title=a;this.text=k;this.contentCls=d;this._init()}l.augment(p,{equals:function(m){if(this.contents!=
m.contents)return false;var k=this.bookmarks;m=m.bookmarks;if(k||m){if(!k||!m||k.length!=m.length)return false;for(var a=0;a<k.length;a++){var d=k[a],f=m[a];if(d.startOffset!=f.startOffset||d.endOffset!=f.endOffset||!v(d.start,f.start)||!v(d.end,f.end))return false}}return true}});var e={16:1,17:1,18:1},c={37:1,38:1,39:1,40:1,33:1,34:1};l.augment(j,{_keyMonitor:function(){var m=this.editor;u.on([m.document,m.textarea],"keydown",function(k){var a=k.keyCode;if(!(a in c||a in e))if(a===90&&(k.ctrlKey||
k.metaKey)){m.fire("restore",{d:-1});k.halt()}else if(a===89&&(k.ctrlKey||k.metaKey)){m.fire("restore",{d:1});k.halt()}else m.fire("save",{buffer:1})})},_init:function(){var m=this,k=m.editor;k.on("save",function(a){if(k.getMode()==s.WYSIWYG_MODE)a.buffer?m.bufferRunner():m.save()});k.on("restore",function(a){k.getMode()==s.WYSIWYG_MODE&&m.restore(a)});m._keyMonitor()},save:function(){var m=this.history,k=this.index;m.length>k+1&&m.splice(k+1,m.length-k-1);var a=this.editor;k=m[m.length-1];var d=
new p(a);if(!k||!k.equals(d)){m.length===30&&m.shift();m.push(d);this.index=k=m.length-1;a.fire("afterSave",{history:m,index:k})}},restore:function(m){m=m.d;var k=this.history,a=this.editor,d=k[this.index+m];if(d){a._setRawData(d.contents);if(d.bookmarks)a.getSelection().selectBookmarks(d.bookmarks);else if(n.ie){d=a.document.body.createTextRange();d.collapse(true);d.select()}(d=a.getSelection())&&d.scrollIntoView();this.index+=m;a.fire("afterRestore",{history:k,index:this.index});a.notifySelectionChange()}}});
var b=s.TripleButton,h={redo:1,undo:-1};l.augment(q,{_init:function(){var m=this,k=m.editor;m.el=new b({contentCls:m.contentCls,title:m.title,container:k.toolBarDiv});var a=m.el;a.set("state",b.DISABLED);k.on("afterSave afterRestore",m._respond,m);a.on("offClick",function(){k.fire("restore",{d:h[m.text]})});s.Utils.sourceDisable(k,m)},disable:function(){this._saveState=this.el.get("state");this.el.set("state",b.DISABLED)},enable:function(){this.el.set("state",this._saveState)},_respond:function(m){this.updateUI(m.history,
m.index)},updateUI:function(m,k){var a=this.el,d=this.text;if(d=="undo")k>0?a.set("state",b.OFF):a.set("state",b.DISABLED);else if(d=="redo")k<m.length-1?a.set("state",b.OFF):a.set("state",b.DISABLED)}});s.UndoManager=j;s.RestoreUI=q}();g.addPlugin(function(){new s.UndoManager(g);new s.RestoreUI(g,"undo","\u64a4\u9500","ke-toolbar-undo");new s.RestoreUI(g,"redo","\u91cd\u505a","ke-toolbar-redo")})});
