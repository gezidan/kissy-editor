/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-30 14:09:47
*/
KISSY.add("editor",function(g,p){function s(l,b){function e(x){for(var u=s.Env.mods,r=0;r<x.length;r++){for(var A=x[r],B=n,C=0;C<r;C++)if(A==x[C]){B=q;break}C=u[A];if(B&&C){B=g.clone(C);A=A+"_"+r;B.name=A;x[r]=A;u[A]||(u[A]=B)}}}var h=this;if(!(h instanceof s))return new s(l,b);if(g.isString(l))l=g.one(l);l=m._4e_wrap(l);b=b||{};b.pluginConfig=b.pluginConfig||{};h.cfg=b;b.pluginConfig=b.pluginConfig;h.cfg=b;g.app(h,g.EventTarget);var t=["htmldataprocessor","enterkey","clipboard"],y=n;h.use=function(x,
u){x=x.split(",");e(x);if(!y)for(var r=0;r<t.length;r++){var A=t[r];g.inArray(A,x)||x.unshift(A)}g.use.call(h,x.join(","),function(){h.ready(function(){u&&u.call(h);if(!y){h.setData(l.val());if(b.focus)h.focus();else{var B=h.getSelection();B&&B.removeAllRanges()}h.fire("save");y=q}})},{order:q,global:s});return h};h.use=h.use;h.init(l);return h}function o(l){var b=g.Config.debug;l=b?b==="dev"?"../src/"+l:l:l.replace(/\.(js|css)/i,"-min.$1");l+=l.indexOf("?")!=-1?"&":"?";l+="t="+encodeURIComponent("2010-11-30 14:09:47");
return l}var m=g.DOM,q=true,n=false;g.app(s,g.EventTarget);s.Config.base=g.Config.base+"editor/";var j=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport",requires:["overlay"]},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},
"flash/dialog",{name:"flash/support",requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},
"preview","removeformat","smiley",{name:"smiley/support",requires:["overlay"]},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],k,c,d,f,i={};k=0;for(c=j.length;k<c;k++){d=j[k];if(g.isString(d))d=j[k]={name:d+"",requires:null};f=d.requires||[];var w=["button"];d.name.indexOf("/dialog")!=-1&&w.push("overlay");d.requires=f.concat(w)}j=["uibase",
{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button",requires:["uibase"]},"dd","progressbar",{name:"overlay",requires:["dd","uibase"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(j);k=0;for(c=j.length;k<c;k++){d=j[k];f=d.name;i[f]={attach:n,charset:"utf-8",requires:d.requires,csspath:d.useCss?o("plugins/"+f+"/plugin.css"):p,path:o("plugins/"+f+"/plugin.js")}}s.add(i);g.Editor=s;g.Editor=s});
KISSY.Editor.add("utils",function(g){var p=null,s=KISSY,o=s.Node,m=s.DOM,q=s.UA,n=s.Event,j;j=q.ie?document.documentMode||q.ie:void 0;var k={debugUrl:function(c){var d=s.Config.debug;c=d?d==="dev"?"../src/"+c:c:c.replace(/\.(js|css)/i,"-min.$1");c+=c.indexOf("?")!=-1?"&":"?";c+="t="+encodeURIComponent("2010-11-30 14:09:47");return c},lazyRun:function(c,d,f){var i=c[d],w=c[f];c[d]=function(){i.apply(this,arguments);c[d]=c[f];return w.apply(this,arguments)}},getXY:function(c,d,f,i){f=f.defaultView||
f.parentWindow;c-=m.scrollLeft(f);d-=m.scrollTop(f);if(i)if(f!=(i.defaultView||i.parentWindow)&&f.frameElement){i=m._4e_getOffset(f.frameElement,i);c+=i.left;d+=i.top}return{left:c,top:d}},tryThese:function(){for(var c,d=0,f=arguments.length;d<f;d++){var i=arguments[d];try{c=i();break}catch(w){}}return c},arrayCompare:function(c,d){if(!c&&!d)return true;if(!c||!d||c.length!=d.length)return false;for(var f=0;f<c.length;f++)if(c[f]!==d[f])return false;return true},getByAddress:function(c,d,f){c=c.documentElement;
for(var i=0;c&&i<d.length;i++){var w=d[i];if(f)for(var l=-1,b=0;b<c.childNodes.length;b++){var e=c.childNodes[b];if(!(f===true&&e.nodeType==3&&e.previousSibling&&e.previousSibling.nodeType==3)){l++;if(l==w){c=e;break}}}else c=c.childNodes[w]}return c?new o(c):p},clearAllMarkers:function(c){for(var d in c)c[d]._4e_clearMarkers(c,true)},htmlEncodeAttr:function(c){return c.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(c){return c.replace(/^\s+/,"")},rtrim:function(c){return c.replace(/\s+$/,
"")},trim:function(c){return this.ltrim(this.rtrim(c))},mix:function(){for(var c={},d=0;d<arguments.length;d++)c=s.mix(c,arguments[d]);return c},isCustomDomain:function(){if(!q.ie)return false;var c=document.domain,d=window.location.hostname;return c!=d&&c!="["+d+"]"},duplicateStr:function(c,d){return Array(d+1).join(c)},throttle:function(c,d,f){f=f||150;if(f===-1)return function(){c.apply(d,arguments)};var i=(new Date).getTime();return function(){var w=(new Date).getTime();if(w-i>f){i=w;c.apply(d,
arguments)}}},buffer:function(c,d,f){f=f||0;var i=p;return function(){i&&clearTimeout(i);var w=arguments;i=setTimeout(function(){return c.apply(d,w)},f)}},isNumber:function(c){return/^\d+(.\d+)?$/.test(s.trim(c))},verifyInputs:function(c){for(var d=0;d<c.length;d++){var f=m._4e_wrap(c[d]),i=s.trim(f.val()),w=f.attr("data-verify");f=f.attr("data-warning");if(w&&!RegExp(w).test(i)){alert(f);return false}}return true},sourceDisable:function(c,d){c.on("sourcemode",d.disable,d);c.on("wysiwygmode",d.enable,
d)},resetInput:function(c){var d=c.attr("placeholder");if(d&&!q.webkit){c.addClass("ke-input-tip");c.val(d)}else q.webkit&&c.val("")},valInput:function(c,d){c.removeClass("ke-input-tip");c.val(d)},placeholder:function(c,d){c.attr("placeholder",d);if(!q.webkit){c.on("blur",function(){if(!s.trim(c.val())){c.addClass("ke-input-tip");c.val(d)}});c.on("focus",function(){c.removeClass("ke-input-tip");s.trim(c.val())==d&&c.val("")})}},clean:function(c){c=c[0]||c;for(var d=s.makeArray(c.childNodes),f=0;f<
d.length;f++){var i=d[f];i.nodeType==g.NODE.NODE_TEXT&&!s.trim(i.nodeValue)&&c.removeChild(i)}},htmlEncode:function(c){return!c?c:String(c).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(c){return!c?c:String(c).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(c,d){return c.toLowerCase()==d.toLowerCase()},normParams:function(c){c=s.clone(c);for(var d in c)if(c.hasOwnProperty(d)){var f=
c[d];if(s.isFunction(f))c[d]=f()}return c},doFormUpload:function(c,d,f){function i(){var y={responseText:"",responseXML:p};y.argument=c?c.argument:p;try{var x;if((x=q.ie?l.contentWindow.document:l.contentDocument||window.frames[w].document)&&x.body)y.responseText=x.body.innerHTML;y.responseXML=x&&x.XMLDocument?x.XMLDocument:x}catch(u){s.log(u)}n.remove(l,"load",i);c.callback&&c.callback(y);setTimeout(function(){m._4e_remove(l)},100)}var w=s.guid("form-upload-"),l=document.createElement("iframe");
l.id=w;l.name=w;l.className="ke-hidden";var b="document.open();"+(k.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(q.ie)l.src=q.ie?"javascript:void(function(){"+encodeURIComponent(b)+"}())":"";s.log("doFormUpload : "+l.src);document.body.appendChild(l);if(q.ie)document.frames[w].name=w;b=m._4e_unwrap(c.form);var e={target:b.target,method:b.method,encoding:b.encoding,enctype:b.enctype,action:b.action};b.target=w;b.method="POST";b.enctype=b.encoding="multipart/form-data";
if(f)b.action=f;var h;if(d){h=[];d=g.Utils.normParams(d);for(var t in d)if(d.hasOwnProperty(t)){f=document.createElement("input");f.type="hidden";f.name=t;f.value=d[t];b.appendChild(f);h.push(f)}}n.on(l,"load",i);b.submit();b.target=e.target;b.method=e.method;b.enctype=e.enctype;b.encoding=e.encoding;b.action=e.action;if(h){d=0;for(t=h.length;d<t;d++)m._4e_remove(h[d])}return l},extern:function(c,d){for(var f in d)c[f]=d[f]},map:function(c,d){for(var f=0;f<c.length;f++)c[f]=d(c[f]);return c},ieEngine:j,
preventFocus:function(c){q.ie?c._4e_unselectable():c.attr("onmousedown","return false;")},isFlashEmbed:function(c){c=c.attributes;return c.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(c.src||"")}};g.Utils=k;g.Utils=k;k.extern(k,{debugUrl:k.debugUrl,lazyRun:k.lazyRun,getXY:k.getXY,tryThese:k.tryThese,arrayCompare:k.arrayCompare,getByAddress:k.getByAddress,clearAllMarkers:k.clearAllMarkers,htmlEncodeAttr:k.htmlEncodeAttr,ltrim:k.ltrim,rtrim:k.rtrim,trim:k.trim,mix:k.mix,isCustomDomain:k.isCustomDomain,
duplicateStr:k.duplicateStr,buffer:k.buffer,isNumber:k.isNumber,verifyInputs:k.verifyInputs,sourceDisable:k.sourceDisable,resetInput:k.resetInput,placeholder:k.placeholder,clean:k.clean,htmlEncode:k.htmlEncode,htmlDecode:k.htmlDecode,equalsIgnoreCase:k.equalsIgnoreCase,normParams:k.normParams,throttle:k.throttle,doFormUpload:k.doFormUpload,map:k.map})});
KISSY.Editor.add("dom",function(g){function p(b){return b.replace(/-(\w)/g,function(e,h){return h.toUpperCase()})}var s=KISSY,o=s.DOM,m=s.UA,q=s.Node,n=g.Utils,j={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};g.NODE=g.NODE;g.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};g.POSITION=g.POSITION;var k=g.NODE,c=g.POSITION,d={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},f={hr:1},i=function(b){return b[0]||b},w=function(b){if(b&&!b[0])return new q(b);return b},l={_4e_wrap:w,_4e_unwrap:i,_4e_equals:function(b,e){if(!b&&!e)return true;if(!b||!e)return false;b=i(b);e=i(e);
return b===e},_4e_isBlockBoundary:function(b,e){b=w(b);var h=s.mix(s.mix({},f),e||{});return d[b.css("display")]||h[b._4e_name()]},_4e_getWin:function(b){return b&&"scrollTo"in b&&b.document?b:b&&b.nodeType===9?b.defaultView||b.parentWindow:false},_4e_index:function(b){b=i(b);for(var e=b.parentNode.childNodes,h=0;h<e.length;h++)if(e[h]===b)return h;return-1},_4e_first:function(b,e){b=i(b);var h=b.firstChild;if((h=h&&new q(h))&&e&&!e(h))h=h._4e_next(e);return h},_4e_move:function(b,e,h){b=i(b);o._4e_remove(b);
e=i(e);h?e.insertBefore(b,e.firstChild):e.appendChild(b)},_4e_name:function(b){b=i(b);var e=b.nodeName.toLowerCase();if(m.ie)if((b=b.scopeName)&&b!="HTML")e=b.toLowerCase()+":"+e;return e},_4e_isIdentical:function(b,e){if(b._4e_name()!=e._4e_name())return false;var h=b[0].attributes,t=e[0].attributes,y=h.length,x=t.length;if(y!=x)return false;for(var u=0;u<y;u++){var r=h[u],A=r.name;if(r.specified&&b.attr(A)!=e.attr(A))return false}if(n.ieEngine<8)for(u=0;u<x;u++){r=t[u];A=r.name;if(r.specified&&
b.attr(A)!=e.attr(A))return false}return true},_4e_isEmptyInlineRemoveable:function(b){b=i(b).childNodes;for(var e=0,h=b.length;e<h;e++){var t=b[e],y=t.nodeType;if(!(y==k.NODE_ELEMENT&&t.getAttribute("_ke_bookmark")))if(y==k.NODE_ELEMENT&&!l._4e_isEmptyInlineRemoveable(t)||y==k.NODE_TEXT&&s.trim(t.nodeValue))return false}return true},_4e_moveChildren:function(b,e,h){b=i(b);e=e[0]||e;if(b!=e)if(h)for(;h=b.lastChild;)e.insertBefore(b.removeChild(h),e.firstChild);else for(;h=b.firstChild;)e.appendChild(b.removeChild(h))},
_4e_mergeSiblings:function(){function b(e,h,t){if(h[0]&&h[0].nodeType==k.NODE_ELEMENT){for(var y=[];h.attr("_ke_bookmark")||h._4e_isEmptyInlineRemoveable();){y.push(h);h=t?new q(h[0].nextSibling):new q(h[0].previousSibling);if(!h[0]||h[0].nodeType!=k.NODE_ELEMENT)return}if(e._4e_isIdentical(h)){for(var x=t?e[0].lastChild:e[0].firstChild;y.length;)y.shift()._4e_move(e,!t);h._4e_moveChildren(e,!t);h._4e_remove();x[0]&&x[0].nodeType==k.NODE_ELEMENT&&x._4e_mergeSiblings()}}}return function(e){if(e[0])if(j[e._4e_name()]||
e._4e_name()=="a"){b(e,new q(e[0].nextSibling),true);b(e,new q(e[0].previousSibling))}}}(),_4e_unselectable:m.gecko?function(b){b=i(b);b.style.MozUserSelect="none"}:m.webkit?function(b){b=i(b);b.style.KhtmlUserSelect="none"}:function(b){b=i(b);if(m.ie||m.opera){var e=0;b.unselectable="on";for(var h=b.getElementsByTagName("*");b=h[e++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},_4e_getOffset:function(b,e){b=i(b);var h,
t=0;h=0;var y=b.ownerDocument.defaultView||b.ownerDocument.parentWindow,x=b.ownerDocument,u=x.documentElement;e=e||x;if(b.getBoundingClientRect){if(b!==x.body&&u!==b){h=b.getBoundingClientRect();t=h.left+(e===x?o.scrollLeft(y):0);h=h.top+(e===x?o.scrollTop(y):0)}if(e)if(y!=(e.defaultView||e.parentWindow)&&y.frameElement){y=l._4e_getOffset(y.frameElement,e);t+=y.left;h+=y.top}}return{left:t,top:h}},_4e_getFrameDocument:function(b){return(b=i(b))&&b.contentWindow.document},_4e_splitText:function(b,
e){b=i(b);var h=b.ownerDocument;if(!(!b||b.nodeType!=k.NODE_TEXT)){if(m.ie&&e==b.nodeValue.length){var t=h.createTextNode("");o.insertAfter(t,b);return new q(t)}t=new q(b.splitText(e));if(h.documentMode){h=h.createTextNode("");o.insertAfter(h,t[0]);o._4e_remove(h)}return t}},_4e_parents:function(b,e){b=w(b);var h=[];do h[e?"push":"unshift"](b);while(b=b.parent());return h},_4e_clone:function(b,e,h){b=i(b);b=b.cloneNode(e);if(!h){var t=function(y){if(y.nodeType==k.NODE_ELEMENT){y.removeAttribute("id");
y=y.childNodes;for(var x=0;x<y.length;x++)t(y[x])}};t(b)}return new q(b)},_4e_nextSourceNode:function(b,e,h,t){b=i(b);if(t&&!t.call){var y=t[0]||t;t=function(u){u=u[0]||u;return u!==y}}e=!e&&b.firstChild;var x=new q(b);if(!e){if(b.nodeType==k.NODE_ELEMENT&&t&&t(b,true)===false)return null;e=b.nextSibling}for(;!e&&(x=x.parent());){if(t&&t(x,true)===false)return null;e=x[0].nextSibling}if(!e)return null;e=o._4e_wrap(e);if(t&&t(e)===false)return null;if(h&&h!=e[0].nodeType)return e._4e_nextSourceNode(false,
h,t);return e},_4e_previousSourceNode:function(b,e,h,t){b=i(b);if(t&&!t.call){var y=t[0]||t;t=function(u){u=u[0]||u;return u!==y}}e=!e&&b.lastChild;var x=new q(b);if(!e){if(b.nodeType==k.NODE_ELEMENT&&t&&t(b,true)===false)return null;e=b.previousSibling}for(;!e&&(x=x.parent());){if(t&&t(x,true)===false)return null;e=x[0].previousSibling}if(!e)return null;e=o._4e_wrap(e);if(t&&t(e)===false)return null;if(h&&e[0].nodeType!=h)return e._4e_previousSourceNode(false,h,t);return e},_4e_commonAncestor:function(b,
e){if(b._4e_equals(e))return b;if(e[0].nodeType!=k.NODE_TEXT&&e.contains(b))return e;var h=b[0].nodeType==k.NODE_TEXT?b.parent():b;do if(h[0].nodeType!=k.NODE_TEXT&&h.contains(e))return h;while(h=h.parent());return null},_4e_ascendant:function(b,e,h){b=i(b);if(!h)b=b.parentNode;if(e&&!s.isFunction(e)){var t=e;e=function(y){return y._4e_name()==t}}for(;b&&b.nodeType!=9;){if(!e||e(new q(b))===true)return new q(b);b=b.parentNode}return null},_4e_hasAttribute:n.ieEngine<9?function(b,e){b=i(b);var h=b.attributes[e];
return!!(h&&h.specified)}:function(b,e){b=i(b);return b.hasAttribute(e)},_4e_hasAttributes:n.ieEngine<9?function(b){b=i(b);for(var e=b.attributes,h=0;h<e.length;h++){var t=e[h];switch(t.name){case "class":if(b.getAttribute("class"))return true;break;default:if(t.specified)return true}}return false}:function(b){b=i(b);m.gecko&&b.removeAttribute("_moz_dirty");return b.hasAttributes()},_4e_position:function(b,e){var h=i(b),t=i(e);if(h.compareDocumentPosition)return h.compareDocumentPosition(t);if(h==
t)return c.POSITION_IDENTICAL;if(h.nodeType==k.NODE_ELEMENT&&t.nodeType==k.NODE_ELEMENT){if(h.contains){if(h.contains(t))return c.POSITION_CONTAINS+c.POSITION_PRECEDING;if(t.contains(h))return c.POSITION_IS_CONTAINED+c.POSITION_FOLLOWING}if("sourceIndex"in h)return h.sourceIndex<0||t.sourceIndex<0?c.POSITION_DISCONNECTED:h.sourceIndex<t.sourceIndex?c.POSITION_PRECEDING:c.POSITION_FOLLOWING}h=b._4e_address();t=e._4e_address();for(var y=Math.min(h.length,t.length),x=0;x<=y-1;x++)if(h[x]!=t[x]){if(x<
y)return h[x]<t[x]?c.POSITION_PRECEDING:c.POSITION_FOLLOWING;break}return h.length<t.length?c.POSITION_CONTAINS+c.POSITION_PRECEDING:c.POSITION_IS_CONTAINED+c.POSITION_FOLLOWING},_4e_address:function(b,e){b=i(b);for(var h=[],t=b.ownerDocument.documentElement,y=b;y&&y!=t;){var x=y.parentNode,u=-1;if(x){for(var r=0;r<x.childNodes.length;r++){var A=x.childNodes[r];if(!(e&&A.nodeType==3&&A.previousSibling&&A.previousSibling.nodeType==3)){u++;if(A==y)break}}h.unshift(u)}y=x}return h},_4e_breakParent:function(b,
e){var h=new g.Range(b[0].ownerDocument);h.setStartAfter(b);h.setEndAfter(e);var t=h.extractContents();h.insertNode(b._4e_remove());b[0].parentNode.insertBefore(t,b[0].nextSibling)},_4e_style:function(b,e,h){b=w(b);if(h!==undefined)return b.css(e,h);b=i(b);return b.style[p(e)]},_4e_remove:function(b,e){var h=i(b),t=h.parentNode;if(t){if(e)for(var y;y=h.firstChild;)t.insertBefore(h.removeChild(y),h);t.removeChild(h)}return b},_4e_trim:function(b){o._4e_ltrim(b);o._4e_rtrim(b)},_4e_ltrim:function(b){b=
i(b);for(var e;e=b.firstChild;){if(e.nodeType==k.NODE_TEXT){var h=n.ltrim(e.nodeValue),t=e.nodeValue.length;if(h){if(h.length<t){(new q(e))._4e_splitText(t-h.length);b.removeChild(b.firstChild)}}else{b.removeChild(e);continue}}break}},_4e_rtrim:function(b){b=i(b);for(var e;e=b.lastChild;){if(e.type==k.NODE_TEXT){var h=n.rtrim(e.nodeValue),t=e.nodeValue.length;if(h){if(h.length<t){(new q(e))._4e_splitText(h.length);b.removeChild(b.lastChild)}}else{b.removeChild(e);continue}}break}if(!m.ie&&!m.opera)(e=
b.lastChild)&&e.nodeType==1&&e.nodeName.toLowerCase()=="br"&&e.parentNode.removeChild(e)},_4e_appendBogus:function(b){b=i(b);for(var e=b.lastChild;e&&e.nodeType==k.NODE_TEXT&&!s.trim(e.nodeValue);)e=e.previousSibling;if(!e||e.nodeType==k.NODE_TEXT||o._4e_name(e)!=="br"){e=m.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br");m.gecko&&e.setAttribute("type","_moz");b.appendChild(e)}},_4e_previous:function(b,e){var h=i(b),t;do t=(h=h.previousSibling)&&new q(h);while(t&&e&&!e(t));
return t},_4e_last:function(b,e){b=o._4e_wrap(b);var h=b[0].lastChild;if((h=h&&new q(h))&&e&&!e(h))h=h._4e_previous(e);return h},_4e_next:function(b,e){var h=i(b),t;do t=(h=h.nextSibling)&&new q(h);while(t&&e&&!e(t));return t},_4e_outerHtml:function(b){b=i(b);if(b.outerHTML)return b.outerHTML.replace(/<\?[^>]*>/,"");var e=b.ownerDocument.createElement("div");e.appendChild(b.cloneNode(true));return e.innerHTML},_4e_setMarker:function(b,e,h,t){b=o._4e_wrap(b);var y=b.data("list_marker_id")||b.data("list_marker_id",
s.guid()).data("list_marker_id"),x=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");e[y]=b;x[h]=1;return b.data(h,t)},_4e_clearMarkers:function(b,e,h){b=w(b);var t=b.data("list_marker_names"),y=b.data("list_marker_id"),x;for(x in t)b.removeData(x);b.removeData("list_marker_names");if(h){b.removeData("list_marker_id");delete e[y]}},_4e_copyAttributes:function(b,e,h){b=i(b);e=w(e);var t=b.attributes;h=h||{};for(var y=0;y<t.length;y++){var x=t[y],u=x.name.toLowerCase(),
r;if(!(u in h))if(u=="checked"&&(r=o.attr(b,u)))e.attr(u,r);else if(x.specified||m.ie&&x.value&&u=="value"){r=o.attr(b,u);if(r===null)r=x.nodeValue;e.attr(u,r)}}if(b.style.cssText!=="")e[0].style.cssText=b.style.cssText},_4e_isEditable:function(b){b=o._4e_name(b);var e=g.XHTML_DTD;return(b=!e.$nonEditable[b]&&(e[b]||e.span))&&b["#"]},_4e_scrollIntoView:function(b){b=w(b);var e=b[0].ownerDocument,h=o.scrollLeft(e),t=o.scrollTop(e),y=b.offset(),x=y.left;y=y.top;if(o.viewportHeight(e)+t<y||y<t||o.viewportWidth(e)+
h<x||x<h)b.scrollIntoView(e)},_4e_getElementsByTagName:function(b,e,h){b=i(b);if(!m.ie&&h)e=h+":"+e;h=[];b=b.getElementsByTagName(e);for(e=0;e<b.length;e++)h.push(new q(b[e]));return h}};s.DOM._4e_inject=function(b){s.mix(o,b);for(var e in b)b.hasOwnProperty(e)&&function(h){q.prototype[h]=function(){var t=[].slice.call(arguments,0);t.unshift(this);return b[h].apply(null,t)}}(e)};n.extern(l,{_4e_wrap:l._4e_wrap,_4e_unwrap:l._4e_unwrap,_4e_equals:l._4e_equals,_4e_isBlockBoundary:l._4e_isBlockBoundary,
_4e_getWin:l._4e_getWin,_4e_index:l._4e_index,_4e_first:l._4e_first,_4e_move:l._4e_move,_4e_name:l._4e_name,_4e_isIdentical:l._4e_isIdentical,_4e_isEmptyInlineRemoveable:l._4e_isEmptyInlineRemoveable,_4e_moveChildren:l._4e_moveChildren,_4e_mergeSiblings:l._4e_mergeSiblings,_4e_unselectable:l._4e_unselectable,_4e_getOffset:l._4e_getOffset,_4e_getFrameDocument:l._4e_getFrameDocument,_4e_splitText:l._4e_splitText,_4e_parents:l._4e_parents,_4e_clone:l._4e_clone,_4e_nextSourceNode:l._4e_nextSourceNode,
_4e_previousSourceNode:l._4e_previousSourceNode,_4e_commonAncestor:l._4e_commonAncestor,_4e_ascendant:l._4e_ascendant,_4e_hasAttribute:l._4e_hasAttribute,_4e_hasAttributes:l._4e_hasAttributes,_4e_position:l._4e_position,_4e_address:l._4e_address,_4e_breakParent:l._4e_breakParent,_4e_style:l._4e_style,_4e_remove:l._4e_remove,_4e_trim:l._4e_trim,_4e_ltrim:l._4e_ltrim,_4e_rtrim:l._4e_rtrim,_4e_appendBogus:l._4e_appendBogus,_4e_last:l._4e_last,_4e_previous:l._4e_previous,_4e_next:l._4e_next,_4e_outerHtml:l._4e_outerHtml,
_4e_setMarker:l._4e_setMarker,_4e_clearMarkers:l._4e_clearMarkers,_4e_getUniqueId:l._4e_getUniqueId,_4e_copyAttributes:l._4e_copyAttributes,_4e_isEditable:l._4e_isEditable,_4e_scrollIntoView:l._4e_scrollIntoView,_4e_getElementsByTagName:l._4e_getElementsByTagName});o._4e_inject(l)});
KISSY.Editor.add("focusmanager",function(g){function p(){this.iframeFocus=c;j=this;o.log(this._UUID+" focus")}function s(){this.iframeFocus=d;j=f;o.log(this._UUID+" blur")}var o=KISSY,m=o.DOM,q=o.Event,n={},j,k={refreshAll:function(){for(var i in n){var w=n[i];w.document.designMode="off";w.document.designMode="on"}},currentInstance:function(){return j},getInstance:function(i){return n[i]},add:function(i){var w=m._4e_getWin(i.document);q.on(w,"focus",p,i);q.on(w,"blur",s,i)},register:function(i){n[i._UUID]=
i},remove:function(i){delete n[i._UUID];var w=m._4e_getWin(i.document);q.remove(w,"focus",p,i);q.remove(w,"blur",s,i)}},c=true,d=false,f=null;g.focusManager=k;g.focusManager=k;g.getInstances=function(){return n};g.getInstances=g.getInstances});
KISSY.Editor.add("definition",function(g){var p=true,s=false,o=g.Utils,m=document,q=KISSY,n=q.UA,j=q.DOM,k=q.Node,c=q.Event,d=g.focusManager,f=o.tryThese,i=o.debugUrl("theme/editor-iframe.css"),w=1,l="document.open();"+(o.isCustomDomain()?'document.domain="'+m.domain+'";':"")+"document.close();",b="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(n.ie?"javascript:void(function(){"+encodeURIComponent(l)+"}())":"")+'"  tabIndex="'+(n.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";g.SOURCE_MODE=0;g.WYSIWYG_MODE=1;g.SOURCE_MODE=g.SOURCE_MODE;g.WYSIWYG_MODE=g.WYSIWYG_MODE;q.augment(g,{init:function(e){if(n.ie)j.addClass(m.body,"ie"+n.ie);else if(n.gecko)j.addClass(m.body,"gecko");else n.webkit&&j.addClass(m.body,"webkit");var h=this,t=new k(b.replace(/\$\(tabIndex\)/,
e.attr("tabIndex")));h.editorWrap=t;h._UUID=w++;d.register(h);h.wrap=t.one(".ke-textarea-wrap");h.wrap=h.wrap;h.iframe=h.wrap.one("iframe");h.iframe=h.iframe;h.toolBarDiv=t.one(".ke-editor-tools");h.toolBarDiv=h.toolBarDiv;h.textarea=e;h.textarea=h.textarea;h.statusDiv=t.one(".ke-editor-status");h.statusDiv=h.statusDiv;o.preventFocus(h.toolBarDiv);h._commands={};h._dialogs={};var y=e._4e_style("width"),x=e._4e_style("height");if(y){t.css("width",y);e.css("width","100%")}h.textarea.css("display","none");
t.insertAfter(e);h.wrap[0].appendChild(e[0]);if(x){h.wrap.css("height",x);e.css("height","100%")}t=h.iframe;h.on("dataReady",function(){h._ready=p;g.fire("instanceCreated",{editor:h})});n.gecko?t.on("load",h._setUpIFrame,h):h._setUpIFrame();h.cfg.attachForm&&e[0].form&&h._attachForm()},_attachForm:function(){(new k(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(e,h){var t=this,y=g.Overlay;y.loading();t.use(e,function(){var x=t.getDialog(e);if(x){h(x);y.unloading()}else q.later(arguments.callee,
50,false,t)})},addDialog:function(e,h){this._dialogs[e]=h},getDialog:function(e){return this._dialogs[e]},addCommand:function(e,h){this._commands[e]=h},hasCommand:function(e){return this._commands[e]},execCommand:function(e){var h=this._commands[e],t=q.makeArray(arguments);t.shift();t.unshift(this);return h.exec.apply(h,t)},getMode:function(){return this.textarea.css("display")=="none"?g.WYSIWYG_MODE:g.SOURCE_MODE},getData:function(e){var h;h=this.getMode()==g.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)h=e?this.htmlDataProcessor.toHtml(h,"p"):this.htmlDataProcessor.toServer(h,"p");h=q.trim(h);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(h))h="";return h},setData:function(e){var h=e;if(this.htmlDataProcessor)h=this.htmlDataProcessor.toDataFormat(e,"p");this.document.body.innerHTML=h;this.getMode()!=g.WYSIWYG_MODE&&this.textarea.val(e)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(e){e=e||0;return e+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(e){this.document.body.innerHTML=e},_prepareIFrameHtml:function(e){var h=this.cfg,t=h.customLink,y="";if(t)for(var x=0;x<t.length;x++)y+='<link href="'+t[x]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+g.Config.base+i+"' rel='stylesheet'/><style>"+(h.customStyle||"")+"</style>"+y+"</head><body class='ke-editor'>&nbsp;"+(e?'<script id="ke_actscript" type="text/javascript">'+(o.isCustomDomain()?'document.domain="'+m.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+e+'");<\/script>':"")+"</body></html>"},getSelection:function(){return g.Selection.getSelection(this.document)},focus:function(){var e=this.document,h=j._4e_getWin(e);n.webkit&&h&&h.parent&&h.parent.focus();h&&h.focus();e&&e.body.focus();this.notifySelectionChange()},blur:function(){j._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(e){var h=this.cfg,t=this.document;h.customStyle=h.customStyle||"";h.customStyle+=
"\n"+e;h=t.createElement("style");t.getElementsByTagName("head")[0].appendChild(h);if(h.styleSheet)h.styleSheet.cssText=e;else h.appendChild(t.createTextNode(e))},addCustomLink:function(e){var h=this.cfg,t=this.document;h.customLink=h.customLink||[];h.customLink.push(e);h=t.createElement("link");h.rel="stylesheet";t.getElementsByTagName("head")[0].appendChild(h);h.href=e},removeCustomLink:function(e){for(var h=this.cfg,t=q.makeArray(this.document.getElementsByTagName("link")),y=0;y<t.length;y++)t[y].href==
e&&j._4e_remove(t[y]);h.customLink=h.customLink||[];h=h.customLink;e=q.indexOf(e,h);e!=-1&&h.splice(e,1)},_setUpIFrame:function(){function e(){u=x.document;h.document=u;t.detach();u.open("text/html","replace");u.write(y);u.close()}var h=this,t=h.iframe,y=h._prepareIFrameHtml(h._UUID),x=t[0].contentWindow,u;try{u=x.document}catch(r){t[0].src=t[0].src;if(n.ie<7){setTimeout(e,10);return}}e()},ready:function(e){this._ready?e():this.on("dataReady",e)},_monitor:function(){var e=this;e._monitorId&&clearTimeout(e._monitorId);
e._monitorId=setTimeout(function(){var h=e.getSelection();if(h&&!h.isInvalid){var t=h.getStartElement(),y=new g.ElementPath(t);if(!e.previousPath||!e.previousPath.compare(y)){e.previousPath=y;e.fire("selectionChange",{selection:h,path:y,element:t})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(e,h){var t=this;t.focus();var y=e._4e_name(),x=g.XHTML_DTD,u=g.RANGE,r=g.NODE,A=x.$block[y],B=t.getSelection(),C=B&&B.getRanges(),v,z,E,F,D;if(!C||
C.length==0){var G=arguments,M=G.callee;setTimeout(function(){M.apply(t,G)},30)}else{t.fire("save");for(var N=C.length-1;N>=0;N--){v=C[N];v.deleteContents();z=!N&&e||e._4e_clone(p);h&&h(z);if(A)for(;(F=v.getCommonAncestor(s,p))&&(D=x[F._4e_name()])&&!(D&&D[y]);)if(F._4e_name()in x.span)v.splitElement(F);else if(v.checkStartOfBlock()&&v.checkEndOfBlock()){v.setStartBefore(F);v.collapse(p);F._4e_remove()}else v.splitBlock();v.insertNode(z);E||(E=z)}if(E){y=E._4e_nextSourceNode(p);x=t.document;D=g.XHTML_DTD;
if(D.$inline[z._4e_name()]){y=new k(x.createTextNode(" "));y.insertAfter(E)}else if(y){if(y._4e_name()=="br"&&D[y.parent()._4e_name()].p){D=new k("<p>&nbsp;</p>",null,x);y[0].parentNode.replaceChild(D[0],y[0]);y=D}}else{D=new k("<p>&nbsp;</p>",null,x);D.insertAfter(E);y=D}v.moveToPosition(E,u.POSITION_AFTER_END);y&&y[0].nodeType==r.NODE_ELEMENT&&v.moveToElementEditablePosition(y);B.selectRanges([v]);t.focus();z&&z._4e_scrollIntoView();setTimeout(function(){t.fire("save")},10);return z}}},insertHtml:function(e){var h=
this;if(h.htmlDataProcessor)e=h.htmlDataProcessor.toDataFormat(e);if(n.webkit){var t=j.create(e,null,this.document);t=t.nodeType==11?q.makeArray(t.childNodes):[t];for(var y=0;y<t.length;y++)h.insertElement(new k(t[y]))}else{h.focus();y=(t=h.getSelection())&&t.getRanges();if(!y||y.length==0){var x=arguments,u=x.callee;setTimeout(function(){u.apply(h,x)},30)}else{h.fire("save");if(n.ie){t=t.getNative();t.type=="Control"&&t.clear();t.createRange().pasteHTML(e)}else h.document.execCommand("inserthtml",
s,e);h.focus();setTimeout(function(){h.fire("save")},10)}}}});g._initIFrame=function(e){function h(z){f(function(){x.designMode="on";setTimeout(function(){x.designMode="off";A.focus();if(!arguments.callee.retry)arguments.callee.retry=p},50)},function(){x.designMode="off";j.attr(A,"contentEditable",s);j.attr(A,"contentEditable",p);!z&&h(1)})}var t=d.getInstance(e);e=t.textarea[0];var y=t.iframe[0].contentWindow,x=t.document,u=t.cfg,r=x.getElementById("ke_actscript");j._4e_remove(r);var A=x.body;if(n.ie){A.hideFocus=
p;A.disabled=p;A.contentEditable=p;A.removeAttribute("disabled")}else setTimeout(function(){if(n.gecko||n.opera)A.contentEditable=p;else if(n.webkit)A.parentNode.contentEditable=p;else x.designMode="on"},0);if(n.webkit){c.on(x,"click",function(z){var E=new k(z.target);q.inArray(E._4e_name(),["input","select"])&&z.preventDefault()});c.on(x,"mouseup",function(z){var E=new k(z.target);q.inArray(E._4e_name(),["input","textarea"])&&z.preventDefault()})}if(n.gecko||n.ie||n.opera){var B;B=new k(j.insertAfter((new k('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
e));B.on("focus",function(){t.focus()});t.activateGecko=function(){n.gecko&&t.iframeFocus&&B[0].focus()};t.on("destroy",function(){})}if(n.ie&&x.compatMode=="CSS1Compat"||n.gecko||n.opera){var C=new k(x.documentElement);C.on("mousedown",function(z){if((new k(z.target))[0]==C[0]){n.gecko&&h(s);B[0].focus()}})}c.on(y,"focus",function(){if(n.gecko)h(s);else n.opera&&A.focus();t.notifySelectionChange()});n.gecko&&c.on(t.document,"mousedown",function(){t.iframeFocus||h(s)});if(n.ie){c.on(x,"keydown",function(z){if(z.keyCode in
{8:1,46:1}){var E=t.getSelection(),F=E.getSelectedElement();if(F){t.fire("save");var D=E.getRanges()[0].createBookmark();F._4e_remove();E.selectBookmarks([D]);t.fire("save");z.preventDefault()}}});if(x.compatMode=="CSS1Compat"){var v={33:1,34:1};c.on(x,"keydown",function(z){z.keyCode in v&&setTimeout(function(){t.getSelection().scrollIntoView()},0)})}}setTimeout(function(){n.ie&&setTimeout(function(){if(x){A.runtimeStyle.marginBottom="0px";A.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){t.fire("dataReady");
var z=u.disableObjectResizing,E=u.disableInlineTableEditing;if(z||E)try{x.execCommand("enableObjectResizing",s,!z);x.execCommand("enableInlineTableEditing",s,!E)}catch(F){c.on(A,n.ie?"resizestart":"resize",function(D){var G=new k(D.target);if(z||G._4e_name()==="table"&&E)D.preventDefault()})}},10);n.webkit&&c.on(x,"mousedown",function(z){z=new k(z.target);q.inArray(z._4e_name(),["img","hr","input","textarea","select"])&&t.getSelection().selectElement(z)});n.gecko&&c.on(x,"dragstart",function(z){var E=
new k(z.target);E._4e_name()==="img"&&/ke_/.test(E[0].className)&&z.preventDefault()});d.add(t)};l=g.prototype;o.extern(l,{setData:l.setData,getData:l.getData,insertElement:l.insertElement,insertHtml:l.insertHtml,ready:l.ready,addCustomStyle:l.addCustomStyle,addCommand:l.addCommand,hasCommand:l.hasCommand,execCommand:l.execCommand,useDialog:l.useDialog,addDialog:l.addDialog,getDialog:l.getDialog,getMode:l.getMode,sync:l.sync,baseZIndex:l.baseZIndex,getSelection:l.getSelection,focus:l.focus,blur:l.blur,
notifySelectionChange:l.notifySelectionChange})});KISSY.Editor.add("zindex",function(){var g=KISSY.Editor;if(!g.zIndexManager){g.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};g.baseZIndex=function(p){var s=p,o=g.getInstances(),m;for(m in o){if(!o.hasOwnProperty(m))return;s=Math.max(s,o[m].baseZIndex(p))}return s};g.baseZIndex=g.baseZIndex;g.zIndexManager=g.zIndexManager}});
KISSY.Editor.add("dtd",function(g){g.XHTML_DTD=function(){function p(u){for(var r=arguments.length-1;r>0;)KISSY.mix(u,arguments[r--]);return u}var s={isindex:1,fieldset:1},o={input:1,button:1,select:1,textarea:1,label:1},m=p({a:1},o),q=p({iframe:1},m),n={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},k=p({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),c=p({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},k),d=p({p:1},c);o=p({iframe:1},c,o);c={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var f=p({a:1},o),i={tr:1},w={"#":1},l=p({param:1},c),b=p({form:1},s,q,n,d),e={li:1},h={base:1,link:1,meta:1,title:1},t=p(h,{style:1,script:1}),y={head:1,body:1},x={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:p({html:1},y,h),$block:x,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:f,$body:p({script:1,style:1},x),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:y,head:t,style:w,body:b,base:{},link:{},meta:{},title:w,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:b,td:b,br:{},th:b,center:b,kbd:f,button:p(d,n),basefont:{},h5:f,h4:f,samp:f,h6:f,ol:e,h1:f,h3:f,option:w,h2:f,form:p(s,q,n,d),select:{optgroup:1,option:1},font:f,ins:f,menu:e,abbr:f,label:f,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:f,script:w,tfoot:i,cite:f,li:b,input:{},iframe:b,strong:f,textarea:w,noframes:b,big:f,small:f,span:f,hr:{},dt:f,sub:f,optgroup:{option:1},param:{},bdo:f,"var":f,div:b,object:l,sup:f,dd:b,strike:f,area:{},dir:e,map:p({area:1,form:1,p:1},s,j,n),applet:l,dl:{dt:1,dd:1},del:f,isindex:{},fieldset:p({legend:1},c),thead:i,ul:e,acronym:f,b:f,a:o,blockquote:b,caption:f,i:f,u:f,tbody:i,s:f,address:p(q,d),tt:f,legend:f,q:f,pre:p(k,m),p:f,em:f,dfn:f}}();g.XHTML_DTD=
g.XHTML_DTD});
KISSY.Editor.add("elementpath",function(g){function p(c){var d=q,f=q,i=[];for(c=c;c&&c[0];){if(c[0].nodeType==m.NODE_ELEMENT){if(!this.lastElement)this.lastElement=c;var w=c._4e_name();if(!f){if(!d&&n[w])d=c;if(j[w]){var l;if(l=!d){if(l=w=="div"){a:{l=c;l=l[0]||l;l=l.childNodes;for(var b=0,e=l.length;b<e;b++){var h=l[b];if(h.nodeType==m.NODE_ELEMENT&&o.$block[h.nodeName.toLowerCase()]){l=true;break a}}l=false}l=!l}l=l}if(l)d=c;else f=c}}i.push(c);if(w=="body")break}c=c.parent()}this.block=this.block=
d;this.blockLimit=this.blockLimit=f;this.elements=this.elements=i}var s=KISSY.DOM,o=g.XHTML_DTD,m=g.NODE,q=null,n={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};p.prototype={compare:function(c){var d=this.elements;c=c&&c.elements;if(!c||d.length!=c.length)return false;for(var f=0;f<d.length;f++)if(!s._4e_equals(d[f],c[f]))return false;return true},contains:function(c){for(var d=this.elements,f=0;f<
d.length;f++)if(d[f]._4e_name()in c)return d[f];return q}};g.ElementPath=g.ElementPath=p;var k=p.prototype;g.Utils.extern(k,{compare:k.compare,contains:k.contains})});
KISSY.Editor.add("walker",function(g){function p(i,w){if(this._.end)return n;var l,b=this.range,e,h=this.guard,t=this.type,y=i?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;b.trim();if(b.collapsed){this.end();return n}}if(!i&&!this._.guardLTR){var x=b.endContainer,u=new d(x[0].childNodes[b.endOffset]);this._.guardLTR=function(C,v){return(C=c._4e_wrap(C))&&C[0]&&(!v||!c._4e_equals(x,C))&&(!u[0]||!C._4e_equals(u))&&(C[0].nodeType!=k.NODE_ELEMENT||!v||C._4e_name()!="body")}}if(i&&
!this._.guardRTL){var r=b.startContainer,A=b.startOffset>0&&new d(r[0].childNodes[b.startOffset-1]);this._.guardRTL=function(C,v){return(C=c._4e_wrap(C))&&C[0]&&(!v||!C._4e_equals(r))&&(!A[0]||!C._4e_equals(A))&&(C[0].nodeType!=k.NODE_ELEMENT||!v||C._4e_name()!="body")}}var B=i?this._.guardRTL:this._.guardLTR;e=h?function(C,v){if(B(C,v)===q)return q;return h(C,v)}:B;if(this.current)l=this.current[y](q,t,e);else if(i){l=b.endContainer;if(b.endOffset>0){l=new d(l[0].childNodes[b.endOffset-1]);if(e(l)===
q)l=n}else l=e(l,m)===q?n:l._4e_previousSourceNode(m,t,e)}else{l=b.startContainer;if((l=new d(l[0].childNodes[b.startOffset]))&&l[0]){if(e(l)===q)l=n}else l=e(b.startContainer,m)===q?n:b.startContainer._4e_nextSourceNode(m,t,e)}for(;l&&l[0]&&!this._.end;){this.current=l;if(!this.evaluator||this.evaluator(l)!==q){if(!w)return l}else if(w&&this.evaluator)return q;l=l[y](q,t,e)}this.end();return this.current=n}function s(i){for(var w,l=n;w=p.call(this,i);)l=w;return l}function o(i){this.range=i;this._=
{}}var m=true,q=false,n=null,j=KISSY,k=g.NODE,c=j.DOM,d=j.Node;j.augment(o,{end:function(){this._.end=1},next:function(){return p.call(this)},previous:function(){return p.call(this,m)},checkForward:function(){return p.call(this,q,m)!==q},checkBackward:function(){return p.call(this,m,m)!==q},lastForward:function(){return s.call(this)},lastBackward:function(){return s.call(this,m)},reset:function(){delete this.current;this._={}}});o.blockBoundary=function(i){return function(w){w=c._4e_wrap(w);return!(w&&
w[0].nodeType==k.NODE_ELEMENT&&w._4e_isBlockBoundary(i))}};o.listItemBoundary=function(){return this.blockBoundary({br:1})};o.bookmark=function(i,w){function l(b){return b&&b[0]&&b._4e_name()=="span"&&b.attr("_ke_bookmark")}return function(b){var e,h;e=b&&b[0]&&b[0].nodeType==k.NODE_TEXT&&(h=b.parent())&&l(h);e=i?e:e||l(b);return w^e}};o.whitespaces=function(i){return function(w){w=(w=w[0]||w)&&w.nodeType==k.NODE_TEXT&&!j.trim(w.nodeValue);return i^w}};o.invisible=function(i){var w=o.whitespaces();
return function(l){l=w(l)||l[0].nodeType==k.NODE_ELEMENT&&!l[0].offsetHeight;return i^l}};g.Walker=o;g.Walker=o;var f=o.prototype;g.Utils.extern(f,{end:f.end,next:f.next,previous:f.previous,checkForward:f.checkForward,checkBackward:f.checkBackward,lastForward:f.lastForward,lastBackward:f.lastBackward,reset:f.reset});g.Utils.extern(o,{blockBoundary:o.blockBoundary,listItemBoundary:o.listItemBoundary,bookmark:o.bookmark,whitespaces:o.whitespaces,invisible:o.invisible})});
KISSY.Editor.add("range",function(g){function p(v){this.endOffset=this.endContainer=this.startOffset=this.startContainer=c;this.collapsed=j;this.document=v}function s(v){var z=v[0].nodeType!=f.NODE_TEXT&&v._4e_name()in t.$removeEmpty,E=!d.trim(v[0].nodeValue);v=!!v.parent().attr("_ke_bookmark");return z||E||v}function o(v){return!A(v)&&!B(v)}function m(v){var z=k,E=l.bookmark(j);return function(F){if(E(F))return j;if(F[0].nodeType==f.NODE_TEXT){if(d.trim(F[0].nodeValue).length)return k}else if(F[0].nodeType==
f.NODE_ELEMENT)if(!r[F._4e_name()])if(!v&&!h.ie&&F._4e_name()=="br"&&!z)z=j;else return k;return j}}function q(v,z){function E(F){return F&&F.nodeName=="span"&&F.getAttribute("_ke_bookmark")}return function(F){var D,G;D=F&&!F.nodeName&&(G=F.parentNode)&&E(G);D=v?D:D||E(F);return z^D}}function n(v){return function(z){z=(z=z[0]||z)&&z.nodeType==f.NODE_TEXT&&!d.trim(z.nodeValue);return v^z}}g.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};g.RANGE=g.RANGE;var j=true,k=false,c=null,d=KISSY,f=g.NODE,i=g.RANGE,w=g.POSITION,l=g.Walker,b=d.DOM,e=g.Utils.getByAddress,h=d.UA,t=g.XHTML_DTD,y=g.ElementPath,x=d.Node,u={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};p.prototype.toString=function(){var v=[];v.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);v.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return v.join("<br/>")};d.augment(p,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&b._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var v=this.startContainer,z=this.startOffset;if(v[0].nodeType!=f.NODE_ELEMENT)if(z)z>=v[0].nodeValue.length&&this.setStartAfter(v);else this.setStartBefore(v);v=this.endContainer;z=this.endOffset;if(v[0].nodeType!=f.NODE_ELEMENT)if(z)z>=
v[0].nodeValue.length&&this.setEndAfter(v);else this.setEndBefore(v)},setStartAfter:function(v){this.setStart(v.parent(),v._4e_index()+1)},setStartBefore:function(v){this.setStart(v.parent(),v._4e_index())},setEndAfter:function(v){this.setEnd(v.parent(),v._4e_index()+1)},setEndBefore:function(v){this.setEnd(v.parent(),v._4e_index())},optimizeBookmark:function(){var v=this.startContainer,z=this.endContainer;v&&v._4e_name()=="span"&&v.attr("_ke_bookmark")&&this.setStartAt(v,i.POSITION_BEFORE_START);
z&&z._4e_name()=="span"&&z.attr("_ke_bookmark")&&this.setEndAt(z,i.POSITION_AFTER_END)},setStart:function(v,z){if(v[0].nodeType==f.NODE_ELEMENT&&u[v._4e_name()]){v=v.parent();z=v._4e_index()}this.startContainer=v;this.startOffset=z;if(!this.endContainer){this.endContainer=v;this.endOffset=z}this.updateCollapsed()},setEnd:function(v,z){if(v[0].nodeType==f.NODE_ELEMENT&&u[v._4e_name()]){v=v.parent();z=v._4e_index()+1}this.endContainer=v;this.endOffset=z;if(!this.startContainer){this.startContainer=
v;this.startOffset=z}this.updateCollapsed()},setStartAt:function(v,z){switch(z){case i.POSITION_AFTER_START:this.setStart(v,0);break;case i.POSITION_BEFORE_END:v[0].nodeType==f.NODE_TEXT?this.setStart(v,v[0].nodeValue.length):this.setStart(v,v[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setStartBefore(v);break;case i.POSITION_AFTER_END:this.setStartAfter(v)}this.updateCollapsed()},setEndAt:function(v,z){switch(z){case i.POSITION_AFTER_START:this.setEnd(v,0);break;case i.POSITION_BEFORE_END:v[0].nodeType==
f.NODE_TEXT?this.setEnd(v,v[0].nodeValue.length):this.setEnd(v,v[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setEndBefore(v);break;case i.POSITION_AFTER_END:this.setEndAfter(v)}this.updateCollapsed()},execContentsAction:function(v,z){var E=this.startContainer,F=this.endContainer,D=this.startOffset,G=this.endOffset,M,N=this.document,Q;this.optimizeBookmark();if(F[0].nodeType==f.NODE_TEXT)F=F._4e_splitText(G);else if(F[0].childNodes.length>0)if(G>=F[0].childNodes.length){F=new x(F[0].appendChild(N.createTextNode("")));
Q=j}else F=new x(F[0].childNodes[G]);if(E[0].nodeType==f.NODE_TEXT){E._4e_splitText(D);if(E._4e_equals(F))F=new x(E[0].nextSibling)}else if(D)if(D>=E[0].childNodes.length){M=new x(N.createTextNode(""));E.append(M);E=M;M=j}else E=new x(E[0].childNodes[D].previousSibling);else{M=new x(N.createTextNode(""));E.prepend(M);E=M;M=j}D=E._4e_parents();G=F._4e_parents();var R,V,T;for(R=0;R<D.length;R++){V=D[R];T=G[R];if(!V._4e_equals(T))break}N=z;for(var U,W,H,L=R;L<D.length;L++){U=D[L];W=N&&!U._4e_equals(E)?
N.appendChild(U._4e_clone()[0]):null;for(U=U[0].nextSibling;U;){if(b._4e_equals(G[L],U)||b._4e_equals(F,U))break;H=U.nextSibling;if(v==2)N.appendChild(U.cloneNode(j));else{b._4e_remove(U);v==1&&N.appendChild(U)}U=H}if(W)N=W}N=z;for(R=R;R<G.length;R++){U=G[R];W=N&&v>0&&!U._4e_equals(F)?N.appendChild(U._4e_clone()[0]):null;if(!D[R]||!U.parent()._4e_equals(D[R].parent()))for(U=U[0].previousSibling;U;){if(b._4e_equals(D[R],U)||b._4e_equals(E,U))break;H=U.previousSibling;if(v==2)N.insertBefore(U.cloneNode(j),
N.firstChild);else{b._4e_remove(U);v==1&&N.insertBefore(U,N.firstChild)}U=H}if(W)N=W}if(v==2){T=this.startContainer[0];if(T.nodeType==f.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==f.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}T=this.endContainer[0];if(T.nodeType==f.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==f.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}}else{if(V&&T&&(!E.parent()._4e_equals(V.parent())||!F.parent()._4e_equals(T.parent()))){V=
T._4e_index();M&&T.parent()._4e_equals(E.parent())&&V--;this.setStart(T.parent(),V)}this.collapse(j)}M&&E._4e_remove();Q&&F[0].parentNode&&F._4e_remove()},collapse:function(v){if(v){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=j},clone:function(){var v=new p(this.document);v.startContainer=this.startContainer;v.startOffset=this.startOffset;v.endContainer=this.endContainer;v.endOffset=
this.endOffset;v.collapsed=this.collapsed;return v},getEnclosedNode:function(){var v=this.clone();v.optimize();if(v.startContainer[0].nodeType!=f.NODE_ELEMENT||v.endContainer[0].nodeType!=f.NODE_ELEMENT)return c;var z=new g.Walker(v),E=q(j,undefined),F=n(j);v.evaluator=function(D){return F(D)&&E(D)};v=z.next();z.reset();z=z.previous();return v&&v._4e_equals(z)?v:c},shrink:function(v,z){if(!this.collapsed){v=v||i.SHRINK_TEXT;var E=this.clone(),F=this.startContainer,D=this.endContainer,G=this.startOffset,
M=this.endOffset,N=1,Q=1;if(F&&F[0].nodeType==f.NODE_TEXT)if(G)if(G>=F[0].nodeValue.length)E.setStartAfter(F);else{E.setStartBefore(F);N=0}else E.setStartBefore(F);if(D&&D[0].nodeType==f.NODE_TEXT)if(M)if(M>=D[0].nodeValue.length)E.setEndAfter(D);else{E.setEndAfter(D);Q=0}else E.setEndBefore(D);E=new l(E);E.evaluator=function(V){V=V[0]||V;return V.nodeType==(v==i.SHRINK_ELEMENT?f.NODE_ELEMENT:f.NODE_TEXT)};var R;E.guard=function(V,T){V=V[0]||V;if(v==i.SHRINK_ELEMENT&&V.nodeType==f.NODE_TEXT)return k;
if(T&&V==R)return k;if(!T&&V.nodeType==f.NODE_ELEMENT)R=V;return j};if(N)(F=E[v==i.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(F,z?i.POSITION_AFTER_START:i.POSITION_BEFORE_START);if(Q){E.reset();(E=E[v==i.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(E,z?i.POSITION_BEFORE_END:i.POSITION_AFTER_END)}return!!(N||Q)}},getTouchedStartNode:function(){var v=this.startContainer;if(this.collapsed||v[0].nodeType!=f.NODE_ELEMENT)return v;return v.childNodes[this.startOffset]||v},createBookmark2:function(v){var z=
this.startContainer,E=this.endContainer,F=this.startOffset,D=this.endOffset,G,M;if(!z||!E)return{start:0,end:0};if(v){if(z[0].nodeType==f.NODE_ELEMENT)if((G=new x(z[0].childNodes[F]))&&G[0]&&G[0].nodeType==f.NODE_TEXT&&F>0&&G[0].previousSibling.nodeType==f.NODE_TEXT){z=G;F=0}for(;z[0].nodeType==f.NODE_TEXT&&(M=z._4e_previous())&&M[0].nodeType==f.NODE_TEXT;){z=M;F+=M[0].nodeValue.length}if(!this.collapsed){if(E[0].nodeType==f.NODE_ELEMENT)if((G=new x(E[0].childNodes[D]))&&G[0]&&G[0].nodeType==f.NODE_TEXT&&
D>0&&G[0].previousSibling.nodeType==f.NODE_TEXT){E=G;D=0}for(;E[0].nodeType==f.NODE_TEXT&&(M=E._4e_previous())&&M[0].nodeType==f.NODE_TEXT;){E=M;D+=M[0].nodeValue.length}}}return{start:z._4e_address(v),end:this.collapsed?c:E._4e_address(v),startOffset:F,endOffset:D,normalized:v,is2:j}},createBookmark:function(v){var z,E,F,D,G=this.collapsed;z=new x("<span>",c,this.document);z.attr("_ke_bookmark",1);z.css("display","none");z.html("&nbsp;");if(v){F=d.guid("ke_bm_");z.attr("id",F+"S")}if(!G){E=z._4e_clone();
E.html("&nbsp;");v&&E.attr("id",F+"E");D=this.clone();D.collapse();D.insertNode(E)}D=this.clone();D.collapse(j);D.insertNode(z);if(E){this.setStartAfter(z);this.setEndBefore(E)}else this.moveToPosition(z,i.POSITION_AFTER_END);return{startNode:v?F+"S":z,endNode:v?F+"E":E,serializable:v,collapsed:G}},moveToPosition:function(v,z){this.setStartAt(v,z);this.collapse(j)},trim:function(v,z){var E=this.startContainer,F=this.startOffset,D=this.collapsed;if((!v||D)&&E[0]&&E[0].nodeType==f.NODE_TEXT){if(F)if(F>=
E[0].nodeValue.length){F=E._4e_index()+1;E=E.parent()}else{var G=E._4e_splitText(F);F=E._4e_index()+1;E=E.parent();if(b._4e_equals(this.startContainer,this.endContainer))this.setEnd(G,this.endOffset-this.startOffset);else if(b._4e_equals(E,this.endContainer))this.endOffset+=1}else{F=E._4e_index();E=E.parent()}this.setStart(E,F);if(D){this.collapse(j);return}}E=this.endContainer;F=this.endOffset;if(!(z||D)&&E[0]&&E[0].nodeType==f.NODE_TEXT){if(F){F>=E.nodeValue.length||E._4e_splitText(F);F=E._4e_index()+
1}else F=E._4e_index();E=E.parent();this.setEnd(E,F)}},insertNode:function(v){this.optimizeBookmark();this.trim(k,j);var z=this.startContainer;z[0].insertBefore(v[0]||v,z[0].childNodes[this.startOffset]||null);b._4e_equals(v.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(v)},moveToBookmark:function(v){if(v.is2){var z=e(this.document,v.start,v.normalized),E=v.startOffset,F=v.end&&e(this.document,v.end,v.normalized);v=v.endOffset;this.setStart(z,E);F?this.setEnd(F,v):this.collapse(j)}else{z=
(E=v.serializable)?d.one("#"+v.startNode,this.document):v.startNode;v=E?d.one("#"+v.endNode,this.document):v.endNode;this.setStartBefore(z);z._4e_remove();if(v&&v[0]){this.setEndBefore(v);v._4e_remove()}else this.collapse(j)}},getCommonAncestor:function(v,z){var E=this.startContainer,F=this.endContainer;E=b._4e_equals(E,F)?v&&E[0].nodeType==f.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new x(E[0].childNodes[this.startOffset]):E:E._4e_commonAncestor(F);return z&&E[0].nodeType==f.NODE_TEXT?E.parent():
E},enlarge:function(v){switch(v){case i.ENLARGE_ELEMENT:if(this.collapsed)break;v=this.getCommonAncestor();var z=new x(this.document.body),E,F,D,G,M,N=k,Q,R;Q=this.startContainer;R=this.startOffset;if(Q[0].nodeType==f.NODE_TEXT){if(R){Q=!d.trim(Q[0].nodeValue.substring(0,R)).length&&Q;N=!!Q}if(Q)if(!(G=Q[0].previousSibling))D=Q.parent()}else{if(R)G=Q[0].childNodes[R-1]||Q[0].lastChild;G||(D=Q)}for(;D||G;){if(D&&!G){if(!M&&b._4e_equals(D,v))M=j;if(!z.contains(D))break;if(!N||D.css("display")!="inline"){N=
k;if(M)E=D;else this.setStartBefore(D)}G=D[0].previousSibling}for(;G;){Q=k;if(G.nodeType==f.NODE_TEXT){R=G.nodeValue;if(/[^\s\ufeff]/.test(R))G=c;Q=/[\s\ufeff]$/.test(R)}else if(G.offsetWidth>0&&!G.getAttribute("_ke_bookmark"))if(N&&t.$removeEmpty[G.nodeName.toLowerCase()]){R=b.text(G);if(/[^\s\ufeff]/.test(R))G=c;else for(var V=G.all||G.getElementsByTagName("*"),T=0,U;U=V[T++];)if(!t.$removeEmpty[U.nodeName.toLowerCase()]){G=c;break}if(G)Q=!!R.length}else G=c;if(Q)if(N)if(M)E=D;else D&&this.setStartBefore(D);
else N=j;if(G){Q=G.previousSibling;if(!D&&!Q){D=new x(G);G=c;break}G=Q}else D=c}if(D)D=D.parent()}Q=this.endContainer;R=this.endOffset;D=G=c;M=N=k;if(Q[0].nodeType==f.NODE_TEXT){Q=!d.trim(Q[0].nodeValue.substring(R)).length&&Q;N=!(Q&&Q[0].nodeValue.length);if(Q)if(!(G=Q[0].nextSibling))D=Q.parent()}else(G=Q[0].childNodes[R])||(D=Q);for(;D||G;){if(D&&!G){if(!M&&b._4e_equals(D,v))M=j;if(!z.contains(D))break;if(!N||D.css("display")!="inline"){N=k;if(M)F=D;else D&&this.setEndAfter(D)}G=D[0].nextSibling}for(;G;){Q=
k;if(G.nodeType==f.NODE_TEXT){R=G.nodeValue;if(/[^\s\ufeff]/.test(R))G=c;Q=/^[\s\ufeff]/.test(R)}else if(G.offsetWidth>0&&!G.getAttribute("_ke_bookmark"))if(N&&t.$removeEmpty[G.nodeName.toLowerCase()]){R=b.text(G);if(/[^\s\ufeff]/.test(R))G=c;else{V=G.all||G.getElementsByTagName("*");for(T=0;U=V[T++];)if(!t.$removeEmpty[U.nodeName.toLowerCase()]){G=c;break}}if(G)Q=!!R.length}else G=c;if(Q)if(N)if(M)F=D;else this.setEndAfter(D);if(G){Q=G.nextSibling;if(!D&&!Q){D=new x(G);G=c;break}G=Q}else D=c}if(D)D=
D.parent()}if(E&&F){v=E.contains(F)?F:E;this.setStartBefore(v);this.setEndAfter(v)}break;case i.ENLARGE_BLOCK_CONTENTS:case i.ENLARGE_LIST_ITEM_CONTENTS:D=new p(this.document);z=new x(this.document.body);D.setStartAt(z,i.POSITION_AFTER_START);D.setEnd(this.startContainer,this.startOffset);D=new l(D);var W,H,L=l.blockBoundary(v==i.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:c),J=function(I){var K=L(I);K||(W=I);return K};E=function(I){var K=J(I);if(!K&&I[0]&&I._4e_name()=="br")H=I;return K};D.guard=J;D=D.lastBackward();
W=W||z;this.setStartAt(W,W._4e_name()!="br"&&(!D&&this.checkStartOfBlock()||D&&W.contains(D))?i.POSITION_AFTER_START:i.POSITION_AFTER_END);D=this.clone();D.collapse();D.setEndAt(z,i.POSITION_BEFORE_END);D=new l(D);D.guard=v==i.ENLARGE_LIST_ITEM_CONTENTS?E:J;W=c;D=D.lastForward();W=W||z;this.setEndAt(W,!D&&this.checkEndOfBlock()||D&&W.contains(D)?i.POSITION_BEFORE_END:i.POSITION_BEFORE_START);H&&this.setEndAfter(H)}},checkStartOfBlock:function(){var v=this.startContainer,z=this.startOffset;if(z&&v[0].nodeType==
f.NODE_TEXT)if(d.trim(v[0].nodeValue.substring(0,z)).length)return k;this.trim();v=new y(this.startContainer);z=this.clone();z.collapse(j);z.setStartAt(v.block||v.blockLimit,i.POSITION_AFTER_START);v=new l(z);v.evaluator=m(j);return v.checkBackward()},checkEndOfBlock:function(){var v=this.endContainer,z=this.endOffset;if(v[0].nodeType==f.NODE_TEXT)if(d.trim(v[0].nodeValue.substring(z)).length)return k;this.trim();v=new y(this.endContainer);z=this.clone();z.collapse(k);z.setEndAt(v.block||v.blockLimit,
i.POSITION_BEFORE_END);v=new l(z);v.evaluator=m(k);return v.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var v=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,v);return v},checkBoundaryOfElement:function(v,z){var E=this.clone();E[z==i.START?"setStartAt":"setEndAt"](v,z==i.START?i.POSITION_AFTER_START:i.POSITION_BEFORE_END);E=new l(E);E.evaluator=s;return E[z==i.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var v=this.startContainer,z=this.endContainer,E=this.startOffset,F=this.endOffset,D;if(v[0].nodeType==f.NODE_ELEMENT){D=v[0].childNodes.length;if(D>E)v=new x(v[0].childNodes[E]);else if(D<1)v=v._4e_previousSourceNode();else{for(v=v[0];v.lastChild;)v=v.lastChild;v=new x(v);v=v._4e_nextSourceNode()||v}}if(z[0].nodeType==f.NODE_ELEMENT){D=z[0].childNodes.length;if(D>F)z=(new x(z[0].childNodes[F]))._4e_previousSourceNode(j);else if(D<1)z=z._4e_previousSourceNode();else{for(z=
z[0];z.lastChild;)z=z.lastChild;z=new x(z)}}if(v._4e_position(z)&w.POSITION_FOLLOWING)v=z;return{startNode:v,endNode:z}},fixBlock:function(v,z){var E=this.createBookmark(),F=new x(this.document.createElement(z));this.collapse(v);this.enlarge(i.ENLARGE_BLOCK_CONTENTS);F[0].appendChild(this.extractContents());F._4e_trim();h.ie||F._4e_appendBogus();this.insertNode(F);this.moveToBookmark(E);return F},splitBlock:function(v){var z=new y(this.startContainer),E=new y(this.endContainer),F=z.block,D=E.block,
G=c;if(!z.blockLimit._4e_equals(E.blockLimit))return c;if(v!="br"){if(!F){F=this.fixBlock(j,v);D=(new y(this.endContainer)).block}D||(D=this.fixBlock(k,v))}v=F&&this.checkStartOfBlock();z=D&&this.checkEndOfBlock();this.deleteContents();if(F&&b._4e_equals(F,D))if(z){G=new y(this.startContainer);this.moveToPosition(D,i.POSITION_AFTER_END);D=c}else if(v){G=new y(this.startContainer);this.moveToPosition(F,i.POSITION_BEFORE_START);F=c}else{D=this.splitElement(F);!h.ie&&!d.inArray(F._4e_name(),["ul","ol"])&&
F._4e_appendBogus()}return{previousBlock:F,nextBlock:D,wasStartOfBlock:v,wasEndOfBlock:z,elementPath:G}},splitElement:function(v){if(!this.collapsed)return c;this.setEndAt(v,i.POSITION_BEFORE_END);var z=this.extractContents(),E=v._4e_clone(k);E[0].appendChild(z);E.insertAfter(v);this.moveToPosition(v,i.POSITION_AFTER_END);return E},moveToElementEditablePosition:function(v,z){var E,F=g.XHTML_DTD;if(F.$empty[v._4e_name()])return k;for(;v&&v[0].nodeType==f.NODE_ELEMENT;){if(E=v._4e_isEditable())this.moveToPosition(v,
z?i.POSITION_BEFORE_END:i.POSITION_AFTER_START);else if(F.$inline[v._4e_name()]){this.moveToPosition(v,z?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);return j}if((v=F.$empty[v._4e_name()]?v[z?"_4e_previous":"_4e_next"](o):v[z?"_4e_last":"_4e_first"](o))&&v[0].nodeType==f.NODE_TEXT){this.moveToPosition(v,z?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);return j}}return E},selectNodeContents:function(v){this.setStart(v,0);this.setEnd(v,v[0].nodeType==f.NODE_TEXT?v[0].nodeValue.length:v[0].childNodes.length)}});
var r={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},A=new l.whitespaces,B=new l.bookmark;g.Range=p;g.Range=p;var C=p.prototype;g.Utils.extern(C,{updateCollapsed:C.updateCollapsed,optimize:C.optimize,setStartAfter:C.setStartAfter,setEndAfter:C.setEndAfter,setStartBefore:C.setStartBefore,setEndBefore:C.setEndBefore,optimizeBookmark:C.optimizeBookmark,setStart:C.setStart,setEnd:C.setEnd,
setStartAt:C.setStartAt,setEndAt:C.setEndAt,execContentsAction:C.execContentsAction,collapse:C.collapse,clone:C.clone,getEnclosedNode:C.getEnclosedNode,shrink:C.shrink,getTouchedStartNode:C.getTouchedStartNode,createBookmark2:C.createBookmark2,createBookmark:C.createBookmark,moveToPosition:C.moveToPosition,trim:C.trim,insertNode:C.insertNode,moveToBookmark:C.moveToBookmark,getCommonAncestor:C.getCommonAncestor,enlarge:C.enlarge,checkStartOfBlock:C.checkStartOfBlock,checkEndOfBlock:C.checkEndOfBlock,
deleteContents:C.deleteContents,extractContents:C.extractContents,checkBoundaryOfElement:C.checkBoundaryOfElement,getBoundaryNodes:C.getBoundaryNodes,fixBlock:C.fixBlock,splitBlock:C.splitBlock,splitElement:C.splitElement,moveToElementEditablePosition:C.moveToElementEditablePosition,selectNodeContents:C.selectNodeContents})});
KISSY.Editor.add("domiterator",function(g){function p(l){if(!(arguments.length<1)){this.range=l;this.forceBrBreak=o;this.enlargeBr=s;this.enforceRealBlocks=o;this._||(this._={})}}var s=true,o=false,m=KISSY,q=m.UA,n=g.Walker,j=g.Range,k=g.RANGE,c=g.NODE,d=g.ElementPath,f=m.Node,i=m.DOM,w=/^[\r\n\t ]*$/;m.augment(p,{getNextParagraph:function(l){var b,e,h,t,y;if(!this._.lastNode){e=this.range.clone();e.shrink(k.SHRINK_ELEMENT,s);e.enlarge(this.forceBrBreak||!this.enlargeBr?k.ENLARGE_LIST_ITEM_CONTENTS:
k.ENLARGE_BLOCK_CONTENTS);var x=new n(e),u=n.bookmark(s,s);x.evaluator=u;this._.nextNode=x.next();x=new n(e);x.evaluator=u;x=x.previous();this._.lastNode=x._4e_nextSourceNode(s);if(this._.lastNode&&this._.lastNode[0].nodeType==c.NODE_TEXT&&!m.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){u=new j(e.document);u.moveToPosition(this._.lastNode,k.POSITION_AFTER_END);if(u.checkEndOfBlock()){u=new d(u.endContainer);this._.lastNode=(u.block||u.blockLimit)._4e_nextSourceNode(s)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new f(e.document.createTextNode(""));i.insertAfter(this._.lastNode[0],x[0])}e=null}u=this._.nextNode;x=this._.lastNode;for(this._.nextNode=null;u;){var r=o,A=u[0].nodeType!=c.NODE_ELEMENT,B=o;if(A){if(u[0].nodeType==c.NODE_TEXT)if(w.test(u[0].nodeValue))A=o}else{var C=u._4e_name();if(u._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(C=="br")A=s;else if(!e&&!u[0].childNodes.length&&C!="hr"){b=u;h=u._4e_equals(x);break}if(e){e.setEndAt(u,k.POSITION_BEFORE_START);if(C!="br")this._.nextNode=
u}r=s}else{if(u[0].firstChild){if(!e){e=new j(this.range.document);e.setStartAt(u,k.POSITION_BEFORE_START)}u=new f(u[0].firstChild);continue}A=s}}if(A&&!e){e=new j(this.range.document);e.setStartAt(u,k.POSITION_BEFORE_START)}h=(!r||A)&&u._4e_equals(x);if(e&&!r)for(;!u[0].nextSibling&&!h;){C=u.parent();if(C._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){r=s;h||C._4e_equals(x);break}u=C;A=s;h=u._4e_equals(x);B=s}A&&e.setEndAt(u,k.POSITION_AFTER_END);u=u._4e_nextSourceNode(B,null,x);if((h=!u)||r&&e)break}if(!b){if(!e){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}b=new d(e.startContainer);u=b.blockLimit;r={div:1,th:1,td:1};b=b.block;if((!b||!b[0])&&!this.enforceRealBlocks&&r[u._4e_name()]&&e.checkStartOfBlock()&&e.checkEndOfBlock())b=u;else if(!b||this.enforceRealBlocks&&b._4e_name()=="li"){b=new f(this.range.document.createElement(l||"p"));b[0].appendChild(e.extractContents());b._4e_trim();e.insertNode(b);t=y=s}else if(b._4e_name()!="li"){if(!e.checkStartOfBlock()||!e.checkEndOfBlock()){b=b._4e_clone(o);
b[0].appendChild(e.extractContents());b._4e_trim();y=e.splitBlock();t=!y.wasStartOfBlock;y=!y.wasEndOfBlock;e.insertNode(b)}}else if(!h)this._.nextNode=b._4e_equals(x)?null:e.getBoundaryNodes().endNode._4e_nextSourceNode(s,null,x)}if(t){e=new f(b[0].previousSibling);if(e[0]&&e[0].nodeType==c.NODE_ELEMENT)if(e._4e_name()=="br")e._4e_remove();else e[0].lastChild&&i._4e_name(e[0].lastChild)=="br"&&i._4e_remove(e[0].lastChild)}if(y){e=n.bookmark(o,s);t=new f(b[0].lastChild);if(t[0]&&t[0].nodeType==c.NODE_ELEMENT&&
t._4e_name()=="br")if(q.ie||t._4e_previous(e)||t._4e_next(e))t._4e_remove()}if(!this._.nextNode)this._.nextNode=h||b._4e_equals(x)?null:b._4e_nextSourceNode(s,null,x);return b}});j.prototype.createIterator=function(){return new p(this)}});
KISSY.Editor.add("selection",function(g){function p(u){this.document=this.document=u;this._={cache:{}};if(k.ie){var r=this.getNative().createRange();if(!r||r.item&&r.item(0).ownerDocument!=u||r.parentElement&&r.parentElement().ownerDocument!=u)this.isInvalid=m}}function s(u){u=new p(u);return!u||u.isInvalid?n:u}function o(u){var r=u.document,A=new f(r.body),B=new f(r.documentElement);if(k.ie){if(k.ie<8||document.documentMode==7)B.on("click",function(N){(new f(N.target))._4e_name()==="html"&&u.getSelection().getRanges()[0].select()});
var C,v,z=1;B.on("mousedown",function(){z=0});B.on("mouseup",function(){z=1});A.on("focusin",function(N){if((new f(N.target))._4e_name()=="body")if(C){try{z&&C.select()}catch(Q){}C=n}});A.on("focus",function(){v=m;F()});A.on("beforedeactivate",function(N){if(!N.relatedTarget){v=q;z=1}});d.on(c._4e_getWin(r),"blur",function(){r&&r.selection.empty()});A.on("mousedown",function(){E()});A.on("mouseup",function(){v=m;setTimeout(function(){F(m)},0)});var E=function(){v=q},F=function(N){if(v){var Q=u.document,
R=u.getSelection(),V=R&&R.getType(),T=R&&R.getNative();if(N&&T&&V==i.SELECTION_NONE)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){F(m)},50);return}var U;if(!(T&&V==i.SELECTION_TEXT&&(U=c._4e_name(T.createRange().parentElement()))&&U in{input:1,textarea:1})){C=T&&R.getRanges()[0];u._monitor()}}};A.on("keydown",E);A.on("keyup",function(){v=m;F()});d.on(r,"selectionchange",F)}else{d.on(r,"mouseup",u._monitor,u);d.on(r,"keyup",u._monitor,u)}var D={table:1,pre:1},G=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
M=g.Walker.whitespaces(m);u.on("selectionChange",function(N){var Q=N.path;N=(N=N.selection)&&N.getRanges()[0];if(!(!N||!N.collapsed||Q.block))if(Q.blockLimit._4e_name()=="body"){Q=N.fixBlock(m,"p");if(Q._4e_outerHtml().match(G)){var R=Q._4e_next(M);if(R&&R[0].nodeType==l.NODE_ELEMENT&&!D[R._4e_name()]){N.moveToElementEditablePosition(R);Q._4e_remove()}else if((R=Q._4e_previous(M))&&R[0].nodeType==l.NODE_ELEMENT&&!D[R._4e_name()]){N.moveToElementEditablePosition(R,R._4e_outerHtml().match(G)?q:m);Q._4e_remove()}}N.select();
k.ie||u.notifySelectionChange()}})}g.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var m=true,q=false,n=null,j=KISSY,k=j.UA,c=j.DOM,d=j.Event,f=j.Node,i=g.SELECTION,w=g.RANGE,l=g.NODE,b=g.Walker,e=g.Range,h={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};j.augment(p,{getNative:k.ie?function(){var u=this._.cache;return u.nativeSel||(u.nativeSel=this.document.selection)}:function(){var u=
this._.cache;return u.nativeSel||(u.nativeSel=c._4e_getWin(this.document).getSelection())},getType:k.ie?function(){var u=this._.cache;if(u.type)return u.type;var r=i.SELECTION_NONE;try{var A=this.getNative(),B=A.type;if(B=="Text")r=i.SELECTION_TEXT;if(B=="Control")r=i.SELECTION_ELEMENT;if(A.createRange().parentElement)r=i.SELECTION_TEXT}catch(C){}return u.type=r}:function(){var u=this._.cache;if(u.type)return u.type;var r=i.SELECTION_TEXT,A=this.getNative();if(A){if(A.rangeCount==1){A=A.getRangeAt(0);
var B=A.startContainer;if(B==A.endContainer&&B.nodeType==l.NODE_ELEMENT&&A.endOffset-A.startOffset===1&&h[B.childNodes[A.startOffset].nodeName.toLowerCase()])r=i.SELECTION_ELEMENT}}else r=i.SELECTION_NONE;return u.type=r},getRanges:k.ie?function(){var u=function(r,A){r=r.duplicate();r.collapse(A);for(var B=r.parentElement(),C=B.childNodes,v,z=0;z<C.length;z++){var E=C[z];if(E.nodeType==l.NODE_ELEMENT){v=r.duplicate();v.moveToElementText(E);E=v.compareEndPoints("StartToStart",r);var F=v.compareEndPoints("EndToStart",
r);v.collapse();if(E>0)break;else if(!E||F==1&&E==-1)return{container:B,offset:z};else if(!F)return{container:B,offset:z+1};v=n}}if(!v){v=r.duplicate();v.moveToElementText(B);v.collapse(q)}v.setEndPoint("StartToStart",r);v=v.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;v>0;)v-=C[--z].nodeValue.length}catch(D){v=0}return v===0?{container:B,offset:z}:{container:C[z],offset:-v}};return function(){var r=this._.cache;if(r.ranges)return r.ranges;var A=this.getNative(),B=A&&A.createRange(),C=this.getType();
if(!A)return[];if(C==i.SELECTION_TEXT){A=new e(this.document);C=u(B,m);A.setStart(new f(C.container),C.offset);C=u(B);A.setEnd(new f(C.container),C.offset);return r.ranges=[A]}else if(C==i.SELECTION_ELEMENT){r=r.ranges=[];for(C=0;C<B.length;C++){var v=B.item(C),z=v.parentNode,E=0;for(A=new e(this.document);E<z.childNodes.length&&z.childNodes[E]!=v;E++);A.setStart(new f(z),E);A.setEnd(new f(z),E+1);r.push(A)}return r}return r.ranges=[]}}():function(){var u=this._.cache;if(u.ranges)return u.ranges;
var r=[],A=this.getNative();if(!A)return[];for(var B=0;B<A.rangeCount;B++){var C=A.getRangeAt(B),v=new e(this.document);v.setStart(new f(C.startContainer),C.startOffset);v.setEnd(new f(C.endContainer),C.endOffset);r.push(v)}return u.ranges=r},getStartElement:function(){var u=this._.cache;if(u.startElement!==undefined)return u.startElement;var r,A=this.getNative();switch(this.getType()){case i.SELECTION_ELEMENT:return this.getSelectedElement();case i.SELECTION_TEXT:var B=this.getRanges()[0];if(B)if(!B.collapsed){for(B.optimize();m;){r=
B.startContainer;if(B.startOffset==(r[0].nodeType===l.NODE_ELEMENT?r[0].childNodes.length:r[0].nodeValue.length)&&!r._4e_isBlockBoundary())B.setStartAfter(r);else break}r=B.startContainer;if(r[0].nodeType!=l.NODE_ELEMENT)return r.parent();r=new f(r[0].childNodes[B.startOffset]);if(!r[0]||r[0].nodeType!=l.NODE_ELEMENT)return B.startContainer;for(B=r[0].firstChild;B&&B.nodeType==l.NODE_ELEMENT;){r=new f(B);B=B.firstChild}return r}if(k.ie){B=A.createRange();B.collapse(m);r=B.parentElement()}else if((r=
A.anchorNode)&&r.nodeType!=l.NODE_ELEMENT)r=r.parentNode}return u.startElement=r?c._4e_wrap(r):n},getSelectedElement:function(){var u=this,r,A=u._.cache;if(A.selectedElement!==undefined)return A.selectedElement;if(k.ie){r=u.getNative().createRange();r=r.item&&r.item(0)}r||(r=function(){for(var B=u.getRanges()[0],C,v,z=2;z&&!((C=B.getEnclosedNode())&&C[0].nodeType==l.NODE_ELEMENT&&h[C._4e_name()]&&(v=C));z--)B.shrink(w.SHRINK_ELEMENT);return v&&v[0]}());return A.selectedElement=c._4e_wrap(r)},reset:function(){this._.cache=
{}},selectElement:function(u){var r;if(k.ie)try{r=this.document.body.createControlRange();r.addElement(u[0]);r.select()}catch(A){r=this.document.body.createTextRange();r.moveToElementText(u[0]);r.select()}finally{}else{r=this.document.createRange();r.selectNode(u[0]);u=this.getNative();u.removeAllRanges();u.addRange(r)}this.reset()},selectRanges:function(u){if(k.ie){if(u.length>1){var r=u[u.length-1];u[0].setEnd(r.endContainer,r.endOffset);u.length=1}u[0]&&u[0].select()}else{r=this.getNative();if(!r)return;
r.removeAllRanges();for(var A=0;A<u.length;A++){var B=u[A],C=this.document.createRange(),v=B.startContainer;B.collapsed&&k.gecko&&k.gecko<1.09&&v[0].nodeType==l.NODE_ELEMENT&&!v[0].childNodes.length&&v[0].appendChild(this.document.createTextNode(""));C.setStart(v[0],B.startOffset);C.setEnd(B.endContainer[0],B.endOffset);r.addRange(C)}}this.reset()},createBookmarks2:function(u){for(var r=[],A=this.getRanges(),B=0;B<A.length;B++)r.push(A[B].createBookmark2(u));return r},createBookmarks:function(u,r){var A=
[],B=this.document,C;r=r||this.getRanges();for(var v=r.length,z=0;z<v;z++){A.push(C=r[z].createBookmark(u,m));var E=(u=C.serializable)?j.one("#"+C.startNode,B):C.startNode;C=u?j.one("#"+C.endNode,B):C.endNode;for(var F=z+1;F<v;F++){var D=r[F],G=D.startContainer,M=D.endContainer;c._4e_equals(G,E.parent())&&D.startOffset++;c._4e_equals(G,C.parent())&&D.startOffset++;c._4e_equals(M,E.parent())&&D.endOffset++;c._4e_equals(M,C.parent())&&D.endOffset++}}return A},selectBookmarks:function(u){for(var r=[],
A=0;A<u.length;A++){var B=new e(this.document);B.moveToBookmark(u[A]);r.push(B)}this.selectRanges(r);return this},getCommonAncestor:function(){var u=this.getRanges();return u[0].startContainer._4e_commonAncestor(u[u.length-1].endContainer)},scrollIntoView:function(){var u=this.getStartElement();u&&u._4e_scrollIntoView()},removeAllRanges:function(){var u=this.getNative();if(k.ie)u&&u.clear();else u&&u.removeAllRanges()}});var t={table:1,tbody:1,tr:1},y=b.whitespaces(m),x=/\ufeff|\u00a0/;e.prototype.select=
e.prototype.select=k.ie?function(u){var r=this.collapsed,A,B;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var C=this.startContainer[0].childNodes[this.startOffset];if(C.nodeType==l.NODE_ELEMENT){(new p(this.document)).selectElement(new f(C));return}}if(this.startContainer[0].nodeType==l.NODE_ELEMENT&&this.startContainer._4e_name()in t||this.endContainer[0].nodeType==l.NODE_ELEMENT&&this.endContainer._4e_name()in t)this.shrink(w.SHRINK_ELEMENT,m);var v=this.createBookmark();
C=v.startNode;var z;if(!r)z=v.endNode;v=this.document.body.createTextRange();v.moveToElementText(C[0]);v.moveStart("character",1);if(z){u=this.document.body.createTextRange();u.moveToElementText(z[0]);v.setEndPoint("EndToEnd",u);v.moveEnd("character",-1)}else{for(A=C[0].nextSibling;A&&!y(A);)A=A.nextSibling;A=!(A&&A.nodeValue&&A.nodeValue.match(x))&&(u||!C[0].previousSibling||C[0].previousSibling&&c._4e_name(C[0].previousSibling)=="br");B=this.document.createElement("span");B.innerHTML="&#65279;";
B=(new f(B)).insertBefore(C);A&&c.insertBefore(this.document.createTextNode("\ufeff"),C)}this.setStartBefore(C);C._4e_remove();if(r){if(A){v.moveStart("character",-1);v.select();this.document.selection.clear()}else v.select();if(B){this.moveToPosition(B,w.POSITION_BEFORE_START);B._4e_remove()}}else{this.setEndBefore(z);z._4e_remove();v.select()}}:function(){var u=this.startContainer;this.collapsed&&u[0].nodeType==l.NODE_ELEMENT&&!u[0].childNodes.length&&u[0].appendChild(this.document.createTextNode(""));
var r=this.document.createRange();r.setStart(u[0],this.startOffset);try{r.setEnd(this.endContainer[0],this.endOffset)}catch(A){if(A.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(m);r.setEnd(this.endContainer[0],this.endOffset)}else throw A;}u=s(this.document).getNative();u.removeAllRanges();u.addRange(r)};p.getSelection=s;g.Selection=p;g.Selection=p;b=p.prototype;g.Utils.extern(b,{getNative:b.getNative,getType:b.getType,getRanges:b.getRanges,getStartElement:b.getStartElement,getSelectedElement:b.getSelectedElement,
reset:b.reset,selectElement:b.selectElement,selectRanges:b.selectRanges,createBookmarks2:b.createBookmarks2,createBookmarks:b.createBookmarks,getCommonAncestor:b.getCommonAncestor,scrollIntoView:b.scrollIntoView,selectBookmarks:b.selectBookmarks,removeAllRanges:b.removeAllRanges});g.on("instanceCreated",function(u){o(u.editor)})});
KISSY.Editor.add("styles",function(g){function p(H,L){for(var J in H)H[J]=H[J].replace(U,function(I,K){return L[K]})}function s(H,L){if(L){H=A.clone(H);p(H.attributes,L);p(H.styles,L)}var J=this.element=this.element=(H.element||"*").toLowerCase();this.type=this.type=J=="#"||R[J]?v.STYLE_BLOCK:V[J]?v.STYLE_OBJECT:v.STYLE_INLINE;this._={definition:H}}function o(H,L){var J=L?this.removeFromRange:this.applyToRange;H.body.focus();for(var I=new E(H),K=I.getRanges(),P=0;P<K.length;P++)J.call(this,K[P]);
I.selectRanges(K)}function m(H,L){var J;J=H.element;if(J=="*")J="span";J=new M(L.createElement(J));return q(J,H)}function q(H,L){var J=L._.definition,I=J.attributes;J=s.getStyleText(J);if(I)for(var K in I)H.attr(K,I[K]);if(J)H[0].style.cssText=J;return H}function n(H){var L=H.createBookmark(x),J=H.createIterator();J.enforceRealBlocks=x;J.enlargeBr=x;for(var I,K=H.document;I=J.getNextParagraph();){var P=m(this,K);I=I;var O=P;P=O._4e_name=="pre";var S=I._4e_name=="pre",$=!P&&S;if(P&&!S){S=I;O=O;$=S.html();
$=j($,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");$=$.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");$=$.replace(/([ \t\n\r]+|&nbsp;)/g," ");$=$.replace(/<br\b[^>]*>/gi,"\n");if(N.ie){S=S[0].ownerDocument.createElement("div");S.appendChild(O[0]);O[0].outerHTML="<pre>"+$+"</pre>";O=new M(S.firstChild);O._4e_remove()}else O.html($);O=O}else if($)O=c(k(I),O);else I._4e_moveChildren(O);I[0].parentNode.replaceChild(O[0],I[0]);if(P){I=O;P=void 0;if((P=I._4e_previousSourceNode(x,F.NODE_ELEMENT))&&P._4e_name()==
"pre"){O=j(P.html(),/\n$/,"")+"\n\n"+j(I.html(),/^\n/,"");if(N.ie)I[0].outerHTML="<pre>"+O+"</pre>";else I.html(O);P._4e_remove()}}}H.moveToBookmark(L)}function j(H,L,J){var I="",K="";H=H.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(P,O,S){O&&(I=O);S&&(K=S);return""});return I+H.replace(L,J)+K}function k(H){var L=[];j(H._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(J,I,K){return I+"</pre>"+K+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(J,I){L.push(I)});return L}function c(H,L){for(var J=L[0].ownerDocument.createDocumentFragment(),I=0;I<H.length;I++){var K=H[I];K=K.replace(/(\r\n|\r)/g,"\n");K=j(K,/^[ \t]*\n/,"");K=j(K,/\n$/,"");K=j(K,/^[ \t]+|[ \t]+$/g,function(O,S){return O.length==1?"&nbsp;":S?" "+Array(O.length).join("&nbsp;"):Array(O.length).join("&nbsp;")+" "});K=K.replace(/\n/g,"<br>");K=K.replace(/[ \t]{2,}/g,function(O){return Array(O.length).join("&nbsp;")+" "});var P=L._4e_clone();P.html(K);J.appendChild(P[0])}return J}
function d(H){var L=H.document;if(H.collapsed){L=m(this,L);H.insertNode(L);H.moveToPosition(L,z.POSITION_BEFORE_END)}else{var J=this.element,I=this._.definition,K,P=g.XHTML_DTD[J]||(K=x,g.XHTML_DTD.span),O=H.createBookmark();H.enlarge(z.ENLARGE_ELEMENT);H.trim();var S=H.createBookmark(),$=S.startNode;S=S.endNode;for(var Y=$,aa;Y&&Y[0];){var X=u;if(C._4e_equals(Y,S)){Y=r;X=x}else{var Z=Y[0].nodeType,da=Z==F.NODE_ELEMENT?Y._4e_name():r;if(da&&Y.attr("_ke_bookmark")){Y=Y._4e_nextSourceNode(x);continue}if(!da||
P[da]&&(Y._4e_position(S)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(Y))){var ea=Y.parent();if(ea&&ea[0]&&((g.XHTML_DTD[ea._4e_name()]||g.XHTML_DTD.span)[J]||K)&&(!I.parentRule||I.parentRule(ea))){if(!aa&&(!da||!g.XHTML_DTD.$removeEmpty[da]||(Y._4e_position(S)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED)){aa=
new G(L);aa.setStartBefore(Y)}if(Z==F.NODE_TEXT||Z==F.NODE_ELEMENT&&!Y[0].childNodes.length){Z=Y;var ba;for(da=Z._4e_next(function(ga){return!ga.attr("_ke_bookmark")});!da&&(ba=Z.parent(),P[ba._4e_name()])&&(ba._4e_position($)|D.POSITION_FOLLOWING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_FOLLOWING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(ba));)Z=ba;aa.setEndAfter(Z);Z[0].nextSibling||(X=x)}}else X=x}else X=x;Y=Y._4e_nextSourceNode()}if(X&&aa&&!aa.collapsed){X=
m(this,L);for(Z=aa.getCommonAncestor();X&&Z&&X[0]&&Z[0];){if(Z._4e_name()==J){for(var ca in I.attributes)X.attr(ca)==Z.attr(ca)&&X[0].removeAttribute(ca);for(var fa in I.styles)X._4e_style(fa)==Z._4e_style(fa)&&X._4e_style(fa,"");if(!X._4e_hasAttributes()){X=r;break}}Z=Z.parent()}if(X){X[0].appendChild(aa.extractContents());h(this,X);aa.insertNode(X);X._4e_mergeSiblings();N.ie||X[0].normalize()}aa=r}}$._4e_remove();S._4e_remove();H.moveToBookmark(O);H.shrink(z.SHRINK_TEXT)}}function f(H){H.enlarge(z.ENLARGE_ELEMENT);
var L=H.createBookmark(),J=L.startNode;if(H.collapsed){for(var I=new Q(J.parent()),K,P=0,O;P<I.elements.length&&(O=I.elements[P]);P++){if(O==I.block||O==I.blockLimit)break;if(this.checkElementRemovable(O)){var S=H.checkBoundaryOfElement(O,z.END),$=!S&&H.checkBoundaryOfElement(O,z.START);if($||S){K=O;K.match=$?"start":"end"}else{O._4e_mergeSiblings();O._4e_name()==this.element?b(this,O):t(O,l(this)[O._4e_name()])}}}if(K&&K[0]){O=J;for(P=0;;P++){S=I.elements[P];if(C._4e_equals(S,K))break;else if(S.match)continue;
else S=S._4e_clone();S[0].appendChild(O[0]);O=S}C[K.match=="start"?"insertBefore":"insertAfter"](O,K)}}else{var Y=L.endNode,aa=this;I=function(){for(var X=new Q(J.parent()),Z=new Q(Y.parent()),da=r,ea=r,ba=0;ba<X.elements.length;ba++){var ca=X.elements[ba];if(ca==X.block||ca==X.blockLimit)break;if(aa.checkElementRemovable(ca))da=ca}for(ba=0;ba<Z.elements.length;ba++){ca=Z.elements[ba];if(ca==Z.block||ca==Z.blockLimit)break;if(aa.checkElementRemovable(ca))ea=ca}ea&&Y._4e_breakParent(ea);da&&J._4e_breakParent(da)};
I();for(K=new M(J[0].nextSibling);K[0]!==Y[0];){P=K._4e_nextSourceNode();if(K[0]&&K[0].nodeType==F.NODE_ELEMENT&&this.checkElementRemovable(K)){K._4e_name()==this.element?b(this,K):t(K,l(this)[K._4e_name()]);if(P[0].nodeType==F.NODE_ELEMENT&&P.contains(J)){I();P=new M(J[0].nextSibling)}}K=P}}H.moveToBookmark(L)}function i(H){var L={};H.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(J,I,K){L[I]=K});return L}function w(H,L){var J;if(L!==u){J=document.createElement("span");
J.style.cssText=H;J=J.style.cssText||""}else J=H;return J.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function l(H){if(H._.overrides)return H._.overrides;var L=H._.overrides={},J=H._.definition.overrides;if(J){A.isArray(J)||(J=[J]);for(var I=0;I<J.length;I++){var K=J[I],P,O;if(typeof K=="string")P=K.toLowerCase();else{P=K.element?K.element.toLowerCase():H.element;O=K.attributes}K=L[P]||(L[P]={});if(O){K=K.attributes=K.attributes||[];for(var S in O)K.push([S.toLowerCase(),
O[S]])}}}return L}function b(H,L){var J=H._.definition,I=B.mix(J.attributes,l(H)[L._4e_name()]);J=J.styles;var K=A.isEmptyObject(I)&&A.isEmptyObject(J),P;for(P in I)if(!((P=="class"||H._.definition.fullMatch)&&L.attr(P)!=e(P,I[P]))){K=K||!!L._4e_hasAttribute(P);L.removeAttr(P)}for(var O in J)if(!(H._.definition.fullMatch&&L._4e_style(O)!=e(O,J[O],x))){K=K||!!L._4e_style(O);L._4e_style(O,"")}y(L)}function e(H,L,J){var I=new M("<span>");I[J?"_4e_style":"attr"](H,L);return I[J?"_4e_style":"attr"](H)}
function h(H,L){for(var J=l(H),I=L.all(H.element),K=I.length;--K>=0;)b(H,new M(I[K]));for(var P in J)if(P!=H.element){I=L.all(P);for(K=I.length-1;K>=0;K--){var O=new M(I[K]);t(O,J[P])}}}function t(H,L){var J=L&&L.attributes;if(J)for(var I=0;I<J.length;I++){var K=J[I][0],P;if(P=H.attr(K)){var O=J[I][1];if(O===r||O.test&&O.test(P)||typeof O=="string"&&P==O)H[0].removeAttribute(K)}}y(H)}function y(H){if(!H._4e_hasAttributes()){var L=H[0].firstChild,J=H[0].lastChild;H._4e_remove(x);if(L){L.nodeType==
F.NODE_ELEMENT&&C._4e_mergeSiblings(L);J&&L!=J&&J.nodeType==F.NODE_ELEMENT&&C._4e_mergeSiblings(J)}}}var x=true,u=false,r=null,A=KISSY,B=g.Utils,C=A.DOM,v={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},z=g.RANGE,E=g.Selection,F=g.NODE,D=g.POSITION,G=g.Range,M=A.Node,N=A.UA,Q=g.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},V={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},T=/\s*(?:;\s*|$)/g,U=/#\((.+?)\)/g;g.STYLE=v;s.prototype={apply:function(H){o.call(this,
H,u)},remove:function(H){o.call(this,H,x)},applyToRange:function(H){return(this.applyToRange=this.type==v.STYLE_INLINE?d:this.type==v.STYLE_BLOCK?n:this.type==v.STYLE_OBJECT?r:r).call(this,H)},removeFromRange:function(H){return(this.removeFromRange=this.type==v.STYLE_INLINE?f:r).call(this,H)},applyToObject:function(H){q(H,this)},checkElementRemovable:function(H,L){if(!H)return u;var J=this._.definition;if(H._4e_name()==this.element){if(!L&&!H._4e_hasAttributes())return x;var I=J._AC;if(I)J=I;else{I=
{};var K=0,P=J.attributes;if(P)for(var O in P){K++;I[O]=P[O]}if(P=s.getStyleText(J)){I.style||K++;I.style=P}I._length=K;J=J._AC=I}if(J._length){for(var S in J)if(S!="_length"){K=H.attr(S)||"";if(S=="style")a:{I=J[S];K=w(K,u);typeof I=="string"&&(I=i(I));typeof K=="string"&&(K=i(K));P=void 0;for(P in I)if(!(P in K&&(K[P]==I[P]||I[P]=="inherit"||K[P]=="inherit"))){I=u;break a}I=x}else I=J[S]==K;if(I){if(!L)return x}else if(L)return u}if(L)return x}else return x}if(S=l(this)[H._4e_name()]){if(!(J=S.attributes))return x;
for(I=0;I<J.length;I++){S=J[I][0];if(S=H.attr(S)){K=J[I][1];if(K===r||typeof K=="string"&&S==K||K.test&&K.test(S))return x}}}return u},checkActive:function(H){switch(this.type){case v.STYLE_BLOCK:return this.checkElementRemovable(H.block||H.blockLimit,x);case v.STYLE_OBJECT:case v.STYLE_INLINE:for(var L=H.elements,J=0,I;J<L.length;J++){I=L[J];if(!(this.type==v.STYLE_INLINE&&(C._4e_equals(I,H.block)||C._4e_equals(I,H.blockLimit))))if(!(this.type==v.STYLE_OBJECT&&!(I._4e_name()in V)))if(this.checkElementRemovable(I,
x))return x}}return u}};s.getStyleText=function(H){var L=H._ST;if(L)return L;L=H.styles;var J=H.attributes&&H.attributes.style||"",I="";if(J.length)J=J.replace(T,";");for(var K in L){var P=L[K],O=(K+":"+P).replace(T,";");if(P=="inherit")I+=O;else J+=O}if(J.length)J=w(J);J+=I;return H._ST=J};g.Style=s;g.Style=s;var W=s.prototype;g.Utils.extern(W,{apply:W.apply,remove:W.remove,applyToRange:W.applyToRange,removeFromRange:W.removeFromRange,applyToObject:W.applyToObject,checkElementRemovable:W.checkElementRemovable,
checkActive:W.checkActive})});
KISSY.Editor.add("htmlparser",function(){function g(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var p=KISSY,s=function(){},o=p.Editor,m=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,q={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},n=o.XHTML_DTD;p.augment(g,{onTagOpen:s,onTagClose:s,
onText:s,onCDATA:s,onComment:s,parse:function(j){for(var k,c,d=0,f;k=this._.htmlPartsRegex.exec(j);){c=k.index;if(c>d){d=j.substring(d,c);f?f.push(d):this.onText(d)}d=this._.htmlPartsRegex.lastIndex;if(c=k[1]){c=c.toLowerCase();if(f&&n.$cdata[c]){this.onCDATA(f.join(""));f=null}if(!f){this.onTagClose(c);continue}}if(f)f.push(k[0]);else if(c=k[3]){c=c.toLowerCase();if(!/="/.test(c)){var i={},w;k=k[4];var l=!!(k&&k.charAt(k.length-1)=="/");if(k)for(;w=m.exec(k);){var b=w[1].toLowerCase();w=w[2]||w[3]||
w[4]||"";i[b]=!w&&q[b]?b:w}this.onTagOpen(c,i,l);if(!f&&n.$cdata[c])f=[]}}else if(c=k[2])this.onComment(c)}j.length>d&&this.onText(j.substring(d,j.length))}});o.HtmlParser=g;o.HtmlParser=g});
KISSY.Editor.add("htmlparser-basicwriter",function(){function g(){this._={output:[]}}var p=KISSY,s=p.Editor,o=s.Utils;p.augment(g,{openTag:function(m){this._.output.push("<",m)},openTagClose:function(m,q){q?this._.output.push(" />"):this._.output.push(">")},attribute:function(m,q){if(typeof q=="string")q=o.htmlEncodeAttr(q);this._.output.push(" ",m,'="',q,'"')},closeTag:function(m){this._.output.push("</",m,">")},text:function(m){this._.output.push(m)},comment:function(m){this._.output.push("<!--",
m,"--\>")},write:function(m){this._.output.push(m)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(m){var q=this._.output.join("");m&&this.reset();return q}});s.HtmlParser.BasicWriter=g;s.HtmlParser.BasicWriter=g;p=g.prototype;s.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,write:p.write,reset:p.reset,getHtml:p.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function g(){g.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=q;this.sortAttributes=m;this._.indent=q;this._.indentation="";this._.rules={};var n=s.XHTML_DTD,j;for(j in o.mix({},n.$nonBodyContent,n.$block,n.$listItem,n.$tableContent))this.setRules(j,{indent:m,breakBeforeOpen:m,breakAfterOpen:m,breakBeforeClose:!n[j]["#"],breakAfterClose:m});this.setRules("br",
{breakAfterOpen:m});this.setRules("title",{indent:q,breakAfterOpen:q});this.setRules("style",{indent:q,breakBeforeClose:m});this.setRules("pre",{indent:q})}var p=KISSY,s=p.Editor,o=s.Utils,m=true,q=false;p.extend(g,s.HtmlParser.BasicWriter,{openTag:function(n){var j=this._.rules[n];if(this._.indent)this.indentation();else if(j&&j.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",n)},openTagClose:function(n,j){var k=this._.rules[n];if(j)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(k&&k.indent)this._.indentation+=this.indentationChars}k&&k.breakAfterOpen&&this.lineBreak()},attribute:function(n,j){if(typeof j=="string"){this.forceSimpleAmpersand&&(j=j.replace(/&amp;/g,"&"));j=o.htmlEncodeAttr(j)}this._.output.push(" ",n,'="',j,'"')},closeTag:function(n){var j=this._.rules[n];if(j&&j.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(j&&j.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",n,">");j&&j.breakAfterClose&&this.lineBreak()},text:function(n){if(this._.indent){this.indentation();n=o.ltrim(n)}this._.output.push(n)},comment:function(n){this._.indent&&this.indentation();this._.output.push("<!--",n,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=m},indentation:function(){this._.output.push(this._.indentation);this._.indent=q},setRules:function(n,j){var k=this._.rules[n];if(k)o.mix(k,
j);else this._.rules[n]=j}});s.HtmlParser.HtmlWriter=g;s.HtmlParser.HtmlWriter=g;p=g.prototype;s.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,lineBreak:p.lineBreak,indentation:p.indentation,setRules:p.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function g(){this.children=[];this.parent=o;this._={isBlockLike:p,hasInlineStarted:s}}var p=true,s=false,o=null,m=KISSY.Editor,q={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},n=KISSY,j=m.Utils,k=m.NODE,c=m.XHTML_DTD,d=j.mix({table:1,ul:1,ol:1,dl:1},c.table,c.ul,c.ol,c.dl),f=c.$list,i=c.$listItem;g.FromHtml=function(w,l){function b(z){var E;if(x.length>0)for(var F=0;F<x.length;F++){var D=x[F],G=D.name,M=c[G],N=r.name&&c[r.name];
if((!N||N[G])&&(!z||!M||M[z]||!c[z])){if(!E){e();E=1}D=D.clone();D.parent=r;r=D;x.splice(F,1);F--}}}function e(){for(;u.length;)r.add(u.shift())}function h(z,E,F){E=E||r||y;if(l&&!E.type){var D,G;if((D=z.attributes&&(G=z.attributes._ke_real_element_type)?G:z.name)&&!(D in c.$body)&&!(D in c.$nonBodyContent)){D=r;r=E;t.onTagOpen(l,{});E=r;if(F)r=D}}if(z._.isBlockLike&&z.name!="pre"){F=z.children.length;if((D=z.children[F-1])&&D.type==k.NODE_TEXT)if(G=j.rtrim(D.value))D.value=G;else z.children.length=
F-1}E.add(z);if(z.returnPoint){r=z.returnPoint;delete z.returnPoint}}var t=new m.HtmlParser,y=new g,x=[],u=[],r=y,A=s,B;t.onTagOpen=function(z,E,F){var D=new m.HtmlParser.Element(z,E);if(D.isUnknown&&F)D.isEmpty=p;if(c.$removeEmpty[z])x.push(D);else{if(z=="pre")A=p;else if(z=="br"&&A){r.add(new m.HtmlParser.Text("\n"));return}if(z=="br")u.push(D);else{var G=r.name,M=G&&(c[G]||(r._.isBlockLike?c.div:c.span));if(M&&!D.isUnknown&&!r.isUnknown&&!M[z]){M=s;var N;if(z in f&&G in f){G=r.children;(G=G[G.length-
1])&&G.name in i||h(G=new m.HtmlParser.Element("li"),r);B=r;N=G}else if(z==G)h(r,r.parent);else{if(d[G])B||(B=r);else{h(r,r.parent,p);q[G]||x.unshift(r)}M=p}r=N?N:r.returnPoint||r.parent;if(M){t.onTagOpen.apply(this,arguments);return}}b(z);e();D.parent=r;D.returnPoint=B;B=0;if(D.isEmpty)h(D);else r=D}}};t.onTagClose=function(z){for(var E=x.length-1;E>=0;E--)if(z==x[E].name){x.splice(E,1);return}for(var F=[],D=[],G=r;G.type&&G.name!=z;){G._.isBlockLike||D.unshift(G);F.push(G);G=G.parent}if(G.type){for(E=
0;E<F.length;E++){var M=F[E];h(M,M.parent)}r=G;if(r.name=="pre")A=s;G._.isBlockLike&&e();h(G,G.parent);if(G==r)r=r.parent;x=x.concat(D)}if(z=="body")l=s};t.onText=function(z){if(!r._.hasInlineStarted&&!A){z=j.ltrim(z);if(z.length===0)return}e();b();if(l&&(!r.type||r.name=="body")&&j.trim(z))this.onTagOpen(l,{});A||(z=z.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));r.add(new m.HtmlParser.Text(z))};t.onCDATA=function(){};t.onComment=function(z){r.add(new m.HtmlParser.Comment(z))};t.parse(w);for(e();r.type;){var C=
r.parent,v=r;if(l&&(!C.type||C.name=="body")&&!c.$body[v.name]){r=C;t.onTagOpen(l,{});C=r}C.add(v);r=C}return y};n.augment(g,{add:function(w){var l=this.children.length;if(l=l>0&&this.children[l-1]||o){if(w._.isBlockLike&&l.type==k.NODE_TEXT){l.value=j.rtrim(l.value);if(l.value.length===0){this.children.pop();this.add(w);return}}l.next=w}w.previous=l;w.parent=this;this.children.push(w);this._.hasInlineStarted=w.type==k.NODE_TEXT||w.type==k.NODE_ELEMENT&&!w._.isBlockLike},writeHtml:function(w,l){var b;
this.filterChildren=this.filterChildren=function(){var e=new m.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,e,l,p);e=e.getHtml();this.children=(new g.FromHtml(e)).children;b=1};!this.name&&l&&l.onFragment(this);this.writeChildrenHtml(w,b?o:l)},writeChildrenHtml:function(w,l){for(var b=0;b<this.children.length;b++)this.children[b].writeHtml(w,l)}});m.HtmlParser.Fragment=g;m.HtmlParser.Fragment=g;g.FromHtml=g.FromHtml;n=g.prototype;m.Utils.extern(n,{add:n.add,writeHtml:n.writeHtml,writeChildrenHtml:n.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function g(q,n){this.name=q;this.attributes=n||(n={});this.children=[];var j=n._ke_real_element_type||q,k=p.XHTML_DTD;j=!!(k.$nonBodyContent[j]||k.$block[j]||k.$listItem[j]||k.$tableContent[j]||k.$nonEditable[j]||j=="br");var c=!!k.$empty[q];this.isEmpty=c;this.isUnknown=!k[q];this._={isBlockLike:j,hasInlineStarted:c||!j}}var p=KISSY.Editor,s=p.NODE,o=function(q,n){q=q[0];n=n[0];return q<n?-1:q>n?1:0};KISSY.augment(g,{type:s.NODE_ELEMENT,add:p.HtmlParser.Fragment.prototype.add,
clone:function(){return new g(this.name,this.attributes)},writeHtml:function(q,n){var j=this.attributes,k=this,c=k.name,d,f,i,w;k.filterChildren=function(){if(!w){var e=new p.HtmlParser.BasicWriter;p.HtmlParser.Fragment.prototype.writeChildrenHtml.call(k,e,n);k.children=(new p.HtmlParser.Fragment.FromHtml(e.getHtml())).children;w=1}};k.filterChildren=k.filterChildren;if(n){for(;;){if(!(c=n.onElementName(c)))return;k.name=c;if(!(k=n.onElement(k)))return;k.parent=this.parent;if(k.name==c)break;if(k.type!=
s.NODE_ELEMENT){k.writeHtml(q,n);return}c=k.name;if(!c){this.writeChildrenHtml.call(k,q,w?null:n);return}}j=k.attributes}q.openTag(c,j);for(var l=[],b=0;b<2;b++)for(d in j){f=d;i=j[d];if(b==1)l.push([d,i]);else if(n){for(;;)if(f=n.onAttributeName(d))if(f!=d){delete j[d];d=f}else break;else{delete j[d];break}if(f)if((i=n.onAttribute(k,f,i))===false)delete j[f];else j[f]=i}}q.sortAttributes&&l.sort(o);j=l.length;for(b=0;b<j;b++){d=l[b];q.attribute(d[0],d[1])}q.openTagClose(c,k.isEmpty);if(!k.isEmpty){this.writeChildrenHtml.call(k,
q,w?null:n);q.closeTag(c)}},writeChildrenHtml:function(){p.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});p.HtmlParser.Element=g;p.HtmlParser.Element=g;var m=g.prototype;p.Utils.extern(m,{type:m.type,add:m.add,clone:m.clone,writeHtml:m.writeHtml,writeChildrenHtml:m.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function g(d){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};d&&this.addRules(d,10)}function p(d,f){for(var i=0;d&&i<f.length;i++){var w=f[i];d=d.replace(w[0],w[1])}return d}function s(d,f,i){if(typeof f=="function")f=[f];var w,l;l=d.length;var b=f&&f.length;if(b){for(w=0;w<l&&d[w].pri<i;w++);for(l=b-1;l>=0;l--)if(b=f[l]){b.pri=i;d.splice(w,0,b)}}}function o(d,f,i){if(f)for(var w in f){var l=d[w];d[w]=m(l,f[w],
i);l||d.$length++}}function m(d,f,i){if(f){f.pri=i;if(d){if(d.splice)s(d,f,i);else{d=d.pri>i?[f,d]:[d,f];d.filter=q}return d}else return f.filter=f}}function q(d){for(var f=d.type||d instanceof j.HtmlParser.Fragment,i=0;i<this.length;i++){if(f)var w=d.type,l=d.name;var b=this[i].apply(window,arguments);if(b===c)return b;if(f){if(b&&(b.name!=l||b.type!=w))return b}else if(typeof b!="string")return b;b!=undefined&&(d=b)}return d}var n=KISSY,j=n.Editor,k=j.NODE,c=false;n.augment(g,{addRules:function(d,
f){if(typeof f!="number")f=10;s(this._.elementNames,d.elementNames,f);s(this._.attributeNames,d.attributeNames,f);o(this._.elements,d.elements,f);o(this._.attributes,d.attributes,f);this._.text=m(this._.text,d.text,f)||this._.text;this._.comment=m(this._.comment,d.comment,f)||this._.comment;this._.root=m(this._.root,d.root,f)||this._.root},onElementName:function(d){return p(d,this._.elementNames)},onAttributeName:function(d){return p(d,this._.attributeNames)},onText:function(d){var f=this._.text;
return f?f.filter(d):d},onComment:function(d,f){var i=this._.comment;return i?i.filter(d,f):d},onFragment:function(d){var f=this._.root;return f?f.filter(d):d},onElement:function(d){for(var f=[this._.elements["^"],this._.elements[d.name],this._.elements.$],i,w=0;w<3;w++)if(i=f[w]){i=i.filter(d,this);if(i===c)return null;if(i&&i!=d)return this.onNode(i);if(d.parent&&!d.name)break}return d},onNode:function(d){var f=d.type;return f==k.NODE_ELEMENT?this.onElement(d):f==k.NODE_TEXT?new j.HtmlParser.Text(this.onText(d.value)):
null},onAttribute:function(d,f,i){if(f=this._.attributes[f]){d=f.filter(i,d,this);if(d===c)return c;if(typeof d!="undefined")return d}return i}});j.HtmlParser.Filter=g;n=g.prototype;j.Utils.extern(n,{addRules:n.addRules,onElementName:n.onElementName,onAttributeName:n.onAttributeName,onText:n.onText,onComment:n.onComment,onFragment:n.onFragment,onElement:n.onElement,onNode:n.onNode,onAttribute:n.onAttribute});j.HtmlParser.Filter=g});
KISSY.Editor.add("htmlparser-text",function(){function g(m){this.value=m;this._={isBlockLike:o}}var p=KISSY,s=p.Editor,o=false;p.augment(g,{type:s.NODE.NODE_TEXT,writeHtml:function(m,q){var n=this.value;q&&!(n=q.onText(n,this))||m.text(n)}});s.HtmlParser.Text=g;s.HtmlParser.Text=g});
KISSY.Editor.add("htmlparser-comment",function(){function g(o){this.value=o;this._={isBlockLike:false}}var p=KISSY.Editor,s=p.NODE;p.HtmlParser.Comment=g;p.HtmlParser.Comment=g;g.prototype={constructor:g,type:s.NODE_COMMENT,writeHtml:function(o,m){var q=this.value;if(m){if(!(q=m.onComment(q,this)))return;if(typeof q!="string"){q.parent=this.parent;q.writeHtml(o,m);return}}o.comment(q)}}});
KISSY.Editor.add("bubbleview",function(){var g=KISSY.Editor,p=KISSY,s=p.Event,o=p.DOM;if(!g.BubbleView){var m=p.UIBase.create(g.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var n=this._selectedEl,j=n._4e_getOffset(document);j.top+=n.height()+5;m.superclass.show.call(this);this.set("xy",[j.left,j.top])}},{ATTRS:{focus4e:false,zIndex:{value:g.baseZIndex(g.zIndexManager.BUBBLE_VIEW)}}}),q={};m.attach=function(n){var j=n.pluginName;p.mix(n,q[j].cfg,
false);var k=n.pluginContext,c=n.func,d=n.editor,f=n.bubble;d.on("selectionChange",function(i){i=i.path;var w=i.elements;if(i&&w)if(i=i.lastElement)if(i=c(i)){w=q[j];if(!w.bubble){w.bubble=new m({autoRender:true});w.cfg.init&&w.cfg.init.call(w.bubble)}f=w.bubble;f._selectedEl=i;f._plugin=k;f.hide();f.show()}else if(f){f._selectedEl=f._plugin=null;f.hide()}});s.on(o._4e_getWin(d.document),"scroll blur",function(){f&&f.hide()})};m.register=function(n){var j=n.pluginName;q[j]=q[j]||{cfg:n};s.on(document,
"click",function(){n.bubble&&n.bubble.hide()});n.editor&&m.attach(n)};g.BubbleView=m}});
KISSY.Editor.add("button",function(){var g=KISSY,p=g.Editor;if(!p.TripleButton){var s=g.UIBase.create([g.UIBase.Box],{bindUI:function(){var o=this,m=o.get("el");m.on("click",o._action,o);m.on("mousedown",function(){o.get("state")=="off"&&m.addClass("ke-triplebutton-active")});m.on("mouseup mouseleave",function(){o.get("state")=="off"&&m.hasClass("ke-triplebutton-active")&&setTimeout(function(){m.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"))},
_uiSetContentCls:function(o){var m=this.get("el");if(o!==undefined){m.html("<span class='ke-toolbar-item "+o+"'>");m._4e_unselectable()}},_uiSetText:function(o){var m=this.get("el");o!==undefined&&m.html(o)},_uiSetState:function(o){this["_"+o]()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(o){this.fire(this.get("state")+"Click",o);o.type=this.get("state")+"Click";
this.fire("click",o);o.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){var o=this.get("el");o.removeClass("ke-triplebutton-off ke-triplebutton-disabled");o.addClass("ke-triplebutton-on")},_off:function(){var o=this.get("el");o.removeClass("ke-triplebutton-on ke-triplebutton-disabled");o.addClass("ke-triplebutton-off")},_disabled:function(){var o=this.get("el");o.removeClass("ke-triplebutton-off ke-triplebutton-on");o.addClass("ke-triplebutton-disabled")}},
{ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elAttrs:{href:{value:"#"}},elTagName:{value:"a"},title:{},contentCls:{},text:{}}});s.ON="on";s.OFF="off";s.DISABLED="disabled";s.ON_CLASS="ke-triplebutton-on";s.OFF_CLASS="ke-triplebutton-off";s.DISABLED_CLASS="ke-triplebutton-disabled";p.TripleButton=s;p.prototype.addButton=function(o,m){var q=this,n=new s({render:q.toolBarDiv,autoRender:true,title:m.title,text:m.text,contentCls:m.contentCls}),j={btn:n,editor:q,cfg:m,
call:function(){var k=g.makeArray(arguments),c=k.shift();return m[c].apply(j,k)},reload:function(k){g.mix(m,k);n.enable();q.on("selectionChange",function(){m.selectionChange&&m.selectionChange.apply(j,arguments)});n.on("click",function(c){var d=c.type;m[d]&&m[d].apply(j,arguments)});if(m.mode==p.WYSIWYG_MODE){q.on("wysiwygmode",n.enable,n);q.on("sourcemode",n.disable,n)}m.init&&m.init.call(j)}};m.loading?n.disable():j.reload();return j}}});
KISSY.Editor.add("clipboard",function(g){var p=KISSY,s=p.Editor,o=p.Node,m=p.UA,q=s.Range,n=s.RANGE,j=p.Event;s.Paste||function(){function k(e){this.editor=e;this._init()}function c(e){if(!(!m.ie||e.document.compatMode=="BackCompat")){var h=e.getSelection(),t;if(h.getType()==l.SELECTION_ELEMENT&&(t=h.getSelectedElement())){var y=h.getRanges()[0],x=new o(e.document.createTextNode(""));x.insertBefore(t);y.setStartBefore(x);y.setEndAfter(t);h.selectRanges([y]);setTimeout(function(){if(t.parent()){x.remove();
h.selectElement(t)}},0)}}}p.augment(k,{_init:function(){var e=this.editor;m.ie?j.on(e.document,"keydown",this._paste,this):j.on(e.document,"paste",this._paste,this);e.addCommand("copy",new w("copy"));e.addCommand("cut",new w("cut"));e.addCommand("paste",new w("paste"))},_paste:function(e){if(!(e.type==="keydown"&&!(e.keyCode===86&&(e.ctrlKey||e.metaKey)))){var h=this,t=h.editor,y=t.document;if(h._running)e.halt();else{var x=t.getSelection();e=new q(y);var u=new o(m.webkit?"<body></body>":"<div></div>",
null,y);m.webkit&&u[0].appendChild(y.createTextNode("\u00a0"));y.body.appendChild(u[0]);u.css({position:"absolute",top:x.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});u.css("left","-1000px");var r=x.createBookmarks();e.setStartAt(u,n.POSITION_AFTER_START);e.setEndAt(u,n.POSITION_BEFORE_END);e.select(true);h._running=true;setTimeout(function(){u._4e_remove();var A;u=m.webkit&&(A=u._4e_first())&&A.hasClass("Apple-style-span")?A:u;x.selectBookmarks(r);t.insertHtml(u.html());
h._running=false},0)}}}});s.Paste=k;var d=function(e,h){var t=e.document,y=new o(t.body),x=false,u=function(){x=true};y.on(h,u);(m.ie>7?t:t.selection.createRange()).execCommand(h);y.detach(h,u);return x},f=m.ie?function(e,h){return d(e,h)}:function(e,h){try{return e.document.execCommand(h)}catch(t){return false}},i={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},w=function(e){this.type=
e;this.canUndo=this.type=="cut"};w.prototype={exec:function(e){this.type=="cut"&&c(e);(e=f(e,this.type))||alert(i[this.type]);return e}};var l=s.Selection,b={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};s.on("contextmenu",function(e){var h=e.contextmenu,t=h.cfg.editor,y=h.elDom,x={copy:0,cut:0,paste:0},u;for(u in x){if(!x.hasOwnProperty(u))break;x[u]=y.one(".ke-paste-"+u);(function(r){var A=x[r];if(!A){A=(new o("<a href='#'class='ke-paste-"+r+"'>"+b[r]+"</a>")).appendTo(y);A.on("click",function(B){B.halt();if(!A.hasClass("ke-menuitem-disable")){h.hide();
setTimeout(function(){t.execCommand(r)},30)}})}x[r]=A})(u);e=x[u];(t.document.queryCommandEnabled(u)?true:false)?e.removeClass("ke-menuitem-disable"):e.addClass("ke-menuitem-disable")}})}();g.ready(function(){new s.Paste(g)})});
KISSY.Editor.add("color",function(g){var p=KISSY.Editor;g.ready(function(){var s=g.cfg.pluginConfig;false!==s.forecolor&&function(){var o=g.addButton("color",{styles:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},title:"\u6587\u672c\u989c\u8272",loading:true,contentCls:"ke-toolbar-color"});p.use("colorsupport",function(){o.reload(p.ColorSupport)})}();false!==s.bgcolor&&function(){var o=g.addButton("color",{styles:{element:"span",styles:{"background-color":"#(color)"}},
title:"\u80cc\u666f\u989c\u8272",loading:true,contentCls:"ke-toolbar-bgcolor"});p.use("colorsupport",function(){o.reload(p.ColorSupport)})}()})});
KISSY.Editor.add("colorsupport",function(){function g(){if(!k){k="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var c=0;c<3;c++){k+="<div class='ke-color-palette'><table>";for(var d=j[c],f=d.length/8,i=0;i<f;i++){k+="<tr>";for(var w=0;w<8;w++){var l="#"+d[8*i+w];k+="<td>";k+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+l+"'></a>";k+="</td>"}k+="</tr>"}k+="</table></div>"}k+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
var p=KISSY,s=p.Editor,o=p.Node,m=p.Event,q=s.Overlay,n=p.DOM;n.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var j=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],k;s.ColorSupport={offClick:function(c){var d=this.cfg,f=this.colorWin;f&&f.get("visible")?f.hide():d._prepare.call(this,c)},_prepare:function(){var c=this,d=c.cfg,f=document,i=c.btn,w=c.editor,l;g();c.colorWin=new q({elCls:"ks-popup",content:k,focus4e:false,autoRender:true,width:"170px",zIndex:w.baseZIndex(s.zIndexManager.POPUP_MENU)});var b=c.colorWin;l=b.get("contentEl");l.on("click",d._selectColor,c);m.on(f,"click",d._hidePanel,c);m.on(w.document,
"click",d._hidePanel,c);b.on("show",i.bon,i);b.on("hide",i.boff,i);l.one(".ke-color-others").on("click",function(e){e.halt();b.hide();w.useDialog("color/dialog",function(h){h.show(c)})});d._prepare=d._show;d._show.call(c)},_show:function(){var c=this.btn.get("el"),d=this.colorWin,f=parseInt(d.get("width")),i=n.viewportWidth();d.align(c,["bl","tl"],[0,2]);d.get("x")+f>i-30&&d.set("x",i-30-f);d.show()},_hidePanel:function(c){var d=this.btn.get("el");c=new o(c.target);var f=this.colorWin;d._4e_equals(c)||
d.contains(c)||f.hide()},_selectColor:function(c){c.halt();var d=this.cfg;c=new o(c.target);if(c._4e_name()=="a"&&!c.hasClass("ke-button")){d._applyColor.call(this,c._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(c){var d=this.editor,f=d.document,i=this.cfg.styles;d.fire("save");c?(new s.Style(i,{color:c})).apply(f):(new s.Style(i,{color:"inherit"})).remove(f);d.fire("save")}}});
KISSY.Editor.add("contextmenu",function(){function g(c){this.cfg=c;s.Utils.lazyRun(this,"_prepareShow","_realShow")}function p(c,d){for(var f=0;f<d.length;f++){var i=d[f];if(o.isFunction(i)){if(i(new m(c)))return true}else if(q.test(c,i))return true}return false}var s=KISSY.Editor,o=KISSY,m=o.Node,q=o.DOM,n=o.Event;if(!s.ContextMenu){g.ATTRS={editor:{}};var j=[];g.register=function(c){var d=new g(c),f=c.editor.document;j.push({doc:f,rules:c.rules||[],instance:d});if(!f.ke_contextmenu){f.ke_contextmenu=
1;n.on(f,"mousedown",g.hide);n.on(f,"contextmenu",function(i){g.hide.call(this);for(var w=new m(i.target);w;){var l=false;if(w._4e_name()=="body")break;for(var b=0;b<j.length;b++){var e=j[b].instance,h=j[b].rules;if(f===j[b].doc&&p(w[0],h)){i.preventDefault();l=true;setTimeout(function(){e.show(s.Utils.getXY(i.pageX,i.pageY,f,document))},30);break}}if(l)break;w=w.parent()}})}return d};g.hide=function(){for(var c=0;c<j.length;c++){var d=j[c].instance;this===j[c].doc&&d.hide()}};var k=s.Overlay;o.augment(g,
{_init:function(){var c=this,d=c.cfg,f=d.funcs;c.el=new k({content:"<div>",autoRender:true,width:d.width,elCls:"ke-menu"});c.elDom=c.el.get("contentEl").one("div");d=c.elDom;for(var i in f){var w=new m("<a href='#'>"+i+"</a>");d[0].appendChild(w[0]);(function(l,b){l._4e_unselectable();l.on("click",function(e){c.hide();e.halt();setTimeout(b,30)})})(w,f[i])}},hide:function(){this.el&&this.el.hide()},_realShow:function(c){s.fire("contextmenu",{contextmenu:this});this.el.set("xy",[c.left,c.top]);this.el.show()},
_prepareShow:function(){this._init()},show:function(c){this._prepareShow(c)}});s.ContextMenu=g}});
KISSY.add("dd",function(g){function p(){p.superclass.constructor.apply(this,arguments);this._init()}function s(n,j,k){k=k||150;if(k===-1)return function(){n.apply(j,arguments)};var c=g.now();return function(){var d=g.now();if(d-c>k){c=d;n.apply(j,arguments)}}}var o=g.Event,m=g.DOM,q=g.Node;g.DD={};p.ATTRS={bufferTime:{value:200},activeDrag:{}};g.extend(p,g.Base,{_init:function(){this._showShimMove=s(this._move,this,30)},_move:function(n){var j=this.get("activeDrag");g.log("move");if(j){n.preventDefault();
this._clearSelection();j._move(n)}},_start:function(n){var j=this,k=j.get("bufferTime")||0;j._registerEvent();if(k)j._bufferTimer=setTimeout(function(){j._bufferStart(n)},k);else j._bufferStart(n)},_bufferStart:function(n){this.set("activeDrag",n);this._activeShim();n._start()},_end:function(n){var j=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(j){j._end(n);this.set("activeDrag",
null)}},_activeShim:function(){var n=document;this._shim=(new q("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:999999;'></div>")).appendTo(n.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:m.docHeight()});this._clearSelection()},_clearSelection:function(){g.log("_clearSelection");if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection)try{document.selection.empty()}catch(n){}},
_registerEvent:function(){var n=document;g.log("_registerEvent");o.on(n,"mouseup",this._end,this);o.on(n,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var n=document;g.log("_unregisterEvent");o.remove(n,"mousemove",this._showShimMove,this);o.remove(n,"mouseup",this._end,this)}});g.DD.DDM=new p});
KISSY.add("dd-draggable",function(g){function p(){p.superclass.constructor.apply(this,arguments);this._init()}var s=g.UA;p.ATTRS={node:{setter:function(o){return g.one(o)}},handlers:{value:[],setter:function(o){if(o)for(var m=0;m<o.length;m++)o[m]=g.one(o[m])}}};g.extend(p,g.Base,{_init:function(){var o=this.get("node"),m=this.get("handlers");if(m.length==0)m[0]=o;for(var q=0;q<m.length;q++){var n=m[q],j=n.css("cursor");if(n[0]!=o[0])if(!j||j==="auto")n.css("cursor","move")}o.on("mousedown",this._handleMouseDown,
this)},destroy:function(){for(var o=this.get("node"),m=this.get("handlers"),q=0;q<m.length;q++){var n=m[q];n.css("cursor")=="move"&&n.css("cursor","auto")}o.detach("mousedown",this._handleMouseDown,this)},_check:function(o){for(var m=this.get("handlers"),q=0;q<m.length;q++){var n=m[q];if(n.contains(o)||n[0]==o[0])return true}return false},_handleMouseDown:function(o){if(this._check(new g.Node(o.target))){s.webkit||o.preventDefault();g.DD.DDM._start(this);var m=this.get("node"),q=o.pageX;o=o.pageY;
m=m.offset();this.startMousePos={left:q,top:o};this.startNodePos=m;this._diff={left:q-m.left,top:o-m.top};this.set("diff",this._diff)}},_move:function(o){var m=this.get("diff");g.mix(o,{left:o.pageX-m.left,top:o.pageY-m.top});this.fire("drag",o)},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});g.Draggable=p},{host:"dd"});KISSY.Editor.add("dd",function(){});KISSY.Editor.add("draft",function(g){var p=KISSY.Editor;g.ready(function(){p.use("draft/support",function(){p.storeReady(function(){new p.Draft(g)})})})});
KISSY.Editor.add("draft/support",function(){function g(c,d,f){for(c+="";c.length<d;)c=f+c;return c}function p(c){if(o.isNumber(c))c=new Date(c);return c instanceof Date?[c.getFullYear(),"-",g(c.getMonth()+1,2,"0"),"-",g(c.getDate(),2,"0")," ",g(c.getHours(),2,"0"),":",g(c.getMinutes(),2,"0"),":",g(c.getSeconds(),2,"0")].join(""):c}function s(c){this.editor=c;this._init()}var o=KISSY,m=o.Editor,q=o.Node,n=o.Event,j=o.JSON,k=window[m.STORE];o.augment(s,{_init:function(){var c=this,d=c.editor,f=d.statusDiv,
i=d.cfg.pluginConfig;i.draft=i.draft||{};c.draftInterval=i.draft.interval=i.draft.interval||5;c.draftLimit=i.draft.limit=i.draft.limit||5;f=(new q("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+i.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(f);c.timeTip=(new q("<span class='ke-draft-time'>")).appendTo(f);var w=(new q("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(f),l=new m.Select({container:f,
menuContainer:document.body,doc:d.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),b=k.getItem("ke-draft-save"),e=[];c.versions=l;if(b)e=o.isString(b)?j.parse(decodeURIComponent(b)):b;c.drafts=e;c.sync();w.on("click",function(){c.save(false)});(function(){var h=d.textarea[0].form;h&&n.on(h,"submit",function(){c.save(false)})})();setInterval(function(){c.save(true)},c.draftInterval*60*1E3);l.on("click",c.recover,c);c.holder=f;if(i.draft.helpHtml){i=new m.TripleButton({cls:"ke-draft-help",
title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:f});i.on("click",function(){c._prepareHelp()});m.Utils.lazyRun(c,"_prepareHelp","_realHelp");c.helpBtn=i.el}c._holder=f},_prepareHelp:function(){var c=this,d=c.editor,f=c.helpBtn,i=new q(d.cfg.pluginConfig.draft.helpHtml||""),w=new q("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
i.append(w);i.css({border:"1px solid #ACB4BE","text-align":"left"});c._help=new o.Overlay({content:i,autoRender:true,width:i.width()+"px",mask:false});c._help.el.css("border","none");c._help.arrow=w;n.on([document,d.document],"click",function(l){l=new q(l.target);l[0]==f[0]||f.contains(l)||c._help.hide()})},_realHelp:function(){var c=this._help,d=this.helpBtn,f=c.arrow;c.show();d=d.offset();c.el.offset({left:d.left-c.el.width()+17,top:d.top-c.el.height()-7});f.offset({left:d.left-2,top:d.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var c=this.draftLimit,d=this.timeTip,f=this.versions,i=this.drafts;i.length>c&&i.splice(0,i.length-c);c=[];for(var w,l=0;l<i.length;l++){w=i[l];w=(w.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+p(w.date);c.push({name:w,value:l})}f.set("items",c.reverse());d.html(w);k.setItem("ke-draft-save",encodeURIComponent(j.stringify(i)))},save:function(c){var d=this.drafts,f=this.editor.getData(true);if(f){if(d[d.length-
1]&&f==d[d.length-1].content)d.length-=1;this.drafts=d.concat({content:f,date:(new Date).getTime(),auto:c});this.sync()}},recover:function(c){var d=this.editor,f=this.drafts;c=c.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+p(f[c].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){d.fire("save");d.setData(f[c].content);d.fire("save")}}});m.Draft=s});
KISSY.Editor.add("elementpaths",function(g){var p=KISSY.Editor,s=KISSY,o=s.Node,m=s.DOM;p.ElementPaths||function(){function q(n){this.cfg=n;this._cache=[];this._init()}m.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");s.augment(q,{_init:function(){var n=this.cfg.editor;this.holder=new o("<span>");this.holder.appendTo(n.statusDiv);n.on("selectionChange",this._selectionChange,this);
p.Utils.sourceDisable(n,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(n){var j=this.cfg.editor,k=this.holder;n=n.path.elements;var c,d;c=this._cache;for(d=0;d<c.length;d++){c[d].detach("click");c[d]._4e_remove()}this._cache=[];for(d=0;d<n.length;d++){c=n[d];var f=new o("<a href='#' class='elementpath'>"+(c.attr("_ke_real_element_type")||c._4e_name())+"</a>");this._cache.push(f);(function(i){f.on("click",
function(w){w.halt();j.focus();setTimeout(function(){j.getSelection().selectElement(i)},50)})})(c);k.prepend(f)}}});p.ElementPaths=q}();g.ready(function(){new p.ElementPaths({editor:g})})});
KISSY.Editor.add("enterkey",function(g){var p=KISSY.Editor,s=KISSY,o=s.UA,m=/^h[1-6]$/,q=p.XHTML_DTD,n=s.Node,j=s.Event,k=p.Walker,c=p.ElementPath;p.enterBlock||function(){function d(f){j.on(f.document,"keydown",function(i){if(i.keyCode===13)if(!i.shiftKey){f.fire("save");var w=f.execCommand("enterBlock");f.fire("save");w!==false&&i.preventDefault()}})}d.enterBlock=function(f){var i;i=f.getSelection().getRanges();for(var w=i.length-1;w>0;w--)i[w].deleteContents();i=i[0];w=i.document;if(i.checkStartOfBlock()&&
i.checkEndOfBlock()){var l=(new c(i.startContainer)).block;if(l&&(l._4e_name()=="li"||l.parent()._4e_name()=="li"))if(f.hasCommand("outdent")){f.fire("save");f.execCommand("outdent");f.fire("save");return}else return false}var b=i.splitBlock("p");if(b){f=b.previousBlock;l=b.nextBlock;var e=b.wasStartOfBlock,h=b.wasEndOfBlock,t;if(l){t=l.parent();if(t._4e_name()=="li"){l._4e_breakParent(t);l._4e_move(l._4e_next(),true)}}else if(f&&(t=f.parent())&&t._4e_name()=="li"){f._4e_breakParent(t);i.moveToElementEditablePosition(f._4e_next());
f._4e_move(f._4e_previous())}if(!e&&!h){if(l._4e_name()=="li"&&(t=l._4e_first(k.invisible(true)))&&s.inArray(t._4e_name(),["ul","ol"]))(o.ie?new n(w.createTextNode("\u00a0")):new n(w.createElement("br"))).insertBefore(t);l&&i.moveToElementEditablePosition(l)}else{var y;if(f){if(f._4e_name()=="li"||!m.test(f._4e_name()))y=f._4e_clone()}else if(l)y=l._4e_clone();y||(y=new n("<p>",null,w));if(t=b.elementPath){b=0;for(var x=t.elements.length;b<x;b++){var u=t.elements[b];if(u._4e_equals(t.block)||u._4e_equals(t.blockLimit))break;
if(q.$removeEmpty[u._4e_name()]){u=u._4e_clone();y._4e_moveChildren(u);y.append(u)}}}o.ie||y._4e_appendBogus();i.insertNode(y);if(o.ie&&e&&(!h||!f[0].childNodes.length)){i.moveToElementEditablePosition(h?f:y);i.select()}i.moveToElementEditablePosition(e&&!h?l:y)}if(!o.ie)if(l){y=new n(w.createElement("span"));y.html("&nbsp;");i.insertNode(y);y._4e_scrollIntoView();i.deleteContents()}else y._4e_scrollIntoView();i.select()}};p.EnterKey=d}();g.ready(function(){g.addCommand("enterBlock",{exec:p.EnterKey.enterBlock});
p.EnterKey(g)})});
KISSY.Editor.add("fakeobjects",function(g){var p=KISSY.Editor,s=KISSY,o=s.Node,m=p.NODE,q=p.Config.base+"theme/spacer.gif",n=p.HtmlParser;p=s.Editor;var j=(g=g.htmlDataProcessor)&&g.htmlFilter,k={elements:{$:function(c){var d=c.attributes;if((d=(d=(d=d&&d._ke_realelement)&&new n.Fragment.FromHtml(decodeURIComponent(d)))&&d.children[0])&&c.attributes._ke_resizable){var f=c.attributes.style;if(f){var i=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f);c=i&&i[1];f=(i=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&i[1];
if(c)d.attributes.width=c;if(f)d.attributes.height=f}}return d}}};j&&j.addRules(k);g&&s.mix(g,{createFakeParserElement:function(c,d,f,i,w){var l;l=new n.BasicWriter;c.writeHtml(l);l=l.getHtml();var b=c.attributes.style;if(c.attributes.width)b="width:"+c.attributes.width+"px;"+b;if(c.attributes.height)b="height:"+c.attributes.height+"px;"+b;c={"class":d,src:q,_ke_realelement:encodeURIComponent(l),_ke_real_node_type:c.type,style:b,align:c.attributes.align||""};w&&delete w.width;w&&delete w.height;w&&
s.mix(c,w,false);if(f)c._ke_real_element_type=f;if(i)c._ke_resizable=i;return new n.Element("img",c)}});s.augment(p,{createFakeElement:function(c,d,f,i,w,l){var b=c.attr("style")||"";if(c.attr("width"))b="width:"+c.attr("width")+"px;"+b;if(c.attr("height"))b="height:"+c.attr("height")+"px;"+b;c={"class":d,src:q,_ke_realelement:encodeURIComponent(w||c._4e_outerHtml()),_ke_real_node_type:c[0].nodeType,style:b};l&&delete l.width;l&&delete l.height;l&&s.mix(c,l,false);if(f)c._ke_real_element_type=f;if(i)c._ke_resizable=
i;return new o("<img/>",c,this.document)},restoreRealElement:function(c){if(c.attr("_ke_real_node_type")!=m.NODE_ELEMENT)return null;c=decodeURIComponent(c.attr("_ke_realelement"));var d=new o("<div>",null,this.document);d.html(c);return d._4e_first(function(f){return f[0].nodeType==m.NODE_ELEMENT})._4e_remove()}})});
KISSY.Editor.add("flash",function(g){g.ready(function(){var p=KISSY,s=p.Editor,o=g.htmlDataProcessor,m=g.cfg.pluginConfig,q=o&&o.dataFilter;q&&q.addRules({elements:{object:function(n){var j=n.attributes;if(!(j.classid&&String(j.classid).toLowerCase())){for(j=0;j<n.children.length;j++)if(n.children[j].name=="embed"){if(!s.Utils.isFlashEmbed(n.children[j]))break;return o.createFakeParserElement(n,"ke_flash","flash",true)}return null}return o.createFakeParserElement(n,"ke_flash","flash",true)},embed:function(n){if(!s.Utils.isFlashEmbed(n))return null;
return o.createFakeParserElement(n,"ke_flash","flash",true)}}},5);s.use("flash/support",function(){var n=s.Flash;g.addCommand("insertFlash",{exec:function(){var j=p.makeArray(arguments);return s.Flash.Insert.apply(null,j)}});if(!m.flash||m.flash.btn!==false)new n(g)})})});
KISSY.Editor.add("flash/support",function(){function g(i){this.editor=i;this._init()}function p(i){return i._4e_name()==="img"&&!!i.hasClass(c)&&i}var s=KISSY.Editor,o=KISSY,m=o.UA,q=o.Event,n=s.ContextMenu,j=o.Node,k=s.BubbleView,c="ke_flash",d=s.Utils.flash;o.augment(g,{_config:function(){this._cls=c;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=f;this._flashRules=["img."+c]},_init:function(){this._config();var i=this,w=i.editor,l={},b=i._contextMenu;
w.addButton("flash",{contentCls:i._contentCls,title:i._tip,offClick:function(){i.show()}});if(b)for(var e in b)(function(h){l[h]=function(){b[h](i)}})(e);n.register({editor:w,rules:i._flashRules,width:"120px",funcs:l});k.attach({pluginName:i._type,editor:i.editor,pluginContext:i});q.on(w.document,"dblclick",i._dbclick,i)},_getFlashUrl:function(i){return d.getUrl(i)},_updateTip:function(i,w){var l=this.editor.restoreRealElement(w);if(l){l=this._getFlashUrl(l);i.html(l);i.attr("href",l)}},_dbclick:function(i){var w=
new j(i.target);if(w._4e_name()==="img"&&w.hasClass(this._cls)){this.show(null,w);i.halt()}},show:function(i,w){this.editor.useDialog(this._type+"/dialog",function(l){l.show(w)})}});s.Flash=g;g.registerBubble=function(i,w,l){k.register({pluginName:i,func:l,init:function(){var b=this,e=b.get("contentEl");e.html(w+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=e.one(".ke-bubbleview-url"),t=e.one(".ke-bubbleview-change"),y=e.one(".ke-bubbleview-remove");s.Utils.preventFocus(e);t.on("click",function(x){b._plugin.show(null,b._selectedEl);x.halt()});y.on("click",function(x){var u=b._plugin;if(m.webkit){var r=u.editor.getSelection().getRanges();r&&r[0]&&(r[0].collapse(true)||1)&&r[0].select()}b._selectedEl._4e_remove();b.hide();u.editor.notifySelectionChange();x.halt()});b.on("show",function(){var x=b._selectedEl;x&&b._plugin._updateTip(h,x)})}})};g.registerBubble("flash",
"Flash \u7f51\u5740\uff1a ",p);g.checkFlash=p;var f={"Flash\u5c5e\u6027":function(i){var w=i.editor.getSelection();w=w&&w.getStartElement();(w=p(w))&&i.show(null,w)}};g.CLS_FLASH=c;g.TYPE_FLASH="flash";g.Insert=function(i,w,l,b,e){w=d.createSWF(w,{attrs:l},i.document);var h=w.el;l=i.createFakeElement?i.createFakeElement(h,b||"ke_flash",e||"flash",true,w.html,l):h;return l=i.insertElement(l)};s.Flash=g});
KISSY.Editor.add("flashbridge",function(){function g(d){this._init(d)}function p(d){var f=o.isString(d)?d.match(/(\d)+/g):d;d=d;if(o.isArray(f))d=parseFloat(f[0]+"."+s(f[1],3)+s(f[2],5));return d||0}function s(d,f){for(var i=(d+"").length;i++<f;)d="0"+d;return d}var o=KISSY,m=o.Editor;if(!m.FlashBridge){var q={};o.augment(g,o.EventTarget,{_init:function(d){var f=o.guid("flashbridge-");d.flashVars=d.flashVars||{};d.attrs=d.attrs||{};d.params=d.params||{};var i=d.flashVars,w=d.params;o.mix(d.attrs,
{id:f,width:"100%",height:"100%"},false);o.mix(w,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);o.mix(i,{shareData:false,useCompression:false},false);w={YUISwfId:f,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(d.ajbridge)w={swfID:f,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};o.mix(i,w);q[f]=this;this.id=f;this.swf=m.Utils.flash.createSWFRuntime(d.movie,d);this._expose(d.methods)},_expose:function(d){for(var f=this,i=0;i<d.length;i++)(function(w){f[w]=
function(){return f._callSWF(w,o.makeArray(arguments))}})(d[i])},_callSWF:function(d,f){f=f||[];try{if(this.swf[d])return this.swf[d].apply(this.swf,f)}catch(i){var w="";if(f.length!==0)w="'"+f.join("', '")+"'";return(new Function("self","return self.swf."+d+"("+w+");"))(this)}},_eventHandler:function(d){var f=d.type;if(f==="log")o.log(d.message);else f&&this.fire(f,d)},_destroy:function(){delete q[this.id]}});g.EventHandler=function(d,f){var i=q[d];i&&setTimeout(function(){i._eventHandler.call(i,
f)},100)};m.FlashBridge=g;var n=o.UA,j,k,c=true;n.fpv=function(d){if(d||c){c=false;var f;if(navigator.plugins&&navigator.mimeTypes.length)f=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{f=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(i){}j=f?f.match(/(\d)+/g):void 0;k=p(j)}return j};n.fpvGEQ=function(d,f){c&&n.fpv(f);return!!k&&k>=p(d)}}});
KISSY.Editor.add("flashutils",function(){var g=KISSY,p=g.Editor,s=p.Utils.flash;if(!s){var o=g.DOM,m=g.Node,q=g.UA;s={getUrl:function(n){var j="",k=p.NODE;if(n._4e_name()=="object"){n=n[0].childNodes;for(var c=0;c<n.length;c++)if(n[c].nodeType==k.NODE_ELEMENT)if((o.attr(n[c],"name")||"").toLowerCase()=="movie")j=o.attr(n[c],"value");else if(o._4e_name(n[c])=="embed")j=o.attr(n[c],"src");else if(o._4e_name(n[c])=="object")j=o.attr(n[c],"data")}else if(n._4e_name()=="embed")j=n.attr("src");return j},
createSWF:function(n,j,k){var c=j.attrs||{},d=j.flashVars,f="",i="";j=j.params||{};var w="";k=k||document;g.mix(c,{wmode:"transparent"});for(var l in c)if(c.hasOwnProperty(l))f+=l+"='"+c[l]+"' ";g.mix(j,{quality:"high",movie:n,wmode:"transparent"});for(var b in j)if(j.hasOwnProperty(b))i+="<param name='"+b+"' value='"+j[b]+"'/>";if(d){for(var e in d)if(d.hasOwnProperty(e))w+="&"+e+"="+encodeURIComponent(d[e]);w=w.substring(1)}n="<object "+f+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
i+(w?'<param name="flashVars" value="'+w+'"/>':"")+"<embed "+f+" "+(w?'FlashVars="'+w+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+n+'"  type="application/x-shockwave-flash"/></object>';return{el:new m(n,null,k),html:n}},createSWFRuntime2:function(n,j,k){k=k||document;var c=(new m("<div style='width:0;height:0;overflow:hidden;'>",null,k)).appendTo(k.body);c=s.createSWF.apply(this,arguments).el.appendTo(c);q.ie||(c=c.one("object"));return c[0]},createSWFRuntime:function(n,
j,k){var c=j.attrs||{},d=j.flashVars||{},f=j.params||{},i="",w="",l="";k=k||document;c.id=c.id||g.guid("ke-runtimeflash-");for(var b in c)if(c.hasOwnProperty(b))i+=b+"='"+c[b]+"' ";for(var e in f)if(f.hasOwnProperty(e))w+="<param name='"+e+"' value='"+f[e]+"'/>";for(var h in d)if(d.hasOwnProperty(h))l+="&"+h+"="+encodeURIComponent(d[h]);l=l.substring(1);n=q.ie?"<object "+i+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+w+'<param name="movie" value="'+n+'" />'+(l?'<param name="flashVars" value="'+
l+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+n+"' "+i+">"+w+(l?'<param name="flashVars" value="'+l+'"/>':"")+"</object>";var t=j.holder;if(!t){t=(new m("<div style='"+(j.style?j.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,k)).appendTo(k.body);setTimeout(function(){t.offset({left:o.scrollLeft(),top:o.scrollTop()})},100)}t.html(n);return k.getElementById(c.id)}};p.Utils.flash=s}});
KISSY.Editor.add("font",function(g){function p(y){for(var x=[],u=0;u<y.length;u++)x.push({name:y[u],value:y[u]});return x}var s=KISSY,o=s.Editor,m=o.Style,q=o.TripleButton,n=g.cfg.pluginConfig,j=s.Node,k=n["font-size"],c,d,f;if(k!==false){k=k||{};s.mix(k,{items:p(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var i={},w=[],l={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(t=0;t<k.items.length;t++){c=
k.items[t];d=c.name;f=c.attrs;c=c.value;i[c]=new m(l,{size:c});w.push({name:d,value:c,attrs:f})}n["font-size"]=k}var b=n["font-family"];if(b!==false){b=b||{};s.mix(b,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},
{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var e={},h=[];l={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};var t;n["font-family"]=b;for(t=0;t<b.items.length;t++){c=b.items[t];d=c.name;f=c.attrs||{};c=c.value;f.style=f.style||"";f.style+=";font-family:"+c;e[c]=new m(l,{family:c});h.push({name:d,value:c,attrs:f})}}o.FontSelect||function(){function y(u){y.superclass.constructor.call(this,u);this._init()}
y.ATTRS={title:{},html:{},styles:{},editor:{}};var x=o.Select;s.extend(y,s.Base,{_init:function(){var u=this.get("editor"),r=u.toolBarDiv;this.get("html");this.el=new x({container:r,doc:u.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new j(document.body)});this.el.on("click",this._vChange,this);u.on("selectionChange",this._selectionChange,this);o.Utils.sourceDisable(u,this)},disable:function(){this.el.set("state",
x.DISABLED)},enable:function(){this.el.set("state",x.ENABLED)},_vChange:function(u){var r=this.get("editor"),A=u.newVal;u=u.prevVal;var B=this.get("styles");r.focus();r.fire("save");B=B[A];if(A==u){B.remove(r.document);this.el.set("value","")}else B.apply(r.document);r.fire("save")},_selectionChange:function(u){this.get("editor");u=u.path.elements;for(var r=this.get("styles"),A=0,B;A<u.length;A++){B=u[A];for(var C in r)if(r[C].checkElementRemovable(B,true)){this.el.set("value",C);return}}this.el.reset("value")}});
o.FontSelect=y}();g.ready(function(){false!==n["font-size"]&&new o.FontSelect({editor:g,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:k.width,styles:i,html:w});false!==n["font-family"]&&new o.FontSelect({editor:g,title:"\u5b57\u4f53",width:"110px",popUpWidth:b.width,styles:e,html:h});var y={mode:o.WYSIWYG_MODE,offClick:function(){var x=this.editor,u=this.cfg.style;x.fire("save");u.apply(x.document);x.fire("save");x.notifySelectionChange();x.focus()},onClick:function(){var x=this.editor,u=this.cfg.style;
x.fire("save");u.remove(x.document);x.fire("save");x.notifySelectionChange();x.focus()},selectionChange:function(x){var u=this.btn;this.cfg.style.checkActive(x.path)?u.set("state",q.ON):u.set("state",q.OFF)}};false!==n["font-bold"]&&g.addButton("font-bold",s.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",style:new m({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},y));false!==n["font-italic"]&&g.addButton("font-italic",s.mix({contentCls:"ke-toolbar-italic",
title:"\u659c\u4f53 ",style:new m({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},y));false!==n["font-underline"]&&g.addButton("font-underline",s.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new m({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})},y));false!==n["font-strikeThrough"]&&g.addButton("font-underline",s.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new m({element:"del",overrides:[{element:"span",
attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})},y))})});
KISSY.Editor.add("format",function(g){var p=KISSY.Editor,s=KISSY,o=s.Node,m=[],q={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},n={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},j={},k=p.Style,c;for(c in q)if(q[c]){j[q[c]]=new k({element:q[c]});m.push({name:c,value:q[c],attrs:{style:"font-size:"+n[q[c]]}})}p.Format||function(){function d(i){d.superclass.constructor.call(this,i);this._init()}d.ATTRS={editor:{}};var f=p.Select;s.extend(d,s.Base,
{_init:function(){var i=this.get("editor");this.el=new f({container:i.toolBarDiv,value:"",doc:i.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new o(document.body)});this.el.on("click",this._vChange,this);i.on("selectionChange",this._selectionChange,this);p.Utils.sourceDisable(i,this)},disable:function(){this.el.set("state",f.DISABLED)},enable:function(){this.el.set("state",f.ENABLED)},_vChange:function(i){var w=this.get("editor"),
l=i.newVal;i=i.prevVal;w.fire("save");if(l!=i)j[l].apply(w.document);else{j.p.apply(w.document);this.el.set("value","p")}w.fire("save")},_selectionChange:function(i){this.get("editor");i=i.path;for(var w in j)if(j[w].checkActive(i)){this.el.set("value",w);return}this.el.reset("value")}});p.Format=d}();g.ready(function(){new p.Format({editor:g,html:m,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(g){var p=p,s=KISSY,o=s.Editor,m=s.Node,q=s.UA,n=o.NODE,j=o.HtmlParser,k=new j.Filter,c=new j.Filter,d=o.XHTML_DTD;if(!g.htmlDataProcessor){(function(){var f=o.HtmlParser.Fragment.prototype,i=o.HtmlParser.Element.prototype;f.onlyChild=i.onlyChild=function(){var w=this.children;return w.length==1&&w[0]||null};i.removeAnyChildWithName=function(w){for(var l=this.children,b=[],e,h=0;h<l.length;h++){e=l[h];if(e.name){if(e.name==w){b.push(e);l.splice(h--,1)}b=
b.concat(e.removeAnyChildWithName(w))}}return b};i.getAncestor=function(w){for(var l=this.parent;l&&!(l.name&&l.name.match(w));)l=l.parent;return l};f.firstChild=i.firstChild=function(w){for(var l,b=0;b<this.children.length;b++){l=this.children[b];if(w(l))return l;else if(l.name)if(l=l.firstChild(w))return l}return null};i.addStyle=function(w,l,b){var e="";if(typeof l=="string")e+=w+":"+l+";";else{if(typeof w=="object")for(var h in w){if(w.hasOwnProperty(h))e+=h+":"+w[h]+";"}else e+=w;b=l}if(!this.attributes)this.attributes=
{};w=this.attributes.style||"";w=(b?[e,w]:[w,e]).join(";");this.attributes.style=w.replace(/^;|;(?=;)/,"")};d.parentOf=function(w){var l={},b;for(b in this)if(b.indexOf("$")==-1&&this[b][w])l[b]=1;return l}})();(function(){function f(r){if(/mso-list\s*:\s*Ignore/i.test(r.attributes&&r.attributes.style))return true;return p}function i(r,A){var B=new o.HtmlParser.Element("ke:listbullet"),C;if(r)if(r[2]){r=isNaN(r[1])?/^[a-z]+$/.test(r[1])?"lower-alpha":/^[A-Z]+$/.test(r[1])?"upper-alpha":"decimal":
"decimal";C="ol"}else{r=/[l\u00B7\u2002]/.test(r[1])?"disc":/[\u006F\u00D8]/.test(r[1])?"circle":/[\u006E\u25C6]/.test(r[1])?"square":"disc";C="ul"}else{r="decimal";C="ol"}B.attributes={"ke:listtype":C,style:"list-style-type:"+r+";"};B.add(new o.HtmlParser.Text(A));return B}function w(r){var A=r.attributes,B;if((B=r.removeAnyChildWithName("ke:listbullet"))&&B.length&&(B=B[0])){r.name="ke:li";if(A.style)A.style=l([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(C){C=C.split(" ");
C=C[3]||C[1]||C[0];C=parseInt(C,10);if(!h&&t&&C>t)h=C-t;A["ke:margin"]=t=C}]],p)(A.style,r)||"";B=B.attributes;r.addStyle(B.style);s.mix(A,B);return true}return false}function l(r,A){return function(B,C){var v=[];B.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(E,F,D){F=F.toLowerCase();F=="font-family"&&(D=D.replace(/["']/g,""));for(var G,M,N,Q=0;Q<r.length;Q++)if(r[Q]){E=r[Q][0];G=r[Q][1];M=r[Q][2];N=r[Q][3];if(F.match(E)&&(!G||D.match(G))){F=N||F;A&&(M=M||D);if(typeof M==
"function")M=M(D,C,F);if(M&&M.push){F=M[0];M=M[1]}typeof M=="string"&&v.push([F,M]);return}}!A&&v.push([F,D])});for(var z=0;z<v.length;z++)v[z]=v[z].join(":");return v.length?v.join(";")+";":false}}function b(r){r=r.children;for(var A,B,C,v,z,E,F,D=0;D<r.length;D++){A=r[D];if("ke:li"==A.name){A.name="li";A=A;B=A.attributes;C=A.attributes["ke:listtype"];v=parseInt(B["ke:indent"],10)||h&&Math.ceil(B["ke:margin"]/h)||1;B.style&&(B.style=l([["list-style-type",C=="ol"?"decimal":"disc"]],p)(B.style)||"");
if(E){if(v>F){E=new o.HtmlParser.Element(C);E.add(A);z.add(E)}else{if(v<F){z=F-v;for(var G;z--&&(G=E.parent);)E=G.parent}E.add(A)}r.splice(D--,1)}else{E=new o.HtmlParser.Element(C);E.add(A);r[D]=E}z=A;F=v}else E=null}h=0}var e=l([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],p),h,t=0,y=d.parentOf("ol"),x={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(r){r.filterChildren();
b(r)},elements:{font:function(r){delete r.name},p:function(r){r.filterChildren();if(w(r))return p},$:function(r){var A=r.name||"";A.indexOf(":")!=-1&&A.indexOf("ke")==-1&&delete r.name;var B=r.attributes.style;if(A=="span"&&(!B||!e(B)))delete r.name;if(A in y){r.filterChildren();b(r)}},span:function(r){if(!q.gecko&&f(r.parent))return false;if(!q.gecko&&f(r)){r=(r=r.firstChild(function(B){return B.value||B.name=="img"}))&&(r.value||"l.");var A=r.match(/^([^\s]+?)([.)]?)$/);return i(A,r)}},a:function(r){r=
r.attributes;if(r.href)r._ke_saved_href=r.href}},comment:!q.ie?function(r,A){var B=r.match(/<img.*?>/),C=r.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(C){C=(B=C[1]||B&&"l.")&&B.match(/>([^\s]+?)([.)]?)</);return i(C,B)}if(q.gecko&&B){B=o.HtmlParser.Fragment.FromHtml(B[0]).children[0];(C=(C=(C=A.previous)&&C.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&C[1])&&(B.attributes.src=C);return B}return false}:function(){return false},attributes:{"class":function(r){if(/(^|\s+)ke_/.test(r))return r;
return false},style:function(r){r=e(r);if(!r)return false;return r}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},u={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(r){var A=r.parent;if(A&&A.name=="object"){var B=A.attributes.width;A=A.attributes.height;B&&(r.attributes.width=B);A&&(r.attributes.height=A)}},param:function(r){r.children=[];r.isEmpty=true;return r},a:function(r){if(!(r.children.length||r.attributes.name))return false;r=r.attributes;if(r._ke_saved_href)r.href=
r._ke_saved_href},td:function(r){for(var A=r.children,B=0;B<A.length;B++)if(A[B].name=="br"){A.splice(B,1);--B}if(!r.children.length){A=new o.HtmlParser.Text("&nbsp;");r.children.push(A)}},span:function(r){if(!r.children.length)return false}},attributes:{style:function(r){if(!s.trim(r))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(q.ie)u.attributes.style=function(r){return r.toLowerCase()};k.addRules(u);c.addRules(x)})();(function(){function f(u){for(var r=u.children.length,
A=u.children[r-1];A&&A.type==n.NODE_TEXT&&!s.trim(A.value);)A=u.children[--r];return A}function i(u){var r=f(u);return!r||r.type==n.NODE_ELEMENT&&r.name=="br"||u.name=="form"&&r.name=="input"}function w(u,r){var A=u.children,B=f(u);if(B){if((r||!q.ie)&&B.type==n.NODE_ELEMENT&&B.name=="br")A.pop();B.type==n.NODE_TEXT&&e.test(B.value)&&A.pop()}}function l(u){w(u,true);if(i(u))q.ie?u.add(new o.HtmlParser.Text("\u00a0")):u.add(new o.HtmlParser.Element("br",{}))}function b(u){w(u);i(u)&&u.add(new o.HtmlParser.Text("\u00a0"))}
var e=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,h=o.XHTML_DTD,t=o.Utils.mix({},h.$block,h.$listItem,h.$tableContent),y;for(y in t)"br"in h[y]||delete t[y];delete t.pre;h={elements:{}};var x={elements:{}};for(y in t){h.elements[y]=l;x.elements[y]=b}c.addRules(h);k.addRules(x)})();(function(){k.addRules({text:function(f){return f.replace(/\xa0/g,"&nbsp;")}})})();g.htmlDataProcessor={htmlFilter:k,dataFilter:c,toHtml:function(f,i){var w=new j.HtmlWriter;j.Fragment.FromHtml(f,i).writeHtml(w,k);return w.getHtml(true)},
toDataFormat:function(f,i){if(q.gecko)f=f.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var w=new m("<div>");w.html("a"+f);f=w.html().substr(1);w=new j.BasicWriter;var l=j.Fragment.FromHtml(f,i);w.reset();l.writeHtml(w,c);return w.getHtml(true)},toServer:function(f,i){var w=new j.BasicWriter;j.Fragment.FromHtml(f,i).writeHtml(w,k);return w.getHtml(true)}}}});
KISSY.Editor.add("image",function(g){var p=KISSY,s=p.Editor,o=p.UA,m=p.Node,q=p.Event,n=s.BubbleView,j=function(k){return k._4e_name()==="img"&&!/(^|\s+)ke_/.test(k[0].className)&&k};g.ready(function(){var k=g.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",offClick:function(){this.call("show")},_updateTip:function(i,w){var l=w.attr("src");i.html(l);i.attr("href",l)},show:function(i,w){this.editor.useDialog("image/dialog",function(l){l.show(w)})}}),c={"\u56fe\u7247\u5c5e\u6027":function(i){i=(i=i.getSelection())&&
i.getStartElement();(i=j(i))&&k.call("show",null,i)}},d={},f;for(f in c)(function(i){d[i]=function(){c[i](g)}})(f);s.ContextMenu.register({editor:g,rules:[j],width:"120px",funcs:d});q.on(g.document,"dblclick",function(i){var w=new m(i.target);i.halt();j(w)&&k.call("show",null,w)});n.register({pluginName:"image",pluginContext:k,editor:g,func:j,init:function(){var i=this,w=i.get("contentEl");w.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var l=w.one(".ke-bubbleview-url"),b=w.one(".ke-bubbleview-change"),e=w.one(".ke-bubbleview-remove");s.Utils.preventFocus(w);b.on("click",function(h){i._plugin.call("show",null,i._selectedEl);h.halt()});e.on("click",function(h){var t=i._plugin;if(o.webkit){var y=t.editor.getSelection().getRanges();y&&y[0]&&(y[0].collapse(true)||1)&&y[0].select()}i._selectedEl._4e_remove();i.hide();t.editor.notifySelectionChange();h.halt()});i.on("show",function(){var h=i._selectedEl;h&&i._plugin.call("_updateTip",
l,h)})}})})});KISSY.Editor.add("indent",function(g){var p=KISSY.Editor;g.ready(function(){var s=g.addButton("outdent",{title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-outdent",type:"outdent",loading:true}),o=g.addButton("indent",{title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-indent",type:"indent",loading:true});p.use("indent/support",function(){s.reload(p.IndentSupport);o.reload(p.IndentSupport)});g.addCommand("indent",{exec:function(){o.call("offClick")}});g.addCommand("outdent",{exec:function(){s.call("offClick")}})})});
KISSY.Editor.add("indent/support",function(){function g(l){this.type=l;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function p(l){return l[0].nodeType==f.NODE_ELEMENT&&l._4e_name()=="li"}function s(l,b){for(var e=l.startContainer,h=l.endContainer;e&&!e.parent()._4e_equals(b);)e=e.parent();for(;h&&!h.parent()._4e_equals(b);)h=h.parent();if(e&&h){var t=e;e=[];for(var y=false;!y;){if(t._4e_equals(h))y=true;e.push(t);t=t.next()}if(!(e.length<1)){t=b._4e_parents(true);
for(h=0;h<t.length;h++)if(q[t[h]._4e_name()]){b=t[h];break}t=this.type=="indent"?1:-1;h=e[0];y=e[e.length-1];e={};var x=m.ListUtils.listToArray(b,e),u=x[y.data("listarray_index")].indent;for(h=h.data("listarray_index");h<=y.data("listarray_index");h++){x[h].indent+=t;var r=x[h].parent;x[h].parent=new c(r[0].ownerDocument.createElement(r._4e_name()))}for(h=y.data("listarray_index")+1;h<x.length&&x[h].indent>u;h++)x[h].indent+=t;y=m.ListUtils.arrayToList(x,e,null,"p",0);t=[];if(this.type=="outdent"){var A;
if((A=b.parent())&&A._4e_name()=="li"){x=y.listNode.childNodes;var B;for(h=x.length-1;h>=0;h--)if((B=new c(x[h]))&&B._4e_name()=="li")t.push(B)}}if(y){k.insertBefore(y.listNode,b);b._4e_remove()}if(t&&t.length)for(h=0;h<t.length;h++){for(y=B=t[h];(y=y.next())&&y._4e_name()in q;){d.ie&&!B._4e_first(function(C){return i(C)&&w(C)})&&B[0].appendChild(l.document.createTextNode("\u00a0"));B[0].appendChild(y[0])}k.insertAfter(B[0],A[0])}m.Utils.clearAllMarkers(e)}}}function o(l){var b=parseInt(l._4e_style(this.indentCssProperty),
10);if(isNaN(b))b=0;b+=(this.type=="indent"?1:-1)*this.indentOffset;if(b<0)return false;b=Math.max(b,0);b=Math.ceil(b/this.indentOffset)*this.indentOffset;l.css(this.indentCssProperty,b?b+this.indentUnit:"");l[0].style.cssText===""&&l.removeAttr("style");return true}var m=KISSY.Editor,q={ol:1,ul:1},n=KISSY,j=m.Walker,k=n.DOM,c=n.Node,d=n.UA,f=m.NODE,i=j.whitespaces(true),w=j.bookmark(false,true);n.augment(g,{exec:function(l){for(var b=(l=l.getSelection())&&l.getRanges()[0],e=b.startContainer,h=b.endContainer,
t=b.getCommonAncestor();t&&!(t[0].nodeType==f.NODE_ELEMENT&&q[t._4e_name()]);)t=t.parent();if(t&&e[0].nodeType==f.NODE_ELEMENT&&e._4e_name()in q){e=new j(b);e.evaluator=p;b.startContainer=e.next()}if(t&&h[0].nodeType==f.NODE_ELEMENT&&h._4e_name()in q){e=new j(b);e.evaluator=p;b.endContainer=e.previous()}h=l.createBookmarks(true);if(t){for(e=t._4e_first();e&&e._4e_name()!="li";)e=e.next();var y=b.startContainer;(e[0]==y[0]||e.contains(y))&&o.call(this,t)||s.call(this,b,t)}else{b=b.createIterator();
b.enforceRealBlocks=true;for(b.enlargeBr=true;t=b.getNextParagraph();)o.call(this,t)}l.selectBookmarks(h)}});m.IndentSupport={init:function(){this.indentCommand=new g(this.cfg.type)},offClick:function(){var l=this,b=l.editor;b.fire("save");setTimeout(function(){l.indentCommand.exec(b);b.fire("save");b.notifySelectionChange()},10)},selectionChange:function(l){if(this.cfg.type=="outdent"){var b=l.path,e=b.blockLimit;l=this.btn;if(b.contains(q))l.boff();else(b=b.block||e)&&b._4e_style(this.indentCommand.indentCssProperty)?
l.boff():l.disable()}}}});
KISSY.Editor.add("justify",function(g){var p=KISSY,s=p.Editor.TripleButton,o=/(-moz-|-webkit-|start|auto)/gi;g.ready(function(){var m={offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var q=this.editor,n=q.getSelection(),j=this.btn.get("state");if(n){var k=n.createBookmarks(),c=n.getRanges(),d,f;q.fire("save");for(var i=c.length-1;i>=0;i--){d=c[i].createIterator();for(d.enlargeBr=true;f=d.getNextParagraph();){f.removeAttr("align");j==s.OFF?f.css("text-align",
this.cfg.v):f.css("text-align","")}}q.notifySelectionChange();n.selectBookmarks(k);q.fire("save")}},selectionChange:function(q){var n=this.btn;q=q.path;q=q.block||q.blockLimit;if(!q||q._4e_name()==="body")n.boff();else(q.css("text-align").replace(o,"")||"left")==this.cfg.v?n.bon():n.boff()}};g.addButton("alignleft",p.mix({contentCls:"ke-toolbar-alignleft",title:"\u5de6\u5bf9\u9f50",v:"left"},m));g.addButton("aligncenter",p.mix({contentCls:"ke-toolbar-aligncenter",title:"\u5c45\u4e2d\u5bf9\u9f50",v:"center"},m));g.addButton("alignright",
p.mix({contentCls:"ke-toolbar-alignright",title:"\u53f3\u5bf9\u9f50",v:"right"},m))})});
KISSY.Editor.add("link",function(g){function p(n){return n._4e_ascendant(function(j){return j._4e_name()==="a"&&!!j.attr("href")},true)}var s=KISSY.Editor,o=s.Style,m=s.BubbleView,q={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};g.ready(function(){var n=g.addButton("link",{contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:s.WYSIWYG_MODE,_getSelectedLink:function(){var j=this.editor.getSelection();if(j=j&&j.getStartElement())j=p(j);return j},
_getSelectionLinkUrl:function(){var j=this.cfg._getSelectedLink.call(this);if(j)return j.attr("_ke_saved_href")||j.attr("href")},_removeLink:function(j){var k=this.editor;k.fire("save");var c=k.getSelection(),d=c.getRanges()[0];if(d&&d.collapsed){d=c.createBookmarks();j._4e_remove(true);c.selectBookmarks(d)}else if(d){j=j[0];c=j.attributes;d={};for(var f=0;f<c.length;f++){var i=c[f];if(i.specified)d[i.name]=i.value}if(j.style.cssText)d.style=j.style.cssText;(new o(q,d)).remove(k.document)}k.fire("save");
k.notifySelectionChange()},_link:function(j){var k=this.editor,c=this.cfg._getSelectedLink.call(this);j._ke_saved_href=j.href;if(c){k.fire("save");c.attr(j);k.fire("save")}else{c=(c=k.getSelection())&&c.getRanges()[0];if(!c||c.collapsed){a=new Node("<a>"+url+"</a>",j,k.document);k.insertElement(a)}else{k.fire("save");(new o(q,j)).apply(k.document);k.fire("save")}}k.notifySelectionChange()},offClick:function(){var j=this;j.editor.useDialog("link/dialog",function(k){k.show(j)})}});m.register({pluginName:"link",
editor:g,pluginContext:n,func:p,init:function(){var j=this,k=j.get("contentEl");k.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var c=k.one(".ke-bubbleview-url"),d=k.one(".ke-bubbleview-change"),f=k.one(".ke-bubbleview-remove");s.Utils.preventFocus(k);d.on("click",function(i){j._plugin.call("offClick");i.halt()});f.on("click",function(i){j._plugin.call("_removeLink",
j._selectedEl);i.halt()});j.on("show",function(){var i=j._selectedEl;if(i){i=i.attr("_ke_saved_href")||i.attr("href");c.html(i);c.attr("href",i)}})}})})});KISSY.Editor.add("list",function(g){var p=KISSY.Editor;g.ready(function(){var s=g.addButton("ul",{title:"\u9879\u76ee\u5217\u8868",contentCls:"ke-toolbar-ul",loading:true,type:"ul"}),o=g.addButton("ol",{title:"\u7f16\u53f7\u5217\u8868",contentCls:"ke-toolbar-ol",loading:true,type:"ol"});p.use("list/support",function(){s.reload(p.ListSupport);o.reload(p.ListSupport)})})});
KISSY.Editor.add("list/support",function(){function g(b){this.type=b}var p=KISSY.Editor,s={ol:1,ul:1},o=["ol","ul"],m=KISSY,q=p.RANGE,n=p.ElementPath,j=p.Walker,k=p.NODE,c=m.UA,d=m.Node,f=m.DOM,i={listToArray:function(b,e,h,t,y){if(!s[b._4e_name()])return[];t||(t=0);h||(h=[]);for(var x=0,u=b[0].childNodes.length;x<u;x++){var r=new d(b[0].childNodes[x]);if(r._4e_name()=="li"){var A={parent:b,indent:t,element:r,contents:[]};if(y)A.grandparent=y;else{A.grandparent=b.parent();if(A.grandparent&&A.grandparent._4e_name()==
"li")A.grandparent=A.grandparent.parent()}e&&r._4e_setMarker(e,"listarray_index",h.length);h.push(A);for(var B=0,C=r[0].childNodes.length,v;B<C;B++){v=new d(r[0].childNodes[B]);v[0].nodeType==k.NODE_ELEMENT&&s[v._4e_name()]?i.listToArray(v,e,h,t+1,A.grandparent):A.contents.push(v)}}}return h},arrayToList:function(b,e,h,t){h||(h=0);if(!b||b.length<h+1)return null;for(var y=b[h].parent[0].ownerDocument,x=y.createDocumentFragment(),u=null,r=h,A=Math.max(b[h].indent,0),B=null;;){var C=b[r];if(C.indent==
A){if(!u||b[r].parent._4e_name()!=u._4e_name()){u=b[r].parent._4e_clone(false,true);x.appendChild(u[0])}B=u[0].appendChild(C.element._4e_clone(false,true)[0]);for(var v=0;v<C.contents.length;v++)B.appendChild(C.contents[v]._4e_clone(true,true)[0]);r++}else if(C.indent==Math.max(A,0)+1){r=i.arrayToList(b,null,r,t);B.appendChild(r.listNode);r=r.nextIndex}else if(C.indent==-1&&!h&&C.grandparent){if(s[C.grandparent._4e_name()])B=C.element._4e_clone(false,true)[0];else if(C.grandparent._4e_name()!="td"){B=
y.createElement(t);C.element._4e_copyAttributes(new d(B))}else B=y.createDocumentFragment();for(v=0;v<C.contents.length;v++){u=C.contents[v]._4e_clone(true,true);B.nodeType==k.NODE_DOCUMENT_FRAGMENT&&C.element._4e_copyAttributes(new d(u));B.appendChild(u[0])}if(B.nodeType==k.NODE_DOCUMENT_FRAGMENT&&r!=b.length-1){B.lastChild&&B.lastChild.nodeType==k.NODE_ELEMENT&&B.lastChild.getAttribute("type")=="_moz"&&f._4e_remove(B.lastChild);f._4e_appendBogus(B)}if(B.nodeType==k.NODE_ELEMENT&&f._4e_name(B)==
t&&B.firstChild){f._4e_trim(B);u=B.firstChild;if(u.nodeType==k.NODE_ELEMENT&&f._4e_isBlockBoundary(u)){u=y.createDocumentFragment();f._4e_moveChildren(B,u);B=u}}u=f._4e_name(B);if(!c.ie&&(u=="div"||u=="p"))f._4e_appendBogus(B);x.appendChild(B);u=null;r++}else return null;if(b.length<=r||Math.max(b[r].indent,0)<A)break}if(e)for(b=new d(x.firstChild);b&&b[0];){b[0].nodeType==k.NODE_ELEMENT&&b._4e_clearMarkers(e,true);b=b._4e_nextSourceNode()}return{listNode:x,nextIndex:r}}},w=/^h[1-6]$/;g.prototype=
{changeListType:function(b,e,h,t){var y=i.listToArray(e.root,h),x=[];for(b=0;b<e.contents.length;b++){var u=e.contents[b];u=u._4e_ascendant("li",true);if(!(!u||!u[0]||u.data("list_item_processed"))){x.push(u);u._4e_setMarker(h,"list_item_processed",true)}}u=new d(e.root[0].ownerDocument.createElement(this.type));for(b=0;b<x.length;b++){var r=x[b].data("listarray_index");y[r].parent=u}h=i.arrayToList(y,h,null,"p");var A;y=h.listNode.childNodes.length;for(b=0;b<y&&(A=new d(h.listNode.childNodes[b]));b++)A._4e_name()==
this.type&&t.push(A);f.insertBefore(h.listNode,e.root);e.root._4e_remove()},createList:function(b,e,h){var t=e.contents;b=e.root[0].ownerDocument;var y=[];if(t.length==1&&t[0][0]===e.root[0]){var x=new d(b.createElement("div"));t[0][0].nodeType!=k.NODE_TEXT&&t[0]._4e_moveChildren(x);t[0][0].appendChild(x[0]);t[0]=x}e=e.contents[0].parent();for(x=0;x<t.length;x++)e=e._4e_commonAncestor(t[x].parent());for(x=0;x<t.length;x++)for(var u=t[x],r;r=u.parent();){if(r[0]===e[0]){y.push(u);break}u=r}if(!(y.length<
1)){t=new d(y[y.length-1][0].nextSibling);x=new d(b.createElement(this.type));for(h.push(x);y.length;){h=y.shift();u=new d(b.createElement("li"));if(w.test(h._4e_name()))u[0].appendChild(h[0]);else{h._4e_copyAttributes(u);h._4e_moveChildren(u);h._4e_remove()}x[0].appendChild(u[0]);c.ie||u._4e_appendBogus()}t[0]?f.insertBefore(x,t):e.append(x)}},removeList:function(b,e,h){function t(v){if((B=new d(A[v?"firstChild":"lastChild"]))&&!(B[0].nodeType==k.NODE_ELEMENT&&B._4e_isBlockBoundary())&&(C=e.root[v?
"_4e_previous":"_4e_next"](j.whitespaces(true)))&&!(B[0].nodeType==k.NODE_ELEMENT&&C._4e_isBlockBoundary({br:1})))f[v?"insertBefore":"insertAfter"](b.document.createElement("br"),B)}for(var y=i.listToArray(e.root,h),x=[],u=0;u<e.contents.length;u++){var r=e.contents[u];r=r._4e_ascendant("li",true);if(!(!r||r.data("list_item_processed"))){x.push(r);r._4e_setMarker(h,"list_item_processed",true)}}r=null;for(u=0;u<x.length;u++){r=x[u].data("listarray_index");y[r].indent=-1;r=r}for(u=r+1;u<y.length;u++)if(y[u].indent>
Math.max(y[u-1].indent,0)){x=y[u-1].indent+1-y[u].indent;for(r=y[u].indent;y[u]&&y[u].indent>=r;){y[u].indent+=x;u++}u--}var A=i.arrayToList(y,h,null,"p").listNode,B,C;t(true);t(undefined);f.insertBefore(A,e.root);e.root._4e_remove()},exec:function(b){var e=b.getSelection(),h=e&&e.getRanges();if(!(!h||h.length<1)){for(var t=e.createBookmarks(true),y=[],x={};h.length>0;){var u=h.shift(),r=u.getBoundaryNodes(),A=r.startNode,B=r.endNode;A[0].nodeType==k.NODE_ELEMENT&&A._4e_name()=="td"&&u.setStartAt(r.startNode,
q.POSITION_AFTER_START);B[0].nodeType==k.NODE_ELEMENT&&B._4e_name()=="td"&&u.setEndAt(r.endNode,q.POSITION_BEFORE_END);u=u.createIterator();for(u.forceBrBreak=false;r=u.getNextParagraph();)if(!r.data("list_block")){r._4e_setMarker(x,"list_block",1);B=new n(r);var C=B.elements,v=null,z=false,E=B.blockLimit,F;for(A=C.length-1;A>=0&&(F=C[A]);A--)if(s[F._4e_name()]&&E.contains(F)){E.removeData("list_group_object");if(A=F.data("list_group_object"))A.contents.push(r);else{A={root:F,contents:[r]};y.push(A);
F._4e_setMarker(x,"list_group_object",A)}z=true;break}if(!z){B=E||B.block;if(B.data("list_group_object"))B.data("list_group_object").contents.push(r);else{A={root:B,contents:[r]};B._4e_setMarker(x,"list_group_object",A);y.push(A)}}}}for(h=[];y.length>0;){A=y.shift();if(this.state=="off")if(s[A.root._4e_name()])this.changeListType(b,A,x,h);else{p.Utils.clearAllMarkers(x);this.createList(b,A,h)}else this.state=="on"&&s[A.root._4e_name()]&&this.removeList(b,A,x)}for(A=0;A<h.length;A++){v=h[A];var D=
this;(b=function(G){var M=v[G?"_4e_previous":"_4e_next"](j.whitespaces(true));if(M&&M[0]&&M._4e_name()==D.type){M._4e_remove();M._4e_moveChildren(v,G?true:false)}})();b(true)}p.Utils.clearAllMarkers(x);e.selectBookmarks(t)}}};var l=p.TripleButton;p.ListUtils=i;p.ListSupport={init:function(){this.listCommand=new g(this.cfg.type)},selectionChange:function(b){var e=this.cfg.type,h=b.path,t;b=this.btn;var y=h.blockLimit;h=h.elements;if(y){if(h)for(var x=0;x<h.length&&(t=h[x])&&t[0]!==y[0];x++){var u=
m.indexOf(h[x]._4e_name(),o);if(u!==-1)if(o[u]===e){b.set("state",l.ON);return}else break}b.set("state",l.OFF)}},offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var b=this.editor,e=this.btn;b.fire("save");this.listCommand.state=e.get("state");this.listCommand.exec(b);b.fire("save");b.notifySelectionChange()}}});
KISSY.Editor.add("localstorage",function(){var g=KISSY,p=g.Editor,s;s=p.STORE="localStorage";if(!p.storeReady){p.storeReady=function(m){p.on("storeReady",m)};p.on("storeReady",function(){p.storeReady=function(m){m()};p.detach("storeReady")})}if(window[s])window[s]._ke||p.fire("storeReady");else{var o=p.Config.base+p.Utils.debugUrl("plugins/localstorage/swfstore.swf?rand="+ +new Date);window[s]=new p.FlashBridge({movie:o,methods:["setItem","removeItem","getValueOf"]});g.mix(window[s],{_ke:1,getItem:function(m){return this.getValueOf(m)}});
window[s].on("contentReady",function(){p.fire("storeReady")})}});KISSY.Editor.add("maximize",function(g){var p=KISSY,s=p.Editor;p.UA.gecko<1.92||g.ready(function(){var o=g.addButton("maximize",{title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize",loading:true});s.use("maximize/support",function(){o.reload(s.Maximize)})})});
KISSY.Editor.add("maximize/support",function(){var g=KISSY.Editor,p=KISSY,s=p.UA,o=p.Node,m=p.Event,q=p.DOM,n;q.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");var j={};p.mix(j,{onClick:function(){var k=this,c=k.editor;k._resize&&m.remove(window,"resize",k._resize);k.call("_saveEditorStatus");k.call("_restoreState");k.btn.boff();setTimeout(function(){k.call("_restoreEditorStatus");c.notifySelectionChange();c.fire("restoreWindow")},30)},_restoreState:function(){var k=document,c=this.editor,
d=this._savedParents;if(d){for(var f=0;f<d.length;f++){var i=d[f];i.el.css("position",i.position)}this._savedParents=null}c.wrap.css({height:this.iframeHeight});q.css(k.body,{width:"",height:"",overflow:""});k.documentElement.style.overflow="";c.editorWrap.css({position:"static",width:this.editorWrapWidth});n.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);k=this.btn.get("el");k.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");k.attr("title",
"\u5168\u5c4f");s.ie<8&&this.editor.toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var k=this.editor,c=[],d=k.editorWrap;this.iframeHeight=k.wrap._4e_style("height");this.editorWrapWidth=d._4e_style("width");this.scrollLeft=q.scrollLeft();this.scrollTop=q.scrollTop();window.scrollTo(0,0);for(k=d.parent();k;){d=k.css("position");if(d!="static"){c.push({el:k,position:d});k.css("position","static")}k=k.parent()}this._savedParents=c;c=this.btn.get("el");c.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
c.attr("title","\u53d6\u6d88\u5168\u5c4f");s.ie<8&&this.editor.toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var k=this.editor;this.savedRanges=null;if(s.gecko&&k.iframeFocus)this.savedRanges=(k=k.getSelection())&&k.getRanges()},_restoreEditorStatus:function(){var k=this.editor,c=k.getSelection(),d=this.savedRanges;k.activateGecko();d&&c&&c.selectRanges(d);if(k.iframeFocus&&c)(k=c.getStartElement())&&k[0]&&k._4e_scrollIntoView();s.ie<8&&this.btn.get("el").one("span").css("background-image",
"")},_maximize:function(k){var c=document,d=this.editor,f=d.editorWrap,i=q.viewportHeight(),w=q.viewportWidth(),l=d.statusDiv?d.statusDiv[0].offsetHeight:0,b=d.toolBarDiv[0].offsetHeight;if(s.ie)c.body.style.overflow="hidden";else q.css(c.body,{width:0,height:0,overflow:"hidden"});c.documentElement.style.overflow="hidden";f.css({position:"absolute",zIndex:d.baseZIndex(g.zIndexManager.MAXIMIZE),width:w+"px"});n.css({zIndex:d.baseZIndex(g.zIndexManager.MAXIMIZE-5),height:i+"px",width:w+"px"});f.offset({left:0,
top:0});n.css({left:0,top:0});d.wrap.css({height:i-l-b+"px"});k!==true&&arguments.callee.call(this,true)},_real:function(){var k=this,c=k.editor;k.call("_saveEditorStatus");k.call("_saveSate");k.call("_maximize");k._resize=k._resize||g.Utils.buffer(k.cfg._maximize,k,100);m.on(window,"resize",k._resize);k.btn.bon();setTimeout(function(){k.call("_restoreEditorStatus");c.notifySelectionChange();c.fire("maximizeWindow")},30)},offClick:function(){n||(n=(new o("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(document.body));
this.call("_real")}});g.Maximize=j});
KISSY.Editor.add("music",function(g){var p=KISSY.Editor,s=g.htmlDataProcessor,o=s&&s.dataFilter;g.ready(function(){o&&o.addRules({elements:{object:function(m){var q=m.attributes;if(!(q.classid&&String(q.classid).toLowerCase())){for(q=0;q<m.children.length;q++)if(m.children[q].name=="embed"){if(!p.Utils.isFlashEmbed(m.children[q]))break;if(m.children[q].attributes.src.indexOf("niftyplayer.swf")!=-1)return s.createFakeParserElement(m,"ke_music","music",true)}return null}for(q=0;q<m.children.length;q++){var n=
m.children[q];if(n.name=="param"&&n.attributes.name=="movie")if(n.attributes.value.indexOf("niftyplayer.swf")!=-1)return s.createFakeParserElement(m,"ke_music","music",true)}},embed:function(m){if(!p.Utils.isFlashEmbed(m))return null;if(m.attributes.src.indexOf("niftyplayer.swf")!=-1)return s.createFakeParserElement(m,"ke_music","music",true)}}},4);p.use("music/support",function(){new p.MusicInserter(g)})})});
KISSY.Editor.add("music/support",function(){function g(d){g.superclass.constructor.apply(this,arguments);d.cfg.disableObjectResizing||m.on(d.document.body,n.ie?"resizestart":"resize",function(f){(new s.Node(f.target)).hasClass(j)&&f.preventDefault()})}function p(d){return d._4e_name()==="img"&&!!d.hasClass(j)&&d}var s=KISSY,o=s.Editor,m=s.Event,q=o.Flash,n=s.UA,j="ke_music",k=["img."+j];s.extend(g,q,{_config:function(){this._cls=j;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";
this._contextMenu=c;this._flashRules=k}});q.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",p);o.MusicInserter=g;var c={"\u97f3\u4e50\u5c5e\u6027":function(d){var f=d.editor.getSelection();(f=(f=f&&f.getStartElement())&&p(f))&&d.show(null,f)}}});
KISSY.add("overlay",function(g){g.Overlay=g.UIBase.create([g.UIBase.Box,g.UIBase.ContentBox,g.UIBase.Position,g.UIBase.Loading,g.UA.ie==6?g.UIBase.Shim:null,g.UIBase.Align,g.UIBase.Mask],{initializer:function(){g.log("Overlay init")},renderUI:function(){g.log("_renderUIOverlay");this.get("el").addClass("ks-overlay")},syncUI:function(){g.log("_syncUIOverlay")},bindUI:function(){g.log("_bindUIOverlay")},destructor:function(){g.log("overlay destructor")}})},{requires:["core"]});
KISSY.add("dialog",function(g){g.Dialog=g.UIBase.create(g.Overlay,[g.UIBase.StdMod,g.UIBase.Close,g.UIBase.Drag,g.UIBase.Constrain],{initializer:function(){g.log("dialog init")},renderUI:function(){g.log("_renderUIDialog");this.get("el").addClass("ks-dialog");this.set("handlers",[this.get("header")])},bindUI:function(){g.log("_bindUIDialog")},syncUI:function(){g.log("_syncUIDialog")},destructor:function(){g.log("Dialog destructor")}})},{host:"overlay"});
KISSY.Editor.add("ext-focus",function(){function g(){p.log("FocusExt init")}var p=KISSY,s=p.UA,o=p.Editor,m=o.focusManager;o.namespace("UIBase");g.ATTRS={focus4e:{value:true}};g.prototype={_uiSetFocus4e:function(q){if(q){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){p.log("_syncUIFocusExt")},__renderUI:function(){p.log("_renderUIFocusExt")},__bindUI:function(){this._focus4e=
(new p.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var q=this._focusEditor=m.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(s.ie&&q){var n=q.document.selection.createRange();if(n)if(n.item&&n.item(0).ownerDocument==q.document){q=document.body.createTextRange();q.moveToElementText(this.get("el")._4e_first()[0]);q.collapse(true);
q.select()}}},_hide4FocusExt:function(){var q=this._focusEditor;q&&q.focus()}};o.UIBase.Focus=g},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var g=KISSY,p=g.Editor;if(!p.Overlay){var s=g.UIBase.create(g.Overlay,[p.UIBase.Focus],{init:function(){g.log("Overlay4E init")},syncUI:function(){g.log("_syncUIOverlay4E");p.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}}),o=g.UIBase.create(g.Dialog,[p.UIBase.Focus],{show:function(){this.center();var q=this.get("y");if(q-g.DOM.scrollTop()>200){q=g.DOM.scrollTop()+200;this.set("y",q)}o.superclass.show.call(this)}},
{ATTRS:{constrain:{value:true},zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}});p.Overlay=s;p.Dialog=o;var m;p.Overlay.loading=function(){m||(m=new p.Overlay({x:0,focus4e:false,width:g.UA.ie==6?g.DOM.docWidth():"100%",y:0,zIndex:p.baseZIndex(p.zIndexManager.LOADING),elCls:"ke-global-loading"}));m.set("height",g.DOM.docHeight());m.show();m.loading()};p.Overlay.unloading=function(){m&&m.hide()}}});
KISSY.Editor.add("pagebreak",function(g){var p=KISSY.Node,s=g.htmlDataProcessor,o=s&&s.dataFilter;o&&o.addRules({elements:{div:function(m){var q=m.attributes;var n=(q=q&&q.style)&&m.children.length==1&&m.children[0];if((n=n&&n.name=="span"&&n.attributes.style)&&/page-break-after\s*:\s*always/i.test(q)&&/display\s*:\s*none/i.test(n))return s.createFakeParserElement(m,"ke_pagebreak","div")}}});g.ready(function(){g.addButton("page-break",{title:"\u5206\u9875",contentCls:"ke-toolbar-pagebreak",offClick:function(){var m=
this.editor,q=new p('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,m.document);q=m.createFakeElement?m.createFakeElement(q,"ke_pagebreak","div",true,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'):q;q=(new p("<div>",null,m.document)).append(q);m.insertElement(q)}})})});
KISSY.Editor.add("preview",function(g){g.ready(function(){g.addButton("preview",{title:"\u9884\u89c8",contentCls:"ke-toolbar-preview",offClick:function(){var p=this.editor,s=640,o=420,m=80;try{var q=window.screen;s=Math.round(q.width*0.8);o=Math.round(q.height*0.7);m=Math.round(q.width*0.1)}catch(n){}p=p._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+p.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");s=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+
s+",height="+o+",left="+m);o=s.document;o.open();o.write(p);o.close();s.focus()}})})});
KISSY.Editor.add("progressbar",function(){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var p=KISSY,s=p.Editor;if(!s.ProgressBar){var o=p.Node;p.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
g.ATTRS={container:{},width:{},height:{},progress:{value:0}};p.extend(g,p.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var m=this.get("height"),q=new o("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+m+";'></div>"),n=this.get("container");m=(new o("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(m)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(q);var j=(new o("<span class='ke-progressbar-title'>")).appendTo(q);
n&&q.appendTo(n);this.el=q;this._title=j;this._p=m;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(m){m=m.newVal;this._p.css("width",m+"%");this._title.html(m+"%")}});s.ProgressBar=g}});
KISSY.Editor.add("removeformat",function(g){function p(k,c){for(var d=0;d<c.length;d++)k.removeAttr(c[d])}var s=KISSY.Editor,o=s.RANGE,m=s.ElementPath,q=s.NODE,n="class,style,lang,width,height,align,hspace,valign".split(/,/),j=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");g.ready(function(){g.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:s.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var k=
this.editor;j.lastIndex=0;var c=k.getSelection().getRanges();k.fire("save");for(var d=0,f;f=c[d];d++)if(!f.collapsed){f.enlarge(o.ENLARGE_ELEMENT);var i=f.createBookmark(),w=i.startNode,l=i.endNode,b=function(e){for(var h=new m(e),t=h.elements,y=1,x;x=t[y];y++){if(x._4e_equals(h.block)||x._4e_equals(h.blockLimit))break;j.test(x._4e_name())&&e._4e_breakParent(x)}};b(w);b(l);for(w=w._4e_nextSourceNode(true,q.NODE_ELEMENT);w;){if(w._4e_equals(l))break;b=w._4e_nextSourceNode(false,q.NODE_ELEMENT);w._4e_name()==
"img"&&w.attr("_ke_realelement")||(j.test(w._4e_name())?w._4e_remove(true):p(w,n));w=b}f.moveToBookmark(i)}k.getSelection().selectRanges(c);k.fire("save")}})})});
KISSY.Editor.add("resize",function(g){var p=KISSY,s=p.Node,o=p.Draggable;g.ready(function(){var m=g.statusDiv,q=new s("<div class='ke-resizer'>"),n=g.cfg.pluginConfig.resize||{};n=n.direction||["x","y"];q.appendTo(m);g.on("maximizeWindow",function(){q.css("display","none")});g.on("restoreWindow",function(){q.css("display","")});m=new o({node:q});var j=0,k=0,c=g.wrap,d=g.editorWrap;m.on("dragstart",function(){j=c.height();k=d.width()});m.on("drag",function(f){var i=f.pageX-this.startMousePos.left;
f=f.pageY-this.startMousePos.top;p.inArray("y",n)&&c.height(j+f);p.inArray("x",n)&&d.width(k+i)})})});
KISSY.Editor.add("select",function(){function g(j){g.superclass.constructor.call(this,j);this._init()}var p=KISSY,s=p.Node,o=p.Event,m=p.DOM,q=p.Editor;if(!q.Select){g.DISABLED=0;g.ENABLED=1;var n=q.XHTML_DTD;g.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var j=this.el.parent();j;){var k=j._4e_name();if(n[k]&&n[k].div)return j;j=j.parent()}return new s(document.body)}},state:{value:1}};g.decorate=
function(j){for(var k=j.width(),c=[],d=j.all("option"),f=0;f<d.length;f++){var i=d[f];c.push({name:m.html(i),value:m.attr(i,"value")})}return new g({width:k+"px",el:j,items:c,cls:"ke-combox",value:j.val()})};p.extend(g,p.Base,{_init:function(){var j=this.get("container"),k=this.get("el"),c=new s("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
d=this.get("title")||"",f=this.get("cls"),i=c.one(".ke-select-text"),w=c.one(".ke-select-text-inner");c.one(".ke-select-drop");this.get("value")!==undefined?w.html(this._findNameByV(this.get("value"))):w.html(d);i.css("width",this.get("width"));c._4e_unselectable();d&&c.attr("title",d);f&&c.addClass(f);if(k)k[0].parentNode.replaceChild(c[0],k[0]);else j&&c.appendTo(j);c.on("click",this._click,this);this.el=c;this.title=w;this._focusA=c.one("a.ke-select");q.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(j){var k=this.get("title")||"",c=this.get("items");if(this.get("showValue"))return j||k;for(var d=0;d<c.length;d++){var f=c[d];if(f.value==j){k=f.name;break}}return k},_valueChange:function(j){this.title.html(this._findNameByV(j.newVal))},_itemsChange:function(j){j=j.newVal;var k=this._selectList;k.html("");if(j)for(var c=0;c<j.length;c++){var d=j[c];(new s("<a class='ke-select-menu-item' href='#' data-value='"+
d.value+"'>"+d.name+"</a>",d.attrs)).appendTo(k)._4e_unselectable()}this.as=k.all("a")},val:function(j){if(j!==undefined){this.set("value",j);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var j=this,k=j.el,c=j.get("popUpWidth"),d=j._focusA,f=new q.Overlay({autoRender:true,render:j.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:c?c:k.width(),zIndex:q.baseZIndex(q.zIndexManager.SELECT),focusMgr:false}),
i=j.get("items");c=f.get("contentEl").one("div");j.menu=f;o.on(window,"resize",j._resize,j);j.get("title")&&(new s("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+j.get("title")+"</div>")).appendTo(c);j._selectList=(new s("<div>")).appendTo(c);j._itemsChange({newVal:i});f.on("show",function(){d.addClass("ke-select-active")});f.on("hide",function(){d.removeClass("ke-select-active")});o.on([document,j.get("doc")],"click",function(w){k.contains(w.target)||f.hide()});c.on("click",
j._select,j);j.as=j._selectList.all("a");o.on(c[0],"mouseenter",function(){j.as.removeClass("ke-menu-selected")});j.on("afterItemsChange",j._itemsChange,j);j.menuNode=c},_stateChange:function(j){var k=this.el;j.newVal==1?k.removeClass("ke-select-disabled"):k.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(j){j.halt();var k=this.menu,c=this.menuNode;if(j=(new s(j.target))._4e_ascendant(function(i){return c.contains(i)&&
i._4e_name()=="a"},true)){var d=this.get("value"),f=j.attr("data-value");this.set("value",f);this.fire("click",{newVal:f,prevVal:d,name:j.html()});k.hide()}},_real:function(){var j=this.el,k=j.offset(),c=p.clone(k),d=this.menu.get("el").height(),f=this.menu.get("el").width(),i=m.scrollTop(),w=m.scrollLeft(),l=m.viewportHeight(),b=m.viewportWidth();b=w+b-60;l=i+l;var e=k.top+(j.height()-2);j=k.left+j.width()-2;var h=this.get("align"),t=h[0];if(h[1]=="b"){k.top=e;if(k.top+d>l&&c.top-i>l-e)k.top=c.top-
d}else{k.top=c.top-d;if(k.top<i&&c.top-i<l-e)k.top=e}if(t=="l"){if(k.left+f>b&&j-w>b-c.left)k.left=j-f}else{k.left=j-f;if(k.left<w&&j-w<b-c.left)k.left=c.left}this.menu.set("xy",[k.left,k.top]);this.menu.show()},_click:function(j){j.preventDefault();j=this.el;var k=this.get("value");if(!j.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();k&&this.menu&&this.as.each(function(c){c.attr("data-value")==k?c.addClass("ke-menu-selected"):c.removeClass("ke-menu-selected")})}}});
q.Select=g}});KISSY.Editor.add("separator",function(g){g.ready(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(g.toolBarDiv)})});KISSY.Editor.add("smiley",function(g){var p=KISSY.Editor;g.ready(function(){var s=g.addButton("smiley",{contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",loading:true});p.use("smiley/support",function(){s.reload(p.SmileySupport)})})});
KISSY.Editor.add("smiley/support",function(){var g=KISSY,p=g.Event,s=g.Editor,o=g.DOM;o.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");var m;s.SmileySupport={_selectSmiley:function(q){q.halt();
var n=this.editor;q=new g.Node(q.target);var j;if(q._4e_name()=="a"&&(j=q.attr("data-icon"))){j=new g.Node("<img class='ke_smiley'alt='' src='"+j+"'/>",null,n.document);n.insertElement(j);this.smileyWin.hide()}},_hidePanel:function(q){var n=this.btn.get("el");q=new g.Node(q.target);var j=this.smileyWin;n._4e_equals(q)||n.contains(q)||j.hide()},_show:function(){var q=this.smileyWin;q&&q.get("visible")?q.hide():this.call("_prepare")},_prepare:function(){var q=this.cfg,n=this.btn,j=this.editor,k;if(!m){m=
"<div class='ke-smiley-sprite'>";for(k=0;k<=98;k++)m+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+k+".gif'></a>";m+="</div>"}k=m;k=this.smileyWin=new s.Overlay({content:k,focus4e:false,width:"297px",autoRender:true,elCls:"ks-popup",zIndex:j.baseZIndex(s.zIndexManager.POPUP_MENU),mask:false});this.smileyPanel=k.get("contentEl");k.on("show",n.bon,n);k.on("hide",n.boff,n);this.smileyPanel.on("click",q._selectSmiley,this);p.on(document,"click",q._hidePanel,this);p.on(j.document,
"click",q._hidePanel,this);this.cfg._prepare=this.cfg._real;this.call("_real")},_real:function(){var q=this.btn.get("el"),n=q.offset();n.top+=q.height()+5;if(n.left+this.smileyPanel.width()>o.viewportWidth()-60)n.left=o.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[n.left,n.top]);this.smileyWin.show()},offClick:function(){this.call("_prepare")},onClick:function(){this.call("_prepare")}}});
KISSY.Editor.add("sourcearea",function(g){var p=KISSY.Editor;KISSY.UA.gecko<1.92||g.ready(function(){var s=p.SOURCE_MODE,o=p.WYSIWYG_MODE;g.addButton("sourcearea",{title:"\u6e90\u7801",contentCls:"ke-toolbar-source",init:function(){var m=this.btn,q=this.editor;q.on("wysiwygmode",m.boff,m);q.on("sourcemode",m.bon,m)},offClick:function(){this.editor.execCommand("sourceAreaSupport",s)},onClick:function(){this.editor.execCommand("sourceAreaSupport",o)}})})});
KISSY.Editor.add("sourcearea/support",function(g){var p=KISSY,s=p.Editor,o=p.UA;s.SourceAreaSupport||function(){function m(){var j=this.mapper={};j[q]=this._show;j[n]=this._hide}var q=s.SOURCE_MODE,n=s.WYSIWYG_MODE;p.augment(m,{exec:function(j,k){var c=this.mapper;c[k]&&c[k].call(this,j)},_show:function(j){j.textarea.val(j.getData(true));this._showSource(j);j.fire("sourcemode")},_showSource:function(j){var k=j.textarea,c=j.iframe;k.css("display","");c.css("display","none");o.ie<8&&k.css("height",
j.wrap.css("height"));k[0].focus()},_hideSource:function(j){var k=j.textarea;j.iframe.css("display","");k.css("display","none")},_hide:function(j){var k=j.textarea;this._hideSource(j);j.fire("save");j.setData(k.val());j.fire("wysiwygmode");j.fire("save");o.gecko&&j.activateGecko()}});s.SourceAreaSupport=new m}();g.addCommand("sourceAreaSupport",s.SourceAreaSupport)});
KISSY.Editor.add("table",function(g){var p=KISSY,s=p.Editor,o=p.trim,m=(p.UA.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border"),q=g.htmlDataProcessor;
p=q&&q.dataFilter;q=q&&q.htmlFilter;p&&p.addRules({elements:{table:function(n){n=n.attributes;var j=n["class"],k=parseInt(n.border,10);if(!k||k<=0)n["class"]=(j||"")+" ke_show_border"}}});q&&q.addRules({elements:{table:function(n){n=n.attributes;var j=n["class"];if(j)n["class"]=o(j.replace("ke_show_border","").replace(/\s{2}/," "))}}});g.ready(function(){var n=g.addButton("table",{contentCls:"ke-toolbar-table",title:"\u63d2\u5165\u8868\u683c",loading:true});s.use("table/support",function(){var j=new s.TableUI(g);n.reload({offClick:function(){j._tableShow()}})});
g.addCustomStyle(m)})});
KISSY.Editor.add("table/support",function(){function g(l){var b=this,e={},h;for(h in w)(function(t){e[t]=function(){l.fire("save");w[t](b);l.fire("save")}})(h);d.ContextMenu.register({editor:l,rules:f,width:"120px",funcs:e});b.editor=l}function p(l){function b(A){if(!(t.length>0))if(A[0].nodeType==KEN.NODE_ELEMENT&&i.test(A._4e_name())&&!A.data("selected_cell")){A._4e_setMarker(y,"selected_cell",true);t.push(A)}}for(var e=l.createBookmarks(),h=l.getRanges(),t=[],y={},x=0;x<h.length;x++){var u=h[x];
if(u.collapsed){u=u.getCommonAncestor();(u=u._4e_ascendant("td",true)||u._4e_ascendant("th",true))&&t.push(u)}else{u=new Walker(u);var r;for(u.guard=b;r=u.next();)if((r=r.parent())&&i.test(r._4e_name())&&!r.data("selected_cell")){r._4e_setMarker(y,"selected_cell",true);t.push(r)}}}d.Utils.clearAllMarkers(y);l.selectBookmarks(e);return t}function s(l,b){var e=l.getStartElement()._4e_ascendant("tr");if(e){var h=e._4e_clone(true);h.insertBefore(e);e=(b?h[0]:e[0]).cells;for(h=0;h<e.length;h++){e[h].innerHTML=
"";k.ie||(new c(e[h]))._4e_appendBogus()}}}function o(l){if(l instanceof d.Selection){var b=p(l),e=b.length;l=[];for(var h,t,y=0;y<e;y++){var x=b[y].parent(),u=x[0].rowIndex;!y&&(h=u-1);l[u]=x;y==e-1&&(t=u+1)}y=x._4e_ascendant("table");h=new c(t<y[0].rows.length&&y[0].rows[t]||h>0&&y[0].rows[h]||y[0].parentNode);for(y=l.length;y>=0;y--)l[y]&&o(l[y]);return h}else if(l instanceof c){y=l._4e_ascendant("table");y[0].rows.length==1?y._4e_remove():l._4e_remove()}return 0}function m(l,b){var e=l.getStartElement();
if(e=e._4e_ascendant("td",true)||e._4e_ascendant("th",true))for(var h=e._4e_ascendant("table"),t=e[0].cellIndex,y=0;y<h[0].rows.length;y++){var x=h[0].rows[y];if(!(x.cells.length<t+1)){e=new c(x.cells[t].cloneNode(false));k.ie||e._4e_appendBogus();x=new c(x.cells[t]);b?e.insertBefore(x):e.insertAfter(x)}}}function q(l){if(l instanceof d.Selection){var b=p(l),e,h=[];l=b[0]&&b[0]._4e_ascendant("table");var t,y,x;t=0;for(y=b.length;t<y;t++)h.push(b[t][0].cellIndex);h.sort();t=1;for(y=h.length;t<y;t++)if(h[t]-
h[t-1]>1){x=h[t-1]+1;break}x||(x=h[0]>0?h[0]-1:h[h.length-1]+1);h=l[0].rows;t=0;for(y=h.length;t<y;t++)if(e=h[t].cells[x])break;e=e?new c(e):l._4e_previous();for(x=b.length-1;x>=0;x--)b[x]&&q(b[x]);return e}else if(l instanceof c){b=l._4e_ascendant("table");if(!b)return null;e=l[0].cellIndex;for(x=b[0].rows.length-1;x>=0;x--){l=new c(b[0].rows[x]);if(!e&&l[0].cells.length==1)o(l);else l[0].cells[e]&&l[0].removeChild(l[0].cells[e])}}return null}function n(l,b){var e=new d.Range(l[0].ownerDocument);
if(!e.moveToElementEditablePosition(l,b?true:undefined)){e.selectNodeContents(l);e.collapse(b?false:true)}e.select(true)}var j=KISSY,k=j.UA,c=j.Node,d=j.Editor,f=["tr","th","td","tbody","table"];j.augment(g,{_tableShow:function(l,b,e){this.editor.useDialog("table/dialog",function(h){h.show(b,e)})}});var i=/^(?:td|th)$/,w={"\u8868\u683c\u5c5e\u6027":function(l){var b=l.editor.getSelection(),e=b&&b.getStartElement();if(b=e&&e._4e_ascendant("table",true)){e=e._4e_ascendant(function(h){h=h._4e_name();return h=="td"||h==
"th"},true);l._tableShow(null,b,e)}},"\u5220\u9664\u8868\u683c":function(l){var b=(l=l.editor.getSelection())&&l.getStartElement();if(b=b&&b._4e_ascendant("table",true)){l.selectElement(b);var e=l.getRanges()[0];e.collapse();l.selectRanges([e]);l=b.parent();l[0].childNodes.length==1&&l._4e_name()!="body"&&l._4e_name()!="td"?l._4e_remove():b._4e_remove()}},"\u5220\u9664\u884c ":function(l){l=l.editor.getSelection();n(o(l),undefined)},"\u5220\u9664\u5217 ":function(l){l=l.editor.getSelection();(l=q(l))&&n(l,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(l){l=l.editor.getSelection();
s(l,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(l){l=l.editor.getSelection();s(l,undefined)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(l){l=l.editor.getSelection();m(l,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(l){l=l.editor.getSelection();m(l,undefined)}};d.TableUI=g});
KISSY.Editor.add("tabs",function(){function g(q){this.cfg=q;this._init()}var p=KISSY,s=p.Editor,o=p.DOM,m=p.Node;if(!s.Tabs){p.augment(g,p.EventTarget,{_init:function(){var q=this,n=q.cfg,j=n.tabs,k=n.contents.children("div"),c=j.children("li");j.on("click",function(d){d=new m(d.target);if(d=d._4e_ascendant(function(i){return i._4e_name()==="li"&&j.contains(i)},true)){c.removeClass("ke-tab-selected");var f=d.attr("rel");d.addClass("ke-tab-selected");k.hide();o.show(k[p.indexOf(d[0],c)]);q.fire(f)}})},
getTab:function(q){var n=this.cfg,j=n.tabs;n=n.contents.children("div");j=j.children("li");for(var k=0;k<j.length;k++){var c=new m(j[k]),d=new m(n[k]);if(p.isNumber(q)&&q==k||p.isString(q)&&q==c.attr("rel"))return{tab:c,content:d}}},remove:function(q){q=this.getTab(q);q.tab.remove();q.content.remove()},_getActivate:function(){var q=this.cfg,n=q.tabs;q.contents.children("div");q=n.children("li");for(n=0;n<q.length;n++){var j=new m(q[n]);if(j.hasClass("ke-tab-selected"))return j.attr("rel")}},activate:function(q){if(arguments.length==
0)return this._getActivate();var n=this.cfg,j=n.tabs;n=n.contents.children("div");j.children("li").removeClass("ke-tab-selected");n.hide();j=this.getTab(q);j.tab.addClass("ke-tab-selected");j.content.show()}});s.Tabs=g}});
KISSY.Editor.add("templates",function(g){var p=KISSY,s=p.Node,o=p.Editor.Dialog;p.DOM.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");g.ready(function(){g.addButton("templates",{contentCls:"ke-toolbar-template",
title:"\u6a21\u677f",offClick:function(){this.cfg._prepare.call(this)},_prepare:function(){for(var m=this.editor,q=m.cfg.pluginConfig.templates||[],n="<div class='ke-tpl'>",j=0;j<q.length;j++)n+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+q[j].demo+"</a>";n+="</div>";var k=new o({width:500,mask:true,autoRender:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:n});k.get("el").all(".ke-tpl-list").on("click",function(c){c.halt();c=(new s(c.target))._4e_index();c!=-1&&m.insertHtml(q[c].html);k.hide()});
this.ui=k;this.cfg.show.call(this);this.cfg._prepare=this.cfg.show},show:function(){this.ui.show()}})})});
KISSY.add("uibase",function(g){function p(j){m.apply(this,arguments);for(var k=this.constructor;k;){if(j&&j[o]&&k.HTML_PARSER)if(j[o]=g.one(j[o])){var c=j[o],d=k.HTML_PARSER,f=void 0,i=void 0;for(f in d)if(d.hasOwnProperty(f)){i=d[f];if(g.isFunction(i))this.__set(f,i.call(this,c));else if(g.isString(i))this.__set(f,c.one(i));else g.isArray(i)&&i[0]&&this.__set(f,c.all(i[0]))}}k=k.superclass&&k.superclass.constructor}s(this,"initializer","constructor");j&&j.autoRender&&this.render()}function s(j,k,
c){for(var d=j.constructor,f=[],i,w,l;d;){l=[];if(w=d.__ks_exts)for(var b=0;b<w.length;b++)if(i=w[b]){if(c!="constructor")i=w[b].prototype[c];i&&l.push(i)}if(i=d.prototype[k])l.push(i);l.length&&f.push.apply(f,l.reverse());d=d.superclass&&d.superclass.constructor}for(b=f.length-1;b>=0;b--)f[b]&&f[b].call(j)}var o="srcNode",m=g.Base,q=g.Attribute.__capitalFirst,n=function(){};p.HTML_PARSER={};p.ATTRS={render:{valueFn:function(){return document.body}},rendered:{value:false}};g.extend(p,m,{render:function(){if(!this.get("rendered")){this._renderUI();
this.fire("renderUI");s(this,"renderUI","__renderUI");this._bindUI();this.fire("bindUI");s(this,"bindUI","__bindUI");this._syncUI();this.fire("syncUI");s(this,"syncUI","__syncUI");this.set("rendered",true)}},_renderUI:n,renderUI:n,_bindUI:function(){var j=this,k=j.__getDefAttrs(),c,d;for(c in k)if(k.hasOwnProperty(c)){d="_uiSet"+q(c);j[d]&&function(f,i){j.on("after"+q(f)+"Change",function(w){j[i](w.newVal,w)})}(c,d)}},bindUI:n,_syncUI:function(){var j=this.__getDefAttrs(),k;for(k in j)if(j.hasOwnProperty(k)){var c=
"_uiSet"+q(k);this[c]&&this[c](this.get(k))}},syncUI:n,destroy:function(){for(var j=this.constructor,k,c,d;j;){(c=j.prototype.destructor)&&c.apply(this);if(k=j.__ks_exts)for(d=k.length-1;d>=0;d--)(c=k[d]&&k[d].prototype.__destructor)&&c.apply(this);j=j.superclass&&j.superclass.constructor}this.fire("destroy");this.detach()}});p.create=function(j,k,c,d){function f(){p.apply(this,arguments)}if(g.isArray(j)){d=c;c=k;k=j;j=p}j=j||p;g.extend(f,j,c,d);if(k){f.__ks_exts=k;g.each(k,function(i){if(i){g.each(["ATTRS",
"HTML_PARSER"],function(w){if(i[w]){f[w]=f[w]||{};g.mix(f[w],i[w],false)}});g.augment(f,i,false)}})}return f};g.UIBase=p});
KISSY.add("uibase-align",function(g){function p(){}function s(m,q){var n=q.charAt(0),j=q.charAt(1),k,c,d,f;if(m){m=g.one(m);k=m.offset();c=m[0].offsetWidth;d=m[0].offsetHeight}else{k={left:o.scrollLeft(),top:o.scrollTop()};c=o.viewportWidth();d=o.viewportHeight()}f=k.left;k=k.top;if(n==="c")k+=d/2;else if(n==="b")k+=d;if(j==="c")f+=c/2;else if(j==="r")f+=c;return{left:f,top:k}}var o=g.DOM;g.mix(p,{TL:"tl",TC:"tc",TR:"tr",CL:"cl",CC:"cc",CR:"cr",BL:"bl",BC:"bc",BR:"br"});p.ATTRS={align:{}};p.prototype=
{_uiSetAlign:function(m){g.isPlainObject(m)&&this.align(m.node,m.points,m.offset)},align:function(m,q,n){var j,k=this.get("el");n=n||[0,0];j=o.offset(k);m=s(m,q[0]);q=s(k,q[1]);q=[q.left-m.left,q.top-m.top];this.set("xy",[j.left-q[0]+ +n[0],j.top-q[1]+ +n[1]])},center:function(m){this.set("align",{node:m,points:[p.CC,p.CC],offset:[0,0]})}};g.UIBase.Align=p});
KISSY.add("uibase-box",function(g){function p(){g.log("box init")}g.namespace("UIBase");var s=g.Node;g.mix(p,{APPEND:1,INSERT:0});p.ATTRS={el:{setter:function(o){if(g.isString(o))return g.one(o)}},elCls:{},elStyle:{},width:{},height:{},elTagName:{value:"div"},elAttrs:{},elOrder:{value:1},html:{value:false}};p.HTML_PARSER={el:function(o){return o}};p.prototype={__syncUI:function(){g.log("_syncUIBoxExt")},__bindUI:function(){g.log("_bindUIBoxExt")},__renderUI:function(){g.log("_renderUIBoxExt");var o=
this.get("render"),m=this.get("el");o=new s(o);if(!m){m=new s("<"+this.get("elTagName")+">");this.get("elOrder")?o.append(m):o.prepend(m);this.set("el",m)}},_uiSetElAttrs:function(o){g.log("_uiSetElAttrs");o&&this.get("el").attr(o)},_uiSetElCls:function(o){o&&this.get("el").addClass(o)},_uiSetElStyle:function(o){g.log("_uiSetElStyle");o&&this.get("el").css(o)},_uiSetWidth:function(o){g.log("_uiSetWidth");o&&this.get("el").width(o)},_uiSetHeight:function(o){g.log("_uiSetHeight");o&&this.get("el").height(o)},
_uiSetHtml:function(o){g.log("_uiSetHtml");o!==false&&this.get("el").html(o)},__destructor:function(){g.log("box __destructor");var o=this.get("el");if(o){o.detach();o.remove()}}};g.UIBase.Box=p});
KISSY.add("uibase-close",function(g){function p(){g.log("close init")}g.namespace("UIBase");var s=g.Node;p.ATTRS={closable:{value:true},closeBtn:{}};p.HTML_PARSER={closeBtn:".ks-ext-close"};p.prototype={__syncUI:function(){g.log("_syncUICloseExt")},_uiSetClosable:function(o){g.log("_uiSetClosable");var m=this.get("closeBtn");if(m)o?m.show():m.hide()},__renderUI:function(){g.log("_renderUICloseExt");var o=this.get("closeBtn"),m=this.get("contentEl");if(!o&&m){o=(new s("<a href='#' class='ks-ext-close'><span class='ks-ext-close-x'>X</span></a>")).appendTo(m);
this.set("closeBtn",o)}},__bindUI:function(){g.log("_bindUICloseExt");var o=this,m=o.get("closeBtn");m&&m.on("click",function(q){o.hide();q.halt()})},__destructor:function(){g.log("close-ext __destructor");var o=this.get("closeBtn");o&&o.detach()}};g.UIBase.Close=p});
KISSY.add("uibase-constrain",function(g){function p(){g.log("constrain init")}function s(m){var q;if(!m)return q;var n=this.get("el");if(m!==true){m=g.one(m);q=m.offset();g.mix(q,{maxLeft:q.left+m[0].offsetWidth-n[0].offsetWidth,maxTop:q.top+m[0].offsetHeight-n[0].offsetHeight})}else{m=document.documentElement.clientWidth;q={left:o.scrollLeft(),top:o.scrollTop()};g.mix(q,{maxLeft:q.left+m-n[0].offsetWidth,maxTop:q.top+o.viewportHeight()-n[0].offsetHeight})}return q}g.namespace("UIBase");var o=g.DOM;
p.ATTRS={constrain:{value:false}};p.prototype={__bindUI:function(){g.log("_bindUIConstrain")},__renderUI:function(){g.log("_renderUIConstrain");var m=this,q=m.__getDefAttrs(),n=q.x;q=q.y;var j=n.setter,k=q.setter;n.setter=function(c){var d=j&&j(c);if(d===undefined)d=c;if(!m.get("constrain"))return d;c=s.call(m,m.get("constrain"));return Math.min(Math.max(d,c.left),c.maxLeft)};q.setter=function(c){var d=k&&k(c);if(d===undefined)d=c;if(!m.get("constrain"))return d;c=s.call(m,m.get("constrain"));return Math.min(Math.max(d,
c.top),c.maxTop)};m.addAttr("x",n);m.addAttr("y",q)},__syncUI:function(){g.log("_syncUIConstrain")},__destructor:function(){g.log("constrain-ext __destructor")}};g.UIBase.Constrain=p});
KISSY.add("uibase-contentbox",function(g){function p(){g.log("contentbox init")}g.namespace("UIBase");var s=g.Node;p.ATTRS={contentEl:{},contentElAttrs:{},contentTagName:{value:"div"},content:{}};p.HTML_PARSER={contentEl:".ks-contentbox"};p.prototype={__syncUI:function(){g.log("_syncUIContentBox")},__bindUI:function(){g.log("_bindUIContentBox")},__renderUI:function(){g.log("_renderUIContentBox");var o=this.get("contentEl"),m=this.get("el");if(!o){o=(new s("<"+this.get("contentTagName")+" class='ks-contentbox'>")).appendTo(m);
this.set("contentEl",o)}},_uiSetContentElAttrs:function(o){g.log("_uiSetContentElAttrs");o&&this.get("contentEl").attr(o)},_uiSetContent:function(o){g.log("_uiSetContent");o!==undefined&&this.get("contentEl").html(o)},__destructor:function(){g.log("contentbox __destructor")}};g.UIBase.ContentBox=p});
KISSY.add("uibase-drag",function(g){function p(){g.log("drag init")}g.namespace("UIBase");p.ATTRS={handlers:{value:[]},draggable:{value:true}};p.prototype={_uiSetHandlers:function(s){g.log("_uiSetHanlders");s&&s.length>0&&this.__drag.set("handlers",s)},__syncUI:function(){g.log("_syncUIDragExt")},__renderUI:function(){g.log("_renderUIDragExt")},__bindUI:function(){g.log("_bindUIDragExt");var s=this.get("el");this.__drag=new g.Draggable({node:s,handlers:this.get("handlers")})},_uiSetDraggable:function(s){g.log("_uiSetDraggable");
var o=this.__drag;if(s){o.detach("drag");o.on("drag",this._dragExtAction,this)}else o.detach("drag")},_dragExtAction:function(s){this.set("xy",[s.left,s.top])},__destructor:function(){g.log("DragExt __destructor");var s=this.__drag;s&&s.destroy()}};g.UIBase.Drag=p});
KISSY.add("uibase-loading",function(g){function p(){g.log("LoadingExt init")}g.namespace("UIBase");p.prototype={loading:function(){if(!this._loadingExtEl)this._loadingExtEl=(new g.Node("<div class='ks-ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'>")).appendTo(this.get("el"));this._loadingExtEl.show()},unloading:function(){var s=this._loadingExtEl;s&&s.hide()}};g.UIBase.Loading=p});
KISSY.add("uibase-mask",function(g){function p(){g.log("mask init")}g.namespace("UIBase");var s,o=g.UA,m=0;p.ATTRS={mask:{value:false}};p.prototype={__bindUI:function(){g.log("_bindUIMask")},__renderUI:function(){g.log("_renderUIMask")},__syncUI:function(){g.log("_syncUIMask")},_uiSetMask:function(q){g.log("_uiSetMask");if(q){this.on("show",this._maskExtShow);this.on("hide",this._maskExtHide)}else{this.detach("show",this._maskExtShow);this.detach("hide",this._maskExtHide)}},_maskExtShow:function(){if(!s){s=
(new g.Node("<div class='ks-ext-mask'>")).prependTo(document.body);s.css({position:"absolute",left:0,top:0,width:o.ie6?g.DOM.docWidth():"100%",height:g.DOM.docHeight()});o.ie==6&&s.append("<iframe style='width:100%;height:expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'>")}s.css({"z-index":this.get("zIndex")-1});m++;s.show()},_maskExtHide:function(){m--;if(m<=0)m=0;m||s&&s.hide()},__destructor:function(){g.log("mask __destructor")}};g.UIBase.Mask=p});
KISSY.add("uibase-position",function(g){function p(){g.log("position init")}g.namespace("UIBase");var s=document,o=g.Event;p.ATTRS={x:{},y:{},xy:{setter:function(m){var q=g.makeArray(m);if(q.length){q[0]&&this.set("x",q[0]);q[1]&&this.set("y",q[1])}return m}},zIndex:{value:9999},visible:{value:undefined}};p.prototype={__syncUI:function(){g.log("_syncUIPosition")},__renderUI:function(){g.log("_renderUIPosition");var m=this.get("el");m.addClass("ks-ext-position");m.css("display","")},__bindUI:function(){g.log("_bindUIPosition")},
_uiSetZIndex:function(m){g.log("_uiSetZIndex");m!==undefined&&this.get("el").css("z-index",m)},_uiSetX:function(m){g.log("_uiSetX");m!==undefined&&this.get("el").offset({left:m})},_uiSetY:function(m){g.log("_uiSetY");m!==undefined&&this.get("el").offset({top:m})},_uiSetVisible:function(m){if(m!==undefined){g.log("_uiSetVisible");this.get("el").css("visibility",m?"visible":"hidden");this[m?"_bindKey":"_unbindKey"]();this.fire(m?"show":"hide")}},_bindKey:function(){o.on(s,"keydown",this._esc,this)},
_unbindKey:function(){o.remove(s,"keydown",this._esc,this)},_esc:function(m){m.keyCode===27&&this.hide()},move:function(m,q){if(g.isArray(m)){q=m[1];m=m[0]}this.set("xy",[m,q])},show:function(){this._firstShow()},_firstShow:function(){this.render();this._realShow();this._firstShow=this._realShow},_realShow:function(){this.set("visible",true)},hide:function(){this.set("visible",false)},__destructor:function(){g.log("position __destructor")}};g.UIBase.Position=p});
KISSY.add("uibase-shim",function(g){function p(){g.log("shim init")}g.namespace("UIBase");var s=g.Node;p.prototype={__syncUI:function(){g.log("_syncUIShimExt")},__bindUI:function(){g.log("_bindUIShimExt")},__renderUI:function(){g.log("_renderUIShimExt");var o=this.get("el"),m=new s("<iframe style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth);top: 0;opacity: 0;filter: alpha(opacity=0);left: 0;z-index: -1;height: expression(this.parentNode.offsetHeight);'>");o.prepend(m)},
__destructor:function(){g.log("shim __destructor")}};g.UIBase.Shim=p});
KISSY.add("uibase-stdmod",function(g){function p(){g.log("stdmod init")}g.namespace("UIBase");var s=g.Node;p.ATTRS={header:{},body:{},footer:{},bodyStyle:{},headerContent:{value:false},bodyContent:{value:false},footerContent:{value:false}};p.HTML_PARSER={header:".ks-stdmod-header",body:".ks-stdmod-body",footer:".ks-stdmod-footer"};p.prototype={__bindUI:function(){g.log("_bindUIStdMod")},__syncUI:function(){g.log("_syncUIStdMod")},_setStdModContent:function(o,m){if(m!==false)if(g.isString(m))this.get(o).html(m);
else{this.get(o).html("");this.get(o).append(m)}},_uiSetBodyStyle:function(o){o!==undefined&&this.get("body").css(o)},_uiSetBodyContent:function(o){g.log("_uiSetBodyContent");this._setStdModContent("body",o)},_uiSetHeaderContent:function(o){g.log("_uiSetHeaderContent");this._setStdModContent("header",o)},_uiSetFooterContent:function(o){g.log("_uiSetFooterContent");this._setStdModContent("footer",o)},__renderUI:function(){g.log("_renderUIStdMod");var o=this.get("contentEl"),m=this.get("header"),q=
this.get("body"),n=this.get("footer");this.get("headerContent");this.get("bodyContent");this.get("footerContent");if(!m){m=(new s("<div class='ks-stdmod-header'>")).appendTo(o);this.set("header",m)}if(!q){q=(new s("<div class='ks-stdmod-body'>")).appendTo(o);this.set("body",q)}if(!n){n=(new s("<div class='ks-stdmod-footer'>")).appendTo(o);this.set("footer",n)}},__destructor:function(){g.log("stdmod __destructor")}};g.UIBase.StdMod=p});KISSY.Editor.add("uibase",function(){});
KISSY.Editor.add("undo",function(g){var p=KISSY,s=p.Editor,o=s.Utils.arrayCompare,m=p.UA,q=p.Event;s.UndoManager||function(){function n(d){var f=d._getRawData(),i;if(f)i=d.getSelection();this.contents=f;this.bookmarks=i&&i.createBookmarks2(true)}function j(d){this.history=[];this.index=-1;this.editor=d;this.bufferRunner=s.Utils.buffer(this.save,this,500);this._init()}p.augment(n,{equals:function(d){if(this.contents!=d.contents)return false;var f=this.bookmarks;d=d.bookmarks;if(f||d){if(!f||!d||f.length!=
d.length)return false;for(var i=0;i<f.length;i++){var w=f[i],l=d[i];if(w.startOffset!=l.startOffset||w.endOffset!=l.endOffset||!o(w.start,l.start)||!o(w.end,l.end))return false}}return true}});var k={16:1,17:1,18:1},c={37:1,38:1,39:1,40:1,33:1,34:1};p.augment(j,{_keyMonitor:function(){var d=this.editor;q.on([d.document,d.textarea],"keydown",function(f){var i=f.keyCode;if(!(i in c||i in k))if(i===90&&(f.ctrlKey||f.metaKey)){d.fire("restore",{d:-1});f.halt()}else if(i===89&&(f.ctrlKey||f.metaKey)){d.fire("restore",
{d:1});f.halt()}else d.fire("save",{buffer:1})})},_init:function(){var d=this,f=d.editor;f.on("save",function(i){if(f.getMode()==s.WYSIWYG_MODE)i.buffer?d.bufferRunner():d.save()});f.on("restore",function(i){f.getMode()==s.WYSIWYG_MODE&&d.restore(i)});d._keyMonitor()},save:function(){var d=this.history,f=this.index;d.length>f+1&&d.splice(f+1,d.length-f-1);var i=this.editor;f=d[d.length-1];var w=new n(i);if(!f||!f.equals(w)){d.length===30&&d.shift();d.push(w);this.index=f=d.length-1;i.fire("afterSave",
{history:d,index:f})}},restore:function(d){d=d.d;var f=this.history,i=this.editor,w=f[this.index+d];if(w){i._setRawData(w.contents);if(w.bookmarks)i.getSelection().selectBookmarks(w.bookmarks);else if(m.ie){w=i.document.body.createTextRange();w.collapse(true);w.select()}(w=i.getSelection())&&w.scrollIntoView();this.index+=d;i.fire("afterRestore",{history:f,index:this.index});i.notifySelectionChange()}}});s.UndoManager=j}();g.ready(function(){new s.UndoManager(g);var n={redo:1,undo:-1},j={mode:s.WYSIWYG_MODE,
init:function(){this.editor.on("afterSave afterRestore",this.cfg._respond,this);this.btn.disable()},offClick:function(){this.editor.fire("restore",{d:n[this.cfg.flag]})}},k=p.mix({title:"\u64a4\u9500",flag:"undo",contentCls:"ke-toolbar-undo",_respond:function(c){var d=this.btn;c.index>0?d.boff():d.disable()}},j,false);j=p.mix({title:"\u91cd\u505a",flag:"redo",contentCls:"ke-toolbar-redo",_respond:function(c){var d=this.btn;c.index<c.history.length-1?d.boff():d.disable()}},j,false);g.addButton("undo",k);g.addButton("undo",
j)})});
