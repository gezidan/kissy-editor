KISSY.add("editor",function(x,r){function w(i,p){function b(v){for(var s=w.Env.mods,c=0;c<v.length;c++){for(var n=v[c],q=false,u=0;u<c;u++)if(n==v[u]){q=true;break}u=s[n];if(q&&u){q=x.clone(u);n=n+"_"+c;q.name=n;v[c]=n;s[n]||(s[n]=q)}}}var a=this;if(!(a instanceof w))return new w(i,p);if(x.isString(i))i=x.one(i);i=z._4e_wrap(i);p=p||{};p.pluginConfig=p.pluginConfig||{};a.cfg=p;x.app(a,x.EventTarget);var d=["htmldataprocessor","enterkey","clipboard"],j=false;a.use=function(v,s){v=v.split(",");b(v);
for(var c=0;c<d.length;c++){var n=d[c];x.inArray(n,v)||v.unshift(n)}x.use.call(a,v.join(","),function(){a.ready(function(){s&&s.call(a);if(!j){a.setData(i.val());if(p.focus)a.focus();else{var q=a.getSelection();q&&q.removeAllRanges()}a.fire("save");j=true}})},{order:true,global:w});return a};a.init(i)}function y(i){if(!B)return i.replace(/\.(js|css)/i,"-min.$1");if(B==="dev")return"../src/"+i;return i}var z=x.DOM;x.app(w,x.EventTarget);w.Config.base=x.Config.base+"editor/";var B=x.Config.debug,o=
{htmlparser:{attach:false,path:y("plugins/htmldataprocessor/htmlparser/htmlparser.js?t=2010-10-25 21:02:33")}},l=["utils","focusmanager","definition","dtd","dom","elementpath","walker","range","domiterator","selection","styles"],m=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},
{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},{name:"flash",requires:["flash/support"]},{name:"flash/dialog",requires:["flash"]},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","overlay","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor",requires:["htmlparser-text"]},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["overlay","tabs"]},"indent","justify",{name:"link",
requires:["bubbleview"]},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["overlay","contextmenu"]},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],h=[{name:"htmlparser-basicwriter",requires:["htmlparser"]},{name:"htmlparser-element",requires:["htmlparser-fragment"]},{name:"htmlparser-filter",
requires:["htmlparser-element"]},{name:"htmlparser-fragment",requires:["htmlparser-htmlwriter"]},{name:"htmlparser-htmlwriter",requires:["htmlparser-basicwriter"]},{name:"htmlparser-text",requires:["htmlparser-comment"]},{name:"htmlparser-comment",requires:["htmlparser-filter"]}],g,f,k,e;g=0;for(f=m.length;g<f;g++){k=m[g];if(x.isString(k))k=m[g]={name:k};k.requires=k.requires||[];k.requires=k.requires.concat(["button"])}m=[{name:"localStorage",requires:["flashutils","flashbridge"]},{name:"button"},
{name:"dd"},{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(m);g=0;for(f=m.length;g<f;g++){k=m[g];e=k.name;o[e]={attach:false,charset:"utf-8",requires:k.requires,csspath:k.useCss?y("plugins/"+e+"/plugin.css?t=2010-10-25 21:02:33"):r,path:y("plugins/"+e+"/plugin.js?t=2010-10-25 21:02:33")}}g=0;for(f=h.length;g<f;g++){k=h[g];m=r;if(!x.isString(k)){m=k.requires;k=k.name}o[k]={attach:false,
charset:"utf-8",requires:m,path:y("plugins/htmldataprocessor/htmlparser/"+k.substring(11)+".js?t=2010-10-25 21:02:33")}}g=0;for(f=l.length;g<f;g++){k=l[g];o[k]={host:"editor",requires:g>0?l[g-1]:[]}}w.add(o);x.Editor=w});
KISSY.Editor.add("utils",function(x){var r=KISSY,w=r.Node,y=r.DOM,z=r.UA,B=r.Event;x.Utils={debugUrl:function(o){var l=r.Config.debug;if(!l)return o.replace(/\.(js|css)/i,"-min.$1");if(l==="dev")return"../src/"+o;return o},lazyRun:function(o,l,m){var h=o[l],g=o[m];o[l]=function(){h.apply(this,arguments);o[l]=o[m];return g.apply(this,arguments)}},getXY:function(o,l,m,h){m=m.defaultView||m.parentWindow;o-=y.scrollLeft(m);l-=y.scrollTop(m);if(h)if(m!=(h.defaultView||h.parentWindow)&&m.frameElement){h=
y._4e_getOffset(m.frameElement,h);o+=h.left;l+=h.top}return{left:o,top:l}},tryThese:function(){for(var o,l=0,m=arguments.length;l<m;l++){var h=arguments[l];try{o=h();break}catch(g){}}return o},arrayCompare:function(o,l){if(!o&&!l)return true;if(!o||!l||o.length!=l.length)return false;for(var m=0;m<o.length;m++)if(o[m]!==l[m])return false;return true},getByAddress:function(o,l,m){o=o.documentElement;for(var h=0;o&&h<l.length;h++){var g=l[h];if(m)for(var f=-1,k=0;k<o.childNodes.length;k++){var e=o.childNodes[k];
if(!(m===true&&e.nodeType==3&&e.previousSibling&&e.previousSibling.nodeType==3)){f++;if(f==g){o=e;break}}}else o=o.childNodes[g]}return o?new w(o):null},clearAllMarkers:function(o){for(var l in o)o[l]._4e_clearMarkers(o,true)},htmlEncodeAttr:function(o){return o.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(o){return o.replace(/^\s+/,"")},rtrim:function(o){return o.replace(/\s+$/,"")},trim:function(o){return this.ltrim(this.rtrim(o))},mix:function(){for(var o={},
l=0;l<arguments.length;l++)o=r.mix(o,arguments[l]);return o},isCustomDomain:function(){if(!z.ie)return false;var o=document.domain,l=window.location.hostname;return o!=l&&o!="["+l+"]"},duplicateStr:function(o,l){return Array(l+1).join(o)},throttle:function(o,l,m){m=m||150;if(m===-1)return function(){o.apply(l,arguments)};var h=(new Date).getTime();return function(){var g=(new Date).getTime();if(g-h>m){h=g;o.apply(l,arguments)}}},buffer:function(o,l,m){m=m||0;var h=null;return function(){h&&clearTimeout(h);
var g=arguments;h=setTimeout(function(){return o.apply(l,g)},m)}},isNumber:function(o){return/^\d+(.\d+)?$/.test(r.trim(o))},verifyInputs:function(o){for(var l=0;l<o.length;l++){var m=y._4e_wrap(o[l]),h=r.trim(m.val()),g=m.attr("data-verify");m=m.attr("data-warning");if(g&&!RegExp(g).test(h)){alert(m);return}}return true},sourceDisable:function(o,l){o.on("sourcemode",l.disable,l);o.on("wysiwygmode",l.enable,l)},resetInput:function(o){var l=o.attr("placeholder");if(l&&!z.webkit){o.val(l);o.addClass("ke-input-tip")}else z.webkit&&
o.val("")},placeholder:function(o,l){o.attr("placeholder",l);if(!z.webkit){o.on("blur",function(){if(!r.trim(o.val())){o.val(l);o.addClass("ke-input-tip")}});o.on("focus",function(){r.trim(o.val())==l&&o.val("");o.removeClass("ke-input-tip")})}},clean:function(o){o=o[0]||o;for(var l=r.makeArray(o.childNodes),m=0;m<l.length;m++){var h=l[m];h.nodeType==x.NODE.NODE_TEXT&&!r.trim(h.nodeValue)&&o.removeChild(h)}},htmlEncode:function(o){return!o?o:String(o).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,
"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(o){return!o?o:String(o).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(o,l){return o.toLowerCase()==l.toLowerCase()},normParams:function(o){o=r.clone(o);for(var l in o)if(o.hasOwnProperty(l)){var m=o[l];if(r.isFunction(m))o[l]=m()}return o},doFormUpload:function(o,l,m){function h(){var b={responseText:"",responseXML:null};b.argument=o?o.argument:null;try{var a;if((a=z.ie?f.contentWindow.document:
f.contentDocument||window.frames[g].document)&&a.body)b.responseText=a.body.innerHTML;b.responseXML=a&&a.XMLDocument?a.XMLDocument:a}catch(d){}B.remove(f,"load",h);o.callback&&o.callback(b);setTimeout(function(){y._4e_remove(f)},100)}var g=r.guid("form-upload-"),f=document.createElement("iframe");f.id=g;f.name=g;f.className="ke-hidden";if(z.ie)f.src="javascript:false";document.body.appendChild(f);if(z.ie)document.frames[g].name=g;var k=y._4e_unwrap(o.form),e={target:k.target,method:k.method,encoding:k.encoding,
enctype:k.enctype,action:k.action};k.target=g;k.method="POST";k.enctype=k.encoding="multipart/form-data";if(m)k.action=m;var i;if(l){i=[];l=x.Utils.normParams(l);for(var p in l)if(l.hasOwnProperty(p)){m=document.createElement("input");m.type="hidden";m.name=p;m.value=l[p];k.appendChild(m);i.push(m)}}B.on(f,"load",h);k.submit();k.target=e.target;k.method=e.method;k.enctype=e.enctype;k.encoding=e.encoding;k.action=e.action;if(i){l=0;for(k=i.length;l<k;l++)y._4e_remove(i[l])}}}});
KISSY.Editor.add("focusmanager",function(x){function r(){this.iframeFocus=true;l=this}function w(){this.iframeFocus=false;l=null}var y=KISSY,z=y.DOM,B=y.Event;y={};var o={},l;y={refreshAll:function(){for(var m in o){var h=o[m];h.document.designMode="off";h.document.designMode="on"}},currentInstance:function(){return l},getInstance:function(m){return o[m]},add:function(m){var h=z._4e_getWin(m.document);B.on(h,"focus",r,m);B.on(h,"blur",w,m)},register:function(m){o[m._UUID]=m},remove:function(m){delete o[m._UUID];
var h=z._4e_getWin(m.document);B.remove(h,"focus",r,m);B.remove(h,"blur",w,m)}};x.focusManager=y;x.getInstances=function(){return o}});
KISSY.Editor.add("definition",function(x){function r(i,p){return h+"<html><head><title>${title}</title><link href='"+x.Config.base+g+"' rel='stylesheet'/><style>"+(p||"")+"</style></head><body class='ke-editor'>&nbsp;"+(i?'<script id="ke_actscript" type="text/javascript">'+(x.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+i+'");<\/script>':"")+"</body></html>"}var w=KISSY,y=w.UA,z=w.DOM,B=w.Node,o=w.Event,l=x.focusManager,m=x.Utils.tryThese,
h="<!doctype html>",g=x.Utils.debugUrl("theme/editor-iframe.css"),f=1,k="document.open();"+(x.Utils.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();",e="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(y.ie?"javascript:void(function(){"+encodeURIComponent(k)+
"}())":"")+'"  tabIndex="'+(y.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";x.SOURCE_MODE=0;x.WYSIWYG_MODE=1;w.augment(x,{init:function(i){if(y.ie)z.addClass(document.body,"ie"+y.ie);else if(y.gecko)z.addClass(document.body,"gecko");else y.webkit&&z.addClass(document.body,"webkit");var p=this,b=new B(e.replace(/\$\(tabIndex\)/,i.attr("tabIndex")));b.on("mousedown",function(j){if(y.webkit){var v=z._4e_name(j.target);
if(v=="select"||v=="option")return true}j.halt()});i.on("mousedown",function(j){j.stopPropagation()});p.editorWrap=b;p._UUID=f++;l.register(p);p.wrap=b.one(".ke-textarea-wrap");p.iframe=p.wrap.one("iframe");p.toolBarDiv=b.one(".ke-editor-tools");p.textarea=i;p.statusDiv=b.one(".ke-editor-status");p.toolBarDiv._4e_unselectable();p._commands={};p._dialogs={};var a=i._4e_style("width"),d=i._4e_style("height");if(a){b.css("width",a);i.css("width","100%")}p.textarea.css("display","none");b.insertAfter(i);
p.wrap[0].appendChild(i[0]);if(d){p.wrap.css("height",d);i.css("height","100%")}b=p.iframe;p.on("dataReady",function(){p._ready=true;x.fire("instanceCreated",{editor:p})});y.gecko?b.on("load",p._setUpIFrame,p):p._setUpIFrame();p.cfg.attachForm&&i[0].form&&p._attachForm()},_attachForm:function(){(new B(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(i,p,b){var a=this,d=x.SimpleOverlay;b=b||{};b.mask?d.mask():d.loading();a.use(i,function(){!b.mask&&d.unloading();var j=a.getDialog(i);
p(j)})},addDialog:function(i,p){this._dialogs[i]=p},getDialog:function(i){return this._dialogs[i]},addPlugin:function(i){this.ready(i)},addCommand:function(i,p){this._commands[i]=p},hasCommand:function(i){return this._commands[i]},execCommand:function(i){var p=this._commands[i],b=w.makeArray(arguments);b.shift();b.unshift(this);return p.exec.apply(p,b)},getMode:function(){return this.textarea.css("display")=="none"?x.WYSIWYG_MODE:x.SOURCE_MODE},getData:function(i){var p;if(this.getMode()==x.WYSIWYG_MODE){p=
this.document.body.innerHTML;if(this.htmlDataProcessor)p=this.htmlDataProcessor.toHtml(p,"p")}else p=this.textarea.val();if(!i){p=p||"";p=p.replace(/\s+/g," ")}return p},setData:function(i){var p;if(this.htmlDataProcessor)p=this.htmlDataProcessor.toDataFormat(i,"p");this.document.body.innerHTML=p;this.getMode()!=x.WYSIWYG_MODE&&this.textarea.val(i)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(i){i=i||0;return i+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(i){this.document.body.innerHTML=i},_prepareIFrameHtml:r,getSelection:function(){var i=new x.Selection(this.document);return!i||i.isInvalid?null:i},focus:function(){var i=this.doc,p=z._4e_getWin(i);y.webkit&&p&&p.parent&&p.parent.focus();p&&p.focus();i&&i.body.focus();this.notifySelectionChange()},blur:function(){z._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(i){var p=this.cfg,b=this.document;p.customStyle=p.customStyle||"";
p.customStyle+="\n"+i;p=b.createElement("style");b.getElementsByTagName("head")[0].appendChild(p);if(p.styleSheet)p.styleSheet.cssText=i;else p.appendChild(b.createTextNode(i))},_setUpIFrame:function(){function i(){j=d.document;p.document=j;b.detach();j.open("text/html","replace");j.write(a);j.close()}var p=this,b=p.iframe,a=r(p._UUID,p.cfg.customStyle),d=b[0].contentWindow,j;try{j=d.document}catch(v){b[0].src=b[0].src;if(y.ie<7){setTimeout(i,10);return}}i()},ready:function(i){this._ready?i():this.on("dataReady",
i)},_monitor:function(){var i=this;i._monitorId&&clearTimeout(i._monitorId);i._monitorId=setTimeout(function(){var p=i.getSelection();if(p&&!p.isInvalid){var b=p.getStartElement(),a=new x.ElementPath(b);if(!i.previousPath||!i.previousPath.compare(a)){i.previousPath=a;i.fire("selectionChange",{selection:p,path:a,element:b})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(i,p){var b=this;b.focus();var a=i._4e_name(),d=x.XHTML_DTD,j=x.RANGE,v=
x.NODE,s=d.$block[a],c=b.getSelection(),n=c.getRanges(),q,u,A,t,C;b.fire("save");for(var E=n.length-1;E>=0;E--){q=n[E];q.deleteContents();u=!E&&i||i._4e_clone(true);p&&p(u);if(s)for(;(t=q.getCommonAncestor(false,true))&&(C=d[t._4e_name()])&&!(C&&C[a]);)if(t._4e_name()in d.span)q.splitElement(t);else if(q.checkStartOfBlock()&&q.checkEndOfBlock()){q.setStartBefore(t);q.collapse(true);t._4e_remove()}else q.splitBlock();q.insertNode(u);A||(A=u)}a=A._4e_nextSourceNode(true);d=b.document;C=x.XHTML_DTD;
if(C.$inline[u._4e_name()]){a=new B(d.createTextNode(" "));a.insertAfter(A)}else if(a){if(a._4e_name()=="br"&&C[a.parent()._4e_name()].p){C=new B("<p>&nbsp;</p>",null,d);a[0].parentNode.replaceChild(C[0],a[0]);a=C}}else{C=new B("<p>&nbsp;</p>",null,d);C.insertAfter(A);a=C}q.moveToPosition(A,j.POSITION_AFTER_END);a&&a[0].nodeType==v.NODE_ELEMENT&&q.moveToElementEditablePosition(a);c.selectRanges([q]);b.focus();u&&u._4e_scrollIntoView();setTimeout(function(){b.fire("save")},10);return u},insertHtml:function(i){var p=
this;if(p.htmlDataProcessor)i=p.htmlDataProcessor.toDataFormat(i);if(y.webkit){i=z.create(i,null,this.document);i=i.nodeType==11?w.makeArray(i.childNodes):[i];for(var b=0;b<i.length;b++)p.insertElement(new B(i[b]))}else{p.focus();p.fire("save");b=p.getSelection();if(y.ie){b=b.getNative();b.type=="Control"&&b.clear();b.createRange().pasteHTML(i)}else p.document.execCommand("inserthtml",false,i);p.focus();setTimeout(function(){p.fire("save")},10)}}});x._initIFrame=function(i){function p(u){m(function(){d.designMode=
"on";setTimeout(function(){d.designMode="off";s.focus();if(!arguments.callee.retry)arguments.callee.retry=true},50)},function(){d.designMode="off";z.attr(s,"contentEditable",false);z.attr(s,"contentEditable",true);!u&&p(1)})}var b=l.getInstance(i);i=b.textarea[0];var a=b.iframe[0].contentWindow,d=b.document,j=b.cfg,v=d.getElementById("ke_actscript");z._4e_remove(v);var s=d.body;if(y.ie){s.hideFocus=true;s.disabled=true;s.contentEditable=true;s.removeAttribute("disabled")}else setTimeout(function(){if(y.gecko||
y.opera)s.contentEditable=true;else if(y.webkit)s.parentNode.contentEditable=true;else d.designMode="on"},0);if(y.webkit){o.on(d,"click",function(u){var A=new B(u.target);w.inArray(A._4e_name(),["input","select"])&&u.preventDefault()});o.on(d,"mouseup",function(u){var A=new B(u.target);w.inArray(A._4e_name(),["input","textarea"])&&u.preventDefault()})}if(y.gecko||y.ie||y.opera){var c;c=new B(z.insertAfter((new B('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
i));c.on("focus",function(){b.focus()});b.activateGecko=function(){y.gecko&&b.iframeFocus&&c[0].focus()};b.on("destroy",function(){})}if(y.ie&&d.compatMode=="CSS1Compat"||y.gecko||y.opera){var n=new B(d.documentElement);n.on("mousedown",function(u){if(u.target==n[0]){y.gecko&&p(false);c[0].focus()}})}o.on(a,"focus",function(){if(y.gecko)p(false);else y.opera&&s.focus();b.notifySelectionChange()});y.gecko&&o.on(b.document,"mousedown",function(){b.iframeFocus||p(false)});if(y.ie){o.on(d,"keydown",function(u){if(u.keyCode in
{8:1,46:1}){var A=b.getSelection(),t=A.getSelectedElement();if(t){b.fire("save");var C=A.getRanges()[0].createBookmark();t._4e_remove();A.selectBookmarks([C]);b.fire("save");u.preventDefault()}}});if(d.compatMode=="CSS1Compat"){var q={33:1,34:1};o.on(d,"keydown",function(u){u.keyCode in q&&setTimeout(function(){b.getSelection().scrollIntoView()},0)})}}setTimeout(function(){y.ie&&setTimeout(function(){if(d){s.runtimeStyle.marginBottom="0px";s.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){b.fire("dataReady");
var u=j.disableObjectResizing,A=j.disableInlineTableEditing;if(u||A)try{d.execCommand("enableObjectResizing",false,!u);d.execCommand("enableInlineTableEditing",false,!A)}catch(t){o.on(s,y.ie?"resizestart":"resize",function(C){if(u||z._4e_name(C.target)==="table"&&A)C.preventDefault()})}},10);y.webkit&&o.on(d,"mousedown",function(u){u=new B(u.target);w.inArray(u._4e_name(),["img","hr","input","textarea","select"])&&b.getSelection().selectElement(u)});y.gecko&&o.on(d,"dragstart",function(u){var A=new B(u.target);
A._4e_name()==="img"&&/ke_/.test(A[0].className)&&u.preventDefault()});l.add(b)};x.baseZIndex=function(i){var p=i,b=x.getInstances(),a;for(a in b){if(!b.hasOwnProperty(a))return;p=Math.max(p,b[a].baseZIndex(i))}return p}});
KISSY.Editor.add("dtd",function(x){x.XHTML_DTD=function(){var r=function(s){for(var c=arguments.length-1;c>0;)KISSY.mix(s,arguments[c--]);return s},w={isindex:1,fieldset:1},y={input:1,button:1,select:1,textarea:1,label:1},z=r({a:1},y),B=r({iframe:1},z),o={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},l={ins:1,del:1,script:1,style:1},m=r({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},l),h=r({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},m),g=r({p:1},h);y=r({iframe:1},h,y);h={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var f=r({a:1},y),k={tr:1},e={"#":1},i=r({param:1},h),p=r({form:1},w,B,o,g),b={li:1},a={base:1,link:1,meta:1,title:1},d=r(a,{style:1,script:1}),j={head:1,body:1},v={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:r({html:1},j,a),$block:v,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:f,$body:r({script:1,style:1},v),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:j,head:d,style:e,body:p,base:{},link:{},meta:{},title:e,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:p,td:p,br:{},th:p,center:p,kbd:f,button:r(g,o),basefont:{},h5:f,h4:f,samp:f,h6:f,ol:b,h1:f,h3:f,option:e,h2:f,form:r(w,B,o,g),select:{optgroup:1,option:1},font:f,ins:f,menu:b,abbr:f,label:f,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:f,script:e,tfoot:k,cite:f,li:p,input:{},iframe:p,strong:f,textarea:e,noframes:p,big:f,small:f,span:f,hr:{},dt:f,sub:f,optgroup:{option:1},param:{},bdo:f,"var":f,div:p,object:i,sup:f,dd:p,strike:f,area:{},dir:b,map:r({area:1,form:1,p:1},w,l,o),applet:i,dl:{dt:1,dd:1},del:f,isindex:{},fieldset:r({legend:1},h),thead:k,ul:b,acronym:f,b:f,a:y,blockquote:p,caption:f,i:f,u:f,tbody:k,s:f,address:r(B,g),tt:f,legend:f,q:f,pre:r(m,z),p:f,em:f,dfn:f}}()});
KISSY.Editor.add("dom",function(x){function r(b){return b.replace(/-(\w)/g,function(a,d){return d.toUpperCase()})}var w=KISSY,y=w.DOM,z=w.UA,B=w.Node,o=x.Utils,l={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};x.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};x.POSITION={};var m=x.NODE,h=x.POSITION;h.POSITION_IDENTICAL=0;h.POSITION_DISCONNECTED=
1;h.POSITION_FOLLOWING=2;h.POSITION_PRECEDING=4;h.POSITION_IS_CONTAINED=8;h.POSITION_CONTAINS=16;var g={},f={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},k={hr:1},e=function(b){return b[0]||b},i=function(b){if(b&&!b[0])return new B(b);return b},p={_4e_wrap:i,_4e_unwrap:e,_4e_equals:function(b,a){if(!b&&!a)return true;if(!b||!a)return false;b=e(b);a=e(a);return b===
a},_4e_isBlockBoundary:function(b,a){b=i(b);var d=w.mix(w.mix({},k),a||{});return f[b.css("display")]||d[b._4e_name()]},_4e_getWin:function(b){return b&&"scrollTo"in b&&b.document?b:b&&b.nodeType===9?b.defaultView||b.parentWindow:false},_4e_index:function(b){b=e(b);for(var a=b.parentNode.childNodes,d=0;d<a.length;d++)if(a[d]===b)return d;return-1},_4e_first:function(b,a){b=e(b);var d=b.firstChild;if((d=d&&new B(d))&&a&&!a(d))d=d._4e_next(a);return d},_4e_move:function(b,a,d){b._4e_remove();b=e(b);
a=e(a);d?a.insertBefore(b,a.firstChild):a.appendChild(b)},_4e_name:function(b){b=e(b);var a=b.nodeName.toLowerCase();if(z.ie)if((b=b.scopeName)&&b!="HTML")a=b.toLowerCase()+":"+a;return a},_4e_isIdentical:function(b,a){if(b._4e_name()!=a._4e_name())return false;var d=b[0].attributes,j=a[0].attributes,v=d.length,s=j.length;if(!z.ie&&v!=s)return false;for(var c=0;c<v;c++){var n=d[c];if((!z.ie||n.specified&&n.nodeName!="_ke_expando")&&n.nodeValue!=a.attr(n.nodeName))return false}if(z.ie)for(c=0;c<s;c++){n=
j[c];if(n.specified&&n.nodeName!="_ke_expando"&&n.nodeValue!=b.attr(n.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(b){b=e(b).childNodes;for(var a=0,d=b.length;a<d;a++){var j=b[a],v=j.nodeType;if(!(v==m.NODE_ELEMENT&&j.getAttribute("_ke_bookmark")))if(v==m.NODE_ELEMENT&&!p._4e_isEmptyInlineRemoveable(j)||v==m.NODE_TEXT&&w.trim(j.nodeValue))return false}return true},_4e_moveChildren:function(b,a,d){b=e(b);a=a[0]||a;if(b!=a)if(d)for(;d=b.lastChild;)a.insertBefore(b.removeChild(d),
a.firstChild);else for(;d=b.firstChild;)a.appendChild(b.removeChild(d))},_4e_mergeSiblings:function(){function b(a,d,j){if(d[0]&&d[0].nodeType==m.NODE_ELEMENT){for(var v=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemoveable();){v.push(d);d=j?new B(d[0].nextSibling):new B(d[0].previousSibling);if(!d[0]||d[0].nodeType!=m.NODE_ELEMENT)return}if(a._4e_isIdentical(d)){for(var s=j?a[0].lastChild:a[0].firstChild;v.length;)v.shift()._4e_move(a,!j);d._4e_moveChildren(a,!j);d._4e_remove();s[0]&&s[0].nodeType==
m.NODE_ELEMENT&&s._4e_mergeSiblings()}}}return function(a){if(a[0])if(l[a._4e_name()]||a._4e_name()=="a"){b(a,new B(a[0].nextSibling),true);b(a,new B(a[0].previousSibling))}}}(),_4e_unselectable:z.gecko?function(b){b=e(b);b.style.MozUserSelect="none"}:z.webkit?function(b){b=e(b);b.style.KhtmlUserSelect="none"}:function(b){b=e(b);if(z.ie||z.opera){var a,d=0;for(b.unselectable="on";a=b.all[d++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.unselectable=
"on"}}},_4e_getOffset:function(b,a){b=e(b);var d,j=0;d=0;var v=b.ownerDocument.defaultView||b.ownerDocument.parentWindow,s=b.ownerDocument,c=s.documentElement;a=a||s;if(b.getBoundingClientRect){if(b!==s.body&&c!==b){d=b.getBoundingClientRect();j=d.left+(a===s?y.scrollLeft(v):0);d=d.top+(a===s?y.scrollTop(v):0)}if(a)if(v!=(a.defaultView||a.parentWindow)&&v.frameElement){v=p._4e_getOffset(v.frameElement,a);j+=v.left;d+=v.top}}return{left:j,top:d}},_4e_getFrameDocument:function(b){return(b=e(b))&&b.contentWindow.document},
_4e_splitText:function(b,a){b=e(b);var d=b.ownerDocument;if(!(!b||b.nodeType!=m.NODE_TEXT)){if(z.ie&&a==b.nodeValue.length){var j=d.createTextNode("");y.insertAfter(j,b);return new B(j)}j=new B(b.splitText(a));if(z.ie==8){d=d.createTextNode("");y.insertAfter(d,j[0]);d.parentNode.removeChild(d)}return j}},_4e_parents:function(b,a){b=i(b);var d=[];do d[a?"push":"unshift"](b);while(b=b.parent());return d},_4e_clone:function(b,a,d){b=e(b);b=b.cloneNode(a);if(!d){var j=function(v){if(v.nodeType==m.NODE_ELEMENT){v.removeAttribute("id",
false);v.removeAttribute("_ke_expando",false);v=v.childNodes;for(var s=0;s<v.length;s++)j(v[s])}};j(b)}return new B(b)},_4e_nextSourceNode:function(b,a,d,j){b=e(b);if(j&&!j.call){var v=j[0]||j;j=function(c){c=c[0]||c;return c!==v}}a=!a&&b.firstChild;var s=new B(b);if(!a){if(b.nodeType==m.NODE_ELEMENT&&j&&j(b,true)===false)return null;a=b.nextSibling}for(;!a&&(s=s.parent());){if(j&&j(s,true)===false)return null;a=s[0].nextSibling}if(!a)return null;a=y._4e_wrap(a);if(j&&j(a)===false)return null;if(d&&
d!=a[0].nodeType)return a._4e_nextSourceNode(false,d,j);return a},_4e_previousSourceNode:function(b,a,d,j){b=e(b);if(j&&!j.call){var v=j[0]||j;j=function(c){c=c[0]||c;return c!==v}}a=!a&&b.lastChild;var s=new B(b);if(!a){if(b.nodeType==m.NODE_ELEMENT&&j&&j(b,true)===false)return null;a=b.previousSibling}for(;!a&&(s=s.parent());){if(j&&j(s,true)===false)return null;a=s[0].previousSibling}if(!a)return null;a=y._4e_wrap(a);if(j&&j(a)===false)return null;if(d&&a[0].nodeType!=d)return a._4e_previousSourceNode(false,
d,j);return a},_4e_contains:z.ie||z.webkit?function(b,a){b=e(b);a=e(a);return a.nodeType!=m.NODE_ELEMENT?b.contains(a.parentNode):b!=a&&b.contains(a)}:function(b,a){b=e(b);a=e(a);return!!(b.compareDocumentPosition(a)&16)},_4e_commonAncestor:function(b,a){if(b._4e_equals(a))return b;if(a[0].nodeType!=m.NODE_TEXT&&a._4e_contains(b))return a;var d=b[0].nodeType==m.NODE_TEXT?b.parent():b;do if(d[0].nodeType!=m.NODE_TEXT&&d._4e_contains(a))return d;while(d=d.parent());return null},_4e_ascendant:function(b,
a,d){b=e(b);if(!d)b=b.parentNode;if(a&&!w.isFunction(a)){var j=a;a=function(v){return v._4e_name()==j}}for(;b&&b.nodeType!=9;){if(!a||a(new B(b))===true)return new B(b);b=b.parentNode}return null},_4e_hasAttribute:function(b,a){b=e(b);var d=b.attributes.getNamedItem(a);return!!(d&&d.specified)},_4e_hasAttributes:z.ie?function(b){b=e(b);for(var a=b.attributes,d=0;d<a.length;d++){var j=a[d];switch(j.nodeName){case "class":if(b.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(j.specified)return true}}return false}:
function(b){b=e(b);z.gecko&&b.removeAttribute("_moz_dirty");b=b.attributes;return b.length>1||b.length==1&&b[0].nodeName!="_ke_expando"},_4e_position:function(b,a){var d=e(b),j=e(a);if(d.compareDocumentPosition)return d.compareDocumentPosition(j);if(d==j)return h.POSITION_IDENTICAL;if(d.nodeType==m.NODE_ELEMENT&&j.nodeType==m.NODE_ELEMENT){if(d.contains){if(d.contains(j))return h.POSITION_CONTAINS+h.POSITION_PRECEDING;if(j.contains(d))return h.POSITION_IS_CONTAINED+h.POSITION_FOLLOWING}if("sourceIndex"in
d)return d.sourceIndex<0||j.sourceIndex<0?h.POSITION_DISCONNECTED:d.sourceIndex<j.sourceIndex?h.POSITION_PRECEDING:h.POSITION_FOLLOWING}d=b._4e_address();j=a._4e_address();for(var v=Math.min(d.length,j.length),s=0;s<=v-1;s++)if(d[s]!=j[s]){if(s<v)return d[s]<j[s]?h.POSITION_PRECEDING:h.POSITION_FOLLOWING;break}return d.length<j.length?h.POSITION_CONTAINS+h.POSITION_PRECEDING:h.POSITION_IS_CONTAINED+h.POSITION_FOLLOWING},_4e_address:function(b,a){b=e(b);for(var d=[],j=b.ownerDocument.documentElement,
v=b;v&&v!=j;){var s=v.parentNode,c=-1;if(s){for(var n=0;n<s.childNodes.length;n++){var q=s.childNodes[n];if(!(a&&q.nodeType==3&&q.previousSibling&&q.previousSibling.nodeType==3)){c++;if(q==v)break}}d.unshift(c)}v=s}return d},_4e_breakParent:function(b,a){var d=new x.Range(b[0].ownerDocument);d.setStartAfter(b);d.setEndAfter(a);var j=d.extractContents();d.insertNode(b._4e_remove());b[0].parentNode.insertBefore(j,b[0].nextSibling)},_4e_style:function(b,a,d){if(d!==undefined)return b.css(a,d);b=b[0]||
b;return b.style[r(a)]},_4e_remove:function(b,a){var d=e(b),j=d.parentNode;if(j){if(a)for(var v;v=d.firstChild;)j.insertBefore(d.removeChild(v),d);j.removeChild(d)}return b},_4e_trim:function(b){y._4e_ltrim(b);y._4e_rtrim(b)},_4e_ltrim:function(b){b=e(b);for(var a;a=b.firstChild;){if(a.nodeType==m.NODE_TEXT){var d=o.ltrim(a.nodeValue),j=a.nodeValue.length;if(d){if(d.length<j){(new B(a))._4e_splitText(j-d.length);b.removeChild(b.firstChild)}}else{b.removeChild(a);continue}}break}},_4e_rtrim:function(b){b=
e(b);for(var a;a=b.lastChild;){if(a.type==m.NODE_TEXT){var d=o.rtrim(a.nodeValue),j=a.nodeValue.length;if(d){if(d.length<j){(new B(a))._4e_splitText(d.length);b.removeChild(b.lastChild)}}else{b.removeChild(a);continue}}break}if(!z.ie&&!z.opera)(a=b.lastChild)&&a.nodeType==1&&a.nodeName.toLowerCase()=="br"&&a.parentNode.removeChild(a)},_4e_appendBogus:function(b){b=e(b);for(var a=b.lastChild;a&&a.nodeType==m.NODE_TEXT&&!w.trim(a.nodeValue);)a=a.previousSibling;if(!a||a.nodeType==m.NODE_TEXT||y._4e_name(a)!==
"br"){a=z.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br");z.gecko&&a.setAttribute("type","_moz");b.appendChild(a)}},_4e_previous:function(b,a){var d=e(b),j;do j=(d=d.previousSibling)&&new B(d);while(j&&a&&!a(j));return j},_4e_last:function(b,a){b=y._4e_wrap(b);var d=b[0].lastChild;if((d=d&&new B(d))&&a&&!a(d))d=d._4e_previous(a);return d},_4e_next:function(b,a){var d=e(b),j;do j=(d=d.nextSibling)&&new B(d);while(j&&a&&!a(j));return j},_4e_outerHtml:function(b){b=e(b);
if(b.outerHTML)return b.outerHTML.replace(/<\?[^>]*>/,"");var a=b.ownerDocument.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML},_4e_setMarker:function(b,a,d,j){b=y._4e_wrap(b);var v=b._4e_getData("list_marker_id")||b._4e_setData("list_marker_id",w.guid())._4e_getData("list_marker_id"),s=b._4e_getData("list_marker_names")||b._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");a[v]=b;s[d]=1;return b._4e_setData(d,j)},_4e_clearMarkers:function(b,a,d){b=i(b);
var j=b._4e_getData("list_marker_names"),v=b._4e_getData("list_marker_id"),s;for(s in j)b._4e_removeData(s);b._4e_removeData("list_marker_names");if(d){b._4e_removeData("list_marker_id");delete a[v]}},_4e_setData:function(b,a,d){var j=y._4e_getUniqueId(b);(g[j]||(g[j]={}))[a]=d;return b},_4e_getData:function(b,a){b=e(b);var d=b.getAttribute("_ke_expando");return(d=d&&g[d])&&d[a]},_4e_removeData:function(b,a){b=e(b);var d=b.getAttribute("_ke_expando");var j=(d=d&&g[d])&&d[a];typeof j!="undefined"&&
d&&delete d[a];w.isEmptyObject(d)&&y._4e_clearData(b);return j||null},_4e_clearData:function(b){b=e(b);var a=b.getAttribute("_ke_expando");a&&delete g[a];a&&b.removeAttribute("_ke_expando")},_4e_getUniqueId:function(b){b=e(b);var a=b.getAttribute("_ke_expando");if(a)return a;a=w.guid();b.setAttribute("_ke_expando",a);return a},_4e_copyAttributes:function(b,a,d){b=e(b);var j=b.attributes;d=d||{};for(var v=0;v<j.length;v++){var s=j[v],c=s.nodeName.toLowerCase(),n;if(!(c in d))if(c=="checked"&&(n=y.attr(b,
c)))a.attr(c,n);else if(s.specified||z.ie&&s.nodeValue&&c=="value"){n=y.attr(b,c);if(n===null)n=s.nodeValue;a.attr(c,n)}}if(b.style.cssText!=="")a[0].style.cssText=b.style.cssText},_4e_isEditable:function(b){b=y._4e_name(b);var a=x.XHTML_DTD;return(b=!a.$nonEditable[b]&&(a[b]||a.span))&&b["#"]},_4e_scrollIntoView:function(b){b=i(b);var a=b[0].ownerDocument,d=y.scrollLeft(a),j=y.scrollTop(a),v=b.offset(),s=v.left;v=v.top;if(y.viewportHeight(a)+j<v||v<j||y.viewportWidth(a)+d<s||s<d)b.scrollIntoView(a)},
_4e_getElementsByTagName:function(b,a,d){b=e(b);if(!z.ie&&d)a=d+":"+a;d=[];b=b.getElementsByTagName(a);for(a=0;a<b.length;a++)d.push(new B(b[a]));return d}};w.DOM._4e_inject=function(b){w.mix(y,b);for(var a in b)b.hasOwnProperty(a)&&function(d){B.prototype[d]=function(){var j=[].slice.call(arguments,0);j.unshift(this);return b[d].apply(null,j)}}(a)};w.DOM._4e_inject(p)});
KISSY.Editor.add("elementpath",function(x){function r(h){var g=null,f=null,k=[];for(h=h;h&&h[0];){if(h[0].nodeType==B.NODE_ELEMENT){if(!this.lastElement)this.lastElement=h;var e=h._4e_name();if(o.ie&&h[0].scopeName!="HTML")e=h[0].scopeName.toLowerCase()+":"+e;if(!f){if(!g&&l[e])g=h;if(m[e]){var i;if(i=!g){if(i=e=="div"){a:{i=h;i=i[0]||i;i=i.childNodes;for(var p=0,b=i.length;p<b;p++){var a=i[p];if(a.nodeType==B.NODE_ELEMENT&&z.$block[a.nodeName.toLowerCase()]){i=true;break a}}i=false}i=!i}i=i}if(i)g=
h;else f=h}}k.push(h);if(e=="body")break}h=h.parent()}this.block=g;this.blockLimit=f;this.elements=k}var w=KISSY,y=w.DOM,z=x.XHTML_DTD,B=x.NODE,o=w.UA,l={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},m={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};r.prototype={compare:function(h){var g=this.elements;h=h&&h.elements;if(!h||g.length!=h.length)return false;for(var f=0;f<g.length;f++)if(!y._4e_equals(g[f],h[f]))return false;return true},contains:function(h){for(var g=
this.elements,f=0;f<g.length;f++)if(g[f]._4e_name()in h)return g[f];return null}};x.ElementPath=r});
KISSY.Editor.add("walker",function(x){function r(m,h){if(this._.end)return null;var g,f=this.range,k,e=this.guard,i=this.type,p=m?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;f.trim();if(f.collapsed){this.end();return null}}if(!m&&!this._.guardLTR){var b=f.endContainer,a=new l(b[0].childNodes[f.endOffset]);this._.guardLTR=function(s,c){return(s=o._4e_wrap(s))&&s[0]&&(!c||!o._4e_equals(b,s))&&(!a[0]||!s._4e_equals(a))&&(s[0].nodeType!=B.NODE_ELEMENT||!c||s._4e_name()!=
"body")}}if(m&&!this._.guardRTL){var d=f.startContainer,j=f.startOffset>0&&new l(d[0].childNodes[f.startOffset-1]);this._.guardRTL=function(s,c){return(s=o._4e_wrap(s))&&s[0]&&(!c||!s._4e_equals(d))&&(!j[0]||!s._4e_equals(j))&&(s[0].nodeType!=B.NODE_ELEMENT||!c||s._4e_name()!="body")}}var v=m?this._.guardRTL:this._.guardLTR;k=e?function(s,c){if(v(s,c)===false)return false;return e(s,c)}:v;if(this.current)g=this.current[p](false,i,k);else if(m){g=f.endContainer;if(f.endOffset>0){g=new l(g[0].childNodes[f.endOffset-
1]);if(k(g)===false)g=null}else g=k(g,true)===false?null:g._4e_previousSourceNode(true,i,k)}else{g=f.startContainer;if((g=new l(g[0].childNodes[f.startOffset]))&&g[0]){if(k(g)===false)g=null}else g=k(f.startContainer,true)===false?null:f.startContainer._4e_nextSourceNode(true,i,k)}for(;g&&g[0]&&!this._.end;){this.current=g;if(!this.evaluator||this.evaluator(g)!==false){if(!h)return g}else if(h&&this.evaluator)return false;g=g[p](false,i,k)}this.end();return this.current=null}function w(m){for(var h,
g=null;h=r.call(this,m);)g=h;return g}function y(m){this.range=m;this._={}}var z=KISSY,B=x.NODE,o=z.DOM,l=z.Node;z.augment(y,{end:function(){this._.end=1},next:function(){return r.call(this)},previous:function(){return r.call(this,true)},checkForward:function(){return r.call(this,false,true)!==false},checkBackward:function(){return r.call(this,true,true)!==false},lastForward:function(){return w.call(this)},lastBackward:function(){return w.call(this,true)},reset:function(){delete this.current;this._=
{}}});y.blockBoundary=function(m){return function(h){h=o._4e_wrap(h);return!(h&&h[0].nodeType==B.NODE_ELEMENT&&h._4e_isBlockBoundary(m))}};y.listItemBoundary=function(){return this.blockBoundary({br:1})};y.bookmark=function(m,h){function g(f){return f&&f[0]&&f._4e_name()=="span"&&f.attr("_ke_bookmark")}return function(f){var k,e;k=f&&f[0]&&f[0].nodeType==B.NODE_TEXT&&(e=f.parent())&&g(e);k=m?k:k||g(f);return h^k}};y.whitespaces=function(m){return function(h){h=(h=h[0]||h)&&h.nodeType==B.NODE_TEXT&&
!z.trim(h.nodeValue);return m^h}};y.invisible=function(m){var h=y.whitespaces();return function(g){g=h(g)||g[0].nodeType==B.NODE_ELEMENT&&!g[0].offsetHeight;return m^g}};x.Walker=y});
KISSY.Editor.add("range",function(x){function r(c){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=true;this.document=c}function w(c){var n=c[0].nodeType!=m.NODE_TEXT&&c._4e_name()in p.$removeEmpty,q=!l.trim(c[0].nodeValue);c=!!c.parent().attr("_ke_bookmark");return n||q||c}function y(c){return!v(c)&&!s(c)}function z(c){var n=false,q=f.bookmark(true);return function(u){if(q(u))return true;if(u[0].nodeType==m.NODE_TEXT){if(l.trim(u[0].nodeValue).length)return false}else if(u[0].nodeType==
m.NODE_ELEMENT)if(!j[u._4e_name()])if(!c&&!i.ie&&u._4e_name()=="br"&&!n)n=true;else return false;return true}}function B(c,n){function q(u){return u&&u.nodeName=="span"&&u.getAttribute("_ke_bookmark")}return function(u){var A,t;A=u&&!u.nodeName&&(t=u.parentNode)&&q(t);A=c?A:A||q(u);return n^A}}function o(c){return function(n){n=(n=n[0]||n)&&n.nodeType==m.NODE_TEXT&&!l.trim(n.nodeValue);return c^n}}x.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var l=KISSY,m=x.NODE,h=x.RANGE,g=x.POSITION,f=x.Walker,k=l.DOM,e=x.Utils.getByAddress,i=l.UA,p=x.XHTML_DTD,b=x.ElementPath,a=l.Node,d={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};r.prototype.toString=function(){var c=[];c.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);c.push((this.endContainer[0].id||this.endContainer[0].nodeName)+
":"+this.endOffset);return c.join("<br/>")};l.augment(r,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&k._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var c=this.startContainer,n=this.startOffset;if(c[0].nodeType!=m.NODE_ELEMENT)if(n)n>=c[0].nodeValue.length&&this.setStartAfter(c);else this.setStartBefore(c);c=this.endContainer;n=this.endOffset;if(c[0].nodeType!=m.NODE_ELEMENT)if(n)n>=c[0].nodeValue.length&&
this.setEndAfter(c);else this.setEndBefore(c)},setStartAfter:function(c){this.setStart(c.parent(),c._4e_index()+1)},setStartBefore:function(c){this.setStart(c.parent(),c._4e_index())},setEndAfter:function(c){this.setEnd(c.parent(),c._4e_index()+1)},setEndBefore:function(c){this.setEnd(c.parent(),c._4e_index())},optimizeBookmark:function(){var c=this.startContainer,n=this.endContainer;c&&c._4e_name()=="span"&&c.attr("_ke_bookmark")&&this.setStartAt(c,h.POSITION_BEFORE_START);n&&n._4e_name()=="span"&&
n.attr("_ke_bookmark")&&this.setEndAt(n,h.POSITION_AFTER_END)},setStart:function(c,n){if(c[0].nodeType==m.NODE_ELEMENT&&d[c._4e_name()]){c=c.parent();n=c._4e_index()}this.startContainer=c;this.startOffset=n;if(!this.endContainer){this.endContainer=c;this.endOffset=n}this.updateCollapsed()},setEnd:function(c,n){if(c[0].nodeType==m.NODE_ELEMENT&&d[c._4e_name()]){c=c.parent();n=c._4e_index()+1}this.endContainer=c;this.endOffset=n;if(!this.startContainer){this.startContainer=c;this.startOffset=n}this.updateCollapsed()},
setStartAt:function(c,n){switch(n){case h.POSITION_AFTER_START:this.setStart(c,0);break;case h.POSITION_BEFORE_END:c[0].nodeType==m.NODE_TEXT?this.setStart(c,c[0].nodeValue.length):this.setStart(c,c[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setStartBefore(c);break;case h.POSITION_AFTER_END:this.setStartAfter(c)}this.updateCollapsed()},setEndAt:function(c,n){switch(n){case h.POSITION_AFTER_START:this.setEnd(c,0);break;case h.POSITION_BEFORE_END:c[0].nodeType==m.NODE_TEXT?this.setEnd(c,
c[0].nodeValue.length):this.setEnd(c,c[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setEndBefore(c);break;case h.POSITION_AFTER_END:this.setEndAfter(c)}this.updateCollapsed()},execContentsAction:function(c,n){var q=this.startContainer,u=this.endContainer,A=this.startOffset,t=this.endOffset,C,E=this.document,F;this.optimizeBookmark();if(u[0].nodeType==m.NODE_TEXT)u=u._4e_splitText(t);else if(u[0].childNodes.length>0)if(t>=u[0].childNodes.length){u=new a(u[0].appendChild(E.createTextNode("")));
F=true}else u=new a(u[0].childNodes[t]);if(q[0].nodeType==m.NODE_TEXT){q._4e_splitText(A);if(q._4e_equals(u))u=new a(q[0].nextSibling)}else if(A)if(A>=q[0].childNodes.length){C=new a(E.createTextNode(""));q.append(C);q=C;C=true}else q=new a(q[0].childNodes[A].previousSibling);else{C=new a(E.createTextNode(""));(A=q[0].firstChild)?k.insertBefore(C[0],A):q.append(C);q=C;C=true}A=q._4e_parents();t=u._4e_parents();var H,K,M;for(H=0;H<A.length;H++){K=A[H];M=t[H];if(!K._4e_equals(M))break}E=n;for(var D,
J,G,I=H;I<A.length;I++){D=A[I];if(E&&!D._4e_equals(q))J=E.appendChild(D._4e_clone()[0]);for(D=D[0].nextSibling;D;){if(k._4e_equals(t[I],D)||k._4e_equals(u,D))break;G=D.nextSibling;if(c==2)E.appendChild(D.cloneNode(true));else{D.parentNode.removeChild(D);c==1&&E.appendChild(D)}D=G}if(J)E=J}E=n;for(H=H;H<t.length;H++){D=t[H];if(c>0&&!D._4e_equals(u))J=E.appendChild(D._4e_clone()[0]);if(!A[H]||!D.parent()._4e_equals(A[H].parent()))for(D=D[0].previousSibling;D;){if(k._4e_equals(A[H],D)||k._4e_equals(q,
D))break;G=D.previousSibling;if(c==2)E.insertBefore(D.cloneNode(true),E.firstChild);else{k._4e_remove(D);c==1&&E.insertBefore(D,E.firstChild)}D=G}if(J)E=J}if(c==2){M=this.startContainer[0];if(M.nodeType==m.NODE_TEXT&&M.nextSibling&&M.nextSibling.nodeType==m.NODE_TEXT){M.data+=M.nextSibling.data;M.parentNode.removeChild(M.nextSibling)}M=this.endContainer[0];if(M.nodeType==m.NODE_TEXT&&M.nextSibling&&M.nextSibling.nodeType==m.NODE_TEXT){M.data+=M.nextSibling.data;M.parentNode.removeChild(M.nextSibling)}}else{if(K&&
M&&(!q.parent()._4e_equals(K.parent())||!u.parent()._4e_equals(M.parent()))){K=M._4e_index();C&&M.parent()._4e_equals(q.parent())&&K--;this.setStart(M.parent(),K)}this.collapse(true)}C&&q._4e_remove();F&&u[0].parentNode&&u._4e_remove()},collapse:function(c){if(c){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=true},clone:function(){var c=new r(this.document);c.startContainer=this.startContainer;
c.startOffset=this.startOffset;c.endContainer=this.endContainer;c.endOffset=this.endOffset;c.collapsed=this.collapsed;return c},getEnclosedNode:function(){var c=this.clone();c.optimize();if(c.startContainer[0].nodeType!=m.NODE_ELEMENT||c.endContainer[0].nodeType!=m.NODE_ELEMENT)return null;var n=new x.Walker(c),q=B(true,undefined),u=o(true);c.evaluator=function(A){return u(A)&&q(A)};c=n.next();n.reset();n=n.previous();return c&&c._4e_equals(n)?c:null},shrink:function(c,n){if(!this.collapsed){c=c||
h.SHRINK_TEXT;var q=this.clone(),u=this.startContainer,A=this.endContainer,t=this.startOffset,C=this.endOffset,E=1,F=1;if(u&&u[0].nodeType==m.NODE_TEXT)if(t)if(t>=u[0].nodeValue.length)q.setStartAfter(u);else{q.setStartBefore(u);E=0}else q.setStartBefore(u);if(A&&A[0].nodeType==m.NODE_TEXT)if(C)if(C>=A[0].nodeValue.length)q.setEndAfter(A);else{q.setEndAfter(A);F=0}else q.setEndBefore(A);q=new f(q);q.evaluator=function(K){K=K[0]||K;return K.nodeType==(c==h.SHRINK_ELEMENT?m.NODE_ELEMENT:m.NODE_TEXT)};
var H;q.guard=function(K,M){K=K[0]||K;if(c==h.SHRINK_ELEMENT&&K.nodeType==m.NODE_TEXT)return false;if(M&&K==H)return false;if(!M&&K.nodeType==m.NODE_ELEMENT)H=K;return true};if(E)(u=q[c==h.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(u,n?h.POSITION_AFTER_START:h.POSITION_BEFORE_START);if(F){q.reset();(q=q[c==h.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(q,n?h.POSITION_BEFORE_END:h.POSITION_AFTER_END)}return!!(E||F)}},getTouchedStartNode:function(){var c=this.startContainer;
if(this.collapsed||c[0].nodeType!=m.NODE_ELEMENT)return c;return c.childNodes[this.startOffset]||c},createBookmark2:function(c){var n=this.startContainer,q=this.endContainer,u=this.startOffset,A=this.endOffset,t,C;if(!n||!q)return{start:0,end:0};if(c){if(n[0].nodeType==m.NODE_ELEMENT)if((t=new a(n[0].childNodes[u]))&&t[0]&&t[0].nodeType==m.NODE_TEXT&&u>0&&t[0].previousSibling.nodeType==m.NODE_TEXT){n=t;u=0}for(;n[0].nodeType==m.NODE_TEXT&&(C=n._4e_previous())&&C[0].nodeType==m.NODE_TEXT;){n=C;u+=
C[0].nodeValue.length}if(!this.collapsed){if(q[0].nodeType==m.NODE_ELEMENT)if((t=new a(q[0].childNodes[A]))&&t[0]&&t[0].nodeType==m.NODE_TEXT&&A>0&&t[0].previousSibling.nodeType==m.NODE_TEXT){q=t;A=0}for(;q[0].nodeType==m.NODE_TEXT&&(C=q._4e_previous())&&C[0].nodeType==m.NODE_TEXT;){q=C;A+=C[0].nodeValue.length}}}return{start:n._4e_address(c),end:this.collapsed?null:q._4e_address(c),startOffset:u,endOffset:A,normalized:c,is2:true}},createBookmark:function(c){var n,q,u,A;n=new a("<span>",null,this.document);
n.attr("_ke_bookmark",1);n.css("display","none");n.html("&nbsp;");if(c){u=l.guid("ke_bm_");n.attr("id",u+"S")}if(!this.collapsed){q=n._4e_clone();q.html("&nbsp;");c&&q.attr("id",u+"E");A=this.clone();A.collapse();A.insertNode(q)}A=this.clone();A.collapse(true);A.insertNode(n);if(q){this.setStartAfter(n);this.setEndBefore(q)}else this.moveToPosition(n,h.POSITION_AFTER_END);return{startNode:c?u+"S":n,endNode:c?u+"E":q,serializable:c}},moveToPosition:function(c,n){this.setStartAt(c,n);this.collapse(true)},
trim:function(c,n){var q=this.startContainer,u=this.startOffset,A=this.collapsed;if((!c||A)&&q[0]&&q[0].nodeType==m.NODE_TEXT){if(u)if(u>=q[0].nodeValue.length){u=q._4e_index()+1;q=q.parent()}else{var t=q._4e_splitText(u);u=q._4e_index()+1;q=q.parent();if(k._4e_equals(this.startContainer,this.endContainer))this.setEnd(t,this.endOffset-this.startOffset);else if(k._4e_equals(q,this.endContainer))this.endOffset+=1}else{u=q._4e_index();q=q.parent()}this.setStart(q,u);if(A){this.collapse(true);return}}q=
this.endContainer;u=this.endOffset;if(!(n||A)&&q[0]&&q[0].nodeType==m.NODE_TEXT){if(u){u>=q.nodeValue.length||q._4e_splitText(u);u=q._4e_index()+1}else u=q._4e_index();q=q.parent();this.setEnd(q,u)}},insertNode:function(c){this.optimizeBookmark();this.trim(false,true);var n=this.startContainer,q=n[0].childNodes[this.startOffset];this.optimizeBookmark();this.trim(false,true);q?k.insertBefore(c[0]||c,q):n[0].appendChild(c[0]||c);k._4e_equals(c.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(c)},
moveToBookmark:function(c){if(c.is2){var n=e(this.document,c.start,c.normalized),q=c.startOffset,u=c.end&&e(this.document,c.end,c.normalized);c=c.endOffset;this.setStart(n,q);u?this.setEnd(u,c):this.collapse(true)}else{n=(q=c.serializable)?l.one("#"+c.startNode,this.document):c.startNode;c=q?l.one("#"+c.endNode,this.document):c.endNode;this.setStartBefore(n);n._4e_remove();if(c&&c[0]){this.setEndBefore(c);c._4e_remove()}else this.collapse(true)}},getCommonAncestor:function(c,n){var q=this.startContainer,
u=this.endContainer;q=k._4e_equals(q,u)?c&&q[0].nodeType==m.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new a(q[0].childNodes[this.startOffset]):q:q._4e_commonAncestor(u);return n&&q[0].nodeType==m.NODE_TEXT?q.parent():q},enlarge:function(c){switch(c){case h.ENLARGE_ELEMENT:if(this.collapsed)break;c=this.getCommonAncestor();var n=new a(this.document.body),q,u,A,t,C,E=false,F,H;F=this.startContainer;H=this.startOffset;if(F[0].nodeType==m.NODE_TEXT){if(H){F=!l.trim(F[0].nodeValue.substring(0,H)).length&&
F;E=!!F}if(F)if(!(t=F[0].previousSibling))A=F.parent()}else{if(H)t=F[0].childNodes[H-1]||F[0].lastChild;t||(A=F)}for(;A||t;){if(A&&!t){if(!C&&k._4e_equals(A,c))C=true;if(!n._4e_contains(A))break;if(!E||A.css("display")!="inline"){E=false;if(C)q=A;else this.setStartBefore(A)}t=A[0].previousSibling}for(;t;){F=false;if(t.nodeType==m.NODE_TEXT){H=t.nodeValue;if(/[^\s\ufeff]/.test(H))t=null;F=/[\s\ufeff]$/.test(H)}else if(t.offsetWidth>0&&!t.getAttribute("_ke_bookmark"))if(E&&p.$removeEmpty[t.nodeName.toLowerCase()]){H=
k.text(t);if(/[^\s\ufeff]/.test(H))t=null;else for(var K=t.all||t.getElementsByTagName("*"),M=0,D;D=K[M++];)if(!p.$removeEmpty[D.nodeName.toLowerCase()]){t=null;break}if(t)F=!!H.length}else t=null;if(F)if(E)if(C)q=A;else A&&this.setStartBefore(A);else E=true;if(t){F=t.previousSibling;if(!A&&!F){A=new a(t);t=null;break}t=F}else A=null}if(A)A=A.parent()}F=this.endContainer;H=this.endOffset;A=t=null;C=E=false;if(F[0].nodeType==m.NODE_TEXT){F=!l.trim(F[0].nodeValue.substring(H)).length&&F;E=!(F&&F[0].nodeValue.length);
if(F)if(!(t=F[0].nextSibling))A=F.parent()}else(t=F[0].childNodes[H])||(A=F);for(;A||t;){if(A&&!t){if(!C&&k._4e_equals(A,c))C=true;if(!n._4e_contains(A))break;if(!E||A.css("display")!="inline"){E=false;if(C)u=A;else A&&this.setEndAfter(A)}t=A[0].nextSibling}for(;t;){F=false;if(t.nodeType==m.NODE_TEXT){H=t.nodeValue;if(/[^\s\ufeff]/.test(H))t=null;F=/^[\s\ufeff]/.test(H)}else if(t.offsetWidth>0&&!t.getAttribute("_ke_bookmark"))if(E&&p.$removeEmpty[t.nodeName.toLowerCase()]){H=k.text(t);if(/[^\s\ufeff]/.test(H))t=
null;else{K=t.all||t.getElementsByTagName("*");for(M=0;D=K[M++];)if(!p.$removeEmpty[D.nodeName.toLowerCase()]){t=null;break}}if(t)F=!!H.length}else t=null;if(F)if(E)if(C)u=A;else this.setEndAfter(A);if(t){F=t.nextSibling;if(!A&&!F){A=new a(t);t=null;break}t=F}else A=null}if(A)A=A.parent()}if(q&&u){c=q._4e_contains(u)?u:q;this.setStartBefore(c);this.setEndAfter(c)}break;case h.ENLARGE_BLOCK_CONTENTS:case h.ENLARGE_LIST_ITEM_CONTENTS:A=new r(this.document);n=new a(this.document.body);A.setStartAt(n,
h.POSITION_AFTER_START);A.setEnd(this.startContainer,this.startOffset);A=new f(A);var J,G,I=f.blockBoundary(c==h.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),L=function(O){var N=I(O);N||(J=O);return N};q=function(O){var N=L(O);if(!N&&O[0]&&O._4e_name()=="br")G=O;return N};A.guard=L;A=A.lastBackward();J=J||n;this.setStartAt(J,J._4e_name()!="br"&&(!A&&this.checkStartOfBlock()||A&&J._4e_contains(A))?h.POSITION_AFTER_START:h.POSITION_AFTER_END);A=this.clone();A.collapse();A.setEndAt(n,h.POSITION_BEFORE_END);
A=new f(A);A.guard=c==h.ENLARGE_LIST_ITEM_CONTENTS?q:L;J=null;A=A.lastForward();J=J||n;this.setEndAt(J,!A&&this.checkEndOfBlock()||A&&J._4e_contains(A)?h.POSITION_BEFORE_END:h.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},checkStartOfBlock:function(){var c=this.startContainer,n=this.startOffset;if(n&&c[0].nodeType==m.NODE_TEXT)if(l.trim(c[0].nodeValue.substring(0,n)).length)return false;this.trim();c=new b(this.startContainer);n=this.clone();n.collapse(true);n.setStartAt(c.block||c.blockLimit,h.POSITION_AFTER_START);
c=new f(n);c.evaluator=z(true);return c.checkBackward()},checkEndOfBlock:function(){var c=this.endContainer,n=this.endOffset;if(c[0].nodeType==m.NODE_TEXT)if(l.trim(c[0].nodeValue.substring(n)).length)return false;this.trim();c=new b(this.endContainer);n=this.clone();n.collapse(false);n.setEndAt(c.block||c.blockLimit,h.POSITION_BEFORE_END);c=new f(n);c.evaluator=z(false);return c.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var c=
this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,c);return c},checkBoundaryOfElement:function(c,n){var q=this.clone();q[n==h.START?"setStartAt":"setEndAt"](c,n==h.START?h.POSITION_AFTER_START:h.POSITION_BEFORE_END);q=new f(q);q.evaluator=w;return q[n==h.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var c=this.startContainer,n=this.endContainer,q=this.startOffset,u=this.endOffset,A;if(c[0].nodeType==m.NODE_ELEMENT){A=c[0].childNodes.length;if(A>
q)c=new a(c[0].childNodes[q]);else if(A<1)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=new a(c);c=c._4e_nextSourceNode()||c}}if(n[0].nodeType==m.NODE_ELEMENT){A=n[0].childNodes.length;if(A>u)n=(new a(n[0].childNodes[u]))._4e_previousSourceNode(true);else if(A<1)n=n._4e_previousSourceNode();else{for(n=n[0];n.lastChild;)n=n.lastChild;n=new a(n)}}if(c._4e_position(n)&g.POSITION_FOLLOWING)c=n;return{startNode:c,endNode:n}},fixBlock:function(c,n){var q=this.createBookmark(),
u=new a(this.document.createElement(n));this.collapse(c);this.enlarge(h.ENLARGE_BLOCK_CONTENTS);u[0].appendChild(this.extractContents());u._4e_trim();i.ie||u._4e_appendBogus();this.insertNode(u);this.moveToBookmark(q);return u},splitBlock:function(c){var n=new b(this.startContainer),q=new b(this.endContainer),u=n.block,A=q.block,t=null;if(!n.blockLimit._4e_equals(q.blockLimit))return null;if(c!="br"){if(!u){u=this.fixBlock(true,c);A=(new b(this.endContainer)).block}A||(A=this.fixBlock(false,c))}c=
u&&this.checkStartOfBlock();n=A&&this.checkEndOfBlock();this.deleteContents();if(u&&k._4e_equals(u,A))if(n){t=new b(this.startContainer);this.moveToPosition(A,h.POSITION_AFTER_END);A=null}else if(c){t=new b(this.startContainer);this.moveToPosition(u,h.POSITION_BEFORE_START);u=null}else{A=this.splitElement(u);!i.ie&&!l.inArray(u._4e_name(),["ul","ol"])&&u._4e_appendBogus()}return{previousBlock:u,nextBlock:A,wasStartOfBlock:c,wasEndOfBlock:n,elementPath:t}},splitElement:function(c){if(!this.collapsed)return null;
this.setEndAt(c,h.POSITION_BEFORE_END);var n=this.extractContents(),q=c._4e_clone(false);q[0].appendChild(n);q.insertAfter(c);this.moveToPosition(c,h.POSITION_AFTER_END);return q},moveToElementEditablePosition:function(c,n){var q,u=x.XHTML_DTD;if(u.$empty[c._4e_name()])return false;for(;c&&c[0].nodeType==m.NODE_ELEMENT;){if(q=c._4e_isEditable())this.moveToPosition(c,n?h.POSITION_BEFORE_END:h.POSITION_AFTER_START);else if(u.$inline[c._4e_name()]){this.moveToPosition(c,n?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);
return true}if((c=u.$empty[c._4e_name()]?c[n?"_4e_previous":"_4e_next"](y):c[n?"_4e_last":"_4e_first"](y))&&c[0].nodeType==m.NODE_TEXT){this.moveToPosition(c,n?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);return true}}return q},selectNodeContents:function(c){this.setStart(c,0);this.setEnd(c,c[0].nodeType==m.NODE_TEXT?c[0].nodeValue.length:c[0].childNodes.length)}});var j={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},v=new f.whitespaces,s=new f.bookmark;x.Range=r});
KISSY.Editor.add("domiterator",function(x){function r(k){if(!(arguments.length<1)){this.range=k;this.forceBrBreak=false;this.enlargeBr=true;this.enforceRealBlocks=false;this._||(this._={})}}var w=KISSY,y=w.UA,z=x.Walker,B=x.Range,o=x.RANGE,l=x.NODE,m=x.ElementPath,h=w.Node,g=w.DOM,f=/^[\r\n\t ]*$/;z.bookmark();w.augment(r,{getNextParagraph:function(k){var e,i,p,b,a;if(!this._.lastNode){i=this.range.clone();i.shrink(o.SHRINK_ELEMENT,true);i.enlarge(this.forceBrBreak||!this.enlargeBr?o.ENLARGE_LIST_ITEM_CONTENTS:
o.ENLARGE_BLOCK_CONTENTS);var d=new z(i),j=z.bookmark(true,true);d.evaluator=j;this._.nextNode=d.next();d=new z(i);d.evaluator=j;d=d.previous();this._.lastNode=d._4e_nextSourceNode(true);if(this._.lastNode&&this._.lastNode[0].nodeType==l.NODE_TEXT&&!w.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){j=new B(i.document);j.moveToPosition(this._.lastNode,o.POSITION_AFTER_END);if(j.checkEndOfBlock()){j=new m(j.endContainer);this._.lastNode=(j.block||j.blockLimit)._4e_nextSourceNode(true)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new h(i.document.createTextNode(""));g.insertAfter(this._.lastNode[0],d[0])}i=null}j=this._.nextNode;d=this._.lastNode;for(this._.nextNode=null;j;){var v=false,s=j[0].nodeType!=l.NODE_ELEMENT,c=false;if(s){if(j[0].nodeType==l.NODE_TEXT)if(f.test(j[0].nodeValue))s=false}else{var n=j._4e_name();if(j._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(n=="br")s=true;else if(!i&&!j[0].childNodes.length&&n!="hr"){e=j;p=j._4e_equals(d);break}if(i){i.setEndAt(j,o.POSITION_BEFORE_START);
if(n!="br")this._.nextNode=j}v=true}else{if(j[0].firstChild){if(!i){i=new B(this.range.document);i.setStartAt(j,o.POSITION_BEFORE_START)}j=new h(j[0].firstChild);continue}s=true}}if(s&&!i){i=new B(this.range.document);i.setStartAt(j,o.POSITION_BEFORE_START)}p=(!v||s)&&j._4e_equals(d);if(i&&!v)for(;!j[0].nextSibling&&!p;){n=j.parent();if(n._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){v=true;p||n._4e_equals(d);break}j=n;s=true;p=j._4e_equals(d);c=true}s&&i.setEndAt(j,o.POSITION_AFTER_END);j=j._4e_nextSourceNode(c,
null,d);if((p=!j)||v&&i)break}if(!e){if(!i){this._.docEndMarker&&this._.docEndMarker._4e_remove();return this._.nextNode=null}e=new m(i.startContainer);j=e.blockLimit;v={div:1,th:1,td:1};e=e.block;if((!e||!e[0])&&!this.enforceRealBlocks&&v[j._4e_name()]&&i.checkStartOfBlock()&&i.checkEndOfBlock())e=j;else if(!e||this.enforceRealBlocks&&e._4e_name()=="li"){e=new h(this.range.document.createElement(k||"p"));e[0].appendChild(i.extractContents());e._4e_trim();i.insertNode(e);b=a=true}else if(e._4e_name()!=
"li"){if(!i.checkStartOfBlock()||!i.checkEndOfBlock()){e=e._4e_clone(false);e[0].appendChild(i.extractContents());e._4e_trim();a=i.splitBlock();b=!a.wasStartOfBlock;a=!a.wasEndOfBlock;i.insertNode(e)}}else if(!p)this._.nextNode=e._4e_equals(d)?null:i.getBoundaryNodes().endNode._4e_nextSourceNode(true,null,d)}if(b){i=new h(e[0].previousSibling);if(i[0]&&i[0].nodeType==l.NODE_ELEMENT)if(i._4e_name()=="br")i._4e_remove();else i[0].lastChild&&g._4e_name(i[0].lastChild)=="br"&&g._4e_remove(i[0].lastChild)}if(a){i=
z.bookmark(false,true);b=new h(e[0].lastChild);if(b[0]&&b[0].nodeType==l.NODE_ELEMENT&&b._4e_name()=="br")if(y.ie||b._4e_previous(i)||b._4e_next(i))b._4e_remove()}if(!this._.nextNode)this._.nextNode=p||e._4e_equals(d)?null:e._4e_nextSourceNode(true,null,d);return e}});B.prototype.createIterator=function(){return new r(this)}});
KISSY.Editor.add("selection",function(x){function r(a){this.document=a;this._={cache:{}};if(z.ie){var d=this.getNative().createRange();if(!d||d.item&&d.item(0).ownerDocument!=a||d.parentElement&&d.parentElement().ownerDocument!=a)this.isInvalid=true}}function w(a){var d=a.document,j=new l(d.body),v=new l(d.documentElement);if(z.ie){if(z.ie<8||document.documentMode==7)v.on("click",function(E){B._4e_name(E.target)==="html"&&a.getSelection().getRanges()[0].select()});var s,c,n=1;v.on("mousedown",function(){n=
0});v.on("mouseup",function(){n=1});j.on("focusin",function(E){if(B._4e_name(E.target)=="body")if(s){try{n&&s.select()}catch(F){}s=null}});j.on("focus",function(){c=true;u()});j.on("beforedeactivate",function(E){if(!E.relatedTarget){c=false;n=1}});o.on(B._4e_getWin(d),"blur",function(){d&&d.selection.empty()});j.on("mousedown",function(){q()});j.on("mouseup",function(){c=true;setTimeout(function(){u(true)},0)});j.on("keydown",q);j.on("keyup",function(){c=true;u()});o.on(d,"selectionchange",u);var q=
function(){c=false},u=function(E){if(c){var F=a.document,H=a.getSelection(),K=H&&H.getType(),M=H&&H.getNative();if(E&&M&&K==m.SELECTION_NONE)if(!F.queryCommandEnabled("InsertImage")){setTimeout(function(){u(true)},50);return}var D;if(!(M&&K==m.SELECTION_TEXT&&(D=B._4e_name(M.createRange().parentElement()))&&D in{input:1,textarea:1})){s=M&&H.getRanges()[0];a._monitor()}}}}else{o.on(d,"mouseup",a._monitor,a);o.on(d,"keyup",a._monitor,a)}var A={table:1,pre:1},t=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
C=x.Walker.whitespaces(true);x.Walker.bookmark(false,true);a.on("selectionChange",function(E){var F=E.path;E=(E=E.selection)&&E.getRanges()[0];var H=F.blockLimit;if(E)if(E.collapse&&!F.block&&H._4e_name()=="body"){F=E.fixBlock(true,"p");if(F._4e_outerHtml().match(t))if((H=F._4e_next(C))&&H[0].nodeType==g.NODE_ELEMENT&&!A[H._4e_name()]){E.moveToElementEditablePosition(H);F._4e_remove()}else if((H=F._4e_previous(C))&&H[0].nodeType==g.NODE_ELEMENT&&!A[H._4e_name()]){E.moveToElementEditablePosition(H,
H._4e_outerHtml().match(t)?false:true);F._4e_remove()}E.select();z.ie||a.notifySelectionChange()}})}x.SELECTION={};var y=KISSY,z=y.UA,B=y.DOM,o=y.Event,l=y.Node,m=x.SELECTION,h=x.RANGE,g=x.NODE,f=x.Walker,k=x.Range;m.SELECTION_NONE=1;m.SELECTION_TEXT=2;m.SELECTION_ELEMENT=3;var e={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};y.augment(r,{getNative:z.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=
this.document.selection)}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=B._4e_getWin(this.document).getSelection())},getType:z.ie?function(){var a=this._.cache;if(a.type)return a.type;var d=m.SELECTION_NONE;try{var j=this.getNative(),v=j.type;if(v=="Text")d=m.SELECTION_TEXT;if(v=="Control")d=m.SELECTION_ELEMENT;if(j.createRange().parentElement)d=m.SELECTION_TEXT}catch(s){}return a.type=d}:function(){var a=this._.cache;if(a.type)return a.type;var d=m.SELECTION_TEXT,j=this.getNative();
if(j){if(j.rangeCount==1){j=j.getRangeAt(0);var v=j.startContainer;if(v==j.endContainer&&v.nodeType==g.NODE_ELEMENT&&j.endOffset-j.startOffset===1&&e[v.childNodes[j.startOffset].nodeName.toLowerCase()])d=m.SELECTION_ELEMENT}}else d=m.SELECTION_NONE;return a.type=d},getRanges:z.ie?function(){var a=function(d,j){d=d.duplicate();d.collapse(j);for(var v=d.parentElement(),s=v.childNodes,c,n=0;n<s.length;n++){var q=s[n];if(q.nodeType==g.NODE_ELEMENT){c=d.duplicate();c.moveToElementText(q);q=c.compareEndPoints("StartToStart",
d);var u=c.compareEndPoints("EndToStart",d);c.collapse();if(q>0)break;else if(!q||u==1&&q==-1)return{container:v,offset:n};else if(!u)return{container:v,offset:n+1};c=null}}if(!c){c=d.duplicate();c.moveToElementText(v);c.collapse(false)}c.setEndPoint("StartToStart",d);c=c.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;c>0;)c-=s[--n].nodeValue.length}catch(A){c=0}return c===0?{container:v,offset:n}:{container:s[n],offset:-c}};return function(){var d=this._.cache;if(d.ranges)return d.ranges;var j=
this.getNative(),v=j&&j.createRange(),s=this.getType();if(!j)return[];if(s==m.SELECTION_TEXT){j=new k(this.document);s=a(v,true);j.setStart(new l(s.container),s.offset);s=a(v);j.setEnd(new l(s.container),s.offset);return d.ranges=[j]}else if(s==m.SELECTION_ELEMENT){d=this._.cache.ranges=[];for(s=0;s<v.length;s++){var c=v.item(s),n=c.parentNode,q=0;for(j=new k(this.document);q<n.childNodes.length&&n.childNodes[q]!=c;q++);j.setStart(new l(n),q);j.setEnd(new l(n),q+1);d.push(j)}return d}return d.ranges=
[]}}():function(){var a=this._.cache;if(a.ranges)return a.ranges;var d=[],j=this.getNative();if(!j)return[];for(var v=0;v<j.rangeCount;v++){var s=j.getRangeAt(v),c=new k(this.document);c.setStart(new l(s.startContainer),s.startOffset);c.setEnd(new l(s.endContainer),s.endOffset);d.push(c)}return a.ranges=d},getStartElement:function(){var a=this._.cache;if(a.startElement!==undefined)return a.startElement;var d,j=this.getNative();switch(this.getType()){case m.SELECTION_ELEMENT:return this.getSelectedElement();
case m.SELECTION_TEXT:var v=this.getRanges()[0];if(v)if(!v.collapsed){for(v.optimize();;){d=v.startContainer;if(v.startOffset==(d[0].nodeType===g.NODE_ELEMENT?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())v.setStartAfter(d);else break}d=v.startContainer;if(d[0].nodeType!=g.NODE_ELEMENT)return d.parent();d=new l(d[0].childNodes[v.startOffset]);if(!d[0]||d[0].nodeType!=g.NODE_ELEMENT)return v.startContainer;for(v=d[0].firstChild;v&&v.nodeType==g.NODE_ELEMENT;){d=new l(v);v=
v.firstChild}return d}if(z.ie){v=j.createRange();v.collapse(true);d=v.parentElement()}else if((d=j.anchorNode)&&d.nodeType!=g.NODE_ELEMENT)d=d.parentNode}return a.startElement=d?B._4e_wrap(d):null},getSelectedElement:function(){var a=this._.cache;if(a.selectedElement!==undefined)return a.selectedElement;var d=this,j;if(z.ie){j=d.getNative().createRange();j=j.item&&j.item(0)}j||(j=function(){for(var v=d.getRanges()[0],s,c,n=2;n&&!((s=v.getEnclosedNode())&&s[0].nodeType==g.NODE_ELEMENT&&e[s._4e_name()]&&
(c=s));n--)v.shrink(h.SHRINK_ELEMENT);return c&&c[0]}());return a.selectedElement=B._4e_wrap(j)},reset:function(){this._.cache={}},selectElement:function(a){var d;if(z.ie)try{d=this.document.body.createControlRange();d.addElement(a[0]);d.select()}catch(j){d=this.document.body.createTextRange();d.moveToElementText(a[0]);d.select()}finally{}else{d=this.document.createRange();d.selectNode(a[0]);a=this.getNative();a.removeAllRanges();a.addRange(d)}this.reset()},selectRanges:function(a){if(z.ie)a[0]&&
a[0].select();else{var d=this.getNative();if(!d)return;d.removeAllRanges();for(var j=0;j<a.length;j++){var v=a[j],s=this.document.createRange(),c=v.startContainer;v.collapsed&&z.gecko&&z.gecko<1.09&&c[0].nodeType==g.NODE_ELEMENT&&!c[0].childNodes.length&&c[0].appendChild(this.document.createTextNode(""));s.setStart(c[0],v.startOffset);s.setEnd(v.endContainer[0],v.endOffset);d.addRange(s)}}this.reset()},createBookmarks2:function(a){for(var d=[],j=this.getRanges(),v=0;v<j.length;v++)d.push(j[v].createBookmark2(a));
return d},createBookmarks:function(a){for(var d=[],j=this.getRanges(),v=j.length,s=this.document,c,n=0;n<v;n++){d.push(c=j[n].createBookmark(a,true));var q=(a=c.serializable)?y.one("#"+c.startNode,s):c.startNode;c=a?y.one("#"+c.endNode,s):c.endNode;for(var u=n+1;u<v;u++){var A=j[u],t=A.startContainer,C=A.endContainer;B._4e_equals(t,q.parent())&&A.startOffset++;B._4e_equals(t,c.parent())&&A.startOffset++;B._4e_equals(C,q.parent())&&A.endOffset++;B._4e_equals(C,c.parent())&&A.endOffset++}}return d},
selectBookmarks:function(a){for(var d=[],j=0;j<a.length;j++){var v=new k(this.document);v.moveToBookmark(a[j]);d.push(v)}this.selectRanges(d);return this},getCommonAncestor:function(){var a=this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a._4e_scrollIntoView()},removeAllRanges:function(){var a=this.getNative();z.ie?a.clear():a.removeAllRanges()}});x.Selection=r;var i={table:1,tbody:1,tr:1},p=f.whitespaces(true),
b=/\ufeff|\u00a0/;k.prototype.select=z.ie?function(a){var d=this.collapsed,j,v;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var s=this.startContainer[0].childNodes[this.startOffset];if(s.nodeType==g.NODE_ELEMENT){(new r(this.document)).selectElement(new l(s));return}}if(this.startContainer[0].nodeType==g.NODE_ELEMENT&&this.startContainer._4e_name()in i||this.endContainer[0].nodeType==g.NODE_ELEMENT&&this.endContainer._4e_name()in i)this.shrink(h.SHRINK_ELEMENT,
true);var c=this.createBookmark();s=c.startNode;var n;if(!d)n=c.endNode;c=this.document.body.createTextRange();c.moveToElementText(s[0]);c.moveStart("character",1);if(n){a=this.document.body.createTextRange();a.moveToElementText(n[0]);c.setEndPoint("EndToEnd",a);c.moveEnd("character",-1)}else{for(j=s[0].nextSibling;j&&!p(j);)j=j.nextSibling;j=!(j&&j.nodeValue&&j.nodeValue.match(b))&&(a||!s[0].previousSibling||s[0].previousSibling&&B._4e_name(s[0].previousSibling)=="br");v=this.document.createElement("span");
v.innerHTML="&#65279;";v=new l(v);B.insertBefore(v[0],s[0]);j&&B.insertBefore(this.document.createTextNode("\ufeff"),s[0])}this.setStartBefore(s);s._4e_remove();if(d){if(j){c.moveStart("character",-1);c.select();this.document.selection.clear()}else c.select();if(v){this.moveToPosition(v,h.POSITION_BEFORE_START);v._4e_remove()}}else{this.setEndBefore(n);n._4e_remove();c.select()}}:function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==g.NODE_ELEMENT&&!a[0].childNodes.length&&a[0].appendChild(this.document.createTextNode(""));
var d=this.document.createRange();d.setStart(a[0],this.startOffset);try{d.setEnd(this.endContainer[0],this.endOffset)}catch(j){if(j.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(true);d.setEnd(this.endContainer[0],this.endOffset)}else throw j;}a=new r(this.document);a=(!a||a.isInvalid?null:a).getNative();a.removeAllRanges();a.addRange(d)};x.on("instanceCreated",function(a){w(a.editor)})});
KISSY.Editor.add("styles",function(x){function r(D,J){for(var G in D)D[G]=D[G].replace(M,function(I,L){return J[L]})}function w(D,J){if(J){D=j.clone(D);r(D.attributes,J);r(D.styles,J)}var G=this.element=(D.element||"*").toLowerCase();this.type=G=="#"||F[G]?s.STYLE_BLOCK:H[G]?s.STYLE_OBJECT:s.STYLE_INLINE;this._={definition:D}}function y(D,J){var G=J?this.removeFromRange:this.applyToRange;D.body.focus();for(var I=new n(D),L=I.getRanges(),O=0;O<L.length;O++)G.call(this,L[O]);I.selectRanges(L)}function z(D,
J){var G;G=D.element;if(G=="*")G="span";G=new t(J.createElement(G));return B(G,D)}function B(D,J){var G=J._.definition,I=G.attributes;G=w.getStyleText(G);if(I)for(var L in I)D.attr(L,I[L]);if(G)D[0].style.cssText=G;return D}function o(D){var J=D.createBookmark(true),G=D.createIterator();G.enforceRealBlocks=true;G.enlargeBr=true;for(var I,L=D.document;I=G.getNextParagraph();){var O=z(this,L);I=I;var N=O;O=N._4e_name=="pre";var P=I._4e_name=="pre",T=!O&&P;if(O&&!P){P=I;N=N;T=P.html();T=l(T,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,
"");T=T.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");T=T.replace(/([ \t\n\r]+|&nbsp;)/g," ");T=T.replace(/<br\b[^>]*>/gi,"\n");if(C.ie){P=P[0].ownerDocument.createElement("div");P.appendChild(N[0]);N[0].outerHTML="<pre>"+T+"</pre>";N=new t(P.firstChild);N._4e_remove()}else N.html(T);N=N}else if(T)N=h(m(I),N);else I._4e_moveChildren(N);I[0].parentNode.replaceChild(N[0],I[0]);if(O){I=N;O=void 0;if((O=I._4e_previousSourceNode(true,q.NODE_ELEMENT))&&O._4e_name()=="pre"){N=l(O.html(),/\n$/,"")+"\n\n"+
l(I.html(),/^\n/,"");if(C.ie)I[0].outerHTML="<pre>"+N+"</pre>";else I.html(N);O._4e_remove()}}}D.moveToBookmark(J)}function l(D,J,G){var I="",L="";D=D.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(O,N,P){N&&(I=N);P&&(L=P);return""});return I+D.replace(J,G)+L}function m(D){var J=[];l(D._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(G,I,L){return I+"</pre>"+L+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,
I){J.push(I)});return J}function h(D,J){for(var G=J[0].ownerDocument.createDocumentFragment(),I=0;I<D.length;I++){var L=D[I];L=L.replace(/(\r\n|\r)/g,"\n");L=l(L,/^[ \t]*\n/,"");L=l(L,/\n$/,"");L=l(L,/^[ \t]+|[ \t]+$/g,function(N,P){return N.length==1?"&nbsp;":P?" "+Array(N.length).join("&nbsp;"):Array(N.length).join("&nbsp;")+" "});L=L.replace(/\n/g,"<br>");L=L.replace(/[ \t]{2,}/g,function(N){return Array(N.length).join("&nbsp;")+" "});var O=J._4e_clone();O.html(L);G.appendChild(O[0])}return G}
function g(D){var J=D.document;if(D.collapsed){J=z(this,J);D.insertNode(J);D.moveToPosition(J,c.POSITION_BEFORE_END)}else{var G=this.element,I=this._.definition,L,O=x.XHTML_DTD[G]||(L=true,x.XHTML_DTD.span),N=D.createBookmark();D.enlarge(c.ENLARGE_ELEMENT);D.trim();var P=D.createBookmark(),T=P.startNode;P=P.endNode;for(var S=T,V;S&&S[0];){var Q=false;if(v._4e_equals(S,P)){S=null;Q=true}else{var R=S[0].nodeType,Y=R==q.NODE_ELEMENT?S._4e_name():null;if(Y&&S.attr("_ke_bookmark")){S=S._4e_nextSourceNode(true);
continue}if(!Y||O[Y]&&(S._4e_position(P)|u.POSITION_PRECEDING|u.POSITION_IDENTICAL|u.POSITION_IS_CONTAINED)==u.POSITION_PRECEDING+u.POSITION_IDENTICAL+u.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(S))){var U=S.parent();if(U&&U[0]&&((x.XHTML_DTD[U._4e_name()]||x.XHTML_DTD.span)[G]||L)&&(!I.parentRule||I.parentRule(U))){if(!V&&(!Y||!x.XHTML_DTD.$removeEmpty[Y]||(S._4e_position(P)|u.POSITION_PRECEDING|u.POSITION_IDENTICAL|u.POSITION_IS_CONTAINED)==u.POSITION_PRECEDING+u.POSITION_IDENTICAL+u.POSITION_IS_CONTAINED)){V=
new A(J);V.setStartBefore(S)}if(R==q.NODE_TEXT||R==q.NODE_ELEMENT&&!S[0].childNodes.length){R=S;for(var W;!R[0].nextSibling&&(W=R.parent(),O[W._4e_name()])&&(W._4e_position(T)|u.POSITION_FOLLOWING|u.POSITION_IDENTICAL|u.POSITION_IS_CONTAINED)==u.POSITION_FOLLOWING+u.POSITION_IDENTICAL+u.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(W));)R=W;V.setEndAfter(R);R[0].nextSibling||(Q=true)}}else Q=true}else Q=true;S=S._4e_nextSourceNode()}if(Q&&V&&!V.collapsed){Q=z(this,J);for(R=V.getCommonAncestor();Q&&
R&&Q[0]&&R[0];){if(R._4e_name()==G){for(var X in I.attributes)Q.attr(X)==R.attr(X)&&Q[0].removeAttribute(X);for(var aa in I.styles)Q._4e_style(aa)==R._4e_style(aa)&&Q._4e_style(aa,"");if(!Q._4e_hasAttributes()){Q=null;break}}R=R.parent()}if(Q){Q[0].appendChild(V.extractContents());R=Q;Y=i(this);U=R.all(this.element);for(var Z=U.length;--Z>=0;)p(this,new t(U[Z]));var $=void 0;for($ in Y)if($!=this.element){U=R.all($);for(Z=U.length-1;Z>=0;Z--){var ba=new t(U[Z]);a(ba,Y[$])}}V.insertNode(Q);Q._4e_mergeSiblings();
C.ie||Q[0].normalize()}V=null}}T._4e_remove();P._4e_remove();D.moveToBookmark(N);D.shrink(c.SHRINK_TEXT)}}function f(D){D.enlarge(c.ENLARGE_ELEMENT);var J=D.createBookmark(),G=J.startNode;if(D.collapsed){for(var I=new E(G.parent()),L,O=0,N;O<I.elements.length&&(N=I.elements[O]);O++){if(N==I.block||N==I.blockLimit)break;if(this.checkElementRemovable(N)){var P=D.checkBoundaryOfElement(N,c.END),T=!P&&D.checkBoundaryOfElement(N,c.START);if(T||P){L=N;L.match=T?"start":"end"}else{N._4e_mergeSiblings();
N._4e_name()==this.element?p(this,N):a(N,i(this)[N._4e_name()])}}}if(L&&L[0]){N=G;for(O=0;;O++){P=I.elements[O];if(v._4e_equals(P,L))break;else if(P.match)continue;else P=P._4e_clone();P[0].appendChild(N[0]);N=P}v[L.match=="start"?"insertBefore":"insertAfter"](N[0],L[0])}}else{var S=J.endNode,V=this;I=function(){for(var Q=new E(G.parent()),R=new E(S.parent()),Y=null,U=null,W=0;W<Q.elements.length;W++){var X=Q.elements[W];if(X==Q.block||X==Q.blockLimit)break;if(V.checkElementRemovable(X))Y=X}for(W=
0;W<R.elements.length;W++){X=R.elements[W];if(X==R.block||X==R.blockLimit)break;if(V.checkElementRemovable(X))U=X}U&&S._4e_breakParent(U);Y&&G._4e_breakParent(Y)};I();for(L=new t(G[0].nextSibling);L[0]!==S[0];){O=L._4e_nextSourceNode();if(L[0]&&L[0].nodeType==q.NODE_ELEMENT&&this.checkElementRemovable(L)){L._4e_name()==this.element?p(this,L):a(L,i(this)[L._4e_name()]);if(O[0].nodeType==q.NODE_ELEMENT&&O._4e_contains(G)){I();O=new t(G[0].nextSibling)}}L=O}}D.moveToBookmark(J)}function k(D){var J={};
D.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(G,I,L){J[I]=L});return J}function e(D,J){var G;if(J!==false){G=document.createElement("span");G.style.cssText=D;G=G.style.cssText||""}else G=D;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(D){if(D._.overrides)return D._.overrides;var J=D._.overrides={},G=D._.definition.overrides;if(G){j.isArray(G)||(G=[G]);for(var I=0;I<G.length;I++){var L=G[I],O,N;if(typeof L==
"string")O=L.toLowerCase();else{O=L.element?L.element.toLowerCase():D.element;N=L.attributes}L=J[O]||(J[O]={});if(N){L=L.attributes=L.attributes||[];for(var P in N)L.push([P.toLowerCase(),N[P]])}}}return J}function p(D,J){var G=D._.definition,I=j.mix(j.mix({},G.attributes),i(D)[J._4e_name()]);G=G.styles;var L=j.isEmptyObject(I)&&j.isEmptyObject(G),O;for(O in I)if(!((O=="class"||D._.definition.fullMatch)&&J.attr(O)!=b(O,I[O]))){L=L||!!J._4e_hasAttribute(O);J.removeAttr(O)}for(var N in G)if(!(D._.definition.fullMatch&&
J._4e_style(N)!=b(N,G[N],true))){L=L||!!J._4e_style(N);J._4e_style(N,"")}L&&d(J)}function b(D,J,G){var I=new t("<span></span>");I[G?"_4e_style":"attr"](D,J);return I[G?"_4e_style":"attr"](D)}function a(D,J){var G=J&&J.attributes;if(G)for(var I=0;I<G.length;I++){var L=G[I][0],O;if(O=D.attr(L)){var N=G[I][1];if(N===null||N.test&&N.test(O)||typeof N=="string"&&O==N)D[0].removeAttribute(L)}}d(D)}function d(D){if(!D._4e_hasAttributes()){var J=D[0].firstChild,G=D[0].lastChild;D._4e_remove(true);if(J){J.nodeType==
q.NODE_ELEMENT&&v._4e_mergeSiblings(J);G&&!J===G&&G.nodeType==q.NODE_ELEMENT&&v._4e_mergeSiblings(G)}}}var j=KISSY,v=j.DOM,s=x.STYLE={},c=x.RANGE,n=x.Selection,q=x.NODE,u=x.POSITION,A=x.Range,t=j.Node,C=j.UA,E=x.ElementPath,F={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},H={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},K=/\s*(?:;\s*|$)/,M=/#\((.+?)\)/g;s.STYLE_BLOCK=1;s.STYLE_INLINE=2;s.STYLE_OBJECT=3;w.prototype={apply:function(D){y.call(this,
D,false)},remove:function(D){y.call(this,D,true)},applyToRange:function(D){return(this.applyToRange=this.type==s.STYLE_INLINE?g:this.type==s.STYLE_BLOCK?o:this.type==s.STYLE_OBJECT?null:null).call(this,D)},removeFromRange:function(D){return(this.removeFromRange=this.type==s.STYLE_INLINE?f:null).call(this,D)},applyToObject:function(D){B(D,this)},checkElementRemovable:function(D,J){if(!D)return false;var G=this._.definition;if(D._4e_name()==this.element){if(!J&&!D._4e_hasAttributes())return true;var I=
G._AC;if(I)G=I;else{I={};var L=0,O=G.attributes;if(O)for(var N in O){L++;I[N]=O[N]}if(O=w.getStyleText(G)){I.style||L++;I.style=O}I._length=L;G=G._AC=I}if(G._length){for(var P in G)if(P!="_length"){L=D.attr(P)||"";if(P=="style")a:{I=G[P];L=e(L,false);typeof I=="string"&&(I=k(I));typeof L=="string"&&(L=k(L));O=void 0;for(O in I)if(!(O in L&&(L[O]==I[O]||I[O]=="inherit"||L[O]=="inherit"))){I=false;break a}I=true}else I=G[P]==L;if(I){if(!J)return true}else if(J)return false}if(J)return true}else return true}if(P=
i(this)[D._4e_name()]){if(!(G=P.attributes))return true;for(I=0;I<G.length;I++){P=G[I][0];if(P=D.attr(P)){L=G[I][1];if(L===null||typeof L=="string"&&P==L||L.test&&L.test(P))return true}}}return false},checkActive:function(D){switch(this.type){case s.STYLE_BLOCK:return this.checkElementRemovable(D.block||D.blockLimit,true);case s.STYLE_OBJECT:case s.STYLE_INLINE:for(var J=D.elements,G=0,I;G<J.length;G++){I=J[G];if(!(this.type==s.STYLE_INLINE&&(v._4e_equals(I,D.block)||v._4e_equals(I,D.blockLimit))))if(!(this.type==
s.STYLE_OBJECT&&!(I._4e_name()in H)))if(this.checkElementRemovable(I,true))return true}}return false}};w.getStyleText=function(D){var J=D._ST;if(J)return J;J=D.styles;var G=D.attributes&&D.attributes.style||"",I="";if(G.length)G=G.replace(K,";");for(var L in J){var O=J[L],N=(L+":"+O).replace(K,";");if(O=="inherit")I+=N;else G+=N}if(G.length)G=e(G);G+=I;return D._ST=G};x.Style=w});
KISSY.Editor.add("bgcolor",function(x){var r=KISSY.Editor,w=r.ColorSupport,y=w.VALID_COLORS,z={},B={element:"span",styles:{"background-color":"#(color)"}};z.inherit=new r.Style(B,{color:"inherit"});for(var o=0;o<y.length;o++){var l=y[o];z[l]=new r.Style(B,{color:l})}x.addPlugin(function(){new w({editor:x,styles:z,title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-bgcolor",text:"bgcolor"})})});
KISSY.Editor.add("bubbleview",function(x){function r(m){r.superclass.constructor.apply(this,arguments);m.init&&m.init.call(this)}var w=KISSY.Editor,y=KISSY,z=y.Event,B=y.DOM,o=y.Node;if(!w.BubbleView){var l={};r.attach=function(m){var h=m.pluginInstance,g=m.pluginName;m=h.editor;var f=l[g];if(f){var k=f.cfg.func,e=l[g].bubble;m.on("selectionChange",function(i){i=i.path;var p=i.elements;if(i&&p)if(i=i.lastElement)if(i=k(i)){p=l[g];if(!p.bubble)p.bubble=new r(p.cfg);e=p.bubble;e._selectedEl=i;e._plugin=
h;e.show()}else if(e){e._selectedEl=e._plugin=null;e.hide()}});z.on(B._4e_getWin(m.document),"scroll blur",function(){e&&e.hide()});z.on(document,"click",function(){e&&e.hide()})}};r.register=function(m){l[m.pluginName]={cfg:m}};r.ATTRS={focusMgr:{value:false},draggable:{value:false},zIndex:{value:x.baseZIndex(998)}};y.extend(r,w.SimpleOverlay,{_createEl:function(){var m=(new o('<div class="ke-bubbleview-bubble" onmousedown="return false;"></div>')).appendTo(document.body);this.el=m;this.set("el",
m)},show:function(){var m=this._selectedEl,h=m._4e_getOffset(document);h.top+=m.height()+5;r.superclass.show.call(this,h)}});w.BubbleView=r}});
KISSY.Editor.add("button",function(){function x(z){x.superclass.constructor.call(this,z);this._init()}var r=KISSY.Editor,w=KISSY,y=w.Node;if(!r.TripleButton){x.ON="on";x.OFF="off";x.DISABLED="disabled";x.ON_CLASS="ke-triplebutton-on";x.OFF_CLASS="ke-triplebutton-off";x.DISABLED_CLASS="ke-triplebutton-disabled";x.ATTRS={state:{value:"off"},container:{},text:{},contentCls:{},cls:{},el:{}};w.extend(x,w.Base,{_init:function(){var z=this.get("container"),B=this.get("el"),o=this.get("title"),l=this.get("text"),
m=this.get("contentCls"),h=this.el=new y("<a class='ke-triplebutton ke-triplebutton-off' href='#' role=\"button\"></a>");h._4e_unselectable();this._attachCls();if(l)h.html(l);else if(m){h.html("<span class='ke-toolbar-item "+m+"'></span>");h.one("span")._4e_unselectable()}o&&h.attr("title",o);if(B)B[0].parentNode.replaceChild(h[0],B[0]);else z&&z.append(this.el);h.on("click",this._action,this);this.on("afterStateChange",this._stateChange,this)},_attachCls:function(){var z=this.get("cls");z&&this.el.addClass(z)},
_stateChange:function(z){this["_"+z.newVal]();this._attachCls()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(z){this.fire(this.get("state")+"Click",z);this.fire("click",z);z.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.el[0].className="ke-triplebutton ke-triplebutton-on"},_off:function(){this.el[0].className=
"ke-triplebutton ke-triplebutton-off"},_disabled:function(){this.el[0].className="ke-triplebutton ke-triplebutton-disabled"}});r.TripleButton=x}});
KISSY.Editor.add("clipboard",function(x){var r=KISSY.Editor,w=KISSY,y=w.Node,z=w.UA,B=r.Range,o=r.RANGE,l=w.Event;r.Paste||function(){function m(b){this.editor=b;this._init()}function h(b){if(!(!z.ie||b.document.compatMode=="BackCompat")){var a=b.getSelection(),d;if(a.getType()==i.SELECTION_ELEMENT&&(d=a.getSelectedElement())){var j=a.getRanges()[0],v=new y(b.document.createTextNode(""));v.insertBefore(d);j.setStartBefore(v);j.setEndAfter(d);a.selectRanges([j]);setTimeout(function(){if(d.parent()){v.remove();
a.selectElement(d)}},0)}}}w.augment(m,{_init:function(){var b=this.editor;z.ie?l.on(b.document,"keydown",this._paste,this):l.on(b.document,"paste",this._paste,this);b.addCommand("copy",new e("copy"));b.addCommand("cut",new e("cut"));b.addCommand("paste",new e("paste"))},_paste:function(b){if(!(b.type==="keydown"&&!(b.keyCode===86&&(b.ctrlKey||b.metaKey)))){var a=this,d=a.editor,j=d.document;if(a._running)b.halt();else{var v=d.getSelection();b=new B(j);var s=new y(z.webkit?"<body></body>":"<div></div>",
null,j);z.webkit&&s[0].appendChild(j.createTextNode("\u00a0"));j.body.appendChild(s[0]);s.css({position:"absolute",top:v.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});s.css("left","-1000px");var c=v.createBookmarks();b.setStartAt(s,o.POSITION_AFTER_START);b.setEndAt(s,o.POSITION_BEFORE_END);b.select(true);a._running=true;setTimeout(function(){s._4e_remove();var n;s=z.webkit&&(n=s._4e_first())&&n.hasClass("Apple-style-span")?n:s;v.selectBookmarks(c);d.insertHtml(s.html());
a._running=false},0)}}}});r.Paste=m;var g=function(b,a){var d=b.document,j=new y(d.body),v=false,s=function(){v=true};j.on(a,s);(z.ie>7?d:d.selection.createRange()).execCommand(a);j.detach(a,s);return v},f=z.ie?function(b,a){return g(b,a)}:function(b,a){try{return b.document.execCommand(a)}catch(d){return false}},k={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},e=function(b){this.type=
b;this.canUndo=this.type=="cut"};e.prototype={exec:function(b){this.type=="cut"&&h(b);(b=f(b,this.type))||alert(k[this.type]);return b}};var i=r.Selection,p={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};r.on("contextmenu",function(b){var a=b.contextmenu,d=a.cfg.editor,j=a.el.originalEl,v={copy:0,cut:0,paste:0},s;for(s in v){if(!v.hasOwnProperty(s))break;v[s]=j.one(".ke-paste-"+s);(function(c){var n=v[c];if(!n){n=(new y("<a href='#'class='ke-paste-"+c+"'>"+p[c]+"</a>")).appendTo(j);n.on("click",function(q){q.halt();
if(!n.hasClass("ke-menuitem-disable")){a.hide();setTimeout(function(){d.execCommand(c)},30)}})}v[c]=n})(s);b=v[s];(d.document.queryCommandEnabled(s)?true:false)?b.removeClass("ke-menuitem-disable"):b.addClass("ke-menuitem-disable")}})}();x.addPlugin(function(){new r.Paste(x)})});
KISSY.Editor.add("colorsupport",function(){function x(a){return("0"+a).slice(a.length-1,a.length+1)}function r(a){a=z.trim(a);if(a.charAt(0)=="#")a=a.substring(1);a=a.replace(/\s+/g,"");var d="";if(/^[0-9a-f]{3,3}$/i.test(a))d=a.replace(/[0-9a-f]/ig,function(v){return v+v});else{var j=a.match(g);if(j&&j[0])for(a=1;a<4;a++)d+=x(parseInt(j[a]).toString(16));else d=a}return"#"+d.toLowerCase()}function w(a){w.superclass.constructor.call(this,a);this._init()}var y=KISSY.Editor,z=KISSY,B=z.Node,o=z.Event,
l=y.SimpleOverlay,m=y.TripleButton,h=z.DOM;if(!y.ColorSupport){for(var g=/^rgb\((\d+),(\d+),(\d+)\)$/i,f="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF".split(/,/),k=[],e="<div><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\"><span>\u6e05\u9664</span></a><table>",i=0;i<5;i++){e+="<tr>";
for(var p=0;p<8;p++){var b=r(f[8*i+p]);e+="<td>";e+="<a href='javascript:void(0);' class='ke-color-a'><span style='background-color:"+b+"'></span></a>";e+="</td>";k.push(b)}e+="</tr>"}e+="</table></div>";w.VALID_COLORS=k;w.ATTRS={editor:{},styles:{},contentCls:{},text:{}};z.extend(w,z.Base,{_init:function(){var a=this.get("editor"),d=new m({container:a.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});d.on("offClick",this._showColors,this);this.el=d;y.Utils.lazyRun(this,"_prepare",
"_real");y.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(a){var d=this,j=d.colorWin;if(j.get("visible"))h._4e_ascendant(a.target,function(v){return v._4e_equals(d.el.el)},true)||j.hide()},_selectColor:function(a){a.halt();var d=this.get("editor");a=a.target;if(h._4e_name(a)=="span"||h._4e_name(a)=="a"){a=new B(a);if(a._4e_name()=="a")a=a.one("span");var j=this.get("styles");d.fire("save");a._4e_style("background-color")?
j[r(a._4e_style("background-color"))].apply(d.document):j.inherit.remove(d.document);d.fire("save");this.colorWin.hide()}},_prepare:function(){var a=document,d=this.get("editor"),j=new B(e);this.colorWin=new l({el:j,width:"130px",zIndex:d.baseZIndex(990),mask:false,focusMgr:false});j._4e_unselectable();j.on("click",this._selectColor,this);this.colorPanel=j;o.on(a,"click",this._hidePanel,this);o.on(d.document,"click",this._hidePanel,this)},_real:function(){var a=this.el.el,d=this.colorPanel,j=a.offset();
j.top+=a.height()+5;if(j.left+d.width()>h.viewportWidth()-60)j.left=h.viewportWidth()-d.width()-60;this.colorWin.show(j)},_showColors:function(a){this._prepare(a)}});y.ColorSupport=w}});
KISSY.Editor.add("contextmenu",function(){function x(h){this.cfg=h;w.Utils.lazyRun(this,"_prepareShow","_realShow")}function r(h,g){for(var f=0;f<g.length;f++){var k=g[f];if(y.isFunction(k)){if(k(new z(h)))return true}else if(B.test(h,k))return true}return false}var w=KISSY.Editor,y=KISSY,z=y.Node,B=y.DOM,o=y.Event;if(!w.ContextMenu){x.ATTRS={editor:{}};var l=[];x.register=function(h){var g=new x(h),f=h.editor.document;l.push({doc:f,rules:h.rules||[],instance:g});if(!f.ke_contextmenu){f.ke_contextmenu=
1;o.on(f,"mousedown",x.hide);o.on(f,"contextmenu",function(k){x.hide.call(this);for(var e=new z(k.target);e;){var i=false;if(e._4e_name()=="body")break;for(var p=0;p<l.length;p++){var b=l[p].instance,a=l[p].rules;if(f===l[p].doc&&r(e[0],a)){k.preventDefault();i=true;setTimeout(function(){b.show(w.Utils.getXY(k.pageX,k.pageY,f,document))},30);break}}if(i)break;e=e.parent()}})}return g};x.hide=function(){for(var h=0;h<l.length;h++){var g=l[h].instance;this===l[h].doc&&g.hide()}};var m=w.SimpleOverlay;
y.augment(x,{_init:function(){var h=this,g=h.cfg,f=g.funcs;h.elDom=new z("<div onmousedown='return false;'>");var k=h.elDom;h.el=new m({el:k,width:g.width,cls:"ke-menu"});for(var e in f){g=new z("<a href='#'>"+e+"</a>");k[0].appendChild(g[0]);(function(i,p){i._4e_unselectable();i.on("click",function(b){h.hide();b.halt();setTimeout(p,30)})})(g,f[e])}},hide:function(){this.el&&this.el.hide()},_realShow:function(h){w.fire("contextmenu",{contextmenu:this});this.el.show(h)},_prepareShow:function(){this._init()},
show:function(h){this._prepareShow(h)}});w.ContextMenu=x}});
KISSY.Editor.add("dd",function(x){function r(){r.superclass.constructor.apply(this,arguments);this._init()}function w(){w.superclass.constructor.apply(this,arguments);this._init()}function y(){y.superclass.constructor.apply(this,arguments)}var z=KISSY,B=z.Editor,o=z.Event,l=z.UA,m=z.DOM,h=z.Node;if(!B.DD){B.DD={};r.ATTRS={timeThred:{value:0},activeDrag:{},drags:{value:{}}};z.extend(r,z.Base,{_init:function(){B.Utils.lazyRun(this,"_prepare","_real")},reg:function(f){var k=this.get("drags");if(!f[0].id)f[0].id=
z.guid("drag-");k[f[0].id]=f;this._prepare()},_move:function(f){var k=this.get("activeDrag");k&&k._move(f)},_start:function(f){var k=this,e=k.get("timeThred")||0;if(e)k._timeThredTimer=setTimeout(function(){k._bufferStart(f)},e);else k._bufferStart(f)},_bufferStart:function(f){this.set("activeDrag",f);this._pg.css({display:"",height:m.docHeight()});f.fire("start")},_end:function(f){var k=this.get("activeDrag");if(this._timeThredTimer){clearTimeout(this._timeThredTimer);this._timeThredTimer=null}if(k){k._end(f);
this.set("activeDrag",null);this._pg.css({display:"none"})}},_prepare:function(){this._pg=(new h("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:"+x.baseZIndex(9999)+";'></div>")).appendTo(document.body);this._pg.css("opacity",0);o.on(document,"mousemove",B.Utils.throttle(this._move,this,10));o.on(document,"mouseup",this._end,this)},_real:function(){}});B.DD.DDM=new r;var g=B.DD.DDM;w.ATTRS={node:{},handlers:{value:{}}};z.extend(w,z.Base,{_init:function(){var f=
this.get("node"),k=this.get("handlers");g.reg(f);if(z.isEmptyObject(k))k[f[0].id]=f;for(var e in k)if(k.hasOwnProperty(e)){var i=k[e],p=i.css("cursor");if(!i._4e_equals(f)){if(!p||p==="auto")i.css("cursor","move");i._4e_unselectable()}}f.on("mousedown",this._handleMouseDown,this);f.on("mouseup",g._end,g)},_check:function(f){var k=this.get("handlers"),e;for(e in k)if(k.hasOwnProperty(e))if(k[e]._4e_contains(f)||k[e]._4e_equals(f))return true;return false},_handleMouseDown:function(f){if(this._check(new h(f.target))){l.webkit||
f.halt();g._start(this);var k=this.get("node"),e=f.pageX;f=f.pageY;k=k.offset();this.startMousePos={left:e,top:f};this.startNodePos=k;this._diff={left:e-k.left,top:f-k.top}}},_move:function(f){this.fire("move",f)},_end:function(){}});z.extend(y,w,{_init:function(){y.superclass._init.apply(this,arguments);var f=this.get("node"),k=this;k.on("move",function(e){f.offset({left:e.pageX-k._diff.left,top:e.pageY-k._diff.top})})}});B.Draggable=w;B.Drag=y}});
KISSY.Editor.add("draft",function(x){var r=KISSY,w=r.Editor;w.Draft||function(){function y(g,f,k){for(g+="";g.length<f;)g=k+g;return g}function z(g){if(r.isNumber(g))g=new Date(g);return g instanceof Date?[g.getFullYear(),"-",y(g.getMonth()+1,2,"0"),"-",y(g.getDate(),2,"0")," ",y(g.getHours(),2,"0"),":",y(g.getMinutes(),2,"0"),":",y(g.getSeconds(),2,"0")].join(""):g}function B(g){this.editor=g;this._init()}var o=r.Node,l=r.Event,m=r.JSON,h=window[w.STORE];r.augment(B,{_init:function(){var g=this,
f=g.editor,k=f.statusDiv,e=f.cfg.pluginConfig;e.draft=e.draft||{};g.draftInterval=e.draft.interval=e.draft.interval||5;g.draftLimit=e.draft.limit=e.draft.limit||5;k=(new o("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+e.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(k);g.timeTip=(new o("<span class='ke-draft-time'>")).appendTo(k);var i=(new o("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(k);
f=new w.Select({container:k,menuContainer:document.body,doc:f.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});var p=h.getItem("ke-draft-save"),b=[];g.versions=f;if(p)b=r.isString(p)?m.parse(decodeURIComponent(p)):p;g.drafts=b;g.sync();i.on("click",function(){g.save(false)});setInterval(function(){g.save(true)},g.draftInterval*60*1E3);f.on("click",g.recover,g);g.holder=k;if(e.draft.helpHtml){e=new w.TripleButton({cls:"ke-draft-help",title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:k});e.on("click",
function(){g._prepareHelp()});w.Utils.lazyRun(g,"_prepareHelp","_realHelp");g.helpBtn=e.el}g._holder=k},_prepareHelp:function(){var g=this,f=g.editor,k=g.helpBtn,e=(new o(f.cfg.pluginConfig.draft.helpHtml||"")).appendTo(document.body),i=new o("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
e.append(i);e.css({border:"1px solid #ACB4BE","text-align":"left"});g._help=new w.SimpleOverlay({el:e,focusMgr:false,draggable:false,width:e.width()+"px",mask:false});g._help.el.css("border","none");g._help.arrow=i;l.on([document,f.document],"click",function(p){p=p.target;p==k[0]||k._4e_contains(p)||g._help.hide()})},_realHelp:function(){var g=this._help,f=this.helpBtn,k=g.arrow;g.show();f=f.offset();g.el.offset({left:f.left-g.el.width()+17,top:f.top-g.el.height()-7});k.offset({left:f.left-2,top:f.top-
8})},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var g=this.draftLimit,f=this.timeTip,k=this.versions,e=this.drafts;e.length>g&&e.splice(0,e.length-g);g=[];for(var i,p=0;p<e.length;p++){i=e[p];i=(i.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+z(i.date);g.push({name:i,value:p})}k.set("items",g.reverse());f.html(i);h.setItem("ke-draft-save",encodeURIComponent(m.stringify(e)))},save:function(g){var f=this.drafts,k=x.getData(true);if(f[f.length-
1]&&k==f[f.length-1].content)f.length-=1;this.drafts=f.concat({content:k,date:(new Date).getTime(),auto:g});this.sync()},recover:function(g){var f=this.editor,k=this.drafts;g=g.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+z(k[g].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){f.fire("save");f.setData(k[g].content);f.fire("save")}}});w.Draft=B}();x.addPlugin(function(){w.storeReady(function(){new w.Draft(x)})})});
KISSY.Editor.add("elementpaths",function(x){var r=KISSY.Editor,w=KISSY,y=w.Node,z=w.DOM;r.ElementPaths||function(){function B(o){this.cfg=o;this._cache=[];this._init()}z.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");w.augment(B,{_init:function(){var o=this.cfg.editor;this.holder=new y("<span>");this.holder.appendTo(o.statusDiv);o.on("selectionChange",this._selectionChange,this);
r.Utils.sourceDisable(o,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(o){var l=this.cfg.editor,m=this.holder;m=m[0]||m;o=o.path.elements;var h,g;h=this._cache;for(g=0;g<h.length;g++){h[g].detach("click");h[g]._4e_remove()}this._cache=[];for(g=0;g<o.length;g++){h=o[g];var f=new y("<a href='#' class='elementpath'>"+(h.attr("_ke_real_element_type")||h._4e_name())+"</a>");this._cache.push(f);(function(k){f.on("click",
function(e){e.halt();l.focus();setTimeout(function(){l.getSelection().selectElement(k)},50)})})(h);m.firstChild?z.insertBefore(f[0],m.firstChild):m.appendChild(f[0])}}});r.ElementPaths=B}();x.addPlugin(function(){new r.ElementPaths({editor:x})})});
KISSY.Editor.add("enterkey",function(x){var r=KISSY.Editor,w=KISSY,y=w.UA,z=/^h[1-6]$/,B=r.XHTML_DTD,o=w.Node,l=w.Event,m=r.Walker,h=r.ElementPath;r.enterBlock||function(){function g(f){l.on(f.document,"keydown",function(k){if(k.keyCode===13)if(!k.shiftKey){f.fire("save");var e=f.execCommand("enterBlock");f.fire("save");e!==false&&k.preventDefault()}})}g.enterBlock=function(f){var k;k=f.getSelection().getRanges();for(var e=k.length-1;e>0;e--)k[e].deleteContents();k=k[0];e=k.document;if(k.checkStartOfBlock()&&
k.checkEndOfBlock()){var i=(new h(k.startContainer)).block;if(i&&(i._4e_name()=="li"||i.parent()._4e_name()=="li"))if(f.hasCommand("outdent")){f.fire("save");f.execCommand("outdent");f.fire("save");return}else return false}var p=k.splitBlock("p");if(p){f=p.previousBlock;i=p.nextBlock;var b=p.wasStartOfBlock,a=p.wasEndOfBlock,d;if(i){d=i.parent();if(d._4e_name()=="li"){i._4e_breakParent(d);i._4e_move(i._4e_next(),true)}}else if(f&&(d=f.parent())&&d._4e_name()=="li"){f._4e_breakParent(d);k.moveToElementEditablePosition(f._4e_next());
f._4e_move(f._4e_previous())}if(!b&&!a){if(i._4e_name()=="li"&&(d=i._4e_first(m.invisible(true)))&&w.inArray(d._4e_name(),["ul","ol"]))(y.ie?new o(e.createTextNode("\u00a0")):new o(e.createElement("br"))).insertBefore(d);i&&k.moveToElementEditablePosition(i)}else{var j;if(f){if(f._4e_name()=="li"||!z.test(f._4e_name()))j=f._4e_clone()}else if(i)j=i._4e_clone();j||(j=new o("<p>",null,e));if(d=p.elementPath){p=0;for(var v=d.elements.length;p<v;p++){var s=d.elements[p];if(s._4e_equals(d.block)||s._4e_equals(d.blockLimit))break;
if(B.$removeEmpty[s._4e_name()]){s=s._4e_clone();j._4e_moveChildren(s);j.append(s)}}}y.ie||j._4e_appendBogus();k.insertNode(j);if(y.ie&&b&&(!a||!f[0].childNodes.length)){k.moveToElementEditablePosition(a?f:j);k.select()}k.moveToElementEditablePosition(b&&!a?i:j)}if(!y.ie)if(i){j=new o(e.createElement("span"));j.html("&nbsp;");k.insertNode(j);j._4e_scrollIntoView();k.deleteContents()}else j._4e_scrollIntoView();k.select()}};r.EnterKey=g}();x.addPlugin(function(){x.addCommand("enterBlock",{exec:r.EnterKey.enterBlock});
r.EnterKey(x)})});
KISSY.Editor.add("fakeobjects",function(x){var r=KISSY.Editor,w=KISSY,y=w.Node,z=r.NODE,B=r.Config.base+"theme/spacer.gif",o=r.HtmlParser;r=w.Editor;var l=(x=x.htmlDataProcessor)&&x.htmlFilter,m={elements:{$:function(h){var g=h.attributes;if((g=(g=(g=g&&g._ke_realelement)&&new o.Fragment.FromHtml(decodeURIComponent(g)))&&g.children[0])&&h.attributes._ke_resizable){var f=h.attributes.style;if(f){var k=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f);h=k&&k[1];f=(k=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&k[1];
if(h)g.attributes.width=h;if(f)g.attributes.height=f}}return g}}};l&&l.addRules(m);x&&w.mix(x,{createFakeParserElement:function(h,g,f,k,e){var i;i=new o.BasicWriter;h.writeHtml(i);i=i.getHtml();var p=h.attributes.style;if(h.attributes.width)p="width:"+h.attributes.width+"px;"+p;if(h.attributes.height)p="height:"+h.attributes.height+"px;"+p;h={"class":g,src:B,_ke_realelement:encodeURIComponent(i),_ke_real_node_type:h.type,style:p,align:h.attributes.align||""};e&&delete e.width;e&&delete e.height;e&&
w.mix(h,e,false);if(f)h._ke_real_element_type=f;if(k)h._ke_resizable=k;return new o.Element("img",h)}});w.augment(r,{createFakeElement:function(h,g,f,k,e,i){var p=h.attr("style")||"";if(h.attr("width"))p="width:"+h.attr("width")+"px;"+p;if(h.attr("height"))p="height:"+h.attr("height")+"px;"+p;h={"class":g,src:B,_ke_realelement:encodeURIComponent(e||h._4e_outerHtml()),_ke_real_node_type:h[0].nodeType,style:p};i&&delete i.width;i&&delete i.height;i&&w.mix(h,i,false);if(f)h._ke_real_element_type=f;if(k)h._ke_resizable=
k;return new y("<img/>",h,this.document)},restoreRealElement:function(h){if(h.attr("_ke_real_node_type")!=z.NODE_ELEMENT)return null;h=decodeURIComponent(h.attr("_ke_realelement"));var g=new y("<div>",null,this.document);g.html(h);return g._4e_first(function(f){return f[0].nodeType==z.NODE_ELEMENT})._4e_remove()}})});KISSY.Editor.add("flash",function(x){x.addPlugin(function(){new KISSY.Editor.Flash(x)})});
KISSY.Editor.add("flash/support",function(x){var r=KISSY.Editor,w=KISSY,y=w.UA,z=w.Event,B=r.ContextMenu,o=w.Node,l=r.BubbleView,m=r.TripleButton,h=x.htmlDataProcessor,g="ke_flash",f=r.Utils.flash;x=h&&h.dataFilter;r.Flash||function(){function k(b){this.editor=b;this._init()}function e(b){return b._4e_name()==="img"&&!!b.hasClass(g)&&b}var i=/\.swf(?:$|\?)/i;k.isFlashEmbed=function(b){b=b.attributes;return b.type=="application/x-shockwave-flash"||i.test(b.src||"")};w.augment(k,{_config:function(){this._cls=
g;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=p;this._flashRules=["img."+g]},_init:function(){this._config();var b=this.editor,a={},d=this._contextMenu;b._toolbars=b._toolbars||{};b._toolbars[this._type]=this;this.el=new m({container:b.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("offClick",this.show,this);if(d)for(var j in d)(function(v){a[v]=function(){d[v](b)}})(j);B.register({editor:b,rules:this._flashRules,width:"120px",
funcs:a});l.attach({pluginName:this._type,pluginInstance:this});z.on(b.document,"dblclick",this._dbclick,this);r.Utils.sourceDisable(b,this)},disable:function(){this.el.set("state",m.DISABLED)},enable:function(){this.el.set("state",m.OFF)},_getFlashUrl:function(b){return f.getUrl(b)},_updateTip:function(b,a){var d=this.editor.restoreRealElement(a);if(d){d=this._getFlashUrl(d);b.html(d);b.attr("href",d)}},_dbclick:function(b){var a=new o(b.target);if(a._4e_name()==="img"&&a.hasClass(this._cls)){this.show(null,
a);b.halt()}},show:function(b,a){this.editor.useDialog(this._type+"/dialog",function(d){d.show(a)},{mask:true})}});r.Flash=k;k.registerBubble=function(b,a,d){l.register({pluginName:b,func:d,init:function(){var j=this,v=j.el;v.html(a+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var s=v.one(".ke-bubbleview-url"),c=v.one(".ke-bubbleview-change");v=v.one(".ke-bubbleview-remove");
c._4e_unselectable();s._4e_unselectable();v._4e_unselectable();c.on("click",function(n){j._plugin.show(null,j._selectedEl);n.halt()});v.on("click",function(n){var q=j._plugin;if(y.webkit){var u=q.editor.getSelection().getRanges();u&&u[0]&&(u[0].collapse(true)||1)&&u[0].select()}j._selectedEl._4e_remove();j.hide();q.editor.notifySelectionChange();n.halt()});j.on("beforeVisibleChange",function(n){var q=j._selectedEl;n.newVal&&q&&j._plugin._updateTip(s,q)})}})};k.registerBubble("flash","Flash \u7f51\u5740\uff1a ",
e);k.checkFlash=e;var p={"Flash\u5c5e\u6027":function(b){var a=b.getSelection();a=a&&a.getStartElement();a=e(a);b=b._toolbars.flash;a&&b.show(null,a)}};k.CLS_FLASH=g;k.TYPE_FLASH="flash"}();x&&x.addRules({elements:{object:function(k){var e=k.attributes;if(!(e.classid&&String(e.classid).toLowerCase())){for(e=0;e<k.children.length;e++)if(k.children[e].name=="embed"){if(!r.Flash.isFlashEmbed(k.children[e]))break;return h.createFakeParserElement(k,g,"flash",true)}return null}return h.createFakeParserElement(k,
g,"flash",true)},embed:function(k){if(!r.Flash.isFlashEmbed(k))return null;return h.createFakeParserElement(k,g,"flash",true)}}},5)});
KISSY.Editor.add("flashbridge",function(){function x(g){this._init(g)}function r(g){var f=y.isString(g)?g.match(/(\d)+/g):g;g=g;if(y.isArray(f))g=parseFloat(f[0]+"."+w(f[1],3)+w(f[2],5));return g||0}function w(g,f){for(var k=(g+"").length;k++<f;)g="0"+g;return g}var y=KISSY,z=y.Editor;if(!z.FlashBridge){var B={};y.augment(x,y.EventTarget,{_init:function(g){var f=y.guid("flashbridge-");g.flashVars=g.flashVars||{};g.attrs=g.attrs||{};g.params=g.params||{};var k=g.flashVars,e=g.params;y.mix(g.attrs,
{id:f,width:"100%",height:"100%"},false);y.mix(e,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);y.mix(k,{shareData:false,useCompression:false},false);e={YUISwfId:f,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(g.ajbridge)e={swfID:f,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};y.mix(k,e);B[f]=this;this.id=f;this.swf=z.Utils.flash.createSWFRuntime(g.movie,g);this._expose(g.methods)},_expose:function(g){for(var f=this,k=0;k<g.length;k++)(function(e){f[e]=
function(){return f._callSWF(e,y.makeArray(arguments))}})(g[k])},_callSWF:function(g,f){f=f||[];try{if(this.swf[g])return this.swf[g].apply(this.swf,f)}catch(k){var e="";if(f.length!==0)e="'"+f.join("', '")+"'";return(new Function("self","return self.swf."+g+"("+e+");"))(this)}},_eventHandler:function(g){var f=g.type;if(f==="log")y.log(g.message);else f&&this.fire(f,g)},_destroy:function(){delete B[this.id]}});x.EventHandler=function(g,f){var k=B[g];k&&setTimeout(function(){k._eventHandler.call(k,
f)},100)};z.FlashBridge=x;var o=y.UA,l,m,h=true;o.fpv=function(g){if(g||h){h=false;var f;if(navigator.plugins&&navigator.mimeTypes.length)f=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{f=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(k){}l=f?f.match(/(\d)+/g):void 0;m=r(l)}return l};o.fpvGEQ=function(g,f){h&&o.fpv(f);return!!m&&m>=r(g)}}});
KISSY.Editor.add("flashutils",function(){var x=KISSY,r=x.Editor,w=r.Utils.flash;if(!w){var y=x.DOM,z=x.Node,B=x.UA;w={getUrl:function(o){var l="",m=r.NODE;if(o._4e_name()=="object"){o=o[0].childNodes;for(var h=0;h<o.length;h++)if(o[h].nodeType==m.NODE_ELEMENT)if((y.attr(o[h],"name")||"").toLowerCase()=="movie")l=y.attr(o[h],"value");else if(y._4e_name(o[h])=="embed")l=y.attr(o[h],"src");else if(y._4e_name(o[h])=="object")l=y.attr(o[h],"data")}else if(o._4e_name()=="embed")l=o.attr("src");return l},
createSWF:function(o,l,m){var h=l.attrs||{},g=l.flashVars,f="",k="";l=l.params||{};var e="";m=m||document;x.mix(h,{wmode:"transparent"});for(var i in h)if(h.hasOwnProperty(i))f+=i+"='"+h[i]+"' ";x.mix(l,{quality:"high",movie:o,wmode:"transparent"});for(var p in l)if(l.hasOwnProperty(p))k+="<param name='"+p+"' value='"+l[p]+"'/>";if(g){for(var b in g)if(g.hasOwnProperty(b))e+="&"+b+"="+encodeURIComponent(g[b]);e=e.substring(1)}o="<object "+f+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
k+(e?'<param name="flashVars" value="'+e+'"/>':"")+"<embed "+f+" "+(e?'FlashVars="'+e+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+o+'"  type="application/x-shockwave-flash"/></object>';return{el:new z(o,null,m),html:o}},createSWFRuntime2:function(o,l,m){m=m||document;var h=(new z("<div style='width:0;height:0;overflow:hidden;'>",null,m)).appendTo(m.body);h=w.createSWF.apply(this,arguments).el.appendTo(h);B.ie||(h=h.one("object"));return h[0]},createSWFRuntime:function(o,
l,m){var h=l.attrs||{},g=l.flashVars||{},f=l.params||{},k="",e="",i="";m=m||document;h.id=h.id||x.guid("ke-runtimeflash-");for(var p in h)if(h.hasOwnProperty(p))k+=p+"='"+h[p]+"' ";for(var b in f)if(f.hasOwnProperty(b))e+="<param name='"+b+"' value='"+f[b]+"'/>";for(var a in g)if(g.hasOwnProperty(a))i+="&"+a+"="+encodeURIComponent(g[a]);i=i.substring(1);o=B.ie?"<object "+k+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+e+'<param name="movie" value="'+o+'" />'+(i?'<param name="flashVars" value="'+
i+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+o+"' "+k+">"+e+(i?'<param name="flashVars" value="'+i+'"/>':"")+"</object>";var d=l.holder;if(!d){d=(new z("<div style='"+(l.style?l.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,m)).appendTo(m.body);setTimeout(function(){d.offset({left:y.scrollLeft(),top:y.scrollTop()})},100)}d.html(o);return m.getElementById(h.id)}};r.Utils.flash=w}});
KISSY.Editor.add("font",function(x){var r=KISSY.Editor,w=KISSY,y=r.Style,z=r.TripleButton,B=w.Node,o=x.cfg.pluginConfig["font-size"]||{};w.mix(o,{items:function(d){for(var j=[],v=0;v<d.length;v++)j.push({name:d[v],value:d[v]});return j}(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px","108px"]),width:"55px"},false);var l={},m=[],h={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]},g=x.cfg.pluginConfig["font-family"]||
{};w.mix(g,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var f={},k=[],e={element:"span",styles:{"font-family":"#(family)"},
overrides:[{element:"font",attributes:{face:null}}]},i;x.cfg.pluginConfig["font-size"]=o;x.cfg.pluginConfig["font-family"]=g;for(i=0;i<o.items.length;i++){var p=o.items[i],b=p.name,a=p.attrs;p=p.value;l[p]=new y(h,{size:p});m.push({name:b,value:p,attrs:a})}for(i=0;i<g.items.length;i++){p=g.items[i];b=p.name;a=p.attrs||{};h=p.value;a.style=a.style||"";a.style+=";font-family:"+h;f[h]=new y(e,{family:h});k.push({name:b,value:h,attrs:a})}r.Font||function(){function d(s){d.superclass.constructor.call(this,
s);this._init()}function j(s){j.superclass.constructor.call(this,s);this._init()}d.ATTRS={title:{},html:{},styles:{},editor:{}};var v=r.Select;w.extend(d,w.Base,{_init:function(){var s=this.get("editor"),c=s.toolBarDiv;this.get("html");this.el=new v({container:c,doc:s.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new B(document.body)});this.el.on("click",this._vChange,this);s.on("selectionChange",
this._selectionChange,this);r.Utils.sourceDisable(s,this)},disable:function(){this.el.set("state",v.DISABLED)},enable:function(){this.el.set("state",v.ENABLED)},_vChange:function(s){var c=this.get("editor"),n=s.newVal;s=s.prevVal;var q=this.get("styles");c.focus();c.fire("save");if(n==s){q[n].remove(c.document);this.el.set("value","")}else q[n].apply(c.document);c.fire("save")},_selectionChange:function(s){this.get("editor");s=s.path.elements;for(var c=this.get("styles"),n=0,q;n<s.length;n++){q=s[n];
for(var u in c)if(c[u].checkElementRemovable(q,true)){this.el.set("value",u);return}}this.el.reset("value")}});j.ATTRS={editor:{},text:{},contentCls:{},title:{},style:{}};w.extend(j,w.Base,{_init:function(){var s=this.get("editor"),c=this.get("text");this.get("style");var n=this.get("title");this.el=new z({text:c,title:n,contentCls:this.get("contentCls"),container:s.toolBarDiv});this.el.on("offClick",this._on,this);this.el.on("onClick",this._off,this);s.on("selectionChange",this._selectionChange,
this);r.Utils.sourceDisable(s,this)},disable:function(){this.el.set("state",z.DISABLED)},enable:function(){this.el.set("state",z.OFF)},_on:function(){var s=this.get("editor");this.get("text");var c=this.get("style");this.get("title");s.fire("save");c.apply(s.document);s.fire("save");s.notifySelectionChange();s.focus()},_off:function(){var s=this.get("editor");this.get("text");var c=this.get("style");this.get("title");s.fire("save");c.remove(s.document);s.fire("save");s.notifySelectionChange();s.focus()},
_selectionChange:function(s){this.get("editor");this.get("text");var c=this.get("style");this.get("title");var n=this.el;s=s.path;if(n.get("state")!=z.DISABLED)c.checkActive(s)?n.set("state",z.ON):n.set("state",z.OFF)}});d.SingleFont=j;r.Font=d}();x.addPlugin(function(){new r.Font({editor:x,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:o.width,styles:l,html:m});new r.Font({editor:x,title:"\u5b57\u4f53",width:"110px",popUpWidth:g.width,styles:f,html:k});new r.Font.SingleFont({contentCls:"ke-toolbar-bold",
title:"\u7c97\u4f53 ",editor:x,style:new y({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})});new r.Font.SingleFont({contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 ",editor:x,style:new y({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})});new r.Font.SingleFont({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",editor:x,style:new y({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})});
new r.Font.SingleFont({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",editor:x,style:new y({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})})})});
KISSY.Editor.add("forecolor",function(x){var r=KISSY.Editor,w=r.ColorSupport,y=w.VALID_COLORS,z={},B={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]};z.inherit=new r.Style(B,{color:"inherit"});for(var o=0;o<y.length;o++){var l=y[o];z[l]=new r.Style(B,{color:l})}x.addPlugin(function(){new w({editor:x,styles:z,title:"\u6587\u672c\u989c\u8272",contentCls:"ke-toolbar-color",text:"color"})})});
KISSY.Editor.add("format",function(x){var r=KISSY.Editor,w=KISSY,y=w.Node,z=[],B={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},o={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},l={},m=r.Style,h;for(h in B)if(B[h]){l[B[h]]=new m({element:B[h]});z.push({name:h,value:B[h],attrs:{style:"font-size:"+o[B[h]]}})}r.Format||function(){function g(k){g.superclass.constructor.call(this,k);this._init()}g.ATTRS={editor:{}};var f=r.Select;w.extend(g,w.Base,
{_init:function(){var k=this.get("editor");this.el=new f({container:k.toolBarDiv,value:"",doc:k.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new y(document.body)});this.el.on("click",this._vChange,this);k.on("selectionChange",this._selectionChange,this);r.Utils.sourceDisable(k,this)},disable:function(){this.el.set("state",f.DISABLED)},enable:function(){this.el.set("state",f.ENABLED)},_vChange:function(k){var e=this.get("editor"),
i=k.newVal;k=k.prevVal;e.fire("save");if(i!=k)l[i].apply(e.document);else{l.p.apply(e.document);this.el.set("value","p")}e.fire("save")},_selectionChange:function(k){this.get("editor");k=k.path;for(var e in l)if(l[e].checkActive(k)){this.el.set("value",e);return}this.el.reset("value")}});r.Format=g}();x.addPlugin(function(){new r.Format({editor:x,html:z,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(x){function r(c){if(/mso-list\s*:\s*Ignore/i.test(c.attributes&&c.attributes.style))return true;return o}function w(c,n){var q=new l.HtmlParser.Element("ke:listbullet"),u;if(c)if(c[2]){c=isNaN(c[1])?/^[a-z]+$/.test(c[1])?"lower-alpha":/^[A-Z]+$/.test(c[1])?"upper-alpha":"decimal":"decimal";u="ol"}else{c=/[l\u00B7\u2002]/.test(c[1])?"disc":/[\u006F\u00D8]/.test(c[1])?"circle":/[\u006E\u25C6]/.test(c[1])?"square":"disc";u="ul"}else{c="decimal";u="ol"}q.attributes=
{"ke:listtype":u,style:"list-style-type:"+c+";"};q.add(new l.HtmlParser.Text(n));return q}function y(c){var n=c.attributes,q;if((q=c.removeAnyChildWithName("ke:listbullet"))&&q.length&&(q=q[0])){c.name="ke:li";if(n.style)n.style=z([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(u){u=u.split(" ");u=u[3]||u[1]||u[0];u=parseInt(u,10);if(!a&&d&&u>d)a=u-d;n["ke:margin"]=d=u}]],o)(n.style,c)||"";q=q.attributes;c.addStyle(q.style);m.mix(n,q);return true}return false}function z(c,n){return function(q,
u){var A=[];q.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(C,E,F){E=E.toLowerCase();E=="font-family"&&(F=F.replace(/["']/g,""));for(var H,K,M,D=0;D<c.length;D++)if(c[D]){C=c[D][0];H=c[D][1];K=c[D][2];M=c[D][3];if(E.match(C)&&(!H||F.match(H))){E=M||E;n&&(K=K||F);if(typeof K=="function")K=K(F,u,E);if(K&&K.push){E=K[0];K=K[1]}typeof K=="string"&&A.push([E,K]);return}}!n&&A.push([E,F])});for(var t=0;t<A.length;t++)A[t]=A[t].join(":");return A.length?A.join(";")+";":
false}}function B(c){c=c.children;for(var n,q,u,A,t,C,E,F=0;F<c.length;F++){n=c[F];if("ke:li"==n.name){n.name="li";n=n;q=n.attributes;u=n.attributes["ke:listtype"];A=parseInt(q["ke:indent"],10)||a&&Math.ceil(q["ke:margin"]/a)||1;q.style&&(q.style=z([["list-style-type",u=="ol"?"decimal":"disc"]],o)(q.style)||"");if(C){if(A>E){C=new l.HtmlParser.Element(u);C.add(n);t.add(C)}else{if(A<E){t=E-A;for(var H;t--&&(H=C.parent);)C=H.parent}C.add(n)}c.splice(F--,1)}else{C=new l.HtmlParser.Element(u);C.add(n);
c[F]=C}t=n;E=A}else C=null}a=0}var o=o,l=KISSY.Editor,m=KISSY,h=m.UA,g=l.NODE,f=l.HtmlParser,k=new f.Filter,e=new f.Filter,i=l.XHTML_DTD;if(!x.htmlDataProcessor){(function(){var c=l.HtmlParser.Fragment.prototype,n=l.HtmlParser.Element.prototype;c.onlyChild=n.onlyChild=function(){var q=this.children;return q.length==1&&q[0]||null};n.removeAnyChildWithName=function(q){for(var u=this.children,A=[],t,C=0;C<u.length;C++){t=u[C];if(t.name){if(t.name==q){A.push(t);u.splice(C--,1)}A=A.concat(t.removeAnyChildWithName(q))}}return A};
n.getAncestor=function(q){for(var u=this.parent;u&&!(u.name&&u.name.match(q));)u=u.parent;return u};c.firstChild=n.firstChild=function(q){for(var u,A=0;A<this.children.length;A++){u=this.children[A];if(q(u))return u;else if(u.name)if(u=u.firstChild(q))return u}return null};n.addStyle=function(q,u,A){var t="";if(typeof u=="string")t+=q+":"+u+";";else{if(typeof q=="object")for(var C in q){if(q.hasOwnProperty(C))t+=C+":"+q[C]+";"}else t+=q;A=u}if(!this.attributes)this.attributes={};q=this.attributes.style||
"";q=(A?[t,q]:[q,t]).join(";");this.attributes.style=q.replace(/^;|;(?=;)/,"")};i.parentOf=function(q){var u={},A;for(A in this)if(A.indexOf("$")==-1&&this[A][q])u[A]=1;return u}})();var p=l.Utils.equalsIgnoreCase,b=z([[/mso/i],[/font-size/i,"",function(c){for(var n=x.cfg.pluginConfig["font-size"].items,q=0;q<n.length;q++)if(p(c,n[q].value))return c;return false},"font-size"],[/font-family/i,"",function(c){for(var n=x.cfg.pluginConfig["font-family"].items,q=0;q<n.length;q++){var u=n[q].value.toLowerCase();
if(p(c,u)||p(c,n[q].name))return u}return false},"font-family"],[/line-height/i],[/display/i,/none/i]],o),a,d=0,j=i.parentOf("ol"),v={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(c){c.filterChildren();B(c)},elements:{font:function(c){delete c.name},p:function(c){c.filterChildren();if(y(c))return o},$:function(c){var n=c.name||"";n.indexOf(":")!=-1&&n.indexOf("ke")==-1&&delete c.name;var q=c.attributes.style;
if(n=="span"&&(!q||!b(q)))delete c.name;if(n in j){c.filterChildren();B(c)}},td:function(c){delete c.attributes.style},span:function(c){if(!h.gecko&&r(c.parent))return false;if(!h.gecko&&r(c)){c=(c=c.firstChild(function(q){return q.value||q.name=="img"}))&&(c.value||"l.");var n=c.match(/^([^\s]+?)([.)]?)$/);return w(n,c)}},a:function(c){c=c.attributes;if(c.href)c._ke_saved_href=c.href}},comment:!h.ie?function(c,n){var q=c.match(/<img.*?>/),u=c.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(u){u=
(q=u[1]||q&&"l.")&&q.match(/>([^\s]+?)([.)]?)</);return w(u,q)}if(h.gecko&&q){q=l.HtmlParser.Fragment.FromHtml(q[0]).children[0];(u=(u=(u=n.previous)&&u.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&u[1])&&(q.attributes.src=u);return q}return false}:function(){return false},attributes:{"class":function(c){if(/(^|\s+)ke_/.test(c))return c;return false},style:function(c){c=b(c);if(!c)return false;return c}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},s={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,
""]],elements:{embed:function(c){var n=c.parent;if(n&&n.name=="object"){var q=n.attributes.width;n=n.attributes.height;q&&(c.attributes.width=q);n&&(c.attributes.height=n)}},param:function(c){c.children=[];c.isEmpty=true;return c},a:function(c){if(!(c.children.length||c.attributes.name))return false;c=c.attributes;if(c._ke_saved_href)c.href=c._ke_saved_href},td:function(c){for(var n=c.children,q=0;q<n.length;q++)if(n[q].name=="br"){n.splice(q,1);--q}if(!c.children.length){n=new l.HtmlParser.Text("&nbsp;");
c.children.push(n)}},span:function(c){if(!c.children.length)return false}},attributes:{style:function(c){if(!m.trim(c))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(h.ie)s.attributes.style=function(c){return c.toLowerCase()};k.addRules(s);e.addRules(v);(function(){function c(K){for(var M=K.children.length,D=K.children[M-1];D&&D.type==g.NODE_TEXT&&!m.trim(D.value);)D=K.children[--M];return D}function n(K){var M=c(K);return!M||M.type==g.NODE_ELEMENT&&M.name=="br"||
K.name=="form"&&M.name=="input"}function q(K,M){var D=K.children,J=c(K);if(J){if((M||!h.ie)&&J.type==g.NODE_ELEMENT&&J.name=="br")D.pop();J.type==g.NODE_TEXT&&t.test(J.value)&&D.pop()}}function u(K){q(K,true);if(n(K))h.ie?K.add(new l.HtmlParser.Text("\u00a0")):K.add(new l.HtmlParser.Element("br",{}))}function A(K){q(K);n(K)&&K.add(new l.HtmlParser.Text("\u00a0"))}var t=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,C=l.XHTML_DTD,E=l.Utils.mix({},C.$block,C.$listItem,C.$tableContent),F;for(F in E)"br"in C[F]||delete E[F];delete E.pre;
C={elements:{}};var H={elements:{}};for(F in E){C.elements[F]=u;H.elements[F]=A}e.addRules(C);k.addRules(H)})();(function(){k.addRules({text:function(c){return c.replace(/&nbsp;/g,"\u00a0").replace(/\xa0/g,"&nbsp;")}})})();x.htmlDataProcessor={htmlFilter:k,dataFilter:e,toHtml:function(c,n){var q=new f.HtmlWriter;f.Fragment.FromHtml(c,n).writeHtml(q,k);return q.getHtml(true)},toDataFormat:function(c,n){if(h.gecko)c=c.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var q=new f.BasicWriter,
u=f.Fragment.FromHtml(c,n);q.reset();u.writeHtml(q,e);return q.getHtml(true)}}}});
KISSY.Editor.add("image",function(x){var r=KISSY.Editor,w=KISSY,y=w.UA,z=w.Node,B=w.Event,o=r.BubbleView;r.ImageInserter||function(){function l(f){l.superclass.constructor.call(this,f);this._init()}var m=function(f){return f._4e_name()==="img"&&!/(^|\s+)ke_/.test(f[0].className)&&f},h=r.TripleButton;l.ATTRS={editor:{}};var g={"\u56fe\u7247\u5c5e\u6027":function(f){var k=f.getSelection();k=k&&k.getStartElement();k=m(k);f=f._toolbars.image;k&&f.show(null,k)}};w.extend(l,w.Base,{_init:function(){var f=this.get("editor"),
k=f.toolBarDiv,e={};this.editor=f;this.el=new h({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",container:k});this.el.on("offClick",this.show,this);B.on(f.document,"dblclick",this._dblclick,this);r.Utils.lazyRun(this,"_prepare","_real");f._toolbars=f._toolbars||{};f._toolbars.image=this;if(g){for(var i in g)(function(p){e[p]=function(){g[p](f)}})(i);r.ContextMenu.register({editor:f,rules:[m],width:"120px",funcs:e})}o.attach({pluginName:"image",pluginInstance:this});r.Utils.sourceDisable(f,this)},disable:function(){this.el.disable()},
enable:function(){this.el.boff()},_dblclick:function(f){var k=new z(f.target);if(m(k)){this.show(null,k);f.halt()}},_updateTip:function(f,k){var e=k.attr("src");f.html(e);f.attr("href",e)},show:function(f,k){this.get("editor").useDialog("image/dialog",function(e){e.show(k)},{mask:true})}});r.ImageInserter=l;(function(f,k,e){o.register({pluginName:f,func:e,init:function(){var i=this,p=i.el;p.html(k+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var b=p.one(".ke-bubbleview-url"),a=p.one(".ke-bubbleview-change");p=p.one(".ke-bubbleview-remove");a._4e_unselectable();b._4e_unselectable();p._4e_unselectable();a.on("click",function(d){i._plugin.show(null,i._selectedEl);d.halt()});p.on("click",function(d){var j=i._plugin;if(y.webkit){var v=j.editor.getSelection().getRanges();v&&v[0]&&(v[0].collapse(true)||1)&&v[0].select()}i._selectedEl._4e_remove();i.hide();j.editor.notifySelectionChange();d.halt()});i.on("afterVisibleChange",function(d){var j=
i._selectedEl;d.newVal&&j&&i._plugin._updateTip(b,j)})}})})("image","\u56fe\u7247\u7f51\u5740\uff1a ",m)}();x.addPlugin(function(){new r.ImageInserter({editor:x})})});
KISSY.Editor.add("indent",function(x){var r=KISSY.Editor,w={ol:1,ul:1},y=KISSY,z=r.Walker,B=y.DOM,o=y.Node,l=y.UA,m=r.NODE;r.Indent||function(){function h(a){this.type=a;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function g(a){return a.type=CKEDITOR.NODE_ELEMENT&&a.is("li")}function f(a,d,j){var v=d.startContainer;for(a=d.endContainer;v&&!v.parent()._4e_equals(j);)v=v.parent();for(;a&&!a.parent()._4e_equals(j);)a=a.parent();if(v&&a){var s=v;v=[];for(var c=false;!c;){if(s._4e_equals(a))c=
true;v.push(s);s=s.next()}if(!(v.length<1)){s=j._4e_parents(true);for(a=0;a<s.length;a++)if(w[s[a]._4e_name()]){j=s[a];break}s=this.type=="indent"?1:-1;a=v[0];c=v[v.length-1];v={};var n=r.ListUtils.listToArray(j,v),q=n[c._4e_getData("listarray_index")].indent;for(a=a._4e_getData("listarray_index");a<=c._4e_getData("listarray_index");a++){n[a].indent+=s;var u=n[a].parent;n[a].parent=new o(u[0].ownerDocument.createElement(u._4e_name()))}for(a=c._4e_getData("listarray_index")+1;a<n.length&&n[a].indent>
q;a++)n[a].indent+=s;c=r.ListUtils.arrayToList(n,v,null,"p",0);s=[];if(this.type=="outdent"){var A;if((A=j.parent())&&A._4e_name()=="li"){n=c.listNode.childNodes;var t;for(a=n.length-1;a>=0;a--)if((t=new o(n[a]))&&t._4e_name()=="li")s.push(t)}}if(c){B.insertBefore(c.listNode,j[0]);j._4e_remove()}if(s&&s.length)for(a=0;a<s.length;a++){for(t=j=s[a];(t=t.next())&&t._4e_name()in w;){l.ie&&!j._4e_first(function(C){return i(C)&&p(C)})&&j[0].appendChild(d.document.createTextNode("\u00a0"));j[0].appendChild(t[0])}B.insertAfter(j[0],
A[0])}for(a in v)v[a]._4e_clearMarkers(v,true)}}}function k(a,d){var j=parseInt(d._4e_style(this.indentCssProperty),10);if(isNaN(j))j=0;j+=(this.type=="indent"?1:-1)*this.indentOffset;if(j<0)return false;j=Math.max(j,0);j=Math.ceil(j/this.indentOffset)*this.indentOffset;d.css(this.indentCssProperty,j?j+this.indentUnit:"");d[0].style.cssText===""&&d[0].removeAttribute("style");return true}function e(a){e.superclass.constructor.call(this,a);a=this.get("editor").toolBarDiv;this.el=new b({container:a,
contentCls:this.get("contentCls"),title:this.get("title")});this.indentCommand=new h(this.get("type"));this._init()}var i=z.whitespaces(true),p=z.bookmark(false,true);y.augment(h,{exec:function(a){for(var d=a.getSelection(),j=d&&d.getRanges()[0],v=j.startContainer,s=j.endContainer,c=j.getCommonAncestor();c&&!(c[0].nodeType==m.NODE_ELEMENT&&w[c._4e_name()]);)c=c.parent();if(c&&v[0].nodeType==m.NODE_ELEMENT&&v._4e_name()in w){v=new z(j);v.evaluator=g;j.startContainer=v.next()}if(c&&s[0].nodeType==m.NODE_ELEMENT&&
s._4e_name()in w){v=new z(j);v.evaluator=g;j.endContainer=v.previous()}s=d.createBookmarks(true);if(c){for(v=c._4e_first();v&&v[0]&&v._4e_name()!="li";)v=v.next();var n=j.startContainer;(v[0]==n[0]||v._4e_contains(n))&&k.call(this,a,c)||f.call(this,a,j,c)}else{j=j.createIterator();j.enforceRealBlocks=true;for(j.enlargeBr=true;c=j.getNextParagraph();)k.call(this,a,c)}d.selectBookmarks(s)}});var b=r.TripleButton;e.ATTRS={type:{},contentCls:{},editor:{}};y.extend(e,y.Base,{_init:function(){var a=this.get("editor"),
d=this.el;d.on("offClick",this.exec,this);this.get("type")=="outdent"?a.on("selectionChange",this._selectionChange,this):d.set("state",b.OFF);r.Utils.sourceDisable(a,this)},disable:function(){this.el.set("state",b.DISABLED)},enable:function(){this.el.set("state",b.OFF)},exec:function(){var a=this.get("editor"),d=this;a.fire("save");setTimeout(function(){d.indentCommand.exec(a);a.fire("save");a.notifySelectionChange()},10)},_selectionChange:function(a){this.get("editor");this.get("type");var d=a.path,
j=d.blockLimit;a=this.el;if(d.contains(w))a.set("state",b.OFF);else(d=d.block||j)&&d._4e_style(this.indentCommand.indentCssProperty)?a.set("state",b.OFF):a.set("state",b.DISABLED)}});r.Indent=e}();x.addPlugin(function(){x.addCommand("outdent",new r.Indent({editor:x,title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-outdent",type:"outdent"}));x.addCommand("indent",new r.Indent({editor:x,title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-indent",type:"indent"}))})});
KISSY.Editor.add("justify",function(x){var r=KISSY.Editor,w=KISSY,y=r.TripleButton;r.Justify||function(){function z(o,l,m,h){this.editor=o;this.v=l;this.contentCls=h;this.title=m;this._init()}var B=/(-moz-|-webkit-|start|auto)/i;w.augment(z,{_init:function(){var o=this.editor;this.el=new y({contentCls:this.contentCls,title:this.title,container:o.toolBarDiv});o.on("selectionChange",this._selectionChange,this);this.el.on("offClick",this._effect,this);r.Utils.sourceDisable(o,this)},disable:function(){this.el.set("state",
y.DISABLED)},enable:function(){this.el.set("state",y.OFF)},_effect:function(){var o=this.editor,l=o.getSelection(),m=this.el.get("state");if(l){var h=l.createBookmarks(),g=l.getRanges(),f,k;o.fire("save");for(var e=g.length-1;e>=0;e--){f=g[e].createIterator();for(f.enlargeBr=true;k=f.getNextParagraph();){k.removeAttr("align");m==y.OFF?k.css("text-align",this.v):k.css("text-align","")}}o.notifySelectionChange();l.selectBookmarks(h);o.fire("save")}},_selectionChange:function(o){var l=this.el;o=o.path;
o=o.block||o.blockLimit;if(!o||o._4e_name()==="body")l.set("state",y.OFF);else{o=o.css("text-align").replace(B,"");o==this.v||!o&&this.v=="left"?l.set("state",y.ON):l.set("state",y.OFF)}}});r.Justify=z}();x.addPlugin(function(){new r.Justify(x,"left","\u5de6\u5bf9\u9f50 ","ke-toolbar-alignleft");new r.Justify(x,"center","\u5c45\u4e2d\u5bf9\u9f50 ","ke-toolbar-aligncenter");new r.Justify(x,"right","\u53f3\u5bf9\u9f50 ","ke-toolbar-alignright")})});
KISSY.Editor.add("link",function(x){var r=KISSY.Editor;r.Link||function(){function w(k){this.editor=k;this._init()}function y(k){return k._4e_ascendant(function(e){return e._4e_name()==="a"&&!!e.attr("href")},true)}var z=KISSY,B=r.TripleButton,o=r.Style,l=z.Node,m=r.Range,h=r.SimpleOverlay,g=r.BubbleView,f={element:"a",attributes:{href:"#(href)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};w.init=function(){var k=new h({title:"\u94fe\u63a5",mask:true});this.dialog=k;k.body.html("<div style='padding:20px 20px 0 20px'><p><label>\u94fe\u63a5\u7f51\u5740\uff1a <input  data-verify='^(https?://[^\\s]+)|(#.+)$'  data-warning='\u8bf7\u8f93\u5165\u5408\u9002\u7684\u7f51\u5740\u683c\u5f0f' class='ke-link-url ke-input' style='width:390px;vertical-align:middle;'  value='http://' /></label></p><p style='margin: 15px 0 10px 64px;'><label><input class='ke-link-blank' type='checkbox'/> &nbsp; \u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5</label></p></div>");
k.foot.html("<a class='ke-link-ok ke-button' style='margin-left:65px;margin-right:20px;'>\u786e\u5b9a</a> <a class='ke-link-cancel ke-button'>\u53d6\u6d88</a>");k.urlEl=k.body.one(".ke-link-url");k.targetEl=k.body.one(".ke-link-blank");var e=k.foot.one(".ke-link-cancel");k.foot.one(".ke-link-ok").on("click",function(i){k.link._link();i.halt()},this);e.on("click",function(i){k.hide();i.halt()},this);w.init=null};g.register({pluginName:"link",func:y,init:function(){var k=this,e=k.el;e.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');
var i=e.one(".ke-bubbleview-url"),p=e.one(".ke-bubbleview-change");e=e.one(".ke-bubbleview-remove");p._4e_unselectable();i._4e_unselectable();e._4e_unselectable();p.on("click",function(b){k._plugin.show();b.halt()});e.on("click",function(b){var a=k._plugin;a._removeLink(k._selectedEl);a.editor.notifySelectionChange();b.halt()});k.on("afterVisibleChange",function(){var b=k._selectedEl;if(b){b=b.attr("_ke_saved_href")||b.attr("href");i.html(b);i.attr("href",b)}})}});z.augment(w,{_init:function(){var k=
this.editor;this.el=new B({container:k.toolBarDiv,contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5 "});this.el.on("offClick",this.show,this);g.attach({pluginName:"link",pluginInstance:this});r.Utils.sourceDisable(k,this)},disable:function(){this.el.set("state",B.DISABLED)},enable:function(){this.el.set("state",B.OFF)},_removeLink:function(k){var e=this.editor,i={href:k.attr("href"),_ke_saved_href:k.attr("_ke_saved_href")};if(k._4e_hasAttribute("target"))i.target=k.attr("target");k=new o(f,i);e.fire("save");
k.remove(e.document);e.fire("save")},_getSelectedLink:function(){var k=this.editor.getSelection();if(k=k&&k.getStartElement())k=y(k);return k},_link:function(){var k,e=this.editor,i=w.dialog,p=i.urlEl.val(),b;if(r.Utils.verifyInputs(i.el.all("input"))){i.hide();if(b=this._getSelectedLink()){k=new m(e.document);k.selectNodeContents(b);e.getSelection().selectRanges([k]);this._removeLink(b)}b={href:p,_ke_saved_href:p};b.target=i.targetEl[0].checked?"_blank":"_self";k=e.getSelection().getRanges()[0];
if(k.collapsed){k=new l("<a href='"+p+"' _ke_saved_href='"+p+"' target='"+b.target+"'>"+p+"</a>",null,e.document);e.insertElement(k)}else{e.fire("save");k=new o(f,b);k.apply(e.document);e.fire("save")}e.notifySelectionChange()}},_prepare:function(){w.init&&w.init()},_real:function(){var k=w.dialog,e=this._getSelectedLink();k.link=this;if(e){k.urlEl.val(e.attr("_ke_saved_href")||e.attr("href"));k.targetEl[0].checked=e.attr("target")=="_blank"}k.show()},show:function(){this._prepare()}});r.Utils.lazyRun(w.prototype,
"_prepare","_real");r.Link=w}();x.addPlugin(function(){new r.Link(x)})});
KISSY.Editor.add("list",function(x){var r=KISSY.Editor,w={ol:1,ul:1},y=["ol","ul"],z=KISSY,B=r.RANGE,o=r.ElementPath,l=r.Walker,m=r.NODE,h=z.UA,g=z.Node,f=z.DOM;r.List||function(){function k(a){this.type=a}function e(a){e.superclass.constructor.call(this,a);a=this.get("editor").toolBarDiv;this.el=new b({contentCls:this.get("contentCls"),title:this.get("title"),container:a});this.listCommand=new k(this.get("type"));this.listCommand.state=this.get("status");this._init()}var i={listToArray:function(a,
d,j,v,s){if(!w[a._4e_name()])return[];v||(v=0);j||(j=[]);for(var c=0,n=a[0].childNodes.length;c<n;c++){var q=new g(a[0].childNodes[c]);if(q._4e_name()=="li"){var u={parent:a,indent:v,element:q,contents:[]};if(s)u.grandparent=s;else{u.grandparent=a.parent();if(u.grandparent&&u.grandparent._4e_name()=="li")u.grandparent=u.grandparent.parent()}d&&q._4e_setMarker(d,"listarray_index",j.length);j.push(u);for(var A=0,t=q[0].childNodes.length,C;A<t;A++){C=new g(q[0].childNodes[A]);C[0].nodeType==m.NODE_ELEMENT&&
w[C._4e_name()]?i.listToArray(C,d,j,v+1,u.grandparent):u.contents.push(C)}}}return j},arrayToList:function(a,d,j,v){j||(j=0);if(!a||a.length<j+1)return null;for(var s=a[j].parent[0].ownerDocument,c=s.createDocumentFragment(),n=null,q=j,u=Math.max(a[j].indent,0),A=null;;){var t=a[q];if(t.indent==u){if(!n||a[q].parent._4e_name()!=n._4e_name()){n=a[q].parent._4e_clone(false,true);c.appendChild(n[0])}A=n[0].appendChild(t.element._4e_clone(false,true)[0]);for(var C=0;C<t.contents.length;C++)A.appendChild(t.contents[C]._4e_clone(true,
true)[0]);q++}else if(t.indent==Math.max(u,0)+1){q=i.arrayToList(a,null,q,v);A.appendChild(q.listNode);q=q.nextIndex}else if(t.indent==-1&&!j&&t.grandparent){if(w[t.grandparent._4e_name()])A=t.element._4e_clone(false,true)[0];else if(t.grandparent._4e_name()!="td"){A=s.createElement(v);t.element._4e_copyAttributes(new g(A))}else A=s.createDocumentFragment();for(C=0;C<t.contents.length;C++){n=t.contents[C]._4e_clone(true,true);A.nodeType==m.NODE_DOCUMENT_FRAGMENT&&t.element._4e_copyAttributes(new g(n));
A.appendChild(n[0])}if(A.nodeType==m.NODE_DOCUMENT_FRAGMENT&&q!=a.length-1){A.lastChild&&A.lastChild.nodeType==m.NODE_ELEMENT&&A.lastChild.getAttribute("type")=="_moz"&&f._4e_remove(A.lastChild);f._4e_appendBogus(A)}if(A.nodeType==m.NODE_ELEMENT&&f._4e_name(A)==v&&A.firstChild){f._4e_trim(A);n=A.firstChild;if(n.nodeType==m.NODE_ELEMENT&&f._4e_isBlockBoundary(n)){n=s.createDocumentFragment();f._4e_moveChildren(A,n);A=n}}n=f._4e_name(A);if(!h.ie&&(n=="div"||n=="p"))f._4e_appendBogus(A);c.appendChild(A);
n=null;q++}else return null;if(a.length<=q||Math.max(a[q].indent,0)<u)break}if(d)for(a=new g(c.firstChild);a&&a[0];){a[0].nodeType==m.NODE_ELEMENT&&a._4e_clearMarkers(d,true);a=a._4e_nextSourceNode()}return{listNode:c,nextIndex:q}}},p=/^h[1-6]$/;k.prototype={changeListType:function(a,d,j,v){var s=i.listToArray(d.root,j),c=[];for(a=0;a<d.contents.length;a++){var n=d.contents[a];n=n._4e_ascendant("li",true);if(!(!n||!n[0]||n._4e_getData("list_item_processed"))){c.push(n);n._4e_setMarker(j,"list_item_processed",
true)}}n=new g(d.root[0].ownerDocument.createElement(this.type));for(a=0;a<c.length;a++){var q=c[a]._4e_getData("listarray_index");s[q].parent=n}j=i.arrayToList(s,j,null,"p");var u;s=j.listNode.childNodes.length;for(a=0;a<s&&(u=new g(j.listNode.childNodes[a]));a++)u._4e_name()==this.type&&v.push(u);f.insertBefore(j.listNode,d.root[0]);d.root._4e_remove()},createList:function(a,d,j){var v=d.contents;a=d.root[0].ownerDocument;var s=[];if(v.length==1&&v[0][0]===d.root[0]){var c=new g(a.createElement("div"));
v[0][0].nodeType!=m.NODE_TEXT&&v[0]._4e_moveChildren(c);v[0][0].appendChild(c[0]);v[0]=c}d=d.contents[0].parent();for(c=0;c<v.length;c++)d=d._4e_commonAncestor(v[c].parent());for(c=0;c<v.length;c++)for(var n=v[c],q;q=n.parent();){if(q[0]===d[0]){s.push(n);break}n=q}if(!(s.length<1)){v=new g(s[s.length-1][0].nextSibling);c=new g(a.createElement(this.type));for(j.push(c);s.length;){j=s.shift();n=new g(a.createElement("li"));if(p.test(j._4e_name()))n[0].appendChild(j[0]);else{j._4e_copyAttributes(n);
j._4e_moveChildren(n);j._4e_remove()}c[0].appendChild(n[0]);h.ie||n._4e_appendBogus()}v[0]?f.insertBefore(c[0],v[0]):d[0].appendChild(c[0])}},removeList:function(a,d,j){function v(C){if((A=new g(u[C?"firstChild":"lastChild"]))&&!(A[0].nodeType==m.NODE_ELEMENT&&A._4e_isBlockBoundary())&&(t=d.root[C?"_4e_previous":"_4e_next"](l.whitespaces(true)))&&!(A[0].nodeType==m.NODE_ELEMENT&&t._4e_isBlockBoundary({br:1})))f[C?"insertBefore":"insertAfter"](a.document.createElement("br"),A[0])}for(var s=i.listToArray(d.root,
j),c=[],n=0;n<d.contents.length;n++){var q=d.contents[n];q=q._4e_ascendant("li",true);if(!(!q||q._4e_getData("list_item_processed"))){c.push(q);q._4e_setMarker(j,"list_item_processed",true)}}q=null;for(n=0;n<c.length;n++){q=c[n]._4e_getData("listarray_index");s[q].indent=-1;q=q}for(n=q+1;n<s.length;n++)if(s[n].indent>Math.max(s[n-1].indent,0)){c=s[n-1].indent+1-s[n].indent;for(q=s[n].indent;s[n]&&s[n].indent>=q;){s[n].indent+=c;n++}n--}var u=i.arrayToList(s,j,null,"p").listNode,A,t;v(true);v(undefined);
f.insertBefore(u,d.root);d.root._4e_remove()},exec:function(a){var d=a.getSelection(),j=d&&d.getRanges();if(!(!j||j.length<1)){for(var v=d.createBookmarks(true),s=[],c={};j.length>0;){var n=j.shift(),q=n.getBoundaryNodes(),u=q.startNode,A=q.endNode;u[0].nodeType==m.NODE_ELEMENT&&u._4e_name()=="td"&&n.setStartAt(q.startNode,B.POSITION_AFTER_START);A[0].nodeType==m.NODE_ELEMENT&&A._4e_name()=="td"&&n.setEndAt(q.endNode,B.POSITION_BEFORE_END);n=n.createIterator();for(n.forceBrBreak=false;q=n.getNextParagraph();)if(!q._4e_getData("list_block")){q._4e_setMarker(c,
"list_block",1);A=new o(q);var t=A.elements,C=null,E=false,F=A.blockLimit,H;for(u=t.length-1;u>=0&&(H=t[u]);u--)if(w[H._4e_name()]&&F.contains(H)){F._4e_removeData("list_group_object");if(u=H._4e_getData("list_group_object"))u.contents.push(q);else{u={root:H,contents:[q]};s.push(u);H._4e_setMarker(c,"list_group_object",u)}E=true;break}if(!E){A=F||A.block;if(A._4e_getData("list_group_object"))A._4e_getData("list_group_object").contents.push(q);else{u={root:A,contents:[q]};A._4e_setMarker(c,"list_group_object",
u);s.push(u)}}}}for(j=[];s.length>0;){u=s.shift();if(this.state=="off")w[u.root._4e_name()]?this.changeListType(a,u,c,j):this.createList(a,u,j);else this.state=="on"&&w[u.root._4e_name()]&&this.removeList(a,u,c)}for(u=0;u<j.length;u++){C=j[u];var K=this;(a=function(M){var D=C[M?"_4e_previous":"_4e_next"](l.whitespaces(true));if(D&&D[0]&&D._4e_name()==K.type){D._4e_remove();D._4e_moveChildren(C,M?true:false)}})();a(true)}r.Utils.clearAllMarkers(c);d.selectBookmarks(v)}}};var b=r.TripleButton;e.ATTRS=
{editor:{},type:{},contentCls:{}};z.extend(e,z.Base,{_init:function(){var a=this.get("editor");this.el.on("offClick onClick",this._change,this);a.on("selectionChange",this._selectionChange,this);r.Utils.sourceDisable(a,this)},disable:function(){this.el.set("state",b.DISABLED)},enable:function(){this.el.set("state",b.OFF)},_change:function(){var a=this.get("editor");this.get("type");var d=this.el;a.fire("save");this.listCommand.state=d.get("state");this.listCommand.exec(a);a.fire("save");a.notifySelectionChange()},
_selectionChange:function(a){this.get("editor");var d=this.get("type"),j=a.path,v;a=this.el;var s=j.blockLimit;j=j.elements;if(s){if(j)for(var c=0;c<j.length&&(v=j[c])&&v[0]!==s[0];c++){var n=z.indexOf(j[c]._4e_name(),y);if(n!==-1)if(y[n]===d){a.set("state",b.ON);return}else break}a.set("state",b.OFF)}}});r.ListUtils=i;r.List=e}();x.addPlugin(function(){new r.List({editor:x,title:"\u9879\u76ee\u5217\u8868",contentCls:"ke-toolbar-ul",type:"ul"});new r.List({editor:x,title:"\u7f16\u53f7\u5217\u8868",contentCls:"ke-toolbar-ol",type:"ol"})})});
KISSY.Editor.add("localStorage",function(){var x=KISSY,r=x.Editor,w;w=r.STORE="localStorage";if(!r.storeReady){r.storeReady=function(z){r.on("storeReady",z)};r.on("storeReady",function(){r.storeReady=function(z){z()};r.detach("storeReady")})}if(window[w])window[w]._ke||r.fire("storeReady");else{var y=r.Config.base+r.Utils.debugUrl("plugins/localStorage/swfstore.swf");window[w]=new r.FlashBridge({movie:y,methods:["setItem","removeItem","getValueOf"]});x.mix(window[w],{_ke:1,getItem:function(z){return this.getValueOf(z)}});
window[w].on("contentReady",function(){r.fire("storeReady")})}});
KISSY.Editor.add("maximize",function(x){var r=KISSY.Editor,w=KISSY,y=w.UA,z=w.Node,B=w.Event,o=r.TripleButton,l=w.DOM,m;if(!(y.gecko<1.92)){r.Maximize||function(){function h(g){this.editor=g;this._init()}l.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");h.init=function(){m=(new z("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>")).appendTo(document.body);h.init=null};w.augment(h,{_init:function(){var g=this.editor,f=
new o({container:g.toolBarDiv,title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"});this.el=f;f.on("offClick",this.maximize,this);f.on("onClick",this.restore,this);r.Utils.lazyRun(this,"_prepare","_real");this._toolBarDiv=g.toolBarDiv},restore:function(){var g=this,f=g.editor;g._resize&&B.remove(window,"resize",g._resize);g._saveEditorStatus();g._restoreState();g.el.boff();setTimeout(function(){g._restoreEditorStatus();f.notifySelectionChange();f.fire("restoreWindow")},30)},_restoreState:function(){var g=
document,f=this.editor,k=this._savedParents;if(k){for(var e=0;e<k.length;e++){var i=k[e];i.el.css("position",i.position)}this._savedParents=null}f.wrap.css({height:this.iframeHeight});l.css(g.body,{width:"",height:"",overflow:""});g.documentElement.style.overflow="";f.editorWrap.css({position:"static",width:this.editorWrapWidth});m.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);g=this.el.el;g.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");
g.attr("title","\u5168\u5c4f");y.ie<8&&this._toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var g=this.editor,f=[],k=g.editorWrap;this.iframeHeight=g.wrap._4e_style("height");this.editorWrapWidth=k._4e_style("width");this.scrollLeft=l.scrollLeft();this.scrollTop=l.scrollTop();window.scrollTo(0,0);for(g=k.parent();g;){k=g.css("position");if(k!="static"){f.push({el:g,position:k});g.css("position","static")}g=g.parent()}this._savedParents=f;f=this.el.el;this.el.el.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
f.attr("title","\u53d6\u6d88\u5168\u5c4f");y.ie<8&&this._toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var g=this.editor;this.savedRanges=null;if(y.gecko&&g.iframeFocus)this.savedRanges=(g=g.getSelection())&&g.getRanges()},_restoreEditorStatus:function(){var g=this.editor,f=g.getSelection(),k=this.savedRanges;g.activateGecko();k&&f&&f.selectRanges(k);if(g.iframeFocus&&f)(g=f.getStartElement())&&g[0]&&g._4e_scrollIntoView();y.ie<8&&this.el.el.one("span").css("background-image","")},_maximize:function(g){var f=
document,k=this.editor,e=k.editorWrap,i=l.viewportHeight(),p=l.viewportWidth(),b=k.statusDiv?k.statusDiv[0].offsetHeight:0,a=k.toolBarDiv[0].offsetHeight;if(y.ie)f.body.style.overflow="hidden";else l.css(f.body,{width:0,height:0,overflow:"hidden"});f.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:k.baseZIndex(990),width:p+"px"});m.css({zIndex:k.baseZIndex(985),height:i+"px",width:p+"px"});e.offset({left:0,top:0});m.css({left:0,top:0});k.wrap.css({height:i-b-a+"px"});g!==
true&&arguments.callee.call(this,true)},_real:function(){var g=this,f=g.editor;g._saveEditorStatus();g._saveSate();g._maximize();g._resize=g._resize||r.Utils.buffer(g._maximize,g,100);B.on(window,"resize",g._resize);g.el.set("state",o.ON);setTimeout(function(){g._restoreEditorStatus();f.notifySelectionChange();f.fire("maximizeWindow")},30)},_prepare:function(){h.init&&h.init()},maximize:function(){this._prepare()}});r.Maximize=h}();x.addPlugin(function(){new r.Maximize(x)})}});
KISSY.Editor.add("music",function(x){var r=KISSY.Editor,w=KISSY,y=w.DOM,z=w.UA,B=w.Event,o=r.Flash,l="ke_music",m=x.htmlDataProcessor,h=m&&m.dataFilter;h&&h.addRules({elements:{object:function(g){var f=g.attributes;if(!(f.classid&&String(f.classid).toLowerCase())){for(f=0;f<g.children.length;f++)if(g.children[f].name=="embed"){if(!o.isFlashEmbed(g.children[f]))break;if(g.children[f].attributes.src.indexOf("niftyplayer.swf")!=-1)return m.createFakeParserElement(g,l,"music",true)}return null}for(f=
0;f<g.children.length;f++){var k=g.children[f];if(k.name=="param"&&k.attributes.name=="movie")if(k.attributes.value.indexOf("niftyplayer.swf")!=-1)return m.createFakeParserElement(g,l,"music",true)}},embed:function(g){if(!o.isFlashEmbed(g))return null;if(g.attributes.src.indexOf("niftyplayer.swf")!=-1)return m.createFakeParserElement(g,l,"music",true)}}},4);r.MusicInserter||function(){function g(i){g.superclass.constructor.apply(this,arguments);i.cfg.disableObjectResizing||B.on(i.document.body,z.ie?
"resizestart":"resize",function(p){y.hasClass(p.target,l)&&p.preventDefault()})}function f(i){return i._4e_name()==="img"&&!!i.hasClass(l)&&i}var k=["img."+l];w.extend(g,o,{_config:function(){this._cls=l;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";this._contextMenu=e;this._flashRules=k}});o.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",f);r.MusicInserter=g;var e={"\u97f3\u4e50\u5c5e\u6027":function(i){var p=i.getSelection();p=(p=p&&p.getStartElement())&&f(p);i=i._toolbars.music;p&&i.show(null,p)}}}();x.addPlugin(function(){new r.MusicInserter(x)})});
KISSY.Editor.add("overlay",function(x){function r(){r.superclass.constructor.apply(this,arguments);this._init()}var w=KISSY,y=w.Editor,z=w.UA,B=y.focusManager,o=w.Node,l=w.Event,m=w.DOM,h,g,f={left:"-9999px",top:"-9999px"},k=y.baseZIndex(11E3);if(!y.SimpleOverlay){r.mask=function(e){if(!h){h=new r({el:new o("<div>"),cls:"ke-mask",focusMgr:false,draggable:false});h.el.css({width:"100%","background-color":"#000000",height:m.docHeight(),opacity:0.15})}e=e||k;h.el.css("z-index",e);h.show({left:0,top:0})};
r.unmask=function(){h&&h.hide()};r.loading=function(e){if(!g){g=new r({el:new o("<div>"),focusMgr:false,cls:"ke-loading",shortkey:false,draggable:false});g.el.css({opacity:0.15,border:0})}var i,p,b;if(e){b=e.offset();i=e[0].offsetWidth;p=e[0].offsetHeight;e=e.css("z-index")+1}else{b={left:0,top:0};i="100%";p=m.docHeight();e=k}g.el.css({width:i,height:p,"z-index":e});g.show(b)};r.unloading=function(){g&&g.hide()};r.ATTRS={title:{value:""},width:{value:"500px"},height:{},cls:{},shortkey:{value:true},
visible:{value:false},zIndex:{value:x.baseZIndex(9999)},focusMgr:{value:true},mask:{value:false},draggable:{value:true}};w.extend(r,w.Base,{_init:function(){var e=this;e._createEl();var i=e.el;i.css("z-index",e.get("zIndex"));e.on("afterVisibleChange",function(p){if(p=p.newVal){typeof p=="boolean"?e.center():i.offset(p);e.fire("show")}else{i.css(f);e.fire("hide")}});if(e.get("focusMgr")){e._initFocusNotice();e.on("afterVisibleChange",e._editorFocusMg,e)}e.on("afterVisibleChange",function(p){p.newVal&&
e.get("shortkey")?e._register():e._unregister()});if(e.get("mask")){e.on("show",function(){r.mask(e.get("zIndex")-1)});e.on("hide",function(){r.unmask()})}e.on("afterZIndexChange",function(p){i.css("z-index",p.newVal)});y.Utils.lazyRun(this,"_prepareShow","_realShow")},_register:function(){l.on(document,"keydown",this._keydown,this)},_keydown:function(e){if(e.keyCode==27){this.hide();e.halt()}},_unregister:function(){l.remove(document,"keydown",this._keydown,this)},_createEl:function(){var e=this,
i=e.get("el");if(i){e.originalEl=i;if(!i[0].parentNode||i[0].parentNode.nodeType!=y.NODE.NODE_ELEMENT)i=(new o("<div class='ke-dialog'>")).append((new o("<div class='ke-dialog-wrapper'>")).append(i)).appendTo(document.body);else{var p=new o("<div class='ke-dialog'>");p.insertBefore(i);p.append((new o("<div class='ke-dialog-wrapper'>")).append(i));i=p}}else{i=(new o("<div class='ke-dialog' ><div class='ke-dialog-wrapper'><div class='ke-hd'><span class='ke-hd-title'>@title@</span><a class='ke-hd-x' href='#'><span class='ke-close'>X</span></a></div><div class='ke-bd'></div><div class='ke-ft'></div></div></div>".replace(/@title@/,
e.get("title")))).appendTo(document.body);p=i.one(".ke-hd");var b=e.get("height");e.body=i.one(".ke-bd");e.foot=i.one(".ke-ft");e._title=p.one("h1");i.one(".ke-hd-x").on("click",function(d){d.preventDefault();e.hide()});b&&e.body.css({height:b,overflow:"auto"});if(b=e.get("draggable")){var a={all:i,foot:e.foot,body:e.body,head:p};(b=b===true?p:a[b])&&new y.Drag({node:i,handlers:{id:b}})}}e.get("cls")&&i.addClass(e.get("cls"));e.get("width")&&i.css("width",e.get("width"));e.set("el",i);e.el=i;i.css(f)},
center:function(){var e=this.el,i=e.width(),p=e.height(),b=m.viewportWidth(),a=m.viewportHeight();i=(b-i)/2+m.scrollLeft();p=(a-p)/2+m.scrollTop();if(p-m.scrollTop()>200)p-=150;i=Math.max(i,m.scrollLeft());p=Math.max(p,m.scrollTop());e.css({left:i+"px",top:p+"px"})},_getFocusEl:function(){var e=this._focusEl;if(e)return e;return this._focusEl=e=(new o("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.el)},_initFocusNotice:function(){var e=
this,i=e._getFocusEl();i.on("focus",function(){e.fire("focus")});i.on("blur",function(){e.fire("blur")})},_editorFocusMg:function(e){var i=this._focusEditor;if(e.newVal){i=this._focusEditor=B.currentInstance();z.webkit||this._getFocusEl()[0].focus();if(z.ie&&i)if(e=i.document.selection.createRange())if(e.item&&e.item(0).ownerDocument==i.document){i=document.body.createTextRange();i.moveToElementText(this.el._4e_first()[0]);i.collapse(true);i.select()}}else i&&i.focus()},_prepareShow:function(){if(z.ie==
6){var e=new o("<iframe class='ke-dialog-iframe'></iframe>");e.css(w.mix({opacity:0}));e.insertBefore(this.el.one(".ke-dialog-wrapper"))}},loading:function(){r.loading(this.el)},unloading:function(){r.unloading()},_realShow:function(e){this.set("visible",e||true)},show:function(e){this._prepareShow(e)},hide:function(){this.set("visible",false)}});y.Utils.lazyRun(r.prototype,"_prepareLoading","_realLoading");y.SimpleOverlay=r}});
KISSY.Editor.add("pagebreak",function(x){var r=KISSY,w=r.Editor,y=x.htmlDataProcessor,z=y&&y.dataFilter,B="ke_pagebreak",o="div";z&&z.addRules({elements:{div:function(l){var m=l.attributes;var h=(m=m&&m.style)&&l.children.length==1&&l.children[0];if((h=h&&h.name=="span"&&h.attributes.style)&&/page-break-after\s*:\s*always/i.test(m)&&/display\s*:\s*none/i.test(h))return y.createFakeParserElement(l,B,o)}}});w.PageBreak||function(){function l(f){var k=new h({container:f.toolBarDiv,title:"\u5206\u9875",contentCls:"ke-toolbar-pagebreak"});
k.on("offClick",function(){var e=new m(g,null,f.document);e=f.createFakeElement?f.createFakeElement(e,B,o,true,g):e;e=(new m("<div>",null,f.document)).append(e);f.insertElement(e)});this.el=k;w.Utils.sourceDisable(f,this)}var m=r.Node,h=w.TripleButton,g='<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>';r.augment(l,{disable:function(){this.el.set("state",h.DISABLED)},enable:function(){this.el.set("state",h.OFF)}});w.PageBreak=l}();x.addPlugin(function(){new w.PageBreak(x)})});
KISSY.Editor.add("preview",function(x){var r=KISSY.Editor,w=KISSY,y=r.TripleButton;r.Preview||function(){function z(B){this.editor=B;this._init()}w.augment(z,{_init:function(){this.el=new y({container:this.editor.toolBarDiv,title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"});this.el.on("offClick",this._show,this)},_show:function(){var B=this.editor,o=640,l=420,m=80;try{var h=window.screen;o=Math.round(h.width*0.8);l=Math.round(h.height*0.7);m=Math.round(h.width*0.1)}catch(g){}B=B._prepareIFrameHtml(null,
B.cfg.customStyle).replace(/<body[^>]+>.+<\/body>/,"<body>\n"+B.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");o=window.open("",null,"toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+o+",height="+l+",left="+m);o.document.open();o.document.write(B);o.document.close();o.focus()}});r.Preview=z}();x.addPlugin(function(){new r.Preview(x)})});
KISSY.Editor.add("progressbar",function(){function x(){x.superclass.constructor.apply(this,arguments);this._init()}var r=KISSY,w=r.Editor;if(!w.ProgressBar){var y=r.Node;r.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}",
"ke_progressbar");x.ATTRS={container:{},width:{},height:{},progress:{value:0}};r.extend(x,r.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var z=this.get("height"),B=new y("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+z+";'></div>"),o=this.get("container");z=(new y("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(z)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(B);var l=
(new y("<span class='ke-progressbar-title'>")).appendTo(B);o&&B.appendTo(o);this.el=B;this._title=l;this._p=z;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(z){z=z.newVal;this._p.css("width",z+"%");this._title.html(z+"%")}});w.ProgressBar=x}});
KISSY.Editor.add("removeformat",function(x){function r(f){this.editor=f;this._init()}function w(f,k){for(var e=0;e<k.length;e++)f.removeAttr(k[e])}var y=KISSY.Editor,z=KISSY,B=y.RANGE,o=y.ElementPath,l=y.NODE,m=y.TripleButton,h="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s",g="class,style,lang,width,height,align,hspace,valign".split(",");h=RegExp("^(?:"+h.replace(/,/g,"|")+")$","i");z.augment(r,{_init:function(){var f=this.editor;this.el=new m({title:"\u6e05\u9664\u683c\u5f0f",
contentCls:"ke-toolbar-removeformat",container:f.toolBarDiv});this.el.on("offClick",this._remove,this);y.Utils.sourceDisable(f,this)},disable:function(){this.el.set("state",m.DISABLED)},enable:function(){this.el.set("state",m.OFF)},_remove:function(){var f=this.editor,k=h;k.lastIndex=0;var e=f.getSelection().getRanges();f.fire("save");for(var i=0,p;p=e[i];i++)if(!p.collapsed){p.enlarge(B.ENLARGE_ELEMENT);var b=p.createBookmark(),a=b.startNode,d=b.endNode,j=function(v){for(var s=new o(v),c=s.elements,
n=1,q;q=c[n];n++){if(q._4e_equals(s.block)||q._4e_equals(s.blockLimit))break;k.test(q._4e_name())&&v._4e_breakParent(q)}};j(a);j(d);for(a=a._4e_nextSourceNode(true,l.NODE_ELEMENT);a;){if(a._4e_equals(d))break;j=a._4e_nextSourceNode(false,l.NODE_ELEMENT);a._4e_name()=="img"&&a.attr("_cke_realelement")||(k.test(a._4e_name())?a._4e_remove(true):w(a,g));a=j}p.moveToBookmark(b)}f.getSelection().selectRanges(e);f.fire("save")}});x.addPlugin(function(){new r(x)})});
KISSY.Editor.add("resize",function(x){var r=KISSY,w=r.Editor,y=r.Node;w.Resizer||function(){function z(o){this.editor=o;this._init()}var B=w.Draggable;r.augment(z,{_init:function(){var o=this.editor,l=o.statusDiv,m=new y("<div class='ke-resizer'></div>"),h=o.cfg.pluginConfig.resize||{};h=h.direction||["x","y"];m.appendTo(l);o.on("maximizeWindow",function(){m.css("display","none")});o.on("restoreWindow",function(){m.css("display","")});l=new B({node:m});var g=0,f=0,k=o.wrap,e=o.editorWrap;l.on("start",
function(){g=k.height();f=e.width()});l.on("move",function(i){var p=i.pageX-this.startMousePos.left;i=i.pageY-this.startMousePos.top;r.inArray("y",h)&&k.height(g+i);r.inArray("x",h)&&e.width(f+p)})}});w.Resizer=z}();x.addPlugin(function(){new w.Resizer(x)})});
KISSY.Editor.add("select",function(){function x(l){x.superclass.constructor.call(this,l);this._init()}var r=KISSY,w=r.Node,y=r.Event,z=r.DOM,B=r.Editor;if(!B.Select){x.DISABLED=0;x.ENABLED=1;var o=B.XHTML_DTD;x.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var l=this.el.parent();l;){var m=l._4e_name();if(o[m]&&o[m].div)return l;l=l.parent()}return new w(document.body)}},state:{value:1}};x.decorate=
function(l){for(var m=l.width(),h=[],g=l.all("option"),f=0;f<g.length;f++){var k=g[f];h.push({name:z.html(k),value:z.attr(k,"value")})}return new x({width:m+"px",el:l,items:h,cls:"ke-combox",value:l.val()})};r.extend(x,r.Base,{_init:function(){var l=this.get("container"),m=this.get("el"),h=new w("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
g=this.get("title")||"",f=this.get("cls"),k=h.one(".ke-select-text"),e=h.one(".ke-select-text-inner");h.one(".ke-select-drop");this.get("value")!==undefined?e.html(this._findNameByV(this.get("value"))):e.html(g);k.css("width",this.get("width"));h._4e_unselectable();g&&h.attr("title",g);f&&h.addClass(f);if(m)m[0].parentNode.replaceChild(h[0],m[0]);else l&&h.appendTo(l);h.on("click",this._click,this);this.el=h;this.title=e;this._focusA=h.one("a.ke-select");B.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(l){var m=this.get("title")||"",h=this.get("items");if(this.get("showValue"))return l||m;for(var g=0;g<h.length;g++){var f=h[g];if(f.value==l){m=f.name;break}}return m},_valueChange:function(l){this.title.html(this._findNameByV(l.newVal))},_itemsChange:function(l){l=l.newVal;var m=this._selectList;m.html("");if(l)for(var h=0;h<l.length;h++){var g=l[h];(new w("<a class='ke-select-menu-item' href='#' data-value='"+
g.value+"'>"+g.name+"</a>",g.attrs)).appendTo(m)._4e_unselectable()}this.as=m.all("a")},val:function(l){if(l!==undefined){this.set("value",l);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var l=this,m=l.el,h=l.get("popUpWidth"),g=l._focusA,f=new w("<div onmousedown='return false;'></div>");f.appendTo(l.get("menuContainer"));var k=new B.SimpleOverlay({el:f,cls:"ke-menu",width:h?h:m.width(),zIndex:B.baseZIndex(990),focusMgr:false});
h=l.get("items");l.menu=k;y.on(window,"resize",l._resize,l);l.get("title")&&(new w("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+l.get("title")+"</div>")).appendTo(f);l._selectList=(new w("<div>")).appendTo(f);l._itemsChange({newVal:h});k.on("show",function(){g.addClass("ke-select-active")});k.on("hide",function(){g.removeClass("ke-select-active")});y.on([document,l.get("doc")],"click",function(e){m._4e_contains(e.target)||k.hide()});f.on("click",l._select,l);l.as=l._selectList.all("a");
y.on(f[0],"mouseenter",function(){l.as.removeClass("ke-menu-selected")});l.on("afterItemsChange",l._itemsChange,l)},_stateChange:function(l){var m=this.el;l.newVal==1?m.removeClass("ke-select-disabled"):m.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(l){l.halt();var m=this.menu,h=m.el;if(l=(new w(l.target))._4e_ascendant(function(k){return h._4e_contains(k)&&k._4e_name()=="a"},true)){var g=this.get("value"),f=l.attr("data-value");
this.set("value",f);this.fire("click",{newVal:f,prevVal:g,name:l.html()});m.hide()}},_real:function(){var l=this.el,m=l.offset(),h=r.clone(m),g=this.menu.el.height(),f=this.menu.el.width(),k=z.scrollTop(),e=z.scrollLeft(),i=z.viewportHeight(),p=z.viewportWidth();p=e+p-60;i=k+i;var b=m.top+(l.height()-2);l=m.left+l.width()-2;var a=this.get("align"),d=a[0];if(a[1]=="b"){m.top=b;if(m.top+g>i&&h.top-k>i-b)m.top=h.top-g}else{m.top=h.top-g;if(m.top<k&&h.top-k<i-b)m.top=b}if(d=="l"){if(m.left+f>p&&l-e>p-
h.left)m.left=l-f}else{m.left=l-f;if(m.left<e&&l-e<p-h.left)m.left=h.left}this.menu.show(m)},_click:function(l){l.preventDefault();l=this.el;var m=this.get("value");if(!l.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();m&&this.menu&&this.as.each(function(h){h.attr("data-value")==m?h.addClass("ke-menu-selected"):h.removeClass("ke-menu-selected")})}}});B.Select=x}});KISSY.Editor.add("separator",function(x){x.addPlugin(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(x.toolBarDiv)})});
KISSY.Editor.add("smiley",function(x){var r=KISSY.Editor,w=KISSY,y=w.DOM,z=w.Event,B=w.Node,o=r.SimpleOverlay,l=r.TripleButton;r.Smiley||function(){function m(f){this.editor=f;this._init()}y.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',
"smiley");for(var h="<div class='ke-smiley-sprite'>",g=0;g<=98;g++)h+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+g+".gif'></a>";h+="</div>";w.augment(m,{_init:function(){var f=this.editor;this.el=new l({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",container:f.toolBarDiv});this.el.on("offClick",this._show,this);r.Utils.lazyRun(this,"_prepare","_real");r.Utils.sourceDisable(f,this)},disable:function(){this.el.set("state",l.DISABLED)},enable:function(){this.el.set("state",l.OFF)},
_hidePanel:function(f){var k=this;if(this.smileyWin.get("visible"))y._4e_ascendant(f.target,function(e){return e[0]===k.el.el[0]},true)||this.smileyWin.hide()},_selectSmiley:function(f){f.halt();var k=this.editor;f=f.target;var e;if(y._4e_name(f)=="a"&&(e=y.attr(f,"data-icon"))){e=new B("<img class='ke_smiley'alt='' src='"+e+"'/>",null,k.document);k.insertElement(e);this.smileyWin.hide()}},_prepare:function(){var f=this.editor;this.smileyPanel=new B(h);this.smileyWin=new o({el:this.smileyPanel,width:"297px",
zIndex:f.baseZIndex(990),focusMgr:false,mask:false});this.smileyPanel.on("click",this._selectSmiley,this);z.on(document,"click",this._hidePanel,this);z.on(f.document,"click",this._hidePanel,this)},_real:function(){var f=this.el.el.offset();f.top+=this.el.el.height()+5;if(f.left+this.smileyPanel.width()>y.viewportWidth()-60)f.left=y.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.show(f)},_show:function(f){this._prepare(f)}});r.Smiley=m}();x.addPlugin(function(){new r.Smiley(x)})});
KISSY.Editor.add("sourcearea",function(x){var r=KISSY.Editor,w=KISSY,y=r.TripleButton;if(!(w.UA.gecko<1.92)){r.SourceArea||function(){function z(l){this.editor=l;this._init()}var B=r.SOURCE_MODE,o=r.WYSIWYG_MODE;w.augment(z,{_init:function(){var l=this.editor;var m=this.el=new y({container:l.toolBarDiv,title:"\u6e90\u7801",contentCls:"ke-toolbar-source"});m.on("offClick",this._show,this);m.on("onClick",this._hide,this);l.on("sourcemode",function(){m.bon()});l.on("wysiwygmode",function(){m.boff()})},_show:function(){this.editor.execCommand("sourceAreaSupport",
B);this.el.bon()},_hide:function(){var l=this.el;this.editor.execCommand("sourceAreaSupport",o);l.boff()}});r.SourceArea=z}();x.addPlugin(function(){new r.SourceArea(x)})}});
KISSY.Editor.add("sourcearea/support",function(x){var r=KISSY,w=r.Editor,y=r.UA;w.SourceAreaSupport||function(){function z(){var l=this.mapper={};l[B]=this._show;l[o]=this._hide}var B=w.SOURCE_MODE,o=w.WYSIWYG_MODE;r.augment(z,{exec:function(l,m){var h=this.mapper;h[m]&&h[m].call(this,l)},_show:function(l){l.textarea.val(l.getData(true));this._showSource(l);l.fire("sourcemode")},_showSource:function(l){var m=l.textarea,h=l.iframe;m.css("display","");h.css("display","none");y.ie<8&&m.css("height",
l.wrap.css("height"));m[0].focus()},_hideSource:function(l){var m=l.textarea;l.iframe.css("display","");m.css("display","none")},_hide:function(l){var m=l.textarea;this._hideSource(l);l.fire("save");l.setData(m.val());l.fire("wysiwygmode");l.fire("save");y.gecko&&l.activateGecko()}});w.SourceAreaSupport=new z}();x.addPlugin(function(){x.addCommand("sourceAreaSupport",w.SourceAreaSupport)})});
KISSY.Editor.add("table",function(x,r){var w=KISSY.Editor,y=KISSY,z=y.Node,B=y.DOM,o=w.Walker,l=y.UA,m=w.NODE,h=w.TripleButton,g=w.SimpleOverlay,f=w.ContextMenu,k=["tr","th","td","tbody","table"],e=y.trim,i;i=(l.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th",
"{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border");var p=x.htmlDataProcessor,b=p&&p.dataFilter;p=p&&p.htmlFilter;b&&b.addRules({elements:{table:function(a){a=a.attributes;var d=a["class"],j=parseInt(a.border,10);if(!j||j<=0)a["class"]=(d||"")+" ke_show_border"}}});p&&p.addRules({elements:{table:function(a){a=a.attributes;var d=a["class"];if(d)a["class"]=e(d.replace("ke_show_border","").replace(/\s{2}/," "))}}});w.TableUI||function(){function a(t){this.editor=t;this.selectedTable=
null;t._toolbars=t._toolbars||{};t._toolbars.table=this;this._init()}function d(t){return e(t).length!=0}function j(t){function C(G){if(!(H.length>0))if(G[0].nodeType==m.NODE_ELEMENT&&u.test(G._4e_name())&&!G._4e_getData("selected_cell")){G._4e_setMarker(K,"selected_cell",true);H.push(G)}}for(var E=t.createBookmarks(),F=t.getRanges(),H=[],K={},M=0;M<F.length;M++){var D=F[M];if(D.collapsed){D=D.getCommonAncestor();(D=D._4e_ascendant("td",true)||D._4e_ascendant("th",true))&&H.push(D)}else{D=new o(D);
var J;for(D.guard=C;J=D.next();)if((J=J.parent())&&u.test(J._4e_name())&&!J._4e_getData("selected_cell")){J._4e_setMarker(K,"selected_cell",true);H.push(J)}}}w.Utils.clearAllMarkers(K);t.selectBookmarks(E);return H}function v(t,C){var E=t.getStartElement()._4e_ascendant("tr");if(E){var F=E._4e_clone(true);F.insertBefore(E);E=(C?F[0]:E[0]).cells;for(F=0;F<E.length;F++){E[F].innerHTML="";l.ie||(new z(E[F]))._4e_appendBogus()}}}function s(t){if(t instanceof w.Selection){var C=j(t),E=C.length;t=[];for(var F,
H,K=0;K<E;K++){var M=C[K].parent(),D=M[0].rowIndex;!K&&(F=D-1);t[D]=M;K==E-1&&(H=D+1)}K=M._4e_ascendant("table");F=new z(H<K[0].rows.length&&K[0].rows[H]||F>0&&K[0].rows[F]||K[0].parentNode);for(K=t.length;K>=0;K--)t[K]&&s(t[K]);return F}else if(t instanceof z){K=t._4e_ascendant("table");K[0].rows.length==1?K._4e_remove():t._4e_remove()}return 0}function c(t,C){var E=t.getStartElement();if(E=E._4e_ascendant("td",true)||E._4e_ascendant("th",true))for(var F=E._4e_ascendant("table"),H=E[0].cellIndex,
K=0;K<F[0].rows.length;K++){var M=F[0].rows[K];if(!(M.cells.length<H+1)){E=new z(M.cells[H].cloneNode(false));l.ie||E._4e_appendBogus();M=new z(M.cells[H]);C?E.insertBefore(M):E.insertAfter(M)}}}function n(t){if(t instanceof w.Selection){var C=j(t),E,F=[];t=C[0]&&C[0]._4e_ascendant("table");var H,K,M;H=0;for(K=C.length;H<K;H++)F.push(C[H][0].cellIndex);F.sort();H=1;for(K=F.length;H<K;H++)if(F[H]-F[H-1]>1){M=F[H-1]+1;break}M||(M=F[0]>0?F[0]-1:F[F.length-1]+1);F=t[0].rows;H=0;for(K=F.length;H<K;H++)if(E=
F[H].cells[M])break;E=E?new z(E):t._4e_previous();for(M=C.length-1;M>=0;M--)C[M]&&n(C[M]);return E}else if(t instanceof z){C=t._4e_ascendant("table");if(!C)return null;E=t[0].cellIndex;for(M=C[0].rows.length-1;M>=0;M--){t=new z(C[0].rows[M]);if(!E&&t[0].cells.length==1)s(t);else t[0].cells[E]&&t[0].removeChild(t[0].cells[E])}}return null}function q(t,C){var E=new w.Range(t[0].ownerDocument);if(!E.moveToElementEditablePosition(t,C?true:r)){E.selectNodeContents(t);E.collapse(C?false:true)}E.select(true)}
y.augment(a,{_init:function(){var t=this.editor,C={};this.el=new h({contentCls:"ke-toolbar-table",title:"\u63d2\u5165\u8868\u683c",container:t.toolBarDiv});this.el.on("offClick",this._tableShow,this);for(var E in A)(function(F){C[F]=function(){t.fire("save");A[F](t);t.fire("save")}})(E);f.register({editor:t,rules:k,width:"120px",funcs:C});w.Utils.lazyRun(this,"_prepareTableShow","_realTableShow");w.Utils.sourceDisable(t,this)},disable:function(){this.el.set("state",h.DISABLED)},enable:function(){this.el.set("state",
h.OFF)},_tableInit:function(){var t=this,C=new g({width:"430px",mask:true,title:"\u8868\u683c"});C.body.html("<div style='padding:20px 20px 10px 20px;'><table class='ke-table-config' style='width:100%'><tr><td><label>\u884c\u6570\uff1a <input  data-verify='^(?!0$)\\d+$'  data-warning='\u884c\u6570\u8bf7\u8f93\u5165\u6b63\u6574\u6570'  value='2'  class='ke-table-rows ke-table-create-only ke-input' style='margin-left:2px;vertical-align:middle;' size='6' /></label></td><td><label>\u5bbd&nbsp;&nbsp;&nbsp;\u5ea6\uff1a <input  data-verify='^(?!0$)\\d+$'  data-warning='\u5bbd\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570' value='200' style='margin-left:2px;vertical-align:middle;' class='ke-table-width ke-input' size='6'/></label> <select class='ke-table-width-unit'><option value='px'>\u50cf\u7d20</option><option value='%'>\u767e\u5206\u6bd4</option></select></td></tr><tr><td><label>\u5217\u6570\uff1a <input  data-verify='^(?!0$)\\d+$'  data-warning='\u5217\u6570\u8bf7\u8f93\u5165\u6b63\u6574\u6570' class='ke-table-cols ke-table-create-only ke-input' style='margin-left:2px;vertical-align:middle;'value='3' size='6'/></label></td><td><label>\u9ad8&nbsp;&nbsp;&nbsp;\u5ea6\uff1a <input  data-verify='^((?!0$)\\d+)?$'  data-warning='\u9ad8\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570' value='' style='margin-left:2px;vertical-align:middle;'class='ke-table-height ke-input' size='6'/></label> &nbsp;\u50cf\u7d20</td></tr><tr><td><label>\u5bf9\u9f50\uff1a <select class='ke-table-align'><option value=''>\u65e0</option><option value='left'>\u5de6\u5bf9\u9f50</option><option value='right'>\u53f3\u5bf9\u9f50</option><option value='center'>\u4e2d\u95f4\u5bf9\u9f50</option></select></label></td><td><label>\u6807\u9898\u683c\uff1a <select class='ke-table-head ke-table-create-only'><option value=''>\u65e0</option><option value='1'>\u6709</option></select></td></tr><tr><td><label>\u8fb9\u6846\uff1a <input  data-verify='^\\d+$'  data-warning='\u8fb9\u6846\u8bf7\u8f93\u5165\u975e\u8d1f\u6574\u6570' value='1' style='margin-left:2px;vertical-align:middle;'class='ke-table-border ke-input' size='6'/></label> &nbsp;\u50cf\u7d20</td><td></td></tr><tr><td colspan='2'><label>\u6807\u9898\uff1a <input class='ke-table-caption ke-input' style='width:320px;margin-left:2px;vertical-align:middle;'></label></td></tr></table></div>");
C.foot.html("<a class='ke-table-ok ke-button' style='margin-right:20px;'>\u786e\u5b9a</a> <a class='ke-table-cancel ke-button'>\u53d6\u6d88</a>");var E=C.body;C.twidth=E.one(".ke-table-width");C.theight=E.one(".ke-table-height");C.tborder=E.one(".ke-table-border");C.tcaption=E.one(".ke-table-caption");C.talign=w.Select.decorate(E.one(".ke-table-align"));C.trows=E.one(".ke-table-rows");C.tcols=E.one(".ke-table-cols");C.thead=w.Select.decorate(E.one(".ke-table-head"));var F=C.foot.one(".ke-table-ok"),H=C.foot.one(".ke-table-cancel");
C.twidthunit=w.Select.decorate(E.one(".ke-table-width-unit"));t.tableDialog=C;F.on("click",t._tableOk,t);C.on("hide",function(){t.selectedTable=null});H.on("click",function(){C.hide()})},_tableOk:function(){var t=this.tableDialog,C=t.el.all("input");if(t.twidthunit.val()=="%"){t=parseInt(t.twidth.val());if(!t||t>100||t<0){alert("\u5bbd\u5ea6\u767e\u5206\u6bd4\uff1a\u8bf7\u8f93\u51651-100\u4e4b\u95f4");return}}if(w.Utils.verifyInputs(C))this.selectedTable?this._modifyTable():this._genTable()},_modifyTable:function(){var t=this.tableDialog,C=this.selectedTable,
E=C.one("caption"),F=t.talign.val(),H=t.tborder.val();d(F)?C.attr("align",e(F)):C.removeAttr("align");d(H)?C.attr("border",e(H)):C.removeAttr("border");!d(H)||H=="0"?C.addClass("ke_show_border"):C.removeClass("ke_show_border");d(t.twidth.val())?C.css("width",e(t.twidth.val())+t.twidthunit.val()):C.css("width","");d(t.theight.val())?C.css("height",e(t.theight.val())):C.css("height","");if(d(t.tcaption.val())){F=w.Utils.htmlEncode(e(t.tcaption.val()));if(E&&E[0])E.html(F);else{C=C[0].createCaption();
B.html(C,"<span>"+F+"</span>")}}else E&&E._4e_remove();t.hide()},_genTable:function(){var t=this.tableDialog,C="<table ",E,F=parseInt(t.tcols.val())||1,H=parseInt(t.trows.val())||1,K=l.ie?"":"<br/>",M=this.editor;if(d(t.talign.val()))C+="align='"+e(t.talign.val())+"' ";if(d(t.tborder.val()))C+="border='"+e(t.tborder.val())+"' ";if(d(t.twidth.val())||d(t.theight.val())){C+="style='";if(d(t.twidth.val()))C+="width:"+e(t.twidth.val())+t.twidthunit.val()+";";if(d(t.theight.val()))C+="height:"+e(t.theight.val())+
"px;";C+="' "}if(!d(t.tborder.val())||e(t.tborder.val())=="0")C+="class='ke_show_border' ";C+=">";if(d(t.tcaption.val()))C+="<caption><span>"+w.Utils.htmlEncode(e(t.tcaption.val()))+"</span></caption>";if(t.thead.val()){C+="<thead>";C+="<tr>";for(E=0;E<F;E++)C+="<th>"+K+"</th>";C+="</tr>";C+="</thead>";H-=1}C+="<tbody>";for(var D=0;D<H;D++){C+="<tr>";for(E=0;E<F;E++)C+="<td>"+K+"</td>";C+="</tr>"}C+="</tbody>";C+="</table>";C=new z(C,null,M.document);M.insertElement(C);t.hide()},_fillTableDialog:function(){var t=
this.tableDialog,C=this.selectedTable,E=C.one("caption");t.talign.val(C.attr("align")||"");t.tborder.val(C.attr("border")||"0");var F=C._4e_style("width")||""+C.width();t.twidth.val(F.replace(/px|%|(.*pt)/i,""));F.indexOf("%")!=-1?t.twidthunit.val("%"):t.twidthunit.val("px");t.theight.val((C._4e_style("height")||"").replace(/px|%/i,""));F="";if(E)F=E.text();t.tcaption.val(F);E=C._4e_first(function(H){return H._4e_name()=="thead"});t.trows.val(C.one("tbody").children().length+(E?E.children("tr").length:
0));t.tcols.val(C.one("tr").children().length);t.thead.val(E?"1":"")},_realTableShow:function(){var t=this.tableDialog;if(this.selectedTable){this._fillTableDialog();t.body.all(".ke-table-create-only").attr("disabled","disabled");t.thead.disable()}else{t.body.all(".ke-table-create-only").removeAttr("disabled");t.thead.enable()}this.tableDialog.show()},_prepareTableShow:function(){this._tableInit()},_tableShow:function(){this._prepareTableShow()}});var u=/^(?:td|th)$/,A={"\u8868\u683c\u5c5e\u6027":function(t){var C=t.getSelection();
if(C=(C=C&&C.getStartElement())&&C._4e_ascendant("table",true)){t=t._toolbars.table;t.selectedTable=C;t._tableShow()}},"\u5220\u9664\u8868\u683c":function(t){var C=(t=t.getSelection())&&t.getStartElement();if(C=C&&C._4e_ascendant("table",true)){t.selectElement(C);var E=t.getRanges()[0];E.collapse();t.selectRanges([E]);t=C.parent();t[0].childNodes.length==1&&t._4e_name()!="body"&&t._4e_name()!="td"?t._4e_remove():C._4e_remove()}},"\u5220\u9664\u884c ":function(t){t=t.getSelection();q(s(t),r)},"\u5220\u9664\u5217 ":function(t){t=t.getSelection();(t=
n(t))&&q(t,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(t){t=t.getSelection();v(t,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(t){t=t.getSelection();v(t,r)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(t){t=t.getSelection();c(t,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(t){t=t.getSelection();c(t,r)}};w.TableUI=a}();x.addPlugin(function(){new w.TableUI(x);x.addCustomStyle(i)})});
KISSY.Editor.add("tabs",function(){function x(B){this.cfg=B;this._init()}var r=KISSY,w=r.Editor,y=r.DOM,z=r.Node;if(!w.Tabs){r.augment(x,r.EventTarget,{_init:function(){var B=this,o=B.cfg,l=o.tabs,m=o.contents.children("div"),h=l.children("li");l.on("click",function(g){g=new z(g.target);if(g=g._4e_ascendant(function(k){return k._4e_name()==="li"&&l._4e_contains(k)},true)){h.removeClass("ke-tab-selected");var f=g.attr("rel");g.addClass("ke-tab-selected");m.hide();y.show(m[r.indexOf(g[0],h)]);B.fire(f)}})},
getTab:function(B){var o=this.cfg,l=o.tabs;o=o.contents.children("div");l=l.children("li");for(var m=0;m<l.length;m++){var h=new z(l[m]),g=new z(o[m]);if(r.isNumber(B)&&B==m||r.isString(B)&&B==h.attr("rel"))return{tab:h,content:g}}},remove:function(B){B=this.getTab(B);B.tab.remove();B.content.remove()},_getActivate:function(){var B=this.cfg,o=B.tabs;B.contents.children("div");B=o.children("li");for(o=0;o<B.length;o++){var l=new z(B[o]);if(l.hasClass("ke-tab-selected"))return l.attr("rel")}},activate:function(B){if(arguments.length==
0)return this._getActivate();var o=this.cfg,l=o.tabs;o=o.contents.children("div");l.children("li").removeClass("ke-tab-selected");o.hide();l=this.getTab(B);l.tab.addClass("ke-tab-selected");l.content.show()}});w.Tabs=x}});
KISSY.Editor.add("templates",function(x){var r=KISSY.Editor,w=KISSY,y=w.Node,z=w.DOM,B=r.TripleButton,o=r.SimpleOverlay;r.TplUI||function(){function l(m){this.editor=m;this._init()}z.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto 0 auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");
w.augment(l,{_init:function(){var m=this.editor,h=new B({container:m.toolBarDiv,contentCls:"ke-toolbar-template",title:"\u6a21\u677f"});h.on("offClick",this._show,this);r.Utils.lazyRun(this,"_prepare","_real");this.el=h;r.Utils.sourceDisable(m,this)},disable:function(){this.el.set("state",B.DISABLED)},enable:function(){this.el.set("state",B.OFF)},_prepare:function(){for(var m=this.editor,h=m.cfg.pluginConfig.templates||[],g="<div class='ke-tpl'>",f=0;f<h.length;f++)g+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+
h[f].demo+"</a>";g+="</div>";this._initDialogOk=true;var k=new o({mask:true,title:"\u5185\u5bb9\u6a21\u677f"});k.body.html(g);k.body.all(".ke-tpl-list").on("click",function(e){e.halt();e=(new y(e.target))._4e_index();e!=-1&&m.insertHtml(h[e].html);k.hide()});this.ui=k},_real:function(){this.ui.show()},_show:function(){this._prepare()}});r.TplUI=l}();x.addPlugin(function(){new r.TplUI(x)})});
KISSY.Editor.add("undo",function(x){var r=KISSY,w=r.Editor,y=w.Utils.arrayCompare,z=r.UA,B=r.Event;w.UndoManager||function(){function o(e){var i=e._getRawData();e=i&&e.getSelection();this.contents=i;this.bookmarks=e&&e.createBookmarks2(true)}function l(e){this.history=[];this.index=-1;this.editor=e;this.bufferRunner=w.Utils.buffer(this.save,this,500);this._init()}function m(e,i,p,b){this.editor=e;this.title=p;this.text=i;this.contentCls=b;this._init()}r.augment(o,{equals:function(e){if(this.contents!=
e.contents)return false;var i=this.bookmarks;e=e.bookmarks;if(i||e){if(!i||!e||i.length!=e.length)return false;for(var p=0;p<i.length;p++){var b=i[p],a=e[p];if(b.startOffset!=a.startOffset||b.endOffset!=a.endOffset||!y(b.start,a.start)||!y(b.end,a.end))return false}}return true}});var h={16:1,17:1,18:1},g={37:1,38:1,39:1,40:1,33:1,34:1};r.augment(l,{_keyMonitor:function(){var e=this.editor;B.on(e.document,"keydown",function(i){var p=i.keyCode;if(!(p in g||p in h))if(p===90&&(i.ctrlKey||i.metaKey)){e.fire("restore",
{d:-1});i.halt()}else if(p===89&&(i.ctrlKey||i.metaKey)){e.fire("restore",{d:1});i.halt()}else e.fire("save",{buffer:1})})},_init:function(){var e=this,i=e.editor;i.on("save",function(p){if(i.getMode()==w.WYSIWYG_MODE)p.buffer?e.bufferRunner():e.save()});i.on("restore",e.restore,e);e._keyMonitor()},save:function(){var e=this.history,i=this.index;e.length>i+1&&e.splice(i+1,e.length-i-1);var p=this.editor;i=e[e.length-1];var b=new o(p);if(!i||!i.equals(b)){e.length===30&&e.shift();e.push(b);this.index=
i=e.length-1;p.fire("afterSave",{history:e,index:i})}},restore:function(e){e=e.d;var i=this.history,p=this.editor,b=i[this.index+e];if(p.getMode()==w.WYSIWYG_MODE)if(b){p._setRawData(b.contents);if(b.bookmarks)p.getSelection().selectBookmarks(b.bookmarks);else if(z.ie){b=p.document.body.createTextRange();b.collapse(true);b.select()}(b=p.getSelection())&&b.scrollIntoView();this.index+=e;p.fire("afterRestore",{history:i,index:this.index});p.notifySelectionChange()}}});var f=w.TripleButton,k={redo:1,
undo:-1};r.augment(m,{_init:function(){var e=this,i=e.editor;e.el=new f({contentCls:e.contentCls,title:e.title,container:i.toolBarDiv});var p=e.el;p.set("state",f.DISABLED);i.on("afterSave afterRestore",e._respond,e);p.on("offClick",function(){i.fire("restore",{d:k[e.text]})});w.Utils.sourceDisable(i,e)},disable:function(){this._saveState=this.el.get("state");this.el.set("state",f.DISABLED)},enable:function(){this.el.set("state",this._saveState)},_respond:function(e){this.updateUI(e.history,e.index)},
updateUI:function(e,i){var p=this.el,b=this.text;if(b=="undo")i>0?p.set("state",f.OFF):p.set("state",f.DISABLED);else if(b=="redo")i<e.length-1?p.set("state",f.OFF):p.set("state",f.DISABLED)}});w.UndoManager=l;w.RestoreUI=m}();x.addPlugin(function(){new w.UndoManager(x);new w.RestoreUI(x,"undo","\u64a4\u9500","ke-toolbar-undo");new w.RestoreUI(x,"redo","\u91cd\u505a","ke-toolbar-redo")})});
