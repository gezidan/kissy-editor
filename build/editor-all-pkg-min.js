/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-10 14:14:07
*/
KISSY.add("editor",function(l,p){function t(o,h){function a(x){for(var q=t.Env.mods,z=0;z<x.length;z++){for(var k=x[z],w=n,D=0;D<z;D++)if(k==x[D]){w=r;break}D=q[k];if(w&&D){w=l.clone(D);k=k+"_"+z;w.name=k;x[z]=k;q[k]||(q[k]=w)}}}var c=this;if(!(c instanceof t))return new t(o,h);if(l.isString(o))o=l.one(o);o=u._4e_wrap(o);h=h||{};h.pluginConfig=h.pluginConfig||{};c.cfg=h;h.pluginConfig=h.pluginConfig;c.cfg=h;l.app(c,l.EventTarget);var f=["htmldataprocessor","enterkey","clipboard"],m=n;c.use=function(x,
q){x=x.split(",");a(x);if(!m)for(var z=0;z<f.length;z++){var k=f[z];l.inArray(k,x)||x.unshift(k)}l.use.call(c,x.join(","),function(){c.ready(function(){q&&q.call(c);if(!m){c.setData(o.val());if(h.focus)c.focus();else{var w=c.getSelection();w&&w.removeAllRanges()}c.fire("save");m=r}})},{order:r,global:t});return c};c.use=c.use;c.init(o);return c}function v(o){var h=l.Config.debug;o=h?h==="dev"?"../src/"+o:o:o.replace(/\.(js|css)/i,"-min.$1");o+=o.indexOf("?")!=-1?"&":"?";o+="t="+encodeURIComponent("2010-12-10 14:14:07");
return o}var u=l.DOM,r=true,n=false;l.app(t,l.EventTarget);t.Config.base=l.Config.base+"editor/";var j=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],i,b,d,e,g={};i=0;for(b=j.length;i<b;i++){d=j[i];if(l.isString(d))d=j[i]={name:d+"",requires:null};e=d.requires||[];d.requires=e.concat(["button"])}j=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar",{name:"contextmenu"},{name:"bubbleview"},{name:"select"}].concat(j);
i=0;for(b=j.length;i<b;i++){d=j[i];e=d.name||d;g[e]={attach:n,charset:"utf-8",requires:d.requires,csspath:d.useCss?v("plugins/"+e+"/plugin.css"):p,path:v("plugins/"+e+"/plugin.js")}}t.add(g);l.Editor=t;l.Editor=t});
KISSY.Editor.add("utils",function(l){var p=null,t=KISSY,v=t.Node,u=t.DOM,r=t.UA,n=t.Event,j;j=r.ie?document.documentMode||r.ie:void 0;var i={debugUrl:function(b){var d=t.Config.debug;b=d?d==="dev"?"../src/"+b:b:b.replace(/\.(js|css)/i,"-min.$1");b+=b.indexOf("?")!=-1?"&":"?";b+="t="+encodeURIComponent("2010-12-10 20:54:45");return b},lazyRun:function(b,d,e){var g=b[d],o=b[e];b[d]=function(){g.apply(this,arguments);b[d]=b[e];return o.apply(this,arguments)}},getXY:function(b,d,e,g){e=e.defaultView||
e.parentWindow;b-=u.scrollLeft(e);d-=u.scrollTop(e);if(g)if(e!=(g.defaultView||g.parentWindow)&&e.frameElement){g=u._4e_getOffset(e.frameElement,g);b+=g.left;d+=g.top}return{left:b,top:d}},tryThese:function(){for(var b,d=0,e=arguments.length;d<e;d++){var g=arguments[d];try{b=g();break}catch(o){}}return b},arrayCompare:function(b,d){if(!b&&!d)return true;if(!b||!d||b.length!=d.length)return false;for(var e=0;e<b.length;e++)if(b[e]!==d[e])return false;return true},getByAddress:function(b,d,e){b=b.documentElement;
for(var g=0;b&&g<d.length;g++){var o=d[g];if(e)for(var h=-1,a=0;a<b.childNodes.length;a++){var c=b.childNodes[a];if(!(e===true&&c.nodeType==3&&c.previousSibling&&c.previousSibling.nodeType==3)){h++;if(h==o){b=c;break}}}else b=b.childNodes[o]}return b?new v(b):p},clearAllMarkers:function(b){for(var d in b)b[d]._4e_clearMarkers(b,true)},htmlEncodeAttr:function(b){return b.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(b){return b.replace(/^\s+/,"")},rtrim:function(b){return b.replace(/\s+$/,
"")},trim:function(b){return this.ltrim(this.rtrim(b))},mix:function(){for(var b={},d=0;d<arguments.length;d++)b=t.mix(b,arguments[d]);return b},isCustomDomain:function(){if(!r.ie)return false;var b=document.domain,d=window.location.hostname;return b!=d&&b!="["+d+"]"},duplicateStr:function(b,d){return Array(d+1).join(b)},throttle:function(b,d,e){e=e||150;if(e===-1)return function(){b.apply(d,arguments)};var g=(new Date).getTime();return function(){var o=(new Date).getTime();if(o-g>e){g=o;b.apply(d,
arguments)}}},buffer:function(b,d,e){e=e||0;var g=p;return function(){g&&clearTimeout(g);var o=arguments;g=setTimeout(function(){return b.apply(d,o)},e)}},isNumber:function(b){return/^\d+(.\d+)?$/.test(t.trim(b))},verifyInputs:function(b){for(var d=0;d<b.length;d++){var e=u._4e_wrap(b[d]),g=t.trim(e.val()),o=e.attr("data-verify");e=e.attr("data-warning");if(o&&!RegExp(o).test(g)){alert(e);return false}}return true},sourceDisable:function(b,d){b.on("sourcemode",d.disable,d);b.on("wysiwygmode",d.enable,
d)},resetInput:function(b){var d=b.attr("placeholder");if(d&&!r.webkit){b.addClass("ke-input-tip");b.val(d)}else r.webkit&&b.val("")},valInput:function(b,d){b.removeClass("ke-input-tip");b.val(d)},placeholder:function(b,d){b.attr("placeholder",d);if(!r.webkit){b.on("blur",function(){if(!t.trim(b.val())){b.addClass("ke-input-tip");b.val(d)}});b.on("focus",function(){b.removeClass("ke-input-tip");t.trim(b.val())==d&&b.val("")})}},clean:function(b){b=b[0]||b;for(var d=t.makeArray(b.childNodes),e=0;e<
d.length;e++){var g=d[e];g.nodeType==l.NODE.NODE_TEXT&&!t.trim(g.nodeValue)&&b.removeChild(g)}},htmlEncode:function(b){return!b?b:String(b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(b){return!b?b:String(b).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(b,d){return b.toLowerCase()==d.toLowerCase()},normParams:function(b){b=t.clone(b);for(var d in b)if(b.hasOwnProperty(d)){var e=
b[d];if(t.isFunction(e))b[d]=e()}return b},doFormUpload:function(b,d,e){function g(){var x={responseText:"",responseXML:p};x.argument=b?b.argument:p;try{var q;if((q=r.ie?h.contentWindow.document:h.contentDocument||window.frames[o].document)&&q.body)x.responseText=q.body.innerHTML;x.responseXML=q&&q.XMLDocument?q.XMLDocument:q}catch(z){t.log(z)}n.remove(h,"load",g);b.callback&&b.callback(x);setTimeout(function(){u._4e_remove(h)},100)}var o=t.guid("form-upload-"),h=document.createElement("iframe");
h.id=o;h.name=o;h.className="ke-hidden";var a="document.open();"+(i.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(r.ie)h.src=r.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";t.log("doFormUpload : "+h.src);document.body.appendChild(h);if(r.ie)document.frames[o].name=o;a=u._4e_unwrap(b.form);var c={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=o;a.method="POST";a.enctype=a.encoding="multipart/form-data";
if(e)a.action=e;var f;if(d){f=[];d=l.Utils.normParams(d);for(var m in d)if(d.hasOwnProperty(m)){e=document.createElement("input");e.type="hidden";e.name=m;e.value=d[m];a.appendChild(e);f.push(e)}}n.on(h,"load",g);a.submit();a.target=c.target;a.method=c.method;a.enctype=c.enctype;a.encoding=c.encoding;a.action=c.action;if(f){d=0;for(m=f.length;d<m;d++)u._4e_remove(f[d])}return h},extern:function(b,d){for(var e in d)b[e]=d[e]},map:function(b,d){for(var e=0;e<b.length;e++)b[e]=d(b[e]);return b},ieEngine:j,
preventFocus:function(b){r.ie?b._4e_unselectable():b.attr("onmousedown","return false;")},isFlashEmbed:function(b){b=b.attributes;return b.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(b.src||"")}};l.Utils=i;l.Utils=i;r.ieEngine=i.ieEngine;i.extern(i,{debugUrl:i.debugUrl,lazyRun:i.lazyRun,getXY:i.getXY,tryThese:i.tryThese,arrayCompare:i.arrayCompare,getByAddress:i.getByAddress,clearAllMarkers:i.clearAllMarkers,htmlEncodeAttr:i.htmlEncodeAttr,ltrim:i.ltrim,rtrim:i.rtrim,trim:i.trim,
mix:i.mix,isCustomDomain:i.isCustomDomain,duplicateStr:i.duplicateStr,buffer:i.buffer,isNumber:i.isNumber,verifyInputs:i.verifyInputs,sourceDisable:i.sourceDisable,resetInput:i.resetInput,placeholder:i.placeholder,clean:i.clean,htmlEncode:i.htmlEncode,htmlDecode:i.htmlDecode,equalsIgnoreCase:i.equalsIgnoreCase,normParams:i.normParams,throttle:i.throttle,doFormUpload:i.doFormUpload,map:i.map})});
KISSY.Editor.add("dom",function(l){function p(a){return a.replace(/-(\w)/g,function(c,f){return f.toUpperCase()})}var t=KISSY,v=t.DOM,u=t.UA,r=t.Node,n=l.Utils,j={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};l.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};l.NODE=l.NODE;l.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};l.POSITION=l.POSITION;var i=l.NODE,b=l.POSITION,d={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},e={hr:1},g=function(a){return a[0]||a},o=function(a){if(a&&!a[0])return new r(a);return a},h={_4e_wrap:o,_4e_unwrap:g,_4e_equals:function(a,c){if(!a&&!c)return true;if(!a||!c)return false;a=g(a);c=g(c);
return a===c},_4e_isBlockBoundary:function(a,c){a=o(a);var f=t.mix(t.mix({},e),c||{});return d[a.css("display")]||f[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=g(a);for(var c=a.parentNode.childNodes,f=0;f<c.length;f++)if(c[f]===a)return f;return-1},_4e_first:function(a,c){a=g(a);var f=a.firstChild;if((f=f&&new r(f))&&c&&!c(f))f=f._4e_next(c);return f},_4e_move:function(a,c,f){a=g(a);v._4e_remove(a);
c=g(c);f?c.insertBefore(a,c.firstChild):c.appendChild(a)},_4e_name:function(a){a=g(a);var c=a.nodeName.toLowerCase();if(u.ie)if((a=a.scopeName)&&a!="HTML")c=a.toLowerCase()+":"+c;return c},_4e_isIdentical:function(a,c){if(a._4e_name()!=c._4e_name())return false;var f=a[0].attributes,m=c[0].attributes,x=f.length,q=m.length;if(x!=q)return false;for(var z=0;z<x;z++){var k=f[z],w=k.name;if(k.specified&&a.attr(w)!=c.attr(w))return false}if(n.ieEngine<8)for(z=0;z<q;z++){k=m[z];w=k.name;if(k.specified&&
a.attr(w)!=c.attr(w))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=g(a).childNodes;for(var c=0,f=a.length;c<f;c++){var m=a[c],x=m.nodeType;if(!(x==i.NODE_ELEMENT&&m.getAttribute("_ke_bookmark")))if(x==i.NODE_ELEMENT&&!h._4e_isEmptyInlineRemoveable(m)||x==i.NODE_TEXT&&t.trim(m.nodeValue))return false}return true},_4e_moveChildren:function(a,c,f){a=g(a);c=c[0]||c;if(a!=c)if(f)for(;f=a.lastChild;)c.insertBefore(a.removeChild(f),c.firstChild);else for(;f=a.firstChild;)c.appendChild(a.removeChild(f))},
_4e_mergeSiblings:function(){function a(c,f,m){if(f[0]&&f[0].nodeType==i.NODE_ELEMENT){for(var x=[];f.attr("_ke_bookmark")||f._4e_isEmptyInlineRemoveable();){x.push(f);f=m?new r(f[0].nextSibling):new r(f[0].previousSibling);if(!f[0]||f[0].nodeType!=i.NODE_ELEMENT)return}if(c._4e_isIdentical(f)){for(var q=m?c[0].lastChild:c[0].firstChild;x.length;)x.shift()._4e_move(c,!m);f._4e_moveChildren(c,!m);f._4e_remove();q[0]&&q[0].nodeType==i.NODE_ELEMENT&&q._4e_mergeSiblings()}}}return function(c){if(c[0])if(j[c._4e_name()]||
c._4e_name()=="a"){a(c,new r(c[0].nextSibling),true);a(c,new r(c[0].previousSibling))}}}(),_4e_unselectable:u.gecko?function(a){a=g(a);a.style.MozUserSelect="none"}:u.webkit?function(a){a=g(a);a.style.KhtmlUserSelect="none"}:function(a){a=g(a);if(u.ie||u.opera){var c=0;a.setAttribute("unselectable","on");for(var f=a.getElementsByTagName("*");a=f[c++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},_4e_getOffset:function(a,
c){a=g(a);var f,m=0;f=0;var x=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,q=a.ownerDocument,z=q.documentElement;c=c||q;if(a.getBoundingClientRect){if(a!==q.body&&z!==a){f=a.getBoundingClientRect();m=f.left+(c===q?v.scrollLeft(x):0);f=f.top+(c===q?v.scrollTop(x):0)}if(c)if(x!=(c.defaultView||c.parentWindow)&&x.frameElement){x=h._4e_getOffset(x.frameElement,c);m+=x.left;f+=x.top}}return{left:m,top:f}},_4e_getFrameDocument:function(a){return(a=g(a))&&a.contentWindow.document},_4e_splitText:function(a,
c){a=g(a);var f=a.ownerDocument;if(!(!a||a.nodeType!=i.NODE_TEXT)){if(u.ie&&c==a.nodeValue.length){var m=f.createTextNode("");v.insertAfter(m,a);return new r(m)}m=new r(a.splitText(c));if(f.documentMode){f=f.createTextNode("");v.insertAfter(f,m[0]);v._4e_remove(f)}return m}},_4e_parents:function(a,c){a=o(a);var f=[];do f[c?"push":"unshift"](a);while(a=a.parent());return f},_4e_clone:function(a,c,f){a=g(a);a=a.cloneNode(c);if(!f){var m=function(x){if(x.nodeType==i.NODE_ELEMENT){x.removeAttribute("id");
x=x.childNodes;for(var q=0;q<x.length;q++)m(x[q])}};m(a)}return new r(a)},_4e_nextSourceNode:function(a,c,f,m){a=g(a);if(m&&!m.call){var x=m[0]||m;m=function(z){z=z[0]||z;return z!==x}}c=!c&&a.firstChild;var q=new r(a);if(!c){if(a.nodeType==i.NODE_ELEMENT&&m&&m(a,true)===false)return null;c=a.nextSibling}for(;!c&&(q=q.parent());){if(m&&m(q,true)===false)return null;c=q[0].nextSibling}if(!c)return null;c=v._4e_wrap(c);if(m&&m(c)===false)return null;if(f&&f!=c[0].nodeType)return c._4e_nextSourceNode(false,
f,m);return c},_4e_previousSourceNode:function(a,c,f,m){a=g(a);if(m&&!m.call){var x=m[0]||m;m=function(z){z=z[0]||z;return z!==x}}c=!c&&a.lastChild;var q=new r(a);if(!c){if(a.nodeType==i.NODE_ELEMENT&&m&&m(a,true)===false)return null;c=a.previousSibling}for(;!c&&(q=q.parent());){if(m&&m(q,true)===false)return null;c=q[0].previousSibling}if(!c)return null;c=v._4e_wrap(c);if(m&&m(c)===false)return null;if(f&&c[0].nodeType!=f)return c._4e_previousSourceNode(false,f,m);return c},_4e_commonAncestor:function(a,
c){if(a._4e_equals(c))return a;if(c[0].nodeType!=i.NODE_TEXT&&c.contains(a))return c;var f=a[0].nodeType==i.NODE_TEXT?a.parent():a;do if(f[0].nodeType!=i.NODE_TEXT&&f.contains(c))return f;while(f=f.parent());return null},_4e_ascendant:function(a,c,f){a=g(a);if(!f)a=a.parentNode;if(c&&!t.isFunction(c)){var m=c;c=function(x){return x._4e_name()==m}}for(;a&&a.nodeType!=9;){if(!c||c(new r(a))===true)return new r(a);a=a.parentNode}return null},_4e_hasAttribute:n.ieEngine<9?function(a,c){a=g(a);var f=a.attributes[c];
return!!(f&&f.specified)}:function(a,c){a=g(a);return a.hasAttribute(c)},_4e_hasAttributes:n.ieEngine<9?function(a){a=g(a);for(var c=a.attributes,f=0;f<c.length;f++){var m=c[f];switch(m.name){case "class":if(a.getAttribute("class"))return true;break;default:if(m.specified)return true}}return false}:function(a){a=g(a);u.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},_4e_position:function(a,c){var f=g(a),m=g(c);if(f.compareDocumentPosition)return f.compareDocumentPosition(m);if(f==
m)return b.POSITION_IDENTICAL;if(f.nodeType==i.NODE_ELEMENT&&m.nodeType==i.NODE_ELEMENT){if(f.contains){if(f.contains(m))return b.POSITION_CONTAINS+b.POSITION_PRECEDING;if(m.contains(f))return b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING}if("sourceIndex"in f)return f.sourceIndex<0||m.sourceIndex<0?b.POSITION_DISCONNECTED:f.sourceIndex<m.sourceIndex?b.POSITION_PRECEDING:b.POSITION_FOLLOWING}f=a._4e_address();m=c._4e_address();for(var x=Math.min(f.length,m.length),q=0;q<=x-1;q++)if(f[q]!=m[q]){if(q<
x)return f[q]<m[q]?b.POSITION_PRECEDING:b.POSITION_FOLLOWING;break}return f.length<m.length?b.POSITION_CONTAINS+b.POSITION_PRECEDING:b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING},_4e_address:function(a,c){a=g(a);for(var f=[],m=a.ownerDocument.documentElement,x=a;x&&x!=m;){var q=x.parentNode,z=-1;if(q){for(var k=0;k<q.childNodes.length;k++){var w=q.childNodes[k];if(!(c&&w.nodeType==3&&w.previousSibling&&w.previousSibling.nodeType==3)){z++;if(w==x)break}}f.unshift(z)}x=q}return f},_4e_breakParent:function(a,
c){var f=new l.Range(a[0].ownerDocument);f.setStartAfter(a);f.setEndAfter(c);var m=f.extractContents();f.insertNode(a._4e_remove());a[0].parentNode.insertBefore(m,a[0].nextSibling)},_4e_style:function(a,c,f){a=o(a);if(f!==undefined)return a.css(c,f);a=g(a);return a.style[p(c)]},_4e_remove:function(a,c){var f=g(a),m=f.parentNode;if(m){if(c)for(var x;x=f.firstChild;)m.insertBefore(f.removeChild(x),f);m.removeChild(f)}return a},_4e_trim:function(a){v._4e_ltrim(a);v._4e_rtrim(a)},_4e_ltrim:function(a){a=
g(a);for(var c;c=a.firstChild;){if(c.nodeType==i.NODE_TEXT){var f=n.ltrim(c.nodeValue),m=c.nodeValue.length;if(f){if(f.length<m){(new r(c))._4e_splitText(m-f.length);a.removeChild(a.firstChild)}}else{a.removeChild(c);continue}}break}},_4e_rtrim:function(a){a=g(a);for(var c;c=a.lastChild;){if(c.type==i.NODE_TEXT){var f=n.rtrim(c.nodeValue),m=c.nodeValue.length;if(f){if(f.length<m){(new r(c))._4e_splitText(f.length);a.removeChild(a.lastChild)}}else{a.removeChild(c);continue}}break}if(!u.ie&&!u.opera)(c=
a.lastChild)&&c.nodeType==1&&c.nodeName.toLowerCase()=="br"&&c.parentNode.removeChild(c)},_4e_appendBogus:function(a){a=g(a);for(var c=a.lastChild;c&&c.nodeType==i.NODE_TEXT&&!t.trim(c.nodeValue);)c=c.previousSibling;if(!c||c.nodeType==i.NODE_TEXT||v._4e_name(c)!=="br"){c=u.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");u.gecko&&c.setAttribute("type","_moz");a.appendChild(c)}},_4e_previous:function(a,c){var f=g(a),m;do m=(f=f.previousSibling)&&new r(f);while(m&&c&&!c(m));
return m},_4e_last:function(a,c){a=v._4e_wrap(a);var f=a[0].lastChild;if((f=f&&new r(f))&&c&&!c(f))f=f._4e_previous(c);return f},_4e_next:function(a,c){var f=g(a),m;do m=(f=f.nextSibling)&&new r(f);while(m&&c&&!c(m));return m},_4e_outerHtml:function(a){a=g(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var c=a.ownerDocument.createElement("div");c.appendChild(a.cloneNode(true));return c.innerHTML},_4e_setMarker:function(a,c,f,m){a=v._4e_wrap(a);var x=a.data("list_marker_id")||a.data("list_marker_id",
t.guid()).data("list_marker_id"),q=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");c[x]=a;q[f]=1;return a.data(f,m)},_4e_clearMarkers:function(a,c,f){a=o(a);var m=a.data("list_marker_names"),x=a.data("list_marker_id"),q;for(q in m)a.removeData(q);a.removeData("list_marker_names");if(f){a.removeData("list_marker_id");delete c[x]}},_4e_copyAttributes:function(a,c,f){a=g(a);c=o(c);var m=a.attributes;f=f||{};for(var x=0;x<m.length;x++){var q=m[x],z=q.name.toLowerCase(),
k;if(!(z in f))if(z=="checked"&&(k=v.attr(a,z)))c.attr(z,k);else if(q.specified||u.ie&&q.value&&z=="value"){k=v.attr(a,z);if(k===null)k=q.nodeValue;c.attr(z,k)}}if(a.style.cssText!=="")c[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=v._4e_name(a);var c=l.XHTML_DTD;return(a=!c.$nonEditable[a]&&(c[a]||c.span))&&a["#"]},_4e_scrollIntoView:function(a){a=o(a);var c=a[0].ownerDocument,f=v.scrollLeft(c),m=v.scrollTop(c),x=a.offset(),q=x.left;x=x.top;if(v.viewportHeight(c)+m<x||x<m||v.viewportWidth(c)+
f<q||q<f)a.scrollIntoView(c)},_4e_getElementsByTagName:function(a,c,f){a=g(a);if(!u.ie&&f)c=f+":"+c;f=[];a=a.getElementsByTagName(c);for(c=0;c<a.length;c++)f.push(new r(a[c]));return f}};t.DOM._4e_inject=function(a){t.mix(v,a);for(var c in a)a.hasOwnProperty(c)&&function(f){r.prototype[f]=function(){var m=[].slice.call(arguments,0);m.unshift(this);return a[f].apply(null,m)}}(c)};n.extern(h,{_4e_wrap:h._4e_wrap,_4e_unwrap:h._4e_unwrap,_4e_equals:h._4e_equals,_4e_isBlockBoundary:h._4e_isBlockBoundary,
_4e_getWin:h._4e_getWin,_4e_index:h._4e_index,_4e_first:h._4e_first,_4e_move:h._4e_move,_4e_name:h._4e_name,_4e_isIdentical:h._4e_isIdentical,_4e_isEmptyInlineRemoveable:h._4e_isEmptyInlineRemoveable,_4e_moveChildren:h._4e_moveChildren,_4e_mergeSiblings:h._4e_mergeSiblings,_4e_unselectable:h._4e_unselectable,_4e_getOffset:h._4e_getOffset,_4e_getFrameDocument:h._4e_getFrameDocument,_4e_splitText:h._4e_splitText,_4e_parents:h._4e_parents,_4e_clone:h._4e_clone,_4e_nextSourceNode:h._4e_nextSourceNode,
_4e_previousSourceNode:h._4e_previousSourceNode,_4e_commonAncestor:h._4e_commonAncestor,_4e_ascendant:h._4e_ascendant,_4e_hasAttribute:h._4e_hasAttribute,_4e_hasAttributes:h._4e_hasAttributes,_4e_position:h._4e_position,_4e_address:h._4e_address,_4e_breakParent:h._4e_breakParent,_4e_style:h._4e_style,_4e_remove:h._4e_remove,_4e_trim:h._4e_trim,_4e_ltrim:h._4e_ltrim,_4e_rtrim:h._4e_rtrim,_4e_appendBogus:h._4e_appendBogus,_4e_last:h._4e_last,_4e_previous:h._4e_previous,_4e_next:h._4e_next,_4e_outerHtml:h._4e_outerHtml,
_4e_setMarker:h._4e_setMarker,_4e_clearMarkers:h._4e_clearMarkers,_4e_getUniqueId:h._4e_getUniqueId,_4e_copyAttributes:h._4e_copyAttributes,_4e_isEditable:h._4e_isEditable,_4e_scrollIntoView:h._4e_scrollIntoView,_4e_getElementsByTagName:h._4e_getElementsByTagName});v._4e_inject(h)});
KISSY.Editor.add("focusmanager",function(l){function p(){this.iframeFocus=b;j=this;v.log(this._UUID+" focus")}function t(){this.iframeFocus=d;j=e;v.log(this._UUID+" blur")}var v=KISSY,u=v.DOM,r=v.Event,n={},j,i={refreshAll:function(){for(var g in n){var o=n[g];o.document.designMode="off";o.document.designMode="on"}},currentInstance:function(){return j},getInstance:function(g){return n[g]},add:function(g){var o=u._4e_getWin(g.document);r.on(o,"focus",p,g);r.on(o,"blur",t,g)},register:function(g){n[g._UUID]=
g},remove:function(g){delete n[g._UUID];var o=u._4e_getWin(g.document);r.remove(o,"focus",p,g);r.remove(o,"blur",t,g)}},b=true,d=false,e=null;l.focusManager=i;l.focusManager=i;l.getInstances=function(){return n};l.getInstances=l.getInstances});
KISSY.Editor.add("definition",function(l){var p=true,t=false,v=l.Utils,u=document,r=KISSY,n=r.UA,j=r.DOM,i=r.Node,b=r.Event,d=l.focusManager,e=v.tryThese,g=v.debugUrl("theme/editor-iframe.css"),o=1,h="document.open();"+(v.isCustomDomain()?'document.domain="'+u.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(n.ie?"javascript:void(function(){"+encodeURIComponent(h)+"}())":"")+'"  tabIndex="'+(n.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";l.SOURCE_MODE=0;l.WYSIWYG_MODE=1;l.SOURCE_MODE=l.SOURCE_MODE;l.WYSIWYG_MODE=l.WYSIWYG_MODE;r.augment(l,{init:function(c){if(n.ie)j.addClass(u.body,"ke-ie"+n.ie);else if(n.gecko)j.addClass(u.body,"ke-gecko");else n.webkit&&j.addClass(u.body,"ke-webkit");var f=this,m=new i(a.replace(/\$\(tabIndex\)/,
c.attr("tabIndex")));f.editorWrap=m;f._UUID=o++;d.register(f);f.wrap=m.one(".ke-textarea-wrap");f.wrap=f.wrap;f.iframe=f.wrap.one("iframe");f.iframe=f.iframe;f.toolBarDiv=m.one(".ke-editor-tools");f.toolBarDiv=f.toolBarDiv;f.textarea=c;f.textarea=f.textarea;f.statusDiv=m.one(".ke-editor-status");f.statusDiv=f.statusDiv;v.preventFocus(f.toolBarDiv);f._commands={};f._dialogs={};var x=c._4e_style("width"),q=c._4e_style("height");if(x){m.css("width",x);c.css("width","100%")}f.textarea.css("display","none");
m.insertAfter(c);f.wrap[0].appendChild(c[0]);if(q){f.wrap.css("height",q);c.css("height","100%")}m=f.iframe;f.on("dataReady",function(){f._ready=p;l.fire("instanceCreated",{editor:f})});n.gecko?m.on("load",f._setUpIFrame,f):f._setUpIFrame();f.cfg.attachForm&&c[0].form&&f._attachForm()},_attachForm:function(){(new i(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(c,f){var m=this,x=l.Overlay;x.loading();m.use(c,function(){var q=m.getDialog(c);if(q){f(q);x.unloading()}else r.later(arguments.callee,
50,false,m)})},addDialog:function(c,f){this._dialogs[c]=f},getDialog:function(c){return this._dialogs[c]},addCommand:function(c,f){this._commands[c]=f},hasCommand:function(c){return this._commands[c]},execCommand:function(c){var f=this._commands[c],m=r.makeArray(arguments);m.shift();m.unshift(this);return f.exec.apply(f,m)},getMode:function(){return this.textarea.css("display")=="none"?l.WYSIWYG_MODE:l.SOURCE_MODE},getData:function(c){var f;f=this.getMode()==l.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)f=c?this.htmlDataProcessor.toHtml(f,"p"):this.htmlDataProcessor.toServer(f,"p");f=r.trim(f);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(f))f="";return f},setData:function(c){var f=c;if(this.htmlDataProcessor)f=this.htmlDataProcessor.toDataFormat(c,"p");this.document.body.innerHTML=f;this.getMode()!=l.WYSIWYG_MODE&&this.textarea.val(c)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(c){c=c||0;return c+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(c){this.document.body.innerHTML=c},_prepareIFrameHtml:function(c){var f=this.cfg,m=f.customLink,x="";if(m)for(var q=0;q<m.length;q++)x+='<link href="'+m[q]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+l.Config.base+g+"' rel='stylesheet'/><style>"+(f.customStyle||"")+"</style>"+x+"</head><body class='ke-editor'>&nbsp;"+(c?'<script id="ke_actscript" type="text/javascript">'+(v.isCustomDomain()?'document.domain="'+u.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+c+'");<\/script>':"")+"</body></html>"},getSelection:function(){return l.Selection.getSelection(this.document)},focus:function(){var c=this.document,f=j._4e_getWin(c);n.webkit&&f&&f.parent&&f.parent.focus();n.webkit&&f&&f.focus();c&&c.body.focus();this.notifySelectionChange()},blur:function(){j._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(c){var f=this.cfg,m=this.document;f.customStyle=f.customStyle||
"";f.customStyle+="\n"+c;f=m.createElement("style");m.getElementsByTagName("head")[0].appendChild(f);if(f.styleSheet)f.styleSheet.cssText=c;else f.appendChild(m.createTextNode(c))},addCustomLink:function(c){var f=this.cfg,m=this.document;f.customLink=f.customLink||[];f.customLink.push(c);f=m.createElement("link");f.rel="stylesheet";m.getElementsByTagName("head")[0].appendChild(f);f.href=c},removeCustomLink:function(c){for(var f=this.cfg,m=r.makeArray(this.document.getElementsByTagName("link")),x=
0;x<m.length;x++)m[x].href==c&&j._4e_remove(m[x]);f.customLink=f.customLink||[];f=f.customLink;c=r.indexOf(c,f);c!=-1&&f.splice(c,1)},_setUpIFrame:function(){function c(){z=q.document;f.document=z;m.detach();z.open("text/html","replace");z.write(x);z.close()}var f=this,m=f.iframe,x=f._prepareIFrameHtml(f._UUID),q=m[0].contentWindow,z;try{z=q.document}catch(k){m[0].src=m[0].src;if(n.ie<7){setTimeout(c,10);return}}c()},ready:function(c){this._ready?c():this.on("dataReady",c)},_monitor:function(){var c=
this;c._monitorId&&clearTimeout(c._monitorId);c._monitorId=setTimeout(function(){var f=c.getSelection();if(f&&!f.isInvalid){var m=f.getStartElement(),x=new l.ElementPath(m);if(!c.previousPath||!c.previousPath.compare(x)){c.previousPath=x;c.fire("selectionChange",{selection:f,path:x,element:m})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(c,f){var m=this,x;m.focus();setTimeout(function(){var q=c._4e_name(),z=l.XHTML_DTD,k=l.RANGE,w=l.NODE,
D=z.$block[q],B=m.getSelection(),s=B&&B.getRanges(),y,A,E,C;if(!s||s.length==0){var F=arguments,M=F.callee;setTimeout(function(){M.apply(m,F)},30)}else{m.fire("save");for(var P=s.length-1;P>=0;P--){y=s[P];y.deleteContents();x=!P&&c||c._4e_clone(p);f&&f(x);if(D)for(;(E=y.getCommonAncestor(t,p))&&(C=z[E._4e_name()])&&!(C&&C[q]);)if(E._4e_name()in z.span)y.splitElement(E);else if(y.checkStartOfBlock()&&y.checkEndOfBlock()){y.setStartBefore(E);y.collapse(p);E._4e_remove()}else y.splitBlock();y.insertNode(x);
A||(A=x)}if(A){q=A._4e_nextSourceNode(p);z=m.document;C=l.XHTML_DTD;if(C.$inline[x._4e_name()]){q=new i(z.createTextNode(" "));q.insertAfter(A)}else if(q){if(q._4e_name()=="br"&&C[q.parent()._4e_name()].p){C=new i("<p>&nbsp;</p>",null,z);q[0].parentNode.replaceChild(C[0],q[0]);q=C}}else{C=new i("<p>&nbsp;</p>",null,z);C.insertAfter(A);q=C}y.moveToPosition(A,k.POSITION_AFTER_END);q&&q[0].nodeType==w.NODE_ELEMENT&&y.moveToElementEditablePosition(q);B.selectRanges([y]);m.focus();x&&x._4e_scrollIntoView();
setTimeout(function(){m.fire("save")},10)}}},0);return x},insertHtml:function(c){var f=this;if(f.htmlDataProcessor)c=f.htmlDataProcessor.toDataFormat(c);if(n.webkit){var m=j.create(c,null,this.document);m=m.nodeType==11?r.makeArray(m.childNodes):[m];for(var x=0;x<m.length;x++)f.insertElement(new i(m[x]))}else{f.focus();setTimeout(function(){var q=f.getSelection(),z=q&&q.getRanges();if(!z||z.length==0){var k=arguments,w=k.callee;setTimeout(function(){w.apply(f,k)},30)}else{f.fire("save");if(n.ie){q=
q.getNative();q.type=="Control"&&q.clear();q.createRange().pasteHTML(c)}else f.document.execCommand("inserthtml",t,c);f.focus();setTimeout(function(){f.fire("save")},10)}},0)}}});l._initIFrame=function(c){function f(y){e(function(){q.designMode="on";setTimeout(function(){q.designMode="off";w.focus();if(!arguments.callee.retry)arguments.callee.retry=p},50)},function(){q.designMode="off";j.attr(w,"contentEditable",t);j.attr(w,"contentEditable",p);!y&&f(1)})}var m=d.getInstance(c);c=m.textarea[0];var x=
m.iframe[0].contentWindow,q=m.document,z=m.cfg,k=q.getElementById("ke_actscript");j._4e_remove(k);var w=q.body;if(n.ie){w.hideFocus=p;w.disabled=p;w.contentEditable=p;w.removeAttribute("disabled")}else setTimeout(function(){if(n.gecko||n.opera)w.contentEditable=p;else if(n.webkit)w.parentNode.contentEditable=p;else q.designMode="on"},0);if(n.webkit){b.on(q,"click",function(y){var A=new i(y.target);r.inArray(A._4e_name(),["input","select"])&&y.preventDefault()});b.on(q,"mouseup",function(y){var A=
new i(y.target);r.inArray(A._4e_name(),["input","textarea"])&&y.preventDefault()})}if(n.gecko||n.ie||n.opera){var D;D=new i(j.insertAfter((new i('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],c));D.on("focus",function(){m.focus()});m.activateGecko=function(){n.gecko&&m.iframeFocus&&D[0].focus()};m.on("destroy",function(){})}if(n.ie&&q.compatMode=="CSS1Compat"||n.gecko||n.opera){var B=new i(q.documentElement);B.on("mousedown",function(y){if((new i(y.target))[0]==
B[0]){n.gecko&&f(t);D[0].focus()}})}b.on(x,"focus",function(){if(n.gecko)f(t);else n.opera&&w.focus();m.notifySelectionChange()});n.gecko&&b.on(m.document,"mousedown",function(){m.iframeFocus||f(t)});if(n.ie){b.on(q,"keydown",function(y){if(y.keyCode in{8:1,46:1}){var A=m.getSelection(),E=A.getSelectedElement();if(E){m.fire("save");var C=A.getRanges()[0].createBookmark();E._4e_remove();A.selectBookmarks([C]);m.fire("save");y.preventDefault()}}});if(q.compatMode=="CSS1Compat"){var s={33:1,34:1};b.on(q,
"keydown",function(y){y.keyCode in s&&setTimeout(function(){m.getSelection().scrollIntoView()},0)})}}setTimeout(function(){n.ie&&setTimeout(function(){if(q){w.runtimeStyle.marginBottom="0px";w.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){m.fire("dataReady");var y=z.disableObjectResizing,A=z.disableInlineTableEditing;if(y||A)try{q.execCommand("enableObjectResizing",t,!y);q.execCommand("enableInlineTableEditing",t,!A)}catch(E){b.on(w,n.ie?"resizestart":"resize",function(C){var F=new i(C.target);
if(y||F._4e_name()==="table"&&A)C.preventDefault()})}},10);n.webkit&&b.on(q,"mousedown",function(y){y=new i(y.target);r.inArray(y._4e_name(),["img","hr","input","textarea","select"])&&m.getSelection().selectElement(y)});n.gecko&&b.on(q,"dragstart",function(y){var A=new i(y.target);A._4e_name()==="img"&&/ke_/.test(A[0].className)&&y.preventDefault()});d.add(m)};h=l.prototype;v.extern(h,{setData:h.setData,getData:h.getData,insertElement:h.insertElement,insertHtml:h.insertHtml,ready:h.ready,addCustomStyle:h.addCustomStyle,
addCommand:h.addCommand,hasCommand:h.hasCommand,execCommand:h.execCommand,useDialog:h.useDialog,addDialog:h.addDialog,getDialog:h.getDialog,getMode:h.getMode,sync:h.sync,baseZIndex:h.baseZIndex,getSelection:h.getSelection,focus:h.focus,blur:h.blur,notifySelectionChange:h.notifySelectionChange})});
KISSY.Editor.add("zindex",function(){var l=KISSY.Editor;if(!l.zIndexManager){l.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};l.baseZIndex=function(p){var t=p,v=l.getInstances(),u;for(u in v){if(!v.hasOwnProperty(u))return;t=Math.max(t,v[u].baseZIndex(p))}return t};l.baseZIndex=l.baseZIndex;l.zIndexManager=l.zIndexManager}});
KISSY.Editor.add("dtd",function(l){l.XHTML_DTD=function(){function p(z){for(var k=arguments.length-1;k>0;)KISSY.mix(z,arguments[k--]);return z}var t={isindex:1,fieldset:1},v={input:1,button:1,select:1,textarea:1,label:1},u=p({a:1},v),r=p({iframe:1},u),n={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},i=p({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),b=p({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),d=p({p:1},b);v=p({iframe:1},b,v);b={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=p({a:1},v),g={tr:1},o={"#":1},h=p({param:1},b),a=p({form:1},t,r,n,d),c={li:1},f={base:1,link:1,meta:1,title:1},m=p(f,{style:1,script:1}),x={head:1,body:1},q={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:p({html:1},x,f),$block:q,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:e,$body:p({script:1,style:1},q),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:x,head:m,style:o,body:a,base:{},link:{},meta:{},title:o,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:p(d,n),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:c,h1:e,h3:e,option:o,h2:e,form:p(t,r,n,d),select:{optgroup:1,option:1},font:e,ins:e,menu:c,abbr:e,label:e,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:o,tfoot:g,cite:e,li:a,input:{},iframe:a,strong:e,textarea:o,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:h,sup:e,dd:a,strike:e,area:{},dir:c,map:p({area:1,form:1,p:1},t,j,n),applet:h,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:p({legend:1},b),thead:g,ul:c,acronym:e,b:e,a:v,blockquote:a,caption:e,i:e,u:e,tbody:g,s:e,address:p(r,d),tt:e,legend:e,q:e,pre:p(i,u),p:e,em:e,dfn:e}}();l.XHTML_DTD=
l.XHTML_DTD});
KISSY.Editor.add("elementpath",function(l){function p(b){var d=r,e=r,g=[];for(b=b;b&&b[0];){if(b[0].nodeType==u.NODE_ELEMENT){if(!this.lastElement)this.lastElement=b;var o=b._4e_name();if(!e){if(!d&&n[o])d=b;if(j[o]){var h;if(h=!d){if(h=o=="div"){a:{h=b;h=h[0]||h;h=h.childNodes;for(var a=0,c=h.length;a<c;a++){var f=h[a];if(f.nodeType==u.NODE_ELEMENT&&v.$block[f.nodeName.toLowerCase()]){h=true;break a}}h=false}h=!h}h=h}if(h)d=b;else e=b}}g.push(b);if(o=="body")break}b=b.parent()}this.block=this.block=
d;this.blockLimit=this.blockLimit=e;this.elements=this.elements=g}var t=KISSY.DOM,v=l.XHTML_DTD,u=l.NODE,r=null,n={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};p.prototype={compare:function(b){var d=this.elements;b=b&&b.elements;if(!b||d.length!=b.length)return false;for(var e=0;e<d.length;e++)if(!t._4e_equals(d[e],b[e]))return false;return true},contains:function(b){for(var d=this.elements,e=0;e<
d.length;e++)if(d[e]._4e_name()in b)return d[e];return r}};l.ElementPath=l.ElementPath=p;var i=p.prototype;l.Utils.extern(i,{compare:i.compare,contains:i.contains})});
KISSY.Editor.add("walker",function(l){function p(g,o){if(this._.end)return n;var h,a=this.range,c,f=this.guard,m=this.type,x=g?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;a.trim();if(a.collapsed){this.end();return n}}if(!g&&!this._.guardLTR){var q=a.endContainer,z=new d(q[0].childNodes[a.endOffset]);this._.guardLTR=function(B,s){return(B=b._4e_wrap(B))&&B[0]&&(!s||!b._4e_equals(q,B))&&(!z[0]||!B._4e_equals(z))&&(B[0].nodeType!=i.NODE_ELEMENT||!s||B._4e_name()!="body")}}if(g&&
!this._.guardRTL){var k=a.startContainer,w=a.startOffset>0&&new d(k[0].childNodes[a.startOffset-1]);this._.guardRTL=function(B,s){return(B=b._4e_wrap(B))&&B[0]&&(!s||!B._4e_equals(k))&&(!w[0]||!B._4e_equals(w))&&(B[0].nodeType!=i.NODE_ELEMENT||!s||B._4e_name()!="body")}}var D=g?this._.guardRTL:this._.guardLTR;c=f?function(B,s){if(D(B,s)===r)return r;return f(B,s)}:D;if(this.current)h=this.current[x](r,m,c);else if(g){h=a.endContainer;if(a.endOffset>0){h=new d(h[0].childNodes[a.endOffset-1]);if(c(h)===
r)h=n}else h=c(h,u)===r?n:h._4e_previousSourceNode(u,m,c)}else{h=a.startContainer;if((h=new d(h[0].childNodes[a.startOffset]))&&h[0]){if(c(h)===r)h=n}else h=c(a.startContainer,u)===r?n:a.startContainer._4e_nextSourceNode(u,m,c)}for(;h&&h[0]&&!this._.end;){this.current=h;if(!this.evaluator||this.evaluator(h)!==r){if(!o)return h}else if(o&&this.evaluator)return r;h=h[x](r,m,c)}this.end();return this.current=n}function t(g){for(var o,h=n;o=p.call(this,g);)h=o;return h}function v(g){this.range=g;this._=
{}}var u=true,r=false,n=null,j=KISSY,i=l.NODE,b=j.DOM,d=j.Node;j.augment(v,{end:function(){this._.end=1},next:function(){return p.call(this)},previous:function(){return p.call(this,u)},checkForward:function(){return p.call(this,r,u)!==r},checkBackward:function(){return p.call(this,u,u)!==r},lastForward:function(){return t.call(this)},lastBackward:function(){return t.call(this,u)},reset:function(){delete this.current;this._={}}});v.blockBoundary=function(g){return function(o){o=b._4e_wrap(o);return!(o&&
o[0].nodeType==i.NODE_ELEMENT&&o._4e_isBlockBoundary(g))}};v.listItemBoundary=function(){return this.blockBoundary({br:1})};v.bookmark=function(g,o){function h(a){return a&&a[0]&&a._4e_name()=="span"&&a.attr("_ke_bookmark")}return function(a){var c,f;c=a&&a[0]&&a[0].nodeType==i.NODE_TEXT&&(f=a.parent())&&h(f);c=g?c:c||h(a);return o^c}};v.whitespaces=function(g){return function(o){o=(o=o[0]||o)&&o.nodeType==i.NODE_TEXT&&!j.trim(o.nodeValue);return g^o}};v.invisible=function(g){var o=v.whitespaces();
return function(h){h=o(h)||h[0].nodeType==i.NODE_ELEMENT&&!h[0].offsetHeight;return g^h}};l.Walker=v;l.Walker=v;var e=v.prototype;l.Utils.extern(e,{end:e.end,next:e.next,previous:e.previous,checkForward:e.checkForward,checkBackward:e.checkBackward,lastForward:e.lastForward,lastBackward:e.lastBackward,reset:e.reset});l.Utils.extern(v,{blockBoundary:v.blockBoundary,listItemBoundary:v.listItemBoundary,bookmark:v.bookmark,whitespaces:v.whitespaces,invisible:v.invisible})});
KISSY.Editor.add("range",function(l){function p(s){this.endOffset=this.endContainer=this.startOffset=this.startContainer=b;this.collapsed=j;this.document=s}function t(s){var y=s[0].nodeType!=e.NODE_TEXT&&s._4e_name()in m.$removeEmpty,A=!d.trim(s[0].nodeValue);s=!!s.parent().attr("_ke_bookmark");return y||A||s}function v(s){return!w(s)&&!D(s)}function u(s){var y=i,A=h.bookmark(j);return function(E){if(A(E))return j;if(E[0].nodeType==e.NODE_TEXT){if(d.trim(E[0].nodeValue).length)return i}else if(E[0].nodeType==
e.NODE_ELEMENT)if(!k[E._4e_name()])if(!s&&!f.ie&&E._4e_name()=="br"&&!y)y=j;else return i;return j}}function r(s,y){function A(E){return E&&E.nodeName=="span"&&E.getAttribute("_ke_bookmark")}return function(E){var C,F;C=E&&!E.nodeName&&(F=E.parentNode)&&A(F);C=s?C:C||A(E);return y^C}}function n(s){return function(y){y=(y=y[0]||y)&&y.nodeType==e.NODE_TEXT&&!d.trim(y.nodeValue);return s^y}}l.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};l.RANGE=l.RANGE;var j=true,i=false,b=null,d=KISSY,e=l.NODE,g=l.RANGE,o=l.POSITION,h=l.Walker,a=d.DOM,c=l.Utils.getByAddress,f=d.UA,m=l.XHTML_DTD,x=l.ElementPath,q=d.Node,z={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};p.prototype.toString=function(){var s=[];s.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);s.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return s.join("<br/>")};d.augment(p,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&a._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var s=this.startContainer,y=this.startOffset;if(s[0].nodeType!=e.NODE_ELEMENT)if(y)y>=s[0].nodeValue.length&&this.setStartAfter(s);else this.setStartBefore(s);s=this.endContainer;y=this.endOffset;if(s[0].nodeType!=e.NODE_ELEMENT)if(y)y>=
s[0].nodeValue.length&&this.setEndAfter(s);else this.setEndBefore(s)},setStartAfter:function(s){this.setStart(s.parent(),s._4e_index()+1)},setStartBefore:function(s){this.setStart(s.parent(),s._4e_index())},setEndAfter:function(s){this.setEnd(s.parent(),s._4e_index()+1)},setEndBefore:function(s){this.setEnd(s.parent(),s._4e_index())},optimizeBookmark:function(){var s=this.startContainer,y=this.endContainer;s&&s._4e_name()=="span"&&s.attr("_ke_bookmark")&&this.setStartAt(s,g.POSITION_BEFORE_START);
y&&y._4e_name()=="span"&&y.attr("_ke_bookmark")&&this.setEndAt(y,g.POSITION_AFTER_END)},setStart:function(s,y){if(s[0].nodeType==e.NODE_ELEMENT&&z[s._4e_name()]){s=s.parent();y=s._4e_index()}this.startContainer=s;this.startOffset=y;if(!this.endContainer){this.endContainer=s;this.endOffset=y}this.updateCollapsed()},setEnd:function(s,y){if(s[0].nodeType==e.NODE_ELEMENT&&z[s._4e_name()]){s=s.parent();y=s._4e_index()+1}this.endContainer=s;this.endOffset=y;if(!this.startContainer){this.startContainer=
s;this.startOffset=y}this.updateCollapsed()},setStartAt:function(s,y){switch(y){case g.POSITION_AFTER_START:this.setStart(s,0);break;case g.POSITION_BEFORE_END:s[0].nodeType==e.NODE_TEXT?this.setStart(s,s[0].nodeValue.length):this.setStart(s,s[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setStartBefore(s);break;case g.POSITION_AFTER_END:this.setStartAfter(s)}this.updateCollapsed()},setEndAt:function(s,y){switch(y){case g.POSITION_AFTER_START:this.setEnd(s,0);break;case g.POSITION_BEFORE_END:s[0].nodeType==
e.NODE_TEXT?this.setEnd(s,s[0].nodeValue.length):this.setEnd(s,s[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setEndBefore(s);break;case g.POSITION_AFTER_END:this.setEndAfter(s)}this.updateCollapsed()},execContentsAction:function(s,y){var A=this.startContainer,E=this.endContainer,C=this.startOffset,F=this.endOffset,M,P=this.document,L;this.optimizeBookmark();if(E[0].nodeType==e.NODE_TEXT)E=E._4e_splitText(F);else if(E[0].childNodes.length>0)if(F>=E[0].childNodes.length){E=new q(E[0].appendChild(P.createTextNode("")));
L=j}else E=new q(E[0].childNodes[F]);if(A[0].nodeType==e.NODE_TEXT){A._4e_splitText(C);if(A._4e_equals(E))E=new q(A[0].nextSibling)}else if(C)if(C>=A[0].childNodes.length){M=new q(P.createTextNode(""));A.append(M);A=M;M=j}else A=new q(A[0].childNodes[C].previousSibling);else{M=new q(P.createTextNode(""));A.prepend(M);A=M;M=j}C=A._4e_parents();F=E._4e_parents();var Q,S,U;for(Q=0;Q<C.length;Q++){S=C[Q];U=F[Q];if(!S._4e_equals(U))break}P=y;for(var T,V,G,K=Q;K<C.length;K++){T=C[K];V=P&&!T._4e_equals(A)?
P.appendChild(T._4e_clone()[0]):null;for(T=T[0].nextSibling;T;){if(a._4e_equals(F[K],T)||a._4e_equals(E,T))break;G=T.nextSibling;if(s==2)P.appendChild(T.cloneNode(j));else{a._4e_remove(T);s==1&&P.appendChild(T)}T=G}if(V)P=V}P=y;for(Q=Q;Q<F.length;Q++){T=F[Q];V=P&&s>0&&!T._4e_equals(E)?P.appendChild(T._4e_clone()[0]):null;if(!C[Q]||!T.parent()._4e_equals(C[Q].parent()))for(T=T[0].previousSibling;T;){if(a._4e_equals(C[Q],T)||a._4e_equals(A,T))break;G=T.previousSibling;if(s==2)P.insertBefore(T.cloneNode(j),
P.firstChild);else{a._4e_remove(T);s==1&&P.insertBefore(T,P.firstChild)}T=G}if(V)P=V}if(s==2){U=this.startContainer[0];if(U.nodeType==e.NODE_TEXT&&U.nextSibling&&U.nextSibling.nodeType==e.NODE_TEXT){U.data+=U.nextSibling.data;U.parentNode.removeChild(U.nextSibling)}U=this.endContainer[0];if(U.nodeType==e.NODE_TEXT&&U.nextSibling&&U.nextSibling.nodeType==e.NODE_TEXT){U.data+=U.nextSibling.data;U.parentNode.removeChild(U.nextSibling)}}else{if(S&&U&&(!A.parent()._4e_equals(S.parent())||!E.parent()._4e_equals(U.parent()))){S=
U._4e_index();M&&U.parent()._4e_equals(A.parent())&&S--;this.setStart(U.parent(),S)}this.collapse(j)}M&&A._4e_remove();L&&E[0].parentNode&&E._4e_remove()},collapse:function(s){if(s){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=j},clone:function(){var s=new p(this.document);s.startContainer=this.startContainer;s.startOffset=this.startOffset;s.endContainer=this.endContainer;s.endOffset=
this.endOffset;s.collapsed=this.collapsed;return s},getEnclosedNode:function(){var s=this.clone();s.optimize();if(s.startContainer[0].nodeType!=e.NODE_ELEMENT||s.endContainer[0].nodeType!=e.NODE_ELEMENT)return b;var y=new l.Walker(s),A=r(j,undefined),E=n(j);s.evaluator=function(C){return E(C)&&A(C)};s=y.next();y.reset();y=y.previous();return s&&s._4e_equals(y)?s:b},shrink:function(s,y){if(!this.collapsed){s=s||g.SHRINK_TEXT;var A=this.clone(),E=this.startContainer,C=this.endContainer,F=this.startOffset,
M=this.endOffset,P=1,L=1;if(E&&E[0].nodeType==e.NODE_TEXT)if(F)if(F>=E[0].nodeValue.length)A.setStartAfter(E);else{A.setStartBefore(E);P=0}else A.setStartBefore(E);if(C&&C[0].nodeType==e.NODE_TEXT)if(M)if(M>=C[0].nodeValue.length)A.setEndAfter(C);else{A.setEndAfter(C);L=0}else A.setEndBefore(C);A=new h(A);A.evaluator=function(S){S=S[0]||S;return S.nodeType==(s==g.SHRINK_ELEMENT?e.NODE_ELEMENT:e.NODE_TEXT)};var Q;A.guard=function(S,U){S=S[0]||S;if(s==g.SHRINK_ELEMENT&&S.nodeType==e.NODE_TEXT)return i;
if(U&&S==Q)return i;if(!U&&S.nodeType==e.NODE_ELEMENT)Q=S;return j};if(P)(E=A[s==g.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(E,y?g.POSITION_AFTER_START:g.POSITION_BEFORE_START);if(L){A.reset();(A=A[s==g.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(A,y?g.POSITION_BEFORE_END:g.POSITION_AFTER_END)}return!!(P||L)}},getTouchedStartNode:function(){var s=this.startContainer;if(this.collapsed||s[0].nodeType!=e.NODE_ELEMENT)return s;return s.childNodes[this.startOffset]||s},createBookmark2:function(s){var y=
this.startContainer,A=this.endContainer,E=this.startOffset,C=this.endOffset,F,M;if(!y||!A)return{start:0,end:0};if(s){if(y[0].nodeType==e.NODE_ELEMENT)if((F=new q(y[0].childNodes[E]))&&F[0]&&F[0].nodeType==e.NODE_TEXT&&E>0&&F[0].previousSibling.nodeType==e.NODE_TEXT){y=F;E=0}for(;y[0].nodeType==e.NODE_TEXT&&(M=y._4e_previous())&&M[0].nodeType==e.NODE_TEXT;){y=M;E+=M[0].nodeValue.length}if(!this.collapsed){if(A[0].nodeType==e.NODE_ELEMENT)if((F=new q(A[0].childNodes[C]))&&F[0]&&F[0].nodeType==e.NODE_TEXT&&
C>0&&F[0].previousSibling.nodeType==e.NODE_TEXT){A=F;C=0}for(;A[0].nodeType==e.NODE_TEXT&&(M=A._4e_previous())&&M[0].nodeType==e.NODE_TEXT;){A=M;C+=M[0].nodeValue.length}}}return{start:y._4e_address(s),end:this.collapsed?b:A._4e_address(s),startOffset:E,endOffset:C,normalized:s,is2:j}},createBookmark:function(s){var y,A,E,C,F=this.collapsed;y=new q("<span>",b,this.document);y.attr("_ke_bookmark",1);y.css("display","none");y.html("&nbsp;");if(s){E=d.guid("ke_bm_");y.attr("id",E+"S")}if(!F){A=y._4e_clone();
A.html("&nbsp;");s&&A.attr("id",E+"E");C=this.clone();C.collapse();C.insertNode(A)}C=this.clone();C.collapse(j);C.insertNode(y);if(A){this.setStartAfter(y);this.setEndBefore(A)}else this.moveToPosition(y,g.POSITION_AFTER_END);return{startNode:s?E+"S":y,endNode:s?E+"E":A,serializable:s,collapsed:F}},moveToPosition:function(s,y){this.setStartAt(s,y);this.collapse(j)},trim:function(s,y){var A=this.startContainer,E=this.startOffset,C=this.collapsed;if((!s||C)&&A[0]&&A[0].nodeType==e.NODE_TEXT){if(E)if(E>=
A[0].nodeValue.length){E=A._4e_index()+1;A=A.parent()}else{var F=A._4e_splitText(E);E=A._4e_index()+1;A=A.parent();if(a._4e_equals(this.startContainer,this.endContainer))this.setEnd(F,this.endOffset-this.startOffset);else if(a._4e_equals(A,this.endContainer))this.endOffset+=1}else{E=A._4e_index();A=A.parent()}this.setStart(A,E);if(C){this.collapse(j);return}}A=this.endContainer;E=this.endOffset;if(!(y||C)&&A[0]&&A[0].nodeType==e.NODE_TEXT){if(E){E>=A.nodeValue.length||A._4e_splitText(E);E=A._4e_index()+
1}else E=A._4e_index();A=A.parent();this.setEnd(A,E)}},insertNode:function(s){this.optimizeBookmark();this.trim(i,j);var y=this.startContainer;y[0].insertBefore(s[0]||s,y[0].childNodes[this.startOffset]||null);a._4e_equals(s.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(s)},moveToBookmark:function(s){if(s.is2){var y=c(this.document,s.start,s.normalized),A=s.startOffset,E=s.end&&c(this.document,s.end,s.normalized);s=s.endOffset;this.setStart(y,A);E?this.setEnd(E,s):this.collapse(j)}else{y=
(A=s.serializable)?d.one("#"+s.startNode,this.document):s.startNode;s=A?d.one("#"+s.endNode,this.document):s.endNode;this.setStartBefore(y);y._4e_remove();if(s&&s[0]){this.setEndBefore(s);s._4e_remove()}else this.collapse(j)}},getCommonAncestor:function(s,y){var A=this.startContainer,E=this.endContainer;A=a._4e_equals(A,E)?s&&A[0].nodeType==e.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new q(A[0].childNodes[this.startOffset]):A:A._4e_commonAncestor(E);return y&&A[0].nodeType==e.NODE_TEXT?A.parent():
A},enlarge:function(s){switch(s){case g.ENLARGE_ELEMENT:if(this.collapsed)break;s=this.getCommonAncestor();var y=new q(this.document.body),A,E,C,F,M,P=i,L,Q;L=this.startContainer;Q=this.startOffset;if(L[0].nodeType==e.NODE_TEXT){if(Q){L=!d.trim(L[0].nodeValue.substring(0,Q)).length&&L;P=!!L}if(L)if(!(F=L[0].previousSibling))C=L.parent()}else{if(Q)F=L[0].childNodes[Q-1]||L[0].lastChild;F||(C=L)}for(;C||F;){if(C&&!F){if(!M&&a._4e_equals(C,s))M=j;if(!y.contains(C))break;if(!P||C.css("display")!="inline"){P=
i;if(M)A=C;else this.setStartBefore(C)}F=C[0].previousSibling}for(;F;){L=i;if(F.nodeType==e.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=b;L=/[\s\ufeff]$/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&m.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=b;else for(var S=F.all||F.getElementsByTagName("*"),U=0,T;T=S[U++];)if(!m.$removeEmpty[T.nodeName.toLowerCase()]){F=b;break}if(F)L=!!Q.length}else F=b;if(L)if(P)if(M)A=C;else C&&this.setStartBefore(C);
else P=j;if(F){L=F.previousSibling;if(!C&&!L){C=new q(F);F=b;break}F=L}else C=b}if(C)C=C.parent()}L=this.endContainer;Q=this.endOffset;C=F=b;M=P=i;if(L[0].nodeType==e.NODE_TEXT){L=!d.trim(L[0].nodeValue.substring(Q)).length&&L;P=!(L&&L[0].nodeValue.length);if(L)if(!(F=L[0].nextSibling))C=L.parent()}else(F=L[0].childNodes[Q])||(C=L);for(;C||F;){if(C&&!F){if(!M&&a._4e_equals(C,s))M=j;if(!y.contains(C))break;if(!P||C.css("display")!="inline"){P=i;if(M)E=C;else C&&this.setEndAfter(C)}F=C[0].nextSibling}for(;F;){L=
i;if(F.nodeType==e.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=b;L=/^[\s\ufeff]/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&m.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=b;else{S=F.all||F.getElementsByTagName("*");for(U=0;T=S[U++];)if(!m.$removeEmpty[T.nodeName.toLowerCase()]){F=b;break}}if(F)L=!!Q.length}else F=b;if(L)if(P)if(M)E=C;else this.setEndAfter(C);if(F){L=F.nextSibling;if(!C&&!L){C=new q(F);F=b;break}F=L}else C=b}if(C)C=
C.parent()}if(A&&E){s=A.contains(E)?E:A;this.setStartBefore(s);this.setEndAfter(s)}break;case g.ENLARGE_BLOCK_CONTENTS:case g.ENLARGE_LIST_ITEM_CONTENTS:C=new p(this.document);y=new q(this.document.body);C.setStartAt(y,g.POSITION_AFTER_START);C.setEnd(this.startContainer,this.startOffset);C=new h(C);var V,G,K=h.blockBoundary(s==g.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:b),I=function(H){var J=K(H);J||(V=H);return J};A=function(H){var J=I(H);if(!J&&H[0]&&H._4e_name()=="br")G=H;return J};C.guard=I;C=C.lastBackward();
V=V||y;this.setStartAt(V,V._4e_name()!="br"&&(!C&&this.checkStartOfBlock()||C&&V.contains(C))?g.POSITION_AFTER_START:g.POSITION_AFTER_END);C=this.clone();C.collapse();C.setEndAt(y,g.POSITION_BEFORE_END);C=new h(C);C.guard=s==g.ENLARGE_LIST_ITEM_CONTENTS?A:I;V=b;C=C.lastForward();V=V||y;this.setEndAt(V,!C&&this.checkEndOfBlock()||C&&V.contains(C)?g.POSITION_BEFORE_END:g.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},checkStartOfBlock:function(){var s=this.startContainer,y=this.startOffset;if(y&&s[0].nodeType==
e.NODE_TEXT)if(d.trim(s[0].nodeValue.substring(0,y)).length)return i;this.trim();s=new x(this.startContainer);y=this.clone();y.collapse(j);y.setStartAt(s.block||s.blockLimit,g.POSITION_AFTER_START);s=new h(y);s.evaluator=u(j);return s.checkBackward()},checkEndOfBlock:function(){var s=this.endContainer,y=this.endOffset;if(s[0].nodeType==e.NODE_TEXT)if(d.trim(s[0].nodeValue.substring(y)).length)return i;this.trim();s=new x(this.endContainer);y=this.clone();y.collapse(i);y.setEndAt(s.block||s.blockLimit,
g.POSITION_BEFORE_END);s=new h(y);s.evaluator=u(i);return s.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var s=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,s);return s},checkBoundaryOfElement:function(s,y){var A=this.clone();A[y==g.START?"setStartAt":"setEndAt"](s,y==g.START?g.POSITION_AFTER_START:g.POSITION_BEFORE_END);A=new h(A);A.evaluator=t;return A[y==g.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var s=this.startContainer,y=this.endContainer,A=this.startOffset,E=this.endOffset,C;if(s[0].nodeType==e.NODE_ELEMENT){C=s[0].childNodes.length;if(C>A)s=new q(s[0].childNodes[A]);else if(C<1)s=s._4e_previousSourceNode();else{for(s=s[0];s.lastChild;)s=s.lastChild;s=new q(s);s=s._4e_nextSourceNode()||s}}if(y[0].nodeType==e.NODE_ELEMENT){C=y[0].childNodes.length;if(C>E)y=(new q(y[0].childNodes[E]))._4e_previousSourceNode(j);else if(C<1)y=y._4e_previousSourceNode();else{for(y=
y[0];y.lastChild;)y=y.lastChild;y=new q(y)}}if(s._4e_position(y)&o.POSITION_FOLLOWING)s=y;return{startNode:s,endNode:y}},fixBlock:function(s,y){var A=this.createBookmark(),E=new q(this.document.createElement(y));this.collapse(s);this.enlarge(g.ENLARGE_BLOCK_CONTENTS);E[0].appendChild(this.extractContents());E._4e_trim();f.ie||E._4e_appendBogus();this.insertNode(E);this.moveToBookmark(A);return E},splitBlock:function(s){var y=new x(this.startContainer),A=new x(this.endContainer),E=y.block,C=A.block,
F=b;if(!y.blockLimit._4e_equals(A.blockLimit))return b;if(s!="br"){if(!E){E=this.fixBlock(j,s);C=(new x(this.endContainer)).block}C||(C=this.fixBlock(i,s))}s=E&&this.checkStartOfBlock();y=C&&this.checkEndOfBlock();this.deleteContents();if(E&&a._4e_equals(E,C))if(y){F=new x(this.startContainer);this.moveToPosition(C,g.POSITION_AFTER_END);C=b}else if(s){F=new x(this.startContainer);this.moveToPosition(E,g.POSITION_BEFORE_START);E=b}else{C=this.splitElement(E);!f.ie&&!d.inArray(E._4e_name(),["ul","ol"])&&
E._4e_appendBogus()}return{previousBlock:E,nextBlock:C,wasStartOfBlock:s,wasEndOfBlock:y,elementPath:F}},splitElement:function(s){if(!this.collapsed)return b;this.setEndAt(s,g.POSITION_BEFORE_END);var y=this.extractContents(),A=s._4e_clone(i);A[0].appendChild(y);A.insertAfter(s);this.moveToPosition(s,g.POSITION_AFTER_END);return A},moveToElementEditablePosition:function(s,y){var A,E=l.XHTML_DTD;if(E.$empty[s._4e_name()])return i;for(;s&&s[0].nodeType==e.NODE_ELEMENT;){if(A=s._4e_isEditable())this.moveToPosition(s,
y?g.POSITION_BEFORE_END:g.POSITION_AFTER_START);else if(E.$inline[s._4e_name()]){this.moveToPosition(s,y?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return j}if((s=E.$empty[s._4e_name()]?s[y?"_4e_previous":"_4e_next"](v):s[y?"_4e_last":"_4e_first"](v))&&s[0].nodeType==e.NODE_TEXT){this.moveToPosition(s,y?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return j}}return A},selectNodeContents:function(s){this.setStart(s,0);this.setEnd(s,s[0].nodeType==e.NODE_TEXT?s[0].nodeValue.length:s[0].childNodes.length)}});
var k={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},w=new h.whitespaces,D=new h.bookmark;l.Range=p;l.Range=p;var B=p.prototype;l.Utils.extern(B,{updateCollapsed:B.updateCollapsed,optimize:B.optimize,setStartAfter:B.setStartAfter,setEndAfter:B.setEndAfter,setStartBefore:B.setStartBefore,setEndBefore:B.setEndBefore,optimizeBookmark:B.optimizeBookmark,setStart:B.setStart,setEnd:B.setEnd,
setStartAt:B.setStartAt,setEndAt:B.setEndAt,execContentsAction:B.execContentsAction,collapse:B.collapse,clone:B.clone,getEnclosedNode:B.getEnclosedNode,shrink:B.shrink,getTouchedStartNode:B.getTouchedStartNode,createBookmark2:B.createBookmark2,createBookmark:B.createBookmark,moveToPosition:B.moveToPosition,trim:B.trim,insertNode:B.insertNode,moveToBookmark:B.moveToBookmark,getCommonAncestor:B.getCommonAncestor,enlarge:B.enlarge,checkStartOfBlock:B.checkStartOfBlock,checkEndOfBlock:B.checkEndOfBlock,
deleteContents:B.deleteContents,extractContents:B.extractContents,checkBoundaryOfElement:B.checkBoundaryOfElement,getBoundaryNodes:B.getBoundaryNodes,fixBlock:B.fixBlock,splitBlock:B.splitBlock,splitElement:B.splitElement,moveToElementEditablePosition:B.moveToElementEditablePosition,selectNodeContents:B.selectNodeContents})});
KISSY.Editor.add("domiterator",function(l){function p(h){if(!(arguments.length<1)){this.range=h;this.forceBrBreak=v;this.enlargeBr=t;this.enforceRealBlocks=v;this._||(this._={})}}var t=true,v=false,u=KISSY,r=u.UA,n=l.Walker,j=l.Range,i=l.RANGE,b=l.NODE,d=l.ElementPath,e=u.Node,g=u.DOM,o=/^[\r\n\t ]*$/;u.augment(p,{getNextParagraph:function(h){var a,c,f,m,x;if(!this._.lastNode){c=this.range.clone();c.shrink(i.SHRINK_ELEMENT,t);c.enlarge(this.forceBrBreak||!this.enlargeBr?i.ENLARGE_LIST_ITEM_CONTENTS:
i.ENLARGE_BLOCK_CONTENTS);var q=new n(c),z=n.bookmark(t,t);q.evaluator=z;this._.nextNode=q.next();q=new n(c);q.evaluator=z;q=q.previous();this._.lastNode=q._4e_nextSourceNode(t);if(this._.lastNode&&this._.lastNode[0].nodeType==b.NODE_TEXT&&!u.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){z=new j(c.document);z.moveToPosition(this._.lastNode,i.POSITION_AFTER_END);if(z.checkEndOfBlock()){z=new d(z.endContainer);this._.lastNode=(z.block||z.blockLimit)._4e_nextSourceNode(t)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new e(c.document.createTextNode(""));g.insertAfter(this._.lastNode[0],q[0])}c=null}z=this._.nextNode;q=this._.lastNode;for(this._.nextNode=null;z;){var k=v,w=z[0].nodeType!=b.NODE_ELEMENT,D=v;if(w){if(z[0].nodeType==b.NODE_TEXT)if(o.test(z[0].nodeValue))w=v}else{var B=z._4e_name();if(z._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(B=="br")w=t;else if(!c&&!z[0].childNodes.length&&B!="hr"){a=z;f=z._4e_equals(q);break}if(c){c.setEndAt(z,i.POSITION_BEFORE_START);if(B!="br")this._.nextNode=
z}k=t}else{if(z[0].firstChild){if(!c){c=new j(this.range.document);c.setStartAt(z,i.POSITION_BEFORE_START)}z=new e(z[0].firstChild);continue}w=t}}if(w&&!c){c=new j(this.range.document);c.setStartAt(z,i.POSITION_BEFORE_START)}f=(!k||w)&&z._4e_equals(q);if(c&&!k)for(;!z[0].nextSibling&&!f;){B=z.parent();if(B._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){k=t;f||B._4e_equals(q);break}z=B;w=t;f=z._4e_equals(q);D=t}w&&c.setEndAt(z,i.POSITION_AFTER_END);z=z._4e_nextSourceNode(D,null,q);if((f=!z)||k&&c)break}if(!a){if(!c){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}a=new d(c.startContainer);z=a.blockLimit;k={div:1,th:1,td:1};a=a.block;if((!a||!a[0])&&!this.enforceRealBlocks&&k[z._4e_name()]&&c.checkStartOfBlock()&&c.checkEndOfBlock())a=z;else if(!a||this.enforceRealBlocks&&a._4e_name()=="li"){a=new e(this.range.document.createElement(h||"p"));a[0].appendChild(c.extractContents());a._4e_trim();c.insertNode(a);m=x=t}else if(a._4e_name()!="li"){if(!c.checkStartOfBlock()||!c.checkEndOfBlock()){a=a._4e_clone(v);
a[0].appendChild(c.extractContents());a._4e_trim();x=c.splitBlock();m=!x.wasStartOfBlock;x=!x.wasEndOfBlock;c.insertNode(a)}}else if(!f)this._.nextNode=a._4e_equals(q)?null:c.getBoundaryNodes().endNode._4e_nextSourceNode(t,null,q)}if(m){c=new e(a[0].previousSibling);if(c[0]&&c[0].nodeType==b.NODE_ELEMENT)if(c._4e_name()=="br")c._4e_remove();else c[0].lastChild&&g._4e_name(c[0].lastChild)=="br"&&g._4e_remove(c[0].lastChild)}if(x){c=n.bookmark(v,t);m=new e(a[0].lastChild);if(m[0]&&m[0].nodeType==b.NODE_ELEMENT&&
m._4e_name()=="br")if(r.ie||m._4e_previous(c)||m._4e_next(c))m._4e_remove()}if(!this._.nextNode)this._.nextNode=f||a._4e_equals(q)?null:a._4e_nextSourceNode(t,null,q);return a}});j.prototype.createIterator=function(){return new p(this)}});
KISSY.Editor.add("selection",function(l){function p(k){this.document=this.document=k;this._={cache:{}};if(a){var w=this.getNative().createRange();if(!w||w.item&&w.item(0).ownerDocument!=k||w.parentElement&&w.parentElement().ownerDocument!=k)this.isInvalid=u}}function t(k){k=new p(k);return!k||k.isInvalid?n:k}function v(k){var w=k.document,D=new e(w.body),B=new e(w.documentElement);if(i.ie){if(i.ie<8||document.documentMode==7)B.on("click",function(L){(new e(L.target))._4e_name()==="html"&&k.getSelection().getRanges()[0].select()});
var s,y,A=1;B.on("mousedown",function(){A=0});B.on("mouseup",function(){A=1});D.on("focusin",function(L){if((new e(L.target))._4e_name()=="body")if(s){try{A&&s.select()}catch(Q){}s=n}});D.on("focus",function(){y=u;C()});D.on("beforedeactivate",function(L){if(!L.relatedTarget){y=r;A=1}});d.on(b._4e_getWin(w),"blur",function(){w&&w.selection.empty()});D.on("mousedown",function(){E()});D.on("mouseup",function(){y=u;setTimeout(function(){C(u)},0)});var E=function(){y=r},C=function(L){if(y){var Q=k.document,
S=k.getSelection(),U=S&&S.getType(),T=S&&S.getNative();if(L&&T&&U==g.SELECTION_NONE)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){C(u)},50);return}var V;if(!(T&&U==g.SELECTION_TEXT&&(V=b._4e_name(S.getStartElement()))&&V in{input:1,textarea:1})){s=T&&S.getRanges()[0];k._monitor()}}};D.on("keydown",E);D.on("keyup",function(){y=u;C()});d.on(w,"selectionchange",C)}else{d.on(w,"mouseup",k._monitor,k);d.on(w,"keyup",k._monitor,k)}var F={table:1,pre:1},M=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
P=l.Walker.whitespaces(u);k.on("selectionChange",function(L){var Q=L.path;L=(L=L.selection)&&L.getRanges()[0];if(!(!L||!L.collapsed||Q.block))if(Q.blockLimit._4e_name()=="body"){Q=L.fixBlock(u,"p");if(Q._4e_outerHtml().match(M)){var S=Q._4e_next(P);if(S&&S[0].nodeType==h.NODE_ELEMENT&&!F[S._4e_name()]){L.moveToElementEditablePosition(S);Q._4e_remove()}else if((S=Q._4e_previous(P))&&S[0].nodeType==h.NODE_ELEMENT&&!F[S._4e_name()]){L.moveToElementEditablePosition(S,S._4e_outerHtml().match(M)?r:u);Q._4e_remove()}}L.select();
a||k.notifySelectionChange()}})}l.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var u=true,r=false,n=null,j=KISSY,i=j.UA,b=j.DOM,d=j.Event,e=j.Node,g=l.SELECTION,o=l.RANGE,h=l.NODE,a=!window.getSelection,c=l.Walker,f=l.Range,m={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};j.augment(p,{getNative:!a?function(){var k=this._.cache;return k.nativeSel||(k.nativeSel=b._4e_getWin(this.document).getSelection())}:
function(){var k=this._.cache;return k.nativeSel||(k.nativeSel=this.document.selection)},getType:!a?function(){var k=this._.cache;if(k.type)return k.type;var w=g.SELECTION_TEXT,D=this.getNative();if(D){if(D.rangeCount==1){D=D.getRangeAt(0);var B=D.startContainer;if(B==D.endContainer&&B.nodeType==h.NODE_ELEMENT&&D.endOffset-D.startOffset===1&&m[B.childNodes[D.startOffset].nodeName.toLowerCase()])w=g.SELECTION_ELEMENT}}else w=g.SELECTION_NONE;return k.type=w}:function(){var k=this._.cache;if(k.type)return k.type;
var w=g.SELECTION_NONE;try{var D=this.getNative(),B=D.type;if(B=="Text")w=g.SELECTION_TEXT;if(B=="Control")w=g.SELECTION_ELEMENT;if(D.createRange().parentElement)w=g.SELECTION_TEXT}catch(s){}return k.type=w},getRanges:a?function(){var k=function(w,D){w=w.duplicate();w.collapse(D);for(var B=w.parentElement(),s=B.childNodes,y,A=0;A<s.length;A++){var E=s[A];if(E.nodeType==h.NODE_ELEMENT){y=w.duplicate();y.moveToElementText(E);E=y.compareEndPoints("StartToStart",w);var C=y.compareEndPoints("EndToStart",
w);y.collapse();if(E>0)break;else if(!E||C==1&&E==-1)return{container:B,offset:A};else if(!C)return{container:B,offset:A+1};y=n}}if(!y){y=w.duplicate();y.moveToElementText(B);y.collapse(r)}y.setEndPoint("StartToStart",w);y=y.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;y>0;)y-=s[--A].nodeValue.length}catch(F){y=0}return y===0?{container:B,offset:A}:{container:s[A],offset:-y}};return function(){var w=this._.cache;if(w.ranges)return w.ranges;var D=this.getNative(),B=D&&D.createRange(),s=this.getType();
if(!D)return[];if(s==g.SELECTION_TEXT){D=new f(this.document);s=k(B,u);D.setStart(new e(s.container),s.offset);s=k(B);D.setEnd(new e(s.container),s.offset);return w.ranges=[D]}else if(s==g.SELECTION_ELEMENT){w=w.ranges=[];for(s=0;s<B.length;s++){var y=B.item(s),A=y.parentNode,E=0;for(D=new f(this.document);E<A.childNodes.length&&A.childNodes[E]!=y;E++);D.setStart(new e(A),E);D.setEnd(new e(A),E+1);w.push(D)}return w}return w.ranges=[]}}():function(){var k=this._.cache;if(k.ranges)return k.ranges;
var w=[],D=this.getNative();if(!D)return[];for(var B=0;B<D.rangeCount;B++){var s=D.getRangeAt(B),y=new f(this.document);y.setStart(new e(s.startContainer),s.startOffset);y.setEnd(new e(s.endContainer),s.endOffset);w.push(y)}return k.ranges=w},getStartElement:function(){var k=this._.cache;if(k.startElement!==undefined)return k.startElement;var w,D=this.getNative();switch(this.getType()){case g.SELECTION_ELEMENT:return this.getSelectedElement();case g.SELECTION_TEXT:var B=this.getRanges()[0];if(B)if(!B.collapsed){for(B.optimize();u;){w=
B.startContainer;if(B.startOffset==(w[0].nodeType===h.NODE_ELEMENT?w[0].childNodes.length:w[0].nodeValue.length)&&!w._4e_isBlockBoundary())B.setStartAfter(w);else break}w=B.startContainer;if(w[0].nodeType!=h.NODE_ELEMENT)return w.parent();w=new e(w[0].childNodes[B.startOffset]);if(!w[0]||w[0].nodeType!=h.NODE_ELEMENT)return B.startContainer;for(B=w[0].firstChild;B&&B.nodeType==h.NODE_ELEMENT;){w=new e(B);B=B.firstChild}return w}if(a){B=D.createRange();B.collapse(u);w=B.parentElement()}else if((w=
D.anchorNode)&&w.nodeType!=h.NODE_ELEMENT)w=w.parentNode}return k.startElement=w?b._4e_wrap(w):n},getSelectedElement:function(){var k=this,w,D=k._.cache;if(D.selectedElement!==undefined)return D.selectedElement;if(a){w=k.getNative().createRange();w=w.item&&w.item(0)}w||(w=function(){for(var B=k.getRanges()[0],s,y,A=2;A&&!((s=B.getEnclosedNode())&&s[0].nodeType==h.NODE_ELEMENT&&m[s._4e_name()]&&(y=s));A--)B.shrink(o.SHRINK_ELEMENT);return y&&y[0]}());return D.selectedElement=b._4e_wrap(w)},reset:function(){this._.cache=
{}},selectElement:function(k){var w;if(a)try{w=this.document.body.createControlRange();w.addElement(k[0]);w.select()}catch(D){w=this.document.body.createTextRange();w.moveToElementText(k[0]);w.select()}finally{}else{w=this.document.createRange();w.selectNode(k[0]);k=this.getNative();k.removeAllRanges();k.addRange(w)}this.reset()},selectRanges:function(k){if(a){if(k.length>1){var w=k[k.length-1];k[0].setEnd(w.endContainer,w.endOffset);k.length=1}k[0]&&k[0].select()}else{w=this.getNative();if(!w)return;
w.removeAllRanges();for(var D=0;D<k.length;D++){var B=k[D],s=this.document.createRange(),y=B.startContainer;B.collapsed&&i.gecko&&i.gecko<1.09&&y[0].nodeType==h.NODE_ELEMENT&&!y[0].childNodes.length&&y[0].appendChild(this.document.createTextNode(""));s.setStart(y[0],B.startOffset);s.setEnd(B.endContainer[0],B.endOffset);w.addRange(s)}}this.reset()},createBookmarks2:function(k){for(var w=[],D=this.getRanges(),B=0;B<D.length;B++)w.push(D[B].createBookmark2(k));return w},createBookmarks:function(k,w){var D=
[],B=this.document,s;w=w||this.getRanges();for(var y=w.length,A=0;A<y;A++){D.push(s=w[A].createBookmark(k,u));var E=(k=s.serializable)?j.one("#"+s.startNode,B):s.startNode;s=k?j.one("#"+s.endNode,B):s.endNode;for(var C=A+1;C<y;C++){var F=w[C],M=F.startContainer,P=F.endContainer;b._4e_equals(M,E.parent())&&F.startOffset++;b._4e_equals(M,s.parent())&&F.startOffset++;b._4e_equals(P,E.parent())&&F.endOffset++;b._4e_equals(P,s.parent())&&F.endOffset++}}return D},selectBookmarks:function(k){for(var w=[],
D=0;D<k.length;D++){var B=new f(this.document);B.moveToBookmark(k[D]);w.push(B)}this.selectRanges(w);return this},getCommonAncestor:function(){var k=this.getRanges();return k[0].startContainer._4e_commonAncestor(k[k.length-1].endContainer)},scrollIntoView:function(){var k=this.getStartElement();k&&k._4e_scrollIntoView()},removeAllRanges:function(){var k=this.getNative();if(a)k&&k.clear();else k&&k.removeAllRanges()}});var x={table:1,tbody:1,tr:1},q=c.whitespaces(u),z=/\ufeff|\u00a0/;f.prototype.select=
f.prototype.select=!a?function(){var k=this.startContainer;this.collapsed&&k[0].nodeType==h.NODE_ELEMENT&&!k[0].childNodes.length&&k[0].appendChild(this.document.createTextNode(""));var w=this.document.createRange();w.setStart(k[0],this.startOffset);try{w.setEnd(this.endContainer[0],this.endOffset)}catch(D){if(D.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(u);w.setEnd(this.endContainer[0],this.endOffset)}else throw D;}k=t(this.document).getNative();k.removeAllRanges();k.addRange(w)}:
function(k){var w=this.collapsed,D,B;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var s=this.startContainer[0].childNodes[this.startOffset];if(s.nodeType==h.NODE_ELEMENT){(new p(this.document)).selectElement(new e(s));return}}if(this.startContainer[0].nodeType==h.NODE_ELEMENT&&this.startContainer._4e_name()in x||this.endContainer[0].nodeType==h.NODE_ELEMENT&&this.endContainer._4e_name()in x)this.shrink(o.SHRINK_ELEMENT,u);var y=this.createBookmark();s=y.startNode;
var A;if(!w)A=y.endNode;y=this.document.body.createTextRange();y.moveToElementText(s[0]);y.moveStart("character",1);if(A){k=this.document.body.createTextRange();k.moveToElementText(A[0]);y.setEndPoint("EndToEnd",k);y.moveEnd("character",-1)}else{for(D=s[0].nextSibling;D&&!q(D);)D=D.nextSibling;D=!(D&&D.nodeValue&&D.nodeValue.match(z))&&(k||!s[0].previousSibling||s[0].previousSibling&&b._4e_name(s[0].previousSibling)=="br");B=this.document.createElement("span");B.innerHTML="&#65279;";B=(new e(B)).insertBefore(s);
D&&b.insertBefore(this.document.createTextNode("\ufeff"),s)}this.setStartBefore(s);s._4e_remove();if(w){if(D){y.moveStart("character",-1);y.select();this.document.selection.clear()}else y.select();if(B){this.moveToPosition(B,o.POSITION_BEFORE_START);B._4e_remove()}}else{this.setEndBefore(A);A._4e_remove();y.select()}};p.getSelection=t;l.Selection=p;l.Selection=p;c=p.prototype;l.Utils.extern(c,{getNative:c.getNative,getType:c.getType,getRanges:c.getRanges,getStartElement:c.getStartElement,getSelectedElement:c.getSelectedElement,
reset:c.reset,selectElement:c.selectElement,selectRanges:c.selectRanges,createBookmarks2:c.createBookmarks2,createBookmarks:c.createBookmarks,getCommonAncestor:c.getCommonAncestor,scrollIntoView:c.scrollIntoView,selectBookmarks:c.selectBookmarks,removeAllRanges:c.removeAllRanges});l.on("instanceCreated",function(k){v(k.editor)})});
KISSY.Editor.add("styles",function(l){function p(G,K){for(var I in G)G[I]=G[I].replace(T,function(H,J){return K[J]})}function t(G,K){if(K){G=w.clone(G);p(G.attributes,K);p(G.styles,K)}var I=this.element=this.element=(G.element||"*").toLowerCase();this.type=this.type=I=="#"||Q[I]?s.STYLE_BLOCK:S[I]?s.STYLE_OBJECT:s.STYLE_INLINE;this._={definition:G}}function v(G,K){var I=K?this.removeFromRange:this.applyToRange;G.body.focus();for(var H=new A(G),J=H.getRanges(),O=0;O<J.length;O++)I.call(this,J[O]);
H.selectRanges(J)}function u(G,K){var I;I=G.element;if(I=="*")I="span";I=new M(K.createElement(I));return r(I,G)}function r(G,K){var I=K._.definition,H=I.attributes;I=t.getStyleText(I);if(H)for(var J in H)G.attr(J,H[J]);if(I)G[0].style.cssText=I;return G}function n(G){var K=G.createBookmark(q),I=G.createIterator();I.enforceRealBlocks=q;I.enlargeBr=q;for(var H,J=G.document;H=I.getNextParagraph();){var O=u(this,J);H=H;var N=O;O=N._4e_name=="pre";var R=H._4e_name=="pre",Z=!O&&R;if(O&&!R){R=H;N=N;Z=R.html();
Z=j(Z,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");Z=Z.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");Z=Z.replace(/([ \t\n\r]+|&nbsp;)/g," ");Z=Z.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(N[0]);N[0].outerHTML="<pre>"+Z+"</pre>";N=new M(R.firstChild);N._4e_remove()}else N.html(Z);N=N}else if(Z)N=b(i(H),N);else H._4e_moveChildren(N);H[0].parentNode.replaceChild(N[0],H[0]);if(O){H=N;O=void 0;if((O=H._4e_previousSourceNode(q,E.NODE_ELEMENT))&&O._4e_name()==
"pre"){N=j(O.html(),/\n$/,"")+"\n\n"+j(H.html(),/^\n/,"");if(P.ie)H[0].outerHTML="<pre>"+N+"</pre>";else H.html(N);O._4e_remove()}}}G.moveToBookmark(K)}function j(G,K,I){var H="",J="";G=G.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(O,N,R){N&&(H=N);R&&(J=R);return""});return H+G.replace(K,I)+J}function i(G){var K=[];j(G._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(I,H,J){return H+"</pre>"+J+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(I,H){K.push(H)});return K}function b(G,K){for(var I=K[0].ownerDocument.createDocumentFragment(),H=0;H<G.length;H++){var J=G[H];J=J.replace(/(\r\n|\r)/g,"\n");J=j(J,/^[ \t]*\n/,"");J=j(J,/\n$/,"");J=j(J,/^[ \t]+|[ \t]+$/g,function(N,R){return N.length==1?"&nbsp;":R?" "+Array(N.length).join("&nbsp;"):Array(N.length).join("&nbsp;")+" "});J=J.replace(/\n/g,"<br>");J=J.replace(/[ \t]{2,}/g,function(N){return Array(N.length).join("&nbsp;")+" "});var O=K._4e_clone();O.html(J);I.appendChild(O[0])}return I}
function d(G){var K=G.document;if(G.collapsed){K=u(this,K);G.insertNode(K);G.moveToPosition(K,y.POSITION_BEFORE_END)}else{var I=this.element,H=this._.definition,J,O=l.XHTML_DTD[I]||(J=q,l.XHTML_DTD.span),N=G.createBookmark();G.enlarge(y.ENLARGE_ELEMENT);G.trim();var R=G.createBookmark(),Z=R.startNode;R=R.endNode;for(var X=Z,$;X&&X[0];){var W=z;if(B._4e_equals(X,R)){X=k;W=q}else{var Y=X[0].nodeType,ca=Y==E.NODE_ELEMENT?X._4e_name():k;if(ca&&X.attr("_ke_bookmark")){X=X._4e_nextSourceNode(q);continue}if(!ca||
O[ca]&&(X._4e_position(R)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(X))){var da=X.parent();if(da&&da[0]&&((l.XHTML_DTD[da._4e_name()]||l.XHTML_DTD.span)[I]||J)&&(!H.parentRule||H.parentRule(da))){if(!$&&(!ca||!l.XHTML_DTD.$removeEmpty[ca]||(X._4e_position(R)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED)){$=
new F(K);$.setStartBefore(X)}if(Y==E.NODE_TEXT||Y==E.NODE_ELEMENT&&!X[0].childNodes.length){Y=X;var aa;for(ca=Y._4e_next(function(fa){return!fa.attr("_ke_bookmark")});!ca&&(aa=Y.parent(),O[aa._4e_name()])&&(aa._4e_position(Z)|C.POSITION_FOLLOWING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_FOLLOWING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(aa));)Y=aa;$.setEndAfter(Y);Y[0].nextSibling||(W=q)}}else W=q}else W=q;X=X._4e_nextSourceNode()}if(W&&$&&!$.collapsed){W=
u(this,K);for(Y=$.getCommonAncestor();W&&Y&&W[0]&&Y[0];){if(Y._4e_name()==I){for(var ba in H.attributes)W.attr(ba)==Y.attr(ba)&&W[0].removeAttribute(ba);for(var ea in H.styles)W._4e_style(ea)==Y._4e_style(ea)&&W._4e_style(ea,"");if(!W._4e_hasAttributes()){W=k;break}}Y=Y.parent()}if(W){W[0].appendChild($.extractContents());f(this,W);$.insertNode(W);W._4e_mergeSiblings();P.ie||W[0].normalize()}$=k}}Z._4e_remove();R._4e_remove();G.moveToBookmark(N);G.shrink(y.SHRINK_TEXT)}}function e(G){G.enlarge(y.ENLARGE_ELEMENT);
var K=G.createBookmark(),I=K.startNode;if(G.collapsed){for(var H=new L(I.parent()),J,O=0,N;O<H.elements.length&&(N=H.elements[O]);O++){if(N==H.block||N==H.blockLimit)break;if(this.checkElementRemovable(N)){var R=G.checkBoundaryOfElement(N,y.END),Z=!R&&G.checkBoundaryOfElement(N,y.START);if(Z||R){J=N;J.match=Z?"start":"end"}else{N._4e_mergeSiblings();N._4e_name()==this.element?a(this,N):m(N,h(this)[N._4e_name()])}}}if(J&&J[0]){N=I;for(O=0;;O++){R=H.elements[O];if(B._4e_equals(R,J))break;else if(R.match)continue;
else R=R._4e_clone();R[0].appendChild(N[0]);N=R}B[J.match=="start"?"insertBefore":"insertAfter"](N,J)}}else{var X=K.endNode,$=this;H=function(){for(var W=new L(I.parent()),Y=new L(X.parent()),ca=k,da=k,aa=0;aa<W.elements.length;aa++){var ba=W.elements[aa];if(ba==W.block||ba==W.blockLimit)break;if($.checkElementRemovable(ba))ca=ba}for(aa=0;aa<Y.elements.length;aa++){ba=Y.elements[aa];if(ba==Y.block||ba==Y.blockLimit)break;if($.checkElementRemovable(ba))da=ba}da&&X._4e_breakParent(da);ca&&I._4e_breakParent(ca)};
H();for(J=new M(I[0].nextSibling);J[0]!==X[0];){O=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==E.NODE_ELEMENT&&this.checkElementRemovable(J)){J._4e_name()==this.element?a(this,J):m(J,h(this)[J._4e_name()]);if(O[0].nodeType==E.NODE_ELEMENT&&O.contains(I)){H();O=new M(I[0].nextSibling)}}J=O}}G.moveToBookmark(K)}function g(G){var K={};G.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(I,H,J){K[H]=J});return K}function o(G,K){var I;if(K!==z){I=document.createElement("span");
I.style.cssText=G;I=I.style.cssText||""}else I=G;return I.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function h(G){if(G._.overrides)return G._.overrides;var K=G._.overrides={},I=G._.definition.overrides;if(I){w.isArray(I)||(I=[I]);for(var H=0;H<I.length;H++){var J=I[H],O,N;if(typeof J=="string")O=J.toLowerCase();else{O=J.element?J.element.toLowerCase():G.element;N=J.attributes}J=K[O]||(K[O]={});if(N){J=J.attributes=J.attributes||[];for(var R in N)J.push([R.toLowerCase(),
N[R]])}}}return K}function a(G,K){var I=G._.definition,H=D.mix(I.attributes,h(G)[K._4e_name()]);I=I.styles;var J=w.isEmptyObject(H)&&w.isEmptyObject(I),O;for(O in H)if(!((O=="class"||G._.definition.fullMatch)&&K.attr(O)!=c(O,H[O]))){J=J||!!K._4e_hasAttribute(O);K.removeAttr(O)}for(var N in I)if(!(G._.definition.fullMatch&&K._4e_style(N)!=c(N,I[N],q))){J=J||!!K._4e_style(N);K._4e_style(N,"")}x(K)}function c(G,K,I){var H=new M("<span>");H[I?"_4e_style":"attr"](G,K);return H[I?"_4e_style":"attr"](G)}
function f(G,K){for(var I=h(G),H=K.all(G.element),J=H.length;--J>=0;)a(G,new M(H[J]));for(var O in I)if(O!=G.element){H=K.all(O);for(J=H.length-1;J>=0;J--){var N=new M(H[J]);m(N,I[O])}}}function m(G,K){var I=K&&K.attributes;if(I)for(var H=0;H<I.length;H++){var J=I[H][0],O;if(O=G.attr(J)){var N=I[H][1];if(N===k||N.test&&N.test(O)||typeof N=="string"&&O==N)G[0].removeAttribute(J)}}x(G)}function x(G){if(!G._4e_hasAttributes()){var K=G[0].firstChild,I=G[0].lastChild;G._4e_remove(q);if(K){K.nodeType==
E.NODE_ELEMENT&&B._4e_mergeSiblings(K);I&&K!=I&&I.nodeType==E.NODE_ELEMENT&&B._4e_mergeSiblings(I)}}}var q=true,z=false,k=null,w=KISSY,D=l.Utils,B=w.DOM,s={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},y=l.RANGE,A=l.Selection,E=l.NODE,C=l.POSITION,F=l.Range,M=w.Node,P=w.UA,L=l.ElementPath,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},S={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},U=/\s*(?:;\s*|$)/g,T=/#\((.+?)\)/g;l.STYLE=s;t.prototype={apply:function(G){v.call(this,
G,z)},remove:function(G){v.call(this,G,q)},applyToRange:function(G){return(this.applyToRange=this.type==s.STYLE_INLINE?d:this.type==s.STYLE_BLOCK?n:this.type==s.STYLE_OBJECT?k:k).call(this,G)},removeFromRange:function(G){return(this.removeFromRange=this.type==s.STYLE_INLINE?e:k).call(this,G)},applyToObject:function(G){r(G,this)},checkElementRemovable:function(G,K){if(!G)return z;var I=this._.definition;if(G._4e_name()==this.element){if(!K&&!G._4e_hasAttributes())return q;var H=I._AC;if(H)I=H;else{H=
{};var J=0,O=I.attributes;if(O)for(var N in O){J++;H[N]=O[N]}if(O=t.getStyleText(I)){H.style||J++;H.style=O}H._length=J;I=I._AC=H}if(I._length){for(var R in I)if(R!="_length"){J=G.attr(R)||"";if(R=="style")a:{H=I[R];J=o(J,z);typeof H=="string"&&(H=g(H));typeof J=="string"&&(J=g(J));O=void 0;for(O in H)if(!(O in J&&(J[O]==H[O]||H[O]=="inherit"||J[O]=="inherit"))){H=z;break a}H=q}else H=I[R]==J;if(H){if(!K)return q}else if(K)return z}if(K)return q}else return q}if(R=h(this)[G._4e_name()]){if(!(I=R.attributes))return q;
for(H=0;H<I.length;H++){R=I[H][0];if(R=G.attr(R)){J=I[H][1];if(J===k||typeof J=="string"&&R==J||J.test&&J.test(R))return q}}}return z},checkActive:function(G){switch(this.type){case s.STYLE_BLOCK:return this.checkElementRemovable(G.block||G.blockLimit,q);case s.STYLE_OBJECT:case s.STYLE_INLINE:for(var K=G.elements,I=0,H;I<K.length;I++){H=K[I];if(!(this.type==s.STYLE_INLINE&&(B._4e_equals(H,G.block)||B._4e_equals(H,G.blockLimit))))if(!(this.type==s.STYLE_OBJECT&&!(H._4e_name()in S)))if(this.checkElementRemovable(H,
q))return q}}return z}};t.getStyleText=function(G){var K=G._ST;if(K)return K;K=G.styles;var I=G.attributes&&G.attributes.style||"",H="";if(I.length)I=I.replace(U,";");for(var J in K){var O=K[J],N=(J+":"+O).replace(U,";");if(O=="inherit")H+=N;else I+=N}if(I.length)I=o(I);I+=H;return G._ST=I};l.Style=t;l.Style=t;var V=t.prototype;l.Utils.extern(V,{apply:V.apply,remove:V.remove,applyToRange:V.applyToRange,removeFromRange:V.removeFromRange,applyToObject:V.applyToObject,checkElementRemovable:V.checkElementRemovable,
checkActive:V.checkActive})});
KISSY.Editor.add("htmlparser",function(){function l(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var p=KISSY,t=function(){},v=p.Editor,u=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,r={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},n=v.XHTML_DTD;p.augment(l,{onTagOpen:t,onTagClose:t,
onText:t,onCDATA:t,onComment:t,parse:function(j){for(var i,b,d=0,e;i=this._.htmlPartsRegex.exec(j);){b=i.index;if(b>d){d=j.substring(d,b);e?e.push(d):this.onText(d)}d=this._.htmlPartsRegex.lastIndex;if(b=i[1]){b=b.toLowerCase();if(e&&n.$cdata[b]){this.onCDATA(e.join(""));e=null}if(!e){this.onTagClose(b);continue}}if(e)e.push(i[0]);else if(b=i[3]){b=b.toLowerCase();if(!/="/.test(b)){var g={},o;i=i[4];var h=!!(i&&i.charAt(i.length-1)=="/");if(i)for(;o=u.exec(i);){var a=o[1].toLowerCase();o=o[2]||o[3]||
o[4]||"";g[a]=!o&&r[a]?a:o}this.onTagOpen(b,g,h);if(!e&&n.$cdata[b])e=[]}}else if(b=i[2])this.onComment(b)}j.length>d&&this.onText(j.substring(d,j.length))}});v.HtmlParser=l;v.HtmlParser=l});
KISSY.Editor.add("htmlparser-basicwriter",function(){function l(){this._={output:[]}}var p=KISSY,t=p.Editor,v=t.Utils;p.augment(l,{openTag:function(u){this._.output.push("<",u)},openTagClose:function(u,r){r?this._.output.push(" />"):this._.output.push(">")},attribute:function(u,r){if(typeof r=="string")r=v.htmlEncodeAttr(r);this._.output.push(" ",u,'="',r,'"')},closeTag:function(u){this._.output.push("</",u,">")},text:function(u){this._.output.push(u)},comment:function(u){this._.output.push("<!--",
u,"--\>")},write:function(u){this._.output.push(u)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(u){var r=this._.output.join("");u&&this.reset();return r}});t.HtmlParser.BasicWriter=l;t.HtmlParser.BasicWriter=l;p=l.prototype;t.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,write:p.write,reset:p.reset,getHtml:p.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function l(){l.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=r;this.sortAttributes=u;this._.indent=r;this._.indentation="";this._.rules={};var n=t.XHTML_DTD,j;for(j in v.mix({},n.$nonBodyContent,n.$block,n.$listItem,n.$tableContent))this.setRules(j,{indent:u,breakBeforeOpen:u,breakAfterOpen:u,breakBeforeClose:!n[j]["#"],breakAfterClose:u});this.setRules("br",
{breakAfterOpen:u});this.setRules("title",{indent:r,breakAfterOpen:r});this.setRules("style",{indent:r,breakBeforeClose:u});this.setRules("pre",{indent:r})}var p=KISSY,t=p.Editor,v=t.Utils,u=true,r=false;p.extend(l,t.HtmlParser.BasicWriter,{openTag:function(n){var j=this._.rules[n];if(this._.indent)this.indentation();else if(j&&j.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",n)},openTagClose:function(n,j){var i=this._.rules[n];if(j)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(i&&i.indent)this._.indentation+=this.indentationChars}i&&i.breakAfterOpen&&this.lineBreak()},attribute:function(n,j){if(typeof j=="string"){this.forceSimpleAmpersand&&(j=j.replace(/&amp;/g,"&"));j=v.htmlEncodeAttr(j)}this._.output.push(" ",n,'="',j,'"')},closeTag:function(n){var j=this._.rules[n];if(j&&j.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(j&&j.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",n,">");j&&j.breakAfterClose&&this.lineBreak()},text:function(n){if(this._.indent){this.indentation();n=v.ltrim(n)}this._.output.push(n)},comment:function(n){this._.indent&&this.indentation();this._.output.push("<!--",n,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=u},indentation:function(){this._.output.push(this._.indentation);this._.indent=r},setRules:function(n,j){var i=this._.rules[n];if(i)v.mix(i,
j);else this._.rules[n]=j}});t.HtmlParser.HtmlWriter=l;t.HtmlParser.HtmlWriter=l;p=l.prototype;t.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,lineBreak:p.lineBreak,indentation:p.indentation,setRules:p.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function l(){this.children=[];this.parent=v;this._={isBlockLike:p,hasInlineStarted:t}}var p=true,t=false,v=null,u=KISSY.Editor,r={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},n=KISSY,j=u.Utils,i=u.NODE,b=u.XHTML_DTD,d=j.mix({table:1,ul:1,ol:1,dl:1},b.table,b.ul,b.ol,b.dl),e=b.$list,g=b.$listItem;l.FromHtml=function(o,h){function a(y){var A;if(q.length>0)for(var E=0;E<q.length;E++){var C=q[E],F=C.name,M=b[F],P=k.name&&b[k.name];
if((!P||P[F])&&(!y||!M||M[y]||!b[y])){if(!A){c();A=1}C=C.clone();C.parent=k;k=C;q.splice(E,1);E--}}}function c(){for(;z.length;)k.add(z.shift())}function f(y,A,E){A=A||k||x;if(h&&!A.type){var C,F;if((C=y.attributes&&(F=y.attributes._ke_real_element_type)?F:y.name)&&!(C in b.$body)&&!(C in b.$nonBodyContent)){C=k;k=A;m.onTagOpen(h,{});A=k;if(E)k=C}}if(y._.isBlockLike&&y.name!="pre"){E=y.children.length;if((C=y.children[E-1])&&C.type==i.NODE_TEXT)if(F=j.rtrim(C.value))C.value=F;else y.children.length=
E-1}A.add(y);if(y.returnPoint){k=y.returnPoint;delete y.returnPoint}}var m=new u.HtmlParser,x=new l,q=[],z=[],k=x,w=t,D;m.onTagOpen=function(y,A,E){var C=new u.HtmlParser.Element(y,A);if(C.isUnknown&&E)C.isEmpty=p;if(b.$removeEmpty[y])q.push(C);else{if(y=="pre")w=p;else if(y=="br"&&w){k.add(new u.HtmlParser.Text("\n"));return}if(y=="br")z.push(C);else{var F=k.name,M=F&&(b[F]||(k._.isBlockLike?b.div:b.span));if(M&&!C.isUnknown&&!k.isUnknown&&!M[y]){M=t;var P;if(y in e&&F in e){F=k.children;(F=F[F.length-
1])&&F.name in g||f(F=new u.HtmlParser.Element("li"),k);D=k;P=F}else if(y==F)f(k,k.parent);else{if(d[F])D||(D=k);else{f(k,k.parent,p);r[F]||q.unshift(k)}M=p}k=P?P:k.returnPoint||k.parent;if(M){m.onTagOpen.apply(this,arguments);return}}a(y);c();C.parent=k;C.returnPoint=D;D=0;if(C.isEmpty)f(C);else k=C}}};m.onTagClose=function(y){for(var A=q.length-1;A>=0;A--)if(y==q[A].name){q.splice(A,1);return}for(var E=[],C=[],F=k;F.type&&F.name!=y;){F._.isBlockLike||C.unshift(F);E.push(F);F=F.parent}if(F.type){for(A=
0;A<E.length;A++){var M=E[A];f(M,M.parent)}k=F;if(k.name=="pre")w=t;F._.isBlockLike&&c();f(F,F.parent);if(F==k)k=k.parent;q=q.concat(C)}if(y=="body")h=t};m.onText=function(y){if(!k._.hasInlineStarted&&!w){y=j.ltrim(y);if(y.length===0)return}c();a();if(h&&(!k.type||k.name=="body")&&j.trim(y))this.onTagOpen(h,{});w||(y=y.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));k.add(new u.HtmlParser.Text(y))};m.onCDATA=function(){};m.onComment=function(y){k.add(new u.HtmlParser.Comment(y))};m.parse(o);for(c();k.type;){var B=
k.parent,s=k;if(h&&(!B.type||B.name=="body")&&!b.$body[s.name]){k=B;m.onTagOpen(h,{});B=k}B.add(s);k=B}return x};n.augment(l,{add:function(o){var h=this.children.length;if(h=h>0&&this.children[h-1]||v){if(o._.isBlockLike&&h.type==i.NODE_TEXT){h.value=j.rtrim(h.value);if(h.value.length===0){this.children.pop();this.add(o);return}}h.next=o}o.previous=h;o.parent=this;this.children.push(o);this._.hasInlineStarted=o.type==i.NODE_TEXT||o.type==i.NODE_ELEMENT&&!o._.isBlockLike},writeHtml:function(o,h){var a;
this.filterChildren=this.filterChildren=function(){var c=new u.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,c,h,p);c=c.getHtml();this.children=(new l.FromHtml(c)).children;a=1};!this.name&&h&&h.onFragment(this);this.writeChildrenHtml(o,a?v:h)},writeChildrenHtml:function(o,h){for(var a=0;a<this.children.length;a++)this.children[a].writeHtml(o,h)}});u.HtmlParser.Fragment=l;u.HtmlParser.Fragment=l;l.FromHtml=l.FromHtml;n=l.prototype;u.Utils.extern(n,{add:n.add,writeHtml:n.writeHtml,writeChildrenHtml:n.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function l(r,n){this.name=r;this.attributes=n||(n={});this.children=[];var j=n._ke_real_element_type||r,i=p.XHTML_DTD;j=!!(i.$nonBodyContent[j]||i.$block[j]||i.$listItem[j]||i.$tableContent[j]||i.$nonEditable[j]||j=="br");var b=!!i.$empty[r];this.isEmpty=b;this.isUnknown=!i[r];this._={isBlockLike:j,hasInlineStarted:b||!j}}var p=KISSY.Editor,t=p.NODE,v=function(r,n){r=r[0];n=n[0];return r<n?-1:r>n?1:0};KISSY.augment(l,{type:t.NODE_ELEMENT,add:p.HtmlParser.Fragment.prototype.add,
clone:function(){return new l(this.name,this.attributes)},writeHtml:function(r,n){var j=this.attributes,i=this,b=i.name,d,e,g,o;i.filterChildren=function(){if(!o){var c=new p.HtmlParser.BasicWriter;p.HtmlParser.Fragment.prototype.writeChildrenHtml.call(i,c,n);i.children=(new p.HtmlParser.Fragment.FromHtml(c.getHtml())).children;o=1}};i.filterChildren=i.filterChildren;if(n){for(;;){if(!(b=n.onElementName(b)))return;i.name=b;if(!(i=n.onElement(i)))return;i.parent=this.parent;if(i.name==b)break;if(i.type!=
t.NODE_ELEMENT){i.writeHtml(r,n);return}b=i.name;if(!b){this.writeChildrenHtml.call(i,r,o?null:n);return}}j=i.attributes}r.openTag(b,j);for(var h=[],a=0;a<2;a++)for(d in j){e=d;g=j[d];if(a==1)h.push([d,g]);else if(n){for(;;)if(e=n.onAttributeName(d))if(e!=d){delete j[d];d=e}else break;else{delete j[d];break}if(e)if((g=n.onAttribute(i,e,g))===false)delete j[e];else j[e]=g}}r.sortAttributes&&h.sort(v);j=h.length;for(a=0;a<j;a++){d=h[a];r.attribute(d[0],d[1])}r.openTagClose(b,i.isEmpty);if(!i.isEmpty){this.writeChildrenHtml.call(i,
r,o?null:n);r.closeTag(b)}},writeChildrenHtml:function(){p.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});p.HtmlParser.Element=l;p.HtmlParser.Element=l;var u=l.prototype;p.Utils.extern(u,{type:u.type,add:u.add,clone:u.clone,writeHtml:u.writeHtml,writeChildrenHtml:u.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function l(d){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};d&&this.addRules(d,10)}function p(d,e){for(var g=0;d&&g<e.length;g++){var o=e[g];d=d.replace(o[0],o[1])}return d}function t(d,e,g){if(typeof e=="function")e=[e];var o,h;h=d.length;var a=e&&e.length;if(a){for(o=0;o<h&&d[o].pri<g;o++);for(h=a-1;h>=0;h--)if(a=e[h]){a.pri=g;d.splice(o,0,a)}}}function v(d,e,g){if(e)for(var o in e){var h=d[o];d[o]=u(h,e[o],
g);h||d.$length++}}function u(d,e,g){if(e){e.pri=g;if(d){if(d.splice)t(d,e,g);else{d=d.pri>g?[e,d]:[d,e];d.filter=r}return d}else return e.filter=e}}function r(d){for(var e=d.type||d instanceof j.HtmlParser.Fragment,g=0;g<this.length;g++){if(e)var o=d.type,h=d.name;var a=this[g].apply(window,arguments);if(a===b)return a;if(e){if(a&&(a.name!=h||a.type!=o))return a}else if(typeof a!="string")return a;a!=undefined&&(d=a)}return d}var n=KISSY,j=n.Editor,i=j.NODE,b=false;n.augment(l,{addRules:function(d,
e){if(typeof e!="number")e=10;t(this._.elementNames,d.elementNames,e);t(this._.attributeNames,d.attributeNames,e);v(this._.elements,d.elements,e);v(this._.attributes,d.attributes,e);this._.text=u(this._.text,d.text,e)||this._.text;this._.comment=u(this._.comment,d.comment,e)||this._.comment;this._.root=u(this._.root,d.root,e)||this._.root},onElementName:function(d){return p(d,this._.elementNames)},onAttributeName:function(d){return p(d,this._.attributeNames)},onText:function(d){var e=this._.text;
return e?e.filter(d):d},onComment:function(d,e){var g=this._.comment;return g?g.filter(d,e):d},onFragment:function(d){var e=this._.root;return e?e.filter(d):d},onElement:function(d){for(var e=[this._.elements["^"],this._.elements[d.name],this._.elements.$],g,o=0;o<3;o++)if(g=e[o]){g=g.filter(d,this);if(g===b)return null;if(g&&g!=d)return this.onNode(g);if(d.parent&&!d.name)break}return d},onNode:function(d){var e=d.type;return e==i.NODE_ELEMENT?this.onElement(d):e==i.NODE_TEXT?new j.HtmlParser.Text(this.onText(d.value)):
null},onAttribute:function(d,e,g){if(e=this._.attributes[e]){d=e.filter(g,d,this);if(d===b)return b;if(typeof d!="undefined")return d}return g}});j.HtmlParser.Filter=l;n=l.prototype;j.Utils.extern(n,{addRules:n.addRules,onElementName:n.onElementName,onAttributeName:n.onAttributeName,onText:n.onText,onComment:n.onComment,onFragment:n.onFragment,onElement:n.onElement,onNode:n.onNode,onAttribute:n.onAttribute});j.HtmlParser.Filter=l});
KISSY.Editor.add("htmlparser-text",function(){function l(u){this.value=u;this._={isBlockLike:v}}var p=KISSY,t=p.Editor,v=false;p.augment(l,{type:t.NODE.NODE_TEXT,writeHtml:function(u,r){var n=this.value;r&&!(n=r.onText(n,this))||u.text(n)}});t.HtmlParser.Text=l;t.HtmlParser.Text=l});
KISSY.Editor.add("htmlparser-comment",function(){function l(v){this.value=v;this._={isBlockLike:false}}var p=KISSY.Editor,t=p.NODE;p.HtmlParser.Comment=l;p.HtmlParser.Comment=l;l.prototype={constructor:l,type:t.NODE_COMMENT,writeHtml:function(v,u){var r=this.value;if(u){if(!(r=u.onComment(r,this)))return;if(typeof r!="string"){r.parent=this.parent;r.writeHtml(v,u);return}}v.comment(r)}}});
KISSY.Editor.add("bubbleview",function(){var l=KISSY.Editor,p=KISSY,t=p.Event,v=p.DOM;if(!l.BubbleView){var u=p.UIBase.create(l.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var n=this._selectedEl,j=n._4e_getOffset(document);j.top+=n.height()+5;u.superclass.show.call(this);this.set("xy",[j.left,j.top])}},{ATTRS:{focus4e:false,zIndex:{value:l.baseZIndex(l.zIndexManager.BUBBLE_VIEW)}}}),r={};u.attach=function(n){var j=n.pluginName;p.mix(n,r[j].cfg,
false);var i=n.pluginContext,b=n.func,d=n.editor,e=n.bubble;d.on("selectionChange",function(g){g=g.path;var o=g.elements;if(g&&o)if(g=g.lastElement)if(g=b(g)){o=r[j];if(!o.bubble){o.bubble=new u({autoRender:true});o.cfg.init&&o.cfg.init.call(o.bubble)}e=o.bubble;e._selectedEl=g;e._plugin=i;e.hide();e.show()}else if(e){e._selectedEl=e._plugin=null;e.hide()}});t.on(v._4e_getWin(d.document),"scroll blur",function(){e&&e.hide()})};u.register=function(n){var j=n.pluginName;r[j]=r[j]||{cfg:n};t.on(document,
"click",function(){n.bubble&&n.bubble.hide()});n.editor&&u.attach(n)};l.BubbleView=u}});
KISSY.Editor.add("button",function(){var l=KISSY,p=l.Editor;if(!p.TripleButton){var t=l.UIBase.create([l.UIBase.Box],{bindUI:function(){var v=this,u=v.get("el");u.on("click",v._action,v);u.on("mousedown",function(){v.get("state")=="off"&&u.addClass("ke-triplebutton-active")});u.on("mouseup mouseleave",function(){v.get("state")=="off"&&u.hasClass("ke-triplebutton-active")&&setTimeout(function(){u.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"))},
_uiSetContentCls:function(v){var u=this.get("el");if(v!==undefined){u.html("<span class='ke-toolbar-item "+v+"'>");u._4e_unselectable()}},_uiSetText:function(v){var u=this.get("el");v!==undefined&&u.html(v)},_uiSetState:function(v){this["_"+v]()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(v){this.fire(this.get("state")+"Click",v);v.type=this.get("state")+"Click";
this.fire("click",v);v.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-disabled");v.addClass("ke-triplebutton-on")},_off:function(){var v=this.get("el");v.removeClass("ke-triplebutton-on ke-triplebutton-disabled");v.addClass("ke-triplebutton-off")},_disabled:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-on");v.addClass("ke-triplebutton-disabled")}},
{ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elAttrs:{value:{hideFocus:true,tabIndex:-1}},elTagName:{value:"a"},title:{},contentCls:{},text:{}}});t.ON="on";t.OFF="off";t.DISABLED="disabled";t.ON_CLASS="ke-triplebutton-on";t.OFF_CLASS="ke-triplebutton-off";t.DISABLED_CLASS="ke-triplebutton-disabled";p.TripleButton=t;p.prototype.addButton=function(v,u){var r=this,n=new t({render:r.toolBarDiv,autoRender:true,title:u.title,text:u.text,contentCls:u.contentCls}),j={btn:n,
editor:r,cfg:u,call:function(){var i=l.makeArray(arguments),b=i.shift();return u[b].apply(j,i)},reload:function(i){l.mix(u,i);n.enable();r.on("selectionChange",function(){r.getMode()!=p.SOURCE_MODE&&u.selectionChange&&u.selectionChange.apply(j,arguments)});n.on("click",function(b){var d=b.type;u[d]&&u[d].apply(j,arguments)});if(u.mode==p.WYSIWYG_MODE){r.on("wysiwygmode",n.enable,n);r.on("sourcemode",n.disable,n)}u.init&&u.init.call(j)}};u.loading?n.disable():j.reload();return j}}});
KISSY.Editor.add("clipboard",function(l){var p=KISSY,t=p.Editor,v=p.Node,u=p.UA,r=t.Range,n=t.RANGE,j=p.Event;t.Paste||function(){function i(c){this.editor=c;this._init()}function b(c){if(!(!u.ie||c.document.compatMode=="BackCompat")){var f=c.getSelection(),m;if(f.getType()==h.SELECTION_ELEMENT&&(m=f.getSelectedElement())){var x=f.getRanges()[0],q=new v(c.document.createTextNode(""));q.insertBefore(m);x.setStartBefore(q);x.setEndAfter(m);f.selectRanges([x]);setTimeout(function(){if(m.parent()){q.remove();
f.selectElement(m)}},0)}}}p.augment(i,{_init:function(){var c=this.editor;u.ie?j.on(c.document,"keydown",this._paste,this):j.on(c.document,"paste",this._paste,this);c.addCommand("copy",new o("copy"));c.addCommand("cut",new o("cut"));c.addCommand("paste",new o("paste"))},_paste:function(c){if(!(c.type==="keydown"&&!(c.keyCode===86&&(c.ctrlKey||c.metaKey)))){var f=this,m=f.editor,x=m.document;if(f._running)c.halt();else{var q=m.getSelection();c=new r(x);var z=new v(u.webkit?"<body></body>":"<div></div>",
null,x);u.webkit&&z[0].appendChild(x.createTextNode("\u00a0"));x.body.appendChild(z[0]);z.css({position:"absolute",top:q.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});z.css("left","-1000px");var k=q.createBookmarks();c.setStartAt(z,n.POSITION_AFTER_START);c.setEndAt(z,n.POSITION_BEFORE_END);c.select(true);f._running=true;setTimeout(function(){z._4e_remove();var w;z=u.webkit&&(w=z._4e_first())&&w.hasClass("Apple-style-span")?w:z;q.selectBookmarks(k);m.insertHtml(z.html());
f._running=false},0)}}}});t.Paste=i;var d=function(c,f){var m=c.document,x=new v(m.body),q=false,z=function(){q=true};x.on(f,z);(u.ie>7?m:m.selection.createRange()).execCommand(f);x.detach(f,z);return q},e=u.ie?function(c,f){return d(c,f)}:function(c,f){try{return c.document.execCommand(f)}catch(m){return false}},g={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},o=function(c){this.type=
c;this.canUndo=this.type=="cut"};o.prototype={exec:function(c){this.type=="cut"&&b(c);(c=e(c,this.type))||alert(g[this.type]);return c}};var h=t.Selection,a={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};t.on("contextmenu",function(c){var f=c.contextmenu,m=f.cfg.editor,x=f.elDom,q={copy:0,cut:0,paste:0},z;for(z in q){if(!q.hasOwnProperty(z))break;q[z]=x.one(".ke-paste-"+z);(function(k){var w=q[k];if(!w){w=(new v("<a href='#'class='ke-paste-"+k+"'>"+a[k]+"</a>")).appendTo(x);w.on("click",function(D){D.halt();if(!w.hasClass("ke-menuitem-disable")){f.hide();
setTimeout(function(){m.execCommand(k)},30)}})}q[k]=w})(z);c=q[z];(m.document.queryCommandEnabled(z)?true:false)?c.removeClass("ke-menuitem-disable"):c.addClass("ke-menuitem-disable")}})}();l.ready(function(){new t.Paste(l)})});
KISSY.Editor.add("color",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.cfg.pluginConfig;false!==t.forecolor&&function(){var v=l.addButton("color",{styles:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},mode:p.WYSIWYG_MODE,title:"\u6587\u672c\u989c\u8272",loading:true,contentCls:"ke-toolbar-color"});p.use("colorsupport",function(){v.reload(p.ColorSupport)})}();false!==t.bgcolor&&function(){var v=l.addButton("color",{styles:{element:"span",styles:{"background-color":"#(color)"}},
title:"\u80cc\u666f\u989c\u8272",mode:p.WYSIWYG_MODE,loading:true,contentCls:"ke-toolbar-bgcolor"});p.use("colorsupport",function(){v.reload(p.ColorSupport)})}()})});
KISSY.Editor.add("colorsupport",function(){function l(){if(!i){i="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var b=0;b<3;b++){i+="<div class='ke-color-palette'><table>";for(var d=j[b],e=d.length/8,g=0;g<e;g++){i+="<tr>";for(var o=0;o<8;o++){var h="#"+d[8*g+o];i+="<td>";i+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+h+"'></a>";i+="</td>"}i+="</tr>"}i+="</table></div>"}i+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
var p=KISSY,t=p.Editor,v=p.Node,u=p.Event,r=t.Overlay,n=p.DOM;n.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var j=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],i;t.ColorSupport={offClick:function(b){var d=this.cfg,e=this.colorWin;e&&e.get("visible")?e.hide():d._prepare.call(this,b)},_prepare:function(){var b=this,d=b.cfg,e=document,g=b.btn,o=b.editor,h;l();b.colorWin=new r({elCls:"ks-popup",content:i,focus4e:false,autoRender:true,width:"170px",zIndex:o.baseZIndex(t.zIndexManager.POPUP_MENU)});var a=b.colorWin;h=a.get("contentEl");h.on("click",d._selectColor,b);u.on(e,"click",d._hidePanel,b);u.on(o.document,
"click",d._hidePanel,b);a.on("show",g.bon,g);a.on("hide",g.boff,g);h.one(".ke-color-others").on("click",function(c){c.halt();a.hide();o.useDialog("color/dialog",function(f){f.show(b)})});d._prepare=d._show;d._show.call(b)},_show:function(){var b=this.btn.get("el"),d=this.colorWin,e=parseInt(d.get("width")),g=n.viewportWidth();d.align(b,["bl","tl"],[0,2]);d.get("x")+e>g-30&&d.set("x",g-30-e);d.show()},_hidePanel:function(b){var d=this.btn.get("el");b=new v(b.target);var e=this.colorWin;d._4e_equals(b)||
d.contains(b)||e.hide()},_selectColor:function(b){b.halt();var d=this.cfg;b=new v(b.target);if(b._4e_name()=="a"&&!b.hasClass("ke-button")){d._applyColor.call(this,b._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(b){var d=this.editor,e=d.document,g=this.cfg.styles;d.fire("save");b?(new t.Style(g,{color:b})).apply(e):(new t.Style(g,{color:"inherit"})).remove(e);d.fire("save")}}});
KISSY.Editor.add("contextmenu",function(){function l(b){this.cfg=b;t.Utils.lazyRun(this,"_prepareShow","_realShow")}function p(b,d){for(var e=0;e<d.length;e++){var g=d[e];if(v.isFunction(g)){if(g(new u(b)))return true}else if(r.test(b,g))return true}return false}var t=KISSY.Editor,v=KISSY,u=v.Node,r=v.DOM,n=v.Event;if(!t.ContextMenu){l.ATTRS={editor:{}};var j=[];l.register=function(b){var d=new l(b),e=b.editor.document;j.push({doc:e,rules:b.rules||[],instance:d});if(!e.ke_contextmenu){e.ke_contextmenu=
1;n.on(e,"mousedown",l.hide);n.on(e,"contextmenu",function(g){l.hide.call(this);for(var o=new u(g.target);o;){var h=false;if(o._4e_name()=="body")break;for(var a=0;a<j.length;a++){var c=j[a].instance,f=j[a].rules;if(e===j[a].doc&&p(o[0],f)){g.preventDefault();h=true;var m=g.pageX,x=g.pageY;if(!m){a=o._4e_getOffset();m=a.left;x=a.top}setTimeout(function(){c.show(t.Utils.getXY(m,x,e,document))},30);break}}if(h)break;o=o.parent()}})}return d};l.hide=function(){for(var b=0;b<j.length;b++){var d=j[b].instance;
this===j[b].doc&&d.hide()}};var i=t.Overlay;v.augment(l,{_init:function(){var b=this,d=b.cfg,e=d.funcs;b.el=new i({content:"<div>",autoRender:true,width:d.width,elCls:"ke-menu"});b.elDom=b.el.get("contentEl").one("div");d=b.elDom;for(var g in e){var o=new u("<a href='#'>"+g+"</a>");d[0].appendChild(o[0]);(function(h,a){h._4e_unselectable();h.on("click",function(c){b.hide();c.halt();setTimeout(a,30)})})(o,e[g])}},hide:function(){this.el&&this.el.hide()},_realShow:function(b){t.fire("contextmenu",{contextmenu:this});
this.el.set("xy",[b.left,b.top]);this.el.show()},_prepareShow:function(){this._init()},show:function(b){this._prepareShow(b)}});t.ContextMenu=l}});KISSY.Editor.add("draft",function(l){var p=KISSY.Editor;l.ready(function(){p.use("draft/support",function(){p.storeReady(function(){new p.Draft(l)})})})});
KISSY.Editor.add("draft/support",function(){function l(b,d,e){for(b+="";b.length<d;)b=e+b;return b}function p(b){if(v.isNumber(b))b=new Date(b);return b instanceof Date?[b.getFullYear(),"-",l(b.getMonth()+1,2,"0"),"-",l(b.getDate(),2,"0")," ",l(b.getHours(),2,"0"),":",l(b.getMinutes(),2,"0"),":",l(b.getSeconds(),2,"0")].join(""):b}function t(b){this.editor=b;this._init()}var v=KISSY,u=v.Editor,r=v.Node,n=v.Event,j=v.JSON,i=window[u.STORE];v.augment(t,{_init:function(){var b=this,d=b.editor,e=d.statusDiv,
g=d.cfg.pluginConfig;g.draft=g.draft||{};b.draftInterval=g.draft.interval=g.draft.interval||5;b.draftLimit=g.draft.limit=g.draft.limit||5;e=(new r("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+g.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);b.timeTip=(new r("<span class='ke-draft-time'>")).appendTo(e);var o=(new r("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(e),h=new u.Select({container:e,
menuContainer:document.body,doc:d.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),a=i.getItem("ke-draft-save"),c=[];b.versions=h;if(a)c=v.isString(a)?j.parse(decodeURIComponent(a)):a;b.drafts=c;b.sync();o.on("click",function(){b.save(false)});(function(){var f=d.textarea[0].form;f&&n.on(f,"submit",function(){b.save(false)})})();setInterval(function(){b.save(true)},b.draftInterval*60*1E3);h.on("click",b.recover,b);b.holder=e;if(g.draft.helpHtml){g=new u.TripleButton({cls:"ke-draft-help",
title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:e});g.on("click",function(){b._prepareHelp()});u.Utils.lazyRun(b,"_prepareHelp","_realHelp");b.helpBtn=g.el}b._holder=e},_prepareHelp:function(){var b=this,d=b.editor,e=b.helpBtn,g=new r(d.cfg.pluginConfig.draft.helpHtml||""),o=new r("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
g.append(o);g.css({border:"1px solid #ACB4BE","text-align":"left"});b._help=new v.Overlay({content:g,autoRender:true,width:g.width()+"px",mask:false});b._help.el.css("border","none");b._help.arrow=o;n.on([document,d.document],"click",function(h){h=new r(h.target);h[0]==e[0]||e.contains(h)||b._help.hide()})},_realHelp:function(){var b=this._help,d=this.helpBtn,e=b.arrow;b.show();d=d.offset();b.el.offset({left:d.left-b.el.width()+17,top:d.top-b.el.height()-7});e.offset({left:d.left-2,top:d.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var b=this.draftLimit,d=this.timeTip,e=this.versions,g=this.drafts;g.length>b&&g.splice(0,g.length-b);b=[];for(var o,h=0;h<g.length;h++){o=g[h];o=(o.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+p(o.date);b.push({name:o,value:h})}e.set("items",b.reverse());d.html(o);i.setItem("ke-draft-save",encodeURIComponent(j.stringify(g)))},save:function(b){var d=this.drafts,e=this.editor.getData(true);if(e){if(d[d.length-
1]&&e==d[d.length-1].content)d.length-=1;this.drafts=d.concat({content:e,date:(new Date).getTime(),auto:b});this.sync()}},recover:function(b){var d=this.editor,e=this.drafts;b=b.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+p(e[b].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){d.fire("save");d.setData(e[b].content);d.fire("save")}}});u.Draft=t});
KISSY.Editor.add("elementpaths",function(l){var p=KISSY.Editor,t=KISSY,v=t.Node,u=t.DOM;p.ElementPaths||function(){function r(n){this.cfg=n;this._cache=[];this._init()}u.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");t.augment(r,{_init:function(){var n=this.cfg.editor;this.holder=new v("<span>");this.holder.appendTo(n.statusDiv);n.on("selectionChange",this._selectionChange,this);
p.Utils.sourceDisable(n,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(n){var j=this.cfg.editor,i=this.holder;n=n.path.elements;var b,d;b=this._cache;for(d=0;d<b.length;d++){b[d].detach("click");b[d]._4e_remove()}this._cache=[];for(d=0;d<n.length;d++){b=n[d];var e=new v("<a href='#' class='elementpath'>"+(b.attr("_ke_real_element_type")||b._4e_name())+"</a>");this._cache.push(e);(function(g){e.on("click",
function(o){o.halt();j.focus();setTimeout(function(){j.getSelection().selectElement(g)},50)})})(b);i.prepend(e)}}});p.ElementPaths=r}();l.ready(function(){new p.ElementPaths({editor:l})})});
KISSY.Editor.add("enterkey",function(l){var p=KISSY.Editor,t=KISSY,v=t.UA,u=/^h[1-6]$/,r=p.XHTML_DTD,n=t.Node,j=t.Event,i=p.Walker,b=p.ElementPath;p.enterBlock||function(){function d(e){j.on(e.document,"keydown",function(g){if(g.keyCode===13)if(!g.shiftKey){e.fire("save");var o=e.execCommand("enterBlock");e.fire("save");o!==false&&g.preventDefault()}})}d.enterBlock=function(e){var g;g=e.getSelection().getRanges();for(var o=g.length-1;o>0;o--)g[o].deleteContents();g=g[0];o=g.document;if(g.checkStartOfBlock()&&
g.checkEndOfBlock()){var h=(new b(g.startContainer)).block;if(h&&(h._4e_name()=="li"||h.parent()._4e_name()=="li"))if(e.hasCommand("outdent")){e.fire("save");e.execCommand("outdent");e.fire("save");return}else return false}var a=g.splitBlock("p");if(a){e=a.previousBlock;h=a.nextBlock;var c=a.wasStartOfBlock,f=a.wasEndOfBlock,m;if(h){m=h.parent();if(m._4e_name()=="li"){h._4e_breakParent(m);h._4e_move(h._4e_next(),true)}}else if(e&&(m=e.parent())&&m._4e_name()=="li"){e._4e_breakParent(m);g.moveToElementEditablePosition(e._4e_next());
e._4e_move(e._4e_previous())}if(!c&&!f){if(h._4e_name()=="li"&&(m=h._4e_first(i.invisible(true)))&&t.inArray(m._4e_name(),["ul","ol"]))(v.ie?new n(o.createTextNode("\u00a0")):new n(o.createElement("br"))).insertBefore(m);h&&g.moveToElementEditablePosition(h)}else{var x;if(e){if(e._4e_name()=="li"||!u.test(e._4e_name()))x=e._4e_clone()}else if(h)x=h._4e_clone();x||(x=new n("<p>",null,o));if(m=a.elementPath){a=0;for(var q=m.elements.length;a<q;a++){var z=m.elements[a];if(z._4e_equals(m.block)||z._4e_equals(m.blockLimit))break;
if(r.$removeEmpty[z._4e_name()]){z=z._4e_clone();x._4e_moveChildren(z);x.append(z)}}}v.ie||x._4e_appendBogus();g.insertNode(x);if(v.ie&&c&&(!f||!e[0].childNodes.length)){g.moveToElementEditablePosition(f?e:x);g.select()}g.moveToElementEditablePosition(c&&!f?h:x)}if(!v.ie)if(h){x=new n(o.createElement("span"));x.html("&nbsp;");g.insertNode(x);x._4e_scrollIntoView();g.deleteContents()}else x._4e_scrollIntoView();g.select()}};p.EnterKey=d}();l.ready(function(){l.addCommand("enterBlock",{exec:p.EnterKey.enterBlock});
p.EnterKey(l)})});
KISSY.Editor.add("fakeobjects",function(l){var p=KISSY.Editor,t=KISSY,v=t.Node,u=p.NODE,r=p.Config.base+"theme/spacer.gif",n=p.HtmlParser;p=t.Editor;var j=(l=l.htmlDataProcessor)&&l.htmlFilter,i={elements:{$:function(b){var d=b.attributes;if((d=(d=(d=d&&d._ke_realelement)&&new n.Fragment.FromHtml(decodeURIComponent(d)))&&d.children[0])&&b.attributes._ke_resizable){var e=b.attributes.style;if(e){var g=/(?:^|\s)width\s*:\s*(\d+)/i.exec(e);b=g&&g[1];e=(g=/(?:^|\s)height\s*:\s*(\d+)/i.exec(e))&&g[1];
if(b)d.attributes.width=b;if(e)d.attributes.height=e}}return d}}};j&&j.addRules(i);l&&t.mix(l,{createFakeParserElement:function(b,d,e,g,o){var h;h=new n.BasicWriter;b.writeHtml(h);h=h.getHtml();var a=b.attributes.style;if(b.attributes.width)a="width:"+b.attributes.width+"px;"+a;if(b.attributes.height)a="height:"+b.attributes.height+"px;"+a;b={"class":d,src:r,_ke_realelement:encodeURIComponent(h),_ke_real_node_type:b.type,style:a,align:b.attributes.align||""};o&&delete o.width;o&&delete o.height;o&&
t.mix(b,o,false);if(e)b._ke_real_element_type=e;if(g)b._ke_resizable=g;return new n.Element("img",b)}});t.augment(p,{createFakeElement:function(b,d,e,g,o,h){var a=b.attr("style")||"";if(b.attr("width"))a="width:"+b.attr("width")+"px;"+a;if(b.attr("height"))a="height:"+b.attr("height")+"px;"+a;b={"class":d,src:r,_ke_realelement:encodeURIComponent(o||b._4e_outerHtml()),_ke_real_node_type:b[0].nodeType,style:a};h&&delete h.width;h&&delete h.height;h&&t.mix(b,h,false);if(e)b._ke_real_element_type=e;if(g)b._ke_resizable=
g;return new v("<img/>",b,this.document)},restoreRealElement:function(b){if(b.attr("_ke_real_node_type")!=u.NODE_ELEMENT)return null;b=decodeURIComponent(b.attr("_ke_realelement"));var d=new v("<div>",null,this.document);d.html(b);return d._4e_first(function(e){return e[0].nodeType==u.NODE_ELEMENT})._4e_remove()}})});
KISSY.Editor.add("flash",function(l){l.ready(function(){var p=KISSY,t=p.Editor,v=l.htmlDataProcessor,u=l.cfg.pluginConfig,r=v&&v.dataFilter;r&&r.addRules({elements:{object:function(n){var j=n.attributes;if(!(j.classid&&String(j.classid).toLowerCase())){for(j=0;j<n.children.length;j++)if(n.children[j].name=="embed"){if(!t.Utils.isFlashEmbed(n.children[j]))break;return v.createFakeParserElement(n,"ke_flash","flash",true)}return null}return v.createFakeParserElement(n,"ke_flash","flash",true)},embed:function(n){if(!t.Utils.isFlashEmbed(n))return null;
return v.createFakeParserElement(n,"ke_flash","flash",true)}}},5);t.use("flash/support",function(){var n=t.Flash;l.addCommand("insertFlash",{exec:function(){var j=p.makeArray(arguments);return t.Flash.Insert.apply(null,j)}});if(!u.flash||u.flash.btn!==false)new n(l)})})});
KISSY.Editor.add("flash/support",function(){function l(g){this.editor=g;this._init()}function p(g){return g._4e_name()==="img"&&!!g.hasClass(b)&&g}var t=KISSY.Editor,v=KISSY,u=v.UA,r=v.Event,n=t.ContextMenu,j=v.Node,i=t.BubbleView,b="ke_flash",d=t.Utils.flash;v.augment(l,{_config:function(){this._cls=b;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=e;this._flashRules=["img."+b]},_init:function(){this._config();var g=this,o=g.editor,h={},a=g._contextMenu;
o.addButton("flash",{contentCls:g._contentCls,title:g._tip,mode:t.WYSIWYG_MODE,offClick:function(){g.show()}});if(a)for(var c in a)(function(f){h[f]=function(){a[f](g)}})(c);n.register({editor:o,rules:g._flashRules,width:"120px",funcs:h});i.attach({pluginName:g._type,editor:g.editor,pluginContext:g});r.on(o.document,"dblclick",g._dbclick,g)},_getFlashUrl:function(g){return d.getUrl(g)},_updateTip:function(g,o){var h=this.editor.restoreRealElement(o);if(h){h=this._getFlashUrl(h);g.html(h);g.attr("href",
h)}},_dbclick:function(g){var o=new j(g.target);if(o._4e_name()==="img"&&o.hasClass(this._cls)){this.show(null,o);g.halt()}},show:function(g,o){this.editor.useDialog(this._type+"/dialog",function(h){h.show(o)})}});t.Flash=l;l.registerBubble=function(g,o,h){i.register({pluginName:g,func:h,init:function(){var a=this,c=a.get("contentEl");c.html(o+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var f=c.one(".ke-bubbleview-url"),m=c.one(".ke-bubbleview-change"),x=c.one(".ke-bubbleview-remove");t.Utils.preventFocus(c);m.on("click",function(q){a._plugin.show(null,a._selectedEl);q.halt()});x.on("click",function(q){var z=a._plugin;if(u.webkit){var k=z.editor.getSelection().getRanges();k&&k[0]&&(k[0].collapse(true)||1)&&k[0].select()}a._selectedEl._4e_remove();a.hide();z.editor.notifySelectionChange();q.halt()});a.on("show",function(){var q=a._selectedEl;q&&a._plugin._updateTip(f,q)})}})};l.registerBubble("flash",
"Flash \u7f51\u5740\uff1a ",p);l.checkFlash=p;var e={"Flash\u5c5e\u6027":function(g){var o=g.editor.getSelection();o=o&&o.getStartElement();(o=p(o))&&g.show(null,o)}};l.CLS_FLASH=b;l.TYPE_FLASH="flash";l.Insert=function(g,o,h,a,c){o=d.createSWF(o,{attrs:h},g.document);var f=o.el;h=g.createFakeElement?g.createFakeElement(f,a||"ke_flash",c||"flash",true,o.html,h):f;return h=g.insertElement(h)};t.Flash=l});
KISSY.Editor.add("flashbridge",function(){function l(d){this._init(d)}function p(d){var e=v.isString(d)?d.match(/(\d)+/g):d;d=d;if(v.isArray(e))d=parseFloat(e[0]+"."+t(e[1],3)+t(e[2],5));return d||0}function t(d,e){for(var g=(d+"").length;g++<e;)d="0"+d;return d}var v=KISSY,u=v.Editor;if(!u.FlashBridge){var r={};v.augment(l,v.EventTarget,{_init:function(d){var e=v.guid("flashbridge-");d.flashVars=d.flashVars||{};d.attrs=d.attrs||{};d.params=d.params||{};var g=d.flashVars,o=d.params;v.mix(d.attrs,
{id:e,width:"100%",height:"100%"},false);v.mix(o,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);v.mix(g,{shareData:false,useCompression:false},false);o={YUISwfId:e,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(d.ajbridge)o={swfID:e,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};v.mix(g,o);r[e]=this;this.id=e;this.swf=u.Utils.flash.createSWFRuntime(d.movie,d);this._expose(d.methods)},_expose:function(d){for(var e=this,g=0;g<d.length;g++)(function(o){e[o]=
function(){return e._callSWF(o,v.makeArray(arguments))}})(d[g])},_callSWF:function(d,e){e=e||[];try{if(this.swf[d])return this.swf[d].apply(this.swf,e)}catch(g){var o="";if(e.length!==0)o="'"+e.join("', '")+"'";return(new Function("self","return self.swf."+d+"("+o+");"))(this)}},_eventHandler:function(d){var e=d.type;if(e==="log")v.log(d.message);else e&&this.fire(e,d)},_destroy:function(){delete r[this.id]}});l.EventHandler=function(d,e){var g=r[d];g&&setTimeout(function(){g._eventHandler.call(g,
e)},100)};u.FlashBridge=l;var n=v.UA,j,i,b=true;n.fpv=function(d){if(d||b){b=false;var e;if(navigator.plugins&&navigator.mimeTypes.length)e=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(g){}j=e?e.match(/(\d)+/g):void 0;i=p(j)}return j};n.fpvGEQ=function(d,e){b&&n.fpv(e);return!!i&&i>=p(d)}}});
KISSY.Editor.add("flashutils",function(){var l=KISSY,p=l.Editor,t=p.Utils.flash;if(!t){var v=l.DOM,u=l.Node,r=l.UA;t={getUrl:function(n){var j="",i=p.NODE;if(n._4e_name()=="object"){n=n[0].childNodes;for(var b=0;b<n.length;b++)if(n[b].nodeType==i.NODE_ELEMENT)if((v.attr(n[b],"name")||"").toLowerCase()=="movie")j=v.attr(n[b],"value");else if(v._4e_name(n[b])=="embed")j=v.attr(n[b],"src");else if(v._4e_name(n[b])=="object")j=v.attr(n[b],"data")}else if(n._4e_name()=="embed")j=n.attr("src");return j},
createSWF:function(n,j,i){var b=j.attrs||{},d=j.flashVars,e="",g="";j=j.params||{};var o="";i=i||document;l.mix(b,{wmode:"transparent"});for(var h in b)if(b.hasOwnProperty(h))e+=h+"='"+b[h]+"' ";l.mix(j,{quality:"high",movie:n,wmode:"transparent"});for(var a in j)if(j.hasOwnProperty(a))g+="<param name='"+a+"' value='"+j[a]+"'/>";if(d){for(var c in d)if(d.hasOwnProperty(c))o+="&"+c+"="+encodeURIComponent(d[c]);o=o.substring(1)}n="<object "+e+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
g+(o?'<param name="flashVars" value="'+o+'"/>':"")+"<embed "+e+" "+(o?'FlashVars="'+o+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+n+'"  type="application/x-shockwave-flash"/></object>';return{el:new u(n,null,i),html:n}},createSWFRuntime2:function(n,j,i){i=i||document;var b=(new u("<div style='width:0;height:0;overflow:hidden;'>",null,i)).appendTo(i.body);b=t.createSWF.apply(this,arguments).el.appendTo(b);r.ie||(b=b.one("object"));return b[0]},createSWFRuntime:function(n,
j,i){var b=j.attrs||{},d=j.flashVars||{},e=j.params||{},g="",o="",h="";i=i||document;b.id=b.id||l.guid("ke-runtimeflash-");for(var a in b)if(b.hasOwnProperty(a))g+=a+"='"+b[a]+"' ";for(var c in e)if(e.hasOwnProperty(c))o+="<param name='"+c+"' value='"+e[c]+"'/>";for(var f in d)if(d.hasOwnProperty(f))h+="&"+f+"="+encodeURIComponent(d[f]);h=h.substring(1);n=r.ie?"<object "+g+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+o+'<param name="movie" value="'+n+'" />'+(h?'<param name="flashVars" value="'+
h+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+n+"' "+g+">"+o+(h?'<param name="flashVars" value="'+h+'"/>':"")+"</object>";var m=j.holder;if(!m){m=(new u("<div style='"+(j.style?j.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,i)).appendTo(i.body);setTimeout(function(){m.offset({left:v.scrollLeft(),top:v.scrollTop()})},100)}m.html(n);return i.getElementById(b.id)}};p.Utils.flash=t}});
KISSY.Editor.add("font",function(l){function p(x){for(var q=[],z=0;z<x.length;z++)q.push({name:x[z],value:x[z]});return q}var t=KISSY,v=t.Editor,u=v.Style,r=v.TripleButton,n=l.cfg.pluginConfig,j=t.Node,i=n["font-size"],b,d,e;if(i!==false){i=i||{};t.mix(i,{items:p(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var g={},o=[],h={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(m=0;m<i.items.length;m++){b=
i.items[m];d=b.name;e=b.attrs;b=b.value;g[b]=new u(h,{size:b});o.push({name:d,value:b,attrs:e})}n["font-size"]=i}var a=n["font-family"];if(a!==false){a=a||{};t.mix(a,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},
{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var c={},f=[];h={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};var m;n["font-family"]=a;for(m=0;m<a.items.length;m++){b=a.items[m];d=b.name;e=b.attrs||{};b=b.value;e.style=e.style||"";e.style+=";font-family:"+b;c[b]=new u(h,{family:b});f.push({name:d,value:b,attrs:e})}}v.FontSelect||function(){function x(z){x.superclass.constructor.call(this,z);this._init()}
x.ATTRS={title:{},html:{},styles:{},editor:{}};var q=v.Select;t.extend(x,t.Base,{_init:function(){var z=this.get("editor"),k=z.toolBarDiv;this.get("html");this.el=new q({container:k,doc:z.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new j(document.body)});this.el.on("click",this._vChange,this);z.on("selectionChange",this._selectionChange,this);v.Utils.sourceDisable(z,this)},disable:function(){this.el.set("state",
q.DISABLED)},enable:function(){this.el.set("state",q.ENABLED)},_vChange:function(z){var k=this.get("editor"),w=z.newVal;z=z.prevVal;var D=this.get("styles");k.focus();k.fire("save");D=D[w];if(w==z){D.remove(k.document);this.el.set("value","")}else D.apply(k.document);k.fire("save")},_selectionChange:function(z){this.get("editor");z=z.path.elements;for(var k=this.get("styles"),w=0,D;w<z.length;w++){D=z[w];for(var B in k)if(k[B].checkElementRemovable(D,true)){this.el.set("value",B);return}}this.el.reset("value")}});
v.FontSelect=x}();l.ready(function(){false!==n["font-size"]&&new v.FontSelect({editor:l,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:i.width,styles:g,html:o});false!==n["font-family"]&&new v.FontSelect({editor:l,title:"\u5b57\u4f53",width:"110px",popUpWidth:a.width,styles:c,html:f});var x={mode:v.WYSIWYG_MODE,offClick:function(){var q=this.editor,z=this.cfg.style;q.fire("save");z.apply(q.document);q.fire("save");q.notifySelectionChange();q.focus()},onClick:function(){var q=this.editor,z=this.cfg.style;
q.fire("save");z.remove(q.document);q.fire("save");q.notifySelectionChange();q.focus()},selectionChange:function(q){var z=this.btn;this.cfg.style.checkActive(q.path)?z.set("state",r.ON):z.set("state",r.OFF)}};false!==n["font-bold"]&&l.addButton("font-bold",t.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",style:new u({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},x));false!==n["font-italic"]&&l.addButton("font-italic",t.mix({contentCls:"ke-toolbar-italic",
title:"\u659c\u4f53 ",style:new u({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},x));false!==n["font-underline"]&&l.addButton("font-underline",t.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new u({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})},x));false!==n["font-strikeThrough"]&&l.addButton("font-underline",t.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new u({element:"del",overrides:[{element:"span",
attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})},x))})});
KISSY.Editor.add("format",function(l){var p=KISSY.Editor,t=KISSY,v=t.Node,u=[],r={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},n={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},j={},i=p.Style,b;for(b in r)if(r[b]){j[r[b]]=new i({element:r[b]});u.push({name:b,value:r[b],attrs:{style:"font-size:"+n[r[b]]}})}p.Format||function(){function d(g){d.superclass.constructor.call(this,g);this._init()}d.ATTRS={editor:{}};var e=p.Select;t.extend(d,t.Base,
{_init:function(){var g=this.get("editor");this.el=new e({container:g.toolBarDiv,value:"",doc:g.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new v(document.body)});this.el.on("click",this._vChange,this);g.on("selectionChange",this._selectionChange,this);p.Utils.sourceDisable(g,this)},disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.ENABLED)},_vChange:function(g){var o=this.get("editor"),
h=g.newVal;g=g.prevVal;o.fire("save");if(h!=g)j[h].apply(o.document);else{j.p.apply(o.document);this.el.set("value","p")}o.fire("save")},_selectionChange:function(g){this.get("editor");g=g.path;for(var o in j)if(j[o].checkActive(g)){this.el.set("value",o);break}}});p.Format=d}();l.ready(function(){new p.Format({editor:l,html:u,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(l){var p=p,t=KISSY,v=t.Editor,u=t.Node,r=t.UA,n=v.NODE,j=v.HtmlParser,i=new j.Filter,b=new j.Filter,d=v.XHTML_DTD;if(!l.htmlDataProcessor){(function(){var e=v.HtmlParser.Fragment.prototype,g=v.HtmlParser.Element.prototype;e.onlyChild=g.onlyChild=function(){var o=this.children;return o.length==1&&o[0]||null};g.removeAnyChildWithName=function(o){for(var h=this.children,a=[],c,f=0;f<h.length;f++){c=h[f];if(c.name){if(c.name==o){a.push(c);h.splice(f--,1)}a=
a.concat(c.removeAnyChildWithName(o))}}return a};g.getAncestor=function(o){for(var h=this.parent;h&&!(h.name&&h.name.match(o));)h=h.parent;return h};e.firstChild=g.firstChild=function(o){for(var h,a=0;a<this.children.length;a++){h=this.children[a];if(o(h))return h;else if(h.name)if(h=h.firstChild(o))return h}return null};g.addStyle=function(o,h,a){var c="";if(typeof h=="string")c+=o+":"+h+";";else{if(typeof o=="object")for(var f in o){if(o.hasOwnProperty(f))c+=f+":"+o[f]+";"}else c+=o;a=h}if(!this.attributes)this.attributes=
{};o=this.attributes.style||"";o=(a?[c,o]:[o,c]).join(";");this.attributes.style=o.replace(/^;|;(?=;)/,"")};d.parentOf=function(o){var h={},a;for(a in this)if(a.indexOf("$")==-1&&this[a][o])h[a]=1;return h}})();(function(){function e(k){if(/mso-list\s*:\s*Ignore/i.test(k.attributes&&k.attributes.style))return true;return p}function g(k,w){var D=new v.HtmlParser.Element("ke:listbullet"),B;if(k)if(k[2]){k=isNaN(k[1])?/^[a-z]+$/.test(k[1])?"lower-alpha":/^[A-Z]+$/.test(k[1])?"upper-alpha":"decimal":
"decimal";B="ol"}else{k=/[l\u00B7\u2002]/.test(k[1])?"disc":/[\u006F\u00D8]/.test(k[1])?"circle":/[\u006E\u25C6]/.test(k[1])?"square":"disc";B="ul"}else{k="decimal";B="ol"}D.attributes={"ke:listtype":B,style:"list-style-type:"+k+";"};D.add(new v.HtmlParser.Text(w));return D}function o(k){var w=k.attributes,D;if((D=k.removeAnyChildWithName("ke:listbullet"))&&D.length&&(D=D[0])){k.name="ke:li";if(w.style)w.style=h([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");
B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!f&&m&&B>m)f=B-m;w["ke:margin"]=m=B}]],p)(w.style,k)||"";D=D.attributes;k.addStyle(D.style);t.mix(w,D);return true}return false}function h(k,w){return function(D,B){var s=[];D.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(A,E,C){E=E.toLowerCase();E=="font-family"&&(C=C.replace(/["']/g,""));for(var F,M,P,L=0;L<k.length;L++)if(k[L]){A=k[L][0];F=k[L][1];M=k[L][2];P=k[L][3];if(E.match(A)&&(!F||C.match(F))){E=P||E;w&&(M=M||C);if(typeof M==
"function")M=M(C,B,E);if(M&&M.push){E=M[0];M=M[1]}typeof M=="string"&&s.push([E,M]);return}}!w&&s.push([E,C])});for(var y=0;y<s.length;y++)s[y]=s[y].join(":");return s.length?s.join(";")+";":false}}function a(k){k=k.children;for(var w,D,B,s,y,A,E,C=0;C<k.length;C++){w=k[C];if("ke:li"==w.name){w.name="li";w=w;D=w.attributes;B=w.attributes["ke:listtype"];s=parseInt(D["ke:indent"],10)||f&&Math.ceil(D["ke:margin"]/f)||1;D.style&&(D.style=h([["list-style-type",B=="ol"?"decimal":"disc"]],p)(D.style)||"");
if(A){if(s>E){A=new v.HtmlParser.Element(B);A.add(w);y.add(A)}else{if(s<E){y=E-s;for(var F;y--&&(F=A.parent);)A=F.parent}A.add(w)}k.splice(C--,1)}else{A=new v.HtmlParser.Element(B);A.add(w);k[C]=A}y=w;E=s}else A=null}f=0}var c=h([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],p),f,m=0,x=d.parentOf("ol"),q={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(k){k.filterChildren();
a(k)},elements:{font:function(k){delete k.name},p:function(k){k.filterChildren();if(o(k))return p},$:function(k){var w=k.name||"";w.indexOf(":")!=-1&&w.indexOf("ke")==-1&&delete k.name;var D=k.attributes.style;if(w=="span"&&(!D||!c(D)))delete k.name;if(w in x){k.filterChildren();a(k)}},span:function(k){if(!r.gecko&&e(k.parent))return false;if(!r.gecko&&e(k)){k=(k=k.firstChild(function(D){return D.value||D.name=="img"}))&&(k.value||"l.");var w=k.match(/^([^\s]+?)([.)]?)$/);return g(w,k)}},a:function(k){k=
k.attributes;if(k.href)k._ke_saved_href=k.href}},comment:!r.ie?function(k,w){var D=k.match(/<img.*?>/),B=k.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(D=B[1]||D&&"l.")&&D.match(/>([^\s]+?)([.)]?)</);return g(B,D)}if(r.gecko&&D){D=v.HtmlParser.Fragment.FromHtml(D[0]).children[0];(B=(B=(B=w.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(D.attributes.src=B);return D}return false}:function(){return false},attributes:{"class":function(k){if(/(^|\s+)ke_/.test(k))return k;
return false},style:function(k){k=c(k);if(!k)return false;return k}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},z={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(k){var w=k.parent;if(w&&w.name=="object"){var D=w.attributes.width;w=w.attributes.height;D&&(k.attributes.width=D);w&&(k.attributes.height=w)}},param:function(k){k.children=[];k.isEmpty=true;return k},a:function(k){if(!(k.children.length||k.attributes.name))return false;k=k.attributes;if(k._ke_saved_href)k.href=
k._ke_saved_href},td:function(k){for(var w=k.children,D=0;D<w.length;D++)if(w[D].name=="br"){w.splice(D,1);--D}if(!k.children.length){w=new v.HtmlParser.Text("&nbsp;");k.children.push(w)}},span:function(k){if(!k.children.length)return false}},attributes:{style:function(k){if(!t.trim(k))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(r.ie)z.attributes.style=function(k){return k.toLowerCase()};i.addRules(z);b.addRules(q)})();(function(){function e(z){for(var k=z.children.length,
w=z.children[k-1];w&&w.type==n.NODE_TEXT&&!t.trim(w.value);)w=z.children[--k];return w}function g(z){var k=e(z);return!k||k.type==n.NODE_ELEMENT&&k.name=="br"||z.name=="form"&&k.name=="input"}function o(z,k){var w=z.children,D=e(z);if(D){if((k||!r.ie)&&D.type==n.NODE_ELEMENT&&D.name=="br")w.pop();D.type==n.NODE_TEXT&&c.test(D.value)&&w.pop()}}function h(z){o(z,true);if(g(z))r.ie?z.add(new v.HtmlParser.Text("\u00a0")):z.add(new v.HtmlParser.Element("br",{}))}function a(z){o(z);g(z)&&z.add(new v.HtmlParser.Text("\u00a0"))}
var c=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,f=v.XHTML_DTD,m=v.Utils.mix({},f.$block,f.$listItem,f.$tableContent),x;for(x in m)"br"in f[x]||delete m[x];delete m.pre;f={elements:{}};var q={elements:{}};for(x in m){f.elements[x]=h;q.elements[x]=a}b.addRules(f);i.addRules(q)})();(function(){i.addRules({text:function(e){return e.replace(/\xa0/g,"&nbsp;")}})})();l.htmlDataProcessor={htmlFilter:i,dataFilter:b,toHtml:function(e,g){var o=new j.HtmlWriter;j.Fragment.FromHtml(e,g).writeHtml(o,i);return o.getHtml(true)},
toDataFormat:function(e,g){if(r.gecko)e=e.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var o=new u("<div>");o.html("a"+e);e=o.html().substr(1);o=new j.BasicWriter;var h=j.Fragment.FromHtml(e,g);o.reset();h.writeHtml(o,b);return o.getHtml(true)},toServer:function(e,g){var o=new j.BasicWriter;j.Fragment.FromHtml(e,g).writeHtml(o,i);return o.getHtml(true)}}}});
KISSY.Editor.add("image",function(l){var p=KISSY,t=p.Editor,v=p.UA,u=p.Node,r=p.Event,n=t.BubbleView,j=function(i){return i._4e_name()==="img"&&!/(^|\s+)ke_/.test(i[0].className)&&i};l.ready(function(){var i=l.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:t.WYSIWYG_MODE,offClick:function(){this.call("show")},_updateTip:function(g,o){var h=o.attr("src");g.html(h);g.attr("href",h)},show:function(g,o){this.editor.useDialog("image/dialog",function(h){h.show(o)})}}),b={"\u56fe\u7247\u5c5e\u6027":function(g){g=
(g=g.getSelection())&&g.getStartElement();(g=j(g))&&i.call("show",null,g)}},d={},e;for(e in b)(function(g){d[g]=function(){b[g](l)}})(e);t.ContextMenu.register({editor:l,rules:[j],width:"120px",funcs:d});r.on(l.document,"dblclick",function(g){var o=new u(g.target);g.halt();j(o)&&i.call("show",null,o)});n.register({pluginName:"image",pluginContext:i,editor:l,func:j,init:function(){var g=this,o=g.get("contentEl");o.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=o.one(".ke-bubbleview-url"),a=o.one(".ke-bubbleview-change"),c=o.one(".ke-bubbleview-remove");t.Utils.preventFocus(o);a.on("click",function(f){g._plugin.call("show",null,g._selectedEl);f.halt()});c.on("click",function(f){var m=g._plugin;if(v.webkit){var x=m.editor.getSelection().getRanges();x&&x[0]&&(x[0].collapse(true)||1)&&x[0].select()}g._selectedEl._4e_remove();g.hide();m.editor.notifySelectionChange();f.halt()});g.on("show",function(){var f=g._selectedEl;f&&g._plugin.call("_updateTip",
h,f)})}})})});
KISSY.Editor.add("indent",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.addButton("outdent",{title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent",type:"outdent",loading:true}),v=l.addButton("indent",{title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-indent",type:"indent",loading:true});p.use("indent/support",function(){t.reload(p.IndentSupport);v.reload(p.IndentSupport)});l.addCommand("indent",{exec:function(){v.call("offClick")}});l.addCommand("outdent",{exec:function(){t.call("offClick")}})})});
KISSY.Editor.add("indent/support",function(){function l(h){this.type=h;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function p(h){return h[0].nodeType==e.NODE_ELEMENT&&h._4e_name()=="li"}function t(h,a){for(var c=h.startContainer,f=h.endContainer;c&&!c.parent()._4e_equals(a);)c=c.parent();for(;f&&!f.parent()._4e_equals(a);)f=f.parent();if(c&&f){var m=c;c=[];for(var x=false;!x;){if(m._4e_equals(f))x=true;c.push(m);m=m.next()}if(!(c.length<1)){m=a._4e_parents(true);
for(f=0;f<m.length;f++)if(r[m[f]._4e_name()]){a=m[f];break}m=this.type=="indent"?1:-1;f=c[0];x=c[c.length-1];c={};var q=u.ListUtils.listToArray(a,c),z=q[x.data("listarray_index")].indent;for(f=f.data("listarray_index");f<=x.data("listarray_index");f++){q[f].indent+=m;var k=q[f].parent;q[f].parent=new b(k[0].ownerDocument.createElement(k._4e_name()))}for(f=x.data("listarray_index")+1;f<q.length&&q[f].indent>z;f++)q[f].indent+=m;x=u.ListUtils.arrayToList(q,c,null,"p",0);m=[];if(this.type=="outdent"){var w;
if((w=a.parent())&&w._4e_name()=="li"){q=x.listNode.childNodes;var D;for(f=q.length-1;f>=0;f--)if((D=new b(q[f]))&&D._4e_name()=="li")m.push(D)}}if(x){i.insertBefore(x.listNode,a);a._4e_remove()}if(m&&m.length)for(f=0;f<m.length;f++){for(x=D=m[f];(x=x.next())&&x._4e_name()in r;){d.ie&&!D._4e_first(function(B){return g(B)&&o(B)})&&D[0].appendChild(h.document.createTextNode("\u00a0"));D[0].appendChild(x[0])}i.insertAfter(D[0],w[0])}u.Utils.clearAllMarkers(c)}}}function v(h){var a=parseInt(h._4e_style(this.indentCssProperty),
10);if(isNaN(a))a=0;a+=(this.type=="indent"?1:-1)*this.indentOffset;if(a<0)return false;a=Math.max(a,0);a=Math.ceil(a/this.indentOffset)*this.indentOffset;h.css(this.indentCssProperty,a?a+this.indentUnit:"");h[0].style.cssText===""&&h.removeAttr("style");return true}var u=KISSY.Editor,r={ol:1,ul:1},n=KISSY,j=u.Walker,i=n.DOM,b=n.Node,d=n.UA,e=u.NODE,g=j.whitespaces(true),o=j.bookmark(false,true);n.augment(l,{exec:function(h){for(var a=(h=h.getSelection())&&h.getRanges()[0],c=a.startContainer,f=a.endContainer,
m=a.getCommonAncestor();m&&!(m[0].nodeType==e.NODE_ELEMENT&&r[m._4e_name()]);)m=m.parent();if(m&&c[0].nodeType==e.NODE_ELEMENT&&c._4e_name()in r){c=new j(a);c.evaluator=p;a.startContainer=c.next()}if(m&&f[0].nodeType==e.NODE_ELEMENT&&f._4e_name()in r){c=new j(a);c.evaluator=p;a.endContainer=c.previous()}f=h.createBookmarks(true);if(m){for(c=m._4e_first();c&&c._4e_name()!="li";)c=c.next();var x=a.startContainer;(c[0]==x[0]||c.contains(x))&&v.call(this,m)||t.call(this,a,m)}else{a=a.createIterator();
a.enforceRealBlocks=true;for(a.enlargeBr=true;m=a.getNextParagraph();)v.call(this,m)}h.selectBookmarks(f)}});u.IndentSupport={init:function(){this.indentCommand=new l(this.cfg.type)},offClick:function(){var h=this,a=h.editor;a.fire("save");setTimeout(function(){h.indentCommand.exec(a);a.fire("save");a.notifySelectionChange()},10)},selectionChange:function(h){if(this.cfg.type=="outdent"){var a=h.path,c=a.blockLimit;h=this.btn;if(a.contains(r))h.boff();else(a=a.block||c)&&a._4e_style(this.indentCommand.indentCssProperty)?
h.boff():h.disable()}}}});
KISSY.Editor.add("justify",function(l){var p=KISSY,t=p.Editor,v=t.TripleButton,u=/(-moz-|-webkit-|start|auto)/gi;l.ready(function(){var r={mode:t.WYSIWYG_MODE,offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var n=this.editor,j=n.getSelection(),i=this.btn.get("state");if(j){var b=j.createBookmarks(),d=j.getRanges(),e,g;n.fire("save");for(var o=d.length-1;o>=0;o--){e=d[o].createIterator();for(e.enlargeBr=true;g=e.getNextParagraph();){g.removeAttr("align");i==
v.OFF?g.css("text-align",this.cfg.v):g.css("text-align","")}}n.notifySelectionChange();j.selectBookmarks(b);n.fire("save")}},selectionChange:function(n){var j=this.btn;n=n.path;n=n.block||n.blockLimit;if(!n||n._4e_name()==="body")j.boff();else(n.css("text-align").replace(u,"")||"left")==this.cfg.v?j.bon():j.boff()}};l.addButton("alignleft",p.mix({contentCls:"ke-toolbar-alignleft",title:"\u5de6\u5bf9\u9f50",v:"left"},r));l.addButton("aligncenter",p.mix({contentCls:"ke-toolbar-aligncenter",title:"\u5c45\u4e2d\u5bf9\u9f50",v:"center"},
r));l.addButton("alignright",p.mix({contentCls:"ke-toolbar-alignright",title:"\u53f3\u5bf9\u9f50",v:"right"},r))})});
KISSY.Editor.add("link",function(l){function p(i){return i._4e_ascendant(function(b){return b._4e_name()==="a"&&!!b.attr("href")},true)}var t=KISSY,v=t.Editor,u=t.Node,r=v.Style,n=v.BubbleView,j={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};l.ready(function(){var i=l.addButton("link",{contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:v.WYSIWYG_MODE,_getSelectedLink:function(){var b=this.editor.getSelection();if(b=b&&b.getStartElement())b=
p(b);return b},_getSelectionLinkUrl:function(){var b=this.cfg._getSelectedLink.call(this);if(b)return b.attr("_ke_saved_href")||b.attr("href")},_removeLink:function(b){var d=this.editor;d.fire("save");var e=d.getSelection(),g=e.getRanges()[0];if(g&&g.collapsed){g=e.createBookmarks();b._4e_remove(true);e.selectBookmarks(g)}else if(g){b=b[0];e=b.attributes;g={};for(var o=0;o<e.length;o++){var h=e[o];if(h.specified)g[h.name]=h.value}if(b.style.cssText)g.style=b.style.cssText;(new r(j,g)).remove(d.document)}d.fire("save");
d.notifySelectionChange()},_link:function(b){var d=this.editor,e=this.cfg._getSelectedLink.call(this);b._ke_saved_href=b.href;if(e){d.fire("save");e.attr(b);d.fire("save")}else{e=(e=d.getSelection())&&e.getRanges()[0];if(!e||e.collapsed){b=new u("<a>"+b.href+"</a>",b,d.document);d.insertElement(b)}else{d.fire("save");(new r(j,b)).apply(d.document);d.fire("save")}}d.notifySelectionChange()},offClick:function(){var b=this;b.editor.useDialog("link/dialog",function(d){d.show(b)})}});n.register({pluginName:"link",
editor:l,pluginContext:i,func:p,init:function(){var b=this,d=b.get("contentEl");d.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var e=d.one(".ke-bubbleview-url"),g=d.one(".ke-bubbleview-change"),o=d.one(".ke-bubbleview-remove");v.Utils.preventFocus(d);g.on("click",function(h){b._plugin.call("offClick");h.halt()});o.on("click",function(h){b._plugin.call("_removeLink",
b._selectedEl);h.halt()});b.on("show",function(){var h=b._selectedEl;if(h){h=h.attr("_ke_saved_href")||h.attr("href");e.html(h);e.attr("href",h)}})}})})});KISSY.Editor.add("list",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.addButton("ul",{title:"\u9879\u76ee\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ul",loading:true,type:"ul"}),v=l.addButton("ol",{title:"\u7f16\u53f7\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ol",loading:true,type:"ol"});p.use("list/support",function(){t.reload(p.ListSupport);v.reload(p.ListSupport)})})});
KISSY.Editor.add("list/support",function(){function l(h){this.type=h}var p=KISSY.Editor,t={ol:1,ul:1},v=["ol","ul"],u=KISSY,r=p.RANGE,n=p.ElementPath,j=p.Walker,i=p.NODE,b=u.UA,d=u.Node,e=u.DOM,g={listToArray:function(h,a,c,f,m){if(!t[h._4e_name()])return[];f||(f=0);c||(c=[]);for(var x=0,q=h[0].childNodes.length;x<q;x++){var z=new d(h[0].childNodes[x]);if(z._4e_name()=="li"){var k={parent:h,indent:f,element:z,contents:[]};if(m)k.grandparent=m;else{k.grandparent=h.parent();if(k.grandparent&&k.grandparent._4e_name()==
"li")k.grandparent=k.grandparent.parent()}a&&z._4e_setMarker(a,"listarray_index",c.length);c.push(k);for(var w=0,D=z[0].childNodes.length,B;w<D;w++){B=new d(z[0].childNodes[w]);B[0].nodeType==i.NODE_ELEMENT&&t[B._4e_name()]?g.listToArray(B,a,c,f+1,k.grandparent):k.contents.push(B)}}}return c},arrayToList:function(h,a,c,f){c||(c=0);if(!h||h.length<c+1)return null;for(var m=h[c].parent[0].ownerDocument,x=m.createDocumentFragment(),q=null,z=c,k=Math.max(h[c].indent,0),w=null;;){var D=h[z];if(D.indent==
k){if(!q||h[z].parent._4e_name()!=q._4e_name()){q=h[z].parent._4e_clone(false,true);x.appendChild(q[0])}w=q[0].appendChild(D.element._4e_clone(false,true)[0]);for(var B=0;B<D.contents.length;B++)w.appendChild(D.contents[B]._4e_clone(true,true)[0]);z++}else if(D.indent==Math.max(k,0)+1){z=g.arrayToList(h,null,z,f);w.appendChild(z.listNode);z=z.nextIndex}else if(D.indent==-1&&!c&&D.grandparent){if(t[D.grandparent._4e_name()])w=D.element._4e_clone(false,true)[0];else if(D.grandparent._4e_name()!="td"){w=
m.createElement(f);D.element._4e_copyAttributes(new d(w))}else w=m.createDocumentFragment();for(B=0;B<D.contents.length;B++){q=D.contents[B]._4e_clone(true,true);w.nodeType==i.NODE_DOCUMENT_FRAGMENT&&D.element._4e_copyAttributes(new d(q));w.appendChild(q[0])}if(w.nodeType==i.NODE_DOCUMENT_FRAGMENT&&z!=h.length-1){w.lastChild&&w.lastChild.nodeType==i.NODE_ELEMENT&&w.lastChild.getAttribute("type")=="_moz"&&e._4e_remove(w.lastChild);e._4e_appendBogus(w)}if(w.nodeType==i.NODE_ELEMENT&&e._4e_name(w)==
f&&w.firstChild){e._4e_trim(w);q=w.firstChild;if(q.nodeType==i.NODE_ELEMENT&&e._4e_isBlockBoundary(q)){q=m.createDocumentFragment();e._4e_moveChildren(w,q);w=q}}q=e._4e_name(w);if(!b.ie&&(q=="div"||q=="p"))e._4e_appendBogus(w);x.appendChild(w);q=null;z++}else return null;if(h.length<=z||Math.max(h[z].indent,0)<k)break}if(a)for(h=new d(x.firstChild);h&&h[0];){h[0].nodeType==i.NODE_ELEMENT&&h._4e_clearMarkers(a,true);h=h._4e_nextSourceNode()}return{listNode:x,nextIndex:z}}},o=/^h[1-6]$/;l.prototype=
{changeListType:function(h,a,c,f){var m=g.listToArray(a.root,c),x=[];for(h=0;h<a.contents.length;h++){var q=a.contents[h];q=q._4e_ascendant("li",true);if(!(!q||!q[0]||q.data("list_item_processed"))){x.push(q);q._4e_setMarker(c,"list_item_processed",true)}}q=new d(a.root[0].ownerDocument.createElement(this.type));for(h=0;h<x.length;h++){var z=x[h].data("listarray_index");m[z].parent=q}c=g.arrayToList(m,c,null,"p");var k;m=c.listNode.childNodes.length;for(h=0;h<m&&(k=new d(c.listNode.childNodes[h]));h++)k._4e_name()==
this.type&&f.push(k);e.insertBefore(c.listNode,a.root);a.root._4e_remove()},createList:function(h,a,c){var f=a.contents;h=a.root[0].ownerDocument;var m=[];if(f.length==1&&f[0][0]===a.root[0]){var x=new d(h.createElement("div"));f[0][0].nodeType!=i.NODE_TEXT&&f[0]._4e_moveChildren(x);f[0][0].appendChild(x[0]);f[0]=x}a=a.contents[0].parent();for(x=0;x<f.length;x++)a=a._4e_commonAncestor(f[x].parent());for(x=0;x<f.length;x++)for(var q=f[x],z;z=q.parent();){if(z[0]===a[0]){m.push(q);break}q=z}if(!(m.length<
1)){f=new d(m[m.length-1][0].nextSibling);x=new d(h.createElement(this.type));for(c.push(x);m.length;){c=m.shift();q=new d(h.createElement("li"));if(o.test(c._4e_name()))q[0].appendChild(c[0]);else{c._4e_copyAttributes(q);c._4e_moveChildren(q);c._4e_remove()}x[0].appendChild(q[0]);b.ie||q._4e_appendBogus()}f[0]?e.insertBefore(x,f):a.append(x)}},removeList:function(h,a,c){function f(B){if((w=new d(k[B?"firstChild":"lastChild"]))&&!(w[0].nodeType==i.NODE_ELEMENT&&w._4e_isBlockBoundary())&&(D=a.root[B?
"_4e_previous":"_4e_next"](j.whitespaces(true)))&&!(w[0].nodeType==i.NODE_ELEMENT&&D._4e_isBlockBoundary({br:1})))e[B?"insertBefore":"insertAfter"](h.document.createElement("br"),w)}for(var m=g.listToArray(a.root,c),x=[],q=0;q<a.contents.length;q++){var z=a.contents[q];z=z._4e_ascendant("li",true);if(!(!z||z.data("list_item_processed"))){x.push(z);z._4e_setMarker(c,"list_item_processed",true)}}z=null;for(q=0;q<x.length;q++){z=x[q].data("listarray_index");m[z].indent=-1;z=z}for(q=z+1;q<m.length;q++)if(m[q].indent>
Math.max(m[q-1].indent,0)){x=m[q-1].indent+1-m[q].indent;for(z=m[q].indent;m[q]&&m[q].indent>=z;){m[q].indent+=x;q++}q--}var k=g.arrayToList(m,c,null,"p").listNode,w,D;f(true);f(undefined);e.insertBefore(k,a.root);a.root._4e_remove()},exec:function(h){var a=h.getSelection(),c=a&&a.getRanges();if(!(!c||c.length<1)){for(var f=a.createBookmarks(true),m=[],x={};c.length>0;){var q=c.shift(),z=q.getBoundaryNodes(),k=z.startNode,w=z.endNode;k[0].nodeType==i.NODE_ELEMENT&&k._4e_name()=="td"&&q.setStartAt(z.startNode,
r.POSITION_AFTER_START);w[0].nodeType==i.NODE_ELEMENT&&w._4e_name()=="td"&&q.setEndAt(z.endNode,r.POSITION_BEFORE_END);q=q.createIterator();for(q.forceBrBreak=false;z=q.getNextParagraph();)if(!z.data("list_block")){z._4e_setMarker(x,"list_block",1);w=new n(z);var D=w.elements,B=null,s=false,y=w.blockLimit,A;for(k=D.length-1;k>=0&&(A=D[k]);k--)if(t[A._4e_name()]&&y.contains(A)){y.removeData("list_group_object");if(k=A.data("list_group_object"))k.contents.push(z);else{k={root:A,contents:[z]};m.push(k);
A._4e_setMarker(x,"list_group_object",k)}s=true;break}if(!s){w=y||w.block;if(w.data("list_group_object"))w.data("list_group_object").contents.push(z);else{k={root:w,contents:[z]};w._4e_setMarker(x,"list_group_object",k);m.push(k)}}}}for(c=[];m.length>0;){k=m.shift();if(this.state=="off")if(t[k.root._4e_name()])this.changeListType(h,k,x,c);else{p.Utils.clearAllMarkers(x);this.createList(h,k,c)}else this.state=="on"&&t[k.root._4e_name()]&&this.removeList(h,k,x)}for(k=0;k<c.length;k++){B=c[k];var E=
this;(h=function(C){var F=B[C?"_4e_previous":"_4e_next"](j.whitespaces(true));if(F&&F[0]&&F._4e_name()==E.type){F._4e_remove();F._4e_moveChildren(B,C?true:false)}})();h(true)}p.Utils.clearAllMarkers(x);a.selectBookmarks(f)}}};p.ListUtils=g;p.ListSupport={init:function(){this.listCommand=new l(this.cfg.type)},selectionChange:function(h){var a=this.cfg.type,c=h.path,f;h=this.btn;var m=c.blockLimit;c=c.elements;if(m){if(c)for(var x=0;x<c.length&&(f=c[x])&&f[0]!==m[0];x++){var q=u.indexOf(c[x]._4e_name(),
v);if(q!==-1)if(v[q]===a){h.bon();return}else break}h.boff()}},offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var h=this.editor,a=this.btn;h.fire("save");this.listCommand.state=a.get("state");this.listCommand.exec(h);h.fire("save");h.notifySelectionChange()}}});
KISSY.Editor.add("localstorage",function(){var l=KISSY,p=l.Editor,t;t=p.STORE="localStorage";if(!p.storeReady){p.storeReady=function(u){p.on("storeReady",u)};p.on("storeReady",function(){p.storeReady=function(u){u()};p.detach("storeReady")})}if(window[t])window[t]._ke||p.fire("storeReady");else{var v=p.Config.base+p.Utils.debugUrl("plugins/localstorage/swfstore.swf?rand="+ +new Date);window[t]=new p.FlashBridge({movie:v,methods:["setItem","removeItem","getValueOf"]});l.mix(window[t],{_ke:1,getItem:function(u){return this.getValueOf(u)}});
window[t].on("contentReady",function(){p.fire("storeReady")})}});KISSY.Editor.add("maximize",function(l){var p=KISSY,t=p.Editor;p.UA.gecko<1.92||l.ready(function(){var v=l.addButton("maximize",{title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize",loading:true});t.use("maximize/support",function(){v.reload(t.Maximize)})})});
KISSY.Editor.add("maximize/support",function(){var l=KISSY.Editor,p=KISSY,t=p.UA,v=p.Node,u=p.Event,r=p.DOM,n;r.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");var j={};p.mix(j,{onClick:function(){var i=this,b=i.editor;i._resize&&u.remove(window,"resize",i._resize);i.call("_saveEditorStatus");i.call("_restoreState");i.btn.boff();setTimeout(function(){i.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("restoreWindow")},30)},_restoreState:function(){var i=document,b=this.editor,
d=this._savedParents;if(d){for(var e=0;e<d.length;e++){var g=d[e];g.el.css("position",g.position)}this._savedParents=null}b.wrap.css({height:this.iframeHeight});r.css(i.body,{width:"",height:"",overflow:""});i.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:this.editorWrapWidth});n.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);i=this.btn.get("el");i.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");i.attr("title",
"\u5168\u5c4f");t.ie<8&&this.editor.toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var i=this.editor,b=[],d=i.editorWrap;this.iframeHeight=i.wrap._4e_style("height");this.editorWrapWidth=d._4e_style("width");this.scrollLeft=r.scrollLeft();this.scrollTop=r.scrollTop();window.scrollTo(0,0);for(i=d.parent();i;){d=i.css("position");if(d!="static"){b.push({el:i,position:d});i.css("position","static")}i=i.parent()}this._savedParents=b;b=this.btn.get("el");b.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
b.attr("title","\u53d6\u6d88\u5168\u5c4f");t.ie<8&&this.editor.toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var i=this.editor;this.savedRanges=null;if(t.gecko&&i.iframeFocus)this.savedRanges=(i=i.getSelection())&&i.getRanges()},_restoreEditorStatus:function(){var i=this.editor,b=i.getSelection(),d=this.savedRanges;i.activateGecko();d&&b&&b.selectRanges(d);if(i.iframeFocus&&b)(i=b.getStartElement())&&i[0]&&i._4e_scrollIntoView();t.ie<8&&this.btn.get("el").one("span").css("background-image",
"")},_maximize:function(i){var b=document,d=this.editor,e=d.editorWrap,g=r.viewportHeight(),o=r.viewportWidth(),h=d.statusDiv?d.statusDiv[0].offsetHeight:0,a=d.toolBarDiv[0].offsetHeight;if(t.ie)b.body.style.overflow="hidden";else r.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:d.baseZIndex(l.zIndexManager.MAXIMIZE),width:o+"px"});n.css({zIndex:d.baseZIndex(l.zIndexManager.MAXIMIZE-5),height:g+"px",width:o+"px"});e.offset({left:0,
top:0});n.css({left:0,top:0});d.wrap.css({height:g-h-a+"px"});i!==true&&arguments.callee.call(this,true)},_real:function(){var i=this,b=i.editor;i.call("_saveEditorStatus");i.call("_saveSate");i.call("_maximize");i._resize=i._resize||l.Utils.buffer(i.cfg._maximize,i,100);u.on(window,"resize",i._resize);i.btn.bon();setTimeout(function(){i.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("maximizeWindow")},30)},offClick:function(){n||(n=(new v("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(document.body));
this.call("_real")}});l.Maximize=j});
KISSY.Editor.add("music",function(l){var p=KISSY.Editor,t=l.htmlDataProcessor,v=t&&t.dataFilter;l.ready(function(){v&&v.addRules({elements:{object:function(u){var r=u.attributes;if(!(r.classid&&String(r.classid).toLowerCase())){for(r=0;r<u.children.length;r++)if(u.children[r].name=="embed"){if(!p.Utils.isFlashEmbed(u.children[r]))break;if(u.children[r].attributes.src.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(u,"ke_music","music",true)}return null}for(r=0;r<u.children.length;r++){var n=
u.children[r];if(n.name=="param"&&n.attributes.name=="movie")if(n.attributes.value.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(u,"ke_music","music",true)}},embed:function(u){if(!p.Utils.isFlashEmbed(u))return null;if(u.attributes.src.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(u,"ke_music","music",true)}}},4);p.use("music/support",function(){new p.MusicInserter(l)})})});
KISSY.Editor.add("music/support",function(){function l(d){l.superclass.constructor.apply(this,arguments);d.cfg.disableObjectResizing||u.on(d.document.body,n.ie?"resizestart":"resize",function(e){(new t.Node(e.target)).hasClass(j)&&e.preventDefault()})}function p(d){return d._4e_name()==="img"&&!!d.hasClass(j)&&d}var t=KISSY,v=t.Editor,u=t.Event,r=v.Flash,n=t.UA,j="ke_music",i=["img."+j];t.extend(l,r,{_config:function(){this._cls=j;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";
this._contextMenu=b;this._flashRules=i}});r.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",p);v.MusicInserter=l;var b={"\u97f3\u4e50\u5c5e\u6027":function(d){var e=d.editor.getSelection();(e=(e=e&&e.getStartElement())&&p(e))&&d.show(null,e)}}});
KISSY.Editor.add("ext-focus",function(){function l(){}var p=KISSY,t=p.UA,v=p.Editor,u=v.focusManager;v.namespace("UIBase");l.ATTRS={focus4e:{value:true}};l.prototype={_uiSetFocus4e:function(r){if(r){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){},__renderUI:function(){},__bindUI:function(){this._focus4e=(new p.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},
_show4FocusExt:function(){var r=this._focusEditor=u.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(t.ie&&r){var n=r.document.selection.createRange();if(n)if(n.item&&n.item(0).ownerDocument==r.document){r=document.body.createTextRange();r.moveToElementText(this.get("el")._4e_first()[0]);r.collapse(true);r.select()}}},_hide4FocusExt:function(){var r=this._focusEditor;r&&r.focus()}};v.UIBase.Focus=l},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var l=KISSY,p=l.Editor;if(!p.Overlay){var t=l.UIBase.create(l.Overlay,[p.UIBase.Focus],{init:function(){},syncUI:function(){p.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}}),v=l.UIBase.create(l.Dialog,[p.UIBase.Focus],{show:function(){this.center();var r=this.get("y");if(r-l.DOM.scrollTop()>200){r=l.DOM.scrollTop()+200;this.set("y",r)}v.superclass.show.call(this)}},{ATTRS:{constrain:{value:true},zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}});
p.Overlay=t;p.Dialog=v;var u;p.Overlay.loading=function(){u||(u=new p.Overlay({x:0,focus4e:false,width:l.UA.ie==6?l.DOM.docWidth():"100%",y:0,zIndex:p.baseZIndex(p.zIndexManager.LOADING),elCls:"ke-global-loading"}));u.set("height",l.DOM.docHeight());u.show();u.loading()};p.Overlay.unloading=function(){u&&u.hide()}}});
KISSY.Editor.add("pagebreak",function(l){var p=KISSY,t=p.Editor,v=p.Node,u=l.htmlDataProcessor;(p=u&&u.dataFilter)&&p.addRules({elements:{div:function(r){var n=r.attributes;var j=(n=n&&n.style)&&r.children.length==1&&r.children[0];if((j=j&&j.name=="span"&&j.attributes.style)&&/page-break-after\s*:\s*always/i.test(n)&&/display\s*:\s*none/i.test(j))return u.createFakeParserElement(r,"ke_pagebreak","div")}}});l.ready(function(){l.addButton("page-break",{title:"\u5206\u9875",mode:t.WYSIWYG_MODE,contentCls:"ke-toolbar-pagebreak",
offClick:function(){var r=this.editor,n=new v('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,r.document);n=r.createFakeElement?r.createFakeElement(n,"ke_pagebreak","div",false,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'):n;var j=r.getSelection();if(j=j&&j.getRanges()[0]){r.fire("save");for(var i=j.startContainer,b=i;i._4e_name()!=="body";){b=i;i=i.parent()}j.collapse(true);j.splitElement(b);n.insertAfter(b);
r.fire("save")}}})})});
KISSY.Editor.add("preview",function(l){l.ready(function(){l.addButton("preview",{title:"\u9884\u89c8",contentCls:"ke-toolbar-preview",offClick:function(){var p=this.editor,t=640,v=420,u=80;try{var r=window.screen;t=Math.round(r.width*0.8);v=Math.round(r.height*0.7);u=Math.round(r.width*0.1)}catch(n){}p=p._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+p.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");t=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+t+
",height="+v+",left="+u);v=t.document;v.open();v.write(p);v.close();t.focus()}})})});
KISSY.Editor.add("progressbar",function(){function l(){l.superclass.constructor.apply(this,arguments);this._init()}var p=KISSY,t=p.Editor;if(!t.ProgressBar){var v=p.Node;p.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
l.ATTRS={container:{},width:{},height:{},progress:{value:0}};p.extend(l,p.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var u=this.get("height"),r=new v("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+u+";'></div>"),n=this.get("container");u=(new v("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(u)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(r);var j=(new v("<span class='ke-progressbar-title'>")).appendTo(r);
n&&r.appendTo(n);this.el=r;this._title=j;this._p=u;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(u){u=u.newVal;this._p.css("width",u+"%");this._title.html(u+"%")}});t.ProgressBar=l}});
KISSY.Editor.add("removeformat",function(l){function p(i,b){for(var d=0;d<b.length;d++)i.removeAttr(b[d])}var t=KISSY.Editor,v=t.RANGE,u=t.ElementPath,r=t.NODE,n="class,style,lang,width,height,align,hspace,valign".split(/,/),j=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");l.ready(function(){l.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:t.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var i=
this.editor;j.lastIndex=0;var b=i.getSelection().getRanges();i.fire("save");for(var d=0,e;e=b[d];d++)if(!e.collapsed){e.enlarge(v.ENLARGE_ELEMENT);var g=e.createBookmark(),o=g.startNode,h=g.endNode,a=function(c){for(var f=new u(c),m=f.elements,x=1,q;q=m[x];x++){if(q._4e_equals(f.block)||q._4e_equals(f.blockLimit))break;j.test(q._4e_name())&&c._4e_breakParent(q)}};a(o);a(h);for(o=o._4e_nextSourceNode(true,r.NODE_ELEMENT);o;){if(o._4e_equals(h))break;a=o._4e_nextSourceNode(false,r.NODE_ELEMENT);o._4e_name()==
"img"&&o.attr("_ke_realelement")||(j.test(o._4e_name())?o._4e_remove(true):p(o,n));o=a}e.moveToBookmark(g)}i.getSelection().selectRanges(b);i.fire("save")}})})});
KISSY.Editor.add("resize",function(l){var p=KISSY,t=p.Node;l.ready(function(){p.use("dd",function(){var v=p.Draggable,u=l.statusDiv,r=new t("<div class='ke-resizer'>"),n=l.cfg.pluginConfig.resize||{};n=n.direction||["x","y"];r.appendTo(u);l.on("maximizeWindow",function(){r.css("display","none")});l.on("restoreWindow",function(){r.css("display","")});v=new v({node:r});var j=0,i=0,b=l.wrap,d=l.editorWrap;v.on("dragstart",function(){j=b.height();i=d.width()});v.on("drag",function(e){var g=e.left-this.startNodePos.left;
e=e.top-this.startNodePos.top;p.inArray("y",n)&&b.height(j+e);p.inArray("x",n)&&d.width(i+g)})})})});
KISSY.Editor.add("select",function(){function l(j){l.superclass.constructor.call(this,j);this._init()}var p=KISSY,t=p.Node,v=p.Event,u=p.DOM,r=p.Editor;if(!r.Select){l.DISABLED=0;l.ENABLED=1;var n=r.XHTML_DTD;l.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var j=this.el.parent();j;){var i=j._4e_name();if(n[i]&&n[i].div)return j;j=j.parent()}return new t(document.body)}},state:{value:1}};l.decorate=
function(j){for(var i=j.width(),b=[],d=j.all("option"),e=0;e<d.length;e++){var g=d[e];b.push({name:u.html(g),value:u.attr(g,"value")})}return new l({width:i+"px",el:j,items:b,cls:"ke-combox",value:j.val()})};p.extend(l,p.Base,{_init:function(){var j=this.get("container"),i=this.get("el"),b=new t("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
d=this.get("title")||"",e=this.get("cls"),g=b.one(".ke-select-text"),o=b.one(".ke-select-text-inner");b.one(".ke-select-drop");this.get("value")!==undefined?o.html(this._findNameByV(this.get("value"))):o.html(d);g.css("width",this.get("width"));b._4e_unselectable();d&&b.attr("title",d);e&&b.addClass(e);if(i)i[0].parentNode.replaceChild(b[0],i[0]);else j&&b.appendTo(j);b.on("click",this._click,this);this.el=b;this.title=o;this._focusA=b.one("a.ke-select");r.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(j){var i=this.get("title")||"",b=this.get("items");if(this.get("showValue"))return j||i;for(var d=0;d<b.length;d++){var e=b[d];if(e.value==j){i=e.name;break}}return i},_valueChange:function(j){this.title.html(this._findNameByV(j.newVal))},_itemsChange:function(j){j=j.newVal;var i=this._selectList;i.html("");if(j)for(var b=0;b<j.length;b++){var d=j[b];(new t("<a class='ke-select-menu-item' href='#' data-value='"+
d.value+"'>"+d.name+"</a>",d.attrs)).appendTo(i)._4e_unselectable()}this.as=i.all("a")},val:function(j){if(j!==undefined){this.set("value",j);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){function j(h){h=new t(h.target);b.contains(h)||b._4e_equals(h)||g.hide()}var i=this,b=i.el,d=i.get("popUpWidth"),e=i._focusA,g=new r.Overlay({autoRender:true,render:i.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:d?
d:b.width(),zIndex:r.baseZIndex(r.zIndexManager.SELECT),focusMgr:false}),o=i.get("items");d=g.get("contentEl").one("div");i.menu=g;v.on(window,"resize",i._resize,i);i.get("title")&&(new t("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+i.get("title")+"</div>")).appendTo(d);i._selectList=(new t("<div>")).appendTo(d);i._itemsChange({newVal:o});g.on("show",function(){e.addClass("ke-select-active")});g.on("hide",function(){e.removeClass("ke-select-active")});v.on(document,
"click",j);i.get("doc")&&v.on(i.get("doc"),"click",j);d.on("click",i._select,i);i.as=i._selectList.all("a");v.on(d[0],"mouseenter",function(){i.as.removeClass("ke-menu-selected")});i.on("afterItemsChange",i._itemsChange,i);i.menuNode=d},_stateChange:function(j){var i=this.el;j.newVal==1?i.removeClass("ke-select-disabled"):i.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(j){j.halt();var i=this.menu,b=this.menuNode;if(j=
(new t(j.target))._4e_ascendant(function(g){return b.contains(g)&&g._4e_name()=="a"},true)){var d=this.get("value"),e=j.attr("data-value");this.set("value",e);this.fire("click",{newVal:e,prevVal:d,name:j.html()});i.hide()}},_real:function(){var j=this.el,i=j.offset(),b=p.clone(i),d=this.menu.get("el").height(),e=this.menu.get("el").width(),g=u.scrollTop(),o=u.scrollLeft(),h=u.viewportHeight(),a=u.viewportWidth();a=o+a-60;h=g+h;var c=i.top+(j.height()-2);j=i.left+j.width()-2;var f=this.get("align"),
m=f[0];if(f[1]=="b"){i.top=c;if(i.top+d>h&&b.top-g>h-c)i.top=b.top-d}else{i.top=b.top-d;if(i.top<g&&b.top-g<h-c)i.top=c}if(m=="l"){if(i.left+e>a&&j-o>a-b.left)i.left=j-e}else{i.left=j-e;if(i.left<o&&j-o<a-b.left)i.left=b.left}this.menu.set("xy",[i.left,i.top]);this.menu.show()},_click:function(j){j.preventDefault();j=this.el;var i=this.get("value");if(!j.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();i&&this.menu&&this.as.each(function(b){b.attr("data-value")==
i?b.addClass("ke-menu-selected"):b.removeClass("ke-menu-selected")})}}});r.Select=l}});KISSY.Editor.add("separator",function(l){l.ready(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(l.toolBarDiv)})});KISSY.Editor.add("smiley",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.addButton("smiley",{contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",mode:p.WYSIWYG_MODE,loading:true});p.use("smiley/support",function(){t.reload(p.SmileySupport)})})});
KISSY.Editor.add("smiley/support",function(){var l=KISSY,p=l.Event,t=l.Editor,v=l.DOM;v.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");var u;t.SmileySupport={_selectSmiley:function(r){r.halt();
var n=this.editor;r=new l.Node(r.target);var j;if(r._4e_name()=="a"&&(j=r.attr("data-icon"))){j=new l.Node("<img class='ke_smiley'alt='' src='"+j+"'/>",null,n.document);n.insertElement(j);this.smileyWin.hide()}},_hidePanel:function(r){var n=this.btn.get("el");r=new l.Node(r.target);var j=this.smileyWin;n._4e_equals(r)||n.contains(r)||j.hide()},_show:function(){var r=this.smileyWin;r&&r.get("visible")?r.hide():this.call("_prepare")},_prepare:function(){var r=this.cfg,n=this.btn,j=this.editor,i;if(!u){u=
"<div class='ke-smiley-sprite'>";for(i=0;i<=98;i++)u+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+i+".gif'></a>";u+="</div>"}i=u;i=this.smileyWin=new t.Overlay({content:i,focus4e:false,width:"297px",autoRender:true,elCls:"ks-popup",zIndex:j.baseZIndex(t.zIndexManager.POPUP_MENU),mask:false});this.smileyPanel=i.get("contentEl");i.on("show",n.bon,n);i.on("hide",n.boff,n);this.smileyPanel.on("click",r._selectSmiley,this);p.on(document,"click",r._hidePanel,this);p.on(j.document,
"click",r._hidePanel,this);this.cfg._prepare=this.cfg._real;this.call("_real")},_real:function(){var r=this.btn.get("el"),n=r.offset();n.top+=r.height()+5;if(n.left+this.smileyPanel.width()>v.viewportWidth()-60)n.left=v.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[n.left,n.top]);this.smileyWin.show()},offClick:function(){this.call("_prepare")},onClick:function(){this.call("_prepare")}}});
KISSY.Editor.add("sourcearea",function(l){var p=KISSY.Editor;KISSY.UA.gecko<1.92||l.ready(function(){var t=p.SOURCE_MODE,v=p.WYSIWYG_MODE;l.addButton("sourcearea",{title:"\u6e90\u7801",contentCls:"ke-toolbar-source",init:function(){var u=this.btn,r=this.editor;r.on("wysiwygmode",u.boff,u);r.on("sourcemode",u.bon,u)},offClick:function(){this.editor.execCommand("sourceAreaSupport",t)},onClick:function(){this.editor.execCommand("sourceAreaSupport",v)}})})});
KISSY.Editor.add("sourcearea/support",function(l){var p=KISSY,t=p.Editor,v=p.UA;t.SourceAreaSupport||function(){function u(){var j=this.mapper={};j[r]=this._show;j[n]=this._hide}var r=t.SOURCE_MODE,n=t.WYSIWYG_MODE;p.augment(u,{exec:function(j,i){var b=this.mapper;b[i]&&b[i].call(this,j)},_show:function(j){j.textarea.val(j.getData(true));this._showSource(j);j.fire("sourcemode")},_showSource:function(j){var i=j.textarea,b=j.iframe;i.css("display","");b.css("display","none");v.ie<8&&i.css("height",
j.wrap.css("height"));i[0].focus()},_hideSource:function(j){var i=j.textarea;j.iframe.css("display","");i.css("display","none")},_hide:function(j){var i=j.textarea;this._hideSource(j);j.fire("save");j.setData(i.val());j.fire("wysiwygmode");j.fire("save");v.gecko&&j.activateGecko()}});t.SourceAreaSupport=new u}();l.addCommand("sourceAreaSupport",t.SourceAreaSupport)});
KISSY.Editor.add("table",function(l){var p=KISSY,t=p.Editor,v=p.trim,u=(p.UA.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border"),r=l.htmlDataProcessor;
p=r&&r.dataFilter;r=r&&r.htmlFilter;p&&p.addRules({elements:{table:function(n){n=n.attributes;var j=n["class"],i=parseInt(n.border,10);if(!i||i<=0)n["class"]=(j||"")+" ke_show_border"}}});r&&r.addRules({elements:{table:function(n){n=n.attributes;var j=n["class"];if(j)n["class"]=v(j.replace("ke_show_border","").replace(/\s{2}/," "))}}});l.ready(function(){var n=l.addButton("table",{contentCls:"ke-toolbar-table",mode:t.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c",loading:true});t.use("table/support",function(){var j=
new t.TableUI(l);n.reload({offClick:function(){j._tableShow()}})});l.addCustomStyle(u)})});
KISSY.Editor.add("table/support",function(){function l(a){var c=this,f={},m;for(m in h)(function(x){f[x]=function(){a.fire("save");h[x](c);a.fire("save")}})(m);d.ContextMenu.register({editor:a,rules:g,width:"120px",funcs:f});c.editor=a}function p(a){function c(D){if(!(x.length>0))if(D[0].nodeType==e.NODE_ELEMENT&&o.test(D._4e_name())&&!D.data("selected_cell")){D._4e_setMarker(q,"selected_cell",true);x.push(D)}}for(var f=a.createBookmarks(),m=a.getRanges(),x=[],q={},z=0;z<m.length;z++){var k=m[z];
if(k.collapsed){k=k.getCommonAncestor();(k=k._4e_ascendant("td",true)||k._4e_ascendant("th",true))&&x.push(k)}else{k=new Walker(k);var w;for(k.guard=c;w=k.next();)if((w=w.parent())&&o.test(w._4e_name())&&!w.data("selected_cell")){w._4e_setMarker(q,"selected_cell",true);x.push(w)}}}d.Utils.clearAllMarkers(q);a.selectBookmarks(f);return x}function t(a,c){var f=a.getStartElement()._4e_ascendant("tr");if(f){var m=f._4e_clone(true);m.insertBefore(f);f=(c?m[0]:f[0]).cells;for(m=0;m<f.length;m++){f[m].innerHTML=
"";i.ie||(new b(f[m]))._4e_appendBogus()}}}function v(a){if(a instanceof d.Selection){var c=p(a),f=c.length;a=[];for(var m,x,q=0;q<f;q++){var z=c[q].parent(),k=z[0].rowIndex;!q&&(m=k-1);a[k]=z;q==f-1&&(x=k+1)}q=z._4e_ascendant("table");m=new b(x<q[0].rows.length&&q[0].rows[x]||m>0&&q[0].rows[m]||q[0].parentNode);for(q=a.length;q>=0;q--)a[q]&&v(a[q]);return m}else if(a instanceof b){q=a._4e_ascendant("table");q[0].rows.length==1?q._4e_remove():a._4e_remove()}return 0}function u(a,c){var f=a.getStartElement();
if(f=f._4e_ascendant("td",true)||f._4e_ascendant("th",true))for(var m=f._4e_ascendant("table"),x=f[0].cellIndex,q=0;q<m[0].rows.length;q++){var z=m[0].rows[q];if(!(z.cells.length<x+1)){f=new b(z.cells[x].cloneNode(false));i.ie||f._4e_appendBogus();z=new b(z.cells[x]);c?f.insertBefore(z):f.insertAfter(z)}}}function r(a){if(a instanceof d.Selection){var c=p(a),f,m=[];a=c[0]&&c[0]._4e_ascendant("table");var x,q,z;x=0;for(q=c.length;x<q;x++)m.push(c[x][0].cellIndex);m.sort();x=1;for(q=m.length;x<q;x++)if(m[x]-
m[x-1]>1){z=m[x-1]+1;break}z||(z=m[0]>0?m[0]-1:m[m.length-1]+1);m=a[0].rows;x=0;for(q=m.length;x<q;x++)if(f=m[x].cells[z])break;f=f?new b(f):a._4e_previous();for(z=c.length-1;z>=0;z--)c[z]&&r(c[z]);return f}else if(a instanceof b){c=a._4e_ascendant("table");if(!c)return null;f=a[0].cellIndex;for(z=c[0].rows.length-1;z>=0;z--){a=new b(c[0].rows[z]);if(!f&&a[0].cells.length==1)v(a);else a[0].cells[f]&&a[0].removeChild(a[0].cells[f])}}return null}function n(a,c){var f=new d.Range(a[0].ownerDocument);
if(!f.moveToElementEditablePosition(a,c?true:undefined)){f.selectNodeContents(a);f.collapse(c?false:true)}f.select(true)}var j=KISSY,i=j.UA,b=j.Node,d=j.Editor,e=d.NODE,g=["tr","th","td","tbody","table"];j.augment(l,{_tableShow:function(a,c,f){this.editor.useDialog("table/dialog",function(m){m.show(c,f)})}});var o=/^(?:td|th)$/,h={"\u8868\u683c\u5c5e\u6027":function(a){var c=a.editor.getSelection(),f=c&&c.getStartElement();if(c=f&&f._4e_ascendant("table",true)){f=f._4e_ascendant(function(m){m=m._4e_name();return m==
"td"||m=="th"},true);a._tableShow(null,c,f)}},"\u5220\u9664\u8868\u683c":function(a){var c=(a=a.editor.getSelection())&&a.getStartElement();if(c=c&&c._4e_ascendant("table",true)){a.selectElement(c);var f=a.getRanges()[0];f.collapse();a.selectRanges([f]);a=c.parent();a[0].childNodes.length==1&&a._4e_name()!="body"&&a._4e_name()!="td"?a._4e_remove():c._4e_remove()}},"\u5220\u9664\u884c ":function(a){a=a.editor.getSelection();n(v(a),undefined)},"\u5220\u9664\u5217 ":function(a){a=a.editor.getSelection();(a=r(a))&&n(a,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(a){a=a.editor.getSelection();
t(a,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(a){a=a.editor.getSelection();t(a,undefined)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(a){a=a.editor.getSelection();u(a,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(a){a=a.editor.getSelection();u(a,undefined)}};d.TableUI=l});
KISSY.Editor.add("tabs",function(){function l(r){this.cfg=r;this._init()}var p=KISSY,t=p.Editor,v=p.DOM,u=p.Node;if(!t.Tabs){p.augment(l,p.EventTarget,{_init:function(){var r=this,n=r.cfg,j=n.tabs,i=n.contents.children("div"),b=j.children("li");j.on("click",function(d){d=new u(d.target);if(d=d._4e_ascendant(function(g){return g._4e_name()==="li"&&j.contains(g)},true)){b.removeClass("ke-tab-selected");var e=d.attr("rel");d.addClass("ke-tab-selected");i.hide();v.show(i[p.indexOf(d[0],b)]);r.fire(e)}})},
getTab:function(r){var n=this.cfg,j=n.tabs;n=n.contents.children("div");j=j.children("li");for(var i=0;i<j.length;i++){var b=new u(j[i]),d=new u(n[i]);if(p.isNumber(r)&&r==i||p.isString(r)&&r==b.attr("rel"))return{tab:b,content:d}}},remove:function(r){r=this.getTab(r);r.tab.remove();r.content.remove()},_getActivate:function(){var r=this.cfg,n=r.tabs;r.contents.children("div");r=n.children("li");for(n=0;n<r.length;n++){var j=new u(r[n]);if(j.hasClass("ke-tab-selected"))return j.attr("rel")}},activate:function(r){if(arguments.length==
0)return this._getActivate();var n=this.cfg,j=n.tabs;n=n.contents.children("div");j.children("li").removeClass("ke-tab-selected");n.hide();j=this.getTab(r);j.tab.addClass("ke-tab-selected");j.content.show()}});t.Tabs=l}});
KISSY.Editor.add("templates",function(l){var p=KISSY,t=p.Editor,v=p.Node,u=t.Dialog;p.DOM.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");l.ready(function(){l.addButton("templates",
{contentCls:"ke-toolbar-template",title:"\u6a21\u677f",mode:t.WYSIWYG_MODE,offClick:function(){this.cfg._prepare.call(this)},_prepare:function(){for(var r=this.editor,n=r.cfg.pluginConfig.templates||[],j="<div class='ke-tpl'>",i=0;i<n.length;i++)j+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+n[i].demo+"</a>";j+="</div>";var b=new u({width:500,mask:true,autoRender:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:j});b.get("el").all(".ke-tpl-list").on("click",function(d){d.halt();d=(new v(d.target))._4e_index();
d!=-1&&r.insertHtml(n[d].html);b.hide()});this.ui=b;this.cfg.show.call(this);this.cfg._prepare=this.cfg.show},show:function(){this.ui.show()}})})});
KISSY.Editor.add("undo",function(l){var p=KISSY,t=p.Editor,v=t.Utils.arrayCompare,u=p.UA,r=p.Event;t.UndoManager||function(){function n(d){var e=d._getRawData(),g;if(e)g=d.getSelection();this.contents=e;this.bookmarks=g&&g.createBookmarks2(true)}function j(d){this.history=[];this.index=-1;this.editor=d;this.bufferRunner=t.Utils.buffer(this.save,this,500);this._init()}p.augment(n,{equals:function(d){if(this.contents!=d.contents)return false;var e=this.bookmarks;d=d.bookmarks;if(e||d){if(!e||!d||e.length!=
d.length)return false;for(var g=0;g<e.length;g++){var o=e[g],h=d[g];if(o.startOffset!=h.startOffset||o.endOffset!=h.endOffset||!v(o.start,h.start)||!v(o.end,h.end))return false}}return true}});var i={16:1,17:1,18:1},b={37:1,38:1,39:1,40:1,33:1,34:1};p.augment(j,{_keyMonitor:function(){var d=this.editor;r.on([d.document,d.textarea],"keydown",function(e){var g=e.keyCode;if(!(g in b||g in i))if(g===90&&(e.ctrlKey||e.metaKey)){d.fire("restore",{d:-1});e.halt()}else if(g===89&&(e.ctrlKey||e.metaKey)){d.fire("restore",
{d:1});e.halt()}else d.fire("save",{buffer:1})})},_init:function(){var d=this,e=d.editor;e.on("save",function(g){if(e.getMode()==t.WYSIWYG_MODE)g.buffer?d.bufferRunner():d.save()});e.on("restore",function(g){e.getMode()==t.WYSIWYG_MODE&&d.restore(g)});d._keyMonitor()},save:function(){var d=this.history,e=this.index;d.length>e+1&&d.splice(e+1,d.length-e-1);var g=this.editor;e=d[d.length-1];var o=new n(g);if(!e||!e.equals(o)){d.length===30&&d.shift();d.push(o);this.index=e=d.length-1;g.fire("afterSave",
{history:d,index:e})}},restore:function(d){d=d.d;var e=this.history,g=this.editor,o=e[this.index+d];if(o){g._setRawData(o.contents);if(o.bookmarks)g.getSelection().selectBookmarks(o.bookmarks);else if(u.ie){o=g.document.body.createTextRange();o.collapse(true);o.select()}(o=g.getSelection())&&o.scrollIntoView();this.index+=d;g.fire("afterRestore",{history:e,index:this.index});g.notifySelectionChange()}}});t.UndoManager=j}();l.ready(function(){new t.UndoManager(l);var n={redo:1,undo:-1},j={mode:t.WYSIWYG_MODE,
init:function(){this.editor.on("afterSave afterRestore",this.cfg._respond,this);this.btn.disable()},offClick:function(){this.editor.fire("restore",{d:n[this.cfg.flag]})}},i=p.mix({title:"\u64a4\u9500",flag:"undo",contentCls:"ke-toolbar-undo",_respond:function(b){var d=this.btn;b.index>0?d.boff():d.disable()}},j,false);j=p.mix({title:"\u91cd\u505a",flag:"redo",contentCls:"ke-toolbar-redo",_respond:function(b){var d=this.btn;b.index<b.history.length-1?d.boff():d.disable()}},j,false);l.addButton("undo",i);l.addButton("undo",
j)})});
