/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-19 15:41:38
*/
KISSY.add("editor",function(g,n){function t(i,b){function f(z){for(var u=t.Env.mods,p=0;p<z.length;p++){for(var x=z[p],y=r,B=0;B<p;B++)if(x==z[B]){y=v;break}B=u[x];if(y&&B){y=g.clone(B);x=x+"_"+p;y.name=x;z[p]=x;u[x]||(u[x]=y)}}}var d=this;if(!(d instanceof t))return new t(i,b);if(g.isString(i))i=g.one(i);i=l._4e_wrap(i);b=b||{};b.pluginConfig=b.pluginConfig||{};d.cfg=b;b.pluginConfig=b.pluginConfig;d.cfg=b;g.app(d,g.EventTarget);var q=["htmldataprocessor","enterkey","clipboard"],A=r;d.use=function(z,
u){z=z.split(",");f(z);if(!A)for(var p=0;p<q.length;p++){var x=q[p];g.inArray(x,z)||z.unshift(x)}g.use.call(d,z.join(","),function(){d.ready(function(){u&&u.call(d);if(!A){d.setData(i.val());if(b.focus)d.focus();else{var y=d.getSelection();y&&y.removeAllRanges()}d.fire("save");A=v}})},{order:v,global:t});return d};d.use=d.use;d.init(i);return d}function s(i){var b=g.Config.debug;i=b?b==="dev"?"../src/"+i:i:i.replace(/\.(js|css)/i,"-min.$1");i+=i.indexOf("?")!=-1?"&":"?";i+="t="+encodeURIComponent("2010-11-19 15:41:38");
return i}var l=g.DOM,v=true,r=false;g.app(t,g.EventTarget);t.Config.base=g.Config.base+"editor/";var m=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},
{name:"flash",requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},
"preview","removeformat",{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],o,e,c,a,h={};o=0;for(e=m.length;o<e;o++){c=m[o];if(g.isString(c))c=m[o]={name:c+"",requires:null};a=c.requires||[];var k=["button"];c.name.indexOf("/dialog")!=-1&&k.push("overlay");c.requires=a.concat(k)}m=[{name:"localStorage",requires:["flashutils","flashbridge"]},
{name:"button"},{name:"dd"},{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(m);o=0;for(e=m.length;o<e;o++){c=m[o];a=c.name;h[a]={attach:r,charset:"utf-8",requires:c.requires,csspath:c.useCss?s("plugins/"+a+"/plugin.css"):n,path:s("plugins/"+a+"/plugin.js")}}t.add(h);g.Editor=t;g.Editor=t});
KISSY.Editor.add("utils",function(g){var n=null,t=KISSY,s=t.Node,l=t.DOM,v=t.UA,r=t.Event,m;m=v.ie?document.documentMode||v.ie:void 0;var o={debugUrl:function(e){var c=t.Config.debug;e=c?c==="dev"?"../src/"+e:e:e.replace(/\.(js|css)/i,"-min.$1");e+=e.indexOf("?")!=-1?"&":"?";e+="t="+encodeURIComponent("2010-11-19 17:29:25");return e},lazyRun:function(e,c,a){var h=e[c],k=e[a];e[c]=function(){h.apply(this,arguments);e[c]=e[a];return k.apply(this,arguments)}},getXY:function(e,c,a,h){a=a.defaultView||
a.parentWindow;e-=l.scrollLeft(a);c-=l.scrollTop(a);if(h)if(a!=(h.defaultView||h.parentWindow)&&a.frameElement){h=l._4e_getOffset(a.frameElement,h);e+=h.left;c+=h.top}return{left:e,top:c}},tryThese:function(){for(var e,c=0,a=arguments.length;c<a;c++){var h=arguments[c];try{e=h();break}catch(k){}}return e},arrayCompare:function(e,c){if(!e&&!c)return true;if(!e||!c||e.length!=c.length)return false;for(var a=0;a<e.length;a++)if(e[a]!==c[a])return false;return true},getByAddress:function(e,c,a){e=e.documentElement;
for(var h=0;e&&h<c.length;h++){var k=c[h];if(a)for(var i=-1,b=0;b<e.childNodes.length;b++){var f=e.childNodes[b];if(!(a===true&&f.nodeType==3&&f.previousSibling&&f.previousSibling.nodeType==3)){i++;if(i==k){e=f;break}}}else e=e.childNodes[k]}return e?new s(e):n},clearAllMarkers:function(e){for(var c in e)e[c]._4e_clearMarkers(e,true)},htmlEncodeAttr:function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(e){return e.replace(/^\s+/,"")},rtrim:function(e){return e.replace(/\s+$/,
"")},trim:function(e){return this.ltrim(this.rtrim(e))},mix:function(){for(var e={},c=0;c<arguments.length;c++)e=t.mix(e,arguments[c]);return e},isCustomDomain:function(){if(!v.ie)return false;var e=document.domain,c=window.location.hostname;return e!=c&&e!="["+c+"]"},duplicateStr:function(e,c){return Array(c+1).join(e)},throttle:function(e,c,a){a=a||150;if(a===-1)return function(){e.apply(c,arguments)};var h=(new Date).getTime();return function(){var k=(new Date).getTime();if(k-h>a){h=k;e.apply(c,
arguments)}}},buffer:function(e,c,a){a=a||0;var h=n;return function(){h&&clearTimeout(h);var k=arguments;h=setTimeout(function(){return e.apply(c,k)},a)}},isNumber:function(e){return/^\d+(.\d+)?$/.test(t.trim(e))},verifyInputs:function(e){for(var c=0;c<e.length;c++){var a=l._4e_wrap(e[c]),h=t.trim(a.val()),k=a.attr("data-verify");a=a.attr("data-warning");if(k&&!RegExp(k).test(h)){alert(a);return false}}return true},sourceDisable:function(e,c){e.on("sourcemode",c.disable,c);e.on("wysiwygmode",c.enable,
c)},resetInput:function(e){var c=e.attr("placeholder");if(c&&!v.webkit){e.addClass("ke-input-tip");e.val(c)}else v.webkit&&e.val("")},valInput:function(e,c){e.removeClass("ke-input-tip");e.val(c)},placeholder:function(e,c){e.attr("placeholder",c);if(!v.webkit){e.on("blur",function(){if(!t.trim(e.val())){e.addClass("ke-input-tip");e.val(c)}});e.on("focus",function(){e.removeClass("ke-input-tip");t.trim(e.val())==c&&e.val("")})}},clean:function(e){e=e[0]||e;for(var c=t.makeArray(e.childNodes),a=0;a<
c.length;a++){var h=c[a];h.nodeType==g.NODE.NODE_TEXT&&!t.trim(h.nodeValue)&&e.removeChild(h)}},htmlEncode:function(e){return!e?e:String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(e){return!e?e:String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(e,c){return e.toLowerCase()==c.toLowerCase()},normParams:function(e){e=t.clone(e);for(var c in e)if(e.hasOwnProperty(c)){var a=
e[c];if(t.isFunction(a))e[c]=a()}return e},doFormUpload:function(e,c,a){function h(){var A={responseText:"",responseXML:n};A.argument=e?e.argument:n;try{var z;if((z=v.ie?i.contentWindow.document:i.contentDocument||window.frames[k].document)&&z.body)A.responseText=z.body.innerHTML;A.responseXML=z&&z.XMLDocument?z.XMLDocument:z}catch(u){t.log(u)}r.remove(i,"load",h);e.callback&&e.callback(A);setTimeout(function(){l._4e_remove(i)},100)}var k=t.guid("form-upload-"),i=document.createElement("iframe");
i.id=k;i.name=k;i.className="ke-hidden";var b="document.open();"+(o.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(v.ie)i.src=v.ie?"javascript:void(function(){"+encodeURIComponent(b)+"}())":"";t.log("doFormUpload : "+i.src);document.body.appendChild(i);if(v.ie)document.frames[k].name=k;b=l._4e_unwrap(e.form);var f={target:b.target,method:b.method,encoding:b.encoding,enctype:b.enctype,action:b.action};b.target=k;b.method="POST";b.enctype=b.encoding="multipart/form-data";
if(a)b.action=a;var d;if(c){d=[];c=g.Utils.normParams(c);for(var q in c)if(c.hasOwnProperty(q)){a=document.createElement("input");a.type="hidden";a.name=q;a.value=c[q];b.appendChild(a);d.push(a)}}r.on(i,"load",h);b.submit();b.target=f.target;b.method=f.method;b.enctype=f.enctype;b.encoding=f.encoding;b.action=f.action;if(d){c=0;for(q=d.length;c<q;c++)l._4e_remove(d[c])}return i},extern:function(e,c){for(var a in c)e[a]=c[a]},map:function(e,c){for(var a=0;a<e.length;a++)e[a]=c(e[a]);return e},ieEngine:m,
preventFocus:function(e){v.ie?e._4e_unselectable():e.attr("onmousedown","return false;")}};g.Utils=o;g.Utils=o;o.extern(o,{debugUrl:o.debugUrl,lazyRun:o.lazyRun,getXY:o.getXY,tryThese:o.tryThese,arrayCompare:o.arrayCompare,getByAddress:o.getByAddress,clearAllMarkers:o.clearAllMarkers,htmlEncodeAttr:o.htmlEncodeAttr,ltrim:o.ltrim,rtrim:o.rtrim,trim:o.trim,mix:o.mix,isCustomDomain:o.isCustomDomain,duplicateStr:o.duplicateStr,buffer:o.buffer,isNumber:o.isNumber,verifyInputs:o.verifyInputs,sourceDisable:o.sourceDisable,
resetInput:o.resetInput,placeholder:o.placeholder,clean:o.clean,htmlEncode:o.htmlEncode,htmlDecode:o.htmlDecode,equalsIgnoreCase:o.equalsIgnoreCase,normParams:o.normParams,throttle:o.throttle,doFormUpload:o.doFormUpload,map:o.map})});
KISSY.Editor.add("dom",function(g){function n(b){return b.replace(/-(\w)/g,function(f,d){return d.toUpperCase()})}var t=KISSY,s=t.DOM,l=t.UA,v=t.Node,r=g.Utils,m={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};g.NODE=g.NODE;g.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};g.POSITION=g.POSITION;var o=g.NODE,e=g.POSITION,c={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},a={hr:1},h=function(b){return b[0]||b},k=function(b){if(b&&!b[0])return new v(b);return b},i={_4e_wrap:k,_4e_unwrap:h,_4e_equals:function(b,f){if(!b&&!f)return true;if(!b||!f)return false;b=h(b);f=h(f);
return b===f},_4e_isBlockBoundary:function(b,f){b=k(b);var d=t.mix(t.mix({},a),f||{});return c[b.css("display")]||d[b._4e_name()]},_4e_getWin:function(b){return b&&"scrollTo"in b&&b.document?b:b&&b.nodeType===9?b.defaultView||b.parentWindow:false},_4e_index:function(b){b=h(b);for(var f=b.parentNode.childNodes,d=0;d<f.length;d++)if(f[d]===b)return d;return-1},_4e_first:function(b,f){b=h(b);var d=b.firstChild;if((d=d&&new v(d))&&f&&!f(d))d=d._4e_next(f);return d},_4e_move:function(b,f,d){b=h(b);s._4e_remove(b);
f=h(f);d?f.insertBefore(b,f.firstChild):f.appendChild(b)},_4e_name:function(b){b=h(b);var f=b.nodeName.toLowerCase();if(l.ie)if((b=b.scopeName)&&b!="HTML")f=b.toLowerCase()+":"+f;return f},_4e_isIdentical:function(b,f){if(b._4e_name()!=f._4e_name())return false;var d=b[0].attributes,q=f[0].attributes,A=d.length,z=q.length;if(A!=z)return false;for(var u=0;u<A;u++){var p=d[u],x=p.name;if(p.specified&&b.attr(x)!=f.attr(x))return false}if(r.ieEngine<8)for(u=0;u<z;u++){p=q[u];x=p.name;if(p.specified&&
b.attr(x)!=f.attr(x))return false}return true},_4e_isEmptyInlineRemoveable:function(b){b=h(b).childNodes;for(var f=0,d=b.length;f<d;f++){var q=b[f],A=q.nodeType;if(!(A==o.NODE_ELEMENT&&q.getAttribute("_ke_bookmark")))if(A==o.NODE_ELEMENT&&!i._4e_isEmptyInlineRemoveable(q)||A==o.NODE_TEXT&&t.trim(q.nodeValue))return false}return true},_4e_moveChildren:function(b,f,d){b=h(b);f=f[0]||f;if(b!=f)if(d)for(;d=b.lastChild;)f.insertBefore(b.removeChild(d),f.firstChild);else for(;d=b.firstChild;)f.appendChild(b.removeChild(d))},
_4e_mergeSiblings:function(){function b(f,d,q){if(d[0]&&d[0].nodeType==o.NODE_ELEMENT){for(var A=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemoveable();){A.push(d);d=q?new v(d[0].nextSibling):new v(d[0].previousSibling);if(!d[0]||d[0].nodeType!=o.NODE_ELEMENT)return}if(f._4e_isIdentical(d)){for(var z=q?f[0].lastChild:f[0].firstChild;A.length;)A.shift()._4e_move(f,!q);d._4e_moveChildren(f,!q);d._4e_remove();z[0]&&z[0].nodeType==o.NODE_ELEMENT&&z._4e_mergeSiblings()}}}return function(f){if(f[0])if(m[f._4e_name()]||
f._4e_name()=="a"){b(f,new v(f[0].nextSibling),true);b(f,new v(f[0].previousSibling))}}}(),_4e_unselectable:l.gecko?function(b){b=h(b);b.style.MozUserSelect="none"}:l.webkit?function(b){b=h(b);b.style.KhtmlUserSelect="none"}:function(b){b=h(b);if(l.ie||l.opera){var f=0;b.unselectable="on";for(var d=b.getElementsByTagName("*");b=d[f++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},_4e_getOffset:function(b,f){b=h(b);var d,
q=0;d=0;var A=b.ownerDocument.defaultView||b.ownerDocument.parentWindow,z=b.ownerDocument,u=z.documentElement;f=f||z;if(b.getBoundingClientRect){if(b!==z.body&&u!==b){d=b.getBoundingClientRect();q=d.left+(f===z?s.scrollLeft(A):0);d=d.top+(f===z?s.scrollTop(A):0)}if(f)if(A!=(f.defaultView||f.parentWindow)&&A.frameElement){A=i._4e_getOffset(A.frameElement,f);q+=A.left;d+=A.top}}return{left:q,top:d}},_4e_getFrameDocument:function(b){return(b=h(b))&&b.contentWindow.document},_4e_splitText:function(b,
f){b=h(b);var d=b.ownerDocument;if(!(!b||b.nodeType!=o.NODE_TEXT)){if(l.ie&&f==b.nodeValue.length){var q=d.createTextNode("");s.insertAfter(q,b);return new v(q)}q=new v(b.splitText(f));if(d.documentMode){d=d.createTextNode("");s.insertAfter(d,q[0]);s._4e_remove(d)}return q}},_4e_parents:function(b,f){b=k(b);var d=[];do d[f?"push":"unshift"](b);while(b=b.parent());return d},_4e_clone:function(b,f,d){b=h(b);b=b.cloneNode(f);if(!d){var q=function(A){if(A.nodeType==o.NODE_ELEMENT){A.removeAttribute("id");
A=A.childNodes;for(var z=0;z<A.length;z++)q(A[z])}};q(b)}return new v(b)},_4e_nextSourceNode:function(b,f,d,q){b=h(b);if(q&&!q.call){var A=q[0]||q;q=function(u){u=u[0]||u;return u!==A}}f=!f&&b.firstChild;var z=new v(b);if(!f){if(b.nodeType==o.NODE_ELEMENT&&q&&q(b,true)===false)return null;f=b.nextSibling}for(;!f&&(z=z.parent());){if(q&&q(z,true)===false)return null;f=z[0].nextSibling}if(!f)return null;f=s._4e_wrap(f);if(q&&q(f)===false)return null;if(d&&d!=f[0].nodeType)return f._4e_nextSourceNode(false,
d,q);return f},_4e_previousSourceNode:function(b,f,d,q){b=h(b);if(q&&!q.call){var A=q[0]||q;q=function(u){u=u[0]||u;return u!==A}}f=!f&&b.lastChild;var z=new v(b);if(!f){if(b.nodeType==o.NODE_ELEMENT&&q&&q(b,true)===false)return null;f=b.previousSibling}for(;!f&&(z=z.parent());){if(q&&q(z,true)===false)return null;f=z[0].previousSibling}if(!f)return null;f=s._4e_wrap(f);if(q&&q(f)===false)return null;if(d&&f[0].nodeType!=d)return f._4e_previousSourceNode(false,d,q);return f},_4e_commonAncestor:function(b,
f){if(b._4e_equals(f))return b;if(f[0].nodeType!=o.NODE_TEXT&&f.contains(b))return f;var d=b[0].nodeType==o.NODE_TEXT?b.parent():b;do if(d[0].nodeType!=o.NODE_TEXT&&d.contains(f))return d;while(d=d.parent());return null},_4e_ascendant:function(b,f,d){b=h(b);if(!d)b=b.parentNode;if(f&&!t.isFunction(f)){var q=f;f=function(A){return A._4e_name()==q}}for(;b&&b.nodeType!=9;){if(!f||f(new v(b))===true)return new v(b);b=b.parentNode}return null},_4e_hasAttribute:r.ieEngine<9?function(b,f){b=h(b);var d=b.attributes[f];
return!!(d&&d.specified)}:function(b,f){b=h(b);return b.hasAttribute(f)},_4e_hasAttributes:r.ieEngine<9?function(b){b=h(b);for(var f=b.attributes,d=0;d<f.length;d++){var q=f[d];switch(q.name){case "class":if(b.getAttribute("class"))return true;break;default:if(q.specified)return true}}return false}:function(b){b=h(b);l.gecko&&b.removeAttribute("_moz_dirty");return b.hasAttributes()},_4e_position:function(b,f){var d=h(b),q=h(f);if(d.compareDocumentPosition)return d.compareDocumentPosition(q);if(d==
q)return e.POSITION_IDENTICAL;if(d.nodeType==o.NODE_ELEMENT&&q.nodeType==o.NODE_ELEMENT){if(d.contains){if(d.contains(q))return e.POSITION_CONTAINS+e.POSITION_PRECEDING;if(q.contains(d))return e.POSITION_IS_CONTAINED+e.POSITION_FOLLOWING}if("sourceIndex"in d)return d.sourceIndex<0||q.sourceIndex<0?e.POSITION_DISCONNECTED:d.sourceIndex<q.sourceIndex?e.POSITION_PRECEDING:e.POSITION_FOLLOWING}d=b._4e_address();q=f._4e_address();for(var A=Math.min(d.length,q.length),z=0;z<=A-1;z++)if(d[z]!=q[z]){if(z<
A)return d[z]<q[z]?e.POSITION_PRECEDING:e.POSITION_FOLLOWING;break}return d.length<q.length?e.POSITION_CONTAINS+e.POSITION_PRECEDING:e.POSITION_IS_CONTAINED+e.POSITION_FOLLOWING},_4e_address:function(b,f){b=h(b);for(var d=[],q=b.ownerDocument.documentElement,A=b;A&&A!=q;){var z=A.parentNode,u=-1;if(z){for(var p=0;p<z.childNodes.length;p++){var x=z.childNodes[p];if(!(f&&x.nodeType==3&&x.previousSibling&&x.previousSibling.nodeType==3)){u++;if(x==A)break}}d.unshift(u)}A=z}return d},_4e_breakParent:function(b,
f){var d=new g.Range(b[0].ownerDocument);d.setStartAfter(b);d.setEndAfter(f);var q=d.extractContents();d.insertNode(b._4e_remove());b[0].parentNode.insertBefore(q,b[0].nextSibling)},_4e_style:function(b,f,d){b=k(b);if(d!==undefined)return b.css(f,d);b=h(b);return b.style[n(f)]},_4e_remove:function(b,f){var d=h(b),q=d.parentNode;if(q){if(f)for(var A;A=d.firstChild;)q.insertBefore(d.removeChild(A),d);q.removeChild(d)}return b},_4e_trim:function(b){s._4e_ltrim(b);s._4e_rtrim(b)},_4e_ltrim:function(b){b=
h(b);for(var f;f=b.firstChild;){if(f.nodeType==o.NODE_TEXT){var d=r.ltrim(f.nodeValue),q=f.nodeValue.length;if(d){if(d.length<q){(new v(f))._4e_splitText(q-d.length);b.removeChild(b.firstChild)}}else{b.removeChild(f);continue}}break}},_4e_rtrim:function(b){b=h(b);for(var f;f=b.lastChild;){if(f.type==o.NODE_TEXT){var d=r.rtrim(f.nodeValue),q=f.nodeValue.length;if(d){if(d.length<q){(new v(f))._4e_splitText(d.length);b.removeChild(b.lastChild)}}else{b.removeChild(f);continue}}break}if(!l.ie&&!l.opera)(f=
b.lastChild)&&f.nodeType==1&&f.nodeName.toLowerCase()=="br"&&f.parentNode.removeChild(f)},_4e_appendBogus:function(b){b=h(b);for(var f=b.lastChild;f&&f.nodeType==o.NODE_TEXT&&!t.trim(f.nodeValue);)f=f.previousSibling;if(!f||f.nodeType==o.NODE_TEXT||s._4e_name(f)!=="br"){f=l.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br");l.gecko&&f.setAttribute("type","_moz");b.appendChild(f)}},_4e_previous:function(b,f){var d=h(b),q;do q=(d=d.previousSibling)&&new v(d);while(q&&f&&!f(q));
return q},_4e_last:function(b,f){b=s._4e_wrap(b);var d=b[0].lastChild;if((d=d&&new v(d))&&f&&!f(d))d=d._4e_previous(f);return d},_4e_next:function(b,f){var d=h(b),q;do q=(d=d.nextSibling)&&new v(d);while(q&&f&&!f(q));return q},_4e_outerHtml:function(b){b=h(b);if(b.outerHTML)return b.outerHTML.replace(/<\?[^>]*>/,"");var f=b.ownerDocument.createElement("div");f.appendChild(b.cloneNode(true));return f.innerHTML},_4e_setMarker:function(b,f,d,q){b=s._4e_wrap(b);var A=b.data("list_marker_id")||b.data("list_marker_id",
t.guid()).data("list_marker_id"),z=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");f[A]=b;z[d]=1;return b.data(d,q)},_4e_clearMarkers:function(b,f,d){b=k(b);var q=b.data("list_marker_names"),A=b.data("list_marker_id"),z;for(z in q)b.removeData(z);b.removeData("list_marker_names");if(d){b.removeData("list_marker_id");delete f[A]}},_4e_copyAttributes:function(b,f,d){b=h(b);f=k(f);var q=b.attributes;d=d||{};for(var A=0;A<q.length;A++){var z=q[A],u=z.name.toLowerCase(),
p;if(!(u in d))if(u=="checked"&&(p=s.attr(b,u)))f.attr(u,p);else if(z.specified||l.ie&&z.value&&u=="value"){p=s.attr(b,u);if(p===null)p=z.nodeValue;f.attr(u,p)}}if(b.style.cssText!=="")f[0].style.cssText=b.style.cssText},_4e_isEditable:function(b){b=s._4e_name(b);var f=g.XHTML_DTD;return(b=!f.$nonEditable[b]&&(f[b]||f.span))&&b["#"]},_4e_scrollIntoView:function(b){b=k(b);var f=b[0].ownerDocument,d=s.scrollLeft(f),q=s.scrollTop(f),A=b.offset(),z=A.left;A=A.top;if(s.viewportHeight(f)+q<A||A<q||s.viewportWidth(f)+
d<z||z<d)b.scrollIntoView(f)},_4e_getElementsByTagName:function(b,f,d){b=h(b);if(!l.ie&&d)f=d+":"+f;d=[];b=b.getElementsByTagName(f);for(f=0;f<b.length;f++)d.push(new v(b[f]));return d}};t.DOM._4e_inject=function(b){t.mix(s,b);for(var f in b)b.hasOwnProperty(f)&&function(d){v.prototype[d]=function(){var q=[].slice.call(arguments,0);q.unshift(this);return b[d].apply(null,q)}}(f)};r.extern(i,{_4e_wrap:i._4e_wrap,_4e_unwrap:i._4e_unwrap,_4e_equals:i._4e_equals,_4e_isBlockBoundary:i._4e_isBlockBoundary,
_4e_getWin:i._4e_getWin,_4e_index:i._4e_index,_4e_first:i._4e_first,_4e_move:i._4e_move,_4e_name:i._4e_name,_4e_isIdentical:i._4e_isIdentical,_4e_isEmptyInlineRemoveable:i._4e_isEmptyInlineRemoveable,_4e_moveChildren:i._4e_moveChildren,_4e_mergeSiblings:i._4e_mergeSiblings,_4e_unselectable:i._4e_unselectable,_4e_getOffset:i._4e_getOffset,_4e_getFrameDocument:i._4e_getFrameDocument,_4e_splitText:i._4e_splitText,_4e_parents:i._4e_parents,_4e_clone:i._4e_clone,_4e_nextSourceNode:i._4e_nextSourceNode,
_4e_previousSourceNode:i._4e_previousSourceNode,_4e_commonAncestor:i._4e_commonAncestor,_4e_ascendant:i._4e_ascendant,_4e_hasAttribute:i._4e_hasAttribute,_4e_hasAttributes:i._4e_hasAttributes,_4e_position:i._4e_position,_4e_address:i._4e_address,_4e_breakParent:i._4e_breakParent,_4e_style:i._4e_style,_4e_remove:i._4e_remove,_4e_trim:i._4e_trim,_4e_ltrim:i._4e_ltrim,_4e_rtrim:i._4e_rtrim,_4e_appendBogus:i._4e_appendBogus,_4e_last:i._4e_last,_4e_previous:i._4e_previous,_4e_next:i._4e_next,_4e_outerHtml:i._4e_outerHtml,
_4e_setMarker:i._4e_setMarker,_4e_clearMarkers:i._4e_clearMarkers,_4e_getUniqueId:i._4e_getUniqueId,_4e_copyAttributes:i._4e_copyAttributes,_4e_isEditable:i._4e_isEditable,_4e_scrollIntoView:i._4e_scrollIntoView,_4e_getElementsByTagName:i._4e_getElementsByTagName});s._4e_inject(i)});
KISSY.Editor.add("focusmanager",function(g){function n(){this.iframeFocus=e;m=this;s.log(this._UUID+" focus")}function t(){this.iframeFocus=c;m=a;s.log(this._UUID+" blur")}var s=KISSY,l=s.DOM,v=s.Event,r={},m,o={refreshAll:function(){for(var h in r){var k=r[h];k.document.designMode="off";k.document.designMode="on"}},currentInstance:function(){return m},getInstance:function(h){return r[h]},add:function(h){var k=l._4e_getWin(h.document);v.on(k,"focus",n,h);v.on(k,"blur",t,h)},register:function(h){r[h._UUID]=
h},remove:function(h){delete r[h._UUID];var k=l._4e_getWin(h.document);v.remove(k,"focus",n,h);v.remove(k,"blur",t,h)}},e=true,c=false,a=null;g.focusManager=o;g.focusManager=o;g.getInstances=function(){return r};g.getInstances=g.getInstances});
KISSY.Editor.add("definition",function(g){var n=true,t=false,s=g.Utils,l=document,v=KISSY,r=v.UA,m=v.DOM,o=v.Node,e=v.Event,c=g.focusManager,a=s.tryThese,h=s.debugUrl("theme/editor-iframe.css"),k=1,i="document.open();"+(s.isCustomDomain()?'document.domain="'+l.domain+'";':"")+"document.close();",b="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(r.ie?"javascript:void(function(){"+encodeURIComponent(i)+"}())":"")+'"  tabIndex="'+(r.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";g.SOURCE_MODE=0;g.WYSIWYG_MODE=1;g.SOURCE_MODE=g.SOURCE_MODE;g.WYSIWYG_MODE=g.WYSIWYG_MODE;v.augment(g,{init:function(f){if(r.ie)m.addClass(l.body,"ie"+r.ie);else if(r.gecko)m.addClass(l.body,"gecko");else r.webkit&&m.addClass(l.body,"webkit");var d=this,q=new o(b.replace(/\$\(tabIndex\)/,
f.attr("tabIndex")));d.editorWrap=q;d._UUID=k++;c.register(d);d.wrap=q.one(".ke-textarea-wrap");d.wrap=d.wrap;d.iframe=d.wrap.one("iframe");d.iframe=d.iframe;d.toolBarDiv=q.one(".ke-editor-tools");d.toolBarDiv=d.toolBarDiv;d.textarea=f;d.textarea=d.textarea;d.statusDiv=q.one(".ke-editor-status");d.statusDiv=d.statusDiv;s.preventFocus(d.toolBarDiv);d._commands={};d._dialogs={};var A=f._4e_style("width"),z=f._4e_style("height");if(A){q.css("width",A);f.css("width","100%")}d.textarea.css("display","none");
q.insertAfter(f);d.wrap[0].appendChild(f[0]);if(z){d.wrap.css("height",z);f.css("height","100%")}q=d.iframe;d.on("dataReady",function(){d._ready=n;g.fire("instanceCreated",{editor:d})});r.gecko?q.on("load",d._setUpIFrame,d):d._setUpIFrame();d.cfg.attachForm&&f[0].form&&d._attachForm()},_attachForm:function(){(new o(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(f,d){var q=this,A=g.Overlay;A.loading();q.use(f,function(){var z=q.getDialog(f);d(z);A.unloading()})},addDialog:function(f,
d){this._dialogs[f]=d},getDialog:function(f){return this._dialogs[f]},addPlugin:function(f){this.ready(f)},addCommand:function(f,d){this._commands[f]=d},hasCommand:function(f){return this._commands[f]},execCommand:function(f){var d=this._commands[f],q=v.makeArray(arguments);q.shift();q.unshift(this);return d.exec.apply(d,q)},getMode:function(){return this.textarea.css("display")=="none"?g.WYSIWYG_MODE:g.SOURCE_MODE},getData:function(f){var d;d=this.getMode()==g.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)d=f?this.htmlDataProcessor.toHtml(d,"p"):this.htmlDataProcessor.toServer(d,"p");d=v.trim(d);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(d))d="";return d},setData:function(f){var d=f;if(this.htmlDataProcessor)d=this.htmlDataProcessor.toDataFormat(f,"p");this.document.body.innerHTML=d;this.getMode()!=g.WYSIWYG_MODE&&this.textarea.val(f)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(f){f=f||0;return f+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(f){this.document.body.innerHTML=f},_prepareIFrameHtml:function(f){var d=this.cfg,q=d.customLink,A="";if(q)for(var z=0;z<q.length;z++)A+='<link href="'+q[z]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+g.Config.base+h+"' rel='stylesheet'/><style>"+(d.customStyle||"")+"</style>"+A+"</head><body class='ke-editor'>&nbsp;"+(f?'<script id="ke_actscript" type="text/javascript">'+(s.isCustomDomain()?'document.domain="'+l.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+f+'");<\/script>':"")+"</body></html>"},getSelection:function(){return g.Selection.getSelection(this.document)},focus:function(){var f=this.document,d=m._4e_getWin(f);r.webkit&&d&&d.parent&&d.parent.focus();d&&d.focus();f&&f.body.focus();this.notifySelectionChange()},blur:function(){m._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(f){var d=this.cfg,q=this.document;d.customStyle=d.customStyle||"";d.customStyle+=
"\n"+f;d=q.createElement("style");q.getElementsByTagName("head")[0].appendChild(d);if(d.styleSheet)d.styleSheet.cssText=f;else d.appendChild(q.createTextNode(f))},addCustomLink:function(f){var d=this.cfg,q=this.document;d.customLink=d.customLink||[];d.customLink.push(f);d=q.createElement("link");d.rel="stylesheet";q.getElementsByTagName("head")[0].appendChild(d);d.href=f},removeCustomLink:function(f){for(var d=this.cfg,q=v.makeArray(this.document.getElementsByTagName("link")),A=0;A<q.length;A++)q[A].href==
f&&m._4e_remove(q[A]);d.customLink=d.customLink||[];d=d.customLink;f=v.indexOf(f,d);f!=-1&&d.splice(f,1)},_setUpIFrame:function(){function f(){u=z.document;d.document=u;q.detach();u.open("text/html","replace");u.write(A);u.close()}var d=this,q=d.iframe,A=d._prepareIFrameHtml(d._UUID),z=q[0].contentWindow,u;try{u=z.document}catch(p){q[0].src=q[0].src;if(r.ie<7){setTimeout(f,10);return}}f()},ready:function(f){this._ready?f():this.on("dataReady",f)},_monitor:function(){var f=this;f._monitorId&&clearTimeout(f._monitorId);
f._monitorId=setTimeout(function(){var d=f.getSelection();if(d&&!d.isInvalid){var q=d.getStartElement(),A=new g.ElementPath(q);if(!f.previousPath||!f.previousPath.compare(A)){f.previousPath=A;f.fire("selectionChange",{selection:d,path:A,element:q})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(f,d){var q=this;q.focus();var A=f._4e_name(),z=g.XHTML_DTD,u=g.RANGE,p=g.NODE,x=z.$block[A],y=q.getSelection(),B=y&&y.getRanges(),j,w,C,E,D;if(!B||
B.length==0){var F=arguments,K=F.callee;setTimeout(function(){K.apply(q,F)},30)}else{q.fire("save");for(var M=B.length-1;M>=0;M--){j=B[M];j.deleteContents();w=!M&&f||f._4e_clone(n);d&&d(w);if(x)for(;(E=j.getCommonAncestor(t,n))&&(D=z[E._4e_name()])&&!(D&&D[A]);)if(E._4e_name()in z.span)j.splitElement(E);else if(j.checkStartOfBlock()&&j.checkEndOfBlock()){j.setStartBefore(E);j.collapse(n);E._4e_remove()}else j.splitBlock();j.insertNode(w);C||(C=w)}if(C){A=C._4e_nextSourceNode(n);z=q.document;D=g.XHTML_DTD;
if(D.$inline[w._4e_name()]){A=new o(z.createTextNode(" "));A.insertAfter(C)}else if(A){if(A._4e_name()=="br"&&D[A.parent()._4e_name()].p){D=new o("<p>&nbsp;</p>",null,z);A[0].parentNode.replaceChild(D[0],A[0]);A=D}}else{D=new o("<p>&nbsp;</p>",null,z);D.insertAfter(C);A=D}j.moveToPosition(C,u.POSITION_AFTER_END);A&&A[0].nodeType==p.NODE_ELEMENT&&j.moveToElementEditablePosition(A);y.selectRanges([j]);q.focus();w&&w._4e_scrollIntoView();setTimeout(function(){q.fire("save")},10);return w}}},insertHtml:function(f){var d=
this;if(d.htmlDataProcessor)f=d.htmlDataProcessor.toDataFormat(f);if(r.webkit){var q=m.create(f,null,this.document);q=q.nodeType==11?v.makeArray(q.childNodes):[q];for(var A=0;A<q.length;A++)d.insertElement(new o(q[A]))}else{d.focus();A=(q=d.getSelection())&&q.getRanges();if(!A||A.length==0){var z=arguments,u=z.callee;setTimeout(function(){u.apply(d,z)},30)}else{d.fire("save");if(r.ie){q=q.getNative();q.type=="Control"&&q.clear();q.createRange().pasteHTML(f)}else d.document.execCommand("inserthtml",
t,f);d.focus();setTimeout(function(){d.fire("save")},10)}}}});g._initIFrame=function(f){function d(w){a(function(){z.designMode="on";setTimeout(function(){z.designMode="off";x.focus();if(!arguments.callee.retry)arguments.callee.retry=n},50)},function(){z.designMode="off";m.attr(x,"contentEditable",t);m.attr(x,"contentEditable",n);!w&&d(1)})}var q=c.getInstance(f);f=q.textarea[0];var A=q.iframe[0].contentWindow,z=q.document,u=q.cfg,p=z.getElementById("ke_actscript");m._4e_remove(p);var x=z.body;if(r.ie){x.hideFocus=
n;x.disabled=n;x.contentEditable=n;x.removeAttribute("disabled")}else setTimeout(function(){if(r.gecko||r.opera)x.contentEditable=n;else if(r.webkit)x.parentNode.contentEditable=n;else z.designMode="on"},0);if(r.webkit){e.on(z,"click",function(w){var C=new o(w.target);v.inArray(C._4e_name(),["input","select"])&&w.preventDefault()});e.on(z,"mouseup",function(w){var C=new o(w.target);v.inArray(C._4e_name(),["input","textarea"])&&w.preventDefault()})}if(r.gecko||r.ie||r.opera){var y;y=new o(m.insertAfter((new o('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],
f));y.on("focus",function(){q.focus()});q.activateGecko=function(){r.gecko&&q.iframeFocus&&y[0].focus()};q.on("destroy",function(){})}if(r.ie&&z.compatMode=="CSS1Compat"||r.gecko||r.opera){var B=new o(z.documentElement);B.on("mousedown",function(w){if(w.target==B[0]){r.gecko&&d(t);y[0].focus()}})}e.on(A,"focus",function(){if(r.gecko)d(t);else r.opera&&x.focus();q.notifySelectionChange()});r.gecko&&e.on(q.document,"mousedown",function(){q.iframeFocus||d(t)});if(r.ie){e.on(z,"keydown",function(w){if(w.keyCode in
{8:1,46:1}){var C=q.getSelection(),E=C.getSelectedElement();if(E){q.fire("save");var D=C.getRanges()[0].createBookmark();E._4e_remove();C.selectBookmarks([D]);q.fire("save");w.preventDefault()}}});if(z.compatMode=="CSS1Compat"){var j={33:1,34:1};e.on(z,"keydown",function(w){w.keyCode in j&&setTimeout(function(){q.getSelection().scrollIntoView()},0)})}}setTimeout(function(){r.ie&&setTimeout(function(){if(z){x.runtimeStyle.marginBottom="0px";x.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){q.fire("dataReady");
var w=u.disableObjectResizing,C=u.disableInlineTableEditing;if(w||C)try{z.execCommand("enableObjectResizing",t,!w);z.execCommand("enableInlineTableEditing",t,!C)}catch(E){e.on(x,r.ie?"resizestart":"resize",function(D){if(w||m._4e_name(D.target)==="table"&&C)D.preventDefault()})}},10);r.webkit&&e.on(z,"mousedown",function(w){w=new o(w.target);v.inArray(w._4e_name(),["img","hr","input","textarea","select"])&&q.getSelection().selectElement(w)});r.gecko&&e.on(z,"dragstart",function(w){var C=new o(w.target);
C._4e_name()==="img"&&/ke_/.test(C[0].className)&&w.preventDefault()});c.add(q)};i=g.prototype;s.extern(i,{setData:i.setData,getData:i.getData,insertElement:i.insertElement,insertHtml:i.insertHtml,ready:i.ready,addCustomStyle:i.addCustomStyle,addCommand:i.addCommand,hasCommand:i.hasCommand,execCommand:i.execCommand,addPlugin:i.addPlugin,useDialog:i.useDialog,addDialog:i.addDialog,getDialog:i.getDialog,getMode:i.getMode,sync:i.sync,baseZIndex:i.baseZIndex,getSelection:i.getSelection,focus:i.focus,
blur:i.blur,notifySelectionChange:i.notifySelectionChange})});KISSY.Editor.add("zindex",function(){var g=KISSY.Editor;if(!g.zIndexManager){g.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};g.baseZIndex=function(n){var t=n,s=g.getInstances(),l;for(l in s){if(!s.hasOwnProperty(l))return;t=Math.max(t,s[l].baseZIndex(n))}return t};g.baseZIndex=g.baseZIndex;g.zIndexManager=g.zIndexManager}});
KISSY.Editor.add("dtd",function(g){g.XHTML_DTD=function(){function n(u){for(var p=arguments.length-1;p>0;)KISSY.mix(u,arguments[p--]);return u}var t={isindex:1,fieldset:1},s={input:1,button:1,select:1,textarea:1,label:1},l=n({a:1},s),v=n({iframe:1},l),r={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},m={ins:1,del:1,script:1,style:1},o=n({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},m),e=n({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},o),c=n({p:1},e);s=n({iframe:1},e,s);e={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var a=n({a:1},s),h={tr:1},k={"#":1},i=n({param:1},e),b=n({form:1},t,v,r,c),f={li:1},d={base:1,link:1,meta:1,title:1},q=n(d,{style:1,script:1}),A={head:1,body:1},z={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:n({html:1},A,d),$block:z,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:a,$body:n({script:1,style:1},z),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:A,head:q,style:k,body:b,base:{},link:{},meta:{},title:k,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:b,td:b,br:{},th:b,center:b,kbd:a,button:n(c,r),basefont:{},h5:a,h4:a,samp:a,h6:a,ol:f,h1:a,h3:a,option:k,h2:a,form:n(t,v,r,c),select:{optgroup:1,option:1},font:a,ins:a,menu:f,abbr:a,label:a,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:a,script:k,tfoot:h,cite:a,li:b,input:{},iframe:b,strong:a,textarea:k,noframes:b,big:a,small:a,span:a,hr:{},dt:a,sub:a,optgroup:{option:1},param:{},bdo:a,"var":a,div:b,object:i,sup:a,dd:b,strike:a,area:{},dir:f,map:n({area:1,form:1,p:1},t,m,r),applet:i,dl:{dt:1,dd:1},del:a,isindex:{},fieldset:n({legend:1},e),thead:h,ul:f,acronym:a,b:a,a:s,blockquote:b,caption:a,i:a,u:a,tbody:h,s:a,address:n(v,c),tt:a,legend:a,q:a,pre:n(o,l),p:a,em:a,dfn:a}}();g.XHTML_DTD=
g.XHTML_DTD});
KISSY.Editor.add("elementpath",function(g){function n(e){var c=v,a=v,h=[];for(e=e;e&&e[0];){if(e[0].nodeType==l.NODE_ELEMENT){if(!this.lastElement)this.lastElement=e;var k=e._4e_name();if(!a){if(!c&&r[k])c=e;if(m[k]){var i;if(i=!c){if(i=k=="div"){a:{i=e;i=i[0]||i;i=i.childNodes;for(var b=0,f=i.length;b<f;b++){var d=i[b];if(d.nodeType==l.NODE_ELEMENT&&s.$block[d.nodeName.toLowerCase()]){i=true;break a}}i=false}i=!i}i=i}if(i)c=e;else a=e}}h.push(e);if(k=="body")break}e=e.parent()}this.block=this.block=
c;this.blockLimit=this.blockLimit=a;this.elements=this.elements=h}var t=KISSY.DOM,s=g.XHTML_DTD,l=g.NODE,v=null,r={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},m={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};n.prototype={compare:function(e){var c=this.elements;e=e&&e.elements;if(!e||c.length!=e.length)return false;for(var a=0;a<c.length;a++)if(!t._4e_equals(c[a],e[a]))return false;return true},contains:function(e){for(var c=this.elements,a=0;a<
c.length;a++)if(c[a]._4e_name()in e)return c[a];return v}};g.ElementPath=g.ElementPath=n;var o=n.prototype;g.Utils.extern(o,{compare:o.compare,contains:o.contains})});
KISSY.Editor.add("walker",function(g){function n(h,k){if(this._.end)return r;var i,b=this.range,f,d=this.guard,q=this.type,A=h?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;b.trim();if(b.collapsed){this.end();return r}}if(!h&&!this._.guardLTR){var z=b.endContainer,u=new c(z[0].childNodes[b.endOffset]);this._.guardLTR=function(B,j){return(B=e._4e_wrap(B))&&B[0]&&(!j||!e._4e_equals(z,B))&&(!u[0]||!B._4e_equals(u))&&(B[0].nodeType!=o.NODE_ELEMENT||!j||B._4e_name()!="body")}}if(h&&
!this._.guardRTL){var p=b.startContainer,x=b.startOffset>0&&new c(p[0].childNodes[b.startOffset-1]);this._.guardRTL=function(B,j){return(B=e._4e_wrap(B))&&B[0]&&(!j||!B._4e_equals(p))&&(!x[0]||!B._4e_equals(x))&&(B[0].nodeType!=o.NODE_ELEMENT||!j||B._4e_name()!="body")}}var y=h?this._.guardRTL:this._.guardLTR;f=d?function(B,j){if(y(B,j)===v)return v;return d(B,j)}:y;if(this.current)i=this.current[A](v,q,f);else if(h){i=b.endContainer;if(b.endOffset>0){i=new c(i[0].childNodes[b.endOffset-1]);if(f(i)===
v)i=r}else i=f(i,l)===v?r:i._4e_previousSourceNode(l,q,f)}else{i=b.startContainer;if((i=new c(i[0].childNodes[b.startOffset]))&&i[0]){if(f(i)===v)i=r}else i=f(b.startContainer,l)===v?r:b.startContainer._4e_nextSourceNode(l,q,f)}for(;i&&i[0]&&!this._.end;){this.current=i;if(!this.evaluator||this.evaluator(i)!==v){if(!k)return i}else if(k&&this.evaluator)return v;i=i[A](v,q,f)}this.end();return this.current=r}function t(h){for(var k,i=r;k=n.call(this,h);)i=k;return i}function s(h){this.range=h;this._=
{}}var l=true,v=false,r=null,m=KISSY,o=g.NODE,e=m.DOM,c=m.Node;m.augment(s,{end:function(){this._.end=1},next:function(){return n.call(this)},previous:function(){return n.call(this,l)},checkForward:function(){return n.call(this,v,l)!==v},checkBackward:function(){return n.call(this,l,l)!==v},lastForward:function(){return t.call(this)},lastBackward:function(){return t.call(this,l)},reset:function(){delete this.current;this._={}}});s.blockBoundary=function(h){return function(k){k=e._4e_wrap(k);return!(k&&
k[0].nodeType==o.NODE_ELEMENT&&k._4e_isBlockBoundary(h))}};s.listItemBoundary=function(){return this.blockBoundary({br:1})};s.bookmark=function(h,k){function i(b){return b&&b[0]&&b._4e_name()=="span"&&b.attr("_ke_bookmark")}return function(b){var f,d;f=b&&b[0]&&b[0].nodeType==o.NODE_TEXT&&(d=b.parent())&&i(d);f=h?f:f||i(b);return k^f}};s.whitespaces=function(h){return function(k){k=(k=k[0]||k)&&k.nodeType==o.NODE_TEXT&&!m.trim(k.nodeValue);return h^k}};s.invisible=function(h){var k=s.whitespaces();
return function(i){i=k(i)||i[0].nodeType==o.NODE_ELEMENT&&!i[0].offsetHeight;return h^i}};g.Walker=s;g.Walker=s;var a=s.prototype;g.Utils.extern(a,{end:a.end,next:a.next,previous:a.previous,checkForward:a.checkForward,checkBackward:a.checkBackward,lastForward:a.lastForward,lastBackward:a.lastBackward,reset:a.reset});g.Utils.extern(s,{blockBoundary:s.blockBoundary,listItemBoundary:s.listItemBoundary,bookmark:s.bookmark,whitespaces:s.whitespaces,invisible:s.invisible})});
KISSY.Editor.add("range",function(g){function n(j){this.endOffset=this.endContainer=this.startOffset=this.startContainer=e;this.collapsed=m;this.document=j}function t(j){var w=j[0].nodeType!=a.NODE_TEXT&&j._4e_name()in q.$removeEmpty,C=!c.trim(j[0].nodeValue);j=!!j.parent().attr("_ke_bookmark");return w||C||j}function s(j){return!x(j)&&!y(j)}function l(j){var w=o,C=i.bookmark(m);return function(E){if(C(E))return m;if(E[0].nodeType==a.NODE_TEXT){if(c.trim(E[0].nodeValue).length)return o}else if(E[0].nodeType==
a.NODE_ELEMENT)if(!p[E._4e_name()])if(!j&&!d.ie&&E._4e_name()=="br"&&!w)w=m;else return o;return m}}function v(j,w){function C(E){return E&&E.nodeName=="span"&&E.getAttribute("_ke_bookmark")}return function(E){var D,F;D=E&&!E.nodeName&&(F=E.parentNode)&&C(F);D=j?D:D||C(E);return w^D}}function r(j){return function(w){w=(w=w[0]||w)&&w.nodeType==a.NODE_TEXT&&!c.trim(w.nodeValue);return j^w}}g.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};g.RANGE=g.RANGE;var m=true,o=false,e=null,c=KISSY,a=g.NODE,h=g.RANGE,k=g.POSITION,i=g.Walker,b=c.DOM,f=g.Utils.getByAddress,d=c.UA,q=g.XHTML_DTD,A=g.ElementPath,z=c.Node,u={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};n.prototype.toString=function(){var j=[];j.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);j.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return j.join("<br/>")};c.augment(n,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&b._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var j=this.startContainer,w=this.startOffset;if(j[0].nodeType!=a.NODE_ELEMENT)if(w)w>=j[0].nodeValue.length&&this.setStartAfter(j);else this.setStartBefore(j);j=this.endContainer;w=this.endOffset;if(j[0].nodeType!=a.NODE_ELEMENT)if(w)w>=
j[0].nodeValue.length&&this.setEndAfter(j);else this.setEndBefore(j)},setStartAfter:function(j){this.setStart(j.parent(),j._4e_index()+1)},setStartBefore:function(j){this.setStart(j.parent(),j._4e_index())},setEndAfter:function(j){this.setEnd(j.parent(),j._4e_index()+1)},setEndBefore:function(j){this.setEnd(j.parent(),j._4e_index())},optimizeBookmark:function(){var j=this.startContainer,w=this.endContainer;j&&j._4e_name()=="span"&&j.attr("_ke_bookmark")&&this.setStartAt(j,h.POSITION_BEFORE_START);
w&&w._4e_name()=="span"&&w.attr("_ke_bookmark")&&this.setEndAt(w,h.POSITION_AFTER_END)},setStart:function(j,w){if(j[0].nodeType==a.NODE_ELEMENT&&u[j._4e_name()]){j=j.parent();w=j._4e_index()}this.startContainer=j;this.startOffset=w;if(!this.endContainer){this.endContainer=j;this.endOffset=w}this.updateCollapsed()},setEnd:function(j,w){if(j[0].nodeType==a.NODE_ELEMENT&&u[j._4e_name()]){j=j.parent();w=j._4e_index()+1}this.endContainer=j;this.endOffset=w;if(!this.startContainer){this.startContainer=
j;this.startOffset=w}this.updateCollapsed()},setStartAt:function(j,w){switch(w){case h.POSITION_AFTER_START:this.setStart(j,0);break;case h.POSITION_BEFORE_END:j[0].nodeType==a.NODE_TEXT?this.setStart(j,j[0].nodeValue.length):this.setStart(j,j[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setStartBefore(j);break;case h.POSITION_AFTER_END:this.setStartAfter(j)}this.updateCollapsed()},setEndAt:function(j,w){switch(w){case h.POSITION_AFTER_START:this.setEnd(j,0);break;case h.POSITION_BEFORE_END:j[0].nodeType==
a.NODE_TEXT?this.setEnd(j,j[0].nodeValue.length):this.setEnd(j,j[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setEndBefore(j);break;case h.POSITION_AFTER_END:this.setEndAfter(j)}this.updateCollapsed()},execContentsAction:function(j,w){var C=this.startContainer,E=this.endContainer,D=this.startOffset,F=this.endOffset,K,M=this.document,N;this.optimizeBookmark();if(E[0].nodeType==a.NODE_TEXT)E=E._4e_splitText(F);else if(E[0].childNodes.length>0)if(F>=E[0].childNodes.length){E=new z(E[0].appendChild(M.createTextNode("")));
N=m}else E=new z(E[0].childNodes[F]);if(C[0].nodeType==a.NODE_TEXT){C._4e_splitText(D);if(C._4e_equals(E))E=new z(C[0].nextSibling)}else if(D)if(D>=C[0].childNodes.length){K=new z(M.createTextNode(""));C.append(K);C=K;K=m}else C=new z(C[0].childNodes[D].previousSibling);else{K=new z(M.createTextNode(""));C.prepend(K);C=K;K=m}D=C._4e_parents();F=E._4e_parents();var Q,U,S;for(Q=0;Q<D.length;Q++){U=D[Q];S=F[Q];if(!U._4e_equals(S))break}M=w;for(var T,V,G,L=Q;L<D.length;L++){T=D[L];V=M&&!T._4e_equals(C)?
M.appendChild(T._4e_clone()[0]):null;for(T=T[0].nextSibling;T;){if(b._4e_equals(F[L],T)||b._4e_equals(E,T))break;G=T.nextSibling;if(j==2)M.appendChild(T.cloneNode(m));else{b._4e_remove(T);j==1&&M.appendChild(T)}T=G}if(V)M=V}M=w;for(Q=Q;Q<F.length;Q++){T=F[Q];V=M&&j>0&&!T._4e_equals(E)?M.appendChild(T._4e_clone()[0]):null;if(!D[Q]||!T.parent()._4e_equals(D[Q].parent()))for(T=T[0].previousSibling;T;){if(b._4e_equals(D[Q],T)||b._4e_equals(C,T))break;G=T.previousSibling;if(j==2)M.insertBefore(T.cloneNode(m),
M.firstChild);else{b._4e_remove(T);j==1&&M.insertBefore(T,M.firstChild)}T=G}if(V)M=V}if(j==2){S=this.startContainer[0];if(S.nodeType==a.NODE_TEXT&&S.nextSibling&&S.nextSibling.nodeType==a.NODE_TEXT){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}S=this.endContainer[0];if(S.nodeType==a.NODE_TEXT&&S.nextSibling&&S.nextSibling.nodeType==a.NODE_TEXT){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}}else{if(U&&S&&(!C.parent()._4e_equals(U.parent())||!E.parent()._4e_equals(S.parent()))){U=
S._4e_index();K&&S.parent()._4e_equals(C.parent())&&U--;this.setStart(S.parent(),U)}this.collapse(m)}K&&C._4e_remove();N&&E[0].parentNode&&E._4e_remove()},collapse:function(j){if(j){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=m},clone:function(){var j=new n(this.document);j.startContainer=this.startContainer;j.startOffset=this.startOffset;j.endContainer=this.endContainer;j.endOffset=
this.endOffset;j.collapsed=this.collapsed;return j},getEnclosedNode:function(){var j=this.clone();j.optimize();if(j.startContainer[0].nodeType!=a.NODE_ELEMENT||j.endContainer[0].nodeType!=a.NODE_ELEMENT)return e;var w=new g.Walker(j),C=v(m,undefined),E=r(m);j.evaluator=function(D){return E(D)&&C(D)};j=w.next();w.reset();w=w.previous();return j&&j._4e_equals(w)?j:e},shrink:function(j,w){if(!this.collapsed){j=j||h.SHRINK_TEXT;var C=this.clone(),E=this.startContainer,D=this.endContainer,F=this.startOffset,
K=this.endOffset,M=1,N=1;if(E&&E[0].nodeType==a.NODE_TEXT)if(F)if(F>=E[0].nodeValue.length)C.setStartAfter(E);else{C.setStartBefore(E);M=0}else C.setStartBefore(E);if(D&&D[0].nodeType==a.NODE_TEXT)if(K)if(K>=D[0].nodeValue.length)C.setEndAfter(D);else{C.setEndAfter(D);N=0}else C.setEndBefore(D);C=new i(C);C.evaluator=function(U){U=U[0]||U;return U.nodeType==(j==h.SHRINK_ELEMENT?a.NODE_ELEMENT:a.NODE_TEXT)};var Q;C.guard=function(U,S){U=U[0]||U;if(j==h.SHRINK_ELEMENT&&U.nodeType==a.NODE_TEXT)return o;
if(S&&U==Q)return o;if(!S&&U.nodeType==a.NODE_ELEMENT)Q=U;return m};if(M)(E=C[j==h.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(E,w?h.POSITION_AFTER_START:h.POSITION_BEFORE_START);if(N){C.reset();(C=C[j==h.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(C,w?h.POSITION_BEFORE_END:h.POSITION_AFTER_END)}return!!(M||N)}},getTouchedStartNode:function(){var j=this.startContainer;if(this.collapsed||j[0].nodeType!=a.NODE_ELEMENT)return j;return j.childNodes[this.startOffset]||j},createBookmark2:function(j){var w=
this.startContainer,C=this.endContainer,E=this.startOffset,D=this.endOffset,F,K;if(!w||!C)return{start:0,end:0};if(j){if(w[0].nodeType==a.NODE_ELEMENT)if((F=new z(w[0].childNodes[E]))&&F[0]&&F[0].nodeType==a.NODE_TEXT&&E>0&&F[0].previousSibling.nodeType==a.NODE_TEXT){w=F;E=0}for(;w[0].nodeType==a.NODE_TEXT&&(K=w._4e_previous())&&K[0].nodeType==a.NODE_TEXT;){w=K;E+=K[0].nodeValue.length}if(!this.collapsed){if(C[0].nodeType==a.NODE_ELEMENT)if((F=new z(C[0].childNodes[D]))&&F[0]&&F[0].nodeType==a.NODE_TEXT&&
D>0&&F[0].previousSibling.nodeType==a.NODE_TEXT){C=F;D=0}for(;C[0].nodeType==a.NODE_TEXT&&(K=C._4e_previous())&&K[0].nodeType==a.NODE_TEXT;){C=K;D+=K[0].nodeValue.length}}}return{start:w._4e_address(j),end:this.collapsed?e:C._4e_address(j),startOffset:E,endOffset:D,normalized:j,is2:m}},createBookmark:function(j){var w,C,E,D,F=this.collapsed;w=new z("<span>",e,this.document);w.attr("_ke_bookmark",1);w.css("display","none");w.html("&nbsp;");if(j){E=c.guid("ke_bm_");w.attr("id",E+"S")}if(!F){C=w._4e_clone();
C.html("&nbsp;");j&&C.attr("id",E+"E");D=this.clone();D.collapse();D.insertNode(C)}D=this.clone();D.collapse(m);D.insertNode(w);if(C){this.setStartAfter(w);this.setEndBefore(C)}else this.moveToPosition(w,h.POSITION_AFTER_END);return{startNode:j?E+"S":w,endNode:j?E+"E":C,serializable:j,collapsed:F}},moveToPosition:function(j,w){this.setStartAt(j,w);this.collapse(m)},trim:function(j,w){var C=this.startContainer,E=this.startOffset,D=this.collapsed;if((!j||D)&&C[0]&&C[0].nodeType==a.NODE_TEXT){if(E)if(E>=
C[0].nodeValue.length){E=C._4e_index()+1;C=C.parent()}else{var F=C._4e_splitText(E);E=C._4e_index()+1;C=C.parent();if(b._4e_equals(this.startContainer,this.endContainer))this.setEnd(F,this.endOffset-this.startOffset);else if(b._4e_equals(C,this.endContainer))this.endOffset+=1}else{E=C._4e_index();C=C.parent()}this.setStart(C,E);if(D){this.collapse(m);return}}C=this.endContainer;E=this.endOffset;if(!(w||D)&&C[0]&&C[0].nodeType==a.NODE_TEXT){if(E){E>=C.nodeValue.length||C._4e_splitText(E);E=C._4e_index()+
1}else E=C._4e_index();C=C.parent();this.setEnd(C,E)}},insertNode:function(j){this.optimizeBookmark();this.trim(o,m);var w=this.startContainer;w[0].insertBefore(j[0]||j,w[0].childNodes[this.startOffset]||null);b._4e_equals(j.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(j)},moveToBookmark:function(j){if(j.is2){var w=f(this.document,j.start,j.normalized),C=j.startOffset,E=j.end&&f(this.document,j.end,j.normalized);j=j.endOffset;this.setStart(w,C);E?this.setEnd(E,j):this.collapse(m)}else{w=
(C=j.serializable)?c.one("#"+j.startNode,this.document):j.startNode;j=C?c.one("#"+j.endNode,this.document):j.endNode;this.setStartBefore(w);w._4e_remove();if(j&&j[0]){this.setEndBefore(j);j._4e_remove()}else this.collapse(m)}},getCommonAncestor:function(j,w){var C=this.startContainer,E=this.endContainer;C=b._4e_equals(C,E)?j&&C[0].nodeType==a.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new z(C[0].childNodes[this.startOffset]):C:C._4e_commonAncestor(E);return w&&C[0].nodeType==a.NODE_TEXT?C.parent():
C},enlarge:function(j){switch(j){case h.ENLARGE_ELEMENT:if(this.collapsed)break;j=this.getCommonAncestor();var w=new z(this.document.body),C,E,D,F,K,M=o,N,Q;N=this.startContainer;Q=this.startOffset;if(N[0].nodeType==a.NODE_TEXT){if(Q){N=!c.trim(N[0].nodeValue.substring(0,Q)).length&&N;M=!!N}if(N)if(!(F=N[0].previousSibling))D=N.parent()}else{if(Q)F=N[0].childNodes[Q-1]||N[0].lastChild;F||(D=N)}for(;D||F;){if(D&&!F){if(!K&&b._4e_equals(D,j))K=m;if(!w.contains(D))break;if(!M||D.css("display")!="inline"){M=
o;if(K)C=D;else this.setStartBefore(D)}F=D[0].previousSibling}for(;F;){N=o;if(F.nodeType==a.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=e;N=/[\s\ufeff]$/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(M&&q.$removeEmpty[F.nodeName.toLowerCase()]){Q=b.text(F);if(/[^\s\ufeff]/.test(Q))F=e;else for(var U=F.all||F.getElementsByTagName("*"),S=0,T;T=U[S++];)if(!q.$removeEmpty[T.nodeName.toLowerCase()]){F=e;break}if(F)N=!!Q.length}else F=e;if(N)if(M)if(K)C=D;else D&&this.setStartBefore(D);
else M=m;if(F){N=F.previousSibling;if(!D&&!N){D=new z(F);F=e;break}F=N}else D=e}if(D)D=D.parent()}N=this.endContainer;Q=this.endOffset;D=F=e;K=M=o;if(N[0].nodeType==a.NODE_TEXT){N=!c.trim(N[0].nodeValue.substring(Q)).length&&N;M=!(N&&N[0].nodeValue.length);if(N)if(!(F=N[0].nextSibling))D=N.parent()}else(F=N[0].childNodes[Q])||(D=N);for(;D||F;){if(D&&!F){if(!K&&b._4e_equals(D,j))K=m;if(!w.contains(D))break;if(!M||D.css("display")!="inline"){M=o;if(K)E=D;else D&&this.setEndAfter(D)}F=D[0].nextSibling}for(;F;){N=
o;if(F.nodeType==a.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=e;N=/^[\s\ufeff]/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(M&&q.$removeEmpty[F.nodeName.toLowerCase()]){Q=b.text(F);if(/[^\s\ufeff]/.test(Q))F=e;else{U=F.all||F.getElementsByTagName("*");for(S=0;T=U[S++];)if(!q.$removeEmpty[T.nodeName.toLowerCase()]){F=e;break}}if(F)N=!!Q.length}else F=e;if(N)if(M)if(K)E=D;else this.setEndAfter(D);if(F){N=F.nextSibling;if(!D&&!N){D=new z(F);F=e;break}F=N}else D=e}if(D)D=
D.parent()}if(C&&E){j=C.contains(E)?E:C;this.setStartBefore(j);this.setEndAfter(j)}break;case h.ENLARGE_BLOCK_CONTENTS:case h.ENLARGE_LIST_ITEM_CONTENTS:D=new n(this.document);w=new z(this.document.body);D.setStartAt(w,h.POSITION_AFTER_START);D.setEnd(this.startContainer,this.startOffset);D=new i(D);var V,G,L=i.blockBoundary(j==h.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:e),I=function(H){var J=L(H);J||(V=H);return J};C=function(H){var J=I(H);if(!J&&H[0]&&H._4e_name()=="br")G=H;return J};D.guard=I;D=D.lastBackward();
V=V||w;this.setStartAt(V,V._4e_name()!="br"&&(!D&&this.checkStartOfBlock()||D&&V.contains(D))?h.POSITION_AFTER_START:h.POSITION_AFTER_END);D=this.clone();D.collapse();D.setEndAt(w,h.POSITION_BEFORE_END);D=new i(D);D.guard=j==h.ENLARGE_LIST_ITEM_CONTENTS?C:I;V=e;D=D.lastForward();V=V||w;this.setEndAt(V,!D&&this.checkEndOfBlock()||D&&V.contains(D)?h.POSITION_BEFORE_END:h.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},checkStartOfBlock:function(){var j=this.startContainer,w=this.startOffset;if(w&&j[0].nodeType==
a.NODE_TEXT)if(c.trim(j[0].nodeValue.substring(0,w)).length)return o;this.trim();j=new A(this.startContainer);w=this.clone();w.collapse(m);w.setStartAt(j.block||j.blockLimit,h.POSITION_AFTER_START);j=new i(w);j.evaluator=l(m);return j.checkBackward()},checkEndOfBlock:function(){var j=this.endContainer,w=this.endOffset;if(j[0].nodeType==a.NODE_TEXT)if(c.trim(j[0].nodeValue.substring(w)).length)return o;this.trim();j=new A(this.endContainer);w=this.clone();w.collapse(o);w.setEndAt(j.block||j.blockLimit,
h.POSITION_BEFORE_END);j=new i(w);j.evaluator=l(o);return j.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var j=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,j);return j},checkBoundaryOfElement:function(j,w){var C=this.clone();C[w==h.START?"setStartAt":"setEndAt"](j,w==h.START?h.POSITION_AFTER_START:h.POSITION_BEFORE_END);C=new i(C);C.evaluator=t;return C[w==h.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var j=this.startContainer,w=this.endContainer,C=this.startOffset,E=this.endOffset,D;if(j[0].nodeType==a.NODE_ELEMENT){D=j[0].childNodes.length;if(D>C)j=new z(j[0].childNodes[C]);else if(D<1)j=j._4e_previousSourceNode();else{for(j=j[0];j.lastChild;)j=j.lastChild;j=new z(j);j=j._4e_nextSourceNode()||j}}if(w[0].nodeType==a.NODE_ELEMENT){D=w[0].childNodes.length;if(D>E)w=(new z(w[0].childNodes[E]))._4e_previousSourceNode(m);else if(D<1)w=w._4e_previousSourceNode();else{for(w=
w[0];w.lastChild;)w=w.lastChild;w=new z(w)}}if(j._4e_position(w)&k.POSITION_FOLLOWING)j=w;return{startNode:j,endNode:w}},fixBlock:function(j,w){var C=this.createBookmark(),E=new z(this.document.createElement(w));this.collapse(j);this.enlarge(h.ENLARGE_BLOCK_CONTENTS);E[0].appendChild(this.extractContents());E._4e_trim();d.ie||E._4e_appendBogus();this.insertNode(E);this.moveToBookmark(C);return E},splitBlock:function(j){var w=new A(this.startContainer),C=new A(this.endContainer),E=w.block,D=C.block,
F=e;if(!w.blockLimit._4e_equals(C.blockLimit))return e;if(j!="br"){if(!E){E=this.fixBlock(m,j);D=(new A(this.endContainer)).block}D||(D=this.fixBlock(o,j))}j=E&&this.checkStartOfBlock();w=D&&this.checkEndOfBlock();this.deleteContents();if(E&&b._4e_equals(E,D))if(w){F=new A(this.startContainer);this.moveToPosition(D,h.POSITION_AFTER_END);D=e}else if(j){F=new A(this.startContainer);this.moveToPosition(E,h.POSITION_BEFORE_START);E=e}else{D=this.splitElement(E);!d.ie&&!c.inArray(E._4e_name(),["ul","ol"])&&
E._4e_appendBogus()}return{previousBlock:E,nextBlock:D,wasStartOfBlock:j,wasEndOfBlock:w,elementPath:F}},splitElement:function(j){if(!this.collapsed)return e;this.setEndAt(j,h.POSITION_BEFORE_END);var w=this.extractContents(),C=j._4e_clone(o);C[0].appendChild(w);C.insertAfter(j);this.moveToPosition(j,h.POSITION_AFTER_END);return C},moveToElementEditablePosition:function(j,w){var C,E=g.XHTML_DTD;if(E.$empty[j._4e_name()])return o;for(;j&&j[0].nodeType==a.NODE_ELEMENT;){if(C=j._4e_isEditable())this.moveToPosition(j,
w?h.POSITION_BEFORE_END:h.POSITION_AFTER_START);else if(E.$inline[j._4e_name()]){this.moveToPosition(j,w?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);return m}if((j=E.$empty[j._4e_name()]?j[w?"_4e_previous":"_4e_next"](s):j[w?"_4e_last":"_4e_first"](s))&&j[0].nodeType==a.NODE_TEXT){this.moveToPosition(j,w?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);return m}}return C},selectNodeContents:function(j){this.setStart(j,0);this.setEnd(j,j[0].nodeType==a.NODE_TEXT?j[0].nodeValue.length:j[0].childNodes.length)}});
var p={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},x=new i.whitespaces,y=new i.bookmark;g.Range=n;g.Range=n;var B=n.prototype;g.Utils.extern(B,{updateCollapsed:B.updateCollapsed,optimize:B.optimize,setStartAfter:B.setStartAfter,setEndAfter:B.setEndAfter,setStartBefore:B.setStartBefore,setEndBefore:B.setEndBefore,optimizeBookmark:B.optimizeBookmark,setStart:B.setStart,setEnd:B.setEnd,
setStartAt:B.setStartAt,setEndAt:B.setEndAt,execContentsAction:B.execContentsAction,collapse:B.collapse,clone:B.clone,getEnclosedNode:B.getEnclosedNode,shrink:B.shrink,getTouchedStartNode:B.getTouchedStartNode,createBookmark2:B.createBookmark2,createBookmark:B.createBookmark,moveToPosition:B.moveToPosition,trim:B.trim,insertNode:B.insertNode,moveToBookmark:B.moveToBookmark,getCommonAncestor:B.getCommonAncestor,enlarge:B.enlarge,checkStartOfBlock:B.checkStartOfBlock,checkEndOfBlock:B.checkEndOfBlock,
deleteContents:B.deleteContents,extractContents:B.extractContents,checkBoundaryOfElement:B.checkBoundaryOfElement,getBoundaryNodes:B.getBoundaryNodes,fixBlock:B.fixBlock,splitBlock:B.splitBlock,splitElement:B.splitElement,moveToElementEditablePosition:B.moveToElementEditablePosition,selectNodeContents:B.selectNodeContents})});
KISSY.Editor.add("domiterator",function(g){function n(i){if(!(arguments.length<1)){this.range=i;this.forceBrBreak=s;this.enlargeBr=t;this.enforceRealBlocks=s;this._||(this._={})}}var t=true,s=false,l=KISSY,v=l.UA,r=g.Walker,m=g.Range,o=g.RANGE,e=g.NODE,c=g.ElementPath,a=l.Node,h=l.DOM,k=/^[\r\n\t ]*$/;l.augment(n,{getNextParagraph:function(i){var b,f,d,q,A;if(!this._.lastNode){f=this.range.clone();f.shrink(o.SHRINK_ELEMENT,t);f.enlarge(this.forceBrBreak||!this.enlargeBr?o.ENLARGE_LIST_ITEM_CONTENTS:
o.ENLARGE_BLOCK_CONTENTS);var z=new r(f),u=r.bookmark(t,t);z.evaluator=u;this._.nextNode=z.next();z=new r(f);z.evaluator=u;z=z.previous();this._.lastNode=z._4e_nextSourceNode(t);if(this._.lastNode&&this._.lastNode[0].nodeType==e.NODE_TEXT&&!l.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){u=new m(f.document);u.moveToPosition(this._.lastNode,o.POSITION_AFTER_END);if(u.checkEndOfBlock()){u=new c(u.endContainer);this._.lastNode=(u.block||u.blockLimit)._4e_nextSourceNode(t)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new a(f.document.createTextNode(""));h.insertAfter(this._.lastNode[0],z[0])}f=null}u=this._.nextNode;z=this._.lastNode;for(this._.nextNode=null;u;){var p=s,x=u[0].nodeType!=e.NODE_ELEMENT,y=s;if(x){if(u[0].nodeType==e.NODE_TEXT)if(k.test(u[0].nodeValue))x=s}else{var B=u._4e_name();if(u._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(B=="br")x=t;else if(!f&&!u[0].childNodes.length&&B!="hr"){b=u;d=u._4e_equals(z);break}if(f){f.setEndAt(u,o.POSITION_BEFORE_START);if(B!="br")this._.nextNode=
u}p=t}else{if(u[0].firstChild){if(!f){f=new m(this.range.document);f.setStartAt(u,o.POSITION_BEFORE_START)}u=new a(u[0].firstChild);continue}x=t}}if(x&&!f){f=new m(this.range.document);f.setStartAt(u,o.POSITION_BEFORE_START)}d=(!p||x)&&u._4e_equals(z);if(f&&!p)for(;!u[0].nextSibling&&!d;){B=u.parent();if(B._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){p=t;d||B._4e_equals(z);break}u=B;x=t;d=u._4e_equals(z);y=t}x&&f.setEndAt(u,o.POSITION_AFTER_END);u=u._4e_nextSourceNode(y,null,z);if((d=!u)||p&&f)break}if(!b){if(!f){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}b=new c(f.startContainer);u=b.blockLimit;p={div:1,th:1,td:1};b=b.block;if((!b||!b[0])&&!this.enforceRealBlocks&&p[u._4e_name()]&&f.checkStartOfBlock()&&f.checkEndOfBlock())b=u;else if(!b||this.enforceRealBlocks&&b._4e_name()=="li"){b=new a(this.range.document.createElement(i||"p"));b[0].appendChild(f.extractContents());b._4e_trim();f.insertNode(b);q=A=t}else if(b._4e_name()!="li"){if(!f.checkStartOfBlock()||!f.checkEndOfBlock()){b=b._4e_clone(s);
b[0].appendChild(f.extractContents());b._4e_trim();A=f.splitBlock();q=!A.wasStartOfBlock;A=!A.wasEndOfBlock;f.insertNode(b)}}else if(!d)this._.nextNode=b._4e_equals(z)?null:f.getBoundaryNodes().endNode._4e_nextSourceNode(t,null,z)}if(q){f=new a(b[0].previousSibling);if(f[0]&&f[0].nodeType==e.NODE_ELEMENT)if(f._4e_name()=="br")f._4e_remove();else f[0].lastChild&&h._4e_name(f[0].lastChild)=="br"&&h._4e_remove(f[0].lastChild)}if(A){f=r.bookmark(s,t);q=new a(b[0].lastChild);if(q[0]&&q[0].nodeType==e.NODE_ELEMENT&&
q._4e_name()=="br")if(v.ie||q._4e_previous(f)||q._4e_next(f))q._4e_remove()}if(!this._.nextNode)this._.nextNode=d||b._4e_equals(z)?null:b._4e_nextSourceNode(t,null,z);return b}});m.prototype.createIterator=function(){return new n(this)}});
KISSY.Editor.add("selection",function(g){function n(u){this.document=this.document=u;this._={cache:{}};if(o.ie){var p=this.getNative().createRange();if(!p||p.item&&p.item(0).ownerDocument!=u||p.parentElement&&p.parentElement().ownerDocument!=u)this.isInvalid=l}}function t(u){u=new n(u);return!u||u.isInvalid?r:u}function s(u){var p=u.document,x=new a(p.body),y=new a(p.documentElement);if(o.ie){if(o.ie<8||document.documentMode==7)y.on("click",function(M){e._4e_name(M.target)==="html"&&u.getSelection().getRanges()[0].select()});
var B,j,w=1;y.on("mousedown",function(){w=0});y.on("mouseup",function(){w=1});x.on("focusin",function(M){if(e._4e_name(M.target)=="body")if(B){try{w&&B.select()}catch(N){}B=r}});x.on("focus",function(){j=l;E()});x.on("beforedeactivate",function(M){if(!M.relatedTarget){j=v;w=1}});c.on(e._4e_getWin(p),"blur",function(){p&&p.selection.empty()});x.on("mousedown",function(){C()});x.on("mouseup",function(){j=l;setTimeout(function(){E(l)},0)});var C=function(){j=v},E=function(M){if(j){var N=u.document,Q=
u.getSelection(),U=Q&&Q.getType(),S=Q&&Q.getNative();if(M&&S&&U==h.SELECTION_NONE)if(!N.queryCommandEnabled("InsertImage")){setTimeout(function(){E(l)},50);return}var T;if(!(S&&U==h.SELECTION_TEXT&&(T=e._4e_name(S.createRange().parentElement()))&&T in{input:1,textarea:1})){B=S&&Q.getRanges()[0];u._monitor()}}};x.on("keydown",C);x.on("keyup",function(){j=l;E()});c.on(p,"selectionchange",E)}else{c.on(p,"mouseup",u._monitor,u);c.on(p,"keyup",u._monitor,u)}var D={table:1,pre:1},F=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
K=g.Walker.whitespaces(l);u.on("selectionChange",function(M){var N=M.path;M=(M=M.selection)&&M.getRanges()[0];if(!(!M||!M.collapsed||N.block))if(N.blockLimit._4e_name()=="body"){N=M.fixBlock(l,"p");if(N._4e_outerHtml().match(F)){var Q=N._4e_next(K);if(Q&&Q[0].nodeType==i.NODE_ELEMENT&&!D[Q._4e_name()]){M.moveToElementEditablePosition(Q);N._4e_remove()}else if((Q=N._4e_previous(K))&&Q[0].nodeType==i.NODE_ELEMENT&&!D[Q._4e_name()]){M.moveToElementEditablePosition(Q,Q._4e_outerHtml().match(F)?v:l);N._4e_remove()}}M.select();
o.ie||u.notifySelectionChange()}})}g.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var l=true,v=false,r=null,m=KISSY,o=m.UA,e=m.DOM,c=m.Event,a=m.Node,h=g.SELECTION,k=g.RANGE,i=g.NODE,b=g.Walker,f=g.Range,d={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};m.augment(n,{getNative:o.ie?function(){var u=this._.cache;return u.nativeSel||(u.nativeSel=this.document.selection)}:function(){var u=
this._.cache;return u.nativeSel||(u.nativeSel=e._4e_getWin(this.document).getSelection())},getType:o.ie?function(){var u=this._.cache;if(u.type)return u.type;var p=h.SELECTION_NONE;try{var x=this.getNative(),y=x.type;if(y=="Text")p=h.SELECTION_TEXT;if(y=="Control")p=h.SELECTION_ELEMENT;if(x.createRange().parentElement)p=h.SELECTION_TEXT}catch(B){}return u.type=p}:function(){var u=this._.cache;if(u.type)return u.type;var p=h.SELECTION_TEXT,x=this.getNative();if(x){if(x.rangeCount==1){x=x.getRangeAt(0);
var y=x.startContainer;if(y==x.endContainer&&y.nodeType==i.NODE_ELEMENT&&x.endOffset-x.startOffset===1&&d[y.childNodes[x.startOffset].nodeName.toLowerCase()])p=h.SELECTION_ELEMENT}}else p=h.SELECTION_NONE;return u.type=p},getRanges:o.ie?function(){var u=function(p,x){p=p.duplicate();p.collapse(x);for(var y=p.parentElement(),B=y.childNodes,j,w=0;w<B.length;w++){var C=B[w];if(C.nodeType==i.NODE_ELEMENT){j=p.duplicate();j.moveToElementText(C);C=j.compareEndPoints("StartToStart",p);var E=j.compareEndPoints("EndToStart",
p);j.collapse();if(C>0)break;else if(!C||E==1&&C==-1)return{container:y,offset:w};else if(!E)return{container:y,offset:w+1};j=r}}if(!j){j=p.duplicate();j.moveToElementText(y);j.collapse(v)}j.setEndPoint("StartToStart",p);j=j.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;j>0;)j-=B[--w].nodeValue.length}catch(D){j=0}return j===0?{container:y,offset:w}:{container:B[w],offset:-j}};return function(){var p=this._.cache;if(p.ranges)return p.ranges;var x=this.getNative(),y=x&&x.createRange(),B=this.getType();
if(!x)return[];if(B==h.SELECTION_TEXT){x=new f(this.document);B=u(y,l);x.setStart(new a(B.container),B.offset);B=u(y);x.setEnd(new a(B.container),B.offset);return p.ranges=[x]}else if(B==h.SELECTION_ELEMENT){p=p.ranges=[];for(B=0;B<y.length;B++){var j=y.item(B),w=j.parentNode,C=0;for(x=new f(this.document);C<w.childNodes.length&&w.childNodes[C]!=j;C++);x.setStart(new a(w),C);x.setEnd(new a(w),C+1);p.push(x)}return p}return p.ranges=[]}}():function(){var u=this._.cache;if(u.ranges)return u.ranges;
var p=[],x=this.getNative();if(!x)return[];for(var y=0;y<x.rangeCount;y++){var B=x.getRangeAt(y),j=new f(this.document);j.setStart(new a(B.startContainer),B.startOffset);j.setEnd(new a(B.endContainer),B.endOffset);p.push(j)}return u.ranges=p},getStartElement:function(){var u=this._.cache;if(u.startElement!==undefined)return u.startElement;var p,x=this.getNative();switch(this.getType()){case h.SELECTION_ELEMENT:return this.getSelectedElement();case h.SELECTION_TEXT:var y=this.getRanges()[0];if(y)if(!y.collapsed){for(y.optimize();l;){p=
y.startContainer;if(y.startOffset==(p[0].nodeType===i.NODE_ELEMENT?p[0].childNodes.length:p[0].nodeValue.length)&&!p._4e_isBlockBoundary())y.setStartAfter(p);else break}p=y.startContainer;if(p[0].nodeType!=i.NODE_ELEMENT)return p.parent();p=new a(p[0].childNodes[y.startOffset]);if(!p[0]||p[0].nodeType!=i.NODE_ELEMENT)return y.startContainer;for(y=p[0].firstChild;y&&y.nodeType==i.NODE_ELEMENT;){p=new a(y);y=y.firstChild}return p}if(o.ie){y=x.createRange();y.collapse(l);p=y.parentElement()}else if((p=
x.anchorNode)&&p.nodeType!=i.NODE_ELEMENT)p=p.parentNode}return u.startElement=p?e._4e_wrap(p):r},getSelectedElement:function(){var u=this,p,x=u._.cache;if(x.selectedElement!==undefined)return x.selectedElement;if(o.ie){p=u.getNative().createRange();p=p.item&&p.item(0)}p||(p=function(){for(var y=u.getRanges()[0],B,j,w=2;w&&!((B=y.getEnclosedNode())&&B[0].nodeType==i.NODE_ELEMENT&&d[B._4e_name()]&&(j=B));w--)y.shrink(k.SHRINK_ELEMENT);return j&&j[0]}());return x.selectedElement=e._4e_wrap(p)},reset:function(){this._.cache=
{}},selectElement:function(u){var p;if(o.ie)try{p=this.document.body.createControlRange();p.addElement(u[0]);p.select()}catch(x){p=this.document.body.createTextRange();p.moveToElementText(u[0]);p.select()}finally{}else{p=this.document.createRange();p.selectNode(u[0]);u=this.getNative();u.removeAllRanges();u.addRange(p)}this.reset()},selectRanges:function(u){if(o.ie){if(u.length>1){var p=u[u.length-1];u[0].setEnd(p.endContainer,p.endOffset);u.length=1}u[0]&&u[0].select()}else{p=this.getNative();if(!p)return;
p.removeAllRanges();for(var x=0;x<u.length;x++){var y=u[x],B=this.document.createRange(),j=y.startContainer;y.collapsed&&o.gecko&&o.gecko<1.09&&j[0].nodeType==i.NODE_ELEMENT&&!j[0].childNodes.length&&j[0].appendChild(this.document.createTextNode(""));B.setStart(j[0],y.startOffset);B.setEnd(y.endContainer[0],y.endOffset);p.addRange(B)}}this.reset()},createBookmarks2:function(u){for(var p=[],x=this.getRanges(),y=0;y<x.length;y++)p.push(x[y].createBookmark2(u));return p},createBookmarks:function(u,p){var x=
[],y=this.document,B;p=p||this.getRanges();for(var j=p.length,w=0;w<j;w++){x.push(B=p[w].createBookmark(u,l));var C=(u=B.serializable)?m.one("#"+B.startNode,y):B.startNode;B=u?m.one("#"+B.endNode,y):B.endNode;for(var E=w+1;E<j;E++){var D=p[E],F=D.startContainer,K=D.endContainer;e._4e_equals(F,C.parent())&&D.startOffset++;e._4e_equals(F,B.parent())&&D.startOffset++;e._4e_equals(K,C.parent())&&D.endOffset++;e._4e_equals(K,B.parent())&&D.endOffset++}}return x},selectBookmarks:function(u){for(var p=[],
x=0;x<u.length;x++){var y=new f(this.document);y.moveToBookmark(u[x]);p.push(y)}this.selectRanges(p);return this},getCommonAncestor:function(){var u=this.getRanges();return u[0].startContainer._4e_commonAncestor(u[u.length-1].endContainer)},scrollIntoView:function(){var u=this.getStartElement();u&&u._4e_scrollIntoView()},removeAllRanges:function(){var u=this.getNative();if(o.ie)u&&u.clear();else u&&u.removeAllRanges()}});var q={table:1,tbody:1,tr:1},A=b.whitespaces(l),z=/\ufeff|\u00a0/;f.prototype.select=
f.prototype.select=o.ie?function(u){var p=this.collapsed,x,y;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var B=this.startContainer[0].childNodes[this.startOffset];if(B.nodeType==i.NODE_ELEMENT){(new n(this.document)).selectElement(new a(B));return}}if(this.startContainer[0].nodeType==i.NODE_ELEMENT&&this.startContainer._4e_name()in q||this.endContainer[0].nodeType==i.NODE_ELEMENT&&this.endContainer._4e_name()in q)this.shrink(k.SHRINK_ELEMENT,l);var j=this.createBookmark();
B=j.startNode;var w;if(!p)w=j.endNode;j=this.document.body.createTextRange();j.moveToElementText(B[0]);j.moveStart("character",1);if(w){u=this.document.body.createTextRange();u.moveToElementText(w[0]);j.setEndPoint("EndToEnd",u);j.moveEnd("character",-1)}else{for(x=B[0].nextSibling;x&&!A(x);)x=x.nextSibling;x=!(x&&x.nodeValue&&x.nodeValue.match(z))&&(u||!B[0].previousSibling||B[0].previousSibling&&e._4e_name(B[0].previousSibling)=="br");y=this.document.createElement("span");y.innerHTML="&#65279;";
y=(new a(y)).insertBefore(B);x&&e.insertBefore(this.document.createTextNode("\ufeff"),B)}this.setStartBefore(B);B._4e_remove();if(p){if(x){j.moveStart("character",-1);j.select();this.document.selection.clear()}else j.select();if(y){this.moveToPosition(y,k.POSITION_BEFORE_START);y._4e_remove()}}else{this.setEndBefore(w);w._4e_remove();j.select()}}:function(){var u=this.startContainer;this.collapsed&&u[0].nodeType==i.NODE_ELEMENT&&!u[0].childNodes.length&&u[0].appendChild(this.document.createTextNode(""));
var p=this.document.createRange();p.setStart(u[0],this.startOffset);try{p.setEnd(this.endContainer[0],this.endOffset)}catch(x){if(x.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(l);p.setEnd(this.endContainer[0],this.endOffset)}else throw x;}u=t(this.document).getNative();u.removeAllRanges();u.addRange(p)};n.getSelection=t;g.Selection=n;g.Selection=n;b=n.prototype;g.Utils.extern(b,{getNative:b.getNative,getType:b.getType,getRanges:b.getRanges,getStartElement:b.getStartElement,getSelectedElement:b.getSelectedElement,
reset:b.reset,selectElement:b.selectElement,selectRanges:b.selectRanges,createBookmarks2:b.createBookmarks2,createBookmarks:b.createBookmarks,getCommonAncestor:b.getCommonAncestor,scrollIntoView:b.scrollIntoView,selectBookmarks:b.selectBookmarks,removeAllRanges:b.removeAllRanges});g.on("instanceCreated",function(u){s(u.editor)})});
KISSY.Editor.add("styles",function(g){function n(G,L){for(var I in G)G[I]=G[I].replace(T,function(H,J){return L[J]})}function t(G,L){if(L){G=x.clone(G);n(G.attributes,L);n(G.styles,L)}var I=this.element=this.element=(G.element||"*").toLowerCase();this.type=this.type=I=="#"||Q[I]?j.STYLE_BLOCK:U[I]?j.STYLE_OBJECT:j.STYLE_INLINE;this._={definition:G}}function s(G,L){var I=L?this.removeFromRange:this.applyToRange;G.body.focus();for(var H=new C(G),J=H.getRanges(),P=0;P<J.length;P++)I.call(this,J[P]);
H.selectRanges(J)}function l(G,L){var I;I=G.element;if(I=="*")I="span";I=new K(L.createElement(I));return v(I,G)}function v(G,L){var I=L._.definition,H=I.attributes;I=t.getStyleText(I);if(H)for(var J in H)G.attr(J,H[J]);if(I)G[0].style.cssText=I;return G}function r(G){var L=G.createBookmark(z),I=G.createIterator();I.enforceRealBlocks=z;I.enlargeBr=z;for(var H,J=G.document;H=I.getNextParagraph();){var P=l(this,J);H=H;var O=P;P=O._4e_name=="pre";var R=H._4e_name=="pre",Z=!P&&R;if(P&&!R){R=H;O=O;Z=R.html();
Z=m(Z,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");Z=Z.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");Z=Z.replace(/([ \t\n\r]+|&nbsp;)/g," ");Z=Z.replace(/<br\b[^>]*>/gi,"\n");if(M.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(O[0]);O[0].outerHTML="<pre>"+Z+"</pre>";O=new K(R.firstChild);O._4e_remove()}else O.html(Z);O=O}else if(Z)O=e(o(H),O);else H._4e_moveChildren(O);H[0].parentNode.replaceChild(O[0],H[0]);if(P){H=O;P=void 0;if((P=H._4e_previousSourceNode(z,E.NODE_ELEMENT))&&P._4e_name()==
"pre"){O=m(P.html(),/\n$/,"")+"\n\n"+m(H.html(),/^\n/,"");if(M.ie)H[0].outerHTML="<pre>"+O+"</pre>";else H.html(O);P._4e_remove()}}}G.moveToBookmark(L)}function m(G,L,I){var H="",J="";G=G.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(P,O,R){O&&(H=O);R&&(J=R);return""});return H+G.replace(L,I)+J}function o(G){var L=[];m(G._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(I,H,J){return H+"</pre>"+J+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(I,H){L.push(H)});return L}function e(G,L){for(var I=L[0].ownerDocument.createDocumentFragment(),H=0;H<G.length;H++){var J=G[H];J=J.replace(/(\r\n|\r)/g,"\n");J=m(J,/^[ \t]*\n/,"");J=m(J,/\n$/,"");J=m(J,/^[ \t]+|[ \t]+$/g,function(O,R){return O.length==1?"&nbsp;":R?" "+Array(O.length).join("&nbsp;"):Array(O.length).join("&nbsp;")+" "});J=J.replace(/\n/g,"<br>");J=J.replace(/[ \t]{2,}/g,function(O){return Array(O.length).join("&nbsp;")+" "});var P=L._4e_clone();P.html(J);I.appendChild(P[0])}return I}
function c(G){var L=G.document;if(G.collapsed){L=l(this,L);G.insertNode(L);G.moveToPosition(L,w.POSITION_BEFORE_END)}else{var I=this.element,H=this._.definition,J,P=g.XHTML_DTD[I]||(J=z,g.XHTML_DTD.span),O=G.createBookmark();G.enlarge(w.ENLARGE_ELEMENT);G.trim();var R=G.createBookmark(),Z=R.startNode;R=R.endNode;for(var X=Z,$;X&&X[0];){var W=u;if(B._4e_equals(X,R)){X=p;W=z}else{var Y=X[0].nodeType,ca=Y==E.NODE_ELEMENT?X._4e_name():p;if(ca&&X.attr("_ke_bookmark")){X=X._4e_nextSourceNode(z);continue}if(!ca||
P[ca]&&(X._4e_position(R)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(X))){var da=X.parent();if(da&&da[0]&&((g.XHTML_DTD[da._4e_name()]||g.XHTML_DTD.span)[I]||J)&&(!H.parentRule||H.parentRule(da))){if(!$&&(!ca||!g.XHTML_DTD.$removeEmpty[ca]||(X._4e_position(R)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED)){$=
new F(L);$.setStartBefore(X)}if(Y==E.NODE_TEXT||Y==E.NODE_ELEMENT&&!X[0].childNodes.length){Y=X;var aa;for(ca=Y._4e_next(function(fa){return!fa.attr("_ke_bookmark")});!ca&&(aa=Y.parent(),P[aa._4e_name()])&&(aa._4e_position(Z)|D.POSITION_FOLLOWING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_FOLLOWING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(aa));)Y=aa;$.setEndAfter(Y);Y[0].nextSibling||(W=z)}}else W=z}else W=z;X=X._4e_nextSourceNode()}if(W&&$&&!$.collapsed){W=
l(this,L);for(Y=$.getCommonAncestor();W&&Y&&W[0]&&Y[0];){if(Y._4e_name()==I){for(var ba in H.attributes)W.attr(ba)==Y.attr(ba)&&W[0].removeAttribute(ba);for(var ea in H.styles)W._4e_style(ea)==Y._4e_style(ea)&&W._4e_style(ea,"");if(!W._4e_hasAttributes()){W=p;break}}Y=Y.parent()}if(W){W[0].appendChild($.extractContents());d(this,W);$.insertNode(W);W._4e_mergeSiblings();M.ie||W[0].normalize()}$=p}}Z._4e_remove();R._4e_remove();G.moveToBookmark(O);G.shrink(w.SHRINK_TEXT)}}function a(G){G.enlarge(w.ENLARGE_ELEMENT);
var L=G.createBookmark(),I=L.startNode;if(G.collapsed){for(var H=new N(I.parent()),J,P=0,O;P<H.elements.length&&(O=H.elements[P]);P++){if(O==H.block||O==H.blockLimit)break;if(this.checkElementRemovable(O)){var R=G.checkBoundaryOfElement(O,w.END),Z=!R&&G.checkBoundaryOfElement(O,w.START);if(Z||R){J=O;J.match=Z?"start":"end"}else{O._4e_mergeSiblings();O._4e_name()==this.element?b(this,O):q(O,i(this)[O._4e_name()])}}}if(J&&J[0]){O=I;for(P=0;;P++){R=H.elements[P];if(B._4e_equals(R,J))break;else if(R.match)continue;
else R=R._4e_clone();R[0].appendChild(O[0]);O=R}B[J.match=="start"?"insertBefore":"insertAfter"](O,J)}}else{var X=L.endNode,$=this;H=function(){for(var W=new N(I.parent()),Y=new N(X.parent()),ca=p,da=p,aa=0;aa<W.elements.length;aa++){var ba=W.elements[aa];if(ba==W.block||ba==W.blockLimit)break;if($.checkElementRemovable(ba))ca=ba}for(aa=0;aa<Y.elements.length;aa++){ba=Y.elements[aa];if(ba==Y.block||ba==Y.blockLimit)break;if($.checkElementRemovable(ba))da=ba}da&&X._4e_breakParent(da);ca&&I._4e_breakParent(ca)};
H();for(J=new K(I[0].nextSibling);J[0]!==X[0];){P=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==E.NODE_ELEMENT&&this.checkElementRemovable(J)){J._4e_name()==this.element?b(this,J):q(J,i(this)[J._4e_name()]);if(P[0].nodeType==E.NODE_ELEMENT&&P.contains(I)){H();P=new K(I[0].nextSibling)}}J=P}}G.moveToBookmark(L)}function h(G){var L={};G.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(I,H,J){L[H]=J});return L}function k(G,L){var I;if(L!==u){I=document.createElement("span");
I.style.cssText=G;I=I.style.cssText||""}else I=G;return I.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function i(G){if(G._.overrides)return G._.overrides;var L=G._.overrides={},I=G._.definition.overrides;if(I){x.isArray(I)||(I=[I]);for(var H=0;H<I.length;H++){var J=I[H],P,O;if(typeof J=="string")P=J.toLowerCase();else{P=J.element?J.element.toLowerCase():G.element;O=J.attributes}J=L[P]||(L[P]={});if(O){J=J.attributes=J.attributes||[];for(var R in O)J.push([R.toLowerCase(),
O[R]])}}}return L}function b(G,L){var I=G._.definition,H=y.mix(I.attributes,i(G)[L._4e_name()]);I=I.styles;var J=x.isEmptyObject(H)&&x.isEmptyObject(I),P;for(P in H)if(!((P=="class"||G._.definition.fullMatch)&&L.attr(P)!=f(P,H[P]))){J=J||!!L._4e_hasAttribute(P);L.removeAttr(P)}for(var O in I)if(!(G._.definition.fullMatch&&L._4e_style(O)!=f(O,I[O],z))){J=J||!!L._4e_style(O);L._4e_style(O,"")}A(L)}function f(G,L,I){var H=new K("<span>");H[I?"_4e_style":"attr"](G,L);return H[I?"_4e_style":"attr"](G)}
function d(G,L){for(var I=i(G),H=L.all(G.element),J=H.length;--J>=0;)b(G,new K(H[J]));for(var P in I)if(P!=G.element){H=L.all(P);for(J=H.length-1;J>=0;J--){var O=new K(H[J]);q(O,I[P])}}}function q(G,L){var I=L&&L.attributes;if(I)for(var H=0;H<I.length;H++){var J=I[H][0],P;if(P=G.attr(J)){var O=I[H][1];if(O===p||O.test&&O.test(P)||typeof O=="string"&&P==O)G[0].removeAttribute(J)}}A(G)}function A(G){if(!G._4e_hasAttributes()){var L=G[0].firstChild,I=G[0].lastChild;G._4e_remove(z);if(L){L.nodeType==
E.NODE_ELEMENT&&B._4e_mergeSiblings(L);I&&L!=I&&I.nodeType==E.NODE_ELEMENT&&B._4e_mergeSiblings(I)}}}var z=true,u=false,p=null,x=KISSY,y=g.Utils,B=x.DOM,j={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},w=g.RANGE,C=g.Selection,E=g.NODE,D=g.POSITION,F=g.Range,K=x.Node,M=x.UA,N=g.ElementPath,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},U={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},S=/\s*(?:;\s*|$)/g,T=/#\((.+?)\)/g;g.STYLE=j;t.prototype={apply:function(G){s.call(this,
G,u)},remove:function(G){s.call(this,G,z)},applyToRange:function(G){return(this.applyToRange=this.type==j.STYLE_INLINE?c:this.type==j.STYLE_BLOCK?r:this.type==j.STYLE_OBJECT?p:p).call(this,G)},removeFromRange:function(G){return(this.removeFromRange=this.type==j.STYLE_INLINE?a:p).call(this,G)},applyToObject:function(G){v(G,this)},checkElementRemovable:function(G,L){if(!G)return u;var I=this._.definition;if(G._4e_name()==this.element){if(!L&&!G._4e_hasAttributes())return z;var H=I._AC;if(H)I=H;else{H=
{};var J=0,P=I.attributes;if(P)for(var O in P){J++;H[O]=P[O]}if(P=t.getStyleText(I)){H.style||J++;H.style=P}H._length=J;I=I._AC=H}if(I._length){for(var R in I)if(R!="_length"){J=G.attr(R)||"";if(R=="style")a:{H=I[R];J=k(J,u);typeof H=="string"&&(H=h(H));typeof J=="string"&&(J=h(J));P=void 0;for(P in H)if(!(P in J&&(J[P]==H[P]||H[P]=="inherit"||J[P]=="inherit"))){H=u;break a}H=z}else H=I[R]==J;if(H){if(!L)return z}else if(L)return u}if(L)return z}else return z}if(R=i(this)[G._4e_name()]){if(!(I=R.attributes))return z;
for(H=0;H<I.length;H++){R=I[H][0];if(R=G.attr(R)){J=I[H][1];if(J===p||typeof J=="string"&&R==J||J.test&&J.test(R))return z}}}return u},checkActive:function(G){switch(this.type){case j.STYLE_BLOCK:return this.checkElementRemovable(G.block||G.blockLimit,z);case j.STYLE_OBJECT:case j.STYLE_INLINE:for(var L=G.elements,I=0,H;I<L.length;I++){H=L[I];if(!(this.type==j.STYLE_INLINE&&(B._4e_equals(H,G.block)||B._4e_equals(H,G.blockLimit))))if(!(this.type==j.STYLE_OBJECT&&!(H._4e_name()in U)))if(this.checkElementRemovable(H,
z))return z}}return u}};t.getStyleText=function(G){var L=G._ST;if(L)return L;L=G.styles;var I=G.attributes&&G.attributes.style||"",H="";if(I.length)I=I.replace(S,";");for(var J in L){var P=L[J],O=(J+":"+P).replace(S,";");if(P=="inherit")H+=O;else I+=O}if(I.length)I=k(I);I+=H;return G._ST=I};g.Style=t;g.Style=t;var V=t.prototype;g.Utils.extern(V,{apply:V.apply,remove:V.remove,applyToRange:V.applyToRange,removeFromRange:V.removeFromRange,applyToObject:V.applyToObject,checkElementRemovable:V.checkElementRemovable,
checkActive:V.checkActive})});
KISSY.Editor.add("htmlparser",function(){function g(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var n=KISSY,t=function(){},s=n.Editor,l=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,v={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},r=s.XHTML_DTD;n.augment(g,{onTagOpen:t,onTagClose:t,
onText:t,onCDATA:t,onComment:t,parse:function(m){for(var o,e,c=0,a;o=this._.htmlPartsRegex.exec(m);){e=o.index;if(e>c){c=m.substring(c,e);a?a.push(c):this.onText(c)}c=this._.htmlPartsRegex.lastIndex;if(e=o[1]){e=e.toLowerCase();if(a&&r.$cdata[e]){this.onCDATA(a.join(""));a=null}if(!a){this.onTagClose(e);continue}}if(a)a.push(o[0]);else if(e=o[3]){e=e.toLowerCase();if(!/="/.test(e)){var h={},k;o=o[4];var i=!!(o&&o.charAt(o.length-1)=="/");if(o)for(;k=l.exec(o);){var b=k[1].toLowerCase();k=k[2]||k[3]||
k[4]||"";h[b]=!k&&v[b]?b:k}this.onTagOpen(e,h,i);if(!a&&r.$cdata[e])a=[]}}else if(e=o[2])this.onComment(e)}m.length>c&&this.onText(m.substring(c,m.length))}});s.HtmlParser=g;s.HtmlParser=g});
KISSY.Editor.add("htmlparser-basicwriter",function(){function g(){this._={output:[]}}var n=KISSY,t=n.Editor,s=t.Utils;n.augment(g,{openTag:function(l){this._.output.push("<",l)},openTagClose:function(l,v){v?this._.output.push(" />"):this._.output.push(">")},attribute:function(l,v){if(typeof v=="string")v=s.htmlEncodeAttr(v);this._.output.push(" ",l,'="',v,'"')},closeTag:function(l){this._.output.push("</",l,">")},text:function(l){this._.output.push(l)},comment:function(l){this._.output.push("<!--",
l,"--\>")},write:function(l){this._.output.push(l)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(l){var v=this._.output.join("");l&&this.reset();return v}});t.HtmlParser.BasicWriter=g;t.HtmlParser.BasicWriter=g;n=g.prototype;t.Utils.extern(n,{openTag:n.openTag,openTagClose:n.openTagClose,attribute:n.attribute,closeTag:n.closeTag,text:n.text,comment:n.comment,write:n.write,reset:n.reset,getHtml:n.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function g(){g.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=v;this.sortAttributes=l;this._.indent=v;this._.indentation="";this._.rules={};var r=t.XHTML_DTD,m;for(m in s.mix({},r.$nonBodyContent,r.$block,r.$listItem,r.$tableContent))this.setRules(m,{indent:l,breakBeforeOpen:l,breakAfterOpen:l,breakBeforeClose:!r[m]["#"],breakAfterClose:l});this.setRules("br",
{breakAfterOpen:l});this.setRules("title",{indent:v,breakAfterOpen:v});this.setRules("style",{indent:v,breakBeforeClose:l});this.setRules("pre",{indent:v})}var n=KISSY,t=n.Editor,s=t.Utils,l=true,v=false;n.extend(g,t.HtmlParser.BasicWriter,{openTag:function(r){var m=this._.rules[r];if(this._.indent)this.indentation();else if(m&&m.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",r)},openTagClose:function(r,m){var o=this._.rules[r];if(m)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(o&&o.indent)this._.indentation+=this.indentationChars}o&&o.breakAfterOpen&&this.lineBreak()},attribute:function(r,m){if(typeof m=="string"){this.forceSimpleAmpersand&&(m=m.replace(/&amp;/g,"&"));m=s.htmlEncodeAttr(m)}this._.output.push(" ",r,'="',m,'"')},closeTag:function(r){var m=this._.rules[r];if(m&&m.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(m&&m.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",r,">");m&&m.breakAfterClose&&this.lineBreak()},text:function(r){if(this._.indent){this.indentation();r=s.ltrim(r)}this._.output.push(r)},comment:function(r){this._.indent&&this.indentation();this._.output.push("<!--",r,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=l},indentation:function(){this._.output.push(this._.indentation);this._.indent=v},setRules:function(r,m){var o=this._.rules[r];if(o)s.mix(o,
m);else this._.rules[r]=m}});t.HtmlParser.HtmlWriter=g;t.HtmlParser.HtmlWriter=g;n=g.prototype;t.Utils.extern(n,{openTag:n.openTag,openTagClose:n.openTagClose,attribute:n.attribute,closeTag:n.closeTag,text:n.text,comment:n.comment,lineBreak:n.lineBreak,indentation:n.indentation,setRules:n.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function g(){this.children=[];this.parent=s;this._={isBlockLike:n,hasInlineStarted:t}}var n=true,t=false,s=null,l=KISSY.Editor,v={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},r=KISSY,m=l.Utils,o=l.NODE,e=l.XHTML_DTD,c=m.mix({table:1,ul:1,ol:1,dl:1},e.table,e.ul,e.ol,e.dl),a=e.$list,h=e.$listItem;g.FromHtml=function(k,i){function b(w){var C;if(z.length>0)for(var E=0;E<z.length;E++){var D=z[E],F=D.name,K=e[F],M=p.name&&e[p.name];
if((!M||M[F])&&(!w||!K||K[w]||!e[w])){if(!C){f();C=1}D=D.clone();D.parent=p;p=D;z.splice(E,1);E--}}}function f(){for(;u.length;)p.add(u.shift())}function d(w,C,E){C=C||p||A;if(i&&!C.type){var D,F;if((D=w.attributes&&(F=w.attributes._ke_real_element_type)?F:w.name)&&!(D in e.$body)&&!(D in e.$nonBodyContent)){D=p;p=C;q.onTagOpen(i,{});C=p;if(E)p=D}}if(w._.isBlockLike&&w.name!="pre"){E=w.children.length;if((D=w.children[E-1])&&D.type==o.NODE_TEXT)if(F=m.rtrim(D.value))D.value=F;else w.children.length=
E-1}C.add(w);if(w.returnPoint){p=w.returnPoint;delete w.returnPoint}}var q=new l.HtmlParser,A=new g,z=[],u=[],p=A,x=t,y;q.onTagOpen=function(w,C,E){var D=new l.HtmlParser.Element(w,C);if(D.isUnknown&&E)D.isEmpty=n;if(e.$removeEmpty[w])z.push(D);else{if(w=="pre")x=n;else if(w=="br"&&x){p.add(new l.HtmlParser.Text("\n"));return}if(w=="br")u.push(D);else{var F=p.name,K=F&&(e[F]||(p._.isBlockLike?e.div:e.span));if(K&&!D.isUnknown&&!p.isUnknown&&!K[w]){K=t;var M;if(w in a&&F in a){F=p.children;(F=F[F.length-
1])&&F.name in h||d(F=new l.HtmlParser.Element("li"),p);y=p;M=F}else if(w==F)d(p,p.parent);else{if(c[F])y||(y=p);else{d(p,p.parent,n);v[F]||z.unshift(p)}K=n}p=M?M:p.returnPoint||p.parent;if(K){q.onTagOpen.apply(this,arguments);return}}b(w);f();D.parent=p;D.returnPoint=y;y=0;if(D.isEmpty)d(D);else p=D}}};q.onTagClose=function(w){for(var C=z.length-1;C>=0;C--)if(w==z[C].name){z.splice(C,1);return}for(var E=[],D=[],F=p;F.type&&F.name!=w;){F._.isBlockLike||D.unshift(F);E.push(F);F=F.parent}if(F.type){for(C=
0;C<E.length;C++){var K=E[C];d(K,K.parent)}p=F;if(p.name=="pre")x=t;F._.isBlockLike&&f();d(F,F.parent);if(F==p)p=p.parent;z=z.concat(D)}if(w=="body")i=t};q.onText=function(w){if(!p._.hasInlineStarted&&!x){w=m.ltrim(w);if(w.length===0)return}f();b();if(i&&(!p.type||p.name=="body")&&m.trim(w))this.onTagOpen(i,{});x||(w=w.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));p.add(new l.HtmlParser.Text(w))};q.onCDATA=function(){};q.onComment=function(w){p.add(new l.HtmlParser.Comment(w))};q.parse(k);for(f();p.type;){var B=
p.parent,j=p;if(i&&(!B.type||B.name=="body")&&!e.$body[j.name]){p=B;q.onTagOpen(i,{});B=p}B.add(j);p=B}return A};r.augment(g,{add:function(k){var i=this.children.length;if(i=i>0&&this.children[i-1]||s){if(k._.isBlockLike&&i.type==o.NODE_TEXT){i.value=m.rtrim(i.value);if(i.value.length===0){this.children.pop();this.add(k);return}}i.next=k}k.previous=i;k.parent=this;this.children.push(k);this._.hasInlineStarted=k.type==o.NODE_TEXT||k.type==o.NODE_ELEMENT&&!k._.isBlockLike},writeHtml:function(k,i){var b;
this.filterChildren=this.filterChildren=function(){var f=new l.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,f,i,n);f=f.getHtml();this.children=(new g.FromHtml(f)).children;b=1};!this.name&&i&&i.onFragment(this);this.writeChildrenHtml(k,b?s:i)},writeChildrenHtml:function(k,i){for(var b=0;b<this.children.length;b++)this.children[b].writeHtml(k,i)}});l.HtmlParser.Fragment=g;l.HtmlParser.Fragment=g;g.FromHtml=g.FromHtml;r=g.prototype;l.Utils.extern(r,{add:r.add,writeHtml:r.writeHtml,writeChildrenHtml:r.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function g(v,r){this.name=v;this.attributes=r||(r={});this.children=[];var m=r._ke_real_element_type||v,o=n.XHTML_DTD;m=!!(o.$nonBodyContent[m]||o.$block[m]||o.$listItem[m]||o.$tableContent[m]||o.$nonEditable[m]||m=="br");var e=!!o.$empty[v];this.isEmpty=e;this.isUnknown=!o[v];this._={isBlockLike:m,hasInlineStarted:e||!m}}var n=KISSY.Editor,t=n.NODE,s=function(v,r){v=v[0];r=r[0];return v<r?-1:v>r?1:0};KISSY.augment(g,{type:t.NODE_ELEMENT,add:n.HtmlParser.Fragment.prototype.add,
clone:function(){return new g(this.name,this.attributes)},writeHtml:function(v,r){var m=this.attributes,o=this,e=o.name,c,a,h,k;o.filterChildren=function(){if(!k){var f=new n.HtmlParser.BasicWriter;n.HtmlParser.Fragment.prototype.writeChildrenHtml.call(o,f,r);o.children=(new n.HtmlParser.Fragment.FromHtml(f.getHtml())).children;k=1}};o.filterChildren=o.filterChildren;if(r){for(;;){if(!(e=r.onElementName(e)))return;o.name=e;if(!(o=r.onElement(o)))return;o.parent=this.parent;if(o.name==e)break;if(o.type!=
t.NODE_ELEMENT){o.writeHtml(v,r);return}e=o.name;if(!e){this.writeChildrenHtml.call(o,v,k?null:r);return}}m=o.attributes}v.openTag(e,m);for(var i=[],b=0;b<2;b++)for(c in m){a=c;h=m[c];if(b==1)i.push([c,h]);else if(r){for(;;)if(a=r.onAttributeName(c))if(a!=c){delete m[c];c=a}else break;else{delete m[c];break}if(a)if((h=r.onAttribute(o,a,h))===false)delete m[a];else m[a]=h}}v.sortAttributes&&i.sort(s);m=i.length;for(b=0;b<m;b++){c=i[b];v.attribute(c[0],c[1])}v.openTagClose(e,o.isEmpty);if(!o.isEmpty){this.writeChildrenHtml.call(o,
v,k?null:r);v.closeTag(e)}},writeChildrenHtml:function(){n.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});n.HtmlParser.Element=g;n.HtmlParser.Element=g;var l=g.prototype;n.Utils.extern(l,{type:l.type,add:l.add,clone:l.clone,writeHtml:l.writeHtml,writeChildrenHtml:l.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function g(c){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};c&&this.addRules(c,10)}function n(c,a){for(var h=0;c&&h<a.length;h++){var k=a[h];c=c.replace(k[0],k[1])}return c}function t(c,a,h){if(typeof a=="function")a=[a];var k,i;i=c.length;var b=a&&a.length;if(b){for(k=0;k<i&&c[k].pri<h;k++);for(i=b-1;i>=0;i--)if(b=a[i]){b.pri=h;c.splice(k,0,b)}}}function s(c,a,h){if(a)for(var k in a){var i=c[k];c[k]=l(i,a[k],
h);i||c.$length++}}function l(c,a,h){if(a){a.pri=h;if(c){if(c.splice)t(c,a,h);else{c=c.pri>h?[a,c]:[c,a];c.filter=v}return c}else return a.filter=a}}function v(c){for(var a=c.type||c instanceof m.HtmlParser.Fragment,h=0;h<this.length;h++){if(a)var k=c.type,i=c.name;var b=this[h].apply(window,arguments);if(b===e)return b;if(a){if(b&&(b.name!=i||b.type!=k))return b}else if(typeof b!="string")return b;b!=undefined&&(c=b)}return c}var r=KISSY,m=r.Editor,o=m.NODE,e=false;r.augment(g,{addRules:function(c,
a){if(typeof a!="number")a=10;t(this._.elementNames,c.elementNames,a);t(this._.attributeNames,c.attributeNames,a);s(this._.elements,c.elements,a);s(this._.attributes,c.attributes,a);this._.text=l(this._.text,c.text,a)||this._.text;this._.comment=l(this._.comment,c.comment,a)||this._.comment;this._.root=l(this._.root,c.root,a)||this._.root},onElementName:function(c){return n(c,this._.elementNames)},onAttributeName:function(c){return n(c,this._.attributeNames)},onText:function(c){var a=this._.text;
return a?a.filter(c):c},onComment:function(c,a){var h=this._.comment;return h?h.filter(c,a):c},onFragment:function(c){var a=this._.root;return a?a.filter(c):c},onElement:function(c){for(var a=[this._.elements["^"],this._.elements[c.name],this._.elements.$],h,k=0;k<3;k++)if(h=a[k]){h=h.filter(c,this);if(h===e)return null;if(h&&h!=c)return this.onNode(h);if(c.parent&&!c.name)break}return c},onNode:function(c){var a=c.type;return a==o.NODE_ELEMENT?this.onElement(c):a==o.NODE_TEXT?new m.HtmlParser.Text(this.onText(c.value)):
null},onAttribute:function(c,a,h){if(a=this._.attributes[a]){c=a.filter(h,c,this);if(c===e)return e;if(typeof c!="undefined")return c}return h}});m.HtmlParser.Filter=g;r=g.prototype;m.Utils.extern(r,{addRules:r.addRules,onElementName:r.onElementName,onAttributeName:r.onAttributeName,onText:r.onText,onComment:r.onComment,onFragment:r.onFragment,onElement:r.onElement,onNode:r.onNode,onAttribute:r.onAttribute});m.HtmlParser.Filter=g});
KISSY.Editor.add("htmlparser-text",function(){function g(l){this.value=l;this._={isBlockLike:s}}var n=KISSY,t=n.Editor,s=false;n.augment(g,{type:t.NODE.NODE_TEXT,writeHtml:function(l,v){var r=this.value;v&&!(r=v.onText(r,this))||l.text(r)}});t.HtmlParser.Text=g;t.HtmlParser.Text=g});
KISSY.Editor.add("htmlparser-comment",function(){function g(s){this.value=s;this._={isBlockLike:false}}var n=KISSY.Editor,t=n.NODE;n.HtmlParser.Comment=g;n.HtmlParser.Comment=g;g.prototype={constructor:g,type:t.NODE_COMMENT,writeHtml:function(s,l){var v=this.value;if(l){if(!(v=l.onComment(v,this)))return;if(typeof v!="string"){v.parent=this.parent;v.writeHtml(s,l);return}}s.comment(v)}}});
KISSY.Editor.add("bgcolor",function(g){var n=KISSY.Editor.ColorSupport,t={element:"span",styles:{"background-color":"#(color)"}};g.addPlugin(function(){new n({editor:g,styles:t,title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-bgcolor",text:"bgcolor"})})});
KISSY.Editor.add("bubbleview",function(){var g=KISSY.Editor,n=KISSY,t=n.Event,s=n.DOM;if(!g.BubbleView){var l=n.Base.create(g.Overlay,[],{init:function(){this.on("renderUI",this._renderUIBubbleView,this)},_renderUIBubbleView:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var r=this._selectedEl,m=r._4e_getOffset(document);m.top+=r.height()+5;l.superclass.show.call(this);this.set("xy",[m.left,m.top])}},{ATTRS:{focus4e:false,zIndex:{value:g.baseZIndex(g.zIndexManager.BUBBLE_VIEW)}}}),
v={};l.attach=function(r){var m=r.pluginInstance,o=r.pluginName;r=m.editor;var e=v[o];if(e){var c=e.cfg.func,a=v[o].bubble;r.on("selectionChange",function(h){h=h.path;var k=h.elements;if(h&&k)if(h=h.lastElement)if(h=c(h)){k=v[o];if(!k.bubble){k.bubble=new l;k.bubble.renderer();k.cfg.init&&k.cfg.init.call(k.bubble)}a=k.bubble;a._selectedEl=h;a._plugin=m;a.hide();a.show()}else if(a){a._selectedEl=a._plugin=null;a.hide()}});t.on(s._4e_getWin(r.document),"scroll blur",function(){a&&a.hide()});t.on(document,
"click",function(){a&&a.hide()})}};l.register=function(r){v[r.pluginName]={cfg:r}};g.BubbleView=l}});
KISSY.Editor.add("button",function(){function g(l){g.superclass.constructor.call(this,l);this._init()}var n=KISSY.Editor,t=KISSY,s=t.Node;if(!n.TripleButton){g.ON="on";g.OFF="off";g.DISABLED="disabled";g.ON_CLASS="ke-triplebutton-on";g.OFF_CLASS="ke-triplebutton-off";g.DISABLED_CLASS="ke-triplebutton-disabled";g.ATTRS={state:{value:"off"},container:{},text:{},contentCls:{},cls:{},el:{}};t.extend(g,t.Base,{_init:function(){var l=this,v=l.get("container"),r=l.get("el"),m=l.get("title"),o=l.get("text"),
e=l.get("contentCls");l.el=new s("<a class='ke-triplebutton ke-triplebutton-off' href='#' role=\"button\"></a>");var c=l.el;c._4e_unselectable();l._attachCls();if(o)c.html(o);else if(e){c.html("<span class='ke-toolbar-item "+e+"'></span>");c.one("span")._4e_unselectable()}m&&c.attr("title",m);if(r)r[0].parentNode.replaceChild(c[0],r[0]);else v&&v.append(c);c.on("click",l._action,l);l.on("afterStateChange",l._stateChange,l);if(!l.get("cls")){c.on("mousedown",function(){l.get("state")=="off"&&c.addClass("ke-triplebutton-active")});
c.on("mouseup mouseleave",function(){l.get("state")=="off"&&c.hasClass("ke-triplebutton-active")&&setTimeout(function(){c.removeClass("ke-triplebutton-active")},300)})}},_attachCls:function(){var l=this.get("cls");l&&this.el.addClass(l)},_stateChange:function(l){this["_"+l.newVal]();this._attachCls()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(l){this.fire(this.get("state")+
"Click",l);this.fire("click",l);l.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.el[0].className="ke-triplebutton ke-triplebutton-on"},_off:function(){this.el[0].className="ke-triplebutton ke-triplebutton-off"},_disabled:function(){this.el[0].className="ke-triplebutton ke-triplebutton-disabled"}});n.TripleButton=g}});
KISSY.Editor.add("clipboard",function(g){var n=KISSY,t=n.Editor,s=n.Node,l=n.UA,v=t.Range,r=t.RANGE,m=n.Event;t.Paste||function(){function o(f){this.editor=f;this._init()}function e(f){if(!(!l.ie||f.document.compatMode=="BackCompat")){var d=f.getSelection(),q;if(d.getType()==i.SELECTION_ELEMENT&&(q=d.getSelectedElement())){var A=d.getRanges()[0],z=new s(f.document.createTextNode(""));z.insertBefore(q);A.setStartBefore(z);A.setEndAfter(q);d.selectRanges([A]);setTimeout(function(){if(q.parent()){z.remove();
d.selectElement(q)}},0)}}}n.augment(o,{_init:function(){var f=this.editor;l.ie?m.on(f.document,"keydown",this._paste,this):m.on(f.document,"paste",this._paste,this);f.addCommand("copy",new k("copy"));f.addCommand("cut",new k("cut"));f.addCommand("paste",new k("paste"))},_paste:function(f){if(!(f.type==="keydown"&&!(f.keyCode===86&&(f.ctrlKey||f.metaKey)))){var d=this,q=d.editor,A=q.document;if(d._running)f.halt();else{var z=q.getSelection();f=new v(A);var u=new s(l.webkit?"<body></body>":"<div></div>",
null,A);l.webkit&&u[0].appendChild(A.createTextNode("\u00a0"));A.body.appendChild(u[0]);u.css({position:"absolute",top:z.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});u.css("left","-1000px");var p=z.createBookmarks();f.setStartAt(u,r.POSITION_AFTER_START);f.setEndAt(u,r.POSITION_BEFORE_END);f.select(true);d._running=true;setTimeout(function(){u._4e_remove();var x;u=l.webkit&&(x=u._4e_first())&&x.hasClass("Apple-style-span")?x:u;z.selectBookmarks(p);q.insertHtml(u.html());
d._running=false},0)}}}});t.Paste=o;var c=function(f,d){var q=f.document,A=new s(q.body),z=false,u=function(){z=true};A.on(d,u);(l.ie>7?q:q.selection.createRange()).execCommand(d);A.detach(d,u);return z},a=l.ie?function(f,d){return c(f,d)}:function(f,d){try{return f.document.execCommand(d)}catch(q){return false}},h={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},k=function(f){this.type=
f;this.canUndo=this.type=="cut"};k.prototype={exec:function(f){this.type=="cut"&&e(f);(f=a(f,this.type))||alert(h[this.type]);return f}};var i=t.Selection,b={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};t.on("contextmenu",function(f){var d=f.contextmenu,q=d.cfg.editor,A=d.elDom,z={copy:0,cut:0,paste:0},u;for(u in z){if(!z.hasOwnProperty(u))break;z[u]=A.one(".ke-paste-"+u);(function(p){var x=z[p];if(!x){x=(new s("<a href='#'class='ke-paste-"+p+"'>"+b[p]+"</a>")).appendTo(A);x.on("click",function(y){y.halt();if(!x.hasClass("ke-menuitem-disable")){d.hide();
setTimeout(function(){q.execCommand(p)},30)}})}z[p]=x})(u);f=z[u];(q.document.queryCommandEnabled(u)?true:false)?f.removeClass("ke-menuitem-disable"):f.addClass("ke-menuitem-disable")}})}();g.addPlugin(function(){new t.Paste(g)})});
KISSY.Editor.add("colorsupport",function(){function g(){if(!c){c="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var a=0;a<3;a++){c+="<div class='ke-color-palette'><table>";for(var h=e[a],k=h.length/8,i=0;i<k;i++){c+="<tr>";for(var b=0;b<8;b++){var f="#"+h[8*i+b];c+="<td>";c+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+f+"'></a>";c+="</td>"}c+="</tr>"}c+="</table></div>"}c+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
function n(a){n.superclass.constructor.call(this,a);this._init()}var t=KISSY.Editor,s=KISSY,l=s.Node,v=s.Event,r=t.Overlay,m=t.TripleButton,o=s.DOM;if(!t.ColorSupport){o.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var e=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],c;n.ATTRS={editor:{},styles:{},contentCls:{},text:{}};s.extend(n,s.Base,{_init:function(){var a=this.get("editor"),h=new m({container:a.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});h.on("offClick onClick",this._showColors,this);this.el=h;t.Utils.lazyRun(this,"_prepare","_real");t.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(a){var h=this.el.el;
a=a.target;var k=this.colorWin;h._4e_equals(a)||h.contains(a)||k.hide()},_selectColor:function(a){a.halt();a=a.target;if(o._4e_name(a)=="a"&&!o.hasClass(a,"ke-button")){a=new l(a);this._applyColor(a._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(a){var h=this.get("editor"),k=h.document,i=this.get("styles");h.fire("save");a?(new t.Style(i,{color:a})).apply(k):(new t.Style(i,{color:"inherit"})).remove(k);h.fire("save")},_prepare:function(){var a=this,h=document,k=a.el,i=
a.get("editor"),b;g();a.colorWin=new r({elCls:"ks-popup",content:c,focus4e:false,width:"170px",zIndex:i.baseZIndex(t.zIndexManager.POPUP_MENU)});var f=a.colorWin;f.renderer();b=f.get("contentEl");b.on("click",a._selectColor,a);a.colorPanel=b;v.on(h,"click",a._hidePanel,a);v.on(i.document,"click",a._hidePanel,a);f.on("show",k.bon,k);f.on("hide",k.boff,k);b.one(".ke-color-others").on("click",function(d){d.halt();f.hide();i.useDialog("colorsupport/dialog",function(q){q.show(a)})})},_real:function(){var a=
this.el.el,h=this.colorWin,k=parseInt(h.get("width")),i=o.viewportWidth();h.align(a,["bl","tl"],[0,2]);h.get("x")+k>i-30&&h.set("x",i-30-k);h.show()},_showColors:function(a){var h=this.colorWin;h&&h.get("visible")?h.hide():this._prepare(a)}});t.ColorSupport=n}});
KISSY.Editor.add("contextmenu",function(){function g(e){this.cfg=e;t.Utils.lazyRun(this,"_prepareShow","_realShow")}function n(e,c){for(var a=0;a<c.length;a++){var h=c[a];if(s.isFunction(h)){if(h(new l(e)))return true}else if(v.test(e,h))return true}return false}var t=KISSY.Editor,s=KISSY,l=s.Node,v=s.DOM,r=s.Event;if(!t.ContextMenu){g.ATTRS={editor:{}};var m=[];g.register=function(e){var c=new g(e),a=e.editor.document;m.push({doc:a,rules:e.rules||[],instance:c});if(!a.ke_contextmenu){a.ke_contextmenu=
1;r.on(a,"mousedown",g.hide);r.on(a,"contextmenu",function(h){g.hide.call(this);for(var k=new l(h.target);k;){var i=false;if(k._4e_name()=="body")break;for(var b=0;b<m.length;b++){var f=m[b].instance,d=m[b].rules;if(a===m[b].doc&&n(k[0],d)){h.preventDefault();i=true;setTimeout(function(){f.show(t.Utils.getXY(h.pageX,h.pageY,a,document))},30);break}}if(i)break;k=k.parent()}})}return c};g.hide=function(){for(var e=0;e<m.length;e++){var c=m[e].instance;this===m[e].doc&&c.hide()}};var o=t.Overlay;s.augment(g,
{_init:function(){var e=this,c=e.cfg,a=c.funcs;e.el=new o({content:"<div>",width:c.width,elCls:"ke-menu"});e.el.renderer();e.elDom=e.el.get("contentEl").one("div");c=e.elDom;for(var h in a){var k=new l("<a href='#'>"+h+"</a>");c[0].appendChild(k[0]);(function(i,b){i._4e_unselectable();i.on("click",function(f){e.hide();f.halt();setTimeout(b,30)})})(k,a[h])}},hide:function(){this.el&&this.el.hide()},_realShow:function(e){t.fire("contextmenu",{contextmenu:this});this.el.set("xy",[e.left,e.top]);this.el.show()},
_prepareShow:function(){this._init()},show:function(e){this._prepareShow(e)}});t.ContextMenu=g}});
KISSY.add("dd",function(g){function n(){n.superclass.constructor.apply(this,arguments);this._init()}function t(r,m,o){o=o||150;if(o===-1)return function(){r.apply(m,arguments)};var e=g.now();return function(){var c=g.now();if(c-e>o){e=c;r.apply(m,arguments)}}}var s=g.Event,l=g.DOM,v=g.Node;g.DD={};n.ATTRS={bufferTime:{value:200},activeDrag:{}};g.extend(n,g.Base,{_init:function(){this._showShimMove=t(this._move,this,30)},_move:function(r){var m=this.get("activeDrag");g.log("move");if(m){r.preventDefault();
this._clearSelection();m._move(r)}},_start:function(r){var m=this,o=m.get("bufferTime")||0;m._registerEvent();if(o)m._bufferTimer=setTimeout(function(){m._bufferStart(r)},o);else m._bufferStart(r)},_bufferStart:function(r){this.set("activeDrag",r);this._activeShim();r._start()},_end:function(r){var m=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(m){m._end(r);this.set("activeDrag",
null)}},_activeShim:function(){var r=document;this._shim=(new v("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:999999;'></div>")).appendTo(r.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:l.docHeight()});this._clearSelection()},_clearSelection:function(){g.log("_clearSelection");if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection)try{document.selection.empty()}catch(r){}},
_registerEvent:function(){var r=document;g.log("_registerEvent");s.on(r,"mouseup",this._end,this);s.on(r,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var r=document;g.log("_unregisterEvent");s.remove(r,"mousemove",this._showShimMove,this);s.remove(r,"mouseup",this._end,this)}});g.DD.DDM=new n});
KISSY.add("dd-draggable",function(g){function n(){n.superclass.constructor.apply(this,arguments);this._init()}var t=g.UA;n.ATTRS={node:{setter:function(s){return g.one(s)}},handlers:{value:[],setter:function(s){if(s)for(var l=0;l<s.length;l++)s[l]=g.one(s[l])}}};g.extend(n,g.Base,{_init:function(){var s=this.get("node"),l=this.get("handlers");if(l.length==0)l[0]=s;for(var v=0;v<l.length;v++){var r=l[v],m=r.css("cursor");if(r[0]!=s[0])if(!m||m==="auto")r.css("cursor","move")}s.on("mousedown",this._handleMouseDown,
this)},destroy:function(){for(var s=this.get("node"),l=this.get("handlers"),v=0;v<l.length;v++){var r=l[v];r.css("cursor")=="move"&&r.css("cursor","auto")}s.detach("mousedown",this._handleMouseDown,this)},_check:function(s){for(var l=this.get("handlers"),v=0;v<l.length;v++){var r=l[v];if(r.contains(s)||r[0]==s[0])return true}return false},_handleMouseDown:function(s){if(this._check(new g.Node(s.target))){t.webkit||s.preventDefault();g.DD.DDM._start(this);var l=this.get("node"),v=s.pageX;s=s.pageY;
l=l.offset();this.startMousePos={left:v,top:s};this.startNodePos=l;this._diff={left:v-l.left,top:s-l.top};this.set("diff",this._diff)}},_move:function(s){var l=this.get("diff");g.mix(s,{left:s.pageX-l.left,top:s.pageY-l.top});this.fire("drag",s)},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});g.Draggable=n},{host:"dd"});KISSY.Editor.add("dd",function(){});
KISSY.Editor.add("draft",function(g){var n=KISSY,t=n.Editor;t.Draft||function(){function s(c,a,h){for(c+="";c.length<a;)c=h+c;return c}function l(c){if(n.isNumber(c))c=new Date(c);return c instanceof Date?[c.getFullYear(),"-",s(c.getMonth()+1,2,"0"),"-",s(c.getDate(),2,"0")," ",s(c.getHours(),2,"0"),":",s(c.getMinutes(),2,"0"),":",s(c.getSeconds(),2,"0")].join(""):c}function v(c){this.editor=c;this._init()}var r=n.Node,m=n.Event,o=n.JSON,e=window[t.STORE];n.augment(v,{_init:function(){var c=this,
a=c.editor,h=a.statusDiv,k=a.cfg.pluginConfig;k.draft=k.draft||{};c.draftInterval=k.draft.interval=k.draft.interval||5;c.draftLimit=k.draft.limit=k.draft.limit||5;h=(new r("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+k.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(h);c.timeTip=(new r("<span class='ke-draft-time'>")).appendTo(h);var i=(new r("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(h),
b=new t.Select({container:h,menuContainer:document.body,doc:a.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),f=e.getItem("ke-draft-save"),d=[];c.versions=b;if(f)d=n.isString(f)?o.parse(decodeURIComponent(f)):f;c.drafts=d;c.sync();i.on("click",function(){c.save(false)});(function(){var q=a.textarea[0].form;q&&m.on(q,"submit",function(){c.save(false)})})();setInterval(function(){c.save(true)},c.draftInterval*60*1E3);b.on("click",c.recover,c);c.holder=h;if(k.draft.helpHtml){k=
new t.TripleButton({cls:"ke-draft-help",title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:h});k.on("click",function(){c._prepareHelp()});t.Utils.lazyRun(c,"_prepareHelp","_realHelp");c.helpBtn=k.el}c._holder=h},_prepareHelp:function(){var c=this,a=c.editor,h=c.helpBtn,k=new r(a.cfg.pluginConfig.draft.helpHtml||""),i=new r("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
k.append(i);k.css({border:"1px solid #ACB4BE","text-align":"left"});c._help=new n.Overlay({content:k,width:k.width()+"px",mask:false});c._help.renderer();c._help.el.css("border","none");c._help.arrow=i;m.on([document,a.document],"click",function(b){b=b.target;b==h[0]||h.contains(b)||c._help.hide()})},_realHelp:function(){var c=this._help,a=this.helpBtn,h=c.arrow;c.show();a=a.offset();c.el.offset({left:a.left-c.el.width()+17,top:a.top-c.el.height()-7});h.offset({left:a.left-2,top:a.top-8})},disable:function(){this.holder.css("visibility",
"hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var c=this.draftLimit,a=this.timeTip,h=this.versions,k=this.drafts;k.length>c&&k.splice(0,k.length-c);c=[];for(var i,b=0;b<k.length;b++){i=k[b];i=(i.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+l(i.date);c.push({name:i,value:b})}h.set("items",c.reverse());a.html(i);e.setItem("ke-draft-save",encodeURIComponent(o.stringify(k)))},save:function(c){var a=this.drafts,h=g.getData(true);if(h){if(a[a.length-1]&&h==a[a.length-1].content)a.length-=1;
this.drafts=a.concat({content:h,date:(new Date).getTime(),auto:c});this.sync()}},recover:function(c){var a=this.editor,h=this.drafts;c=c.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+l(h[c].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){a.fire("save");a.setData(h[c].content);a.fire("save")}}});t.Draft=v}();g.addPlugin(function(){t.storeReady(function(){new t.Draft(g)})})});
KISSY.Editor.add("elementpaths",function(g){var n=KISSY.Editor,t=KISSY,s=t.Node,l=t.DOM;n.ElementPaths||function(){function v(r){this.cfg=r;this._cache=[];this._init()}l.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");t.augment(v,{_init:function(){var r=this.cfg.editor;this.holder=new s("<span>");this.holder.appendTo(r.statusDiv);r.on("selectionChange",this._selectionChange,this);
n.Utils.sourceDisable(r,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(r){var m=this.cfg.editor,o=this.holder;r=r.path.elements;var e,c;e=this._cache;for(c=0;c<e.length;c++){e[c].detach("click");e[c]._4e_remove()}this._cache=[];for(c=0;c<r.length;c++){e=r[c];var a=new s("<a href='#' class='elementpath'>"+(e.attr("_ke_real_element_type")||e._4e_name())+"</a>");this._cache.push(a);(function(h){a.on("click",
function(k){k.halt();m.focus();setTimeout(function(){m.getSelection().selectElement(h)},50)})})(e);o.prepend(a)}}});n.ElementPaths=v}();g.addPlugin(function(){new n.ElementPaths({editor:g})})});
KISSY.Editor.add("enterkey",function(g){var n=KISSY.Editor,t=KISSY,s=t.UA,l=/^h[1-6]$/,v=n.XHTML_DTD,r=t.Node,m=t.Event,o=n.Walker,e=n.ElementPath;n.enterBlock||function(){function c(a){m.on(a.document,"keydown",function(h){if(h.keyCode===13)if(!h.shiftKey){a.fire("save");var k=a.execCommand("enterBlock");a.fire("save");k!==false&&h.preventDefault()}})}c.enterBlock=function(a){var h;h=a.getSelection().getRanges();for(var k=h.length-1;k>0;k--)h[k].deleteContents();h=h[0];k=h.document;if(h.checkStartOfBlock()&&
h.checkEndOfBlock()){var i=(new e(h.startContainer)).block;if(i&&(i._4e_name()=="li"||i.parent()._4e_name()=="li"))if(a.hasCommand("outdent")){a.fire("save");a.execCommand("outdent");a.fire("save");return}else return false}var b=h.splitBlock("p");if(b){a=b.previousBlock;i=b.nextBlock;var f=b.wasStartOfBlock,d=b.wasEndOfBlock,q;if(i){q=i.parent();if(q._4e_name()=="li"){i._4e_breakParent(q);i._4e_move(i._4e_next(),true)}}else if(a&&(q=a.parent())&&q._4e_name()=="li"){a._4e_breakParent(q);h.moveToElementEditablePosition(a._4e_next());
a._4e_move(a._4e_previous())}if(!f&&!d){if(i._4e_name()=="li"&&(q=i._4e_first(o.invisible(true)))&&t.inArray(q._4e_name(),["ul","ol"]))(s.ie?new r(k.createTextNode("\u00a0")):new r(k.createElement("br"))).insertBefore(q);i&&h.moveToElementEditablePosition(i)}else{var A;if(a){if(a._4e_name()=="li"||!l.test(a._4e_name()))A=a._4e_clone()}else if(i)A=i._4e_clone();A||(A=new r("<p>",null,k));if(q=b.elementPath){b=0;for(var z=q.elements.length;b<z;b++){var u=q.elements[b];if(u._4e_equals(q.block)||u._4e_equals(q.blockLimit))break;
if(v.$removeEmpty[u._4e_name()]){u=u._4e_clone();A._4e_moveChildren(u);A.append(u)}}}s.ie||A._4e_appendBogus();h.insertNode(A);if(s.ie&&f&&(!d||!a[0].childNodes.length)){h.moveToElementEditablePosition(d?a:A);h.select()}h.moveToElementEditablePosition(f&&!d?i:A)}if(!s.ie)if(i){A=new r(k.createElement("span"));A.html("&nbsp;");h.insertNode(A);A._4e_scrollIntoView();h.deleteContents()}else A._4e_scrollIntoView();h.select()}};n.EnterKey=c}();g.addPlugin(function(){g.addCommand("enterBlock",{exec:n.EnterKey.enterBlock});
n.EnterKey(g)})});
KISSY.Editor.add("fakeobjects",function(g){var n=KISSY.Editor,t=KISSY,s=t.Node,l=n.NODE,v=n.Config.base+"theme/spacer.gif",r=n.HtmlParser;n=t.Editor;var m=(g=g.htmlDataProcessor)&&g.htmlFilter,o={elements:{$:function(e){var c=e.attributes;if((c=(c=(c=c&&c._ke_realelement)&&new r.Fragment.FromHtml(decodeURIComponent(c)))&&c.children[0])&&e.attributes._ke_resizable){var a=e.attributes.style;if(a){var h=/(?:^|\s)width\s*:\s*(\d+)/i.exec(a);e=h&&h[1];a=(h=/(?:^|\s)height\s*:\s*(\d+)/i.exec(a))&&h[1];
if(e)c.attributes.width=e;if(a)c.attributes.height=a}}return c}}};m&&m.addRules(o);g&&t.mix(g,{createFakeParserElement:function(e,c,a,h,k){var i;i=new r.BasicWriter;e.writeHtml(i);i=i.getHtml();var b=e.attributes.style;if(e.attributes.width)b="width:"+e.attributes.width+"px;"+b;if(e.attributes.height)b="height:"+e.attributes.height+"px;"+b;e={"class":c,src:v,_ke_realelement:encodeURIComponent(i),_ke_real_node_type:e.type,style:b,align:e.attributes.align||""};k&&delete k.width;k&&delete k.height;k&&
t.mix(e,k,false);if(a)e._ke_real_element_type=a;if(h)e._ke_resizable=h;return new r.Element("img",e)}});t.augment(n,{createFakeElement:function(e,c,a,h,k,i){var b=e.attr("style")||"";if(e.attr("width"))b="width:"+e.attr("width")+"px;"+b;if(e.attr("height"))b="height:"+e.attr("height")+"px;"+b;e={"class":c,src:v,_ke_realelement:encodeURIComponent(k||e._4e_outerHtml()),_ke_real_node_type:e[0].nodeType,style:b};i&&delete i.width;i&&delete i.height;i&&t.mix(e,i,false);if(a)e._ke_real_element_type=a;if(h)e._ke_resizable=
h;return new s("<img/>",e,this.document)},restoreRealElement:function(e){if(e.attr("_ke_real_node_type")!=l.NODE_ELEMENT)return null;e=decodeURIComponent(e.attr("_ke_realelement"));var c=new s("<div>",null,this.document);c.html(e);return c._4e_first(function(a){return a[0].nodeType==l.NODE_ELEMENT})._4e_remove()}})});KISSY.Editor.add("flash",function(g){g.addPlugin(function(){new KISSY.Editor.Flash(g)})});
KISSY.Editor.add("flash/support",function(g){var n=KISSY.Editor,t=KISSY,s=t.UA,l=t.Event,v=n.ContextMenu,r=t.Node,m=n.BubbleView,o=n.TripleButton,e=g.htmlDataProcessor,c="ke_flash",a=n.Utils.flash,h=e&&e.dataFilter;n.Flash||function(){function k(d){this.editor=d;this._init()}function i(d){return d._4e_name()==="img"&&!!d.hasClass(c)&&d}var b=/\.swf(?:$|\?)/i;k.isFlashEmbed=function(d){d=d.attributes;return d.type=="application/x-shockwave-flash"||b.test(d.src||"")};t.augment(k,{_config:function(){this._cls=
c;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=f;this._flashRules=["img."+c]},_init:function(){this._config();var d=this.editor,q={},A=this._contextMenu;d._toolbars=d._toolbars||{};d._toolbars[this._type]=this;this.el=new o({container:d.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("offClick",this.show,this);if(A)for(var z in A)(function(u){q[u]=function(){A[u](d)}})(z);v.register({editor:d,rules:this._flashRules,width:"120px",
funcs:q});m.attach({pluginName:this._type,pluginInstance:this});l.on(d.document,"dblclick",this._dbclick,this);n.Utils.sourceDisable(d,this)},disable:function(){this.el.set("state",o.DISABLED)},enable:function(){this.el.set("state",o.OFF)},_getFlashUrl:function(d){return a.getUrl(d)},_updateTip:function(d,q){var A=this.editor.restoreRealElement(q);if(A){A=this._getFlashUrl(A);d.html(A);d.attr("href",A)}},_dbclick:function(d){var q=new r(d.target);if(q._4e_name()==="img"&&q.hasClass(this._cls)){this.show(null,
q);d.halt()}},show:function(d,q){this.editor.useDialog(this._type+"/dialog",function(A){A.show(q)})}});n.Flash=k;k.registerBubble=function(d,q,A){m.register({pluginName:d,func:A,init:function(){var z=this,u=z.get("contentEl");u.html(q+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var p=u.one(".ke-bubbleview-url"),x=u.one(".ke-bubbleview-change"),y=
u.one(".ke-bubbleview-remove");n.Utils.preventFocus(u);x.on("click",function(B){z._plugin.show(null,z._selectedEl);B.halt()});y.on("click",function(B){var j=z._plugin;if(s.webkit){var w=j.editor.getSelection().getRanges();w&&w[0]&&(w[0].collapse(true)||1)&&w[0].select()}z._selectedEl._4e_remove();z.hide();j.editor.notifySelectionChange();B.halt()});z.on("show",function(){var B=z._selectedEl;B&&z._plugin._updateTip(p,B)})}})};k.registerBubble("flash","Flash \u7f51\u5740\uff1a ",i);k.checkFlash=i;var f={"Flash\u5c5e\u6027":function(d){var q=
d.getSelection();q=q&&q.getStartElement();q=i(q);d=d._toolbars.flash;q&&d.show(null,q)}};k.CLS_FLASH=c;k.TYPE_FLASH="flash";k.Insert=function(d,q,A,z,u){q=a.createSWF(q,{attrs:A},d.document);var p=q.el;A=d.createFakeElement?d.createFakeElement(p,z||"ke_flash",u||"flash",true,q.html,A):p;return A=d.insertElement(A)}}();g.addCommand("insertFlash",{exec:function(){var k=t.makeArray(arguments);return n.Flash.Insert.apply(null,k)}});h&&h.addRules({elements:{object:function(k){var i=k.attributes;if(!(i.classid&&
String(i.classid).toLowerCase())){for(i=0;i<k.children.length;i++)if(k.children[i].name=="embed"){if(!n.Flash.isFlashEmbed(k.children[i]))break;return e.createFakeParserElement(k,c,"flash",true)}return null}return e.createFakeParserElement(k,c,"flash",true)},embed:function(k){if(!n.Flash.isFlashEmbed(k))return null;return e.createFakeParserElement(k,c,"flash",true)}}},5)});
KISSY.Editor.add("flashbridge",function(){function g(c){this._init(c)}function n(c){var a=s.isString(c)?c.match(/(\d)+/g):c;c=c;if(s.isArray(a))c=parseFloat(a[0]+"."+t(a[1],3)+t(a[2],5));return c||0}function t(c,a){for(var h=(c+"").length;h++<a;)c="0"+c;return c}var s=KISSY,l=s.Editor;if(!l.FlashBridge){var v={};s.augment(g,s.EventTarget,{_init:function(c){var a=s.guid("flashbridge-");c.flashVars=c.flashVars||{};c.attrs=c.attrs||{};c.params=c.params||{};var h=c.flashVars,k=c.params;s.mix(c.attrs,
{id:a,width:"100%",height:"100%"},false);s.mix(k,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);s.mix(h,{shareData:false,useCompression:false},false);k={YUISwfId:a,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(c.ajbridge)k={swfID:a,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};s.mix(h,k);v[a]=this;this.id=a;this.swf=l.Utils.flash.createSWFRuntime(c.movie,c);this._expose(c.methods)},_expose:function(c){for(var a=this,h=0;h<c.length;h++)(function(k){a[k]=
function(){return a._callSWF(k,s.makeArray(arguments))}})(c[h])},_callSWF:function(c,a){a=a||[];try{if(this.swf[c])return this.swf[c].apply(this.swf,a)}catch(h){var k="";if(a.length!==0)k="'"+a.join("', '")+"'";return(new Function("self","return self.swf."+c+"("+k+");"))(this)}},_eventHandler:function(c){var a=c.type;if(a==="log")s.log(c.message);else a&&this.fire(a,c)},_destroy:function(){delete v[this.id]}});g.EventHandler=function(c,a){var h=v[c];h&&setTimeout(function(){h._eventHandler.call(h,
a)},100)};l.FlashBridge=g;var r=s.UA,m,o,e=true;r.fpv=function(c){if(c||e){e=false;var a;if(navigator.plugins&&navigator.mimeTypes.length)a=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(h){}m=a?a.match(/(\d)+/g):void 0;o=n(m)}return m};r.fpvGEQ=function(c,a){e&&r.fpv(a);return!!o&&o>=n(c)}}});
KISSY.Editor.add("flashutils",function(){var g=KISSY,n=g.Editor,t=n.Utils.flash;if(!t){var s=g.DOM,l=g.Node,v=g.UA;t={getUrl:function(r){var m="",o=n.NODE;if(r._4e_name()=="object"){r=r[0].childNodes;for(var e=0;e<r.length;e++)if(r[e].nodeType==o.NODE_ELEMENT)if((s.attr(r[e],"name")||"").toLowerCase()=="movie")m=s.attr(r[e],"value");else if(s._4e_name(r[e])=="embed")m=s.attr(r[e],"src");else if(s._4e_name(r[e])=="object")m=s.attr(r[e],"data")}else if(r._4e_name()=="embed")m=r.attr("src");return m},
createSWF:function(r,m,o){var e=m.attrs||{},c=m.flashVars,a="",h="";m=m.params||{};var k="";o=o||document;g.mix(e,{wmode:"transparent"});for(var i in e)if(e.hasOwnProperty(i))a+=i+"='"+e[i]+"' ";g.mix(m,{quality:"high",movie:r,wmode:"transparent"});for(var b in m)if(m.hasOwnProperty(b))h+="<param name='"+b+"' value='"+m[b]+"'/>";if(c){for(var f in c)if(c.hasOwnProperty(f))k+="&"+f+"="+encodeURIComponent(c[f]);k=k.substring(1)}r="<object "+a+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
h+(k?'<param name="flashVars" value="'+k+'"/>':"")+"<embed "+a+" "+(k?'FlashVars="'+k+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+r+'"  type="application/x-shockwave-flash"/></object>';return{el:new l(r,null,o),html:r}},createSWFRuntime2:function(r,m,o){o=o||document;var e=(new l("<div style='width:0;height:0;overflow:hidden;'>",null,o)).appendTo(o.body);e=t.createSWF.apply(this,arguments).el.appendTo(e);v.ie||(e=e.one("object"));return e[0]},createSWFRuntime:function(r,
m,o){var e=m.attrs||{},c=m.flashVars||{},a=m.params||{},h="",k="",i="";o=o||document;e.id=e.id||g.guid("ke-runtimeflash-");for(var b in e)if(e.hasOwnProperty(b))h+=b+"='"+e[b]+"' ";for(var f in a)if(a.hasOwnProperty(f))k+="<param name='"+f+"' value='"+a[f]+"'/>";for(var d in c)if(c.hasOwnProperty(d))i+="&"+d+"="+encodeURIComponent(c[d]);i=i.substring(1);r=v.ie?"<object "+h+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+k+'<param name="movie" value="'+r+'" />'+(i?'<param name="flashVars" value="'+
i+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+r+"' "+h+">"+k+(i?'<param name="flashVars" value="'+i+'"/>':"")+"</object>";var q=m.holder;if(!q){q=(new l("<div style='"+(m.style?m.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,o)).appendTo(o.body);setTimeout(function(){q.offset({left:s.scrollLeft(),top:s.scrollTop()})},100)}q.html(r);return o.getElementById(e.id)}};n.Utils.flash=t}});
KISSY.Editor.add("font",function(g){function n(z){for(var u=[],p=0;p<z.length;p++)u.push({name:z[p],value:z[p]});return u}var t=KISSY,s=t.Editor,l=s.Style,v=s.TripleButton,r=g.cfg.pluginConfig,m=t.Node,o=r["font-size"];if(o!==false){o=o||{};t.mix(o,{items:n(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var e={},c=[],a={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(A=0;A<o.items.length;A++){var h=
o.items[A],k=h.name,i=h.attrs;h=h.value;e[h]=new l(a,{size:h});c.push({name:k,value:h,attrs:i})}r["font-size"]=o}e.inherit=new l(a,{size:"inherit"});var b=r["font-family"];if(b!==false){b=b||{};t.mix(b,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},
{name:"Arial",value:"Arial"},{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var f={},d=[],q={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]},A;r["font-family"]=b;for(A=0;A<b.items.length;A++){h=b.items[A];k=h.name;i=h.attrs||{};a=h.value;i.style=i.style||"";i.style+=";font-family:"+a;f[a]=new l(q,{family:a});d.push({name:k,value:a,attrs:i})}}f.inherit=new l(q,{family:"inherit"});s.Font||function(){function z(x){z.superclass.constructor.call(this,
x);this._init()}function u(x){u.superclass.constructor.call(this,x);this._init()}z.ATTRS={title:{},html:{},styles:{},editor:{}};var p=s.Select;t.extend(z,t.Base,{_init:function(){var x=this.get("editor"),y=x.toolBarDiv;this.get("html");this.el=new p({container:y,doc:x.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new m(document.body)});this.el.on("click",this._vChange,this);x.on("selectionChange",
this._selectionChange,this);s.Utils.sourceDisable(x,this)},disable:function(){this.el.set("state",p.DISABLED)},enable:function(){this.el.set("state",p.ENABLED)},_vChange:function(x){var y=this.get("editor"),B=x.newVal;x=x.prevVal;var j=this.get("styles");y.focus();y.fire("save");j=j[B];if(B==x){j.remove(y.document);this.el.set("value","")}else j.apply(y.document);y.fire("save")},_selectionChange:function(x){this.get("editor");x=x.path.elements;for(var y=this.get("styles"),B=0,j;B<x.length;B++){j=
x[B];for(var w in y)if(y[w].checkElementRemovable(j,true)){this.el.set("value",w);return}}this.el.reset("value")}});u.ATTRS={editor:{},text:{},contentCls:{},title:{},style:{}};t.extend(u,t.Base,{_init:function(){var x=this.get("editor"),y=this.get("text");this.get("style");var B=this.get("title");this.el=new v({text:y,title:B,contentCls:this.get("contentCls"),container:x.toolBarDiv});this.el.on("offClick",this._on,this);this.el.on("onClick",this._off,this);x.on("selectionChange",this._selectionChange,
this);s.Utils.sourceDisable(x,this)},disable:function(){this.el.set("state",v.DISABLED)},enable:function(){this.el.set("state",v.OFF)},_on:function(){var x=this.get("editor");this.get("text");var y=this.get("style");this.get("title");x.fire("save");y.apply(x.document);x.fire("save");x.notifySelectionChange();x.focus()},_off:function(){var x=this.get("editor");this.get("text");var y=this.get("style");this.get("title");x.fire("save");y.remove(x.document);x.fire("save");x.notifySelectionChange();x.focus()},
_selectionChange:function(x){this.get("editor");this.get("text");var y=this.get("style");this.get("title");var B=this.el;x=x.path;if(B.get("state")!=v.DISABLED)y.checkActive(x)?B.set("state",v.ON):B.set("state",v.OFF)}});z.SingleFont=u;s.Font=z}();g.addPlugin(function(){false!==r["font-size"]&&new s.Font({editor:g,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:o.width,styles:e,html:c});false!==r["font-family"]&&new s.Font({editor:g,title:"\u5b57\u4f53",width:"110px",popUpWidth:b.width,styles:f,html:d});
false!==r["font-bold"]&&new s.Font.SingleFont({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",editor:g,style:new l({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})});false!==r["font-italic"]&&new s.Font.SingleFont({contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 ",editor:g,style:new l({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})});false!==r["font-underline"]&&new s.Font.SingleFont({contentCls:"ke-toolbar-underline",
title:"\u4e0b\u5212\u7ebf ",editor:g,style:new l({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})});false!==r["font-strikeThrough"]&&new s.Font.SingleFont({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",editor:g,style:new l({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})})})});
KISSY.Editor.add("forecolor",function(g){var n=KISSY.Editor.ColorSupport,t={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]};g.addPlugin(function(){new n({editor:g,styles:t,title:"\u6587\u672c\u989c\u8272",contentCls:"ke-toolbar-color",text:"color"})})});
KISSY.Editor.add("format",function(g){var n=KISSY.Editor,t=KISSY,s=t.Node,l=[],v={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},r={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},m={},o=n.Style,e;for(e in v)if(v[e]){m[v[e]]=new o({element:v[e]});l.push({name:e,value:v[e],attrs:{style:"font-size:"+r[v[e]]}})}n.Format||function(){function c(h){c.superclass.constructor.call(this,h);this._init()}c.ATTRS={editor:{}};var a=n.Select;t.extend(c,t.Base,
{_init:function(){var h=this.get("editor");this.el=new a({container:h.toolBarDiv,value:"",doc:h.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new s(document.body)});this.el.on("click",this._vChange,this);h.on("selectionChange",this._selectionChange,this);n.Utils.sourceDisable(h,this)},disable:function(){this.el.set("state",a.DISABLED)},enable:function(){this.el.set("state",a.ENABLED)},_vChange:function(h){var k=this.get("editor"),
i=h.newVal;h=h.prevVal;k.fire("save");if(i!=h)m[i].apply(k.document);else{m.p.apply(k.document);this.el.set("value","p")}k.fire("save")},_selectionChange:function(h){this.get("editor");h=h.path;for(var k in m)if(m[k].checkActive(h)){this.el.set("value",k);return}this.el.reset("value")}});n.Format=c}();g.addPlugin(function(){new n.Format({editor:g,html:l,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(g){var n=n,t=KISSY,s=t.Editor,l=t.Node,v=t.UA,r=s.NODE,m=s.HtmlParser,o=new m.Filter,e=new m.Filter,c=s.XHTML_DTD;if(!g.htmlDataProcessor){(function(){var a=s.HtmlParser.Fragment.prototype,h=s.HtmlParser.Element.prototype;a.onlyChild=h.onlyChild=function(){var k=this.children;return k.length==1&&k[0]||null};h.removeAnyChildWithName=function(k){for(var i=this.children,b=[],f,d=0;d<i.length;d++){f=i[d];if(f.name){if(f.name==k){b.push(f);i.splice(d--,1)}b=
b.concat(f.removeAnyChildWithName(k))}}return b};h.getAncestor=function(k){for(var i=this.parent;i&&!(i.name&&i.name.match(k));)i=i.parent;return i};a.firstChild=h.firstChild=function(k){for(var i,b=0;b<this.children.length;b++){i=this.children[b];if(k(i))return i;else if(i.name)if(i=i.firstChild(k))return i}return null};h.addStyle=function(k,i,b){var f="";if(typeof i=="string")f+=k+":"+i+";";else{if(typeof k=="object")for(var d in k){if(k.hasOwnProperty(d))f+=d+":"+k[d]+";"}else f+=k;b=i}if(!this.attributes)this.attributes=
{};k=this.attributes.style||"";k=(b?[f,k]:[k,f]).join(";");this.attributes.style=k.replace(/^;|;(?=;)/,"")};c.parentOf=function(k){var i={},b;for(b in this)if(b.indexOf("$")==-1&&this[b][k])i[b]=1;return i}})();(function(){function a(p){if(/mso-list\s*:\s*Ignore/i.test(p.attributes&&p.attributes.style))return true;return n}function h(p,x){var y=new s.HtmlParser.Element("ke:listbullet"),B;if(p)if(p[2]){p=isNaN(p[1])?/^[a-z]+$/.test(p[1])?"lower-alpha":/^[A-Z]+$/.test(p[1])?"upper-alpha":"decimal":
"decimal";B="ol"}else{p=/[l\u00B7\u2002]/.test(p[1])?"disc":/[\u006F\u00D8]/.test(p[1])?"circle":/[\u006E\u25C6]/.test(p[1])?"square":"disc";B="ul"}else{p="decimal";B="ol"}y.attributes={"ke:listtype":B,style:"list-style-type:"+p+";"};y.add(new s.HtmlParser.Text(x));return y}function k(p){var x=p.attributes,y;if((y=p.removeAnyChildWithName("ke:listbullet"))&&y.length&&(y=y[0])){p.name="ke:li";if(x.style)x.style=i([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");
B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!d&&q&&B>q)d=B-q;x["ke:margin"]=q=B}]],n)(x.style,p)||"";y=y.attributes;p.addStyle(y.style);t.mix(x,y);return true}return false}function i(p,x){return function(y,B){var j=[];y.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(C,E,D){E=E.toLowerCase();E=="font-family"&&(D=D.replace(/["']/g,""));for(var F,K,M,N=0;N<p.length;N++)if(p[N]){C=p[N][0];F=p[N][1];K=p[N][2];M=p[N][3];if(E.match(C)&&(!F||D.match(F))){E=M||E;x&&(K=K||D);if(typeof K==
"function")K=K(D,B,E);if(K&&K.push){E=K[0];K=K[1]}typeof K=="string"&&j.push([E,K]);return}}!x&&j.push([E,D])});for(var w=0;w<j.length;w++)j[w]=j[w].join(":");return j.length?j.join(";")+";":false}}function b(p){p=p.children;for(var x,y,B,j,w,C,E,D=0;D<p.length;D++){x=p[D];if("ke:li"==x.name){x.name="li";x=x;y=x.attributes;B=x.attributes["ke:listtype"];j=parseInt(y["ke:indent"],10)||d&&Math.ceil(y["ke:margin"]/d)||1;y.style&&(y.style=i([["list-style-type",B=="ol"?"decimal":"disc"]],n)(y.style)||"");
if(C){if(j>E){C=new s.HtmlParser.Element(B);C.add(x);w.add(C)}else{if(j<E){w=E-j;for(var F;w--&&(F=C.parent);)C=F.parent}C.add(x)}p.splice(D--,1)}else{C=new s.HtmlParser.Element(B);C.add(x);p[D]=C}w=x;E=j}else C=null}d=0}var f=i([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],n),d,q=0,A=c.parentOf("ol"),z={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(p){p.filterChildren();
b(p)},elements:{font:function(p){delete p.name},p:function(p){p.filterChildren();if(k(p))return n},$:function(p){var x=p.name||"";x.indexOf(":")!=-1&&x.indexOf("ke")==-1&&delete p.name;var y=p.attributes.style;if(x=="span"&&(!y||!f(y)))delete p.name;if(x in A){p.filterChildren();b(p)}},span:function(p){if(!v.gecko&&a(p.parent))return false;if(!v.gecko&&a(p)){p=(p=p.firstChild(function(y){return y.value||y.name=="img"}))&&(p.value||"l.");var x=p.match(/^([^\s]+?)([.)]?)$/);return h(x,p)}},a:function(p){p=
p.attributes;if(p.href)p._ke_saved_href=p.href}},comment:!v.ie?function(p,x){var y=p.match(/<img.*?>/),B=p.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(y=B[1]||y&&"l.")&&y.match(/>([^\s]+?)([.)]?)</);return h(B,y)}if(v.gecko&&y){y=s.HtmlParser.Fragment.FromHtml(y[0]).children[0];(B=(B=(B=x.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(y.attributes.src=B);return y}return false}:function(){return false},attributes:{"class":function(p){if(/(^|\s+)ke_/.test(p))return p;
return false},style:function(p){p=f(p);if(!p)return false;return p}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},u={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(p){var x=p.parent;if(x&&x.name=="object"){var y=x.attributes.width;x=x.attributes.height;y&&(p.attributes.width=y);x&&(p.attributes.height=x)}},param:function(p){p.children=[];p.isEmpty=true;return p},a:function(p){if(!(p.children.length||p.attributes.name))return false;p=p.attributes;if(p._ke_saved_href)p.href=
p._ke_saved_href},td:function(p){for(var x=p.children,y=0;y<x.length;y++)if(x[y].name=="br"){x.splice(y,1);--y}if(!p.children.length){x=new s.HtmlParser.Text("&nbsp;");p.children.push(x)}},span:function(p){if(!p.children.length)return false}},attributes:{style:function(p){if(!t.trim(p))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(v.ie)u.attributes.style=function(p){return p.toLowerCase()};o.addRules(u);e.addRules(z)})();(function(){function a(u){for(var p=u.children.length,
x=u.children[p-1];x&&x.type==r.NODE_TEXT&&!t.trim(x.value);)x=u.children[--p];return x}function h(u){var p=a(u);return!p||p.type==r.NODE_ELEMENT&&p.name=="br"||u.name=="form"&&p.name=="input"}function k(u,p){var x=u.children,y=a(u);if(y){if((p||!v.ie)&&y.type==r.NODE_ELEMENT&&y.name=="br")x.pop();y.type==r.NODE_TEXT&&f.test(y.value)&&x.pop()}}function i(u){k(u,true);if(h(u))v.ie?u.add(new s.HtmlParser.Text("\u00a0")):u.add(new s.HtmlParser.Element("br",{}))}function b(u){k(u);h(u)&&u.add(new s.HtmlParser.Text("\u00a0"))}
var f=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,d=s.XHTML_DTD,q=s.Utils.mix({},d.$block,d.$listItem,d.$tableContent),A;for(A in q)"br"in d[A]||delete q[A];delete q.pre;d={elements:{}};var z={elements:{}};for(A in q){d.elements[A]=i;z.elements[A]=b}e.addRules(d);o.addRules(z)})();(function(){o.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}})})();g.htmlDataProcessor={htmlFilter:o,dataFilter:e,toHtml:function(a,h){var k=new m.HtmlWriter;m.Fragment.FromHtml(a,h).writeHtml(k,o);return k.getHtml(true)},
toDataFormat:function(a,h){if(v.gecko)a=a.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var k=new l("<div>");k.html("a"+a);a=k.html().substr(1);k=new m.BasicWriter;var i=m.Fragment.FromHtml(a,h);k.reset();i.writeHtml(k,e);return k.getHtml(true)},toServer:function(a,h){var k=new m.BasicWriter;m.Fragment.FromHtml(a,h).writeHtml(k,o);return k.getHtml(true)}}}});
KISSY.Editor.add("image",function(g){var n=KISSY.Editor,t=KISSY,s=t.UA,l=t.Node,v=t.Event,r=n.BubbleView;n.ImageInserter||function(){function m(a){m.superclass.constructor.call(this,a);this._init()}var o=function(a){return a._4e_name()==="img"&&!/(^|\s+)ke_/.test(a[0].className)&&a},e=n.TripleButton;m.ATTRS={editor:{}};var c={"\u56fe\u7247\u5c5e\u6027":function(a){var h=a.getSelection();h=h&&h.getStartElement();h=o(h);a=a._toolbars.image;h&&a.show(null,h)}};t.extend(m,t.Base,{_init:function(){var a=this.get("editor"),
h=a.toolBarDiv,k={};this.editor=a;this.el=new e({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",container:h});this.el.on("offClick",this.show,this);v.on(a.document,"dblclick",this._dblclick,this);n.Utils.lazyRun(this,"_prepare","_real");a._toolbars=a._toolbars||{};a._toolbars.image=this;if(c){for(var i in c)(function(b){k[b]=function(){c[b](a)}})(i);n.ContextMenu.register({editor:a,rules:[o],width:"120px",funcs:k})}r.attach({pluginName:"image",pluginInstance:this});n.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},
enable:function(){this.el.boff()},_dblclick:function(a){var h=this,k=new l(a.target);if(o(k)){setTimeout(function(){h.show(null,k)},1E3);a.halt()}},_updateTip:function(a,h){var k=h.attr("src");a.html(k);a.attr("href",k)},show:function(a,h){this.get("editor").useDialog("image/dialog",function(k){k.show(h)})}});n.ImageInserter=m;(function(a,h,k){r.register({pluginName:a,func:k,init:function(){var i=this,b=i.get("contentEl");b.html(h+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var f=b.one(".ke-bubbleview-url"),d=b.one(".ke-bubbleview-change"),q=b.one(".ke-bubbleview-remove");n.Utils.preventFocus(b);d.on("click",function(A){i._plugin.show(null,i._selectedEl);A.halt()});q.on("click",function(A){var z=i._plugin;if(s.webkit){var u=z.editor.getSelection().getRanges();u&&u[0]&&(u[0].collapse(true)||1)&&u[0].select()}i._selectedEl._4e_remove();i.hide();z.editor.notifySelectionChange();A.halt()});i.on("show",function(){var A=i._selectedEl;A&&i._plugin._updateTip(f,A)})}})})("image",
"\u56fe\u7247\u7f51\u5740\uff1a ",o)}();g.addPlugin(function(){new n.ImageInserter({editor:g})})});
KISSY.Editor.add("indent",function(g){var n=KISSY.Editor,t={ol:1,ul:1},s=KISSY,l=n.Walker,v=s.DOM,r=s.Node,m=s.UA,o=n.NODE;n.Indent||function(){function e(d){this.type=d;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function c(d){return d[0].nodeType==o.NODE_ELEMENT&&d._4e_name()=="li"}function a(d,q){for(var A=d.startContainer,z=d.endContainer;A&&!A.parent()._4e_equals(q);)A=A.parent();for(;z&&!z.parent()._4e_equals(q);)z=z.parent();if(A&&z){var u=A;A=[];for(var p=
false;!p;){if(u._4e_equals(z))p=true;A.push(u);u=u.next()}if(!(A.length<1)){u=q._4e_parents(true);for(z=0;z<u.length;z++)if(t[u[z]._4e_name()]){q=u[z];break}u=this.type=="indent"?1:-1;z=A[0];p=A[A.length-1];A={};var x=n.ListUtils.listToArray(q,A),y=x[p.data("listarray_index")].indent;for(z=z.data("listarray_index");z<=p.data("listarray_index");z++){x[z].indent+=u;var B=x[z].parent;x[z].parent=new r(B[0].ownerDocument.createElement(B._4e_name()))}for(z=p.data("listarray_index")+1;z<x.length&&x[z].indent>
y;z++)x[z].indent+=u;p=n.ListUtils.arrayToList(x,A,null,"p",0);u=[];if(this.type=="outdent"){var j;if((j=q.parent())&&j._4e_name()=="li"){x=p.listNode.childNodes;var w;for(z=x.length-1;z>=0;z--)if((w=new r(x[z]))&&w._4e_name()=="li")u.push(w)}}if(p){v.insertBefore(p.listNode,q);q._4e_remove()}if(u&&u.length)for(z=0;z<u.length;z++){for(p=w=u[z];(p=p.next())&&p._4e_name()in t;){m.ie&&!w._4e_first(function(C){return i(C)&&b(C)})&&w[0].appendChild(d.document.createTextNode("\u00a0"));w[0].appendChild(p[0])}v.insertAfter(w[0],
j[0])}n.Utils.clearAllMarkers(A)}}}function h(d){var q=parseInt(d._4e_style(this.indentCssProperty),10);if(isNaN(q))q=0;q+=(this.type=="indent"?1:-1)*this.indentOffset;if(q<0)return false;q=Math.max(q,0);q=Math.ceil(q/this.indentOffset)*this.indentOffset;d.css(this.indentCssProperty,q?q+this.indentUnit:"");d[0].style.cssText===""&&d.removeAttr("style");return true}function k(d){k.superclass.constructor.call(this,d);d=this.get("editor").toolBarDiv;this.el=new f({container:d,contentCls:this.get("contentCls"),
title:this.get("title")});this.indentCommand=new e(this.get("type"));this._init()}var i=l.whitespaces(true),b=l.bookmark(false,true);s.augment(e,{exec:function(d){for(var q=(d=d.getSelection())&&d.getRanges()[0],A=q.startContainer,z=q.endContainer,u=q.getCommonAncestor();u&&!(u[0].nodeType==o.NODE_ELEMENT&&t[u._4e_name()]);)u=u.parent();if(u&&A[0].nodeType==o.NODE_ELEMENT&&A._4e_name()in t){A=new l(q);A.evaluator=c;q.startContainer=A.next()}if(u&&z[0].nodeType==o.NODE_ELEMENT&&z._4e_name()in t){A=
new l(q);A.evaluator=c;q.endContainer=A.previous()}z=d.createBookmarks(true);if(u){for(A=u._4e_first();A&&A._4e_name()!="li";)A=A.next();var p=q.startContainer;(A[0]==p[0]||A.contains(p))&&h.call(this,u)||a.call(this,q,u)}else{q=q.createIterator();q.enforceRealBlocks=true;for(q.enlargeBr=true;u=q.getNextParagraph();)h.call(this,u)}d.selectBookmarks(z)}});var f=n.TripleButton;k.ATTRS={type:{},contentCls:{},editor:{}};s.extend(k,s.Base,{_init:function(){var d=this.get("editor"),q=this.el;q.on("offClick",
this.exec,this);this.get("type")=="outdent"?d.on("selectionChange",this._selectionChange,this):q.set("state",f.OFF);n.Utils.sourceDisable(d,this)},disable:function(){this.el.set("state",f.DISABLED)},enable:function(){this.el.set("state",f.OFF)},exec:function(){var d=this.get("editor"),q=this;d.fire("save");setTimeout(function(){q.indentCommand.exec(d);d.fire("save");d.notifySelectionChange()},10)},_selectionChange:function(d){this.get("editor");this.get("type");var q=d.path,A=q.blockLimit;d=this.el;
if(q.contains(t))d.set("state",f.OFF);else(q=q.block||A)&&q._4e_style(this.indentCommand.indentCssProperty)?d.set("state",f.OFF):d.set("state",f.DISABLED)}});n.Indent=k}();g.addPlugin(function(){g.addCommand("outdent",new n.Indent({editor:g,title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-outdent",type:"outdent"}));g.addCommand("indent",new n.Indent({editor:g,title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-indent",type:"indent"}))})});
KISSY.Editor.add("justify",function(g){var n=KISSY.Editor,t=KISSY,s=n.TripleButton;n.Justify||function(){function l(r,m,o,e){this.editor=r;this.v=m;this.contentCls=e;this.title=o;this._init()}var v=/(-moz-|-webkit-|start|auto)/gi;t.augment(l,{_init:function(){var r=this.editor;this.el=new s({contentCls:this.contentCls,title:this.title,container:r.toolBarDiv});r.on("selectionChange",this._selectionChange,this);this.el.on("offClick",this._effect,this);n.Utils.sourceDisable(r,this)},disable:function(){this.el.set("state",
s.DISABLED)},enable:function(){this.el.set("state",s.OFF)},_effect:function(){var r=this.editor,m=r.getSelection(),o=this.el.get("state");if(m){var e=m.createBookmarks(),c=m.getRanges(),a,h;r.fire("save");for(var k=c.length-1;k>=0;k--){a=c[k].createIterator();for(a.enlargeBr=true;h=a.getNextParagraph();){h.removeAttr("align");o==s.OFF?h.css("text-align",this.v):h.css("text-align","")}}r.notifySelectionChange();m.selectBookmarks(e);r.fire("save")}},_selectionChange:function(r){var m=this.el;r=r.path;
r=r.block||r.blockLimit;if(!r||r._4e_name()==="body")m.set("state",s.OFF);else(r.css("text-align").replace(v,"")||"left")==this.v?m.set("state",s.ON):m.set("state",s.OFF)}});n.Justify=l}();g.addPlugin(function(){new n.Justify(g,"left","\u5de6\u5bf9\u9f50 ","ke-toolbar-alignleft");new n.Justify(g,"center","\u5c45\u4e2d\u5bf9\u9f50 ","ke-toolbar-aligncenter");new n.Justify(g,"right","\u53f3\u5bf9\u9f50 ","ke-toolbar-alignright")})});
KISSY.Editor.add("link",function(g){var n=KISSY,t=n.Editor;t.Link||function(){function s(e){this.editor=e;this._init()}function l(e){return e._4e_ascendant(function(c){return c._4e_name()==="a"&&!!c.attr("href")},true)}var v=t.TripleButton,r=t.Style,m=t.BubbleView,o={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};s.link_Style=o;s._ke_saved_href="_ke_saved_href";s.checkLink=l;m.register({pluginName:"link",func:l,init:function(){var e=
this,c=e.get("contentEl");c.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var a=c.one(".ke-bubbleview-url"),h=c.one(".ke-bubbleview-change"),k=c.one(".ke-bubbleview-remove");t.Utils.preventFocus(c);h.on("click",function(i){e._plugin.show();i.halt()});k.on("click",function(i){var b=e._plugin.editor,f=e._selectedEl;b.fire("save");var d=b.getSelection(),
q=d.getRanges()[0];if(q&&q.collapsed){q=d.createBookmarks();f._4e_remove(true);d.selectBookmarks(q)}else if(q){f=f[0];d=f.attributes;q={};for(var A=0;A<d.length;A++){var z=d[A];if(z.specified)q[z.name]=z.value}if(f.style.cssText)q.style=f.style.cssText;(new r(o,q)).remove(b.document)}b.fire("save");b.notifySelectionChange();i.halt()});e.on("show",function(){var i=e._selectedEl;if(i){i=i.attr("_ke_saved_href")||i.attr("href");a.html(i);a.attr("href",i)}})}});n.augment(s,{_init:function(){var e=this.editor;
this.el=new v({container:e.toolBarDiv,contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5 "});this.el.on("offClick",this.show,this);m.attach({pluginName:"link",pluginInstance:this});t.Utils.sourceDisable(e,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},show:function(){this.editor.useDialog("link/dialog",function(e){e.show()})}});t.Link=s}();g.addPlugin(function(){new t.Link(g)})});
KISSY.Editor.add("list",function(g){var n=KISSY.Editor,t={ol:1,ul:1},s=["ol","ul"],l=KISSY,v=n.RANGE,r=n.ElementPath,m=n.Walker,o=n.NODE,e=l.UA,c=l.Node,a=l.DOM;n.List||function(){function h(d){this.type=d}function k(d){k.superclass.constructor.call(this,d);d=this.get("editor").toolBarDiv;this.el=new f({contentCls:this.get("contentCls"),title:this.get("title"),container:d});this.listCommand=new h(this.get("type"));this.listCommand.state=this.get("status");this._init()}var i={listToArray:function(d,
q,A,z,u){if(!t[d._4e_name()])return[];z||(z=0);A||(A=[]);for(var p=0,x=d[0].childNodes.length;p<x;p++){var y=new c(d[0].childNodes[p]);if(y._4e_name()=="li"){var B={parent:d,indent:z,element:y,contents:[]};if(u)B.grandparent=u;else{B.grandparent=d.parent();if(B.grandparent&&B.grandparent._4e_name()=="li")B.grandparent=B.grandparent.parent()}q&&y._4e_setMarker(q,"listarray_index",A.length);A.push(B);for(var j=0,w=y[0].childNodes.length,C;j<w;j++){C=new c(y[0].childNodes[j]);C[0].nodeType==o.NODE_ELEMENT&&
t[C._4e_name()]?i.listToArray(C,q,A,z+1,B.grandparent):B.contents.push(C)}}}return A},arrayToList:function(d,q,A,z){A||(A=0);if(!d||d.length<A+1)return null;for(var u=d[A].parent[0].ownerDocument,p=u.createDocumentFragment(),x=null,y=A,B=Math.max(d[A].indent,0),j=null;;){var w=d[y];if(w.indent==B){if(!x||d[y].parent._4e_name()!=x._4e_name()){x=d[y].parent._4e_clone(false,true);p.appendChild(x[0])}j=x[0].appendChild(w.element._4e_clone(false,true)[0]);for(var C=0;C<w.contents.length;C++)j.appendChild(w.contents[C]._4e_clone(true,
true)[0]);y++}else if(w.indent==Math.max(B,0)+1){y=i.arrayToList(d,null,y,z);j.appendChild(y.listNode);y=y.nextIndex}else if(w.indent==-1&&!A&&w.grandparent){if(t[w.grandparent._4e_name()])j=w.element._4e_clone(false,true)[0];else if(w.grandparent._4e_name()!="td"){j=u.createElement(z);w.element._4e_copyAttributes(new c(j))}else j=u.createDocumentFragment();for(C=0;C<w.contents.length;C++){x=w.contents[C]._4e_clone(true,true);j.nodeType==o.NODE_DOCUMENT_FRAGMENT&&w.element._4e_copyAttributes(new c(x));
j.appendChild(x[0])}if(j.nodeType==o.NODE_DOCUMENT_FRAGMENT&&y!=d.length-1){j.lastChild&&j.lastChild.nodeType==o.NODE_ELEMENT&&j.lastChild.getAttribute("type")=="_moz"&&a._4e_remove(j.lastChild);a._4e_appendBogus(j)}if(j.nodeType==o.NODE_ELEMENT&&a._4e_name(j)==z&&j.firstChild){a._4e_trim(j);x=j.firstChild;if(x.nodeType==o.NODE_ELEMENT&&a._4e_isBlockBoundary(x)){x=u.createDocumentFragment();a._4e_moveChildren(j,x);j=x}}x=a._4e_name(j);if(!e.ie&&(x=="div"||x=="p"))a._4e_appendBogus(j);p.appendChild(j);
x=null;y++}else return null;if(d.length<=y||Math.max(d[y].indent,0)<B)break}if(q)for(d=new c(p.firstChild);d&&d[0];){d[0].nodeType==o.NODE_ELEMENT&&d._4e_clearMarkers(q,true);d=d._4e_nextSourceNode()}return{listNode:p,nextIndex:y}}},b=/^h[1-6]$/;h.prototype={changeListType:function(d,q,A,z){var u=i.listToArray(q.root,A),p=[];for(d=0;d<q.contents.length;d++){var x=q.contents[d];x=x._4e_ascendant("li",true);if(!(!x||!x[0]||x.data("list_item_processed"))){p.push(x);x._4e_setMarker(A,"list_item_processed",
true)}}x=new c(q.root[0].ownerDocument.createElement(this.type));for(d=0;d<p.length;d++){var y=p[d].data("listarray_index");u[y].parent=x}A=i.arrayToList(u,A,null,"p");var B;u=A.listNode.childNodes.length;for(d=0;d<u&&(B=new c(A.listNode.childNodes[d]));d++)B._4e_name()==this.type&&z.push(B);a.insertBefore(A.listNode,q.root);q.root._4e_remove()},createList:function(d,q,A){var z=q.contents;d=q.root[0].ownerDocument;var u=[];if(z.length==1&&z[0][0]===q.root[0]){var p=new c(d.createElement("div"));z[0][0].nodeType!=
o.NODE_TEXT&&z[0]._4e_moveChildren(p);z[0][0].appendChild(p[0]);z[0]=p}q=q.contents[0].parent();for(p=0;p<z.length;p++)q=q._4e_commonAncestor(z[p].parent());for(p=0;p<z.length;p++)for(var x=z[p],y;y=x.parent();){if(y[0]===q[0]){u.push(x);break}x=y}if(!(u.length<1)){z=new c(u[u.length-1][0].nextSibling);p=new c(d.createElement(this.type));for(A.push(p);u.length;){A=u.shift();x=new c(d.createElement("li"));if(b.test(A._4e_name()))x[0].appendChild(A[0]);else{A._4e_copyAttributes(x);A._4e_moveChildren(x);
A._4e_remove()}p[0].appendChild(x[0]);e.ie||x._4e_appendBogus()}z[0]?a.insertBefore(p,z):q.append(p)}},removeList:function(d,q,A){function z(C){if((j=new c(B[C?"firstChild":"lastChild"]))&&!(j[0].nodeType==o.NODE_ELEMENT&&j._4e_isBlockBoundary())&&(w=q.root[C?"_4e_previous":"_4e_next"](m.whitespaces(true)))&&!(j[0].nodeType==o.NODE_ELEMENT&&w._4e_isBlockBoundary({br:1})))a[C?"insertBefore":"insertAfter"](d.document.createElement("br"),j)}for(var u=i.listToArray(q.root,A),p=[],x=0;x<q.contents.length;x++){var y=
q.contents[x];y=y._4e_ascendant("li",true);if(!(!y||y.data("list_item_processed"))){p.push(y);y._4e_setMarker(A,"list_item_processed",true)}}y=null;for(x=0;x<p.length;x++){y=p[x].data("listarray_index");u[y].indent=-1;y=y}for(x=y+1;x<u.length;x++)if(u[x].indent>Math.max(u[x-1].indent,0)){p=u[x-1].indent+1-u[x].indent;for(y=u[x].indent;u[x]&&u[x].indent>=y;){u[x].indent+=p;x++}x--}var B=i.arrayToList(u,A,null,"p").listNode,j,w;z(true);z(undefined);a.insertBefore(B,q.root);q.root._4e_remove()},exec:function(d){var q=
d.getSelection(),A=q&&q.getRanges();if(!(!A||A.length<1)){for(var z=q.createBookmarks(true),u=[],p={};A.length>0;){var x=A.shift(),y=x.getBoundaryNodes(),B=y.startNode,j=y.endNode;B[0].nodeType==o.NODE_ELEMENT&&B._4e_name()=="td"&&x.setStartAt(y.startNode,v.POSITION_AFTER_START);j[0].nodeType==o.NODE_ELEMENT&&j._4e_name()=="td"&&x.setEndAt(y.endNode,v.POSITION_BEFORE_END);x=x.createIterator();for(x.forceBrBreak=false;y=x.getNextParagraph();)if(!y.data("list_block")){y._4e_setMarker(p,"list_block",
1);j=new r(y);var w=j.elements,C=null,E=false,D=j.blockLimit,F;for(B=w.length-1;B>=0&&(F=w[B]);B--)if(t[F._4e_name()]&&D.contains(F)){D.removeData("list_group_object");if(B=F.data("list_group_object"))B.contents.push(y);else{B={root:F,contents:[y]};u.push(B);F._4e_setMarker(p,"list_group_object",B)}E=true;break}if(!E){j=D||j.block;if(j.data("list_group_object"))j.data("list_group_object").contents.push(y);else{B={root:j,contents:[y]};j._4e_setMarker(p,"list_group_object",B);u.push(B)}}}}for(A=[];u.length>
0;){B=u.shift();if(this.state=="off")if(t[B.root._4e_name()])this.changeListType(d,B,p,A);else{n.Utils.clearAllMarkers(p);this.createList(d,B,A)}else this.state=="on"&&t[B.root._4e_name()]&&this.removeList(d,B,p)}for(B=0;B<A.length;B++){C=A[B];var K=this;(d=function(M){var N=C[M?"_4e_previous":"_4e_next"](m.whitespaces(true));if(N&&N[0]&&N._4e_name()==K.type){N._4e_remove();N._4e_moveChildren(C,M?true:false)}})();d(true)}n.Utils.clearAllMarkers(p);q.selectBookmarks(z)}}};var f=n.TripleButton;k.ATTRS=
{editor:{},type:{},contentCls:{}};l.extend(k,l.Base,{_init:function(){var d=this.get("editor");this.el.on("offClick onClick",this._change,this);d.on("selectionChange",this._selectionChange,this);n.Utils.sourceDisable(d,this)},disable:function(){this.el.set("state",f.DISABLED)},enable:function(){this.el.set("state",f.OFF)},_change:function(){var d=this.get("editor");this.get("type");var q=this.el;d.fire("save");this.listCommand.state=q.get("state");this.listCommand.exec(d);d.fire("save");d.notifySelectionChange()},
_selectionChange:function(d){this.get("editor");var q=this.get("type"),A=d.path,z;d=this.el;var u=A.blockLimit;A=A.elements;if(u){if(A)for(var p=0;p<A.length&&(z=A[p])&&z[0]!==u[0];p++){var x=l.indexOf(A[p]._4e_name(),s);if(x!==-1)if(s[x]===q){d.set("state",f.ON);return}else break}d.set("state",f.OFF)}}});n.ListUtils=i;n.List=k}();g.addPlugin(function(){new n.List({editor:g,title:"\u9879\u76ee\u5217\u8868",contentCls:"ke-toolbar-ul",type:"ul"});new n.List({editor:g,title:"\u7f16\u53f7\u5217\u8868",contentCls:"ke-toolbar-ol",type:"ol"})})});
KISSY.Editor.add("localStorage",function(){var g=KISSY,n=g.Editor,t;t=n.STORE="localStorage";if(!n.storeReady){n.storeReady=function(l){n.on("storeReady",l)};n.on("storeReady",function(){n.storeReady=function(l){l()};n.detach("storeReady")})}if(window[t])window[t]._ke||n.fire("storeReady");else{var s=n.Config.base+n.Utils.debugUrl("plugins/localStorage/swfstore.swf?rand="+ +new Date);window[t]=new n.FlashBridge({movie:s,methods:["setItem","removeItem","getValueOf"]});g.mix(window[t],{_ke:1,getItem:function(l){return this.getValueOf(l)}});
window[t].on("contentReady",function(){n.fire("storeReady")})}});
KISSY.Editor.add("maximize",function(g){var n=KISSY.Editor,t=KISSY,s=t.UA,l=t.Node,v=t.Event,r=n.TripleButton,m=t.DOM,o;if(!(s.gecko<1.92)){n.Maximize||function(){function e(c){this.editor=c;this._init()}m.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");e.init=function(){o=(new l("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>")).appendTo(document.body);e.init=null};t.augment(e,{_init:function(){var c=this.editor,a=
new r({container:c.toolBarDiv,title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"});this.el=a;a.on("offClick",this.maximize,this);a.on("onClick",this.restore,this);n.Utils.lazyRun(this,"_prepare","_real");this._toolBarDiv=c.toolBarDiv},restore:function(){var c=this,a=c.editor;c._resize&&v.remove(window,"resize",c._resize);c._saveEditorStatus();c._restoreState();c.el.boff();setTimeout(function(){c._restoreEditorStatus();a.notifySelectionChange();a.fire("restoreWindow")},30)},_restoreState:function(){var c=
document,a=this.editor,h=this._savedParents;if(h){for(var k=0;k<h.length;k++){var i=h[k];i.el.css("position",i.position)}this._savedParents=null}a.wrap.css({height:this.iframeHeight});m.css(c.body,{width:"",height:"",overflow:""});c.documentElement.style.overflow="";a.editorWrap.css({position:"static",width:this.editorWrapWidth});o.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);c=this.el.el;c.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");
c.attr("title","\u5168\u5c4f");s.ie<8&&this._toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var c=this.editor,a=[],h=c.editorWrap;this.iframeHeight=c.wrap._4e_style("height");this.editorWrapWidth=h._4e_style("width");this.scrollLeft=m.scrollLeft();this.scrollTop=m.scrollTop();window.scrollTo(0,0);for(c=h.parent();c;){h=c.css("position");if(h!="static"){a.push({el:c,position:h});c.css("position","static")}c=c.parent()}this._savedParents=a;a=this.el.el;this.el.el.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
a.attr("title","\u53d6\u6d88\u5168\u5c4f");s.ie<8&&this._toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var c=this.editor;this.savedRanges=null;if(s.gecko&&c.iframeFocus)this.savedRanges=(c=c.getSelection())&&c.getRanges()},_restoreEditorStatus:function(){var c=this.editor,a=c.getSelection(),h=this.savedRanges;c.activateGecko();h&&a&&a.selectRanges(h);if(c.iframeFocus&&a)(c=a.getStartElement())&&c[0]&&c._4e_scrollIntoView();s.ie<8&&this.el.el.one("span").css("background-image","")},_maximize:function(c){var a=
document,h=this.editor,k=h.editorWrap,i=m.viewportHeight(),b=m.viewportWidth(),f=h.statusDiv?h.statusDiv[0].offsetHeight:0,d=h.toolBarDiv[0].offsetHeight;if(s.ie)a.body.style.overflow="hidden";else m.css(a.body,{width:0,height:0,overflow:"hidden"});a.documentElement.style.overflow="hidden";k.css({position:"absolute",zIndex:h.baseZIndex(n.zIndexManager.MAXIMIZE),width:b+"px"});o.css({zIndex:h.baseZIndex(n.zIndexManager.MAXIMIZE-5),height:i+"px",width:b+"px"});k.offset({left:0,top:0});o.css({left:0,
top:0});h.wrap.css({height:i-f-d+"px"});c!==true&&arguments.callee.call(this,true)},_real:function(){var c=this,a=c.editor;c._saveEditorStatus();c._saveSate();c._maximize();c._resize=c._resize||n.Utils.buffer(c._maximize,c,100);v.on(window,"resize",c._resize);c.el.set("state",r.ON);setTimeout(function(){c._restoreEditorStatus();a.notifySelectionChange();a.fire("maximizeWindow")},30)},_prepare:function(){e.init&&e.init()},maximize:function(){this._prepare()}});n.Maximize=e}();g.addPlugin(function(){new n.Maximize(g)})}});
KISSY.Editor.add("music",function(g){var n=KISSY.Editor,t=KISSY,s=t.DOM,l=t.UA,v=t.Event,r=n.Flash,m="ke_music",o=g.htmlDataProcessor,e=o&&o.dataFilter;e&&e.addRules({elements:{object:function(c){var a=c.attributes;if(!(a.classid&&String(a.classid).toLowerCase())){for(a=0;a<c.children.length;a++)if(c.children[a].name=="embed"){if(!r.isFlashEmbed(c.children[a]))break;if(c.children[a].attributes.src.indexOf("niftyplayer.swf")!=-1)return o.createFakeParserElement(c,m,"music",true)}return null}for(a=
0;a<c.children.length;a++){var h=c.children[a];if(h.name=="param"&&h.attributes.name=="movie")if(h.attributes.value.indexOf("niftyplayer.swf")!=-1)return o.createFakeParserElement(c,m,"music",true)}},embed:function(c){if(!r.isFlashEmbed(c))return null;if(c.attributes.src.indexOf("niftyplayer.swf")!=-1)return o.createFakeParserElement(c,m,"music",true)}}},4);n.MusicInserter||function(){function c(i){c.superclass.constructor.apply(this,arguments);i.cfg.disableObjectResizing||v.on(i.document.body,l.ie?
"resizestart":"resize",function(b){s.hasClass(b.target,m)&&b.preventDefault()})}function a(i){return i._4e_name()==="img"&&!!i.hasClass(m)&&i}var h=["img."+m];t.extend(c,r,{_config:function(){this._cls=m;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";this._contextMenu=k;this._flashRules=h}});r.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",a);n.MusicInserter=c;var k={"\u97f3\u4e50\u5c5e\u6027":function(i){var b=i.getSelection();b=(b=b&&b.getStartElement())&&a(b);i=i._toolbars.music;b&&i.show(null,b)}}}();g.addPlugin(function(){new n.MusicInserter(g)})});
KISSY.add("ext-align",function(g){function n(){g.log("align init");this.on("bindUI",this._bindUIAlign,this);this.on("renderUI",this._renderUIAlign,this);this.on("syncUI",this._syncUIAlign,this)}function t(l,v){var r=v.charAt(0),m=v.charAt(1),o,e,c,a;if(l){l=g.one(l);o=l.offset();e=l[0].offsetWidth;c=l[0].offsetHeight}else{o={left:s.scrollLeft(),top:s.scrollTop()};e=s.viewportWidth();c=s.viewportHeight()}a=o.left;o=o.top;if(r==="c")o+=c/2;else if(r==="b")o+=c;if(m==="c")a+=e/2;else if(m==="r")a+=e;
return{left:a,top:o}}g.namespace("Ext");var s=g.DOM;g.mix(n,{TL:"tl",TC:"tc",TR:"tr",CL:"cl",CC:"cc",CR:"cr",BL:"bl",BC:"bc",BR:"br"});n.ATTRS={align:{}};n.prototype={_bindUIAlign:function(){g.log("_bindUIAlign")},_renderUIAlign:function(){g.log("_renderUIAlign")},_syncUIAlign:function(){g.log("_syncUIAlign")},_uiSetAlign:function(l){g.log("_uiSetAlign");g.isPlainObject(l)&&this.align(l.node,l.points,l.offset)},align:function(l,v,r){var m,o=this.get("el");r=r||[0,0];m=s.offset(o);l=t(l,v[0]);v=t(o,
v[1]);v=[v.left-l.left,v.top-l.top];this.set("xy",[m.left-v[0]+ +r[0],m.top-v[1]+ +r[1]])},center:function(l){this.set("align",{node:l,points:[n.CC,n.CC],offset:[0,0]})},__destructor:function(){g.log("align __destructor")}};g.Ext.Align=n});
KISSY.add("ext-box",function(g){function n(){g.log("box init");this.on("renderUI",this._renderUIBoxExt,this);this.on("syncUI",this._syncUIBoxExt,this);this.on("bindUI",this._bindUIBoxExt,this)}g.namespace("Ext");var t=document,s=g.Node;n.ATTRS={el:{setter:function(l){if(g.isString(l))return g.one(l)}},elCls:{},elStyle:{},width:{},height:{},html:{value:false}};n.HTML_PARSER={el:function(l){return l}};n.prototype={_syncUIBoxExt:function(){g.log("_syncUIBoxExt")},_bindUIBoxExt:function(){g.log("_bindUIBoxExt")},
_renderUIBoxExt:function(){g.log("_renderUIBoxExt");var l=this.get("render")||g.one(t.body),v=this.get("el");l=new s(l);if(!v){v=new s("<div>");l.prepend(v);this.set("el",v)}},_uiSetElCls:function(l){g.log("_uiSetElCls");l&&this.get("el").addClass(l)},_uiSetElStyle:function(l){g.log("_uiSetElStyle");l&&this.get("el").css(l)},_uiSetWidth:function(l){g.log("_uiSetWidth");l&&this.get("el").width(l)},_uiSetHeight:function(l){g.log("_uiSetHeight");l&&this.get("el").height(l)},_uiSetHtml:function(l){g.log("_uiSetHtml");
l!==false&&this.get("el").html(l)},__destructor:function(){g.log("box __destructor");var l=this.get("el");if(l){l.detach();l.remove()}}};g.Ext.Box=n});
KISSY.add("ext-overlay-close",function(g){function n(){g.log("close init");this.on("renderUI",this._rendUICloseExt,this);this.on("bindUI",this._bindUICloseExt,this);this.on("syncUI",this._syncUICloseExt,this)}g.namespace("Ext");var t=g.Node;n.ATTRS={closable:{value:true},closeBtn:{}};n.HTML_PARSER={closeBtn:".ks-ext-close"};n.prototype={_syncUICloseExt:function(){g.log("_syncUICloseExt")},_uiSetClosable:function(s){g.log("_uiSetClosable");var l=this.get("closeBtn");if(l)s?l.show():l.hide()},_rendUICloseExt:function(){g.log("_rendUICloseExt");
var s=this.get("closeBtn"),l=this.get("contentEl");if(!s&&l){s=(new t("<a href='#' class='ks-ext-close'><span class='ks-ext-close-x'>X</span></a>")).appendTo(l);this.set("closeBtn",s)}},_bindUICloseExt:function(){g.log("_bindUICloseExt");var s=this,l=s.get("closeBtn");l&&l.on("click",function(v){s.hide();v.halt()})},__destructor:function(){g.log("close-ext __destructor");var s=this.get("closeBtn");s&&s.detach()}};g.Ext.Close=n});
KISSY.add("ext-constrain",function(g){function n(){g.log("constrain init");this.on("bindUI",this._bindUIConstrain,this);this.on("renderUI",this._renderUIConstrain,this);this.on("syncUI",this._syncUIConstrain,this)}function t(l){var v=undefined;if(!l)return v;var r=this.get("el");if(l!==true){l=g.one(l);v=l.offset();g.mix(v,{maxLeft:v.left+l[0].offsetWidth-r[0].offsetWidth,maxTop:v.top+l[0].offsetHeight-r[0].offsetHeight})}else{l=document.documentElement.clientWidth;v={left:s.scrollLeft(),top:s.scrollTop()};
g.mix(v,{maxLeft:v.left+l-r[0].offsetWidth,maxTop:v.top+s.viewportHeight()-r[0].offsetHeight})}return v}g.namespace("Ext");var s=g.DOM;n.ATTRS={constrain:{value:false}};n.prototype={_bindUIConstrain:function(){g.log("_bindUIConstrain")},_renderUIConstrain:function(){g.log("_renderUIConstrain");var l=this,v=l.getDefAttrs(),r=v.x;v=v.y;var m=r.setter,o=v.setter;r.setter=function(e){var c=m&&m(e);if(c===undefined)c=e;if(!l.get("constrain"))return c;e=t.call(l,l.get("constrain"));return Math.min(Math.max(c,
e.left),e.maxLeft)};v.setter=function(e){var c=o&&o(e);if(c===undefined)c=e;if(!l.get("constrain"))return c;e=t.call(l,l.get("constrain"));return Math.min(Math.max(c,e.top),e.maxTop)};l.addAttr("x",r);l.addAttr("y",v)},_syncUIConstrain:function(){g.log("_syncUIConstrain")},__destructor:function(){g.log("constrain-ext __destructor")}};g.Ext.Constrain=n});
KISSY.add("ext-contentbox",function(g){function n(){g.log("contentbox init");this.on("renderUI",this._renderUIContentBox,this);this.on("syncUI",this._syncUIContentBox,this);this.on("bindUI",this._bindUIContentBox,this)}g.namespace("Ext");var t=g.Node;n.ATTRS={contentEl:{},content:{}};n.HTML_PARSER={contentEl:".ks-contentbox"};n.prototype={_syncUIContentBox:function(){g.log("_syncUIContentBox")},_bindUIContentBox:function(){g.log("_bindUIContentBox")},_renderUIContentBox:function(){g.log("_renderUIContentBox");
var s=this.get("contentEl"),l=this.get("el");if(!s){s=(new t("<div class='ks-contentbox'>")).appendTo(l);this.set("contentEl",s)}},_uiSetContent:function(s){g.log("_uiSetContent");s!==undefined&&this.get("contentEl").html(s)},__destructor:function(){g.log("contentbox __destructor")}};g.Ext.ContentBox=n});
KISSY.add("ext-drag",function(g){function n(){g.log("drag init");this.on("bindUI",this._bindUIDragExt,this);this.on("renderUI",this._renderUIDragExt,this);this.on("syncUIUI",this._syncUIDragExt,this)}g.namespace("Ext");n.ATTRS={handlers:{value:[]},draggable:{value:true}};n.prototype={_uiSetHandlers:function(t){g.log("_uiSetHanlders");t&&t.length>0&&this.__drag.set("handlers",t)},_syncUIDragExt:function(){g.log("_syncUIDragExt")},_renderUIDragExt:function(){g.log("_renderUIDragExt")},_bindUIDragExt:function(){g.log("_bindUIDragExt");
var t=this.get("el");this.__drag=new g.Draggable({node:t,handlers:this.get("handlers")})},_uiSetDraggable:function(t){g.log("_uiSetDraggable");var s=this.__drag;if(t){s.detach("drag");s.on("drag",this._dragExtAction,this)}else s.detach("drag")},_dragExtAction:function(t){this.set("xy",[t.left,t.top])},__destructor:function(){g.log("DragExt __destructor");var t=this.__drag;t&&t.destroy()}};g.Ext.Drag=n});
KISSY.add("ext-loading",function(g){function n(){g.log("LoadingExt init")}g.namespace("Ext");n.prototype={loading:function(){if(!this._loadingExtEl)this._loadingExtEl=(new g.Node("<div class='ks-ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'>")).appendTo(this.get("el"));this._loadingExtEl.show()},unloading:function(){var t=this._loadingExtEl;t&&t.hide()}};g.Ext.Loading=n});
KISSY.add("ext-mask",function(g){function n(){g.log("mask init");this.on("bindUI",this._bindUIMask,this);this.on("renderUI",this._renderUIMask,this);this.on("syncUI",this._syncUIMask,this)}g.namespace("Ext");var t,s=g.UA,l=0;n.ATTRS={mask:{value:false}};n.prototype={_bindUIMask:function(){g.log("_bindUIMask")},_renderUIMask:function(){g.log("_renderUIMask")},_syncUIMask:function(){g.log("_syncUIMask")},_uiSetMask:function(v){g.log("_uiSetMask");if(v){this.on("show",this._maskExtShow,this);this.on("hide",
this._maskExtHide,this)}else{this.detach("show",this._maskExtShow,this);this.detach("hide",this._maskExtHide,this)}},_maskExtShow:function(){if(!t){t=(new g.Node("<div class='ks-ext-mask'>")).prependTo(document.body);t.css({position:"absolute",left:0,top:0,width:"100%",height:g.DOM.docHeight()});s.ie==6&&t.append("<iframe style='width:100%;height:expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'>")}t.css({"z-index":this.get("zIndex")-1});l++;t.show()},_maskExtHide:function(){l--;
if(l<=0)l=0;l||t&&t.hide()},__destructor:function(){g.log("mask __destructor")}};g.Ext.Mask=n});
KISSY.add("ext-position",function(g){function n(){g.log("position init");this.on("bindUI",this._bindUIPosition,this);this.on("renderUI",this._renderUIPosition,this);this.on("syncUI",this._syncUIPosition,this)}g.namespace("Ext");var t=document,s=g.Event;n.ATTRS={x:{},y:{},xy:{setter:function(l){var v=g.makeArray(l);if(v.length){v[0]&&this.set("x",v[0]);v[1]&&this.set("y",v[1])}return l}},zIndex:{value:9999},visible:{value:undefined}};n.prototype={_syncUIPosition:function(){g.log("_syncUIPosition")},
_renderUIPosition:function(){g.log("_renderUIPosition");this.get("el").addClass("ks-ext-position");this.get("el").css("display","")},_bindUIPosition:function(){g.log("_bindUIPosition")},_uiSetZIndex:function(l){g.log("_uiSetZIndex");l!==undefined&&this.get("el").css("z-index",l)},_uiSetX:function(l){g.log("_uiSetX");l!==undefined&&this.get("el").offset({left:l})},_uiSetY:function(l){g.log("_uiSetY");l!==undefined&&this.get("el").offset({top:l})},_uiSetVisible:function(l){if(l!==undefined){g.log("_uiSetVisible");
this.get("el").css("visibility",l?"visible":"hidden");this[l?"_bindKey":"_unbindKey"]();this.fire(l?"show":"hide")}},_bindKey:function(){s.on(t,"keydown",this._esc,this)},_unbindKey:function(){s.remove(t,"keydown",this._esc,this)},_esc:function(l){l.keyCode===27&&this.hide()},move:function(l,v){if(g.isArray(l)){v=l[1];l=l[0]}this.set("xy",[l,v])},show:function(){this._firstShow()},_firstShow:function(){this.renderer();this._realShow();this._firstShow=this._realShow},_realShow:function(){this.set("visible",
true)},hide:function(){this.set("visible",false)},__destructor:function(){g.log("position __destructor")}};g.Ext.Position=n});
KISSY.add("ext-shim",function(g){function n(){g.log("shim init");this.on("renderUI",this._renderUIShimExt,this);this.on("bindUI",this._bindUIShimExt,this);this.on("syncUI",this._syncUIShimExt,this)}g.namespace("Ext");var t=g.Node;n.prototype={_syncUIShimExt:function(){g.log("_syncUIShimExt")},_bindUIShimExt:function(){g.log("_bindUIShimExt")},_renderUIShimExt:function(){g.log("_renderUIShimExt");var s=this.get("el"),l=new t("<iframe style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth);top: 0;opacity: 0;filter: alpha(opacity=0);left: 0;z-index: -1;height: expression(this.parentNode.offsetHeight);'>");
s.prepend(l)},__destructor:function(){g.log("shim __destructor")}};g.Ext.Shim=n});
KISSY.add("ext-stdmod",function(g){function n(){g.log("stdmod init");this.on("renderUI",this._renderUIStdMod,this);this.on("syncUI",this._syncUIStdMod,this);this.on("bindUI",this._bindUIStdMod,this)}g.namespace("Ext");var t=g.Node;n.ATTRS={header:{},body:{},footer:{},bodyStyle:{},headerContent:{value:false},bodyContent:{value:false},footerContent:{value:false}};n.HTML_PARSER={header:".ks-stdmod-header",body:".ks-stdmod-body",footer:".ks-stdmod-footer"};n.prototype={_bindUIStdMod:function(){g.log("_bindUIStdMod")},
_syncUIStdMod:function(){g.log("_syncUIStdMod")},_setStdModContent:function(s,l){if(l!==false)if(g.isString(l))this.get(s).html(l);else{this.get(s).html("");this.get(s).append(l)}},_uiSetBodyStyle:function(s){s!==undefined&&this.get("body").css(s)},_uiSetBodyContent:function(s){g.log("_uiSetBodyContent");this._setStdModContent("body",s)},_uiSetHeaderContent:function(s){g.log("_uiSetHeaderContent");this._setStdModContent("header",s)},_uiSetFooterContent:function(s){g.log("_uiSetFooterContent");this._setStdModContent("footer",
s)},_renderUIStdMod:function(){g.log("_renderUIStdMod");var s=this.get("contentEl"),l=this.get("header"),v=this.get("body"),r=this.get("footer");this.get("headerContent");this.get("bodyContent");this.get("footerContent");if(!l){l=(new t("<div class='ks-stdmod-header'>")).appendTo(s);this.set("header",l)}if(!v){v=(new t("<div class='ks-stdmod-body'>")).appendTo(s);this.set("body",v)}if(!r){r=(new t("<div class='ks-stdmod-footer'>")).appendTo(s);this.set("footer",r)}},__destructor:function(){g.log("stdmod __destructor")}};
g.Ext.StdMod=n});
KISSY.add("overlay",function(g){var n=g.Base.create([g.Ext.Box,g.Ext.ContentBox,g.Ext.Position,g.Ext.Loading,g.UA.ie==6?g.Ext.Shim:null,g.Ext.Align,g.Ext.Mask],{init:function(){g.log("Overlay init");this.on("bindUI",this._bindUIOverlay,this);this.on("renderUI",this._renderUIOverlay,this);this.on("syncUI",this._syncUIOverlay,this)},_renderUIOverlay:function(){g.log("_renderUIOverlay");this.get("el").addClass("ks-overlay")},_syncUIOverlay:function(){g.log("_syncUIOverlay")},_bindUIOverlay:function(){g.log("_bindUIOverlay")},destructor:function(){g.log("overlay destructor")}});
g.Overlay=n},{requires:["core"]});
KISSY.add("dialog",function(g){g.Dialog=g.Base.create(g.Overlay,[g.Ext.StdMod,g.Ext.Close,g.Ext.Drag,g.Ext.Constrain],{init:function(){g.log("dialog init");this.on("renderUI",this._rendUIDialog,this);this.on("bindUI",this._bindUIDialog,this);this.on("syncUI",this._syncUIDialog,this)},_rendUIDialog:function(){g.log("_rendUIDialog");this.get("el").addClass("ks-dialog");this.set("handlers",[this.get("header")])},_bindUIDialog:function(){g.log("_bindUIDialog")},_syncUIDialog:function(){g.log("_syncUIDialog")},destructor:function(){g.log("Dialog destructor")}})},
{host:"overlay"});
KISSY.Editor.add("ext-focus",function(){function g(){n.log("FocusExt init");this.on("renderUI",this._renderUIFocusExt,this);this.on("bindUI",this._bindUIFocusExt,this);this.on("syncUI",this._syncUIFocusExt,this)}var n=KISSY,t=n.UA,s=n.Editor,l=s.focusManager;s.namespace("Ext");g.ATTRS={focus4e:{value:true}};g.prototype={_uiSetFocus4e:function(v){if(v){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",
this._hide4FocusExt,this)}},_syncUIFocusExt:function(){n.log("_syncUIFocusExt")},_renderUIFocusExt:function(){n.log("_renderUIFocusExt")},_bindUIFocusExt:function(){this._focus4e=(new n.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var v=this._focusEditor=l.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(t.ie&&v){var r=v.document.selection.createRange();
if(r)if(r.item&&r.item(0).ownerDocument==v.document){v=document.body.createTextRange();v.moveToElementText(this.get("el")._4e_first()[0]);v.collapse(true);v.select()}}},_hide4FocusExt:function(){var v=this._focusEditor;v&&v.focus()}};s.Ext.Focus=g},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var g=KISSY,n=g.Editor;if(!n.Overlay){var t=g.Base.create(g.Overlay,[n.Ext.Focus],{init:function(){g.log("Overlay4E init");this.on("syncUI",this._syncUIOverlay4E,this)},_syncUIOverlay4E:function(){g.log("_syncUIOverlay4E");n.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:n.baseZIndex(n.zIndexManager.OVERLAY)}}}),s=g.Base.create(g.Dialog,[n.Ext.Focus],{show:function(){this.center();var v=this.get("y");if(v-g.DOM.scrollTop()>200){v=g.DOM.scrollTop()+
200;this.set("y",v)}s.superclass.show.call(this)}},{ATTRS:{constrain:{value:true},zIndex:{value:n.baseZIndex(n.zIndexManager.OVERLAY)}}});n.Overlay=t;n.Dialog=s;var l;n.Overlay.loading=function(){l||(l=new n.Overlay({x:0,focus4e:false,width:"100%",y:0,zIndex:n.baseZIndex(n.zIndexManager.LOADING),elCls:"ke-global-loading"}));l.set("height",g.DOM.docHeight());l.show();l.loading()};n.Overlay.unloading=function(){l&&l.hide()}}});
KISSY.Editor.add("pagebreak",function(g){var n=KISSY,t=n.Editor,s=g.htmlDataProcessor,l=s&&s.dataFilter,v="ke_pagebreak",r="div";l&&l.addRules({elements:{div:function(m){var o=m.attributes;var e=(o=o&&o.style)&&m.children.length==1&&m.children[0];if((e=e&&e.name=="span"&&e.attributes.style)&&/page-break-after\s*:\s*always/i.test(o)&&/display\s*:\s*none/i.test(e))return s.createFakeParserElement(m,v,r)}}});t.PageBreak||function(){function m(a){var h=new e({container:a.toolBarDiv,title:"\u5206\u9875",contentCls:"ke-toolbar-pagebreak"});
h.on("offClick",function(){var k=new o(c,null,a.document);k=a.createFakeElement?a.createFakeElement(k,v,r,true,c):k;k=(new o("<div>",null,a.document)).append(k);a.insertElement(k)});this.el=h;t.Utils.sourceDisable(a,this)}var o=n.Node,e=t.TripleButton,c='<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>';n.augment(m,{disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.OFF)}});t.PageBreak=m}();g.addPlugin(function(){new t.PageBreak(g)})});
KISSY.Editor.add("preview",function(g){var n=KISSY.Editor,t=KISSY,s=n.TripleButton;n.Preview||function(){function l(v){this.editor=v;this._init()}t.augment(l,{_init:function(){this.el=new s({container:this.editor.toolBarDiv,title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"});this.el.on("offClick",this._show,this)},_show:function(){var v=this.editor,r=640,m=420,o=80;try{var e=window.screen;r=Math.round(e.width*0.8);m=Math.round(e.height*0.7);o=Math.round(e.width*0.1)}catch(c){}v=v._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,
"<body>\n"+v.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");r=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+r+",height="+m+",left="+o);r.document.open();r.document.write(v);r.document.close();r.focus()}});n.Preview=l}();g.addPlugin(function(){new n.Preview(g)})});
KISSY.Editor.add("progressbar",function(){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var n=KISSY,t=n.Editor;if(!t.ProgressBar){var s=n.Node;n.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
g.ATTRS={container:{},width:{},height:{},progress:{value:0}};n.extend(g,n.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var l=this.get("height"),v=new s("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+l+";'></div>"),r=this.get("container");l=(new s("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(l)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(v);var m=(new s("<span class='ke-progressbar-title'>")).appendTo(v);
r&&v.appendTo(r);this.el=v;this._title=m;this._p=l;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(l){l=l.newVal;this._p.css("width",l+"%");this._title.html(l+"%")}});t.ProgressBar=g}});
KISSY.Editor.add("removeformat",function(g){function n(a){this.editor=a;this._init()}function t(a,h){for(var k=0;k<h.length;k++)a.removeAttr(h[k])}var s=KISSY.Editor,l=KISSY,v=s.RANGE,r=s.ElementPath,m=s.NODE,o=s.TripleButton,e="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s",c="class,style,lang,width,height,align,hspace,valign".split(",");e=RegExp("^(?:"+e.replace(/,/g,"|")+")$","i");l.augment(n,{_init:function(){var a=this.editor;this.el=new o({title:"\u6e05\u9664\u683c\u5f0f",
contentCls:"ke-toolbar-removeformat",container:a.toolBarDiv});this.el.on("offClick",this._remove,this);s.Utils.sourceDisable(a,this)},disable:function(){this.el.set("state",o.DISABLED)},enable:function(){this.el.set("state",o.OFF)},_remove:function(){var a=this.editor,h=e;h.lastIndex=0;var k=a.getSelection().getRanges();a.fire("save");for(var i=0,b;b=k[i];i++)if(!b.collapsed){b.enlarge(v.ENLARGE_ELEMENT);var f=b.createBookmark(),d=f.startNode,q=f.endNode,A=function(z){for(var u=new r(z),p=u.elements,
x=1,y;y=p[x];x++){if(y._4e_equals(u.block)||y._4e_equals(u.blockLimit))break;h.test(y._4e_name())&&z._4e_breakParent(y)}};A(d);A(q);for(d=d._4e_nextSourceNode(true,m.NODE_ELEMENT);d;){if(d._4e_equals(q))break;A=d._4e_nextSourceNode(false,m.NODE_ELEMENT);d._4e_name()=="img"&&d.attr("_ke_realelement")||(h.test(d._4e_name())?d._4e_remove(true):t(d,c));d=A}b.moveToBookmark(f)}a.getSelection().selectRanges(k);a.fire("save")}});g.addPlugin(function(){new n(g)})});
KISSY.Editor.add("resize",function(g){var n=KISSY,t=n.Editor,s=n.Node;t.Resizer||function(){function l(r){this.editor=r;this._init()}var v=n.Draggable;n.augment(l,{_init:function(){var r=this.editor,m=r.statusDiv,o=new s("<div class='ke-resizer'></div>"),e=r.cfg.pluginConfig.resize||{};e=e.direction||["x","y"];o.appendTo(m);r.on("maximizeWindow",function(){o.css("display","none")});r.on("restoreWindow",function(){o.css("display","")});m=new v({node:o,handlers:[o]});var c=0,a=0,h=r.wrap,k=r.editorWrap;
m.on("dragstart",function(){c=h.height();a=k.width()});m.on("drag",function(i){var b=i.pageX-this.startMousePos.left;i=i.pageY-this.startMousePos.top;n.inArray("y",e)&&h.height(c+i);n.inArray("x",e)&&k.width(a+b)})}});t.Resizer=l}();g.addPlugin(function(){new t.Resizer(g)})});
KISSY.Editor.add("select",function(){function g(m){g.superclass.constructor.call(this,m);this._init()}var n=KISSY,t=n.Node,s=n.Event,l=n.DOM,v=n.Editor;if(!v.Select){g.DISABLED=0;g.ENABLED=1;var r=v.XHTML_DTD;g.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var m=this.el.parent();m;){var o=m._4e_name();if(r[o]&&r[o].div)return m;m=m.parent()}return new t(document.body)}},state:{value:1}};g.decorate=
function(m){for(var o=m.width(),e=[],c=m.all("option"),a=0;a<c.length;a++){var h=c[a];e.push({name:l.html(h),value:l.attr(h,"value")})}return new g({width:o+"px",el:m,items:e,cls:"ke-combox",value:m.val()})};n.extend(g,n.Base,{_init:function(){var m=this.get("container"),o=this.get("el"),e=new t("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
c=this.get("title")||"",a=this.get("cls"),h=e.one(".ke-select-text"),k=e.one(".ke-select-text-inner");e.one(".ke-select-drop");this.get("value")!==undefined?k.html(this._findNameByV(this.get("value"))):k.html(c);h.css("width",this.get("width"));e._4e_unselectable();c&&e.attr("title",c);a&&e.addClass(a);if(o)o[0].parentNode.replaceChild(e[0],o[0]);else m&&e.appendTo(m);e.on("click",this._click,this);this.el=e;this.title=k;this._focusA=e.one("a.ke-select");v.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(m){var o=this.get("title")||"",e=this.get("items");if(this.get("showValue"))return m||o;for(var c=0;c<e.length;c++){var a=e[c];if(a.value==m){o=a.name;break}}return o},_valueChange:function(m){this.title.html(this._findNameByV(m.newVal))},_itemsChange:function(m){m=m.newVal;var o=this._selectList;o.html("");if(m)for(var e=0;e<m.length;e++){var c=m[e];(new t("<a class='ke-select-menu-item' href='#' data-value='"+
c.value+"'>"+c.name+"</a>",c.attrs)).appendTo(o)._4e_unselectable()}this.as=o.all("a")},val:function(m){if(m!==undefined){this.set("value",m);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var m=this,o=m.el,e=m.get("popUpWidth"),c=m._focusA,a=new v.Overlay({render:m.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:e?e:o.width(),zIndex:v.baseZIndex(v.zIndexManager.SELECT),focusMgr:false}),h=m.get("items");
a.renderer();e=a.get("contentEl").one("div");m.menu=a;s.on(window,"resize",m._resize,m);m.get("title")&&(new t("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+m.get("title")+"</div>")).appendTo(e);m._selectList=(new t("<div>")).appendTo(e);m._itemsChange({newVal:h});a.on("show",function(){c.addClass("ke-select-active")});a.on("hide",function(){c.removeClass("ke-select-active")});s.on([document,m.get("doc")],"click",function(k){o.contains(k.target)||a.hide()});e.on("click",
m._select,m);m.as=m._selectList.all("a");s.on(e[0],"mouseenter",function(){m.as.removeClass("ke-menu-selected")});m.on("afterItemsChange",m._itemsChange,m);m.menuNode=e},_stateChange:function(m){var o=this.el;m.newVal==1?o.removeClass("ke-select-disabled"):o.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(m){m.halt();var o=this.menu,e=this.menuNode;if(m=(new t(m.target))._4e_ascendant(function(h){return e.contains(h)&&
h._4e_name()=="a"},true)){var c=this.get("value"),a=m.attr("data-value");this.set("value",a);this.fire("click",{newVal:a,prevVal:c,name:m.html()});o.hide()}},_real:function(){var m=this.el,o=m.offset(),e=n.clone(o),c=this.menu.get("el").height(),a=this.menu.get("el").width(),h=l.scrollTop(),k=l.scrollLeft(),i=l.viewportHeight(),b=l.viewportWidth();b=k+b-60;i=h+i;var f=o.top+(m.height()-2);m=o.left+m.width()-2;var d=this.get("align"),q=d[0];if(d[1]=="b"){o.top=f;if(o.top+c>i&&e.top-h>i-f)o.top=e.top-
c}else{o.top=e.top-c;if(o.top<h&&e.top-h<i-f)o.top=f}if(q=="l"){if(o.left+a>b&&m-k>b-e.left)o.left=m-a}else{o.left=m-a;if(o.left<k&&m-k<b-e.left)o.left=e.left}this.menu.set("xy",[o.left,o.top]);this.menu.show()},_click:function(m){m.preventDefault();m=this.el;var o=this.get("value");if(!m.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();o&&this.menu&&this.as.each(function(e){e.attr("data-value")==o?e.addClass("ke-menu-selected"):e.removeClass("ke-menu-selected")})}}});
v.Select=g}});KISSY.Editor.add("separator",function(g){g.addPlugin(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(g.toolBarDiv)})});
KISSY.Editor.add("smiley",function(g){var n=KISSY.Editor,t=KISSY,s=t.DOM,l=t.Event,v=t.Node,r=n.Overlay,m=n.TripleButton;n.Smiley||function(){function o(a){this.editor=a;this._init()}s.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");
for(var e="<div class='ke-smiley-sprite'>",c=0;c<=98;c++)e+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+c+".gif'></a>";e+="</div>";t.augment(o,{_init:function(){var a=this.editor;this.el=new m({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",container:a.toolBarDiv});this.el.on("offClick onClick",this._show,this);n.Utils.lazyRun(this,"_prepare","_real");n.Utils.sourceDisable(a,this)},disable:function(){this.el.set("state",m.DISABLED)},enable:function(){this.el.set("state",m.OFF)},
_hidePanel:function(a){var h=this.el.el;a=a.target;var k=this.smileyWin;h._4e_equals(a)||h.contains(a)||k.hide()},_selectSmiley:function(a){a.halt();var h=this.editor;a=a.target;var k;if(s._4e_name(a)=="a"&&(k=s.attr(a,"data-icon"))){k=new v("<img class='ke_smiley'alt='' src='"+k+"'/>",null,h.document);h.insertElement(k);this.smileyWin.hide()}},_prepare:function(){var a=this.el,h=this.editor,k=this.smileyWin=new r({content:e,focus4e:false,width:"297px",elCls:"ks-popup",zIndex:h.baseZIndex(n.zIndexManager.POPUP_MENU),
mask:false});k.renderer();this.smileyPanel=k.get("contentEl");k.on("show",a.bon,a);k.on("hide",a.boff,a);this.smileyPanel.on("click",this._selectSmiley,this);l.on(document,"click",this._hidePanel,this);l.on(h.document,"click",this._hidePanel,this)},_real:function(){var a=this.el.el.offset();a.top+=this.el.el.height()+5;if(a.left+this.smileyPanel.width()>s.viewportWidth()-60)a.left=s.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[a.left,a.top]);this.smileyWin.show()},_show:function(a){var h=
this.smileyWin;h&&h.get("visible")?h.hide():this._prepare(a)}});n.Smiley=o}();g.addPlugin(function(){new n.Smiley(g)})});
KISSY.Editor.add("sourcearea",function(g){var n=KISSY.Editor,t=KISSY,s=n.TripleButton;if(!(t.UA.gecko<1.92)){n.SourceArea||function(){function l(m){this.editor=m;this._init()}var v=n.SOURCE_MODE,r=n.WYSIWYG_MODE;t.augment(l,{_init:function(){var m=this.editor;var o=this.el=new s({container:m.toolBarDiv,title:"\u6e90\u7801",contentCls:"ke-toolbar-source"});o.on("offClick",this._show,this);o.on("onClick",this._hide,this);m.on("sourcemode",function(){o.bon()});m.on("wysiwygmode",function(){o.boff()})},_show:function(){this.editor.execCommand("sourceAreaSupport",
v);this.el.bon()},_hide:function(){var m=this.el;this.editor.execCommand("sourceAreaSupport",r);m.boff()}});n.SourceArea=l}();g.addPlugin(function(){new n.SourceArea(g)})}});
KISSY.Editor.add("sourcearea/support",function(g){var n=KISSY,t=n.Editor,s=n.UA;t.SourceAreaSupport||function(){function l(){var m=this.mapper={};m[v]=this._show;m[r]=this._hide}var v=t.SOURCE_MODE,r=t.WYSIWYG_MODE;n.augment(l,{exec:function(m,o){var e=this.mapper;e[o]&&e[o].call(this,m)},_show:function(m){m.textarea.val(m.getData(true));this._showSource(m);m.fire("sourcemode")},_showSource:function(m){var o=m.textarea,e=m.iframe;o.css("display","");e.css("display","none");s.ie<8&&o.css("height",
m.wrap.css("height"));o[0].focus()},_hideSource:function(m){var o=m.textarea;m.iframe.css("display","");o.css("display","none")},_hide:function(m){var o=m.textarea;this._hideSource(m);m.fire("save");m.setData(o.val());m.fire("wysiwygmode");m.fire("save");s.gecko&&m.activateGecko()}});t.SourceAreaSupport=new l}();g.addPlugin(function(){g.addCommand("sourceAreaSupport",t.SourceAreaSupport)})});
KISSY.Editor.add("table",function(g,n){var t=KISSY,s=t.Editor,l=t.Node,v=s.Walker,r=t.UA,m=s.NODE,o=s.TripleButton,e=s.ContextMenu,c=["tr","th","td","tbody","table"],a=t.trim,h;h=(r.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th",
"{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border");var k=g.htmlDataProcessor,i=k&&k.dataFilter;k=k&&k.htmlFilter;i&&i.addRules({elements:{table:function(b){b=b.attributes;var f=b["class"],d=parseInt(b.border,10);if(!d||d<=0)b["class"]=(f||"")+" ke_show_border"}}});k&&k.addRules({elements:{table:function(b){b=b.attributes;var f=b["class"];if(f)b["class"]=a(f.replace("ke_show_border","").replace(/\s{2}/," "))}}});s.TableUI||function(){function b(y){this.editor=y;y._toolbars=
y._toolbars||{};y._toolbars.table=this;this._init()}function f(y){function B(M){if(!(C.length>0))if(M[0].nodeType==m.NODE_ELEMENT&&p.test(M._4e_name())&&!M.data("selected_cell")){M._4e_setMarker(E,"selected_cell",true);C.push(M)}}for(var j=y.createBookmarks(),w=y.getRanges(),C=[],E={},D=0;D<w.length;D++){var F=w[D];if(F.collapsed){F=F.getCommonAncestor();(F=F._4e_ascendant("td",true)||F._4e_ascendant("th",true))&&C.push(F)}else{F=new v(F);var K;for(F.guard=B;K=F.next();)if((K=K.parent())&&p.test(K._4e_name())&&
!K.data("selected_cell")){K._4e_setMarker(E,"selected_cell",true);C.push(K)}}}s.Utils.clearAllMarkers(E);y.selectBookmarks(j);return C}function d(y,B){var j=y.getStartElement()._4e_ascendant("tr");if(j){var w=j._4e_clone(true);w.insertBefore(j);j=(B?w[0]:j[0]).cells;for(w=0;w<j.length;w++){j[w].innerHTML="";r.ie||(new l(j[w]))._4e_appendBogus()}}}function q(y){if(y instanceof s.Selection){var B=f(y),j=B.length;y=[];for(var w,C,E=0;E<j;E++){var D=B[E].parent(),F=D[0].rowIndex;!E&&(w=F-1);y[F]=D;E==
j-1&&(C=F+1)}E=D._4e_ascendant("table");w=new l(C<E[0].rows.length&&E[0].rows[C]||w>0&&E[0].rows[w]||E[0].parentNode);for(E=y.length;E>=0;E--)y[E]&&q(y[E]);return w}else if(y instanceof l){E=y._4e_ascendant("table");E[0].rows.length==1?E._4e_remove():y._4e_remove()}return 0}function A(y,B){var j=y.getStartElement();if(j=j._4e_ascendant("td",true)||j._4e_ascendant("th",true))for(var w=j._4e_ascendant("table"),C=j[0].cellIndex,E=0;E<w[0].rows.length;E++){var D=w[0].rows[E];if(!(D.cells.length<C+1)){j=
new l(D.cells[C].cloneNode(false));r.ie||j._4e_appendBogus();D=new l(D.cells[C]);B?j.insertBefore(D):j.insertAfter(D)}}}function z(y){if(y instanceof s.Selection){var B=f(y),j,w=[];y=B[0]&&B[0]._4e_ascendant("table");var C,E,D;C=0;for(E=B.length;C<E;C++)w.push(B[C][0].cellIndex);w.sort();C=1;for(E=w.length;C<E;C++)if(w[C]-w[C-1]>1){D=w[C-1]+1;break}D||(D=w[0]>0?w[0]-1:w[w.length-1]+1);w=y[0].rows;C=0;for(E=w.length;C<E;C++)if(j=w[C].cells[D])break;j=j?new l(j):y._4e_previous();for(D=B.length-1;D>=
0;D--)B[D]&&z(B[D]);return j}else if(y instanceof l){B=y._4e_ascendant("table");if(!B)return null;j=y[0].cellIndex;for(D=B[0].rows.length-1;D>=0;D--){y=new l(B[0].rows[D]);if(!j&&y[0].cells.length==1)q(y);else y[0].cells[j]&&y[0].removeChild(y[0].cells[j])}}return null}function u(y,B){var j=new s.Range(y[0].ownerDocument);if(!j.moveToElementEditablePosition(y,B?true:n)){j.selectNodeContents(y);j.collapse(B?false:true)}j.select(true)}b.showBorderClassName="ke_show_border";t.augment(b,{_init:function(){var y=
this.editor,B={};this.el=new o({contentCls:"ke-toolbar-table",title:"\u63d2\u5165\u8868\u683c",container:y.toolBarDiv});this.el.on("offClick",this._tableShow,this);for(var j in x)(function(w){B[w]=function(){y.fire("save");x[w](y);y.fire("save")}})(j);e.register({editor:y,rules:c,width:"120px",funcs:B});s.Utils.sourceDisable(y,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_tableShow:function(y,B,j){this.editor.useDialog("table/dialog",function(w){w.show(B,j)})}});var p=/^(?:td|th)$/,
x={"\u8868\u683c\u5c5e\u6027":function(y){var B=y.getSelection(),j=B&&B.getStartElement();if(B=j&&j._4e_ascendant("table",true)){y=y._toolbars.table;j=j._4e_ascendant(function(w){w=w._4e_name();return w=="td"||w=="th"},true);y._tableShow(null,B,j)}},"\u5220\u9664\u8868\u683c":function(y){var B=(y=y.getSelection())&&y.getStartElement();if(B=B&&B._4e_ascendant("table",true)){y.selectElement(B);var j=y.getRanges()[0];j.collapse();y.selectRanges([j]);y=B.parent();y[0].childNodes.length==1&&y._4e_name()!="body"&&y._4e_name()!="td"?y._4e_remove():
B._4e_remove()}},"\u5220\u9664\u884c ":function(y){y=y.getSelection();u(q(y),n)},"\u5220\u9664\u5217 ":function(y){y=y.getSelection();(y=z(y))&&u(y,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(y){y=y.getSelection();d(y,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(y){y=y.getSelection();d(y,n)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(y){y=y.getSelection();A(y,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(y){y=y.getSelection();A(y,n)}};s.TableUI=b}();g.addPlugin(function(){new s.TableUI(g);g.addCustomStyle(h)})});
KISSY.Editor.add("tabs",function(){function g(v){this.cfg=v;this._init()}var n=KISSY,t=n.Editor,s=n.DOM,l=n.Node;if(!t.Tabs){n.augment(g,n.EventTarget,{_init:function(){var v=this,r=v.cfg,m=r.tabs,o=r.contents.children("div"),e=m.children("li");m.on("click",function(c){c=new l(c.target);if(c=c._4e_ascendant(function(h){return h._4e_name()==="li"&&m.contains(h)},true)){e.removeClass("ke-tab-selected");var a=c.attr("rel");c.addClass("ke-tab-selected");o.hide();s.show(o[n.indexOf(c[0],e)]);v.fire(a)}})},
getTab:function(v){var r=this.cfg,m=r.tabs;r=r.contents.children("div");m=m.children("li");for(var o=0;o<m.length;o++){var e=new l(m[o]),c=new l(r[o]);if(n.isNumber(v)&&v==o||n.isString(v)&&v==e.attr("rel"))return{tab:e,content:c}}},remove:function(v){v=this.getTab(v);v.tab.remove();v.content.remove()},_getActivate:function(){var v=this.cfg,r=v.tabs;v.contents.children("div");v=r.children("li");for(r=0;r<v.length;r++){var m=new l(v[r]);if(m.hasClass("ke-tab-selected"))return m.attr("rel")}},activate:function(v){if(arguments.length==
0)return this._getActivate();var r=this.cfg,m=r.tabs;r=r.contents.children("div");m.children("li").removeClass("ke-tab-selected");r.hide();m=this.getTab(v);m.tab.addClass("ke-tab-selected");m.content.show()}});t.Tabs=g}});
KISSY.Editor.add("templates",function(g){var n=KISSY.Editor,t=KISSY,s=t.Node,l=t.DOM,v=n.TripleButton,r=n.Dialog;n.TplUI||function(){function m(o){this.editor=o;this._init()}l.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");
t.augment(m,{_init:function(){var o=this.editor,e=new v({container:o.toolBarDiv,contentCls:"ke-toolbar-template",title:"\u6a21\u677f"});e.on("offClick",this._show,this);n.Utils.lazyRun(this,"_prepare","_real");this.el=e;n.Utils.sourceDisable(o,this)},disable:function(){this.el.set("state",v.DISABLED)},enable:function(){this.el.set("state",v.OFF)},_prepare:function(){for(var o=this.editor,e=o.cfg.pluginConfig.templates||[],c="<div class='ke-tpl'>",a=0;a<e.length;a++)c+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+
e[a].demo+"</a>";c+="</div>";this._initDialogOk=true;var h=new r({width:500,mask:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:c});h.renderer();h.get("el").all(".ke-tpl-list").on("click",function(k){k.halt();k=(new s(k.target))._4e_index();k!=-1&&o.insertHtml(e[k].html);h.hide()});this.ui=h},_real:function(){this.ui.show()},_show:function(){this._prepare()}});n.TplUI=m}();g.addPlugin(function(){new n.TplUI(g)})});
KISSY.Editor.add("undo",function(g){var n=KISSY,t=n.Editor,s=t.Utils.arrayCompare,l=n.UA,v=n.Event;t.UndoManager||function(){function r(k){var i=k._getRawData();k=i&&k.getSelection();this.contents=i;this.bookmarks=k&&k.createBookmarks2(true)}function m(k){this.history=[];this.index=-1;this.editor=k;this.bufferRunner=t.Utils.buffer(this.save,this,500);this._init()}function o(k,i,b,f){this.editor=k;this.title=b;this.text=i;this.contentCls=f;this._init()}n.augment(r,{equals:function(k){if(this.contents!=
k.contents)return false;var i=this.bookmarks;k=k.bookmarks;if(i||k){if(!i||!k||i.length!=k.length)return false;for(var b=0;b<i.length;b++){var f=i[b],d=k[b];if(f.startOffset!=d.startOffset||f.endOffset!=d.endOffset||!s(f.start,d.start)||!s(f.end,d.end))return false}}return true}});var e={16:1,17:1,18:1},c={37:1,38:1,39:1,40:1,33:1,34:1};n.augment(m,{_keyMonitor:function(){var k=this.editor;v.on([k.document,k.textarea],"keydown",function(i){var b=i.keyCode;if(!(b in c||b in e))if(b===90&&(i.ctrlKey||
i.metaKey)){k.fire("restore",{d:-1});i.halt()}else if(b===89&&(i.ctrlKey||i.metaKey)){k.fire("restore",{d:1});i.halt()}else k.fire("save",{buffer:1})})},_init:function(){var k=this,i=k.editor;i.on("save",function(b){if(i.getMode()==t.WYSIWYG_MODE)b.buffer?k.bufferRunner():k.save()});i.on("restore",function(b){i.getMode()==t.WYSIWYG_MODE&&k.restore(b)});k._keyMonitor()},save:function(){var k=this.history,i=this.index;k.length>i+1&&k.splice(i+1,k.length-i-1);var b=this.editor;i=k[k.length-1];var f=
new r(b);if(!i||!i.equals(f)){k.length===30&&k.shift();k.push(f);this.index=i=k.length-1;b.fire("afterSave",{history:k,index:i})}},restore:function(k){k=k.d;var i=this.history,b=this.editor,f=i[this.index+k];if(f){b._setRawData(f.contents);if(f.bookmarks)b.getSelection().selectBookmarks(f.bookmarks);else if(l.ie){f=b.document.body.createTextRange();f.collapse(true);f.select()}(f=b.getSelection())&&f.scrollIntoView();this.index+=k;b.fire("afterRestore",{history:i,index:this.index});b.notifySelectionChange()}}});
var a=t.TripleButton,h={redo:1,undo:-1};n.augment(o,{_init:function(){var k=this,i=k.editor;k.el=new a({contentCls:k.contentCls,title:k.title,container:i.toolBarDiv});var b=k.el;b.set("state",a.DISABLED);i.on("afterSave afterRestore",k._respond,k);b.on("offClick",function(){i.fire("restore",{d:h[k.text]})});t.Utils.sourceDisable(i,k)},disable:function(){this._saveState=this.el.get("state");this.el.set("state",a.DISABLED)},enable:function(){this.el.set("state",this._saveState)},_respond:function(k){this.updateUI(k.history,
k.index)},updateUI:function(k,i){var b=this.el,f=this.text;if(f=="undo")i>0?b.set("state",a.OFF):b.set("state",a.DISABLED);else if(f=="redo")i<k.length-1?b.set("state",a.OFF):b.set("state",a.DISABLED)}});t.UndoManager=m;t.RestoreUI=o}();g.addPlugin(function(){new t.UndoManager(g);new t.RestoreUI(g,"undo","\u64a4\u9500","ke-toolbar-undo");new t.RestoreUI(g,"redo","\u91cd\u505a","ke-toolbar-redo")})});
