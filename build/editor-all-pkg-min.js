/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1
 @buildtime: 2010-12-10 14:14:07
*/
KISSY.add("editor",function(l,p){function t(r,h){function a(w){for(var o=t.Env.mods,z=0;z<w.length;z++){for(var x=w[z],A=m,E=0;E<z;E++)if(x==w[E]){A=q;break}E=o[x];if(A&&E){A=l.clone(E);x=x+"_"+z;A.name=x;w[z]=x;o[x]||(o[x]=A)}}}var c=this;if(!(c instanceof t))return new t(r,h);if(l.isString(r))r=l.one(r);r=s._4e_wrap(r);h=h||{};h.pluginConfig=h.pluginConfig||{};c.cfg=h;h.pluginConfig=h.pluginConfig;c.cfg=h;l.app(c,l.EventTarget);var f=["htmldataprocessor","enterkey","clipboard"],k=m;c.use=function(w,
o){w=w.split(",");a(w);if(!k)for(var z=0;z<f.length;z++){var x=f[z];l.inArray(x,w)||w.unshift(x)}l.use.call(c,w.join(","),function(){c.ready(function(){o&&o.call(c);if(!k){c.setData(r.val());if(h.focus)c.focus();else{var A=c.getSelection();A&&A.removeAllRanges()}c.fire("save");k=q}})},{order:q,global:t});return c};c.use=c.use;c.init(r);return c}function v(r){var h=l.Config.debug;r=h?h==="dev"?"../src/"+r:r:r.replace(/\.(js|css)/i,"-min.$1");r+=r.indexOf("?")!=-1?"&":"?";r+="t="+encodeURIComponent("2010-12-10 14:14:07");
return r}var s=l.DOM,q=true,m=false;l.app(t,l.EventTarget);t.Config.base=l.Config.base+"editor/";var j=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard","colorsupport/dialog/colorpicker",{name:"colorsupport"},"color/dialog","color","elementpaths","enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},"draft",{name:"draft/support",requires:["localstorage"]},{name:"flash",requires:["fakeobjects"]},"flash/dialog",{name:"flash/support",
requires:["flashutils","contextmenu","bubbleview"]},{name:"font",requires:["select"]},"format","htmldataprocessor",{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","indent/support","justify",{name:"link",requires:["bubbleview"]},"link/dialog","list/support","list","maximize","maximize/support",{name:"music/support",requires:["flash/support"]},{name:"music",requires:["fakeobjects"]},{name:"music/dialog",requires:["flash/dialog"]},"preview","removeformat",
"smiley",{name:"smiley/support"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table"},{name:"table/support",requires:["contextmenu"]},"table/dialog",{name:"templates"},"undo",{name:"resize"}],i,b,d,e,g={};i=0;for(b=j.length;i<b;i++){d=j[i];if(l.isString(d))d=j[i]={name:d+"",requires:null};e=d.requires||[];d.requires=e.concat(["button"])}j=[{name:"localstorage",requires:["flashutils","flashbridge"]},{name:"button"},"progressbar",{name:"contextmenu"},{name:"bubbleview"},{name:"select"}].concat(j);
i=0;for(b=j.length;i<b;i++){d=j[i];e=d.name||d;g[e]={attach:m,charset:"utf-8",requires:d.requires,csspath:d.useCss?v("plugins/"+e+"/plugin.css"):p,path:v("plugins/"+e+"/plugin.js")}}t.add(g);l.Editor=t;l.Editor=t});
KISSY.Editor.add("utils",function(l){var p=null,t=KISSY,v=t.Node,s=t.DOM,q=t.UA,m=t.Event,j;j=q.ie?document.documentMode||q.ie:void 0;var i={debugUrl:function(b){var d=t.Config.debug;b=d?d==="dev"?"../src/"+b:b:b.replace(/\.(js|css)/i,"-min.$1");b+=b.indexOf("?")!=-1?"&":"?";b+="t="+encodeURIComponent("2010-12-10 20:54:45");return b},lazyRun:function(b,d,e){var g=b[d],r=b[e];b[d]=function(){g.apply(this,arguments);b[d]=b[e];return r.apply(this,arguments)}},getXY:function(b,d,e,g){e=e.defaultView||
e.parentWindow;b-=s.scrollLeft(e);d-=s.scrollTop(e);if(g)if(e!=(g.defaultView||g.parentWindow)&&e.frameElement){g=s._4e_getOffset(e.frameElement,g);b+=g.left;d+=g.top}return{left:b,top:d}},tryThese:function(){for(var b,d=0,e=arguments.length;d<e;d++){var g=arguments[d];try{b=g();break}catch(r){}}return b},arrayCompare:function(b,d){if(!b&&!d)return true;if(!b||!d||b.length!=d.length)return false;for(var e=0;e<b.length;e++)if(b[e]!==d[e])return false;return true},getByAddress:function(b,d,e){b=b.documentElement;
for(var g=0;b&&g<d.length;g++){var r=d[g];if(e)for(var h=-1,a=0;a<b.childNodes.length;a++){var c=b.childNodes[a];if(!(e===true&&c.nodeType==3&&c.previousSibling&&c.previousSibling.nodeType==3)){h++;if(h==r){b=c;break}}}else b=b.childNodes[r]}return b?new v(b):p},clearAllMarkers:function(b){for(var d in b)b[d]._4e_clearMarkers(b,true)},htmlEncodeAttr:function(b){return b.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(b){return b.replace(/^\s+/,"")},rtrim:function(b){return b.replace(/\s+$/,
"")},trim:function(b){return this.ltrim(this.rtrim(b))},mix:function(){for(var b={},d=0;d<arguments.length;d++)b=t.mix(b,arguments[d]);return b},isCustomDomain:function(){if(!q.ie)return false;var b=document.domain,d=window.location.hostname;return b!=d&&b!="["+d+"]"},duplicateStr:function(b,d){return Array(d+1).join(b)},throttle:function(b,d,e){e=e||150;if(e===-1)return function(){b.apply(d,arguments)};var g=(new Date).getTime();return function(){var r=(new Date).getTime();if(r-g>e){g=r;b.apply(d,
arguments)}}},buffer:function(b,d,e){e=e||0;var g=p;return function(){g&&clearTimeout(g);var r=arguments;g=setTimeout(function(){return b.apply(d,r)},e)}},isNumber:function(b){return/^\d+(.\d+)?$/.test(t.trim(b))},verifyInputs:function(b){for(var d=0;d<b.length;d++){var e=s._4e_wrap(b[d]),g=t.trim(e.val()),r=e.attr("data-verify");e=e.attr("data-warning");if(r&&!RegExp(r).test(g)){alert(e);return false}}return true},sourceDisable:function(b,d){b.on("sourcemode",d.disable,d);b.on("wysiwygmode",d.enable,
d)},resetInput:function(b){var d=b.attr("placeholder");if(d&&!q.webkit){b.addClass("ke-input-tip");b.val(d)}else q.webkit&&b.val("")},valInput:function(b,d){b.removeClass("ke-input-tip");b.val(d)},placeholder:function(b,d){b.attr("placeholder",d);if(!q.webkit){b.on("blur",function(){if(!t.trim(b.val())){b.addClass("ke-input-tip");b.val(d)}});b.on("focus",function(){b.removeClass("ke-input-tip");t.trim(b.val())==d&&b.val("")})}},clean:function(b){b=b[0]||b;for(var d=t.makeArray(b.childNodes),e=0;e<
d.length;e++){var g=d[e];g.nodeType==l.NODE.NODE_TEXT&&!t.trim(g.nodeValue)&&b.removeChild(g)}},htmlEncode:function(b){return!b?b:String(b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(b){return!b?b:String(b).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(b,d){return b.toLowerCase()==d.toLowerCase()},normParams:function(b){b=t.clone(b);for(var d in b)if(b.hasOwnProperty(d)){var e=
b[d];if(t.isFunction(e))b[d]=e()}return b},doFormUpload:function(b,d,e){function g(){var w={responseText:"",responseXML:p};w.argument=b?b.argument:p;try{var o;if((o=q.ie?h.contentWindow.document:h.contentDocument||window.frames[r].document)&&o.body)w.responseText=o.body.innerHTML;w.responseXML=o&&o.XMLDocument?o.XMLDocument:o}catch(z){t.log(z)}m.remove(h,"load",g);b.callback&&b.callback(w);setTimeout(function(){s._4e_remove(h)},100)}var r=t.guid("form-upload-"),h=document.createElement("iframe");
h.id=r;h.name=r;h.className="ke-hidden";var a="document.open();"+(i.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(q.ie)h.src=q.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";t.log("doFormUpload : "+h.src);document.body.appendChild(h);if(q.ie)document.frames[r].name=r;a=s._4e_unwrap(b.form);var c={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=r;a.method="POST";a.enctype=a.encoding="multipart/form-data";
if(e)a.action=e;var f;if(d){f=[];d=l.Utils.normParams(d);for(var k in d)if(d.hasOwnProperty(k)){e=document.createElement("input");e.type="hidden";e.name=k;e.value=d[k];a.appendChild(e);f.push(e)}}m.on(h,"load",g);a.submit();a.target=c.target;a.method=c.method;a.enctype=c.enctype;a.encoding=c.encoding;a.action=c.action;if(f){d=0;for(k=f.length;d<k;d++)s._4e_remove(f[d])}return h},extern:function(b,d){for(var e in d)b[e]=d[e]},map:function(b,d){for(var e=0;e<b.length;e++)b[e]=d(b[e]);return b},ieEngine:j,
preventFocus:function(b){q.ie?b._4e_unselectable():b.attr("onmousedown","return false;")},isFlashEmbed:function(b){b=b.attributes;return b.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(b.src||"")}};l.Utils=i;l.Utils=i;q.ieEngine=i.ieEngine;i.extern(i,{debugUrl:i.debugUrl,lazyRun:i.lazyRun,getXY:i.getXY,tryThese:i.tryThese,arrayCompare:i.arrayCompare,getByAddress:i.getByAddress,clearAllMarkers:i.clearAllMarkers,htmlEncodeAttr:i.htmlEncodeAttr,ltrim:i.ltrim,rtrim:i.rtrim,trim:i.trim,
mix:i.mix,isCustomDomain:i.isCustomDomain,duplicateStr:i.duplicateStr,buffer:i.buffer,isNumber:i.isNumber,verifyInputs:i.verifyInputs,sourceDisable:i.sourceDisable,resetInput:i.resetInput,placeholder:i.placeholder,clean:i.clean,htmlEncode:i.htmlEncode,htmlDecode:i.htmlDecode,equalsIgnoreCase:i.equalsIgnoreCase,normParams:i.normParams,throttle:i.throttle,doFormUpload:i.doFormUpload,map:i.map})});
KISSY.Editor.add("dom",function(l){function p(a){return a.replace(/-(\w)/g,function(c,f){return f.toUpperCase()})}var t=KISSY,v=t.DOM,s=t.UA,q=t.Node,m=l.Utils,j={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};l.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};l.NODE=l.NODE;l.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};l.POSITION=l.POSITION;var i=l.NODE,b=l.POSITION,d={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},e={hr:1},g=function(a){return a[0]||a},r=function(a){if(a&&!a[0])return new q(a);return a},h={_4e_wrap:r,_4e_unwrap:g,_4e_equals:function(a,c){if(!a&&!c)return true;if(!a||!c)return false;a=g(a);c=g(c);
return a===c},_4e_isBlockBoundary:function(a,c){a=r(a);var f=t.mix(t.mix({},e),c||{});return d[a.css("display")]||f[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=g(a);for(var c=a.parentNode.childNodes,f=0;f<c.length;f++)if(c[f]===a)return f;return-1},_4e_first:function(a,c){a=g(a);var f=a.firstChild;if((f=f&&new q(f))&&c&&!c(f))f=f._4e_next(c);return f},_4e_move:function(a,c,f){a=g(a);v._4e_remove(a);
c=g(c);f?c.insertBefore(a,c.firstChild):c.appendChild(a)},_4e_name:function(a){a=g(a);var c=a.nodeName.toLowerCase();if(s.ie)if((a=a.scopeName)&&a!="HTML")c=a.toLowerCase()+":"+c;return c},_4e_isIdentical:function(a,c){if(a._4e_name()!=c._4e_name())return false;var f=a[0].attributes,k=c[0].attributes,w=f.length,o=k.length;if(w!=o)return false;for(var z=0;z<w;z++){var x=f[z],A=x.name;if(x.specified&&a.attr(A)!=c.attr(A))return false}if(m.ieEngine<8)for(z=0;z<o;z++){x=k[z];A=x.name;if(x.specified&&
a.attr(A)!=c.attr(A))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=g(a).childNodes;for(var c=0,f=a.length;c<f;c++){var k=a[c],w=k.nodeType;if(!(w==i.NODE_ELEMENT&&k.getAttribute("_ke_bookmark")))if(w==i.NODE_ELEMENT&&!h._4e_isEmptyInlineRemoveable(k)||w==i.NODE_TEXT&&t.trim(k.nodeValue))return false}return true},_4e_moveChildren:function(a,c,f){a=g(a);c=c[0]||c;if(a!=c)if(f)for(;f=a.lastChild;)c.insertBefore(a.removeChild(f),c.firstChild);else for(;f=a.firstChild;)c.appendChild(a.removeChild(f))},
_4e_mergeSiblings:function(){function a(c,f,k){if(f[0]&&f[0].nodeType==i.NODE_ELEMENT){for(var w=[];f.attr("_ke_bookmark")||f._4e_isEmptyInlineRemoveable();){w.push(f);f=k?new q(f[0].nextSibling):new q(f[0].previousSibling);if(!f[0]||f[0].nodeType!=i.NODE_ELEMENT)return}if(c._4e_isIdentical(f)){for(var o=k?c[0].lastChild:c[0].firstChild;w.length;)w.shift()._4e_move(c,!k);f._4e_moveChildren(c,!k);f._4e_remove();o[0]&&o[0].nodeType==i.NODE_ELEMENT&&o._4e_mergeSiblings()}}}return function(c){if(c[0])if(j[c._4e_name()]||
c._4e_name()=="a"){a(c,new q(c[0].nextSibling),true);a(c,new q(c[0].previousSibling))}}}(),_4e_unselectable:s.gecko?function(a){a=g(a);a.style.MozUserSelect="none"}:s.webkit?function(a){a=g(a);a.style.KhtmlUserSelect="none"}:function(a){a=g(a);if(s.ie||s.opera){var c=0;a.setAttribute("unselectable","on");for(var f=a.getElementsByTagName("*");a=f[c++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},_4e_getOffset:function(a,
c){a=g(a);var f,k=0;f=0;var w=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,o=a.ownerDocument,z=o.documentElement;c=c||o;if(a.getBoundingClientRect){if(a!==o.body&&z!==a){f=a.getBoundingClientRect();k=f.left+(c===o?v.scrollLeft(w):0);f=f.top+(c===o?v.scrollTop(w):0)}if(c)if(w!=(c.defaultView||c.parentWindow)&&w.frameElement){w=h._4e_getOffset(w.frameElement,c);k+=w.left;f+=w.top}}return{left:k,top:f}},_4e_getFrameDocument:function(a){return(a=g(a))&&a.contentWindow.document},_4e_splitText:function(a,
c){a=g(a);var f=a.ownerDocument;if(!(!a||a.nodeType!=i.NODE_TEXT)){if(s.ie&&c==a.nodeValue.length){var k=f.createTextNode("");v.insertAfter(k,a);return new q(k)}k=new q(a.splitText(c));if(f.documentMode){f=f.createTextNode("");v.insertAfter(f,k[0]);v._4e_remove(f)}return k}},_4e_parents:function(a,c){a=r(a);var f=[];do f[c?"push":"unshift"](a);while(a=a.parent());return f},_4e_clone:function(a,c,f){a=g(a);a=a.cloneNode(c);if(!f){var k=function(w){if(w.nodeType==i.NODE_ELEMENT){w.removeAttribute("id");
w=w.childNodes;for(var o=0;o<w.length;o++)k(w[o])}};k(a)}return new q(a)},_4e_nextSourceNode:function(a,c,f,k){a=g(a);if(k&&!k.call){var w=k[0]||k;k=function(z){z=z[0]||z;return z!==w}}c=!c&&a.firstChild;var o=new q(a);if(!c){if(a.nodeType==i.NODE_ELEMENT&&k&&k(a,true)===false)return null;c=a.nextSibling}for(;!c&&(o=o.parent());){if(k&&k(o,true)===false)return null;c=o[0].nextSibling}if(!c)return null;c=v._4e_wrap(c);if(k&&k(c)===false)return null;if(f&&f!=c[0].nodeType)return c._4e_nextSourceNode(false,
f,k);return c},_4e_previousSourceNode:function(a,c,f,k){a=g(a);if(k&&!k.call){var w=k[0]||k;k=function(z){z=z[0]||z;return z!==w}}c=!c&&a.lastChild;var o=new q(a);if(!c){if(a.nodeType==i.NODE_ELEMENT&&k&&k(a,true)===false)return null;c=a.previousSibling}for(;!c&&(o=o.parent());){if(k&&k(o,true)===false)return null;c=o[0].previousSibling}if(!c)return null;c=v._4e_wrap(c);if(k&&k(c)===false)return null;if(f&&c[0].nodeType!=f)return c._4e_previousSourceNode(false,f,k);return c},_4e_commonAncestor:function(a,
c){if(a._4e_equals(c))return a;if(c[0].nodeType!=i.NODE_TEXT&&c.contains(a))return c;var f=a[0].nodeType==i.NODE_TEXT?a.parent():a;do if(f[0].nodeType!=i.NODE_TEXT&&f.contains(c))return f;while(f=f.parent());return null},_4e_ascendant:function(a,c,f){a=g(a);if(!f)a=a.parentNode;if(c&&!t.isFunction(c)){var k=c;c=function(w){return w._4e_name()==k}}for(;a&&a.nodeType!=9;){if(!c||c(new q(a))===true)return new q(a);a=a.parentNode}return null},_4e_hasAttribute:m.ieEngine<9?function(a,c){a=g(a);var f=a.attributes[c];
return!!(f&&f.specified)}:function(a,c){a=g(a);return a.hasAttribute(c)},_4e_hasAttributes:m.ieEngine<9?function(a){a=g(a);for(var c=a.attributes,f=0;f<c.length;f++){var k=c[f];switch(k.name){case "class":if(a.getAttribute("class"))return true;break;default:if(k.specified)return true}}return false}:function(a){a=g(a);s.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},_4e_position:function(a,c){var f=g(a),k=g(c);if(f.compareDocumentPosition)return f.compareDocumentPosition(k);if(f==
k)return b.POSITION_IDENTICAL;if(f.nodeType==i.NODE_ELEMENT&&k.nodeType==i.NODE_ELEMENT){if(f.contains){if(f.contains(k))return b.POSITION_CONTAINS+b.POSITION_PRECEDING;if(k.contains(f))return b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING}if("sourceIndex"in f)return f.sourceIndex<0||k.sourceIndex<0?b.POSITION_DISCONNECTED:f.sourceIndex<k.sourceIndex?b.POSITION_PRECEDING:b.POSITION_FOLLOWING}f=a._4e_address();k=c._4e_address();for(var w=Math.min(f.length,k.length),o=0;o<=w-1;o++)if(f[o]!=k[o]){if(o<
w)return f[o]<k[o]?b.POSITION_PRECEDING:b.POSITION_FOLLOWING;break}return f.length<k.length?b.POSITION_CONTAINS+b.POSITION_PRECEDING:b.POSITION_IS_CONTAINED+b.POSITION_FOLLOWING},_4e_address:function(a,c){a=g(a);for(var f=[],k=a.ownerDocument.documentElement,w=a;w&&w!=k;){var o=w.parentNode,z=-1;if(o){for(var x=0;x<o.childNodes.length;x++){var A=o.childNodes[x];if(!(c&&A.nodeType==3&&A.previousSibling&&A.previousSibling.nodeType==3)){z++;if(A==w)break}}f.unshift(z)}w=o}return f},_4e_breakParent:function(a,
c){var f=new l.Range(a[0].ownerDocument);f.setStartAfter(a);f.setEndAfter(c);var k=f.extractContents();f.insertNode(a._4e_remove());a[0].parentNode.insertBefore(k,a[0].nextSibling)},_4e_style:function(a,c,f){a=r(a);if(f!==undefined)return a.css(c,f);a=g(a);return a.style[p(c)]},_4e_remove:function(a,c){var f=g(a),k=f.parentNode;if(k){if(c)for(var w;w=f.firstChild;)k.insertBefore(f.removeChild(w),f);k.removeChild(f)}return a},_4e_trim:function(a){v._4e_ltrim(a);v._4e_rtrim(a)},_4e_ltrim:function(a){a=
g(a);for(var c;c=a.firstChild;){if(c.nodeType==i.NODE_TEXT){var f=m.ltrim(c.nodeValue),k=c.nodeValue.length;if(f){if(f.length<k){(new q(c))._4e_splitText(k-f.length);a.removeChild(a.firstChild)}}else{a.removeChild(c);continue}}break}},_4e_rtrim:function(a){a=g(a);for(var c;c=a.lastChild;){if(c.type==i.NODE_TEXT){var f=m.rtrim(c.nodeValue),k=c.nodeValue.length;if(f){if(f.length<k){(new q(c))._4e_splitText(f.length);a.removeChild(a.lastChild)}}else{a.removeChild(c);continue}}break}if(!s.ie&&!s.opera)(c=
a.lastChild)&&c.nodeType==1&&c.nodeName.toLowerCase()=="br"&&c.parentNode.removeChild(c)},_4e_appendBogus:function(a){a=g(a);for(var c=a.lastChild;c&&c.nodeType==i.NODE_TEXT&&!t.trim(c.nodeValue);)c=c.previousSibling;if(!c||c.nodeType==i.NODE_TEXT||v._4e_name(c)!=="br"){c=s.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");s.gecko&&c.setAttribute("type","_moz");a.appendChild(c)}},_4e_previous:function(a,c){var f=g(a),k;do k=(f=f.previousSibling)&&new q(f);while(k&&c&&!c(k));
return k},_4e_last:function(a,c){a=v._4e_wrap(a);var f=a[0].lastChild;if((f=f&&new q(f))&&c&&!c(f))f=f._4e_previous(c);return f},_4e_next:function(a,c){var f=g(a),k;do k=(f=f.nextSibling)&&new q(f);while(k&&c&&!c(k));return k},_4e_outerHtml:function(a){a=g(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var c=a.ownerDocument.createElement("div");c.appendChild(a.cloneNode(true));return c.innerHTML},_4e_setMarker:function(a,c,f,k){a=v._4e_wrap(a);var w=a.data("list_marker_id")||a.data("list_marker_id",
t.guid()).data("list_marker_id"),o=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");c[w]=a;o[f]=1;return a.data(f,k)},_4e_clearMarkers:function(a,c,f){a=r(a);var k=a.data("list_marker_names"),w=a.data("list_marker_id"),o;for(o in k)a.removeData(o);a.removeData("list_marker_names");if(f){a.removeData("list_marker_id");delete c[w]}},_4e_copyAttributes:function(a,c,f){a=g(a);c=r(c);var k=a.attributes;f=f||{};for(var w=0;w<k.length;w++){var o=k[w],z=o.name.toLowerCase(),
x;if(!(z in f))if(z=="checked"&&(x=v.attr(a,z)))c.attr(z,x);else if(o.specified||s.ie&&o.value&&z=="value"){x=v.attr(a,z);if(x===null)x=o.nodeValue;c.attr(z,x)}}if(a.style.cssText!=="")c[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=v._4e_name(a);var c=l.XHTML_DTD;return(a=!c.$nonEditable[a]&&(c[a]||c.span))&&a["#"]},_4e_scrollIntoView:function(a){a=r(a);var c=a[0].ownerDocument,f=v.scrollLeft(c),k=v.scrollTop(c),w=a.offset(),o=w.left;w=w.top;if(v.viewportHeight(c)+k<w||w<k||v.viewportWidth(c)+
f<o||o<f)a.scrollIntoView(c)},_4e_getElementsByTagName:function(a,c,f){a=g(a);if(!s.ie&&f)c=f+":"+c;f=[];a=a.getElementsByTagName(c);for(c=0;c<a.length;c++)f.push(new q(a[c]));return f}};t.DOM._4e_inject=function(a){t.mix(v,a);for(var c in a)a.hasOwnProperty(c)&&function(f){q.prototype[f]=function(){var k=[].slice.call(arguments,0);k.unshift(this);return a[f].apply(null,k)}}(c)};m.extern(h,{_4e_wrap:h._4e_wrap,_4e_unwrap:h._4e_unwrap,_4e_equals:h._4e_equals,_4e_isBlockBoundary:h._4e_isBlockBoundary,
_4e_getWin:h._4e_getWin,_4e_index:h._4e_index,_4e_first:h._4e_first,_4e_move:h._4e_move,_4e_name:h._4e_name,_4e_isIdentical:h._4e_isIdentical,_4e_isEmptyInlineRemoveable:h._4e_isEmptyInlineRemoveable,_4e_moveChildren:h._4e_moveChildren,_4e_mergeSiblings:h._4e_mergeSiblings,_4e_unselectable:h._4e_unselectable,_4e_getOffset:h._4e_getOffset,_4e_getFrameDocument:h._4e_getFrameDocument,_4e_splitText:h._4e_splitText,_4e_parents:h._4e_parents,_4e_clone:h._4e_clone,_4e_nextSourceNode:h._4e_nextSourceNode,
_4e_previousSourceNode:h._4e_previousSourceNode,_4e_commonAncestor:h._4e_commonAncestor,_4e_ascendant:h._4e_ascendant,_4e_hasAttribute:h._4e_hasAttribute,_4e_hasAttributes:h._4e_hasAttributes,_4e_position:h._4e_position,_4e_address:h._4e_address,_4e_breakParent:h._4e_breakParent,_4e_style:h._4e_style,_4e_remove:h._4e_remove,_4e_trim:h._4e_trim,_4e_ltrim:h._4e_ltrim,_4e_rtrim:h._4e_rtrim,_4e_appendBogus:h._4e_appendBogus,_4e_last:h._4e_last,_4e_previous:h._4e_previous,_4e_next:h._4e_next,_4e_outerHtml:h._4e_outerHtml,
_4e_setMarker:h._4e_setMarker,_4e_clearMarkers:h._4e_clearMarkers,_4e_getUniqueId:h._4e_getUniqueId,_4e_copyAttributes:h._4e_copyAttributes,_4e_isEditable:h._4e_isEditable,_4e_scrollIntoView:h._4e_scrollIntoView,_4e_getElementsByTagName:h._4e_getElementsByTagName});v._4e_inject(h)});
KISSY.Editor.add("focusmanager",function(l){function p(){this.iframeFocus=b;j=this;v.log(this._UUID+" focus")}function t(){this.iframeFocus=d;j=e;v.log(this._UUID+" blur")}var v=KISSY,s=v.DOM,q=v.Event,m={},j,i={refreshAll:function(){for(var g in m){var r=m[g];r.document.designMode="off";r.document.designMode="on"}},currentInstance:function(){return j},getInstance:function(g){return m[g]},add:function(g){var r=s._4e_getWin(g.document);q.on(r,"focus",p,g);q.on(r,"blur",t,g)},register:function(g){m[g._UUID]=
g},remove:function(g){delete m[g._UUID];var r=s._4e_getWin(g.document);q.remove(r,"focus",p,g);q.remove(r,"blur",t,g)}},b=true,d=false,e=null;l.focusManager=i;l.focusManager=i;l.getInstances=function(){return m};l.getInstances=l.getInstances});
KISSY.Editor.add("definition",function(l){var p=true,t=false,v=l.Utils,s=document,q=KISSY,m=q.UA,j=q.DOM,i=q.Node,b=q.Event,d=l.focusManager,e=v.tryThese,g=v.debugUrl("theme/editor-iframe.css"),r=1,h="document.open();"+(v.isCustomDomain()?'document.domain="'+s.domain+'";':"")+"document.close();",a="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(m.ie?"javascript:void(function(){"+encodeURIComponent(h)+"}())":"")+'"  tabIndex="'+(m.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";l.SOURCE_MODE=0;l.WYSIWYG_MODE=1;l.SOURCE_MODE=l.SOURCE_MODE;l.WYSIWYG_MODE=l.WYSIWYG_MODE;q.augment(l,{init:function(c){if(m.ie)j.addClass(s.body,"ke-ie"+m.ie);else if(m.gecko)j.addClass(s.body,"ke-gecko");else m.webkit&&j.addClass(s.body,"ke-webkit");var f=this,k=new i(a.replace(/\$\(tabIndex\)/,
c.attr("tabIndex")));f.editorWrap=k;f._UUID=r++;d.register(f);f.wrap=k.one(".ke-textarea-wrap");f.wrap=f.wrap;f.iframe=f.wrap.one("iframe");f.iframe=f.iframe;f.toolBarDiv=k.one(".ke-editor-tools");f.toolBarDiv=f.toolBarDiv;f.textarea=c;f.textarea=f.textarea;f.statusDiv=k.one(".ke-editor-status");f.statusDiv=f.statusDiv;v.preventFocus(f.toolBarDiv);f._commands={};f._dialogs={};var w=c._4e_style("width"),o=c._4e_style("height");if(w){k.css("width",w);c.css("width","100%")}f.textarea.css("display","none");
k.insertAfter(c);f.wrap[0].appendChild(c[0]);if(o){f.wrap.css("height",o);c.css("height","100%")}k=f.iframe;f.on("dataReady",function(){f._ready=p;l.fire("instanceCreated",{editor:f})});m.gecko?k.on("load",f._setUpIFrame,f):f._setUpIFrame();f.cfg.attachForm&&c[0].form&&f._attachForm()},_attachForm:function(){(new i(this.textarea[0].form)).on("submit",this.sync,this)},useDialog:function(c,f){var k=this,w=l.Overlay;w.loading();k.use(c,function(){var o=k.getDialog(c);if(o){f(o);w.unloading()}else q.later(arguments.callee,
50,false,k)})},addDialog:function(c,f){this._dialogs[c]=f},getDialog:function(c){return this._dialogs[c]},addCommand:function(c,f){this._commands[c]=f},hasCommand:function(c){return this._commands[c]},execCommand:function(c){var f=this._commands[c],k=q.makeArray(arguments);k.shift();k.unshift(this);return f.exec.apply(f,k)},getMode:function(){return this.textarea.css("display")=="none"?l.WYSIWYG_MODE:l.SOURCE_MODE},getData:function(c){var f;f=this.getMode()==l.WYSIWYG_MODE?this.document.body.innerHTML:
this.textarea.val();if(this.htmlDataProcessor)f=c?this.htmlDataProcessor.toHtml(f,"p"):this.htmlDataProcessor.toServer(f,"p");f=q.trim(f);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(f))f="";return f},setData:function(c){var f=c;if(this.htmlDataProcessor)f=this.htmlDataProcessor.toDataFormat(c,"p");this.document.body.innerHTML=f;this.getMode()!=l.WYSIWYG_MODE&&this.textarea.val(c)},sync:function(){this.textarea.val(this.getData())},baseZIndex:function(c){c=c||0;return c+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},
_setRawData:function(c){this.document.body.innerHTML=c},_prepareIFrameHtml:function(c){var f=this.cfg,k=f.customLink,w="";if(k)for(var o=0;o<k.length;o++)w+='<link href="'+k[o]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+l.Config.base+g+"' rel='stylesheet'/><style>"+(f.customStyle||"")+"</style>"+w+"</head><body class='ke-editor'>&nbsp;"+(c?'<script id="ke_actscript" type="text/javascript">'+(v.isCustomDomain()?'document.domain="'+s.domain+'";':"")+
'window.parent.KISSY.Editor._initIFrame("'+c+'");<\/script>':"")+"</body></html>"},getSelection:function(){return l.Selection.getSelection(this.document)},focus:function(){var c=this.document,f=j._4e_getWin(c);m.webkit&&f&&f.parent&&f.parent.focus();m.webkit&&f&&f.focus();c&&c.body.focus();this.notifySelectionChange()},blur:function(){j._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(c){var f=this.cfg,k=this.document;f.customStyle=f.customStyle||
"";f.customStyle+="\n"+c;f=k.createElement("style");k.getElementsByTagName("head")[0].appendChild(f);if(f.styleSheet)f.styleSheet.cssText=c;else f.appendChild(k.createTextNode(c))},addCustomLink:function(c){var f=this.cfg,k=this.document;f.customLink=f.customLink||[];f.customLink.push(c);f=k.createElement("link");f.rel="stylesheet";k.getElementsByTagName("head")[0].appendChild(f);f.href=c},removeCustomLink:function(c){for(var f=this.cfg,k=q.makeArray(this.document.getElementsByTagName("link")),w=
0;w<k.length;w++)k[w].href==c&&j._4e_remove(k[w]);f.customLink=f.customLink||[];f=f.customLink;c=q.indexOf(c,f);c!=-1&&f.splice(c,1)},_setUpIFrame:function(){function c(){z=o.document;f.document=z;k.detach();z.open("text/html","replace");z.write(w);z.close()}var f=this,k=f.iframe,w=f._prepareIFrameHtml(f._UUID),o=k[0].contentWindow,z;try{z=o.document}catch(x){k[0].src=k[0].src;if(m.ie<7){setTimeout(c,10);return}}c()},ready:function(c){this._ready?c():this.on("dataReady",c)},_monitor:function(){var c=
this;c._monitorId&&clearTimeout(c._monitorId);c._monitorId=setTimeout(function(){var f=c.getSelection();if(f&&!f.isInvalid){var k=f.getStartElement(),w=new l.ElementPath(k);if(!c.previousPath||!c.previousPath.compare(w)){c.previousPath=w;c.fire("selectionChange",{selection:f,path:w,element:k})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(c,f){var k=this,w;k.focus();setTimeout(function(){var o=c._4e_name(),z=l.XHTML_DTD,x=l.RANGE,A=l.NODE,
E=z.$block[o],y=k.getSelection(),n=y&&y.getRanges(),u,B,D,C;if(!n||n.length==0){var F=arguments,L=F.callee;setTimeout(function(){L.apply(k,F)},30)}else{k.fire("save");for(var P=n.length-1;P>=0;P--){u=n[P];u.deleteContents();w=!P&&c||c._4e_clone(p);f&&f(w);if(E)for(;(D=u.getCommonAncestor(t,p))&&(C=z[D._4e_name()])&&!(C&&C[o]);)if(D._4e_name()in z.span)u.splitElement(D);else if(u.checkStartOfBlock()&&u.checkEndOfBlock()){u.setStartBefore(D);u.collapse(p);D._4e_remove()}else u.splitBlock();u.insertNode(w);
B||(B=w)}if(B){o=B._4e_nextSourceNode(p);z=k.document;C=l.XHTML_DTD;if(C.$inline[w._4e_name()]){o=new i(z.createTextNode(" "));o.insertAfter(B)}else if(o){if(o._4e_name()=="br"&&C[o.parent()._4e_name()].p){C=new i("<p>&nbsp;</p>",null,z);o[0].parentNode.replaceChild(C[0],o[0]);o=C}}else{C=new i("<p>&nbsp;</p>",null,z);C.insertAfter(B);o=C}u.moveToPosition(B,x.POSITION_AFTER_END);o&&o[0].nodeType==A.NODE_ELEMENT&&u.moveToElementEditablePosition(o);y.selectRanges([u]);k.focus();w&&w._4e_scrollIntoView();
setTimeout(function(){k.fire("save")},10)}}},0);return w},insertHtml:function(c){var f=this;if(f.htmlDataProcessor)c=f.htmlDataProcessor.toDataFormat(c);if(m.webkit){var k=j.create(c,null,this.document);k=k.nodeType==11?q.makeArray(k.childNodes):[k];for(var w=0;w<k.length;w++)f.insertElement(new i(k[w]))}else{f.focus();setTimeout(function(){var o=f.getSelection(),z=o&&o.getRanges();if(!z||z.length==0){var x=arguments,A=x.callee;setTimeout(function(){A.apply(f,x)},30)}else{f.fire("save");if(m.ie){o=
o.getNative();o.type=="Control"&&o.clear();o.createRange().pasteHTML(c)}else f.document.execCommand("inserthtml",t,c);f.focus();setTimeout(function(){f.fire("save")},10)}},0)}}});l._initIFrame=function(c){function f(u){e(function(){o.designMode="on";setTimeout(function(){o.designMode="off";A.focus();if(!arguments.callee.retry)arguments.callee.retry=p},50)},function(){o.designMode="off";j.attr(A,"contentEditable",t);j.attr(A,"contentEditable",p);!u&&f(1)})}var k=d.getInstance(c);c=k.textarea[0];var w=
k.iframe[0].contentWindow,o=k.document,z=k.cfg,x=o.getElementById("ke_actscript");j._4e_remove(x);var A=o.body;if(m.ie){A.hideFocus=p;A.disabled=p;A.contentEditable=p;A.removeAttribute("disabled")}else setTimeout(function(){if(m.gecko||m.opera)A.contentEditable=p;else if(m.webkit)A.parentNode.contentEditable=p;else o.designMode="on"},0);if(m.webkit){b.on(o,"click",function(u){var B=new i(u.target);q.inArray(B._4e_name(),["input","select"])&&u.preventDefault()});b.on(o,"mouseup",function(u){var B=
new i(u.target);q.inArray(B._4e_name(),["input","textarea"])&&u.preventDefault()})}if(m.gecko||m.ie||m.opera){var E;E=new i(j.insertAfter((new i('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],c));E.on("focus",function(){k.focus()});k.activateGecko=function(){m.gecko&&k.iframeFocus&&E[0].focus()};k.on("destroy",function(){})}if(m.ie&&o.compatMode=="CSS1Compat"||m.gecko||m.opera){var y=new i(o.documentElement);y.on("mousedown",function(u){if((new i(u.target))[0]==
y[0]){m.gecko&&f(t);E[0].focus()}})}b.on(w,"focus",function(){if(m.gecko)f(t);else m.opera&&A.focus();k.notifySelectionChange()});m.gecko&&b.on(k.document,"mousedown",function(){k.iframeFocus||f(t)});if(m.ie){b.on(o,"keydown",function(u){if(u.keyCode in{8:1,46:1}){var B=k.getSelection(),D=B.getSelectedElement();if(D){k.fire("save");var C=B.getRanges()[0].createBookmark();D._4e_remove();B.selectBookmarks([C]);k.fire("save");u.preventDefault()}}});if(o.compatMode=="CSS1Compat"){var n={33:1,34:1};b.on(o,
"keydown",function(u){u.keyCode in n&&setTimeout(function(){k.getSelection().scrollIntoView()},0)})}}setTimeout(function(){m.ie&&setTimeout(function(){if(o){A.runtimeStyle.marginBottom="0px";A.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){k.fire("dataReady");var u=z.disableObjectResizing,B=z.disableInlineTableEditing;if(u||B)try{o.execCommand("enableObjectResizing",t,!u);o.execCommand("enableInlineTableEditing",t,!B)}catch(D){b.on(A,m.ie?"resizestart":"resize",function(C){var F=new i(C.target);
if(u||F._4e_name()==="table"&&B)C.preventDefault()})}},10);m.webkit&&b.on(o,"mousedown",function(u){u=new i(u.target);q.inArray(u._4e_name(),["img","hr","input","textarea","select"])&&k.getSelection().selectElement(u)});m.gecko&&b.on(o,"dragstart",function(u){var B=new i(u.target);B._4e_name()==="img"&&/ke_/.test(B[0].className)&&u.preventDefault()});d.add(k)};h=l.prototype;v.extern(h,{setData:h.setData,getData:h.getData,insertElement:h.insertElement,insertHtml:h.insertHtml,ready:h.ready,addCustomStyle:h.addCustomStyle,
addCommand:h.addCommand,hasCommand:h.hasCommand,execCommand:h.execCommand,useDialog:h.useDialog,addDialog:h.addDialog,getDialog:h.getDialog,getMode:h.getMode,sync:h.sync,baseZIndex:h.baseZIndex,getSelection:h.getSelection,focus:h.focus,blur:h.blur,notifySelectionChange:h.notifySelectionChange})});
KISSY.Editor.add("zindex",function(){var l=KISSY.Editor;if(!l.zIndexManager){l.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};l.baseZIndex=function(p){var t=p,v=l.getInstances(),s;for(s in v){if(!v.hasOwnProperty(s))return;t=Math.max(t,v[s].baseZIndex(p))}return t};l.baseZIndex=l.baseZIndex;l.zIndexManager=l.zIndexManager}});
KISSY.Editor.add("dtd",function(l){l.XHTML_DTD=function(){function p(z){for(var x=arguments.length-1;x>0;)KISSY.mix(z,arguments[x--]);return z}var t={isindex:1,fieldset:1},v={input:1,button:1,select:1,textarea:1,label:1},s=p({a:1},v),q=p({iframe:1},s),m={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},i=p({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),b=p({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),d=p({p:1},b);v=p({iframe:1},b,v);b={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=p({a:1},v),g={tr:1},r={"#":1},h=p({param:1},b),a=p({form:1},t,q,m,d),c={li:1},f={base:1,link:1,meta:1,title:1},k=p(f,{style:1,script:1}),w={head:1,body:1},o={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:p({html:1},w,f),$block:o,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:e,$body:p({script:1,style:1},o),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:w,head:k,style:r,body:a,base:{},link:{},meta:{},title:r,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:e,button:p(d,m),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:c,h1:e,h3:e,option:r,h2:e,form:p(t,q,m,d),select:{optgroup:1,option:1},font:e,ins:e,menu:c,abbr:e,label:e,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:r,tfoot:g,cite:e,li:a,input:{},iframe:a,strong:e,textarea:r,noframes:a,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:a,object:h,sup:e,dd:a,strike:e,area:{},dir:c,map:p({area:1,form:1,p:1},t,j,m),applet:h,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:p({legend:1},b),thead:g,ul:c,acronym:e,b:e,a:v,blockquote:a,caption:e,i:e,u:e,tbody:g,s:e,address:p(q,d),tt:e,legend:e,q:e,pre:p(i,s),p:e,em:e,dfn:e}}();l.XHTML_DTD=
l.XHTML_DTD});
KISSY.Editor.add("elementpath",function(l){function p(b){var d=q,e=q,g=[];for(b=b;b&&b[0];){if(b[0].nodeType==s.NODE_ELEMENT){if(!this.lastElement)this.lastElement=b;var r=b._4e_name();if(!e){if(!d&&m[r])d=b;if(j[r]){var h;if(h=!d){if(h=r=="div"){a:{h=b;h=h[0]||h;h=h.childNodes;for(var a=0,c=h.length;a<c;a++){var f=h[a];if(f.nodeType==s.NODE_ELEMENT&&v.$block[f.nodeName.toLowerCase()]){h=true;break a}}h=false}h=!h}h=h}if(h)d=b;else e=b}}g.push(b);if(r=="body")break}b=b.parent()}this.block=this.block=
d;this.blockLimit=this.blockLimit=e;this.elements=this.elements=g}var t=KISSY.DOM,v=l.XHTML_DTD,s=l.NODE,q=null,m={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},j={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};p.prototype={compare:function(b){var d=this.elements;b=b&&b.elements;if(!b||d.length!=b.length)return false;for(var e=0;e<d.length;e++)if(!t._4e_equals(d[e],b[e]))return false;return true},contains:function(b){for(var d=this.elements,e=0;e<
d.length;e++)if(d[e]._4e_name()in b)return d[e];return q}};l.ElementPath=l.ElementPath=p;var i=p.prototype;l.Utils.extern(i,{compare:i.compare,contains:i.contains})});
KISSY.Editor.add("walker",function(l){function p(g,r){if(this._.end)return m;var h,a=this.range,c,f=this.guard,k=this.type,w=g?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;a.trim();if(a.collapsed){this.end();return m}}if(!g&&!this._.guardLTR){var o=a.endContainer,z=new d(o[0].childNodes[a.endOffset]);this._.guardLTR=function(y,n){return(y=b._4e_wrap(y))&&y[0]&&(!n||!b._4e_equals(o,y))&&(!z[0]||!y._4e_equals(z))&&(y[0].nodeType!=i.NODE_ELEMENT||!n||y._4e_name()!="body")}}if(g&&
!this._.guardRTL){var x=a.startContainer,A=a.startOffset>0&&new d(x[0].childNodes[a.startOffset-1]);this._.guardRTL=function(y,n){return(y=b._4e_wrap(y))&&y[0]&&(!n||!y._4e_equals(x))&&(!A[0]||!y._4e_equals(A))&&(y[0].nodeType!=i.NODE_ELEMENT||!n||y._4e_name()!="body")}}var E=g?this._.guardRTL:this._.guardLTR;c=f?function(y,n){if(E(y,n)===q)return q;return f(y,n)}:E;if(this.current)h=this.current[w](q,k,c);else if(g){h=a.endContainer;if(a.endOffset>0){h=new d(h[0].childNodes[a.endOffset-1]);if(c(h)===
q)h=m}else h=c(h,s)===q?m:h._4e_previousSourceNode(s,k,c)}else{h=a.startContainer;if((h=new d(h[0].childNodes[a.startOffset]))&&h[0]){if(c(h)===q)h=m}else h=c(a.startContainer,s)===q?m:a.startContainer._4e_nextSourceNode(s,k,c)}for(;h&&h[0]&&!this._.end;){this.current=h;if(!this.evaluator||this.evaluator(h)!==q){if(!r)return h}else if(r&&this.evaluator)return q;h=h[w](q,k,c)}this.end();return this.current=m}function t(g){for(var r,h=m;r=p.call(this,g);)h=r;return h}function v(g){this.range=g;this._=
{}}var s=true,q=false,m=null,j=KISSY,i=l.NODE,b=j.DOM,d=j.Node;j.augment(v,{end:function(){this._.end=1},next:function(){return p.call(this)},previous:function(){return p.call(this,s)},checkForward:function(){return p.call(this,q,s)!==q},checkBackward:function(){return p.call(this,s,s)!==q},lastForward:function(){return t.call(this)},lastBackward:function(){return t.call(this,s)},reset:function(){delete this.current;this._={}}});v.blockBoundary=function(g){return function(r){r=b._4e_wrap(r);return!(r&&
r[0].nodeType==i.NODE_ELEMENT&&r._4e_isBlockBoundary(g))}};v.listItemBoundary=function(){return this.blockBoundary({br:1})};v.bookmark=function(g,r){function h(a){return a&&a[0]&&a._4e_name()=="span"&&a.attr("_ke_bookmark")}return function(a){var c,f;c=a&&a[0]&&a[0].nodeType==i.NODE_TEXT&&(f=a.parent())&&h(f);c=g?c:c||h(a);return r^c}};v.whitespaces=function(g){return function(r){r=(r=r[0]||r)&&r.nodeType==i.NODE_TEXT&&!j.trim(r.nodeValue);return g^r}};v.invisible=function(g){var r=v.whitespaces();
return function(h){h=r(h)||h[0].nodeType==i.NODE_ELEMENT&&!h[0].offsetHeight;return g^h}};l.Walker=v;l.Walker=v;var e=v.prototype;l.Utils.extern(e,{end:e.end,next:e.next,previous:e.previous,checkForward:e.checkForward,checkBackward:e.checkBackward,lastForward:e.lastForward,lastBackward:e.lastBackward,reset:e.reset});l.Utils.extern(v,{blockBoundary:v.blockBoundary,listItemBoundary:v.listItemBoundary,bookmark:v.bookmark,whitespaces:v.whitespaces,invisible:v.invisible})});
KISSY.Editor.add("range",function(l){function p(n){this.endOffset=this.endContainer=this.startOffset=this.startContainer=b;this.collapsed=j;this.document=n}function t(n){var u=n[0].nodeType!=e.NODE_TEXT&&n._4e_name()in k.$removeEmpty,B=!d.trim(n[0].nodeValue);n=!!n.parent().attr("_ke_bookmark");return u||B||n}function v(n){return!A(n)&&!E(n)}function s(n){var u=i,B=h.bookmark(j);return function(D){if(B(D))return j;if(D[0].nodeType==e.NODE_TEXT){if(d.trim(D[0].nodeValue).length)return i}else if(D[0].nodeType==
e.NODE_ELEMENT)if(!x[D._4e_name()])if(!n&&!f.ie&&D._4e_name()=="br"&&!u)u=j;else return i;return j}}function q(n,u){function B(D){return D&&D.nodeName=="span"&&D.getAttribute("_ke_bookmark")}return function(D){var C,F;C=D&&!D.nodeName&&(F=D.parentNode)&&B(F);C=n?C:C||B(D);return u^C}}function m(n){return function(u){u=(u=u[0]||u)&&u.nodeType==e.NODE_TEXT&&!d.trim(u.nodeValue);return n^u}}l.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};l.RANGE=l.RANGE;var j=true,i=false,b=null,d=KISSY,e=l.NODE,g=l.RANGE,r=l.POSITION,h=l.Walker,a=d.DOM,c=l.Utils.getByAddress,f=d.UA,k=l.XHTML_DTD,w=l.ElementPath,o=d.Node,z={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};p.prototype.toString=function(){var n=[];n.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);n.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return n.join("<br/>")};d.augment(p,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&a._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var n=this.startContainer,u=this.startOffset;if(n[0].nodeType!=e.NODE_ELEMENT)if(u)u>=n[0].nodeValue.length&&this.setStartAfter(n);else this.setStartBefore(n);n=this.endContainer;u=this.endOffset;if(n[0].nodeType!=e.NODE_ELEMENT)if(u)u>=
n[0].nodeValue.length&&this.setEndAfter(n);else this.setEndBefore(n)},setStartAfter:function(n){this.setStart(n.parent(),n._4e_index()+1)},setStartBefore:function(n){this.setStart(n.parent(),n._4e_index())},setEndAfter:function(n){this.setEnd(n.parent(),n._4e_index()+1)},setEndBefore:function(n){this.setEnd(n.parent(),n._4e_index())},optimizeBookmark:function(){var n=this.startContainer,u=this.endContainer;n&&n._4e_name()=="span"&&n.attr("_ke_bookmark")&&this.setStartAt(n,g.POSITION_BEFORE_START);
u&&u._4e_name()=="span"&&u.attr("_ke_bookmark")&&this.setEndAt(u,g.POSITION_AFTER_END)},setStart:function(n,u){if(n[0].nodeType==e.NODE_ELEMENT&&z[n._4e_name()]){n=n.parent();u=n._4e_index()}this.startContainer=n;this.startOffset=u;if(!this.endContainer){this.endContainer=n;this.endOffset=u}this.updateCollapsed()},setEnd:function(n,u){if(n[0].nodeType==e.NODE_ELEMENT&&z[n._4e_name()]){n=n.parent();u=n._4e_index()+1}this.endContainer=n;this.endOffset=u;if(!this.startContainer){this.startContainer=
n;this.startOffset=u}this.updateCollapsed()},setStartAt:function(n,u){switch(u){case g.POSITION_AFTER_START:this.setStart(n,0);break;case g.POSITION_BEFORE_END:n[0].nodeType==e.NODE_TEXT?this.setStart(n,n[0].nodeValue.length):this.setStart(n,n[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setStartBefore(n);break;case g.POSITION_AFTER_END:this.setStartAfter(n)}this.updateCollapsed()},setEndAt:function(n,u){switch(u){case g.POSITION_AFTER_START:this.setEnd(n,0);break;case g.POSITION_BEFORE_END:n[0].nodeType==
e.NODE_TEXT?this.setEnd(n,n[0].nodeValue.length):this.setEnd(n,n[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setEndBefore(n);break;case g.POSITION_AFTER_END:this.setEndAfter(n)}this.updateCollapsed()},execContentsAction:function(n,u){var B=this.startContainer,D=this.endContainer,C=this.startOffset,F=this.endOffset,L,P=this.document,M;this.optimizeBookmark();if(D[0].nodeType==e.NODE_TEXT)D=D._4e_splitText(F);else if(D[0].childNodes.length>0)if(F>=D[0].childNodes.length){D=new o(D[0].appendChild(P.createTextNode("")));
M=j}else D=new o(D[0].childNodes[F]);if(B[0].nodeType==e.NODE_TEXT){B._4e_splitText(C);if(B._4e_equals(D))D=new o(B[0].nextSibling)}else if(C)if(C>=B[0].childNodes.length){L=new o(P.createTextNode(""));B.append(L);B=L;L=j}else B=new o(B[0].childNodes[C].previousSibling);else{L=new o(P.createTextNode(""));B.prepend(L);B=L;L=j}C=B._4e_parents();F=D._4e_parents();var Q,R,T;for(Q=0;Q<C.length;Q++){R=C[Q];T=F[Q];if(!R._4e_equals(T))break}P=u;for(var U,V,G,K=Q;K<C.length;K++){U=C[K];V=P&&!U._4e_equals(B)?
P.appendChild(U._4e_clone()[0]):null;for(U=U[0].nextSibling;U;){if(a._4e_equals(F[K],U)||a._4e_equals(D,U))break;G=U.nextSibling;if(n==2)P.appendChild(U.cloneNode(j));else{a._4e_remove(U);n==1&&P.appendChild(U)}U=G}if(V)P=V}P=u;for(Q=Q;Q<F.length;Q++){U=F[Q];V=P&&n>0&&!U._4e_equals(D)?P.appendChild(U._4e_clone()[0]):null;if(!C[Q]||!U.parent()._4e_equals(C[Q].parent()))for(U=U[0].previousSibling;U;){if(a._4e_equals(C[Q],U)||a._4e_equals(B,U))break;G=U.previousSibling;if(n==2)P.insertBefore(U.cloneNode(j),
P.firstChild);else{a._4e_remove(U);n==1&&P.insertBefore(U,P.firstChild)}U=G}if(V)P=V}if(n==2){T=this.startContainer[0];if(T.nodeType==e.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==e.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}T=this.endContainer[0];if(T.nodeType==e.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==e.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}}else{if(R&&T&&(!B.parent()._4e_equals(R.parent())||!D.parent()._4e_equals(T.parent()))){R=
T._4e_index();L&&T.parent()._4e_equals(B.parent())&&R--;this.setStart(T.parent(),R)}this.collapse(j)}L&&B._4e_remove();M&&D[0].parentNode&&D._4e_remove()},collapse:function(n){if(n){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=j},clone:function(){var n=new p(this.document);n.startContainer=this.startContainer;n.startOffset=this.startOffset;n.endContainer=this.endContainer;n.endOffset=
this.endOffset;n.collapsed=this.collapsed;return n},getEnclosedNode:function(){var n=this.clone();n.optimize();if(n.startContainer[0].nodeType!=e.NODE_ELEMENT||n.endContainer[0].nodeType!=e.NODE_ELEMENT)return b;var u=new l.Walker(n),B=q(j,undefined),D=m(j);n.evaluator=function(C){return D(C)&&B(C)};n=u.next();u.reset();u=u.previous();return n&&n._4e_equals(u)?n:b},shrink:function(n,u){if(!this.collapsed){n=n||g.SHRINK_TEXT;var B=this.clone(),D=this.startContainer,C=this.endContainer,F=this.startOffset,
L=this.endOffset,P=1,M=1;if(D&&D[0].nodeType==e.NODE_TEXT)if(F)if(F>=D[0].nodeValue.length)B.setStartAfter(D);else{B.setStartBefore(D);P=0}else B.setStartBefore(D);if(C&&C[0].nodeType==e.NODE_TEXT)if(L)if(L>=C[0].nodeValue.length)B.setEndAfter(C);else{B.setEndAfter(C);M=0}else B.setEndBefore(C);B=new h(B);B.evaluator=function(R){R=R[0]||R;return R.nodeType==(n==g.SHRINK_ELEMENT?e.NODE_ELEMENT:e.NODE_TEXT)};var Q;B.guard=function(R,T){R=R[0]||R;if(n==g.SHRINK_ELEMENT&&R.nodeType==e.NODE_TEXT)return i;
if(T&&R==Q)return i;if(!T&&R.nodeType==e.NODE_ELEMENT)Q=R;return j};if(P)(D=B[n==g.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(D,u?g.POSITION_AFTER_START:g.POSITION_BEFORE_START);if(M){B.reset();(B=B[n==g.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(B,u?g.POSITION_BEFORE_END:g.POSITION_AFTER_END)}return!!(P||M)}},getTouchedStartNode:function(){var n=this.startContainer;if(this.collapsed||n[0].nodeType!=e.NODE_ELEMENT)return n;return n.childNodes[this.startOffset]||n},createBookmark2:function(n){var u=
this.startContainer,B=this.endContainer,D=this.startOffset,C=this.endOffset,F,L;if(!u||!B)return{start:0,end:0};if(n){if(u[0].nodeType==e.NODE_ELEMENT)if((F=new o(u[0].childNodes[D]))&&F[0]&&F[0].nodeType==e.NODE_TEXT&&D>0&&F[0].previousSibling.nodeType==e.NODE_TEXT){u=F;D=0}for(;u[0].nodeType==e.NODE_TEXT&&(L=u._4e_previous())&&L[0].nodeType==e.NODE_TEXT;){u=L;D+=L[0].nodeValue.length}if(!this.collapsed){if(B[0].nodeType==e.NODE_ELEMENT)if((F=new o(B[0].childNodes[C]))&&F[0]&&F[0].nodeType==e.NODE_TEXT&&
C>0&&F[0].previousSibling.nodeType==e.NODE_TEXT){B=F;C=0}for(;B[0].nodeType==e.NODE_TEXT&&(L=B._4e_previous())&&L[0].nodeType==e.NODE_TEXT;){B=L;C+=L[0].nodeValue.length}}}return{start:u._4e_address(n),end:this.collapsed?b:B._4e_address(n),startOffset:D,endOffset:C,normalized:n,is2:j}},createBookmark:function(n){var u,B,D,C,F=this.collapsed;u=new o("<span>",b,this.document);u.attr("_ke_bookmark",1);u.css("display","none");u.html("&nbsp;");if(n){D=d.guid("ke_bm_");u.attr("id",D+"S")}if(!F){B=u._4e_clone();
B.html("&nbsp;");n&&B.attr("id",D+"E");C=this.clone();C.collapse();C.insertNode(B)}C=this.clone();C.collapse(j);C.insertNode(u);if(B){this.setStartAfter(u);this.setEndBefore(B)}else this.moveToPosition(u,g.POSITION_AFTER_END);return{startNode:n?D+"S":u,endNode:n?D+"E":B,serializable:n,collapsed:F}},moveToPosition:function(n,u){this.setStartAt(n,u);this.collapse(j)},trim:function(n,u){var B=this.startContainer,D=this.startOffset,C=this.collapsed;if((!n||C)&&B[0]&&B[0].nodeType==e.NODE_TEXT){if(D)if(D>=
B[0].nodeValue.length){D=B._4e_index()+1;B=B.parent()}else{var F=B._4e_splitText(D);D=B._4e_index()+1;B=B.parent();if(a._4e_equals(this.startContainer,this.endContainer))this.setEnd(F,this.endOffset-this.startOffset);else if(a._4e_equals(B,this.endContainer))this.endOffset+=1}else{D=B._4e_index();B=B.parent()}this.setStart(B,D);if(C){this.collapse(j);return}}B=this.endContainer;D=this.endOffset;if(!(u||C)&&B[0]&&B[0].nodeType==e.NODE_TEXT){if(D){D>=B.nodeValue.length||B._4e_splitText(D);D=B._4e_index()+
1}else D=B._4e_index();B=B.parent();this.setEnd(B,D)}},insertNode:function(n){this.optimizeBookmark();this.trim(i,j);var u=this.startContainer;u[0].insertBefore(n[0]||n,u[0].childNodes[this.startOffset]||null);a._4e_equals(n.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(n)},moveToBookmark:function(n){if(n.is2){var u=c(this.document,n.start,n.normalized),B=n.startOffset,D=n.end&&c(this.document,n.end,n.normalized);n=n.endOffset;this.setStart(u,B);D?this.setEnd(D,n):this.collapse(j)}else{u=
(B=n.serializable)?d.one("#"+n.startNode,this.document):n.startNode;n=B?d.one("#"+n.endNode,this.document):n.endNode;this.setStartBefore(u);u._4e_remove();if(n&&n[0]){this.setEndBefore(n);n._4e_remove()}else this.collapse(j)}},getCommonAncestor:function(n,u){var B=this.startContainer,D=this.endContainer;B=a._4e_equals(B,D)?n&&B[0].nodeType==e.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new o(B[0].childNodes[this.startOffset]):B:B._4e_commonAncestor(D);return u&&B[0].nodeType==e.NODE_TEXT?B.parent():
B},enlarge:function(n){switch(n){case g.ENLARGE_ELEMENT:if(this.collapsed)break;n=this.getCommonAncestor();var u=new o(this.document.body),B,D,C,F,L,P=i,M,Q;M=this.startContainer;Q=this.startOffset;if(M[0].nodeType==e.NODE_TEXT){if(Q){M=!d.trim(M[0].nodeValue.substring(0,Q)).length&&M;P=!!M}if(M)if(!(F=M[0].previousSibling))C=M.parent()}else{if(Q)F=M[0].childNodes[Q-1]||M[0].lastChild;F||(C=M)}for(;C||F;){if(C&&!F){if(!L&&a._4e_equals(C,n))L=j;if(!u.contains(C))break;if(!P||C.css("display")!="inline"){P=
i;if(L)B=C;else this.setStartBefore(C)}F=C[0].previousSibling}for(;F;){M=i;if(F.nodeType==e.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=b;M=/[\s\ufeff]$/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&k.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=b;else for(var R=F.all||F.getElementsByTagName("*"),T=0,U;U=R[T++];)if(!k.$removeEmpty[U.nodeName.toLowerCase()]){F=b;break}if(F)M=!!Q.length}else F=b;if(M)if(P)if(L)B=C;else C&&this.setStartBefore(C);
else P=j;if(F){M=F.previousSibling;if(!C&&!M){C=new o(F);F=b;break}F=M}else C=b}if(C)C=C.parent()}M=this.endContainer;Q=this.endOffset;C=F=b;L=P=i;if(M[0].nodeType==e.NODE_TEXT){M=!d.trim(M[0].nodeValue.substring(Q)).length&&M;P=!(M&&M[0].nodeValue.length);if(M)if(!(F=M[0].nextSibling))C=M.parent()}else(F=M[0].childNodes[Q])||(C=M);for(;C||F;){if(C&&!F){if(!L&&a._4e_equals(C,n))L=j;if(!u.contains(C))break;if(!P||C.css("display")!="inline"){P=i;if(L)D=C;else C&&this.setEndAfter(C)}F=C[0].nextSibling}for(;F;){M=
i;if(F.nodeType==e.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=b;M=/^[\s\ufeff]/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&k.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=b;else{R=F.all||F.getElementsByTagName("*");for(T=0;U=R[T++];)if(!k.$removeEmpty[U.nodeName.toLowerCase()]){F=b;break}}if(F)M=!!Q.length}else F=b;if(M)if(P)if(L)D=C;else this.setEndAfter(C);if(F){M=F.nextSibling;if(!C&&!M){C=new o(F);F=b;break}F=M}else C=b}if(C)C=
C.parent()}if(B&&D){n=B.contains(D)?D:B;this.setStartBefore(n);this.setEndAfter(n)}break;case g.ENLARGE_BLOCK_CONTENTS:case g.ENLARGE_LIST_ITEM_CONTENTS:C=new p(this.document);u=new o(this.document.body);C.setStartAt(u,g.POSITION_AFTER_START);C.setEnd(this.startContainer,this.startOffset);C=new h(C);var V,G,K=h.blockBoundary(n==g.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:b),I=function(H){var J=K(H);J||(V=H);return J};B=function(H){var J=I(H);if(!J&&H[0]&&H._4e_name()=="br")G=H;return J};C.guard=I;C=C.lastBackward();
V=V||u;this.setStartAt(V,V._4e_name()!="br"&&(!C&&this.checkStartOfBlock()||C&&V.contains(C))?g.POSITION_AFTER_START:g.POSITION_AFTER_END);C=this.clone();C.collapse();C.setEndAt(u,g.POSITION_BEFORE_END);C=new h(C);C.guard=n==g.ENLARGE_LIST_ITEM_CONTENTS?B:I;V=b;C=C.lastForward();V=V||u;this.setEndAt(V,!C&&this.checkEndOfBlock()||C&&V.contains(C)?g.POSITION_BEFORE_END:g.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},checkStartOfBlock:function(){var n=this.startContainer,u=this.startOffset;if(u&&n[0].nodeType==
e.NODE_TEXT)if(d.trim(n[0].nodeValue.substring(0,u)).length)return i;this.trim();n=new w(this.startContainer);u=this.clone();u.collapse(j);u.setStartAt(n.block||n.blockLimit,g.POSITION_AFTER_START);n=new h(u);n.evaluator=s(j);return n.checkBackward()},checkEndOfBlock:function(){var n=this.endContainer,u=this.endOffset;if(n[0].nodeType==e.NODE_TEXT)if(d.trim(n[0].nodeValue.substring(u)).length)return i;this.trim();n=new w(this.endContainer);u=this.clone();u.collapse(i);u.setEndAt(n.block||n.blockLimit,
g.POSITION_BEFORE_END);n=new h(u);n.evaluator=s(i);return n.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var n=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,n);return n},checkBoundaryOfElement:function(n,u){var B=this.clone();B[u==g.START?"setStartAt":"setEndAt"](n,u==g.START?g.POSITION_AFTER_START:g.POSITION_BEFORE_END);B=new h(B);B.evaluator=t;return B[u==g.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var n=this.startContainer,u=this.endContainer,B=this.startOffset,D=this.endOffset,C;if(n[0].nodeType==e.NODE_ELEMENT){C=n[0].childNodes.length;if(C>B)n=new o(n[0].childNodes[B]);else if(C<1)n=n._4e_previousSourceNode();else{for(n=n[0];n.lastChild;)n=n.lastChild;n=new o(n);n=n._4e_nextSourceNode()||n}}if(u[0].nodeType==e.NODE_ELEMENT){C=u[0].childNodes.length;if(C>D)u=(new o(u[0].childNodes[D]))._4e_previousSourceNode(j);else if(C<1)u=u._4e_previousSourceNode();else{for(u=
u[0];u.lastChild;)u=u.lastChild;u=new o(u)}}if(n._4e_position(u)&r.POSITION_FOLLOWING)n=u;return{startNode:n,endNode:u}},fixBlock:function(n,u){var B=this.createBookmark(),D=new o(this.document.createElement(u));this.collapse(n);this.enlarge(g.ENLARGE_BLOCK_CONTENTS);D[0].appendChild(this.extractContents());D._4e_trim();f.ie||D._4e_appendBogus();this.insertNode(D);this.moveToBookmark(B);return D},splitBlock:function(n){var u=new w(this.startContainer),B=new w(this.endContainer),D=u.block,C=B.block,
F=b;if(!u.blockLimit._4e_equals(B.blockLimit))return b;if(n!="br"){if(!D){D=this.fixBlock(j,n);C=(new w(this.endContainer)).block}C||(C=this.fixBlock(i,n))}n=D&&this.checkStartOfBlock();u=C&&this.checkEndOfBlock();this.deleteContents();if(D&&a._4e_equals(D,C))if(u){F=new w(this.startContainer);this.moveToPosition(C,g.POSITION_AFTER_END);C=b}else if(n){F=new w(this.startContainer);this.moveToPosition(D,g.POSITION_BEFORE_START);D=b}else{C=this.splitElement(D);!f.ie&&!d.inArray(D._4e_name(),["ul","ol"])&&
D._4e_appendBogus()}return{previousBlock:D,nextBlock:C,wasStartOfBlock:n,wasEndOfBlock:u,elementPath:F}},splitElement:function(n){if(!this.collapsed)return b;this.setEndAt(n,g.POSITION_BEFORE_END);var u=this.extractContents(),B=n._4e_clone(i);B[0].appendChild(u);B.insertAfter(n);this.moveToPosition(n,g.POSITION_AFTER_END);return B},moveToElementEditablePosition:function(n,u){var B,D=l.XHTML_DTD;if(D.$empty[n._4e_name()])return i;for(;n&&n[0].nodeType==e.NODE_ELEMENT;){if(B=n._4e_isEditable())this.moveToPosition(n,
u?g.POSITION_BEFORE_END:g.POSITION_AFTER_START);else if(D.$inline[n._4e_name()]){this.moveToPosition(n,u?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return j}if((n=D.$empty[n._4e_name()]?n[u?"_4e_previous":"_4e_next"](v):n[u?"_4e_last":"_4e_first"](v))&&n[0].nodeType==e.NODE_TEXT){this.moveToPosition(n,u?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return j}}return B},selectNodeContents:function(n){this.setStart(n,0);this.setEnd(n,n[0].nodeType==e.NODE_TEXT?n[0].nodeValue.length:n[0].childNodes.length)}});
var x={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},A=new h.whitespaces,E=new h.bookmark;l.Range=p;l.Range=p;var y=p.prototype;l.Utils.extern(y,{updateCollapsed:y.updateCollapsed,optimize:y.optimize,setStartAfter:y.setStartAfter,setEndAfter:y.setEndAfter,setStartBefore:y.setStartBefore,setEndBefore:y.setEndBefore,optimizeBookmark:y.optimizeBookmark,setStart:y.setStart,setEnd:y.setEnd,
setStartAt:y.setStartAt,setEndAt:y.setEndAt,execContentsAction:y.execContentsAction,collapse:y.collapse,clone:y.clone,getEnclosedNode:y.getEnclosedNode,shrink:y.shrink,getTouchedStartNode:y.getTouchedStartNode,createBookmark2:y.createBookmark2,createBookmark:y.createBookmark,moveToPosition:y.moveToPosition,trim:y.trim,insertNode:y.insertNode,moveToBookmark:y.moveToBookmark,getCommonAncestor:y.getCommonAncestor,enlarge:y.enlarge,checkStartOfBlock:y.checkStartOfBlock,checkEndOfBlock:y.checkEndOfBlock,
deleteContents:y.deleteContents,extractContents:y.extractContents,checkBoundaryOfElement:y.checkBoundaryOfElement,getBoundaryNodes:y.getBoundaryNodes,fixBlock:y.fixBlock,splitBlock:y.splitBlock,splitElement:y.splitElement,moveToElementEditablePosition:y.moveToElementEditablePosition,selectNodeContents:y.selectNodeContents})});
KISSY.Editor.add("domiterator",function(l){function p(h){if(!(arguments.length<1)){this.range=h;this.forceBrBreak=v;this.enlargeBr=t;this.enforceRealBlocks=v;this._||(this._={})}}var t=true,v=false,s=KISSY,q=s.UA,m=l.Walker,j=l.Range,i=l.RANGE,b=l.NODE,d=l.ElementPath,e=s.Node,g=s.DOM,r=/^[\r\n\t ]*$/;s.augment(p,{getNextParagraph:function(h){var a,c,f,k,w;if(!this._.lastNode){c=this.range.clone();c.shrink(i.SHRINK_ELEMENT,t);c.enlarge(this.forceBrBreak||!this.enlargeBr?i.ENLARGE_LIST_ITEM_CONTENTS:
i.ENLARGE_BLOCK_CONTENTS);var o=new m(c),z=m.bookmark(t,t);o.evaluator=z;this._.nextNode=o.next();o=new m(c);o.evaluator=z;o=o.previous();this._.lastNode=o._4e_nextSourceNode(t);if(this._.lastNode&&this._.lastNode[0].nodeType==b.NODE_TEXT&&!s.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){z=new j(c.document);z.moveToPosition(this._.lastNode,i.POSITION_AFTER_END);if(z.checkEndOfBlock()){z=new d(z.endContainer);this._.lastNode=(z.block||z.blockLimit)._4e_nextSourceNode(t)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new e(c.document.createTextNode(""));g.insertAfter(this._.lastNode[0],o[0])}c=null}z=this._.nextNode;o=this._.lastNode;for(this._.nextNode=null;z;){var x=v,A=z[0].nodeType!=b.NODE_ELEMENT,E=v;if(A){if(z[0].nodeType==b.NODE_TEXT)if(r.test(z[0].nodeValue))A=v}else{var y=z._4e_name();if(z._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(y=="br")A=t;else if(!c&&!z[0].childNodes.length&&y!="hr"){a=z;f=z._4e_equals(o);break}if(c){c.setEndAt(z,i.POSITION_BEFORE_START);if(y!="br")this._.nextNode=
z}x=t}else{if(z[0].firstChild){if(!c){c=new j(this.range.document);c.setStartAt(z,i.POSITION_BEFORE_START)}z=new e(z[0].firstChild);continue}A=t}}if(A&&!c){c=new j(this.range.document);c.setStartAt(z,i.POSITION_BEFORE_START)}f=(!x||A)&&z._4e_equals(o);if(c&&!x)for(;!z[0].nextSibling&&!f;){y=z.parent();if(y._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){x=t;f||y._4e_equals(o);break}z=y;A=t;f=z._4e_equals(o);E=t}A&&c.setEndAt(z,i.POSITION_AFTER_END);z=z._4e_nextSourceNode(E,null,o);if((f=!z)||x&&c)break}if(!a){if(!c){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}a=new d(c.startContainer);z=a.blockLimit;x={div:1,th:1,td:1};a=a.block;if((!a||!a[0])&&!this.enforceRealBlocks&&x[z._4e_name()]&&c.checkStartOfBlock()&&c.checkEndOfBlock())a=z;else if(!a||this.enforceRealBlocks&&a._4e_name()=="li"){a=new e(this.range.document.createElement(h||"p"));a[0].appendChild(c.extractContents());a._4e_trim();c.insertNode(a);k=w=t}else if(a._4e_name()!="li"){if(!c.checkStartOfBlock()||!c.checkEndOfBlock()){a=a._4e_clone(v);
a[0].appendChild(c.extractContents());a._4e_trim();w=c.splitBlock();k=!w.wasStartOfBlock;w=!w.wasEndOfBlock;c.insertNode(a)}}else if(!f)this._.nextNode=a._4e_equals(o)?null:c.getBoundaryNodes().endNode._4e_nextSourceNode(t,null,o)}if(k){c=new e(a[0].previousSibling);if(c[0]&&c[0].nodeType==b.NODE_ELEMENT)if(c._4e_name()=="br")c._4e_remove();else c[0].lastChild&&g._4e_name(c[0].lastChild)=="br"&&g._4e_remove(c[0].lastChild)}if(w){c=m.bookmark(v,t);k=new e(a[0].lastChild);if(k[0]&&k[0].nodeType==b.NODE_ELEMENT&&
k._4e_name()=="br")if(q.ie||k._4e_previous(c)||k._4e_next(c))k._4e_remove()}if(!this._.nextNode)this._.nextNode=f||a._4e_equals(o)?null:a._4e_nextSourceNode(t,null,o);return a}});j.prototype.createIterator=function(){return new p(this)}});
KISSY.Editor.add("selection",function(l){function p(x){this.document=this.document=x;this._={cache:{}};if(a){var A=this.getNative().createRange();if(!A||A.item&&A.item(0).ownerDocument!=x||A.parentElement&&A.parentElement().ownerDocument!=x)this.isInvalid=s}}function t(x){x=new p(x);return!x||x.isInvalid?m:x}function v(x){var A=x.document,E=new e(A.body),y=new e(A.documentElement);if(i.ie){if(i.ie<8||document.documentMode==7)y.on("click",function(M){(new e(M.target))._4e_name()==="html"&&x.getSelection().getRanges()[0].select()});
var n,u,B=1;y.on("mousedown",function(){B=0});y.on("mouseup",function(){B=1});E.on("focusin",function(M){if((new e(M.target))._4e_name()=="body")if(n){try{B&&n.select()}catch(Q){}n=m}});E.on("focus",function(){u=s;C()});E.on("beforedeactivate",function(M){if(!M.relatedTarget){u=q;B=1}});d.on(b._4e_getWin(A),"blur",function(){A&&A.selection.empty()});E.on("mousedown",function(){D()});E.on("mouseup",function(){u=s;setTimeout(function(){C(s)},0)});var D=function(){u=q},C=function(M){if(u){var Q=x.document,
R=x.getSelection(),T=R&&R.getType(),U=R&&R.getNative();if(M&&U&&T==g.SELECTION_NONE)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){C(s)},50);return}var V;if(!(U&&T==g.SELECTION_TEXT&&(V=b._4e_name(R.getStartElement()))&&V in{input:1,textarea:1})){n=U&&R.getRanges()[0];x._monitor()}}};E.on("keydown",D);E.on("keyup",function(){u=s;C()});d.on(A,"selectionchange",C)}else{d.on(A,"mouseup",x._monitor,x);d.on(A,"keyup",x._monitor,x)}var F={table:1,pre:1},L=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
P=l.Walker.whitespaces(s);x.on("selectionChange",function(M){var Q=M.path;M=(M=M.selection)&&M.getRanges()[0];if(!(!M||!M.collapsed||Q.block))if(Q.blockLimit._4e_name()=="body"){Q=M.fixBlock(s,"p");if(Q._4e_outerHtml().match(L)){var R=Q._4e_next(P);if(R&&R[0].nodeType==h.NODE_ELEMENT&&!F[R._4e_name()]){M.moveToElementEditablePosition(R);Q._4e_remove()}else if((R=Q._4e_previous(P))&&R[0].nodeType==h.NODE_ELEMENT&&!F[R._4e_name()]){M.moveToElementEditablePosition(R,R._4e_outerHtml().match(L)?q:s);Q._4e_remove()}}M.select();
a||x.notifySelectionChange()}})}l.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var s=true,q=false,m=null,j=KISSY,i=j.UA,b=j.DOM,d=j.Event,e=j.Node,g=l.SELECTION,r=l.RANGE,h=l.NODE,a=!window.getSelection,c=l.Walker,f=l.Range,k={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};j.augment(p,{getNative:!a?function(){var x=this._.cache;return x.nativeSel||(x.nativeSel=b._4e_getWin(this.document).getSelection())}:
function(){var x=this._.cache;return x.nativeSel||(x.nativeSel=this.document.selection)},getType:!a?function(){var x=this._.cache;if(x.type)return x.type;var A=g.SELECTION_TEXT,E=this.getNative();if(E){if(E.rangeCount==1){E=E.getRangeAt(0);var y=E.startContainer;if(y==E.endContainer&&y.nodeType==h.NODE_ELEMENT&&E.endOffset-E.startOffset===1&&k[y.childNodes[E.startOffset].nodeName.toLowerCase()])A=g.SELECTION_ELEMENT}}else A=g.SELECTION_NONE;return x.type=A}:function(){var x=this._.cache;if(x.type)return x.type;
var A=g.SELECTION_NONE;try{var E=this.getNative(),y=E.type;if(y=="Text")A=g.SELECTION_TEXT;if(y=="Control")A=g.SELECTION_ELEMENT;if(E.createRange().parentElement)A=g.SELECTION_TEXT}catch(n){}return x.type=A},getRanges:a?function(){var x=function(A,E){A=A.duplicate();A.collapse(E);for(var y=A.parentElement(),n=y.childNodes,u,B=0;B<n.length;B++){var D=n[B];if(D.nodeType==h.NODE_ELEMENT){u=A.duplicate();u.moveToElementText(D);D=u.compareEndPoints("StartToStart",A);var C=u.compareEndPoints("EndToStart",
A);u.collapse();if(D>0)break;else if(!D||C==1&&D==-1)return{container:y,offset:B};else if(!C)return{container:y,offset:B+1};u=m}}if(!u){u=A.duplicate();u.moveToElementText(y);u.collapse(q)}u.setEndPoint("StartToStart",A);u=u.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;u>0;)u-=n[--B].nodeValue.length}catch(F){u=0}return u===0?{container:y,offset:B}:{container:n[B],offset:-u}};return function(){var A=this._.cache;if(A.ranges)return A.ranges;var E=this.getNative(),y=E&&E.createRange(),n=this.getType();
if(!E)return[];if(n==g.SELECTION_TEXT){E=new f(this.document);n=x(y,s);E.setStart(new e(n.container),n.offset);n=x(y);E.setEnd(new e(n.container),n.offset);return A.ranges=[E]}else if(n==g.SELECTION_ELEMENT){A=A.ranges=[];for(n=0;n<y.length;n++){var u=y.item(n),B=u.parentNode,D=0;for(E=new f(this.document);D<B.childNodes.length&&B.childNodes[D]!=u;D++);E.setStart(new e(B),D);E.setEnd(new e(B),D+1);A.push(E)}return A}return A.ranges=[]}}():function(){var x=this._.cache;if(x.ranges)return x.ranges;
var A=[],E=this.getNative();if(!E)return[];for(var y=0;y<E.rangeCount;y++){var n=E.getRangeAt(y),u=new f(this.document);u.setStart(new e(n.startContainer),n.startOffset);u.setEnd(new e(n.endContainer),n.endOffset);A.push(u)}return x.ranges=A},getStartElement:function(){var x=this._.cache;if(x.startElement!==undefined)return x.startElement;var A,E=this.getNative();switch(this.getType()){case g.SELECTION_ELEMENT:return this.getSelectedElement();case g.SELECTION_TEXT:var y=this.getRanges()[0];if(y)if(!y.collapsed){for(y.optimize();s;){A=
y.startContainer;if(y.startOffset==(A[0].nodeType===h.NODE_ELEMENT?A[0].childNodes.length:A[0].nodeValue.length)&&!A._4e_isBlockBoundary())y.setStartAfter(A);else break}A=y.startContainer;if(A[0].nodeType!=h.NODE_ELEMENT)return A.parent();A=new e(A[0].childNodes[y.startOffset]);if(!A[0]||A[0].nodeType!=h.NODE_ELEMENT)return y.startContainer;for(y=A[0].firstChild;y&&y.nodeType==h.NODE_ELEMENT;){A=new e(y);y=y.firstChild}return A}if(a){y=E.createRange();y.collapse(s);A=y.parentElement()}else if((A=
E.anchorNode)&&A.nodeType!=h.NODE_ELEMENT)A=A.parentNode}return x.startElement=A?b._4e_wrap(A):m},getSelectedElement:function(){var x=this,A,E=x._.cache;if(E.selectedElement!==undefined)return E.selectedElement;if(a){A=x.getNative().createRange();A=A.item&&A.item(0)}A||(A=function(){for(var y=x.getRanges()[0],n,u,B=2;B&&!((n=y.getEnclosedNode())&&n[0].nodeType==h.NODE_ELEMENT&&k[n._4e_name()]&&(u=n));B--)y.shrink(r.SHRINK_ELEMENT);return u&&u[0]}());return E.selectedElement=b._4e_wrap(A)},reset:function(){this._.cache=
{}},selectElement:function(x){var A;if(a)try{A=this.document.body.createControlRange();A.addElement(x[0]);A.select()}catch(E){A=this.document.body.createTextRange();A.moveToElementText(x[0]);A.select()}finally{}else{A=this.document.createRange();A.selectNode(x[0]);x=this.getNative();x.removeAllRanges();x.addRange(A)}this.reset()},selectRanges:function(x){if(a){if(x.length>1){var A=x[x.length-1];x[0].setEnd(A.endContainer,A.endOffset);x.length=1}x[0]&&x[0].select()}else{A=this.getNative();if(!A)return;
A.removeAllRanges();for(var E=0;E<x.length;E++){var y=x[E],n=this.document.createRange(),u=y.startContainer;y.collapsed&&i.gecko&&i.gecko<1.09&&u[0].nodeType==h.NODE_ELEMENT&&!u[0].childNodes.length&&u[0].appendChild(this.document.createTextNode(""));n.setStart(u[0],y.startOffset);n.setEnd(y.endContainer[0],y.endOffset);A.addRange(n)}}this.reset()},createBookmarks2:function(x){for(var A=[],E=this.getRanges(),y=0;y<E.length;y++)A.push(E[y].createBookmark2(x));return A},createBookmarks:function(x,A){var E=
[],y=this.document,n;A=A||this.getRanges();for(var u=A.length,B=0;B<u;B++){E.push(n=A[B].createBookmark(x,s));var D=(x=n.serializable)?j.one("#"+n.startNode,y):n.startNode;n=x?j.one("#"+n.endNode,y):n.endNode;for(var C=B+1;C<u;C++){var F=A[C],L=F.startContainer,P=F.endContainer;b._4e_equals(L,D.parent())&&F.startOffset++;b._4e_equals(L,n.parent())&&F.startOffset++;b._4e_equals(P,D.parent())&&F.endOffset++;b._4e_equals(P,n.parent())&&F.endOffset++}}return E},selectBookmarks:function(x){for(var A=[],
E=0;E<x.length;E++){var y=new f(this.document);y.moveToBookmark(x[E]);A.push(y)}this.selectRanges(A);return this},getCommonAncestor:function(){var x=this.getRanges();return x[0].startContainer._4e_commonAncestor(x[x.length-1].endContainer)},scrollIntoView:function(){var x=this.getStartElement();x&&x._4e_scrollIntoView()},removeAllRanges:function(){var x=this.getNative();if(a)x&&x.clear();else x&&x.removeAllRanges()}});var w={table:1,tbody:1,tr:1},o=c.whitespaces(s),z=/\ufeff|\u00a0/;f.prototype.select=
f.prototype.select=!a?function(){var x=this.startContainer;this.collapsed&&x[0].nodeType==h.NODE_ELEMENT&&!x[0].childNodes.length&&x[0].appendChild(this.document.createTextNode(""));var A=this.document.createRange();A.setStart(x[0],this.startOffset);try{A.setEnd(this.endContainer[0],this.endOffset)}catch(E){if(E.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(s);A.setEnd(this.endContainer[0],this.endOffset)}else throw E;}x=t(this.document).getNative();x.removeAllRanges();x.addRange(A)}:
function(x){var A=this.collapsed,E,y;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var n=this.startContainer[0].childNodes[this.startOffset];if(n.nodeType==h.NODE_ELEMENT){(new p(this.document)).selectElement(new e(n));return}}if(this.startContainer[0].nodeType==h.NODE_ELEMENT&&this.startContainer._4e_name()in w||this.endContainer[0].nodeType==h.NODE_ELEMENT&&this.endContainer._4e_name()in w)this.shrink(r.SHRINK_ELEMENT,s);var u=this.createBookmark();n=u.startNode;
var B;if(!A)B=u.endNode;u=this.document.body.createTextRange();u.moveToElementText(n[0]);u.moveStart("character",1);if(B){x=this.document.body.createTextRange();x.moveToElementText(B[0]);u.setEndPoint("EndToEnd",x);u.moveEnd("character",-1)}else{for(E=n[0].nextSibling;E&&!o(E);)E=E.nextSibling;E=!(E&&E.nodeValue&&E.nodeValue.match(z))&&(x||!n[0].previousSibling||n[0].previousSibling&&b._4e_name(n[0].previousSibling)=="br");y=this.document.createElement("span");y.innerHTML="&#65279;";y=(new e(y)).insertBefore(n);
E&&b.insertBefore(this.document.createTextNode("\ufeff"),n)}this.setStartBefore(n);n._4e_remove();if(A){if(E){u.moveStart("character",-1);u.select();this.document.selection.clear()}else u.select();if(y){this.moveToPosition(y,r.POSITION_BEFORE_START);y._4e_remove()}}else{this.setEndBefore(B);B._4e_remove();u.select()}};p.getSelection=t;l.Selection=p;l.Selection=p;c=p.prototype;l.Utils.extern(c,{getNative:c.getNative,getType:c.getType,getRanges:c.getRanges,getStartElement:c.getStartElement,getSelectedElement:c.getSelectedElement,
reset:c.reset,selectElement:c.selectElement,selectRanges:c.selectRanges,createBookmarks2:c.createBookmarks2,createBookmarks:c.createBookmarks,getCommonAncestor:c.getCommonAncestor,scrollIntoView:c.scrollIntoView,selectBookmarks:c.selectBookmarks,removeAllRanges:c.removeAllRanges});l.on("instanceCreated",function(x){v(x.editor)})});
KISSY.Editor.add("styles",function(l){function p(G,K){for(var I in G)G[I]=G[I].replace(U,function(H,J){return K[J]})}function t(G,K){if(K){G=A.clone(G);p(G.attributes,K);p(G.styles,K)}var I=this.element=this.element=(G.element||"*").toLowerCase();this.type=this.type=I=="#"||Q[I]?n.STYLE_BLOCK:R[I]?n.STYLE_OBJECT:n.STYLE_INLINE;this._={definition:G}}function v(G,K){var I=K?this.removeFromRange:this.applyToRange;G.body.focus();for(var H=new B(G),J=H.getRanges(),O=0;O<J.length;O++)I.call(this,J[O]);
H.selectRanges(J)}function s(G,K){var I;I=G.element;if(I=="*")I="span";I=new L(K.createElement(I));return q(I,G)}function q(G,K){var I=K._.definition,H=I.attributes;I=t.getStyleText(I);if(H)for(var J in H)G.attr(J,H[J]);if(I)G[0].style.cssText=I;return G}function m(G){var K=G.createBookmark(o),I=G.createIterator();I.enforceRealBlocks=o;I.enlargeBr=o;for(var H,J=G.document;H=I.getNextParagraph();){var O=s(this,J);H=H;var N=O;O=N._4e_name=="pre";var S=H._4e_name=="pre",Z=!O&&S;if(O&&!S){S=H;N=N;Z=S.html();
Z=j(Z,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");Z=Z.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");Z=Z.replace(/([ \t\n\r]+|&nbsp;)/g," ");Z=Z.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){S=S[0].ownerDocument.createElement("div");S.appendChild(N[0]);N[0].outerHTML="<pre>"+Z+"</pre>";N=new L(S.firstChild);N._4e_remove()}else N.html(Z);N=N}else if(Z)N=b(i(H),N);else H._4e_moveChildren(N);H[0].parentNode.replaceChild(N[0],H[0]);if(O){H=N;O=void 0;if((O=H._4e_previousSourceNode(o,D.NODE_ELEMENT))&&O._4e_name()==
"pre"){N=j(O.html(),/\n$/,"")+"\n\n"+j(H.html(),/^\n/,"");if(P.ie)H[0].outerHTML="<pre>"+N+"</pre>";else H.html(N);O._4e_remove()}}}G.moveToBookmark(K)}function j(G,K,I){var H="",J="";G=G.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(O,N,S){N&&(H=N);S&&(J=S);return""});return H+G.replace(K,I)+J}function i(G){var K=[];j(G._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(I,H,J){return H+"</pre>"+J+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(I,H){K.push(H)});return K}function b(G,K){for(var I=K[0].ownerDocument.createDocumentFragment(),H=0;H<G.length;H++){var J=G[H];J=J.replace(/(\r\n|\r)/g,"\n");J=j(J,/^[ \t]*\n/,"");J=j(J,/\n$/,"");J=j(J,/^[ \t]+|[ \t]+$/g,function(N,S){return N.length==1?"&nbsp;":S?" "+Array(N.length).join("&nbsp;"):Array(N.length).join("&nbsp;")+" "});J=J.replace(/\n/g,"<br>");J=J.replace(/[ \t]{2,}/g,function(N){return Array(N.length).join("&nbsp;")+" "});var O=K._4e_clone();O.html(J);I.appendChild(O[0])}return I}
function d(G){var K=G.document;if(G.collapsed){K=s(this,K);G.insertNode(K);G.moveToPosition(K,u.POSITION_BEFORE_END)}else{var I=this.element,H=this._.definition,J,O=l.XHTML_DTD[I]||(J=o,l.XHTML_DTD.span),N=G.createBookmark();G.enlarge(u.ENLARGE_ELEMENT);G.trim();var S=G.createBookmark(),Z=S.startNode;S=S.endNode;for(var X=Z,$;X&&X[0];){var W=z;if(y._4e_equals(X,S)){X=x;W=o}else{var Y=X[0].nodeType,ca=Y==D.NODE_ELEMENT?X._4e_name():x;if(ca&&X.attr("_ke_bookmark")){X=X._4e_nextSourceNode(o);continue}if(!ca||
O[ca]&&(X._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(X))){var da=X.parent();if(da&&da[0]&&((l.XHTML_DTD[da._4e_name()]||l.XHTML_DTD.span)[I]||J)&&(!H.parentRule||H.parentRule(da))){if(!$&&(!ca||!l.XHTML_DTD.$removeEmpty[ca]||(X._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED)){$=
new F(K);$.setStartBefore(X)}if(Y==D.NODE_TEXT||Y==D.NODE_ELEMENT&&!X[0].childNodes.length){Y=X;var aa;for(ca=Y._4e_next(function(fa){return!fa.attr("_ke_bookmark")});!ca&&(aa=Y.parent(),O[aa._4e_name()])&&(aa._4e_position(Z)|C.POSITION_FOLLOWING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_FOLLOWING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(aa));)Y=aa;$.setEndAfter(Y);Y[0].nextSibling||(W=o)}}else W=o}else W=o;X=X._4e_nextSourceNode()}if(W&&$&&!$.collapsed){W=
s(this,K);for(Y=$.getCommonAncestor();W&&Y&&W[0]&&Y[0];){if(Y._4e_name()==I){for(var ba in H.attributes)W.attr(ba)==Y.attr(ba)&&W[0].removeAttribute(ba);for(var ea in H.styles)W._4e_style(ea)==Y._4e_style(ea)&&W._4e_style(ea,"");if(!W._4e_hasAttributes()){W=x;break}}Y=Y.parent()}if(W){W[0].appendChild($.extractContents());f(this,W);$.insertNode(W);W._4e_mergeSiblings();P.ie||W[0].normalize()}$=x}}Z._4e_remove();S._4e_remove();G.moveToBookmark(N);G.shrink(u.SHRINK_TEXT)}}function e(G){G.enlarge(u.ENLARGE_ELEMENT);
var K=G.createBookmark(),I=K.startNode;if(G.collapsed){for(var H=new M(I.parent()),J,O=0,N;O<H.elements.length&&(N=H.elements[O]);O++){if(N==H.block||N==H.blockLimit)break;if(this.checkElementRemovable(N)){var S=G.checkBoundaryOfElement(N,u.END),Z=!S&&G.checkBoundaryOfElement(N,u.START);if(Z||S){J=N;J.match=Z?"start":"end"}else{N._4e_mergeSiblings();N._4e_name()==this.element?a(this,N):k(N,h(this)[N._4e_name()])}}}if(J&&J[0]){N=I;for(O=0;;O++){S=H.elements[O];if(y._4e_equals(S,J))break;else if(S.match)continue;
else S=S._4e_clone();S[0].appendChild(N[0]);N=S}y[J.match=="start"?"insertBefore":"insertAfter"](N,J)}}else{var X=K.endNode,$=this;H=function(){for(var W=new M(I.parent()),Y=new M(X.parent()),ca=x,da=x,aa=0;aa<W.elements.length;aa++){var ba=W.elements[aa];if(ba==W.block||ba==W.blockLimit)break;if($.checkElementRemovable(ba))ca=ba}for(aa=0;aa<Y.elements.length;aa++){ba=Y.elements[aa];if(ba==Y.block||ba==Y.blockLimit)break;if($.checkElementRemovable(ba))da=ba}da&&X._4e_breakParent(da);ca&&I._4e_breakParent(ca)};
H();for(J=new L(I[0].nextSibling);J[0]!==X[0];){O=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==D.NODE_ELEMENT&&this.checkElementRemovable(J)){J._4e_name()==this.element?a(this,J):k(J,h(this)[J._4e_name()]);if(O[0].nodeType==D.NODE_ELEMENT&&O.contains(I)){H();O=new L(I[0].nextSibling)}}J=O}}G.moveToBookmark(K)}function g(G){var K={};G.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(I,H,J){K[H]=J});return K}function r(G,K){var I;if(K!==z){I=document.createElement("span");
I.style.cssText=G;I=I.style.cssText||""}else I=G;return I.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function h(G){if(G._.overrides)return G._.overrides;var K=G._.overrides={},I=G._.definition.overrides;if(I){A.isArray(I)||(I=[I]);for(var H=0;H<I.length;H++){var J=I[H],O,N;if(typeof J=="string")O=J.toLowerCase();else{O=J.element?J.element.toLowerCase():G.element;N=J.attributes}J=K[O]||(K[O]={});if(N){J=J.attributes=J.attributes||[];for(var S in N)J.push([S.toLowerCase(),
N[S]])}}}return K}function a(G,K){var I=G._.definition,H=E.mix(I.attributes,h(G)[K._4e_name()]);I=I.styles;var J=A.isEmptyObject(H)&&A.isEmptyObject(I),O;for(O in H)if(!((O=="class"||G._.definition.fullMatch)&&K.attr(O)!=c(O,H[O]))){J=J||!!K._4e_hasAttribute(O);K.removeAttr(O)}for(var N in I)if(!(G._.definition.fullMatch&&K._4e_style(N)!=c(N,I[N],o))){J=J||!!K._4e_style(N);K._4e_style(N,"")}w(K)}function c(G,K,I){var H=new L("<span>");H[I?"_4e_style":"attr"](G,K);return H[I?"_4e_style":"attr"](G)}
function f(G,K){for(var I=h(G),H=K.all(G.element),J=H.length;--J>=0;)a(G,new L(H[J]));for(var O in I)if(O!=G.element){H=K.all(O);for(J=H.length-1;J>=0;J--){var N=new L(H[J]);k(N,I[O])}}}function k(G,K){var I=K&&K.attributes;if(I)for(var H=0;H<I.length;H++){var J=I[H][0],O;if(O=G.attr(J)){var N=I[H][1];if(N===x||N.test&&N.test(O)||typeof N=="string"&&O==N)G[0].removeAttribute(J)}}w(G)}function w(G){if(!G._4e_hasAttributes()){var K=G[0].firstChild,I=G[0].lastChild;G._4e_remove(o);if(K){K.nodeType==
D.NODE_ELEMENT&&y._4e_mergeSiblings(K);I&&K!=I&&I.nodeType==D.NODE_ELEMENT&&y._4e_mergeSiblings(I)}}}var o=true,z=false,x=null,A=KISSY,E=l.Utils,y=A.DOM,n={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},u=l.RANGE,B=l.Selection,D=l.NODE,C=l.POSITION,F=l.Range,L=A.Node,P=A.UA,M=l.ElementPath,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},R={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},T=/\s*(?:;\s*|$)/g,U=/#\((.+?)\)/g;l.STYLE=n;t.prototype={apply:function(G){v.call(this,
G,z)},remove:function(G){v.call(this,G,o)},applyToRange:function(G){return(this.applyToRange=this.type==n.STYLE_INLINE?d:this.type==n.STYLE_BLOCK?m:this.type==n.STYLE_OBJECT?x:x).call(this,G)},removeFromRange:function(G){return(this.removeFromRange=this.type==n.STYLE_INLINE?e:x).call(this,G)},applyToObject:function(G){q(G,this)},checkElementRemovable:function(G,K){if(!G)return z;var I=this._.definition;if(G._4e_name()==this.element){if(!K&&!G._4e_hasAttributes())return o;var H=I._AC;if(H)I=H;else{H=
{};var J=0,O=I.attributes;if(O)for(var N in O){J++;H[N]=O[N]}if(O=t.getStyleText(I)){H.style||J++;H.style=O}H._length=J;I=I._AC=H}if(I._length){for(var S in I)if(S!="_length"){J=G.attr(S)||"";if(S=="style")a:{H=I[S];J=r(J,z);typeof H=="string"&&(H=g(H));typeof J=="string"&&(J=g(J));O=void 0;for(O in H)if(!(O in J&&(J[O]==H[O]||H[O]=="inherit"||J[O]=="inherit"))){H=z;break a}H=o}else H=I[S]==J;if(H){if(!K)return o}else if(K)return z}if(K)return o}else return o}if(S=h(this)[G._4e_name()]){if(!(I=S.attributes))return o;
for(H=0;H<I.length;H++){S=I[H][0];if(S=G.attr(S)){J=I[H][1];if(J===x||typeof J=="string"&&S==J||J.test&&J.test(S))return o}}}return z},checkActive:function(G){switch(this.type){case n.STYLE_BLOCK:return this.checkElementRemovable(G.block||G.blockLimit,o);case n.STYLE_OBJECT:case n.STYLE_INLINE:for(var K=G.elements,I=0,H;I<K.length;I++){H=K[I];if(!(this.type==n.STYLE_INLINE&&(y._4e_equals(H,G.block)||y._4e_equals(H,G.blockLimit))))if(!(this.type==n.STYLE_OBJECT&&!(H._4e_name()in R)))if(this.checkElementRemovable(H,
o))return o}}return z}};t.getStyleText=function(G){var K=G._ST;if(K)return K;K=G.styles;var I=G.attributes&&G.attributes.style||"",H="";if(I.length)I=I.replace(T,";");for(var J in K){var O=K[J],N=(J+":"+O).replace(T,";");if(O=="inherit")H+=N;else I+=N}if(I.length)I=r(I);I+=H;return G._ST=I};l.Style=t;l.Style=t;var V=t.prototype;l.Utils.extern(V,{apply:V.apply,remove:V.remove,applyToRange:V.applyToRange,removeFromRange:V.removeFromRange,applyToObject:V.applyToObject,checkElementRemovable:V.checkElementRemovable,
checkActive:V.checkActive})});
KISSY.Editor.add("htmlparser",function(){function l(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var p=KISSY,t=function(){},v=p.Editor,s=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,q={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},m=v.XHTML_DTD;p.augment(l,{onTagOpen:t,onTagClose:t,
onText:t,onCDATA:t,onComment:t,parse:function(j){for(var i,b,d=0,e;i=this._.htmlPartsRegex.exec(j);){b=i.index;if(b>d){d=j.substring(d,b);e?e.push(d):this.onText(d)}d=this._.htmlPartsRegex.lastIndex;if(b=i[1]){b=b.toLowerCase();if(e&&m.$cdata[b]){this.onCDATA(e.join(""));e=null}if(!e){this.onTagClose(b);continue}}if(e)e.push(i[0]);else if(b=i[3]){b=b.toLowerCase();if(!/="/.test(b)){var g={},r;i=i[4];var h=!!(i&&i.charAt(i.length-1)=="/");if(i)for(;r=s.exec(i);){var a=r[1].toLowerCase();r=r[2]||r[3]||
r[4]||"";g[a]=!r&&q[a]?a:r}this.onTagOpen(b,g,h);if(!e&&m.$cdata[b])e=[]}}else if(b=i[2])this.onComment(b)}j.length>d&&this.onText(j.substring(d,j.length))}});v.HtmlParser=l;v.HtmlParser=l});
KISSY.Editor.add("htmlparser-basicwriter",function(){function l(){this._={output:[]}}var p=KISSY,t=p.Editor,v=t.Utils;p.augment(l,{openTag:function(s){this._.output.push("<",s)},openTagClose:function(s,q){q?this._.output.push(" />"):this._.output.push(">")},attribute:function(s,q){if(typeof q=="string")q=v.htmlEncodeAttr(q);this._.output.push(" ",s,'="',q,'"')},closeTag:function(s){this._.output.push("</",s,">")},text:function(s){this._.output.push(s)},comment:function(s){this._.output.push("<!--",
s,"--\>")},write:function(s){this._.output.push(s)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(s){var q=this._.output.join("");s&&this.reset();return q}});t.HtmlParser.BasicWriter=l;t.HtmlParser.BasicWriter=l;p=l.prototype;t.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,write:p.write,reset:p.reset,getHtml:p.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function l(){l.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=q;this.sortAttributes=s;this._.indent=q;this._.indentation="";this._.rules={};var m=t.XHTML_DTD,j;for(j in v.mix({},m.$nonBodyContent,m.$block,m.$listItem,m.$tableContent))this.setRules(j,{indent:s,breakBeforeOpen:s,breakAfterOpen:s,breakBeforeClose:!m[j]["#"],breakAfterClose:s});this.setRules("br",
{breakAfterOpen:s});this.setRules("title",{indent:q,breakAfterOpen:q});this.setRules("style",{indent:q,breakBeforeClose:s});this.setRules("pre",{indent:q})}var p=KISSY,t=p.Editor,v=t.Utils,s=true,q=false;p.extend(l,t.HtmlParser.BasicWriter,{openTag:function(m){var j=this._.rules[m];if(this._.indent)this.indentation();else if(j&&j.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",m)},openTagClose:function(m,j){var i=this._.rules[m];if(j)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(i&&i.indent)this._.indentation+=this.indentationChars}i&&i.breakAfterOpen&&this.lineBreak()},attribute:function(m,j){if(typeof j=="string"){this.forceSimpleAmpersand&&(j=j.replace(/&amp;/g,"&"));j=v.htmlEncodeAttr(j)}this._.output.push(" ",m,'="',j,'"')},closeTag:function(m){var j=this._.rules[m];if(j&&j.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(j&&j.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",m,">");j&&j.breakAfterClose&&this.lineBreak()},text:function(m){if(this._.indent){this.indentation();m=v.ltrim(m)}this._.output.push(m)},comment:function(m){this._.indent&&this.indentation();this._.output.push("<!--",m,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=s},indentation:function(){this._.output.push(this._.indentation);this._.indent=q},setRules:function(m,j){var i=this._.rules[m];if(i)v.mix(i,
j);else this._.rules[m]=j}});t.HtmlParser.HtmlWriter=l;t.HtmlParser.HtmlWriter=l;p=l.prototype;t.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,lineBreak:p.lineBreak,indentation:p.indentation,setRules:p.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function l(){this.children=[];this.parent=v;this._={isBlockLike:p,hasInlineStarted:t}}var p=true,t=false,v=null,s=KISSY.Editor,q={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},m=KISSY,j=s.Utils,i=s.NODE,b=s.XHTML_DTD,d=j.mix({table:1,ul:1,ol:1,dl:1},b.table,b.ul,b.ol,b.dl),e=b.$list,g=b.$listItem;l.FromHtml=function(r,h){function a(u){var B;if(o.length>0)for(var D=0;D<o.length;D++){var C=o[D],F=C.name,L=b[F],P=x.name&&b[x.name];
if((!P||P[F])&&(!u||!L||L[u]||!b[u])){if(!B){c();B=1}C=C.clone();C.parent=x;x=C;o.splice(D,1);D--}}}function c(){for(;z.length;)x.add(z.shift())}function f(u,B,D){B=B||x||w;if(h&&!B.type){var C,F;if((C=u.attributes&&(F=u.attributes._ke_real_element_type)?F:u.name)&&!(C in b.$body)&&!(C in b.$nonBodyContent)){C=x;x=B;k.onTagOpen(h,{});B=x;if(D)x=C}}if(u._.isBlockLike&&u.name!="pre"){D=u.children.length;if((C=u.children[D-1])&&C.type==i.NODE_TEXT)if(F=j.rtrim(C.value))C.value=F;else u.children.length=
D-1}B.add(u);if(u.returnPoint){x=u.returnPoint;delete u.returnPoint}}var k=new s.HtmlParser,w=new l,o=[],z=[],x=w,A=t,E;k.onTagOpen=function(u,B,D){var C=new s.HtmlParser.Element(u,B);if(C.isUnknown&&D)C.isEmpty=p;if(b.$removeEmpty[u])o.push(C);else{if(u=="pre")A=p;else if(u=="br"&&A){x.add(new s.HtmlParser.Text("\n"));return}if(u=="br")z.push(C);else{var F=x.name,L=F&&(b[F]||(x._.isBlockLike?b.div:b.span));if(L&&!C.isUnknown&&!x.isUnknown&&!L[u]){L=t;var P;if(u in e&&F in e){F=x.children;(F=F[F.length-
1])&&F.name in g||f(F=new s.HtmlParser.Element("li"),x);E=x;P=F}else if(u==F)f(x,x.parent);else{if(d[F])E||(E=x);else{f(x,x.parent,p);q[F]||o.unshift(x)}L=p}x=P?P:x.returnPoint||x.parent;if(L){k.onTagOpen.apply(this,arguments);return}}a(u);c();C.parent=x;C.returnPoint=E;E=0;if(C.isEmpty)f(C);else x=C}}};k.onTagClose=function(u){for(var B=o.length-1;B>=0;B--)if(u==o[B].name){o.splice(B,1);return}for(var D=[],C=[],F=x;F.type&&F.name!=u;){F._.isBlockLike||C.unshift(F);D.push(F);F=F.parent}if(F.type){for(B=
0;B<D.length;B++){var L=D[B];f(L,L.parent)}x=F;if(x.name=="pre")A=t;F._.isBlockLike&&c();f(F,F.parent);if(F==x)x=x.parent;o=o.concat(C)}if(u=="body")h=t};k.onText=function(u){if(!x._.hasInlineStarted&&!A){u=j.ltrim(u);if(u.length===0)return}c();a();if(h&&(!x.type||x.name=="body")&&j.trim(u))this.onTagOpen(h,{});A||(u=u.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));x.add(new s.HtmlParser.Text(u))};k.onCDATA=function(){};k.onComment=function(u){x.add(new s.HtmlParser.Comment(u))};k.parse(r);for(c();x.type;){var y=
x.parent,n=x;if(h&&(!y.type||y.name=="body")&&!b.$body[n.name]){x=y;k.onTagOpen(h,{});y=x}y.add(n);x=y}return w};m.augment(l,{add:function(r){var h=this.children.length;if(h=h>0&&this.children[h-1]||v){if(r._.isBlockLike&&h.type==i.NODE_TEXT){h.value=j.rtrim(h.value);if(h.value.length===0){this.children.pop();this.add(r);return}}h.next=r}r.previous=h;r.parent=this;this.children.push(r);this._.hasInlineStarted=r.type==i.NODE_TEXT||r.type==i.NODE_ELEMENT&&!r._.isBlockLike},writeHtml:function(r,h){var a;
this.filterChildren=this.filterChildren=function(){var c=new s.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,c,h,p);c=c.getHtml();this.children=(new l.FromHtml(c)).children;a=1};!this.name&&h&&h.onFragment(this);this.writeChildrenHtml(r,a?v:h)},writeChildrenHtml:function(r,h){for(var a=0;a<this.children.length;a++)this.children[a].writeHtml(r,h)}});s.HtmlParser.Fragment=l;s.HtmlParser.Fragment=l;l.FromHtml=l.FromHtml;m=l.prototype;s.Utils.extern(m,{add:m.add,writeHtml:m.writeHtml,writeChildrenHtml:m.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function l(q,m){this.name=q;this.attributes=m||(m={});this.children=[];var j=m._ke_real_element_type||q,i=p.XHTML_DTD;j=!!(i.$nonBodyContent[j]||i.$block[j]||i.$listItem[j]||i.$tableContent[j]||i.$nonEditable[j]||j=="br");var b=!!i.$empty[q];this.isEmpty=b;this.isUnknown=!i[q];this._={isBlockLike:j,hasInlineStarted:b||!j}}var p=KISSY.Editor,t=p.NODE,v=function(q,m){q=q[0];m=m[0];return q<m?-1:q>m?1:0};KISSY.augment(l,{type:t.NODE_ELEMENT,add:p.HtmlParser.Fragment.prototype.add,
clone:function(){return new l(this.name,this.attributes)},writeHtml:function(q,m){var j=this.attributes,i=this,b=i.name,d,e,g,r;i.filterChildren=function(){if(!r){var c=new p.HtmlParser.BasicWriter;p.HtmlParser.Fragment.prototype.writeChildrenHtml.call(i,c,m);i.children=(new p.HtmlParser.Fragment.FromHtml(c.getHtml())).children;r=1}};i.filterChildren=i.filterChildren;if(m){for(;;){if(!(b=m.onElementName(b)))return;i.name=b;if(!(i=m.onElement(i)))return;i.parent=this.parent;if(i.name==b)break;if(i.type!=
t.NODE_ELEMENT){i.writeHtml(q,m);return}b=i.name;if(!b){this.writeChildrenHtml.call(i,q,r?null:m);return}}j=i.attributes}q.openTag(b,j);for(var h=[],a=0;a<2;a++)for(d in j){e=d;g=j[d];if(a==1)h.push([d,g]);else if(m){for(;;)if(e=m.onAttributeName(d))if(e!=d){delete j[d];d=e}else break;else{delete j[d];break}if(e)if((g=m.onAttribute(i,e,g))===false)delete j[e];else j[e]=g}}q.sortAttributes&&h.sort(v);j=h.length;for(a=0;a<j;a++){d=h[a];q.attribute(d[0],d[1])}q.openTagClose(b,i.isEmpty);if(!i.isEmpty){this.writeChildrenHtml.call(i,
q,r?null:m);q.closeTag(b)}},writeChildrenHtml:function(){p.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});p.HtmlParser.Element=l;p.HtmlParser.Element=l;var s=l.prototype;p.Utils.extern(s,{type:s.type,add:s.add,clone:s.clone,writeHtml:s.writeHtml,writeChildrenHtml:s.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function l(d){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};d&&this.addRules(d,10)}function p(d,e){for(var g=0;d&&g<e.length;g++){var r=e[g];d=d.replace(r[0],r[1])}return d}function t(d,e,g){if(typeof e=="function")e=[e];var r,h;h=d.length;var a=e&&e.length;if(a){for(r=0;r<h&&d[r].pri<g;r++);for(h=a-1;h>=0;h--)if(a=e[h]){a.pri=g;d.splice(r,0,a)}}}function v(d,e,g){if(e)for(var r in e){var h=d[r];d[r]=s(h,e[r],
g);h||d.$length++}}function s(d,e,g){if(e){e.pri=g;if(d){if(d.splice)t(d,e,g);else{d=d.pri>g?[e,d]:[d,e];d.filter=q}return d}else return e.filter=e}}function q(d){for(var e=d.type||d instanceof j.HtmlParser.Fragment,g=0;g<this.length;g++){if(e)var r=d.type,h=d.name;var a=this[g].apply(window,arguments);if(a===b)return a;if(e){if(a&&(a.name!=h||a.type!=r))return a}else if(typeof a!="string")return a;a!=undefined&&(d=a)}return d}var m=KISSY,j=m.Editor,i=j.NODE,b=false;m.augment(l,{addRules:function(d,
e){if(typeof e!="number")e=10;t(this._.elementNames,d.elementNames,e);t(this._.attributeNames,d.attributeNames,e);v(this._.elements,d.elements,e);v(this._.attributes,d.attributes,e);this._.text=s(this._.text,d.text,e)||this._.text;this._.comment=s(this._.comment,d.comment,e)||this._.comment;this._.root=s(this._.root,d.root,e)||this._.root},onElementName:function(d){return p(d,this._.elementNames)},onAttributeName:function(d){return p(d,this._.attributeNames)},onText:function(d){var e=this._.text;
return e?e.filter(d):d},onComment:function(d,e){var g=this._.comment;return g?g.filter(d,e):d},onFragment:function(d){var e=this._.root;return e?e.filter(d):d},onElement:function(d){for(var e=[this._.elements["^"],this._.elements[d.name],this._.elements.$],g,r=0;r<3;r++)if(g=e[r]){g=g.filter(d,this);if(g===b)return null;if(g&&g!=d)return this.onNode(g);if(d.parent&&!d.name)break}return d},onNode:function(d){var e=d.type;return e==i.NODE_ELEMENT?this.onElement(d):e==i.NODE_TEXT?new j.HtmlParser.Text(this.onText(d.value)):
null},onAttribute:function(d,e,g){if(e=this._.attributes[e]){d=e.filter(g,d,this);if(d===b)return b;if(typeof d!="undefined")return d}return g}});j.HtmlParser.Filter=l;m=l.prototype;j.Utils.extern(m,{addRules:m.addRules,onElementName:m.onElementName,onAttributeName:m.onAttributeName,onText:m.onText,onComment:m.onComment,onFragment:m.onFragment,onElement:m.onElement,onNode:m.onNode,onAttribute:m.onAttribute});j.HtmlParser.Filter=l});
KISSY.Editor.add("htmlparser-text",function(){function l(s){this.value=s;this._={isBlockLike:v}}var p=KISSY,t=p.Editor,v=false;p.augment(l,{type:t.NODE.NODE_TEXT,writeHtml:function(s,q){var m=this.value;q&&!(m=q.onText(m,this))||s.text(m)}});t.HtmlParser.Text=l;t.HtmlParser.Text=l});
KISSY.Editor.add("htmlparser-comment",function(){function l(v){this.value=v;this._={isBlockLike:false}}var p=KISSY.Editor,t=p.NODE;p.HtmlParser.Comment=l;p.HtmlParser.Comment=l;l.prototype={constructor:l,type:t.NODE_COMMENT,writeHtml:function(v,s){var q=this.value;if(s){if(!(q=s.onComment(q,this)))return;if(typeof q!="string"){q.parent=this.parent;q.writeHtml(v,s);return}}v.comment(q)}}});
KISSY.Editor.add("bubbleview",function(){var l=KISSY.Editor,p=KISSY,t=p.Event,v=p.DOM;if(!l.BubbleView){var s=p.UIBase.create(l.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var m=this._selectedEl,j=m._4e_getOffset(document);j.top+=m.height()+5;s.superclass.show.call(this);this.set("xy",[j.left,j.top])}},{ATTRS:{focus4e:false,zIndex:{value:l.baseZIndex(l.zIndexManager.BUBBLE_VIEW)}}}),q={};s.attach=function(m){var j=m.pluginName;p.mix(m,q[j].cfg,
false);var i=m.pluginContext,b=m.func,d=m.editor,e=m.bubble;d.on("selectionChange",function(g){g=g.path;var r=g.elements;if(g&&r)if(g=g.lastElement)if(g=b(g)){r=q[j];if(!r.bubble){r.bubble=new s({autoRender:true});r.cfg.init&&r.cfg.init.call(r.bubble)}e=r.bubble;e._selectedEl=g;e._plugin=i;e.hide();e.show()}else if(e){e._selectedEl=e._plugin=null;e.hide()}});t.on(v._4e_getWin(d.document),"scroll blur",function(){e&&e.hide()})};s.register=function(m){var j=m.pluginName;q[j]=q[j]||{cfg:m};t.on(document,
"click",function(){m.bubble&&m.bubble.hide()});m.editor&&s.attach(m)};l.BubbleView=s}});
KISSY.Editor.add("button",function(){var l=KISSY,p=l.Editor;if(!p.TripleButton){var t=l.UIBase.create([l.UIBase.Box],{bindUI:function(){var v=this,s=v.get("el");s.on("click",v._action,v);s.on("mousedown",function(){v.get("state")=="off"&&s.addClass("ke-triplebutton-active")});s.on("mouseup mouseleave",function(){v.get("state")=="off"&&s.hasClass("ke-triplebutton-active")&&setTimeout(function(){s.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"))},
_uiSetContentCls:function(v){var s=this.get("el");if(v!==undefined){s.html("<span class='ke-toolbar-item "+v+"'>");s._4e_unselectable()}},_uiSetText:function(v){var s=this.get("el");v!==undefined&&s.html(v)},_uiSetState:function(v){this["_"+v]()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(v){this.fire(this.get("state")+"Click",v);v.type=this.get("state")+"Click";
this.fire("click",v);v.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-disabled");v.addClass("ke-triplebutton-on")},_off:function(){var v=this.get("el");v.removeClass("ke-triplebutton-on ke-triplebutton-disabled");v.addClass("ke-triplebutton-off")},_disabled:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-on");v.addClass("ke-triplebutton-disabled")}},
{ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elAttrs:{value:{hideFocus:true,tabIndex:-1}},elTagName:{value:"a"},title:{},contentCls:{},text:{}}});t.ON="on";t.OFF="off";t.DISABLED="disabled";t.ON_CLASS="ke-triplebutton-on";t.OFF_CLASS="ke-triplebutton-off";t.DISABLED_CLASS="ke-triplebutton-disabled";p.TripleButton=t;p.prototype.addButton=function(v,s){var q=this,m=new t({render:q.toolBarDiv,autoRender:true,title:s.title,text:s.text,contentCls:s.contentCls}),j={btn:m,
editor:q,cfg:s,call:function(){var i=l.makeArray(arguments),b=i.shift();return s[b].apply(j,i)},reload:function(i){l.mix(s,i);m.enable();q.on("selectionChange",function(){q.getMode()!=p.SOURCE_MODE&&s.selectionChange&&s.selectionChange.apply(j,arguments)});m.on("click",function(b){var d=b.type;s[d]&&s[d].apply(j,arguments)});if(s.mode==p.WYSIWYG_MODE){q.on("wysiwygmode",m.enable,m);q.on("sourcemode",m.disable,m)}s.init&&s.init.call(j)}};s.loading?m.disable():j.reload();return j}}});
KISSY.Editor.add("clipboard",function(l){var p=KISSY,t=p.Editor,v=p.Node,s=p.UA,q=t.Range,m=t.RANGE,j=p.Event;t.Paste||function(){function i(c){this.editor=c;this._init()}function b(c){if(!(!s.ie||c.document.compatMode=="BackCompat")){var f=c.getSelection(),k;if(f.getType()==h.SELECTION_ELEMENT&&(k=f.getSelectedElement())){var w=f.getRanges()[0],o=new v(c.document.createTextNode(""));o.insertBefore(k);w.setStartBefore(o);w.setEndAfter(k);f.selectRanges([w]);setTimeout(function(){if(k.parent()){o.remove();
f.selectElement(k)}},0)}}}p.augment(i,{_init:function(){var c=this.editor;s.ie?j.on(c.document,"keydown",this._paste,this):j.on(c.document,"paste",this._paste,this);c.addCommand("copy",new r("copy"));c.addCommand("cut",new r("cut"));c.addCommand("paste",new r("paste"))},_paste:function(c){if(!(c.type==="keydown"&&!(c.keyCode===86&&(c.ctrlKey||c.metaKey)))){var f=this,k=f.editor,w=k.document;if(f._running)c.halt();else{var o=k.getSelection();c=new q(w);var z=new v(s.webkit?"<body></body>":"<div></div>",
null,w);s.webkit&&z[0].appendChild(w.createTextNode("\u00a0"));w.body.appendChild(z[0]);z.css({position:"absolute",top:o.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});z.css("left","-1000px");var x=o.createBookmarks();c.setStartAt(z,m.POSITION_AFTER_START);c.setEndAt(z,m.POSITION_BEFORE_END);c.select(true);f._running=true;setTimeout(function(){z._4e_remove();var A;z=s.webkit&&(A=z._4e_first())&&A.hasClass("Apple-style-span")?A:z;o.selectBookmarks(x);k.insertHtml(z.html());
f._running=false},0)}}}});t.Paste=i;var d=function(c,f){var k=c.document,w=new v(k.body),o=false,z=function(){o=true};w.on(f,z);(s.ie>7?k:k.selection.createRange()).execCommand(f);w.detach(f,z);return o},e=s.ie?function(c,f){return d(c,f)}:function(c,f){try{return c.document.execCommand(f)}catch(k){return false}},g={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},r=function(c){this.type=
c;this.canUndo=this.type=="cut"};r.prototype={exec:function(c){this.type=="cut"&&b(c);(c=e(c,this.type))||alert(g[this.type]);return c}};var h=t.Selection,a={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};t.on("contextmenu",function(c){var f=c.contextmenu,k=f.cfg.editor,w=f.elDom,o={copy:0,cut:0,paste:0},z;for(z in o){if(!o.hasOwnProperty(z))break;o[z]=w.one(".ke-paste-"+z);(function(x){var A=o[x];if(!A){A=(new v("<a href='#'class='ke-paste-"+x+"'>"+a[x]+"</a>")).appendTo(w);A.on("click",function(E){E.halt();if(!A.hasClass("ke-menuitem-disable")){f.hide();
setTimeout(function(){k.execCommand(x)},30)}})}o[x]=A})(z);c=o[z];(k.document.queryCommandEnabled(z)?true:false)?c.removeClass("ke-menuitem-disable"):c.addClass("ke-menuitem-disable")}})}();l.ready(function(){new t.Paste(l)})});
KISSY.Editor.add("color",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.cfg.pluginConfig;false!==t.forecolor&&function(){var v=l.addButton("color",{styles:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},mode:p.WYSIWYG_MODE,title:"\u6587\u672c\u989c\u8272",loading:true,contentCls:"ke-toolbar-color"});p.use("colorsupport",function(){v.reload(p.ColorSupport)})}();false!==t.bgcolor&&function(){var v=l.addButton("color",{styles:{element:"span",styles:{"background-color":"#(color)"}},
title:"\u80cc\u666f\u989c\u8272",mode:p.WYSIWYG_MODE,loading:true,contentCls:"ke-toolbar-bgcolor"});p.use("colorsupport",function(){v.reload(p.ColorSupport)})}()})});
KISSY.Editor.add("colorsupport",function(){function l(){if(!i){i="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var b=0;b<3;b++){i+="<div class='ke-color-palette'><table>";for(var d=j[b],e=d.length/8,g=0;g<e;g++){i+="<tr>";for(var r=0;r<8;r++){var h="#"+d[8*g+r];i+="<td>";i+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+h+"'></a>";i+="</td>"}i+="</tr>"}i+="</table></div>"}i+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
var p=KISSY,t=p.Editor,v=p.Node,s=p.Event,q=t.Overlay,m=p.DOM;m.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var j=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],i;t.ColorSupport={offClick:function(b){var d=this.cfg,e=this.colorWin;e&&e.get("visible")?e.hide():d._prepare.call(this,b)},_prepare:function(){var b=this,d=b.cfg,e=document,g=b.btn,r=b.editor,h;l();b.colorWin=new q({elCls:"ks-popup",content:i,focus4e:false,autoRender:true,width:"170px",zIndex:r.baseZIndex(t.zIndexManager.POPUP_MENU)});var a=b.colorWin;h=a.get("contentEl");h.on("click",d._selectColor,b);s.on(e,"click",d._hidePanel,b);s.on(r.document,
"click",d._hidePanel,b);a.on("show",g.bon,g);a.on("hide",g.boff,g);h.one(".ke-color-others").on("click",function(c){c.halt();a.hide();r.useDialog("color/dialog",function(f){f.show(b)})});d._prepare=d._show;d._show.call(b)},_show:function(){var b=this.btn.get("el"),d=this.colorWin,e=parseInt(d.get("width")),g=m.viewportWidth();d.align(b,["bl","tl"],[0,2]);d.get("x")+e>g-30&&d.set("x",g-30-e);d.show()},_hidePanel:function(b){var d=this.btn.get("el");b=new v(b.target);var e=this.colorWin;d._4e_equals(b)||
d.contains(b)||e.hide()},_selectColor:function(b){b.halt();var d=this.cfg;b=new v(b.target);if(b._4e_name()=="a"&&!b.hasClass("ke-button")){d._applyColor.call(this,b._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(b){var d=this.editor,e=d.document,g=this.cfg.styles;d.fire("save");b?(new t.Style(g,{color:b})).apply(e):(new t.Style(g,{color:"inherit"})).remove(e);d.fire("save")}}});
KISSY.Editor.add("contextmenu",function(){function l(b){this.cfg=b;t.Utils.lazyRun(this,"_prepareShow","_realShow")}function p(b,d){for(var e=0;e<d.length;e++){var g=d[e];if(v.isFunction(g)){if(g(new s(b)))return true}else if(q.test(b,g))return true}return false}var t=KISSY.Editor,v=KISSY,s=v.Node,q=v.DOM,m=v.Event;if(!t.ContextMenu){l.ATTRS={editor:{}};var j=[];l.register=function(b){var d=new l(b),e=b.editor.document;j.push({doc:e,rules:b.rules||[],instance:d});if(!e.ke_contextmenu){e.ke_contextmenu=
1;m.on(e,"mousedown",l.hide);m.on(e,"contextmenu",function(g){l.hide.call(this);for(var r=new s(g.target);r;){var h=false;if(r._4e_name()=="body")break;for(var a=0;a<j.length;a++){var c=j[a].instance,f=j[a].rules;if(e===j[a].doc&&p(r[0],f)){g.preventDefault();h=true;var k=g.pageX,w=g.pageY;if(!k){a=r._4e_getOffset();k=a.left;w=a.top}setTimeout(function(){c.show(t.Utils.getXY(k,w,e,document))},30);break}}if(h)break;r=r.parent()}})}return d};l.hide=function(){for(var b=0;b<j.length;b++){var d=j[b].instance;
this===j[b].doc&&d.hide()}};var i=t.Overlay;v.augment(l,{_init:function(){var b=this,d=b.cfg,e=d.funcs;b.el=new i({content:"<div>",autoRender:true,width:d.width,elCls:"ke-menu"});b.elDom=b.el.get("contentEl").one("div");d=b.elDom;for(var g in e){var r=new s("<a href='#'>"+g+"</a>");d[0].appendChild(r[0]);(function(h,a){h._4e_unselectable();h.on("click",function(c){b.hide();c.halt();setTimeout(a,30)})})(r,e[g])}},hide:function(){this.el&&this.el.hide()},_realShow:function(b){t.fire("contextmenu",{contextmenu:this});
this.el.set("xy",[b.left,b.top]);this.el.show()},_prepareShow:function(){this._init()},show:function(b){this._prepareShow(b)}});t.ContextMenu=l}});KISSY.Editor.add("draft",function(l){var p=KISSY.Editor;l.ready(function(){p.use("draft/support",function(){p.storeReady(function(){new p.Draft(l)})})})});
KISSY.Editor.add("draft/support",function(){function l(b,d,e){for(b+="";b.length<d;)b=e+b;return b}function p(b){if(v.isNumber(b))b=new Date(b);return b instanceof Date?[b.getFullYear(),"-",l(b.getMonth()+1,2,"0"),"-",l(b.getDate(),2,"0")," ",l(b.getHours(),2,"0"),":",l(b.getMinutes(),2,"0"),":",l(b.getSeconds(),2,"0")].join(""):b}function t(b){this.editor=b;this._init()}var v=KISSY,s=v.Editor,q=v.Node,m=v.Event,j=v.JSON,i=window[s.STORE];v.augment(t,{_init:function(){var b=this,d=b.editor,e=d.statusDiv,
g=d.cfg.pluginConfig;g.draft=g.draft||{};b.draftInterval=g.draft.interval=g.draft.interval||5;b.draftLimit=g.draft.limit=g.draft.limit||5;e=(new q("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+g.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);b.timeTip=(new q("<span class='ke-draft-time'>")).appendTo(e);var r=(new q("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(e),h=new s.Select({container:e,
menuContainer:document.body,doc:d.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),a=i.getItem("ke-draft-save"),c=[];b.versions=h;if(a)c=v.isString(a)?j.parse(decodeURIComponent(a)):a;b.drafts=c;b.sync();r.on("click",function(){b.save(false)});(function(){var f=d.textarea[0].form;f&&m.on(f,"submit",function(){b.save(false)})})();setInterval(function(){b.save(true)},b.draftInterval*60*1E3);h.on("click",b.recover,b);b.holder=e;if(g.draft.helpHtml){g=new s.TripleButton({cls:"ke-draft-help",
title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:e});g.on("click",function(){b._prepareHelp()});s.Utils.lazyRun(b,"_prepareHelp","_realHelp");b.helpBtn=g.el}b._holder=e},_prepareHelp:function(){var b=this,d=b.editor,e=b.helpBtn,g=new q(d.cfg.pluginConfig.draft.helpHtml||""),r=new q("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
g.append(r);g.css({border:"1px solid #ACB4BE","text-align":"left"});b._help=new v.Overlay({content:g,autoRender:true,width:g.width()+"px",mask:false});b._help.el.css("border","none");b._help.arrow=r;m.on([document,d.document],"click",function(h){h=new q(h.target);h[0]==e[0]||e.contains(h)||b._help.hide()})},_realHelp:function(){var b=this._help,d=this.helpBtn,e=b.arrow;b.show();d=d.offset();b.el.offset({left:d.left-b.el.width()+17,top:d.top-b.el.height()-7});e.offset({left:d.left-2,top:d.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var b=this.draftLimit,d=this.timeTip,e=this.versions,g=this.drafts;g.length>b&&g.splice(0,g.length-b);b=[];for(var r,h=0;h<g.length;h++){r=g[h];r=(r.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+p(r.date);b.push({name:r,value:h})}e.set("items",b.reverse());d.html(r);i.setItem("ke-draft-save",encodeURIComponent(j.stringify(g)))},save:function(b){var d=this.drafts,e=this.editor.getData(true);if(e){if(d[d.length-
1]&&e==d[d.length-1].content)d.length-=1;this.drafts=d.concat({content:e,date:(new Date).getTime(),auto:b});this.sync()}},recover:function(b){var d=this.editor,e=this.drafts;b=b.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+p(e[b].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){d.fire("save");d.setData(e[b].content);d.fire("save")}}});s.Draft=t});
KISSY.Editor.add("elementpaths",function(l){var p=KISSY.Editor,t=KISSY,v=t.Node,s=t.DOM;p.ElementPaths||function(){function q(m){this.cfg=m;this._cache=[];this._init()}s.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");t.augment(q,{_init:function(){var m=this.cfg.editor;this.holder=new v("<span>");this.holder.appendTo(m.statusDiv);m.on("selectionChange",this._selectionChange,this);
p.Utils.sourceDisable(m,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(m){var j=this.cfg.editor,i=this.holder;m=m.path.elements;var b,d;b=this._cache;for(d=0;d<b.length;d++){b[d].detach("click");b[d]._4e_remove()}this._cache=[];for(d=0;d<m.length;d++){b=m[d];var e=new v("<a href='#' class='elementpath'>"+(b.attr("_ke_real_element_type")||b._4e_name())+"</a>");this._cache.push(e);(function(g){e.on("click",
function(r){r.halt();j.focus();setTimeout(function(){j.getSelection().selectElement(g)},50)})})(b);i.prepend(e)}}});p.ElementPaths=q}();l.ready(function(){new p.ElementPaths({editor:l})})});
KISSY.Editor.add("enterkey",function(l){var p=KISSY.Editor,t=KISSY,v=t.UA,s=/^h[1-6]$/,q=p.XHTML_DTD,m=t.Node,j=t.Event,i=p.Walker,b=p.ElementPath;p.enterBlock||function(){function d(e){j.on(e.document,"keydown",function(g){if(g.keyCode===13)if(!g.shiftKey){e.fire("save");var r=e.execCommand("enterBlock");e.fire("save");r!==false&&g.preventDefault()}})}d.enterBlock=function(e){var g;g=e.getSelection().getRanges();for(var r=g.length-1;r>0;r--)g[r].deleteContents();g=g[0];r=g.document;if(g.checkStartOfBlock()&&
g.checkEndOfBlock()){var h=(new b(g.startContainer)).block;if(h&&(h._4e_name()=="li"||h.parent()._4e_name()=="li"))if(e.hasCommand("outdent")){e.fire("save");e.execCommand("outdent");e.fire("save");return}else return false}var a=g.splitBlock("p");if(a){e=a.previousBlock;h=a.nextBlock;var c=a.wasStartOfBlock,f=a.wasEndOfBlock,k;if(h){k=h.parent();if(k._4e_name()=="li"){h._4e_breakParent(k);h._4e_move(h._4e_next(),true)}}else if(e&&(k=e.parent())&&k._4e_name()=="li"){e._4e_breakParent(k);g.moveToElementEditablePosition(e._4e_next());
e._4e_move(e._4e_previous())}if(!c&&!f){if(h._4e_name()=="li"&&(k=h._4e_first(i.invisible(true)))&&t.inArray(k._4e_name(),["ul","ol"]))(v.ie?new m(r.createTextNode("\u00a0")):new m(r.createElement("br"))).insertBefore(k);h&&g.moveToElementEditablePosition(h)}else{var w;if(e){if(e._4e_name()=="li"||!s.test(e._4e_name()))w=e._4e_clone()}else if(h)w=h._4e_clone();w||(w=new m("<p>",null,r));if(k=a.elementPath){a=0;for(var o=k.elements.length;a<o;a++){var z=k.elements[a];if(z._4e_equals(k.block)||z._4e_equals(k.blockLimit))break;
if(q.$removeEmpty[z._4e_name()]){z=z._4e_clone();w._4e_moveChildren(z);w.append(z)}}}v.ie||w._4e_appendBogus();g.insertNode(w);if(v.ie&&c&&(!f||!e[0].childNodes.length)){g.moveToElementEditablePosition(f?e:w);g.select()}g.moveToElementEditablePosition(c&&!f?h:w)}if(!v.ie)if(h){w=new m(r.createElement("span"));w.html("&nbsp;");g.insertNode(w);w._4e_scrollIntoView();g.deleteContents()}else w._4e_scrollIntoView();g.select()}};p.EnterKey=d}();l.ready(function(){l.addCommand("enterBlock",{exec:p.EnterKey.enterBlock});
p.EnterKey(l)})});
KISSY.Editor.add("fakeobjects",function(l){var p=KISSY.Editor,t=KISSY,v=t.Node,s=p.NODE,q=p.Config.base+"theme/spacer.gif",m=p.HtmlParser;p=t.Editor;var j=(l=l.htmlDataProcessor)&&l.htmlFilter,i={elements:{$:function(b){var d=b.attributes;if((d=(d=(d=d&&d._ke_realelement)&&new m.Fragment.FromHtml(decodeURIComponent(d)))&&d.children[0])&&b.attributes._ke_resizable){var e=b.attributes.style;if(e){var g=/(?:^|\s)width\s*:\s*(\d+)/i.exec(e);b=g&&g[1];e=(g=/(?:^|\s)height\s*:\s*(\d+)/i.exec(e))&&g[1];
if(b)d.attributes.width=b;if(e)d.attributes.height=e}}return d}}};j&&j.addRules(i);l&&t.mix(l,{createFakeParserElement:function(b,d,e,g,r){var h;h=new m.BasicWriter;b.writeHtml(h);h=h.getHtml();var a=b.attributes.style;if(b.attributes.width)a="width:"+b.attributes.width+"px;"+a;if(b.attributes.height)a="height:"+b.attributes.height+"px;"+a;b={"class":d,src:q,_ke_realelement:encodeURIComponent(h),_ke_real_node_type:b.type,style:a,align:b.attributes.align||""};r&&delete r.width;r&&delete r.height;r&&
t.mix(b,r,false);if(e)b._ke_real_element_type=e;if(g)b._ke_resizable=g;return new m.Element("img",b)}});t.augment(p,{createFakeElement:function(b,d,e,g,r,h){var a=b.attr("style")||"";if(b.attr("width"))a="width:"+b.attr("width")+"px;"+a;if(b.attr("height"))a="height:"+b.attr("height")+"px;"+a;b={"class":d,src:q,_ke_realelement:encodeURIComponent(r||b._4e_outerHtml()),_ke_real_node_type:b[0].nodeType,style:a};h&&delete h.width;h&&delete h.height;h&&t.mix(b,h,false);if(e)b._ke_real_element_type=e;if(g)b._ke_resizable=
g;return new v("<img/>",b,this.document)},restoreRealElement:function(b){if(b.attr("_ke_real_node_type")!=s.NODE_ELEMENT)return null;b=decodeURIComponent(b.attr("_ke_realelement"));var d=new v("<div>",null,this.document);d.html(b);return d._4e_first(function(e){return e[0].nodeType==s.NODE_ELEMENT})._4e_remove()}})});
KISSY.Editor.add("flash",function(l){l.ready(function(){var p=KISSY,t=p.Editor,v=l.htmlDataProcessor,s=l.cfg.pluginConfig,q=v&&v.dataFilter;q&&q.addRules({elements:{object:function(m){var j=m.attributes;if(!(j.classid&&String(j.classid).toLowerCase())){for(j=0;j<m.children.length;j++)if(m.children[j].name=="embed"){if(!t.Utils.isFlashEmbed(m.children[j]))break;return v.createFakeParserElement(m,"ke_flash","flash",true)}return null}return v.createFakeParserElement(m,"ke_flash","flash",true)},embed:function(m){if(!t.Utils.isFlashEmbed(m))return null;
return v.createFakeParserElement(m,"ke_flash","flash",true)}}},5);t.use("flash/support",function(){var m=t.Flash;l.addCommand("insertFlash",{exec:function(){var j=p.makeArray(arguments);return t.Flash.Insert.apply(null,j)}});if(!s.flash||s.flash.btn!==false)new m(l)})})});
KISSY.Editor.add("flash/support",function(){function l(g){this.editor=g;this._init()}function p(g){return g._4e_name()==="img"&&!!g.hasClass(b)&&g}var t=KISSY.Editor,v=KISSY,s=v.UA,q=v.Event,m=t.ContextMenu,j=v.Node,i=t.BubbleView,b="ke_flash",d=t.Utils.flash;v.augment(l,{_config:function(){this._cls=b;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=e;this._flashRules=["img."+b]},_init:function(){this._config();var g=this,r=g.editor,h={},a=g._contextMenu;
r.addButton("flash",{contentCls:g._contentCls,title:g._tip,mode:t.WYSIWYG_MODE,offClick:function(){g.show()}});if(a)for(var c in a)(function(f){h[f]=function(){a[f](g)}})(c);m.register({editor:r,rules:g._flashRules,width:"120px",funcs:h});i.attach({pluginName:g._type,editor:g.editor,pluginContext:g});q.on(r.document,"dblclick",g._dbclick,g)},_getFlashUrl:function(g){return d.getUrl(g)},_updateTip:function(g,r){var h=this.editor.restoreRealElement(r);if(h){h=this._getFlashUrl(h);g.html(h);g.attr("href",
h)}},_dbclick:function(g){var r=new j(g.target);if(r._4e_name()==="img"&&r.hasClass(this._cls)){this.show(null,r);g.halt()}},show:function(g,r){this.editor.useDialog(this._type+"/dialog",function(h){h.show(r)})}});t.Flash=l;l.registerBubble=function(g,r,h){i.register({pluginName:g,func:h,init:function(){var a=this,c=a.get("contentEl");c.html(r+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var f=c.one(".ke-bubbleview-url"),k=c.one(".ke-bubbleview-change"),w=c.one(".ke-bubbleview-remove");t.Utils.preventFocus(c);k.on("click",function(o){a._plugin.show(null,a._selectedEl);o.halt()});w.on("click",function(o){var z=a._plugin;if(s.webkit){var x=z.editor.getSelection().getRanges();x&&x[0]&&(x[0].collapse(true)||1)&&x[0].select()}a._selectedEl._4e_remove();a.hide();z.editor.notifySelectionChange();o.halt()});a.on("show",function(){var o=a._selectedEl;o&&a._plugin._updateTip(f,o)})}})};l.registerBubble("flash",
"Flash \u7f51\u5740\uff1a ",p);l.checkFlash=p;var e={"Flash\u5c5e\u6027":function(g){var r=g.editor.getSelection();r=r&&r.getStartElement();(r=p(r))&&g.show(null,r)}};l.CLS_FLASH=b;l.TYPE_FLASH="flash";l.Insert=function(g,r,h,a,c){r=d.createSWF(r,{attrs:h},g.document);var f=r.el;h=g.createFakeElement?g.createFakeElement(f,a||"ke_flash",c||"flash",true,r.html,h):f;return h=g.insertElement(h)};t.Flash=l});
KISSY.Editor.add("flashbridge",function(){function l(d){this._init(d)}function p(d){var e=v.isString(d)?d.match(/(\d)+/g):d;d=d;if(v.isArray(e))d=parseFloat(e[0]+"."+t(e[1],3)+t(e[2],5));return d||0}function t(d,e){for(var g=(d+"").length;g++<e;)d="0"+d;return d}var v=KISSY,s=v.Editor;if(!s.FlashBridge){var q={};v.augment(l,v.EventTarget,{_init:function(d){var e=v.guid("flashbridge-");d.flashVars=d.flashVars||{};d.attrs=d.attrs||{};d.params=d.params||{};var g=d.flashVars,r=d.params;v.mix(d.attrs,
{id:e,width:"100%",height:"100%"},false);v.mix(r,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);v.mix(g,{shareData:false,useCompression:false},false);r={YUISwfId:e,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(d.ajbridge)r={swfID:e,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};v.mix(g,r);q[e]=this;this.id=e;this.swf=s.Utils.flash.createSWFRuntime(d.movie,d);this._expose(d.methods)},_expose:function(d){for(var e=this,g=0;g<d.length;g++)(function(r){e[r]=
function(){return e._callSWF(r,v.makeArray(arguments))}})(d[g])},_callSWF:function(d,e){e=e||[];try{if(this.swf[d])return this.swf[d].apply(this.swf,e)}catch(g){var r="";if(e.length!==0)r="'"+e.join("', '")+"'";return(new Function("self","return self.swf."+d+"("+r+");"))(this)}},_eventHandler:function(d){var e=d.type;if(e==="log")v.log(d.message);else e&&this.fire(e,d)},_destroy:function(){delete q[this.id]}});l.EventHandler=function(d,e){var g=q[d];g&&setTimeout(function(){g._eventHandler.call(g,
e)},100)};s.FlashBridge=l;var m=v.UA,j,i,b=true;m.fpv=function(d){if(d||b){b=false;var e;if(navigator.plugins&&navigator.mimeTypes.length)e=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(g){}j=e?e.match(/(\d)+/g):void 0;i=p(j)}return j};m.fpvGEQ=function(d,e){b&&m.fpv(e);return!!i&&i>=p(d)}}});
KISSY.Editor.add("flashutils",function(){var l=KISSY,p=l.Editor,t=p.Utils.flash;if(!t){var v=l.DOM,s=l.Node,q=l.UA;t={getUrl:function(m){var j="",i=p.NODE;if(m._4e_name()=="object"){m=m[0].childNodes;for(var b=0;b<m.length;b++)if(m[b].nodeType==i.NODE_ELEMENT)if((v.attr(m[b],"name")||"").toLowerCase()=="movie")j=v.attr(m[b],"value");else if(v._4e_name(m[b])=="embed")j=v.attr(m[b],"src");else if(v._4e_name(m[b])=="object")j=v.attr(m[b],"data")}else if(m._4e_name()=="embed")j=m.attr("src");return j},
createSWF:function(m,j,i){var b=j.attrs||{},d=j.flashVars,e="",g="";j=j.params||{};var r="";i=i||document;l.mix(b,{wmode:"transparent"});for(var h in b)if(b.hasOwnProperty(h))e+=h+"='"+b[h]+"' ";l.mix(j,{quality:"high",movie:m,wmode:"transparent"});for(var a in j)if(j.hasOwnProperty(a))g+="<param name='"+a+"' value='"+j[a]+"'/>";if(d){for(var c in d)if(d.hasOwnProperty(c))r+="&"+c+"="+encodeURIComponent(d[c]);r=r.substring(1)}m="<object "+e+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
g+(r?'<param name="flashVars" value="'+r+'"/>':"")+"<embed "+e+" "+(r?'FlashVars="'+r+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+m+'"  type="application/x-shockwave-flash"/></object>';return{el:new s(m,null,i),html:m}},createSWFRuntime2:function(m,j,i){i=i||document;var b=(new s("<div style='width:0;height:0;overflow:hidden;'>",null,i)).appendTo(i.body);b=t.createSWF.apply(this,arguments).el.appendTo(b);q.ie||(b=b.one("object"));return b[0]},createSWFRuntime:function(m,
j,i){var b=j.attrs||{},d=j.flashVars||{},e=j.params||{},g="",r="",h="";i=i||document;b.id=b.id||l.guid("ke-runtimeflash-");for(var a in b)if(b.hasOwnProperty(a))g+=a+"='"+b[a]+"' ";for(var c in e)if(e.hasOwnProperty(c))r+="<param name='"+c+"' value='"+e[c]+"'/>";for(var f in d)if(d.hasOwnProperty(f))h+="&"+f+"="+encodeURIComponent(d[f]);h=h.substring(1);m=q.ie?"<object "+g+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+r+'<param name="movie" value="'+m+'" />'+(h?'<param name="flashVars" value="'+
h+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+m+"' "+g+">"+r+(h?'<param name="flashVars" value="'+h+'"/>':"")+"</object>";var k=j.holder;if(!k){k=(new s("<div style='"+(j.style?j.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,i)).appendTo(i.body);setTimeout(function(){k.offset({left:v.scrollLeft(),top:v.scrollTop()})},100)}k.html(m);return i.getElementById(b.id)}};p.Utils.flash=t}});
KISSY.Editor.add("font",function(l){function p(w){for(var o=[],z=0;z<w.length;z++)o.push({name:w[z],value:w[z]});return o}var t=KISSY,v=t.Editor,s=v.Style,q=v.TripleButton,m=l.cfg.pluginConfig,j=t.Node,i=m["font-size"],b,d,e;if(i!==false){i=i||{};t.mix(i,{items:p(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var g={},r=[],h={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(k=0;k<i.items.length;k++){b=
i.items[k];d=b.name;e=b.attrs;b=b.value;g[b]=new s(h,{size:b});r.push({name:d,value:b,attrs:e})}m["font-size"]=i}var a=m["font-family"];if(a!==false){a=a||{};t.mix(a,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},
{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var c={},f=[];h={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};var k;m["font-family"]=a;for(k=0;k<a.items.length;k++){b=a.items[k];d=b.name;e=b.attrs||{};b=b.value;e.style=e.style||"";e.style+=";font-family:"+b;c[b]=new s(h,{family:b});f.push({name:d,value:b,attrs:e})}}v.FontSelect||function(){function w(z){w.superclass.constructor.call(this,z);this._init()}
w.ATTRS={title:{},html:{},styles:{},editor:{}};var o=v.Select;t.extend(w,t.Base,{_init:function(){var z=this.get("editor"),x=z.toolBarDiv;this.get("html");this.el=new o({container:x,doc:z.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new j(document.body)});this.el.on("click",this._vChange,this);z.on("selectionChange",this._selectionChange,this);v.Utils.sourceDisable(z,this)},disable:function(){this.el.set("state",
o.DISABLED)},enable:function(){this.el.set("state",o.ENABLED)},_vChange:function(z){var x=this.get("editor"),A=z.newVal;z=z.prevVal;var E=this.get("styles");x.focus();x.fire("save");E=E[A];if(A==z){E.remove(x.document);this.el.set("value","")}else E.apply(x.document);x.fire("save")},_selectionChange:function(z){this.get("editor");z=z.path.elements;for(var x=this.get("styles"),A=0,E;A<z.length;A++){E=z[A];for(var y in x)if(x[y].checkElementRemovable(E,true)){this.el.set("value",y);return}}this.el.reset("value")}});
v.FontSelect=w}();l.ready(function(){false!==m["font-size"]&&new v.FontSelect({editor:l,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:i.width,styles:g,html:r});false!==m["font-family"]&&new v.FontSelect({editor:l,title:"\u5b57\u4f53",width:"110px",popUpWidth:a.width,styles:c,html:f});var w={mode:v.WYSIWYG_MODE,offClick:function(){var o=this.editor,z=this.cfg.style;o.fire("save");z.apply(o.document);o.fire("save");o.notifySelectionChange();o.focus()},onClick:function(){var o=this.editor,z=this.cfg.style;
o.fire("save");z.remove(o.document);o.fire("save");o.notifySelectionChange();o.focus()},selectionChange:function(o){var z=this.btn;this.cfg.style.checkActive(o.path)?z.set("state",q.ON):z.set("state",q.OFF)}};false!==m["font-bold"]&&l.addButton("font-bold",t.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",style:new s({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},w));false!==m["font-italic"]&&l.addButton("font-italic",t.mix({contentCls:"ke-toolbar-italic",
title:"\u659c\u4f53 ",style:new s({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},w));false!==m["font-underline"]&&l.addButton("font-underline",t.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new s({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})},w));false!==m["font-strikeThrough"]&&l.addButton("font-underline",t.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new s({element:"del",overrides:[{element:"span",
attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})},w))})});
KISSY.Editor.add("format",function(l){var p=KISSY.Editor,t=KISSY,v=t.Node,s=[],q={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},m={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},j={},i=p.Style,b;for(b in q)if(q[b]){j[q[b]]=new i({element:q[b]});s.push({name:b,value:q[b],attrs:{style:"font-size:"+m[q[b]]}})}p.Format||function(){function d(g){d.superclass.constructor.call(this,g);this._init()}d.ATTRS={editor:{}};var e=p.Select;t.extend(d,t.Base,
{_init:function(){var g=this.get("editor");this.el=new e({container:g.toolBarDiv,value:"",doc:g.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new v(document.body)});this.el.on("click",this._vChange,this);g.on("selectionChange",this._selectionChange,this);p.Utils.sourceDisable(g,this)},disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.ENABLED)},_vChange:function(g){var r=this.get("editor"),
h=g.newVal;g=g.prevVal;r.fire("save");if(h!=g)j[h].apply(r.document);else{j.p.apply(r.document);this.el.set("value","p")}r.fire("save")},_selectionChange:function(g){this.get("editor");g=g.path;for(var r in j)if(j[r].checkActive(g)){this.el.set("value",r);break}}});p.Format=d}();l.ready(function(){new p.Format({editor:l,html:s,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(l){function p(h){return h.replace(g,function(a,c,f,k,w){return k=="src"&&r.test(a)?a:"<"+c+f+" _ke_saved_"+f+w+">"})}var t=t,v=KISSY,s=v.Editor,q=v.Node,m=v.UA,j=s.NODE,i=s.HtmlParser,b=new i.Filter,d=new i.Filter,e=s.XHTML_DTD;if(!l.htmlDataProcessor){(function(){var h=s.HtmlParser.Fragment.prototype,a=s.HtmlParser.Element.prototype;h.onlyChild=a.onlyChild=function(){var c=this.children;return c.length==1&&c[0]||null};a.removeAnyChildWithName=function(c){for(var f=
this.children,k=[],w,o=0;o<f.length;o++){w=f[o];if(w.name){if(w.name==c){k.push(w);f.splice(o--,1)}k=k.concat(w.removeAnyChildWithName(c))}}return k};a.getAncestor=function(c){for(var f=this.parent;f&&!(f.name&&f.name.match(c));)f=f.parent;return f};h.firstChild=a.firstChild=function(c){for(var f,k=0;k<this.children.length;k++){f=this.children[k];if(c(f))return f;else if(f.name)if(f=f.firstChild(c))return f}return null};a.addStyle=function(c,f,k){var w="";if(typeof f=="string")w+=c+":"+f+";";else{if(typeof c==
"object")for(var o in c){if(c.hasOwnProperty(o))w+=o+":"+c[o]+";"}else w+=c;k=f}if(!this.attributes)this.attributes={};c=this.attributes.style||"";c=(k?[w,c]:[c,w]).join(";");this.attributes.style=c.replace(/^;|;(?=;)/,"")};e.parentOf=function(c){var f={},k;for(k in this)if(k.indexOf("$")==-1&&this[k][c])f[k]=1;return f}})();(function(){function h(y){if(/mso-list\s*:\s*Ignore/i.test(y.attributes&&y.attributes.style))return true;return t}function a(y,n){var u=new s.HtmlParser.Element("ke:listbullet"),
B;if(y)if(y[2]){y=isNaN(y[1])?/^[a-z]+$/.test(y[1])?"lower-alpha":/^[A-Z]+$/.test(y[1])?"upper-alpha":"decimal":"decimal";B="ol"}else{y=/[l\u00B7\u2002]/.test(y[1])?"disc":/[\u006F\u00D8]/.test(y[1])?"circle":/[\u006E\u25C6]/.test(y[1])?"square":"disc";B="ul"}else{y="decimal";B="ol"}u.attributes={"ke:listtype":B,style:"list-style-type:"+y+";"};u.add(new s.HtmlParser.Text(n));return u}function c(y){var n=y.attributes,u;if((u=y.removeAnyChildWithName("ke:listbullet"))&&u.length&&(u=u[0])){y.name="ke:li";
if(n.style)n.style=f([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!o&&z&&B>z)o=B-z;n["ke:margin"]=z=B}]],t)(n.style,y)||"";u=u.attributes;y.addStyle(u.style);v.mix(n,u);return true}return false}function f(y,n){return function(u,B){var D=[];u.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(F,L,P){L=L.toLowerCase();L=="font-family"&&(P=P.replace(/["']/g,""));for(var M,Q,R,T=0;T<y.length;T++)if(y[T]){F=
y[T][0];M=y[T][1];Q=y[T][2];R=y[T][3];if(L.match(F)&&(!M||P.match(M))){L=R||L;n&&(Q=Q||P);if(typeof Q=="function")Q=Q(P,B,L);if(Q&&Q.push){L=Q[0];Q=Q[1]}typeof Q=="string"&&D.push([L,Q]);return}}!n&&D.push([L,P])});for(var C=0;C<D.length;C++)D[C]=D[C].join(":");return D.length?D.join(";")+";":false}}function k(y){y=y.children;for(var n,u,B,D,C,F,L,P=0;P<y.length;P++){n=y[P];if("ke:li"==n.name){n.name="li";n=n;u=n.attributes;B=n.attributes["ke:listtype"];D=parseInt(u["ke:indent"],10)||o&&Math.ceil(u["ke:margin"]/
o)||1;u.style&&(u.style=f([["list-style-type",B=="ol"?"decimal":"disc"]],t)(u.style)||"");if(F){if(D>L){F=new s.HtmlParser.Element(B);F.add(n);C.add(F)}else{if(D<L){C=L-D;for(var M;C--&&(M=F.parent);)F=M.parent}F.add(n)}y.splice(P--,1)}else{F=new s.HtmlParser.Element(B);F.add(n);y[P]=F}C=n;L=D}else F=null}o=0}var w=f([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],t),o,z=0,x=e.parentOf("ol"),A={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,
""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(y){y.filterChildren();k(y)},elements:{font:function(y){delete y.name},p:function(y){y.filterChildren();if(c(y))return t},$:function(y){var n=y.name||"";n.indexOf(":")!=-1&&n.indexOf("ke")==-1&&delete y.name;var u=y.attributes.style;if(n=="span"&&(!u||!w(u)))delete y.name;if(n in x){y.filterChildren();k(y)}},span:function(y){if(!m.gecko&&h(y.parent))return false;if(!m.gecko&&h(y)){y=(y=y.firstChild(function(u){return u.value||
u.name=="img"}))&&(y.value||"l.");var n=y.match(/^([^\s]+?)([.)]?)$/);return a(n,y)}}},comment:!m.ie?function(y,n){var u=y.match(/<img.*?>/),B=y.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(u=B[1]||u&&"l.")&&u.match(/>([^\s]+?)([.)]?)</);return a(B,u)}if(m.gecko&&u){u=s.HtmlParser.Fragment.FromHtml(u[0]).children[0];(B=(B=(B=n.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(u.attributes.src=B);return u}return false}:function(){return false},attributes:{"class":function(y){if(/(^|\s+)ke_/.test(y))return y;
return false},style:function(y){y=w(y);if(!y)return false;return y}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},E={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{$:function(y){var n=y.attributes;if(n)for(var u=["name","href","src"],B,D=0;D<u.length;D++){B="_ke_saved_"+u[D];B in n&&delete n[u[D]]}return y},embed:function(y){var n=y.parent;if(n&&n.name=="object"){var u=n.attributes.width;n=n.attributes.height;u&&(y.attributes.width=u);n&&(y.attributes.height=n)}},param:function(y){y.children=
[];y.isEmpty=true;return y},a:function(y){if(!(y.children.length||y.attributes.name||y.attributes._ke_saved_name))return false},td:function(y){for(var n=y.children,u=0;u<n.length;u++)if(n[u].name=="br"){n.splice(u,1);--u}if(!y.children.length){n=new s.HtmlParser.Text("&nbsp;");y.children.push(n)}},span:function(y){if(!y.children.length)return false}},attributes:{style:function(y){if(!v.trim(y))return false}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(m.ie)E.attributes.style=
function(y){return y.toLowerCase()};b.addRules(E);d.addRules(A)})();(function(){function h(E){for(var y=E.children.length,n=E.children[y-1];n&&n.type==j.NODE_TEXT&&!v.trim(n.value);)n=E.children[--y];return n}function a(E){var y=h(E);return!y||y.type==j.NODE_ELEMENT&&y.name=="br"||E.name=="form"&&y.name=="input"}function c(E,y){var n=E.children,u=h(E);if(u){if((y||!m.ie)&&u.type==j.NODE_ELEMENT&&u.name=="br")n.pop();u.type==j.NODE_TEXT&&w.test(u.value)&&n.pop()}}function f(E){c(E,true);if(a(E))m.ie?
E.add(new s.HtmlParser.Text("\u00a0")):E.add(new s.HtmlParser.Element("br",{}))}function k(E){c(E);a(E)&&E.add(new s.HtmlParser.Text("\u00a0"))}var w=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,o=s.XHTML_DTD,z=s.Utils.mix({},o.$block,o.$listItem,o.$tableContent),x;for(x in z)"br"in o[x]||delete z[x];delete z.pre;o={elements:{}};var A={elements:{}};for(x in z){o.elements[x]=f;A.elements[x]=k}d.addRules(o);b.addRules(A)})();(function(){b.addRules({text:function(h){return h.replace(/\xa0/g,"&nbsp;")}})})();var g=/<((?:a|area|img|input)[\s\S]*?\s)((href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+)))([^>]*)>/gi,
r=/\s_cke_saved_src\s*=/;l.htmlDataProcessor={htmlFilter:b,dataFilter:d,toHtml:function(h,a){var c=new i.HtmlWriter;i.Fragment.FromHtml(h,a).writeHtml(c,b);return c.getHtml(true)},toDataFormat:function(h,a){if(m.gecko)h=h.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");h=p(h);var c=new q("<div>");c.html("a"+h);h=c.html().substr(1);c=new i.BasicWriter;var f=i.Fragment.FromHtml(h,a);c.reset();f.writeHtml(c,d);return c.getHtml(true)},toServer:function(h,a){var c=new i.BasicWriter;
i.Fragment.FromHtml(h,a).writeHtml(c,b);return c.getHtml(true)}}}});
KISSY.Editor.add("image",function(l){var p=KISSY,t=p.Editor,v=p.UA,s=p.Node,q=p.Event,m=t.BubbleView,j=function(i){return i._4e_name()==="img"&&!/(^|\s+)ke_/.test(i[0].className)&&i};l.ready(function(){var i=l.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:t.WYSIWYG_MODE,offClick:function(){this.call("show")},_updateTip:function(g,r){var h=r.attr("src");g.html(h);g.attr("href",h)},show:function(g,r){this.editor.useDialog("image/dialog",function(h){h.show(r)})}}),b={"\u56fe\u7247\u5c5e\u6027":function(g){g=
(g=g.getSelection())&&g.getStartElement();(g=j(g))&&i.call("show",null,g)}},d={},e;for(e in b)(function(g){d[g]=function(){b[g](l)}})(e);t.ContextMenu.register({editor:l,rules:[j],width:"120px",funcs:d});q.on(l.document,"dblclick",function(g){var r=new s(g.target);g.halt();j(r)&&i.call("show",null,r)});m.register({pluginName:"image",pluginContext:i,editor:l,func:j,init:function(){var g=this,r=g.get("contentEl");r.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=r.one(".ke-bubbleview-url"),a=r.one(".ke-bubbleview-change"),c=r.one(".ke-bubbleview-remove");t.Utils.preventFocus(r);a.on("click",function(f){g._plugin.call("show",null,g._selectedEl);f.halt()});c.on("click",function(f){var k=g._plugin;if(v.webkit){var w=k.editor.getSelection().getRanges();w&&w[0]&&(w[0].collapse(true)||1)&&w[0].select()}g._selectedEl._4e_remove();g.hide();k.editor.notifySelectionChange();f.halt()});g.on("show",function(){var f=g._selectedEl;f&&g._plugin.call("_updateTip",
h,f)})}})})});
KISSY.Editor.add("indent",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.addButton("outdent",{title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent",type:"outdent",loading:true}),v=l.addButton("indent",{title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-indent",type:"indent",loading:true});p.use("indent/support",function(){t.reload(p.IndentSupport);v.reload(p.IndentSupport)});l.addCommand("indent",{exec:function(){v.call("offClick")}});l.addCommand("outdent",{exec:function(){t.call("offClick")}})})});
KISSY.Editor.add("indent/support",function(){function l(h){this.type=h;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function p(h){return h[0].nodeType==e.NODE_ELEMENT&&h._4e_name()=="li"}function t(h,a){for(var c=h.startContainer,f=h.endContainer;c&&!c.parent()._4e_equals(a);)c=c.parent();for(;f&&!f.parent()._4e_equals(a);)f=f.parent();if(c&&f){var k=c;c=[];for(var w=false;!w;){if(k._4e_equals(f))w=true;c.push(k);k=k.next()}if(!(c.length<1)){k=a._4e_parents(true);
for(f=0;f<k.length;f++)if(q[k[f]._4e_name()]){a=k[f];break}k=this.type=="indent"?1:-1;f=c[0];w=c[c.length-1];c={};var o=s.ListUtils.listToArray(a,c),z=o[w.data("listarray_index")].indent;for(f=f.data("listarray_index");f<=w.data("listarray_index");f++){o[f].indent+=k;var x=o[f].parent;o[f].parent=new b(x[0].ownerDocument.createElement(x._4e_name()))}for(f=w.data("listarray_index")+1;f<o.length&&o[f].indent>z;f++)o[f].indent+=k;w=s.ListUtils.arrayToList(o,c,null,"p",0);k=[];if(this.type=="outdent"){var A;
if((A=a.parent())&&A._4e_name()=="li"){o=w.listNode.childNodes;var E;for(f=o.length-1;f>=0;f--)if((E=new b(o[f]))&&E._4e_name()=="li")k.push(E)}}if(w){i.insertBefore(w.listNode,a);a._4e_remove()}if(k&&k.length)for(f=0;f<k.length;f++){for(w=E=k[f];(w=w.next())&&w._4e_name()in q;){d.ie&&!E._4e_first(function(y){return g(y)&&r(y)})&&E[0].appendChild(h.document.createTextNode("\u00a0"));E[0].appendChild(w[0])}i.insertAfter(E[0],A[0])}s.Utils.clearAllMarkers(c)}}}function v(h){var a=parseInt(h._4e_style(this.indentCssProperty),
10);if(isNaN(a))a=0;a+=(this.type=="indent"?1:-1)*this.indentOffset;if(a<0)return false;a=Math.max(a,0);a=Math.ceil(a/this.indentOffset)*this.indentOffset;h.css(this.indentCssProperty,a?a+this.indentUnit:"");h[0].style.cssText===""&&h.removeAttr("style");return true}var s=KISSY.Editor,q={ol:1,ul:1},m=KISSY,j=s.Walker,i=m.DOM,b=m.Node,d=m.UA,e=s.NODE,g=j.whitespaces(true),r=j.bookmark(false,true);m.augment(l,{exec:function(h){for(var a=(h=h.getSelection())&&h.getRanges()[0],c=a.startContainer,f=a.endContainer,
k=a.getCommonAncestor();k&&!(k[0].nodeType==e.NODE_ELEMENT&&q[k._4e_name()]);)k=k.parent();if(k&&c[0].nodeType==e.NODE_ELEMENT&&c._4e_name()in q){c=new j(a);c.evaluator=p;a.startContainer=c.next()}if(k&&f[0].nodeType==e.NODE_ELEMENT&&f._4e_name()in q){c=new j(a);c.evaluator=p;a.endContainer=c.previous()}f=h.createBookmarks(true);if(k){for(c=k._4e_first();c&&c._4e_name()!="li";)c=c.next();var w=a.startContainer;(c[0]==w[0]||c.contains(w))&&v.call(this,k)||t.call(this,a,k)}else{a=a.createIterator();
a.enforceRealBlocks=true;for(a.enlargeBr=true;k=a.getNextParagraph();)v.call(this,k)}h.selectBookmarks(f)}});s.IndentSupport={init:function(){this.indentCommand=new l(this.cfg.type)},offClick:function(){var h=this,a=h.editor;a.fire("save");setTimeout(function(){h.indentCommand.exec(a);a.fire("save");a.notifySelectionChange()},10)},selectionChange:function(h){if(this.cfg.type=="outdent"){var a=h.path,c=a.blockLimit;h=this.btn;if(a.contains(q))h.boff();else(a=a.block||c)&&a._4e_style(this.indentCommand.indentCssProperty)?
h.boff():h.disable()}}}});
KISSY.Editor.add("justify",function(l){var p=KISSY,t=p.Editor,v=t.TripleButton,s=/(-moz-|-webkit-|start|auto)/gi;l.ready(function(){var q={mode:t.WYSIWYG_MODE,offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var m=this.editor,j=m.getSelection(),i=this.btn.get("state");if(j){var b=j.createBookmarks(),d=j.getRanges(),e,g;m.fire("save");for(var r=d.length-1;r>=0;r--){e=d[r].createIterator();for(e.enlargeBr=true;g=e.getNextParagraph();){g.removeAttr("align");i==
v.OFF?g.css("text-align",this.cfg.v):g.css("text-align","")}}m.notifySelectionChange();j.selectBookmarks(b);m.fire("save")}},selectionChange:function(m){var j=this.btn;m=m.path;m=m.block||m.blockLimit;if(!m||m._4e_name()==="body")j.boff();else(m.css("text-align").replace(s,"")||"left")==this.cfg.v?j.bon():j.boff()}};l.addButton("alignleft",p.mix({contentCls:"ke-toolbar-alignleft",title:"\u5de6\u5bf9\u9f50",v:"left"},q));l.addButton("aligncenter",p.mix({contentCls:"ke-toolbar-aligncenter",title:"\u5c45\u4e2d\u5bf9\u9f50",v:"center"},
q));l.addButton("alignright",p.mix({contentCls:"ke-toolbar-alignright",title:"\u53f3\u5bf9\u9f50",v:"right"},q))})});
KISSY.Editor.add("link",function(l){function p(i){return i._4e_ascendant(function(b){return b._4e_name()==="a"&&!!b.attr("href")},true)}var t=KISSY,v=t.Editor,s=t.Node,q=v.Style,m=v.BubbleView,j={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};l.ready(function(){var i=l.addButton("link",{contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:v.WYSIWYG_MODE,_getSelectedLink:function(){var b=this.editor.getSelection();if(b=b&&b.getStartElement())b=
p(b);return b},_getSelectionLinkUrl:function(){var b=this.cfg._getSelectedLink.call(this);if(b)return b.attr("_ke_saved_href")||b.attr("href")},_removeLink:function(b){var d=this.editor;d.fire("save");var e=d.getSelection(),g=e.getRanges()[0];if(g&&g.collapsed){g=e.createBookmarks();b._4e_remove(true);e.selectBookmarks(g)}else if(g){b=b[0];e=b.attributes;g={};for(var r=0;r<e.length;r++){var h=e[r];if(h.specified)g[h.name]=h.value}if(b.style.cssText)g.style=b.style.cssText;(new q(j,g)).remove(d.document)}d.fire("save");
d.notifySelectionChange()},_link:function(b){var d=this.editor,e=this.cfg._getSelectedLink.call(this);b._ke_saved_href=b.href;if(e){d.fire("save");e.attr(b);d.fire("save")}else{e=(e=d.getSelection())&&e.getRanges()[0];if(!e||e.collapsed){b=new s("<a>"+b.href+"</a>",b,d.document);d.insertElement(b)}else{d.fire("save");(new q(j,b)).apply(d.document);d.fire("save")}}d.notifySelectionChange()},offClick:function(){var b=this;b.editor.useDialog("link/dialog",function(d){d.show(b)})}});m.register({pluginName:"link",
editor:l,pluginContext:i,func:p,init:function(){var b=this,d=b.get("contentEl");d.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var e=d.one(".ke-bubbleview-url"),g=d.one(".ke-bubbleview-change"),r=d.one(".ke-bubbleview-remove");v.Utils.preventFocus(d);g.on("click",function(h){b._plugin.call("offClick");h.halt()});r.on("click",function(h){b._plugin.call("_removeLink",
b._selectedEl);h.halt()});b.on("show",function(){var h=b._selectedEl;if(h){h=h.attr("_ke_saved_href")||h.attr("href");e.html(h);e.attr("href",h)}})}})})});KISSY.Editor.add("list",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.addButton("ul",{title:"\u9879\u76ee\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ul",loading:true,type:"ul"}),v=l.addButton("ol",{title:"\u7f16\u53f7\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ol",loading:true,type:"ol"});p.use("list/support",function(){t.reload(p.ListSupport);v.reload(p.ListSupport)})})});
KISSY.Editor.add("list/support",function(){function l(h){this.type=h}var p=KISSY.Editor,t={ol:1,ul:1},v=["ol","ul"],s=KISSY,q=p.RANGE,m=p.ElementPath,j=p.Walker,i=p.NODE,b=s.UA,d=s.Node,e=s.DOM,g={listToArray:function(h,a,c,f,k){if(!t[h._4e_name()])return[];f||(f=0);c||(c=[]);for(var w=0,o=h[0].childNodes.length;w<o;w++){var z=new d(h[0].childNodes[w]);if(z._4e_name()=="li"){var x={parent:h,indent:f,element:z,contents:[]};if(k)x.grandparent=k;else{x.grandparent=h.parent();if(x.grandparent&&x.grandparent._4e_name()==
"li")x.grandparent=x.grandparent.parent()}a&&z._4e_setMarker(a,"listarray_index",c.length);c.push(x);for(var A=0,E=z[0].childNodes.length,y;A<E;A++){y=new d(z[0].childNodes[A]);y[0].nodeType==i.NODE_ELEMENT&&t[y._4e_name()]?g.listToArray(y,a,c,f+1,x.grandparent):x.contents.push(y)}}}return c},arrayToList:function(h,a,c,f){c||(c=0);if(!h||h.length<c+1)return null;for(var k=h[c].parent[0].ownerDocument,w=k.createDocumentFragment(),o=null,z=c,x=Math.max(h[c].indent,0),A=null;;){var E=h[z];if(E.indent==
x){if(!o||h[z].parent._4e_name()!=o._4e_name()){o=h[z].parent._4e_clone(false,true);w.appendChild(o[0])}A=o[0].appendChild(E.element._4e_clone(false,true)[0]);for(var y=0;y<E.contents.length;y++)A.appendChild(E.contents[y]._4e_clone(true,true)[0]);z++}else if(E.indent==Math.max(x,0)+1){z=g.arrayToList(h,null,z,f);A.appendChild(z.listNode);z=z.nextIndex}else if(E.indent==-1&&!c&&E.grandparent){if(t[E.grandparent._4e_name()])A=E.element._4e_clone(false,true)[0];else if(E.grandparent._4e_name()!="td"){A=
k.createElement(f);E.element._4e_copyAttributes(new d(A))}else A=k.createDocumentFragment();for(y=0;y<E.contents.length;y++){o=E.contents[y]._4e_clone(true,true);A.nodeType==i.NODE_DOCUMENT_FRAGMENT&&E.element._4e_copyAttributes(new d(o));A.appendChild(o[0])}if(A.nodeType==i.NODE_DOCUMENT_FRAGMENT&&z!=h.length-1){A.lastChild&&A.lastChild.nodeType==i.NODE_ELEMENT&&A.lastChild.getAttribute("type")=="_moz"&&e._4e_remove(A.lastChild);e._4e_appendBogus(A)}if(A.nodeType==i.NODE_ELEMENT&&e._4e_name(A)==
f&&A.firstChild){e._4e_trim(A);o=A.firstChild;if(o.nodeType==i.NODE_ELEMENT&&e._4e_isBlockBoundary(o)){o=k.createDocumentFragment();e._4e_moveChildren(A,o);A=o}}o=e._4e_name(A);if(!b.ie&&(o=="div"||o=="p"))e._4e_appendBogus(A);w.appendChild(A);o=null;z++}else return null;if(h.length<=z||Math.max(h[z].indent,0)<x)break}if(a)for(h=new d(w.firstChild);h&&h[0];){h[0].nodeType==i.NODE_ELEMENT&&h._4e_clearMarkers(a,true);h=h._4e_nextSourceNode()}return{listNode:w,nextIndex:z}}},r=/^h[1-6]$/;l.prototype=
{changeListType:function(h,a,c,f){var k=g.listToArray(a.root,c),w=[];for(h=0;h<a.contents.length;h++){var o=a.contents[h];o=o._4e_ascendant("li",true);if(!(!o||!o[0]||o.data("list_item_processed"))){w.push(o);o._4e_setMarker(c,"list_item_processed",true)}}o=new d(a.root[0].ownerDocument.createElement(this.type));for(h=0;h<w.length;h++){var z=w[h].data("listarray_index");k[z].parent=o}c=g.arrayToList(k,c,null,"p");var x;k=c.listNode.childNodes.length;for(h=0;h<k&&(x=new d(c.listNode.childNodes[h]));h++)x._4e_name()==
this.type&&f.push(x);e.insertBefore(c.listNode,a.root);a.root._4e_remove()},createList:function(h,a,c){var f=a.contents;h=a.root[0].ownerDocument;var k=[];if(f.length==1&&f[0][0]===a.root[0]){var w=new d(h.createElement("div"));f[0][0].nodeType!=i.NODE_TEXT&&f[0]._4e_moveChildren(w);f[0][0].appendChild(w[0]);f[0]=w}a=a.contents[0].parent();for(w=0;w<f.length;w++)a=a._4e_commonAncestor(f[w].parent());for(w=0;w<f.length;w++)for(var o=f[w],z;z=o.parent();){if(z[0]===a[0]){k.push(o);break}o=z}if(!(k.length<
1)){f=new d(k[k.length-1][0].nextSibling);w=new d(h.createElement(this.type));for(c.push(w);k.length;){c=k.shift();o=new d(h.createElement("li"));if(r.test(c._4e_name()))o[0].appendChild(c[0]);else{c._4e_copyAttributes(o);c._4e_moveChildren(o);c._4e_remove()}w[0].appendChild(o[0]);b.ie||o._4e_appendBogus()}f[0]?e.insertBefore(w,f):a.append(w)}},removeList:function(h,a,c){function f(y){if((A=new d(x[y?"firstChild":"lastChild"]))&&!(A[0].nodeType==i.NODE_ELEMENT&&A._4e_isBlockBoundary())&&(E=a.root[y?
"_4e_previous":"_4e_next"](j.whitespaces(true)))&&!(A[0].nodeType==i.NODE_ELEMENT&&E._4e_isBlockBoundary({br:1})))e[y?"insertBefore":"insertAfter"](h.document.createElement("br"),A)}for(var k=g.listToArray(a.root,c),w=[],o=0;o<a.contents.length;o++){var z=a.contents[o];z=z._4e_ascendant("li",true);if(!(!z||z.data("list_item_processed"))){w.push(z);z._4e_setMarker(c,"list_item_processed",true)}}z=null;for(o=0;o<w.length;o++){z=w[o].data("listarray_index");k[z].indent=-1;z=z}for(o=z+1;o<k.length;o++)if(k[o].indent>
Math.max(k[o-1].indent,0)){w=k[o-1].indent+1-k[o].indent;for(z=k[o].indent;k[o]&&k[o].indent>=z;){k[o].indent+=w;o++}o--}var x=g.arrayToList(k,c,null,"p").listNode,A,E;f(true);f(undefined);e.insertBefore(x,a.root);a.root._4e_remove()},exec:function(h){var a=h.getSelection(),c=a&&a.getRanges();if(!(!c||c.length<1)){for(var f=a.createBookmarks(true),k=[],w={};c.length>0;){var o=c.shift(),z=o.getBoundaryNodes(),x=z.startNode,A=z.endNode;x[0].nodeType==i.NODE_ELEMENT&&x._4e_name()=="td"&&o.setStartAt(z.startNode,
q.POSITION_AFTER_START);A[0].nodeType==i.NODE_ELEMENT&&A._4e_name()=="td"&&o.setEndAt(z.endNode,q.POSITION_BEFORE_END);o=o.createIterator();for(o.forceBrBreak=false;z=o.getNextParagraph();)if(!z.data("list_block")){z._4e_setMarker(w,"list_block",1);A=new m(z);var E=A.elements,y=null,n=false,u=A.blockLimit,B;for(x=E.length-1;x>=0&&(B=E[x]);x--)if(t[B._4e_name()]&&u.contains(B)){u.removeData("list_group_object");if(x=B.data("list_group_object"))x.contents.push(z);else{x={root:B,contents:[z]};k.push(x);
B._4e_setMarker(w,"list_group_object",x)}n=true;break}if(!n){A=u||A.block;if(A.data("list_group_object"))A.data("list_group_object").contents.push(z);else{x={root:A,contents:[z]};A._4e_setMarker(w,"list_group_object",x);k.push(x)}}}}for(c=[];k.length>0;){x=k.shift();if(this.state=="off")if(t[x.root._4e_name()])this.changeListType(h,x,w,c);else{p.Utils.clearAllMarkers(w);this.createList(h,x,c)}else this.state=="on"&&t[x.root._4e_name()]&&this.removeList(h,x,w)}for(x=0;x<c.length;x++){y=c[x];var D=
this;(h=function(C){var F=y[C?"_4e_previous":"_4e_next"](j.whitespaces(true));if(F&&F[0]&&F._4e_name()==D.type){F._4e_remove();F._4e_moveChildren(y,C?true:false)}})();h(true)}p.Utils.clearAllMarkers(w);a.selectBookmarks(f)}}};p.ListUtils=g;p.ListSupport={init:function(){this.listCommand=new l(this.cfg.type)},selectionChange:function(h){var a=this.cfg.type,c=h.path,f;h=this.btn;var k=c.blockLimit;c=c.elements;if(k){if(c)for(var w=0;w<c.length&&(f=c[w])&&f[0]!==k[0];w++){var o=s.indexOf(c[w]._4e_name(),
v);if(o!==-1)if(v[o]===a){h.bon();return}else break}h.boff()}},offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var h=this.editor,a=this.btn;h.fire("save");this.listCommand.state=a.get("state");this.listCommand.exec(h);h.fire("save");h.notifySelectionChange()}}});
KISSY.Editor.add("localstorage",function(){var l=KISSY,p=l.Editor,t;t=p.STORE="localStorage";if(!p.storeReady){p.storeReady=function(s){p.on("storeReady",s)};p.on("storeReady",function(){p.storeReady=function(s){s()};p.detach("storeReady")})}if(window[t])window[t]._ke||p.fire("storeReady");else{var v=p.Config.base+p.Utils.debugUrl("plugins/localstorage/swfstore.swf?rand="+ +new Date);window[t]=new p.FlashBridge({movie:v,methods:["setItem","removeItem","getValueOf"]});l.mix(window[t],{_ke:1,getItem:function(s){return this.getValueOf(s)}});
window[t].on("contentReady",function(){p.fire("storeReady")})}});KISSY.Editor.add("maximize",function(l){var p=KISSY,t=p.Editor;p.UA.gecko<1.92||l.ready(function(){var v=l.addButton("maximize",{title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize",loading:true});t.use("maximize/support",function(){v.reload(t.Maximize)})})});
KISSY.Editor.add("maximize/support",function(){var l=KISSY.Editor,p=KISSY,t=p.UA,v=p.Node,s=p.Event,q=p.DOM,m;q.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");var j={};p.mix(j,{onClick:function(){var i=this,b=i.editor;i._resize&&s.remove(window,"resize",i._resize);i.call("_saveEditorStatus");i.call("_restoreState");i.btn.boff();setTimeout(function(){i.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("restoreWindow")},30)},_restoreState:function(){var i=document,b=this.editor,
d=this._savedParents;if(d){for(var e=0;e<d.length;e++){var g=d[e];g.el.css("position",g.position)}this._savedParents=null}b.wrap.css({height:this.iframeHeight});q.css(i.body,{width:"",height:"",overflow:""});i.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:this.editorWrapWidth});m.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);i=this.btn.get("el");i.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");i.attr("title",
"\u5168\u5c4f");t.ie<8&&this.editor.toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var i=this.editor,b=[],d=i.editorWrap;this.iframeHeight=i.wrap._4e_style("height");this.editorWrapWidth=d._4e_style("width");this.scrollLeft=q.scrollLeft();this.scrollTop=q.scrollTop();window.scrollTo(0,0);for(i=d.parent();i;){d=i.css("position");if(d!="static"){b.push({el:i,position:d});i.css("position","static")}i=i.parent()}this._savedParents=b;b=this.btn.get("el");b.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
b.attr("title","\u53d6\u6d88\u5168\u5c4f");t.ie<8&&this.editor.toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var i=this.editor;this.savedRanges=null;if(t.gecko&&i.iframeFocus)this.savedRanges=(i=i.getSelection())&&i.getRanges()},_restoreEditorStatus:function(){var i=this.editor,b=i.getSelection(),d=this.savedRanges;i.activateGecko();d&&b&&b.selectRanges(d);if(i.iframeFocus&&b)(i=b.getStartElement())&&i[0]&&i._4e_scrollIntoView();t.ie<8&&this.btn.get("el").one("span").css("background-image",
"")},_maximize:function(i){var b=document,d=this.editor,e=d.editorWrap,g=q.viewportHeight(),r=q.viewportWidth(),h=d.statusDiv?d.statusDiv[0].offsetHeight:0,a=d.toolBarDiv[0].offsetHeight;if(t.ie)b.body.style.overflow="hidden";else q.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:d.baseZIndex(l.zIndexManager.MAXIMIZE),width:r+"px"});m.css({zIndex:d.baseZIndex(l.zIndexManager.MAXIMIZE-5),height:g+"px",width:r+"px"});e.offset({left:0,
top:0});m.css({left:0,top:0});d.wrap.css({height:g-h-a+"px"});i!==true&&arguments.callee.call(this,true)},_real:function(){var i=this,b=i.editor;i.call("_saveEditorStatus");i.call("_saveSate");i.call("_maximize");i._resize=i._resize||l.Utils.buffer(i.cfg._maximize,i,100);s.on(window,"resize",i._resize);i.btn.bon();setTimeout(function(){i.call("_restoreEditorStatus");b.notifySelectionChange();b.fire("maximizeWindow")},30)},offClick:function(){m||(m=(new v("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(document.body));
this.call("_real")}});l.Maximize=j});
KISSY.Editor.add("music",function(l){var p=KISSY.Editor,t=l.htmlDataProcessor,v=t&&t.dataFilter;l.ready(function(){v&&v.addRules({elements:{object:function(s){var q=s.attributes;if(!(q.classid&&String(q.classid).toLowerCase())){for(q=0;q<s.children.length;q++)if(s.children[q].name=="embed"){if(!p.Utils.isFlashEmbed(s.children[q]))break;if(s.children[q].attributes.src.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(s,"ke_music","music",true)}return null}for(q=0;q<s.children.length;q++){var m=
s.children[q];if(m.name=="param"&&m.attributes.name=="movie")if(m.attributes.value.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(s,"ke_music","music",true)}},embed:function(s){if(!p.Utils.isFlashEmbed(s))return null;if(s.attributes.src.indexOf("niftyplayer.swf")!=-1)return t.createFakeParserElement(s,"ke_music","music",true)}}},4);p.use("music/support",function(){new p.MusicInserter(l)})})});
KISSY.Editor.add("music/support",function(){function l(d){l.superclass.constructor.apply(this,arguments);d.cfg.disableObjectResizing||s.on(d.document.body,m.ie?"resizestart":"resize",function(e){(new t.Node(e.target)).hasClass(j)&&e.preventDefault()})}function p(d){return d._4e_name()==="img"&&!!d.hasClass(j)&&d}var t=KISSY,v=t.Editor,s=t.Event,q=v.Flash,m=t.UA,j="ke_music",i=["img."+j];t.extend(l,q,{_config:function(){this._cls=j;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";
this._contextMenu=b;this._flashRules=i}});q.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",p);v.MusicInserter=l;var b={"\u97f3\u4e50\u5c5e\u6027":function(d){var e=d.editor.getSelection();(e=(e=e&&e.getStartElement())&&p(e))&&d.show(null,e)}}});
KISSY.Editor.add("ext-focus",function(){function l(){}var p=KISSY,t=p.UA,v=p.Editor,s=v.focusManager;v.namespace("UIBase");l.ATTRS={focus4e:{value:true}};l.prototype={_uiSetFocus4e:function(q){if(q){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){},__renderUI:function(){},__bindUI:function(){this._focus4e=(new p.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},
_show4FocusExt:function(){var q=this._focusEditor=s.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(t.ie&&q){var m=q.document.selection.createRange();if(m)if(m.item&&m.item(0).ownerDocument==q.document){q=document.body.createTextRange();q.moveToElementText(this.get("el")._4e_first()[0]);q.collapse(true);q.select()}}},_hide4FocusExt:function(){var q=this._focusEditor;q&&q.focus()}};v.UIBase.Focus=l},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var l=KISSY,p=l.Editor;if(!p.Overlay){var t=l.UIBase.create(l.Overlay,[p.UIBase.Focus],{init:function(){},syncUI:function(){p.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}}),v=l.UIBase.create(l.Dialog,[p.UIBase.Focus],{show:function(){this.center();var q=this.get("y");if(q-l.DOM.scrollTop()>200){q=l.DOM.scrollTop()+200;this.set("y",q)}v.superclass.show.call(this)}},{ATTRS:{constrain:{value:true},zIndex:{value:p.baseZIndex(p.zIndexManager.OVERLAY)}}});
p.Overlay=t;p.Dialog=v;var s;p.Overlay.loading=function(){s||(s=new p.Overlay({x:0,focus4e:false,width:l.UA.ie==6?l.DOM.docWidth():"100%",y:0,zIndex:p.baseZIndex(p.zIndexManager.LOADING),elCls:"ke-global-loading"}));s.set("height",l.DOM.docHeight());s.show();s.loading()};p.Overlay.unloading=function(){s&&s.hide()}}});
KISSY.Editor.add("pagebreak",function(l){var p=KISSY,t=p.Editor,v=p.Node,s=l.htmlDataProcessor;(p=s&&s.dataFilter)&&p.addRules({elements:{div:function(q){var m=q.attributes;var j=(m=m&&m.style)&&q.children.length==1&&q.children[0];if((j=j&&j.name=="span"&&j.attributes.style)&&/page-break-after\s*:\s*always/i.test(m)&&/display\s*:\s*none/i.test(j))return s.createFakeParserElement(q,"ke_pagebreak","div")}}});l.ready(function(){l.addButton("page-break",{title:"\u5206\u9875",mode:t.WYSIWYG_MODE,contentCls:"ke-toolbar-pagebreak",
offClick:function(){var q=this.editor,m=new v('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,q.document);m=q.createFakeElement?q.createFakeElement(m,"ke_pagebreak","div",false,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'):m;var j=q.getSelection();if(j=j&&j.getRanges()[0]){q.fire("save");for(var i=j.startContainer,b=i;i._4e_name()!=="body";){b=i;i=i.parent()}j.collapse(true);j.splitElement(b);m.insertAfter(b);
q.fire("save")}}})})});
KISSY.Editor.add("preview",function(l){l.ready(function(){l.addButton("preview",{title:"\u9884\u89c8",contentCls:"ke-toolbar-preview",offClick:function(){var p=this.editor,t=640,v=420,s=80;try{var q=window.screen;t=Math.round(q.width*0.8);v=Math.round(q.height*0.7);s=Math.round(q.width*0.1)}catch(m){}p=p._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+p.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");t=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+t+
",height="+v+",left="+s);v=t.document;v.open();v.write(p);v.close();t.focus()}})})});
KISSY.Editor.add("progressbar",function(){function l(){l.superclass.constructor.apply(this,arguments);this._init()}var p=KISSY,t=p.Editor;if(!t.ProgressBar){var v=p.Node;p.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
l.ATTRS={container:{},width:{},height:{},progress:{value:0}};p.extend(l,p.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var s=this.get("height"),q=new v("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+s+";'></div>"),m=this.get("container");s=(new v("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(s)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(q);var j=(new v("<span class='ke-progressbar-title'>")).appendTo(q);
m&&q.appendTo(m);this.el=q;this._title=j;this._p=s;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(s){s=s.newVal;this._p.css("width",s+"%");this._title.html(s+"%")}});t.ProgressBar=l}});
KISSY.Editor.add("removeformat",function(l){function p(i,b){for(var d=0;d<b.length;d++)i.removeAttr(b[d])}var t=KISSY.Editor,v=t.RANGE,s=t.ElementPath,q=t.NODE,m="class,style,lang,width,height,align,hspace,valign".split(/,/),j=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");l.ready(function(){l.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:t.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var i=
this.editor;j.lastIndex=0;var b=i.getSelection().getRanges();i.fire("save");for(var d=0,e;e=b[d];d++)if(!e.collapsed){e.enlarge(v.ENLARGE_ELEMENT);var g=e.createBookmark(),r=g.startNode,h=g.endNode,a=function(c){for(var f=new s(c),k=f.elements,w=1,o;o=k[w];w++){if(o._4e_equals(f.block)||o._4e_equals(f.blockLimit))break;j.test(o._4e_name())&&c._4e_breakParent(o)}};a(r);a(h);for(r=r._4e_nextSourceNode(true,q.NODE_ELEMENT);r;){if(r._4e_equals(h))break;a=r._4e_nextSourceNode(false,q.NODE_ELEMENT);r._4e_name()==
"img"&&r.attr("_ke_realelement")||(j.test(r._4e_name())?r._4e_remove(true):p(r,m));r=a}e.moveToBookmark(g)}i.getSelection().selectRanges(b);i.fire("save")}})})});
KISSY.Editor.add("resize",function(l){var p=KISSY,t=p.Node;l.ready(function(){p.use("dd",function(){var v=p.Draggable,s=l.statusDiv,q=new t("<div class='ke-resizer'>"),m=l.cfg.pluginConfig.resize||{};m=m.direction||["x","y"];q.appendTo(s);l.on("maximizeWindow",function(){q.css("display","none")});l.on("restoreWindow",function(){q.css("display","")});v=new v({node:q});var j=0,i=0,b=l.wrap,d=l.editorWrap;v.on("dragstart",function(){j=b.height();i=d.width()});v.on("drag",function(e){var g=e.left-this.startNodePos.left;
e=e.top-this.startNodePos.top;p.inArray("y",m)&&b.height(j+e);p.inArray("x",m)&&d.width(i+g)})})})});
KISSY.Editor.add("select",function(){function l(j){l.superclass.constructor.call(this,j);this._init()}var p=KISSY,t=p.Node,v=p.Event,s=p.DOM,q=p.Editor;if(!q.Select){l.DISABLED=0;l.ENABLED=1;var m=q.XHTML_DTD;l.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var j=this.el.parent();j;){var i=j._4e_name();if(m[i]&&m[i].div)return j;j=j.parent()}return new t(document.body)}},state:{value:1}};l.decorate=
function(j){for(var i=j.width(),b=[],d=j.all("option"),e=0;e<d.length;e++){var g=d[e];b.push({name:s.html(g),value:s.attr(g,"value")})}return new l({width:i+"px",el:j,items:b,cls:"ke-combox",value:j.val()})};p.extend(l,p.Base,{_init:function(){var j=this.get("container"),i=this.get("el"),b=new t("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
d=this.get("title")||"",e=this.get("cls"),g=b.one(".ke-select-text"),r=b.one(".ke-select-text-inner");b.one(".ke-select-drop");this.get("value")!==undefined?r.html(this._findNameByV(this.get("value"))):r.html(d);g.css("width",this.get("width"));b._4e_unselectable();d&&b.attr("title",d);e&&b.addClass(e);if(i)i[0].parentNode.replaceChild(b[0],i[0]);else j&&b.appendTo(j);b.on("click",this._click,this);this.el=b;this.title=r;this._focusA=b.one("a.ke-select");q.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(j){var i=this.get("title")||"",b=this.get("items");if(this.get("showValue"))return j||i;for(var d=0;d<b.length;d++){var e=b[d];if(e.value==j){i=e.name;break}}return i},_valueChange:function(j){this.title.html(this._findNameByV(j.newVal))},_itemsChange:function(j){j=j.newVal;var i=this._selectList;i.html("");if(j)for(var b=0;b<j.length;b++){var d=j[b];(new t("<a class='ke-select-menu-item' href='#' data-value='"+
d.value+"'>"+d.name+"</a>",d.attrs)).appendTo(i)._4e_unselectable()}this.as=i.all("a")},val:function(j){if(j!==undefined){this.set("value",j);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){function j(h){h=new t(h.target);b.contains(h)||b._4e_equals(h)||g.hide()}var i=this,b=i.el,d=i.get("popUpWidth"),e=i._focusA,g=new q.Overlay({autoRender:true,render:i.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:d?
d:b.width(),zIndex:q.baseZIndex(q.zIndexManager.SELECT),focusMgr:false}),r=i.get("items");d=g.get("contentEl").one("div");i.menu=g;v.on(window,"resize",i._resize,i);i.get("title")&&(new t("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+i.get("title")+"</div>")).appendTo(d);i._selectList=(new t("<div>")).appendTo(d);i._itemsChange({newVal:r});g.on("show",function(){e.addClass("ke-select-active")});g.on("hide",function(){e.removeClass("ke-select-active")});v.on(document,
"click",j);i.get("doc")&&v.on(i.get("doc"),"click",j);d.on("click",i._select,i);i.as=i._selectList.all("a");v.on(d[0],"mouseenter",function(){i.as.removeClass("ke-menu-selected")});i.on("afterItemsChange",i._itemsChange,i);i.menuNode=d},_stateChange:function(j){var i=this.el;j.newVal==1?i.removeClass("ke-select-disabled"):i.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(j){j.halt();var i=this.menu,b=this.menuNode;if(j=
(new t(j.target))._4e_ascendant(function(g){return b.contains(g)&&g._4e_name()=="a"},true)){var d=this.get("value"),e=j.attr("data-value");this.set("value",e);this.fire("click",{newVal:e,prevVal:d,name:j.html()});i.hide()}},_real:function(){var j=this.el,i=j.offset(),b=p.clone(i),d=this.menu.get("el").height(),e=this.menu.get("el").width(),g=s.scrollTop(),r=s.scrollLeft(),h=s.viewportHeight(),a=s.viewportWidth();a=r+a-60;h=g+h;var c=i.top+(j.height()-2);j=i.left+j.width()-2;var f=this.get("align"),
k=f[0];if(f[1]=="b"){i.top=c;if(i.top+d>h&&b.top-g>h-c)i.top=b.top-d}else{i.top=b.top-d;if(i.top<g&&b.top-g<h-c)i.top=c}if(k=="l"){if(i.left+e>a&&j-r>a-b.left)i.left=j-e}else{i.left=j-e;if(i.left<r&&j-r<a-b.left)i.left=b.left}this.menu.set("xy",[i.left,i.top]);this.menu.show()},_click:function(j){j.preventDefault();j=this.el;var i=this.get("value");if(!j.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();i&&this.menu&&this.as.each(function(b){b.attr("data-value")==
i?b.addClass("ke-menu-selected"):b.removeClass("ke-menu-selected")})}}});q.Select=l}});KISSY.Editor.add("separator",function(l){l.ready(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(l.toolBarDiv)})});KISSY.Editor.add("smiley",function(l){var p=KISSY.Editor;l.ready(function(){var t=l.addButton("smiley",{contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",mode:p.WYSIWYG_MODE,loading:true});p.use("smiley/support",function(){t.reload(p.SmileySupport)})})});
KISSY.Editor.add("smiley/support",function(){var l=KISSY,p=l.Event,t=l.Editor,v=l.DOM;v.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");var s;t.SmileySupport={_selectSmiley:function(q){q.halt();
var m=this.editor;q=new l.Node(q.target);var j;if(q._4e_name()=="a"&&(j=q.attr("data-icon"))){j=new l.Node("<img class='ke_smiley'alt='' src='"+j+"'/>",null,m.document);m.insertElement(j);this.smileyWin.hide()}},_hidePanel:function(q){var m=this.btn.get("el");q=new l.Node(q.target);var j=this.smileyWin;m._4e_equals(q)||m.contains(q)||j.hide()},_show:function(){var q=this.smileyWin;q&&q.get("visible")?q.hide():this.call("_prepare")},_prepare:function(){var q=this.cfg,m=this.btn,j=this.editor,i;if(!s){s=
"<div class='ke-smiley-sprite'>";for(i=0;i<=98;i++)s+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+i+".gif'></a>";s+="</div>"}i=s;i=this.smileyWin=new t.Overlay({content:i,focus4e:false,width:"297px",autoRender:true,elCls:"ks-popup",zIndex:j.baseZIndex(t.zIndexManager.POPUP_MENU),mask:false});this.smileyPanel=i.get("contentEl");i.on("show",m.bon,m);i.on("hide",m.boff,m);this.smileyPanel.on("click",q._selectSmiley,this);p.on(document,"click",q._hidePanel,this);p.on(j.document,
"click",q._hidePanel,this);this.cfg._prepare=this.cfg._real;this.call("_real")},_real:function(){var q=this.btn.get("el"),m=q.offset();m.top+=q.height()+5;if(m.left+this.smileyPanel.width()>v.viewportWidth()-60)m.left=v.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[m.left,m.top]);this.smileyWin.show()},offClick:function(){this.call("_prepare")},onClick:function(){this.call("_prepare")}}});
KISSY.Editor.add("sourcearea",function(l){var p=KISSY.Editor;KISSY.UA.gecko<1.92||l.ready(function(){var t=p.SOURCE_MODE,v=p.WYSIWYG_MODE;l.addButton("sourcearea",{title:"\u6e90\u7801",contentCls:"ke-toolbar-source",init:function(){var s=this.btn,q=this.editor;q.on("wysiwygmode",s.boff,s);q.on("sourcemode",s.bon,s)},offClick:function(){this.editor.execCommand("sourceAreaSupport",t)},onClick:function(){this.editor.execCommand("sourceAreaSupport",v)}})})});
KISSY.Editor.add("sourcearea/support",function(l){var p=KISSY,t=p.Editor,v=p.UA;t.SourceAreaSupport||function(){function s(){var j=this.mapper={};j[q]=this._show;j[m]=this._hide}var q=t.SOURCE_MODE,m=t.WYSIWYG_MODE;p.augment(s,{exec:function(j,i){var b=this.mapper;b[i]&&b[i].call(this,j)},_show:function(j){j.textarea.val(j.getData(true));this._showSource(j);j.fire("sourcemode")},_showSource:function(j){var i=j.textarea,b=j.iframe;i.css("display","");b.css("display","none");v.ieEngine<8&&i.css("height",
j.wrap.css("height"));i[0].focus()},_hideSource:function(j){var i=j.textarea;j.iframe.css("display","");i.css("display","none")},_hide:function(j){var i=j.textarea;this._hideSource(j);j.fire("save");j.setData(i.val());j.fire("wysiwygmode");j.fire("save");v.gecko&&j.activateGecko()}});t.SourceAreaSupport=new s}();l.addCommand("sourceAreaSupport",t.SourceAreaSupport)});
KISSY.Editor.add("table",function(l){var p=KISSY,t=p.Editor,v=p.trim,s=(p.UA.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border"),q=l.htmlDataProcessor;
p=q&&q.dataFilter;q=q&&q.htmlFilter;p&&p.addRules({elements:{table:function(m){m=m.attributes;var j=m["class"],i=parseInt(m.border,10);if(!i||i<=0)m["class"]=(j||"")+" ke_show_border"}}});q&&q.addRules({elements:{table:function(m){m=m.attributes;var j=m["class"];if(j)m["class"]=v(j.replace("ke_show_border","").replace(/\s{2}/," "))}}});l.ready(function(){var m=l.addButton("table",{contentCls:"ke-toolbar-table",mode:t.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c",loading:true});t.use("table/support",function(){var j=
new t.TableUI(l);m.reload({offClick:function(){j._tableShow()}})});l.addCustomStyle(s)})});
KISSY.Editor.add("table/support",function(){function l(a){var c=this,f={},k;for(k in h)(function(w){f[w]=function(){a.fire("save");h[w](c);a.fire("save")}})(k);d.ContextMenu.register({editor:a,rules:g,width:"120px",funcs:f});c.editor=a}function p(a){function c(E){if(!(w.length>0))if(E[0].nodeType==e.NODE_ELEMENT&&r.test(E._4e_name())&&!E.data("selected_cell")){E._4e_setMarker(o,"selected_cell",true);w.push(E)}}for(var f=a.createBookmarks(),k=a.getRanges(),w=[],o={},z=0;z<k.length;z++){var x=k[z];
if(x.collapsed){x=x.getCommonAncestor();(x=x._4e_ascendant("td",true)||x._4e_ascendant("th",true))&&w.push(x)}else{x=new Walker(x);var A;for(x.guard=c;A=x.next();)if((A=A.parent())&&r.test(A._4e_name())&&!A.data("selected_cell")){A._4e_setMarker(o,"selected_cell",true);w.push(A)}}}d.Utils.clearAllMarkers(o);a.selectBookmarks(f);return w}function t(a,c){var f=a.getStartElement()._4e_ascendant("tr");if(f){var k=f._4e_clone(true);k.insertBefore(f);f=(c?k[0]:f[0]).cells;for(k=0;k<f.length;k++){f[k].innerHTML=
"";i.ie||(new b(f[k]))._4e_appendBogus()}}}function v(a){if(a instanceof d.Selection){var c=p(a),f=c.length;a=[];for(var k,w,o=0;o<f;o++){var z=c[o].parent(),x=z[0].rowIndex;!o&&(k=x-1);a[x]=z;o==f-1&&(w=x+1)}o=z._4e_ascendant("table");k=new b(w<o[0].rows.length&&o[0].rows[w]||k>0&&o[0].rows[k]||o[0].parentNode);for(o=a.length;o>=0;o--)a[o]&&v(a[o]);return k}else if(a instanceof b){o=a._4e_ascendant("table");o[0].rows.length==1?o._4e_remove():a._4e_remove()}return 0}function s(a,c){var f=a.getStartElement();
if(f=f._4e_ascendant("td",true)||f._4e_ascendant("th",true))for(var k=f._4e_ascendant("table"),w=f[0].cellIndex,o=0;o<k[0].rows.length;o++){var z=k[0].rows[o];if(!(z.cells.length<w+1)){f=new b(z.cells[w].cloneNode(false));i.ie||f._4e_appendBogus();z=new b(z.cells[w]);c?f.insertBefore(z):f.insertAfter(z)}}}function q(a){if(a instanceof d.Selection){var c=p(a),f,k=[];a=c[0]&&c[0]._4e_ascendant("table");var w,o,z;w=0;for(o=c.length;w<o;w++)k.push(c[w][0].cellIndex);k.sort();w=1;for(o=k.length;w<o;w++)if(k[w]-
k[w-1]>1){z=k[w-1]+1;break}z||(z=k[0]>0?k[0]-1:k[k.length-1]+1);k=a[0].rows;w=0;for(o=k.length;w<o;w++)if(f=k[w].cells[z])break;f=f?new b(f):a._4e_previous();for(z=c.length-1;z>=0;z--)c[z]&&q(c[z]);return f}else if(a instanceof b){c=a._4e_ascendant("table");if(!c)return null;f=a[0].cellIndex;for(z=c[0].rows.length-1;z>=0;z--){a=new b(c[0].rows[z]);if(!f&&a[0].cells.length==1)v(a);else a[0].cells[f]&&a[0].removeChild(a[0].cells[f])}}return null}function m(a,c){var f=new d.Range(a[0].ownerDocument);
if(!f.moveToElementEditablePosition(a,c?true:undefined)){f.selectNodeContents(a);f.collapse(c?false:true)}f.select(true)}var j=KISSY,i=j.UA,b=j.Node,d=j.Editor,e=d.NODE,g=["tr","th","td","tbody","table"];j.augment(l,{_tableShow:function(a,c,f){this.editor.useDialog("table/dialog",function(k){k.show(c,f)})}});var r=/^(?:td|th)$/,h={"\u8868\u683c\u5c5e\u6027":function(a){var c=a.editor.getSelection(),f=c&&c.getStartElement();if(c=f&&f._4e_ascendant("table",true)){f=f._4e_ascendant(function(k){k=k._4e_name();return k==
"td"||k=="th"},true);a._tableShow(null,c,f)}},"\u5220\u9664\u8868\u683c":function(a){var c=(a=a.editor.getSelection())&&a.getStartElement();if(c=c&&c._4e_ascendant("table",true)){a.selectElement(c);var f=a.getRanges()[0];f.collapse();a.selectRanges([f]);a=c.parent();a[0].childNodes.length==1&&a._4e_name()!="body"&&a._4e_name()!="td"?a._4e_remove():c._4e_remove()}},"\u5220\u9664\u884c ":function(a){a=a.editor.getSelection();m(v(a),undefined)},"\u5220\u9664\u5217 ":function(a){a=a.editor.getSelection();(a=q(a))&&m(a,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(a){a=a.editor.getSelection();
t(a,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(a){a=a.editor.getSelection();t(a,undefined)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(a){a=a.editor.getSelection();s(a,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(a){a=a.editor.getSelection();s(a,undefined)}};d.TableUI=l});
KISSY.Editor.add("tabs",function(){function l(q){this.cfg=q;this._init()}var p=KISSY,t=p.Editor,v=p.DOM,s=p.Node;if(!t.Tabs){p.augment(l,p.EventTarget,{_init:function(){var q=this,m=q.cfg,j=m.tabs,i=m.contents.children("div"),b=j.children("li");j.on("click",function(d){d=new s(d.target);if(d=d._4e_ascendant(function(g){return g._4e_name()==="li"&&j.contains(g)},true)){b.removeClass("ke-tab-selected");var e=d.attr("rel");d.addClass("ke-tab-selected");i.hide();v.show(i[p.indexOf(d[0],b)]);q.fire(e)}})},
getTab:function(q){var m=this.cfg,j=m.tabs;m=m.contents.children("div");j=j.children("li");for(var i=0;i<j.length;i++){var b=new s(j[i]),d=new s(m[i]);if(p.isNumber(q)&&q==i||p.isString(q)&&q==b.attr("rel"))return{tab:b,content:d}}},remove:function(q){q=this.getTab(q);q.tab.remove();q.content.remove()},_getActivate:function(){var q=this.cfg,m=q.tabs;q.contents.children("div");q=m.children("li");for(m=0;m<q.length;m++){var j=new s(q[m]);if(j.hasClass("ke-tab-selected"))return j.attr("rel")}},activate:function(q){if(arguments.length==
0)return this._getActivate();var m=this.cfg,j=m.tabs;m=m.contents.children("div");j.children("li").removeClass("ke-tab-selected");m.hide();j=this.getTab(q);j.tab.addClass("ke-tab-selected");j.content.show()}});t.Tabs=l}});
KISSY.Editor.add("templates",function(l){var p=KISSY,t=p.Editor,v=p.Node,s=t.Dialog;p.DOM.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");l.ready(function(){l.addButton("templates",
{contentCls:"ke-toolbar-template",title:"\u6a21\u677f",mode:t.WYSIWYG_MODE,offClick:function(){this.cfg._prepare.call(this)},_prepare:function(){for(var q=this.editor,m=q.cfg.pluginConfig.templates||[],j="<div class='ke-tpl'>",i=0;i<m.length;i++)j+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+m[i].demo+"</a>";j+="</div>";var b=new s({width:500,mask:true,autoRender:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:j});b.get("el").all(".ke-tpl-list").on("click",function(d){d.halt();d=(new v(d.target))._4e_index();
d!=-1&&q.insertHtml(m[d].html);b.hide()});this.ui=b;this.cfg.show.call(this);this.cfg._prepare=this.cfg.show},show:function(){this.ui.show()}})})});
KISSY.Editor.add("undo",function(l){var p=KISSY,t=p.Editor,v=t.Utils.arrayCompare,s=p.UA,q=p.Event;t.UndoManager||function(){function m(d){var e=d._getRawData(),g;if(e)g=d.getSelection();this.contents=e;this.bookmarks=g&&g.createBookmarks2(true)}function j(d){this.history=[];this.index=-1;this.editor=d;this.bufferRunner=t.Utils.buffer(this.save,this,500);this._init()}p.augment(m,{equals:function(d){if(this.contents!=d.contents)return false;var e=this.bookmarks;d=d.bookmarks;if(e||d){if(!e||!d||e.length!=
d.length)return false;for(var g=0;g<e.length;g++){var r=e[g],h=d[g];if(r.startOffset!=h.startOffset||r.endOffset!=h.endOffset||!v(r.start,h.start)||!v(r.end,h.end))return false}}return true}});var i={16:1,17:1,18:1},b={37:1,38:1,39:1,40:1,33:1,34:1};p.augment(j,{_keyMonitor:function(){var d=this.editor;q.on([d.document,d.textarea],"keydown",function(e){var g=e.keyCode;if(!(g in b||g in i))if(g===90&&(e.ctrlKey||e.metaKey)){d.fire("restore",{d:-1});e.halt()}else if(g===89&&(e.ctrlKey||e.metaKey)){d.fire("restore",
{d:1});e.halt()}else d.fire("save",{buffer:1})})},_init:function(){var d=this,e=d.editor;e.on("save",function(g){if(e.getMode()==t.WYSIWYG_MODE)g.buffer?d.bufferRunner():d.save()});e.on("restore",function(g){e.getMode()==t.WYSIWYG_MODE&&d.restore(g)});d._keyMonitor()},save:function(){var d=this.history,e=this.index;d.length>e+1&&d.splice(e+1,d.length-e-1);var g=this.editor;e=d[d.length-1];var r=new m(g);if(!e||!e.equals(r)){d.length===30&&d.shift();d.push(r);this.index=e=d.length-1;g.fire("afterSave",
{history:d,index:e})}},restore:function(d){d=d.d;var e=this.history,g=this.editor,r=e[this.index+d];if(r){g._setRawData(r.contents);if(r.bookmarks)g.getSelection().selectBookmarks(r.bookmarks);else if(s.ie){r=g.document.body.createTextRange();r.collapse(true);r.select()}(r=g.getSelection())&&r.scrollIntoView();this.index+=d;g.fire("afterRestore",{history:e,index:this.index});g.notifySelectionChange()}}});t.UndoManager=j}();l.ready(function(){new t.UndoManager(l);var m={redo:1,undo:-1},j={mode:t.WYSIWYG_MODE,
init:function(){this.editor.on("afterSave afterRestore",this.cfg._respond,this);this.btn.disable()},offClick:function(){this.editor.fire("restore",{d:m[this.cfg.flag]})}},i=p.mix({title:"\u64a4\u9500",flag:"undo",contentCls:"ke-toolbar-undo",_respond:function(b){var d=this.btn;b.index>0?d.boff():d.disable()}},j,false);j=p.mix({title:"\u91cd\u505a",flag:"redo",contentCls:"ke-toolbar-redo",_respond:function(b){var d=this.btn;b.index<b.history.length-1?d.boff():d.disable()}},j,false);l.addButton("undo",i);l.addButton("undo",
j)})});
