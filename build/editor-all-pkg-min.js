/*
 Constructor for kissy editor and module dependency definition
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.0
 @buildtime: 2010-11-10 13:03:14
*/
KISSY.add("editor",function(p,o){function s(k,a){function e(A){for(var q=s.Env.mods,j=0;j<A.length;j++){for(var y=A[j],t=u,B=0;B<j;B++)if(y==A[B]){t=z;break}B=q[y];if(t&&B){t=p.clone(B);y=y+"_"+j;t.name=y;A[j]=y;q[y]||(q[y]=t)}}}var f=this;if(!(f instanceof s))return new s(k,a);if(p.isString(k))k=p.one(k);k=v._4e_wrap(k);a=a||{};a.pluginConfig=a.pluginConfig||{};f.cfg=a;a.pluginConfig=a.pluginConfig;f.cfg=a;p.app(f,p.EventTarget);var r=["htmldataprocessor","enterkey","clipboard"],n=u;f.use=function(A,
q){A=A.split(",");e(A);if(!n)for(var j=0;j<r.length;j++){var y=r[j];p.inArray(y,A)||A.unshift(y)}p.use.call(f,A.join(","),function(){f.ready(function(){q&&q.call(f);if(!n){f.setData(k.val());if(a.focus)f.focus();else{var t=f.getSelection();t&&t.removeAllRanges()}f.fire("save");n=z}})},{order:z,global:s});return f};f.use=f.use;f.init(k);return f}function x(k){var a=p.Config.debug;k=a?a==="dev"?"../src/"+k:k:k.replace(/\.(js|css)/i,"-min.$1");k+=k.indexOf("?")!=-1?"&":"?";k+="t="+encodeURIComponent("2010-11-10 13:03:14");
return k}var v=p.DOM,z=true,u=false;p.app(s,p.EventTarget);s.Config.base=p.Config.base+"editor/";var l=["separator","sourcearea/support","tabs","flashbridge","flashutils","clipboard",{name:"colorsupport",requires:["overlay"]},{name:"colorsupport/dialog"},{name:"forecolor",requires:["colorsupport"]},{name:"bgcolor",requires:["colorsupport"]},{name:"elementpaths"},"enterkey",{name:"pagebreak",requires:["fakeobjects"]},{name:"fakeobjects",requires:["htmldataprocessor"]},{name:"draft",requires:["localStorage"]},
{name:"flash",requires:["flash/support"]},{name:"flash/dialog"},{name:"flash/support",requires:["flashutils","contextmenu","fakeobjects","bubbleview"]},{name:"font",requires:["select"]},"format",{name:"htmldataprocessor"},{name:"image",requires:["contextmenu","bubbleview"]},{name:"image/dialog",requires:["tabs"]},"indent","justify",{name:"link",requires:["bubbleview"]},{name:"link/dialog"},"list","maximize",{name:"music",requires:["flash/support"]},{name:"music/dialog",requires:["flash/dialog"]},
"preview","removeformat",{name:"smiley"},{name:"sourcearea",requires:["sourcearea/support"]},{name:"table",requires:["contextmenu"]},{name:"table/dialog"},{name:"templates",requires:["overlay"]},"undo",{name:"resize",requires:["dd"]}],m,g,c,b,d={};m=0;for(g=l.length;m<g;m++){c=l[m];if(p.isString(c))c=l[m]={name:c+"",requires:null};b=c.requires||[];var h=["button"];c.name.indexOf("/dialog")!=-1&&h.push("overlay");c.requires=b.concat(h)}l=[{name:"localStorage",requires:["flashutils","flashbridge"]},
{name:"button"},{name:"dd"},{name:"progressbar"},{name:"overlay",requires:["dd"]},{name:"contextmenu",requires:["overlay"]},{name:"bubbleview",requires:["overlay"]},{name:"select",requires:["overlay"]}].concat(l);m=0;for(g=l.length;m<g;m++){c=l[m];b=c.name;d[b]={attach:u,charset:"utf-8",requires:c.requires,csspath:c.useCss?x("plugins/"+b+"/plugin.css"):o,path:x("plugins/"+b+"/plugin.js")}}s.add(d);p.Editor=s;p.Editor=s});
KISSY.Editor.add("utils",function(p){var o=null,s=KISSY,x=s.Node,v=s.DOM,z=s.UA,u=s.Event,l;l=z.ie?document.documentMode||z.ie:void 0;var m={debugUrl:function(g){var c=s.Config.debug;g=c?c==="dev"?"../src/"+g:g:g.replace(/\.(js|css)/i,"-min.$1");g+=g.indexOf("?")!=-1?"&":"?";g+="t="+encodeURIComponent("2010-11-17 18:19:09");return g},lazyRun:function(g,c,b){var d=g[c],h=g[b];g[c]=function(){d.apply(this,arguments);g[c]=g[b];return h.apply(this,arguments)}},getXY:function(g,c,b,d){b=b.defaultView||
b.parentWindow;g-=v.scrollLeft(b);c-=v.scrollTop(b);if(d)if(b!=(d.defaultView||d.parentWindow)&&b.frameElement){d=v._4e_getOffset(b.frameElement,d);g+=d.left;c+=d.top}return{left:g,top:c}},tryThese:function(){for(var g,c=0,b=arguments.length;c<b;c++){var d=arguments[c];try{g=d();break}catch(h){}}return g},arrayCompare:function(g,c){if(!g&&!c)return true;if(!g||!c||g.length!=c.length)return false;for(var b=0;b<g.length;b++)if(g[b]!==c[b])return false;return true},getByAddress:function(g,c,b){g=g.documentElement;
for(var d=0;g&&d<c.length;d++){var h=c[d];if(b)for(var k=-1,a=0;a<g.childNodes.length;a++){var e=g.childNodes[a];if(!(b===true&&e.nodeType==3&&e.previousSibling&&e.previousSibling.nodeType==3)){k++;if(k==h){g=e;break}}}else g=g.childNodes[h]}return g?new x(g):o},clearAllMarkers:function(g){for(var c in g)g[c]._4e_clearMarkers(g,true)},htmlEncodeAttr:function(g){return g.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(g){return g.replace(/^\s+/,"")},rtrim:function(g){return g.replace(/\s+$/,
"")},trim:function(g){return this.ltrim(this.rtrim(g))},mix:function(){for(var g={},c=0;c<arguments.length;c++)g=s.mix(g,arguments[c]);return g},isCustomDomain:function(){if(!z.ie)return false;var g=document.domain,c=window.location.hostname;return g!=c&&g!="["+c+"]"},duplicateStr:function(g,c){return Array(c+1).join(g)},throttle:function(g,c,b){b=b||150;if(b===-1)return function(){g.apply(c,arguments)};var d=(new Date).getTime();return function(){var h=(new Date).getTime();if(h-d>b){d=h;g.apply(c,
arguments)}}},buffer:function(g,c,b){b=b||0;var d=o;return function(){d&&clearTimeout(d);var h=arguments;d=setTimeout(function(){return g.apply(c,h)},b)}},isNumber:function(g){return/^\d+(.\d+)?$/.test(s.trim(g))},verifyInputs:function(g){for(var c=0;c<g.length;c++){var b=v._4e_wrap(g[c]),d=s.trim(b.val()),h=b.attr("data-verify");b=b.attr("data-warning");if(h&&!RegExp(h).test(d)){alert(b);return false}}return true},sourceDisable:function(g,c){g.on("sourcemode",c.disable,c);g.on("wysiwygmode",c.enable,
c)},resetInput:function(g){var c=g.attr("placeholder");if(c&&!z.webkit){g.addClass("ke-input-tip");g.val(c)}else z.webkit&&g.val("")},valInput:function(g,c){g.removeClass("ke-input-tip");g.val(c)},placeholder:function(g,c){g.attr("placeholder",c);if(!z.webkit){g.on("blur",function(){if(!s.trim(g.val())){g.addClass("ke-input-tip");g.val(c)}});g.on("focus",function(){g.removeClass("ke-input-tip");s.trim(g.val())==c&&g.val("")})}},clean:function(g){g=g[0]||g;for(var c=s.makeArray(g.childNodes),b=0;b<
c.length;b++){var d=c[b];d.nodeType==p.NODE.NODE_TEXT&&!s.trim(d.nodeValue)&&g.removeChild(d)}},htmlEncode:function(g){return!g?g:String(g).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(g){return!g?g:String(g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(g,c){return g.toLowerCase()==c.toLowerCase()},normParams:function(g){g=s.clone(g);for(var c in g)if(g.hasOwnProperty(c)){var b=
g[c];if(s.isFunction(b))g[c]=b()}return g},doFormUpload:function(g,c,b){function d(){var n={responseText:"",responseXML:o};n.argument=g?g.argument:o;try{var A;if((A=z.ie?k.contentWindow.document:k.contentDocument||window.frames[h].document)&&A.body)n.responseText=A.body.innerHTML;n.responseXML=A&&A.XMLDocument?A.XMLDocument:A}catch(q){s.log(q)}u.remove(k,"load",d);g.callback&&g.callback(n);setTimeout(function(){v._4e_remove(k)},100)}var h=s.guid("form-upload-"),k=document.createElement("iframe");
k.id=h;k.name=h;k.className="ke-hidden";var a="document.open();"+(m.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(z.ie)k.src=z.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"";s.log("doFormUpload : "+k.src);document.body.appendChild(k);if(z.ie)document.frames[h].name=h;a=v._4e_unwrap(g.form);var e={target:a.target,method:a.method,encoding:a.encoding,enctype:a.enctype,action:a.action};a.target=h;a.method="POST";a.enctype=a.encoding="multipart/form-data";
if(b)a.action=b;var f;if(c){f=[];c=p.Utils.normParams(c);for(var r in c)if(c.hasOwnProperty(r)){b=document.createElement("input");b.type="hidden";b.name=r;b.value=c[r];a.appendChild(b);f.push(b)}}u.on(k,"load",d);a.submit();a.target=e.target;a.method=e.method;a.enctype=e.enctype;a.encoding=e.encoding;a.action=e.action;if(f){c=0;for(r=f.length;c<r;c++)v._4e_remove(f[c])}return k},extern:function(g,c){for(var b in c)g[b]=c[b]},map:function(g,c){for(var b=0;b<g.length;b++)g[b]=c(g[b]);return g},ieEngine:l};
p.Utils=m;p.Utils=m;m.extern(m,{debugUrl:m.debugUrl,lazyRun:m.lazyRun,getXY:m.getXY,tryThese:m.tryThese,arrayCompare:m.arrayCompare,getByAddress:m.getByAddress,clearAllMarkers:m.clearAllMarkers,htmlEncodeAttr:m.htmlEncodeAttr,ltrim:m.ltrim,rtrim:m.rtrim,trim:m.trim,mix:m.mix,isCustomDomain:m.isCustomDomain,duplicateStr:m.duplicateStr,buffer:m.buffer,isNumber:m.isNumber,verifyInputs:m.verifyInputs,sourceDisable:m.sourceDisable,resetInput:m.resetInput,placeholder:m.placeholder,clean:m.clean,htmlEncode:m.htmlEncode,
htmlDecode:m.htmlDecode,equalsIgnoreCase:m.equalsIgnoreCase,normParams:m.normParams,throttle:m.throttle,doFormUpload:m.doFormUpload,map:m.map})});
KISSY.Editor.add("focusmanager",function(p){function o(){this.iframeFocus=m;l=this}function s(){this.iframeFocus=g;l=c}var x=KISSY,v=x.DOM,z=x.Event,u={},l;x={refreshAll:function(){for(var b in u){var d=u[b];d.document.designMode="off";d.document.designMode="on"}},currentInstance:function(){return l},getInstance:function(b){return u[b]},add:function(b){var d=v._4e_getWin(b.document);z.on(d,"focus",o,b);z.on(d,"blur",s,b)},register:function(b){u[b._UUID]=b},remove:function(b){delete u[b._UUID];var d=
v._4e_getWin(b.document);z.remove(d,"focus",o,b);z.remove(d,"blur",s,b)}};var m=true,g=false,c=null;p.focusManager=x;p.focusManager=x;p.getInstances=function(){return u};p.getInstances=p.getInstances});
KISSY.Editor.add("definition",function(p){var o=true,s=false,x=document,v=KISSY,z=v.UA,u=v.DOM,l=v.Node,m=v.Event,g=p.focusManager,c=p.Utils.tryThese,b=p.Utils.debugUrl("theme/editor-iframe.css"),d=1,h="document.open();"+(p.Utils.isCustomDomain()?'document.domain="'+x.domain+'";':"")+"document.close();",k="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(z.ie?"javascript:void(function(){"+encodeURIComponent(h)+"}())":"")+'"  tabIndex="'+(z.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";p.SOURCE_MODE=0;p.WYSIWYG_MODE=1;p.SOURCE_MODE=p.SOURCE_MODE;p.WYSIWYG_MODE=p.WYSIWYG_MODE;v.augment(p,{init:function(a){if(z.ie)u.addClass(x.body,"ie"+z.ie);else if(z.gecko)u.addClass(x.body,"gecko");else z.webkit&&u.addClass(x.body,"webkit");var e=this,f=new l(k.replace(/\$\(tabIndex\)/,
a.attr("tabIndex")));f.on("mousedown",function(A){if(z.webkit){var q=u._4e_name(A.target);if(q=="select"||q=="option")return o}A.halt()});a.on("mousedown",function(A){A.stopPropagation()});e.editorWrap=f;e._UUID=d++;g.register(e);e.wrap=f.one(".ke-textarea-wrap");e.wrap=e.wrap;e.iframe=e.wrap.one("iframe");e.iframe=e.iframe;e.toolBarDiv=f.one(".ke-editor-tools");e.toolBarDiv=e.toolBarDiv;e.textarea=a;e.textarea=e.textarea;e.statusDiv=f.one(".ke-editor-status");e.statusDiv=e.statusDiv;e.toolBarDiv._4e_unselectable();
e._commands={};e._dialogs={};var r=a._4e_style("width"),n=a._4e_style("height");if(r){f.css("width",r);a.css("width","100%")}e.textarea.css("display","none");f.insertAfter(a);e.wrap[0].appendChild(a[0]);if(n){e.wrap.css("height",n);a.css("height","100%")}f=e.iframe;e.on("dataReady",function(){e._ready=o;p.fire("instanceCreated",{editor:e})});z.gecko?f.on("load",e._setUpIFrame,e):e._setUpIFrame();e.cfg.attachForm&&a[0].form&&e._attachForm()},_attachForm:function(){(new l(this.textarea[0].form)).on("submit",
this.sync,this)},useDialog:function(a,e){var f=this,r=p.SimpleOverlay;r.loading();f.use(a,function(){var n=f.getDialog(a);e(n);r.unloading()})},addDialog:function(a,e){this._dialogs[a]=e},getDialog:function(a){return this._dialogs[a]},addPlugin:function(a){this.ready(a)},addCommand:function(a,e){this._commands[a]=e},hasCommand:function(a){return this._commands[a]},execCommand:function(a){var e=this._commands[a],f=v.makeArray(arguments);f.shift();f.unshift(this);return e.exec.apply(e,f)},getMode:function(){return this.textarea.css("display")==
"none"?p.WYSIWYG_MODE:p.SOURCE_MODE},getData:function(a){var e;e=this.getMode()==p.WYSIWYG_MODE?this.document.body.innerHTML:this.textarea.val();if(this.htmlDataProcessor)e=a?this.htmlDataProcessor.toHtml(e,"p"):this.htmlDataProcessor.toServer(e,"p");e=v.trim(e);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(e))e="";return e},setData:function(a){var e=a;if(this.htmlDataProcessor)e=this.htmlDataProcessor.toDataFormat(a,"p");this.document.body.innerHTML=e;this.getMode()!=p.WYSIWYG_MODE&&this.textarea.val(a)},sync:function(){this.textarea.val(this.getData())},
baseZIndex:function(a){a=a||0;return a+(this.cfg.baseZIndex||0)},_getRawData:function(){return this.document.body.innerHTML},_setRawData:function(a){this.document.body.innerHTML=a},_prepareIFrameHtml:function(a){var e=this.cfg,f=e.customLink,r="";if(f)for(var n=0;n<f.length;n++)r+='<link href="'+f[n]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+p.Config.base+b+"' rel='stylesheet'/><style>"+(e.customStyle||"")+"</style>"+r+"</head><body class='ke-editor'>&nbsp;"+
(a?'<script id="ke_actscript" type="text/javascript">'+(p.Utils.isCustomDomain()?'document.domain="'+x.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':"")+"</body></html>"},getSelection:function(){return p.Selection.getSelection(this.document)},focus:function(){var a=this.document,e=u._4e_getWin(a);z.webkit&&e&&e.parent&&e.parent.focus();e&&e.focus();a&&a.body.focus();this.notifySelectionChange()},blur:function(){u._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},
addCustomStyle:function(a){var e=this.cfg,f=this.document;e.customStyle=e.customStyle||"";e.customStyle+="\n"+a;e=f.createElement("style");f.getElementsByTagName("head")[0].appendChild(e);if(e.styleSheet)e.styleSheet.cssText=a;else e.appendChild(f.createTextNode(a))},addCustomLink:function(a){var e=this.cfg,f=this.document;e.customLink=e.customLink||[];e.customLink.push(a);e=f.createElement("link");e.rel="stylesheet";f.getElementsByTagName("head")[0].appendChild(e);e.href=a},removeCustomLink:function(a){for(var e=
this.cfg,f=v.makeArray(this.document.getElementsByTagName("link")),r=0;r<f.length;r++)f[r].href==a&&u._4e_remove(f[r]);e.customLink=e.customLink||[];e=e.customLink;a=v.indexOf(a,e);a!=-1&&e.splice(a,1)},_setUpIFrame:function(){function a(){A=n.document;e.document=A;f.detach();A.open("text/html","replace");A.write(r);A.close()}var e=this,f=e.iframe,r=e._prepareIFrameHtml(e._UUID),n=f[0].contentWindow,A;try{A=n.document}catch(q){f[0].src=f[0].src;if(z.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this._ready?
a():this.on("dataReady",a)},_monitor:function(){var a=this;a._monitorId&&clearTimeout(a._monitorId);a._monitorId=setTimeout(function(){var e=a.getSelection();if(e&&!e.isInvalid){var f=e.getStartElement(),r=new p.ElementPath(f);if(!a.previousPath||!a.previousPath.compare(r)){a.previousPath=r;a.fire("selectionChange",{selection:e,path:r,element:f})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(a,e){var f=this;f.focus();var r=a._4e_name(),n=
p.XHTML_DTD,A=p.RANGE,q=p.NODE,j=n.$block[r],y=f.getSelection(),t=y&&y.getRanges(),B,i,w,C,D;if(!t||t.length==0){var E=arguments,F=E.callee;setTimeout(function(){F.apply(f,E)},30)}else{f.fire("save");for(var K=t.length-1;K>=0;K--){B=t[K];B.deleteContents();i=!K&&a||a._4e_clone(o);e&&e(i);if(j)for(;(C=B.getCommonAncestor(s,o))&&(D=n[C._4e_name()])&&!(D&&D[r]);)if(C._4e_name()in n.span)B.splitElement(C);else if(B.checkStartOfBlock()&&B.checkEndOfBlock()){B.setStartBefore(C);B.collapse(o);C._4e_remove()}else B.splitBlock();
B.insertNode(i);w||(w=i)}if(w){r=w._4e_nextSourceNode(o);n=f.document;D=p.XHTML_DTD;if(D.$inline[i._4e_name()]){r=new l(n.createTextNode(" "));r.insertAfter(w)}else if(r){if(r._4e_name()=="br"&&D[r.parent()._4e_name()].p){D=new l("<p>&nbsp;</p>",null,n);r[0].parentNode.replaceChild(D[0],r[0]);r=D}}else{D=new l("<p>&nbsp;</p>",null,n);D.insertAfter(w);r=D}B.moveToPosition(w,A.POSITION_AFTER_END);r&&r[0].nodeType==q.NODE_ELEMENT&&B.moveToElementEditablePosition(r);y.selectRanges([B]);f.focus();i&&i._4e_scrollIntoView();
setTimeout(function(){f.fire("save")},10);return i}}},insertHtml:function(a){var e=this;if(e.htmlDataProcessor)a=e.htmlDataProcessor.toDataFormat(a);if(z.webkit){var f=u.create(a,null,this.document);f=f.nodeType==11?v.makeArray(f.childNodes):[f];for(var r=0;r<f.length;r++)e.insertElement(new l(f[r]))}else{e.focus();r=(f=e.getSelection())&&f.getRanges();if(!r||r.length==0){var n=arguments,A=n.callee;setTimeout(function(){A.apply(e,n)},30)}else{e.fire("save");if(z.ie){f=f.getNative();f.type=="Control"&&
f.clear();f.createRange().pasteHTML(a)}else e.document.execCommand("inserthtml",s,a);e.focus();setTimeout(function(){e.fire("save")},10)}}}});p._initIFrame=function(a){function e(i){c(function(){n.designMode="on";setTimeout(function(){n.designMode="off";j.focus();if(!arguments.callee.retry)arguments.callee.retry=o},50)},function(){n.designMode="off";u.attr(j,"contentEditable",s);u.attr(j,"contentEditable",o);!i&&e(1)})}var f=g.getInstance(a);a=f.textarea[0];var r=f.iframe[0].contentWindow,n=f.document,
A=f.cfg,q=n.getElementById("ke_actscript");u._4e_remove(q);var j=n.body;if(z.ie){j.hideFocus=o;j.disabled=o;j.contentEditable=o;j.removeAttribute("disabled")}else setTimeout(function(){if(z.gecko||z.opera)j.contentEditable=o;else if(z.webkit)j.parentNode.contentEditable=o;else n.designMode="on"},0);if(z.webkit){m.on(n,"click",function(i){var w=new l(i.target);v.inArray(w._4e_name(),["input","select"])&&i.preventDefault()});m.on(n,"mouseup",function(i){var w=new l(i.target);v.inArray(w._4e_name(),
["input","textarea"])&&i.preventDefault()})}if(z.gecko||z.ie||z.opera){var y;y=new l(u.insertAfter((new l('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],a));y.on("focus",function(){f.focus()});f.activateGecko=function(){z.gecko&&f.iframeFocus&&y[0].focus()};f.on("destroy",function(){})}if(z.ie&&n.compatMode=="CSS1Compat"||z.gecko||z.opera){var t=new l(n.documentElement);t.on("mousedown",function(i){if(i.target==t[0]){z.gecko&&e(s);y[0].focus()}})}m.on(r,
"focus",function(){if(z.gecko)e(s);else z.opera&&j.focus();f.notifySelectionChange()});z.gecko&&m.on(f.document,"mousedown",function(){f.iframeFocus||e(s)});if(z.ie){m.on(n,"keydown",function(i){if(i.keyCode in{8:1,46:1}){var w=f.getSelection(),C=w.getSelectedElement();if(C){f.fire("save");var D=w.getRanges()[0].createBookmark();C._4e_remove();w.selectBookmarks([D]);f.fire("save");i.preventDefault()}}});if(n.compatMode=="CSS1Compat"){var B={33:1,34:1};m.on(n,"keydown",function(i){i.keyCode in B&&
setTimeout(function(){f.getSelection().scrollIntoView()},0)})}}setTimeout(function(){z.ie&&setTimeout(function(){if(n){j.runtimeStyle.marginBottom="0px";j.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){f.fire("dataReady");var i=A.disableObjectResizing,w=A.disableInlineTableEditing;if(i||w)try{n.execCommand("enableObjectResizing",s,!i);n.execCommand("enableInlineTableEditing",s,!w)}catch(C){m.on(j,z.ie?"resizestart":"resize",function(D){if(i||u._4e_name(D.target)==="table"&&w)D.preventDefault()})}},
10);z.webkit&&m.on(n,"mousedown",function(i){i=new l(i.target);v.inArray(i._4e_name(),["img","hr","input","textarea","select"])&&f.getSelection().selectElement(i)});z.gecko&&m.on(n,"dragstart",function(i){var w=new l(i.target);w._4e_name()==="img"&&/ke_/.test(w[0].className)&&i.preventDefault()});g.add(f)};h=p.prototype;p.Utils.extern(h,{setData:h.setData,getData:h.getData,insertElement:h.insertElement,insertHtml:h.insertHtml,ready:h.ready,addCustomStyle:h.addCustomStyle,addCommand:h.addCommand,hasCommand:h.hasCommand,
execCommand:h.execCommand,addPlugin:h.addPlugin,useDialog:h.useDialog,addDialog:h.addDialog,getDialog:h.getDialog,getMode:h.getMode,sync:h.sync,baseZIndex:h.baseZIndex,getSelection:h.getSelection,focus:h.focus,blur:h.blur,notifySelectionChange:h.notifySelectionChange})});
KISSY.Editor.add("zindex",function(){var p=KISSY.Editor;if(!p.zIndexManager){p.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};p.baseZIndex=function(o){var s=o,x=p.getInstances(),v;for(v in x){if(!x.hasOwnProperty(v))return;s=Math.max(s,x[v].baseZIndex(o))}return s};p.baseZIndex=p.baseZIndex;p.zIndexManager=p.zIndexManager}});
KISSY.Editor.add("dtd",function(p){p.XHTML_DTD=function(){function o(q){for(var j=arguments.length-1;j>0;)KISSY.mix(q,arguments[j--]);return q}var s={isindex:1,fieldset:1},x={input:1,button:1,select:1,textarea:1,label:1},v=o({a:1},x),z=o({iframe:1},v),u={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},l={ins:1,del:1,script:1,style:1},m=o({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},l),g=o({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},m),c=o({p:1},g);x=o({iframe:1},g,x);g={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var b=o({a:1},x),d={tr:1},h={"#":1},k=o({param:1},g),a=o({form:1},s,z,u,c),e={li:1},f={base:1,link:1,meta:1,title:1},r=o(f,{style:1,script:1}),n={head:1,body:1},A={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:o({html:1},n,f),$block:A,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:b,$body:o({script:1,style:1},A),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:n,head:r,style:h,body:a,base:{},link:{},meta:{},title:h,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:a,td:a,br:{},th:a,center:a,kbd:b,button:o(c,u),basefont:{},h5:b,h4:b,samp:b,h6:b,ol:e,h1:b,h3:b,option:h,h2:b,form:o(s,z,u,c),select:{optgroup:1,option:1},font:b,ins:b,menu:e,abbr:b,label:b,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:b,script:h,tfoot:d,cite:b,li:a,input:{},iframe:a,strong:b,textarea:h,noframes:a,big:b,small:b,span:b,hr:{},dt:b,sub:b,optgroup:{option:1},param:{},bdo:b,"var":b,div:a,object:k,sup:b,dd:a,strike:b,area:{},dir:e,map:o({area:1,form:1,p:1},s,l,u),applet:k,dl:{dt:1,dd:1},del:b,isindex:{},fieldset:o({legend:1},g),thead:d,ul:e,acronym:b,b:b,a:x,blockquote:a,caption:b,i:b,u:b,tbody:d,s:b,address:o(z,c),tt:b,legend:b,q:b,pre:o(m,v),p:b,em:b,dfn:b}}();p.XHTML_DTD=
p.XHTML_DTD});
KISSY.Editor.add("dom",function(p){function o(a){return a.replace(/-(\w)/g,function(e,f){return f.toUpperCase()})}var s=KISSY,x=s.DOM,v=s.UA,z=s.Node,u=p.Utils,l={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};p.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};p.NODE=p.NODE;p.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};p.POSITION=p.POSITION;var m=p.NODE,g=p.POSITION,c={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},b={hr:1},d=function(a){return a[0]||a},h=function(a){if(a&&!a[0])return new z(a);return a},k={_4e_wrap:h,_4e_unwrap:d,_4e_equals:function(a,e){if(!a&&!e)return true;if(!a||!e)return false;a=d(a);e=d(e);
return a===e},_4e_isBlockBoundary:function(a,e){a=h(a);var f=s.mix(s.mix({},b),e||{});return c[a.css("display")]||f[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=d(a);for(var e=a.parentNode.childNodes,f=0;f<e.length;f++)if(e[f]===a)return f;return-1},_4e_first:function(a,e){a=d(a);var f=a.firstChild;if((f=f&&new z(f))&&e&&!e(f))f=f._4e_next(e);return f},_4e_move:function(a,e,f){a=d(a);x._4e_remove(a);
e=d(e);f?e.insertBefore(a,e.firstChild):e.appendChild(a)},_4e_name:function(a){a=d(a);var e=a.nodeName.toLowerCase();if(v.ie)if((a=a.scopeName)&&a!="HTML")e=a.toLowerCase()+":"+e;return e},_4e_isIdentical:function(a,e){if(a._4e_name()!=e._4e_name())return false;var f=a[0].attributes,r=e[0].attributes,n=f.length,A=r.length;if(n!=A)return false;for(var q=0;q<n;q++){var j=f[q],y=j.name;if(j.specified&&a.attr(y)!=e.attr(y))return false}if(u.ieEngine<8)for(q=0;q<A;q++){j=r[q];y=j.name;if(j.specified&&
a.attr(y)!=e.attr(y))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=d(a).childNodes;for(var e=0,f=a.length;e<f;e++){var r=a[e],n=r.nodeType;if(!(n==m.NODE_ELEMENT&&r.getAttribute("_ke_bookmark")))if(n==m.NODE_ELEMENT&&!k._4e_isEmptyInlineRemoveable(r)||n==m.NODE_TEXT&&s.trim(r.nodeValue))return false}return true},_4e_moveChildren:function(a,e,f){a=d(a);e=e[0]||e;if(a!=e)if(f)for(;f=a.lastChild;)e.insertBefore(a.removeChild(f),e.firstChild);else for(;f=a.firstChild;)e.appendChild(a.removeChild(f))},
_4e_mergeSiblings:function(){function a(e,f,r){if(f[0]&&f[0].nodeType==m.NODE_ELEMENT){for(var n=[];f.attr("_ke_bookmark")||f._4e_isEmptyInlineRemoveable();){n.push(f);f=r?new z(f[0].nextSibling):new z(f[0].previousSibling);if(!f[0]||f[0].nodeType!=m.NODE_ELEMENT)return}if(e._4e_isIdentical(f)){for(var A=r?e[0].lastChild:e[0].firstChild;n.length;)n.shift()._4e_move(e,!r);f._4e_moveChildren(e,!r);f._4e_remove();A[0]&&A[0].nodeType==m.NODE_ELEMENT&&A._4e_mergeSiblings()}}}return function(e){if(e[0])if(l[e._4e_name()]||
e._4e_name()=="a"){a(e,new z(e[0].nextSibling),true);a(e,new z(e[0].previousSibling))}}}(),_4e_unselectable:v.gecko?function(a){a=d(a);a.style.MozUserSelect="none"}:v.webkit?function(a){a=d(a);a.style.KhtmlUserSelect="none"}:function(a){a=d(a);if(v.ie||v.opera){var e,f=0;for(a.unselectable="on";e=a.all[f++];)switch(e.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:e.unselectable="on"}}},_4e_getOffset:function(a,e){a=d(a);var f,r=0;f=0;var n=a.ownerDocument.defaultView||
a.ownerDocument.parentWindow,A=a.ownerDocument,q=A.documentElement;e=e||A;if(a.getBoundingClientRect){if(a!==A.body&&q!==a){f=a.getBoundingClientRect();r=f.left+(e===A?x.scrollLeft(n):0);f=f.top+(e===A?x.scrollTop(n):0)}if(e)if(n!=(e.defaultView||e.parentWindow)&&n.frameElement){n=k._4e_getOffset(n.frameElement,e);r+=n.left;f+=n.top}}return{left:r,top:f}},_4e_getFrameDocument:function(a){return(a=d(a))&&a.contentWindow.document},_4e_splitText:function(a,e){a=d(a);var f=a.ownerDocument;if(!(!a||a.nodeType!=
m.NODE_TEXT)){if(v.ie&&e==a.nodeValue.length){var r=f.createTextNode("");x.insertAfter(r,a);return new z(r)}r=new z(a.splitText(e));if(f.documentMode){f=f.createTextNode("");x.insertAfter(f,r[0]);x._4e_remove(f)}return r}},_4e_parents:function(a,e){a=h(a);var f=[];do f[e?"push":"unshift"](a);while(a=a.parent());return f},_4e_clone:function(a,e,f){a=d(a);a=a.cloneNode(e);if(!f){var r=function(n){if(n.nodeType==m.NODE_ELEMENT){n.removeAttribute("id");n=n.childNodes;for(var A=0;A<n.length;A++)r(n[A])}};
r(a)}return new z(a)},_4e_nextSourceNode:function(a,e,f,r){a=d(a);if(r&&!r.call){var n=r[0]||r;r=function(q){q=q[0]||q;return q!==n}}e=!e&&a.firstChild;var A=new z(a);if(!e){if(a.nodeType==m.NODE_ELEMENT&&r&&r(a,true)===false)return null;e=a.nextSibling}for(;!e&&(A=A.parent());){if(r&&r(A,true)===false)return null;e=A[0].nextSibling}if(!e)return null;e=x._4e_wrap(e);if(r&&r(e)===false)return null;if(f&&f!=e[0].nodeType)return e._4e_nextSourceNode(false,f,r);return e},_4e_previousSourceNode:function(a,
e,f,r){a=d(a);if(r&&!r.call){var n=r[0]||r;r=function(q){q=q[0]||q;return q!==n}}e=!e&&a.lastChild;var A=new z(a);if(!e){if(a.nodeType==m.NODE_ELEMENT&&r&&r(a,true)===false)return null;e=a.previousSibling}for(;!e&&(A=A.parent());){if(r&&r(A,true)===false)return null;e=A[0].previousSibling}if(!e)return null;e=x._4e_wrap(e);if(r&&r(e)===false)return null;if(f&&e[0].nodeType!=f)return e._4e_previousSourceNode(false,f,r);return e},_4e_contains:v.gecko?function(a,e){a=d(a);e=d(e);return!!(a.compareDocumentPosition(e)&
16)}:function(a,e){a=d(a);e=d(e);return e.nodeType!=m.NODE_ELEMENT?a.contains(e.parentNode):a!=e&&a.contains(e)},_4e_commonAncestor:function(a,e){if(a._4e_equals(e))return a;if(e[0].nodeType!=m.NODE_TEXT&&e._4e_contains(a))return e;var f=a[0].nodeType==m.NODE_TEXT?a.parent():a;do if(f[0].nodeType!=m.NODE_TEXT&&f._4e_contains(e))return f;while(f=f.parent());return null},_4e_ascendant:function(a,e,f){a=d(a);if(!f)a=a.parentNode;if(e&&!s.isFunction(e)){var r=e;e=function(n){return n._4e_name()==r}}for(;a&&
a.nodeType!=9;){if(!e||e(new z(a))===true)return new z(a);a=a.parentNode}return null},_4e_hasAttribute:u.ieEngine<9?function(a,e){a=d(a);var f=a.attributes[e];return!!(f&&f.specified)}:function(a,e){a=d(a);return a.hasAttribute(e)},_4e_hasAttributes:u.ieEngine<9?function(a){a=d(a);for(var e=a.attributes,f=0;f<e.length;f++){var r=e[f];switch(r.name){case "class":if(a.getAttribute("class"))return true;break;default:if(r.specified)return true}}return false}:function(a){a=d(a);v.gecko&&a.removeAttribute("_moz_dirty");
return a.hasAttributes()},_4e_position:function(a,e){var f=d(a),r=d(e);if(f.compareDocumentPosition)return f.compareDocumentPosition(r);if(f==r)return g.POSITION_IDENTICAL;if(f.nodeType==m.NODE_ELEMENT&&r.nodeType==m.NODE_ELEMENT){if(f.contains){if(f.contains(r))return g.POSITION_CONTAINS+g.POSITION_PRECEDING;if(r.contains(f))return g.POSITION_IS_CONTAINED+g.POSITION_FOLLOWING}if("sourceIndex"in f)return f.sourceIndex<0||r.sourceIndex<0?g.POSITION_DISCONNECTED:f.sourceIndex<r.sourceIndex?g.POSITION_PRECEDING:
g.POSITION_FOLLOWING}f=a._4e_address();r=e._4e_address();for(var n=Math.min(f.length,r.length),A=0;A<=n-1;A++)if(f[A]!=r[A]){if(A<n)return f[A]<r[A]?g.POSITION_PRECEDING:g.POSITION_FOLLOWING;break}return f.length<r.length?g.POSITION_CONTAINS+g.POSITION_PRECEDING:g.POSITION_IS_CONTAINED+g.POSITION_FOLLOWING},_4e_address:function(a,e){a=d(a);for(var f=[],r=a.ownerDocument.documentElement,n=a;n&&n!=r;){var A=n.parentNode,q=-1;if(A){for(var j=0;j<A.childNodes.length;j++){var y=A.childNodes[j];if(!(e&&
y.nodeType==3&&y.previousSibling&&y.previousSibling.nodeType==3)){q++;if(y==n)break}}f.unshift(q)}n=A}return f},_4e_breakParent:function(a,e){var f=new p.Range(a[0].ownerDocument);f.setStartAfter(a);f.setEndAfter(e);var r=f.extractContents();f.insertNode(a._4e_remove());a[0].parentNode.insertBefore(r,a[0].nextSibling)},_4e_style:function(a,e,f){a=h(a);if(f!==undefined)return a.css(e,f);a=d(a);return a.style[o(e)]},_4e_remove:function(a,e){var f=d(a),r=f.parentNode;if(r){if(e)for(var n;n=f.firstChild;)r.insertBefore(f.removeChild(n),
f);r.removeChild(f)}return a},_4e_trim:function(a){x._4e_ltrim(a);x._4e_rtrim(a)},_4e_ltrim:function(a){a=d(a);for(var e;e=a.firstChild;){if(e.nodeType==m.NODE_TEXT){var f=u.ltrim(e.nodeValue),r=e.nodeValue.length;if(f){if(f.length<r){(new z(e))._4e_splitText(r-f.length);a.removeChild(a.firstChild)}}else{a.removeChild(e);continue}}break}},_4e_rtrim:function(a){a=d(a);for(var e;e=a.lastChild;){if(e.type==m.NODE_TEXT){var f=u.rtrim(e.nodeValue),r=e.nodeValue.length;if(f){if(f.length<r){(new z(e))._4e_splitText(f.length);
a.removeChild(a.lastChild)}}else{a.removeChild(e);continue}}break}if(!v.ie&&!v.opera)(e=a.lastChild)&&e.nodeType==1&&e.nodeName.toLowerCase()=="br"&&e.parentNode.removeChild(e)},_4e_appendBogus:function(a){a=d(a);for(var e=a.lastChild;e&&e.nodeType==m.NODE_TEXT&&!s.trim(e.nodeValue);)e=e.previousSibling;if(!e||e.nodeType==m.NODE_TEXT||x._4e_name(e)!=="br"){e=v.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");v.gecko&&e.setAttribute("type","_moz");a.appendChild(e)}},_4e_previous:function(a,
e){var f=d(a),r;do r=(f=f.previousSibling)&&new z(f);while(r&&e&&!e(r));return r},_4e_last:function(a,e){a=x._4e_wrap(a);var f=a[0].lastChild;if((f=f&&new z(f))&&e&&!e(f))f=f._4e_previous(e);return f},_4e_next:function(a,e){var f=d(a),r;do r=(f=f.nextSibling)&&new z(f);while(r&&e&&!e(r));return r},_4e_outerHtml:function(a){a=d(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var e=a.ownerDocument.createElement("div");e.appendChild(a.cloneNode(true));return e.innerHTML},_4e_setMarker:function(a,
e,f,r){a=x._4e_wrap(a);var n=a.data("list_marker_id")||a.data("list_marker_id",s.guid()).data("list_marker_id"),A=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");e[n]=a;A[f]=1;return a.data(f,r)},_4e_clearMarkers:function(a,e,f){a=h(a);var r=a.data("list_marker_names"),n=a.data("list_marker_id"),A;for(A in r)a.removeData(A);a.removeData("list_marker_names");if(f){a.removeData("list_marker_id");delete e[n]}},_4e_copyAttributes:function(a,e,f){a=d(a);e=h(e);var r=
a.attributes;f=f||{};for(var n=0;n<r.length;n++){var A=r[n],q=A.name.toLowerCase(),j;if(!(q in f))if(q=="checked"&&(j=x.attr(a,q)))e.attr(q,j);else if(A.specified||v.ie&&A.value&&q=="value"){j=x.attr(a,q);if(j===null)j=A.nodeValue;e.attr(q,j)}}if(a.style.cssText!=="")e[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=x._4e_name(a);var e=p.XHTML_DTD;return(a=!e.$nonEditable[a]&&(e[a]||e.span))&&a["#"]},_4e_scrollIntoView:function(a){a=h(a);var e=a[0].ownerDocument,f=x.scrollLeft(e),r=
x.scrollTop(e),n=a.offset(),A=n.left;n=n.top;if(x.viewportHeight(e)+r<n||n<r||x.viewportWidth(e)+f<A||A<f)a.scrollIntoView(e)},_4e_getElementsByTagName:function(a,e,f){a=d(a);if(!v.ie&&f)e=f+":"+e;f=[];a=a.getElementsByTagName(e);for(e=0;e<a.length;e++)f.push(new z(a[e]));return f}};s.DOM._4e_inject=function(a){s.mix(x,a);for(var e in a)a.hasOwnProperty(e)&&function(f){z.prototype[f]=function(){var r=[].slice.call(arguments,0);r.unshift(this);return a[f].apply(null,r)}}(e)};u.extern(k,{_4e_wrap:k._4e_wrap,
_4e_unwrap:k._4e_unwrap,_4e_equals:k._4e_equals,_4e_isBlockBoundary:k._4e_isBlockBoundary,_4e_getWin:k._4e_getWin,_4e_index:k._4e_index,_4e_first:k._4e_first,_4e_move:k._4e_move,_4e_name:k._4e_name,_4e_isIdentical:k._4e_isIdentical,_4e_isEmptyInlineRemoveable:k._4e_isEmptyInlineRemoveable,_4e_moveChildren:k._4e_moveChildren,_4e_mergeSiblings:k._4e_mergeSiblings,_4e_unselectable:k._4e_unselectable,_4e_getOffset:k._4e_getOffset,_4e_getFrameDocument:k._4e_getFrameDocument,_4e_splitText:k._4e_splitText,
_4e_parents:k._4e_parents,_4e_clone:k._4e_clone,_4e_nextSourceNode:k._4e_nextSourceNode,_4e_previousSourceNode:k._4e_previousSourceNode,_4e_contains:k._4e_contains,_4e_commonAncestor:k._4e_commonAncestor,_4e_ascendant:k._4e_ascendant,_4e_hasAttribute:k._4e_hasAttribute,_4e_hasAttributes:k._4e_hasAttributes,_4e_position:k._4e_position,_4e_address:k._4e_address,_4e_breakParent:k._4e_breakParent,_4e_style:k._4e_style,_4e_remove:k._4e_remove,_4e_trim:k._4e_trim,_4e_ltrim:k._4e_ltrim,_4e_rtrim:k._4e_rtrim,
_4e_appendBogus:k._4e_appendBogus,_4e_last:k._4e_last,_4e_previous:k._4e_previous,_4e_next:k._4e_next,_4e_outerHtml:k._4e_outerHtml,_4e_setMarker:k._4e_setMarker,_4e_clearMarkers:k._4e_clearMarkers,_4e_getUniqueId:k._4e_getUniqueId,_4e_copyAttributes:k._4e_copyAttributes,_4e_isEditable:k._4e_isEditable,_4e_scrollIntoView:k._4e_scrollIntoView,_4e_getElementsByTagName:k._4e_getElementsByTagName});x._4e_inject(k)});
KISSY.Editor.add("elementpath",function(p){function o(g){var c=z,b=z,d=[];for(g=g;g&&g[0];){if(g[0].nodeType==v.NODE_ELEMENT){if(!this.lastElement)this.lastElement=g;var h=g._4e_name();if(!b){if(!c&&u[h])c=g;if(l[h]){var k;if(k=!c){if(k=h=="div"){a:{k=g;k=k[0]||k;k=k.childNodes;for(var a=0,e=k.length;a<e;a++){var f=k[a];if(f.nodeType==v.NODE_ELEMENT&&x.$block[f.nodeName.toLowerCase()]){k=true;break a}}k=false}k=!k}k=k}if(k)c=g;else b=g}}d.push(g);if(h=="body")break}g=g.parent()}this.block=this.block=
c;this.blockLimit=this.blockLimit=b;this.elements=this.elements=d}var s=KISSY.DOM,x=p.XHTML_DTD,v=p.NODE,z=null,u={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},l={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};o.prototype={compare:function(g){var c=this.elements;g=g&&g.elements;if(!g||c.length!=g.length)return false;for(var b=0;b<c.length;b++)if(!s._4e_equals(c[b],g[b]))return false;return true},contains:function(g){for(var c=this.elements,b=0;b<
c.length;b++)if(c[b]._4e_name()in g)return c[b];return z}};p.ElementPath=p.ElementPath=o;var m=o.prototype;p.Utils.extern(m,{compare:m.compare,contains:m.contains})});
KISSY.Editor.add("walker",function(p){function o(d,h){if(this._.end)return u;var k,a=this.range,e,f=this.guard,r=this.type,n=d?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;a.trim();if(a.collapsed){this.end();return u}}if(!d&&!this._.guardLTR){var A=a.endContainer,q=new c(A[0].childNodes[a.endOffset]);this._.guardLTR=function(B,i){return(B=g._4e_wrap(B))&&B[0]&&(!i||!g._4e_equals(A,B))&&(!q[0]||!B._4e_equals(q))&&(B[0].nodeType!=m.NODE_ELEMENT||!i||B._4e_name()!="body")}}if(d&&
!this._.guardRTL){var j=a.startContainer,y=a.startOffset>0&&new c(j[0].childNodes[a.startOffset-1]);this._.guardRTL=function(B,i){return(B=g._4e_wrap(B))&&B[0]&&(!i||!B._4e_equals(j))&&(!y[0]||!B._4e_equals(y))&&(B[0].nodeType!=m.NODE_ELEMENT||!i||B._4e_name()!="body")}}var t=d?this._.guardRTL:this._.guardLTR;e=f?function(B,i){if(t(B,i)===z)return z;return f(B,i)}:t;if(this.current)k=this.current[n](z,r,e);else if(d){k=a.endContainer;if(a.endOffset>0){k=new c(k[0].childNodes[a.endOffset-1]);if(e(k)===
z)k=u}else k=e(k,v)===z?u:k._4e_previousSourceNode(v,r,e)}else{k=a.startContainer;if((k=new c(k[0].childNodes[a.startOffset]))&&k[0]){if(e(k)===z)k=u}else k=e(a.startContainer,v)===z?u:a.startContainer._4e_nextSourceNode(v,r,e)}for(;k&&k[0]&&!this._.end;){this.current=k;if(!this.evaluator||this.evaluator(k)!==z){if(!h)return k}else if(h&&this.evaluator)return z;k=k[n](z,r,e)}this.end();return this.current=u}function s(d){for(var h,k=u;h=o.call(this,d);)k=h;return k}function x(d){this.range=d;this._=
{}}var v=true,z=false,u=null,l=KISSY,m=p.NODE,g=l.DOM,c=l.Node;l.augment(x,{end:function(){this._.end=1},next:function(){return o.call(this)},previous:function(){return o.call(this,v)},checkForward:function(){return o.call(this,z,v)!==z},checkBackward:function(){return o.call(this,v,v)!==z},lastForward:function(){return s.call(this)},lastBackward:function(){return s.call(this,v)},reset:function(){delete this.current;this._={}}});x.blockBoundary=function(d){return function(h){h=g._4e_wrap(h);return!(h&&
h[0].nodeType==m.NODE_ELEMENT&&h._4e_isBlockBoundary(d))}};x.listItemBoundary=function(){return this.blockBoundary({br:1})};x.bookmark=function(d,h){function k(a){return a&&a[0]&&a._4e_name()=="span"&&a.attr("_ke_bookmark")}return function(a){var e,f;e=a&&a[0]&&a[0].nodeType==m.NODE_TEXT&&(f=a.parent())&&k(f);e=d?e:e||k(a);return h^e}};x.whitespaces=function(d){return function(h){h=(h=h[0]||h)&&h.nodeType==m.NODE_TEXT&&!l.trim(h.nodeValue);return d^h}};x.invisible=function(d){var h=x.whitespaces();
return function(k){k=h(k)||k[0].nodeType==m.NODE_ELEMENT&&!k[0].offsetHeight;return d^k}};p.Walker=x;p.Walker=x;var b=x.prototype;p.Utils.extern(b,{end:b.end,next:b.next,previous:b.previous,checkForward:b.checkForward,checkBackward:b.checkBackward,lastForward:b.lastForward,lastBackward:b.lastBackward,reset:b.reset});p.Utils.extern(x,{blockBoundary:x.blockBoundary,listItemBoundary:x.listItemBoundary,bookmark:x.bookmark,whitespaces:x.whitespaces,invisible:x.invisible})});
KISSY.Editor.add("range",function(p){function o(i){this.endOffset=this.endContainer=this.startOffset=this.startContainer=g;this.collapsed=l;this.document=i}function s(i){var w=i[0].nodeType!=b.NODE_TEXT&&i._4e_name()in r.$removeEmpty,C=!c.trim(i[0].nodeValue);i=!!i.parent().attr("_ke_bookmark");return w||C||i}function x(i){return!y(i)&&!t(i)}function v(i){var w=m,C=k.bookmark(l);return function(D){if(C(D))return l;if(D[0].nodeType==b.NODE_TEXT){if(c.trim(D[0].nodeValue).length)return m}else if(D[0].nodeType==
b.NODE_ELEMENT)if(!j[D._4e_name()])if(!i&&!f.ie&&D._4e_name()=="br"&&!w)w=l;else return m;return l}}function z(i,w){function C(D){return D&&D.nodeName=="span"&&D.getAttribute("_ke_bookmark")}return function(D){var E,F;E=D&&!D.nodeName&&(F=D.parentNode)&&C(F);E=i?E:E||C(D);return w^E}}function u(i){return function(w){w=(w=w[0]||w)&&w.nodeType==b.NODE_TEXT&&!c.trim(w.nodeValue);return i^w}}p.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};p.RANGE=p.RANGE;var l=true,m=false,g=null,c=KISSY,b=p.NODE,d=p.RANGE,h=p.POSITION,k=p.Walker,a=c.DOM,e=p.Utils.getByAddress,f=c.UA,r=p.XHTML_DTD,n=p.ElementPath,A=c.Node,q={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};o.prototype.toString=function(){var i=[];i.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);i.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return i.join("<br/>")};c.augment(o,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&a._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var i=this.startContainer,w=this.startOffset;if(i[0].nodeType!=b.NODE_ELEMENT)if(w)w>=i[0].nodeValue.length&&this.setStartAfter(i);else this.setStartBefore(i);i=this.endContainer;w=this.endOffset;if(i[0].nodeType!=b.NODE_ELEMENT)if(w)w>=
i[0].nodeValue.length&&this.setEndAfter(i);else this.setEndBefore(i)},setStartAfter:function(i){this.setStart(i.parent(),i._4e_index()+1)},setStartBefore:function(i){this.setStart(i.parent(),i._4e_index())},setEndAfter:function(i){this.setEnd(i.parent(),i._4e_index()+1)},setEndBefore:function(i){this.setEnd(i.parent(),i._4e_index())},optimizeBookmark:function(){var i=this.startContainer,w=this.endContainer;i&&i._4e_name()=="span"&&i.attr("_ke_bookmark")&&this.setStartAt(i,d.POSITION_BEFORE_START);
w&&w._4e_name()=="span"&&w.attr("_ke_bookmark")&&this.setEndAt(w,d.POSITION_AFTER_END)},setStart:function(i,w){if(i[0].nodeType==b.NODE_ELEMENT&&q[i._4e_name()]){i=i.parent();w=i._4e_index()}this.startContainer=i;this.startOffset=w;if(!this.endContainer){this.endContainer=i;this.endOffset=w}this.updateCollapsed()},setEnd:function(i,w){if(i[0].nodeType==b.NODE_ELEMENT&&q[i._4e_name()]){i=i.parent();w=i._4e_index()+1}this.endContainer=i;this.endOffset=w;if(!this.startContainer){this.startContainer=
i;this.startOffset=w}this.updateCollapsed()},setStartAt:function(i,w){switch(w){case d.POSITION_AFTER_START:this.setStart(i,0);break;case d.POSITION_BEFORE_END:i[0].nodeType==b.NODE_TEXT?this.setStart(i,i[0].nodeValue.length):this.setStart(i,i[0].childNodes.length);break;case d.POSITION_BEFORE_START:this.setStartBefore(i);break;case d.POSITION_AFTER_END:this.setStartAfter(i)}this.updateCollapsed()},setEndAt:function(i,w){switch(w){case d.POSITION_AFTER_START:this.setEnd(i,0);break;case d.POSITION_BEFORE_END:i[0].nodeType==
b.NODE_TEXT?this.setEnd(i,i[0].nodeValue.length):this.setEnd(i,i[0].childNodes.length);break;case d.POSITION_BEFORE_START:this.setEndBefore(i);break;case d.POSITION_AFTER_END:this.setEndAfter(i)}this.updateCollapsed()},execContentsAction:function(i,w){var C=this.startContainer,D=this.endContainer,E=this.startOffset,F=this.endOffset,K,M=this.document,N;this.optimizeBookmark();if(D[0].nodeType==b.NODE_TEXT)D=D._4e_splitText(F);else if(D[0].childNodes.length>0)if(F>=D[0].childNodes.length){D=new A(D[0].appendChild(M.createTextNode("")));
N=l}else D=new A(D[0].childNodes[F]);if(C[0].nodeType==b.NODE_TEXT){C._4e_splitText(E);if(C._4e_equals(D))D=new A(C[0].nextSibling)}else if(E)if(E>=C[0].childNodes.length){K=new A(M.createTextNode(""));C.append(K);C=K;K=l}else C=new A(C[0].childNodes[E].previousSibling);else{K=new A(M.createTextNode(""));(E=C[0].firstChild)?a.insertBefore(K[0],E):C.append(K);C=K;K=l}E=C._4e_parents();F=D._4e_parents();var Q,U,T;for(Q=0;Q<E.length;Q++){U=E[Q];T=F[Q];if(!U._4e_equals(T))break}M=w;for(var S,G,L,H=Q;H<
E.length;H++){S=E[H];G=M&&!S._4e_equals(C)?M.appendChild(S._4e_clone()[0]):null;for(S=S[0].nextSibling;S;){if(a._4e_equals(F[H],S)||a._4e_equals(D,S))break;L=S.nextSibling;if(i==2)M.appendChild(S.cloneNode(l));else{a._4e_remove(S);i==1&&M.appendChild(S)}S=L}if(G)M=G}M=w;for(Q=Q;Q<F.length;Q++){S=F[Q];G=M&&i>0&&!S._4e_equals(D)?M.appendChild(S._4e_clone()[0]):null;if(!E[Q]||!S.parent()._4e_equals(E[Q].parent()))for(S=S[0].previousSibling;S;){if(a._4e_equals(E[Q],S)||a._4e_equals(C,S))break;L=S.previousSibling;
if(i==2)M.insertBefore(S.cloneNode(l),M.firstChild);else{a._4e_remove(S);i==1&&M.insertBefore(S,M.firstChild)}S=L}if(G)M=G}if(i==2){T=this.startContainer[0];if(T.nodeType==b.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==b.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}T=this.endContainer[0];if(T.nodeType==b.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==b.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}}else{if(U&&T&&(!C.parent()._4e_equals(U.parent())||
!D.parent()._4e_equals(T.parent()))){U=T._4e_index();K&&T.parent()._4e_equals(C.parent())&&U--;this.setStart(T.parent(),U)}this.collapse(l)}K&&C._4e_remove();N&&D[0].parentNode&&D._4e_remove()},collapse:function(i){if(i){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=l},clone:function(){var i=new o(this.document);i.startContainer=this.startContainer;i.startOffset=this.startOffset;i.endContainer=
this.endContainer;i.endOffset=this.endOffset;i.collapsed=this.collapsed;return i},getEnclosedNode:function(){var i=this.clone();i.optimize();if(i.startContainer[0].nodeType!=b.NODE_ELEMENT||i.endContainer[0].nodeType!=b.NODE_ELEMENT)return g;var w=new p.Walker(i),C=z(l,undefined),D=u(l);i.evaluator=function(E){return D(E)&&C(E)};i=w.next();w.reset();w=w.previous();return i&&i._4e_equals(w)?i:g},shrink:function(i,w){if(!this.collapsed){i=i||d.SHRINK_TEXT;var C=this.clone(),D=this.startContainer,E=
this.endContainer,F=this.startOffset,K=this.endOffset,M=1,N=1;if(D&&D[0].nodeType==b.NODE_TEXT)if(F)if(F>=D[0].nodeValue.length)C.setStartAfter(D);else{C.setStartBefore(D);M=0}else C.setStartBefore(D);if(E&&E[0].nodeType==b.NODE_TEXT)if(K)if(K>=E[0].nodeValue.length)C.setEndAfter(E);else{C.setEndAfter(E);N=0}else C.setEndBefore(E);C=new k(C);C.evaluator=function(U){U=U[0]||U;return U.nodeType==(i==d.SHRINK_ELEMENT?b.NODE_ELEMENT:b.NODE_TEXT)};var Q;C.guard=function(U,T){U=U[0]||U;if(i==d.SHRINK_ELEMENT&&
U.nodeType==b.NODE_TEXT)return m;if(T&&U==Q)return m;if(!T&&U.nodeType==b.NODE_ELEMENT)Q=U;return l};if(M)(D=C[i==d.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(D,w?d.POSITION_AFTER_START:d.POSITION_BEFORE_START);if(N){C.reset();(C=C[i==d.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(C,w?d.POSITION_BEFORE_END:d.POSITION_AFTER_END)}return!!(M||N)}},getTouchedStartNode:function(){var i=this.startContainer;if(this.collapsed||i[0].nodeType!=b.NODE_ELEMENT)return i;return i.childNodes[this.startOffset]||
i},createBookmark2:function(i){var w=this.startContainer,C=this.endContainer,D=this.startOffset,E=this.endOffset,F,K;if(!w||!C)return{start:0,end:0};if(i){if(w[0].nodeType==b.NODE_ELEMENT)if((F=new A(w[0].childNodes[D]))&&F[0]&&F[0].nodeType==b.NODE_TEXT&&D>0&&F[0].previousSibling.nodeType==b.NODE_TEXT){w=F;D=0}for(;w[0].nodeType==b.NODE_TEXT&&(K=w._4e_previous())&&K[0].nodeType==b.NODE_TEXT;){w=K;D+=K[0].nodeValue.length}if(!this.collapsed){if(C[0].nodeType==b.NODE_ELEMENT)if((F=new A(C[0].childNodes[E]))&&
F[0]&&F[0].nodeType==b.NODE_TEXT&&E>0&&F[0].previousSibling.nodeType==b.NODE_TEXT){C=F;E=0}for(;C[0].nodeType==b.NODE_TEXT&&(K=C._4e_previous())&&K[0].nodeType==b.NODE_TEXT;){C=K;E+=K[0].nodeValue.length}}}return{start:w._4e_address(i),end:this.collapsed?g:C._4e_address(i),startOffset:D,endOffset:E,normalized:i,is2:l}},createBookmark:function(i){var w,C,D,E,F=this.collapsed;w=new A("<span>",g,this.document);w.attr("_ke_bookmark",1);w.css("display","none");w.html("&nbsp;");if(i){D=c.guid("ke_bm_");
w.attr("id",D+"S")}if(!F){C=w._4e_clone();C.html("&nbsp;");i&&C.attr("id",D+"E");E=this.clone();E.collapse();E.insertNode(C)}E=this.clone();E.collapse(l);E.insertNode(w);if(C){this.setStartAfter(w);this.setEndBefore(C)}else this.moveToPosition(w,d.POSITION_AFTER_END);return{startNode:i?D+"S":w,endNode:i?D+"E":C,serializable:i,collapsed:F}},moveToPosition:function(i,w){this.setStartAt(i,w);this.collapse(l)},trim:function(i,w){var C=this.startContainer,D=this.startOffset,E=this.collapsed;if((!i||E)&&
C[0]&&C[0].nodeType==b.NODE_TEXT){if(D)if(D>=C[0].nodeValue.length){D=C._4e_index()+1;C=C.parent()}else{var F=C._4e_splitText(D);D=C._4e_index()+1;C=C.parent();if(a._4e_equals(this.startContainer,this.endContainer))this.setEnd(F,this.endOffset-this.startOffset);else if(a._4e_equals(C,this.endContainer))this.endOffset+=1}else{D=C._4e_index();C=C.parent()}this.setStart(C,D);if(E){this.collapse(l);return}}C=this.endContainer;D=this.endOffset;if(!(w||E)&&C[0]&&C[0].nodeType==b.NODE_TEXT){if(D){D>=C.nodeValue.length||
C._4e_splitText(D);D=C._4e_index()+1}else D=C._4e_index();C=C.parent();this.setEnd(C,D)}},insertNode:function(i){this.optimizeBookmark();this.trim(m,l);var w=this.startContainer,C=w[0].childNodes[this.startOffset];C?a.insertBefore(i[0]||i,C):w[0].appendChild(i[0]||i);a._4e_equals(i.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(i)},moveToBookmark:function(i){if(i.is2){var w=e(this.document,i.start,i.normalized),C=i.startOffset,D=i.end&&e(this.document,i.end,i.normalized);i=i.endOffset;
this.setStart(w,C);D?this.setEnd(D,i):this.collapse(l)}else{w=(C=i.serializable)?c.one("#"+i.startNode,this.document):i.startNode;i=C?c.one("#"+i.endNode,this.document):i.endNode;this.setStartBefore(w);w._4e_remove();if(i&&i[0]){this.setEndBefore(i);i._4e_remove()}else this.collapse(l)}},getCommonAncestor:function(i,w){var C=this.startContainer,D=this.endContainer;C=a._4e_equals(C,D)?i&&C[0].nodeType==b.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new A(C[0].childNodes[this.startOffset]):C:C._4e_commonAncestor(D);
return w&&C[0].nodeType==b.NODE_TEXT?C.parent():C},enlarge:function(i){switch(i){case d.ENLARGE_ELEMENT:if(this.collapsed)break;i=this.getCommonAncestor();var w=new A(this.document.body),C,D,E,F,K,M=m,N,Q;N=this.startContainer;Q=this.startOffset;if(N[0].nodeType==b.NODE_TEXT){if(Q){N=!c.trim(N[0].nodeValue.substring(0,Q)).length&&N;M=!!N}if(N)if(!(F=N[0].previousSibling))E=N.parent()}else{if(Q)F=N[0].childNodes[Q-1]||N[0].lastChild;F||(E=N)}for(;E||F;){if(E&&!F){if(!K&&a._4e_equals(E,i))K=l;if(!w._4e_contains(E))break;
if(!M||E.css("display")!="inline"){M=m;if(K)C=E;else this.setStartBefore(E)}F=E[0].previousSibling}for(;F;){N=m;if(F.nodeType==b.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=g;N=/[\s\ufeff]$/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(M&&r.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=g;else for(var U=F.all||F.getElementsByTagName("*"),T=0,S;S=U[T++];)if(!r.$removeEmpty[S.nodeName.toLowerCase()]){F=g;break}if(F)N=!!Q.length}else F=g;
if(N)if(M)if(K)C=E;else E&&this.setStartBefore(E);else M=l;if(F){N=F.previousSibling;if(!E&&!N){E=new A(F);F=g;break}F=N}else E=g}if(E)E=E.parent()}N=this.endContainer;Q=this.endOffset;E=F=g;K=M=m;if(N[0].nodeType==b.NODE_TEXT){N=!c.trim(N[0].nodeValue.substring(Q)).length&&N;M=!(N&&N[0].nodeValue.length);if(N)if(!(F=N[0].nextSibling))E=N.parent()}else(F=N[0].childNodes[Q])||(E=N);for(;E||F;){if(E&&!F){if(!K&&a._4e_equals(E,i))K=l;if(!w._4e_contains(E))break;if(!M||E.css("display")!="inline"){M=m;
if(K)D=E;else E&&this.setEndAfter(E)}F=E[0].nextSibling}for(;F;){N=m;if(F.nodeType==b.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=g;N=/^[\s\ufeff]/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(M&&r.$removeEmpty[F.nodeName.toLowerCase()]){Q=a.text(F);if(/[^\s\ufeff]/.test(Q))F=g;else{U=F.all||F.getElementsByTagName("*");for(T=0;S=U[T++];)if(!r.$removeEmpty[S.nodeName.toLowerCase()]){F=g;break}}if(F)N=!!Q.length}else F=g;if(N)if(M)if(K)D=E;else this.setEndAfter(E);if(F){N=
F.nextSibling;if(!E&&!N){E=new A(F);F=g;break}F=N}else E=g}if(E)E=E.parent()}if(C&&D){i=C._4e_contains(D)?D:C;this.setStartBefore(i);this.setEndAfter(i)}break;case d.ENLARGE_BLOCK_CONTENTS:case d.ENLARGE_LIST_ITEM_CONTENTS:E=new o(this.document);w=new A(this.document.body);E.setStartAt(w,d.POSITION_AFTER_START);E.setEnd(this.startContainer,this.startOffset);E=new k(E);var G,L,H=k.blockBoundary(i==d.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:g),I=function(J){var O=H(J);O||(G=J);return O};C=function(J){var O=
I(J);if(!O&&J[0]&&J._4e_name()=="br")L=J;return O};E.guard=I;E=E.lastBackward();G=G||w;this.setStartAt(G,G._4e_name()!="br"&&(!E&&this.checkStartOfBlock()||E&&G._4e_contains(E))?d.POSITION_AFTER_START:d.POSITION_AFTER_END);E=this.clone();E.collapse();E.setEndAt(w,d.POSITION_BEFORE_END);E=new k(E);E.guard=i==d.ENLARGE_LIST_ITEM_CONTENTS?C:I;G=g;E=E.lastForward();G=G||w;this.setEndAt(G,!E&&this.checkEndOfBlock()||E&&G._4e_contains(E)?d.POSITION_BEFORE_END:d.POSITION_BEFORE_START);L&&this.setEndAfter(L)}},
checkStartOfBlock:function(){var i=this.startContainer,w=this.startOffset;if(w&&i[0].nodeType==b.NODE_TEXT)if(c.trim(i[0].nodeValue.substring(0,w)).length)return m;this.trim();i=new n(this.startContainer);w=this.clone();w.collapse(l);w.setStartAt(i.block||i.blockLimit,d.POSITION_AFTER_START);i=new k(w);i.evaluator=v(l);return i.checkBackward()},checkEndOfBlock:function(){var i=this.endContainer,w=this.endOffset;if(i[0].nodeType==b.NODE_TEXT)if(c.trim(i[0].nodeValue.substring(w)).length)return m;this.trim();
i=new n(this.endContainer);w=this.clone();w.collapse(m);w.setEndAt(i.block||i.blockLimit,d.POSITION_BEFORE_END);i=new k(w);i.evaluator=v(m);return i.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var i=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,i);return i},checkBoundaryOfElement:function(i,w){var C=this.clone();C[w==d.START?"setStartAt":"setEndAt"](i,w==d.START?d.POSITION_AFTER_START:d.POSITION_BEFORE_END);
C=new k(C);C.evaluator=s;return C[w==d.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var i=this.startContainer,w=this.endContainer,C=this.startOffset,D=this.endOffset,E;if(i[0].nodeType==b.NODE_ELEMENT){E=i[0].childNodes.length;if(E>C)i=new A(i[0].childNodes[C]);else if(E<1)i=i._4e_previousSourceNode();else{for(i=i[0];i.lastChild;)i=i.lastChild;i=new A(i);i=i._4e_nextSourceNode()||i}}if(w[0].nodeType==b.NODE_ELEMENT){E=w[0].childNodes.length;if(E>D)w=(new A(w[0].childNodes[D]))._4e_previousSourceNode(l);
else if(E<1)w=w._4e_previousSourceNode();else{for(w=w[0];w.lastChild;)w=w.lastChild;w=new A(w)}}if(i._4e_position(w)&h.POSITION_FOLLOWING)i=w;return{startNode:i,endNode:w}},fixBlock:function(i,w){var C=this.createBookmark(),D=new A(this.document.createElement(w));this.collapse(i);this.enlarge(d.ENLARGE_BLOCK_CONTENTS);D[0].appendChild(this.extractContents());D._4e_trim();f.ie||D._4e_appendBogus();this.insertNode(D);this.moveToBookmark(C);return D},splitBlock:function(i){var w=new n(this.startContainer),
C=new n(this.endContainer),D=w.block,E=C.block,F=g;if(!w.blockLimit._4e_equals(C.blockLimit))return g;if(i!="br"){if(!D){D=this.fixBlock(l,i);E=(new n(this.endContainer)).block}E||(E=this.fixBlock(m,i))}i=D&&this.checkStartOfBlock();w=E&&this.checkEndOfBlock();this.deleteContents();if(D&&a._4e_equals(D,E))if(w){F=new n(this.startContainer);this.moveToPosition(E,d.POSITION_AFTER_END);E=g}else if(i){F=new n(this.startContainer);this.moveToPosition(D,d.POSITION_BEFORE_START);D=g}else{E=this.splitElement(D);
!f.ie&&!c.inArray(D._4e_name(),["ul","ol"])&&D._4e_appendBogus()}return{previousBlock:D,nextBlock:E,wasStartOfBlock:i,wasEndOfBlock:w,elementPath:F}},splitElement:function(i){if(!this.collapsed)return g;this.setEndAt(i,d.POSITION_BEFORE_END);var w=this.extractContents(),C=i._4e_clone(m);C[0].appendChild(w);C.insertAfter(i);this.moveToPosition(i,d.POSITION_AFTER_END);return C},moveToElementEditablePosition:function(i,w){var C,D=p.XHTML_DTD;if(D.$empty[i._4e_name()])return m;for(;i&&i[0].nodeType==
b.NODE_ELEMENT;){if(C=i._4e_isEditable())this.moveToPosition(i,w?d.POSITION_BEFORE_END:d.POSITION_AFTER_START);else if(D.$inline[i._4e_name()]){this.moveToPosition(i,w?d.POSITION_AFTER_END:d.POSITION_BEFORE_START);return l}if((i=D.$empty[i._4e_name()]?i[w?"_4e_previous":"_4e_next"](x):i[w?"_4e_last":"_4e_first"](x))&&i[0].nodeType==b.NODE_TEXT){this.moveToPosition(i,w?d.POSITION_AFTER_END:d.POSITION_BEFORE_START);return l}}return C},selectNodeContents:function(i){this.setStart(i,0);this.setEnd(i,
i[0].nodeType==b.NODE_TEXT?i[0].nodeValue.length:i[0].childNodes.length)}});var j={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},y=new k.whitespaces,t=new k.bookmark;p.Range=o;p.Range=o;var B=o.prototype;p.Utils.extern(B,{updateCollapsed:B.updateCollapsed,optimize:B.optimize,setStartAfter:B.setStartAfter,setEndAfter:B.setEndAfter,setStartBefore:B.setStartBefore,setEndBefore:B.setEndBefore,
optimizeBookmark:B.optimizeBookmark,setStart:B.setStart,setEnd:B.setEnd,setStartAt:B.setStartAt,setEndAt:B.setEndAt,execContentsAction:B.execContentsAction,collapse:B.collapse,clone:B.clone,getEnclosedNode:B.getEnclosedNode,shrink:B.shrink,getTouchedStartNode:B.getTouchedStartNode,createBookmark2:B.createBookmark2,createBookmark:B.createBookmark,moveToPosition:B.moveToPosition,trim:B.trim,insertNode:B.insertNode,moveToBookmark:B.moveToBookmark,getCommonAncestor:B.getCommonAncestor,enlarge:B.enlarge,
checkStartOfBlock:B.checkStartOfBlock,checkEndOfBlock:B.checkEndOfBlock,deleteContents:B.deleteContents,extractContents:B.extractContents,checkBoundaryOfElement:B.checkBoundaryOfElement,getBoundaryNodes:B.getBoundaryNodes,fixBlock:B.fixBlock,splitBlock:B.splitBlock,splitElement:B.splitElement,moveToElementEditablePosition:B.moveToElementEditablePosition,selectNodeContents:B.selectNodeContents})});
KISSY.Editor.add("domiterator",function(p){function o(k){if(!(arguments.length<1)){this.range=k;this.forceBrBreak=x;this.enlargeBr=s;this.enforceRealBlocks=x;this._||(this._={})}}var s=true,x=false,v=KISSY,z=v.UA,u=p.Walker,l=p.Range,m=p.RANGE,g=p.NODE,c=p.ElementPath,b=v.Node,d=v.DOM,h=/^[\r\n\t ]*$/;v.augment(o,{getNextParagraph:function(k){var a,e,f,r,n;if(!this._.lastNode){e=this.range.clone();e.shrink(m.SHRINK_ELEMENT,s);e.enlarge(this.forceBrBreak||!this.enlargeBr?m.ENLARGE_LIST_ITEM_CONTENTS:
m.ENLARGE_BLOCK_CONTENTS);var A=new u(e),q=u.bookmark(s,s);A.evaluator=q;this._.nextNode=A.next();A=new u(e);A.evaluator=q;A=A.previous();this._.lastNode=A._4e_nextSourceNode(s);if(this._.lastNode&&this._.lastNode[0].nodeType==g.NODE_TEXT&&!v.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){q=new l(e.document);q.moveToPosition(this._.lastNode,m.POSITION_AFTER_END);if(q.checkEndOfBlock()){q=new c(q.endContainer);this._.lastNode=(q.block||q.blockLimit)._4e_nextSourceNode(s)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new b(e.document.createTextNode(""));d.insertAfter(this._.lastNode[0],A[0])}e=null}q=this._.nextNode;A=this._.lastNode;for(this._.nextNode=null;q;){var j=x,y=q[0].nodeType!=g.NODE_ELEMENT,t=x;if(y){if(q[0].nodeType==g.NODE_TEXT)if(h.test(q[0].nodeValue))y=x}else{var B=q._4e_name();if(q._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(B=="br")y=s;else if(!e&&!q[0].childNodes.length&&B!="hr"){a=q;f=q._4e_equals(A);break}if(e){e.setEndAt(q,m.POSITION_BEFORE_START);if(B!="br")this._.nextNode=
q}j=s}else{if(q[0].firstChild){if(!e){e=new l(this.range.document);e.setStartAt(q,m.POSITION_BEFORE_START)}q=new b(q[0].firstChild);continue}y=s}}if(y&&!e){e=new l(this.range.document);e.setStartAt(q,m.POSITION_BEFORE_START)}f=(!j||y)&&q._4e_equals(A);if(e&&!j)for(;!q[0].nextSibling&&!f;){B=q.parent();if(B._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){j=s;f||B._4e_equals(A);break}q=B;y=s;f=q._4e_equals(A);t=s}y&&e.setEndAt(q,m.POSITION_AFTER_END);q=q._4e_nextSourceNode(t,null,A);if((f=!q)||j&&e)break}if(!a){if(!e){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}a=new c(e.startContainer);q=a.blockLimit;j={div:1,th:1,td:1};a=a.block;if((!a||!a[0])&&!this.enforceRealBlocks&&j[q._4e_name()]&&e.checkStartOfBlock()&&e.checkEndOfBlock())a=q;else if(!a||this.enforceRealBlocks&&a._4e_name()=="li"){a=new b(this.range.document.createElement(k||"p"));a[0].appendChild(e.extractContents());a._4e_trim();e.insertNode(a);r=n=s}else if(a._4e_name()!="li"){if(!e.checkStartOfBlock()||!e.checkEndOfBlock()){a=a._4e_clone(x);
a[0].appendChild(e.extractContents());a._4e_trim();n=e.splitBlock();r=!n.wasStartOfBlock;n=!n.wasEndOfBlock;e.insertNode(a)}}else if(!f)this._.nextNode=a._4e_equals(A)?null:e.getBoundaryNodes().endNode._4e_nextSourceNode(s,null,A)}if(r){e=new b(a[0].previousSibling);if(e[0]&&e[0].nodeType==g.NODE_ELEMENT)if(e._4e_name()=="br")e._4e_remove();else e[0].lastChild&&d._4e_name(e[0].lastChild)=="br"&&d._4e_remove(e[0].lastChild)}if(n){e=u.bookmark(x,s);r=new b(a[0].lastChild);if(r[0]&&r[0].nodeType==g.NODE_ELEMENT&&
r._4e_name()=="br")if(z.ie||r._4e_previous(e)||r._4e_next(e))r._4e_remove()}if(!this._.nextNode)this._.nextNode=f||a._4e_equals(A)?null:a._4e_nextSourceNode(s,null,A);return a}});l.prototype.createIterator=function(){return new o(this)}});
KISSY.Editor.add("selection",function(p){function o(q){this.document=this.document=q;this._={cache:{}};if(m.ie){var j=this.getNative().createRange();if(!j||j.item&&j.item(0).ownerDocument!=q||j.parentElement&&j.parentElement().ownerDocument!=q)this.isInvalid=v}}function s(q){q=new o(q);return!q||q.isInvalid?u:q}function x(q){var j=q.document,y=new b(j.body),t=new b(j.documentElement);if(m.ie){if(m.ie<8||document.documentMode==7)t.on("click",function(M){g._4e_name(M.target)==="html"&&q.getSelection().getRanges()[0].select()});
var B,i,w=1;t.on("mousedown",function(){w=0});t.on("mouseup",function(){w=1});y.on("focusin",function(M){if(g._4e_name(M.target)=="body")if(B){try{w&&B.select()}catch(N){}B=u}});y.on("focus",function(){i=v;D()});y.on("beforedeactivate",function(M){if(!M.relatedTarget){i=z;w=1}});c.on(g._4e_getWin(j),"blur",function(){j&&j.selection.empty()});y.on("mousedown",function(){C()});y.on("mouseup",function(){i=v;setTimeout(function(){D(v)},0)});var C=function(){i=z},D=function(M){if(i){var N=q.document,Q=
q.getSelection(),U=Q&&Q.getType(),T=Q&&Q.getNative();if(M&&T&&U==d.SELECTION_NONE)if(!N.queryCommandEnabled("InsertImage")){setTimeout(function(){D(v)},50);return}var S;if(!(T&&U==d.SELECTION_TEXT&&(S=g._4e_name(T.createRange().parentElement()))&&S in{input:1,textarea:1})){B=T&&Q.getRanges()[0];q._monitor()}}};y.on("keydown",C);y.on("keyup",function(){i=v;D()});c.on(j,"selectionchange",D)}else{c.on(j,"mouseup",q._monitor,q);c.on(j,"keyup",q._monitor,q)}var E={table:1,pre:1},F=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
K=p.Walker.whitespaces(v);q.on("selectionChange",function(M){var N=M.path;M=(M=M.selection)&&M.getRanges()[0];var Q=N.blockLimit;if(M)if(M.collapse&&!N.block&&Q._4e_name()=="body"){N=M.fixBlock(v,"p");if(N._4e_outerHtml().match(F))if((Q=N._4e_next(K))&&Q[0].nodeType==k.NODE_ELEMENT&&!E[Q._4e_name()]){M.moveToElementEditablePosition(Q);N._4e_remove()}else if((Q=N._4e_previous(K))&&Q[0].nodeType==k.NODE_ELEMENT&&!E[Q._4e_name()]){M.moveToElementEditablePosition(Q,Q._4e_outerHtml().match(F)?z:v);N._4e_remove()}M.select();
m.ie||q.notifySelectionChange()}})}p.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var v=true,z=false,u=null,l=KISSY,m=l.UA,g=l.DOM,c=l.Event,b=l.Node,d=p.SELECTION,h=p.RANGE,k=p.NODE,a=p.Walker,e=p.Range,f={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};l.augment(o,{getNative:m.ie?function(){var q=this._.cache;return q.nativeSel||(q.nativeSel=this.document.selection)}:function(){var q=
this._.cache;return q.nativeSel||(q.nativeSel=g._4e_getWin(this.document).getSelection())},getType:m.ie?function(){var q=this._.cache;if(q.type)return q.type;var j=d.SELECTION_NONE;try{var y=this.getNative(),t=y.type;if(t=="Text")j=d.SELECTION_TEXT;if(t=="Control")j=d.SELECTION_ELEMENT;if(y.createRange().parentElement)j=d.SELECTION_TEXT}catch(B){}return q.type=j}:function(){var q=this._.cache;if(q.type)return q.type;var j=d.SELECTION_TEXT,y=this.getNative();if(y){if(y.rangeCount==1){y=y.getRangeAt(0);
var t=y.startContainer;if(t==y.endContainer&&t.nodeType==k.NODE_ELEMENT&&y.endOffset-y.startOffset===1&&f[t.childNodes[y.startOffset].nodeName.toLowerCase()])j=d.SELECTION_ELEMENT}}else j=d.SELECTION_NONE;return q.type=j},getRanges:m.ie?function(){var q=function(j,y){j=j.duplicate();j.collapse(y);for(var t=j.parentElement(),B=t.childNodes,i,w=0;w<B.length;w++){var C=B[w];if(C.nodeType==k.NODE_ELEMENT){i=j.duplicate();i.moveToElementText(C);C=i.compareEndPoints("StartToStart",j);var D=i.compareEndPoints("EndToStart",
j);i.collapse();if(C>0)break;else if(!C||D==1&&C==-1)return{container:t,offset:w};else if(!D)return{container:t,offset:w+1};i=u}}if(!i){i=j.duplicate();i.moveToElementText(t);i.collapse(z)}i.setEndPoint("StartToStart",j);i=i.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;i>0;)i-=B[--w].nodeValue.length}catch(E){i=0}return i===0?{container:t,offset:w}:{container:B[w],offset:-i}};return function(){var j=this._.cache;if(j.ranges)return j.ranges;var y=this.getNative(),t=y&&y.createRange(),B=this.getType();
if(!y)return[];if(B==d.SELECTION_TEXT){y=new e(this.document);B=q(t,v);y.setStart(new b(B.container),B.offset);B=q(t);y.setEnd(new b(B.container),B.offset);return j.ranges=[y]}else if(B==d.SELECTION_ELEMENT){j=j.ranges=[];for(B=0;B<t.length;B++){var i=t.item(B),w=i.parentNode,C=0;for(y=new e(this.document);C<w.childNodes.length&&w.childNodes[C]!=i;C++);y.setStart(new b(w),C);y.setEnd(new b(w),C+1);j.push(y)}return j}return j.ranges=[]}}():function(){var q=this._.cache;if(q.ranges)return q.ranges;
var j=[],y=this.getNative();if(!y)return[];for(var t=0;t<y.rangeCount;t++){var B=y.getRangeAt(t),i=new e(this.document);i.setStart(new b(B.startContainer),B.startOffset);i.setEnd(new b(B.endContainer),B.endOffset);j.push(i)}return q.ranges=j},getStartElement:function(){var q=this._.cache;if(q.startElement!==undefined)return q.startElement;var j,y=this.getNative();switch(this.getType()){case d.SELECTION_ELEMENT:return this.getSelectedElement();case d.SELECTION_TEXT:var t=this.getRanges()[0];if(t)if(!t.collapsed){for(t.optimize();v;){j=
t.startContainer;if(t.startOffset==(j[0].nodeType===k.NODE_ELEMENT?j[0].childNodes.length:j[0].nodeValue.length)&&!j._4e_isBlockBoundary())t.setStartAfter(j);else break}j=t.startContainer;if(j[0].nodeType!=k.NODE_ELEMENT)return j.parent();j=new b(j[0].childNodes[t.startOffset]);if(!j[0]||j[0].nodeType!=k.NODE_ELEMENT)return t.startContainer;for(t=j[0].firstChild;t&&t.nodeType==k.NODE_ELEMENT;){j=new b(t);t=t.firstChild}return j}if(m.ie){t=y.createRange();t.collapse(v);j=t.parentElement()}else if((j=
y.anchorNode)&&j.nodeType!=k.NODE_ELEMENT)j=j.parentNode}return q.startElement=j?g._4e_wrap(j):u},getSelectedElement:function(){var q=this,j,y=q._.cache;if(y.selectedElement!==undefined)return y.selectedElement;if(m.ie){j=q.getNative().createRange();j=j.item&&j.item(0)}j||(j=function(){for(var t=q.getRanges()[0],B,i,w=2;w&&!((B=t.getEnclosedNode())&&B[0].nodeType==k.NODE_ELEMENT&&f[B._4e_name()]&&(i=B));w--)t.shrink(h.SHRINK_ELEMENT);return i&&i[0]}());return y.selectedElement=g._4e_wrap(j)},reset:function(){this._.cache=
{}},selectElement:function(q){var j;if(m.ie)try{j=this.document.body.createControlRange();j.addElement(q[0]);j.select()}catch(y){j=this.document.body.createTextRange();j.moveToElementText(q[0]);j.select()}finally{}else{j=this.document.createRange();j.selectNode(q[0]);q=this.getNative();q.removeAllRanges();q.addRange(j)}this.reset()},selectRanges:function(q){if(m.ie){if(q.length>1){var j=q[q.length-1];q[0].setEnd(j.endContainer,j.endOffset);q.length=1}q[0]&&q[0].select()}else{j=this.getNative();if(!j)return;
j.removeAllRanges();for(var y=0;y<q.length;y++){var t=q[y],B=this.document.createRange(),i=t.startContainer;t.collapsed&&m.gecko&&m.gecko<1.09&&i[0].nodeType==k.NODE_ELEMENT&&!i[0].childNodes.length&&i[0].appendChild(this.document.createTextNode(""));B.setStart(i[0],t.startOffset);B.setEnd(t.endContainer[0],t.endOffset);j.addRange(B)}}this.reset()},createBookmarks2:function(q){for(var j=[],y=this.getRanges(),t=0;t<y.length;t++)j.push(y[t].createBookmark2(q));return j},createBookmarks:function(q,j){var y=
[],t=this.document,B;j=j||this.getRanges();for(var i=j.length,w=0;w<i;w++){y.push(B=j[w].createBookmark(q,v));var C=(q=B.serializable)?l.one("#"+B.startNode,t):B.startNode;B=q?l.one("#"+B.endNode,t):B.endNode;for(var D=w+1;D<i;D++){var E=j[D],F=E.startContainer,K=E.endContainer;g._4e_equals(F,C.parent())&&E.startOffset++;g._4e_equals(F,B.parent())&&E.startOffset++;g._4e_equals(K,C.parent())&&E.endOffset++;g._4e_equals(K,B.parent())&&E.endOffset++}}return y},selectBookmarks:function(q){for(var j=[],
y=0;y<q.length;y++){var t=new e(this.document);t.moveToBookmark(q[y]);j.push(t)}this.selectRanges(j);return this},getCommonAncestor:function(){var q=this.getRanges();return q[0].startContainer._4e_commonAncestor(q[q.length-1].endContainer)},scrollIntoView:function(){var q=this.getStartElement();q&&q._4e_scrollIntoView()},removeAllRanges:function(){var q=this.getNative();if(m.ie)q&&q.clear();else q&&q.removeAllRanges()}});var r={table:1,tbody:1,tr:1},n=a.whitespaces(v),A=/\ufeff|\u00a0/;e.prototype.select=
e.prototype.select=m.ie?function(q){var j=this.collapsed,y,t;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var B=this.startContainer[0].childNodes[this.startOffset];if(B.nodeType==k.NODE_ELEMENT){(new o(this.document)).selectElement(new b(B));return}}if(this.startContainer[0].nodeType==k.NODE_ELEMENT&&this.startContainer._4e_name()in r||this.endContainer[0].nodeType==k.NODE_ELEMENT&&this.endContainer._4e_name()in r)this.shrink(h.SHRINK_ELEMENT,v);var i=this.createBookmark();
B=i.startNode;var w;if(!j)w=i.endNode;i=this.document.body.createTextRange();i.moveToElementText(B[0]);i.moveStart("character",1);if(w){q=this.document.body.createTextRange();q.moveToElementText(w[0]);i.setEndPoint("EndToEnd",q);i.moveEnd("character",-1)}else{for(y=B[0].nextSibling;y&&!n(y);)y=y.nextSibling;y=!(y&&y.nodeValue&&y.nodeValue.match(A))&&(q||!B[0].previousSibling||B[0].previousSibling&&g._4e_name(B[0].previousSibling)=="br");t=this.document.createElement("span");t.innerHTML="&#65279;";
t=new b(t);g.insertBefore(t[0],B[0]);y&&g.insertBefore(this.document.createTextNode("\ufeff"),B[0])}this.setStartBefore(B);B._4e_remove();if(j){if(y){i.moveStart("character",-1);i.select();this.document.selection.clear()}else i.select();if(t){this.moveToPosition(t,h.POSITION_BEFORE_START);t._4e_remove()}}else{this.setEndBefore(w);w._4e_remove();i.select()}}:function(){var q=this.startContainer;this.collapsed&&q[0].nodeType==k.NODE_ELEMENT&&!q[0].childNodes.length&&q[0].appendChild(this.document.createTextNode(""));
var j=this.document.createRange();j.setStart(q[0],this.startOffset);try{j.setEnd(this.endContainer[0],this.endOffset)}catch(y){if(y.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(v);j.setEnd(this.endContainer[0],this.endOffset)}else throw y;}q=s(this.document).getNative();q.removeAllRanges();q.addRange(j)};o.getSelection=s;p.Selection=o;p.Selection=o;a=o.prototype;p.Utils.extern(a,{getNative:a.getNative,getType:a.getType,getRanges:a.getRanges,getStartElement:a.getStartElement,getSelectedElement:a.getSelectedElement,
reset:a.reset,selectElement:a.selectElement,selectRanges:a.selectRanges,createBookmarks2:a.createBookmarks2,createBookmarks:a.createBookmarks,getCommonAncestor:a.getCommonAncestor,scrollIntoView:a.scrollIntoView,selectBookmarks:a.selectBookmarks,removeAllRanges:a.removeAllRanges});p.on("instanceCreated",function(q){x(q.editor)})});
KISSY.Editor.add("styles",function(p){function o(G,L){for(var H in G)G[H]=G[H].replace(T,function(I,J){return L[J]})}function s(G,L){if(L){G=j.clone(G);o(G.attributes,L);o(G.styles,L)}var H=this.element=this.element=(G.element||"*").toLowerCase();this.type=this.type=H=="#"||N[H]?B.STYLE_BLOCK:Q[H]?B.STYLE_OBJECT:B.STYLE_INLINE;this._={definition:G}}function x(G,L){var H=L?this.removeFromRange:this.applyToRange;G.body.focus();for(var I=new w(G),J=I.getRanges(),O=0;O<J.length;O++)H.call(this,J[O]);
I.selectRanges(J)}function v(G,L){var H;H=G.element;if(H=="*")H="span";H=new F(L.createElement(H));return z(H,G)}function z(G,L){var H=L._.definition,I=H.attributes;H=s.getStyleText(H);if(I)for(var J in I)G.attr(J,I[J]);if(H)G[0].style.cssText=H;return G}function u(G){var L=G.createBookmark(n),H=G.createIterator();H.enforceRealBlocks=n;H.enlargeBr=n;for(var I,J=G.document;I=H.getNextParagraph();){var O=v(this,J);I=I;var P=O;O=P._4e_name=="pre";var R=I._4e_name=="pre",Y=!O&&R;if(O&&!R){R=I;P=P;Y=R.html();
Y=l(Y,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");Y=Y.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");Y=Y.replace(/([ \t\n\r]+|&nbsp;)/g," ");Y=Y.replace(/<br\b[^>]*>/gi,"\n");if(K.ie){R=R[0].ownerDocument.createElement("div");R.appendChild(P[0]);P[0].outerHTML="<pre>"+Y+"</pre>";P=new F(R.firstChild);P._4e_remove()}else P.html(Y);P=P}else if(Y)P=g(m(I),P);else I._4e_moveChildren(P);I[0].parentNode.replaceChild(P[0],I[0]);if(O){I=P;O=void 0;if((O=I._4e_previousSourceNode(n,C.NODE_ELEMENT))&&O._4e_name()==
"pre"){P=l(O.html(),/\n$/,"")+"\n\n"+l(I.html(),/^\n/,"");if(K.ie)I[0].outerHTML="<pre>"+P+"</pre>";else I.html(P);O._4e_remove()}}}G.moveToBookmark(L)}function l(G,L,H){var I="",J="";G=G.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(O,P,R){P&&(I=P);R&&(J=R);return""});return I+G.replace(L,H)+J}function m(G){var L=[];l(G._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(H,I,J){return I+"</pre>"+J+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(H,I){L.push(I)});return L}function g(G,L){for(var H=L[0].ownerDocument.createDocumentFragment(),I=0;I<G.length;I++){var J=G[I];J=J.replace(/(\r\n|\r)/g,"\n");J=l(J,/^[ \t]*\n/,"");J=l(J,/\n$/,"");J=l(J,/^[ \t]+|[ \t]+$/g,function(P,R){return P.length==1?"&nbsp;":R?" "+Array(P.length).join("&nbsp;"):Array(P.length).join("&nbsp;")+" "});J=J.replace(/\n/g,"<br>");J=J.replace(/[ \t]{2,}/g,function(P){return Array(P.length).join("&nbsp;")+" "});var O=L._4e_clone();O.html(J);H.appendChild(O[0])}return H}
function c(G){var L=G.document;if(G.collapsed){L=v(this,L);G.insertNode(L);G.moveToPosition(L,i.POSITION_BEFORE_END)}else{var H=this.element,I=this._.definition,J,O=p.XHTML_DTD[H]||(J=n,p.XHTML_DTD.span),P=G.createBookmark();G.enlarge(i.ENLARGE_ELEMENT);G.trim();var R=G.createBookmark(),Y=R.startNode;R=R.endNode;for(var X=Y,$;X&&X[0];){var V=A;if(t._4e_equals(X,R)){X=q;V=n}else{var W=X[0].nodeType,ca=W==C.NODE_ELEMENT?X._4e_name():q;if(ca&&X.attr("_ke_bookmark")){X=X._4e_nextSourceNode(n);continue}if(!ca||
O[ca]&&(X._4e_position(R)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(X))){var Z=X.parent();if(Z&&Z[0]&&((p.XHTML_DTD[Z._4e_name()]||p.XHTML_DTD.span)[H]||J)&&(!I.parentRule||I.parentRule(Z))){if(!$&&(!ca||!p.XHTML_DTD.$removeEmpty[ca]||(X._4e_position(R)|D.POSITION_PRECEDING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_PRECEDING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED)){$=
new E(L);$.setStartBefore(X)}if(W==C.NODE_TEXT||W==C.NODE_ELEMENT&&!X[0].childNodes.length){W=X;for(var aa;!W[0].nextSibling&&(aa=W.parent(),O[aa._4e_name()])&&(aa._4e_position(Y)|D.POSITION_FOLLOWING|D.POSITION_IDENTICAL|D.POSITION_IS_CONTAINED)==D.POSITION_FOLLOWING+D.POSITION_IDENTICAL+D.POSITION_IS_CONTAINED&&(!I.childRule||I.childRule(aa));)W=aa;$.setEndAfter(W);W[0].nextSibling||(V=n)}}else V=n}else V=n;X=X._4e_nextSourceNode()}if(V&&$&&!$.collapsed){V=v(this,L);for(W=$.getCommonAncestor();V&&
W&&V[0]&&W[0];){if(W._4e_name()==H){for(var ba in I.attributes)V.attr(ba)==W.attr(ba)&&V[0].removeAttribute(ba);for(var fa in I.styles)V._4e_style(fa)==W._4e_style(fa)&&V._4e_style(fa,"");if(!V._4e_hasAttributes()){V=q;break}}W=W.parent()}if(V){V[0].appendChild($.extractContents());W=V;ca=k(this);Z=W.all(this.element);for(var da=Z.length;--da>=0;)a(this,new F(Z[da]));var ea=void 0;for(ea in ca)if(ea!=this.element){Z=W.all(ea);for(da=Z.length-1;da>=0;da--){var ga=new F(Z[da]);f(ga,ca[ea])}}$.insertNode(V);
V._4e_mergeSiblings();K.ie||V[0].normalize()}$=q}}Y._4e_remove();R._4e_remove();G.moveToBookmark(P);G.shrink(i.SHRINK_TEXT)}}function b(G){G.enlarge(i.ENLARGE_ELEMENT);var L=G.createBookmark(),H=L.startNode;if(G.collapsed){for(var I=new M(H.parent()),J,O=0,P;O<I.elements.length&&(P=I.elements[O]);O++){if(P==I.block||P==I.blockLimit)break;if(this.checkElementRemovable(P)){var R=G.checkBoundaryOfElement(P,i.END),Y=!R&&G.checkBoundaryOfElement(P,i.START);if(Y||R){J=P;J.match=Y?"start":"end"}else{P._4e_mergeSiblings();
P._4e_name()==this.element?a(this,P):f(P,k(this)[P._4e_name()])}}}if(J&&J[0]){P=H;for(O=0;;O++){R=I.elements[O];if(t._4e_equals(R,J))break;else if(R.match)continue;else R=R._4e_clone();R[0].appendChild(P[0]);P=R}t[J.match=="start"?"insertBefore":"insertAfter"](P[0],J[0])}}else{var X=L.endNode,$=this;I=function(){for(var V=new M(H.parent()),W=new M(X.parent()),ca=q,Z=q,aa=0;aa<V.elements.length;aa++){var ba=V.elements[aa];if(ba==V.block||ba==V.blockLimit)break;if($.checkElementRemovable(ba))ca=ba}for(aa=
0;aa<W.elements.length;aa++){ba=W.elements[aa];if(ba==W.block||ba==W.blockLimit)break;if($.checkElementRemovable(ba))Z=ba}Z&&X._4e_breakParent(Z);ca&&H._4e_breakParent(ca)};I();for(J=new F(H[0].nextSibling);J[0]!==X[0];){O=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==C.NODE_ELEMENT&&this.checkElementRemovable(J)){J._4e_name()==this.element?a(this,J):f(J,k(this)[J._4e_name()]);if(O[0].nodeType==C.NODE_ELEMENT&&O._4e_contains(H)){I();O=new F(H[0].nextSibling)}}J=O}}G.moveToBookmark(L)}function d(G){var L=
{};G.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(H,I,J){L[I]=J});return L}function h(G,L){var H;if(L!==A){H=document.createElement("span");H.style.cssText=G;H=H.style.cssText||""}else H=G;return H.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function k(G){if(G._.overrides)return G._.overrides;var L=G._.overrides={},H=G._.definition.overrides;if(H){j.isArray(H)||(H=[H]);for(var I=0;I<H.length;I++){var J=H[I],O,P;if(typeof J==
"string")O=J.toLowerCase();else{O=J.element?J.element.toLowerCase():G.element;P=J.attributes}J=L[O]||(L[O]={});if(P){J=J.attributes=J.attributes||[];for(var R in P)J.push([R.toLowerCase(),P[R]])}}}return L}function a(G,L){var H=G._.definition,I=y.mix(H.attributes,k(G)[L._4e_name()]);H=H.styles;var J=j.isEmptyObject(I)&&j.isEmptyObject(H),O;for(O in I)if(!((O=="class"||G._.definition.fullMatch)&&L.attr(O)!=e(O,I[O]))){J=J||!!L._4e_hasAttribute(O);L.removeAttr(O)}for(var P in H)if(!(G._.definition.fullMatch&&
L._4e_style(P)!=e(P,H[P],n))){J=J||!!L._4e_style(P);L._4e_style(P,"")}r(L)}function e(G,L,H){var I=new F("<span>");I[H?"_4e_style":"attr"](G,L);return I[H?"_4e_style":"attr"](G)}function f(G,L){var H=L&&L.attributes;if(H)for(var I=0;I<H.length;I++){var J=H[I][0],O;if(O=G.attr(J)){var P=H[I][1];if(P===q||P.test&&P.test(O)||typeof P=="string"&&O==P)G[0].removeAttribute(J)}}r(G)}function r(G){if(!G._4e_hasAttributes()){var L=G[0].firstChild,H=G[0].lastChild;G._4e_remove(n);if(L){L.nodeType==C.NODE_ELEMENT&&
t._4e_mergeSiblings(L);H&&L!=H&&H.nodeType==C.NODE_ELEMENT&&t._4e_mergeSiblings(H)}}}var n=true,A=false,q=null,j=KISSY,y=p.Utils,t=j.DOM,B={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},i=p.RANGE,w=p.Selection,C=p.NODE,D=p.POSITION,E=p.Range,F=j.Node,K=j.UA,M=p.ElementPath,N={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},Q={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},U=/\s*(?:;\s*|$)/,T=/#\((.+?)\)/g;p.STYLE=B;s.prototype={apply:function(G){x.call(this,
G,A)},remove:function(G){x.call(this,G,n)},applyToRange:function(G){return(this.applyToRange=this.type==B.STYLE_INLINE?c:this.type==B.STYLE_BLOCK?u:this.type==B.STYLE_OBJECT?q:q).call(this,G)},removeFromRange:function(G){return(this.removeFromRange=this.type==B.STYLE_INLINE?b:q).call(this,G)},applyToObject:function(G){z(G,this)},checkElementRemovable:function(G,L){if(!G)return A;var H=this._.definition;if(G._4e_name()==this.element){if(!L&&!G._4e_hasAttributes())return n;var I=H._AC;if(I)H=I;else{I=
{};var J=0,O=H.attributes;if(O)for(var P in O){J++;I[P]=O[P]}if(O=s.getStyleText(H)){I.style||J++;I.style=O}I._length=J;H=H._AC=I}if(H._length){for(var R in H)if(R!="_length"){J=G.attr(R)||"";if(R=="style")a:{I=H[R];J=h(J,A);typeof I=="string"&&(I=d(I));typeof J=="string"&&(J=d(J));O=void 0;for(O in I)if(!(O in J&&(J[O]==I[O]||I[O]=="inherit"||J[O]=="inherit"))){I=A;break a}I=n}else I=H[R]==J;if(I){if(!L)return n}else if(L)return A}if(L)return n}else return n}if(R=k(this)[G._4e_name()]){if(!(H=R.attributes))return n;
for(I=0;I<H.length;I++){R=H[I][0];if(R=G.attr(R)){J=H[I][1];if(J===q||typeof J=="string"&&R==J||J.test&&J.test(R))return n}}}return A},checkActive:function(G){switch(this.type){case B.STYLE_BLOCK:return this.checkElementRemovable(G.block||G.blockLimit,n);case B.STYLE_OBJECT:case B.STYLE_INLINE:for(var L=G.elements,H=0,I;H<L.length;H++){I=L[H];if(!(this.type==B.STYLE_INLINE&&(t._4e_equals(I,G.block)||t._4e_equals(I,G.blockLimit))))if(!(this.type==B.STYLE_OBJECT&&!(I._4e_name()in Q)))if(this.checkElementRemovable(I,
n))return n}}return A}};s.getStyleText=function(G){var L=G._ST;if(L)return L;L=G.styles;var H=G.attributes&&G.attributes.style||"",I="";if(H.length)H=H.replace(U,";");for(var J in L){var O=L[J],P=(J+":"+O).replace(U,";");if(O=="inherit")I+=P;else H+=P}if(H.length)H=h(H);H+=I;return G._ST=H};p.Style=s;p.Style=s;var S=s.prototype;p.Utils.extern(S,{apply:S.apply,remove:S.remove,applyToRange:S.applyToRange,removeFromRange:S.removeFromRange,applyToObject:S.applyToObject,checkElementRemovable:S.checkElementRemovable,
checkActive:S.checkActive})});
KISSY.Editor.add("htmlparser",function(){function p(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var o=KISSY,s=function(){},x=o.Editor,v=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,z={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},u=x.XHTML_DTD;o.augment(p,{onTagOpen:s,onTagClose:s,
onText:s,onCDATA:s,onComment:s,parse:function(l){for(var m,g,c=0,b;m=this._.htmlPartsRegex.exec(l);){g=m.index;if(g>c){c=l.substring(c,g);b?b.push(c):this.onText(c)}c=this._.htmlPartsRegex.lastIndex;if(g=m[1]){g=g.toLowerCase();if(b&&u.$cdata[g]){this.onCDATA(b.join(""));b=null}if(!b){this.onTagClose(g);continue}}if(b)b.push(m[0]);else if(g=m[3]){g=g.toLowerCase();if(!/="/.test(g)){var d={},h;m=m[4];var k=!!(m&&m.charAt(m.length-1)=="/");if(m)for(;h=v.exec(m);){var a=h[1].toLowerCase();h=h[2]||h[3]||
h[4]||"";d[a]=!h&&z[a]?a:h}this.onTagOpen(g,d,k);if(!b&&u.$cdata[g])b=[]}}else if(g=m[2])this.onComment(g)}l.length>c&&this.onText(l.substring(c,l.length))}});x.HtmlParser=p;x.HtmlParser=p});
KISSY.Editor.add("htmlparser-basicwriter",function(){function p(){this._={output:[]}}var o=KISSY,s=o.Editor,x=s.Utils;o.augment(p,{openTag:function(v){this._.output.push("<",v)},openTagClose:function(v,z){z?this._.output.push(" />"):this._.output.push(">")},attribute:function(v,z){if(typeof z=="string")z=x.htmlEncodeAttr(z);this._.output.push(" ",v,'="',z,'"')},closeTag:function(v){this._.output.push("</",v,">")},text:function(v){this._.output.push(v)},comment:function(v){this._.output.push("<!--",
v,"--\>")},write:function(v){this._.output.push(v)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(v){var z=this._.output.join("");v&&this.reset();return z}});s.HtmlParser.BasicWriter=p;s.HtmlParser.BasicWriter=p;o=p.prototype;s.Utils.extern(o,{openTag:o.openTag,openTagClose:o.openTagClose,attribute:o.attribute,closeTag:o.closeTag,text:o.text,comment:o.comment,write:o.write,reset:o.reset,getHtml:o.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function p(){p.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=z;this.sortAttributes=v;this._.indent=z;this._.indentation="";this._.rules={};var u=s.XHTML_DTD,l;for(l in x.mix({},u.$nonBodyContent,u.$block,u.$listItem,u.$tableContent))this.setRules(l,{indent:v,breakBeforeOpen:v,breakAfterOpen:v,breakBeforeClose:!u[l]["#"],breakAfterClose:v});this.setRules("br",
{breakAfterOpen:v});this.setRules("title",{indent:z,breakAfterOpen:z});this.setRules("style",{indent:z,breakBeforeClose:v});this.setRules("pre",{indent:z})}var o=KISSY,s=o.Editor,x=s.Utils,v=true,z=false;o.extend(p,s.HtmlParser.BasicWriter,{openTag:function(u){var l=this._.rules[u];if(this._.indent)this.indentation();else if(l&&l.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",u)},openTagClose:function(u,l){var m=this._.rules[u];if(l)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(m&&m.indent)this._.indentation+=this.indentationChars}m&&m.breakAfterOpen&&this.lineBreak()},attribute:function(u,l){if(typeof l=="string"){this.forceSimpleAmpersand&&(l=l.replace(/&amp;/g,"&"));l=x.htmlEncodeAttr(l)}this._.output.push(" ",u,'="',l,'"')},closeTag:function(u){var l=this._.rules[u];if(l&&l.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(l&&l.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",u,">");l&&l.breakAfterClose&&this.lineBreak()},text:function(u){if(this._.indent){this.indentation();u=x.ltrim(u)}this._.output.push(u)},comment:function(u){this._.indent&&this.indentation();this._.output.push("<!--",u,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=v},indentation:function(){this._.output.push(this._.indentation);this._.indent=z},setRules:function(u,l){var m=this._.rules[u];if(m)x.mix(m,
l);else this._.rules[u]=l}});s.HtmlParser.HtmlWriter=p;s.HtmlParser.HtmlWriter=p;o=p.prototype;s.Utils.extern(o,{openTag:o.openTag,openTagClose:o.openTagClose,attribute:o.attribute,closeTag:o.closeTag,text:o.text,comment:o.comment,lineBreak:o.lineBreak,indentation:o.indentation,setRules:o.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function p(){this.children=[];this.parent=x;this._={isBlockLike:o,hasInlineStarted:s}}var o=true,s=false,x=null,v=KISSY.Editor,z={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},u=KISSY,l=v.Utils,m=v.NODE,g=v.XHTML_DTD,c=l.mix({table:1,ul:1,ol:1,dl:1},g.table,g.ul,g.ol,g.dl),b=g.$list,d=g.$listItem;p.FromHtml=function(h,k){function a(w){var C;if(A.length>0)for(var D=0;D<A.length;D++){var E=A[D],F=E.name,K=g[F],M=j.name&&g[j.name];
if((!M||M[F])&&(!w||!K||K[w]||!g[w])){if(!C){e();C=1}E=E.clone();E.parent=j;j=E;A.splice(D,1);D--}}}function e(){for(;q.length;)j.add(q.shift())}function f(w,C,D){C=C||j||n;if(k&&!C.type){var E,F;if((E=w.attributes&&(F=w.attributes._ke_real_element_type)?F:w.name)&&!(E in g.$body)&&!(E in g.$nonBodyContent)){E=j;j=C;r.onTagOpen(k,{});C=j;if(D)j=E}}if(w._.isBlockLike&&w.name!="pre"){D=w.children.length;if((E=w.children[D-1])&&E.type==m.NODE_TEXT)if(F=l.rtrim(E.value))E.value=F;else w.children.length=
D-1}C.add(w);if(w.returnPoint){j=w.returnPoint;delete w.returnPoint}}var r=new v.HtmlParser,n=new p,A=[],q=[],j=n,y=s,t;r.onTagOpen=function(w,C,D){var E=new v.HtmlParser.Element(w,C);if(E.isUnknown&&D)E.isEmpty=o;if(g.$removeEmpty[w])A.push(E);else{if(w=="pre")y=o;else if(w=="br"&&y){j.add(new v.HtmlParser.Text("\n"));return}if(w=="br")q.push(E);else{var F=j.name,K=F&&(g[F]||(j._.isBlockLike?g.div:g.span));if(K&&!E.isUnknown&&!j.isUnknown&&!K[w]){K=s;var M;if(w in b&&F in b){F=j.children;(F=F[F.length-
1])&&F.name in d||f(F=new v.HtmlParser.Element("li"),j);t=j;M=F}else if(w==F)f(j,j.parent);else{if(c[F])t||(t=j);else{f(j,j.parent,o);z[F]||A.unshift(j)}K=o}j=M?M:j.returnPoint||j.parent;if(K){r.onTagOpen.apply(this,arguments);return}}a(w);e();E.parent=j;E.returnPoint=t;t=0;if(E.isEmpty)f(E);else j=E}}};r.onTagClose=function(w){for(var C=A.length-1;C>=0;C--)if(w==A[C].name){A.splice(C,1);return}for(var D=[],E=[],F=j;F.type&&F.name!=w;){F._.isBlockLike||E.unshift(F);D.push(F);F=F.parent}if(F.type){for(C=
0;C<D.length;C++){var K=D[C];f(K,K.parent)}j=F;if(j.name=="pre")y=s;F._.isBlockLike&&e();f(F,F.parent);if(F==j)j=j.parent;A=A.concat(E)}if(w=="body")k=s};r.onText=function(w){if(!j._.hasInlineStarted&&!y){w=l.ltrim(w);if(w.length===0)return}e();a();if(k&&(!j.type||j.name=="body")&&l.trim(w))this.onTagOpen(k,{});y||(w=w.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));j.add(new v.HtmlParser.Text(w))};r.onCDATA=function(){};r.onComment=function(w){j.add(new v.HtmlParser.Comment(w))};r.parse(h);for(e();j.type;){var B=
j.parent,i=j;if(k&&(!B.type||B.name=="body")&&!g.$body[i.name]){j=B;r.onTagOpen(k,{});B=j}B.add(i);j=B}return n};u.augment(p,{add:function(h){var k=this.children.length;if(k=k>0&&this.children[k-1]||x){if(h._.isBlockLike&&k.type==m.NODE_TEXT){k.value=l.rtrim(k.value);if(k.value.length===0){this.children.pop();this.add(h);return}}k.next=h}h.previous=k;h.parent=this;this.children.push(h);this._.hasInlineStarted=h.type==m.NODE_TEXT||h.type==m.NODE_ELEMENT&&!h._.isBlockLike},writeHtml:function(h,k){var a;
this.filterChildren=this.filterChildren=function(){var e=new v.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,e,k,o);e=e.getHtml();this.children=(new p.FromHtml(e)).children;a=1};!this.name&&k&&k.onFragment(this);this.writeChildrenHtml(h,a?x:k)},writeChildrenHtml:function(h,k){for(var a=0;a<this.children.length;a++)this.children[a].writeHtml(h,k)}});v.HtmlParser.Fragment=p;v.HtmlParser.Fragment=p;p.FromHtml=p.FromHtml;u=p.prototype;v.Utils.extern(u,{add:u.add,writeHtml:u.writeHtml,writeChildrenHtml:u.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function p(z,u){this.name=z;this.attributes=u||(u={});this.children=[];var l=u._ke_real_element_type||z,m=o.XHTML_DTD;l=!!(m.$nonBodyContent[l]||m.$block[l]||m.$listItem[l]||m.$tableContent[l]||m.$nonEditable[l]||l=="br");var g=!!m.$empty[z];this.isEmpty=g;this.isUnknown=!m[z];this._={isBlockLike:l,hasInlineStarted:g||!l}}var o=KISSY.Editor,s=o.NODE,x=function(z,u){z=z[0];u=u[0];return z<u?-1:z>u?1:0};KISSY.augment(p,{type:s.NODE_ELEMENT,add:o.HtmlParser.Fragment.prototype.add,
clone:function(){return new p(this.name,this.attributes)},writeHtml:function(z,u){var l=this.attributes,m=this,g=m.name,c,b,d,h;m.filterChildren=function(){if(!h){var e=new o.HtmlParser.BasicWriter;o.HtmlParser.Fragment.prototype.writeChildrenHtml.call(m,e,u);m.children=(new o.HtmlParser.Fragment.FromHtml(e.getHtml())).children;h=1}};m.filterChildren=m.filterChildren;if(u){for(;;){if(!(g=u.onElementName(g)))return;m.name=g;if(!(m=u.onElement(m)))return;m.parent=this.parent;if(m.name==g)break;if(m.type!=
s.NODE_ELEMENT){m.writeHtml(z,u);return}g=m.name;if(!g){this.writeChildrenHtml.call(m,z,h?null:u);return}}l=m.attributes}z.openTag(g,l);for(var k=[],a=0;a<2;a++)for(c in l){b=c;d=l[c];if(a==1)k.push([c,d]);else if(u){for(;;)if(b=u.onAttributeName(c))if(b!=c){delete l[c];c=b}else break;else{delete l[c];break}if(b)if((d=u.onAttribute(m,b,d))===false)delete l[b];else l[b]=d}}z.sortAttributes&&k.sort(x);l=k.length;for(a=0;a<l;a++){c=k[a];z.attribute(c[0],c[1])}z.openTagClose(g,m.isEmpty);if(!m.isEmpty){this.writeChildrenHtml.call(m,
z,h?null:u);z.closeTag(g)}},writeChildrenHtml:function(){o.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});o.HtmlParser.Element=p;o.HtmlParser.Element=p;var v=p.prototype;o.Utils.extern(v,{type:v.type,add:v.add,clone:v.clone,writeHtml:v.writeHtml,writeChildrenHtml:v.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function p(c){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};c&&this.addRules(c,10)}function o(c,b){for(var d=0;c&&d<b.length;d++){var h=b[d];c=c.replace(h[0],h[1])}return c}function s(c,b,d){if(typeof b=="function")b=[b];var h,k;k=c.length;var a=b&&b.length;if(a){for(h=0;h<k&&c[h].pri<d;h++);for(k=a-1;k>=0;k--)if(a=b[k]){a.pri=d;c.splice(h,0,a)}}}function x(c,b,d){if(b)for(var h in b){var k=c[h];c[h]=v(k,b[h],
d);k||c.$length++}}function v(c,b,d){if(b){b.pri=d;if(c){if(c.splice)s(c,b,d);else{c=c.pri>d?[b,c]:[c,b];c.filter=z}return c}else return b.filter=b}}function z(c){for(var b=c.type||c instanceof l.HtmlParser.Fragment,d=0;d<this.length;d++){if(b)var h=c.type,k=c.name;var a=this[d].apply(window,arguments);if(a===g)return a;if(b){if(a&&(a.name!=k||a.type!=h))return a}else if(typeof a!="string")return a;a!=undefined&&(c=a)}return c}var u=KISSY,l=u.Editor,m=l.NODE,g=false;u.augment(p,{addRules:function(c,
b){if(typeof b!="number")b=10;s(this._.elementNames,c.elementNames,b);s(this._.attributeNames,c.attributeNames,b);x(this._.elements,c.elements,b);x(this._.attributes,c.attributes,b);this._.text=v(this._.text,c.text,b)||this._.text;this._.comment=v(this._.comment,c.comment,b)||this._.comment;this._.root=v(this._.root,c.root,b)||this._.root},onElementName:function(c){return o(c,this._.elementNames)},onAttributeName:function(c){return o(c,this._.attributeNames)},onText:function(c){var b=this._.text;
return b?b.filter(c):c},onComment:function(c,b){var d=this._.comment;return d?d.filter(c,b):c},onFragment:function(c){var b=this._.root;return b?b.filter(c):c},onElement:function(c){for(var b=[this._.elements["^"],this._.elements[c.name],this._.elements.$],d,h=0;h<3;h++)if(d=b[h]){d=d.filter(c,this);if(d===g)return null;if(d&&d!=c)return this.onNode(d);if(c.parent&&!c.name)break}return c},onNode:function(c){var b=c.type;return b==m.NODE_ELEMENT?this.onElement(c):b==m.NODE_TEXT?new l.HtmlParser.Text(this.onText(c.value)):
null},onAttribute:function(c,b,d){if(b=this._.attributes[b]){c=b.filter(d,c,this);if(c===g)return g;if(typeof c!="undefined")return c}return d}});l.HtmlParser.Filter=p;u=p.prototype;l.Utils.extern(u,{addRules:u.addRules,onElementName:u.onElementName,onAttributeName:u.onAttributeName,onText:u.onText,onComment:u.onComment,onFragment:u.onFragment,onElement:u.onElement,onNode:u.onNode,onAttribute:u.onAttribute});l.HtmlParser.Filter=p});
KISSY.Editor.add("htmlparser-text",function(){function p(v){this.value=v;this._={isBlockLike:x}}var o=KISSY,s=o.Editor,x=false;o.augment(p,{type:s.NODE.NODE_TEXT,writeHtml:function(v,z){var u=this.value;z&&!(u=z.onText(u,this))||v.text(u)}});s.HtmlParser.Text=p;s.HtmlParser.Text=p});
KISSY.Editor.add("htmlparser-comment",function(){function p(x){this.value=x;this._={isBlockLike:false}}var o=KISSY.Editor,s=o.NODE;o.HtmlParser.Comment=p;o.HtmlParser.Comment=p;p.prototype={constructor:p,type:s.NODE_COMMENT,writeHtml:function(x,v){var z=this.value;if(v){if(!(z=v.onComment(z,this)))return;if(typeof z!="string"){z.parent=this.parent;z.writeHtml(x,v);return}}x.comment(z)}}});
KISSY.Editor.add("bgcolor",function(p){var o=KISSY.Editor.ColorSupport,s={element:"span",styles:{"background-color":"#(color)"}};p.addPlugin(function(){new o({editor:p,styles:s,title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-bgcolor",text:"bgcolor"})})});
KISSY.Editor.add("bubbleview",function(){function p(l){p.superclass.constructor.apply(this,arguments);l.init&&l.init.call(this)}var o=KISSY.Editor,s=KISSY,x=s.Event,v=s.DOM,z=s.Node;if(!o.BubbleView){var u={};p.attach=function(l){var m=l.pluginInstance,g=l.pluginName;l=m.editor;var c=u[g];if(c){var b=c.cfg.func,d=u[g].bubble;l.on("selectionChange",function(h){h=h.path;var k=h.elements;if(h&&k)if(h=h.lastElement)if(h=b(h)){k=u[g];if(!k.bubble)k.bubble=new p(k.cfg);d=k.bubble;d._selectedEl=h;d._plugin=
m;d.show()}else if(d){d._selectedEl=d._plugin=null;d.hide()}});x.on(v._4e_getWin(l.document),"scroll blur",function(){d&&d.hide()});x.on(document,"click",function(){d&&d.hide()})}};p.register=function(l){u[l.pluginName]={cfg:l}};p.ATTRS={focusMgr:{value:false},draggable:{value:false},zIndex:{value:o.baseZIndex(o.zIndexManager.BUBBLE_VIEW)}};s.extend(p,o.SimpleOverlay,{_createEl:function(){var l=(new z('<div class="ke-bubbleview-bubble" onmousedown="return false;"></div>')).appendTo(document.body);
this.el=l;this.set("el",l)},show:function(){var l=this._selectedEl,m=l._4e_getOffset(document);m.top+=l.height()+5;p.superclass.show.call(this,m)}});o.BubbleView=p}});
KISSY.Editor.add("button",function(){function p(v){p.superclass.constructor.call(this,v);this._init()}var o=KISSY.Editor,s=KISSY,x=s.Node;if(!o.TripleButton){p.ON="on";p.OFF="off";p.DISABLED="disabled";p.ON_CLASS="ke-triplebutton-on";p.OFF_CLASS="ke-triplebutton-off";p.DISABLED_CLASS="ke-triplebutton-disabled";p.ATTRS={state:{value:"off"},container:{},text:{},contentCls:{},cls:{},el:{}};s.extend(p,s.Base,{_init:function(){var v=this,z=v.get("container"),u=v.get("el"),l=v.get("title"),m=v.get("text"),
g=v.get("contentCls");v.el=new x("<a class='ke-triplebutton ke-triplebutton-off' href='#' role=\"button\"></a>");var c=v.el;c._4e_unselectable();v._attachCls();if(m)c.html(m);else if(g){c.html("<span class='ke-toolbar-item "+g+"'></span>");c.one("span")._4e_unselectable()}l&&c.attr("title",l);if(u)u[0].parentNode.replaceChild(c[0],u[0]);else z&&z.append(c);c.on("click",v._action,v);v.on("afterStateChange",v._stateChange,v);if(!v.get("cls")){c.on("mousedown",function(){v.get("state")=="off"&&c.addClass("ke-triplebutton-active")});
c.on("mouseup mouseleave",function(){v.get("state")=="off"&&c.hasClass("ke-triplebutton-active")&&setTimeout(function(){c.removeClass("ke-triplebutton-active")},300)})}},_attachCls:function(){var v=this.get("cls");v&&this.el.addClass(v)},_stateChange:function(v){this["_"+v.newVal]();this._attachCls()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(v){this.fire(this.get("state")+
"Click",v);this.fire("click",v);v.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.el[0].className="ke-triplebutton ke-triplebutton-on"},_off:function(){this.el[0].className="ke-triplebutton ke-triplebutton-off"},_disabled:function(){this.el[0].className="ke-triplebutton ke-triplebutton-disabled"}});o.TripleButton=p}});
KISSY.Editor.add("clipboard",function(p){var o=KISSY,s=o.Editor,x=o.Node,v=o.UA,z=s.Range,u=s.RANGE,l=o.Event;s.Paste||function(){function m(e){this.editor=e;this._init()}function g(e){if(!(!v.ie||e.document.compatMode=="BackCompat")){var f=e.getSelection(),r;if(f.getType()==k.SELECTION_ELEMENT&&(r=f.getSelectedElement())){var n=f.getRanges()[0],A=new x(e.document.createTextNode(""));A.insertBefore(r);n.setStartBefore(A);n.setEndAfter(r);f.selectRanges([n]);setTimeout(function(){if(r.parent()){A.remove();
f.selectElement(r)}},0)}}}o.augment(m,{_init:function(){var e=this.editor;v.ie?l.on(e.document,"keydown",this._paste,this):l.on(e.document,"paste",this._paste,this);e.addCommand("copy",new h("copy"));e.addCommand("cut",new h("cut"));e.addCommand("paste",new h("paste"))},_paste:function(e){if(!(e.type==="keydown"&&!(e.keyCode===86&&(e.ctrlKey||e.metaKey)))){var f=this,r=f.editor,n=r.document;if(f._running)e.halt();else{var A=r.getSelection();e=new z(n);var q=new x(v.webkit?"<body></body>":"<div></div>",
null,n);v.webkit&&q[0].appendChild(n.createTextNode("\u00a0"));n.body.appendChild(q[0]);q.css({position:"absolute",top:A.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});q.css("left","-1000px");var j=A.createBookmarks();e.setStartAt(q,u.POSITION_AFTER_START);e.setEndAt(q,u.POSITION_BEFORE_END);e.select(true);f._running=true;setTimeout(function(){q._4e_remove();var y;q=v.webkit&&(y=q._4e_first())&&y.hasClass("Apple-style-span")?y:q;A.selectBookmarks(j);r.insertHtml(q.html());
f._running=false},0)}}}});s.Paste=m;var c=function(e,f){var r=e.document,n=new x(r.body),A=false,q=function(){A=true};n.on(f,q);(v.ie>7?r:r.selection.createRange()).execCommand(f);n.detach(f,q);return A},b=v.ie?function(e,f){return c(e,f)}:function(e,f){try{return e.document.execCommand(f)}catch(r){return false}},d={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},h=function(e){this.type=
e;this.canUndo=this.type=="cut"};h.prototype={exec:function(e){this.type=="cut"&&g(e);(e=b(e,this.type))||alert(d[this.type]);return e}};var k=s.Selection,a={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};s.on("contextmenu",function(e){var f=e.contextmenu,r=f.cfg.editor,n=f.el.originalEl,A={copy:0,cut:0,paste:0},q;for(q in A){if(!A.hasOwnProperty(q))break;A[q]=n.one(".ke-paste-"+q);(function(j){var y=A[j];if(!y){y=(new x("<a href='#'class='ke-paste-"+j+"'>"+a[j]+"</a>")).appendTo(n);y.on("click",function(t){t.halt();
if(!y.hasClass("ke-menuitem-disable")){f.hide();setTimeout(function(){r.execCommand(j)},30)}})}A[j]=y})(q);e=A[q];(r.document.queryCommandEnabled(q)?true:false)?e.removeClass("ke-menuitem-disable"):e.addClass("ke-menuitem-disable")}})}();p.addPlugin(function(){new s.Paste(p)})});
KISSY.Editor.add("colorsupport",function(){function p(n){return("0"+n).slice(n.length-1,n.length+1)}function o(n){n=v.trim(n);if(n.charAt(0)=="#")n=n.substring(1);n=n.replace(/\s+/g,"");var A="";if(/^[0-9a-f]{3,3}$/i.test(n))A=n.replace(/[0-9a-f]/ig,function(j){return j+j});else{var q=n.match(c);if(q&&q[0])for(n=1;n<4;n++)A+=p(parseInt(q[n]).toString(16));else A=n}return"#"+A.toLowerCase()}function s(n){s.superclass.constructor.call(this,n);this._init()}var x=KISSY.Editor,v=KISSY,z=v.Node,u=v.Event,
l=x.SimpleOverlay,m=x.TripleButton,g=v.DOM;if(!x.ColorSupport){g.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");for(var c=/^rgb\((\d+),(\d+),(\d+)\)$/i,b=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394",
"351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"]],d="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>",h=0;h<3;h++){d+="<div class='ke-color-palette'><table>";for(var k=b[h],a=k.length/8,e=0;e<a;e++){d+="<tr>";for(var f=0;f<8;f++){var r=o(k[8*e+f]);d+="<td>";d+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+r+"'></a>";d+="</td>"}d+="</tr>"}d+="</table></div>"}d+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>";
s.ATTRS={editor:{},styles:{},contentCls:{},text:{}};v.extend(s,v.Base,{_init:function(){var n=this.get("editor"),A=new m({container:n.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});A.on("offClick onClick",this._showColors,this);this.el=A;x.Utils.lazyRun(this,"_prepare","_real");x.Utils.sourceDisable(n,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(n){var A=this.el.el;n=n.target;var q=this.colorWin;A._4e_equals(n)||A._4e_contains(n)||
q.hide()},_selectColor:function(n){n.halt();n=n.target;if(g._4e_name(n)=="a"&&!g.hasClass(n,"ke-button")){n=new z(n);this._applyColor(o(n._4e_style("background-color")));this.colorWin.hide()}},_applyColor:function(n){var A=this.get("editor"),q=A.document,j=this.get("styles");A.fire("save");n?(new x.Style(j,{color:n})).apply(q):(new x.Style(j,{color:"inherit"})).remove(q);A.fire("save")},_prepare:function(){var n=this,A=document,q=n.el,j=n.get("editor"),y=new z(d);n.colorWin=new l({el:y,width:"170px",
zIndex:j.baseZIndex(x.zIndexManager.POPUP_MENU),mask:false,focusMgr:false});y._4e_unselectable();y.on("click",n._selectColor,n);n.colorPanel=y;u.on(A,"click",n._hidePanel,n);u.on(j.document,"click",n._hidePanel,n);var t=n.colorWin;t.on("show",q.bon,q);t.on("hide",q.boff,q);y.one(".ke-color-others").on("click",function(B){B.halt();t.hide();j.useDialog("colorsupport/dialog",function(i){i.show(n)})})},_real:function(){var n=this.el.el,A=this.colorPanel,q=n.offset();q.top+=n.height()+5;if(q.left+A.width()>
g.viewportWidth()-60)q.left=g.viewportWidth()-A.width()-60;this.colorWin.show(q)},_showColors:function(n){var A=this.colorWin;A&&A.get("visible")?A.hide():this._prepare(n)}});x.ColorSupport=s}});
KISSY.Editor.add("contextmenu",function(){function p(g){this.cfg=g;s.Utils.lazyRun(this,"_prepareShow","_realShow")}function o(g,c){for(var b=0;b<c.length;b++){var d=c[b];if(x.isFunction(d)){if(d(new v(g)))return true}else if(z.test(g,d))return true}return false}var s=KISSY.Editor,x=KISSY,v=x.Node,z=x.DOM,u=x.Event;if(!s.ContextMenu){p.ATTRS={editor:{}};var l=[];p.register=function(g){var c=new p(g),b=g.editor.document;l.push({doc:b,rules:g.rules||[],instance:c});if(!b.ke_contextmenu){b.ke_contextmenu=
1;u.on(b,"mousedown",p.hide);u.on(b,"contextmenu",function(d){p.hide.call(this);for(var h=new v(d.target);h;){var k=false;if(h._4e_name()=="body")break;for(var a=0;a<l.length;a++){var e=l[a].instance,f=l[a].rules;if(b===l[a].doc&&o(h[0],f)){d.preventDefault();k=true;setTimeout(function(){e.show(s.Utils.getXY(d.pageX,d.pageY,b,document))},30);break}}if(k)break;h=h.parent()}})}return c};p.hide=function(){for(var g=0;g<l.length;g++){var c=l[g].instance;this===l[g].doc&&c.hide()}};var m=s.SimpleOverlay;
x.augment(p,{_init:function(){var g=this,c=g.cfg,b=c.funcs;g.elDom=new v("<div onmousedown='return false;'>");var d=g.elDom;g.el=new m({el:d,width:c.width,cls:"ke-menu"});for(var h in b){c=new v("<a href='#'>"+h+"</a>");d[0].appendChild(c[0]);(function(k,a){k._4e_unselectable();k.on("click",function(e){g.hide();e.halt();setTimeout(a,30)})})(c,b[h])}},hide:function(){this.el&&this.el.hide()},_realShow:function(g){s.fire("contextmenu",{contextmenu:this});this.el.show(g)},_prepareShow:function(){this._init()},
show:function(g){this._prepareShow(g)}});s.ContextMenu=p}});
KISSY.Editor.add("dd",function(){function p(){p.superclass.constructor.apply(this,arguments);this._init()}function o(){o.superclass.constructor.apply(this,arguments);this._init()}function s(){s.superclass.constructor.apply(this,arguments)}var x=KISSY,v=x.Editor,z=x.Event,u=x.UA,l=x.DOM,m=x.Node;if(!v.DD){v.DD={};p.ATTRS={bufferTime:{value:200},activeDrag:{}};x.extend(p,x.Base,{_init:function(){this._showShimMove=v.Utils.throttle(this._move,this,30)},_move:function(c){var b=this.get("activeDrag");
x.log("move");if(b){c.preventDefault();this._clearSelection();b._move(c)}},_start:function(c){var b=this,d=b.get("bufferTime")||0;b._registerEvent();if(d)b._bufferTimer=setTimeout(function(){b._bufferStart(c)},d);else b._bufferStart(c)},_bufferStart:function(c){this.set("activeDrag",c);this._activeShim();c._start()},_end:function(c){var b=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});
if(b){b._end(c);this.set("activeDrag",null)}},_activeShim:function(){var c=document;this._shim=(new m("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:"+v.baseZIndex(v.zIndexManager.DD_PG)+";'></div>")).appendTo(c.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:l.docHeight()});this._clearSelection()},_clearSelection:function(){if(window.getSelection)window.getSelection().removeAllRanges();
else document.selection&&document.selection.empty()},_registerEvent:function(){var c=document;x.log("_registerEvent");z.on(c,"mouseup",this._end,this);z.on(c,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var c=document;x.log("_unregisterEvent");z.remove(c,"mousemove",this._showShimMove,this);z.remove(c,"mouseup",this._end,this)}});v.DD.DDM=new p;var g=v.DD.DDM;o.ATTRS={node:{},handlers:{value:{}}};x.extend(o,x.Base,{_init:function(){var c=this.get("node"),b=this.get("handlers");
if(x.isEmptyObject(b))b[c[0].id]=c;for(var d in b)if(b.hasOwnProperty(d)){var h=b[d],k=h.css("cursor");if(!h._4e_equals(c))if(!k||k==="auto")h.css("cursor","move")}c.on("mousedown",this._handleMouseDown,this)},_check:function(c){var b=this.get("handlers"),d;for(d in b)if(b.hasOwnProperty(d))if(b[d]._4e_contains(c)||b[d]._4e_equals(c))return true;return false},_handleMouseDown:function(c){if(this._check(new m(c.target))){u.webkit||c.preventDefault();g._start(this);var b=this.get("node"),d=c.pageX;
c=c.pageY;b=b.offset();this.startMousePos={left:d,top:c};this.startNodePos=b;this._diff={left:d-b.left,top:c-b.top}}},_move:function(c){this.fire("move",c)},_end:function(){this.fire("end")},_start:function(){this.fire("start")}});x.extend(s,o,{_init:function(){var c=this;s.superclass._init.apply(c,arguments);var b=c.get("node");c.on("move",function(d){b.offset({left:d.pageX-c._diff.left,top:d.pageY-c._diff.top})})}});v.Draggable=o;v.Drag=s}});
KISSY.Editor.add("draft",function(p){var o=KISSY,s=o.Editor;s.Draft||function(){function x(c,b,d){for(c+="";c.length<b;)c=d+c;return c}function v(c){if(o.isNumber(c))c=new Date(c);return c instanceof Date?[c.getFullYear(),"-",x(c.getMonth()+1,2,"0"),"-",x(c.getDate(),2,"0")," ",x(c.getHours(),2,"0"),":",x(c.getMinutes(),2,"0"),":",x(c.getSeconds(),2,"0")].join(""):c}function z(c){this.editor=c;this._init()}var u=o.Node,l=o.Event,m=o.JSON,g=window[s.STORE];o.augment(z,{_init:function(){var c=this,
b=c.editor,d=b.statusDiv,h=b.cfg.pluginConfig;h.draft=h.draft||{};c.draftInterval=h.draft.interval=h.draft.interval||5;c.draftLimit=h.draft.limit=h.draft.limit||5;d=(new u("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+h.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(d);c.timeTip=(new u("<span class='ke-draft-time'>")).appendTo(d);var k=(new u("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(d),
a=new s.Select({container:d,menuContainer:document.body,doc:b.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),e=g.getItem("ke-draft-save"),f=[];c.versions=a;if(e)f=o.isString(e)?m.parse(decodeURIComponent(e)):e;c.drafts=f;c.sync();k.on("click",function(){c.save(false)});(function(){var r=b.textarea[0].form;r&&l.on(r,"submit",function(){c.save(false)})})();setInterval(function(){c.save(true)},c.draftInterval*60*1E3);a.on("click",c.recover,c);c.holder=d;if(h.draft.helpHtml){h=
new s.TripleButton({cls:"ke-draft-help",title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:d});h.on("click",function(){c._prepareHelp()});s.Utils.lazyRun(c,"_prepareHelp","_realHelp");c.helpBtn=h.el}c._holder=d},_prepareHelp:function(){var c=this,b=c.editor,d=c.helpBtn,h=(new u(b.cfg.pluginConfig.draft.helpHtml||"")).appendTo(document.body),k=new u("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
h.append(k);h.css({border:"1px solid #ACB4BE","text-align":"left"});c._help=new s.SimpleOverlay({el:h,focusMgr:false,draggable:false,width:h.width()+"px",mask:false});c._help.el.css("border","none");c._help.arrow=k;l.on([document,b.document],"click",function(a){a=a.target;a==d[0]||d._4e_contains(a)||c._help.hide()})},_realHelp:function(){var c=this._help,b=this.helpBtn,d=c.arrow;c.show();b=b.offset();c.el.offset({left:b.left-c.el.width()+17,top:b.top-c.el.height()-7});d.offset({left:b.left-2,top:b.top-
8})},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var c=this.draftLimit,b=this.timeTip,d=this.versions,h=this.drafts;h.length>c&&h.splice(0,h.length-c);c=[];for(var k,a=0;a<h.length;a++){k=h[a];k=(k.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+v(k.date);c.push({name:k,value:a})}d.set("items",c.reverse());b.html(k);g.setItem("ke-draft-save",encodeURIComponent(m.stringify(h)))},save:function(c){var b=this.drafts,d=p.getData(true);if(d){if(b[b.length-
1]&&d==b[b.length-1].content)b.length-=1;this.drafts=b.concat({content:d,date:(new Date).getTime(),auto:c});this.sync()}},recover:function(c){var b=this.editor,d=this.drafts;c=c.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+v(d[c].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){b.fire("save");b.setData(d[c].content);b.fire("save")}}});s.Draft=z}();p.addPlugin(function(){s.storeReady(function(){new s.Draft(p)})})});
KISSY.Editor.add("elementpaths",function(p){var o=KISSY.Editor,s=KISSY,x=s.Node,v=s.DOM;o.ElementPaths||function(){function z(u){this.cfg=u;this._cache=[];this._init()}v.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");s.augment(z,{_init:function(){var u=this.cfg.editor;this.holder=new x("<span>");this.holder.appendTo(u.statusDiv);u.on("selectionChange",this._selectionChange,this);
o.Utils.sourceDisable(u,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(u){var l=this.cfg.editor,m=this.holder;m=m[0]||m;u=u.path.elements;var g,c;g=this._cache;for(c=0;c<g.length;c++){g[c].detach("click");g[c]._4e_remove()}this._cache=[];for(c=0;c<u.length;c++){g=u[c];var b=new x("<a href='#' class='elementpath'>"+(g.attr("_ke_real_element_type")||g._4e_name())+"</a>");this._cache.push(b);(function(d){b.on("click",
function(h){h.halt();l.focus();setTimeout(function(){l.getSelection().selectElement(d)},50)})})(g);m.firstChild?v.insertBefore(b[0],m.firstChild):m.appendChild(b[0])}}});o.ElementPaths=z}();p.addPlugin(function(){new o.ElementPaths({editor:p})})});
KISSY.Editor.add("enterkey",function(p){var o=KISSY.Editor,s=KISSY,x=s.UA,v=/^h[1-6]$/,z=o.XHTML_DTD,u=s.Node,l=s.Event,m=o.Walker,g=o.ElementPath;o.enterBlock||function(){function c(b){l.on(b.document,"keydown",function(d){if(d.keyCode===13)if(!d.shiftKey){b.fire("save");var h=b.execCommand("enterBlock");b.fire("save");h!==false&&d.preventDefault()}})}c.enterBlock=function(b){var d;d=b.getSelection().getRanges();for(var h=d.length-1;h>0;h--)d[h].deleteContents();d=d[0];h=d.document;if(d.checkStartOfBlock()&&
d.checkEndOfBlock()){var k=(new g(d.startContainer)).block;if(k&&(k._4e_name()=="li"||k.parent()._4e_name()=="li"))if(b.hasCommand("outdent")){b.fire("save");b.execCommand("outdent");b.fire("save");return}else return false}var a=d.splitBlock("p");if(a){b=a.previousBlock;k=a.nextBlock;var e=a.wasStartOfBlock,f=a.wasEndOfBlock,r;if(k){r=k.parent();if(r._4e_name()=="li"){k._4e_breakParent(r);k._4e_move(k._4e_next(),true)}}else if(b&&(r=b.parent())&&r._4e_name()=="li"){b._4e_breakParent(r);d.moveToElementEditablePosition(b._4e_next());
b._4e_move(b._4e_previous())}if(!e&&!f){if(k._4e_name()=="li"&&(r=k._4e_first(m.invisible(true)))&&s.inArray(r._4e_name(),["ul","ol"]))(x.ie?new u(h.createTextNode("\u00a0")):new u(h.createElement("br"))).insertBefore(r);k&&d.moveToElementEditablePosition(k)}else{var n;if(b){if(b._4e_name()=="li"||!v.test(b._4e_name()))n=b._4e_clone()}else if(k)n=k._4e_clone();n||(n=new u("<p>",null,h));if(r=a.elementPath){a=0;for(var A=r.elements.length;a<A;a++){var q=r.elements[a];if(q._4e_equals(r.block)||q._4e_equals(r.blockLimit))break;
if(z.$removeEmpty[q._4e_name()]){q=q._4e_clone();n._4e_moveChildren(q);n.append(q)}}}x.ie||n._4e_appendBogus();d.insertNode(n);if(x.ie&&e&&(!f||!b[0].childNodes.length)){d.moveToElementEditablePosition(f?b:n);d.select()}d.moveToElementEditablePosition(e&&!f?k:n)}if(!x.ie)if(k){n=new u(h.createElement("span"));n.html("&nbsp;");d.insertNode(n);n._4e_scrollIntoView();d.deleteContents()}else n._4e_scrollIntoView();d.select()}};o.EnterKey=c}();p.addPlugin(function(){p.addCommand("enterBlock",{exec:o.EnterKey.enterBlock});
o.EnterKey(p)})});
KISSY.Editor.add("fakeobjects",function(p){var o=KISSY.Editor,s=KISSY,x=s.Node,v=o.NODE,z=o.Config.base+"theme/spacer.gif",u=o.HtmlParser;o=s.Editor;var l=(p=p.htmlDataProcessor)&&p.htmlFilter,m={elements:{$:function(g){var c=g.attributes;if((c=(c=(c=c&&c._ke_realelement)&&new u.Fragment.FromHtml(decodeURIComponent(c)))&&c.children[0])&&g.attributes._ke_resizable){var b=g.attributes.style;if(b){var d=/(?:^|\s)width\s*:\s*(\d+)/i.exec(b);g=d&&d[1];b=(d=/(?:^|\s)height\s*:\s*(\d+)/i.exec(b))&&d[1];
if(g)c.attributes.width=g;if(b)c.attributes.height=b}}return c}}};l&&l.addRules(m);p&&s.mix(p,{createFakeParserElement:function(g,c,b,d,h){var k;k=new u.BasicWriter;g.writeHtml(k);k=k.getHtml();var a=g.attributes.style;if(g.attributes.width)a="width:"+g.attributes.width+"px;"+a;if(g.attributes.height)a="height:"+g.attributes.height+"px;"+a;g={"class":c,src:z,_ke_realelement:encodeURIComponent(k),_ke_real_node_type:g.type,style:a,align:g.attributes.align||""};h&&delete h.width;h&&delete h.height;h&&
s.mix(g,h,false);if(b)g._ke_real_element_type=b;if(d)g._ke_resizable=d;return new u.Element("img",g)}});s.augment(o,{createFakeElement:function(g,c,b,d,h,k){var a=g.attr("style")||"";if(g.attr("width"))a="width:"+g.attr("width")+"px;"+a;if(g.attr("height"))a="height:"+g.attr("height")+"px;"+a;g={"class":c,src:z,_ke_realelement:encodeURIComponent(h||g._4e_outerHtml()),_ke_real_node_type:g[0].nodeType,style:a};k&&delete k.width;k&&delete k.height;k&&s.mix(g,k,false);if(b)g._ke_real_element_type=b;if(d)g._ke_resizable=
d;return new x("<img/>",g,this.document)},restoreRealElement:function(g){if(g.attr("_ke_real_node_type")!=v.NODE_ELEMENT)return null;g=decodeURIComponent(g.attr("_ke_realelement"));var c=new x("<div>",null,this.document);c.html(g);return c._4e_first(function(b){return b[0].nodeType==v.NODE_ELEMENT})._4e_remove()}})});KISSY.Editor.add("flash",function(p){p.addPlugin(function(){new KISSY.Editor.Flash(p)})});
KISSY.Editor.add("flash/support",function(p){var o=KISSY.Editor,s=KISSY,x=s.UA,v=s.Event,z=o.ContextMenu,u=s.Node,l=o.BubbleView,m=o.TripleButton,g=p.htmlDataProcessor,c="ke_flash",b=o.Utils.flash;p=g&&g.dataFilter;o.Flash||function(){function d(e){this.editor=e;this._init()}function h(e){return e._4e_name()==="img"&&!!e.hasClass(c)&&e}var k=/\.swf(?:$|\?)/i;d.isFlashEmbed=function(e){e=e.attributes;return e.type=="application/x-shockwave-flash"||k.test(e.src||"")};s.augment(d,{_config:function(){this._cls=
c;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=a;this._flashRules=["img."+c]},_init:function(){this._config();var e=this.editor,f={},r=this._contextMenu;e._toolbars=e._toolbars||{};e._toolbars[this._type]=this;this.el=new m({container:e.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("offClick",this.show,this);if(r)for(var n in r)(function(A){f[A]=function(){r[A](e)}})(n);z.register({editor:e,rules:this._flashRules,width:"120px",
funcs:f});l.attach({pluginName:this._type,pluginInstance:this});v.on(e.document,"dblclick",this._dbclick,this);o.Utils.sourceDisable(e,this)},disable:function(){this.el.set("state",m.DISABLED)},enable:function(){this.el.set("state",m.OFF)},_getFlashUrl:function(e){return b.getUrl(e)},_updateTip:function(e,f){var r=this.editor.restoreRealElement(f);if(r){r=this._getFlashUrl(r);e.html(r);e.attr("href",r)}},_dbclick:function(e){var f=new u(e.target);if(f._4e_name()==="img"&&f.hasClass(this._cls)){this.show(null,
f);e.halt()}},show:function(e,f){this.editor.useDialog(this._type+"/dialog",function(r){r.show(f)})}});o.Flash=d;d.registerBubble=function(e,f,r){l.register({pluginName:e,func:r,init:function(){var n=this,A=n.el;A.html(f+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var q=A.one(".ke-bubbleview-url"),j=A.one(".ke-bubbleview-change");A=A.one(".ke-bubbleview-remove");
j._4e_unselectable();q._4e_unselectable();A._4e_unselectable();j.on("click",function(y){n._plugin.show(null,n._selectedEl);y.halt()});A.on("click",function(y){var t=n._plugin;if(x.webkit){var B=t.editor.getSelection().getRanges();B&&B[0]&&(B[0].collapse(true)||1)&&B[0].select()}n._selectedEl._4e_remove();n.hide();t.editor.notifySelectionChange();y.halt()});n.on("beforeVisibleChange",function(y){var t=n._selectedEl;y.newVal&&t&&n._plugin._updateTip(q,t)})}})};d.registerBubble("flash","Flash \u7f51\u5740\uff1a ",
h);d.checkFlash=h;var a={"Flash\u5c5e\u6027":function(e){var f=e.getSelection();f=f&&f.getStartElement();f=h(f);e=e._toolbars.flash;f&&e.show(null,f)}};d.CLS_FLASH=c;d.TYPE_FLASH="flash"}();p&&p.addRules({elements:{object:function(d){var h=d.attributes;if(!(h.classid&&String(h.classid).toLowerCase())){for(h=0;h<d.children.length;h++)if(d.children[h].name=="embed"){if(!o.Flash.isFlashEmbed(d.children[h]))break;return g.createFakeParserElement(d,c,"flash",true)}return null}return g.createFakeParserElement(d,
c,"flash",true)},embed:function(d){if(!o.Flash.isFlashEmbed(d))return null;return g.createFakeParserElement(d,c,"flash",true)}}},5)});
KISSY.Editor.add("flashbridge",function(){function p(c){this._init(c)}function o(c){var b=x.isString(c)?c.match(/(\d)+/g):c;c=c;if(x.isArray(b))c=parseFloat(b[0]+"."+s(b[1],3)+s(b[2],5));return c||0}function s(c,b){for(var d=(c+"").length;d++<b;)c="0"+c;return c}var x=KISSY,v=x.Editor;if(!v.FlashBridge){var z={};x.augment(p,x.EventTarget,{_init:function(c){var b=x.guid("flashbridge-");c.flashVars=c.flashVars||{};c.attrs=c.attrs||{};c.params=c.params||{};var d=c.flashVars,h=c.params;x.mix(c.attrs,
{id:b,width:"100%",height:"100%"},false);x.mix(h,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);x.mix(d,{shareData:false,useCompression:false},false);h={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(c.ajbridge)h={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};x.mix(d,h);z[b]=this;this.id=b;this.swf=v.Utils.flash.createSWFRuntime(c.movie,c);this._expose(c.methods)},_expose:function(c){for(var b=this,d=0;d<c.length;d++)(function(h){b[h]=
function(){return b._callSWF(h,x.makeArray(arguments))}})(c[d])},_callSWF:function(c,b){b=b||[];try{if(this.swf[c])return this.swf[c].apply(this.swf,b)}catch(d){var h="";if(b.length!==0)h="'"+b.join("', '")+"'";return(new Function("self","return self.swf."+c+"("+h+");"))(this)}},_eventHandler:function(c){var b=c.type;if(b==="log")x.log(c.message);else b&&this.fire(b,c)},_destroy:function(){delete z[this.id]}});p.EventHandler=function(c,b){var d=z[c];d&&setTimeout(function(){d._eventHandler.call(d,
b)},100)};v.FlashBridge=p;var u=x.UA,l,m,g=true;u.fpv=function(c){if(c||g){g=false;var b;if(navigator.plugins&&navigator.mimeTypes.length)b=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{b=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(d){}l=b?b.match(/(\d)+/g):void 0;m=o(l)}return l};u.fpvGEQ=function(c,b){g&&u.fpv(b);return!!m&&m>=o(c)}}});
KISSY.Editor.add("flashutils",function(){var p=KISSY,o=p.Editor,s=o.Utils.flash;if(!s){var x=p.DOM,v=p.Node,z=p.UA;s={getUrl:function(u){var l="",m=o.NODE;if(u._4e_name()=="object"){u=u[0].childNodes;for(var g=0;g<u.length;g++)if(u[g].nodeType==m.NODE_ELEMENT)if((x.attr(u[g],"name")||"").toLowerCase()=="movie")l=x.attr(u[g],"value");else if(x._4e_name(u[g])=="embed")l=x.attr(u[g],"src");else if(x._4e_name(u[g])=="object")l=x.attr(u[g],"data")}else if(u._4e_name()=="embed")l=u.attr("src");return l},
createSWF:function(u,l,m){var g=l.attrs||{},c=l.flashVars,b="",d="";l=l.params||{};var h="";m=m||document;p.mix(g,{wmode:"transparent"});for(var k in g)if(g.hasOwnProperty(k))b+=k+"='"+g[k]+"' ";p.mix(l,{quality:"high",movie:u,wmode:"transparent"});for(var a in l)if(l.hasOwnProperty(a))d+="<param name='"+a+"' value='"+l[a]+"'/>";if(c){for(var e in c)if(c.hasOwnProperty(e))h+="&"+e+"="+encodeURIComponent(c[e]);h=h.substring(1)}u="<object "+b+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
d+(h?'<param name="flashVars" value="'+h+'"/>':"")+"<embed "+b+" "+(h?'FlashVars="'+h+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+u+'"  type="application/x-shockwave-flash"/></object>';return{el:new v(u,null,m),html:u}},createSWFRuntime2:function(u,l,m){m=m||document;var g=(new v("<div style='width:0;height:0;overflow:hidden;'>",null,m)).appendTo(m.body);g=s.createSWF.apply(this,arguments).el.appendTo(g);z.ie||(g=g.one("object"));return g[0]},createSWFRuntime:function(u,
l,m){var g=l.attrs||{},c=l.flashVars||{},b=l.params||{},d="",h="",k="";m=m||document;g.id=g.id||p.guid("ke-runtimeflash-");for(var a in g)if(g.hasOwnProperty(a))d+=a+"='"+g[a]+"' ";for(var e in b)if(b.hasOwnProperty(e))h+="<param name='"+e+"' value='"+b[e]+"'/>";for(var f in c)if(c.hasOwnProperty(f))k+="&"+f+"="+encodeURIComponent(c[f]);k=k.substring(1);u=z.ie?"<object "+d+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+h+'<param name="movie" value="'+u+'" />'+(k?'<param name="flashVars" value="'+
k+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+u+"' "+d+">"+h+(k?'<param name="flashVars" value="'+k+'"/>':"")+"</object>";var r=l.holder;if(!r){r=(new v("<div style='"+(l.style?l.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,m)).appendTo(m.body);setTimeout(function(){r.offset({left:x.scrollLeft(),top:x.scrollTop()})},100)}r.html(u);return m.getElementById(g.id)}};o.Utils.flash=s}});
KISSY.Editor.add("font",function(p){function o(n){for(var A=[],q=0;q<n.length;q++)A.push({name:n[q],value:n[q]});return A}var s=KISSY,x=s.Editor,v=x.Style,z=x.TripleButton,u=p.cfg.pluginConfig,l=s.Node,m=u["font-size"];if(m!==false){m=m||{};s.mix(m,{items:o(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var g={},c=[],b={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};for(r=0;r<m.items.length;r++){var d=
m.items[r],h=d.name,k=d.attrs;d=d.value;g[d]=new v(b,{size:d});c.push({name:h,value:d,attrs:k})}u["font-size"]=m}var a=u["font-family"];if(a!==false){a=a||{};s.mix(a,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},
{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var e={},f=[];b={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};var r;u["font-family"]=a;for(r=0;r<a.items.length;r++){d=a.items[r];h=d.name;k=d.attrs||{};d=d.value;k.style=k.style||"";k.style+=";font-family:"+d;e[d]=new v(b,{family:d});f.push({name:h,value:d,attrs:k})}}x.Font||function(){function n(j){n.superclass.constructor.call(this,j);this._init()}function A(j){A.superclass.constructor.call(this,
j);this._init()}n.ATTRS={title:{},html:{},styles:{},editor:{}};var q=x.Select;s.extend(n,s.Base,{_init:function(){var j=this.get("editor"),y=j.toolBarDiv;this.get("html");this.el=new q({container:y,doc:j.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),showValue:this.get("showValue"),menuContainer:new l(document.body)});this.el.on("click",this._vChange,this);j.on("selectionChange",this._selectionChange,this);x.Utils.sourceDisable(j,
this)},disable:function(){this.el.set("state",q.DISABLED)},enable:function(){this.el.set("state",q.ENABLED)},_vChange:function(j){var y=this.get("editor"),t=j.newVal;j=j.prevVal;var B=this.get("styles");y.focus();y.fire("save");if(t==j){B[t].remove(y.document);this.el.set("value","")}else B[t].apply(y.document);y.fire("save")},_selectionChange:function(j){this.get("editor");j=j.path.elements;for(var y=this.get("styles"),t=0,B;t<j.length;t++){B=j[t];for(var i in y)if(y[i].checkElementRemovable(B,true)){this.el.set("value",
i);return}}this.el.reset("value")}});A.ATTRS={editor:{},text:{},contentCls:{},title:{},style:{}};s.extend(A,s.Base,{_init:function(){var j=this.get("editor"),y=this.get("text");this.get("style");var t=this.get("title");this.el=new z({text:y,title:t,contentCls:this.get("contentCls"),container:j.toolBarDiv});this.el.on("offClick",this._on,this);this.el.on("onClick",this._off,this);j.on("selectionChange",this._selectionChange,this);x.Utils.sourceDisable(j,this)},disable:function(){this.el.set("state",
z.DISABLED)},enable:function(){this.el.set("state",z.OFF)},_on:function(){var j=this.get("editor");this.get("text");var y=this.get("style");this.get("title");j.fire("save");y.apply(j.document);j.fire("save");j.notifySelectionChange();j.focus()},_off:function(){var j=this.get("editor");this.get("text");var y=this.get("style");this.get("title");j.fire("save");y.remove(j.document);j.fire("save");j.notifySelectionChange();j.focus()},_selectionChange:function(j){this.get("editor");this.get("text");var y=
this.get("style");this.get("title");var t=this.el;j=j.path;if(t.get("state")!=z.DISABLED)y.checkActive(j)?t.set("state",z.ON):t.set("state",z.OFF)}});n.SingleFont=A;x.Font=n}();p.addPlugin(function(){false!==u["font-size"]&&new x.Font({editor:p,title:"\u5927\u5c0f",width:"30px",showValue:true,popUpWidth:m.width,styles:g,html:c});false!==u["font-family"]&&new x.Font({editor:p,title:"\u5b57\u4f53",width:"110px",popUpWidth:a.width,styles:e,html:f});false!==u["font-bold"]&&new x.Font.SingleFont({contentCls:"ke-toolbar-bold",
title:"\u7c97\u4f53 ",editor:p,style:new v({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})});false!==u["font-italic"]&&new x.Font.SingleFont({contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 ",editor:p,style:new v({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})});false!==u["font-underline"]&&new x.Font.SingleFont({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",editor:p,style:new v({element:"u",overrides:[{element:"span",
attributes:{style:"text-decoration: underline;"}}]})});false!==u["font-strikeThrough"]&&new x.Font.SingleFont({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",editor:p,style:new v({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})})})});
KISSY.Editor.add("forecolor",function(p){var o=KISSY.Editor.ColorSupport,s={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]};p.addPlugin(function(){new o({editor:p,styles:s,title:"\u6587\u672c\u989c\u8272",contentCls:"ke-toolbar-color",text:"color"})})});
KISSY.Editor.add("format",function(p){var o=KISSY.Editor,s=KISSY,x=s.Node,v=[],z={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},u={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},l={},m=o.Style,g;for(g in z)if(z[g]){l[z[g]]=new m({element:z[g]});v.push({name:g,value:z[g],attrs:{style:"font-size:"+u[z[g]]}})}o.Format||function(){function c(d){c.superclass.constructor.call(this,d);this._init()}c.ATTRS={editor:{}};var b=o.Select;s.extend(c,s.Base,
{_init:function(){var d=this.get("editor");this.el=new b({container:d.toolBarDiv,value:"",doc:d.document,width:this.get("width"),popUpWidth:this.get("popUpWidth"),title:this.get("title"),items:this.get("html"),menuContainer:new x(document.body)});this.el.on("click",this._vChange,this);d.on("selectionChange",this._selectionChange,this);o.Utils.sourceDisable(d,this)},disable:function(){this.el.set("state",b.DISABLED)},enable:function(){this.el.set("state",b.ENABLED)},_vChange:function(d){var h=this.get("editor"),
k=d.newVal;d=d.prevVal;h.fire("save");if(k!=d)l[k].apply(h.document);else{l.p.apply(h.document);this.el.set("value","p")}h.fire("save")},_selectionChange:function(d){this.get("editor");d=d.path;for(var h in l)if(l[h].checkActive(d)){this.el.set("value",h);return}this.el.reset("value")}});o.Format=c}();p.addPlugin(function(){new o.Format({editor:p,html:v,title:"\u6807\u9898",width:"100px",popUpWidth:"120px"})})});
KISSY.Editor.add("htmldataprocessor",function(p){var o=o,s=KISSY,x=s.Editor,v=s.Node,z=s.UA,u=x.NODE,l=x.HtmlParser,m=new l.Filter,g=new l.Filter,c=x.XHTML_DTD;if(!p.htmlDataProcessor){(function(){var b=x.HtmlParser.Fragment.prototype,d=x.HtmlParser.Element.prototype;b.onlyChild=d.onlyChild=function(){var h=this.children;return h.length==1&&h[0]||null};d.removeAnyChildWithName=function(h){for(var k=this.children,a=[],e,f=0;f<k.length;f++){e=k[f];if(e.name){if(e.name==h){a.push(e);k.splice(f--,1)}a=
a.concat(e.removeAnyChildWithName(h))}}return a};d.getAncestor=function(h){for(var k=this.parent;k&&!(k.name&&k.name.match(h));)k=k.parent;return k};b.firstChild=d.firstChild=function(h){for(var k,a=0;a<this.children.length;a++){k=this.children[a];if(h(k))return k;else if(k.name)if(k=k.firstChild(h))return k}return null};d.addStyle=function(h,k,a){var e="";if(typeof k=="string")e+=h+":"+k+";";else{if(typeof h=="object")for(var f in h){if(h.hasOwnProperty(f))e+=f+":"+h[f]+";"}else e+=h;a=k}if(!this.attributes)this.attributes=
{};h=this.attributes.style||"";h=(a?[e,h]:[h,e]).join(";");this.attributes.style=h.replace(/^;|;(?=;)/,"")};c.parentOf=function(h){var k={},a;for(a in this)if(a.indexOf("$")==-1&&this[a][h])k[a]=1;return k}})();(function(){function b(j){if(/mso-list\s*:\s*Ignore/i.test(j.attributes&&j.attributes.style))return true;return o}function d(j,y){var t=new x.HtmlParser.Element("ke:listbullet"),B;if(j)if(j[2]){j=isNaN(j[1])?/^[a-z]+$/.test(j[1])?"lower-alpha":/^[A-Z]+$/.test(j[1])?"upper-alpha":"decimal":
"decimal";B="ol"}else{j=/[l\u00B7\u2002]/.test(j[1])?"disc":/[\u006F\u00D8]/.test(j[1])?"circle":/[\u006E\u25C6]/.test(j[1])?"square":"disc";B="ul"}else{j="decimal";B="ol"}t.attributes={"ke:listtype":B,style:"list-style-type:"+j+";"};t.add(new x.HtmlParser.Text(y));return t}function h(j){var y=j.attributes,t;if((t=j.removeAnyChildWithName("ke:listbullet"))&&t.length&&(t=t[0])){j.name="ke:li";if(y.style)y.style=k([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");
B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!f&&r&&B>r)f=B-r;y["ke:margin"]=r=B}]],o)(y.style,j)||"";t=t.attributes;j.addStyle(t.style);s.mix(y,t);return true}return false}function k(j,y){return function(t,B){var i=[];t.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(C,D,E){D=D.toLowerCase();D=="font-family"&&(E=E.replace(/["']/g,""));for(var F,K,M,N=0;N<j.length;N++)if(j[N]){C=j[N][0];F=j[N][1];K=j[N][2];M=j[N][3];if(D.match(C)&&(!F||E.match(F))){D=M||D;y&&(K=K||E);if(typeof K==
"function")K=K(E,B,D);if(K&&K.push){D=K[0];K=K[1]}typeof K=="string"&&i.push([D,K]);return}}!y&&i.push([D,E])});for(var w=0;w<i.length;w++)i[w]=i[w].join(":");return i.length?i.join(";")+";":false}}function a(j){j=j.children;for(var y,t,B,i,w,C,D,E=0;E<j.length;E++){y=j[E];if("ke:li"==y.name){y.name="li";y=y;t=y.attributes;B=y.attributes["ke:listtype"];i=parseInt(t["ke:indent"],10)||f&&Math.ceil(t["ke:margin"]/f)||1;t.style&&(t.style=k([["list-style-type",B=="ol"?"decimal":"disc"]],o)(t.style)||"");
if(C){if(i>D){C=new x.HtmlParser.Element(B);C.add(y);w.add(C)}else{if(i<D){w=D-i;for(var F;w--&&(F=C.parent);)C=F.parent}C.add(y)}j.splice(E--,1)}else{C=new x.HtmlParser.Element(B);C.add(y);j[E]=C}w=y;D=i}else C=null}f=0}var e=k([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],o),f,r=0,n=c.parentOf("ol"),A={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(j){j.filterChildren();
a(j)},elements:{font:function(j){delete j.name},p:function(j){j.filterChildren();if(h(j))return o},$:function(j){var y=j.name||"";y.indexOf(":")!=-1&&y.indexOf("ke")==-1&&delete j.name;var t=j.attributes.style;if(y=="span"&&(!t||!e(t)))delete j.name;if(y in n){j.filterChildren();a(j)}},span:function(j){if(!z.gecko&&b(j.parent))return false;if(!z.gecko&&b(j)){j=(j=j.firstChild(function(t){return t.value||t.name=="img"}))&&(j.value||"l.");var y=j.match(/^([^\s]+?)([.)]?)$/);return d(y,j)}},a:function(j){j=
j.attributes;if(j.href)j._ke_saved_href=j.href}},comment:!z.ie?function(j,y){var t=j.match(/<img.*?>/),B=j.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(t=B[1]||t&&"l.")&&t.match(/>([^\s]+?)([.)]?)</);return d(B,t)}if(z.gecko&&t){t=x.HtmlParser.Fragment.FromHtml(t[0]).children[0];(B=(B=(B=y.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(t.attributes.src=B);return t}return false}:function(){return false},attributes:{"class":function(j){if(/(^|\s+)ke_/.test(j))return j;
return false},style:function(j){j=e(j);if(!j)return false;return j}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},q={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(j){var y=j.parent;if(y&&y.name=="object"){var t=y.attributes.width;y=y.attributes.height;t&&(j.attributes.width=t);y&&(j.attributes.height=y)}},param:function(j){j.children=[];j.isEmpty=true;return j},a:function(j){if(!(j.children.length||j.attributes.name))return false;j=j.attributes;if(j._ke_saved_href)j.href=
j._ke_saved_href},td:function(j){for(var y=j.children,t=0;t<y.length;t++)if(y[t].name=="br"){y.splice(t,1);--t}if(!j.children.length){y=new x.HtmlParser.Text("&nbsp;");j.children.push(y)}},span:function(j){if(!j.children.length)return false}},attributes:{style:function(j){if(!s.trim(j))return false}},attributeNames:[[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""]]};if(z.ie)q.attributes.style=function(j){return j.toLowerCase()};m.addRules(q);g.addRules(A)})();(function(){function b(q){for(var j=q.children.length,
y=q.children[j-1];y&&y.type==u.NODE_TEXT&&!s.trim(y.value);)y=q.children[--j];return y}function d(q){var j=b(q);return!j||j.type==u.NODE_ELEMENT&&j.name=="br"||q.name=="form"&&j.name=="input"}function h(q,j){var y=q.children,t=b(q);if(t){if((j||!z.ie)&&t.type==u.NODE_ELEMENT&&t.name=="br")y.pop();t.type==u.NODE_TEXT&&e.test(t.value)&&y.pop()}}function k(q){h(q,true);if(d(q))z.ie?q.add(new x.HtmlParser.Text("\u00a0")):q.add(new x.HtmlParser.Element("br",{}))}function a(q){h(q);d(q)&&q.add(new x.HtmlParser.Text("\u00a0"))}
var e=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,f=x.XHTML_DTD,r=x.Utils.mix({},f.$block,f.$listItem,f.$tableContent),n;for(n in r)"br"in f[n]||delete r[n];delete r.pre;f={elements:{}};var A={elements:{}};for(n in r){f.elements[n]=k;A.elements[n]=a}g.addRules(f);m.addRules(A)})();(function(){m.addRules({text:function(b){return b.replace(/\xa0/g,"&nbsp;")}})})();p.htmlDataProcessor={htmlFilter:m,dataFilter:g,toHtml:function(b,d){var h=new l.HtmlWriter;l.Fragment.FromHtml(b,d).writeHtml(h,m);return h.getHtml(true)},
toDataFormat:function(b,d){if(z.gecko)b=b.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");var h=new v("<div>");h.html("a"+b);b=h.html().substr(1);h=new l.BasicWriter;var k=l.Fragment.FromHtml(b,d);h.reset();k.writeHtml(h,g);return h.getHtml(true)},toServer:function(b,d){var h=new l.BasicWriter;l.Fragment.FromHtml(b,d).writeHtml(h,m);return h.getHtml(true)}}}});
KISSY.Editor.add("image",function(p){var o=KISSY.Editor,s=KISSY,x=s.UA,v=s.Node,z=s.Event,u=o.BubbleView;o.ImageInserter||function(){function l(b){l.superclass.constructor.call(this,b);this._init()}var m=function(b){return b._4e_name()==="img"&&!/(^|\s+)ke_/.test(b[0].className)&&b},g=o.TripleButton;l.ATTRS={editor:{}};var c={"\u56fe\u7247\u5c5e\u6027":function(b){var d=b.getSelection();d=d&&d.getStartElement();d=m(d);b=b._toolbars.image;d&&b.show(null,d)}};s.extend(l,s.Base,{_init:function(){var b=this.get("editor"),
d=b.toolBarDiv,h={};this.editor=b;this.el=new g({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",container:d});this.el.on("offClick",this.show,this);z.on(b.document,"dblclick",this._dblclick,this);o.Utils.lazyRun(this,"_prepare","_real");b._toolbars=b._toolbars||{};b._toolbars.image=this;if(c){for(var k in c)(function(a){h[a]=function(){c[a](b)}})(k);o.ContextMenu.register({editor:b,rules:[m],width:"120px",funcs:h})}u.attach({pluginName:"image",pluginInstance:this});o.Utils.sourceDisable(b,this)},disable:function(){this.el.disable()},
enable:function(){this.el.boff()},_dblclick:function(b){var d=new v(b.target);if(m(d)){this.show(null,d);b.halt()}},_updateTip:function(b,d){var h=d.attr("src");b.html(h);b.attr("href",h)},show:function(b,d){this.get("editor").useDialog("image/dialog",function(h){h.show(d)})}});o.ImageInserter=l;(function(b,d,h){u.register({pluginName:b,func:h,init:function(){var k=this,a=k.el;a.html(d+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var e=a.one(".ke-bubbleview-url"),f=a.one(".ke-bubbleview-change");a=a.one(".ke-bubbleview-remove");f._4e_unselectable();e._4e_unselectable();a._4e_unselectable();f.on("click",function(r){k._plugin.show(null,k._selectedEl);r.halt()});a.on("click",function(r){var n=k._plugin;if(x.webkit){var A=n.editor.getSelection().getRanges();A&&A[0]&&(A[0].collapse(true)||1)&&A[0].select()}k._selectedEl._4e_remove();k.hide();n.editor.notifySelectionChange();r.halt()});k.on("afterVisibleChange",function(r){var n=
k._selectedEl;r.newVal&&n&&k._plugin._updateTip(e,n)})}})})("image","\u56fe\u7247\u7f51\u5740\uff1a ",m)}();p.addPlugin(function(){new o.ImageInserter({editor:p})})});
KISSY.Editor.add("indent",function(p){var o=KISSY.Editor,s={ol:1,ul:1},x=KISSY,v=o.Walker,z=x.DOM,u=x.Node,l=x.UA,m=o.NODE;o.Indent||function(){function g(f){this.type=f;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function c(f){return f.type=CKEDITOR.NODE_ELEMENT&&f.is("li")}function b(f,r,n){var A=r.startContainer;for(f=r.endContainer;A&&!A.parent()._4e_equals(n);)A=A.parent();for(;f&&!f.parent()._4e_equals(n);)f=f.parent();if(A&&f){var q=A;A=[];for(var j=false;!j;){if(q._4e_equals(f))j=
true;A.push(q);q=q.next()}if(!(A.length<1)){q=n._4e_parents(true);for(f=0;f<q.length;f++)if(s[q[f]._4e_name()]){n=q[f];break}q=this.type=="indent"?1:-1;f=A[0];j=A[A.length-1];A={};var y=o.ListUtils.listToArray(n,A),t=y[j.data("listarray_index")].indent;for(f=f.data("listarray_index");f<=j.data("listarray_index");f++){y[f].indent+=q;var B=y[f].parent;y[f].parent=new u(B[0].ownerDocument.createElement(B._4e_name()))}for(f=j.data("listarray_index")+1;f<y.length&&y[f].indent>t;f++)y[f].indent+=q;j=o.ListUtils.arrayToList(y,
A,null,"p",0);q=[];if(this.type=="outdent"){var i;if((i=n.parent())&&i._4e_name()=="li"){y=j.listNode.childNodes;var w;for(f=y.length-1;f>=0;f--)if((w=new u(y[f]))&&w._4e_name()=="li")q.push(w)}}if(j){z.insertBefore(j.listNode,n[0]);n._4e_remove()}if(q&&q.length)for(f=0;f<q.length;f++){for(w=n=q[f];(w=w.next())&&w._4e_name()in s;){l.ie&&!n._4e_first(function(C){return k(C)&&a(C)})&&n[0].appendChild(r.document.createTextNode("\u00a0"));n[0].appendChild(w[0])}z.insertAfter(n[0],i[0])}for(f in A)A[f]._4e_clearMarkers(A,
true)}}}function d(f,r){var n=parseInt(r._4e_style(this.indentCssProperty),10);if(isNaN(n))n=0;n+=(this.type=="indent"?1:-1)*this.indentOffset;if(n<0)return false;n=Math.max(n,0);n=Math.ceil(n/this.indentOffset)*this.indentOffset;r.css(this.indentCssProperty,n?n+this.indentUnit:"");r[0].style.cssText===""&&r[0].removeAttribute("style");return true}function h(f){h.superclass.constructor.call(this,f);f=this.get("editor").toolBarDiv;this.el=new e({container:f,contentCls:this.get("contentCls"),title:this.get("title")});
this.indentCommand=new g(this.get("type"));this._init()}var k=v.whitespaces(true),a=v.bookmark(false,true);x.augment(g,{exec:function(f){for(var r=f.getSelection(),n=r&&r.getRanges()[0],A=n.startContainer,q=n.endContainer,j=n.getCommonAncestor();j&&!(j[0].nodeType==m.NODE_ELEMENT&&s[j._4e_name()]);)j=j.parent();if(j&&A[0].nodeType==m.NODE_ELEMENT&&A._4e_name()in s){A=new v(n);A.evaluator=c;n.startContainer=A.next()}if(j&&q[0].nodeType==m.NODE_ELEMENT&&q._4e_name()in s){A=new v(n);A.evaluator=c;n.endContainer=
A.previous()}q=r.createBookmarks(true);if(j){for(A=j._4e_first();A&&A[0]&&A._4e_name()!="li";)A=A.next();var y=n.startContainer;(A[0]==y[0]||A._4e_contains(y))&&d.call(this,f,j)||b.call(this,f,n,j)}else{n=n.createIterator();n.enforceRealBlocks=true;for(n.enlargeBr=true;j=n.getNextParagraph();)d.call(this,f,j)}r.selectBookmarks(q)}});var e=o.TripleButton;h.ATTRS={type:{},contentCls:{},editor:{}};x.extend(h,x.Base,{_init:function(){var f=this.get("editor"),r=this.el;r.on("offClick",this.exec,this);
this.get("type")=="outdent"?f.on("selectionChange",this._selectionChange,this):r.set("state",e.OFF);o.Utils.sourceDisable(f,this)},disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.OFF)},exec:function(){var f=this.get("editor"),r=this;f.fire("save");setTimeout(function(){r.indentCommand.exec(f);f.fire("save");f.notifySelectionChange()},10)},_selectionChange:function(f){this.get("editor");this.get("type");var r=f.path,n=r.blockLimit;f=this.el;if(r.contains(s))f.set("state",
e.OFF);else(r=r.block||n)&&r._4e_style(this.indentCommand.indentCssProperty)?f.set("state",e.OFF):f.set("state",e.DISABLED)}});o.Indent=h}();p.addPlugin(function(){p.addCommand("outdent",new o.Indent({editor:p,title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-outdent",type:"outdent"}));p.addCommand("indent",new o.Indent({editor:p,title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",contentCls:"ke-toolbar-indent",type:"indent"}))})});
KISSY.Editor.add("justify",function(p){var o=KISSY.Editor,s=KISSY,x=o.TripleButton;o.Justify||function(){function v(u,l,m,g){this.editor=u;this.v=l;this.contentCls=g;this.title=m;this._init()}var z=/(-moz-|-webkit-|start|auto)/i;s.augment(v,{_init:function(){var u=this.editor;this.el=new x({contentCls:this.contentCls,title:this.title,container:u.toolBarDiv});u.on("selectionChange",this._selectionChange,this);this.el.on("offClick",this._effect,this);o.Utils.sourceDisable(u,this)},disable:function(){this.el.set("state",
x.DISABLED)},enable:function(){this.el.set("state",x.OFF)},_effect:function(){var u=this.editor,l=u.getSelection(),m=this.el.get("state");if(l){var g=l.createBookmarks(),c=l.getRanges(),b,d;u.fire("save");for(var h=c.length-1;h>=0;h--){b=c[h].createIterator();for(b.enlargeBr=true;d=b.getNextParagraph();){d.removeAttr("align");m==x.OFF?d.css("text-align",this.v):d.css("text-align","")}}u.notifySelectionChange();l.selectBookmarks(g);u.fire("save")}},_selectionChange:function(u){var l=this.el;u=u.path;
u=u.block||u.blockLimit;if(!u||u._4e_name()==="body")l.set("state",x.OFF);else{u=u.css("text-align").replace(z,"");u==this.v||!u&&this.v=="left"?l.set("state",x.ON):l.set("state",x.OFF)}}});o.Justify=v}();p.addPlugin(function(){new o.Justify(p,"left","\u5de6\u5bf9\u9f50 ","ke-toolbar-alignleft");new o.Justify(p,"center","\u5c45\u4e2d\u5bf9\u9f50 ","ke-toolbar-aligncenter");new o.Justify(p,"right","\u53f3\u5bf9\u9f50 ","ke-toolbar-alignright")})});
KISSY.Editor.add("link",function(p){var o=KISSY,s=o.Editor;s.Link||function(){function x(b){this.editor=b;this._init()}function v(b){return b._4e_ascendant(function(d){return d._4e_name()==="a"&&!!d.attr("href")},true)}function z(b,d){var h={href:b.attr("href"),_ke_saved_href:b.attr(m)};if(b._4e_hasAttribute("target"))h.target=b.attr("target");h=new l(c,h);d.fire("save");h.remove(d.document);d.fire("save")}var u=s.TripleButton,l=s.Style,m="_ke_saved_href",g=s.BubbleView,c={element:"a",attributes:{href:"#(href)",
_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};x.link_Style=c;x._ke_saved_href=m;x.checkLink=v;g.register({pluginName:"link",func:v,init:function(){var b=this,d=b.el;d.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var h=d.one(".ke-bubbleview-url"),k=d.one(".ke-bubbleview-change");d=d.one(".ke-bubbleview-remove");k._4e_unselectable();
h._4e_unselectable();d._4e_unselectable();k.on("click",function(a){b._plugin.show();a.halt()});d.on("click",function(a){var e=b._plugin.editor;z(b._selectedEl,e);e.notifySelectionChange();a.halt()});b.on("afterVisibleChange",function(){var a=b._selectedEl;if(a){a=a.attr(m)||a.attr("href");h.html(a);h.attr("href",a)}})}});x._removeLink=z;o.augment(x,{_init:function(){var b=this.editor;this.el=new u({container:b.toolBarDiv,contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5 "});this.el.on("offClick",this.show,
this);g.attach({pluginName:"link",pluginInstance:this});s.Utils.sourceDisable(b,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},show:function(){this.editor.useDialog("link/dialog",function(b){b.show()})}});s.Link=x}();p.addPlugin(function(){new s.Link(p)})});
KISSY.Editor.add("list",function(p){var o=KISSY.Editor,s={ol:1,ul:1},x=["ol","ul"],v=KISSY,z=o.RANGE,u=o.ElementPath,l=o.Walker,m=o.NODE,g=v.UA,c=v.Node,b=v.DOM;o.List||function(){function d(f){this.type=f}function h(f){h.superclass.constructor.call(this,f);f=this.get("editor").toolBarDiv;this.el=new e({contentCls:this.get("contentCls"),title:this.get("title"),container:f});this.listCommand=new d(this.get("type"));this.listCommand.state=this.get("status");this._init()}var k={listToArray:function(f,
r,n,A,q){if(!s[f._4e_name()])return[];A||(A=0);n||(n=[]);for(var j=0,y=f[0].childNodes.length;j<y;j++){var t=new c(f[0].childNodes[j]);if(t._4e_name()=="li"){var B={parent:f,indent:A,element:t,contents:[]};if(q)B.grandparent=q;else{B.grandparent=f.parent();if(B.grandparent&&B.grandparent._4e_name()=="li")B.grandparent=B.grandparent.parent()}r&&t._4e_setMarker(r,"listarray_index",n.length);n.push(B);for(var i=0,w=t[0].childNodes.length,C;i<w;i++){C=new c(t[0].childNodes[i]);C[0].nodeType==m.NODE_ELEMENT&&
s[C._4e_name()]?k.listToArray(C,r,n,A+1,B.grandparent):B.contents.push(C)}}}return n},arrayToList:function(f,r,n,A){n||(n=0);if(!f||f.length<n+1)return null;for(var q=f[n].parent[0].ownerDocument,j=q.createDocumentFragment(),y=null,t=n,B=Math.max(f[n].indent,0),i=null;;){var w=f[t];if(w.indent==B){if(!y||f[t].parent._4e_name()!=y._4e_name()){y=f[t].parent._4e_clone(false,true);j.appendChild(y[0])}i=y[0].appendChild(w.element._4e_clone(false,true)[0]);for(var C=0;C<w.contents.length;C++)i.appendChild(w.contents[C]._4e_clone(true,
true)[0]);t++}else if(w.indent==Math.max(B,0)+1){t=k.arrayToList(f,null,t,A);i.appendChild(t.listNode);t=t.nextIndex}else if(w.indent==-1&&!n&&w.grandparent){if(s[w.grandparent._4e_name()])i=w.element._4e_clone(false,true)[0];else if(w.grandparent._4e_name()!="td"){i=q.createElement(A);w.element._4e_copyAttributes(new c(i))}else i=q.createDocumentFragment();for(C=0;C<w.contents.length;C++){y=w.contents[C]._4e_clone(true,true);i.nodeType==m.NODE_DOCUMENT_FRAGMENT&&w.element._4e_copyAttributes(new c(y));
i.appendChild(y[0])}if(i.nodeType==m.NODE_DOCUMENT_FRAGMENT&&t!=f.length-1){i.lastChild&&i.lastChild.nodeType==m.NODE_ELEMENT&&i.lastChild.getAttribute("type")=="_moz"&&b._4e_remove(i.lastChild);b._4e_appendBogus(i)}if(i.nodeType==m.NODE_ELEMENT&&b._4e_name(i)==A&&i.firstChild){b._4e_trim(i);y=i.firstChild;if(y.nodeType==m.NODE_ELEMENT&&b._4e_isBlockBoundary(y)){y=q.createDocumentFragment();b._4e_moveChildren(i,y);i=y}}y=b._4e_name(i);if(!g.ie&&(y=="div"||y=="p"))b._4e_appendBogus(i);j.appendChild(i);
y=null;t++}else return null;if(f.length<=t||Math.max(f[t].indent,0)<B)break}if(r)for(f=new c(j.firstChild);f&&f[0];){f[0].nodeType==m.NODE_ELEMENT&&f._4e_clearMarkers(r,true);f=f._4e_nextSourceNode()}return{listNode:j,nextIndex:t}}},a=/^h[1-6]$/;d.prototype={changeListType:function(f,r,n,A){var q=k.listToArray(r.root,n),j=[];for(f=0;f<r.contents.length;f++){var y=r.contents[f];y=y._4e_ascendant("li",true);if(!(!y||!y[0]||y.data("list_item_processed"))){j.push(y);y._4e_setMarker(n,"list_item_processed",
true)}}y=new c(r.root[0].ownerDocument.createElement(this.type));for(f=0;f<j.length;f++){var t=j[f].data("listarray_index");q[t].parent=y}n=k.arrayToList(q,n,null,"p");var B;q=n.listNode.childNodes.length;for(f=0;f<q&&(B=new c(n.listNode.childNodes[f]));f++)B._4e_name()==this.type&&A.push(B);b.insertBefore(n.listNode,r.root[0]);r.root._4e_remove()},createList:function(f,r,n){var A=r.contents;f=r.root[0].ownerDocument;var q=[];if(A.length==1&&A[0][0]===r.root[0]){var j=new c(f.createElement("div"));
A[0][0].nodeType!=m.NODE_TEXT&&A[0]._4e_moveChildren(j);A[0][0].appendChild(j[0]);A[0]=j}r=r.contents[0].parent();for(j=0;j<A.length;j++)r=r._4e_commonAncestor(A[j].parent());for(j=0;j<A.length;j++)for(var y=A[j],t;t=y.parent();){if(t[0]===r[0]){q.push(y);break}y=t}if(!(q.length<1)){A=new c(q[q.length-1][0].nextSibling);j=new c(f.createElement(this.type));for(n.push(j);q.length;){n=q.shift();y=new c(f.createElement("li"));if(a.test(n._4e_name()))y[0].appendChild(n[0]);else{n._4e_copyAttributes(y);
n._4e_moveChildren(y);n._4e_remove()}j[0].appendChild(y[0]);g.ie||y._4e_appendBogus()}A[0]?b.insertBefore(j[0],A[0]):r[0].appendChild(j[0])}},removeList:function(f,r,n){function A(C){if((i=new c(B[C?"firstChild":"lastChild"]))&&!(i[0].nodeType==m.NODE_ELEMENT&&i._4e_isBlockBoundary())&&(w=r.root[C?"_4e_previous":"_4e_next"](l.whitespaces(true)))&&!(i[0].nodeType==m.NODE_ELEMENT&&w._4e_isBlockBoundary({br:1})))b[C?"insertBefore":"insertAfter"](f.document.createElement("br"),i[0])}for(var q=k.listToArray(r.root,
n),j=[],y=0;y<r.contents.length;y++){var t=r.contents[y];t=t._4e_ascendant("li",true);if(!(!t||t.data("list_item_processed"))){j.push(t);t._4e_setMarker(n,"list_item_processed",true)}}t=null;for(y=0;y<j.length;y++){t=j[y].data("listarray_index");q[t].indent=-1;t=t}for(y=t+1;y<q.length;y++)if(q[y].indent>Math.max(q[y-1].indent,0)){j=q[y-1].indent+1-q[y].indent;for(t=q[y].indent;q[y]&&q[y].indent>=t;){q[y].indent+=j;y++}y--}var B=k.arrayToList(q,n,null,"p").listNode,i,w;A(true);A(undefined);b.insertBefore(B,
r.root);r.root._4e_remove()},exec:function(f){var r=f.getSelection(),n=r&&r.getRanges();if(!(!n||n.length<1)){for(var A=r.createBookmarks(true),q=[],j={};n.length>0;){var y=n.shift(),t=y.getBoundaryNodes(),B=t.startNode,i=t.endNode;B[0].nodeType==m.NODE_ELEMENT&&B._4e_name()=="td"&&y.setStartAt(t.startNode,z.POSITION_AFTER_START);i[0].nodeType==m.NODE_ELEMENT&&i._4e_name()=="td"&&y.setEndAt(t.endNode,z.POSITION_BEFORE_END);y=y.createIterator();for(y.forceBrBreak=false;t=y.getNextParagraph();)if(!t.data("list_block")){t._4e_setMarker(j,
"list_block",1);i=new u(t);var w=i.elements,C=null,D=false,E=i.blockLimit,F;for(B=w.length-1;B>=0&&(F=w[B]);B--)if(s[F._4e_name()]&&E.contains(F)){E.removeData("list_group_object");if(B=F.data("list_group_object"))B.contents.push(t);else{B={root:F,contents:[t]};q.push(B);F._4e_setMarker(j,"list_group_object",B)}D=true;break}if(!D){i=E||i.block;if(i.data("list_group_object"))i.data("list_group_object").contents.push(t);else{B={root:i,contents:[t]};i._4e_setMarker(j,"list_group_object",B);q.push(B)}}}}for(n=
[];q.length>0;){B=q.shift();if(this.state=="off")s[B.root._4e_name()]?this.changeListType(f,B,j,n):this.createList(f,B,n);else this.state=="on"&&s[B.root._4e_name()]&&this.removeList(f,B,j)}for(B=0;B<n.length;B++){C=n[B];var K=this;(f=function(M){var N=C[M?"_4e_previous":"_4e_next"](l.whitespaces(true));if(N&&N[0]&&N._4e_name()==K.type){N._4e_remove();N._4e_moveChildren(C,M?true:false)}})();f(true)}o.Utils.clearAllMarkers(j);r.selectBookmarks(A)}}};var e=o.TripleButton;h.ATTRS={editor:{},type:{},
contentCls:{}};v.extend(h,v.Base,{_init:function(){var f=this.get("editor");this.el.on("offClick onClick",this._change,this);f.on("selectionChange",this._selectionChange,this);o.Utils.sourceDisable(f,this)},disable:function(){this.el.set("state",e.DISABLED)},enable:function(){this.el.set("state",e.OFF)},_change:function(){var f=this.get("editor");this.get("type");var r=this.el;f.fire("save");this.listCommand.state=r.get("state");this.listCommand.exec(f);f.fire("save");f.notifySelectionChange()},_selectionChange:function(f){this.get("editor");
var r=this.get("type"),n=f.path,A;f=this.el;var q=n.blockLimit;n=n.elements;if(q){if(n)for(var j=0;j<n.length&&(A=n[j])&&A[0]!==q[0];j++){var y=v.indexOf(n[j]._4e_name(),x);if(y!==-1)if(x[y]===r){f.set("state",e.ON);return}else break}f.set("state",e.OFF)}}});o.ListUtils=k;o.List=h}();p.addPlugin(function(){new o.List({editor:p,title:"\u9879\u76ee\u5217\u8868",contentCls:"ke-toolbar-ul",type:"ul"});new o.List({editor:p,title:"\u7f16\u53f7\u5217\u8868",contentCls:"ke-toolbar-ol",type:"ol"})})});
KISSY.Editor.add("localStorage",function(){var p=KISSY,o=p.Editor,s;s=o.STORE="localStorage";if(!o.storeReady){o.storeReady=function(v){o.on("storeReady",v)};o.on("storeReady",function(){o.storeReady=function(v){v()};o.detach("storeReady")})}if(window[s])window[s]._ke||o.fire("storeReady");else{var x=o.Config.base+o.Utils.debugUrl("plugins/localStorage/swfstore.swf?rand="+ +new Date);window[s]=new o.FlashBridge({movie:x,methods:["setItem","removeItem","getValueOf"]});p.mix(window[s],{_ke:1,getItem:function(v){return this.getValueOf(v)}});
window[s].on("contentReady",function(){o.fire("storeReady")})}});
KISSY.Editor.add("maximize",function(p){var o=KISSY.Editor,s=KISSY,x=s.UA,v=s.Node,z=s.Event,u=o.TripleButton,l=s.DOM,m;if(!(x.gecko<1.92)){o.Maximize||function(){function g(c){this.editor=c;this._init()}l.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");g.init=function(){m=(new v("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>")).appendTo(document.body);g.init=null};s.augment(g,{_init:function(){var c=this.editor,b=
new u({container:c.toolBarDiv,title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"});this.el=b;b.on("offClick",this.maximize,this);b.on("onClick",this.restore,this);o.Utils.lazyRun(this,"_prepare","_real");this._toolBarDiv=c.toolBarDiv},restore:function(){var c=this,b=c.editor;c._resize&&z.remove(window,"resize",c._resize);c._saveEditorStatus();c._restoreState();c.el.boff();setTimeout(function(){c._restoreEditorStatus();b.notifySelectionChange();b.fire("restoreWindow")},30)},_restoreState:function(){var c=
document,b=this.editor,d=this._savedParents;if(d){for(var h=0;h<d.length;h++){var k=d[h];k.el.css("position",k.position)}this._savedParents=null}b.wrap.css({height:this.iframeHeight});l.css(c.body,{width:"",height:"",overflow:""});c.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:this.editorWrapWidth});m.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);c=this.el.el;c.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");
c.attr("title","\u5168\u5c4f");x.ie<8&&this._toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var c=this.editor,b=[],d=c.editorWrap;this.iframeHeight=c.wrap._4e_style("height");this.editorWrapWidth=d._4e_style("width");this.scrollLeft=l.scrollLeft();this.scrollTop=l.scrollTop();window.scrollTo(0,0);for(c=d.parent();c;){d=c.css("position");if(d!="static"){b.push({el:c,position:d});c.css("position","static")}c=c.parent()}this._savedParents=b;b=this.el.el;this.el.el.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
b.attr("title","\u53d6\u6d88\u5168\u5c4f");x.ie<8&&this._toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var c=this.editor;this.savedRanges=null;if(x.gecko&&c.iframeFocus)this.savedRanges=(c=c.getSelection())&&c.getRanges()},_restoreEditorStatus:function(){var c=this.editor,b=c.getSelection(),d=this.savedRanges;c.activateGecko();d&&b&&b.selectRanges(d);if(c.iframeFocus&&b)(c=b.getStartElement())&&c[0]&&c._4e_scrollIntoView();x.ie<8&&this.el.el.one("span").css("background-image","")},_maximize:function(c){var b=
document,d=this.editor,h=d.editorWrap,k=l.viewportHeight(),a=l.viewportWidth(),e=d.statusDiv?d.statusDiv[0].offsetHeight:0,f=d.toolBarDiv[0].offsetHeight;if(x.ie)b.body.style.overflow="hidden";else l.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";h.css({position:"absolute",zIndex:d.baseZIndex(o.zIndexManager.MAXIMIZE),width:a+"px"});m.css({zIndex:d.baseZIndex(o.zIndexManager.MAXIMIZE-5),height:k+"px",width:a+"px"});h.offset({left:0,top:0});m.css({left:0,
top:0});d.wrap.css({height:k-e-f+"px"});c!==true&&arguments.callee.call(this,true)},_real:function(){var c=this,b=c.editor;c._saveEditorStatus();c._saveSate();c._maximize();c._resize=c._resize||o.Utils.buffer(c._maximize,c,100);z.on(window,"resize",c._resize);c.el.set("state",u.ON);setTimeout(function(){c._restoreEditorStatus();b.notifySelectionChange();b.fire("maximizeWindow")},30)},_prepare:function(){g.init&&g.init()},maximize:function(){this._prepare()}});o.Maximize=g}();p.addPlugin(function(){new o.Maximize(p)})}});
KISSY.Editor.add("music",function(p){var o=KISSY.Editor,s=KISSY,x=s.DOM,v=s.UA,z=s.Event,u=o.Flash,l="ke_music",m=p.htmlDataProcessor,g=m&&m.dataFilter;g&&g.addRules({elements:{object:function(c){var b=c.attributes;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<c.children.length;b++)if(c.children[b].name=="embed"){if(!u.isFlashEmbed(c.children[b]))break;if(c.children[b].attributes.src.indexOf("niftyplayer.swf")!=-1)return m.createFakeParserElement(c,l,"music",true)}return null}for(b=
0;b<c.children.length;b++){var d=c.children[b];if(d.name=="param"&&d.attributes.name=="movie")if(d.attributes.value.indexOf("niftyplayer.swf")!=-1)return m.createFakeParserElement(c,l,"music",true)}},embed:function(c){if(!u.isFlashEmbed(c))return null;if(c.attributes.src.indexOf("niftyplayer.swf")!=-1)return m.createFakeParserElement(c,l,"music",true)}}},4);o.MusicInserter||function(){function c(k){c.superclass.constructor.apply(this,arguments);k.cfg.disableObjectResizing||z.on(k.document.body,v.ie?
"resizestart":"resize",function(a){x.hasClass(a.target,l)&&a.preventDefault()})}function b(k){return k._4e_name()==="img"&&!!k.hasClass(l)&&k}var d=["img."+l];s.extend(c,u,{_config:function(){this._cls=l;this._type="music";this._contentCls="ke-toolbar-music";this._tip="\u63d2\u5165\u97f3\u4e50";this._contextMenu=h;this._flashRules=d}});u.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",b);o.MusicInserter=c;var h={"\u97f3\u4e50\u5c5e\u6027":function(k){var a=k.getSelection();a=(a=a&&a.getStartElement())&&b(a);k=k._toolbars.music;a&&k.show(null,a)}}}();p.addPlugin(function(){new o.MusicInserter(p)})});
KISSY.Editor.add("overlay",function(){function p(){p.superclass.constructor.apply(this,arguments);this._init()}var o=KISSY,s=o.Editor,x=o.UA,v=s.focusManager,z=o.Node,u=o.Event,l=o.DOM,m,g,c={left:"-9999px",top:"-9999px"},b=s.baseZIndex(s.zIndexManager.LOADING);if(!s.SimpleOverlay){p.mask=function(d){if(!m){m=new p({el:new z("<div>"),cls:"ke-mask",focusMgr:false,draggable:false});m.el.css({width:"100%","background-color":"#000000",height:l.docHeight(),opacity:0.15})}d=d||b;m.el.css("z-index",d);m.show({left:0,
top:0})};p.unmask=function(){m&&m.hide()};p.loading=function(d){if(!g){g=new p({el:new z("<div>"),focusMgr:false,cls:"ke-loading",shortkey:false,draggable:false});g.el.css({opacity:0.15,border:0})}var h,k,a;if(d){a=d.offset();h=d[0].offsetWidth;k=d[0].offsetHeight;d=parseInt(d.css("z-index"))+1;g.el.css("background-attachment","scroll")}else{a={left:0,top:0};h="100%";k=l.docHeight();d=b;g.el.css("background-attachment","fixed")}g.el.css({width:h,height:k,"z-index":d});g.show(a);return g};p.unloading=
function(){g&&g.hide()};p.ATTRS={title:{value:""},width:{value:"500px"},height:{},cls:{},shortkey:{value:true},visible:{value:false},zIndex:{value:s.baseZIndex(s.zIndexManager.OVERLAY)},focusMgr:{value:true},mask:{value:false},draggable:{value:true}};o.extend(p,o.Base,{_init:function(){var d=this;d._createEl();var h=d.el;h.css("z-index",d.get("zIndex"));d.on("afterVisibleChange",function(k){if(k=k.newVal){typeof k=="boolean"?d.center():h.offset(k);d.fire("show")}else{h.css(c);d.fire("hide")}});if(d.get("focusMgr")){d._initFocusNotice();
d.on("afterVisibleChange",d._editorFocusMg,d)}d.on("afterVisibleChange",function(k){k.newVal&&d.get("shortkey")?d._register():d._unregister()});if(d.get("mask")){d.on("show",function(){p.mask(d.get("zIndex")-1)});d.on("hide",function(){p.unmask()})}d.on("afterZIndexChange",function(k){h.css("z-index",k.newVal)});s.Utils.lazyRun(this,"_prepareShow","_realShow")},_register:function(){u.on(document,"keydown",this._keydown,this)},_keydown:function(d){if(d.keyCode==27){this.hide();d.halt()}},_unregister:function(){u.remove(document,
"keydown",this._keydown,this)},_createEl:function(){var d=this,h=d.get("el");if(h){d.originalEl=h;if(!h[0].parentNode||h[0].parentNode.nodeType!=s.NODE.NODE_ELEMENT)h=(new z("<div class='ke-dialog'>")).append((new z("<div class='ke-dialog-wrapper'>")).append(h)).appendTo(document.body);else{var k=new z("<div class='ke-dialog'>");k.insertBefore(h);k.append((new z("<div class='ke-dialog-wrapper'>")).append(h));h=k}}else{h=(new z("<div class='ke-dialog' ><div class='ke-dialog-wrapper'><div class='ke-hd'><span class='ke-hd-title'>@title@</span><a class='ke-hd-x' href='#'><span class='ke-close'>X</span></a></div><div class='ke-bd'></div><div class='ke-ft'></div></div></div>".replace(/@title@/,
d.get("title")))).appendTo(document.body);k=h.one(".ke-hd");var a=d.get("height");d.body=h.one(".ke-bd");d.foot=h.one(".ke-ft");d._title=k.one("h1");h.one(".ke-hd-x").on("click",function(f){f.preventDefault();d.hide()});a&&d.body.css({height:a,overflow:"auto"});if(a=d.get("draggable")){var e={all:h,foot:d.foot,body:d.body,head:k};(a=a===true?k:e[a])&&new s.Drag({node:h,handlers:{id:a}})}}d.get("cls")&&h.addClass(d.get("cls"));d.get("width")&&h.css("width",d.get("width"));d.set("el",h);d.el=h;h.css(c)},
center:function(){var d=this.el,h=d.width(),k=d.height(),a=l.viewportWidth(),e=l.viewportHeight();h=(a-h)/2+l.scrollLeft();k=(e-k)/2+l.scrollTop();if(k-l.scrollTop()>200)k-=150;h=Math.max(h,l.scrollLeft());k=Math.max(k,l.scrollTop());d.css({left:h+"px",top:k+"px"})},_getFocusEl:function(){var d=this._focusEl;if(d)return d;return this._focusEl=d=(new z("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.el)},_initFocusNotice:function(){var d=
this,h=d._getFocusEl();h.on("focus",function(){d.fire("focus")});h.on("blur",function(){d.fire("blur")})},_editorFocusMg:function(d){var h=this._focusEditor;if(d.newVal){h=this._focusEditor=v.currentInstance();x.webkit||this._getFocusEl()[0].focus();if(x.ie&&h)if(d=h.document.selection.createRange())if(d.item&&d.item(0).ownerDocument==h.document){h=document.body.createTextRange();h.moveToElementText(this.el._4e_first()[0]);h.collapse(true);h.select()}}else h&&h.focus()},_prepareShow:function(){if(x.ie==
6){var d=new z("<iframe class='ke-dialog-iframe'></iframe>");d.css(o.mix({opacity:0}));d.insertBefore(this.el.one(".ke-dialog-wrapper"))}},loading:function(){return p.loading(this.el)},unloading:function(){p.unloading()},_realShow:function(d){this.set("visible",d||true)},show:function(d){this._prepareShow(d)},hide:function(){this.set("visible",false)}});s.Utils.lazyRun(p.prototype,"_prepareLoading","_realLoading");s.SimpleOverlay=p}});
KISSY.Editor.add("pagebreak",function(p){var o=KISSY,s=o.Editor,x=p.htmlDataProcessor,v=x&&x.dataFilter,z="ke_pagebreak",u="div";v&&v.addRules({elements:{div:function(l){var m=l.attributes;var g=(m=m&&m.style)&&l.children.length==1&&l.children[0];if((g=g&&g.name=="span"&&g.attributes.style)&&/page-break-after\s*:\s*always/i.test(m)&&/display\s*:\s*none/i.test(g))return x.createFakeParserElement(l,z,u)}}});s.PageBreak||function(){function l(b){var d=new g({container:b.toolBarDiv,title:"\u5206\u9875",contentCls:"ke-toolbar-pagebreak"});
d.on("offClick",function(){var h=new m(c,null,b.document);h=b.createFakeElement?b.createFakeElement(h,z,u,true,c):h;h=(new m("<div>",null,b.document)).append(h);b.insertElement(h)});this.el=d;s.Utils.sourceDisable(b,this)}var m=o.Node,g=s.TripleButton,c='<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>';o.augment(l,{disable:function(){this.el.set("state",g.DISABLED)},enable:function(){this.el.set("state",g.OFF)}});s.PageBreak=l}();p.addPlugin(function(){new s.PageBreak(p)})});
KISSY.Editor.add("preview",function(p){var o=KISSY.Editor,s=KISSY,x=o.TripleButton;o.Preview||function(){function v(z){this.editor=z;this._init()}s.augment(v,{_init:function(){this.el=new x({container:this.editor.toolBarDiv,title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"});this.el.on("offClick",this._show,this)},_show:function(){var z=this.editor,u=640,l=420,m=80;try{var g=window.screen;u=Math.round(g.width*0.8);l=Math.round(g.height*0.7);m=Math.round(g.width*0.1)}catch(c){}z=z._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,
"<body>\n"+z.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");u=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+u+",height="+l+",left="+m);u.document.open();u.document.write(z);u.document.close();u.focus()}});o.Preview=v}();p.addPlugin(function(){new o.Preview(p)})});
KISSY.Editor.add("progressbar",function(){function p(){p.superclass.constructor.apply(this,arguments);this._init()}var o=KISSY,s=o.Editor;if(!s.ProgressBar){var x=o.Node;o.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
p.ATTRS={container:{},width:{},height:{},progress:{value:0}};o.extend(p,o.Base,{destroy:function(){this.detach();this.el._4e_remove()},_init:function(){var v=this.get("height"),z=new x("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+v+";'></div>"),u=this.get("container");v=(new x("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(v)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(z);var l=(new x("<span class='ke-progressbar-title'>")).appendTo(z);
u&&z.appendTo(u);this.el=z;this._title=l;this._p=v;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(v){v=v.newVal;this._p.css("width",v+"%");this._title.html(v+"%")}});s.ProgressBar=p}});
KISSY.Editor.add("removeformat",function(p){function o(b){this.editor=b;this._init()}function s(b,d){for(var h=0;h<d.length;h++)b.removeAttr(d[h])}var x=KISSY.Editor,v=KISSY,z=x.RANGE,u=x.ElementPath,l=x.NODE,m=x.TripleButton,g="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s",c="class,style,lang,width,height,align,hspace,valign".split(",");g=RegExp("^(?:"+g.replace(/,/g,"|")+")$","i");v.augment(o,{_init:function(){var b=this.editor;this.el=new m({title:"\u6e05\u9664\u683c\u5f0f",
contentCls:"ke-toolbar-removeformat",container:b.toolBarDiv});this.el.on("offClick",this._remove,this);x.Utils.sourceDisable(b,this)},disable:function(){this.el.set("state",m.DISABLED)},enable:function(){this.el.set("state",m.OFF)},_remove:function(){var b=this.editor,d=g;d.lastIndex=0;var h=b.getSelection().getRanges();b.fire("save");for(var k=0,a;a=h[k];k++)if(!a.collapsed){a.enlarge(z.ENLARGE_ELEMENT);var e=a.createBookmark(),f=e.startNode,r=e.endNode,n=function(A){for(var q=new u(A),j=q.elements,
y=1,t;t=j[y];y++){if(t._4e_equals(q.block)||t._4e_equals(q.blockLimit))break;d.test(t._4e_name())&&A._4e_breakParent(t)}};n(f);n(r);for(f=f._4e_nextSourceNode(true,l.NODE_ELEMENT);f;){if(f._4e_equals(r))break;n=f._4e_nextSourceNode(false,l.NODE_ELEMENT);f._4e_name()=="img"&&f.attr("_cke_realelement")||(d.test(f._4e_name())?f._4e_remove(true):s(f,c));f=n}a.moveToBookmark(e)}b.getSelection().selectRanges(h);b.fire("save")}});p.addPlugin(function(){new o(p)})});
KISSY.Editor.add("resize",function(p){var o=KISSY,s=o.Editor,x=o.Node;s.Resizer||function(){function v(u){this.editor=u;this._init()}var z=s.Draggable;o.augment(v,{_init:function(){var u=this.editor,l=u.statusDiv,m=new x("<div class='ke-resizer'></div>"),g=u.cfg.pluginConfig.resize||{};g=g.direction||["x","y"];m.appendTo(l);u.on("maximizeWindow",function(){m.css("display","none")});u.on("restoreWindow",function(){m.css("display","")});l=new z({node:m});var c=0,b=0,d=u.wrap,h=u.editorWrap;l.on("start",
function(){c=d.height();b=h.width()});l.on("move",function(k){var a=k.pageX-this.startMousePos.left;k=k.pageY-this.startMousePos.top;o.inArray("y",g)&&d.height(c+k);o.inArray("x",g)&&h.width(b+a)})}});s.Resizer=v}();p.addPlugin(function(){new s.Resizer(p)})});
KISSY.Editor.add("select",function(){function p(l){p.superclass.constructor.call(this,l);this._init()}var o=KISSY,s=o.Node,x=o.Event,v=o.DOM,z=o.Editor;if(!z.Select){p.DISABLED=0;p.ENABLED=1;var u=z.XHTML_DTD;p.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var l=this.el.parent();l;){var m=l._4e_name();if(u[m]&&u[m].div)return l;l=l.parent()}return new s(document.body)}},state:{value:1}};p.decorate=
function(l){for(var m=l.width(),g=[],c=l.all("option"),b=0;b<c.length;b++){var d=c[b];g.push({name:v.html(d),value:v.attr(d,"value")})}return new p({width:m+"px",el:l,items:g,cls:"ke-combox",value:l.val()})};o.extend(p,o.Base,{_init:function(){var l=this.get("container"),m=this.get("el"),g=new s("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
c=this.get("title")||"",b=this.get("cls"),d=g.one(".ke-select-text"),h=g.one(".ke-select-text-inner");g.one(".ke-select-drop");this.get("value")!==undefined?h.html(this._findNameByV(this.get("value"))):h.html(c);d.css("width",this.get("width"));g._4e_unselectable();c&&g.attr("title",c);b&&g.addClass(b);if(m)m[0].parentNode.replaceChild(g[0],m[0]);else l&&g.appendTo(l);g.on("click",this._click,this);this.el=g;this.title=h;this._focusA=g.one("a.ke-select");z.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(l){var m=this.get("title")||"",g=this.get("items");if(this.get("showValue"))return l||m;for(var c=0;c<g.length;c++){var b=g[c];if(b.value==l){m=b.name;break}}return m},_valueChange:function(l){this.title.html(this._findNameByV(l.newVal))},_itemsChange:function(l){l=l.newVal;var m=this._selectList;m.html("");if(l)for(var g=0;g<l.length;g++){var c=l[g];(new s("<a class='ke-select-menu-item' href='#' data-value='"+
c.value+"'>"+c.name+"</a>",c.attrs)).appendTo(m)._4e_unselectable()}this.as=m.all("a")},val:function(l){if(l!==undefined){this.set("value",l);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var l=this,m=l.el,g=l.get("popUpWidth"),c=l._focusA,b=new s("<div onmousedown='return false;'></div>");b.appendTo(l.get("menuContainer"));var d=new z.SimpleOverlay({el:b,cls:"ke-menu",width:g?g:m.width(),zIndex:z.baseZIndex(z.zIndexManager.SELECT),
focusMgr:false});g=l.get("items");l.menu=d;x.on(window,"resize",l._resize,l);l.get("title")&&(new s("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+l.get("title")+"</div>")).appendTo(b);l._selectList=(new s("<div>")).appendTo(b);l._itemsChange({newVal:g});d.on("show",function(){c.addClass("ke-select-active")});d.on("hide",function(){c.removeClass("ke-select-active")});x.on([document,l.get("doc")],"click",function(h){m._4e_contains(h.target)||d.hide()});b.on("click",l._select,
l);l.as=l._selectList.all("a");x.on(b[0],"mouseenter",function(){l.as.removeClass("ke-menu-selected")});l.on("afterItemsChange",l._itemsChange,l)},_stateChange:function(l){var m=this.el;l.newVal==1?m.removeClass("ke-select-disabled"):m.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(l){l.halt();var m=this.menu,g=m.el;if(l=(new s(l.target))._4e_ascendant(function(d){return g._4e_contains(d)&&d._4e_name()=="a"},true)){var c=
this.get("value"),b=l.attr("data-value");this.set("value",b);this.fire("click",{newVal:b,prevVal:c,name:l.html()});m.hide()}},_real:function(){var l=this.el,m=l.offset(),g=o.clone(m),c=this.menu.el.height(),b=this.menu.el.width(),d=v.scrollTop(),h=v.scrollLeft(),k=v.viewportHeight(),a=v.viewportWidth();a=h+a-60;k=d+k;var e=m.top+(l.height()-2);l=m.left+l.width()-2;var f=this.get("align"),r=f[0];if(f[1]=="b"){m.top=e;if(m.top+c>k&&g.top-d>k-e)m.top=g.top-c}else{m.top=g.top-c;if(m.top<d&&g.top-d<k-
e)m.top=e}if(r=="l"){if(m.left+b>a&&l-h>a-g.left)m.left=l-b}else{m.left=l-b;if(m.left<h&&l-h<a-g.left)m.left=g.left}this.menu.show(m)},_click:function(l){l.preventDefault();l=this.el;var m=this.get("value");if(!l.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();m&&this.menu&&this.as.each(function(g){g.attr("data-value")==m?g.addClass("ke-menu-selected"):g.removeClass("ke-menu-selected")})}}});z.Select=p}});
KISSY.Editor.add("separator",function(p){p.addPlugin(function(){(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(p.toolBarDiv)})});
KISSY.Editor.add("smiley",function(p){var o=KISSY.Editor,s=KISSY,x=s.DOM,v=s.Event,z=s.Node,u=o.SimpleOverlay,l=o.TripleButton;o.Smiley||function(){function m(b){this.editor=b;this._init()}x.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',"smiley");
for(var g="<div class='ke-smiley-sprite'>",c=0;c<=98;c++)g+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+c+".gif'></a>";g+="</div>";s.augment(m,{_init:function(){var b=this.editor;this.el=new l({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",container:b.toolBarDiv});this.el.on("offClick onClick",this._show,this);o.Utils.lazyRun(this,"_prepare","_real");o.Utils.sourceDisable(b,this)},disable:function(){this.el.set("state",l.DISABLED)},enable:function(){this.el.set("state",l.OFF)},
_hidePanel:function(b){var d=this.el.el;b=b.target;var h=this.smileyWin;d._4e_equals(b)||d._4e_contains(b)||h.hide()},_selectSmiley:function(b){b.halt();var d=this.editor;b=b.target;var h;if(x._4e_name(b)=="a"&&(h=x.attr(b,"data-icon"))){h=new z("<img class='ke_smiley'alt='' src='"+h+"'/>",null,d.document);d.insertElement(h);this.smileyWin.hide()}},_prepare:function(){var b=this.el,d=this.editor;this.smileyPanel=new z(g);var h=this.smileyWin=new u({el:this.smileyPanel,width:"297px",zIndex:d.baseZIndex(o.zIndexManager.POPUP_MENU),
focusMgr:false,mask:false});h.on("show",b.bon,b);h.on("hide",b.boff,b);this.smileyPanel.on("click",this._selectSmiley,this);v.on(document,"click",this._hidePanel,this);v.on(d.document,"click",this._hidePanel,this)},_real:function(){var b=this.el.el.offset();b.top+=this.el.el.height()+5;if(b.left+this.smileyPanel.width()>x.viewportWidth()-60)b.left=x.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.show(b)},_show:function(b){var d=this.smileyWin;d&&d.get("visible")?d.hide():this._prepare(b)}});
o.Smiley=m}();p.addPlugin(function(){new o.Smiley(p)})});
KISSY.Editor.add("sourcearea",function(p){var o=KISSY.Editor,s=KISSY,x=o.TripleButton;if(!(s.UA.gecko<1.92)){o.SourceArea||function(){function v(l){this.editor=l;this._init()}var z=o.SOURCE_MODE,u=o.WYSIWYG_MODE;s.augment(v,{_init:function(){var l=this.editor;var m=this.el=new x({container:l.toolBarDiv,title:"\u6e90\u7801",contentCls:"ke-toolbar-source"});m.on("offClick",this._show,this);m.on("onClick",this._hide,this);l.on("sourcemode",function(){m.bon()});l.on("wysiwygmode",function(){m.boff()})},_show:function(){this.editor.execCommand("sourceAreaSupport",
z);this.el.bon()},_hide:function(){var l=this.el;this.editor.execCommand("sourceAreaSupport",u);l.boff()}});o.SourceArea=v}();p.addPlugin(function(){new o.SourceArea(p)})}});
KISSY.Editor.add("sourcearea/support",function(p){var o=KISSY,s=o.Editor,x=o.UA;s.SourceAreaSupport||function(){function v(){var l=this.mapper={};l[z]=this._show;l[u]=this._hide}var z=s.SOURCE_MODE,u=s.WYSIWYG_MODE;o.augment(v,{exec:function(l,m){var g=this.mapper;g[m]&&g[m].call(this,l)},_show:function(l){l.textarea.val(l.getData(true));this._showSource(l);l.fire("sourcemode")},_showSource:function(l){var m=l.textarea,g=l.iframe;m.css("display","");g.css("display","none");x.ie<8&&m.css("height",
l.wrap.css("height"));m[0].focus()},_hideSource:function(l){var m=l.textarea;l.iframe.css("display","");m.css("display","none")},_hide:function(l){var m=l.textarea;this._hideSource(l);l.fire("save");l.setData(m.val());l.fire("wysiwygmode");l.fire("save");x.gecko&&l.activateGecko()}});s.SourceAreaSupport=new v}();p.addPlugin(function(){p.addCommand("sourceAreaSupport",s.SourceAreaSupport)})});
KISSY.Editor.add("table",function(p,o){var s=KISSY,x=s.Editor,v=s.Node,z=x.Walker,u=s.UA,l=x.NODE,m=x.TripleButton,g=x.ContextMenu,c=["tr","th","td","tbody","table"],b=s.trim,d;d=(u.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th",
"{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border");var h=p.htmlDataProcessor,k=h&&h.dataFilter;h=h&&h.htmlFilter;k&&k.addRules({elements:{table:function(a){a=a.attributes;var e=a["class"],f=parseInt(a.border,10);if(!f||f<=0)a["class"]=(e||"")+" ke_show_border"}}});h&&h.addRules({elements:{table:function(a){a=a.attributes;var e=a["class"];if(e)a["class"]=b(e.replace("ke_show_border","").replace(/\s{2}/," "))}}});x.TableUI||function(){function a(t){this.editor=t;t._toolbars=
t._toolbars||{};t._toolbars.table=this;this._init()}function e(t){function B(M){if(!(C.length>0))if(M[0].nodeType==l.NODE_ELEMENT&&j.test(M._4e_name())&&!M.data("selected_cell")){M._4e_setMarker(D,"selected_cell",true);C.push(M)}}for(var i=t.createBookmarks(),w=t.getRanges(),C=[],D={},E=0;E<w.length;E++){var F=w[E];if(F.collapsed){F=F.getCommonAncestor();(F=F._4e_ascendant("td",true)||F._4e_ascendant("th",true))&&C.push(F)}else{F=new z(F);var K;for(F.guard=B;K=F.next();)if((K=K.parent())&&j.test(K._4e_name())&&
!K.data("selected_cell")){K._4e_setMarker(D,"selected_cell",true);C.push(K)}}}x.Utils.clearAllMarkers(D);t.selectBookmarks(i);return C}function f(t,B){var i=t.getStartElement()._4e_ascendant("tr");if(i){var w=i._4e_clone(true);w.insertBefore(i);i=(B?w[0]:i[0]).cells;for(w=0;w<i.length;w++){i[w].innerHTML="";u.ie||(new v(i[w]))._4e_appendBogus()}}}function r(t){if(t instanceof x.Selection){var B=e(t),i=B.length;t=[];for(var w,C,D=0;D<i;D++){var E=B[D].parent(),F=E[0].rowIndex;!D&&(w=F-1);t[F]=E;D==
i-1&&(C=F+1)}D=E._4e_ascendant("table");w=new v(C<D[0].rows.length&&D[0].rows[C]||w>0&&D[0].rows[w]||D[0].parentNode);for(D=t.length;D>=0;D--)t[D]&&r(t[D]);return w}else if(t instanceof v){D=t._4e_ascendant("table");D[0].rows.length==1?D._4e_remove():t._4e_remove()}return 0}function n(t,B){var i=t.getStartElement();if(i=i._4e_ascendant("td",true)||i._4e_ascendant("th",true))for(var w=i._4e_ascendant("table"),C=i[0].cellIndex,D=0;D<w[0].rows.length;D++){var E=w[0].rows[D];if(!(E.cells.length<C+1)){i=
new v(E.cells[C].cloneNode(false));u.ie||i._4e_appendBogus();E=new v(E.cells[C]);B?i.insertBefore(E):i.insertAfter(E)}}}function A(t){if(t instanceof x.Selection){var B=e(t),i,w=[];t=B[0]&&B[0]._4e_ascendant("table");var C,D,E;C=0;for(D=B.length;C<D;C++)w.push(B[C][0].cellIndex);w.sort();C=1;for(D=w.length;C<D;C++)if(w[C]-w[C-1]>1){E=w[C-1]+1;break}E||(E=w[0]>0?w[0]-1:w[w.length-1]+1);w=t[0].rows;C=0;for(D=w.length;C<D;C++)if(i=w[C].cells[E])break;i=i?new v(i):t._4e_previous();for(E=B.length-1;E>=
0;E--)B[E]&&A(B[E]);return i}else if(t instanceof v){B=t._4e_ascendant("table");if(!B)return null;i=t[0].cellIndex;for(E=B[0].rows.length-1;E>=0;E--){t=new v(B[0].rows[E]);if(!i&&t[0].cells.length==1)r(t);else t[0].cells[i]&&t[0].removeChild(t[0].cells[i])}}return null}function q(t,B){var i=new x.Range(t[0].ownerDocument);if(!i.moveToElementEditablePosition(t,B?true:o)){i.selectNodeContents(t);i.collapse(B?false:true)}i.select(true)}a.showBorderClassName="ke_show_border";s.augment(a,{_init:function(){var t=
this.editor,B={};this.el=new m({contentCls:"ke-toolbar-table",title:"\u63d2\u5165\u8868\u683c",container:t.toolBarDiv});this.el.on("offClick",this._tableShow,this);for(var i in y)(function(w){B[w]=function(){t.fire("save");y[w](t);t.fire("save")}})(i);g.register({editor:t,rules:c,width:"120px",funcs:B});x.Utils.sourceDisable(t,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_tableShow:function(t,B,i){this.editor.useDialog("table/dialog",function(w){w.show(B,i)})}});var j=/^(?:td|th)$/,
y={"\u8868\u683c\u5c5e\u6027":function(t){var B=t.getSelection(),i=B&&B.getStartElement();if(B=i&&i._4e_ascendant("table",true)){t=t._toolbars.table;i=i._4e_ascendant(function(w){w=w._4e_name();return w=="td"||w=="th"},true);t._tableShow(null,B,i)}},"\u5220\u9664\u8868\u683c":function(t){var B=(t=t.getSelection())&&t.getStartElement();if(B=B&&B._4e_ascendant("table",true)){t.selectElement(B);var i=t.getRanges()[0];i.collapse();t.selectRanges([i]);t=B.parent();t[0].childNodes.length==1&&t._4e_name()!="body"&&t._4e_name()!="td"?t._4e_remove():
B._4e_remove()}},"\u5220\u9664\u884c ":function(t){t=t.getSelection();q(r(t),o)},"\u5220\u9664\u5217 ":function(t){t=t.getSelection();(t=A(t))&&q(t,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(t){t=t.getSelection();f(t,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(t){t=t.getSelection();f(t,o)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(t){t=t.getSelection();n(t,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(t){t=t.getSelection();n(t,o)}};x.TableUI=a}();p.addPlugin(function(){new x.TableUI(p);p.addCustomStyle(d)})});
KISSY.Editor.add("tabs",function(){function p(z){this.cfg=z;this._init()}var o=KISSY,s=o.Editor,x=o.DOM,v=o.Node;if(!s.Tabs){o.augment(p,o.EventTarget,{_init:function(){var z=this,u=z.cfg,l=u.tabs,m=u.contents.children("div"),g=l.children("li");l.on("click",function(c){c=new v(c.target);if(c=c._4e_ascendant(function(d){return d._4e_name()==="li"&&l._4e_contains(d)},true)){g.removeClass("ke-tab-selected");var b=c.attr("rel");c.addClass("ke-tab-selected");m.hide();x.show(m[o.indexOf(c[0],g)]);z.fire(b)}})},
getTab:function(z){var u=this.cfg,l=u.tabs;u=u.contents.children("div");l=l.children("li");for(var m=0;m<l.length;m++){var g=new v(l[m]),c=new v(u[m]);if(o.isNumber(z)&&z==m||o.isString(z)&&z==g.attr("rel"))return{tab:g,content:c}}},remove:function(z){z=this.getTab(z);z.tab.remove();z.content.remove()},_getActivate:function(){var z=this.cfg,u=z.tabs;z.contents.children("div");z=u.children("li");for(u=0;u<z.length;u++){var l=new v(z[u]);if(l.hasClass("ke-tab-selected"))return l.attr("rel")}},activate:function(z){if(arguments.length==
0)return this._getActivate();var u=this.cfg,l=u.tabs;u=u.contents.children("div");l.children("li").removeClass("ke-tab-selected");u.hide();l=this.getTab(z);l.tab.addClass("ke-tab-selected");l.content.show()}});s.Tabs=p}});
KISSY.Editor.add("templates",function(p){var o=KISSY.Editor,s=KISSY,x=s.Node,v=s.DOM,z=o.TripleButton,u=o.SimpleOverlay;o.TplUI||function(){function l(m){this.editor=m;this._init()}v.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto 0 auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");
s.augment(l,{_init:function(){var m=this.editor,g=new z({container:m.toolBarDiv,contentCls:"ke-toolbar-template",title:"\u6a21\u677f"});g.on("offClick",this._show,this);o.Utils.lazyRun(this,"_prepare","_real");this.el=g;o.Utils.sourceDisable(m,this)},disable:function(){this.el.set("state",z.DISABLED)},enable:function(){this.el.set("state",z.OFF)},_prepare:function(){for(var m=this.editor,g=m.cfg.pluginConfig.templates||[],c="<div class='ke-tpl'>",b=0;b<g.length;b++)c+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+
g[b].demo+"</a>";c+="</div>";this._initDialogOk=true;var d=new u({mask:true,title:"\u5185\u5bb9\u6a21\u677f"});d.body.html(c);d.body.all(".ke-tpl-list").on("click",function(h){h.halt();h=(new x(h.target))._4e_index();h!=-1&&m.insertHtml(g[h].html);d.hide()});this.ui=d},_real:function(){this.ui.show()},_show:function(){this._prepare()}});o.TplUI=l}();p.addPlugin(function(){new o.TplUI(p)})});
KISSY.Editor.add("undo",function(p){var o=KISSY,s=o.Editor,x=s.Utils.arrayCompare,v=o.UA,z=o.Event;s.UndoManager||function(){function u(h){var k=h._getRawData();h=k&&h.getSelection();this.contents=k;this.bookmarks=h&&h.createBookmarks2(true)}function l(h){this.history=[];this.index=-1;this.editor=h;this.bufferRunner=s.Utils.buffer(this.save,this,500);this._init()}function m(h,k,a,e){this.editor=h;this.title=a;this.text=k;this.contentCls=e;this._init()}o.augment(u,{equals:function(h){if(this.contents!=
h.contents)return false;var k=this.bookmarks;h=h.bookmarks;if(k||h){if(!k||!h||k.length!=h.length)return false;for(var a=0;a<k.length;a++){var e=k[a],f=h[a];if(e.startOffset!=f.startOffset||e.endOffset!=f.endOffset||!x(e.start,f.start)||!x(e.end,f.end))return false}}return true}});var g={16:1,17:1,18:1},c={37:1,38:1,39:1,40:1,33:1,34:1};o.augment(l,{_keyMonitor:function(){var h=this.editor;z.on([h.document,h.textarea],"keydown",function(k){var a=k.keyCode;if(!(a in c||a in g))if(a===90&&(k.ctrlKey||
k.metaKey)){h.fire("restore",{d:-1});k.halt()}else if(a===89&&(k.ctrlKey||k.metaKey)){h.fire("restore",{d:1});k.halt()}else h.fire("save",{buffer:1})})},_init:function(){var h=this,k=h.editor;k.on("save",function(a){if(k.getMode()==s.WYSIWYG_MODE)a.buffer?h.bufferRunner():h.save()});k.on("restore",function(a){k.getMode()==s.WYSIWYG_MODE&&h.restore(a)});h._keyMonitor()},save:function(){var h=this.history,k=this.index;h.length>k+1&&h.splice(k+1,h.length-k-1);var a=this.editor;k=h[h.length-1];var e=
new u(a);if(!k||!k.equals(e)){h.length===30&&h.shift();h.push(e);this.index=k=h.length-1;a.fire("afterSave",{history:h,index:k})}},restore:function(h){h=h.d;var k=this.history,a=this.editor,e=k[this.index+h];if(e){a._setRawData(e.contents);if(e.bookmarks)a.getSelection().selectBookmarks(e.bookmarks);else if(v.ie){e=a.document.body.createTextRange();e.collapse(true);e.select()}(e=a.getSelection())&&e.scrollIntoView();this.index+=h;a.fire("afterRestore",{history:k,index:this.index});a.notifySelectionChange()}}});
var b=s.TripleButton,d={redo:1,undo:-1};o.augment(m,{_init:function(){var h=this,k=h.editor;h.el=new b({contentCls:h.contentCls,title:h.title,container:k.toolBarDiv});var a=h.el;a.set("state",b.DISABLED);k.on("afterSave afterRestore",h._respond,h);a.on("offClick",function(){k.fire("restore",{d:d[h.text]})});s.Utils.sourceDisable(k,h)},disable:function(){this._saveState=this.el.get("state");this.el.set("state",b.DISABLED)},enable:function(){this.el.set("state",this._saveState)},_respond:function(h){this.updateUI(h.history,
h.index)},updateUI:function(h,k){var a=this.el,e=this.text;if(e=="undo")k>0?a.set("state",b.OFF):a.set("state",b.DISABLED);else if(e=="redo")k<h.length-1?a.set("state",b.OFF):a.set("state",b.DISABLED)}});s.UndoManager=l;s.RestoreUI=m}();p.addPlugin(function(){new s.UndoManager(p);new s.RestoreUI(p,"undo","\u64a4\u9500","ke-toolbar-undo");new s.RestoreUI(p,"redo","\u91cd\u505a","ke-toolbar-redo")})});
