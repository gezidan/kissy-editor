/*
 Constructor for kissy editor,dependency moved to independent module
 thanks to CKSource's intelligent work on CKEditor
 @author: yiminghe@gmail.com, lifesinger@gmail.com
 @version: 2.1.5
 @buildtime: 2011-01-05 18:09:51
*/
KISSY.add("editor",function(l){function p(k,o){var i=this;if(!(i instanceof p))return new p(k,o);if(l.isString(k))k=l.one(k);k=v._4e_wrap(k);o=o||{};o.pluginConfig=o.pluginConfig||{};i.cfg=o;o.pluginConfig=o.pluginConfig;i.cfg=o;l.app(i,l.EventTarget);var f=["htmldataprocessor","enterkey","clipboard"],d=r;i.use=function(b,g){b=b.split(",");if(!d)for(var t=0;t<f.length;t++){var h=f[t];l.inArray(h,b)||b.unshift(h)}i.ready(function(){l.use.call(i,b.join(","),function(){for(var c=0;c<b.length;c++)i.usePlugin(b[c]);
g&&g.call(i);if(!d){i.setData(k.val());if(o.focus)i.focus();else(c=i.getSelection())&&c.removeAllRanges();d=u}},{global:p})});return i};i.use=i.use;i.Config.base=p.Config.base;i.Config.debug=p.Config.debug;i.Config.componentJsName=q;i.init(k);return i}function q(){return"plugin-min.js?t=2011-01-05 18:09:51"}var v=l.DOM,u=true,r=false;l.app(p,l.EventTarget);p.Config.base=l.Config.base+"editor/plugins/";p.Config.debug=l.Config.debug;p.Config.componentJsName=q;l.Editor=p;l.Editor=p});
KISSY.Editor.add("utils",function(l){var p=null,q=KISSY,v=q.Node,u=q.DOM,r=q.UA,k=q.Event,o;o=r.ie?document.documentMode||r.ie:void 0;var i={debugUrl:function(f){f=f.replace(/-min\.(js|css)/i,".$1");l.Config.debug||(f=f.replace(/\.(js|css)/i,"-min.$1"));if(f.indexOf("?t")==-1){f+=f.indexOf("?")!=-1?"&":"?";f+="t=2011-01-05 18:09:51"}return l.Config.base+f},lazyRun:function(f,d,b){var g=f[d],t=f[b];f[d]=function(){g.apply(this,arguments);f[d]=f[b];return t.apply(this,arguments)}},getXY:function(f,
d,b,g){b=b.defaultView||b.parentWindow;f-=u.scrollLeft(b);d-=u.scrollTop(b);if(g)if(b!=(g.defaultView||g.parentWindow)&&b.frameElement){g=u._4e_getOffset(b.frameElement,g);f+=g.left;d+=g.top}return{left:f,top:d}},tryThese:function(){for(var f,d=0,b=arguments.length;d<b;d++){var g=arguments[d];try{f=g();break}catch(t){}}return f},arrayCompare:function(f,d){if(!f&&!d)return true;if(!f||!d||f.length!=d.length)return false;for(var b=0;b<f.length;b++)if(f[b]!==d[b])return false;return true},getByAddress:function(f,
d,b){f=f.documentElement;for(var g=0;f&&g<d.length;g++){var t=d[g];if(b)for(var h=-1,c=0;c<f.childNodes.length;c++){var a=f.childNodes[c];if(!(b===true&&a.nodeType==3&&a.previousSibling&&a.previousSibling.nodeType==3)){h++;if(h==t){f=a;break}}}else f=f.childNodes[t]}return f?new v(f):p},clearAllMarkers:function(f){for(var d in f)f[d]._4e_clearMarkers(f,true)},htmlEncodeAttr:function(f){return f.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(f){return f.replace(/^\s+/,
"")},rtrim:function(f){return f.replace(/\s+$/,"")},trim:function(f){return this.ltrim(this.rtrim(f))},mix:function(){for(var f={},d=0;d<arguments.length;d++)f=q.mix(f,arguments[d]);return f},isCustomDomain:function(){if(!r.ie)return false;var f=document.domain,d=window.location.hostname;return f!=d&&f!="["+d+"]"},duplicateStr:function(f,d){return Array(d+1).join(f)},throttle:function(f,d,b){b=b||150;if(b===-1)return function(){f.apply(d,arguments)};var g=(new Date).getTime();return function(){var t=
(new Date).getTime();if(t-g>b){g=t;f.apply(d,arguments)}}},buffer:function(f,d,b){b=b||0;var g=p;return function(){g&&clearTimeout(g);var t=arguments;g=setTimeout(function(){return f.apply(d,t)},b)}},isNumber:function(f){return/^\d+(.\d+)?$/.test(q.trim(f))},verifyInputs:function(f){for(var d=0;d<f.length;d++){var b=u._4e_wrap(f[d]),g=q.trim(b.val()),t=b.attr("data-verify");b=b.attr("data-warning");if(t&&!RegExp(t).test(g)){alert(b);return false}}return true},sourceDisable:function(f,d){f.on("sourcemode",
d.disable,d);f.on("wysiwygmode",d.enable,d)},resetInput:function(f){var d=f.attr("placeholder");if(d&&!r.webkit){f.addClass("ke-input-tip");f.val(d)}else r.webkit&&f.val("")},valInput:function(f,d){f.removeClass("ke-input-tip");f.val(d)},placeholder:function(f,d){f.attr("placeholder",d);if(!r.webkit){f.on("blur",function(){if(!q.trim(f.val())){f.addClass("ke-input-tip");f.val(d)}});f.on("focus",function(){f.removeClass("ke-input-tip");q.trim(f.val())==d&&f.val("")})}},clean:function(f){f=f[0]||f;
for(var d=q.makeArray(f.childNodes),b=0;b<d.length;b++){var g=d[b];g.nodeType==l.NODE.NODE_TEXT&&!q.trim(g.nodeValue)&&f.removeChild(g)}},htmlEncode:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(f){return!f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},equalsIgnoreCase:function(f,d){return f.toLowerCase()==d.toLowerCase()},normParams:function(f){f=q.clone(f);
for(var d in f)if(f.hasOwnProperty(d)){var b=f[d];if(q.isFunction(b))f[d]=b()}return f},doFormUpload:function(f,d,b){function g(){var s={responseText:"",responseXML:p};s.argument=f?f.argument:p;try{var n;if((n=r.ie?h.contentWindow.document:h.contentDocument||window.frames[t].document)&&n.body)s.responseText=n.body.innerHTML;s.responseXML=n&&n.XMLDocument?n.XMLDocument:n}catch(y){q.log(y)}k.remove(h,"load",g);f.callback&&f.callback(s);setTimeout(function(){u._4e_remove(h)},100)}var t=q.guid("form-upload-"),
h=document.createElement("iframe");h.id=t;h.name=t;h.className="ke-hidden";var c="document.open();"+(i.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(r.ie)h.src=r.ie?"javascript:void(function(){"+encodeURIComponent(c)+"}())":"";q.log("doFormUpload : "+h.src);document.body.appendChild(h);if(r.ie)document.frames[t].name=t;c=u._4e_unwrap(f.form);var a={target:c.target,method:c.method,encoding:c.encoding,enctype:c.enctype,action:c.action};c.target=t;c.method="POST";
c.enctype=c.encoding="multipart/form-data";if(b)c.action=b;var e;if(d){e=[];d=l.Utils.normParams(d);for(var j in d)if(d.hasOwnProperty(j)){b=document.createElement("input");b.type="hidden";b.name=j;b.value=d[j];c.appendChild(b);e.push(b)}}k.on(h,"load",g);c.submit();c.target=a.target;c.method=a.method;c.enctype=a.enctype;c.encoding=a.encoding;c.action=a.action;if(e){d=0;for(j=e.length;d<j;d++)u._4e_remove(e[d])}return h},extern:function(f,d){for(var b in d)f[b]=d[b]},map:function(f,d){for(var b=0;b<
f.length;b++)f[b]=d(f[b]);return f},ieEngine:o,preventFocus:function(f){r.ie?f._4e_unselectable():f.attr("onmousedown","return false;")},isFlashEmbed:function(f){f=f.attributes;return f.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(f.src||"")},addRes:function(){var f=this.__res=this.__res||[];f.push.apply(f,q.makeArray(arguments))},destroyRes:function(){for(var f=this.__res||[],d=0;d<f.length;d++){var b=f[d];if(q.isFunction(b))b();else{b.detach&&b.detach();b.destroy&&b.destroy();b.nodeType&&
b.remove&&b.remove()}}this.__res=[]}};l.Utils=i;l.Utils=i;r.ieEngine=i.ieEngine;i.extern(i,{debugUrl:i.debugUrl,lazyRun:i.lazyRun,getXY:i.getXY,tryThese:i.tryThese,arrayCompare:i.arrayCompare,getByAddress:i.getByAddress,clearAllMarkers:i.clearAllMarkers,htmlEncodeAttr:i.htmlEncodeAttr,ltrim:i.ltrim,rtrim:i.rtrim,trim:i.trim,mix:i.mix,isCustomDomain:i.isCustomDomain,duplicateStr:i.duplicateStr,buffer:i.buffer,isNumber:i.isNumber,verifyInputs:i.verifyInputs,sourceDisable:i.sourceDisable,resetInput:i.resetInput,
placeholder:i.placeholder,clean:i.clean,htmlEncode:i.htmlEncode,htmlDecode:i.htmlDecode,equalsIgnoreCase:i.equalsIgnoreCase,normParams:i.normParams,throttle:i.throttle,doFormUpload:i.doFormUpload,map:i.map})});
KISSY.Editor.add("dom",function(l){function p(c){return c.replace(/-(\w)/g,function(a,e){return e.toUpperCase()})}var q=KISSY,v=q.DOM,u=q.UA,r=q.Node,k=l.Utils,o={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};l.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};l.NODE=l.NODE;l.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};l.POSITION=l.POSITION;var i=l.NODE,f=l.POSITION,d={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},b={hr:1},g=function(c){return c[0]||c},t=function(c){if(c&&!c[0])return new r(c);return c},h={_4e_wrap:t,_4e_unwrap:g,_4e_equals:function(c,a){if(!c&&!a)return true;if(!c||!a)return false;c=g(c);a=g(a);
return c===a},_4e_isBlockBoundary:function(c,a){c=t(c);var e=q.mix(q.mix({},b),a||{});return d[c.css("display")]||e[c._4e_name()]},_4e_getWin:function(c){return c&&"scrollTo"in c&&c.document?c:c&&c.nodeType===9?c.defaultView||c.parentWindow:false},_4e_index:function(c){c=g(c);for(var a=c.parentNode.childNodes,e=0;e<a.length;e++)if(a[e]===c)return e;return-1},_4e_first:function(c,a){c=g(c);var e=c.firstChild;if((e=e&&new r(e))&&a&&!a(e))e=e._4e_next(a);return e},_4e_move:function(c,a,e){c=g(c);v._4e_remove(c);
a=g(a);e?a.insertBefore(c,a.firstChild):a.appendChild(c)},_4e_name:function(c){c=g(c);var a=c.nodeName.toLowerCase();if(u.ie)if((c=c.scopeName)&&c!="HTML")a=c.toLowerCase()+":"+a;return a},_4e_isIdentical:function(c,a){if(c._4e_name()!=a._4e_name())return false;var e=c[0].attributes,j=a[0].attributes,s=e.length,n=j.length;if(s!=n)return false;for(var y=0;y<s;y++){var x=e[y],A=x.name;if(x.specified&&c.attr(A)!=a.attr(A))return false}if(k.ieEngine<8)for(y=0;y<n;y++){x=j[y];A=x.name;if(x.specified&&
c.attr(A)!=a.attr(A))return false}return true},_4e_isEmptyInlineRemoveable:function(c){c=g(c).childNodes;for(var a=0,e=c.length;a<e;a++){var j=c[a],s=j.nodeType;if(!(s==i.NODE_ELEMENT&&j.getAttribute("_ke_bookmark")))if(s==i.NODE_ELEMENT&&!h._4e_isEmptyInlineRemoveable(j)||s==i.NODE_TEXT&&q.trim(j.nodeValue))return false}return true},_4e_moveChildren:function(c,a,e){c=g(c);a=a[0]||a;if(c!=a)if(e)for(;e=c.lastChild;)a.insertBefore(c.removeChild(e),a.firstChild);else for(;e=c.firstChild;)a.appendChild(c.removeChild(e))},
_4e_mergeSiblings:function(){function c(a,e,j){if(e[0]&&e[0].nodeType==i.NODE_ELEMENT){for(var s=[];e.attr("_ke_bookmark")||e._4e_isEmptyInlineRemoveable();){s.push(e);e=j?new r(e[0].nextSibling):new r(e[0].previousSibling);if(!e[0]||e[0].nodeType!=i.NODE_ELEMENT)return}if(a._4e_isIdentical(e)){for(var n=j?a[0].lastChild:a[0].firstChild;s.length;)s.shift()._4e_move(a,!j);e._4e_moveChildren(a,!j);e._4e_remove();n[0]&&n[0].nodeType==i.NODE_ELEMENT&&n._4e_mergeSiblings()}}}return function(a){if(a[0])if(o[a._4e_name()]||
a._4e_name()=="a"){c(a,new r(a[0].nextSibling),true);c(a,new r(a[0].previousSibling))}}}(),_4e_unselectable:u.gecko?function(c){c=g(c);c.style.MozUserSelect="none"}:u.webkit?function(c){c=g(c);c.style.KhtmlUserSelect="none"}:function(c){c=g(c);if(u.ie||u.opera){var a=0;c.setAttribute("unselectable","on");for(var e=c.getElementsByTagName("*");c=e[a++];)switch(c.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:c.setAttribute("unselectable","on")}}},_4e_getOffset:function(c,
a){c=g(c);var e,j=0;e=0;var s=c.ownerDocument.defaultView||c.ownerDocument.parentWindow,n=c.ownerDocument,y=n.documentElement;a=a||n;if(c.getBoundingClientRect){if(c!==n.body&&y!==c){e=c.getBoundingClientRect();j=e.left+(a===n?v.scrollLeft(s):0);e=e.top+(a===n?v.scrollTop(s):0)}if(a)if(s!=(a.defaultView||a.parentWindow)&&s.frameElement){s=h._4e_getOffset(s.frameElement,a);j+=s.left;e+=s.top}}return{left:j,top:e}},_4e_getFrameDocument:function(c){return(c=g(c))&&c.contentWindow.document},_4e_splitText:function(c,
a){c=g(c);var e=c.ownerDocument;if(!(!c||c.nodeType!=i.NODE_TEXT)){if(u.ie&&a==c.nodeValue.length){var j=e.createTextNode("");v.insertAfter(j,c);return new r(j)}j=new r(c.splitText(a));if(e.documentMode){e=e.createTextNode("");v.insertAfter(e,j[0]);v._4e_remove(e)}return j}},_4e_parents:function(c,a){c=t(c);var e=[];do e[a?"push":"unshift"](c);while(c=c.parent());return e},_4e_clone:function(c,a,e){c=g(c);c=c.cloneNode(a);if(!e){var j=function(s){if(s.nodeType==i.NODE_ELEMENT){s.removeAttribute("id");
s=s.childNodes;for(var n=0;n<s.length;n++)j(s[n])}};j(c)}return new r(c)},_4e_nextSourceNode:function(c,a,e,j){c=g(c);if(j&&!j.call){var s=j[0]||j;j=function(y){y=y[0]||y;return y!==s}}a=!a&&c.firstChild;var n=new r(c);if(!a){if(c.nodeType==i.NODE_ELEMENT&&j&&j(c,true)===false)return null;a=c.nextSibling}for(;!a&&(n=n.parent());){if(j&&j(n,true)===false)return null;a=n[0].nextSibling}if(!a)return null;a=v._4e_wrap(a);if(j&&j(a)===false)return null;if(e&&e!=a[0].nodeType)return a._4e_nextSourceNode(false,
e,j);return a},_4e_previousSourceNode:function(c,a,e,j){c=g(c);if(j&&!j.call){var s=j[0]||j;j=function(y){y=y[0]||y;return y!==s}}a=!a&&c.lastChild;var n=new r(c);if(!a){if(c.nodeType==i.NODE_ELEMENT&&j&&j(c,true)===false)return null;a=c.previousSibling}for(;!a&&(n=n.parent());){if(j&&j(n,true)===false)return null;a=n[0].previousSibling}if(!a)return null;a=v._4e_wrap(a);if(j&&j(a)===false)return null;if(e&&a[0].nodeType!=e)return a._4e_previousSourceNode(false,e,j);return a},_4e_commonAncestor:function(c,
a){if(c._4e_equals(a))return c;if(a[0].nodeType!=i.NODE_TEXT&&a.contains(c))return a;var e=c[0].nodeType==i.NODE_TEXT?c.parent():c;do if(e[0].nodeType!=i.NODE_TEXT&&e.contains(a))return e;while(e=e.parent());return null},_4e_ascendant:function(c,a,e){c=g(c);if(!e)c=c.parentNode;if(a&&!q.isFunction(a)){var j=a;a=function(s){return s._4e_name()==j}}for(;c&&c.nodeType!=9;){if(!a||a(new r(c))===true)return new r(c);c=c.parentNode}return null},_4e_hasAttribute:k.ieEngine<9?function(c,a){c=g(c);var e=c.attributes[a];
return!!(e&&e.specified)}:function(c,a){c=g(c);return c.hasAttribute(a)},_4e_hasAttributes:k.ieEngine<9?function(c){c=g(c);for(var a=c.attributes,e=0;e<a.length;e++){var j=a[e];switch(j.name){case "class":if(c.getAttribute("class"))return true;break;default:if(j.specified)return true}}return false}:function(c){c=g(c);u.gecko&&c.removeAttribute("_moz_dirty");return c.hasAttributes()},_4e_position:function(c,a){var e=g(c),j=g(a);if(e.compareDocumentPosition)return e.compareDocumentPosition(j);if(e==
j)return f.POSITION_IDENTICAL;if(e.nodeType==i.NODE_ELEMENT&&j.nodeType==i.NODE_ELEMENT){if(e.contains){if(e.contains(j))return f.POSITION_CONTAINS+f.POSITION_PRECEDING;if(j.contains(e))return f.POSITION_IS_CONTAINED+f.POSITION_FOLLOWING}if("sourceIndex"in e)return e.sourceIndex<0||j.sourceIndex<0?f.POSITION_DISCONNECTED:e.sourceIndex<j.sourceIndex?f.POSITION_PRECEDING:f.POSITION_FOLLOWING}e=c._4e_address();j=a._4e_address();for(var s=Math.min(e.length,j.length),n=0;n<=s-1;n++)if(e[n]!=j[n]){if(n<
s)return e[n]<j[n]?f.POSITION_PRECEDING:f.POSITION_FOLLOWING;break}return e.length<j.length?f.POSITION_CONTAINS+f.POSITION_PRECEDING:f.POSITION_IS_CONTAINED+f.POSITION_FOLLOWING},_4e_address:function(c,a){c=g(c);for(var e=[],j=c.ownerDocument.documentElement,s=c;s&&s!=j;){var n=s.parentNode,y=-1;if(n){for(var x=0;x<n.childNodes.length;x++){var A=n.childNodes[x];if(!(a&&A.nodeType==3&&A.previousSibling&&A.previousSibling.nodeType==3)){y++;if(A==s)break}}e.unshift(y)}s=n}return e},_4e_breakParent:function(c,
a){var e=new l.Range(c[0].ownerDocument);e.setStartAfter(c);e.setEndAfter(a);var j=e.extractContents();e.insertNode(c._4e_remove());c[0].parentNode.insertBefore(j,c[0].nextSibling)},_4e_style:function(c,a,e){c=t(c);if(e!==undefined)return c.css(a,e);c=g(c);return c.style[p(a)]},_4e_remove:function(c,a){var e=g(c),j=e.parentNode;if(j){if(a)for(var s;s=e.firstChild;)j.insertBefore(e.removeChild(s),e);j.removeChild(e)}return c},_4e_trim:function(c){v._4e_ltrim(c);v._4e_rtrim(c)},_4e_ltrim:function(c){c=
g(c);for(var a;a=c.firstChild;){if(a.nodeType==i.NODE_TEXT){var e=k.ltrim(a.nodeValue),j=a.nodeValue.length;if(e){if(e.length<j){(new r(a))._4e_splitText(j-e.length);c.removeChild(c.firstChild)}}else{c.removeChild(a);continue}}break}},_4e_rtrim:function(c){c=g(c);for(var a;a=c.lastChild;){if(a.type==i.NODE_TEXT){var e=k.rtrim(a.nodeValue),j=a.nodeValue.length;if(e){if(e.length<j){(new r(a))._4e_splitText(e.length);c.removeChild(c.lastChild)}}else{c.removeChild(a);continue}}break}if(!u.ie&&!u.opera)(a=
c.lastChild)&&a.nodeType==1&&a.nodeName.toLowerCase()=="br"&&a.parentNode.removeChild(a)},_4e_appendBogus:function(c){c=g(c);for(var a=c.lastChild;a&&a.nodeType==i.NODE_TEXT&&!q.trim(a.nodeValue);)a=a.previousSibling;if(!a||a.nodeType==i.NODE_TEXT||v._4e_name(a)!=="br"){a=u.opera?c.ownerDocument.createTextNode(""):c.ownerDocument.createElement("br");u.gecko&&a.setAttribute("type","_moz");c.appendChild(a)}},_4e_previous:function(c,a){var e=g(c),j;do j=(e=e.previousSibling)&&new r(e);while(j&&a&&!a(j));
return j},_4e_last:function(c,a){c=v._4e_wrap(c);var e=c[0].lastChild;if((e=e&&new r(e))&&a&&!a(e))e=e._4e_previous(a);return e},_4e_next:function(c,a){var e=g(c),j;do j=(e=e.nextSibling)&&new r(e);while(j&&a&&!a(j));return j},_4e_outerHtml:function(c){c=g(c);if(c.outerHTML)return c.outerHTML.replace(/<\?[^>]*>/,"");var a=c.ownerDocument.createElement("div");a.appendChild(c.cloneNode(true));return a.innerHTML},_4e_setMarker:function(c,a,e,j){c=v._4e_wrap(c);var s=c.data("list_marker_id")||c.data("list_marker_id",
q.guid()).data("list_marker_id"),n=c.data("list_marker_names")||c.data("list_marker_names",{}).data("list_marker_names");a[s]=c;n[e]=1;return c.data(e,j)},_4e_clearMarkers:function(c,a,e){c=t(c);var j=c.data("list_marker_names"),s=c.data("list_marker_id"),n;for(n in j)c.removeData(n);c.removeData("list_marker_names");if(e){c.removeData("list_marker_id");delete a[s]}},_4e_copyAttributes:function(c,a,e){c=g(c);a=t(a);var j=c.attributes;e=e||{};for(var s=0;s<j.length;s++){var n=j[s],y=n.name.toLowerCase(),
x;if(!(y in e))if(y=="checked"&&(x=v.attr(c,y)))a.attr(y,x);else if(n.specified||u.ie&&n.value&&y=="value"){x=v.attr(c,y);if(x===null)x=n.nodeValue;a.attr(y,x)}}if(c.style.cssText!=="")a[0].style.cssText=c.style.cssText},_4e_isEditable:function(c){c=v._4e_name(c);var a=l.XHTML_DTD;return(c=!a.$nonEditable[c]&&(a[c]||a.span))&&c["#"]},_4e_scrollIntoView:function(c){c=t(c);var a=c[0].ownerDocument,e=v.scrollLeft(a),j=v.scrollTop(a),s=c.offset(),n=s.left;s=s.top;if(v.viewportHeight(a)+j<s||s<j||v.viewportWidth(a)+
e<n||n<e)c.scrollIntoView(a)},_4e_getElementsByTagName:function(c,a,e){c=g(c);if(!u.ie&&e)a=e+":"+a;e=[];c=c.getElementsByTagName(a);for(a=0;a<c.length;a++)e.push(new r(c[a]));return e}};q.DOM._4e_inject=function(c){q.mix(v,c);for(var a in c)c.hasOwnProperty(a)&&function(e){r.prototype[e]=function(){var j=[].slice.call(arguments,0);j.unshift(this);return c[e].apply(null,j)}}(a)};k.extern(h,{_4e_wrap:h._4e_wrap,_4e_unwrap:h._4e_unwrap,_4e_equals:h._4e_equals,_4e_isBlockBoundary:h._4e_isBlockBoundary,
_4e_getWin:h._4e_getWin,_4e_index:h._4e_index,_4e_first:h._4e_first,_4e_move:h._4e_move,_4e_name:h._4e_name,_4e_isIdentical:h._4e_isIdentical,_4e_isEmptyInlineRemoveable:h._4e_isEmptyInlineRemoveable,_4e_moveChildren:h._4e_moveChildren,_4e_mergeSiblings:h._4e_mergeSiblings,_4e_unselectable:h._4e_unselectable,_4e_getOffset:h._4e_getOffset,_4e_getFrameDocument:h._4e_getFrameDocument,_4e_splitText:h._4e_splitText,_4e_parents:h._4e_parents,_4e_clone:h._4e_clone,_4e_nextSourceNode:h._4e_nextSourceNode,
_4e_previousSourceNode:h._4e_previousSourceNode,_4e_commonAncestor:h._4e_commonAncestor,_4e_ascendant:h._4e_ascendant,_4e_hasAttribute:h._4e_hasAttribute,_4e_hasAttributes:h._4e_hasAttributes,_4e_position:h._4e_position,_4e_address:h._4e_address,_4e_breakParent:h._4e_breakParent,_4e_style:h._4e_style,_4e_remove:h._4e_remove,_4e_trim:h._4e_trim,_4e_ltrim:h._4e_ltrim,_4e_rtrim:h._4e_rtrim,_4e_appendBogus:h._4e_appendBogus,_4e_last:h._4e_last,_4e_previous:h._4e_previous,_4e_next:h._4e_next,_4e_outerHtml:h._4e_outerHtml,
_4e_setMarker:h._4e_setMarker,_4e_clearMarkers:h._4e_clearMarkers,_4e_getUniqueId:h._4e_getUniqueId,_4e_copyAttributes:h._4e_copyAttributes,_4e_isEditable:h._4e_isEditable,_4e_scrollIntoView:h._4e_scrollIntoView,_4e_getElementsByTagName:h._4e_getElementsByTagName});v._4e_inject(h)});
KISSY.Editor.add("focusmanager",function(l){function p(){this.iframeFocus=i;o=this}function q(){this.iframeFocus=f;o=d}var v=KISSY,u=v.DOM,r=v.Event,k={},o;v={refreshAll:function(){for(var b in k){var g=k[b];g.document.designMode="off";g.document.designMode="on"}},currentInstance:function(){return o},getInstance:function(b){return k[b]},add:function(b){var g=u._4e_getWin(b.document);r.on(g,"focus",p,b);r.on(g,"blur",q,b)},register:function(b){k[b._UUID]=b},remove:function(b){delete k[b._UUID];var g=
u._4e_getWin(b.document);r.remove(g,"focus",p,b);r.remove(g,"blur",q,b)}};var i=true,f=false,d=null;l.focusManager=v;l.focusManager=v;l.getInstances=function(){return k};l.getInstances=l.getInstances});
KISSY.Editor.add("definition",function(l){var p=true,q=false,v=l.Utils,u=document,r=KISSY,k=r.UA,o=r.DOM,i=r.Node,f=!window.getSelection,d=r.Event,b=l.focusManager,g=v.tryThese,t=1,h="document.open();"+(v.isCustomDomain()?'document.domain="'+u.domain+'";':"")+"document.close();",c="<div  class='ke-editor-wrap'  > <div class='"+".ke-editor-tools".substring(1)+"' ></div><div class='"+".ke-textarea-wrap".substring(1)+'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+
(k.ie?"javascript:void(function(){"+encodeURIComponent(h)+"}())":"")+'"  tabIndex="'+(k.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";l.SOURCE_MODE=0;l.WYSIWYG_MODE=1;l.SOURCE_MODE=l.SOURCE_MODE;l.WYSIWYG_MODE=l.WYSIWYG_MODE;r.augment(l,{init:function(a){var e=this;e.__commands={};e.__dialogs={};e.__plugins={};k.ie&&o.addClass(u.body,"ke-ie"+k.ie);if(k.trident)o.addClass(u.body,"ke-trident"+k.trident);else if(k.gecko)o.addClass(u.body,
"ke-gecko");else k.webkit&&o.addClass(u.body,"ke-webkit");var j=new i(c.replace(/\$\(tabIndex\)/,a.attr("tabIndex")));e.editorWrap=j;e._UUID=t++;b.register(e);e.wrap=j.one(".ke-textarea-wrap");e.wrap=e.wrap;e.iframe=e.wrap.one("iframe");e.iframe=e.iframe;e.toolBarDiv=j.one(".ke-editor-tools");e.toolBarDiv=e.toolBarDiv;e.textarea=a;e.textarea=e.textarea;e.statusDiv=j.one(".ke-editor-status");e.statusDiv=e.statusDiv;v.preventFocus(e.toolBarDiv);var s=a._4e_style("width"),n=a._4e_style("height");if(s){j.css("width",
s);a.css("width","100%")}e.textarea.css("display","none");j.insertAfter(a);e.wrap[0].appendChild(a[0]);if(n){e.wrap.css("height",n);a.css("height","100%")}j=e.iframe;e.on("dataReady",function(){e._ready=p;l.fire("instanceCreated",{editor:e})});k.gecko?j.on("load",e._setUpIFrame,e):e._setUpIFrame();e.cfg.attachForm&&a[0].form&&e._attachForm()},destroy:function(){if(!this.__destroyed){var a=this.editorWrap,e=this.textarea,j=this.document,s=this.iframe[0].contentWindow;this.sync();l.focusManager.remove(this);
d.remove(j);d.remove(j.documentElement);d.remove(j.body);d.remove(s);this.iframe.detach();j=this.__plugins;for(var n in j)if(j.hasOwnProperty(n)){s=j[n];s.destroy&&s.destroy()}this.fire("destroy");e.insertBefore(a);a.remove();e.css({width:a.css("width"),height:this.wrap.css("height")});e.show();this.__commands=this.__dialogs=this.__plugins=null;this.detach();this.__destroyed=true}},_attachForm:function(){var a=this,e=new i(a.textarea[0].form);e.on("submit",a.sync,a);a.on("destroy",function(){e.detach("submit",
a.sync,a)})},useDialog:function(a,e){var j=this,s=l.Overlay;s&&s.loading();j.use(a,function(){var n=j.getDialog(a);if(n){e(n);s&&s.unloading()}else r.later(arguments.callee,50,false,j)})},addDialog:function(a,e){this.__dialogs[a]=e},getDialog:function(a){return this.__dialogs[a]},destroyDialog:function(a){var e=this.__dialogs[a];e&&e.destroy();this.__dialogs[a]=null},addCommand:function(a,e){this.__commands[a]=e},hasCommand:function(a){return this.__commands[a]},execCommand:function(a){var e=this.__commands[a],
j=r.makeArray(arguments);j.shift();j.unshift(this);return e.exec.apply(e,j)},getMode:function(){return this.textarea.css("display")=="none"?l.WYSIWYG_MODE:l.SOURCE_MODE},getData:function(a){var e;e=this.getMode()==l.WYSIWYG_MODE?this.document&&this.document.body?this.document.body.innerHTML:"":this.textarea.val();if(this.htmlDataProcessor)e=a?this.htmlDataProcessor.toHtml(e,"p"):this.htmlDataProcessor.toServer(e,"p");e=r.trim(e);if(/^<p>((&nbsp;)|\s)*<\/p>$/.test(e))e="";return e},setData:function(a){var e=
a;if(this.htmlDataProcessor)e=this.htmlDataProcessor.toDataFormat(a,"p");this.document.body.innerHTML=e;this.getMode()!=l.WYSIWYG_MODE&&this.textarea.val(a)},sync:function(){this.textarea.val(this.getData())},_getRawData:function(){return this.document.body.innerHTML},_setRawData:function(a){this.document.body.innerHTML=a},_prepareIFrameHtml:function(a){var e=this.cfg,j=e.customStyle;e=e.customLink;var s="",n=l.Utils.debugUrl("../theme/editor-iframe.css");if(e)for(var y=0;y<e.length;y++)s+='<link href="'+
e[y]+'" rel="stylesheet"/>';return"<!doctype html><html><head><title>${title}</title><link href='"+n+"' rel='stylesheet'/><style>"+(j||"")+"</style>"+s+"</head><body class='ke-editor'>&nbsp;"+(a?'<script id="ke_actscript" type="text/javascript">'+(v.isCustomDomain()?'document.domain="'+u.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':"")+"</body></html>"},getSelection:function(){return l.Selection.getSelection(this.document)},focus:function(){var a=this.document,e=o._4e_getWin(a);
k.webkit&&e&&e.parent&&e.parent.focus();k.webkit&&e&&e.focus();a&&a.body.focus();this.notifySelectionChange()},blur:function(){o._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},addCustomStyle:function(a){var e=this.cfg,j=this.document;e.customStyle=e.customStyle||"";e.customStyle+="\n"+a;e=j.createElement("style");j.getElementsByTagName("head")[0].appendChild(e);if(e.styleSheet)e.styleSheet.cssText=a;else e.appendChild(j.createTextNode(a))},addCustomLink:function(a){var e=
this.cfg,j=this.document;e.customLink=e.customLink||[];e.customLink.push(a);e=j.createElement("link");e.rel="stylesheet";j.getElementsByTagName("head")[0].appendChild(e);e.href=a},removeCustomLink:function(a){for(var e=this.cfg,j=r.makeArray(this.document.getElementsByTagName("link")),s=0;s<j.length;s++)j[s].href==a&&o._4e_remove(j[s]);e.customLink=e.customLink||[];e=e.customLink;a=r.indexOf(a,e);a!=-1&&e.splice(a,1)},_setUpIFrame:function(){function a(){y=n.document;e.document=y;j.detach();y.open("text/html",
"replace");y.write(s);y.close()}var e=this,j=e.iframe,s=e._prepareIFrameHtml(e._UUID),n=j[0].contentWindow,y;try{y=n.document}catch(x){j[0].src=j[0].src;if(k.ie<7){setTimeout(a,10);return}}a()},ready:function(a){this._ready?a():this.on("dataReady",a)},addPlugin:function(a,e,j){this.__plugins=this.__plugins;j=j||{};j.func=e;this.__plugins[a]=j},usePlugin:function(a){var e=this.__plugins[a];if(e)if(!(e.status&&!e.duplicate)){a=this.Env.mods[a].requires||[];for(var j=0;j<a.length;j++)this.usePlugin(a[j]);
e.func.call(e);e.status=1}},_monitor:function(){var a=this;a._monitorId&&clearTimeout(a._monitorId);a._monitorId=setTimeout(function(){var e=a.getSelection();if(e&&!e.isInvalid){var j=e.getStartElement(),s=new l.ElementPath(j);if(!a.previousPath||!a.previousPath.compare(s)){a.previousPath=s;a.fire("selectionChange",{selection:e,path:s,element:j})}}},100)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(a,e,j){var s=this;s.focus();setTimeout(function(){var n,
y=a._4e_name(),x=l.XHTML_DTD,A=l.RANGE,E=l.NODE,z=x.$block[y],m=s.getSelection(),w=m&&m.getRanges(),B,D,C,F;if(!w||w.length==0){var M=arguments,P=M.callee;setTimeout(function(){P.apply(s,M)},30)}else{s.fire("save");for(var L=w.length-1;L>=0;L--){B=w[L];B.deleteContents();n=!L&&a||a._4e_clone(p);e&&e(n);if(z)for(;(C=B.getCommonAncestor(q,p))&&(F=x[C._4e_name()])&&!(F&&F[y]);)if(C._4e_name()in x.span)B.splitElement(C);else if(B.checkStartOfBlock()&&B.checkEndOfBlock()){B.setStartBefore(C);B.collapse(p);
C._4e_remove()}else B.splitBlock();B.insertNode(n);D||(D=n)}if(D){y=D._4e_nextSourceNode(p);x=s.document;F=l.XHTML_DTD;if(F.$inline[n._4e_name()]){y=new i(x.createTextNode(" "));y.insertAfter(D)}else if(y){if(y._4e_name()=="br"&&F[y.parent()._4e_name()].p){F=new i("<p>&nbsp;</p>",null,x);y[0].parentNode.replaceChild(F[0],y[0]);y=F}}else{F=new i("<p>&nbsp;</p>",null,x);F.insertAfter(D);y=F}B.moveToPosition(D,A.POSITION_AFTER_END);y&&y[0].nodeType==E.NODE_ELEMENT&&B.moveToElementEditablePosition(y);
m.selectRanges([B]);s.focus();n&&n._4e_scrollIntoView();setTimeout(function(){s.fire("save")},10);j&&j(n)}}},0)},insertHtml:function(a){var e=this;if(e.htmlDataProcessor)a=e.htmlDataProcessor.toDataFormat(a);if(k.webkit){var j=o.create(a,null,e.document);j=j.nodeType==11?r.makeArray(j.childNodes):[j];for(var s=0;s<j.length;s++)e.insertElement(new i(j[s]))}else{e.focus();setTimeout(function(){var n=e.getSelection(),y=n&&n.getRanges();if(!y||y.length==0){var x=arguments,A=x.callee;setTimeout(function(){A.apply(e,
x)},30)}else{e.fire("save");if(f){n=n.getNative();n.type=="Control"&&n.clear();n.createRange().pasteHTML(a)}else e.document.execCommand("inserthtml",q,a);setTimeout(function(){e.fire("save")},10)}},0)}}});l._initIFrame=function(a){function e(w){g(function(){n.designMode="on";setTimeout(function(){n.designMode="off";A.focus();if(!arguments.callee.retry)arguments.callee.retry=p},50)},function(){n.designMode="off";o.attr(A,"contentEditable",q);o.attr(A,"contentEditable",p);!w&&e(1)})}var j=b.getInstance(a);
a=j.textarea[0];var s=j.iframe[0].contentWindow,n=j.document,y=j.cfg,x=n.getElementById("ke_actscript");o._4e_remove(x);var A=n.body;if(k.ie){A.hideFocus=p;A.disabled=p;A.contentEditable=p;A.removeAttribute("disabled")}else setTimeout(function(){if(k.gecko||k.opera)A.contentEditable=p;else if(k.webkit)A.parentNode.contentEditable=p;else n.designMode="on"},0);if(k.webkit){d.on(n,"click",function(w){var B=new i(w.target);r.inArray(B._4e_name(),["input","select"])&&w.preventDefault()});d.on(n,"mouseup",
function(w){var B=new i(w.target);r.inArray(B._4e_name(),["input","textarea"])&&w.preventDefault()})}if(k.gecko||k.ie||k.opera){var E;E=new i(o.insertAfter((new i('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>'))[0],a));E.on("focus",function(){j.focus()});j.activateGecko=function(){k.gecko&&j.iframeFocus&&E[0].focus()};j.on("destroy",function(){E.detach();E.remove()})}if(k.ie&&n.compatMode=="CSS1Compat"||n.documentMode||k.gecko||k.opera){var z=n.documentElement;
d.on(z,"mousedown",function(w){if(w.target==z){k.gecko&&e(q);E[0].focus()}})}d.on(s,"focus",function(){if(k.gecko)e(q);else k.opera&&A.focus();j.notifySelectionChange()});k.gecko&&d.on(j.document,"mousedown",function(){j.iframeFocus||e(q)});if(k.ie){d.on(n,"keydown",function(w){if(w.keyCode in{8:1,46:1}){var B=j.getSelection(),D=B.getSelectedElement();if(D){j.fire("save");var C=B.getRanges()[0].createBookmark();D._4e_remove();B.selectBookmarks([C]);j.fire("save");w.preventDefault()}}});if(n.compatMode==
"CSS1Compat"){var m={33:1,34:1};d.on(n,"keydown",function(w){w.keyCode in m&&setTimeout(function(){j.getSelection().scrollIntoView()},0)})}}setTimeout(function(){k.ie&&setTimeout(function(){if(n){A.runtimeStyle.marginBottom="0px";A.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){j.fire("dataReady");var w=y.disableObjectResizing,B=y.disableInlineTableEditing;if(w||B)try{n.execCommand("enableObjectResizing",q,!w);n.execCommand("enableInlineTableEditing",q,!B)}catch(D){d.on(A,k.ie?"resizestart":
"resize",function(C){var F=new i(C.target);if(w||F._4e_name()==="table"&&B)C.preventDefault()})}},10);k.webkit&&d.on(n,"mousedown",function(w){w=new i(w.target);r.inArray(w._4e_name(),["img","hr","input","textarea","select"])&&j.getSelection().selectElement(w)});k.gecko&&d.on(n,"dragstart",function(w){var B=new i(w.target);B._4e_name()==="img"&&/ke_/.test(B[0].className)&&w.preventDefault()});b.add(j)};h=l.prototype;v.extern(h,{setData:h.setData,getData:h.getData,insertElement:h.insertElement,insertHtml:h.insertHtml,
ready:h.ready,addCustomStyle:h.addCustomStyle,addCommand:h.addCommand,hasCommand:h.hasCommand,execCommand:h.execCommand,useDialog:h.useDialog,addDialog:h.addDialog,getDialog:h.getDialog,getMode:h.getMode,sync:h.sync,getSelection:h.getSelection,focus:h.focus,blur:h.blur,notifySelectionChange:h.notifySelectionChange})});
KISSY.Editor.add("zindex",function(){var l=KISSY.Editor;if(!l.zIndexManager){l.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,DD_PG:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};l.baseZIndex=function(p){return(l.Config.baseZIndex||1E4)+p};l.baseZIndex=l.baseZIndex;l.zIndexManager=l.zIndexManager}});
KISSY.Editor.add("dtd",function(l){l.XHTML_DTD=function(){function p(y){for(var x=arguments.length-1;x>0;)KISSY.mix(y,arguments[x--]);return y}var q={isindex:1,fieldset:1},v={input:1,button:1,select:1,textarea:1,label:1},u=p({a:1},v),r=p({iframe:1},u),k={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},o={ins:1,del:1,script:1,style:1},i=p({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},o),f=p({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),d=p({p:1},f);v=p({iframe:1},f,v);f={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var b=p({a:1},v),g={tr:1},t={"#":1},h=p({param:1},f),c=p({form:1},q,r,k,d),a={li:1},e={base:1,link:1,meta:1,title:1},j=p(e,{style:1,script:1}),s={head:1,body:1},n={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:p({html:1},s,e),$block:n,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:b,$body:p({script:1,style:1},n),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:s,head:j,style:t,body:c,base:{},link:{},meta:{},title:t,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:c,td:c,br:{},th:c,center:c,kbd:b,button:p(d,k),basefont:{},h5:b,h4:b,samp:b,h6:b,ol:a,h1:b,h3:b,option:t,h2:b,form:p(q,r,k,d),select:{optgroup:1,option:1},font:b,ins:b,menu:a,abbr:b,label:b,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:b,script:t,tfoot:g,cite:b,li:c,input:{},iframe:c,strong:b,textarea:t,noframes:c,big:b,small:b,span:b,hr:{},dt:b,sub:b,optgroup:{option:1},param:{},bdo:b,"var":b,div:c,object:h,sup:b,dd:c,strike:b,area:{},dir:a,map:p({area:1,form:1,p:1},q,o,k),applet:h,dl:{dt:1,dd:1},del:b,isindex:{},fieldset:p({legend:1},f),thead:g,ul:a,acronym:b,b:b,a:v,blockquote:c,caption:b,i:b,u:b,tbody:g,s:b,address:p(r,d),tt:b,legend:b,q:b,pre:p(i,u),p:b,em:b,dfn:b}}();l.XHTML_DTD=
l.XHTML_DTD});
KISSY.Editor.add("elementpath",function(l){function p(f){var d=r,b=r,g=[];for(f=f;f&&f[0];){if(f[0].nodeType==u.NODE_ELEMENT){if(!this.lastElement)this.lastElement=f;var t=f._4e_name();if(!b){if(!d&&k[t])d=f;if(o[t]){var h;if(h=!d){if(h=t=="div"){a:{h=f;h=h[0]||h;h=h.childNodes;for(var c=0,a=h.length;c<a;c++){var e=h[c];if(e.nodeType==u.NODE_ELEMENT&&v.$block[e.nodeName.toLowerCase()]){h=true;break a}}h=false}h=!h}h=h}if(h)d=f;else b=f}}g.push(f);if(t=="body")break}f=f.parent()}this.block=this.block=
d;this.blockLimit=this.blockLimit=b;this.elements=this.elements=g}var q=KISSY.DOM,v=l.XHTML_DTD,u=l.NODE,r=null,k={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},o={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};p.prototype={compare:function(f){var d=this.elements;f=f&&f.elements;if(!f||d.length!=f.length)return false;for(var b=0;b<d.length;b++)if(!q._4e_equals(d[b],f[b]))return false;return true},contains:function(f){for(var d=this.elements,b=0;b<
d.length;b++)if(d[b]._4e_name()in f)return d[b];return r}};l.ElementPath=l.ElementPath=p;var i=p.prototype;l.Utils.extern(i,{compare:i.compare,contains:i.contains})});
KISSY.Editor.add("walker",function(l){function p(g,t){if(this._.end)return k;var h,c=this.range,a,e=this.guard,j=this.type,s=g?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;c.trim();if(c.collapsed){this.end();return k}}if(!g&&!this._.guardLTR){var n=c.endContainer,y=new d(n[0].childNodes[c.endOffset]);this._.guardLTR=function(z,m){return(z=f._4e_wrap(z))&&z[0]&&(!m||!f._4e_equals(n,z))&&(!y[0]||!z._4e_equals(y))&&(z[0].nodeType!=i.NODE_ELEMENT||!m||z._4e_name()!="body")}}if(g&&
!this._.guardRTL){var x=c.startContainer,A=c.startOffset>0&&new d(x[0].childNodes[c.startOffset-1]);this._.guardRTL=function(z,m){return(z=f._4e_wrap(z))&&z[0]&&(!m||!z._4e_equals(x))&&(!A[0]||!z._4e_equals(A))&&(z[0].nodeType!=i.NODE_ELEMENT||!m||z._4e_name()!="body")}}var E=g?this._.guardRTL:this._.guardLTR;a=e?function(z,m){if(E(z,m)===r)return r;return e(z,m)}:E;if(this.current)h=this.current[s](r,j,a);else if(g){h=c.endContainer;if(c.endOffset>0){h=new d(h[0].childNodes[c.endOffset-1]);if(a(h)===
r)h=k}else h=a(h,u)===r?k:h._4e_previousSourceNode(u,j,a)}else{h=c.startContainer;if((h=new d(h[0].childNodes[c.startOffset]))&&h[0]){if(a(h)===r)h=k}else h=a(c.startContainer,u)===r?k:c.startContainer._4e_nextSourceNode(u,j,a)}for(;h&&h[0]&&!this._.end;){this.current=h;if(!this.evaluator||this.evaluator(h)!==r){if(!t)return h}else if(t&&this.evaluator)return r;h=h[s](r,j,a)}this.end();return this.current=k}function q(g){for(var t,h=k;t=p.call(this,g);)h=t;return h}function v(g){this.range=g;this._=
{}}var u=true,r=false,k=null,o=KISSY,i=l.NODE,f=o.DOM,d=o.Node;o.augment(v,{end:function(){this._.end=1},next:function(){return p.call(this)},previous:function(){return p.call(this,u)},checkForward:function(){return p.call(this,r,u)!==r},checkBackward:function(){return p.call(this,u,u)!==r},lastForward:function(){return q.call(this)},lastBackward:function(){return q.call(this,u)},reset:function(){delete this.current;this._={}}});v.blockBoundary=function(g){return function(t){t=f._4e_wrap(t);return!(t&&
t[0].nodeType==i.NODE_ELEMENT&&t._4e_isBlockBoundary(g))}};v.listItemBoundary=function(){return this.blockBoundary({br:1})};v.bookmark=function(g,t){function h(c){return c&&c[0]&&c._4e_name()=="span"&&c.attr("_ke_bookmark")}return function(c){var a,e;a=c&&c[0]&&c[0].nodeType==i.NODE_TEXT&&(e=c.parent())&&h(e);a=g?a:a||h(c);return t^a}};v.whitespaces=function(g){return function(t){t=(t=t[0]||t)&&t.nodeType==i.NODE_TEXT&&!o.trim(t.nodeValue);return g^t}};v.invisible=function(g){var t=v.whitespaces();
return function(h){h=t(h)||h[0].nodeType==i.NODE_ELEMENT&&!h[0].offsetHeight;return g^h}};l.Walker=v;l.Walker=v;var b=v.prototype;l.Utils.extern(b,{end:b.end,next:b.next,previous:b.previous,checkForward:b.checkForward,checkBackward:b.checkBackward,lastForward:b.lastForward,lastBackward:b.lastBackward,reset:b.reset});l.Utils.extern(v,{blockBoundary:v.blockBoundary,listItemBoundary:v.listItemBoundary,bookmark:v.bookmark,whitespaces:v.whitespaces,invisible:v.invisible})});
KISSY.Editor.add("range",function(l){function p(m){this.endOffset=this.endContainer=this.startOffset=this.startContainer=f;this.collapsed=o;this.document=m}function q(m){var w=m[0].nodeType!=b.NODE_TEXT&&m._4e_name()in j.$removeEmpty,B=!d.trim(m[0].nodeValue);m=!!m.parent().attr("_ke_bookmark");return w||B||m}function v(m){return!A(m)&&!E(m)}function u(m){var w=i,B=h.bookmark(o);return function(D){if(B(D))return o;if(D[0].nodeType==b.NODE_TEXT){if(d.trim(D[0].nodeValue).length)return i}else if(D[0].nodeType==
b.NODE_ELEMENT)if(!x[D._4e_name()])if(!m&&!e.ie&&D._4e_name()=="br"&&!w)w=o;else return i;return o}}function r(m,w){function B(D){return D&&D.nodeName=="span"&&D.getAttribute("_ke_bookmark")}return function(D){var C,F;C=D&&!D.nodeName&&(F=D.parentNode)&&B(F);C=m?C:C||B(D);return w^C}}function k(m){return function(w){w=(w=w[0]||w)&&w.nodeType==b.NODE_TEXT&&!d.trim(w.nodeValue);return m^w}}l.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};l.RANGE=l.RANGE;var o=true,i=false,f=null,d=KISSY,b=l.NODE,g=l.RANGE,t=l.POSITION,h=l.Walker,c=d.DOM,a=l.Utils.getByAddress,e=d.UA,j=l.XHTML_DTD,s=l.ElementPath,n=d.Node,y={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};p.prototype.toString=function(){var m=[];m.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);m.push((this.endContainer[0].id||
this.endContainer[0].nodeName)+":"+this.endOffset);return m.join("<br/>")};d.augment(p,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&c._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var m=this.startContainer,w=this.startOffset;if(m[0].nodeType!=b.NODE_ELEMENT)if(w)w>=m[0].nodeValue.length&&this.setStartAfter(m);else this.setStartBefore(m);m=this.endContainer;w=this.endOffset;if(m[0].nodeType!=b.NODE_ELEMENT)if(w)w>=
m[0].nodeValue.length&&this.setEndAfter(m);else this.setEndBefore(m)},setStartAfter:function(m){this.setStart(m.parent(),m._4e_index()+1)},setStartBefore:function(m){this.setStart(m.parent(),m._4e_index())},setEndAfter:function(m){this.setEnd(m.parent(),m._4e_index()+1)},setEndBefore:function(m){this.setEnd(m.parent(),m._4e_index())},optimizeBookmark:function(){var m=this.startContainer,w=this.endContainer;m&&m._4e_name()=="span"&&m.attr("_ke_bookmark")&&this.setStartAt(m,g.POSITION_BEFORE_START);
w&&w._4e_name()=="span"&&w.attr("_ke_bookmark")&&this.setEndAt(w,g.POSITION_AFTER_END)},setStart:function(m,w){if(m[0].nodeType==b.NODE_ELEMENT&&y[m._4e_name()]){m=m.parent();w=m._4e_index()}this.startContainer=m;this.startOffset=w;if(!this.endContainer){this.endContainer=m;this.endOffset=w}this.updateCollapsed()},setEnd:function(m,w){if(m[0].nodeType==b.NODE_ELEMENT&&y[m._4e_name()]){m=m.parent();w=m._4e_index()+1}this.endContainer=m;this.endOffset=w;if(!this.startContainer){this.startContainer=
m;this.startOffset=w}this.updateCollapsed()},setStartAt:function(m,w){switch(w){case g.POSITION_AFTER_START:this.setStart(m,0);break;case g.POSITION_BEFORE_END:m[0].nodeType==b.NODE_TEXT?this.setStart(m,m[0].nodeValue.length):this.setStart(m,m[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setStartBefore(m);break;case g.POSITION_AFTER_END:this.setStartAfter(m)}this.updateCollapsed()},setEndAt:function(m,w){switch(w){case g.POSITION_AFTER_START:this.setEnd(m,0);break;case g.POSITION_BEFORE_END:m[0].nodeType==
b.NODE_TEXT?this.setEnd(m,m[0].nodeValue.length):this.setEnd(m,m[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setEndBefore(m);break;case g.POSITION_AFTER_END:this.setEndAfter(m)}this.updateCollapsed()},execContentsAction:function(m,w){var B=this.startContainer,D=this.endContainer,C=this.startOffset,F=this.endOffset,M,P=this.document,L;this.optimizeBookmark();if(D[0].nodeType==b.NODE_TEXT)D=D._4e_splitText(F);else if(D[0].childNodes.length>0)if(F>=D[0].childNodes.length){D=new n(D[0].appendChild(P.createTextNode("")));
L=o}else D=new n(D[0].childNodes[F]);if(B[0].nodeType==b.NODE_TEXT){B._4e_splitText(C);if(B._4e_equals(D))D=new n(B[0].nextSibling)}else if(C)if(C>=B[0].childNodes.length){M=new n(P.createTextNode(""));B.append(M);B=M;M=o}else B=new n(B[0].childNodes[C].previousSibling);else{M=new n(P.createTextNode(""));B.prepend(M);B=M;M=o}C=B._4e_parents();F=D._4e_parents();var Q,R,T;for(Q=0;Q<C.length;Q++){R=C[Q];T=F[Q];if(!R._4e_equals(T))break}P=w;for(var U,V,G,K=Q;K<C.length;K++){U=C[K];V=P&&!U._4e_equals(B)?
P.appendChild(U._4e_clone()[0]):null;for(U=U[0].nextSibling;U;){if(c._4e_equals(F[K],U)||c._4e_equals(D,U))break;G=U.nextSibling;if(m==2)P.appendChild(U.cloneNode(o));else{c._4e_remove(U);m==1&&P.appendChild(U)}U=G}if(V)P=V}P=w;for(Q=Q;Q<F.length;Q++){U=F[Q];V=P&&m>0&&!U._4e_equals(D)?P.appendChild(U._4e_clone()[0]):null;if(!C[Q]||!U.parent()._4e_equals(C[Q].parent()))for(U=U[0].previousSibling;U;){if(c._4e_equals(C[Q],U)||c._4e_equals(B,U))break;G=U.previousSibling;if(m==2)P.insertBefore(U.cloneNode(o),
P.firstChild);else{c._4e_remove(U);m==1&&P.insertBefore(U,P.firstChild)}U=G}if(V)P=V}if(m==2){T=this.startContainer[0];if(T.nodeType==b.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==b.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}T=this.endContainer[0];if(T.nodeType==b.NODE_TEXT&&T.nextSibling&&T.nextSibling.nodeType==b.NODE_TEXT){T.data+=T.nextSibling.data;T.parentNode.removeChild(T.nextSibling)}}else{if(R&&T&&(!B.parent()._4e_equals(R.parent())||!D.parent()._4e_equals(T.parent()))){R=
T._4e_index();M&&T.parent()._4e_equals(B.parent())&&R--;this.setStart(T.parent(),R)}this.collapse(o)}M&&B._4e_remove();L&&D[0].parentNode&&D._4e_remove()},collapse:function(m){if(m){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=o},clone:function(){var m=new p(this.document);m.startContainer=this.startContainer;m.startOffset=this.startOffset;m.endContainer=this.endContainer;m.endOffset=
this.endOffset;m.collapsed=this.collapsed;return m},getEnclosedNode:function(){var m=this.clone();m.optimize();if(m.startContainer[0].nodeType!=b.NODE_ELEMENT||m.endContainer[0].nodeType!=b.NODE_ELEMENT)return f;var w=new l.Walker(m),B=r(o,undefined),D=k(o);m.evaluator=function(C){return D(C)&&B(C)};m=w.next();w.reset();w=w.previous();return m&&m._4e_equals(w)?m:f},shrink:function(m,w){if(!this.collapsed){m=m||g.SHRINK_TEXT;var B=this.clone(),D=this.startContainer,C=this.endContainer,F=this.startOffset,
M=this.endOffset,P=1,L=1;if(D&&D[0].nodeType==b.NODE_TEXT)if(F)if(F>=D[0].nodeValue.length)B.setStartAfter(D);else{B.setStartBefore(D);P=0}else B.setStartBefore(D);if(C&&C[0].nodeType==b.NODE_TEXT)if(M)if(M>=C[0].nodeValue.length)B.setEndAfter(C);else{B.setEndAfter(C);L=0}else B.setEndBefore(C);B=new h(B);B.evaluator=function(R){R=R[0]||R;return R.nodeType==(m==g.SHRINK_ELEMENT?b.NODE_ELEMENT:b.NODE_TEXT)};var Q;B.guard=function(R,T){R=R[0]||R;if(m==g.SHRINK_ELEMENT&&R.nodeType==b.NODE_TEXT)return i;
if(T&&R==Q)return i;if(!T&&R.nodeType==b.NODE_ELEMENT)Q=R;return o};if(P)(D=B[m==g.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(D,w?g.POSITION_AFTER_START:g.POSITION_BEFORE_START);if(L){B.reset();(B=B[m==g.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(B,w?g.POSITION_BEFORE_END:g.POSITION_AFTER_END)}return!!(P||L)}},getTouchedStartNode:function(){var m=this.startContainer;if(this.collapsed||m[0].nodeType!=b.NODE_ELEMENT)return m;return m.childNodes[this.startOffset]||m},createBookmark2:function(m){var w=
this.startContainer,B=this.endContainer,D=this.startOffset,C=this.endOffset,F,M;if(!w||!B)return{start:0,end:0};if(m){if(w[0].nodeType==b.NODE_ELEMENT)if((F=new n(w[0].childNodes[D]))&&F[0]&&F[0].nodeType==b.NODE_TEXT&&D>0&&F[0].previousSibling.nodeType==b.NODE_TEXT){w=F;D=0}for(;w[0].nodeType==b.NODE_TEXT&&(M=w._4e_previous())&&M[0].nodeType==b.NODE_TEXT;){w=M;D+=M[0].nodeValue.length}if(!this.collapsed){if(B[0].nodeType==b.NODE_ELEMENT)if((F=new n(B[0].childNodes[C]))&&F[0]&&F[0].nodeType==b.NODE_TEXT&&
C>0&&F[0].previousSibling.nodeType==b.NODE_TEXT){B=F;C=0}for(;B[0].nodeType==b.NODE_TEXT&&(M=B._4e_previous())&&M[0].nodeType==b.NODE_TEXT;){B=M;C+=M[0].nodeValue.length}}}return{start:w._4e_address(m),end:this.collapsed?f:B._4e_address(m),startOffset:D,endOffset:C,normalized:m,is2:o}},createBookmark:function(m){var w,B,D,C,F=this.collapsed;w=new n("<span>",f,this.document);w.attr("_ke_bookmark",1);w.css("display","none");w.html("&nbsp;");if(m){D=d.guid("ke_bm_");w.attr("id",D+"S")}if(!F){B=w._4e_clone();
B.html("&nbsp;");m&&B.attr("id",D+"E");C=this.clone();C.collapse();C.insertNode(B)}C=this.clone();C.collapse(o);C.insertNode(w);if(B){this.setStartAfter(w);this.setEndBefore(B)}else this.moveToPosition(w,g.POSITION_AFTER_END);return{startNode:m?D+"S":w,endNode:m?D+"E":B,serializable:m,collapsed:F}},moveToPosition:function(m,w){this.setStartAt(m,w);this.collapse(o)},trim:function(m,w){var B=this.startContainer,D=this.startOffset,C=this.collapsed;if((!m||C)&&B[0]&&B[0].nodeType==b.NODE_TEXT){if(D)if(D>=
B[0].nodeValue.length){D=B._4e_index()+1;B=B.parent()}else{var F=B._4e_splitText(D);D=B._4e_index()+1;B=B.parent();if(c._4e_equals(this.startContainer,this.endContainer))this.setEnd(F,this.endOffset-this.startOffset);else if(c._4e_equals(B,this.endContainer))this.endOffset+=1}else{D=B._4e_index();B=B.parent()}this.setStart(B,D);if(C){this.collapse(o);return}}B=this.endContainer;D=this.endOffset;if(!(w||C)&&B[0]&&B[0].nodeType==b.NODE_TEXT){if(D){D>=B.nodeValue.length||B._4e_splitText(D);D=B._4e_index()+
1}else D=B._4e_index();B=B.parent();this.setEnd(B,D)}},insertNode:function(m){this.optimizeBookmark();this.trim(i,o);var w=this.startContainer;w[0].insertBefore(m[0]||m,w[0].childNodes[this.startOffset]||null);c._4e_equals(m.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(m)},moveToBookmark:function(m){if(m.is2){var w=a(this.document,m.start,m.normalized),B=m.startOffset,D=m.end&&a(this.document,m.end,m.normalized);m=m.endOffset;this.setStart(w,B);D?this.setEnd(D,m):this.collapse(o)}else{w=
(B=m.serializable)?d.one("#"+m.startNode,this.document):m.startNode;m=B?d.one("#"+m.endNode,this.document):m.endNode;this.setStartBefore(w);w._4e_remove();if(m&&m[0]){this.setEndBefore(m);m._4e_remove()}else this.collapse(o)}},getCommonAncestor:function(m,w){var B=this.startContainer,D=this.endContainer;B=c._4e_equals(B,D)?m&&B[0].nodeType==b.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new n(B[0].childNodes[this.startOffset]):B:B._4e_commonAncestor(D);return w&&B[0].nodeType==b.NODE_TEXT?B.parent():
B},enlarge:function(m){switch(m){case g.ENLARGE_ELEMENT:if(this.collapsed)break;m=this.getCommonAncestor();var w=new n(this.document.body),B,D,C,F,M,P=i,L,Q;L=this.startContainer;Q=this.startOffset;if(L[0].nodeType==b.NODE_TEXT){if(Q){L=!d.trim(L[0].nodeValue.substring(0,Q)).length&&L;P=!!L}if(L)if(!(F=L[0].previousSibling))C=L.parent()}else{if(Q)F=L[0].childNodes[Q-1]||L[0].lastChild;F||(C=L)}for(;C||F;){if(C&&!F){if(!M&&c._4e_equals(C,m))M=o;if(!w.contains(C))break;if(!P||C.css("display")!="inline"){P=
i;if(M)B=C;else this.setStartBefore(C)}F=C[0].previousSibling}for(;F;){L=i;if(F.nodeType==b.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=f;L=/[\s\ufeff]$/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&j.$removeEmpty[F.nodeName.toLowerCase()]){Q=c.text(F);if(/[^\s\ufeff]/.test(Q))F=f;else for(var R=F.all||F.getElementsByTagName("*"),T=0,U;U=R[T++];)if(!j.$removeEmpty[U.nodeName.toLowerCase()]){F=f;break}if(F)L=!!Q.length}else F=f;if(L)if(P)if(M)B=C;else C&&this.setStartBefore(C);
else P=o;if(F){L=F.previousSibling;if(!C&&!L){C=new n(F);F=f;break}F=L}else C=f}if(C)C=C.parent()}L=this.endContainer;Q=this.endOffset;C=F=f;M=P=i;if(L[0].nodeType==b.NODE_TEXT){L=!d.trim(L[0].nodeValue.substring(Q)).length&&L;P=!(L&&L[0].nodeValue.length);if(L)if(!(F=L[0].nextSibling))C=L.parent()}else(F=L[0].childNodes[Q])||(C=L);for(;C||F;){if(C&&!F){if(!M&&c._4e_equals(C,m))M=o;if(!w.contains(C))break;if(!P||C.css("display")!="inline"){P=i;if(M)D=C;else C&&this.setEndAfter(C)}F=C[0].nextSibling}for(;F;){L=
i;if(F.nodeType==b.NODE_TEXT){Q=F.nodeValue;if(/[^\s\ufeff]/.test(Q))F=f;L=/^[\s\ufeff]/.test(Q)}else if(F.offsetWidth>0&&!F.getAttribute("_ke_bookmark"))if(P&&j.$removeEmpty[F.nodeName.toLowerCase()]){Q=c.text(F);if(/[^\s\ufeff]/.test(Q))F=f;else{R=F.all||F.getElementsByTagName("*");for(T=0;U=R[T++];)if(!j.$removeEmpty[U.nodeName.toLowerCase()]){F=f;break}}if(F)L=!!Q.length}else F=f;if(L)if(P)if(M)D=C;else this.setEndAfter(C);if(F){L=F.nextSibling;if(!C&&!L){C=new n(F);F=f;break}F=L}else C=f}if(C)C=
C.parent()}if(B&&D){m=B.contains(D)?D:B;this.setStartBefore(m);this.setEndAfter(m)}break;case g.ENLARGE_BLOCK_CONTENTS:case g.ENLARGE_LIST_ITEM_CONTENTS:C=new p(this.document);w=new n(this.document.body);C.setStartAt(w,g.POSITION_AFTER_START);C.setEnd(this.startContainer,this.startOffset);C=new h(C);var V,G,K=h.blockBoundary(m==g.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:f),I=function(H){var J=K(H);J||(V=H);return J};B=function(H){var J=I(H);if(!J&&H[0]&&H._4e_name()=="br")G=H;return J};C.guard=I;C=C.lastBackward();
V=V||w;this.setStartAt(V,V._4e_name()!="br"&&(!C&&this.checkStartOfBlock()||C&&V.contains(C))?g.POSITION_AFTER_START:g.POSITION_AFTER_END);C=this.clone();C.collapse();C.setEndAt(w,g.POSITION_BEFORE_END);C=new h(C);C.guard=m==g.ENLARGE_LIST_ITEM_CONTENTS?B:I;V=f;C=C.lastForward();V=V||w;this.setEndAt(V,!C&&this.checkEndOfBlock()||C&&V.contains(C)?g.POSITION_BEFORE_END:g.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},checkStartOfBlock:function(){var m=this.startContainer,w=this.startOffset;if(w&&m[0].nodeType==
b.NODE_TEXT)if(d.trim(m[0].nodeValue.substring(0,w)).length)return i;this.trim();m=new s(this.startContainer);w=this.clone();w.collapse(o);w.setStartAt(m.block||m.blockLimit,g.POSITION_AFTER_START);m=new h(w);m.evaluator=u(o);return m.checkBackward()},checkEndOfBlock:function(){var m=this.endContainer,w=this.endOffset;if(m[0].nodeType==b.NODE_TEXT)if(d.trim(m[0].nodeValue.substring(w)).length)return i;this.trim();m=new s(this.endContainer);w=this.clone();w.collapse(i);w.setEndAt(m.block||m.blockLimit,
g.POSITION_BEFORE_END);m=new h(w);m.evaluator=u(i);return m.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var m=this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,m);return m},checkBoundaryOfElement:function(m,w){var B=this.clone();B[w==g.START?"setStartAt":"setEndAt"](m,w==g.START?g.POSITION_AFTER_START:g.POSITION_BEFORE_END);B=new h(B);B.evaluator=q;return B[w==g.START?"checkBackward":"checkForward"]()},
getBoundaryNodes:function(){var m=this.startContainer,w=this.endContainer,B=this.startOffset,D=this.endOffset,C;if(m[0].nodeType==b.NODE_ELEMENT){C=m[0].childNodes.length;if(C>B)m=new n(m[0].childNodes[B]);else if(C<1)m=m._4e_previousSourceNode();else{for(m=m[0];m.lastChild;)m=m.lastChild;m=new n(m);m=m._4e_nextSourceNode()||m}}if(w[0].nodeType==b.NODE_ELEMENT){C=w[0].childNodes.length;if(C>D)w=(new n(w[0].childNodes[D]))._4e_previousSourceNode(o);else if(C<1)w=w._4e_previousSourceNode();else{for(w=
w[0];w.lastChild;)w=w.lastChild;w=new n(w)}}if(m._4e_position(w)&t.POSITION_FOLLOWING)m=w;return{startNode:m,endNode:w}},fixBlock:function(m,w){var B=this.createBookmark(),D=new n(this.document.createElement(w));this.collapse(m);this.enlarge(g.ENLARGE_BLOCK_CONTENTS);D[0].appendChild(this.extractContents());D._4e_trim();e.ie||D._4e_appendBogus();this.insertNode(D);this.moveToBookmark(B);return D},splitBlock:function(m){var w=new s(this.startContainer),B=new s(this.endContainer),D=w.block,C=B.block,
F=f;if(!w.blockLimit._4e_equals(B.blockLimit))return f;if(m!="br"){if(!D){D=this.fixBlock(o,m);C=(new s(this.endContainer)).block}C||(C=this.fixBlock(i,m))}m=D&&this.checkStartOfBlock();w=C&&this.checkEndOfBlock();this.deleteContents();if(D&&c._4e_equals(D,C))if(w){F=new s(this.startContainer);this.moveToPosition(C,g.POSITION_AFTER_END);C=f}else if(m){F=new s(this.startContainer);this.moveToPosition(D,g.POSITION_BEFORE_START);D=f}else{C=this.splitElement(D);!e.ie&&!d.inArray(D._4e_name(),["ul","ol"])&&
D._4e_appendBogus()}return{previousBlock:D,nextBlock:C,wasStartOfBlock:m,wasEndOfBlock:w,elementPath:F}},splitElement:function(m){if(!this.collapsed)return f;this.setEndAt(m,g.POSITION_BEFORE_END);var w=this.extractContents(),B=m._4e_clone(i);B[0].appendChild(w);B.insertAfter(m);this.moveToPosition(m,g.POSITION_AFTER_END);return B},moveToElementEditablePosition:function(m,w){var B,D=l.XHTML_DTD;if(D.$empty[m._4e_name()])return i;for(;m&&m[0].nodeType==b.NODE_ELEMENT;){if(B=m._4e_isEditable())this.moveToPosition(m,
w?g.POSITION_BEFORE_END:g.POSITION_AFTER_START);else if(D.$inline[m._4e_name()]){this.moveToPosition(m,w?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return o}if((m=D.$empty[m._4e_name()]?m[w?"_4e_previous":"_4e_next"](v):m[w?"_4e_last":"_4e_first"](v))&&m[0].nodeType==b.NODE_TEXT){this.moveToPosition(m,w?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return o}}return B},selectNodeContents:function(m){this.setStart(m,0);this.setEnd(m,m[0].nodeType==b.NODE_TEXT?m[0].nodeValue.length:m[0].childNodes.length)}});
var x={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},A=new h.whitespaces,E=new h.bookmark;l.Range=p;l.Range=p;var z=p.prototype;l.Utils.extern(z,{updateCollapsed:z.updateCollapsed,optimize:z.optimize,setStartAfter:z.setStartAfter,setEndAfter:z.setEndAfter,setStartBefore:z.setStartBefore,setEndBefore:z.setEndBefore,optimizeBookmark:z.optimizeBookmark,setStart:z.setStart,setEnd:z.setEnd,
setStartAt:z.setStartAt,setEndAt:z.setEndAt,execContentsAction:z.execContentsAction,collapse:z.collapse,clone:z.clone,getEnclosedNode:z.getEnclosedNode,shrink:z.shrink,getTouchedStartNode:z.getTouchedStartNode,createBookmark2:z.createBookmark2,createBookmark:z.createBookmark,moveToPosition:z.moveToPosition,trim:z.trim,insertNode:z.insertNode,moveToBookmark:z.moveToBookmark,getCommonAncestor:z.getCommonAncestor,enlarge:z.enlarge,checkStartOfBlock:z.checkStartOfBlock,checkEndOfBlock:z.checkEndOfBlock,
deleteContents:z.deleteContents,extractContents:z.extractContents,checkBoundaryOfElement:z.checkBoundaryOfElement,getBoundaryNodes:z.getBoundaryNodes,fixBlock:z.fixBlock,splitBlock:z.splitBlock,splitElement:z.splitElement,moveToElementEditablePosition:z.moveToElementEditablePosition,selectNodeContents:z.selectNodeContents})});
KISSY.Editor.add("domiterator",function(l){function p(h){if(!(arguments.length<1)){this.range=h;this.forceBrBreak=v;this.enlargeBr=q;this.enforceRealBlocks=v;this._||(this._={})}}var q=true,v=false,u=KISSY,r=u.UA,k=l.Walker,o=l.Range,i=l.RANGE,f=l.NODE,d=l.ElementPath,b=u.Node,g=u.DOM,t=/^[\r\n\t ]*$/;u.augment(p,{getNextParagraph:function(h){var c,a,e,j,s;if(!this._.lastNode){a=this.range.clone();a.shrink(i.SHRINK_ELEMENT,q);a.enlarge(this.forceBrBreak||!this.enlargeBr?i.ENLARGE_LIST_ITEM_CONTENTS:
i.ENLARGE_BLOCK_CONTENTS);var n=new k(a),y=k.bookmark(q,q);n.evaluator=y;this._.nextNode=n.next();n=new k(a);n.evaluator=y;n=n.previous();this._.lastNode=n._4e_nextSourceNode(q);if(this._.lastNode&&this._.lastNode[0].nodeType==f.NODE_TEXT&&!u.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){y=new o(a.document);y.moveToPosition(this._.lastNode,i.POSITION_AFTER_END);if(y.checkEndOfBlock()){y=new d(y.endContainer);this._.lastNode=(y.block||y.blockLimit)._4e_nextSourceNode(q)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new b(a.document.createTextNode(""));g.insertAfter(this._.lastNode[0],n[0])}a=null}y=this._.nextNode;n=this._.lastNode;for(this._.nextNode=null;y;){var x=v,A=y[0].nodeType!=f.NODE_ELEMENT,E=v;if(A){if(y[0].nodeType==f.NODE_TEXT)if(t.test(y[0].nodeValue))A=v}else{var z=y._4e_name();if(y._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(z=="br")A=q;else if(!a&&!y[0].childNodes.length&&z!="hr"){c=y;e=y._4e_equals(n);break}if(a){a.setEndAt(y,i.POSITION_BEFORE_START);if(z!="br")this._.nextNode=
y}x=q}else{if(y[0].firstChild){if(!a){a=new o(this.range.document);a.setStartAt(y,i.POSITION_BEFORE_START)}y=new b(y[0].firstChild);continue}A=q}}if(A&&!a){a=new o(this.range.document);a.setStartAt(y,i.POSITION_BEFORE_START)}e=(!x||A)&&y._4e_equals(n);if(a&&!x)for(;!y[0].nextSibling&&!e;){z=y.parent();if(z._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){x=q;e||z._4e_equals(n);break}y=z;A=q;e=y._4e_equals(n);E=q}A&&a.setEndAt(y,i.POSITION_AFTER_END);y=y._4e_nextSourceNode(E,null,n);if((e=!y)||x&&a)break}if(!c){if(!a){this._.docEndMarker&&
this._.docEndMarker._4e_remove();return this._.nextNode=null}c=new d(a.startContainer);y=c.blockLimit;x={div:1,th:1,td:1};c=c.block;if((!c||!c[0])&&!this.enforceRealBlocks&&x[y._4e_name()]&&a.checkStartOfBlock()&&a.checkEndOfBlock())c=y;else if(!c||this.enforceRealBlocks&&c._4e_name()=="li"){c=new b(this.range.document.createElement(h||"p"));c[0].appendChild(a.extractContents());c._4e_trim();a.insertNode(c);j=s=q}else if(c._4e_name()!="li"){if(!a.checkStartOfBlock()||!a.checkEndOfBlock()){c=c._4e_clone(v);
c[0].appendChild(a.extractContents());c._4e_trim();s=a.splitBlock();j=!s.wasStartOfBlock;s=!s.wasEndOfBlock;a.insertNode(c)}}else if(!e)this._.nextNode=c._4e_equals(n)?null:a.getBoundaryNodes().endNode._4e_nextSourceNode(q,null,n)}if(j){a=new b(c[0].previousSibling);if(a[0]&&a[0].nodeType==f.NODE_ELEMENT)if(a._4e_name()=="br")a._4e_remove();else a[0].lastChild&&g._4e_name(a[0].lastChild)=="br"&&g._4e_remove(a[0].lastChild)}if(s){a=k.bookmark(v,q);j=new b(c[0].lastChild);if(j[0]&&j[0].nodeType==f.NODE_ELEMENT&&
j._4e_name()=="br")if(r.ie||j._4e_previous(a)||j._4e_next(a))j._4e_remove()}if(!this._.nextNode)this._.nextNode=e||c._4e_equals(n)?null:c._4e_nextSourceNode(q,null,n);return c}});o.prototype.createIterator=function(){return new p(this)}});
KISSY.Editor.add("selection",function(l){function p(x){this.document=this.document=x;this._={cache:{}};if(c){var A=this.getNative().createRange();if(!A||A.item&&A.item(0).ownerDocument!=x||A.parentElement&&A.parentElement().ownerDocument!=x)this.isInvalid=u}}function q(x){x=new p(x);return!x||x.isInvalid?k:x}function v(x){var A=x.document,E=new b(A.body),z=new b(A.documentElement);if(i.ie){if(i.ie<8||document.documentMode==7)z.on("click",function(L){(new b(L.target))._4e_name()==="html"&&x.getSelection().getRanges()[0].select()});
var m,w,B=1;z.on("mousedown",function(){B=0});z.on("mouseup",function(){B=1});E.on("focusin",function(L){if((new b(L.target))._4e_name()=="body")if(m){try{B&&m.select()}catch(Q){}m=k}});E.on("focus",function(){w=u;C()});E.on("beforedeactivate",function(L){if(!L.relatedTarget){w=r;B=1}});d.on(f._4e_getWin(A),"blur",function(){A&&A.selection.empty()});E.on("mousedown",function(){D()});E.on("mouseup",function(){w=u;setTimeout(function(){C(u)},0)});var D=function(){w=r},C=function(L){if(w){var Q=x.document,
R=x.getSelection(),T=R&&R.getType(),U=R&&R.getNative();if(L&&U&&T==g.SELECTION_NONE)if(!Q.queryCommandEnabled("InsertImage")){setTimeout(function(){C(u)},50);return}var V;if(!(U&&T==g.SELECTION_TEXT&&(V=f._4e_name(R.getStartElement()))&&V in{input:1,textarea:1})){m=U&&R.getRanges()[0];x._monitor()}}};E.on("keydown",D);E.on("keyup",function(){w=u;C()});d.on(A,"selectionchange",C)}else{d.on(A,"mouseup",x._monitor,x);d.on(A,"keyup",x._monitor,x)}var F={table:1,pre:1},M=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,
P=l.Walker.whitespaces(u);x.on("selectionChange",function(L){var Q=L.path;L=(L=L.selection)&&L.getRanges()[0];if(!(!L||!L.collapsed||Q.block))if(Q.blockLimit._4e_name()=="body"){Q=L.fixBlock(u,"p");if(Q._4e_outerHtml().match(M)){var R=Q._4e_next(P);if(R&&R[0].nodeType==h.NODE_ELEMENT&&!F[R._4e_name()]){L.moveToElementEditablePosition(R);Q._4e_remove()}else if((R=Q._4e_previous(P))&&R[0].nodeType==h.NODE_ELEMENT&&!F[R._4e_name()]){L.moveToElementEditablePosition(R,R._4e_outerHtml().match(M)?r:u);Q._4e_remove()}}L.select();
c||x.notifySelectionChange()}})}l.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var u=true,r=false,k=null,o=KISSY,i=o.UA,f=o.DOM,d=o.Event,b=o.Node,g=l.SELECTION,t=l.RANGE,h=l.NODE,c=!window.getSelection,a=l.Walker,e=l.Range,j={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};o.augment(p,{getNative:!c?function(){var x=this._.cache;return x.nativeSel||(x.nativeSel=f._4e_getWin(this.document).getSelection())}:
function(){var x=this._.cache;return x.nativeSel||(x.nativeSel=this.document.selection)},getType:!c?function(){var x=this._.cache;if(x.type)return x.type;var A=g.SELECTION_TEXT,E=this.getNative();if(E){if(E.rangeCount==1){E=E.getRangeAt(0);var z=E.startContainer;if(z==E.endContainer&&z.nodeType==h.NODE_ELEMENT&&E.endOffset-E.startOffset===1&&j[z.childNodes[E.startOffset].nodeName.toLowerCase()])A=g.SELECTION_ELEMENT}}else A=g.SELECTION_NONE;return x.type=A}:function(){var x=this._.cache;if(x.type)return x.type;
var A=g.SELECTION_NONE;try{var E=this.getNative(),z=E.type;if(z=="Text")A=g.SELECTION_TEXT;if(z=="Control")A=g.SELECTION_ELEMENT;if(E.createRange().parentElement)A=g.SELECTION_TEXT}catch(m){}return x.type=A},getRanges:c?function(){var x=function(A,E){A=A.duplicate();A.collapse(E);for(var z=A.parentElement(),m=z.childNodes,w,B=0;B<m.length;B++){var D=m[B];if(D.nodeType==h.NODE_ELEMENT){w=A.duplicate();w.moveToElementText(D);D=w.compareEndPoints("StartToStart",A);var C=w.compareEndPoints("EndToStart",
A);w.collapse();if(D>0)break;else if(!D||C==1&&D==-1)return{container:z,offset:B};else if(!C)return{container:z,offset:B+1};w=k}}if(!w){w=A.duplicate();w.moveToElementText(z);w.collapse(r)}w.setEndPoint("StartToStart",A);w=w.text.replace(/\r\n|\r/g,"\n").length;try{for(;w>0;)w-=m[--B].nodeValue.length}catch(F){w=0}return w===0?{container:z,offset:B}:{container:m[B],offset:-w}};return function(){var A=this._.cache;if(A.ranges)return A.ranges;var E=this.getNative(),z=E&&E.createRange(),m=this.getType();
if(!E)return[];if(m==g.SELECTION_TEXT){E=new e(this.document);m=x(z,u);E.setStart(new b(m.container),m.offset);m=x(z);E.setEnd(new b(m.container),m.offset);return A.ranges=[E]}else if(m==g.SELECTION_ELEMENT){A=A.ranges=[];for(m=0;m<z.length;m++){var w=z.item(m),B=w.parentNode,D=0;for(E=new e(this.document);D<B.childNodes.length&&B.childNodes[D]!=w;D++);E.setStart(new b(B),D);E.setEnd(new b(B),D+1);A.push(E)}return A}return A.ranges=[]}}():function(){var x=this._.cache;if(x.ranges)return x.ranges;
var A=[],E=this.getNative();if(!E)return[];for(var z=0;z<E.rangeCount;z++){var m=E.getRangeAt(z),w=new e(this.document);w.setStart(new b(m.startContainer),m.startOffset);w.setEnd(new b(m.endContainer),m.endOffset);A.push(w)}return x.ranges=A},getStartElement:function(){var x=this._.cache;if(x.startElement!==undefined)return x.startElement;var A,E=this.getNative();switch(this.getType()){case g.SELECTION_ELEMENT:return this.getSelectedElement();case g.SELECTION_TEXT:var z=this.getRanges()[0];if(z)if(!z.collapsed){for(z.optimize();u;){A=
z.startContainer;if(z.startOffset==(A[0].nodeType===h.NODE_ELEMENT?A[0].childNodes.length:A[0].nodeValue.length)&&!A._4e_isBlockBoundary())z.setStartAfter(A);else break}A=z.startContainer;if(A[0].nodeType!=h.NODE_ELEMENT)return A.parent();A=new b(A[0].childNodes[z.startOffset]);if(!A[0]||A[0].nodeType!=h.NODE_ELEMENT)return z.startContainer;for(z=A[0].firstChild;z&&z.nodeType==h.NODE_ELEMENT;){A=new b(z);z=z.firstChild}return A}if(c){z=E.createRange();z.collapse(u);A=z.parentElement()}else if((A=
E.anchorNode)&&A.nodeType!=h.NODE_ELEMENT)A=A.parentNode}return x.startElement=A?f._4e_wrap(A):k},getSelectedElement:function(){var x=this,A,E=x._.cache;if(E.selectedElement!==undefined)return E.selectedElement;if(c){A=x.getNative().createRange();A=A.item&&A.item(0)}A||(A=function(){for(var z=x.getRanges()[0],m,w,B=2;B&&!((m=z.getEnclosedNode())&&m[0].nodeType==h.NODE_ELEMENT&&j[m._4e_name()]&&(w=m));B--)z.shrink(t.SHRINK_ELEMENT);return w&&w[0]}());return E.selectedElement=f._4e_wrap(A)},reset:function(){this._.cache=
{}},selectElement:function(x){var A,E=this.document;if(c)try{A=E.body.createControlRange();A.addElement(x[0]);A.select()}catch(z){A=E.body.createTextRange();A.moveToElementText(x[0]);A.select()}finally{}else{A=E.createRange();A.selectNode(x[0]);x=this.getNative();x.removeAllRanges();x.addRange(A)}this.reset()},selectRanges:function(x){if(c){if(x.length>1){var A=x[x.length-1];x[0].setEnd(A.endContainer,A.endOffset);x.length=1}x[0]&&x[0].select()}else{A=this.getNative();if(!A)return;A.removeAllRanges();
for(var E=0;E<x.length;E++){var z=x[E],m=this.document.createRange(),w=z.startContainer;z.collapsed&&i.gecko&&i.gecko<1.09&&w[0].nodeType==h.NODE_ELEMENT&&!w[0].childNodes.length&&w[0].appendChild(this.document.createTextNode(""));m.setStart(w[0],z.startOffset);m.setEnd(z.endContainer[0],z.endOffset);A.addRange(m)}}this.reset()},createBookmarks2:function(x){for(var A=[],E=this.getRanges(),z=0;z<E.length;z++)A.push(E[z].createBookmark2(x));return A},createBookmarks:function(x,A){var E=[],z=this.document,
m;A=A||this.getRanges();for(var w=A.length,B=0;B<w;B++){E.push(m=A[B].createBookmark(x,u));var D=(x=m.serializable)?o.one("#"+m.startNode,z):m.startNode;m=x?o.one("#"+m.endNode,z):m.endNode;for(var C=B+1;C<w;C++){var F=A[C],M=F.startContainer,P=F.endContainer;f._4e_equals(M,D.parent())&&F.startOffset++;f._4e_equals(M,m.parent())&&F.startOffset++;f._4e_equals(P,D.parent())&&F.endOffset++;f._4e_equals(P,m.parent())&&F.endOffset++}}return E},selectBookmarks:function(x){for(var A=[],E=0;E<x.length;E++){var z=
new e(this.document);z.moveToBookmark(x[E]);A.push(z)}this.selectRanges(A);return this},getCommonAncestor:function(){var x=this.getRanges();return x[0].startContainer._4e_commonAncestor(x[x.length-1].endContainer)},scrollIntoView:function(){var x=this.getStartElement();x&&x._4e_scrollIntoView()},removeAllRanges:function(){var x=this.getNative();if(c)x&&x.clear();else x&&x.removeAllRanges()}});var s={table:1,tbody:1,tr:1},n=a.whitespaces(u),y=/\ufeff|\u00a0/;e.prototype.select=e.prototype.select=!c?
function(){var x=this.startContainer;this.collapsed&&x[0].nodeType==h.NODE_ELEMENT&&!x[0].childNodes.length&&x[0].appendChild(this.document.createTextNode(""));var A=this.document.createRange();A.setStart(x[0],this.startOffset);try{A.setEnd(this.endContainer[0],this.endOffset)}catch(E){if(E.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(u);A.setEnd(this.endContainer[0],this.endOffset)}else throw E;}x=q(this.document).getNative();x.removeAllRanges();x.addRange(A)}:function(x){var A=
this.collapsed,E,z;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var m=this.startContainer[0].childNodes[this.startOffset];if(m.nodeType==h.NODE_ELEMENT){(new p(this.document)).selectElement(new b(m));return}}if(this.startContainer[0].nodeType==h.NODE_ELEMENT&&this.startContainer._4e_name()in s||this.endContainer[0].nodeType==h.NODE_ELEMENT&&this.endContainer._4e_name()in s)this.shrink(t.SHRINK_ELEMENT,u);var w=this.createBookmark();m=w.startNode;var B;if(!A)B=
w.endNode;w=this.document.body.createTextRange();w.moveToElementText(m[0]);w.moveStart("character",1);if(B){x=this.document.body.createTextRange();x.moveToElementText(B[0]);w.setEndPoint("EndToEnd",x);w.moveEnd("character",-1)}else{for(E=m[0].nextSibling;E&&!n(E);)E=E.nextSibling;E=!(E&&E.nodeValue&&E.nodeValue.match(y))&&(x||!m[0].previousSibling||m[0].previousSibling&&f._4e_name(m[0].previousSibling)=="br");z=new b(this.document.createElement("span"));z.html("&#65279;");z.insertBefore(m);E&&f.insertBefore(this.document.createTextNode("\ufeff"),
m)}this.setStartBefore(m);m._4e_remove();if(A){if(E){w.moveStart("character",-1);w.select();this.document.selection.clear()}else w.select();if(z){this.moveToPosition(z,t.POSITION_BEFORE_START);z._4e_remove()}}else{this.setEndBefore(B);B._4e_remove();w.select()}};p.getSelection=q;l.Selection=p;l.Selection=p;a=p.prototype;l.Utils.extern(a,{getNative:a.getNative,getType:a.getType,getRanges:a.getRanges,getStartElement:a.getStartElement,getSelectedElement:a.getSelectedElement,reset:a.reset,selectElement:a.selectElement,
selectRanges:a.selectRanges,createBookmarks2:a.createBookmarks2,createBookmarks:a.createBookmarks,getCommonAncestor:a.getCommonAncestor,scrollIntoView:a.scrollIntoView,selectBookmarks:a.selectBookmarks,removeAllRanges:a.removeAllRanges});l.on("instanceCreated",function(x){v(x.editor)})});
KISSY.Editor.add("styles",function(l){function p(G,K){for(var I in G)G[I]=G[I].replace(U,function(H,J){return K[J]})}function q(G,K){if(K){G=A.clone(G);p(G.attributes,K);p(G.styles,K)}var I=this.element=this.element=(G.element||"*").toLowerCase();this.type=this.type=I=="#"||Q[I]?m.STYLE_BLOCK:R[I]?m.STYLE_OBJECT:m.STYLE_INLINE;this._={definition:G}}function v(G,K){var I=K?this.removeFromRange:this.applyToRange;G.body.focus();for(var H=new B(G),J=H.getRanges(),O=0;O<J.length;O++)I.call(this,J[O]);
H.selectRanges(J)}function u(G,K){var I;I=G.element;if(I=="*")I="span";I=new M(K.createElement(I));return r(I,G)}function r(G,K){var I=K._.definition,H=I.attributes;I=q.getStyleText(I);if(H)for(var J in H)G.attr(J,H[J]);if(I)G[0].style.cssText=I;return G}function k(G){var K=G.createBookmark(n),I=G.createIterator();I.enforceRealBlocks=n;I.enlargeBr=n;for(var H,J=G.document;H=I.getNextParagraph();){var O=u(this,J);H=H;var N=O;O=N._4e_name=="pre";var S=H._4e_name=="pre",Z=!O&&S;if(O&&!S){S=H;N=N;Z=S.html();
Z=o(Z,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");Z=Z.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");Z=Z.replace(/([ \t\n\r]+|&nbsp;)/g," ");Z=Z.replace(/<br\b[^>]*>/gi,"\n");if(P.ie){S=S[0].ownerDocument.createElement("div");S.appendChild(N[0]);N[0].outerHTML="<pre>"+Z+"</pre>";N=new M(S.firstChild);N._4e_remove()}else N.html(Z);N=N}else if(Z)N=f(i(H),N);else H._4e_moveChildren(N);H[0].parentNode.replaceChild(N[0],H[0]);if(O){H=N;O=void 0;if((O=H._4e_previousSourceNode(n,D.NODE_ELEMENT))&&O._4e_name()==
"pre"){N=o(O.html(),/\n$/,"")+"\n\n"+o(H.html(),/^\n/,"");if(P.ie)H[0].outerHTML="<pre>"+N+"</pre>";else H.html(N);O._4e_remove()}}}G.moveToBookmark(K)}function o(G,K,I){var H="",J="";G=G.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(O,N,S){N&&(H=N);S&&(J=S);return""});return H+G.replace(K,I)+J}function i(G){var K=[];o(G._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(I,H,J){return H+"</pre>"+J+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(I,H){K.push(H)});return K}function f(G,K){for(var I=K[0].ownerDocument.createDocumentFragment(),H=0;H<G.length;H++){var J=G[H];J=J.replace(/(\r\n|\r)/g,"\n");J=o(J,/^[ \t]*\n/,"");J=o(J,/\n$/,"");J=o(J,/^[ \t]+|[ \t]+$/g,function(N,S){return N.length==1?"&nbsp;":S?" "+Array(N.length).join("&nbsp;"):Array(N.length).join("&nbsp;")+" "});J=J.replace(/\n/g,"<br>");J=J.replace(/[ \t]{2,}/g,function(N){return Array(N.length).join("&nbsp;")+" "});var O=K._4e_clone();O.html(J);I.appendChild(O[0])}return I}
function d(G){var K=G.document;if(G.collapsed){K=u(this,K);G.insertNode(K);G.moveToPosition(K,w.POSITION_BEFORE_END)}else{var I=this.element,H=this._.definition,J,O=l.XHTML_DTD[I]||(J=n,l.XHTML_DTD.span),N=G.createBookmark();G.enlarge(w.ENLARGE_ELEMENT);G.trim();var S=G.createBookmark(),Z=S.startNode;S=S.endNode;for(var X=Z,aa;X&&X[0];){var W=y;if(z._4e_equals(X,S)){X=x;W=n}else{var Y=X[0].nodeType,$=Y==D.NODE_ELEMENT?X._4e_name():x;if($&&X.attr("_ke_bookmark")){X=X._4e_nextSourceNode(n);continue}if(!$||
O[$]&&(X._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(X))){var da=X.parent();if(da&&da[0]&&((l.XHTML_DTD[da._4e_name()]||l.XHTML_DTD.span)[I]||J)&&(!H.parentRule||H.parentRule(da))){if(!aa&&(!$||!l.XHTML_DTD.$removeEmpty[$]||(X._4e_position(S)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED)){aa=
new F(K);aa.setStartBefore(X)}if(Y==D.NODE_TEXT||Y==D.NODE_ELEMENT&&!X[0].childNodes.length){Y=X;var ca;for($=Y._4e_next(function(ga){return!ga.attr("_ke_bookmark")});!$&&(ca=Y.parent(),O[ca._4e_name()])&&(ca._4e_position(Z)|C.POSITION_FOLLOWING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_FOLLOWING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!H.childRule||H.childRule(ca));)Y=ca;aa.setEndAfter(Y);Y[0].nextSibling||(W=n)}}else W=n}else W=n;X=X._4e_nextSourceNode()}if(W&&aa&&!aa.collapsed){W=
u(this,K);Y=aa.getCommonAncestor();$={styles:{},attrs:{},blockedStyles:{},blockedAttrs:{}};for(var ba,ea,fa;W&&Y&&W[0]&&Y[0];){if(Y._4e_name()==I){for(ba in H.attributes)if(!($.blockedAttrs[ba]||!(fa=Y.attr(ea))))if(W.attr(ba)==fa)W.removeAttr(ba);else $.blockedAttrs[ba]=1;for(ea in H.styles)if(!($.blockedStyles[ea]||!(fa=Y._4e_style(ea))))if(W._4e_style(ea)==fa)W._4e_style(ea,"");else $.blockedStyles[ea]=1;if(!W._4e_hasAttributes()){W=x;break}}Y=Y.parent()}if(W){W[0].appendChild(aa.extractContents());
e(this,W);aa.insertNode(W);W._4e_mergeSiblings();P.ie||W[0].normalize()}else{W=new M(K.createElement("span"));W[0].appendChild(aa.extractContents());aa.insertNode(W);e(this,W);W._4e_remove(true)}aa=x}}Z._4e_remove();S._4e_remove();G.moveToBookmark(N);G.shrink(w.SHRINK_TEXT)}}function b(G){G.enlarge(w.ENLARGE_ELEMENT);var K=G.createBookmark(),I=K.startNode;if(G.collapsed){for(var H=new L(I.parent()),J,O=0,N;O<H.elements.length&&(N=H.elements[O]);O++){if(N==H.block||N==H.blockLimit)break;if(this.checkElementRemovable(N)){var S=
G.checkBoundaryOfElement(N,w.END),Z=!S&&G.checkBoundaryOfElement(N,w.START);if(Z||S){J=N;J.match=Z?"start":"end"}else{N._4e_mergeSiblings();N._4e_name()==this.element?c(this,N):j(N,h(this)[N._4e_name()])}}}if(J&&J[0]){N=I;for(O=0;;O++){S=H.elements[O];if(z._4e_equals(S,J))break;else if(S.match)continue;else S=S._4e_clone();S[0].appendChild(N[0]);N=S}z[J.match=="start"?"insertBefore":"insertAfter"](N,J)}}else{var X=K.endNode,aa=this;H=function(){for(var W=new L(I.parent()),Y=new L(X.parent()),$=x,
da=x,ca=0;ca<W.elements.length;ca++){var ba=W.elements[ca];if(ba==W.block||ba==W.blockLimit)break;if(aa.checkElementRemovable(ba))$=ba}for(ca=0;ca<Y.elements.length;ca++){ba=Y.elements[ca];if(ba==Y.block||ba==Y.blockLimit)break;if(aa.checkElementRemovable(ba))da=ba}da&&X._4e_breakParent(da);$&&I._4e_breakParent($)};H();for(J=new M(I[0].nextSibling);J[0]!==X[0];){O=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==D.NODE_ELEMENT&&this.checkElementRemovable(J)){J._4e_name()==this.element?c(this,J):j(J,
h(this)[J._4e_name()]);if(O[0].nodeType==D.NODE_ELEMENT&&O.contains(I)){H();O=new M(I[0].nextSibling)}}J=O}}G.moveToBookmark(K)}function g(G){var K={};G.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(I,H,J){K[H]=J});return K}function t(G,K){var I;if(K!==y){I=document.createElement("span");I.style.cssText=G;I=I.style.cssText||""}else I=G;return I.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function h(G){if(G._.overrides)return G._.overrides;
var K=G._.overrides={},I=G._.definition.overrides;if(I){A.isArray(I)||(I=[I]);for(var H=0;H<I.length;H++){var J=I[H],O,N;if(typeof J=="string")O=J.toLowerCase();else{O=J.element?J.element.toLowerCase():G.element;N=J.attributes}J=K[O]||(K[O]={});if(N){J=J.attributes=J.attributes||[];for(var S in N)J.push([S.toLowerCase(),N[S]])}}}return K}function c(G,K){var I=G._.definition,H=E.mix(I.attributes,h(G)[K._4e_name()]);I=I.styles;var J=A.isEmptyObject(H)&&A.isEmptyObject(I),O;for(O in H)if(!((O=="class"||
G._.definition.fullMatch)&&K.attr(O)!=a(O,H[O]))){J=J||!!K._4e_hasAttribute(O);K.removeAttr(O)}for(var N in I)if(!(G._.definition.fullMatch&&K._4e_style(N)!=a(N,I[N],n))){J=J||!!K._4e_style(N);K._4e_style(N,"")}s(K)}function a(G,K,I){var H=new M("<span>");H[I?"_4e_style":"attr"](G,K);return H[I?"_4e_style":"attr"](G)}function e(G,K){for(var I=h(G),H=K.all(G.element),J=H.length;--J>=0;)c(G,new M(H[J]));for(var O in I)if(O!=G.element){H=K.all(O);for(J=H.length-1;J>=0;J--){var N=new M(H[J]);j(N,I[O])}}}
function j(G,K){var I=K&&K.attributes;if(I)for(var H=0;H<I.length;H++){var J=I[H][0],O;if(O=G.attr(J)){var N=I[H][1];if(N===x||N.test&&N.test(O)||typeof N=="string"&&O==N)G[0].removeAttribute(J)}}s(G)}function s(G){if(!G._4e_hasAttributes()){var K=G[0].firstChild,I=G[0].lastChild;G._4e_remove(n);if(K){K.nodeType==D.NODE_ELEMENT&&z._4e_mergeSiblings(K);I&&K!=I&&I.nodeType==D.NODE_ELEMENT&&z._4e_mergeSiblings(I)}}}var n=true,y=false,x=null,A=KISSY,E=l.Utils,z=A.DOM,m={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},
w=l.RANGE,B=l.Selection,D=l.NODE,C=l.POSITION,F=l.Range,M=A.Node,P=A.UA,L=l.ElementPath,Q={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},R={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},T=/\s*(?:;\s*|$)/g,U=/#\((.+?)\)/g;l.STYLE=m;q.prototype={apply:function(G){v.call(this,G,y)},remove:function(G){v.call(this,G,n)},applyToRange:function(G){return(this.applyToRange=this.type==m.STYLE_INLINE?d:this.type==m.STYLE_BLOCK?k:this.type==m.STYLE_OBJECT?
x:x).call(this,G)},removeFromRange:function(G){return(this.removeFromRange=this.type==m.STYLE_INLINE?b:x).call(this,G)},applyToObject:function(G){r(G,this)},checkElementRemovable:function(G,K){if(!G)return y;var I=this._.definition;if(G._4e_name()==this.element){if(!K&&!G._4e_hasAttributes())return n;var H=I._AC;if(H)I=H;else{H={};var J=0,O=I.attributes;if(O)for(var N in O){J++;H[N]=O[N]}if(O=q.getStyleText(I)){H.style||J++;H.style=O}H._length=J;I=I._AC=H}if(I._length){for(var S in I)if(S!="_length"){J=
G.attr(S)||"";if(S=="style")a:{H=I[S];J=t(J,y);typeof H=="string"&&(H=g(H));typeof J=="string"&&(J=g(J));O=void 0;for(O in H)if(!(O in J&&(J[O]==H[O]||H[O]=="inherit"||J[O]=="inherit"))){H=y;break a}H=n}else H=I[S]==J;if(H){if(!K)return n}else if(K)return y}if(K)return n}else return n}if(S=h(this)[G._4e_name()]){if(!(I=S.attributes))return n;for(H=0;H<I.length;H++){S=I[H][0];if(S=G.attr(S)){J=I[H][1];if(J===x||typeof J=="string"&&S==J||J.test&&J.test(S))return n}}}return y},checkActive:function(G){switch(this.type){case m.STYLE_BLOCK:return this.checkElementRemovable(G.block||
G.blockLimit,n);case m.STYLE_OBJECT:case m.STYLE_INLINE:for(var K=G.elements,I=0,H;I<K.length;I++){H=K[I];if(!(this.type==m.STYLE_INLINE&&(z._4e_equals(H,G.block)||z._4e_equals(H,G.blockLimit))))if(!(this.type==m.STYLE_OBJECT&&!(H._4e_name()in R)))if(this.checkElementRemovable(H,n))return n}}return y}};q.getStyleText=function(G){var K=G._ST;if(K)return K;K=G.styles;var I=G.attributes&&G.attributes.style||"",H="";if(I.length)I=I.replace(T,";");for(var J in K){var O=K[J],N=(J+":"+O).replace(T,";");
if(O=="inherit")H+=N;else I+=N}if(I.length)I=t(I);I+=H;return G._ST=I};l.Style=q;l.Style=q;var V=q.prototype;l.Utils.extern(V,{apply:V.apply,remove:V.remove,applyToRange:V.applyToRange,removeFromRange:V.removeFromRange,applyToObject:V.applyToObject,checkElementRemovable:V.checkElementRemovable,checkActive:V.checkActive})});
KISSY.Editor.add("htmlparser",function(){function l(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var p=KISSY,q=function(){},v=p.Editor,u=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,r={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},k=v.XHTML_DTD;p.augment(l,{onTagOpen:q,onTagClose:q,
onText:q,onCDATA:q,onComment:q,parse:function(o){for(var i,f,d=0,b;i=this._.htmlPartsRegex.exec(o);){f=i.index;if(f>d){d=o.substring(d,f);b?b.push(d):this.onText(d)}d=this._.htmlPartsRegex.lastIndex;if(f=i[1]){f=f.toLowerCase();if(b&&k.$cdata[f]){this.onCDATA(b.join(""));b=null}if(!b){this.onTagClose(f);continue}}if(b)b.push(i[0]);else if(f=i[3]){f=f.toLowerCase();if(!/="/.test(f)){var g={},t;i=i[4];var h=!!(i&&i.charAt(i.length-1)=="/");if(i)for(;t=u.exec(i);){var c=t[1].toLowerCase();t=t[2]||t[3]||
t[4]||"";g[c]=!t&&r[c]?c:t}this.onTagOpen(f,g,h);if(!b&&k.$cdata[f])b=[]}}else if(f=i[2])this.onComment(f)}o.length>d&&this.onText(o.substring(d,o.length))}});v.HtmlParser=l;v.HtmlParser=l});
KISSY.Editor.add("htmlparser-basicwriter",function(){function l(){this._={output:[]}}var p=KISSY,q=p.Editor,v=q.Utils;p.augment(l,{openTag:function(u){this._.output.push("<",u)},openTagClose:function(u,r){r?this._.output.push(" />"):this._.output.push(">")},attribute:function(u,r){if(typeof r=="string")r=v.htmlEncodeAttr(r);this._.output.push(" ",u,'="',r,'"')},closeTag:function(u){this._.output.push("</",u,">")},text:function(u){this._.output.push(u)},comment:function(u){this._.output.push("<!--",
u,"--\>")},write:function(u){this._.output.push(u)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(u){var r=this._.output.join("");u&&this.reset();return r}});q.HtmlParser.BasicWriter=l;q.HtmlParser.BasicWriter=l;p=l.prototype;q.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,write:p.write,reset:p.reset,getHtml:p.getHtml})});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function l(){l.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=r;this.sortAttributes=u;this._.indent=r;this._.indentation="";this._.rules={};var k=q.XHTML_DTD,o;for(o in v.mix({},k.$nonBodyContent,k.$block,k.$listItem,k.$tableContent))this.setRules(o,{indent:u,breakBeforeOpen:u,breakAfterOpen:u,breakBeforeClose:!k[o]["#"],breakAfterClose:u});this.setRules("br",
{breakAfterOpen:u});this.setRules("title",{indent:r,breakAfterOpen:r});this.setRules("style",{indent:r,breakBeforeClose:u});this.setRules("pre",{indent:r})}var p=KISSY,q=p.Editor,v=q.Utils,u=true,r=false;p.extend(l,q.HtmlParser.BasicWriter,{openTag:function(k){var o=this._.rules[k];if(this._.indent)this.indentation();else if(o&&o.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",k)},openTagClose:function(k,o){var i=this._.rules[k];if(o)this._.output.push(this.selfClosingEnd);
else{this._.output.push(">");if(i&&i.indent)this._.indentation+=this.indentationChars}i&&i.breakAfterOpen&&this.lineBreak()},attribute:function(k,o){if(typeof o=="string"){this.forceSimpleAmpersand&&(o=o.replace(/&amp;/g,"&"));o=v.htmlEncodeAttr(o)}this._.output.push(" ",k,'="',o,'"')},closeTag:function(k){var o=this._.rules[k];if(o&&o.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();else if(o&&o.breakBeforeClose){this.lineBreak();
this.indentation()}this._.output.push("</",k,">");o&&o.breakAfterClose&&this.lineBreak()},text:function(k){if(this._.indent){this.indentation();k=v.ltrim(k)}this._.output.push(k)},comment:function(k){this._.indent&&this.indentation();this._.output.push("<!--",k,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=u},indentation:function(){this._.output.push(this._.indentation);this._.indent=r},setRules:function(k,o){var i=this._.rules[k];if(i)v.mix(i,
o);else this._.rules[k]=o}});q.HtmlParser.HtmlWriter=l;q.HtmlParser.HtmlWriter=l;p=l.prototype;q.Utils.extern(p,{openTag:p.openTag,openTagClose:p.openTagClose,attribute:p.attribute,closeTag:p.closeTag,text:p.text,comment:p.comment,lineBreak:p.lineBreak,indentation:p.indentation,setRules:p.setRules})});
KISSY.Editor.add("htmlparser-fragment",function(){function l(){this.children=[];this.parent=v;this._={isBlockLike:p,hasInlineStarted:q}}var p=true,q=false,v=null,u=KISSY.Editor,r={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},k=KISSY,o=u.Utils,i=u.NODE,f=u.XHTML_DTD,d=o.mix({table:1,ul:1,ol:1,dl:1},f.table,f.ul,f.ol,f.dl),b=f.$list,g=f.$listItem;l.FromHtml=function(t,h){function c(w){var B;if(n.length>0)for(var D=0;D<n.length;D++){var C=n[D],F=C.name,M=f[F],P=x.name&&f[x.name];
if((!P||P[F])&&(!w||!M||M[w]||!f[w])){if(!B){a();B=1}C=C.clone();C.parent=x;x=C;n.splice(D,1);D--}}}function a(){for(;y.length;)x.add(y.shift())}function e(w,B,D){B=B||x||s;if(h&&!B.type){var C,F;if((C=w.attributes&&(F=w.attributes._ke_real_element_type)?F:w.name)&&!(C in f.$body)&&!(C in f.$nonBodyContent)){C=x;x=B;j.onTagOpen(h,{});B=x;if(D)x=C}}if(w._.isBlockLike&&w.name!="pre"){D=w.children.length;if((C=w.children[D-1])&&C.type==i.NODE_TEXT)if(F=o.rtrim(C.value))C.value=F;else w.children.length=
D-1}B.add(w);if(w.returnPoint){x=w.returnPoint;delete w.returnPoint}}var j=new u.HtmlParser,s=new l,n=[],y=[],x=s,A=q,E;j.onTagOpen=function(w,B,D){var C=new u.HtmlParser.Element(w,B);if(C.isUnknown&&D)C.isEmpty=p;if(f.$removeEmpty[w])n.push(C);else{if(w==="pre")A=p;else if(w==="br"&&A){x.add(new u.HtmlParser.Text("\n"));return}if(w==="br")y.push(C);else{var F=x.name,M=F&&(f[F]||(x._.isBlockLike?f.div:f.span));if(M&&!C.isUnknown&&!x.isUnknown&&!M[w]){M=q;var P;if(w in b&&F in b){F=x.children;(F=F[F.length-
1])&&F.name in g||e(F=new u.HtmlParser.Element("li"),x);E=x;P=F}else if(w==F)e(x,x.parent);else{if(d[F])E||(E=x);else{e(x,x.parent,p);r[F]||n.unshift(x)}M=p}x=P?P:x.returnPoint||x.parent;if(M){j.onTagOpen.apply(this,arguments);return}}c(w);a();C.parent=x;C.returnPoint=E;E=0;if(C.isEmpty)e(C);else x=C}}};j.onTagClose=function(w){for(var B=n.length-1;B>=0;B--)if(w==n[B].name){n.splice(B,1);return}for(var D=[],C=[],F=x;F.type&&F.name!=w;){F._.isBlockLike||C.unshift(F);D.push(F);F=F.parent}if(F.type){for(B=
0;B<D.length;B++){var M=D[B];e(M,M.parent)}x=F;if(x.name=="pre")A=q;F._.isBlockLike&&a();e(F,F.parent);if(F==x)x=x.parent;n=n.concat(C)}if(w=="body")h=q};j.onText=function(w){if(!x._.hasInlineStarted&&!A){w=o.ltrim(w);if(w.length===0)return}a();c();if(h&&(!x.type||x.name=="body")&&o.trim(w))this.onTagOpen(h,{});A||(w=w.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));x.add(new u.HtmlParser.Text(w))};j.onCDATA=function(){};j.onComment=function(w){x.add(new u.HtmlParser.Comment(w))};j.parse(t);for(a();x.type;){var z=
x.parent,m=x;if(h&&(!z.type||z.name=="body")&&!f.$body[m.name]){x=z;j.onTagOpen(h,{});z=x}z.add(m);x=z}return s};k.augment(l,{add:function(t){var h=this.children.length;if(h=h>0&&this.children[h-1]||v){if(t._.isBlockLike&&h.type==i.NODE_TEXT){h.value=o.rtrim(h.value);if(h.value.length===0){this.children.pop();this.add(t);return}}h.next=t}t.previous=h;t.parent=this;this.children.push(t);this._.hasInlineStarted=t.type==i.NODE_TEXT||t.type==i.NODE_ELEMENT&&!t._.isBlockLike},writeHtml:function(t,h){var c;
this.filterChildren=this.filterChildren=function(){var a=new u.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,a,h,p);a=a.getHtml();this.children=(new l.FromHtml(a)).children;c=1};!this.name&&h&&h.onFragment(this);this.writeChildrenHtml(t,c?v:h)},writeChildrenHtml:function(t,h){for(var c=0;c<this.children.length;c++)this.children[c].writeHtml(t,h)}});u.HtmlParser.Fragment=l;u.HtmlParser.Fragment=l;l.FromHtml=l.FromHtml;k=l.prototype;u.Utils.extern(k,{add:k.add,writeHtml:k.writeHtml,writeChildrenHtml:k.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-element",function(){function l(r,k){this.name=r;this.attributes=k||(k={});this.children=[];var o=k._ke_real_element_type||r,i=p.XHTML_DTD;o=!!(i.$nonBodyContent[o]||i.$block[o]||i.$listItem[o]||i.$tableContent[o]||i.$nonEditable[o]||o=="br");var f=!!i.$empty[r];this.isEmpty=f;this.isUnknown=!i[r];this._={isBlockLike:o,hasInlineStarted:f||!o}}var p=KISSY.Editor,q=p.NODE,v=function(r,k){r=r[0];k=k[0];return r<k?-1:r>k?1:0};KISSY.augment(l,{type:q.NODE_ELEMENT,add:p.HtmlParser.Fragment.prototype.add,
clone:function(){return new l(this.name,this.attributes)},writeHtml:function(r,k){var o=this.attributes,i=this,f=i.name,d,b,g,t;i.filterChildren=function(){if(!t){var a=new p.HtmlParser.BasicWriter;p.HtmlParser.Fragment.prototype.writeChildrenHtml.call(i,a,k);i.children=(new p.HtmlParser.Fragment.FromHtml(a.getHtml())).children;t=1}};i.filterChildren=i.filterChildren;if(k){for(;;){if(!(f=k.onElementName(f)))return;i.name=f;if(!(i=k.onElement(i)))return;i.parent=this.parent;if(i.name==f)break;if(i.type!=
q.NODE_ELEMENT){i.writeHtml(r,k);return}f=i.name;if(!f){this.writeChildrenHtml.call(i,r,t?null:k);return}}o=i.attributes}r.openTag(f,o);for(var h=[],c=0;c<2;c++)for(d in o){b=d;g=o[d];if(c==1)h.push([d,g]);else if(k){for(;;)if(b=k.onAttributeName(d))if(b!=d){delete o[d];d=b}else break;else{delete o[d];break}if(b)if((g=k.onAttribute(i,b,g))===false)delete o[b];else o[b]=g}}r.sortAttributes&&h.sort(v);o=h.length;for(c=0;c<o;c++){d=h[c];r.attribute(d[0],d[1])}r.openTagClose(f,i.isEmpty);if(!i.isEmpty){this.writeChildrenHtml.call(i,
r,t?null:k);r.closeTag(f)}},writeChildrenHtml:function(){p.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});p.HtmlParser.Element=l;p.HtmlParser.Element=l;var u=l.prototype;p.Utils.extern(u,{type:u.type,add:u.add,clone:u.clone,writeHtml:u.writeHtml,writeChildrenHtml:u.writeChildrenHtml})});
KISSY.Editor.add("htmlparser-filter",function(){function l(d){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};d&&this.addRules(d,10)}function p(d,b){for(var g=0;d&&g<b.length;g++){var t=b[g];d=d.replace(t[0],t[1])}return d}function q(d,b,g){if(typeof b=="function")b=[b];var t,h;h=d.length;var c=b&&b.length;if(c){for(t=0;t<h&&d[t].pri<g;t++);for(h=c-1;h>=0;h--)if(c=b[h]){c.pri=g;d.splice(t,0,c)}}}function v(d,b,g){if(b)for(var t in b){var h=d[t];d[t]=u(h,b[t],
g);h||d.$length++}}function u(d,b,g){if(b){b.pri=g;if(d){if(d.splice)q(d,b,g);else{d=d.pri>g?[b,d]:[d,b];d.filter=r}return d}else return b.filter=b}}function r(d){for(var b=d.type||d instanceof o.HtmlParser.Fragment,g=0;g<this.length;g++){if(b)var t=d.type,h=d.name;var c=this[g].apply(window,arguments);if(c===f)return c;if(b){if(c&&(c.name!=h||c.type!=t))return c}else if(typeof c!="string")return c;c!=undefined&&(d=c)}return d}var k=KISSY,o=k.Editor,i=o.NODE,f=false;k.augment(l,{addRules:function(d,
b){if(typeof b!="number")b=10;q(this._.elementNames,d.elementNames,b);q(this._.attributeNames,d.attributeNames,b);v(this._.elements,d.elements,b);v(this._.attributes,d.attributes,b);this._.text=u(this._.text,d.text,b)||this._.text;this._.comment=u(this._.comment,d.comment,b)||this._.comment;this._.root=u(this._.root,d.root,b)||this._.root},onElementName:function(d){return p(d,this._.elementNames)},onAttributeName:function(d){return p(d,this._.attributeNames)},onText:function(d){var b=this._.text;
return b?b.filter(d):d},onComment:function(d,b){var g=this._.comment;return g?g.filter(d,b):d},onFragment:function(d){var b=this._.root;return b?b.filter(d):d},onElement:function(d){for(var b=[this._.elements["^"],this._.elements[d.name],this._.elements.$],g,t=0;t<3;t++)if(g=b[t]){g=g.filter(d,this);if(g===f)return null;if(g&&g!=d)return this.onNode(g);if(d.parent&&!d.name)break}return d},onNode:function(d){var b=d.type;return b==i.NODE_ELEMENT?this.onElement(d):b==i.NODE_TEXT?new o.HtmlParser.Text(this.onText(d.value)):
null},onAttribute:function(d,b,g){if(b=this._.attributes[b]){d=b.filter(g,d,this);if(d===f)return f;if(typeof d!="undefined")return d}return g}});o.HtmlParser.Filter=l;k=l.prototype;o.Utils.extern(k,{addRules:k.addRules,onElementName:k.onElementName,onAttributeName:k.onAttributeName,onText:k.onText,onComment:k.onComment,onFragment:k.onFragment,onElement:k.onElement,onNode:k.onNode,onAttribute:k.onAttribute});o.HtmlParser.Filter=l});
KISSY.Editor.add("htmlparser-text",function(){function l(u){this.value=u;this._={isBlockLike:v}}var p=KISSY,q=p.Editor,v=false;p.augment(l,{type:q.NODE.NODE_TEXT,writeHtml:function(u,r){var k=this.value;r&&!(k=r.onText(k,this))||u.text(k)}});q.HtmlParser.Text=l;q.HtmlParser.Text=l});
KISSY.Editor.add("htmlparser-comment",function(){function l(v){this.value=v;this._={isBlockLike:false}}var p=KISSY.Editor,q=p.NODE;p.HtmlParser.Comment=l;p.HtmlParser.Comment=l;l.prototype={constructor:l,type:q.NODE_COMMENT,writeHtml:function(v,u){var r=this.value;if(u){if(!(r=u.onComment(r,this)))return;if(typeof r!="string"){r.parent=this.parent;r.writeHtml(v,u);return}}v.comment(r)}}});
KISSY.Editor.add("button",function(){var l=KISSY,p=l.Editor;if(p.TripleButton)l.log("TripleButton attach twice","warn");else{var q=l.UIBase.create([l.UIBase.Box],{bindUI:function(){var v=this,u=v.get("el");u.on("click",v._action,v);u.on("mousedown",function(){v.get("state")=="off"&&u.addClass("ke-triplebutton-active")});u.on("mouseup mouseleave",function(){v.get("state")=="off"&&u.hasClass("ke-triplebutton-active")&&setTimeout(function(){u.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",
this.get("title"))},_uiSetContentCls:function(v){var u=this.get("el");if(v!==undefined){u.html("<span class='ke-toolbar-item "+v+"'>");u._4e_unselectable()}},_uiSetText:function(v){var u=this.get("el");v!==undefined&&u.html(v)},_uiSetState:function(v){this["_"+v]()},disable:function(){this._savedState=this.get("state");this.set("state","disabled")},enable:function(){this.get("state")=="disabled"&&this.set("state",this._savedState)},_action:function(v){this.fire(this.get("state")+"Click",{TripleEvent:v});
this.fire("click",{TripleClickType:this.get("state")+"Click"});v.preventDefault()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-disabled");v.addClass("ke-triplebutton-on")},_off:function(){var v=this.get("el");v.removeClass("ke-triplebutton-on ke-triplebutton-disabled");v.addClass("ke-triplebutton-off")},_disabled:function(){var v=this.get("el");v.removeClass("ke-triplebutton-off ke-triplebutton-on");
v.addClass("ke-triplebutton-disabled")}},{ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elAttrs:{value:{hideFocus:true,tabIndex:-1}},elTagName:{value:"a"},title:{},contentCls:{},text:{}}});q.ON="on";q.OFF="off";q.DISABLED="disabled";q.ON_CLASS="ke-triplebutton-on";q.OFF_CLASS="ke-triplebutton-off";q.DISABLED_CLASS="ke-triplebutton-disabled";p.TripleButton=q;p.prototype.addButton=function(v,u){var r=this,k=new q({render:r.toolBarDiv,autoRender:true,title:u.title,text:u.text,
contentCls:u.contentCls}),o={btn:k,editor:r,cfg:u,call:function(){var i=l.makeArray(arguments),f=i.shift();return u[f].apply(o,i)},reload:function(i){l.mix(u,i);k.enable();r.on("selectionChange",function(){r.getMode()!=p.SOURCE_MODE&&u.selectionChange&&u.selectionChange.apply(o,arguments)});k.on("click",function(f){var d=f.TripleClickType;u[d]&&u[d].apply(o,arguments)});if(u.mode==p.WYSIWYG_MODE){r.on("wysiwygmode",k.enable,k);r.on("sourcemode",k.disable,k)}u.init&&u.init.call(o)},destroy:function(){u.destroy&&
u.destroy.call(o);k.destroy()}};u.loading?k.disable():o.reload(undefined);return o}}});
KISSY.Editor.add("select",function(){function l(f){l.superclass.constructor.call(this,f);this._init()}var p=KISSY,q=p.Node,v=p.Event,u=p.DOM,r=p.Editor;if(r.Select)p.log("ke select attach more");else{l.DISABLED=0;l.ENABLED=1;var k=r.XHTML_DTD;l.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var f=this.el.parent();f;){var d=f._4e_name();if(k[d]&&k[d].div)return f;f=f.parent()}return new q(document.body)}},
state:{value:1}};l.decorate=function(f){for(var d=f.width(),b=[],g=f.all("option"),t=0;t<g.length;t++){var h=g[t];b.push({name:u.html(h),value:u.attr(h,"value")})}return new l({width:d+"px",el:f,items:b,cls:"ke-combox",value:f.val()})};var o=r.Utils.addRes,i=r.Utils.destroyRes;p.extend(l,p.Base,{_init:function(){var f=this.get("container"),d=this.get("el"),b=new q("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
g=this.get("title")||"",t=this.get("cls"),h=b.one(".ke-select-text"),c=b.one(".ke-select-text-inner");b.one(".ke-select-drop");this.get("value")!==undefined?c.html(this._findNameByV(this.get("value"))):c.html(g);h.css("width",this.get("width"));b._4e_unselectable();g&&b.attr("title",g);t&&b.addClass(t);if(d)d[0].parentNode.replaceChild(b[0],d[0]);else f&&b.appendTo(f);b.on("click",this._click,this);this.el=b;this.title=c;this._focusA=b.one("a.ke-select");r.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(f){var d=this.get("title")||"",b=this.get("items");if(this.get("showValue"))return f||d;for(var g=0;g<b.length;g++){var t=b[g];if(t.value==f){d=t.name;break}}return d},_valueChange:function(f){this.title.html(this._findNameByV(f.newVal))},_itemsChange:function(f){f=f.newVal;var d=this._selectList;d.html("");if(f)for(var b=0;b<f.length;b++){var g=f[b];(new q("<a class='ke-select-menu-item' href='#' data-value='"+
g.value+"'>"+g.name+"</a>",g.attrs)).appendTo(d)._4e_unselectable()}this.as=d.all("a")},val:function(f){if(f!==undefined){this.set("value",f);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){function f(a){a=new q(a.target);b.contains(a)||b._4e_equals(a)||h.hide()}var d=this,b=d.el,g=d.get("popUpWidth"),t=d._focusA,h=new r.Overlay({autoRender:true,render:d.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:g?
g:b.width(),zIndex:r.baseZIndex(r.zIndexManager.SELECT),focusMgr:false}),c=d.get("items");o.call(d,h);g=h.get("contentEl").one("div");d.menu=h;v.on(window,"resize",d._resize,d);o.call(d,function(){v.remove(window,"resize",d._resize,d)});d.get("title")&&(new q("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+d.get("title")+"</div>")).appendTo(g);d._selectList=(new q("<div>")).appendTo(g);d._itemsChange({newVal:c});h.on("show",function(){t.addClass("ke-select-active")});h.on("hide",
function(){t.removeClass("ke-select-active")});v.on(document,"click",f);o.call(d,function(){v.remove(document,"click",f)});d.get("doc")&&v.on(d.get("doc"),"click",f);g.on("click",d._select,d);d.as=d._selectList.all("a");v.on(g[0],"mouseenter",function(){d.as.removeClass("ke-menu-selected")});o.call(d,g);d.on("afterItemsChange",d._itemsChange,d);d.menuNode=g},_stateChange:function(f){var d=this.el;f.newVal==1?d.removeClass("ke-select-disabled"):d.addClass("ke-select-disabled")},enable:function(){this.set("state",
1)},disable:function(){this.set("state",0)},_select:function(f){f.halt();var d=this.menu,b=this.menuNode;if(f=(new q(f.target))._4e_ascendant(function(h){return b.contains(h)&&h._4e_name()=="a"},true)){var g=this.get("value"),t=f.attr("data-value");this.set("value",t);this.fire("click",{newVal:t,prevVal:g,name:f.html()});d.hide()}},_real:function(){var f=this.el,d=f.offset(),b=p.clone(d),g=this.menu.get("el").height(),t=this.menu.get("el").width(),h=u.scrollTop(),c=u.scrollLeft(),a=u.viewportHeight(),
e=u.viewportWidth();e=c+e-60;a=h+a;var j=d.top+(f.height()-2);f=d.left+f.width()-2;var s=this.get("align"),n=s[0];if(s[1]=="b"){d.top=j;if(d.top+g>a&&b.top-h>a-j)d.top=b.top-g}else{d.top=b.top-g;if(d.top<h&&b.top-h<a-j)d.top=j}if(n=="l"){if(d.left+t>e&&f-c>e-b.left)d.left=f-t}else{d.left=f-t;if(d.left<c&&f-c<e-b.left)d.left=b.left}this.menu.set("xy",[d.left,d.top]);this.menu.show()},_click:function(f){if(!this.loading){f.preventDefault();var d=this;f=d.el;var b=d.get("value");if(!f.hasClass("ke-select-disabled"))if(d._focusA.hasClass("ke-select-active"))d.menu&&
d.menu.hide();else{d.loading=true;r.use("overlay",function(){d.loading=false;d._prepare();b&&d.menu&&d.as.each(function(g){g.attr("data-value")==b?g.addClass("ke-menu-selected"):g.removeClass("ke-menu-selected")})})}}},destroy:function(){i.call(this);this.el.detach();this.el.remove()}});r.Select=l;r.prototype.addSelect=function(f,d){var b=this;d=p.mix({container:b.toolBarDiv,doc:b.document,menuContainer:new q(document.body)},d);var g=new l(d),t={btn:g,editor:b,cfg:d,call:function(){var h=p.makeArray(arguments),
c=h.shift();return d[c].apply(t,h)},reload:function(h){p.mix(d,h);g.enable();b.on("selectionChange",function(){b.getMode()!=r.SOURCE_MODE&&d.selectionChange&&d.selectionChange.apply(t,arguments)});g.on("click",function(c){var a=c.type;d[a]&&d[a].apply(t,arguments)});if(d.mode==r.WYSIWYG_MODE){b.on("wysiwygmode",g.enable,g);b.on("sourcemode",g.disable,g)}d.init&&d.init.call(t)},destroy:function(){d.destroy&&d.destroy.call(t);g.destroy()}};d.loading?g.disable():t.reload(undefined);return t}}});
KISSY.Editor.add("bubbleview",function(){var l=KISSY,p=l.Editor,q=l.Event,v=l.DOM;if(p.BubbleView)l.log("attach bubbleview more","warn");else{var u=l.UIBase.create(p.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var k=this._selectedEl,o=k._4e_getOffset(document);o.top+=k.height()+5;u.superclass.show.call(this);this.set("xy",[o.left,o.top])},destructor:function(){p.Utils.destroyRes.call(this)}},{ATTRS:{focus4e:false,zIndex:{value:p.baseZIndex(p.zIndexManager.BUBBLE_VIEW)}}}),
r={};u.destroy=function(k){if((k=r[k])&&k.bubble){k.bubble.destroy();k.bubble=null}};u.attach=function(k){var o=k.pluginName;l.mix(k,r[o].cfg,false);var i=k.pluginContext,f=k.func,d=k.editor,b=k.bubble;d.on("selectionChange",function(g){g=g.path;var t=g.elements;if(g&&t)if(g=g.lastElement)if(g=f(g)){t=r[o];if(!t.bubble){t.bubble=new u({autoRender:true});t.cfg.init&&t.cfg.init.call(t.bubble)}b=t.bubble;b._selectedEl=g;b._plugin=i;b.hide();b.show()}else if(b){b._selectedEl=b._plugin=null;b.hide()}});
q.on(v._4e_getWin(d.document),"scroll blur",function(){b&&b.hide()})};u.register=function(k){var o=k.pluginName;r[o]=r[o]||{cfg:k};q.on(document,"click",function(){k.bubble&&k.bubble.hide()});k.editor&&u.attach(k)};p.BubbleView=u}},{attach:false,requires:["overlay"]});
KISSY.Editor.add("clipboard",function(l){var p=KISSY,q=p.Editor,v=p.Node,u=p.UA,r=q.Range,k=q.RANGE,o=p.Event;q.Paste||function(){function i(a){this.editor=a;this._init()}function f(a){if(!(!u.ie||a.document.compatMode=="BackCompat")){var e=a.getSelection(),j;if(e.getType()==h.SELECTION_ELEMENT&&(j=e.getSelectedElement())){var s=e.getRanges()[0],n=new v(a.document.createTextNode(""));n.insertBefore(j);s.setStartBefore(n);s.setEndAfter(j);e.selectRanges([s]);setTimeout(function(){if(j.parent()){n.remove();
e.selectElement(j)}},0)}}}p.augment(i,{_init:function(){var a=this.editor;u.ie?o.on(a.document,"keydown",this._paste,this):o.on(a.document,"paste",this._paste,this);a.addCommand("copy",new t("copy"));a.addCommand("cut",new t("cut"));a.addCommand("paste",new t("paste"))},_paste:function(a){if(!(a.type==="keydown"&&!(a.keyCode===86&&(a.ctrlKey||a.metaKey)))){var e=this,j=e.editor,s=j.document;if(e._running)a.halt();else{var n=j.getSelection();a=new r(s);var y=new v(u.webkit?"<body></body>":"<div></div>",
null,s);u.webkit&&y[0].appendChild(s.createTextNode("\u00a0"));s.body.appendChild(y[0]);y.css({position:"absolute",top:n.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});y.css("left","-1000px");var x=n.createBookmarks();a.setStartAt(y,k.POSITION_AFTER_START);a.setEndAt(y,k.POSITION_BEFORE_END);a.select(true);e._running=true;setTimeout(function(){y._4e_remove();var A;y=u.webkit&&(A=y._4e_first())&&A.hasClass("Apple-style-span")?A:y;n.selectBookmarks(x);A=y.html();var E=j.fire("paste",
{html:A,holder:y});if(E!==undefined)A=E;j.insertHtml(A);e._running=false},0)}}}});q.Paste=i;var d=function(a,e){var j=a.document,s=new v(j.body),n=false,y=function(){n=true};s.on(e,y);(u.ie>7?j:j.selection.createRange()).execCommand(e);s.detach(e,y);return n},b=u.ie?function(a,e){return d(a,e)}:function(a,e){try{return a.document.execCommand(e)}catch(j){return false}},g={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},
t=function(a){this.type=a;this.canUndo=this.type=="cut"};t.prototype={exec:function(a){this.type=="cut"&&f(a);(a=b(a,this.type))||alert(g[this.type]);return a}};var h=q.Selection,c={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};q.on("contextmenu",function(a){var e=a.contextmenu,j=e.cfg.editor,s=e.elDom,n={copy:0,cut:0,paste:0},y;for(y in n){if(!n.hasOwnProperty(y))break;n[y]=s.one(".ke-paste-"+y);(function(x){var A=n[x];if(!A){A=(new v("<a href='#'class='ke-paste-"+x+"'>"+c[x]+"</a>")).appendTo(s);A.on("click",
function(E){E.halt();if(!A.hasClass("ke-menuitem-disable")){e.hide();setTimeout(function(){j.execCommand(x)},30)}})}n[x]=A})(y);a=n[y];(j.document.queryCommandEnabled(y)?true:false)?a.removeClass("ke-menuitem-disable"):a.addClass("ke-menuitem-disable")}})}();new q.Paste(l)},{attach:false});
KISSY.Editor.add("color",function(l){l.addPlugin("color",function(){var p=KISSY.Editor,q=l.cfg.pluginConfig,v=[];false!==q.forecolor&&function(){var u=l.addButton("color",{styles:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},mode:p.WYSIWYG_MODE,title:"\u6587\u672c\u989c\u8272",loading:true,contentCls:"ke-toolbar-color"});p.use("colorsupport",function(){u.reload(p.ColorSupport)});v.push(function(){u.destroy()})}();false!==q.bgcolor&&function(){var u=l.addButton("color",
{styles:{element:"span",styles:{"background-color":"#(color)"}},title:"\u80cc\u666f\u989c\u8272",mode:p.WYSIWYG_MODE,loading:true,contentCls:"ke-toolbar-bgcolor"});p.use("colorsupport",function(){u.reload(p.ColorSupport)});v.push(function(){u.destroy()})}();this.destroy=function(){for(var u=0;u<v.length;u++)v[u]()}})},{attach:false});
KISSY.Editor.add("colorsupport",function(){function l(){if(!o){o="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var d=0;d<3;d++){o+="<div class='ke-color-palette'><table>";for(var b=k[d],g=b.length/8,t=0;t<g;t++){o+="<tr>";for(var h=0;h<8;h++){var c="#"+b[8*t+h];o+="<td>";o+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+c+"'></a>";o+="</td>"}o+="</tr>"}o+="</table></div>"}o+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
var p=KISSY,q=p.Editor,v=p.Node,u=p.Event,r=p.DOM;r.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var k=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],o,i=q.Utils.addRes,f=q.Utils.destroyRes;q.ColorSupport={offClick:function(d){var b=this,g=b.cfg;q.use("overlay",function(){g._prepare.call(b,d)})},onClick:function(){this.colorWin&&this.colorWin.hide()},_prepare:function(){var d=this,b=d.cfg,g=document,t=d.btn,h=d.editor,c;l();d.colorWin=new q.Overlay({elCls:"ks-popup",content:o,focus4e:false,autoRender:true,width:"170px",zIndex:q.baseZIndex(q.zIndexManager.POPUP_MENU)});var a=d.colorWin;c=a.get("contentEl");
c.on("click",b._selectColor,d);u.on(g,"click",b._hidePanel,d);u.on(h.document,"click",b._hidePanel,d);a.on("show",t.bon,t);a.on("hide",t.boff,t);g=c.one(".ke-color-others");g.on("click",function(e){e.halt();a.hide();h.useDialog("color/dialog",function(j){j.show(d)})});b._prepare=b._show;b._show.call(d);i.call(d,c,a,g)},_show:function(){var d=this.btn.get("el"),b=this.colorWin,g=parseInt(b.get("width")),t=r.viewportWidth();b.align(d,["bl","tl"],[0,2]);b.get("x")+g>t-30&&b.set("x",t-30-g);b.show()},
_hidePanel:function(d){var b=this.btn.get("el");d=new v(d.target);var g=this.colorWin;b._4e_equals(d)||b.contains(d)||g.hide()},_selectColor:function(d){d.halt();var b=this.cfg;d=new v(d.target);if(d._4e_name()=="a"&&!d.hasClass("ke-button")){b._applyColor.call(this,d._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(d){var b=this.editor,g=b.document,t=this.cfg.styles;b.fire("save");d?(new q.Style(t,{color:d})).apply(g):(new q.Style(t,{color:"inherit"})).remove(g);b.fire("save")},
destroy:function(){f.call(this);var d=this.editor;u.remove(document,"click",this.cfg._hidePanel,this);d.destroyDialog("color/dialog")}}});
KISSY.Editor.add("contextmenu",function(){function l(f){this.cfg=f;q.Utils.lazyRun(this,"_prepareShow","_realShow")}function p(f,d){for(var b=0;b<d.length;b++){var g=d[b];if(v.isFunction(g)){if(g(new u(f)))return true}else if(r.test(f,g))return true}return false}var q=KISSY.Editor,v=KISSY,u=v.Node,r=v.DOM,k=v.Event;if(q.ContextMenu)v.log("attach ContextMenu twice","warn");else{l.ATTRS={editor:{}};var o=[];l.register=function(f){var d=new l(f),b=f.editor.document;o.push({doc:b,rules:f.rules||[],instance:d});
if(!b.ke_contextmenu){b.ke_contextmenu=1;k.on(b,"mousedown",l.hide);k.on(b,"contextmenu",function(g){l.hide.call(this);for(var t=new u(g.target);t;){var h=false;if(t._4e_name()=="body")break;for(var c=0;c<o.length;c++){var a=o[c].instance,e=o[c].rules;if(b===o[c].doc&&p(t[0],e)){g.preventDefault();h=true;var j=g.pageX,s=g.pageY;if(!j){c=t._4e_getOffset();j=c.left;s=c.top}setTimeout(function(){a.show(q.Utils.getXY(j,s,b,document))},30);break}}if(h)break;t=t.parent()}})}return d};l.hide=function(){for(var f=
0;f<o.length;f++){var d=o[f].instance;this===o[f].doc&&d.hide()}};var i=q.Overlay;v.augment(l,{_init:function(){var f=this,d=f.cfg,b=d.funcs;f.el=new i({content:"<div>",autoRender:true,width:d.width,elCls:"ke-menu"});f.elDom=f.el.get("contentEl").one("div");d=f.elDom;for(var g in b){var t=new u("<a href='#'>"+g+"</a>");d[0].appendChild(t[0]);(function(h,c){h._4e_unselectable();h.on("click",function(a){f.hide();a.halt();setTimeout(c,30)})})(t,b[g])}},destroy:function(){if(this.el){this.elDom.children().detach();
this.el.destroy()}},hide:function(){this.el&&this.el.hide()},_realShow:function(f){q.fire("contextmenu",{contextmenu:this});this.el.set("xy",[f.left,f.top]);this.el.show()},_prepareShow:function(){this._init()},show:function(f){this._prepareShow(f)}});q.ContextMenu=l}},{attach:false,requires:["overlay"]});
KISSY.Editor.add("draft",function(l){var p=KISSY.Editor;l.addPlugin("draft",function(){var q=this;p.use("draft/support",function(){p.storeReady(function(){var v=new p.Draft(l);q.destroy=function(){v.destroy()}})})})},{attach:false});
KISSY.Editor.add("draft/support",function(){function l(b,g,t){for(b+="";b.length<g;)b=t+b;return b}function p(b){if(v.isNumber(b))b=new Date(b);return b instanceof Date?[b.getFullYear(),"-",l(b.getMonth()+1,2,"0"),"-",l(b.getDate(),2,"0")," ",l(b.getHours(),2,"0"),":",l(b.getMinutes(),2,"0"),":",l(b.getSeconds(),2,"0")].join(""):b}function q(b){this.editor=b;this._init()}var v=KISSY,u=v.Editor,r=v.Node,k=v.Event,o=v.JSON,i=window[u.STORE],f=u.Utils.addRes,d=u.Utils.destroyRes;v.augment(q,{_init:function(){var b=
this,g=b.editor,t=g.statusDiv,h=g.cfg.pluginConfig;h.draft=h.draft||{};b.draftInterval=h.draft.interval=h.draft.interval||5;b.draftLimit=h.draft.limit=h.draft.limit||5;t=(new r("<div class='ke-draft'><spa class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+h.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(t);b.timeTip=(new r("<span class='ke-draft-time'>")).appendTo(t);var c=(new r("<a class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).appendTo(t),
a=new u.Select({container:t,menuContainer:document.body,doc:g.document,width:"85px",popUpWidth:"225px",align:["r","t"],title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"}),e=i.getItem("ke-draft-save"),j=[];b.versions=a;if(e)j=v.isString(e)?o.parse(decodeURIComponent(e)):e;b.drafts=j;b.sync();c.on("click",function(){b.save(false)});f.call(b,c);g.textarea[0].form&&function(){function n(){b.save(false)}var y=g.textarea[0].form;k.on(y,"submit",n);f.call(b,function(){k.remove(y,"submit",n)})}();var s=setInterval(function(){b.save(true)},
b.draftInterval*60*1E3);f.call(b,function(){clearInterval(s)});a.on("click",b.recover,b);f.call(b,a);b.holder=t;if(h.draft.helpHtml){h=new u.TripleButton({cls:"ke-draft-help",title:"\u5e2e\u52a9",text:"\u5e2e\u52a9",container:t});h.on("click",function(){b._prepareHelp()});f.call(b,h);u.Utils.lazyRun(b,"_prepareHelp","_realHelp");b.helpBtn=h.el}b._holder=t;f.call(b,t)},_prepareHelp:function(){function b(){var e=new r(ev.target);e[0]==h[0]||h.contains(e)||g._help.hide()}var g=this,t=g.editor,h=g.helpBtn,c=new r(t.cfg.pluginConfig.draft.helpHtml||
""),a=new r("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");c.append(a);c.css({border:"1px solid #ACB4BE","text-align":"left"});
g._help=new v.Overlay({content:c,autoRender:true,width:c.width()+"px",mask:false});g._help.el.css("border","none");g._help.arrow=a;k.on([document,t.document],"click",b);f.call(g,g._help,function(){k.remove([document,t.document],"click",b)})},_realHelp:function(){var b=this._help,g=this.helpBtn,t=b.arrow;b.show();g=g.offset();b.el.offset({left:g.left-b.el.width()+17,top:g.top-b.el.height()-7});t.offset({left:g.left-2,top:g.top-8})},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility",
"")},sync:function(){var b=this.draftLimit,g=this.timeTip,t=this.versions,h=this.drafts;h.length>b&&h.splice(0,h.length-b);b=[];for(var c,a=0;a<h.length;a++){c=h[a];c=(c.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+p(c.date);b.push({name:c,value:a})}t.set("items",b.reverse());g.html(c);i.setItem("ke-draft-save",encodeURIComponent(o.stringify(h)))},save:function(b){var g=this.drafts,t=this.editor.getData(true);if(t){if(g[g.length-1]&&t==g[g.length-1].content)g.length-=1;this.drafts=g.concat({content:t,date:(new Date).getTime(),
auto:b});this.sync()}},recover:function(b){var g=this.editor,t=this.drafts;b=b.newVal;this.versions.reset("value");if(confirm("\u786e\u8ba4\u6062\u590d "+p(t[b].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){g.fire("save");g.setData(t[b].content);g.fire("save")}},destroy:function(){d.call(this)}});u.Draft=q},{requires:["localstorage"]});
KISSY.Editor.add("dragupload",function(l){function p(a){a=a.originalEvent.target;if(v.DOM._4e_name(a)=="img"&&a.src.match(/^file:\/\//))h[a.src]=a}function q(a,e){var j=new FileReader;j.onload=function(s){var n=a.name;s=s.target.result;var y=new XMLHttpRequest;y.open("POST",b,true);y.onreadystatechange=function(){if(y.readyState==4){if(y.status==200||y.status==304){if(y.responseText!=""){var E=v.JSON.parse(y.responseText);e[0].src=E.imgUrl}}else{alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01");e._4e_remove();v.log(y)}y.onreadystatechange=
null}};var x="\r\n------kissy-editor-2.1\r\n";x+='Content-Disposition: form-data; name="'+i+'"; filename="'+encodeURIComponent(n)+'"\r\n';x+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";x+=s+"\r\n";d=u.Utils.normParams(d);for(var A in d)if(d.hasOwnProperty(A)){x+="------kissy-editor-2.1\r\n";x+='Content-Disposition: form-data; name="'+A+'"\r\n\r\n';x+=d[A]+"\r\n"}x+="------kissy-editor-2.1--";y.setRequestHeader("Content-Type","multipart/form-data, boundary=----kissy-editor-2.1");
y.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-2.1\r\nContent-Length: "+x.length+"\r\n"+x+"\r\n");j.onload=null};j.readAsBinaryString(a)}var v=KISSY,u=v.Editor,r=v.Node,k=v.Event,o=l.cfg.pluginConfig.dragupload||{},i=o.fileInput||"Filedata",f=o.sizeLimit||Number.MAX_VALUE,d=o.serverParams||{},b=o.serverUrl||"",g=RegExp((o.surfix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),t=l.document,h={},c=false;k.on(t,"dragenter",function(){if(!c){k.on(t,"DOMNodeInserted",p);
c=true}});k.on(t,"dragenter dragover",function(a){a.halt()});k.on(t,"drop",function(a){k.remove(t,"DOMNodeInserted",p);c=false;a.halt();a=a.originalEvent;v.log(a);var e,j;if(v.isEmptyObject(h)){j=t.elementFromPoint(a.clientX,a.clientY);e=j.lastChild}else{v.each(h,function(x){if(v.DOM._4e_name(x)=="img"){e=x.nextSibling;j=x.parentNode;v.DOM._4e_remove(x)}});h={}}a=a.dataTransfer;a.dropEffect="copy";if(a=a.files)for(var s=0;s<a.length;s++){var n=a[s],y=n.size;if(n.name.match(g))if(!(y/1E3>f)){y=new r("<img src='"+
(u.Config.base+"../theme/loading.gif")+"'/>");j.insertBefore(y[0],e);q(n,y)}}});if(window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary)XMLHttpRequest.prototype.sendAsBinary=function(a,e){for(var j=new BlobBuilder,s=a.length,n=new Uint8Array(s),y=0;y<s;y++)n[y]=a.charCodeAt(y);j.append(n.buffer);this.send(j.getBlob(e))}},{attach:false});
KISSY.Editor.add("elementpaths",function(l){var p=KISSY.Editor,q=KISSY,v=q.Node,u=q.DOM;p.ElementPaths||function(){function r(k){this.cfg=k;this._cache=[];this._init()}u.addStyleSheet(".elementpath {   padding: 0 5px;    text-decoration: none;}.elementpath:hover {    background: #CCFFFF;    text-decoration: none;}","ke-ElementPaths");q.augment(r,{_init:function(){var k=this.cfg.editor;this.holder=new v("<span>");this.holder.appendTo(k.statusDiv);k.on("selectionChange",this._selectionChange,this);
p.Utils.sourceDisable(k,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(k){var o=this.cfg.editor,i=this.holder;k=k.path.elements;var f,d;f=this._cache;for(d=0;d<f.length;d++){f[d].detach("click");f[d]._4e_remove()}this._cache=[];for(d=0;d<k.length;d++){f=k[d];var b=new v("<a href='#' class='elementpath'>"+(f.attr("_ke_real_element_type")||f._4e_name())+"</a>");this._cache.push(b);(function(g){b.on("click",
function(t){t.halt();o.focus();setTimeout(function(){o.getSelection().selectElement(g)},50)})})(f);i.prepend(b)}},destroy:function(){this.holder.remove()}});p.ElementPaths=r}();l.addPlugin("elementpaths",function(){var r=new p.ElementPaths({editor:l});this.destroy=function(){r.destroy()}})},{attach:false});
KISSY.Editor.add("enterkey",function(l){var p=KISSY,q=p.Editor,v=p.UA,u=/^h[1-6]$/,r=q.XHTML_DTD,k=p.Node,o=p.Event,i=q.Walker,f=q.ElementPath;q.enterBlock||function(){function d(b){o.on(b.document,"keydown",function(g){if(g.keyCode===13)if(!g.shiftKey){b.fire("save");var t=b.execCommand("enterBlock");b.fire("save");t!==false&&g.preventDefault()}})}d.enterBlock=function(b){var g;g=b.getSelection().getRanges();for(var t=g.length-1;t>0;t--)g[t].deleteContents();g=g[0];t=g.document;if(g.checkStartOfBlock()&&
g.checkEndOfBlock()){var h=(new f(g.startContainer)).block;if(h&&(h._4e_name()=="li"||h.parent()._4e_name()=="li"))if(b.hasCommand("outdent")){b.fire("save");b.execCommand("outdent");b.fire("save");return true}else return false}var c=g.splitBlock("p");if(!c)return true;b=c.previousBlock;h=c.nextBlock;var a=c.wasStartOfBlock,e=c.wasEndOfBlock,j;if(h){j=h.parent();if(j._4e_name()=="li"){h._4e_breakParent(j);h._4e_move(h._4e_next(),true)}}else if(b&&(j=b.parent())&&j._4e_name()=="li"){b._4e_breakParent(j);
g.moveToElementEditablePosition(b._4e_next());b._4e_move(b._4e_previous())}if(!a&&!e){if(h._4e_name()=="li"&&(j=h._4e_first(i.invisible(true)))&&p.inArray(j._4e_name(),["ul","ol"]))(v.ie?new k(t.createTextNode("\u00a0")):new k(t.createElement("br"))).insertBefore(j);h&&g.moveToElementEditablePosition(h)}else{var s;if(b){if(b._4e_name()=="li"||!u.test(b._4e_name()))s=b._4e_clone()}else if(h)s=h._4e_clone();s||(s=new k("<p>",null,t));if(j=c.elementPath){c=0;for(var n=j.elements.length;c<n;c++){var y=j.elements[c];
if(y._4e_equals(j.block)||y._4e_equals(j.blockLimit))break;if(r.$removeEmpty[y._4e_name()]){y=y._4e_clone();s._4e_moveChildren(y);s.append(y)}}}v.ie||s._4e_appendBogus();g.insertNode(s);if(v.ie&&a&&(!e||!b[0].childNodes.length)){g.moveToElementEditablePosition(e?b:s);g.select()}g.moveToElementEditablePosition(a&&!e?h:s)}if(!v.ie)if(h){s=new k(t.createElement("span"));s.html("&nbsp;");g.insertNode(s);s._4e_scrollIntoView();g.deleteContents()}else s._4e_scrollIntoView();g.select();return true};q.EnterKey=
d}();l.addCommand("enterBlock",{exec:q.EnterKey.enterBlock});q.EnterKey(l)},{attach:false});
KISSY.Editor.add("fakeobjects",function(l){var p=KISSY.Editor,q=KISSY,v=q.Node,u=p.NODE,r=p.Config.base+"../theme/spacer.gif",k=p.HtmlParser;p=q.Editor;var o=l.htmlDataProcessor,i=o&&o.htmlFilter,f={elements:{$:function(d){var b=d.attributes;if((b=(b=(b=b&&b._ke_realelement)&&new k.Fragment.FromHtml(decodeURIComponent(b)))&&b.children[0])&&d.attributes._ke_resizable){var g=d.attributes.style;if(g){var t=/(?:^|\s)width\s*:\s*(\d+)/i.exec(g);d=t&&t[1];g=(t=/(?:^|\s)height\s*:\s*(\d+)/i.exec(g))&&t[1];
if(d)b.attributes.width=d;if(g)b.attributes.height=g}}return b}}};i&&i.addRules(f);o&&q.mix(o,{createFakeParserElement:function(d,b,g,t,h){var c;c=new k.BasicWriter;d.writeHtml(c);c=c.getHtml();var a=d.attributes.style;if(d.attributes.width)a="width:"+d.attributes.width+"px;"+a;if(d.attributes.height)a="height:"+d.attributes.height+"px;"+a;d={"class":b,src:r,_ke_realelement:encodeURIComponent(c),_ke_real_node_type:d.type,style:a,align:d.attributes.align||""};h&&delete h.width;h&&delete h.height;h&&
q.mix(d,h,false);if(g)d._ke_real_element_type=g;if(t)d._ke_resizable=t;return new k.Element("img",d)}});l.createFakeElement||q.augment(p,{createFakeElement:function(d,b,g,t,h,c){var a=d.attr("style")||"";if(d.attr("width"))a="width:"+d.attr("width")+"px;"+a;if(d.attr("height"))a="height:"+d.attr("height")+"px;"+a;d={"class":b,src:r,_ke_realelement:encodeURIComponent(h||d._4e_outerHtml()),_ke_real_node_type:d[0].nodeType,style:a};c&&delete c.width;c&&delete c.height;c&&q.mix(d,c,false);if(g)d._ke_real_element_type=
g;if(t)d._ke_resizable=t;return new v("<img/>",d,this.document)},restoreRealElement:function(d){if(d.attr("_ke_real_node_type")!=u.NODE_ELEMENT)return null;d=decodeURIComponent(d.attr("_ke_realelement"));var b=new v("<div>",null,this.document);b.html(d);return b._4e_first(function(g){return g[0].nodeType==u.NODE_ELEMENT})._4e_remove()}})},{attach:false});
KISSY.Editor.add("flash",function(l){var p=KISSY.Editor,q=l.htmlDataProcessor,v=l.cfg.pluginConfig,u=q&&q.dataFilter;u&&u.addRules({elements:{object:function(r){var k=r.attributes;if(!(k.classid&&String(k.classid).toLowerCase())){for(k=0;k<r.children.length;k++)if(r.children[k].name=="embed"){if(!p.Utils.isFlashEmbed(r.children[k]))break;return q.createFakeParserElement(r,"ke_flash","flash",true)}return null}return q.createFakeParserElement(r,"ke_flash","flash",true)},embed:function(r){if(!p.Utils.isFlashEmbed(r))return null;
return q.createFakeParserElement(r,"ke_flash","flash",true)}}},5);l.addPlugin("flash",function(){var r;if(!v.flash||v.flash.btn!==false)r=l.addButton("flash",{contentCls:"ke-toolbar-flash",title:"\u63d2\u5165Flash",mode:p.WYSIWYG_MODE,loading:true});p.use("flash/support",function(){var k=new p.Flash(l);r&&r.reload({offClick:function(){k.show()},destroy:function(){k.destroy()}})});this.destroy=function(){r.destroy()}})},{attach:false,requires:["fakeobjects"]});
KISSY.Editor.add("flash/support",function(){function l(g){this.editor=g;this._init()}function p(g){return g._4e_name()==="img"&&!!g.hasClass(f)&&g}var q=KISSY,v=q.Editor,u=q.UA,r=q.Event,k=v.ContextMenu,o=q.Node,i=v.BubbleView,f="ke_flash",d=v.Utils.flash;q.augment(l,{_config:function(){this._cls=f;this._type="flash";this._contextMenu=b;this._flashRules=["img."+f]},_init:function(){this._config();var g=this,t=g.editor,h={},c=g._contextMenu;if(c)for(var a in c)(function(e){h[e]=function(){c[e](g)}})(a);
g._contextMenu=k.register({editor:t,rules:g._flashRules,width:"120px",funcs:h});i.attach({pluginName:g._type,editor:g.editor,pluginContext:g});r.on(t.document,"dblclick",g._dbclick,g)},_getFlashUrl:function(g){return d.getUrl(g)},_updateTip:function(g,t){var h=this.editor.restoreRealElement(t);if(h){h=this._getFlashUrl(h);g.html(h);g.attr("href",h)}},_dbclick:function(g){var t=new o(g.target);if(t._4e_name()==="img"&&t.hasClass(this._cls)){this.show(null,t);g.halt()}},show:function(g,t){this.editor.useDialog(this._type+
"/dialog",function(h){h.show(t)})},destroy:function(){var g=this.editor;this._contextMenu.destroy();i.destroy(this._type);r.remove(g.document,"dblclick",this._dbclick,this);g.destroyDialog(this._type+"/dialog")}});v.Flash=l;l.registerBubble=function(g,t,h){i.register({pluginName:g,func:h,init:function(){var c=this,a=c.get("contentEl");a.html(t+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var e=a.one(".ke-bubbleview-url"),j=a.one(".ke-bubbleview-change"),s=a.one(".ke-bubbleview-remove");v.Utils.preventFocus(a);j.on("click",function(n){c._plugin.show(null,c._selectedEl);n.halt()});s.on("click",function(n){var y=c._plugin;if(u.webkit){var x=y.editor.getSelection().getRanges();x&&x[0]&&(x[0].collapse(true)||1)&&x[0].select()}c._selectedEl._4e_remove();c.hide();y.editor.notifySelectionChange();n.halt()});v.Utils.addRes.call(c,j,s);c.on("show",function(){var n=c._selectedEl;n&&c._plugin._updateTip(e,
n)})}})};l.registerBubble("flash","Flash \u7f51\u5740\uff1a ",p);l.checkFlash=p;var b={"Flash\u5c5e\u6027":function(g){var t=g.editor.getSelection();t=t&&t.getStartElement();(t=p(t))&&g.show(null,t)}};l.CLS_FLASH=f;l.TYPE_FLASH="flash";l.Insert=function(g,t,h,c,a,e){t=d.createSWF(t,{attrs:h},g.document);var j=t.el;h=g.createFakeElement?g.createFakeElement(j,c||"ke_flash",a||"flash",true,t.html,h):j;g.insertElement(h,null,e)};v.Flash=l},{requires:["bubbleview","contextmenu","flashutils"]});
KISSY.Editor.add("flashbridge",function(){function l(d){this._init(d)}function p(d){var b=v.isString(d)?d.match(/(\d)+/g):d;d=d;if(v.isArray(b))d=parseFloat(b[0]+"."+q(b[1],3)+q(b[2],5));return d||0}function q(d,b){for(var g=(d+"").length;g++<b;)d="0"+d;return d}var v=KISSY,u=v.Editor;if(u.FlashBridge)v.log("KE.FlashBridge attach more","warn");else{var r={};v.augment(l,v.EventTarget,{_init:function(d){var b=v.guid("flashbridge-");d.flashVars=d.flashVars||{};d.attrs=d.attrs||{};d.params=d.params||
{};var g=d.flashVars,t=d.params;v.mix(d.attrs,{id:b,width:"100%",height:"100%"},false);v.mix(t,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);v.mix(g,{shareData:false,useCompression:false},false);t={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};if(d.ajbridge)t={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};v.mix(g,t);r[b]=this;this.id=b;this.swf=u.Utils.flash.createSWFRuntime(d.movie,d);this._expose(d.methods)},_expose:function(d){for(var b=
this,g=0;g<d.length;g++)(function(t){b[t]=function(){return b._callSWF(t,v.makeArray(arguments))}})(d[g])},_callSWF:function(d,b){b=b||[];try{if(this.swf[d])return this.swf[d].apply(this.swf,b)}catch(g){var t="";if(b.length!==0)t="'"+b.join("', '")+"'";return(new Function("self","return self.swf."+d+"("+t+");"))(this)}},_eventHandler:function(d){var b=d.type;if(b==="log")v.log(d.message);else b&&this.fire(b,d)},_destroy:function(){delete r[this.id]}});l.EventHandler=function(d,b){var g=r[d];g&&setTimeout(function(){g._eventHandler.call(g,
b)},100)};u.FlashBridge=l;var k=v.UA,o,i,f=true;k.fpv=function(d){if(d||f){f=false;var b;if(navigator.plugins&&navigator.mimeTypes.length)b=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{b=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(g){}o=b?b.match(/(\d)+/g):void 0;i=p(o)}return o};k.fpvGEQ=function(d,b){f&&k.fpv(b);return!!i&&i>=p(d)}}});
KISSY.Editor.add("flashutils",function(){var l=KISSY,p=l.Editor,q=p.Utils.flash;if(q)l.log("flashUtils attach more");else{var v=l.DOM,u=l.Node,r=l.UA;q={getUrl:function(k){var o="",i=p.NODE;if(k._4e_name()=="object"){k=k[0].childNodes;for(var f=0;f<k.length;f++)if(k[f].nodeType==i.NODE_ELEMENT)if((v.attr(k[f],"name")||"").toLowerCase()=="movie")o=v.attr(k[f],"value");else if(v._4e_name(k[f])=="embed")o=v.attr(k[f],"src");else if(v._4e_name(k[f])=="object")o=v.attr(k[f],"data")}else if(k._4e_name()==
"embed")o=k.attr("src");return o},createSWF:function(k,o,i){var f=o.attrs||{},d=o.flashVars,b="",g="";o=o.params||{};var t="";i=i||document;l.mix(f,{wmode:"transparent"});for(var h in f)if(f.hasOwnProperty(h))b+=h+"='"+f[h]+"' ";l.mix(o,{quality:"high",movie:k,wmode:"transparent"});for(var c in o)if(o.hasOwnProperty(c))g+="<param name='"+c+"' value='"+o[c]+"'/>";if(d){for(var a in d)if(d.hasOwnProperty(a))t+="&"+a+"="+encodeURIComponent(d[a]);t=t.substring(1)}k="<object "+b+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
g+(t?'<param name="flashVars" value="'+t+'"/>':"")+"<embed "+b+" "+(t?'FlashVars="'+t+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+k+'"  type="application/x-shockwave-flash"/></object>';return{el:new u(k,null,i),html:k}},createSWFRuntime2:function(k,o,i){i=i||document;var f=(new u("<div style='width:0;height:0;overflow:hidden;'>",null,i)).appendTo(i.body);f=q.createSWF.apply(this,arguments).el.appendTo(f);r.ie||(f=f.one("object"));return f[0]},createSWFRuntime:function(k,
o,i){var f=o.attrs||{},d=o.flashVars||{},b=o.params||{},g="",t="",h="";i=i||document;f.id=f.id||l.guid("ke-runtimeflash-");for(var c in f)if(f.hasOwnProperty(c))g+=c+"='"+f[c]+"' ";for(var a in b)if(b.hasOwnProperty(a))t+="<param name='"+a+"' value='"+b[a]+"'/>";for(var e in d)if(d.hasOwnProperty(e))h+="&"+e+"="+encodeURIComponent(d[e]);h=h.substring(1);k=r.ie?"<object "+g+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+t+'<param name="movie" value="'+k+'" />'+(h?'<param name="flashVars" value="'+
h+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+k+"' "+g+">"+t+(h?'<param name="flashVars" value="'+h+'"/>':"")+"</object>";var j=o.holder;if(!j){j=(new u("<div style='"+(o.style?o.style:"width:1px;height:1px;position:absolute;"+ +"overflow:hidden;")+"'>",null,i)).appendTo(i.body);setTimeout(function(){j.offset({left:v.scrollLeft(),top:v.scrollTop()})},100)}j.html(k);return i.getElementById(f.id)}};p.Utils.flash=q}});
KISSY.Editor.add("font",function(l){l.addPlugin("font",function(){function p(s){for(var n=[],y=0;y<s.length;y++)n.push({name:s[y],value:s[y]});return n}var q=KISSY,v=q.Editor,u=v.Style,r=v.TripleButton,k=l.cfg.pluginConfig,o=k["font-size"],i,f,d,b=[];if(o!==false){o=o||{};q.mix(o,{items:p(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var g={},t=[],h={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};
for(j=0;j<o.items.length;j++){i=o.items[j];f=i.name;d=i.attrs;i=i.value;g[i]=new u(h,{size:i});t.push({name:f,value:i,attrs:d})}k["font-size"]=o}h=k["font-family"];if(h!==false){h=h||{};q.mix(h,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},
{name:"Arial",value:"Arial"},{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var c={},a=[],e={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]},j;k["font-family"]=h;for(j=0;j<h.items.length;j++){i=h.items[j];f=i.name;d=i.attrs||{};i=i.value;d.style=d.style||"";d.style+=";font-family:"+i;c[i]=new u(e,{family:i});a.push({name:f,value:i,attrs:d})}}f={click:function(s){var n=s.newVal;s=s.prevVal;var y=this.cfg.styles;
l.focus();l.fire("save");y=y[n];if(n==s){y.remove(l.document);this.btn.set("value","")}else y.apply(l.document);l.fire("save")},selectionChange:function(s){s=s.path.elements;for(var n=this.cfg.styles,y=0,x;y<s.length;y++){x=s[y];for(var A in n)if(n[A].checkElementRemovable(x,true)){this.btn.set("value",A);return}}this.btn.reset("value")}};false!==k["font-size"]&&b.push(l.addSelect("font-size",q.mix({title:"\u5927\u5c0f",width:"30px",mode:v.WYSIWYG_MODE,showValue:true,popUpWidth:o.width,items:t,styles:g},f)));
false!==k["font-family"]&&b.push(l.addSelect("font-family",q.mix({title:"\u5b57\u4f53",width:"110px",mode:v.WYSIWYG_MODE,popUpWidth:h.width,items:a,styles:c},f)));v={mode:v.WYSIWYG_MODE,offClick:function(){var s=this.editor,n=this.cfg.style;s.fire("save");n.apply(s.document);s.fire("save");s.notifySelectionChange();s.focus()},onClick:function(){var s=this.editor,n=this.cfg.style;s.fire("save");n.remove(s.document);s.fire("save");s.notifySelectionChange();s.focus()},selectionChange:function(s){var n=this.btn;
this.cfg.style.checkActive(s.path)?n.set("state",r.ON):n.set("state",r.OFF)}};false!==k["font-bold"]&&b.push(l.addButton("font-bold",q.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",style:new u({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},v)));false!==k["font-italic"]&&b.push(l.addButton("font-italic",q.mix({contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 ",style:new u({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},
v)));false!==k["font-underline"]&&b.push(l.addButton("font-underline",q.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new u({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]})},v)));false!==k["font-strikeThrough"]&&b.push(l.addButton("font-underline",q.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new u({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"}]})},v)));this.destroy=
function(){for(var s=0;s<b.length;s++)b[s].destroy()}})},{attach:false});
KISSY.Editor.add("format",function(l){l.addPlugin("format",function(){var p=KISSY.Editor,q=[],v={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},u={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},r={},k=p.Style,o;for(o in v)if(v[o]){r[v[o]]=new k({element:v[o]});q.push({name:o,value:v[o],attrs:{style:"font-size:"+u[v[o]]}})}var i=l.addSelect("font-family",{items:q,title:"\u6807\u9898",width:"100px",mode:p.WYSIWYG_MODE,popUpWidth:"120px",click:function(f){var d=
f.newVal;f=f.prevVal;l.fire("save");if(d!=f)r[d].apply(l.document);else{r.p.apply(l.document);this.btn.set("value","p")}l.fire("save")},selectionChange:function(f){f=f.path;for(var d in r)if(r[d].checkActive(f)){this.btn.set("value",d);break}}});this.destroy=function(){i.destroy()}})},{attach:false});
KISSY.Editor.add("htmldataprocessor",function(l){function p(h){return h.replace(g,function(c,a,e,j,s){return j=="src"&&t.test(c)?c:"<"+a+e+" _ke_saved_"+e+s+">"})}var q=q,v=KISSY,u=v.Editor,r=v.Node,k=v.UA,o=u.NODE,i=u.HtmlParser,f=new i.Filter,d=new i.Filter,b=u.XHTML_DTD;if(!l.htmlDataProcessor){(function(){var h=u.HtmlParser.Fragment.prototype,c=u.HtmlParser.Element.prototype;h.onlyChild=c.onlyChild=function(){var a=this.children;return a.length==1&&a[0]||null};c.removeAnyChildWithName=function(a){for(var e=
this.children,j=[],s,n=0;n<e.length;n++){s=e[n];if(s.name){if(s.name==a){j.push(s);e.splice(n--,1)}j=j.concat(s.removeAnyChildWithName(a))}}return j};c.getAncestor=function(a){for(var e=this.parent;e&&!(e.name&&e.name.match(a));)e=e.parent;return e};h.firstChild=c.firstChild=function(a){for(var e,j=0;j<this.children.length;j++){e=this.children[j];if(a(e))return e;else if(e.name)if(e=e.firstChild(a))return e}return null};c.addStyle=function(a,e,j){var s="";if(typeof e=="string")s+=a+":"+e+";";else{if(typeof a==
"object")for(var n in a){if(a.hasOwnProperty(n))s+=n+":"+a[n]+";"}else s+=a;j=e}if(!this.attributes)this.attributes={};a=this.attributes.style||"";a=(j?[s,a]:[a,s]).join(";");this.attributes.style=a.replace(/^;|;(?=;)/,"")};b.parentOf=function(a){var e={},j;for(j in this)if(j.indexOf("$")==-1&&this[j][a])e[j]=1;return e}})();(function(){function h(z){if(/mso-list\s*:\s*Ignore/i.test(z.attributes&&z.attributes.style))return true;return q}function c(z,m){var w=new u.HtmlParser.Element("ke:listbullet"),
B;if(z)if(z[2]){z=isNaN(z[1])?/^[a-z]+$/.test(z[1])?"lower-alpha":/^[A-Z]+$/.test(z[1])?"upper-alpha":"decimal":"decimal";B="ol"}else{z=/[l\u00B7\u2002]/.test(z[1])?"disc":/[\u006F\u00D8]/.test(z[1])?"circle":/[\u006E\u25C6]/.test(z[1])?"square":"disc";B="ul"}else{z="decimal";B="ol"}w.attributes={"ke:listtype":B,style:"list-style-type:"+z+";"};w.add(new u.HtmlParser.Text(m));return w}function a(z){var m=z.attributes,w;if((w=z.removeAnyChildWithName("ke:listbullet"))&&w.length&&(w=w[0])){z.name="ke:li";
if(m.style)m.style=e([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(B){B=B.split(" ");B=B[3]||B[1]||B[0];B=parseInt(B,10);if(!n&&y&&B>y)n=B-y;m["ke:margin"]=y=B}]],q)(m.style,z)||"";w=w.attributes;z.addStyle(w.style);v.mix(m,w);return true}return false}function e(z,m){return function(w,B){var D=[];w.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(F,M,P){M=M.toLowerCase();M=="font-family"&&(P=P.replace(/["']/g,""));for(var L,Q,R,T=0;T<z.length;T++)if(z[T]){F=
z[T][0];L=z[T][1];Q=z[T][2];R=z[T][3];if(M.match(F)&&(!L||P.match(L))){M=R||M;m&&(Q=Q||P);if(typeof Q=="function")Q=Q(P,B,M);if(Q&&Q.push){M=Q[0];Q=Q[1]}typeof Q=="string"&&D.push([M,Q]);return}}!m&&D.push([M,P])});for(var C=0;C<D.length;C++)D[C]=D[C].join(":");return D.length?D.join(";")+";":false}}function j(z){z=z.children;for(var m,w,B,D,C,F,M,P=0;P<z.length;P++){m=z[P];if("ke:li"==m.name){m.name="li";m=m;w=m.attributes;B=m.attributes["ke:listtype"];D=parseInt(w["ke:indent"],10)||n&&Math.ceil(w["ke:margin"]/
n)||1;w.style&&(w.style=e([["list-style-type",B=="ol"?"decimal":"disc"]],q)(w.style)||"");if(F){if(D>M){F=new u.HtmlParser.Element(B);F.add(m);C.add(F)}else{if(D<M){C=M-D;for(var L;C--&&(L=F.parent);)F=L.parent}F.add(m)}z.splice(P--,1)}else{F=new u.HtmlParser.Element(B);F.add(m);z[P]=F}C=m;M=D}else F=null}n=0}var s=e([[/mso/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i],[/line-height/i],[/display/i,/none/i]],q),n,y=0,x=b.parentOf("ol"),A={elementNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,
""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(z){z.filterChildren();j(z)},elements:{font:function(z){delete z.name},p:function(z){z.filterChildren();if(a(z))return q},$:function(z){var m=z.name||"";m.indexOf(":")!=-1&&m.indexOf("ke")==-1&&delete z.name;var w=z.attributes.style;if(m=="span"&&(!w||!s(w)))delete z.name;if(m in x){z.filterChildren();j(z)}},span:function(z){if(!k.gecko&&h(z.parent))return false;if(!k.gecko&&h(z)){z=(z=z.firstChild(function(w){return w.value||
w.name=="img"}))&&(z.value||"l.");var m=z.match(/^([^\s]+?)([.)]?)$/);return c(m,z)}}},comment:!k.ie?function(z,m){var w=z.match(/<img.*?>/),B=z.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(B){B=(w=B[1]||w&&"l.")&&w.match(/>([^\s]+?)([.)]?)</);return c(B,w)}if(k.gecko&&w){w=u.HtmlParser.Fragment.FromHtml(w[0]).children[0];(B=(B=(B=m.previous)&&B.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&B[1])&&(w.attributes.src=B);return w}return false}:function(){return false},attributes:{"class":function(z){if(/(^|\s+)ke_/.test(z))return z;
return false},style:function(z){z=s(z);if(!z)return false;return z}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},E={elementNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],elements:{$:function(z){var m=z.attributes;if(m)for(var w=["name","href","src"],B,D=0;D<w.length;D++){B="_ke_saved_"+w[D];B in m&&delete m[w[D]]}return z},embed:function(z){var m=z.parent;if(m&&m.name=="object"){var w=m.attributes.width;m=m.attributes.height;w&&(z.attributes.width=w);m&&(z.attributes.height=m)}},param:function(z){z.children=
[];z.isEmpty=true;return z},a:function(z){if(!(z.children.length||z.attributes.name||z.attributes._ke_saved_name))return false},td:function(z){for(var m=z.children,w=0;w<m.length;w++)if(m[w].name=="br"){m.splice(w,1);--w}if(!z.children.length){m=new u.HtmlParser.Text("&nbsp;");z.children.push(m)}},span:function(z){if(!z.children.length)return false}},attributes:{style:function(z){if(!v.trim(z))return false}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,
""]]};if(k.ie)E.attributes.style=function(z){return z.toLowerCase()};f.addRules(E);d.addRules(A)})();(function(){function h(E){for(var z=E.children.length,m=E.children[z-1];m&&m.type==o.NODE_TEXT&&!v.trim(m.value);)m=E.children[--z];return m}function c(E){var z=h(E);return!z||z.type==o.NODE_ELEMENT&&z.name=="br"||E.name=="form"&&z.name=="input"}function a(E,z){var m=E.children,w=h(E);if(w){if((z||!k.ie)&&w.type==o.NODE_ELEMENT&&w.name=="br")m.pop();w.type==o.NODE_TEXT&&s.test(w.value)&&m.pop()}}function e(E){a(E,
true);if(c(E))k.ie?E.add(new u.HtmlParser.Text("\u00a0")):E.add(new u.HtmlParser.Element("br",{}))}function j(E){a(E,false);c(E)&&E.add(new u.HtmlParser.Text("\u00a0"))}var s=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,n=u.XHTML_DTD,y=u.Utils.mix({},n.$block,n.$listItem,n.$tableContent),x;for(x in y)"br"in n[x]||delete y[x];delete y.pre;n={elements:{}};var A={elements:{}};for(x in y){n.elements[x]=e;A.elements[x]=j}d.addRules(n);f.addRules(A)})();(function(){f.addRules({text:function(h){return h.replace(/\xa0/g,"&nbsp;")}})})();
var g=/<((?:a|area|img|input)[\s\S]*?\s)((href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+)))([^>]*)>/gi,t=/\s_cke_saved_src\s*=/;l.htmlDataProcessor={htmlFilter:f,dataFilter:d,toHtml:function(h,c){var a=new i.HtmlWriter;i.Fragment.FromHtml(h,c).writeHtml(a,f);return a.getHtml(true)},toDataFormat:function(h,c){if(k.gecko)h=h.replace(/(<!--\[if[^<]*?\])--\>([\S\s]*?)<!--(\[endif\]--\>)/gi,"$1$2$3");h=p(h);var a=new r("<div>");a.html("a"+h);h=a.html().substr(1);a=new i.BasicWriter;var e=
i.Fragment.FromHtml(h,c);a.reset();e.writeHtml(a,d);return a.getHtml(true)},toServer:function(h,c){var a=new i.BasicWriter;i.Fragment.FromHtml(h,c).writeHtml(a,f);return a.getHtml(true)}}}},{attach:false});
KISSY.Editor.add("image",function(l){l.addPlugin("image",function(){var p=KISSY,q=p.Editor,v=p.UA,u=p.Node,r=p.Event,k=function(b){return b._4e_name()==="img"&&!/(^|\s+)ke_/.test(b[0].className)&&b},o={},i=q.Utils.addRes,f=q.Utils.destroyRes,d=l.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:q.WYSIWYG_MODE,offClick:function(){this.call("show")},_updateTip:function(b,g){var t=g.attr("src");b.html(t);b.attr("href",t)},show:function(b,g){this.editor.useDialog("image/dialog",function(t){t.show(g)})}});
i.call(o,d,function(){l.destroyDialog("image/dialog")});q.use("contextmenu",function(){function b(c){var a=new u(c.target);c.halt();k(a)&&d.call("show",null,a)}var g={"\u56fe\u7247\u5c5e\u6027":function(c){c=(c=c.getSelection())&&c.getStartElement();(c=k(c))&&d.call("show",null,c)}};r.on(l.document,"dblclick",b);i.call(o,function(){r.remove(l.document,"dblclick",b)});var t={},h;for(h in g)(function(c){t[c]=function(){g[c](l)}})(h);h=q.ContextMenu.register({editor:l,rules:[k],width:"120px",funcs:t});i.call(o,h)});q.use("bubbleview",
function(){q.BubbleView.register({pluginName:"image",pluginContext:d,editor:l,func:k,init:function(){var b=this,g=b.get("contentEl");g.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var t=g.one(".ke-bubbleview-url"),h=g.one(".ke-bubbleview-change"),c=g.one(".ke-bubbleview-remove");q.Utils.preventFocus(g);h.on("click",function(a){b._plugin.call("show",
null,b._selectedEl);a.halt()});c.on("click",function(a){var e=b._plugin;if(v.webkit){var j=e.editor.getSelection().getRanges();j&&j[0]&&(j[0].collapse(true)||1)&&j[0].select()}b._selectedEl._4e_remove();b.hide();e.editor.notifySelectionChange();a.halt()});q.Utils.addRes.call(b,h,c);b.on("show",function(){var a=b._selectedEl;a&&b._plugin.call("_updateTip",t,a)})}});i.call(o,function(){q.BubbleView.destroy("image")})});this.destroy=function(){f.call(o)}})},{attach:false});
KISSY.Editor.add("indent",function(l){l.addPlugin("indent",function(){var p=KISSY.Editor,q=l.addButton("outdent",{title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent",type:"outdent",loading:true}),v=l.addButton("indent",{title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-indent",type:"indent",loading:true});p.use("indent/support",function(){q.reload(p.IndentSupport);v.reload(p.IndentSupport)});l.addCommand("indent",{exec:function(){v.call("offClick")}});l.addCommand("outdent",
{exec:function(){q.call("offClick")}});this.destroy=function(){q.destroy();v.destroy()}})},{attach:false});
KISSY.Editor.add("indent/support",function(){function l(h){this.type=h;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function p(h){return h[0].nodeType==b.NODE_ELEMENT&&h._4e_name()=="li"}function q(h,c){for(var a=h.startContainer,e=h.endContainer;a&&!a.parent()._4e_equals(c);)a=a.parent();for(;e&&!e.parent()._4e_equals(c);)e=e.parent();if(a&&e){var j=a;a=[];for(var s=false;!s;){if(j._4e_equals(e))s=true;a.push(j);j=j.next()}if(!(a.length<1)){j=c._4e_parents(true);
for(e=0;e<j.length;e++)if(r[j[e]._4e_name()]){c=j[e];break}j=this.type=="indent"?1:-1;e=a[0];s=a[a.length-1];a={};var n=u.ListUtils.listToArray(c,a),y=n[s.data("listarray_index")].indent;for(e=e.data("listarray_index");e<=s.data("listarray_index");e++){n[e].indent+=j;var x=n[e].parent;n[e].parent=new f(x[0].ownerDocument.createElement(x._4e_name()))}for(e=s.data("listarray_index")+1;e<n.length&&n[e].indent>y;e++)n[e].indent+=j;s=u.ListUtils.arrayToList(n,a,null,"p",0);j=[];if(this.type=="outdent"){var A;
if((A=c.parent())&&A._4e_name()=="li"){n=s.listNode.childNodes;var E;for(e=n.length-1;e>=0;e--)if((E=new f(n[e]))&&E._4e_name()=="li")j.push(E)}}if(s){i.insertBefore(s.listNode,c);c._4e_remove()}if(j&&j.length)for(e=0;e<j.length;e++){for(s=E=j[e];(s=s.next())&&s._4e_name()in r;){d.ie&&!E._4e_first(function(z){return g(z)&&t(z)})&&E[0].appendChild(h.document.createTextNode("\u00a0"));E[0].appendChild(s[0])}i.insertAfter(E[0],A[0])}u.Utils.clearAllMarkers(a)}}}function v(h){var c=parseInt(h._4e_style(this.indentCssProperty),
10);if(isNaN(c))c=0;c+=(this.type=="indent"?1:-1)*this.indentOffset;if(c<0)return false;c=Math.max(c,0);c=Math.ceil(c/this.indentOffset)*this.indentOffset;h.css(this.indentCssProperty,c?c+this.indentUnit:"");h[0].style.cssText===""&&h.removeAttr("style");return true}var u=KISSY.Editor,r={ol:1,ul:1},k=KISSY,o=u.Walker,i=k.DOM,f=k.Node,d=k.UA,b=u.NODE,g=o.whitespaces(true),t=o.bookmark(false,true);k.augment(l,{exec:function(h){for(var c=(h=h.getSelection())&&h.getRanges()[0],a=c.startContainer,e=c.endContainer,
j=c.getCommonAncestor();j&&!(j[0].nodeType==b.NODE_ELEMENT&&r[j._4e_name()]);)j=j.parent();if(j&&a[0].nodeType==b.NODE_ELEMENT&&a._4e_name()in r){a=new o(c);a.evaluator=p;c.startContainer=a.next()}if(j&&e[0].nodeType==b.NODE_ELEMENT&&e._4e_name()in r){a=new o(c);a.evaluator=p;c.endContainer=a.previous()}e=h.createBookmarks(true);if(j){for(a=j._4e_first();a&&a._4e_name()!="li";)a=a.next();var s=c.startContainer;(a[0]==s[0]||a.contains(s))&&v.call(this,j)||q.call(this,c,j)}else{c=c.createIterator();
c.enforceRealBlocks=true;for(c.enlargeBr=true;j=c.getNextParagraph();)v.call(this,j)}h.selectBookmarks(e)}});u.IndentSupport={init:function(){this.indentCommand=new l(this.cfg.type)},offClick:function(){var h=this,c=h.editor;c.fire("save");setTimeout(function(){h.indentCommand.exec(c);c.fire("save");c.notifySelectionChange()},10)},selectionChange:function(h){if(this.cfg.type=="outdent"){var c=h.path,a=c.blockLimit;h=this.btn;if(c.contains(r))h.boff();else(c=c.block||a)&&c._4e_style(this.indentCommand.indentCssProperty)?
h.boff():h.disable()}}}});
KISSY.Editor.add("justify",function(l){l.addPlugin("justify",function(){var p=KISSY,q=p.Editor,v=q.TripleButton,u=/(-moz-|-webkit-|start|auto)/gi;q={mode:q.WYSIWYG_MODE,offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var i=this.editor,f=i.getSelection(),d=this.btn.get("state");if(f){var b=f.createBookmarks(),g=f.getRanges(),t,h;i.fire("save");for(var c=g.length-1;c>=0;c--){t=g[c].createIterator();for(t.enlargeBr=true;h=t.getNextParagraph();){h.removeAttr("align");
d==v.OFF?h.css("text-align",this.cfg.v):h.css("text-align","")}}i.notifySelectionChange();f.selectBookmarks(b);i.fire("save")}},selectionChange:function(i){var f=this.btn;i=i.path;i=i.block||i.blockLimit;if(!i||i._4e_name()==="body")f.boff();else(i.css("text-align").replace(u,"")||"left")==this.cfg.v?f.bon():f.boff()}};var r=l.addButton("alignleft",p.mix({contentCls:"ke-toolbar-alignleft",title:"\u5de6\u5bf9\u9f50",v:"left"},q)),k=l.addButton("aligncenter",p.mix({contentCls:"ke-toolbar-aligncenter",title:"\u5c45\u4e2d\u5bf9\u9f50",
v:"center"},q)),o=l.addButton("alignright",p.mix({contentCls:"ke-toolbar-alignright",title:"\u53f3\u5bf9\u9f50",v:"right"},q));this.destroy=function(){r.destroy();k.destroy();o.destroy()}})},{attach:false});
KISSY.Editor.add("link",function(l){l.addPlugin("link",function(){function p(b){return b._4e_ascendant(function(g){return g._4e_name()==="a"&&!!g.attr("href")},true)}var q=KISSY,v=q.Editor,u=q.Node,r=v.Style,k={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}},o={},i=v.Utils.addRes,f=v.Utils.destroyRes,d=l.addButton("link",{contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:v.WYSIWYG_MODE,_getSelectedLink:function(){var b=this.editor.getSelection();
if(b=b&&b.getStartElement())b=p(b);return b},_getSelectionLinkUrl:function(){var b=this.cfg._getSelectedLink.call(this);if(b)return b.attr("_ke_saved_href")||b.attr("href")},_removeLink:function(b){var g=this.editor;g.fire("save");var t=g.getSelection(),h=t.getRanges()[0];if(h&&h.collapsed){h=t.createBookmarks();b._4e_remove(true);t.selectBookmarks(h)}else if(h){b=b[0];t=b.attributes;h={};for(var c=0;c<t.length;c++){var a=t[c];if(a.specified)h[a.name]=a.value}if(b.style.cssText)h.style=b.style.cssText;
(new r(k,h)).remove(g.document)}g.fire("save");g.notifySelectionChange()},_link:function(b,g){var t=this.editor;b._ke_saved_href=b.href;if(g){t.fire("save");g.attr(b);t.fire("save")}else{var h=t.getSelection();h=h&&h.getRanges()[0];if(!h||h.collapsed){h=new u("<a>"+b.href+"</a>",b,t.document);t.insertElement(h)}else{t.fire("save");(new r(k,b)).apply(t.document);t.fire("save")}}t.notifySelectionChange()},offClick:function(){var b=this;b.editor.useDialog("link/dialog",function(g){g.show(b)})},destroy:function(){this.editor.destroyDialog("link/dialog")}});
i.call(o,d);v.use("bubbleview",function(){v.BubbleView.register({pluginName:"link",editor:l,pluginContext:d,func:p,init:function(){var b=this,g=b.get("contentEl");g.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var t=g.one(".ke-bubbleview-url"),h=g.one(".ke-bubbleview-change"),c=g.one(".ke-bubbleview-remove");v.Utils.preventFocus(g);h.on("click",
function(a){b._plugin.call("offClick");a.halt()});c.on("click",function(a){b._plugin.call("_removeLink",b._selectedEl);a.halt()});i.call(b,h,c);b.on("show",function(){var a=b._selectedEl;if(a){a=a.attr("_ke_saved_href")||a.attr("href");t.html(a);t.attr("href",a)}})}});i.call(o,function(){v.BubbleView.destroy("link")})});this.destroy=function(){f.call(o)}})},{attach:false});
KISSY.Editor.add("list",function(l){l.addPlugin("list",function(){var p=KISSY.Editor,q=l.addButton("ul",{title:"\u9879\u76ee\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ul",loading:true,type:"ul"}),v=l.addButton("ol",{title:"\u7f16\u53f7\u5217\u8868",mode:p.WYSIWYG_MODE,contentCls:"ke-toolbar-ol",loading:true,type:"ol"});p.use("list/support",function(){q.reload(p.ListSupport);v.reload(p.ListSupport)});this.destroy=function(){q.destroy();v.destroy()}})},{attach:false});
KISSY.Editor.add("list/support",function(){function l(h){this.type=h}var p=KISSY.Editor,q={ol:1,ul:1},v=["ol","ul"],u=KISSY,r=p.RANGE,k=p.ElementPath,o=p.Walker,i=p.NODE,f=u.UA,d=u.Node,b=u.DOM,g={listToArray:function(h,c,a,e,j){if(!q[h._4e_name()])return[];e||(e=0);a||(a=[]);for(var s=0,n=h[0].childNodes.length;s<n;s++){var y=new d(h[0].childNodes[s]);if(y._4e_name()=="li"){var x={parent:h,indent:e,element:y,contents:[]};if(j)x.grandparent=j;else{x.grandparent=h.parent();if(x.grandparent&&x.grandparent._4e_name()==
"li")x.grandparent=x.grandparent.parent()}c&&y._4e_setMarker(c,"listarray_index",a.length);a.push(x);for(var A=0,E=y[0].childNodes.length,z;A<E;A++){z=new d(y[0].childNodes[A]);z[0].nodeType==i.NODE_ELEMENT&&q[z._4e_name()]?g.listToArray(z,c,a,e+1,x.grandparent):x.contents.push(z)}}}return a},arrayToList:function(h,c,a,e){a||(a=0);if(!h||h.length<a+1)return null;for(var j=h[a].parent[0].ownerDocument,s=j.createDocumentFragment(),n=null,y=a,x=Math.max(h[a].indent,0),A=null;;){var E=h[y];if(E.indent==
x){if(!n||h[y].parent._4e_name()!=n._4e_name()){n=h[y].parent._4e_clone(false,true);s.appendChild(n[0])}A=n[0].appendChild(E.element._4e_clone(false,true)[0]);for(var z=0;z<E.contents.length;z++)A.appendChild(E.contents[z]._4e_clone(true,true)[0]);y++}else if(E.indent==Math.max(x,0)+1){y=g.arrayToList(h,null,y,e);A.appendChild(y.listNode);y=y.nextIndex}else if(E.indent==-1&&!a&&E.grandparent){if(q[E.grandparent._4e_name()])A=E.element._4e_clone(false,true)[0];else if(E.grandparent._4e_name()!="td"){A=
j.createElement(e);E.element._4e_copyAttributes(new d(A))}else A=j.createDocumentFragment();for(z=0;z<E.contents.length;z++){n=E.contents[z]._4e_clone(true,true);A.nodeType==i.NODE_DOCUMENT_FRAGMENT&&E.element._4e_copyAttributes(new d(n));A.appendChild(n[0])}if(A.nodeType==i.NODE_DOCUMENT_FRAGMENT&&y!=h.length-1){A.lastChild&&A.lastChild.nodeType==i.NODE_ELEMENT&&A.lastChild.getAttribute("type")=="_moz"&&b._4e_remove(A.lastChild);b._4e_appendBogus(A)}if(A.nodeType==i.NODE_ELEMENT&&b._4e_name(A)==
e&&A.firstChild){b._4e_trim(A);n=A.firstChild;if(n.nodeType==i.NODE_ELEMENT&&b._4e_isBlockBoundary(n)){n=j.createDocumentFragment();b._4e_moveChildren(A,n);A=n}}n=b._4e_name(A);if(!f.ie&&(n=="div"||n=="p"))b._4e_appendBogus(A);s.appendChild(A);n=null;y++}else return null;if(h.length<=y||Math.max(h[y].indent,0)<x)break}if(c)for(h=new d(s.firstChild);h&&h[0];){h[0].nodeType==i.NODE_ELEMENT&&h._4e_clearMarkers(c,true);h=h._4e_nextSourceNode()}return{listNode:s,nextIndex:y}}},t=/^h[1-6]$/;l.prototype=
{changeListType:function(h,c,a,e){var j=g.listToArray(c.root,a,undefined,undefined,undefined),s=[];for(h=0;h<c.contents.length;h++){var n=c.contents[h];n=n._4e_ascendant("li",true);if(!(!n||!n[0]||n.data("list_item_processed"))){s.push(n);n._4e_setMarker(a,"list_item_processed",true)}}n=new d(c.root[0].ownerDocument.createElement(this.type));for(h=0;h<s.length;h++){var y=s[h].data("listarray_index");j[y].parent=n}a=g.arrayToList(j,a,null,"p");var x;j=a.listNode.childNodes.length;for(h=0;h<j&&(x=new d(a.listNode.childNodes[h]));h++)x._4e_name()==
this.type&&e.push(x);b.insertBefore(a.listNode,c.root);c.root._4e_remove()},createList:function(h,c,a){var e=c.contents;h=c.root[0].ownerDocument;var j=[];if(e.length==1&&e[0][0]===c.root[0]){var s=new d(h.createElement("div"));e[0][0].nodeType!=i.NODE_TEXT&&e[0]._4e_moveChildren(s);e[0][0].appendChild(s[0]);e[0]=s}c=c.contents[0].parent();for(s=0;s<e.length;s++)c=c._4e_commonAncestor(e[s].parent());for(s=0;s<e.length;s++)for(var n=e[s],y;y=n.parent();){if(y[0]===c[0]){j.push(n);break}n=y}if(!(j.length<
1)){e=new d(j[j.length-1][0].nextSibling);s=new d(h.createElement(this.type));for(a.push(s);j.length;){a=j.shift();n=new d(h.createElement("li"));if(t.test(a._4e_name()))n[0].appendChild(a[0]);else{a._4e_copyAttributes(n);a._4e_moveChildren(n);a._4e_remove()}s[0].appendChild(n[0]);f.ie||n._4e_appendBogus()}e[0]?b.insertBefore(s,e):c.append(s)}},removeList:function(h,c,a){function e(z){if((A=new d(x[z?"firstChild":"lastChild"]))&&!(A[0].nodeType==i.NODE_ELEMENT&&A._4e_isBlockBoundary())&&(E=c.root[z?
"_4e_previous":"_4e_next"](o.whitespaces(true)))&&!(A[0].nodeType==i.NODE_ELEMENT&&E._4e_isBlockBoundary({br:1})))b[z?"insertBefore":"insertAfter"](h.document.createElement("br"),A)}for(var j=g.listToArray(c.root,a,undefined,undefined,undefined),s=[],n=0;n<c.contents.length;n++){var y=c.contents[n];y=y._4e_ascendant("li",true);if(!(!y||y.data("list_item_processed"))){s.push(y);y._4e_setMarker(a,"list_item_processed",true)}}y=null;for(n=0;n<s.length;n++){y=s[n].data("listarray_index");j[y].indent=
-1;y=y}for(n=y+1;n<j.length;n++)if(j[n].indent>Math.max(j[n-1].indent,0)){s=j[n-1].indent+1-j[n].indent;for(y=j[n].indent;j[n]&&j[n].indent>=y;){j[n].indent+=s;n++}n--}var x=g.arrayToList(j,a,null,"p").listNode,A,E;e(true);e(undefined);b.insertBefore(x,c.root);c.root._4e_remove()},exec:function(h){var c=h.getSelection(),a=c&&c.getRanges();if(!(!a||a.length<1)){for(var e=c.createBookmarks(true),j=[],s={};a.length>0;){var n=a.shift(),y=n.getBoundaryNodes(),x=y.startNode,A=y.endNode;x[0].nodeType==i.NODE_ELEMENT&&
x._4e_name()=="td"&&n.setStartAt(y.startNode,r.POSITION_AFTER_START);A[0].nodeType==i.NODE_ELEMENT&&A._4e_name()=="td"&&n.setEndAt(y.endNode,r.POSITION_BEFORE_END);n=n.createIterator();for(n.forceBrBreak=false;y=n.getNextParagraph();)if(!y.data("list_block")){y._4e_setMarker(s,"list_block",1);A=new k(y);var E=A.elements,z=null,m=false,w=A.blockLimit,B;for(x=E.length-1;x>=0&&(B=E[x]);x--)if(q[B._4e_name()]&&w.contains(B)){w.removeData("list_group_object");if(x=B.data("list_group_object"))x.contents.push(y);
else{x={root:B,contents:[y]};j.push(x);B._4e_setMarker(s,"list_group_object",x)}m=true;break}if(!m){A=w||A.block;if(A.data("list_group_object"))A.data("list_group_object").contents.push(y);else{x={root:A,contents:[y]};A._4e_setMarker(s,"list_group_object",x);j.push(x)}}}}for(a=[];j.length>0;){x=j.shift();if(this.state=="off")if(q[x.root._4e_name()])this.changeListType(h,x,s,a);else{p.Utils.clearAllMarkers(s);this.createList(h,x,a)}else this.state=="on"&&q[x.root._4e_name()]&&this.removeList(h,x,s)}for(x=
0;x<a.length;x++){z=a[x];var D=this;(h=function(C){var F=z[C?"_4e_previous":"_4e_next"](o.whitespaces(true));if(F&&F[0]&&F._4e_name()==D.type){F._4e_remove();F._4e_moveChildren(z,C?true:false)}})();h(true)}p.Utils.clearAllMarkers(s);c.selectBookmarks(e)}}};p.ListUtils=g;p.ListSupport={init:function(){this.listCommand=new l(this.cfg.type)},selectionChange:function(h){var c=this.cfg.type,a=h.path,e;h=this.btn;var j=a.blockLimit;a=a.elements;if(j){if(a)for(var s=0;s<a.length&&(e=a[s])&&e[0]!==j[0];s++){var n=
u.indexOf(a[s]._4e_name(),v);if(n!==-1)if(v[n]===c){h.bon();return}else break}h.boff()}},offClick:function(){this.call("_change")},onClick:function(){this.call("_change")},_change:function(){var h=this.editor,c=this.btn;h.fire("save");this.listCommand.state=c.get("state");this.listCommand.exec(h);h.fire("save");h.notifySelectionChange()}}});
KISSY.Editor.add("localstorage",function(){var l=KISSY,p=l.Editor,q;q=p.STORE="localStorage";if(p.storeReady)l.log("localstorage attach more","warn");else{p.storeReady=function(u){p.on("storeReady",u)};p.on("storeReady",function(){p.storeReady=function(u){u()};p.detach("storeReady")});if(window[q])window[q]._ke||p.fire("storeReady");else{var v=p.Utils.debugUrl("localstorage/swfstore.swf?t="+ +new Date);window[q]=new p.FlashBridge({movie:v,methods:["setItem","removeItem","getValueOf"]});l.mix(window[q],
{_ke:1,getItem:function(u){return this.getValueOf(u)}});window[q].on("contentReady",function(){p.fire("storeReady")})}}},{requires:["flashutils","flashbridge"]});KISSY.Editor.add("maximize",function(l){l.addPlugin("maximize",function(){var p=KISSY,q=p.Editor;if(!(p.UA.gecko<1.92)){var v=l.addButton("maximize",{title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize",loading:true});q.use("maximize/support",function(){v.reload(q.Maximize)});this.destroy=function(){v.destroy()}}})},{attach:false});
KISSY.Editor.add("maximize/support",function(){var l=KISSY.Editor,p=KISSY,q=p.UA,v=p.Node,u=p.Event,r=p.DOM,k;r.addStyleSheet(".ke-toolbar-padding {padding:5px;}","ke-maximize");var o={};p.mix(o,{onClick:function(){var i=this,f=i.editor;i._resize&&u.remove(window,"resize",i._resize);i.call("_saveEditorStatus");i.call("_restoreState");i.btn.boff();setTimeout(function(){i.call("_restoreEditorStatus");f.notifySelectionChange();f.fire("restoreWindow")},30)},_restoreState:function(){var i=document,f=this.editor,
d=this._savedParents;if(d){for(var b=0;b<d.length;b++){var g=d[b];g.el.css("position",g.position)}this._savedParents=null}f.wrap.css({height:this.iframeHeight});r.css(i.body,{width:"",height:"",overflow:""});i.documentElement.style.overflow="";f.editorWrap.css({position:"static",width:this.editorWrapWidth});k.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);i=this.btn.get("el");i.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");i.attr("title",
"\u5168\u5c4f");q.ie<8&&this.editor.toolBarDiv.removeClass("ke-toolbar-padding")},_saveSate:function(){var i=this.editor,f=[],d=i.editorWrap;this.iframeHeight=i.wrap._4e_style("height");this.editorWrapWidth=d._4e_style("width");this.scrollLeft=r.scrollLeft();this.scrollTop=r.scrollTop();window.scrollTo(0,0);for(i=d.parent();i;){d=i.css("position");if(d!="static"){f.push({el:i,position:d});i.css("position","static")}i=i.parent()}this._savedParents=f;f=this.btn.get("el");f.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");
f.attr("title","\u53d6\u6d88\u5168\u5c4f");q.ie<8&&this.editor.toolBarDiv.addClass("ke-toolbar-padding")},_saveEditorStatus:function(){var i=this.editor;this.savedRanges=null;if(q.gecko&&i.iframeFocus)this.savedRanges=(i=i.getSelection())&&i.getRanges()},_restoreEditorStatus:function(){var i=this.editor,f=i.getSelection(),d=this.savedRanges;i.activateGecko();d&&f&&f.selectRanges(d);if(i.iframeFocus&&f)(i=f.getStartElement())&&i[0]&&i._4e_scrollIntoView();q.ie<8&&this.btn.get("el").one("span").css("background-image",
"")},_maximize:function(i){var f=document,d=this.editor,b=d.editorWrap,g=r.viewportHeight(),t=r.viewportWidth(),h=d.statusDiv?d.statusDiv[0].offsetHeight:0,c=d.toolBarDiv[0].offsetHeight;if(q.ie)f.body.style.overflow="hidden";else r.css(f.body,{width:0,height:0,overflow:"hidden"});f.documentElement.style.overflow="hidden";b.css({position:"absolute",zIndex:l.baseZIndex(l.zIndexManager.MAXIMIZE),width:t+"px"});k.css({zIndex:l.baseZIndex(l.zIndexManager.MAXIMIZE-5),height:g+"px",width:t+"px"});b.offset({left:0,
top:0});k.css({left:0,top:0});d.wrap.css({height:g-h-c+"px"});i!==true&&arguments.callee.call(this,true)},_real:function(){var i=this,f=i.editor;i.call("_saveEditorStatus");i.call("_saveSate");i.call("_maximize");i._resize=i._resize||l.Utils.buffer(i.cfg._maximize,i,100);u.on(window,"resize",i._resize);i.btn.bon();setTimeout(function(){i.call("_restoreEditorStatus");f.notifySelectionChange();f.fire("maximizeWindow")},30)},offClick:function(){k||(k=(new v("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(document.body));
this.call("_real")},destroy:function(){}});l.Maximize=o});
KISSY.Editor.add("music",function(l){l.addPlugin("music",function(){var p=KISSY.Editor,q=l.htmlDataProcessor,v=q&&q.dataFilter;v&&v.addRules({elements:{object:function(r){var k=r.attributes;if(!(k.classid&&String(k.classid).toLowerCase())){for(k=0;k<r.children.length;k++)if(r.children[k].name=="embed"){if(!p.Utils.isFlashEmbed(r.children[k]))break;if(r.children[k].attributes.src.indexOf("niftyplayer.swf")!=-1)return q.createFakeParserElement(r,"ke_music","music",true)}return null}for(k=0;k<r.children.length;k++){var o=
r.children[k];if(o.name=="param"&&o.attributes.name=="movie")if(o.attributes.value.indexOf("niftyplayer.swf")!=-1)return q.createFakeParserElement(r,"ke_music","music",true)}},embed:function(r){if(!p.Utils.isFlashEmbed(r))return null;if(r.attributes.src.indexOf("niftyplayer.swf")!=-1)return q.createFakeParserElement(r,"ke_music","music",true)}}},4);var u=l.addButton("music",{contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u97f3\u4e50",mode:p.WYSIWYG_MODE,loading:true});p.use("music/support",function(){var r=new p.MusicInserter(l);
u.reload({offClick:function(){r.show()},destroy:function(){r.destroy()}})});this.destroy=function(){u.destroy()}})},{attach:false,requires:["fakeobjects"]});
KISSY.Editor.add("music/support",function(){function l(d){l.superclass.constructor.apply(this,arguments);d.cfg.disableObjectResizing||u.on(d.document.body,k.ie?"resizestart":"resize",function(b){(new q.Node(b.target)).hasClass(o)&&b.preventDefault()})}function p(d){return d._4e_name()==="img"&&!!d.hasClass(o)&&d}var q=KISSY,v=q.Editor,u=q.Event,r=v.Flash,k=q.UA,o="ke_music",i=["img."+o];q.extend(l,r,{_config:function(){this._cls=o;this._type="music";this._contextMenu=f;this._flashRules=i},_getFlashUrl:function(){return l.superclass._getFlashUrl.apply(this,
arguments).replace(/^.+niftyplayer\.swf\?file=/,"")}});r.registerBubble("music","\u97f3\u4e50\u7f51\u5740\uff1a ",p);v.MusicInserter=l;var f={"\u97f3\u4e50\u5c5e\u6027":function(d){var b=d.editor.getSelection();(b=(b=b&&b.getStartElement())&&p(b))&&d.show(null,b)}}},{requires:["flash/support"]});
KISSY.Editor.add("overlay",function(){function l(){}var p=KISSY,q=p.UA,v=p.Editor,u=v.focusManager;v.namespace("UIBase");if(v.UIBase.Focus)p.log("ke uibase focus attach more","warn");else{l.ATTRS={focus4e:{value:true}};l.prototype={_uiSetFocus4e:function(r){if(r){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){},__renderUI:function(){},__bindUI:function(){this._focus4e=
(new p.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var r=this._focusEditor=u.currentInstance();if(q.ie&&r){window.focus();document.body.focus();this._focus4e[0].focus();var k=r.document.selection.createRange();if(k)if(k.item&&k.item(0).ownerDocument==r.document){r=document.body.createTextRange();r.moveToElementText(this.get("el")._4e_first()[0]);r.collapse(true);
r.select()}}},_hide4FocusExt:function(){var r=this._focusEditor;r&&r.focus()}};v.UIBase.Focus=l}},{attach:false});
KISSY.Editor.add("overlay",function(){var l=KISSY,p=l.UIBase,q=l.Editor;if(q.Overlay)l.log("ke overlay attach more");else{var v=p.create(l.Overlay,[q.UIBase.Focus],{syncUI:function(){q.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:q.baseZIndex(q.zIndexManager.OVERLAY)}}}),u=p.create(l.Dialog,[q.UIBase.Focus],{show:function(){this.center();var k=this.get("y");if(k-l.DOM.scrollTop()>200){k=l.DOM.scrollTop()+200;this.set("y",k)}u.superclass.show.call(this)}},{ATTRS:{constrain:{value:true},
zIndex:{value:q.baseZIndex(q.zIndexManager.OVERLAY)}}});q.Overlay=v;q.Dialog=u;var r;q.Overlay.loading=function(){r||(r=new q.Overlay({x:0,focus4e:false,width:l.UA.ie==6?l.DOM.docWidth():"100%",y:0,zIndex:q.baseZIndex(q.zIndexManager.LOADING),elCls:"ke-global-loading"}));r.set("height",l.DOM.docHeight());r.show();r.loading()};q.Overlay.unloading=function(){r&&r.hide()}}});
KISSY.Editor.add("pagebreak",function(l){l.addPlugin("pagebreak",function(){var p=KISSY,q=p.Editor,v=p.Node,u=l.htmlDataProcessor;(p=u&&u.dataFilter)&&p.addRules({elements:{div:function(k){var o=k.attributes;var i=(o=o&&o.style)&&k.children.length==1&&k.children[0];if((i=i&&i.name=="span"&&i.attributes.style)&&/page-break-after\s*:\s*always/i.test(o)&&/display\s*:\s*none/i.test(i))return u.createFakeParserElement(k,"ke_pagebreak","div")}}});var r=l.addButton("page-break",{title:"\u5206\u9875",mode:q.WYSIWYG_MODE,
contentCls:"ke-toolbar-pagebreak",offClick:function(){var k=this.editor,o=new v('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,k.document);o=k.createFakeElement?k.createFakeElement(o,"ke_pagebreak","div",false,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'):o;var i=k.getSelection();if(i=i&&i.getRanges()[0]){k.fire("save");for(var f=i.startContainer,d=f;f._4e_name()!=="body";){d=f;f=f.parent()}i.collapse(true);
i.splitElement(d);o.insertAfter(d);k.fire("save")}}});this.destroy=function(){r.destroy()}})},{attach:false,requires:["fakeobjects"]});
KISSY.Editor.add("preview",function(l){l.addPlugin("preview",function(){var p=l.addButton("preview",{title:"\u9884\u89c8",contentCls:"ke-toolbar-preview",offClick:function(){var q=this.editor,v=640,u=420,r=80;try{var k=window.screen;v=Math.round(k.width*0.8);u=Math.round(k.height*0.7);r=Math.round(k.width*0.1)}catch(o){}q=q._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+q.getData(true)+"\n</body>").replace(/\${title}/,"\u9884\u89c8");v=window.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+
v+",height="+u+",left="+r);u=v.document;u.open();u.write(q);u.close();v.focus()}});this.destroy=function(){p.destroy()}})},{attach:false});
KISSY.Editor.add("progressbar",function(){function l(){l.superclass.constructor.apply(this,arguments);this._init()}var p=KISSY,q=p.Editor;if(!q.ProgressBar){var v=p.Node;p.DOM.addStyleSheet(".ke-progressbar {border:1px solid #D6DEE6;position:relative;margin-left:auto;margin-right:auto;background-color: #EAEFF4;background: -webkit-gradient(linear, left top, left bottom, from(#EAEFF4), .to(#EBF0F3)); background: -moz-linear-gradient(top, #EAEFF4, #EBF0F3);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#EAEFF4', endColorstr = '#EBF0F3');}.ke-progressbar-inner {border:1px solid #3571B4;background-color:#6FA5DB;padding:1px;}.ke-progressbar-inner-bg {height:100%;background-color: #73B1E9;background: -webkit-gradient(linear, left top, left bottom, from(#73B1E9), .to(#3F81C8)); background: -moz-linear-gradient(top, #73B1E9, #3F81C8);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#73B1E9', endColorstr = '#3F81C8');}.ke-progressbar-title {width:30px;top:0;left:40%;line-height:1.2;position:absolute;}","ke_progressbar");
l.ATTRS={container:{},width:{},height:{},progress:{value:0}};p.extend(l,p.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var u=this.get("height"),r=new v("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+u+";'></div>"),k=this.get("container");u=(new v("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(u)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(r);var o=(new v("<span class='ke-progressbar-title'>")).appendTo(r);
k&&r.appendTo(k);this.el=r;this._title=o;this._p=u;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(u){u=u.newVal;this._p.css("width",u+"%");this._title.html(u+"%")}});q.ProgressBar=l}});
KISSY.Editor.add("removeformat",function(l){l.addPlugin("removeformat",function(){function p(f,d){for(var b=0;b<d.length;b++)f.removeAttr(d[b])}var q=KISSY.Editor,v=q.RANGE,u=q.ElementPath,r=q.NODE,k="class,style,lang,width,height,align,hspace,valign".split(/,/),o=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i"),i=l.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:q.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var f=
this.editor;f.focus();o.lastIndex=0;var d=f.getSelection().getRanges();f.fire("save");for(var b=0,g;g=d[b];b++)if(!g.collapsed){g.enlarge(v.ENLARGE_ELEMENT);var t=g.createBookmark(),h=t.startNode,c=t.endNode,a=function(e){for(var j=new u(e),s=j.elements,n=1,y;y=s[n];n++){if(y._4e_equals(j.block)||y._4e_equals(j.blockLimit))break;o.test(y._4e_name())&&e._4e_breakParent(y)}};a(h);a(c);for(h=h._4e_nextSourceNode(true,r.NODE_ELEMENT);h;){if(h._4e_equals(c))break;a=h._4e_nextSourceNode(false,r.NODE_ELEMENT);
h._4e_name()=="img"&&h.attr("_ke_realelement")||(o.test(h._4e_name())?h._4e_remove(true):p(h,k));h=a}g.moveToBookmark(t)}f.getSelection().selectRanges(d);f.fire("save")}});this.destroy=function(){i.destroy()}})},{attach:false});
KISSY.Editor.add("resize",function(l){var p=KISSY,q=p.Node;p.use("dd",function(){var v=p.Draggable,u=l.statusDiv,r=new q("<div class='ke-resizer'>"),k=l.cfg.pluginConfig.resize||{};k=k.direction||["x","y"];r.appendTo(u);l.on("maximizeWindow",function(){r.css("display","none")});l.on("restoreWindow",function(){r.css("display","")});var o=new v({node:r}),i=0,f=0,d=l.wrap,b=l.editorWrap;o.on("dragstart",function(){i=d.height();f=b.width()});o.on("drag",function(g){var t=g.left-this.startNodePos.left;
g=g.top-this.startNodePos.top;p.inArray("y",k)&&d.height(i+g);p.inArray("x",k)&&b.width(f+t)});l.on("destroy",function(){o.destroy();r.remove()})})},{attach:false});KISSY.Editor.add("separator",function(l){l.addPlugin("separator",function(){var p=(new KISSY.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(l.toolBarDiv);l.on("destroy",function(){p.remove()})},{duplicate:true})},{attach:false});
KISSY.Editor.add("smiley",function(l){l.addPlugin("smiley",function(){var p=KISSY.Editor,q=l.addButton("smiley",{contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",mode:p.WYSIWYG_MODE,loading:true});p.use("smiley/support",function(){q.reload(p.SmileySupport)});this.destroy=function(){q.destroy()}})},{attach:false});
KISSY.Editor.add("smiley/support",function(){function l(){if(r)return r;r="<div class='ke-smiley-sprite'>";for(var i=0;i<=98;i++)r+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+i+".gif'></a>";r+="</div>";return r}var p=KISSY,q=p.Event,v=p.Editor,u=p.DOM;u.addStyleSheet('.ke-smiley-sprite { background: url("http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png") no-repeat scroll -1px 0 transparent; height: 235px; width: 288px; margin: 5px;zoom: 1; overflow: hidden;}.ke-smiley-sprite a {   width: 24px;height: 24px; border: 1px solid white; float: left;}.ke-smiley-sprite a:hover { border: 1px solid #808080;}',
"smiley");var r,k=v.Utils.addRes,o=v.Utils.destroyRes;v.SmileySupport={_selectSmiley:function(i){i.halt();var f=this.editor;i=new p.Node(i.target);var d;if(i._4e_name()=="a"&&(d=i.attr("data-icon"))){d=new p.Node("<img class='ke_smiley'alt='' src='"+d+"'/>",null,f.document);f.insertElement(d);this.smileyWin.hide()}},_hidePanel:function(i){var f=this.btn.get("el");i=new p.Node(i.target);var d=this.smileyWin;f._4e_equals(i)||f.contains(i)||d.hide()},_prepare:function(){var i=this,f=i.cfg,d=i.btn,b=
i.editor,g=l();i.smileyWin=new v.Overlay({content:g,focus4e:false,width:"297px",autoRender:true,elCls:"ks-popup",zIndex:v.baseZIndex(v.zIndexManager.POPUP_MENU),mask:false});g=i.smileyWin;i.smileyPanel=g.get("contentEl");g.on("show",d.bon,d);g.on("hide",d.boff,d);i.smileyPanel.on("click",f._selectSmiley,i);q.on(document,"click",f._hidePanel,i);q.on(b.document,"click",f._hidePanel,i);i.cfg._prepare=i.cfg._real;k.call(i,i.smileyWin,i.smileyPanel,function(){q.remove(document,"click",f._hidePanel,i);
q.remove(b.document,"click",f._hidePanel,i)});i.call("_real")},_real:function(){var i=this.btn.get("el"),f=i.offset();f.top+=i.height()+5;if(f.left+this.smileyPanel.width()>u.viewportWidth()-60)f.left=u.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.set("xy",[f.left,f.top]);this.smileyWin.show()},offClick:function(){var i=this;v.use("overlay",function(){i.call("_prepare")})},onClick:function(){this.smileyWin&&this.smileyWin.hide()},destroy:function(){o.call(this)}}});
KISSY.Editor.add("sourcearea",function(l){l.addPlugin("sourcearea",function(){var p=KISSY,q=p.Editor;if(!(p.UA.gecko<1.92)){var v=q.SOURCE_MODE,u=q.WYSIWYG_MODE,r=l.addButton("sourcearea",{title:"\u6e90\u7801",contentCls:"ke-toolbar-source",loading:true});q.use("sourcearea/support",function(){r.reload({init:function(){var k=this.btn,o=this.editor;o.on("wysiwygmode",k.boff,k);o.on("sourcemode",k.bon,k)},offClick:function(){this.editor.execCommand("sourceAreaSupport",v)},onClick:function(){this.editor.execCommand("sourceAreaSupport",
u)}});l.addCommand("sourceAreaSupport",q.SourceAreaSupport)});this.destroy=function(){r.destroy()}}})},{attach:false});
KISSY.Editor.add("sourcearea/support",function(){function l(){var k=this.mapper={};k[u]=this._show;k[r]=this._hide}var p=KISSY,q=p.Editor,v=p.UA,u=q.SOURCE_MODE,r=q.WYSIWYG_MODE;p.augment(l,{exec:function(k,o){var i=this.mapper;i[o]&&i[o].call(this,k)},_show:function(k){k.textarea.val(k.getData(true));this._showSource(k);k.fire("sourcemode")},_showSource:function(k){var o=k.textarea,i=k.iframe;o.css("display","");i.css("display","none");v.ieEngine<8&&o.css("height",k.wrap.css("height"));o[0].focus()},
_hideSource:function(k){var o=k.textarea;k.iframe.css("display","");o.css("display","none")},_hide:function(k){var o=k.textarea;this._hideSource(k);k.fire("save");k.setData(o.val());k.fire("wysiwygmode");k.fire("save");v.gecko&&k.activateGecko()}});q.SourceAreaSupport=new l});
KISSY.Editor.add("table",function(l){l.addPlugin("table",function(){var p=KISSY,q=p.Editor,v=p.trim;p=(p.UA.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border");
var u=l.htmlDataProcessor,r=u&&u.dataFilter;u=u&&u.htmlFilter;r&&r.addRules({elements:{table:function(o){o=o.attributes;var i=o["class"],f=parseInt(o.border,10);if(!f||f<=0)o["class"]=(i||"")+" ke_show_border"}}});u&&u.addRules({elements:{table:function(o){o=o.attributes;var i=o["class"];if(i)o["class"]=v(i.replace("ke_show_border","").replace(/\s{2}/," "))}}});var k=l.addButton("table",{contentCls:"ke-toolbar-table",mode:q.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c",loading:true});q.use("table/support",function(){var o=
new q.TableUI(l);k.reload({offClick:function(){o._tableShow()},destroy:function(){o.destroy()}})});this.destroy=function(){k.destroy()};l.addCustomStyle(p)})},{attach:false});
KISSY.Editor.add("table/support",function(){function l(e){var j=this,s={},n;for(n in a)(function(y){s[y]=function(){e.fire("save");a[y](j);e.fire("save")}})(n);n=d.ContextMenu.register({editor:e,rules:g,width:"120px",funcs:s});t.call(j,n);j.editor=e}function p(e){function j(m){if(!(y.length>0))if(m[0].nodeType==b.NODE_ELEMENT&&c.test(m._4e_name())&&!m.data("selected_cell")){m._4e_setMarker(x,"selected_cell",true);y.push(m)}}for(var s=e.createBookmarks(),n=e.getRanges(),y=[],x={},A=0;A<n.length;A++){var E=
n[A];if(E.collapsed){E=E.getCommonAncestor();(E=E._4e_ascendant("td",true)||E._4e_ascendant("th",true))&&y.push(E)}else{E=new Walker(E);var z;for(E.guard=j;z=E.next();)if((z=z.parent())&&c.test(z._4e_name())&&!z.data("selected_cell")){z._4e_setMarker(x,"selected_cell",true);y.push(z)}}}d.Utils.clearAllMarkers(x);e.selectBookmarks(s);return y}function q(e,j){var s=e.getStartElement()._4e_ascendant("tr");if(s){var n=s._4e_clone(true);n.insertBefore(s);s=(j?n[0]:s[0]).cells;for(n=0;n<s.length;n++){s[n].innerHTML=
"";i.ie||(new f(s[n]))._4e_appendBogus()}}}function v(e){if(e instanceof d.Selection){var j=p(e),s=j.length;e=[];for(var n,y,x=0;x<s;x++){var A=j[x].parent(),E=A[0].rowIndex;!x&&(n=E-1);e[E]=A;x==s-1&&(y=E+1)}x=A._4e_ascendant("table");n=new f(y<x[0].rows.length&&x[0].rows[y]||n>0&&x[0].rows[n]||x[0].parentNode);for(x=e.length;x>=0;x--)e[x]&&v(e[x]);return n}else if(e instanceof f){x=e._4e_ascendant("table");x[0].rows.length==1?x._4e_remove():e._4e_remove()}return 0}function u(e,j){var s=e.getStartElement();
if(s=s._4e_ascendant("td",true)||s._4e_ascendant("th",true))for(var n=s._4e_ascendant("table"),y=s[0].cellIndex,x=0;x<n[0].rows.length;x++){var A=n[0].rows[x];if(!(A.cells.length<y+1)){s=new f(A.cells[y].cloneNode(false));i.ie||s._4e_appendBogus();A=new f(A.cells[y]);j?s.insertBefore(A):s.insertAfter(A)}}}function r(e){if(e instanceof d.Selection){var j=p(e),s,n=[];e=j[0]&&j[0]._4e_ascendant("table");var y,x,A;y=0;for(x=j.length;y<x;y++)n.push(j[y][0].cellIndex);n.sort();y=1;for(x=n.length;y<x;y++)if(n[y]-
n[y-1]>1){A=n[y-1]+1;break}A||(A=n[0]>0?n[0]-1:n[n.length-1]+1);n=e[0].rows;y=0;for(x=n.length;y<x;y++)if(s=n[y].cells[A])break;s=s?new f(s):e._4e_previous();for(A=j.length-1;A>=0;A--)j[A]&&r(j[A]);return s}else if(e instanceof f){j=e._4e_ascendant("table");if(!j)return null;s=e[0].cellIndex;for(A=j[0].rows.length-1;A>=0;A--){e=new f(j[0].rows[A]);if(!s&&e[0].cells.length==1)v(e);else e[0].cells[s]&&e[0].removeChild(e[0].cells[s])}}return null}function k(e,j){var s=new d.Range(e[0].ownerDocument);
if(!s.moveToElementEditablePosition(e,j?true:undefined)){s.selectNodeContents(e);s.collapse(j?false:true)}s.select(true)}var o=KISSY,i=o.UA,f=o.Node,d=o.Editor,b=d.NODE,g=["tr","th","td","tbody","table"],t=d.Utils.addRes,h=d.Utils.destroyRes;o.augment(l,{_tableShow:function(e,j,s){this.editor.useDialog("table/dialog",function(n){n.show(j,s)})},destroy:function(){h.call(this);this.editor.destroyDialog("table/dialog")}});var c=/^(?:td|th)$/,a={"\u8868\u683c\u5c5e\u6027":function(e){var j=e.editor.getSelection(),s=j&&j.getStartElement();
if(j=s&&s._4e_ascendant("table",true)){s=s._4e_ascendant(function(n){n=n._4e_name();return n=="td"||n=="th"},true);e._tableShow(null,j,s)}},"\u5220\u9664\u8868\u683c":function(e){var j=(e=e.editor.getSelection())&&e.getStartElement();if(j=j&&j._4e_ascendant("table",true)){e.selectElement(j);var s=e.getRanges()[0];s.collapse();e.selectRanges([s]);e=j.parent();e[0].childNodes.length==1&&e._4e_name()!="body"&&e._4e_name()!="td"?e._4e_remove():j._4e_remove()}},"\u5220\u9664\u884c ":function(e){e=e.editor.getSelection();k(v(e),undefined)},
"\u5220\u9664\u5217 ":function(e){e=e.editor.getSelection();(e=r(e))&&k(e,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(e){e=e.editor.getSelection();q(e,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(e){e=e.editor.getSelection();q(e,undefined)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(e){e=e.editor.getSelection();u(e,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(e){e=e.editor.getSelection();u(e,undefined)}};d.TableUI=l},{requires:["contextmenu"]});
KISSY.Editor.add("tabs",function(){function l(r){this.cfg=r;this._init()}var p=KISSY,q=p.Editor,v=p.DOM,u=p.Node;if(q.Tabs)p.log("ke tabs attach more","warn");else{p.augment(l,p.EventTarget,{_init:function(){var r=this,k=r.cfg,o=k.tabs,i=k.contents.children("div"),f=o.children("li");o.on("click",function(d){d=new u(d.target);if(d=d._4e_ascendant(function(g){return g._4e_name()==="li"&&o.contains(g)},true)){f.removeClass("ke-tab-selected");var b=d.attr("rel");d.addClass("ke-tab-selected");i.hide();
v.show(i[p.indexOf(d[0],f)]);r.fire(b)}})},getTab:function(r){var k=this.cfg,o=k.tabs;k=k.contents.children("div");o=o.children("li");for(var i=0;i<o.length;i++){var f=new u(o[i]),d=new u(k[i]);if(p.isNumber(r)&&r==i||p.isString(r)&&r==f.attr("rel"))return{tab:f,content:d}}},remove:function(r){r=this.getTab(r);r.tab.remove();r.content.remove()},_getActivate:function(){for(var r=this.cfg.tabs.children("li"),k=0;k<r.length;k++){var o=new u(r[k]);if(o.hasClass("ke-tab-selected"))return o.attr("rel")}},
activate:function(r){if(arguments.length==0)return this._getActivate();var k=this.cfg,o=k.tabs;k=k.contents.children("div");o.children("li").removeClass("ke-tab-selected");k.hide();o=this.getTab(r);o.tab.addClass("ke-tab-selected");o.content.show()},destroy:function(){var r=this.cfg.tabs;r.detach();r.remove()}});q.Tabs=l}});
KISSY.Editor.add("templates",function(l){l.addPlugin("templates",function(){var p=KISSY,q=p.Editor,v=p.Node;p.DOM.addStyleSheet(".ke-tpl {    border: 2px solid #EEEEEE;    width: 95%;    margin: 20px auto;}.ke-tpl-list {    border: 1px solid #EEEEEE;    margin: 5px;    padding: 7px;    display: block;    text-decoration: none;    zoom: 1;}.ke-tpl-list:hover, .ke-tpl-selected {    background-color: #FFFACD;    text-decoration: none;    border: 1px solid #FF9933;}","ke-templates");var u=l.addButton("templates",
{contentCls:"ke-toolbar-template",title:"\u6a21\u677f",mode:q.WYSIWYG_MODE,offClick:function(){var r=this;q.use("overlay",function(){r.cfg._prepare.call(r)})},_prepare:function(){for(var r=this.editor,k=r.cfg.pluginConfig.templates||[],o="<div class='ke-tpl'>",i=0;i<k.length;i++)o+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+k[i].demo+"</a>";o+="</div>";var f=new q.Dialog({width:500,mask:true,autoRender:true,headerContent:"\u5185\u5bb9\u6a21\u677f",bodyContent:o});f.get("el").all(".ke-tpl-list").on("click",
function(d){d.halt();d=(new v(d.target))._4e_index();d!=-1&&r.insertHtml(k[d].html);f.hide()});this.ui=f;this.cfg.show.call(this);this.cfg._prepare=this.cfg.show},show:function(){this.ui.show()}});this.destroy=function(){u.destroy()}})},{attach:false});
KISSY.Editor.add("undo",function(l){var p=KISSY,q=p.Editor,v={redo:1,undo:-1},u={mode:q.WYSIWYG_MODE,init:function(){this.editor.on("afterSave afterRestore",this.cfg._respond,this);this.btn.disable()},offClick:function(){this.editor.fire("restore",{d:v[this.cfg.flag]})}},r=p.mix({flag:"undo",_respond:function(o){var i=this.btn;o.index>0?i.boff():i.disable()}},u,false),k=p.mix({flag:"redo",_respond:function(o){var i=this.btn;o.index<o.history.length-1?i.boff():i.disable()}},u,false);l.addPlugin("undo",
function(){var o=l.addButton("undo",{title:"\u64a4\u9500",loading:true,contentCls:"ke-toolbar-undo"}),i=l.addButton("undo",{title:"\u91cd\u505a",loading:true,contentCls:"ke-toolbar-redo"});q.use("undo/support",function(){new q.UndoManager(l);o.reload(r);i.reload(k)});this.destroy=function(){o.destroy();i.destroy()}})},{attach:false});
KISSY.Editor.add("undo/support",function(){function l(f){var d=f._getRawData(),b;if(d)b=f.getSelection();this.contents=d;this.bookmarks=b&&b.createBookmarks2(true)}function p(f){this.history=[];this.index=-1;this.editor=f;this.bufferRunner=v.Utils.buffer(this.save,this,500);this._init()}var q=KISSY,v=q.Editor,u=v.Utils.arrayCompare,r=q.UA,k=q.Event;q.augment(l,{equals:function(f){if(this.contents!=f.contents)return false;var d=this.bookmarks;f=f.bookmarks;if(d||f){if(!d||!f||d.length!=f.length)return false;
for(var b=0;b<d.length;b++){var g=d[b],t=f[b];if(g.startOffset!=t.startOffset||g.endOffset!=t.endOffset||!u(g.start,t.start)||!u(g.end,t.end))return false}}return true}});var o={16:1,17:1,18:1},i={37:1,38:1,39:1,40:1,33:1,34:1};q.augment(p,{_keyMonitor:function(){var f=this.editor;k.on([f.document,f.textarea],"keydown",function(d){var b=d.keyCode;if(!(b in i||b in o))if(b===90&&(d.ctrlKey||d.metaKey)){f.fire("restore",{d:-1});d.halt()}else if(b===89&&(d.ctrlKey||d.metaKey)){f.fire("restore",{d:1});
d.halt()}else f.fire("save",{buffer:1})})},_init:function(){var f=this,d=f.editor;d.on("save",function(b){if(d.getMode()==v.WYSIWYG_MODE)b.buffer?f.bufferRunner():f.save()});d.on("restore",function(b){d.getMode()==v.WYSIWYG_MODE&&f.restore(b)});f._keyMonitor();setTimeout(function(){f.save()},0)},save:function(){var f=this.history,d=this.index;f.length>d+1&&f.splice(d+1,f.length-d-1);var b=this.editor;d=f[f.length-1];var g=new l(b);if(!d||!d.equals(g)){f.length===30&&f.shift();f.push(g);this.index=
d=f.length-1;b.fire("afterSave",{history:f,index:d})}},restore:function(f){f=f.d;var d=this.history,b=this.editor,g=d[this.index+f];if(g){b._setRawData(g.contents);if(g.bookmarks)b.getSelection().selectBookmarks(g.bookmarks);else if(r.ie){g=b.document.body.createTextRange();g.collapse(true);g.select()}(g=b.getSelection())&&g.scrollIntoView();this.index+=f;b.fire("afterRestore",{history:d,index:this.index});b.notifySelectionChange()}}});v.UndoManager=p});
