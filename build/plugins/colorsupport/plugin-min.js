KISSY.Editor.add("colorsupport",function(){function m(){if(!e){e="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var a=0;a<3;a++){e+="<div class='ke-color-palette'><table>";for(var b=n[a],d=b.length/8,c=0;c<d;c++){e+="<tr>";for(var g=0;g<8;g++){var h="#"+b[8*c+g];e+="<td>";e+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+h+"'></a>";e+="</td>"}e+="</tr>"}e+="</table></div>"}e+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"}}
function j(a){j.superclass.constructor.call(this,a);this._init()}var f=KISSY.Editor,i=KISSY,o=i.Node,l=i.Event,p=f.Overlay,q=f.TripleButton,k=i.DOM;if(!f.ColorSupport){k.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var n=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04",
"7F6000","274E13","0C343D","073763","20124D","4C1130"]],e;j.ATTRS={editor:{},styles:{},contentCls:{},text:{}};i.extend(j,i.Base,{_init:function(){var a=this.get("editor"),b=new q({container:a.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});b.on("offClick onClick",this._showColors,this);this.el=b;f.Utils.lazyRun(this,"_prepare","_real");f.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(a){var b=this.el.el;
a=a.target;var d=this.colorWin;b._4e_equals(a)||b.contains(a)||d.hide()},_selectColor:function(a){a.halt();a=a.target;if(k._4e_name(a)=="a"&&!k.hasClass(a,"ke-button")){a=new o(a);this._applyColor(a._4e_style("background-color"));this.colorWin.hide()}},_applyColor:function(a){var b=this.get("editor"),d=b.document,c=this.get("styles");b.fire("save");a?(new f.Style(c,{color:a})).apply(d):(new f.Style(c,{color:"inherit"})).remove(d);b.fire("save")},_prepare:function(){var a=this,b=document,d=a.el,c=
a.get("editor"),g;m();a.colorWin=new p({elCls:"ks-popup",content:e,focus4e:false,width:"170px",zIndex:c.baseZIndex(f.zIndexManager.POPUP_MENU)});var h=a.colorWin;h.renderer();g=h.get("contentEl");g.on("click",a._selectColor,a);a.colorPanel=g;l.on(b,"click",a._hidePanel,a);l.on(c.document,"click",a._hidePanel,a);h.on("show",d.bon,d);h.on("hide",d.boff,d);g.one(".ke-color-others").on("click",function(r){r.halt();h.hide();c.useDialog("colorsupport/dialog",function(s){s.show(a)})})},_real:function(){var a=
this.el.el,b=this.colorPanel,d=k.viewportWidth();b=b.width();var c=a.offset();c.top+=a.height()+5;if(c.left+b>d-60)c.left=d-b-60;this.colorWin.set("xy",[c.left,c.top]);this.colorWin.show()},_showColors:function(a){var b=this.colorWin;b&&b.get("visible")?b.hide():this._prepare(a)}});f.ColorSupport=j}});
