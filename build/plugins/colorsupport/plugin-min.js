KISSY.Editor.add("colorsupport",function(q){function r(a){return("0"+a).slice(a.length-1,a.length+1)}function l(a){a=e.trim(a);if(a.charAt(0)=="#")a=a.substring(1);a=a.replace(/\s+/g,"");var b="";if(/^[0-9a-f]{3,3}$/i.test(a))b=a.replace(/[0-9a-f]/ig,function(i){return i+i});else{var c=a.match(s);if(c&&c[0])for(a=1;a<4;a++)b+=r(parseInt(c[a]).toString(16));else b=a}return"#"+b.toLowerCase()}function g(a){g.superclass.constructor.call(this,a);this._init()}var f=KISSY.Editor,e=KISSY,m=e.Node,n=e.Event,
t=f.SimpleOverlay,u=f.TripleButton,h=e.DOM;if(!f.ColorSupport){for(var s=/^rgb\((\d+),(\d+),(\d+)\)$/i,v="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF".split(/,/),o=[],d="<div><a class='ke-color-remove' href=\"javascript:void('清除');\"><span>清除</span></a><table>",j=0;j<5;j++){d+="<tr>";
for(var k=0;k<8;k++){var p=l(v[8*j+k]);d+="<td>";d+="<a href='javascript:void(0);' class='ke-color-a'><span style='background-color:"+p+"'></span></a>";d+="</td>";o.push(p)}d+="</tr>"}d+="</table></div>";g.VALID_COLORS=o;g.ATTRS={editor:{},styles:{},contentCls:{},text:{}};e.extend(g,e.Base,{_init:function(){var a=this.get("editor"),b=new u({container:a.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});b.on("offClick",this._showColors,this);this.el=b;f.Utils.lazyRun(this,"_prepare",
"_real");f.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(a){var b=this,c=b.colorWin;if(c.get("visible"))h._4e_ascendant(a.target,function(i){return i._4e_equals(b.el.el)},true)||c.hide()},_selectColor:function(a){a.halt();var b=this.get("editor");a=a.target;if(h._4e_name(a)=="span"||h._4e_name(a)=="a"){a=new m(a);if(a._4e_name()=="a")a=a.one("span");var c=this.get("styles");b.fire("save");a._4e_style("background-color")?
c[l(a._4e_style("background-color"))].apply(b.document):c.inherit.remove(b.document);b.fire("save");this.colorWin.hide()}},_prepare:function(){var a=document,b=new m(d);this.colorWin=new t({el:b,width:"130px",zIndex:990,mask:false,focusMgr:false});b._4e_unselectable();b.on("click",this._selectColor,this);this.colorPanel=b;n.on(a,"click",this._hidePanel,this);n.on(q.document,"click",this._hidePanel,this)},_real:function(){var a=this.el.el,b=this.colorPanel,c=a.offset();c.top+=a.height()+5;if(c.left+
b.width()>h.viewportWidth()-60)c.left=h.viewportWidth()-b.width()-60;this.colorWin.show(c)},_showColors:function(a){this._prepare(a)}});f.ColorSupport=g}});
