KISSY.Editor.add("colorsupport",function(){function q(a){return("0"+a).slice(a.length-1,a.length+1)}function k(a){a=f.trim(a);if(a.charAt(0)=="#")a=a.substring(1);a=a.replace(/\s+/g,"");var b="";if(/^[0-9a-f]{3,3}$/i.test(a))b=a.replace(/[0-9a-f]/ig,function(l){return l+l});else{var c=a.match(r);if(c&&c[0])for(a=1;a<4;a++)b+=q(parseInt(c[a]).toString(16));else b=a}return"#"+b.toLowerCase()}function g(a){g.superclass.constructor.call(this,a);this._init()}var d=KISSY.Editor,f=KISSY,m=f.Node,n=f.Event,
s=d.SimpleOverlay,t=d.TripleButton,h=f.DOM;if(!d.ColorSupport){for(var r=/^rgb\((\d+),(\d+),(\d+)\)$/i,u="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF".split(/,/),o=[],e="<div><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\"><span>\u6e05\u9664</span></a><table>",i=0;i<5;i++){e+="<tr>";
for(var j=0;j<8;j++){var p=k(u[8*i+j]);e+="<td>";e+="<a href='javascript:void(0);' class='ke-color-a'><span style='background-color:"+p+"'></span></a>";e+="</td>";o.push(p)}e+="</tr>"}e+="</table></div>";g.VALID_COLORS=o;g.ATTRS={editor:{},styles:{},contentCls:{},text:{}};f.extend(g,f.Base,{_init:function(){var a=this.get("editor"),b=new t({container:a.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});b.on("offClick",this._showColors,this);this.el=b;d.Utils.lazyRun(this,"_prepare",
"_real");d.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(a){var b=this.el.el;a=a.target;var c=this.colorWin;b._4e_equals(a)||b._4e_contains(a)||c.hide()},_selectColor:function(a){a.halt();var b=this.get("editor");a=a.target;if(h._4e_name(a)=="span"||h._4e_name(a)=="a"){a=new m(a);if(a._4e_name()=="a")a=a.one("span");var c=this.get("styles");b.fire("save");a._4e_style("background-color")?c[k(a._4e_style("background-color"))].apply(b.document):
c.inherit.remove(b.document);b.fire("save");this.colorWin.hide()}},_prepare:function(){var a=document,b=this.get("editor"),c=new m(e);this.colorWin=new s({el:c,width:"130px",zIndex:b.baseZIndex(d.zIndexManager.POPUP_MENU),mask:false,focusMgr:false});c._4e_unselectable();c.on("click",this._selectColor,this);this.colorPanel=c;n.on(a,"click",this._hidePanel,this);n.on(b.document,"click",this._hidePanel,this)},_real:function(){var a=this.el.el,b=this.colorPanel,c=a.offset();c.top+=a.height()+5;if(c.left+
b.width()>h.viewportWidth()-60)c.left=h.viewportWidth()-b.width()-60;this.colorWin.show(c)},_showColors:function(a){var b=this.colorWin;b&&b.get("visible")?b.hide():this._prepare(a)}});d.ColorSupport=g}});
