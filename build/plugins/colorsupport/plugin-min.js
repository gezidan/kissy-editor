KISSY.Editor.add("colorsupport",function(){function s(a){return("0"+a).slice(a.length-1,a.length+1)}function o(a){a=g.trim(a);if(a.charAt(0)=="#")a=a.substring(1);a=a.replace(/\s+/g,"");var b="";if(/^[0-9a-f]{3,3}$/i.test(a))b=a.replace(/[0-9a-f]/ig,function(d){return d+d});else{var c=a.match(t);if(c&&c[0])for(a=1;a<4;a++)b+=s(parseInt(c[a]).toString(16));else b=a}return"#"+b.toLowerCase()}function j(a){j.superclass.constructor.call(this,a);this._init()}var e=KISSY.Editor,g=KISSY,p=g.Node,q=g.Event,
u=e.SimpleOverlay,v=e.TripleButton,h=g.DOM;if(!e.ColorSupport){h.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");for(var t=/^rgb\((\d+),(\d+),(\d+)\)$/i,w=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394",
"351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"]],f="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>",k=0;k<3;k++){f+="<div class='ke-color-palette'><table>";for(var r=w[k],x=r.length/8,l=0;l<x;l++){f+="<tr>";for(var m=0;m<8;m++){var y=o(r[8*l+m]);f+="<td>";f+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+y+"'></a>";f+="</td>"}f+="</tr>"}f+="</table></div>"}f+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>";
j.ATTRS={editor:{},styles:{},contentCls:{},text:{}};g.extend(j,g.Base,{_init:function(){var a=this.get("editor"),b=new v({container:a.toolBarDiv,title:this.get("title"),contentCls:this.get("contentCls")});b.on("offClick",this._showColors,this);this.el=b;e.Utils.lazyRun(this,"_prepare","_real");e.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},_hidePanel:function(a){var b=this.el.el;a=a.target;var c=this.colorWin;b._4e_equals(a)||b._4e_contains(a)||
c.hide()},_selectColor:function(a){a.halt();a=a.target;if(h._4e_name(a)=="a"&&!h.hasClass(a,"ke-button")){a=new p(a);this._applyColor(o(a._4e_style("background-color")));this.colorWin.hide()}},_applyColor:function(a){var b=this.get("editor"),c=b.document,d=this.get("styles");b.fire("save");a?(new e.Style(d,{color:a})).apply(c):(new e.Style(d,{color:"inherit"})).remove(c);b.fire("save")},_prepare:function(){var a=this,b=document,c=a.el,d=a.get("editor"),i=new p(f);a.colorWin=new u({el:i,width:"170px",
zIndex:d.baseZIndex(e.zIndexManager.POPUP_MENU),mask:false,focusMgr:false});i._4e_unselectable();i.on("click",a._selectColor,a);a.colorPanel=i;q.on(b,"click",a._hidePanel,a);q.on(d.document,"click",a._hidePanel,a);var n=a.colorWin;n.on("show",c.bon,c);n.on("hide",c.boff,c);i.one(".ke-color-others").on("click",function(z){z.halt();n.hide();d.useDialog("colorsupport/dialog",function(A){A.show(a)})})},_real:function(){var a=this.el.el,b=this.colorPanel,c=a.offset();c.top+=a.height()+5;if(c.left+b.width()>
h.viewportWidth()-60)c.left=h.viewportWidth()-b.width()-60;this.colorWin.show(c)},_showColors:function(a){var b=this.colorWin;b&&b.get("visible")?b.hide():this._prepare(a)}});e.ColorSupport=j}});
