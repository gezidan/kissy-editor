KISSY.add("overlay",function(a){a.Overlay=a.UIBase.create([a.UIBase.Box,a.UIBase.ContentBox,a.UIBase.Position,a.UIBase.Loading,a.UA.ie==6?a.UIBase.Shim:null,a.UIBase.Align,a.UIBase.Mask],{initializer:function(){a.log("Overlay init")},renderUI:function(){a.log("_renderUIOverlay");this.get("el").addClass("ks-overlay")},syncUI:function(){a.log("_syncUIOverlay")},bindUI:function(){a.log("_bindUIOverlay")},destructor:function(){a.log("overlay destructor")}})},{requires:["core"]});
KISSY.add("dialog",function(a){a.Dialog=a.UIBase.create(a.Overlay,[a.UIBase.StdMod,a.UIBase.Close,a.UIBase.Drag,a.UIBase.Constrain],{initializer:function(){a.log("dialog init")},renderUI:function(){a.log("_renderUIDialog");this.get("el").addClass("ks-dialog");this.set("handlers",[this.get("header")])},bindUI:function(){a.log("_bindUIDialog")},syncUI:function(){a.log("_syncUIDialog")},destructor:function(){a.log("Dialog destructor")}})},{host:"overlay"});
KISSY.Editor.add("ext-focus",function(){function a(){b.log("FocusExt init")}var b=KISSY,f=b.UA,e=b.Editor,d=e.focusManager;e.namespace("UIBase");a.ATTRS={focus4e:{value:true}};a.prototype={_uiSetFocus4e:function(c){if(c){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){b.log("_syncUIFocusExt")},__renderUI:function(){b.log("_renderUIFocusExt")},__bindUI:function(){this._focus4e=
(new b.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var c=this._focusEditor=d.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(f.ie&&c){var g=c.document.selection.createRange();if(g)if(g.item&&g.item(0).ownerDocument==c.document){c=document.body.createTextRange();c.moveToElementText(this.get("el")._4e_first()[0]);c.collapse(true);
c.select()}}},_hide4FocusExt:function(){var c=this._focusEditor;c&&c.focus()}};e.UIBase.Focus=a},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var a=KISSY,b=a.Editor;if(!b.Overlay){var f=a.UIBase.create(a.Overlay,[b.UIBase.Focus],{init:function(){a.log("Overlay4E init")},syncUI:function(){a.log("_syncUIOverlay4E");b.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:b.baseZIndex(b.zIndexManager.OVERLAY)}}}),e=a.UIBase.create(a.Dialog,[b.UIBase.Focus],{show:function(){this.center();var c=this.get("y");if(c-a.DOM.scrollTop()>200){c=a.DOM.scrollTop()+200;this.set("y",c)}e.superclass.show.call(this)}},
{ATTRS:{constrain:{value:true},zIndex:{value:b.baseZIndex(b.zIndexManager.OVERLAY)}}});b.Overlay=f;b.Dialog=e;var d;b.Overlay.loading=function(){d||(d=new b.Overlay({x:0,focus4e:false,width:a.UA.ie==6?a.DOM.docWidth():"100%",y:0,zIndex:b.baseZIndex(b.zIndexManager.LOADING),elCls:"ke-global-loading"}));d.set("height",a.DOM.docHeight());d.show();d.loading()};b.Overlay.unloading=function(){d&&d.hide()}}});
