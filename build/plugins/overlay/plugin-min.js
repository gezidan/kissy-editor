KISSY.Editor.add("ext-focus",function(){function b(){a.log("FocusExt init")}var a=KISSY,f=a.UA,e=a.Editor,d=e.focusManager;e.namespace("UIBase");b.ATTRS={focus4e:{value:true}};b.prototype={_uiSetFocus4e:function(c){if(c){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",this._hide4FocusExt,this)}},__syncUI:function(){a.log("_syncUIFocusExt")},__renderUI:function(){a.log("_renderUIFocusExt")},__bindUI:function(){this._focus4e=
(new a.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var c=this._focusEditor=d.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(f.ie&&c){var g=c.document.selection.createRange();if(g)if(g.item&&g.item(0).ownerDocument==c.document){c=document.body.createTextRange();c.moveToElementText(this.get("el")._4e_first()[0]);c.collapse(true);
c.select()}}},_hide4FocusExt:function(){var c=this._focusEditor;c&&c.focus()}};e.UIBase.Focus=b},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var b=KISSY,a=b.Editor;if(!a.Overlay){var f=b.UIBase.create(b.Overlay,[a.UIBase.Focus],{init:function(){b.log("Overlay4E init")},syncUI:function(){b.log("_syncUIOverlay4E");a.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:a.baseZIndex(a.zIndexManager.OVERLAY)}}}),e=b.UIBase.create(b.Dialog,[a.UIBase.Focus],{show:function(){this.center();var c=this.get("y");if(c-b.DOM.scrollTop()>200){c=b.DOM.scrollTop()+200;this.set("y",c)}e.superclass.show.call(this)}},
{ATTRS:{constrain:{value:true},zIndex:{value:a.baseZIndex(a.zIndexManager.OVERLAY)}}});a.Overlay=f;a.Dialog=e;var d;a.Overlay.loading=function(){d||(d=new a.Overlay({x:0,focus4e:false,width:b.UA.ie==6?b.DOM.docWidth():"100%",y:0,zIndex:a.baseZIndex(a.zIndexManager.LOADING),elCls:"ke-global-loading"}));d.set("height",b.DOM.docHeight());d.show();d.loading()};a.Overlay.unloading=function(){d&&d.hide()}}});
