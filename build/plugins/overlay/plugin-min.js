KISSY.add("ext-align",function(a){function c(){a.log("align init");this.on("bindUI",this._bindUIAlign,this);this.on("renderUI",this._renderUIAlign,this);this.on("syncUI",this._syncUIAlign,this)}function f(b,d){var g=d.charAt(0),k=d.charAt(1),i,h,j,l;if(b){b=a.one(b);i=b.offset();h=b[0].offsetWidth;j=b[0].offsetHeight}else{i={left:e.scrollLeft(),top:e.scrollTop()};h=e.viewportWidth();j=e.viewportHeight()}l=i.left;i=i.top;if(g==="c")i+=j/2;else if(g==="b")i+=j;if(k==="c")l+=h/2;else if(k==="r")l+=h;
return{left:l,top:i}}a.namespace("Ext");var e=a.DOM;a.mix(c,{TL:"tl",TC:"tc",TR:"tr",CL:"cl",CC:"cc",CR:"cr",BL:"bl",BC:"bc",BR:"br"});c.ATTRS={align:{}};c.prototype={_bindUIAlign:function(){a.log("_bindUIAlign")},_renderUIAlign:function(){a.log("_renderUIAlign")},_syncUIAlign:function(){a.log("_syncUIAlign")},_uiSetAlign:function(b){a.log("_uiSetAlign");a.isPlainObject(b)&&this.align(b.node,b.points,b.offset)},align:function(b,d,g){var k,i=this.get("el");g=g||[0,0];k=e.offset(i);b=f(b,d[0]);d=f(i,
d[1]);d=[d.left-b.left,d.top-b.top];this.set("xy",[k.left-d[0]+ +g[0],k.top-d[1]+ +g[1]])},center:function(b){this.set("align",{node:b,points:[c.CC,c.CC],offset:[0,0]})},__destructor:function(){a.log("align __destructor")}};a.Ext.Align=c});
KISSY.add("ext-box",function(a){function c(){a.log("box init");this.on("renderUI",this._renderUIBoxExt,this);this.on("syncUI",this._syncUIBoxExt,this);this.on("bindUI",this._bindUIBoxExt,this)}a.namespace("Ext");var f=document,e=a.Node;c.ATTRS={el:{setter:function(b){if(a.isString(b))return a.one(b)}},elCls:{},elStyle:{},width:{},height:{},html:{value:false}};c.HTML_PARSER={el:function(b){return b}};c.prototype={_syncUIBoxExt:function(){a.log("_syncUIBoxExt")},_bindUIBoxExt:function(){a.log("_bindUIBoxExt")},
_renderUIBoxExt:function(){a.log("_renderUIBoxExt");var b=this.get("render")||a.one(f.body),d=this.get("el");b=new e(b);if(!d){d=new e("<div>");b.prepend(d);this.set("el",d)}},_uiSetElCls:function(b){a.log("_uiSetElCls");b&&this.get("el").addClass(b)},_uiSetElStyle:function(b){a.log("_uiSetElStyle");b&&this.get("el").css(b)},_uiSetWidth:function(b){a.log("_uiSetWidth");b&&this.get("el").width(b)},_uiSetHeight:function(b){a.log("_uiSetHeight");b&&this.get("el").height(b)},_uiSetHtml:function(b){a.log("_uiSetHtml");
b!==false&&this.get("el").html(b)},__destructor:function(){a.log("box __destructor");var b=this.get("el");if(b){b.detach();b.remove()}}};a.Ext.Box=c});
KISSY.add("ext-overlay-close",function(a){function c(){a.log("close init");this.on("renderUI",this._rendUICloseExt,this);this.on("bindUI",this._bindUICloseExt,this);this.on("syncUI",this._syncUICloseExt,this)}a.namespace("Ext");var f=a.Node;c.ATTRS={closable:{value:true},closeBtn:{}};c.HTML_PARSER={closeBtn:".ks-ext-close"};c.prototype={_syncUICloseExt:function(){a.log("_syncUICloseExt")},_uiSetClosable:function(e){a.log("_uiSetClosable");var b=this.get("closeBtn");if(b)e?b.show():b.hide()},_rendUICloseExt:function(){a.log("_rendUICloseExt");
var e=this.get("closeBtn"),b=this.get("contentEl");if(!e&&b){e=(new f("<a href='#' class='ks-ext-close'><span class='ks-ext-close-x'>X</span></a>")).appendTo(b);this.set("closeBtn",e)}},_bindUICloseExt:function(){a.log("_bindUICloseExt");var e=this,b=e.get("closeBtn");b&&b.on("click",function(d){e.hide();d.halt()})},__destructor:function(){a.log("close-ext __destructor");var e=this.get("closeBtn");e&&e.detach()}};a.Ext.Close=c});
KISSY.add("ext-constrain",function(a){function c(){a.log("constrain init");this.on("bindUI",this._bindUIConstrain,this);this.on("renderUI",this._renderUIConstrain,this);this.on("syncUI",this._syncUIConstrain,this)}function f(b){var d=undefined;if(!b)return d;var g=this.get("el");if(b!==true){b=a.one(b);d=b.offset();a.mix(d,{maxLeft:d.left+b[0].offsetWidth-g[0].offsetWidth,maxTop:d.top+b[0].offsetHeight-g[0].offsetHeight})}else{b=document.documentElement.clientWidth;d={left:e.scrollLeft(),top:e.scrollTop()};
a.mix(d,{maxLeft:d.left+b-g[0].offsetWidth,maxTop:d.top+e.viewportHeight()-g[0].offsetHeight})}return d}a.namespace("Ext");var e=a.DOM;c.ATTRS={constrain:{value:false}};c.prototype={_bindUIConstrain:function(){a.log("_bindUIConstrain")},_renderUIConstrain:function(){a.log("_renderUIConstrain");var b=this,d=b.getDefAttrs(),g=d.x;d=d.y;var k=g.setter,i=d.setter;g.setter=function(h){var j=k&&k(h);if(j===undefined)j=h;if(!b.get("constrain"))return j;h=f.call(b,b.get("constrain"));return Math.min(Math.max(j,
h.left),h.maxLeft)};d.setter=function(h){var j=i&&i(h);if(j===undefined)j=h;if(!b.get("constrain"))return j;h=f.call(b,b.get("constrain"));return Math.min(Math.max(j,h.top),h.maxTop)};b.addAttr("x",g);b.addAttr("y",d)},_syncUIConstrain:function(){a.log("_syncUIConstrain")},__destructor:function(){a.log("constrain-ext __destructor")}};a.Ext.Constrain=c});
KISSY.add("ext-contentbox",function(a){function c(){a.log("contentbox init");this.on("renderUI",this._renderUIContentBox,this);this.on("syncUI",this._syncUIContentBox,this);this.on("bindUI",this._bindUIContentBox,this)}a.namespace("Ext");var f=a.Node;c.ATTRS={contentEl:{},content:{}};c.HTML_PARSER={contentEl:".ks-contentbox"};c.prototype={_syncUIContentBox:function(){a.log("_syncUIContentBox")},_bindUIContentBox:function(){a.log("_bindUIContentBox")},_renderUIContentBox:function(){a.log("_renderUIContentBox");
var e=this.get("contentEl"),b=this.get("el");if(!e){e=(new f("<div class='ks-contentbox'>")).appendTo(b);this.set("contentEl",e)}},_uiSetContent:function(e){a.log("_uiSetContent");e!==undefined&&this.get("contentEl").html(e)},__destructor:function(){a.log("contentbox __destructor")}};a.Ext.ContentBox=c});
KISSY.add("ext-drag",function(a){function c(){a.log("drag init");this.on("bindUI",this._bindUIDragExt,this);this.on("renderUI",this._renderUIDragExt,this);this.on("syncUIUI",this._syncUIDragExt,this)}a.namespace("Ext");c.ATTRS={handlers:{value:[]},draggable:{value:true}};c.prototype={_uiSetHandlers:function(f){a.log("_uiSetHanlders");f&&f.length>0&&this.__drag.set("handlers",f)},_syncUIDragExt:function(){a.log("_syncUIDragExt")},_renderUIDragExt:function(){a.log("_renderUIDragExt")},_bindUIDragExt:function(){a.log("_bindUIDragExt");
var f=this.get("el");this.__drag=new a.Draggable({node:f,handlers:this.get("handlers")})},_uiSetDraggable:function(f){a.log("_uiSetDraggable");var e=this.__drag;if(f){e.detach("drag");e.on("drag",this._dragExtAction,this)}else e.detach("drag")},_dragExtAction:function(f){this.set("xy",[f.left,f.top])},__destructor:function(){a.log("DragExt __destructor");var f=this.__drag;f&&f.destroy()}};a.Ext.Drag=c});
KISSY.add("ext-loading",function(a){function c(){a.log("LoadingExt init")}a.namespace("Ext");c.prototype={loading:function(){if(!this._loadingExtEl)this._loadingExtEl=(new a.Node("<div class='ks-ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'>")).appendTo(this.get("el"));this._loadingExtEl.show()},unloading:function(){var f=this._loadingExtEl;f&&f.hide()}};a.Ext.Loading=c});
KISSY.add("ext-mask",function(a){function c(){a.log("mask init");this.on("bindUI",this._bindUIMask,this);this.on("renderUI",this._renderUIMask,this);this.on("syncUI",this._syncUIMask,this)}a.namespace("Ext");var f,e=a.UA,b=0;c.ATTRS={mask:{value:false}};c.prototype={_bindUIMask:function(){a.log("_bindUIMask")},_renderUIMask:function(){a.log("_renderUIMask")},_syncUIMask:function(){a.log("_syncUIMask")},_uiSetMask:function(d){a.log("_uiSetMask");if(d){this.on("show",this._maskExtShow,this);this.on("hide",
this._maskExtHide,this)}else{this.detach("show",this._maskExtShow,this);this.detach("hide",this._maskExtHide,this)}},_maskExtShow:function(){if(!f){f=(new a.Node("<div class='ks-ext-mask'>")).prependTo(document.body);f.css({position:"absolute",left:0,top:0,width:"100%",height:a.DOM.docHeight()});e.ie==6&&f.append("<iframe style='width:100%;height:expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'>")}f.css({"z-index":this.get("zIndex")-1});b++;f.show()},_maskExtHide:function(){b--;
if(b<=0)b=0;b||f&&f.hide()},__destructor:function(){a.log("mask __destructor")}};a.Ext.Mask=c});
KISSY.add("ext-position",function(a){function c(){a.log("position init");this.on("bindUI",this._bindUIPosition,this);this.on("renderUI",this._renderUIPosition,this);this.on("syncUI",this._syncUIPosition,this)}a.namespace("Ext");var f=document,e=a.Event;c.ATTRS={x:{},y:{},xy:{setter:function(b){var d=a.makeArray(b);if(d.length){d[0]&&this.set("x",d[0]);d[1]&&this.set("y",d[1])}return b}},zIndex:{value:9999},visible:{value:undefined}};c.prototype={_syncUIPosition:function(){a.log("_syncUIPosition")},
_renderUIPosition:function(){a.log("_renderUIPosition");this.get("el").addClass("ks-ext-position");this.get("el").css("display","")},_bindUIPosition:function(){a.log("_bindUIPosition")},_uiSetZIndex:function(b){a.log("_uiSetZIndex");b!==undefined&&this.get("el").css("z-index",b)},_uiSetX:function(b){a.log("_uiSetX");b!==undefined&&this.get("el").offset({left:b})},_uiSetY:function(b){a.log("_uiSetY");b!==undefined&&this.get("el").offset({top:b})},_uiSetVisible:function(b){if(b!==undefined){a.log("_uiSetVisible");
this.get("el").css("visibility",b?"visible":"hidden");this[b?"_bindKey":"_unbindKey"]();this.fire(b?"show":"hide")}},_bindKey:function(){e.on(f,"keydown",this._esc,this)},_unbindKey:function(){e.remove(f,"keydown",this._esc,this)},_esc:function(b){b.keyCode===27&&this.hide()},move:function(b,d){if(a.isArray(b)){d=b[1];b=b[0]}this.set("xy",[b,d])},show:function(){this._firstShow()},_firstShow:function(){this.renderer();this._realShow();this._firstShow=this._realShow},_realShow:function(){this.set("visible",
true)},hide:function(){this.set("visible",false)},__destructor:function(){a.log("position __destructor")}};a.Ext.Position=c});
KISSY.add("ext-shim",function(a){function c(){a.log("shim init");this.on("renderUI",this._renderUIShimExt,this);this.on("bindUI",this._bindUIShimExt,this);this.on("syncUI",this._syncUIShimExt,this)}a.namespace("Ext");var f=a.Node;c.prototype={_syncUIShimExt:function(){a.log("_syncUIShimExt")},_bindUIShimExt:function(){a.log("_bindUIShimExt")},_renderUIShimExt:function(){a.log("_renderUIShimExt");var e=this.get("el"),b=new f("<iframe style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth);top: 0;opacity: 0;filter: alpha(opacity=0);left: 0;z-index: -1;height: expression(this.parentNode.offsetHeight);'>");
e.prepend(b)},__destructor:function(){a.log("shim __destructor")}};a.Ext.Shim=c});
KISSY.add("ext-stdmod",function(a){function c(){a.log("stdmod init");this.on("renderUI",this._renderUIStdMod,this);this.on("syncUI",this._syncUIStdMod,this);this.on("bindUI",this._bindUIStdMod,this)}a.namespace("Ext");var f=a.Node;c.ATTRS={header:{},body:{},footer:{},bodyStyle:{},headerContent:{value:false},bodyContent:{value:false},footerContent:{value:false}};c.HTML_PARSER={header:".ks-stdmod-header",body:".ks-stdmod-body",footer:".ks-stdmod-footer"};c.prototype={_bindUIStdMod:function(){a.log("_bindUIStdMod")},
_syncUIStdMod:function(){a.log("_syncUIStdMod")},_setStdModContent:function(e,b){if(b!==false)if(a.isString(b))this.get(e).html(b);else{this.get(e).html("");this.get(e).append(b)}},_uiSetBodyStyle:function(e){e!==undefined&&this.get("body").css(e)},_uiSetBodyContent:function(e){a.log("_uiSetBodyContent");this._setStdModContent("body",e)},_uiSetHeaderContent:function(e){a.log("_uiSetHeaderContent");this._setStdModContent("header",e)},_uiSetFooterContent:function(e){a.log("_uiSetFooterContent");this._setStdModContent("footer",
e)},_renderUIStdMod:function(){a.log("_renderUIStdMod");var e=this.get("contentEl"),b=this.get("header"),d=this.get("body"),g=this.get("footer");this.get("headerContent");this.get("bodyContent");this.get("footerContent");if(!b){b=(new f("<div class='ks-stdmod-header'>")).appendTo(e);this.set("header",b)}if(!d){d=(new f("<div class='ks-stdmod-body'>")).appendTo(e);this.set("body",d)}if(!g){g=(new f("<div class='ks-stdmod-footer'>")).appendTo(e);this.set("footer",g)}},__destructor:function(){a.log("stdmod __destructor")}};
a.Ext.StdMod=c});
KISSY.add("overlay",function(a){var c=a.Base.create([a.Ext.Box,a.Ext.ContentBox,a.Ext.Position,a.Ext.Loading,a.UA.ie==6?a.Ext.Shim:null,a.Ext.Align,a.Ext.Mask],{init:function(){a.log("Overlay init");this.on("bindUI",this._bindUIOverlay,this);this.on("renderUI",this._renderUIOverlay,this);this.on("syncUI",this._syncUIOverlay,this)},_renderUIOverlay:function(){a.log("_renderUIOverlay");this.get("el").addClass("ks-overlay")},_syncUIOverlay:function(){a.log("_syncUIOverlay")},_bindUIOverlay:function(){a.log("_bindUIOverlay")},destructor:function(){a.log("overlay destructor")}});
a.Overlay=c},{requires:["core"]});
KISSY.add("dialog",function(a){a.Dialog=a.Base.create(a.Overlay,[a.Ext.StdMod,a.Ext.Close,a.Ext.Drag,a.Ext.Constrain],{init:function(){a.log("dialog init");this.on("renderUI",this._rendUIDialog,this);this.on("bindUI",this._bindUIDialog,this);this.on("syncUI",this._syncUIDialog,this)},_rendUIDialog:function(){a.log("_rendUIDialog");this.get("el").addClass("ks-dialog");this.set("handlers",[this.get("header")])},_bindUIDialog:function(){a.log("_bindUIDialog")},_syncUIDialog:function(){a.log("_syncUIDialog")},destructor:function(){a.log("Dialog destructor")}})},
{host:"overlay"});
KISSY.Editor.add("ext-focus",function(){function a(){c.log("FocusExt init");this.on("renderUI",this._renderUIFocusExt,this);this.on("bindUI",this._bindUIFocusExt,this);this.on("syncUI",this._syncUIFocusExt,this)}var c=KISSY,f=c.UA,e=c.Editor,b=e.focusManager;e.namespace("Ext");a.ATTRS={focus4e:{value:true}};a.prototype={_uiSetFocus4e:function(d){if(d){this.on("show",this._show4FocusExt,this);this.on("hide",this._hide4FocusExt,this)}else{this.detach("show",this._show4FocusExt,this);this.detach("hide",
this._hide4FocusExt,this)}},_syncUIFocusExt:function(){c.log("_syncUIFocusExt")},_renderUIFocusExt:function(){c.log("_renderUIFocusExt")},_bindUIFocusExt:function(){this._focus4e=(new c.Node("<a href='#' class='ke-focus' style='width:0;height:0;margin:0;padding:0;overflow:hidden;outline:none;font-size:0;'></a>")).appendTo(this.get("el"))},_show4FocusExt:function(){var d=this._focusEditor=b.currentInstance();window.focus();document.body.focus();this._focus4e[0].focus();if(f.ie&&d){var g=d.document.selection.createRange();
if(g)if(g.item&&g.item(0).ownerDocument==d.document){d=document.body.createTextRange();d.moveToElementText(this.get("el")._4e_first()[0]);d.collapse(true);d.select()}}},_hide4FocusExt:function(){var d=this._focusEditor;d&&d.focus()}};e.Ext.Focus=a},{host:"overlay"});
KISSY.Editor.add("overlay",function(){var a=KISSY,c=a.Editor;if(!c.Overlay){var f=a.Base.create(a.Overlay,[c.Ext.Focus],{init:function(){a.log("Overlay4E init");this.on("syncUI",this._syncUIOverlay4E,this)},_syncUIOverlay4E:function(){a.log("_syncUIOverlay4E");c.Utils.preventFocus(this.get("contentEl"))}},{ATTRS:{zIndex:{value:c.baseZIndex(c.zIndexManager.OVERLAY)}}}),e=a.Base.create(a.Dialog,[c.Ext.Focus],{show:function(){this.center();var d=this.get("y");if(d-a.DOM.scrollTop()>200){d=a.DOM.scrollTop()+
200;this.set("y",d)}e.superclass.show.call(this)}},{ATTRS:{constrain:{value:true},zIndex:{value:c.baseZIndex(c.zIndexManager.OVERLAY)}}});c.Overlay=f;c.Dialog=e;var b;c.Overlay.loading=function(){b||(b=new c.Overlay({x:0,focus4e:false,width:"100%",y:0,zIndex:c.baseZIndex(c.zIndexManager.LOADING),elCls:"ke-global-loading"}));b.set("height",a.DOM.docHeight());b.show();b.loading()};c.Overlay.unloading=function(){b&&b.hide()}}});
