KISSY.Editor.add("link",function(l){var m=KISSY,d=m.Editor;d.Link||function(){function h(a){this.editor=a;this._init()}function n(a){return a._4e_ascendant(function(e){return e._4e_name()==="a"&&!!e.attr("href")},true)}var r=d.TripleButton,s=d.Style,o=d.BubbleView,p={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};h.link_Style=p;h._ke_saved_href="_ke_saved_href";h.checkLink=n;o.register({pluginName:"link",func:n,init:function(){var a=
this,e=a.get("contentEl");e.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var q=e.one(".ke-bubbleview-url"),t=e.one(".ke-bubbleview-change"),u=e.one(".ke-bubbleview-remove");d.Utils.preventFocus(e);t.on("click",function(b){a._plugin.show();b.halt()});u.on("click",function(b){var i=a._plugin.editor,f=a._selectedEl;i.fire("save");var g=i.getSelection(),
c=g.getRanges()[0];if(c&&c.collapsed){c=g.createBookmarks();f._4e_remove(true);g.selectBookmarks(c)}else if(c){f=f[0];g=f.attributes;c={};for(var j=0;j<g.length;j++){var k=g[j];if(k.specified)c[k.name]=k.value}if(f.style.cssText)c.style=f.style.cssText;(new s(p,c)).remove(i.document)}i.fire("save");i.notifySelectionChange();b.halt()});a.on("show",function(){var b=a._selectedEl;if(b){b=b.attr("_ke_saved_href")||b.attr("href");q.html(b);q.attr("href",b)}})}});m.augment(h,{_init:function(){var a=this.editor;
this.el=new r({container:a.toolBarDiv,contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5 "});this.el.on("offClick",this.show,this);o.attach({pluginName:"link",pluginInstance:this});d.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},show:function(){this.editor.useDialog("link/dialog",function(a){a.show()})}});d.Link=h}();l.addPlugin(function(){new d.Link(l)})});
