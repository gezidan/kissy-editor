KISSY.Editor.add("link",function(j){var k=KISSY,d=k.Editor;d.Link||function(){function f(a){this.editor=a;this._init()}function l(a){return a._4e_ascendant(function(c){return c._4e_name()==="a"&&!!c.attr("href")},true)}function m(a,c){for(var e=a[0],i=e.attributes,h={},b=0;b<i.length;b++){var g=i[b];if(g.specified)h[g.name]=g.value}if(e.style.cssText)h.style=e.style.cssText;e=new p(n,h);c.fire("save");e.remove(c.document);c.fire("save")}var q=d.TripleButton,p=d.Style,o=d.BubbleView,n={element:"a",
attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};f.link_Style=n;f._ke_saved_href="_ke_saved_href";f.checkLink=l;o.register({pluginName:"link",func:l,init:function(){var a=this,c=a.get("contentEl");c.html('\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');var e=c.one(".ke-bubbleview-url"),i=c.one(".ke-bubbleview-change"),
h=c.one(".ke-bubbleview-remove");d.Utils.preventFocus(c);i.on("click",function(b){a._plugin.show();b.halt()});h.on("click",function(b){var g=a._plugin.editor;m(a._selectedEl,g);g.notifySelectionChange();b.halt()});a.on("show",function(){var b=a._selectedEl;if(b){b=b.attr("_ke_saved_href")||b.attr("href");e.html(b);e.attr("href",b)}})}});f._removeLink=m;k.augment(f,{_init:function(){var a=this.editor;this.el=new q({container:a.toolBarDiv,contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5 "});this.el.on("offClick",
this.show,this);o.attach({pluginName:"link",pluginInstance:this});d.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},enable:function(){this.el.enable()},show:function(){this.editor.useDialog("link/dialog",function(a){a.show()})}});d.Link=f}();j.addPlugin(function(){new d.Link(j)})});
