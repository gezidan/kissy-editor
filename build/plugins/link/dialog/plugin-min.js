KISSY.Editor.add("link/dialog",function(i){var h=KISSY,d=h.Editor,f=d.Link;f.Dialog||function(){function j(a){this.editor=a;d.Utils.lazyRun(this,"_prepareShow","_real")}var l=f.checkLink,m=f._removeLink,n=d.Style,o=h.Node,p=d.Range,q=d.Dialog,k=f._ke_saved_href,r=f.link_Style;f.Dialog=j;h.augment(j,{_prepareShow:function(){var a=this,b=new q({width:500,headerContent:"\u94fe\u63a5",bodyContent:"<div style='padding:20px 20px 0 20px'><p><label>\u94fe\u63a5\u7f51\u5740\uff1a <input  data-verify='^(https?://[^\\s]+)|(#.+)$'  data-warning='\u8bf7\u8f93\u5165\u5408\u9002\u7684\u7f51\u5740\u683c\u5f0f' class='ke-link-url ke-input' style='width:390px;vertical-align:middle;' /></label></p><p style='margin: 15px 0 10px 64px;'><label><input class='ke-link-blank' type='checkbox'/> &nbsp; \u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5</label></p></div>",
footerContent:"<div style='padding:5px 20px 20px;'><a class='ke-link-ok ke-button' style='margin-left:65px;margin-right:20px;'>\u786e\u5b9a</a> <a class='ke-link-cancel ke-button'>\u53d6\u6d88</a></div>",mask:true});b.renderer();a.dialog=b;var e=b.get("body"),c=b.get("footer");b.urlEl=e.one(".ke-link-url");b.targetEl=e.one(".ke-link-blank");e=c.one(".ke-link-cancel");c.one(".ke-link-ok").on("click",function(){a._link()},a);e.on("click",function(){b.hide()},a);d.Utils.placeholder(b.urlEl,"http://")},_getSelectedLink:function(){var a=
this.editor.getSelection();if(a=a&&a.getStartElement())a=l(a);return a},_link:function(){var a,b=this.editor,e=this.dialog,c=e.urlEl.val(),g;if(d.Utils.verifyInputs(e.get("el").all("input"))){e.hide();if(g=this._getSelectedLink()){a=new p(b.document);a.selectNodeContents(g);b.getSelection().selectRanges([a]);m(g,b)}g={href:c,_ke_saved_href:c};g.target=e.targetEl[0].checked?"_blank":"_self";a=(a=b.getSelection())&&a.getRanges()[0];if(!a||a.collapsed){c=new o("<a href='"+c+"' "+k+"='"+c+"' target='"+
g.target+"'>"+c+"</a>",null,b.document);b.insertElement(c)}else{b.fire("save");c=new n(r,g);c.apply(b.document);b.fire("save")}b.notifySelectionChange()}},_real:function(){var a=this.dialog,b=this._getSelectedLink();a.link=this;if(b){d.Utils.valInput(a.urlEl,b.attr(k)||b.attr("href"));a.targetEl[0].checked=b.attr("target")=="_blank"}else d.Utils.resetInput(a.urlEl);a.show()},show:function(){this._prepareShow()}})}();i.addDialog("link/dialog",new f.Dialog(i))});
