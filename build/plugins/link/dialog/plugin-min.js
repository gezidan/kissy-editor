KISSY.Editor.add("link/dialog",function(h){var g=KISSY,e=g.Editor,f=e.Link;f.Dialog||function(){function i(a){this.editor=a;e.Utils.lazyRun(this,"_prepareShow","_real")}var j=f.checkLink,k=e.Style,l=g.Node,m=e.Dialog,n=f._ke_saved_href,o=f.link_Style;f.Dialog=i;g.augment(i,{_prepareShow:function(){var a=this,b=new m({width:500,headerContent:"\u94fe\u63a5",bodyContent:"<div style='padding:20px 20px 0 20px'><p><label>\u94fe\u63a5\u7f51\u5740\uff1a <input  data-verify='^(https?://[^\\s]+)|(#.+)$'  data-warning='\u8bf7\u8f93\u5165\u5408\u9002\u7684\u7f51\u5740\u683c\u5f0f' class='ke-link-url ke-input' style='width:390px;vertical-align:middle;' /></label></p><p style='margin: 15px 0 10px 0px;'><label>\u94fe\u63a5\u540d\u79f0\uff1a <input class='ke-link-title ke-input' style='width:100px;vertical-align:middle;'></label> <label><input class='ke-link-blank' style='vertical-align: middle; margin-left: 21px;' type='checkbox'/> &nbsp; \u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5</label></p></div>",
footerContent:"<div style='padding:5px 20px 20px;'><a class='ke-link-ok ke-button' style='margin-left:65px;margin-right:20px;'>\u786e\u5b9a</a> <a class='ke-link-cancel ke-button'>\u53d6\u6d88</a></div>",mask:true});b.renderer();a.dialog=b;var c=b.get("body"),d=b.get("footer");b.urlEl=c.one(".ke-link-url");b.urlTitle=c.one(".ke-link-title");b.targetEl=c.one(".ke-link-blank");c=d.one(".ke-link-cancel");d.one(".ke-link-ok").on("click",function(){a._link()},a);c.on("click",function(){b.hide()},a);e.Utils.placeholder(b.urlEl,
"http://")},_getSelectedLink:function(){var a=this.editor.getSelection();if(a=a&&a.getStartElement())a=j(a);return a},_link:function(){var a,b=this.editor,c=this.dialog,d=c.urlEl.val();if(e.Utils.verifyInputs(c.get("el").all("input"))){c.hide();a=this._getSelectedLink();c={href:d,_ke_saved_href:d,target:c.targetEl[0].checked?"_blank":"_self",title:g.trim(c.urlTitle.val())};if(a){b.fire("save");a.attr(c);b.fire("save")}else{a=(a=b.getSelection())&&a.getRanges()[0];if(!a||a.collapsed){d=new l("<a>"+
d+"</a>",c,b.document);b.insertElement(d)}else{b.fire("save");d=new k(o,c);d.apply(b.document);b.fire("save")}}b.notifySelectionChange()}},_real:function(){var a=this.dialog,b=this._getSelectedLink();a.link=this;if(b){e.Utils.valInput(a.urlEl,b.attr(n)||b.attr("href")||"");a.urlTitle.val(b.attr("title")||"");a.targetEl[0].checked=b.attr("target")=="_blank"}else{e.Utils.resetInput(a.urlEl);a.urlTitle.val("")}a.show()},show:function(){this._prepareShow()}})}();h.addDialog("link/dialog",new f.Dialog(h))});
