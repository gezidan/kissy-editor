KISSY.Editor.add("link/dialog",function(i){var h=KISSY,e=h.Editor,g=e.Link;g.Dialog||function(){function j(a){this.editor=a;e.Utils.lazyRun(this,"_prepareShow","_real")}var l=g.checkLink,m=g._removeLink,n=e.Style,o=h.Node,p=e.Range,q=e.Dialog,k=g._ke_saved_href,r=g.link_Style;g.Dialog=j;h.augment(j,{_prepareShow:function(){var a=this,b=new q({width:500,headerContent:"\u94fe\u63a5",bodyContent:"<div style='padding:20px 20px 0 20px'><p><label>\u94fe\u63a5\u7f51\u5740\uff1a <input  data-verify='^(https?://[^\\s]+)|(#.+)$'  data-warning='\u8bf7\u8f93\u5165\u5408\u9002\u7684\u7f51\u5740\u683c\u5f0f' class='ke-link-url ke-input' style='width:390px;vertical-align:middle;' /></label></p><p style='margin: 15px 0 10px 0px;'><label>\u94fe\u63a5\u540d\u79f0\uff1a <input class='ke-link-title ke-input' style='width:100px;vertical-align:middle;'></label> <label><input class='ke-link-blank' style='vertical-align: middle; margin-left: 21px;' type='checkbox'/> &nbsp; \u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5</label></p></div>",
footerContent:"<div style='padding:5px 20px 20px;'><a class='ke-link-ok ke-button' style='margin-left:65px;margin-right:20px;'>\u786e\u5b9a</a> <a class='ke-link-cancel ke-button'>\u53d6\u6d88</a></div>",mask:true});b.renderer();a.dialog=b;var c=b.get("body"),d=b.get("footer");b.urlEl=c.one(".ke-link-url");b.urlTitle=c.one(".ke-link-title");b.targetEl=c.one(".ke-link-blank");c=d.one(".ke-link-cancel");d.one(".ke-link-ok").on("click",function(){a._link()},a);c.on("click",function(){b.hide()},a);e.Utils.placeholder(b.urlEl,
"http://")},_getSelectedLink:function(){var a=this.editor.getSelection();if(a=a&&a.getStartElement())a=l(a);return a},_link:function(){var a,b=this.editor,c=this.dialog,d=c.urlEl.val(),f;if(e.Utils.verifyInputs(c.get("el").all("input"))){c.hide();if(f=this._getSelectedLink()){a=new p(b.document);a.selectNodeContents(f);b.getSelection().selectRanges([a]);m(f,b)}f={href:d,_ke_saved_href:d};f.target=c.targetEl[0].checked?"_blank":"_self";if(c=h.trim(c.urlTitle.val()))f.title=c;a=(a=b.getSelection())&&
a.getRanges()[0];if(!a||a.collapsed){d=new o("<a href='"+d+"' "+k+"='"+d+"' "+(c?" title='"+c+"' ":" ")+"target='"+f.target+"'>"+d+"</a>",null,b.document);b.insertElement(d)}else{b.fire("save");d=new n(r,f);d.apply(b.document);b.fire("save")}b.notifySelectionChange()}},_real:function(){var a=this.dialog,b=this._getSelectedLink();a.link=this;if(b){e.Utils.valInput(a.urlEl,b.attr(k)||b.attr("href"));a.urlTitle.val(b.attr("title"));a.targetEl[0].checked=b.attr("target")=="_blank"}else{e.Utils.resetInput(a.urlEl);
a.urlTitle.val("")}a.show()},show:function(){this._prepareShow()}})}();i.addDialog("link/dialog",new g.Dialog(i))});
