KISSY.Editor.add("flashsupport",function(n){var g=KISSY.Editor,j=KISSY,u=j.UA,v=j.Event,w=g.ContextMenu,p=j.Node,q=g.BubbleView,x=g.TripleButton,y=g.SimpleOverlay,k=n.htmlDataProcessor,i="ke_flash",r=g.Utils.getFlashUrl;n=k&&k.dataFilter;g.Flash||function(){function c(a){this.editor=a;this._init()}function h(a){return a._4e_name()==="img"&&!!a.hasClass(i)&&a}var z=/\.swf(?:$|\?)/i,A="<p><label>\u5730\u5740\uff1a <input class='ke-flash-url' style='width:280px' value='\u8bf7\u8f93\u5165\u5982 http://www.xxx.com/xxx.swf'/></label></p><p style='margin:5px 0'><label>\u5bbd\u5ea6\uff1a <input class='ke-flash-width' style='width:110px' /></label>&nbsp;&nbsp;<label>\u9ad8\u5ea6\uff1a<input class='ke-flash-height' style='width:110px' /></label></p><p style='margin:5px 0'><label>\u5bf9\u9f50\uff1a <select class='ke-flash-align'><option value=''>\u65e0</option><option value='left'>\u5de6\u5bf9\u9f50</option><option value='right'>\u53f3\u5bf9\u9f50</option></select>"+
g.Utils.duplicateStr("&nbsp;",13)+"<label>\u95f4\u8ddd\uff1a </span> <input class='ke-flash-margin' style='width:90px' value='5'/> px</label><p>";c.isFlashEmbed=function(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||z.test(a.src||"")};j.augment(c,{_config:function(){this._cls=i;this._type="flash";this._title="Flash\u5c5e\u6027";this._bodyHtml=A;this._footHtml="<button class='ke-flash-ok'>\u786e\u5b9a</button> <button class='ke-flash-cancel'>\u53d6\u6d88</button>";this._contentCls=
"ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=B;this._flashRules=["img."+i]},_init:function(){this._config();var a=this.editor,b={},f=this._contextMenu;a._toolbars=a._toolbars||{};a._toolbars[this._type]=this;this.el=new x({container:a.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("click",this.show,this);if(f)for(var e in f)(function(d){b[d]=function(){f[d](a)}})(e);w.register(a.document,{rules:this._flashRules,width:"120px",funcs:b});q.attach({pluginName:this._type,
pluginInstance:this});v.on(a.document,"dblclick",this._dbclick,this);g.Utils.lazyRun(this,"_prepareShow","_realShow")},_getFlashUrl:function(a){return r(a)},_updateTip:function(a,b){b=this.editor.restoreRealElement(b);a.html(this._getFlashUrl(b));a.attr("href",this._getFlashUrl(b))},_dbclick:function(a){var b=new p(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.show(null,b);a.halt()}},_prepareShow:function(){var a=new y({title:this._title,width:this._config_dwidth||"350px",mask:true});
a.body.html(this._bodyHtml);a.foot.html(this._footHtml);this.d=a;this._initD()},_realShow:function(){this._updateD();this.d.show()},_updateD:function(){var a=this.editor,b=this.selectedFlash;if(b){a=a.restoreRealElement(b);a.attr("width")&&this.dWidth.val(parseInt(a.attr("width")));a.attr("height")&&this.dHeight.val(parseInt(a.attr("height")));this.dAlign.val(a.attr("align"));this.dUrl.val(r(a));this.dMargin.val(parseInt(a._4e_style("margin"))||0)}else{this.dUrl.val("\u8bf7\u8f93\u5165\u5982 http://www.xxx.com/xxx.swf");
this.dWidth.val("");this.dHeight.val("");this.dAlign.val("");this.dMargin.val("5")}},show:function(a,b){this.selectedFlash=b;this._prepareShow()},_initD:function(){var a=this,b=a.d;a.dHeight=b.el.one(".ke-flash-height");a.dWidth=b.el.one(".ke-flash-width");a.dUrl=b.el.one(".ke-flash-url");a.dAlign=b.el.one(".ke-flash-align");a.dMargin=b.el.one(".ke-flash-margin");var f=b.el.one(".ke-flash-ok");b=b.el.one(".ke-flash-cancel");f.on("click",a._gen,a);b.on("click",function(){a.d.hide()})},_getDInfo:function(){return{url:this.dUrl.val(),
attrs:{width:this.dWidth.val(),height:this.dHeight.val(),align:this.dAlign.val(),style:"margin:"+(parseInt(this.dMargin.val())||0)+"px"}}},_gen:function(){var a=this.editor,b=this._getDInfo(),f=b&&b.url;b=b&&b.attrs;var e=" ";if(j.trim(f)){if(b)for(var d in b)e+=d+"='"+b[d]+"' ";f="<object "+e+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"  codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"><param name="quality" value="high" /><param name="movie" value="'+
f+'" /><embed '+e+'pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high"  src="'+f+'"  type="application/x-shockwave-flash"/></object>';d=new p(f,null,a.document);b=a.createFakeElement?a.createFakeElement(d,this._cls,this._type,true,f,b):d;b=a.insertElement(b);this.selectedFlash&&a.getSelection().selectElement(b);this.d.hide()}}});g.Flash=c;c.registerBubble=function(a,b,f){q.register({pluginName:a,func:f,init:function(){var e=this,d=e.el;d.html(b+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var s=d.one(".ke-bubbleview-url"),t=d.one(".ke-bubbleview-change");d=d.one(".ke-bubbleview-remove");t._4e_unselectable();s._4e_unselectable();d._4e_unselectable();t.on("click",function(l){e._plugin.show(null,e._selectedEl);l.halt()});d.on("click",function(l){var m=e._plugin;if(u.webkit){var o=m.editor.getSelection().getRanges();o&&o[0]&&(o[0].collapse(true)||1)&&o[0].select()}e._selectedEl._4e_remove();e.hide();m.editor.notifySelectionChange();l.halt()});e.on("beforeVisibleChange",function(l){var m=
e._selectedEl;l.newVal&&m&&e._plugin._updateTip(s,m)})}})};c.registerBubble("flash","Flash \u7f51\u5740\uff1a ",h);c.checkFlash=h;var B={"Flash\u5c5e\u6027":function(a){var b=a.getSelection();b=b&&b.getStartElement();b=h(b);a=a._toolbars.flash;b&&a.show(null,b)}};c.CLS_FLASH=i;c.TYPE_FLASH="flash"}();n&&n.addRules({elements:{object:function(c){var h=c.attributes;if(!(h.classid&&String(h.classid).toLowerCase())){for(h=0;h<c.children.length;h++)if(c.children[h].name=="embed"){if(!g.Flash.isFlashEmbed(c.children[h]))return null;
return k.createFakeParserElement(c,i,"flash",true)}return null}return k.createFakeParserElement(c,i,"flash",true)},embed:function(c){if(!g.Flash.isFlashEmbed(c))return null;return k.createFakeParserElement(c,i,"flash",true)}}},5)});
