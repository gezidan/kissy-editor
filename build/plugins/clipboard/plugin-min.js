KISSY.Editor.add("clipboard",function(n){var k=KISSY,h=k.Editor,l=k.Node,i=k.UA,r=h.Range,o=h.RANGE,p=k.Event;h.Paste||function(){function q(a){this.editor=a;this._init()}function s(a){if(!(!i.ie||a.document.compatMode=="BackCompat")){var b=a.getSelection(),d;if(b.getType()==t.SELECTION_ELEMENT&&(d=b.getSelectedElement())){var f=b.getRanges()[0],e=new l(a.document.createTextNode(""));e.insertBefore(d);f.setStartBefore(e);f.setEndAfter(d);b.selectRanges([f]);setTimeout(function(){if(d.parent()){e.remove();
b.selectElement(d)}},0)}}}k.augment(q,{_init:function(){var a=this.editor;i.ie?p.on(a.document,"keydown",this._paste,this):p.on(a.document,"paste",this._paste,this);a.addCommand("copy",new m("copy"));a.addCommand("cut",new m("cut"));a.addCommand("paste",new m("paste"))},_paste:function(a){if(!(a.type==="keydown"&&!(a.keyCode===86&&(a.ctrlKey||a.metaKey)))){var b=this,d=b.editor,f=d.document;if(b._running)a.halt();else{var e=d.getSelection();a=new r(f);var c=new l(i.webkit?"<body></body>":"<div></div>",
null,f);i.webkit&&c[0].appendChild(f.createTextNode("\u00a0"));f.body.appendChild(c[0]);c.css({position:"absolute",top:e.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});c.css("left","-1000px");var j=e.createBookmarks();a.setStartAt(c,o.POSITION_AFTER_START);a.setEndAt(c,o.POSITION_BEFORE_END);a.select(true);b._running=true;setTimeout(function(){c._4e_remove();var g;c=i.webkit&&(g=c._4e_first())&&g.hasClass("Apple-style-span")?g:c;e.selectBookmarks(j);d.insertHtml(c.html());
b._running=false},0)}}}});h.Paste=q;var u=function(a,b){var d=a.document,f=new l(d.body),e=false,c=function(){e=true};f.on(b,c);(i.ie>7?d:d.selection.createRange()).execCommand(b);f.detach(b,c);return e},v=i.ie?function(a,b){return u(a,b)}:function(a,b){try{return a.document.execCommand(b)}catch(d){return false}},w={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},m=function(a){this.type=
a;this.canUndo=this.type=="cut"};m.prototype={exec:function(a){this.type=="cut"&&s(a);(a=v(a,this.type))||alert(w[this.type]);return a}};var t=h.Selection,x={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};h.on("contextmenu",function(a){var b=a.contextmenu,d=b.cfg.editor,f=b.elDom,e={copy:0,cut:0,paste:0},c;for(c in e){if(!e.hasOwnProperty(c))break;e[c]=f.one(".ke-paste-"+c);(function(j){var g=e[j];if(!g){g=(new l("<a href='#'class='ke-paste-"+j+"'>"+x[j]+"</a>")).appendTo(f);g.on("click",function(y){y.halt();if(!g.hasClass("ke-menuitem-disable")){b.hide();
setTimeout(function(){d.execCommand(j)},30)}})}e[j]=g})(c);a=e[c];(d.document.queryCommandEnabled(c)?true:false)?a.removeClass("ke-menuitem-disable"):a.addClass("ke-menuitem-disable")}})}();n.ready(function(){new h.Paste(n)})});
