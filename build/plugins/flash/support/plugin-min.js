KISSY.Editor.add("flash/support",function(p){var f=KISSY.Editor,k=KISSY,u=k.UA,v=k.Event,w=f.ContextMenu,x=k.Node,q=f.BubbleView,o=f.TripleButton,l=p.htmlDataProcessor,i="ke_flash",r=f.Utils.flash,s=l&&l.dataFilter;f.Flash||function(){function c(a){this.editor=a;this._init()}function g(a){return a._4e_name()==="img"&&!!a.hasClass(i)&&a}var y=/\.swf(?:$|\?)/i;c.isFlashEmbed=function(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||y.test(a.src||"")};k.augment(c,{_config:function(){this._cls=
i;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=z;this._flashRules=["img."+i]},_init:function(){this._config();var a=this.editor,b={},d=this._contextMenu;a._toolbars=a._toolbars||{};a._toolbars[this._type]=this;this.el=new o({container:a.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("offClick",this.show,this);if(d)for(var e in d)(function(h){b[h]=function(){d[h](a)}})(e);w.register({editor:a,rules:this._flashRules,width:"120px",
funcs:b});q.attach({pluginName:this._type,pluginInstance:this});v.on(a.document,"dblclick",this._dbclick,this);f.Utils.sourceDisable(a,this)},disable:function(){this.el.set("state",o.DISABLED)},enable:function(){this.el.set("state",o.OFF)},_getFlashUrl:function(a){return r.getUrl(a)},_updateTip:function(a,b){var d=this.editor.restoreRealElement(b);if(d){d=this._getFlashUrl(d);a.html(d);a.attr("href",d)}},_dbclick:function(a){var b=new x(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.show(null,
b);a.halt()}},show:function(a,b){this.editor.useDialog(this._type+"/dialog",function(d){d.show(b)})}});f.Flash=c;c.registerBubble=function(a,b,d){q.register({pluginName:a,func:d,init:function(){var e=this,h=e.get("contentEl");h.html(b+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var m=h.one(".ke-bubbleview-url"),A=h.one(".ke-bubbleview-change"),B=
h.one(".ke-bubbleview-remove");f.Utils.preventFocus(h);A.on("click",function(j){e._plugin.show(null,e._selectedEl);j.halt()});B.on("click",function(j){var t=e._plugin;if(u.webkit){var n=t.editor.getSelection().getRanges();n&&n[0]&&(n[0].collapse(true)||1)&&n[0].select()}e._selectedEl._4e_remove();e.hide();t.editor.notifySelectionChange();j.halt()});e.on("show",function(){var j=e._selectedEl;j&&e._plugin._updateTip(m,j)})}})};c.registerBubble("flash","Flash \u7f51\u5740\uff1a ",g);c.checkFlash=g;var z={"Flash\u5c5e\u6027":function(a){var b=
a.getSelection();b=b&&b.getStartElement();b=g(b);a=a._toolbars.flash;b&&a.show(null,b)}};c.CLS_FLASH=i;c.TYPE_FLASH="flash";c.Insert=function(a,b,d,e,h){b=r.createSWF(b,{attrs:d},a.document);var m=b.el;d=a.createFakeElement?a.createFakeElement(m,e||"ke_flash",h||"flash",true,b.html,d):m;return d=a.insertElement(d)}}();p.addCommand("insertFlash",{exec:function(){var c=k.makeArray(arguments);return f.Flash.Insert.apply(null,c)}});s&&s.addRules({elements:{object:function(c){var g=c.attributes;if(!(g.classid&&
String(g.classid).toLowerCase())){for(g=0;g<c.children.length;g++)if(c.children[g].name=="embed"){if(!f.Flash.isFlashEmbed(c.children[g]))break;return l.createFakeParserElement(c,i,"flash",true)}return null}return l.createFakeParserElement(c,i,"flash",true)},embed:function(c){if(!f.Flash.isFlashEmbed(c))return null;return l.createFakeParserElement(c,i,"flash",true)}}},5)});
