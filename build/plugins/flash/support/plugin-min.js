KISSY.Editor.add("flash/support",function(m){var h=KISSY.Editor,n=KISSY,t=n.UA,u=n.Event,v=h.ContextMenu,w=n.Node,q=h.BubbleView,p=h.TripleButton,j=m.htmlDataProcessor,i="ke_flash",x=h.Utils.flash;m=j&&j.dataFilter;h.Flash||function(){function c(a){this.editor=a;this._init()}function e(a){return a._4e_name()==="img"&&!!a.hasClass(i)&&a}var y=/\.swf(?:$|\?)/i;c.isFlashEmbed=function(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||y.test(a.src||"")};n.augment(c,{_config:function(){this._cls=
i;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=z;this._flashRules=["img."+i]},_init:function(){this._config();var a=this.editor,b={},d=this._contextMenu;a._toolbars=a._toolbars||{};a._toolbars[this._type]=this;this.el=new p({container:a.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("offClick",this.show,this);if(d)for(var f in d)(function(g){b[g]=function(){d[g](a)}})(f);v.register({editor:a,rules:this._flashRules,width:"120px",
funcs:b});q.attach({pluginName:this._type,pluginInstance:this});u.on(a.document,"dblclick",this._dbclick,this);h.Utils.sourceDisable(a,this)},disable:function(){this.el.set("state",p.DISABLED)},enable:function(){this.el.set("state",p.OFF)},_getFlashUrl:function(a){return x.getUrl(a)},_updateTip:function(a,b){var d=this.editor.restoreRealElement(b);if(d){d=this._getFlashUrl(d);a.html(d);a.attr("href",d)}},_dbclick:function(a){var b=new w(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.show(null,
b);a.halt()}},show:function(a,b){this.editor.useDialog(this._type+"/dialog",function(d){d.show(b)},{mask:true})}});h.Flash=c;c.registerBubble=function(a,b,d){q.register({pluginName:a,func:d,init:function(){var f=this,g=f.el;g.html(b+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var r=g.one(".ke-bubbleview-url"),s=g.one(".ke-bubbleview-change");g=g.one(".ke-bubbleview-remove");
s._4e_unselectable();r._4e_unselectable();g._4e_unselectable();s.on("click",function(k){f._plugin.show(null,f._selectedEl);k.halt()});g.on("click",function(k){var l=f._plugin;if(t.webkit){var o=l.editor.getSelection().getRanges();o&&o[0]&&(o[0].collapse(true)||1)&&o[0].select()}f._selectedEl._4e_remove();f.hide();l.editor.notifySelectionChange();k.halt()});f.on("beforeVisibleChange",function(k){var l=f._selectedEl;k.newVal&&l&&f._plugin._updateTip(r,l)})}})};c.registerBubble("flash","Flash \u7f51\u5740\uff1a ",
e);c.checkFlash=e;var z={"Flash\u5c5e\u6027":function(a){var b=a.getSelection();b=b&&b.getStartElement();b=e(b);a=a._toolbars.flash;b&&a.show(null,b)}};c.CLS_FLASH=i;c.TYPE_FLASH="flash"}();m&&m.addRules({elements:{object:function(c){var e=c.attributes;if(!(e.classid&&String(e.classid).toLowerCase())){for(e=0;e<c.children.length;e++)if(c.children[e].name=="embed"){if(!h.Flash.isFlashEmbed(c.children[e]))break;return j.createFakeParserElement(c,i,"flash",true)}return null}return j.createFakeParserElement(c,
i,"flash",true)},embed:function(c){if(!h.Flash.isFlashEmbed(c))return null;return j.createFakeParserElement(c,i,"flash",true)}}},5)});
