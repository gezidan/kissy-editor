KISSY.Editor.add("flash/support",function(){function e(a){this.editor=a;this._init()}function m(a){return a._4e_name()==="img"&&!!a.hasClass(j)&&a}var h=KISSY.Editor,k=KISSY,q=k.UA,r=k.Event,s=h.ContextMenu,t=k.Node,n=h.BubbleView,j="ke_flash",o=h.Utils.flash;k.augment(e,{_config:function(){this._cls=j;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=u;this._flashRules=["img."+j]},_init:function(){this._config();var a=this,b=a.editor,c={},d=a._contextMenu;
b.addButton("flash",{contentCls:a._contentCls,title:a._tip,offClick:function(){a.show()}});if(d)for(var f in d)(function(g){c[g]=function(){d[g](a)}})(f);s.register({editor:b,rules:a._flashRules,width:"120px",funcs:c});n.attach({pluginName:a._type,editor:a.editor,pluginContext:a});r.on(b.document,"dblclick",a._dbclick,a)},_getFlashUrl:function(a){return o.getUrl(a)},_updateTip:function(a,b){var c=this.editor.restoreRealElement(b);if(c){c=this._getFlashUrl(c);a.html(c);a.attr("href",c)}},_dbclick:function(a){var b=
new t(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.show(null,b);a.halt()}},show:function(a,b){this.editor.useDialog(this._type+"/dialog",function(c){c.show(b)})}});h.Flash=e;e.registerBubble=function(a,b,c){n.register({pluginName:a,func:c,init:function(){var d=this,f=d.get("contentEl");f.html(b+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var g=f.one(".ke-bubbleview-url"),v=f.one(".ke-bubbleview-change"),w=f.one(".ke-bubbleview-remove");h.Utils.preventFocus(f);v.on("click",function(i){d._plugin.show(null,d._selectedEl);i.halt()});w.on("click",function(i){var p=d._plugin;if(q.webkit){var l=p.editor.getSelection().getRanges();l&&l[0]&&(l[0].collapse(true)||1)&&l[0].select()}d._selectedEl._4e_remove();d.hide();p.editor.notifySelectionChange();i.halt()});d.on("show",function(){var i=d._selectedEl;i&&d._plugin._updateTip(g,i)})}})};e.registerBubble("flash",
"Flash \u7f51\u5740\uff1a ",m);e.checkFlash=m;var u={"Flash\u5c5e\u6027":function(a){var b=a.editor.getSelection();b=b&&b.getStartElement();(b=m(b))&&a.show(null,b)}};e.CLS_FLASH=j;e.TYPE_FLASH="flash";e.Insert=function(a,b,c,d,f){b=o.createSWF(b,{attrs:c},a.document);var g=b.el;c=a.createFakeElement?a.createFakeElement(g,d||"ke_flash",f||"flash",true,b.html,c):g;return c=a.insertElement(c)};h.Flash=e});
