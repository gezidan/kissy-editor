KISSY.Editor.add("flash/support",function(l){var g=KISSY.Editor,m=KISSY,r=m.UA,s=m.Event,t=g.ContextMenu,u=m.Node,p=g.BubbleView,o=g.TripleButton,k=l.htmlDataProcessor,i="ke_flash",v=g.Utils.flash;l=k&&k.dataFilter;g.Flash||function(){function c(a){this.editor=a;this._init()}function e(a){return a._4e_name()==="img"&&!!a.hasClass(i)&&a}var w=/\.swf(?:$|\?)/i;c.isFlashEmbed=function(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||w.test(a.src||"")};m.augment(c,{_config:function(){this._cls=
i;this._type="flash";this._contentCls="ke-toolbar-flash";this._tip="\u63d2\u5165Flash";this._contextMenu=x;this._flashRules=["img."+i]},_init:function(){this._config();var a=this.editor,b={},d=this._contextMenu;a._toolbars=a._toolbars||{};a._toolbars[this._type]=this;this.el=new o({container:a.toolBarDiv,contentCls:this._contentCls,title:this._tip});this.el.on("offClick",this.show,this);if(d)for(var f in d)(function(h){b[h]=function(){d[h](a)}})(f);t.register({editor:a,rules:this._flashRules,width:"120px",
funcs:b});p.attach({pluginName:this._type,pluginInstance:this});s.on(a.document,"dblclick",this._dbclick,this);g.Utils.sourceDisable(a,this)},disable:function(){this.el.set("state",o.DISABLED)},enable:function(){this.el.set("state",o.OFF)},_getFlashUrl:function(a){return v.getUrl(a)},_updateTip:function(a,b){var d=this.editor.restoreRealElement(b);if(d){d=this._getFlashUrl(d);a.html(d);a.attr("href",d)}},_dbclick:function(a){var b=new u(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.show(null,
b);a.halt()}},show:function(a,b){this.editor.useDialog(this._type+"/dialog",function(d){d.show(b)})}});g.Flash=c;c.registerBubble=function(a,b,d){p.register({pluginName:a,func:d,init:function(){var f=this,h=f.get("contentEl");h.html(b+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');var y=h.one(".ke-bubbleview-url"),z=h.one(".ke-bubbleview-change"),A=
h.one(".ke-bubbleview-remove");g.Utils.preventFocus(h);z.on("click",function(j){f._plugin.show(null,f._selectedEl);j.halt()});A.on("click",function(j){var q=f._plugin;if(r.webkit){var n=q.editor.getSelection().getRanges();n&&n[0]&&(n[0].collapse(true)||1)&&n[0].select()}f._selectedEl._4e_remove();f.hide();q.editor.notifySelectionChange();j.halt()});f.on("show",function(){var j=f._selectedEl;j&&f._plugin._updateTip(y,j)})}})};c.registerBubble("flash","Flash \u7f51\u5740\uff1a ",e);c.checkFlash=e;var x={"Flash\u5c5e\u6027":function(a){var b=
a.getSelection();b=b&&b.getStartElement();b=e(b);a=a._toolbars.flash;b&&a.show(null,b)}};c.CLS_FLASH=i;c.TYPE_FLASH="flash"}();l&&l.addRules({elements:{object:function(c){var e=c.attributes;if(!(e.classid&&String(e.classid).toLowerCase())){for(e=0;e<c.children.length;e++)if(c.children[e].name=="embed"){if(!g.Flash.isFlashEmbed(c.children[e]))break;return k.createFakeParserElement(c,i,"flash",true)}return null}return k.createFakeParserElement(c,i,"flash",true)},embed:function(c){if(!g.Flash.isFlashEmbed(c))return null;
return k.createFakeParserElement(c,i,"flash",true)}}},5)});
