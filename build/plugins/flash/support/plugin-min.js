KISSY.Editor.add("flash/support",function(){function e(a){this.editor=a;this._init()}function n(a){return a._4e_name()==="img"&&!!a.hasClass(k)&&a}var j=KISSY,g=j.Editor,s=j.UA,p=j.Event,t=g.ContextMenu,u=j.Node,o=g.BubbleView,k="ke_flash",q=g.Utils.flash;j.augment(e,{_config:function(){this._cls=k;this._type="flash";this._contextMenu=v;this._flashRules=["img."+k]},_init:function(){this._config();var a=this,b=a.editor,c={},d=a._contextMenu;if(d)for(var f in d)(function(h){c[h]=function(){d[h](a)}})(f);
a._contextMenu=t.register({editor:b,rules:a._flashRules,width:"120px",funcs:c});o.attach({pluginName:a._type,editor:a.editor,pluginContext:a});p.on(b.document,"dblclick",a._dbclick,a)},_getFlashUrl:function(a){return q.getUrl(a)},_updateTip:function(a,b){var c=this.editor.restoreRealElement(b);if(c){c=this._getFlashUrl(c);a.html(c);a.attr("href",c)}},_dbclick:function(a){var b=new u(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.show(null,b);a.halt()}},show:function(a,b){this.editor.useDialog(this._type+
"/dialog",function(c){c.show(b)})},destroy:function(){var a=this.editor;this._contextMenu.destroy();o.destroy(this._type);p.remove(a.document,"dblclick",this._dbclick,this);a.destroyDialog(this._type+"/dialog")}});g.Flash=e;e.registerBubble=function(a,b,c){o.register({pluginName:a,func:c,init:function(){var d=this,f=d.get("contentEl");f.html(b+' <a class="ke-bubbleview-url" target="_blank" href="#"></a> -  <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -  <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=f.one(".ke-bubbleview-url"),l=f.one(".ke-bubbleview-change"),w=f.one(".ke-bubbleview-remove");g.Utils.preventFocus(f);l.on("click",function(i){d._plugin.show(null,d._selectedEl);i.halt()});w.on("click",function(i){var r=d._plugin;if(s.webkit){var m=r.editor.getSelection().getRanges();m&&m[0]&&(m[0].collapse(true)||1)&&m[0].select()}d._selectedEl._4e_remove();d.hide();r.editor.notifySelectionChange();i.halt()});d.on("show",function(){var i=d._selectedEl;i&&d._plugin._updateTip(h,i)})}})};e.registerBubble("flash",
"Flash \u7f51\u5740\uff1a ",n);e.checkFlash=n;var v={"Flash\u5c5e\u6027":function(a){var b=a.editor.getSelection();b=b&&b.getStartElement();(b=n(b))&&a.show(null,b)}};e.CLS_FLASH=k;e.TYPE_FLASH="flash";e.Insert=function(a,b,c,d,f,h){b=q.createSWF(b,{attrs:c},a.document);var l=b.el;c=a.createFakeElement?a.createFakeElement(l,d||"ke_flash",f||"flash",true,b.html,c):l;a.insertElement(c,null,h)};g.Flash=e},{requires:["bubbleview","contextmenu","flashutils"]});
