KISSY.Editor.add("select",function(){function h(a){h.superclass.constructor.call(this,a);this._init()}var f=KISSY,g=f.Node,k=f.Event,l=f.DOM,i=f.Editor;if(!i.Select){h.ATTRS={container:{},doc:{},value:{},width:{},title:{},items:{}};f.extend(h,f.Base,{_init:function(){var a=this.get("container"),c=new g("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'></span><span class='ke-select-drop'></span></a></span>"),d=this.get("title"),b=c.one(".ke-select-text");
c.one(".ke-select-drop");b.html(d);b.css("width",this.get("width"));c._4e_unselectable();c.attr("title",d);c.appendTo(a);c.on("click",this._click,this);this.el=c;this.title=b;this._focusA=c.one("a.ke-select");i.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",this._valueChange,this)},_valueChange:function(a){a=a.newVal;for(var c=this.get("title"),d=this.get("items"),b=0;b<d.length;b++){var e=d[b];if(e.value==a){c=e.name;break}}this.title.html(c)},_itemsChange:function(a){a=a.newVal;
var c=this.menu.el;c.html("");if(a)for(var d=0;d<a.length;d++){var b=a[d];b=new g("<a class='ke-select-menu-item' href='#' data-value='"+b.value+"'>"+b.name+"</a>",b.attrs);b._4e_unselectable();b.appendTo(c)}this.as=c.all("a")},_prepare:function(){var a=this,c=a.el,d=a._focusA,b=new g("<div class='ke-menu' onmousedown='return false;'></div>"),e=new i.SimpleOverlay({el:b,focusMgr:false}),j=a.get("items");a.menu=e;a.get("title")&&(new g("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+
a.get("title")+"</div>")).appendTo(b);a._itemsChange({newVal:j});a.get("popUpWidth")&&b.css("width",a.get("popUpWidth"));b.appendTo(document.body);e.on("show",function(){d.addClass("ke-select-active")});e.on("hide",function(){d.removeClass("ke-select-active")});k.on([document,a.get("doc")],"click",function(m){c._4e_contains(m.target)||e.hide()});b.on("click",a._select,a);a.as=b.all("a");k.on(b[0],"mouseenter",function(){a.as.removeClass("ke-menu-selected")});a.on("afterItemsChange",a._itemsChange,
a)},_select:function(a){a.halt();var c=this.menu,d=c.el;if(a=(new g(a.target))._4e_ascendant(function(j){return d._4e_contains(j)&&j._4e_name()=="a"},true)){var b=this.get("value"),e=a.attr("data-value");this.set("value",e);this.fire("click",{newVal:e,preVal:b,name:a.html()});c.hide()}},_real:function(){var a=this.el.offset();a.top+=this.el.height();a.left+=1;if(a.left+this.menu.el.width()>l.viewportWidth()-60)a.left=l.viewportWidth()-this.menu.el.width()-60;this.menu.show(a)},_click:function(a){a.preventDefault();
var c=this.get("value");if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();c&&this.menu&&this.as.each(function(d){d.attr("data-value")==c?d.addClass("ke-menu-selected"):d.removeClass("ke-menu-selected")})}}});i.Select=h}});
