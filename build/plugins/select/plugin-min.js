KISSY.Editor.add("select",function(){function h(a){h.superclass.constructor.call(this,a);this._init()}var i=KISSY,o=i.UA,j=i.Node,n=i.Event,k=i.DOM,l=i.Editor;if(!l.Select){h.DISABLED=0;h.ENABLED=1;h.ATTRS={el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},menuContainer:{valueFn:function(){return this.el.parent()}},state:{value:1}};h.decorate=function(a){for(var b=a.width(),c=[],e=a.all("option"),d=0;d<e.length;d++){var f=e[d];c.push({name:k.html(f),value:k.attr(f,"value")})}return new h({width:b+
"px",el:a,items:c,cls:"ke-combox",value:a.val()})};i.extend(h,i.Base,{_init:function(){var a=this.get("container"),b=this.get("el"),c=new j("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),e=this.get("title")||"",d=this.get("cls"),f=c.one(".ke-select-text"),g=c.one(".ke-select-text-inner");c.one(".ke-select-drop");
this.get("value")!==undefined?g.html(this._findNameByV(this.get("value"))):g.html(e);o.ie==6&&setTimeout(function(){g.css("zoom",1)},0);f.css("width",this.get("width"));c._4e_unselectable();e&&c.attr("title",e);d&&c.addClass(d);if(b)b[0].parentNode.replaceChild(c[0],b[0]);else a&&c.appendTo(a);c.on("click",this._click,this);this.el=c;this.title=g;this._focusA=c.one("a.ke-select");l.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",this._valueChange,this);this.on("afterStateChange",
this._stateChange,this)},_findNameByV:function(a){for(var b=this.get("title")||"",c=this.get("items"),e=0;e<c.length;e++){var d=c[e];if(d.value==a){b=d.name;break}}return b},_valueChange:function(a){this.title.html(this._findNameByV(a.newVal))},_itemsChange:function(a){a=a.newVal;var b=this._selectList;b.html("");if(a)for(var c=0;c<a.length;c++){var e=a[c];(new j("<a class='ke-select-menu-item' href='#' data-value='"+e.value+"'>"+e.name+"</a>",e.attrs)).appendTo(b)._4e_unselectable()}this.as=b.all("a")},
val:function(a){if(a!==undefined){this.set("value",a);return this}else return this.get("value")},_prepare:function(){var a=this,b=a.el,c=a.get("popUpWidth"),e=a._focusA,d=new j("<div class='ke-menu' onmousedown='return false;'></div>"),f=new l.SimpleOverlay({el:d,zIndex:990,focusMgr:false}),g=a.get("items");a.menu=f;a.get("title")&&(new j("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+a.get("title")+"</div>")).appendTo(d);a._selectList=(new j("<div>")).appendTo(d);a._itemsChange({newVal:g});
c?d.css("width",c):d.css("width",b.width());d.appendTo(a.get("menuContainer"));f.on("show",function(){e.addClass("ke-select-active")});f.on("hide",function(){e.removeClass("ke-select-active")});n.on([document,a.get("doc")],"click",function(m){b._4e_contains(m.target)||f.hide()});d.on("click",a._select,a);a.as=a._selectList.all("a");n.on(d[0],"mouseenter",function(){a.as.removeClass("ke-menu-selected")});a.on("afterItemsChange",a._itemsChange,a)},_stateChange:function(a){var b=this.el;a.newVal==1?
b.removeClass("ke-select-disabled"):b.addClass("ke-select-disabled")},_select:function(a){a.halt();var b=this.menu,c=b.el;if(a=(new j(a.target))._4e_ascendant(function(f){return c._4e_contains(f)&&f._4e_name()=="a"},true)){var e=this.get("value"),d=a.attr("data-value");this.set("value",d);this.fire("click",{newVal:d,preVal:e,name:a.html()});b.hide()}},_real:function(){var a=this.el,b=a.offset(),c=i.clone(b),e=this.menu.el.height(),d=this.menu.el.width(),f=b.top,g=k.scrollTop(),m=k.viewportHeight(),
p=k.viewportWidth();b.top+=a.height()-2;if(b.top+e>g+m&&f-g>g+m-b.top){b=c;b.top-=e+9}if(b.left+d>p-60)b.left-=d-a.width();this.menu.show(b)},_click:function(a){a.preventDefault();a=this.el;var b=this.get("value");if(!a.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();b&&this.menu&&this.as.each(function(c){c.attr("data-value")==b?c.addClass("ke-menu-selected"):c.removeClass("ke-menu-selected")})}}});l.Select=h}});
