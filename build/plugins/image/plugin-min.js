KISSY.Editor.add("image",function(m){var e=KISSY.Editor,h=KISSY,p=h.UA,q=h.Node,r=h.Event,n=e.BubbleView;e.ImageInserter||function(){function i(a){i.superclass.constructor.call(this,a);this._init()}var j=function(a){return a._4e_name()==="img"&&!/(^|\s+)ke_/.test(a[0].className)&&a},s=e.TripleButton;i.ATTRS={editor:{}};var l={"\u56fe\u7247\u5c5e\u6027":function(a){var b=a.getSelection();b=b&&b.getStartElement();b=j(b);a=a._toolbars.image;b&&a.show(null,b)}};h.extend(i,h.Base,{_init:function(){var a=this.get("editor"),
b=a.toolBarDiv,c={};this.editor=a;this.el=new s({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",container:b});this.el.on("offClick",this.show,this);r.on(a.document,"dblclick",this._dblclick,this);e.Utils.lazyRun(this,"_prepare","_real");a._toolbars=a._toolbars||{};a._toolbars.image=this;if(l){for(var d in l)(function(f){c[f]=function(){l[f](a)}})(d);e.ContextMenu.register({editor:a,rules:[j],width:"120px",funcs:c})}n.attach({pluginName:"image",pluginInstance:this});e.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},
enable:function(){this.el.boff()},_dblclick:function(a){var b=this,c=new q(a.target);if(j(c)){setTimeout(function(){b.show(null,c)},1E3);a.halt()}},_updateTip:function(a,b){var c=b.attr("src");a.html(c);a.attr("href",c)},show:function(a,b){this.get("editor").useDialog("image/dialog",function(c){c.show(b)})}});e.ImageInserter=i;(function(a,b,c){n.register({pluginName:a,func:c,init:function(){var d=this,f=d.get("contentEl");f.html(b+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var t=f.one(".ke-bubbleview-url"),u=f.one(".ke-bubbleview-change"),v=f.one(".ke-bubbleview-remove");e.Utils.preventFocus(f);u.on("click",function(g){d._plugin.show(null,d._selectedEl);g.halt()});v.on("click",function(g){var o=d._plugin;if(p.webkit){var k=o.editor.getSelection().getRanges();k&&k[0]&&(k[0].collapse(true)||1)&&k[0].select()}d._selectedEl._4e_remove();d.hide();o.editor.notifySelectionChange();g.halt()});d.on("show",function(){var g=d._selectedEl;g&&d._plugin._updateTip(t,g)})}})})("image",
"\u56fe\u7247\u7f51\u5740\uff1a ",j)}();m.addPlugin(function(){new e.ImageInserter({editor:m})})});
