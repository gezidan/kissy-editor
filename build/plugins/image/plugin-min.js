KISSY.Editor.add("image",function(e){e.addPlugin("image",function(){var h=KISSY,f=h.Editor,n=h.UA,o=h.Node,p=h.Event,i=function(a){return a._4e_name()==="img"&&!/(^|\s+)ke_/.test(a[0].className)&&a},l=e.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:f.WYSIWYG_MODE,offClick:function(){this.call("show")},_updateTip:function(a,c){var d=c.attr("src");a.html(d);a.attr("href",d)},show:function(a,c){this.editor.useDialog("image/dialog",function(d){d.show(c)})}});f.use("contextmenu",function(){var a=
{"\u56fe\u7247\u5c5e\u6027":function(b){b=(b=b.getSelection())&&b.getStartElement();(b=i(b))&&l.call("show",null,b)}};p.on(e.document,"dblclick",function(b){var j=new o(b.target);b.halt();i(j)&&l.call("show",null,j)});var c={},d;for(d in a)(function(b){c[b]=function(){a[b](e)}})(d);f.ContextMenu.register({editor:e,rules:[i],width:"120px",funcs:c})});f.use("bubbleview",function(){f.BubbleView.register({pluginName:"image",pluginContext:l,editor:e,func:i,init:function(){var a=this,c=a.get("contentEl");c.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var d=c.one(".ke-bubbleview-url"),b=c.one(".ke-bubbleview-change"),j=c.one(".ke-bubbleview-remove");f.Utils.preventFocus(c);b.on("click",function(g){a._plugin.call("show",null,a._selectedEl);g.halt()});j.on("click",function(g){var m=a._plugin;if(n.webkit){var k=m.editor.getSelection().getRanges();k&&k[0]&&(k[0].collapse(true)||1)&&k[0].select()}a._selectedEl._4e_remove();a.hide();m.editor.notifySelectionChange();g.halt()});a.on("show",function(){var g=a._selectedEl;g&&a._plugin.call("_updateTip",
d,g)})}})})})},{attach:false});
