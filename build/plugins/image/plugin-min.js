KISSY.Editor.add("image",function(g){var d=KISSY.Editor,e=KISSY,i=e.Node,j=e.DOM,h=e.Event,k=d.SimpleOverlay;d.ImageInserter||function(){function f(a){f.superclass.constructor.call(this,a);this._init()}var l=d.TripleButton;f.ATTRS={editor:{}};e.extend(f,e.Base,{_init:function(){var a=this.get("editor").toolBarDiv;this.el=new l({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",container:a});this.el.on("offClick",this.show,this);d.Utils.lazyRun(this,"_prepare","_real")},_prepare:function(){var a=
this,c=a.get("editor");a.d=new k({title:"\u56fe\u7247\u5c5e\u6027",mask:true,width:"350px"});var b=a.d;b.body.html("<div><p><label><span style='color:#0066CC;font-weight:bold;'>\u56fe\u7247\u7f51\u5740\uff1a </span><input class='ke-img-url' style='width:230px' value='http://'/></label></p></div>");b.foot.html("<button class='ke-img-insert'>\u63d2\u5165</button> <button class='ke-img-cancel'>\u53d6\u6d88</button>");a.content=b.el;b=a.content;var m=b.one(".ke-img-cancel"),n=b.one(".ke-img-insert");
a.imgUrl=b.one(".ke-img-url");m.on("click",function(o){a.d.hide();o.halt()});h.on(document,"click",a.hide,a);h.on(c.document,"click",a.hide,a);n.on("click",function(){a._insert()})},hide:function(a){var c=this;j._4e_ascendant(a.target,function(b){return b[0]===c.content[0]||b[0]===c.el.el[0]},true)||this.d.hide()},_real:function(){this.d.show()},_insert:function(){var a=this.get("editor"),c=this.imgUrl.val();if(c){c=new i("<img src='"+c+"' alt='' />",null,a.document);a.insertElement(c,function(b){b.on("load",
function(){b.detach();b.css({width:b.width()+"px",height:b.height()+"px"})})});this.d.hide()}},show:function(){this._prepare()}});d.ImageInserter=f}();g.addPlugin(function(){new d.ImageInserter({editor:g})})});
