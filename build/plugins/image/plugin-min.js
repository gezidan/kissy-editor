KISSY.Editor.add("image",function(d){var g=KISSY,j=g.Editor,o=g.UA,p=g.Node,q=g.Event,r=j.BubbleView,h=function(c){return c._4e_name()==="img"&&!/(^|\s+)ke_/.test(c[0].className)&&c};d.ready(function(){var c=d.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",offClick:function(){this.call("show")},_updateTip:function(a,b){var e=b.attr("src");a.html(e);a.attr("href",e)},show:function(a,b){this.editor.useDialog("image/dialog",function(e){e.show(b)})}}),k={"\u56fe\u7247\u5c5e\u6027":function(a){a=(a=a.getSelection())&&
a.getStartElement();(a=h(a))&&c.call("show",null,a)}},l={},m;for(m in k)(function(a){l[a]=function(){k[a](d)}})(m);j.ContextMenu.register({editor:d,rules:[h],width:"120px",funcs:l});q.on(d.document,"dblclick",function(a){var b=new p(a.target);a.halt();h(b)&&c.call("show",null,b)});r.register({pluginName:"image",pluginContext:c,editor:d,func:h,init:function(){var a=this,b=a.get("contentEl");b.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var e=b.one(".ke-bubbleview-url"),s=b.one(".ke-bubbleview-change"),t=b.one(".ke-bubbleview-remove");j.Utils.preventFocus(b);s.on("click",function(f){a._plugin.call("show",null,a._selectedEl);f.halt()});t.on("click",function(f){var n=a._plugin;if(o.webkit){var i=n.editor.getSelection().getRanges();i&&i[0]&&(i[0].collapse(true)||1)&&i[0].select()}a._selectedEl._4e_remove();a.hide();n.editor.notifySelectionChange();f.halt()});a.on("show",function(){var f=a._selectedEl;f&&a._plugin.call("_updateTip",
e,f)})}})})});
