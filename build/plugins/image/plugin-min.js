KISSY.Editor.add("image",function(m){var d=KISSY.Editor,h=KISSY,p=h.UA,q=h.Node,r=h.Event,n=d.BubbleView;d.ImageInserter||function(){function i(a){i.superclass.constructor.call(this,a);this._init()}var j=function(a){return a._4e_name()==="img"&&!/(^|\s+)ke_/.test(a[0].className)&&a},s=d.TripleButton;i.ATTRS={editor:{}};var l={"\u56fe\u7247\u5c5e\u6027":function(a){var b=a.getSelection();b=b&&b.getStartElement();b=j(b);a=a._toolbars.image;b&&a.show(null,b)}};h.extend(i,h.Base,{_init:function(){var a=this.get("editor"),
b=a.toolBarDiv,e={};this.editor=a;this.el=new s({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",container:b});this.el.on("offClick",this.show,this);r.on(a.document,"dblclick",this._dblclick,this);d.Utils.lazyRun(this,"_prepare","_real");a._toolbars=a._toolbars||{};a._toolbars.image=this;if(l){for(var c in l)(function(f){e[f]=function(){l[f](a)}})(c);d.ContextMenu.register({editor:a,rules:[j],width:"120px",funcs:e})}n.attach({pluginName:"image",pluginInstance:this});d.Utils.sourceDisable(a,this)},disable:function(){this.el.disable()},
enable:function(){this.el.boff()},_dblclick:function(a){var b=new q(a.target);if(j(b)){this.show(null,b);a.halt()}},_updateTip:function(a,b){var e=b.attr("src");a.html(e);a.attr("href",e)},show:function(a,b){this.get("editor").useDialog("image/dialog",function(e){e.show(b)})}});d.ImageInserter=i;(function(a,b,e){n.register({pluginName:a,func:e,init:function(){var c=this,f=c.get("contentEl");f.html(b+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var t=f.one(".ke-bubbleview-url"),u=f.one(".ke-bubbleview-change"),v=f.one(".ke-bubbleview-remove");d.Utils.preventFocus(f);u.on("click",function(g){c._plugin.show(null,c._selectedEl);g.halt()});v.on("click",function(g){var o=c._plugin;if(p.webkit){var k=o.editor.getSelection().getRanges();k&&k[0]&&(k[0].collapse(true)||1)&&k[0].select()}c._selectedEl._4e_remove();c.hide();o.editor.notifySelectionChange();g.halt()});c.on("show",function(){var g=c._selectedEl;g&&c._plugin._updateTip(t,g)})}})})("image",
"\u56fe\u7247\u7f51\u5740\uff1a ",j)}();m.addPlugin(function(){new d.ImageInserter({editor:m})})});
