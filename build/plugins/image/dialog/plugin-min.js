KISSY.Editor.add("image/dialog",function(j){function u(){var c=l.val(),a=parseInt(p.val()),b=parseInt(q.val()),h=r.val(),t=parseInt(s.val()),e="";if(a)e+="height:"+a+"px;";if(b)e+="width:"+b+"px;";if(h)e+="float:"+h+";";isNaN(t)||(e+="margin:"+t+"px;");if(e)e=" style='"+e+"' ";a=new v("<img "+e+"src='"+c+"' alt='' />",null,j.document);f.hide();a=j.insertElement(a,function(g){g.on("abort error",function(){g.detach();g[0].src=c})});i&&j.getSelection().selectElement(a);j.notifySelectionChange()}var k=
KISSY,m=k.Editor,y=k.UA,z=k.JSON,v=k.Node,A=m.SimpleOverlay,f,n,l,p,q,r,s,i;j.addDialog("image/dialog",{show:function(c){var a="remote";if(i=c){l.val(i.attr("src"));p.val(i.height());q.val(i.width());r.val(i.css("float")||"none");c=parseInt(i._4e_style("margin"))||0;s.val(c)}else{if(n.getTab("local"))a="local";l.val("http://");p.val("\u81ea\u52a8");q.val("\u81ea\u52a8");r.val("none");s.val(0)}n.activate(a);f.show()},hide:function(){f.hide()}});(function(){var c="\u8bf7\u70b9\u51fb\u6d4f\u89c8\u4e0a\u4f20\u56fe\u7247",a=(j.cfg.pluginConfig.image||{}).upload||null;
f=new A({title:"\u56fe\u7247",mask:true});f.body.html("<div class='ke-image-wrap'><ul class='ke-tabs ks-clear'><li rel='remote'>\u7f51\u7edc\u56fe\u7247</li><li rel='local'>\u672c\u5730\u4e0a\u4f20</li></ul><div style='padding:12px 20px 5px 20px;'><div class='ke-image-tabs-content-wrap' ><div><label><span class='ke-image-title'>\u56fe\u7247\u5730\u5740\uff1a </span><input  data-verify='^https?://[^\\s]+$'  data-warning='\u7f51\u5740\u683c\u5f0f\u4e3a\uff1ahttp://' class='ke-img-url ke-input' style='width:390px;' value='http://'/></label></div><div style='position:relative;'><form class='ke-img-upload-form'><p style='zoom:1;'><input class='ke-input ke-img-local-url' readonly='readonly' style='margin-right: 15px; vertical-align: middle; width: 368px;color:#969696;'/><a style='padding:3px 11px;position:absolute;left:390px;top:0px;z-index:1;' class='ke-image-up ke-button'>\u6d4f\u89c8...</a></p><div class='ke-img-up-extraHtml'></div></form></div></div><table style='width:100%;margin-top:8px;' class='ke-img-setting'><tr><td><label>\u5bbd\u5ea6\uff1a <input  data-verify='^(\u81ea\u52a8|((?!0$)\\d+))$'  data-warning='\u5bbd\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570' class='ke-img-width ke-input' style='width:60px' value='\u81ea\u52a8'/> \u50cf\u7d20 </label></td><td><label>\u9ad8\u5ea6\uff1a <input  data-verify='^(\u81ea\u52a8|((?!0$)\\d+))$'  data-warning='\u9ad8\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570' class='ke-img-height ke-input' style='width:60px' value='\u81ea\u52a8'/> \u50cf\u7d20 </label></td></tr><tr><td><label>\u5bf9\u9f50\uff1a<select class='ke-img-align'><option value='none'>\u65e0</option><option value='left'>\u5de6\u5bf9\u9f50</option><option value='right'>\u53f3\u5bf9\u9f50</option></select></label></td><td><label>\u95f4\u8ddd\uff1a <input  data-verify='^\\d+$'  data-warning='\u95f4\u8ddd\u8bf7\u8f93\u5165\u975e\u8d1f\u6574\u6570' class='ke-img-margin ke-input' style='width:60px' value='0'/> \u50cf\u7d20</label></td></tr></table></div></div>");
f.foot.html("<a class='ke-img-insert ke-button' style='margin-right:30px;'>\u786e\u5b9a</a> <a  class='ke-img-cancel ke-button'>\u53d6\u6d88</a>");var b=f.el,h=b.one(".ke-img-cancel"),t=b.one(".ke-img-insert"),e=b.one(".ke-img-upload-form"),g=b.one(".ke-img-local-url"),w=m.Utils.verifyInputs,B=b.one(".ke-img-setting");n=new m.Tabs({tabs:b.one("ul.ke-tabs"),contents:b.one("div.ke-image-tabs-content-wrap")});g.val(c);l=b.one(".ke-img-url");p=b.one(".ke-img-height");q=b.one(".ke-img-width");r=m.Select.decorate(b.one(".ke-img-align"));
s=b.one(".ke-img-margin");h.on("click",function(d){f.hide();d.halt()});t.on("click",function(){if(n.activate()=="local"&&a){if(w(B.all("input")))if(g.val()==c)alert("\u8bf7\u5148\u9009\u62e9\u6587\u4ef6!");else{m.Utils.doFormUpload({form:e,callback:function(d){d=k.trim(d.responseText).replace(/\r|\n/g,"");f.unloading();try{d=z.parse(d)}catch(C){k.log(d);d={error:"\u670d\u52a1\u5668\u51fa\u9519\uff0c\u8bf7\u91cd\u8bd5"}}if(d.error)alert(d.error);else{l.val(d.imgUrl);u()}}},a.serverParams,a.serverUrl);f.loading()}}else w(b.all("input"))&&u()});if(a){a.extraHtml&&b.one(".ke-img-up-extraHtml").html(a.extraHtml);
var x=b.one(".ke-image-up");h=a&&a.sizeLimit;var o=(new v("<input type='file' style='position:absolute;cursor:pointer;left:"+(y.ie?"360":"369")+"px;z-index:2;top:0px;height:26px;' size='1' name='"+(a.fileInput||"Filedata")+"'/>")).insertAfter(g);if(h)c="\u5355\u5f20\u56fe\u7247\u5bb9\u91cf\u4e0d\u8d85\u8fc7 "+h/1E3+" M";g.val(c);o.css({opacity:0});o.on("mouseenter",function(){x.addClass("ke-button-hover")});o.on("mouseleave",function(){x.removeClass("ke-button-hover")});o.on("change",function(){g.val(o.val())})}else n.remove("local")})()});
