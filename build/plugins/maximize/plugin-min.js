KISSY.Editor.add("maximize",function(l){var d=KISSY.Editor,h=KISSY,j=h.UA,p=h.Node,m=h.Event,n=d.TripleButton,e=h.DOM,k;if(!(j.gecko<1.92)){d.Maximize||function(){function f(a){this.editor=a;this._init()}f.init=function(){k=(new p("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>")).appendTo(document.body);f.init=null};h.augment(f,{_init:function(){var a=new n({container:this.editor.toolBarDiv,title:"全屏",contentCls:"ke-toolbar-maximize"});
this.el=a;a.on("offClick",this.maximize,this);a.on("onClick",this.restore,this);d.Utils.lazyRun(this,"_prepare","_real")},restore:function(){var a=this,b=a.editor;a._resize&&m.remove(window,"resize",a._resize);a._saveEditorStatus();a._restoreState();a.el.boff();setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange()},30)},_restoreState:function(){var a=document,b=this.editor,c=this._savedParents;if(c){for(var g=0;g<c.length;g++){var i=c[g];i.el.css("position",i.position)}this._savedParents=
null}b.wrap.css({height:this.iframeHeight});e.css(a.body,{width:"",height:"",overflow:""});a.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:this.editorWrapWidth});k.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);a=this.el.el;a.one("span").removeClass("ke-toolbar-restore").addClass("ke-toolbar-maximize");a.attr("title","全屏")},_saveSate:function(){var a=this.editor,b=[],c=a.editorWrap;this.iframeHeight=a.wrap._4e_style("height");this.editorWrapWidth=
c._4e_style("width");this.scrollLeft=e.scrollLeft();this.scrollTop=e.scrollTop();window.scrollTo(0,0);for(a=c.parent();a;){c=a.css("position");if(c!="static"){b.push({el:a,position:c});a.css("position","static")}a=a.parent()}this._savedParents=b;b=this.el.el;this.el.el.one("span").removeClass("ke-toolbar-maximize").addClass("ke-toolbar-restore");b.attr("title","取消全屏")},_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;if(j.gecko&&a.iframeFocus)this.savedRanges=(a=a.getSelection())&&
a.getRanges()},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;a.activateGecko();c&&b&&b.selectRanges(c);if(a.iframeFocus&&b)(a=b.getStartElement())&&a[0]&&a._4e_scrollIntoView();j.ie<8&&this.el.el.one("span").css("background-image","")},_maximize:function(a){var b=document,c=this.editor,g=c.editorWrap,i=e.viewportHeight(),o=e.viewportWidth(),q=c.statusDiv?c.statusDiv.height():0,r=c.toolBarDiv.height();if(j.ie)b.body.style.overflow="hidden";else e.css(b.body,
{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";g.css({position:"absolute",zIndex:c.baseZIndex(990),width:o+"px"});k.css({zIndex:c.baseZIndex(985),height:i+"px",width:o+"px"});g.offset({left:0,top:0});k.css({left:0,top:0});c.wrap.css({height:i-q-r-8+"px"});a!==true&&arguments.callee.call(this,true)},_real:function(){var a=this,b=a.editor;a._saveEditorStatus();a._saveSate();a._maximize();a._resize=a._resize||d.Utils.buffer(a._maximize,a,100);m.on(window,"resize",a._resize);
a.el.set("state",n.ON);setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange()},30)},_prepare:function(){f.init&&f.init()},maximize:function(){this._prepare()}});d.Maximize=f}();l.addPlugin(function(){new d.Maximize(l)})}});
