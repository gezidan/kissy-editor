KISSY.Editor.add("maximize",function(n){var e=KISSY.Editor,f=KISSY,k=f.UA,l=f.Node,o=f.Event,m=e.TripleButton,i=f.DOM,g;e.Maximize||function(){function c(a){this.editor=a;this._init()}c.init=function(){g=new l("<iframe style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>");document.body.appendChild(g[0]);c.init=null};f.augment(c,{_init:function(){this.el=new m({container:this.editor.toolBarDiv,title:"全屏",contentCls:"ke-toolbar-maximize"});this.el.on("offClick",this.maximize,
this);this.el.on("onClick",this.restore,this);e.Utils.lazyRun(this,"_prepare","_real")},restore:function(){var a=this,b=a.editor;o.remove(window,"resize",a._maximize,a);var d=a._savedParents;if(d)for(var h=0;h<d.length;h++){var j=d[h];j.el.css("position",j.position)}this._saveEditorStatus();b.wrap.css({height:a.iframeHeight});(new l(document.body)).css({width:"",height:"",overflow:""});document.documentElement.style.overflow="";b.editorWrap.css({position:"static",width:a.editorWrapWidth});g.css({left:"-99999px",
top:"-99999px"});window.scrollTo(a.scrollLeft,a.scrollTop);a.el.set("state",m.OFF);setTimeout(function(){a._restoreEditorStatus()},30);b.notifySelectionChange()},_saveSate:function(){var a=this.editor;this.iframeHeight=a.wrap._4e_style("height");this.editorWrapWidth=a.editorWrap._4e_style("width");this.scrollLeft=i.scrollLeft();this.scrollTop=i.scrollTop();window.scrollTo(0,0);this._savedParents=[];for(a=a.editorWrap.parent();a;){if(a.css("position")!="static"){this._savedParents.push({el:a,position:a.css("position")});
a.css("position","static")}a=a.parent()}},_saveEditorStatus:function(){var a=this.editor;if(k.gecko&&a.iframeFocus)this.savedRanges=(a=a.getSelection())&&a.getRanges()},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection();if(k.gecko&&a.iframeFocus){this.el.el[0].focus();a.focus();this.savedRanges&&b&&b.selectRanges(this.savedRanges)}if(a.iframeFocus&&b)(a=b.getStartElement())&&a[0]&&a._4e_scrollIntoView()},_maximize:function(){var a=this.editor,b=i.viewportHeight(),d=i.viewportWidth(),
h=a.statusDiv?a.statusDiv.height():0,j=a.toolBarDiv.height();if(k.ie){document.documentElement.style.overflow="hidden";document.body.style.overflow="hidden"}else(new l(document.body)).css({width:0,height:0,overflow:"hidden"});a.editorWrap.css({position:"absolute",zIndex:990,width:d+"px"});g.css({zIndex:985,height:b+"px",width:d+"px"});a.editorWrap.offset({left:0,top:0});g.css({left:0,top:0});a.wrap.css({height:b-h-j-14+"px"});a.notifySelectionChange()},_real:function(){var a=this;this._saveEditorStatus();
this._saveSate();this._maximize();this._maximize();o.on(window,"resize",a._maximize,a);this.el.set("state",m.ON);setTimeout(function(){a._restoreEditorStatus()},30)},_prepare:function(){c.init&&c.init()},maximize:function(){this._prepare()}});e.Maximize=c}();n.addPlugin(function(){new e.Maximize(n)})});
