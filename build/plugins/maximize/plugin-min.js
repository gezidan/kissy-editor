KISSY.Editor.add("maximize",function(l){var g=KISSY.Editor,h=KISSY,m=h.UA,o=h.Node,n=h.Event,k=g.TripleButton,d=h.DOM,j;if(!(m.gecko<1.92)){g.Maximize||function(){function e(a){this.editor=a;this._init()}e.init=function(){j=(new o("<iframe style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>")).appendTo(document.body);e.init=null};h.augment(e,{_init:function(){var a=new k({container:this.editor.toolBarDiv,title:"全屏",contentCls:"ke-toolbar-maximize"});this.el=a;a.on("offClick",
this.maximize,this);a.on("onClick",this.restore,this);g.Utils.lazyRun(this,"_prepare","_real")},restore:function(){var a=this,b=a.editor;n.remove(window,"resize",a._maximize,a);a._saveEditorStatus();a._restoreState();a.el.set("state",k.OFF);setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange()},30)},_restoreState:function(){var a=document,b=this.editor,c=this._savedParents;if(c)for(var f=0;f<c.length;f++){var i=c[f];i.el.css("position",i.position)}b.wrap.css({height:this.iframeHeight});
d.css([a.documentElement,a.body],{width:"",height:"",overflow:""});b.editorWrap.css({position:"static",width:this.editorWrapWidth});j.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop)},_saveSate:function(){var a=this.editor,b=[],c=a.editorWrap;this.iframeHeight=a.wrap._4e_style("height");this.editorWrapWidth=c._4e_style("width");this.scrollLeft=d.scrollLeft();this.scrollTop=d.scrollTop();window.scrollTo(0,0);for(a=c.parent();a;){if(a.css("position")!="static"){b.push({el:a,
position:a.css("position")});a.css("position","static")}a=a.parent()}this._savedParents=b},_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;if(m.gecko&&a.iframeFocus)this.savedRanges=(a=a.getSelection())&&a.getRanges()},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;a.activateGecko();c&&b&&b.selectRanges(c);if(a.iframeFocus&&b)(a=b.getStartElement())&&a[0]&&a._4e_scrollIntoView()},_maximize:function(){var a=document,b=this.editor,c=b.editorWrap,
f=d.viewportHeight(),i=d.viewportWidth(),p=b.statusDiv?b.statusDiv.height():0,q=b.toolBarDiv.height();d.css([a.documentElement,a.body],{width:0,height:0,overflow:"hidden"});c.css({position:"absolute",zIndex:990,width:i+"px"});j.css({zIndex:985,height:f+"px",width:i+"px"});c.offset({left:0,top:0});j.css({left:0,top:0});b.wrap.css({height:f-p-q-8+"px"})},_real:function(){var a=this,b=a.editor;a._saveEditorStatus();a._saveSate();a._maximize();a._maximize();n.on(window,"resize",a._maximize,a);a.el.set("state",
k.ON);setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange()},30)},_prepare:function(){e.init&&e.init()},maximize:function(){this._prepare()}});g.Maximize=e}();l.addPlugin(function(){new g.Maximize(l)})}});
